# Issue 23803: Allow graceful Sphinx upgrades

archive/issues_023566.json:
```json
{
    "body": "The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n\n**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n\nCC:  @jhpalmieri\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: John Palmieri\n\nAuthor: Jeroen Demeyer\n\nBranch: 150baf55e4380b63b57fe998877cd5ce70a40bdb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23803\n\n",
    "closed_at": "2017-09-15T07:47:36Z",
    "created_at": "2017-09-08T07:48:04Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Allow graceful Sphinx upgrades",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23803",
    "user": "https://github.com/jdemeyer"
}
```
The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.

**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048

CC:  @jhpalmieri

Upstream: Fixed upstream, but not in a stable release.

Reviewer: John Palmieri

Author: Jeroen Demeyer

Branch: 150baf55e4380b63b57fe998877cd5ce70a40bdb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23803





---

archive/issue_comments_451434.json:
```json
{
    "body": "<a id='comment:1'></a>\nActually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.",
    "created_at": "2017-09-08T09:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451434",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Actually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.



---

archive/issue_comments_451435.json:
```json
{
    "body": "<a id='comment:2'></a>\nhttps://github.com/sphinx-doc/sphinx/pull/4048",
    "created_at": "2017-09-08T09:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451435",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
https://github.com/sphinx-doc/sphinx/pull/4048



---

archive/issue_events_069027.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "rename": {
        "from": "Rebuild doc when Sphinx is reinstalled",
        "to": "Allow graceful Sphinx upgrades"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23803#event-69027"
}
```



---

archive/issue_comments_451436.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-09-08T10:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451436",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_451437.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.\n+The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n+\n+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n``````\n",
    "created_at": "2017-09-08T10:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451437",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.
+The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.
+
+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048
``````




---

archive/issue_comments_451438.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled\"",
    "created_at": "2017-09-08T10:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451438",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled"



---

archive/issue_comments_451439.json:
```json
{
    "body": "Changing commit from \"\" to \"150baf55e4380b63b57fe998877cd5ce70a40bdb\"",
    "created_at": "2017-09-08T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451439",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "150baf55e4380b63b57fe998877cd5ce70a40bdb"



---

archive/issue_comments_451440.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-08T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451440",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_451441.json:
```json
{
    "body": "<a id='comment:5'></a>\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)|`Allow graceful Sphinx upgrade`|",
    "created_at": "2017-09-08T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451441",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)|`Allow graceful Sphinx upgrade`|



---

archive/issue_comments_451442.json:
```json
{
    "body": "<a id='comment:6'></a>\nIs it worth printing more information than just\n\n```\n[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'\n```\nto let users know that this is indeed harmless?",
    "created_at": "2017-09-08T18:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451442",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
Is it worth printing more information than just

```
[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'
```
to let users know that this is indeed harmless?



---

archive/issue_comments_451443.json:
```json
{
    "body": "<a id='comment:7'></a>\nI don't really see the point... In any case, I feel that this is something that upstream should decide.",
    "created_at": "2017-09-09T08:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451443",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I don't really see the point... In any case, I feel that this is something that upstream should decide.



---

archive/issue_comments_451444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-11T16:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451444",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_451445.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2017-09-11T16:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451445",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_451446.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jdemeyer](#comment%3A7):\n> I don't really see the point... \n\n\nThe point, as I said, is \"to let users know that this is indeed harmless\". Some people worry when they see messages saying that something \"failed\".",
    "created_at": "2017-09-11T16:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451446",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Replying to [jdemeyer](#comment%3A7):
> I don't really see the point... 


The point, as I said, is "to let users know that this is indeed harmless". Some people worry when they see messages saying that something "failed".



---

archive/issue_events_069028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-15T07:47:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23803#event-69028"
}
```



---

archive/issue_comments_451447.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-15T07:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451447",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_451448.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled\" to \"150baf55e4380b63b57fe998877cd5ce70a40bdb\"",
    "created_at": "2017-09-15T07:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451448",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled" to "150baf55e4380b63b57fe998877cd5ce70a40bdb"



---

archive/issue_comments_451449.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2017-09-25T11:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451449",
    "user": "https://github.com/jdemeyer"
}
```

Changing upstream from "N/A" to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_451450.json:
```json
{
    "body": "Changing commit from \"150baf55e4380b63b57fe998877cd5ce70a40bdb\" to \"\"",
    "created_at": "2017-09-25T11:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-451450",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "150baf55e4380b63b57fe998877cd5ce70a40bdb" to ""
