# Issue 23803: Allow graceful Sphinx upgrades

archive/issues_023566.json:
```json
{
    "body": "The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n\n**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n\nCC:  @jhpalmieri\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: John Palmieri\n\nAuthor: Jeroen Demeyer\n\nBranch: 150baf55e4380b63b57fe998877cd5ce70a40bdb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23803\n\n",
    "closed_at": "2017-09-15T07:47:36Z",
    "created_at": "2017-09-08T07:48:04Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Allow graceful Sphinx upgrades",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23803",
    "user": "https://github.com/jdemeyer"
}
```
The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.

**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048

CC:  @jhpalmieri

Upstream: Fixed upstream, but not in a stable release.

Reviewer: John Palmieri

Author: Jeroen Demeyer

Branch: 150baf55e4380b63b57fe998877cd5ce70a40bdb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23803





---

archive/issue_comments_351315.json:
```json
{
    "body": "<a id='comment:1'></a>Actually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.",
    "created_at": "2017-09-08T09:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351315",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>Actually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.



---

archive/issue_comments_351316.json:
```json
{
    "body": "<a id='comment:2'></a>https://github.com/sphinx-doc/sphinx/pull/4048",
    "created_at": "2017-09-08T09:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351316",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>https://github.com/sphinx-doc/sphinx/pull/4048



---

archive/issue_comments_351317.json:
```json
{
    "body": "Changing component from build to packages: standard.",
    "created_at": "2017-09-08T10:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351317",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from build to packages: standard.



---

archive/issue_comments_351318.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-The upgrade to Sphinx-1.6.3 broke docbuilding if \\`make doc-clean\\` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.\n+The upgrade to Sphinx-1.6.3 broke docbuilding if \\`make doc-clean\\` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n+\n+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n \n Comment: 1\n \n```\n",
    "created_at": "2017-09-08T10:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351318",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
-The upgrade to Sphinx-1.6.3 broke docbuilding if \`make doc-clean\` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.
+The upgrade to Sphinx-1.6.3 broke docbuilding if \`make doc-clean\` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.
+
+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048
 
 Comment: 1
 
```




---

archive/issue_comments_351319.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-08T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351319",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_351320.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2017-09-08T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351320",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_351321.json:
```json
{
    "body": "<a id='comment:6'></a>Is it worth printing more information than just\n\n```\n[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'\n```\nto let users know that this is indeed harmless?",
    "created_at": "2017-09-08T18:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351321",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Is it worth printing more information than just

```
[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'
```
to let users know that this is indeed harmless?



---

archive/issue_comments_351322.json:
```json
{
    "body": "<a id='comment:7'></a>I don't really see the point... In any case, I feel that this is something that upstream should decide.",
    "created_at": "2017-09-09T08:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351322",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I don't really see the point... In any case, I feel that this is something that upstream should decide.



---

archive/issue_comments_351323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-11T16:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351323",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_351324.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:\n> I don't really see the point... \n\n\nThe point, as I said, is \"to let users know that this is indeed harmless\". Some people worry when they see messages saying that something \"failed\".",
    "created_at": "2017-09-11T16:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351324",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:
> I don't really see the point... 


The point, as I said, is "to let users know that this is indeed harmless". Some people worry when they see messages saying that something "failed".



---

archive/issue_events_060699.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-15T07:47:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23803#event-60699"
}
```



---

archive/issue_comments_351325.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-15T07:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23803#issuecomment-351325",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
