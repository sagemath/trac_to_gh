# Issue 23803: Allow graceful Sphinx upgrades

archive/issues_023566.json:
```json
{
    "assignees": [],
    "body": "The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n\n**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n\nCC:  @jhpalmieri\n\nBranch: **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **John Palmieri**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23803_\n\n",
    "closed_at": "2017-09-15T07:47:36Z",
    "created_at": "2017-09-08T07:48:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Allow graceful Sphinx upgrades",
    "type": "issue",
    "updated_at": "2017-09-25T11:30:14Z",
    "url": "https://github.com/sagemath/sage/issues/23803",
    "user": "https://github.com/jdemeyer"
}
```
The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.

**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048

CC:  @jhpalmieri

Branch: **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **John Palmieri**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23803_





---

archive/issue_events_312693.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T07:48:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312693"
}
```



---

archive/issue_events_312694.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T07:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312694"
}
```



---

archive/issue_events_312695.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T07:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312695"
}
```



---

archive/issue_events_312696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T07:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312696"
}
```



---

archive/issue_comments_361712.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nActually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.",
    "created_at": "2017-09-08T09:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361712",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">Comment 1</div>

Actually, I'm experimenting with a much simpler change to allow a graceful upgrade to Sphinx-1.6.3: it's a specific pickle which fails to load. Wrapping that in `try`/`except` might work.



---

archive/issue_comments_361713.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nhttps://github.com/sphinx-doc/sphinx/pull/4048",
    "created_at": "2017-09-08T09:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361713",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

https://github.com/sphinx-doc/sphinx/pull/4048



---

archive/issue_events_312697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T10:16:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312697"
}
```



---

archive/issue_events_312698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T10:16:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312698"
}
```



---

archive/issue_events_312699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T10:16:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "title_is": "Allow graceful Sphinx upgrades",
    "title_was": "Rebuild doc when Sphinx is reinstalled",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312699"
}
```



---

archive/issue_comments_361714.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-09-08T10:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361714",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_361715.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.\n+The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the \"environment pickle\" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.\n+\n+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048\n``````\n",
    "created_at": "2017-09-08T10:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361715",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. We propose to automatically delete documentation in the docbuilder if Sphinx was reinstalled.
+The upgrade to Sphinx-1.6.3 broke docbuilding if `make doc-clean` was not done. This is because the "environment pickle" from the old Sphinx failed to unpickle with the new Sphinx. This pickle is not so important, we can just ignore this error and continue.
+
+**Upstream**: https://github.com/sphinx-doc/sphinx/pull/4048
``````




---

archive/issue_comments_361716.json:
```json
{
    "body": "Branch: **[u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled)**",
    "created_at": "2017-09-08T10:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361716",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled)**



---

archive/issue_comments_361717.json:
```json
{
    "body": "Commit: **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**",
    "created_at": "2017-09-08T10:18:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361717",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**



---

archive/issue_events_312700.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-08T10:18:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312700"
}
```



---

archive/issue_comments_361718.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb\">150baf5</a></td><td><code>Allow graceful Sphinx upgrade</code></td></tr></table>\n",
    "created_at": "2017-09-08T10:18:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361718",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">Comment 5</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb">150baf5</a></td><td><code>Allow graceful Sphinx upgrade</code></td></tr></table>




---

archive/issue_comments_361719.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nIs it worth printing more information than just\n\n```\n[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'\n```\nto let users know that this is indeed harmless?",
    "created_at": "2017-09-08T18:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361719",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">Comment 6</div>

Is it worth printing more information than just

```
[diophanti] loading pickled environment... failed: 'module' object has no attribute 'WarningStream'
```
to let users know that this is indeed harmless?



---

archive/issue_comments_361720.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI don't really see the point... In any case, I feel that this is something that upstream should decide.",
    "created_at": "2017-09-09T08:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361720",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">Comment 7</div>

I don't really see the point... In any case, I feel that this is something that upstream should decide.



---

archive/issue_events_312701.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-11T16:47:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312701"
}
```



---

archive/issue_events_312702.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-09-11T16:47:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312702"
}
```



---

archive/issue_comments_361721.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2017-09-11T16:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361721",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_361722.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@jdemeyer](#comment%3A7):\n> I don't really see the point... \n\nThe point, as I said, is \"to let users know that this is indeed harmless\". Some people worry when they see messages saying that something \"failed\".",
    "created_at": "2017-09-11T16:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361722",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@jdemeyer](#comment%3A7):
> I don't really see the point... 

The point, as I said, is "to let users know that this is indeed harmless". Some people worry when they see messages saying that something "failed".



---

archive/issue_events_312703.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-15T07:47:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312703"
}
```



---

archive/issue_events_312704.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c24c802cb1e5bd29c5c5f2c6d7d5564b59ac3306",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-15T07:47:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23803#event-312704"
}
```



---

archive/issue_comments_361723.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled)** to **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**",
    "created_at": "2017-09-15T07:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361723",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/rebuild_doc_when_sphinx_is_reinstalled)** to **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)**



---

archive/issue_comments_361724.json:
```json
{
    "body": "Upstream: **Fixed upstream, but not in a stable release.**",
    "created_at": "2017-09-25T11:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361724",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_361725.json:
```json
{
    "body": "Changed commit from **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)** to none",
    "created_at": "2017-09-25T11:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23803#issuecomment-361725",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[150baf5](https://github.com/sagemath/sagetrac-mirror/commit/150baf55e4380b63b57fe998877cd5ce70a40bdb)** to none
