# Issue 23712: Upgrade to Tachyon 0.99.5

archive/issues_023475.json:
```json
{
    "assignees": [],
    "body": "We currently are shipping a 12 years old tachyon (0.98.9).\n\n0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/\n\nThis is also needed to make Sage work on arm64/aarch64, see #23687.\n\n\n\nMany distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions\n\n\nIn Debian:\n- https://salsa.debian.org/science-team/tachyon\n- https://packages.debian.org/source/buster/tachyon\n- https://packages.debian.org/source/sid/tachyon\n- https://packages.debian.org/source/stretch/tachyon\n\n\nCC:  @slel @orlitzky @kiwifb @antonio-rojas @tscrim\n\nKeywords: **upgrade, tachyon**\n\nBranch/Commit: **[u/dimpase/packages/tachyon0992](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/tachyon0992) @ [`d3034fc`](https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Dima Pasechnik, Gonzalo Tornar\u00eda**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23712_\n\n",
    "created_at": "2017-08-25T10:56:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/positive%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to Tachyon 0.99.5",
    "type": "issue",
    "updated_at": "2023-01-07T00:09:23Z",
    "url": "https://github.com/sagemath/sage/issues/23712",
    "user": "https://github.com/dimpase"
}
```
We currently are shipping a 12 years old tachyon (0.98.9).

0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/

This is also needed to make Sage work on arm64/aarch64, see #23687.



Many distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions


In Debian:
- https://salsa.debian.org/science-team/tachyon
- https://packages.debian.org/source/buster/tachyon
- https://packages.debian.org/source/sid/tachyon
- https://packages.debian.org/source/stretch/tachyon


CC:  @slel @orlitzky @kiwifb @antonio-rojas @tscrim

Keywords: **upgrade, tachyon**

Branch/Commit: **[u/dimpase/packages/tachyon0992](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/tachyon0992) @ [`d3034fc`](https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a)**

Reviewer: **Matthias Koeppe**

Author: **Dima Pasechnik, Gonzalo Tornar√≠a**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/23712_





---

archive/issue_events_326825.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-08-25T10:56:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326825"
}
```



---

archive/issue_events_326826.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-08-25T10:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326826"
}
```



---

archive/issue_events_326827.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-08-25T10:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326827"
}
```



---

archive/issue_events_326828.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-08-25T10:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326828"
}
```



---

archive/issue_comments_357544.json:
```json
{
    "body": "Branch: **[public/23712](https://github.com/sagemath/sagetrac-mirror/tree/public/23712)**",
    "created_at": "2017-08-25T17:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357544",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/23712](https://github.com/sagemath/sagetrac-mirror/tree/public/23712)**



---

archive/issue_comments_357545.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNone of our 4 patches does apply. I do not know if they should be removed or rebased.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9\"><code>8138ccf</code></a></td><td><code>new tachyon 99b6</code></td></tr></table>\n",
    "created_at": "2017-08-25T17:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357545",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

None of our 4 patches does apply. I do not know if they should be removed or rebased.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9"><code>8138ccf</code></a></td><td><code>new tachyon 99b6</code></td></tr></table>




---

archive/issue_comments_357546.json:
```json
{
    "body": "Commit: **[`8138ccf`](https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9)**",
    "created_at": "2017-08-25T17:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357546",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`8138ccf`](https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9)**



---

archive/issue_comments_357547.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nthere are quite a few doctests failing with this branch. Presumably the interface might have changed a bit.",
    "created_at": "2017-08-26T22:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357547",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

there are quite a few doctests failing with this branch. Presumably the interface might have changed a bit.



---

archive/issue_comments_357548.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@dimpase](#comment:2):\n> there are quite a few doctests failing with this branch. Presumably the interface might have changed a bit.\n\nThat's what I remember. Are all the failing doctests in doc? I realised yesterday that I have lost the ability to test those in sage-on-gentoo recently (for some reason .rst files get installed as .rst.txt and then they are not tested). So I miss all broken doctests from rst files at the moment. \n\nFor the record I don't seem to have any (repeatable) failures on the stuff I doctest in sage-on-gentoo.",
    "created_at": "2017-08-27T03:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357548",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@dimpase](#comment:2):
> there are quite a few doctests failing with this branch. Presumably the interface might have changed a bit.

That's what I remember. Are all the failing doctests in doc? I realised yesterday that I have lost the ability to test those in sage-on-gentoo recently (for some reason .rst files get installed as .rst.txt and then they are not tested). So I miss all broken doctests from rst files at the moment. 

For the record I don't seem to have any (repeatable) failures on the stuff I doctest in sage-on-gentoo.



---

archive/issue_comments_357549.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is what I get with ptestlong:\n\n```\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_plot3d.py  # 1 doctest failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/implicit_plot3d.py  # 6 doctests failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/platonic.py  # 1 doctest failed\nsage -t --long --warn-long 45.7 src/sage/graphs/generic_graph.py  # 9 doctests failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_surface.pyx  # 3 doctests failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/implicit_surface.pyx  # 1 doctest failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/tachyon.py  # 21 doctests failed\nsage -t --long --warn-long 45.7 src/sage/combinat/tiling.py  # 1 doctest failed\nsage -t --long --warn-long 45.7 src/sage/numerical/sdp.pyx  # 9 doctests failed\nsage -t --long --warn-long 45.7 src/sage/numerical/backends/cvxopt_sdp_backend.pyx  # 7 doctests failed\nsage -t --long --warn-long 45.7 src/sage/geometry/polyhedron/backend_normaliz.py  # 2 doctests failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/index_face_set.pyx  # 1 doctest failed\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/base.pyx  # 1 doctest failed\n```\nTypically it's something about PNG interface:\n\n```\nUsing --optional=ccache,cmake,database_gap,gap_packages,mpir,normaliz,pynormaliz,python2,qhull,sage\nDoctesting entire Sage library.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 3578 files using 4 threads.\nsage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_plot3d.py\n**********************************************************************\nFile \"src/sage/plot/plot3d/parametric_plot3d.py\", line 172, in sage.plot.plot3d.parametric_plot3d.?\nFailed example:\n    P.show(viewer='tachyon')\nException raised:\n    Traceback (most recent call last):\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.parametric_plot3d.?[13]>\", line 1, in <module>\n        P.show(viewer='tachyon')\n      File \"sage/plot/plot3d/base.pyx\", line 1478, in sage.plot.plot3d.base.Graphics3d.show (build/cythonized/sage/plot/plot3d/base.c\n:21367)\n        dm.display_immediately(self, **kwds)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 834, in displa\ny_immediately\n        self._backend.display_immediately(plain_text, rich_output)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_doctest.py\", line 209, in displa\ny_immediately\n        self.validate(rich_output)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_doctest.py\", line 270, in valida\nte\n        assert rich_output.png.get().startswith('\\x89PNG')\n    AssertionError\n```\nRunning the corresponding lines at the Sage prompt works and shows a meaningful plot.\nHowever, it's not stored in a PNG file, it's stored in TGA file:\n\n```\n$ file tmp_ZccmzF.png \ntmp_ZccmzF.png: Targa image data - RGB 500 x 500 x 24 - top Targa image data - RGB 500 x 500 x 24 - top\n```",
    "created_at": "2017-08-27T17:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357549",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

This is what I get with ptestlong:

```
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_plot3d.py  # 1 doctest failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/implicit_plot3d.py  # 6 doctests failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/platonic.py  # 1 doctest failed
sage -t --long --warn-long 45.7 src/sage/graphs/generic_graph.py  # 9 doctests failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_surface.pyx  # 3 doctests failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/implicit_surface.pyx  # 1 doctest failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/tachyon.py  # 21 doctests failed
sage -t --long --warn-long 45.7 src/sage/combinat/tiling.py  # 1 doctest failed
sage -t --long --warn-long 45.7 src/sage/numerical/sdp.pyx  # 9 doctests failed
sage -t --long --warn-long 45.7 src/sage/numerical/backends/cvxopt_sdp_backend.pyx  # 7 doctests failed
sage -t --long --warn-long 45.7 src/sage/geometry/polyhedron/backend_normaliz.py  # 2 doctests failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/index_face_set.pyx  # 1 doctest failed
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/base.pyx  # 1 doctest failed
```
Typically it's something about PNG interface:

```
Using --optional=ccache,cmake,database_gap,gap_packages,mpir,normaliz,pynormaliz,python2,qhull,sage
Doctesting entire Sage library.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 3578 files using 4 threads.
sage -t --long --warn-long 45.7 src/sage/plot/plot3d/parametric_plot3d.py
**********************************************************************
File "src/sage/plot/plot3d/parametric_plot3d.py", line 172, in sage.plot.plot3d.parametric_plot3d.?
Failed example:
    P.show(viewer='tachyon')
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.parametric_plot3d.?[13]>", line 1, in <module>
        P.show(viewer='tachyon')
      File "sage/plot/plot3d/base.pyx", line 1478, in sage.plot.plot3d.base.Graphics3d.show (build/cythonized/sage/plot/plot3d/base.c
:21367)
        dm.display_immediately(self, **kwds)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 834, in displa
y_immediately
        self._backend.display_immediately(plain_text, rich_output)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_doctest.py", line 209, in displa
y_immediately
        self.validate(rich_output)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_doctest.py", line 270, in valida
te
        assert rich_output.png.get().startswith('\x89PNG')
    AssertionError
```
Running the corresponding lines at the Sage prompt works and shows a meaningful plot.
However, it's not stored in a PNG file, it's stored in TGA file:

```
$ file tmp_ZccmzF.png 
tmp_ZccmzF.png: Targa image data - RGB 500 x 500 x 24 - top Targa image data - RGB 500 x 500 x 24 - top
```



---

archive/issue_comments_357550.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIn fact, ldd says that tachyon is not linked to libpng - no wonder it cannot do PNG.",
    "created_at": "2017-08-27T17:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357550",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

In fact, ldd says that tachyon is not linked to libpng - no wonder it cannot do PNG.



---

archive/issue_comments_357551.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI see that Debian has a set of patches to this version, including autotoolisation!\nhttps://packages.debian.org/source/sid/tachyon\n\nShould we use them, rather than keep wrestling with patches to Makefiles?",
    "created_at": "2017-08-27T17:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357551",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

I see that Debian has a set of patches to this version, including autotoolisation!
https://packages.debian.org/source/sid/tachyon

Should we use them, rather than keep wrestling with patches to Makefiles?



---

archive/issue_comments_357552.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nProbably. The linking problem would also explain why I don't see those failures in s-o-g.",
    "created_at": "2017-08-27T20:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357552",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

Probably. The linking problem would also explain why I don't see those failures in s-o-g.



---

archive/issue_comments_357553.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThat's a lot of patches https://anonscm.debian.org/cgit/debian-science/packages/tachyon.git/tree/debian/patches but most of them will probably be handy. Are you up to write a `spkg-src`?",
    "created_at": "2017-08-28T09:32:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357553",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

That's a lot of patches https://anonscm.debian.org/cgit/debian-science/packages/tachyon.git/tree/debian/patches but most of them will probably be handy. Are you up to write a `spkg-src`?



---

archive/issue_comments_357554.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@kiwifb](#comment:8):\n> That's a lot of patches https://anonscm.debian.org/cgit/debian-science/packages/tachyon.git/tree/debian/patches but most of them will probably be handy. Are you up to write a `spkg-src`?\n\nI have a problem with them at the moment: namely, applying these patches and invoking `autoreconf -i -f` leads to\n\n```\nsrc/Makefile.am:33: error: HAVE_LD_VERSION_SCRIPT does not appear in AM_CONDITIONAL\n```\nNote that `src/Makefile.am` has the following lines around line 33:\n\n```\nlibtachyon_la_LD_VERSION_SCRIPT=\nif HAVE_LD_VERSION_SCRIPT\nlibtachyon_la_LD_VERSION_SCRIPT+= -Wl,--version-script=$(top_srcdir)/src/tachyon.map\nendif\n```\nThis can be remedied by adding to `configure.ac` the following:\n\n```\nAM_CONDITIONAL([HAVE_LD_VERSION_SCRIPT],   [blah...])\n```\nbut I don't quite see what `blah...` should be. (I put in some random shell call just to see if it helps, and it does, but that's of course not a proper fix).\n\n\nSo this looks like a bug in Debian patches (namely in `upstream-rationalization-autotools.patch`), which only manifests itself in non-Debian setting.",
    "created_at": "2017-08-28T11:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357554",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@kiwifb](#comment:8):
> That's a lot of patches https://anonscm.debian.org/cgit/debian-science/packages/tachyon.git/tree/debian/patches but most of them will probably be handy. Are you up to write a `spkg-src`?

I have a problem with them at the moment: namely, applying these patches and invoking `autoreconf -i -f` leads to

```
src/Makefile.am:33: error: HAVE_LD_VERSION_SCRIPT does not appear in AM_CONDITIONAL
```
Note that `src/Makefile.am` has the following lines around line 33:

```
libtachyon_la_LD_VERSION_SCRIPT=
if HAVE_LD_VERSION_SCRIPT
libtachyon_la_LD_VERSION_SCRIPT+= -Wl,--version-script=$(top_srcdir)/src/tachyon.map
endif
```
This can be remedied by adding to `configure.ac` the following:

```
AM_CONDITIONAL([HAVE_LD_VERSION_SCRIPT],   [blah...])
```
but I don't quite see what `blah...` should be. (I put in some random shell call just to see if it helps, and it does, but that's of course not a proper fix).


So this looks like a bug in Debian patches (namely in `upstream-rationalization-autotools.patch`), which only manifests itself in non-Debian setting.



---

archive/issue_comments_357555.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAnd I also don't get how to configure and run make to create a `tachyon` executable. All what `make install` does, it installs headers and various dynamic libs, such as `libtachyon-mt-thr.so.0.0.0`.",
    "created_at": "2017-08-28T12:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357555",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

And I also don't get how to configure and run make to create a `tachyon` executable. All what `make install` does, it installs headers and various dynamic libs, such as `libtachyon-mt-thr.so.0.0.0`.



---

archive/issue_comments_357556.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,5 +3,11 @@\n \n This is also needed to make Sage work on arm64/aarch64, see #23687.\n \n-the tarball is here: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz\n+- **Tarball**: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz\n \n+In Debian:\n+- https://salsa.debian.org/science-team/tachyon\n+- https://packages.debian.org/source/buster/tachyon\n+- https://packages.debian.org/source/sid/tachyon\n+- https://packages.debian.org/source/stretch/tachyon\n+\n``````\n",
    "created_at": "2019-01-30T20:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357556",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,5 +3,11 @@
 
 This is also needed to make Sage work on arm64/aarch64, see #23687.
 
-the tarball is here: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz
+- **Tarball**: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz
 
+In Debian:
+- https://salsa.debian.org/science-team/tachyon
+- https://packages.debian.org/source/buster/tachyon
+- https://packages.debian.org/source/sid/tachyon
+- https://packages.debian.org/source/stretch/tachyon
+
``````




---

archive/issue_events_326829.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-01-30T20:17:15Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "title_is": "Upgrade to Tachyon 0.99b6",
    "title_was": "update tachyon to 0.99",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326829"
}
```



---

archive/issue_comments_357557.json:
```json
{
    "body": "Changed keywords from none to **upgrade, tachyon**",
    "created_at": "2019-01-30T20:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357557",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **upgrade, tachyon**



---

archive/issue_events_326830.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-01-30T20:17:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326830"
}
```



---

archive/issue_events_326831.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-01-30T20:17:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326831"
}
```



---

archive/issue_comments_357558.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357558",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_326832.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326832"
}
```



---

archive/issue_events_326833.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326833"
}
```



---

archive/issue_comments_357559.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357559",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_326834.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326834"
}
```



---

archive/issue_comments_357560.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nFor what it's worth I'm just fixing up aarch64 sage on nixos and I get no doctest failures with tachyon 0.99b2 (the version we ship).\n\nThere are some transient timeout failures, but that's it. Probably not related to tachyon.",
    "created_at": "2019-08-13T19:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357560",
    "user": "https://github.com/timokau"
}
```

<div id="comment:14" align="right">comment:14</div>

For what it's worth I'm just fixing up aarch64 sage on nixos and I get no doctest failures with tachyon 0.99b2 (the version we ship).

There are some transient timeout failures, but that's it. Probably not related to tachyon.



---

archive/issue_comments_357561.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThere's officially a new release, v0.99.2:\n\n  http://jedi.ks.uiuc.edu/~johns/raytracer/",
    "created_at": "2022-01-19T00:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357561",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:15" align="right">comment:15</div>

There's officially a new release, v0.99.2:

  http://jedi.ks.uiuc.edu/~johns/raytracer/



---

archive/issue_events_326835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-06T20:15:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "title_is": "Upgrade to Tachyon 0.99.2",
    "title_was": "Upgrade to Tachyon 0.99b6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326835"
}
```



---

archive/issue_comments_357562.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,13 @@\n We currently are shipping a 7 years old tachyon (0.98).\n-0.99b6 is from 2013, and is de facto stable version, e.g. in debian or gentoo.\n+\n+0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/\n \n This is also needed to make Sage work on arm64/aarch64, see #23687.\n \n-- **Tarball**: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz\n+- **Tarball**: http://jedi.ks.uiuc.edu/~johns/raytracer/files/0.99.2/tachyon-0.99.2.tar.gz\n+\n+Many distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions\n+\n \n In Debian:\n - https://salsa.debian.org/science-team/tachyon\n``````\n",
    "created_at": "2022-03-06T20:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357562",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,13 @@
 We currently are shipping a 7 years old tachyon (0.98).
-0.99b6 is from 2013, and is de facto stable version, e.g. in debian or gentoo.
+
+0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/
 
 This is also needed to make Sage work on arm64/aarch64, see #23687.
 
-- **Tarball**: http://jedi.ks.uiuc.edu/~johns/tachyon/files/0.99b6/tachyon-0.99b6.tar.gz
+- **Tarball**: http://jedi.ks.uiuc.edu/~johns/raytracer/files/0.99.2/tachyon-0.99.2.tar.gz
+
+Many distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions
+
 
 In Debian:
 - https://salsa.debian.org/science-team/tachyon
``````




---

archive/issue_comments_357563.json:
```json
{
    "body": "Changed commit from **[`8138ccf`](https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9)** to **[`407cb62`](https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4)**",
    "created_at": "2022-03-06T20:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357563",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8138ccf`](https://github.com/sagemath/sagetrac-mirror/commit/8138ccf1ee71785c44efe9df9e87eab7210425d9)** to **[`407cb62`](https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4)**



---

archive/issue_comments_357564.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ba28c7b988a2cafce2ca12236cd6664b5148823\"><code>2ba28c7</code></a></td><td><code>new tachyon 99b6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4\"><code>407cb62</code></a></td><td><code>build/pkgs/tachyon: Update to 0.99.2, add upstream_url</code></td></tr></table>\n",
    "created_at": "2022-03-06T20:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357564",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ba28c7b988a2cafce2ca12236cd6664b5148823"><code>2ba28c7</code></a></td><td><code>new tachyon 99b6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4"><code>407cb62</code></a></td><td><code>build/pkgs/tachyon: Update to 0.99.2, add upstream_url</code></td></tr></table>




---

archive/issue_comments_357565.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We currently are shipping a 7 years old tachyon (0.98).\n+We currently are shipping a 12 years old tachyon (0.98.9).\n \n 0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/\n \n``````\n",
    "created_at": "2022-03-06T20:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357565",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We currently are shipping a 7 years old tachyon (0.98).
+We currently are shipping a 12 years old tachyon (0.98.9).
 
 0.99.2 was released Dec 2021. http://jedi.ks.uiuc.edu/~johns/raytracer/files/
 
``````




---

archive/issue_comments_357566.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nPatches need updating or removing",
    "created_at": "2022-03-06T20:34:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357566",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Patches need updating or removing



---

archive/issue_events_326836.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2022-03-07T04:44:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326836"
}
```



---

archive/issue_comments_357567.json:
```json
{
    "body": "Changed commit from **[`407cb62`](https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4)** to **[`6209e8e`](https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617)**",
    "created_at": "2022-03-07T10:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357567",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`407cb62`](https://github.com/sagemath/sagetrac-mirror/commit/407cb6218170d791a75070e64515db06322feea4)** to **[`6209e8e`](https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617)**



---

archive/issue_comments_357568.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617\"><code>6209e8e</code></a></td><td><code>remove most patches, adjust some</code></td></tr></table>\n",
    "created_at": "2022-03-07T10:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357568",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617"><code>6209e8e</code></a></td><td><code>remove most patches, adjust some</code></td></tr></table>




---

archive/issue_comments_357569.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNow it builds (at least on Linux). For tests, there was an option renaming `focallength->FOCALDIST`.\nThe following patch makes all tests pass:\n\n```diff\n--- a/src/sage/interfaces/tachyon.py\n+++ b/src/sage/interfaces/tachyon.py\n@@ -261,13 +261,13 @@ written in the sequence they are listed in the examples in this section.\n   The {\\bf PROJECTION} keyword must be followed by one of the supported\n camera projection mode identifiers {\\bf PERSPECTIVE}, {\\bf PERSPECTIVE_DOF},\n {\\bf ORTHOGRAPHIC}, or {\\bf FISHEYE}.  The {\\bf FISHEYE} projection mode\n-requires two extra parameters {\\bf FOCALLENGTH} and {\\bf APERTURE}\n+requires two extra parameters {\\bf FOCALDIST} and {\\bf APERTURE}\n which precede the regular camera options.\n \n \\begin{verbatim}\n Camera\n   projection perspective_dof\n-  focallength 0.75\n+  FOCALDIST 0.75\n   aperture 0.02\n   Zoom 0.666667\n   Aspectratio 1.000000\ndiff --git a/src/sage/plot/plot3d/tachyon.py b/src/sage/plot/plot3d/tachyon.py\nindex 08caf38d67..41b646a80f 100644\n--- a/src/sage/plot/plot3d/tachyon.py\n+++ b/src/sage/plot/plot3d/tachyon.py\n@@ -92,7 +92,7 @@ angle, right angle)::\n Finally there is the ``projection='perspective_dof'`` option. ::\n \n     sage: T = Tachyon(xres=800, antialiasing=4, raydepth=10,\n-    ....: projection='perspective_dof', focallength='1.0', aperture='.0025')\n+    ....: projection='perspective_dof', FOCALDIST='1.0', aperture='.0025')\n     sage: T.light((0,5,7), 1.0, (1,1,1))\n     sage: T.texture('t1', opacity=1, specular=.3)\n     sage: T.texture('t2', opacity=1, specular=.3, color=(0,0,1))\n@@ -186,7 +186,7 @@ class Tachyon(WithEqualityById, SageObject):\n       or ``'fisheye'``.\n     - ``frustum`` - (default ''), otherwise list of four numbers. Only\n       used with projection='fisheye'.\n-    - ``focallength`` - (default ''), otherwise a number. Only used\n+    - ``FOCALDIST`` - (default ''), otherwise a number. Only used\n       with projection='perspective_dof'.\n     - ``aperture`` - (default ''), otherwise a number.  Only used\n       with projection='perspective_dof'.\n@@ -331,7 +331,7 @@ class Tachyon(WithEqualityById, SageObject):\n     Use of the ``projection='perspective_dof'`` option.  This may not be\n     implemented correctly. ::\n \n-        sage: T = Tachyon(xres=800,antialiasing=4, raydepth=10, projection='perspective_dof', focallength='1.0', aperture='.0025')\n+        sage: T = Tachyon(xres=800,antialiasing=4, raydepth=10, projection='perspective_dof', FOCALDIST='1.0', aperture='.0025')\n         sage: T.light((0,5,7), 1.0, (1,1,1))\n         sage: T.texture('t1', opacity=1, specular=.3)\n         sage: T.texture('t2', opacity=1, specular=.3, color=(0,0,1))\n@@ -365,7 +365,7 @@ class Tachyon(WithEqualityById, SageObject):\n                  look_at=[0, 0, 0],\n                  viewdir=None,\n                  projection='PERSPECTIVE',\n-                 focallength='',\n+                 FOCALDIST='',\n                  aperture='',\n                  frustum=''):\n         r\"\"\"\n@@ -391,7 +391,7 @@ class Tachyon(WithEqualityById, SageObject):\n             self._camera_position = (-3, 0, 0) # default value\n         self._updir = updir\n         self._projection = projection\n-        self._focallength = focallength\n+        self._FOCALDIST = FOCALDIST\n         self._aperture = aperture\n         self._frustum = frustum\n         self._objects = []\n@@ -624,9 +624,9 @@ class Tachyon(WithEqualityById, SageObject):\n         camera_out = r\"\"\"\n            camera\n               projection %s\"\"\" % (tostr(self._projection))\n-        if self._focallength != '':\n+        if self._FOCALDIST != '':\n             camera_out = camera_out + r\"\"\"\n-              focallength %s\"\"\" % (float(self._focallength))\n+              FOCALDIST %s\"\"\" % (float(self._FOCALDIST))\n         if self._aperture != '':\n             camera_out = camera_out + r\"\"\"\n               aperture %s\"\"\" % (float(self._aperture))\n```\n\nNot sure how to best handle this and older versions of `tachyon` at the same time.",
    "created_at": "2022-03-07T10:10:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357569",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Now it builds (at least on Linux). For tests, there was an option renaming `focallength->FOCALDIST`.
The following patch makes all tests pass:

```diff
--- a/src/sage/interfaces/tachyon.py
+++ b/src/sage/interfaces/tachyon.py
@@ -261,13 +261,13 @@ written in the sequence they are listed in the examples in this section.
   The {\bf PROJECTION} keyword must be followed by one of the supported
 camera projection mode identifiers {\bf PERSPECTIVE}, {\bf PERSPECTIVE_DOF},
 {\bf ORTHOGRAPHIC}, or {\bf FISHEYE}.  The {\bf FISHEYE} projection mode
-requires two extra parameters {\bf FOCALLENGTH} and {\bf APERTURE}
+requires two extra parameters {\bf FOCALDIST} and {\bf APERTURE}
 which precede the regular camera options.
 
 \begin{verbatim}
 Camera
   projection perspective_dof
-  focallength 0.75
+  FOCALDIST 0.75
   aperture 0.02
   Zoom 0.666667
   Aspectratio 1.000000
diff --git a/src/sage/plot/plot3d/tachyon.py b/src/sage/plot/plot3d/tachyon.py
index 08caf38d67..41b646a80f 100644
--- a/src/sage/plot/plot3d/tachyon.py
+++ b/src/sage/plot/plot3d/tachyon.py
@@ -92,7 +92,7 @@ angle, right angle)::
 Finally there is the ``projection='perspective_dof'`` option. ::
 
     sage: T = Tachyon(xres=800, antialiasing=4, raydepth=10,
-    ....: projection='perspective_dof', focallength='1.0', aperture='.0025')
+    ....: projection='perspective_dof', FOCALDIST='1.0', aperture='.0025')
     sage: T.light((0,5,7), 1.0, (1,1,1))
     sage: T.texture('t1', opacity=1, specular=.3)
     sage: T.texture('t2', opacity=1, specular=.3, color=(0,0,1))
@@ -186,7 +186,7 @@ class Tachyon(WithEqualityById, SageObject):
       or ``'fisheye'``.
     - ``frustum`` - (default ''), otherwise list of four numbers. Only
       used with projection='fisheye'.
-    - ``focallength`` - (default ''), otherwise a number. Only used
+    - ``FOCALDIST`` - (default ''), otherwise a number. Only used
       with projection='perspective_dof'.
     - ``aperture`` - (default ''), otherwise a number.  Only used
       with projection='perspective_dof'.
@@ -331,7 +331,7 @@ class Tachyon(WithEqualityById, SageObject):
     Use of the ``projection='perspective_dof'`` option.  This may not be
     implemented correctly. ::
 
-        sage: T = Tachyon(xres=800,antialiasing=4, raydepth=10, projection='perspective_dof', focallength='1.0', aperture='.0025')
+        sage: T = Tachyon(xres=800,antialiasing=4, raydepth=10, projection='perspective_dof', FOCALDIST='1.0', aperture='.0025')
         sage: T.light((0,5,7), 1.0, (1,1,1))
         sage: T.texture('t1', opacity=1, specular=.3)
         sage: T.texture('t2', opacity=1, specular=.3, color=(0,0,1))
@@ -365,7 +365,7 @@ class Tachyon(WithEqualityById, SageObject):
                  look_at=[0, 0, 0],
                  viewdir=None,
                  projection='PERSPECTIVE',
-                 focallength='',
+                 FOCALDIST='',
                  aperture='',
                  frustum=''):
         r"""
@@ -391,7 +391,7 @@ class Tachyon(WithEqualityById, SageObject):
             self._camera_position = (-3, 0, 0) # default value
         self._updir = updir
         self._projection = projection
-        self._focallength = focallength
+        self._FOCALDIST = FOCALDIST
         self._aperture = aperture
         self._frustum = frustum
         self._objects = []
@@ -624,9 +624,9 @@ class Tachyon(WithEqualityById, SageObject):
         camera_out = r"""
            camera
               projection %s""" % (tostr(self._projection))
-        if self._focallength != '':
+        if self._FOCALDIST != '':
             camera_out = camera_out + r"""
-              focallength %s""" % (float(self._focallength))
+              FOCALDIST %s""" % (float(self._FOCALDIST))
         if self._aperture != '':
             camera_out = camera_out + r"""
               aperture %s""" % (float(self._aperture))
```

Not sure how to best handle this and older versions of `tachyon` at the same time.



---

archive/issue_comments_357570.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nProbably the latter could be accomplished by using a decorator.",
    "created_at": "2022-03-15T10:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357570",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Probably the latter could be accomplished by using a decorator.



---

archive/issue_events_326837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326837"
}
```



---

archive/issue_events_326838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326838"
}
```



---

archive/issue_comments_357571.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nopensuse-tumbleweed now has a new tachyon, causes failures https://github.com/sagemath/sage/runs/6236170449",
    "created_at": "2022-05-01T19:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357571",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

opensuse-tumbleweed now has a new tachyon, causes failures https://github.com/sagemath/sage/runs/6236170449



---

archive/issue_comments_357572.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nand 0.99.5 is out",
    "created_at": "2022-05-01T19:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357572",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

and 0.99.5 is out



---

archive/issue_events_326839.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326839"
}
```



---

archive/issue_events_326840.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326840"
}
```



---

archive/issue_comments_357573.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe following makes all tests pass with new versions of tachyon, without breaking old versions. I tested it with 0.99 (old) and 0.99.5 (new).\n\nThis does not change the sage interface in `sage.plot.plot3d.tachyon`, it will still use `focallength` so the change is very safe to apply. In the future (possibly when tachyon in sage gets upgraded), all the `focallength` occurences in `sage.plot.plot3d.tachyon` can be replaced by `focaldist` for consistency with new tachyon, and the logic here can be reversed (i.e. patch the model when `self.version() < '0.99.2'`).\n\n\n\n\n{{{ #!diff\n--- a/src/sage/interfaces/tachyon.py\n+++ b/src/sage/interfaces/tachyon.py\n@@ -683,12 +683,14 @@\n #*****************************************************************************\n \n import os\n+import re\n \n from sage.cpython.string import bytes_to_str\n from sage.misc.pager import pager\n from sage.misc.superseded import deprecation\n from sage.misc.temporary_file import tmp_filename\n from sage.structure.sage_object import SageObject\n+from sage.misc.cachefunc import cached_method\n \n \n class TachyonRT(SageObject):\n@@ -799,6 +801,11 @@ class TachyonRT(SageObject):\n             Parser failed due to an input file syntax error.\n             Aborting render.\n         \"\"\"\n+        if self.version() >= '0.99.2':\n+            # this keyword was changed in 0.99.2\n+            model = model.replace(\n+                    \"              focallength \",\n+                    \"              focaldist \")\n         modelfile = tmp_filename(ext='.dat')\n         with open(modelfile, 'w') as file:\n             file.write(model)\n@@ -851,6 +858,22 @@ class TachyonRT(SageObject):\n         else:\n             print(r)\n \n+    `@`cached_method\n+    def version(self):\n+        \"\"\"\n+        Returns the version of the Tachyon raytracer being used.\n+\n+        TESTS::\n+\n+            sage: tachyon_rt.version()  # not tested\n+            0.98.9\n+            sage: tachyon_rt.version() >= '0.98.9'\n+            True\n+        \"\"\"\n+        with os.popen('tachyon') as f:\n+            r = f.read()\n+        return re.search(r\"Version ([\\d.]*)\", r)[1]\n+\n     def help(self, use_pager=True):\n         \"\"\"\n         Deprecated: type 'sage.interfaces.tachyon?' for help\n}}}\n\n\nBTW, in order for tachyon spkg to work in aarch64, all I had to do is the following trivial change:\n{{{ #!diff\n--- a/build/pkgs/tachyon/spkg-install.in\n+++ b/build/pkgs/tachyon/spkg-install.in\n@@ -30,7 +30,7 @@\n     ppc*|powerpc*)\n         TARGET=linux-ppc\n         ;;\n-    armv6l*|armv7l*)\n+    armv6l*|armv7l*|aarch64*)\n         TARGET=linux-arm-thr\n         ;;\n     esac\n}}}",
    "created_at": "2022-12-21T03:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357573",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:28" align="right">comment:28</div>

The following makes all tests pass with new versions of tachyon, without breaking old versions. I tested it with 0.99 (old) and 0.99.5 (new).

This does not change the sage interface in `sage.plot.plot3d.tachyon`, it will still use `focallength` so the change is very safe to apply. In the future (possibly when tachyon in sage gets upgraded), all the `focallength` occurences in `sage.plot.plot3d.tachyon` can be replaced by `focaldist` for consistency with new tachyon, and the logic here can be reversed (i.e. patch the model when `self.version() < '0.99.2'`).




{{{ #!diff
--- a/src/sage/interfaces/tachyon.py
+++ b/src/sage/interfaces/tachyon.py
@@ -683,12 +683,14 @@
 #*****************************************************************************
 
 import os
+import re
 
 from sage.cpython.string import bytes_to_str
 from sage.misc.pager import pager
 from sage.misc.superseded import deprecation
 from sage.misc.temporary_file import tmp_filename
 from sage.structure.sage_object import SageObject
+from sage.misc.cachefunc import cached_method
 
 
 class TachyonRT(SageObject):
@@ -799,6 +801,11 @@ class TachyonRT(SageObject):
             Parser failed due to an input file syntax error.
             Aborting render.
         """
+        if self.version() >= '0.99.2':
+            # this keyword was changed in 0.99.2
+            model = model.replace(
+                    "              focallength ",
+                    "              focaldist ")
         modelfile = tmp_filename(ext='.dat')
         with open(modelfile, 'w') as file:
             file.write(model)
@@ -851,6 +858,22 @@ class TachyonRT(SageObject):
         else:
             print(r)
 
+    `@`cached_method
+    def version(self):
+        """
+        Returns the version of the Tachyon raytracer being used.
+
+        TESTS::
+
+            sage: tachyon_rt.version()  # not tested
+            0.98.9
+            sage: tachyon_rt.version() >= '0.98.9'
+            True
+        """
+        with os.popen('tachyon') as f:
+            r = f.read()
+        return re.search(r"Version ([\d.]*)", r)[1]
+
     def help(self, use_pager=True):
         """
         Deprecated: type 'sage.interfaces.tachyon?' for help
}}}


BTW, in order for tachyon spkg to work in aarch64, all I had to do is the following trivial change:
{{{ #!diff
--- a/build/pkgs/tachyon/spkg-install.in
+++ b/build/pkgs/tachyon/spkg-install.in
@@ -30,7 +30,7 @@
     ppc*|powerpc*)
         TARGET=linux-ppc
         ;;
-    armv6l*|armv7l*)
+    armv6l*|armv7l*|aarch64*)
         TARGET=linux-arm-thr
         ;;
     esac
}}}



---

archive/issue_comments_357574.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nafk, please post your branch here",
    "created_at": "2022-12-21T08:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357574",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

afk, please post your branch here



---

archive/issue_comments_357575.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSee `u/tornaria/tachyon`. I'm not sure if I should overwrite the current branch, or move this to a separate ticket.\n\nMy branch is \"safe\" in the sense that it doesn't touch the spkg (other than allowing building on linux aarch64 but that is broken now and the trivial change doesn't affect other architectures) but it will allow sagemath to work ok with newer versions of tachyon in the system.\n\nI'd rather see those two commits on 9.8 if upgrading tachyon spkg needs more testing, since I will be upgrading tachyon on void linux soon.",
    "created_at": "2022-12-21T22:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357575",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:30" align="right">comment:30</div>

See `u/tornaria/tachyon`. I'm not sure if I should overwrite the current branch, or move this to a separate ticket.

My branch is "safe" in the sense that it doesn't touch the spkg (other than allowing building on linux aarch64 but that is broken now and the trivial change doesn't affect other architectures) but it will allow sagemath to work ok with newer versions of tachyon in the system.

I'd rather see those two commits on 9.8 if upgrading tachyon spkg needs more testing, since I will be upgrading tachyon on void linux soon.



---

archive/issue_comments_357576.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nchanging Branch field here does not overwrite anything - the old branch stays good and well. (you need to use git to overwrite a branch)",
    "created_at": "2022-12-22T08:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357576",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

changing Branch field here does not overwrite anything - the old branch stays good and well. (you need to use git to overwrite a branch)



---

archive/issue_comments_357577.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55c04623a4b7404f5e4f9d152366d53e9c21cfa6\"><code>55c0462</code></a></td><td><code>Trac #23712: support tachyon >= 0.99.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446\"><code>3390c83</code></a></td><td><code>Trac #23712: aarch64 support for tachyon spkg</code></td></tr></table>\n",
    "created_at": "2022-12-22T08:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357577",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55c04623a4b7404f5e4f9d152366d53e9c21cfa6"><code>55c0462</code></a></td><td><code>Trac #23712: support tachyon >= 0.99.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446"><code>3390c83</code></a></td><td><code>Trac #23712: aarch64 support for tachyon spkg</code></td></tr></table>




---

archive/issue_comments_357578.json:
```json
{
    "body": "Changed branch from **[public/23712](https://github.com/sagemath/sagetrac-mirror/tree/public/23712)** to **[u/tornaria/tachyon](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/tachyon)**",
    "created_at": "2022-12-22T08:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357578",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[public/23712](https://github.com/sagemath/sagetrac-mirror/tree/public/23712)** to **[u/tornaria/tachyon](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/tachyon)**



---

archive/issue_comments_357579.json:
```json
{
    "body": "Changed commit from **[`6209e8e`](https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617)** to **[`3390c83`](https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446)**",
    "created_at": "2022-12-22T08:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357579",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`6209e8e`](https://github.com/sagemath/sagetrac-mirror/commit/6209e8e5903286a51f8bdbfd7fffc829a4e1d617)** to **[`3390c83`](https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446)**



---

archive/issue_comments_357580.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dima Pasechnik, Gonzalo Tornar\u00eda**",
    "created_at": "2022-12-22T08:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357580",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Dima Pasechnik** to **Dima Pasechnik, Gonzalo Tornar√≠a**



---

archive/issue_events_326841.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-12-22T08:49:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326841"
}
```



---

archive/issue_comments_357581.json:
```json
{
    "body": "Changed commit from **[`3390c83`](https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446)** to **[`d86d550`](https://github.com/sagemath/sagetrac-mirror/commit/d86d550de2a3b64c454d8e1534b81d93f590f093)**",
    "created_at": "2022-12-22T22:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357581",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`3390c83`](https://github.com/sagemath/sagetrac-mirror/commit/3390c835ec5301d074931d6bc1ce3106ffdf4446)** to **[`d86d550`](https://github.com/sagemath/sagetrac-mirror/commit/d86d550de2a3b64c454d8e1534b81d93f590f093)**



---

archive/issue_comments_357582.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nadded checksums etc (for 0.99.5)",
    "created_at": "2022-12-22T22:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357582",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

added checksums etc (for 0.99.5)



---

archive/issue_comments_357583.json:
```json
{
    "body": "Changed branch from **[u/tornaria/tachyon](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/tachyon)** to **[u/dimpase/packages/tachyon0992](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/tachyon0992)**",
    "created_at": "2022-12-22T22:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357583",
    "user": "https://github.com/dimpase"
}
```

Changed branch from **[u/tornaria/tachyon](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/tachyon)** to **[u/dimpase/packages/tachyon0992](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/tachyon0992)**



---

archive/issue_events_326842.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-12-22T22:59:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "title_is": "Upgrade to Tachyon 0.99.5",
    "title_was": "Upgrade to Tachyon 0.99.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326842"
}
```



---

archive/issue_comments_357584.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n This is also needed to make Sage work on arm64/aarch64, see #23687.\n \n-- **Tarball**: http://jedi.ks.uiuc.edu/~johns/raytracer/files/0.99.2/tachyon-0.99.2.tar.gz\n+\n \n Many distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions\n \n``````\n",
    "created_at": "2022-12-22T22:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357584",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 This is also needed to make Sage work on arm64/aarch64, see #23687.
 
-- **Tarball**: http://jedi.ks.uiuc.edu/~johns/raytracer/files/0.99.2/tachyon-0.99.2.tar.gz
+
 
 Many distributions are still on 0.99.beta6 - https://repology.org/project/tachyon/versions
 
``````




---

archive/issue_comments_357585.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1\"><code>3756c85</code></a></td><td><code>remove patches</code></td></tr></table>\n",
    "created_at": "2022-12-22T23:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357585",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1"><code>3756c85</code></a></td><td><code>remove patches</code></td></tr></table>




---

archive/issue_comments_357586.json:
```json
{
    "body": "Changed commit from **[`d86d550`](https://github.com/sagemath/sagetrac-mirror/commit/d86d550de2a3b64c454d8e1534b81d93f590f093)** to **[`3756c85`](https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1)**",
    "created_at": "2022-12-22T23:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357586",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d86d550`](https://github.com/sagemath/sagetrac-mirror/commit/d86d550de2a3b64c454d8e1534b81d93f590f093)** to **[`3756c85`](https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1)**



---

archive/issue_comments_357587.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\ndoesn't work with 0.99.5: typical error is\n\n```\nsage -t --warn-long 60.9 --random-seed=298292522010650641629269891184485194160 src/sage/plot/plot3d/implicit_plot3d.py\n**********************************************************************\nFile \"src/sage/plot/plot3d/implicit_plot3d.py\", line 53, in sage.plot.plot3d.implicit_plot3d.implicit_plot3d\nFailed example:\n    implicit_plot3d((x^2 + y^2 + z^2), (x,-2,2), (y,-2,2), (z,-2,2), plot_points=60, contour=[1,3,5],\n                    region=lambda x,y,z: x<=0.2 or y>=0.2 or z<=0.2, color='aquamarine').show(viewer='tachyon')\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/opt/Sage/sage-dev/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.implicit_plot3d.implicit_plot3d[2]>\", line 1, in <module>\n        implicit_plot3d((x**Integer(2) + y**Integer(2) + z**Integer(2)), (x,-Integer(2),Integer(2)), (y,-Integer(2),Integer(2)), (z,-Integer(2),Integer(2)), plot_points=Integer(60), contour=[Integer(1),Integer(3),Integer(5)],\n      File \"sage/plot/plot3d/base.pyx\", line 1800, in sage.plot.plot3d.base.Graphics3d.show\n        dm.display_immediately(self, **kwds)\n      File \"/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/display_manager.py\", line 854, in display_immediately\n        self._backend.display_immediately(plain_text, rich_output)\n      File \"/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/backend_doctest.py\", line 210, in display_immediately\n        self.validate(rich_output)\n      File \"/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/backend_doctest.py\", line 271, in validate\n        assert rich_output.png.get().startswith(b'\\x89PNG')\n    AssertionError\n```",
    "created_at": "2022-12-23T11:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357587",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

doesn't work with 0.99.5: typical error is

```
sage -t --warn-long 60.9 --random-seed=298292522010650641629269891184485194160 src/sage/plot/plot3d/implicit_plot3d.py
**********************************************************************
File "src/sage/plot/plot3d/implicit_plot3d.py", line 53, in sage.plot.plot3d.implicit_plot3d.implicit_plot3d
Failed example:
    implicit_plot3d((x^2 + y^2 + z^2), (x,-2,2), (y,-2,2), (z,-2,2), plot_points=60, contour=[1,3,5],
                    region=lambda x,y,z: x<=0.2 or y>=0.2 or z<=0.2, color='aquamarine').show(viewer='tachyon')
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/opt/Sage/sage-dev/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.implicit_plot3d.implicit_plot3d[2]>", line 1, in <module>
        implicit_plot3d((x**Integer(2) + y**Integer(2) + z**Integer(2)), (x,-Integer(2),Integer(2)), (y,-Integer(2),Integer(2)), (z,-Integer(2),Integer(2)), plot_points=Integer(60), contour=[Integer(1),Integer(3),Integer(5)],
      File "sage/plot/plot3d/base.pyx", line 1800, in sage.plot.plot3d.base.Graphics3d.show
        dm.display_immediately(self, **kwds)
      File "/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/display_manager.py", line 854, in display_immediately
        self._backend.display_immediately(plain_text, rich_output)
      File "/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/backend_doctest.py", line 210, in display_immediately
        self.validate(rich_output)
      File "/mnt/opt/Sage/sage-dev/src/sage/repl/rich_output/backend_doctest.py", line 271, in validate
        assert rich_output.png.get().startswith(b'\x89PNG')
    AssertionError
```



---

archive/issue_comments_357588.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d\"><code>d6656e8</code></a></td><td><code>add patch to tell tachyon to use png (from public/23712)</code></td></tr></table>\n",
    "created_at": "2022-12-23T12:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357588",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d"><code>d6656e8</code></a></td><td><code>add patch to tell tachyon to use png (from public/23712)</code></td></tr></table>




---

archive/issue_comments_357589.json:
```json
{
    "body": "Changed commit from **[`3756c85`](https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1)** to **[`d6656e8`](https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d)**",
    "created_at": "2022-12-23T12:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357589",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3756c85`](https://github.com/sagemath/sagetrac-mirror/commit/3756c85a1ca118f9a0244c8029268740cb01bdb1)** to **[`d6656e8`](https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d)**



---

archive/issue_comments_357590.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\npng patch was missing from Gonzalo's branch; we now add it, and it fixed [comment:36](#comment:36)",
    "created_at": "2022-12-23T12:07:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357590",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

png patch was missing from Gonzalo's branch; we now add it, and it fixed [comment:36](#comment:36)



---

archive/issue_comments_357591.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nOK, now tests pass, both with this 0.99.5, and with 0.99 (from Fedora)\n\nGood to go?",
    "created_at": "2022-12-24T00:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357591",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:39" align="right">comment:39</div>

OK, now tests pass, both with this 0.99.5, and with 0.99 (from Fedora)

Good to go?



---

archive/issue_comments_357592.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nping?",
    "created_at": "2023-01-06T21:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357592",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

ping?



---

archive/issue_comments_357593.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nupstream server is down",
    "created_at": "2023-01-06T22:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357593",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">comment:41</div>

upstream server is down



---

archive/issue_comments_357594.json:
```json
{
    "body": "Changed commit from **[`d6656e8`](https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d)** to **[`d3034fc`](https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a)**",
    "created_at": "2023-01-06T22:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357594",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d6656e8`](https://github.com/sagemath/sagetrac-mirror/commit/d6656e85c51280e236494d8a3ef9a12811e5379d)** to **[`d3034fc`](https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a)**



---

archive/issue_comments_357595.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a\"><code>d3034fc</code></a></td><td><code>re-host tachyon tarball</code></td></tr></table>\n",
    "created_at": "2023-01-06T22:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357595",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3034fce69bfe19a5f5f73d5f6aecff19c223a2a"><code>d3034fc</code></a></td><td><code>re-host tachyon tarball</code></td></tr></table>




---

archive/issue_comments_357596.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI've had a copy, so I put it up for downloading",
    "created_at": "2023-01-06T22:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357596",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">comment:43</div>

I've had a copy, so I put it up for downloading



---

archive/issue_comments_357597.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThanks. Builds and tests OK on macOS (Intel) and `debian-buster-i386-standard`",
    "created_at": "2023-01-07T00:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357597",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Thanks. Builds and tests OK on macOS (Intel) and `debian-buster-i386-standard`



---

archive/issue_events_326843.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T00:09:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326843"
}
```



---

archive/issue_events_326844.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T00:09:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23712#event-326844"
}
```



---

archive/issue_comments_357598.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2023-01-07T00:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23712#issuecomment-357598",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**
