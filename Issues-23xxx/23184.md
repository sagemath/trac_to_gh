# Issue 23184: Use the right category for DefaultConvertMaps, rather than SetsWithPartialMaps

archive/issues_022947.json:
```json
{
    "body": "Currently, the category for `DefaultConvertMap`s is `SetsWithPartialMaps()`.\n\n```\nsage: type(QQ[['x']].coerce_map_from(QQ))\n<type 'sage.structure.coerce_maps.DefaultConvertMap_unique'>\nsage: QQ[['x']].coerce_map_from(QQ).category_for()\nCategory of sets with partial maps\n```\nIn contrast,\n\n```\nsage: QQ.hom(QQ[['x']]).category_for()\nCategory of euclidean domains\n```\n\nKeywords: sd86.5\n\nBranch: [5eccb5217999af4dc094b8a21d8b00071457c04d](https://github.com/sagemath/sagetrac-mirror/commit/5eccb5217999af4dc094b8a21d8b00071457c04d)\n\nReviewer: Julian R\u00fcth, David Roe\n\nAuthor: David Roe, Julian R\u00fcth\n\nDependencies: #23201\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23184\n\n",
    "closed_at": "2017-06-12T18:01:40Z",
    "created_at": "2017-06-09T01:02:07Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Use the right category for DefaultConvertMaps, rather than SetsWithPartialMaps",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23184",
    "user": "https://github.com/roed314"
}
```
Currently, the category for `DefaultConvertMap`s is `SetsWithPartialMaps()`.

```
sage: type(QQ[['x']].coerce_map_from(QQ))
<type 'sage.structure.coerce_maps.DefaultConvertMap_unique'>
sage: QQ[['x']].coerce_map_from(QQ).category_for()
Category of sets with partial maps
```
In contrast,

```
sage: QQ.hom(QQ[['x']]).category_for()
Category of euclidean domains
```

Keywords: sd86.5

Branch: [5eccb5217999af4dc094b8a21d8b00071457c04d](https://github.com/sagemath/sagetrac-mirror/commit/5eccb5217999af4dc094b8a21d8b00071457c04d)

Reviewer: Julian Rüth, David Roe

Author: David Roe, Julian Rüth

Dependencies: #23201

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23184





---

archive/issue_comments_437724.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd86.5\".",
    "created_at": "2017-06-09T17:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437724",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "sd86.5".



---

archive/issue_comments_437725.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#23201\"",
    "created_at": "2017-06-09T17:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437725",
    "user": "https://github.com/roed314"
}
```

Changing dependencies from "" to "#23201"



---

archive/issue_comments_437726.json:
```json
{
    "body": "<a id='comment:2'></a>\nPlease make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.",
    "created_at": "2017-06-09T18:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437726",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:2'></a>
Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.



---

archive/issue_comments_437727.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.",
    "created_at": "2017-06-09T19:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437727",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>
I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.



---

archive/issue_comments_437728.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [pbruin](#comment%3A2):\n> Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.\n\n\nMy plan is to only change the category for coercions, not conversions.  I can't think of any examples where coercions aren't morphisms in the meet of the categories of the parents involved.  All of the examples I see in #15618 are conversions, which this ticket won't affect.",
    "created_at": "2017-06-09T20:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437728",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>
Replying to [pbruin](#comment%3A2):
> Please make sure that you only refine the category when this makes mathematical sense.  In #15618, I  implemented taking `SetsWithPartialMaps` as the default category for a `DefaultConvertMap` because in general such a map is not defined everywhere, nor is it always a morphism in the category where the parents live.


My plan is to only change the category for coercions, not conversions.  I can't think of any examples where coercions aren't morphisms in the meet of the categories of the parents involved.  All of the examples I see in #15618 are conversions, which this ticket won't affect.



---

archive/issue_comments_437729.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [pbruin](#comment%3A3):\n> I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.\n\n\nYou could fix it in this way, but that's a lot of work that would need to be duplicated over and over again for different examples of `DefaultConvertMap`s.",
    "created_at": "2017-06-09T20:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437729",
    "user": "https://github.com/roed314"
}
```

<a id='comment:5'></a>
Replying to [pbruin](#comment%3A3):
> I guess this should be fixed in `PowerSeries_generic._coerce_map_from_()` by returning a specific map instead of `True`.


You could fix it in this way, but that's a lot of work that would need to be duplicated over and over again for different examples of `DefaultConvertMap`s.



---

archive/issue_comments_437730.json:
```json
{
    "body": "Changing branch from \"\" to \"u/roed/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps\"",
    "created_at": "2017-06-10T16:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437730",
    "user": "https://github.com/roed314"
}
```

Changing branch from "" to "u/roed/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps"



---

archive/issue_comments_437731.json:
```json
{
    "body": "Changing author from \"\" to \"David Roe\"",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437731",
    "user": "https://github.com/roed314"
}
```

Changing author from "" to "David Roe"



---

archive/issue_comments_437732.json:
```json
{
    "body": "Changing commit from \"\" to \"3cc08d1ad81c264d7af4794ed9e41387d645edc2\"",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437732",
    "user": "https://github.com/roed314"
}
```

Changing commit from "" to "3cc08d1ad81c264d7af4794ed9e41387d645edc2"



---

archive/issue_comments_437733.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437733",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437734.json:
```json
{
    "body": "<a id='comment:7'></a>\nNew commits:\n|                                                                                                                                          |                                                                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|\n|[b00d97f](https://github.com/sagemath/sagetrac-mirror/commit/b00d97f3c38b19ba30ce53fdd084c6d06eaa2b2d)|`Make DefaultConvertMaps have a more refined category (than SetsWithPartialMaps) when they're actually coercions`|\n|[5fbc34c](https://github.com/sagemath/sagetrac-mirror/commit/5fbc34cbf9fb493773a1de9ecfd8289d58e602b0)|`Change base ring for CuspFormsRing in Hecke triangle group`|\n|[906d5b2](https://github.com/sagemath/sagetrac-mirror/commit/906d5b22b1d6d4d9781581ce664f623df732981d)|`Fix base rings for many other parents in sage/modular/moform_hecketriangle`|\n|[3e0fcd7](https://github.com/sagemath/sagetrac-mirror/commit/3e0fcd729b5908b4d2e98a2fde08bb0486ba1bf6)|`Merge branch 't/23201/hecke_triangle_group_cusp_form_base_ring' into t/23184/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps`|\n|[3cc08d1](https://github.com/sagemath/sagetrac-mirror/commit/3cc08d1ad81c264d7af4794ed9e41387d645edc2)|`Fix a problem in quivers from changing the category of DefaultConvertMaps, add doctests to _generic_convert_map`|",
    "created_at": "2017-06-10T16:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437734",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
New commits:
|                                                                                                                                          |                                                                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|[b00d97f](https://github.com/sagemath/sagetrac-mirror/commit/b00d97f3c38b19ba30ce53fdd084c6d06eaa2b2d)|`Make DefaultConvertMaps have a more refined category (than SetsWithPartialMaps) when they're actually coercions`|
|[5fbc34c](https://github.com/sagemath/sagetrac-mirror/commit/5fbc34cbf9fb493773a1de9ecfd8289d58e602b0)|`Change base ring for CuspFormsRing in Hecke triangle group`|
|[906d5b2](https://github.com/sagemath/sagetrac-mirror/commit/906d5b22b1d6d4d9781581ce664f623df732981d)|`Fix base rings for many other parents in sage/modular/moform_hecketriangle`|
|[3e0fcd7](https://github.com/sagemath/sagetrac-mirror/commit/3e0fcd729b5908b4d2e98a2fde08bb0486ba1bf6)|`Merge branch 't/23201/hecke_triangle_group_cusp_form_base_ring' into t/23184/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps`|
|[3cc08d1](https://github.com/sagemath/sagetrac-mirror/commit/3cc08d1ad81c264d7af4794ed9e41387d645edc2)|`Fix a problem in quivers from changing the category of DefaultConvertMaps, add doctests to _generic_convert_map`|



---

archive/issue_comments_437735.json:
```json
{
    "body": "<a id='comment:8'></a>\nAll tests pass.",
    "created_at": "2017-06-10T17:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437735",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>
All tests pass.



---

archive/issue_comments_437736.json:
```json
{
    "body": "Changing commit from \"3cc08d1ad81c264d7af4794ed9e41387d645edc2\" to \"09d34563e2dd6359b2350e8a4865b45b9a49b8b3\"",
    "created_at": "2017-06-11T00:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3cc08d1ad81c264d7af4794ed9e41387d645edc2" to "09d34563e2dd6359b2350e8a4865b45b9a49b8b3"



---

archive/issue_comments_437737.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[09d3456](https://github.com/sagemath/sagetrac-mirror/commit/09d34563e2dd6359b2350e8a4865b45b9a49b8b3)|`Fix a dangling sage: prompt`|",
    "created_at": "2017-06-11T00:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437737",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[09d3456](https://github.com/sagemath/sagetrac-mirror/commit/09d34563e2dd6359b2350e8a4865b45b9a49b8b3)|`Fix a dangling sage: prompt`|



---

archive/issue_comments_437738.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks good except for a few places where `S.category()` should be replaced with an appropriate meet. I'll fix that myself.",
    "created_at": "2017-06-11T03:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437738",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
Looks good except for a few places where `S.category()` should be replaced with an appropriate meet. I'll fix that myself.



---

archive/issue_comments_437739.json:
```json
{
    "body": "Changing branch from \"u/roed/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps\" to \"u/saraedum/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps\"",
    "created_at": "2017-06-11T05:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437739",
    "user": "https://github.com/saraedum"
}
```

Changing branch from "u/roed/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps" to "u/saraedum/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps"



---

archive/issue_comments_437740.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[5eccb52](https://github.com/sagemath/sagetrac-mirror/commit/5eccb5217999af4dc094b8a21d8b00071457c04d)|`Refactor _default_convert_map`|",
    "created_at": "2017-06-11T05:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[5eccb52](https://github.com/sagemath/sagetrac-mirror/commit/5eccb5217999af4dc094b8a21d8b00071457c04d)|`Refactor _default_convert_map`|



---

archive/issue_comments_437741.json:
```json
{
    "body": "Changing commit from \"09d34563e2dd6359b2350e8a4865b45b9a49b8b3\" to \"5eccb5217999af4dc094b8a21d8b00071457c04d\"",
    "created_at": "2017-06-11T05:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "09d34563e2dd6359b2350e8a4865b45b9a49b8b3" to "5eccb5217999af4dc094b8a21d8b00071457c04d"



---

archive/issue_comments_437742.json:
```json
{
    "body": "Changing author from \"David Roe\" to \"David Roe, Julian R\u00fcth\"",
    "created_at": "2017-06-11T05:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437742",
    "user": "https://github.com/saraedum"
}
```

Changing author from "David Roe" to "David Roe, Julian Rüth"



---

archive/issue_comments_437743.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian R\u00fcth\"",
    "created_at": "2017-06-11T05:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437743",
    "user": "https://github.com/saraedum"
}
```

Changing reviewer from "" to "Julian Rüth"



---

archive/issue_comments_437744.json:
```json
{
    "body": "<a id='comment:14'></a>\ntests pass.",
    "created_at": "2017-06-11T05:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437744",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:14'></a>
tests pass.



---

archive/issue_comments_437745.json:
```json
{
    "body": "Changing reviewer from \"Julian R\u00fcth\" to \"Julian R\u00fcth, David Roe\"",
    "created_at": "2017-06-11T05:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437745",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "Julian Rüth" to "Julian Rüth, David Roe"



---

archive/issue_comments_437746.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-11T05:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437746",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437747.json:
```json
{
    "body": "<a id='comment:15'></a>\nLooks good.",
    "created_at": "2017-06-11T05:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437747",
    "user": "https://github.com/roed314"
}
```

<a id='comment:15'></a>
Looks good.



---

archive/issue_comments_437748.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-12T18:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437748",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_437749.json:
```json
{
    "body": "Changing branch from \"u/saraedum/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps\" to \"5eccb5217999af4dc094b8a21d8b00071457c04d\"",
    "created_at": "2017-06-12T18:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437749",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/saraedum/use_the_right_category_for_defaultconvertmaps__rather_than_setswithpartialmaps" to "5eccb5217999af4dc094b8a21d8b00071457c04d"



---

archive/issue_events_068076.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-12T18:01:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23184#event-68076"
}
```



---

archive/issue_comments_437750.json:
```json
{
    "body": "Changing commit from \"5eccb5217999af4dc094b8a21d8b00071457c04d\" to \"\"",
    "created_at": "2017-07-23T09:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437750",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "5eccb5217999af4dc094b8a21d8b00071457c04d" to ""



---

archive/issue_comments_437751.json:
```json
{
    "body": "<a id='comment:17'></a>\nyou used a bad syntax for the trac role here :\n\n```\n+        We check that `trac`:23184 has been resolved::\n```\nit should have been\n\n```\n+        We check that :trac:`23184` has been resolved::\n```\nSo please review #23526",
    "created_at": "2017-07-23T09:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23184#issuecomment-437751",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>
you used a bad syntax for the trac role here :

```
+        We check that `trac`:23184 has been resolved::
```
it should have been

```
+        We check that :trac:`23184` has been resolved::
```
So please review #23526
