# Issue 23923: Interface cases function with SymPy's piecewise

archive/issues_023686.json:
```json
{
    "body": "In #20191 the `cases` function is introduced. This ticket should interface it with SymPy's piecewise (both directions) and test with:\n\n```\n        sage: _ = var('y, z')\n        sage: (x^y - z).integrate(y)\n        -y*z + x^y/log(x)\n        sage: (x^y - z).integrate(y, algorithm=\"sympy\")  # see Trac #14694\n        -y*z + cases(((log(x) == 0, y), (1, x^y/log(x))))\n```\n\n\nCC:  @mforets @EmmanuelCharpentier\n\nBranch/Commit: [b261ec3e671179d04d1922d15d9116e4f6e1d47f](https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f)\n\nReviewer: Emmanuel Charpentier\n\nAuthor: Ralf Stephan\n\nDependencies: #20191, #23990, #24006\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23923\n\n",
    "closed_at": "2017-10-30T07:41:21Z",
    "created_at": "2017-09-23T06:17:24Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Interface cases function with SymPy's piecewise",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23923",
    "user": "https://github.com/rwst"
}
```
In #20191 the `cases` function is introduced. This ticket should interface it with SymPy's piecewise (both directions) and test with:

```
        sage: _ = var('y, z')
        sage: (x^y - z).integrate(y)
        -y*z + x^y/log(x)
        sage: (x^y - z).integrate(y, algorithm="sympy")  # see Trac #14694
        -y*z + cases(((log(x) == 0, y), (1, x^y/log(x))))
```


CC:  @mforets @EmmanuelCharpentier

Branch/Commit: [b261ec3e671179d04d1922d15d9116e4f6e1d47f](https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f)

Reviewer: Emmanuel Charpentier

Author: Ralf Stephan

Dependencies: #20191, #23990, #24006

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23923





---

archive/issue_comments_454013.json:
```json
{
    "body": "Changing dependencies from \"#20191\" to \"#20191, #23990\"",
    "created_at": "2017-10-08T14:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454013",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#20191" to "#20191, #23990"



---

archive/issue_comments_454014.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/interface_cases_function_with_sympy_s_piecewise\"",
    "created_at": "2017-10-08T14:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454014",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/interface_cases_function_with_sympy_s_piecewise"



---

archive/issue_comments_454015.json:
```json
{
    "body": "Changing commit from \"\" to \"ea10ee716041295de353cbef6f21d6885c825178\"",
    "created_at": "2017-10-09T20:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454015",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing commit from "" to "ea10ee716041295de353cbef6f21d6885c825178"



---

archive/issue_comments_454016.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[ea10ee7](https://github.com/sagemath/sagetrac-mirror/commit/ea10ee716041295de353cbef6f21d6885c825178)|`23923: interface cases() with SymPy`|",
    "created_at": "2017-10-09T20:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454016",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[ea10ee7](https://github.com/sagemath/sagetrac-mirror/commit/ea10ee716041295de353cbef6f21d6885c825178)|`23923: interface cases() with SymPy`|



---

archive/issue_comments_454017.json:
```json
{
    "body": "Changing branch from \"u/rws/interface_cases_function_with_sympy_s_piecewise\" to \"u/rws/23923\"",
    "created_at": "2017-10-17T06:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454017",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/interface_cases_function_with_sympy_s_piecewise" to "u/rws/23923"



---

archive/issue_comments_454018.json:
```json
{
    "body": "Changing commit from \"ea10ee716041295de353cbef6f21d6885c825178\" to \"b80d98c2415f106f9f90270f1b0a7f9f240b76f4\"",
    "created_at": "2017-10-17T06:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ea10ee716041295de353cbef6f21d6885c825178" to "b80d98c2415f106f9f90270f1b0a7f9f240b76f4"



---

archive/issue_comments_454019.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|\n|[b80d98c](https://github.com/sagemath/sagetrac-mirror/commit/b80d98c2415f106f9f90270f1b0a7f9f240b76f4)|`23923: fix typo`|",
    "created_at": "2017-10-17T06:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------|
|[b80d98c](https://github.com/sagemath/sagetrac-mirror/commit/b80d98c2415f106f9f90270f1b0a7f9f240b76f4)|`23923: fix typo`|



---

archive/issue_comments_454020.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-10-17T06:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454020",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_454021.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-17T06:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454021",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454022.json:
```json
{
    "body": "Changing dependencies from \"#20191, #23990\" to \"#20191, #23990, #24006\"",
    "created_at": "2017-10-17T06:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454022",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#20191, #23990" to "#20191, #23990, #24006"



---

archive/issue_comments_454023.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-17T15:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454023",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454024.json:
```json
{
    "body": "<a id='comment:7'></a>\nOn top of 8.1beta7+#24026 + #24006(dependency) + #23990(dependency) + #23923(present patch), one permanent failure :\n\n```\nsage -t --long src/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"src/sage/symbolic/integration/integral.py\", line 508, in sage.symbolic.int\negration.integral.integrate\nFailed example:\n    (x^y - z).integrate(y, algorithm=\"sympy\")  # see Trac #14694\nExpected:\n    Traceback (most recent call last):\n    ...\n    AttributeError: 'ExprCondPair' object has no attribute '_sage_'\nGot:\n    -y*z + cases(((log(x) == 0, y), (1, x^y/log(x))))\n**********************************************************************\n1 item had failures:\n   1 of 126 in sage.symbolic.integration.integral.integrate\n    [169 tests, 1 failure, 53.41 s]\n```\n==>`needs_work`. Probably a booboo, though...",
    "created_at": "2017-10-17T15:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454024",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:7'></a>
On top of 8.1beta7+#24026 + #24006(dependency) + #23990(dependency) + #23923(present patch), one permanent failure :

```
sage -t --long src/sage/symbolic/integration/integral.py
**********************************************************************
File "src/sage/symbolic/integration/integral.py", line 508, in sage.symbolic.int
egration.integral.integrate
Failed example:
    (x^y - z).integrate(y, algorithm="sympy")  # see Trac #14694
Expected:
    Traceback (most recent call last):
    ...
    AttributeError: 'ExprCondPair' object has no attribute '_sage_'
Got:
    -y*z + cases(((log(x) == 0, y), (1, x^y/log(x))))
**********************************************************************
1 item had failures:
   1 of 126 in sage.symbolic.integration.integral.integrate
    [169 tests, 1 failure, 53.41 s]
```
==>`needs_work`. Probably a booboo, though...



---

archive/issue_comments_454025.json:
```json
{
    "body": "Changing commit from \"b80d98c2415f106f9f90270f1b0a7f9f240b76f4\" to \"b261ec3e671179d04d1922d15d9116e4f6e1d47f\"",
    "created_at": "2017-10-17T16:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b80d98c2415f106f9f90270f1b0a7f9f240b76f4" to "b261ec3e671179d04d1922d15d9116e4f6e1d47f"



---

archive/issue_comments_454026.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[b261ec3](https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f)|`23923: fix doctest`|",
    "created_at": "2017-10-17T16:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[b261ec3](https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f)|`23923: fix doctest`|



---

archive/issue_comments_454027.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-17T16:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454027",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454028.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-17T21:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454028",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454029.json:
```json
{
    "body": "<a id='comment:10'></a>\nOn top of 8.1beta8+#24026 + #24006(dependency) + #23990(dependency) + #23923(present patch), passes ptestlong with no error whatsoever.\n\n==>`positive_review`\n\nNotes : \n* I rebased the test on the hust-issued 8.1.beta8\n* I have kept #24026 (which `needs_review`, BTW...) because removing it entails recompiling R (which is slow) and reinstall 442 R packages, (which is slower...).",
    "created_at": "2017-10-17T21:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454029",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:10'></a>
On top of 8.1beta8+#24026 + #24006(dependency) + #23990(dependency) + #23923(present patch), passes ptestlong with no error whatsoever.

==>`positive_review`

Notes : 
* I rebased the test on the hust-issued 8.1.beta8
* I have kept #24026 (which `needs_review`, BTW...) because removing it entails recompiling R (which is slow) and reinstall 442 R packages, (which is slower...).



---

archive/issue_comments_454030.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Emmanuel Charpentier\"",
    "created_at": "2017-10-18T06:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454030",
    "user": "https://github.com/rwst"
}
```

Changing reviewer from "" to "Emmanuel Charpentier"



---

archive/issue_comments_454031.json:
```json
{
    "body": "<a id='comment:11'></a>\nThanks. I've added your name, hope it's not impolite.",
    "created_at": "2017-10-18T06:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454031",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'></a>
Thanks. I've added your name, hope it's not impolite.



---

archive/issue_events_069229.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-30T07:41:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23923#event-69229"
}
```



---

archive/issue_comments_454032.json:
```json
{
    "body": "Changing branch from \"u/rws/23923\" to \"b261ec3e671179d04d1922d15d9116e4f6e1d47f\"",
    "created_at": "2017-10-30T07:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454032",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/23923" to "b261ec3e671179d04d1922d15d9116e4f6e1d47f"



---

archive/issue_comments_454033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-30T07:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23923",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23923#issuecomment-454033",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
