# Issue 23586: Pretty print: sort by string if sorting fails

archive/issues_023349.json:
```json
{
    "assignees": [],
    "body": "Whenever IPython prints a dict or set, it tries to sort the keys for a nicer output. If the sorting fails, then no sorting is done.\n\nThis ticket proposes instead to sort on the string representation if the usual sorting fails. That way, we almost certainly get a deterministic output, which is mainly useful for doctests.\n\nIt must be said that sorting rarely fails on Python 2, so this would affect mostly Python 3.\n\n**Upstream**: https://github.com/ipython/ipython/pull/10767\n\nCC:  @mkoeppe @dkrenn @koffie\n\nBranch/Commit: **[u/jdemeyer/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23586) @ [394d5a4](https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066)**\n\nUpstream: **Reported upstream. No feedback yet.**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23586_\n\n",
    "closed_at": "2021-10-11T08:43:22Z",
    "created_at": "2017-08-05T20:52:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Pretty print: sort by string if sorting fails",
    "type": "issue",
    "updated_at": "2021-10-11T08:43:22Z",
    "url": "https://github.com/sagemath/sage/issues/23586",
    "user": "https://github.com/fchapoton"
}
```
Whenever IPython prints a dict or set, it tries to sort the keys for a nicer output. If the sorting fails, then no sorting is done.

This ticket proposes instead to sort on the string representation if the usual sorting fails. That way, we almost certainly get a deterministic output, which is mainly useful for doctests.

It must be said that sorting rarely fails on Python 2, so this would affect mostly Python 3.

**Upstream**: https://github.com/ipython/ipython/pull/10767

CC:  @mkoeppe @dkrenn @koffie

Branch/Commit: **[u/jdemeyer/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23586) @ [394d5a4](https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066)**

Upstream: **Reported upstream. No feedback yet.**

Reviewer: **François Bissey**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23586_





---

archive/issue_events_298980.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T20:52:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298980"
}
```



---

archive/issue_events_298981.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T20:52:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298981"
}
```



---

archive/issue_events_298982.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T20:52:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298982"
}
```



---

archive/issue_comments_357658.json:
```json
{
    "body": "Branch: **[u/chapoton/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23586)**",
    "created_at": "2017-08-05T20:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357658",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23586)**



---

archive/issue_comments_357659.json:
```json
{
    "body": "Commit: **[9b314dd](https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb)**",
    "created_at": "2017-08-05T20:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357659",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[9b314dd](https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb)**



---

archive/issue_events_298983.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T20:52:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298983"
}
```



---

archive/issue_comments_357660.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb\">9b314dd</a></td><td><code>fixing pynormaliz doctests</code></td></tr></table>\n",
    "created_at": "2017-08-05T20:52:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357660",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb">9b314dd</a></td><td><code>fixing pynormaliz doctests</code></td></tr></table>




---

archive/issue_comments_357661.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nbot is morally green",
    "created_at": "2017-08-07T09:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357661",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'>Comment 2:</a>
bot is morally green



---

archive/issue_comments_357662.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nDo you have any idea why the output has changed? I usually find it dangerous to just accept doctest changes like this without understanding the reason.",
    "created_at": "2017-08-11T07:55:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357662",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Do you have any idea why the output has changed? I usually find it dangerous to just accept doctest changes like this without understanding the reason.



---

archive/issue_comments_357663.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@fchapoton](#comment%3A2):\n> bot is morally green\n\nThose bots do not have `pynormaliz` installed, that means nothing...\n\nOn my bots I try to install all optional packages, so `sage4` and `arando` should have it.",
    "created_at": "2017-08-11T07:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357663",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@fchapoton](#comment%3A2):
> bot is morally green

Those bots do not have `pynormaliz` installed, that means nothing...

On my bots I try to install all optional packages, so `sage4` and `arando` should have it.



---

archive/issue_comments_357664.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nLooks to me like only the ordering of the solutions has changed. The overall set is still the same.",
    "created_at": "2017-08-11T07:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357664",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'>Comment 6:</a>
Looks to me like only the ordering of the solutions has changed. The overall set is still the same.



---

archive/issue_comments_357665.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@kiwifb](#comment%3A6):\n> Looks to me like only the ordering of the solutions has changed.\n\nThat still doesn't answer the \"why\" question.",
    "created_at": "2017-08-11T07:59:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357665",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@kiwifb](#comment%3A6):
> Looks to me like only the ordering of the solutions has changed.

That still doesn't answer the "why" question.



---

archive/issue_comments_357666.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIt's a set, so it is inherently unordered. Although my guess is either changes in the comparisons or the hash led to this change. Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.",
    "created_at": "2017-08-11T08:48:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357666",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'>Comment 8:</a>
It's a set, so it is inherently unordered. Although my guess is either changes in the comparisons or the hash led to this change. Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.



---

archive/issue_comments_357667.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@tscrim](#comment%3A8):\n> Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.\n\n+1",
    "created_at": "2017-08-11T20:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357667",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@tscrim](#comment%3A8):
> Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.

+1



---

archive/issue_events_298984.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-11T20:42:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298984"
}
```



---

archive/issue_events_298985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2017-08-11T20:42:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298985"
}
```



---

archive/issue_comments_357668.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@tscrim](#comment%3A8):\n> Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.\n\nNo, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.",
    "created_at": "2017-08-18T07:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357668",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@tscrim](#comment%3A8):
> Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.

No, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.



---

archive/issue_comments_357669.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@jdemeyer](#comment%3A11):\n> Replying to [@tscrim](#comment%3A8):\n> No, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.\n\n+1",
    "created_at": "2017-08-18T08:51:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357669",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@jdemeyer](#comment%3A11):
> Replying to [@tscrim](#comment%3A8):
> No, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.

+1



---

archive/issue_comments_357670.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@jdemeyer](#comment%3A11):\n> Replying to [@tscrim](#comment%3A8):\n> > Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.\n\n> \n> No, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.\n\n+1",
    "created_at": "2017-08-18T09:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357670",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@jdemeyer](#comment%3A11):
> Replying to [@tscrim](#comment%3A8):
> > Perhaps it will be better to make this robust and just do `sorted(PI.Vrepresentation(), key=str)` instead.

> 
> No, if we want to do that, it should be done at the level of the displayhook. We already do that for `dict`, so it makes sense to do the same for `set`.

+1



---

archive/issue_comments_357671.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI looked a bit into this, and from reading the sage and IPython code I currently understand how the printing of sets is handled is currently via the pretty printing of IPython. And this pretty printing of ipython already sorts items before printing (although on their actual value and not their string representation). \n\nI just verified this experimentally:\n\n```\nsage: str(set([13^i for i in  range(10,1,-1)]))\n'set([815730721, 62748517, 137858491849, 10604499373, 28561, 2197, 169, 4826809, 371293])'\nsage: set([13^i for i in  range(10,1,-1)])\n{169,\n 2197,\n 28561,\n 371293,\n 4826809,\n 62748517,\n 815730721,\n 10604499373,\n 137858491849}\n```\n\nSo the question is wether we want to change this sorting on `__cmp__` to a sorting on str (or on pretty). \n\nThe current sorting behaviour is ok with respect to the doctest for sets containing objects that have a meaningful `__cmp__` method. However the default fallback for `__cmp__` is comparing objects by their id which is really random. So although the IPython pretty printing is more robust then the standard printing, it is not really robust in general.\n\nThe following current printing behaviour is convincing enough for me that we should still change. \n\n```\nsage: set(GF(13)).union(GF(11))\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\nsage: \nsage: set(GF(11)).union(GF(13))\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n```\n\nAfter restarting sage:\n\n```\nsage: set(GF(11)).union(GF(13))\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}\n```",
    "created_at": "2017-08-18T21:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357671",
    "user": "https://github.com/koffie"
}
```

<a id='comment:15'>Comment 15:</a>
I looked a bit into this, and from reading the sage and IPython code I currently understand how the printing of sets is handled is currently via the pretty printing of IPython. And this pretty printing of ipython already sorts items before printing (although on their actual value and not their string representation). 

I just verified this experimentally:

```
sage: str(set([13^i for i in  range(10,1,-1)]))
'set([815730721, 62748517, 137858491849, 10604499373, 28561, 2197, 169, 4826809, 371293])'
sage: set([13^i for i in  range(10,1,-1)])
{169,
 2197,
 28561,
 371293,
 4826809,
 62748517,
 815730721,
 10604499373,
 137858491849}
```

So the question is wether we want to change this sorting on `__cmp__` to a sorting on str (or on pretty). 

The current sorting behaviour is ok with respect to the doctest for sets containing objects that have a meaningful `__cmp__` method. However the default fallback for `__cmp__` is comparing objects by their id which is really random. So although the IPython pretty printing is more robust then the standard printing, it is not really robust in general.

The following current printing behaviour is convincing enough for me that we should still change. 

```
sage: set(GF(13)).union(GF(11))
{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
sage: 
sage: set(GF(11)).union(GF(13))
{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
```

After restarting sage:

```
sage: set(GF(11)).union(GF(13))
{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12}
```



---

archive/issue_comments_357672.json:
```json
{
    "body": "Changed commit from **[9b314dd](https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb)** to **[50e8265](https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032)**",
    "created_at": "2017-08-18T23:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357672",
    "user": "https://github.com/koffie"
}
```

Changed commit from **[9b314dd](https://github.com/sagemath/sagetrac-mirror/commit/9b314ddf075600df41a0433c5247abce218f36fb)** to **[50e8265](https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032)**



---

archive/issue_comments_357673.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nI implemented the sorting by str option. Although there are some things I didn't do yet:\n\n- Document the newly written code\n- Adapt the doctests to accommodate the new way of printing\n- Apply this also to the printing of the builtin Set of sage\n\nThe main reason is that I am not 100% sure ye that this is the way to fix this ticket. This way of fixing this ticket namely also means that we now have\n\n```\nsage: set(GF(11))\n{0, 1, 10, 2, 3, 4, 5, 6, 7, 8, 9}\n```\n\ninstead of\n\n```\nsage: set(GF(11))\n{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n```\n\nAnd this looks ugly to me.\n\nWe could make the order of the printing depend on wether we are currently doctesting, so that the end user is not bothered by the ugly output.\n\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032\">50e8265</a></td><td><code>Make the printed output of sets deterministic, trac 23586</code></td></tr></table>\n",
    "created_at": "2017-08-18T23:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357673",
    "user": "https://github.com/koffie"
}
```

<a id='comment:16'>Comment 16:</a>
I implemented the sorting by str option. Although there are some things I didn't do yet:

- Document the newly written code
- Adapt the doctests to accommodate the new way of printing
- Apply this also to the printing of the builtin Set of sage

The main reason is that I am not 100% sure ye that this is the way to fix this ticket. This way of fixing this ticket namely also means that we now have

```
sage: set(GF(11))
{0, 1, 10, 2, 3, 4, 5, 6, 7, 8, 9}
```

instead of

```
sage: set(GF(11))
{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10}
```

And this looks ugly to me.

We could make the order of the printing depend on wether we are currently doctesting, so that the end user is not bothered by the ugly output.


---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032">50e8265</a></td><td><code>Make the printed output of sets deterministic, trac 23586</code></td></tr></table>




---

archive/issue_comments_357674.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23586)** to **[u/mderickx/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/mderickx/23586)**",
    "created_at": "2017-08-18T23:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357674",
    "user": "https://github.com/koffie"
}
```

Changed branch from **[u/chapoton/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23586)** to **[u/mderickx/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/mderickx/23586)**



---

archive/issue_comments_357675.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI am actually a little more split on the repr of `set` than initially. I feel like it is better to use the natural sorting, but this is not always sufficient to give a unique ordering (as per Jeoren's example). However, I think it is okay for things to not always work (because the data is essentially unordered), in which can for doctests, we should be more explicit. Yet, I am worried about not using `str` and Python3 of doing something like `set([int(1), 'a'])` as those become incomparable and raise an error. Those errors would be caught, but we would be back in the same situation as now in that the output is random.",
    "created_at": "2017-08-18T23:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357675",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'>Comment 17:</a>
I am actually a little more split on the repr of `set` than initially. I feel like it is better to use the natural sorting, but this is not always sufficient to give a unique ordering (as per Jeoren's example). However, I think it is okay for things to not always work (because the data is essentially unordered), in which can for doctests, we should be more explicit. Yet, I am worried about not using `str` and Python3 of doing something like `set([int(1), 'a'])` as those become incomparable and raise an error. Those errors would be caught, but we would be back in the same situation as now in that the output is random.



---

archive/issue_comments_357676.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nYou may want to keep the distinction between sets and frozensets:\n\n```\nFailed example:\n    f.vars\nExpected:\n    frozenset({'x', 'y'})\nGot:\n    {'x', 'y'}\n```",
    "created_at": "2017-08-19T16:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357676",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'>Comment 18:</a>
You may want to keep the distinction between sets and frozensets:

```
Failed example:
    f.vars
Expected:
    frozenset({'x', 'y'})
Got:
    {'x', 'y'}
```



---

archive/issue_comments_357677.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI remember fixing similar fails by not depending on printing at all, i.e. make a result set and compare both sets, testing for \"True\".",
    "created_at": "2017-08-22T14:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357677",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'>Comment 19:</a>
I remember fixing similar fails by not depending on printing at all, i.e. make a result set and compare both sets, testing for "True".



---

archive/issue_comments_357678.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@rwst](#comment%3A19):\n> I remember fixing similar fails by not depending on printing at all, i.e. make a result set and compare both sets, testing for \"True\".\n\nThat might be good for tests, but certainly not for documentation.",
    "created_at": "2017-08-22T17:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357678",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@rwst](#comment%3A19):
> I remember fixing similar fails by not depending on printing at all, i.e. make a result set and compare both sets, testing for "True".

That might be good for tests, but certainly not for documentation.



---

archive/issue_comments_357679.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@tscrim](#comment%3A17):\n> I am actually a little more split on the repr of `set` than initially.\n\nWhy are we even discussing this? The obvious answer is: do whatever we do for dicts. A set is just a dict without values and dicts are sorted nicely:\n\n```\nsage: dict((100**i,i) for i in range(20))\n\n{1: 0,\n 100: 1,\n 10000: 2,\n 1000000: 3,\n 100000000: 4,\n 10000000000: 5,\n 1000000000000: 6,\n 100000000000000: 7,\n 10000000000000000: 8,\n 1000000000000000000: 9,\n 100000000000000000000: 10,\n 10000000000000000000000: 11,\n 1000000000000000000000000: 12,\n 100000000000000000000000000: 13,\n 10000000000000000000000000000: 14,\n 1000000000000000000000000000000: 15,\n 100000000000000000000000000000000: 16,\n 10000000000000000000000000000000000: 17,\n 1000000000000000000000000000000000000: 18,\n 100000000000000000000000000000000000000: 19}\n```",
    "created_at": "2017-08-24T07:52:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357679",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@tscrim](#comment%3A17):
> I am actually a little more split on the repr of `set` than initially.

Why are we even discussing this? The obvious answer is: do whatever we do for dicts. A set is just a dict without values and dicts are sorted nicely:

```
sage: dict((100**i,i) for i in range(20))

{1: 0,
 100: 1,
 10000: 2,
 1000000: 3,
 100000000: 4,
 10000000000: 5,
 1000000000000: 6,
 100000000000000: 7,
 10000000000000000: 8,
 1000000000000000000: 9,
 100000000000000000000: 10,
 10000000000000000000000: 11,
 1000000000000000000000000: 12,
 100000000000000000000000000: 13,
 10000000000000000000000000000: 14,
 1000000000000000000000000000000: 15,
 100000000000000000000000000000000: 16,
 10000000000000000000000000000000000: 17,
 1000000000000000000000000000000000000: 18,
 100000000000000000000000000000000000000: 19}
```



---

archive/issue_comments_357680.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@jdemeyer](#comment%3A21):\n> Replying to [@tscrim](#comment%3A17):\n> > I am actually a little more split on the repr of `set` than initially.\n\n> \n> Why are we even discussing this? The obvious answer is: do whatever we do for dicts. A set is just a dict without values and dicts are sorted nicely:\n\nI agree that they should be consistent (they both are sorted by ipython, see [comment:15](#comment%3A15)), but I feel like the discussion is more about what we use for sorting. The question is the use their default comparisons or to use `str` as a key. After a little more thought, having the default comparison is probably best. If something needs special handling because objects are not comparable, then I think deserves to manually have a `sorted(foo, key=str)` for the doctest. Another option would be if their is an error caught by ipython, then default to `key=str`.",
    "created_at": "2017-08-24T14:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357680",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@jdemeyer](#comment%3A21):
> Replying to [@tscrim](#comment%3A17):
> > I am actually a little more split on the repr of `set` than initially.

> 
> Why are we even discussing this? The obvious answer is: do whatever we do for dicts. A set is just a dict without values and dicts are sorted nicely:

I agree that they should be consistent (they both are sorted by ipython, see [comment:15](#comment%3A15)), but I feel like the discussion is more about what we use for sorting. The question is the use their default comparisons or to use `str` as a key. After a little more thought, having the default comparison is probably best. If something needs special handling because objects are not comparable, then I think deserves to manually have a `sorted(foo, key=str)` for the doctest. Another option would be if their is an error caught by ipython, then default to `key=str`.



---

archive/issue_comments_357681.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@tscrim](#comment%3A22):\n> I agree that they should be consistent (they both are sorted by ipython, see [comment:15](#comment%3A15)), but I feel like the discussion is more about what we use for sorting. The question is the use their default comparisons or to use `str` as a key. \n\nYes exactly that is the main question we should reach a consensus over, and why I have stopped writing more code until we know which direction we want to go! I.e. is sorting by `__cmp__` already robust enough for doctest, and should we only allow doctests with sets containing objects with a `__cmp__` method that is deterministic and not likely to change in the future. Or should we adjust the way we sort the output according to str?\n\nIf we do want to sort for str, then there is another choice to be made. Do we want to do this both for user output or just for doctesting. Doing this for user output as well, will give the user less meaningful and more ugly looking output. So the question is whether nice user output outweighs the good practice of output order in doctests and user output being the same. I personally think this is ok since sets are inherently unordered, but am open for other opinions.\n\n> After a little more thought, having the default comparison is probably best. If something needs special handling because objects are not comparable, then I think deserves to manually have a `sorted(foo, key=str)` for the doctest. Another option would be if their is an error caught by ipython, then default to `key=str`.\n\nIn the current failing doctest IPython is not catching any errors so I don't see how the other option would help.\n\np.s. Slightly offtopic, thinking about the subtleties in this ticket I really start to dislike how the coercion framework, `__eq__` and hash interact. There seems to be something inherently contradictory in the assumptions of these three primitives, leading to things like\n\n```\nsage: set(srange(5)).union(GF(3)).union(GF(5))\n{0, 1, 2, 3, 4}\nsage: set(GF(3)).union(GF(5)).union(srange(5))\n{0, 1, 2, 0, 1, 2, 3, 4}\n```",
    "created_at": "2017-08-24T14:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357681",
    "user": "https://github.com/koffie"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@tscrim](#comment%3A22):
> I agree that they should be consistent (they both are sorted by ipython, see [comment:15](#comment%3A15)), but I feel like the discussion is more about what we use for sorting. The question is the use their default comparisons or to use `str` as a key. 

Yes exactly that is the main question we should reach a consensus over, and why I have stopped writing more code until we know which direction we want to go! I.e. is sorting by `__cmp__` already robust enough for doctest, and should we only allow doctests with sets containing objects with a `__cmp__` method that is deterministic and not likely to change in the future. Or should we adjust the way we sort the output according to str?

If we do want to sort for str, then there is another choice to be made. Do we want to do this both for user output or just for doctesting. Doing this for user output as well, will give the user less meaningful and more ugly looking output. So the question is whether nice user output outweighs the good practice of output order in doctests and user output being the same. I personally think this is ok since sets are inherently unordered, but am open for other opinions.

> After a little more thought, having the default comparison is probably best. If something needs special handling because objects are not comparable, then I think deserves to manually have a `sorted(foo, key=str)` for the doctest. Another option would be if their is an error caught by ipython, then default to `key=str`.

In the current failing doctest IPython is not catching any errors so I don't see how the other option would help.

p.s. Slightly offtopic, thinking about the subtleties in this ticket I really start to dislike how the coercion framework, `__eq__` and hash interact. There seems to be something inherently contradictory in the assumptions of these three primitives, leading to things like

```
sage: set(srange(5)).union(GF(3)).union(GF(5))
{0, 1, 2, 3, 4}
sage: set(GF(3)).union(GF(5)).union(srange(5))
{0, 1, 2, 0, 1, 2, 3, 4}
```



---

archive/issue_comments_357682.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@tscrim](#comment%3A17):\n> Yet, I am worried about not using `str` and Python3 of doing something like `set([int(1), 'a'])` as those become incomparable and raise an error. Those errors would be caught, but we would be back in the same situation as now in that the output is random.\n\nGood point, due to the work being done on making sage work on Python3 we also should take compatibility with Python3 in mind. I now understand your \"Another option would be if their is an error caught by ipython, then default to key=str.\" remark. This would however only fix things for python3 and not the current situation.",
    "created_at": "2017-08-24T15:01:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357682",
    "user": "https://github.com/koffie"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@tscrim](#comment%3A17):
> Yet, I am worried about not using `str` and Python3 of doing something like `set([int(1), 'a'])` as those become incomparable and raise an error. Those errors would be caught, but we would be back in the same situation as now in that the output is random.

Good point, due to the work being done on making sage work on Python3 we also should take compatibility with Python3 in mind. I now understand your "Another option would be if their is an error caught by ipython, then default to key=str." remark. This would however only fix things for python3 and not the current situation.



---

archive/issue_events_298986.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-08-29T15:54:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "title_is": "Make doctest framework more robust with sets",
    "title_was": "fixing broken pynormaliz doctests",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298986"
}
```



---

archive/issue_comments_357683.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI'm degrading this ticket from blocker status, the blocker part of this ticket (i.e. make the output of patchbot useful again) is now #23637 . \n\nSee also the discussion in https://groups.google.com/forum/#!topic/sage-devel/_2vtRbauvrw",
    "created_at": "2017-08-29T15:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357683",
    "user": "https://github.com/koffie"
}
```

<a id='comment:25'>Comment 25:</a>
I'm degrading this ticket from blocker status, the blocker part of this ticket (i.e. make the output of patchbot useful again) is now #23637 . 

See also the discussion in https://groups.google.com/forum/#!topic/sage-devel/_2vtRbauvrw



---

archive/issue_comments_357684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n-found by the patchbot\n-\n-see\n-\n-https://patchbot.sagemath.org/log/14153/Gentoo%20Base%20System/2.2/x86_64/4.4.26-gentoo/sage4/2017-08-05%2017:30:09?short\n+Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic. Sorting object with respect to the string that is actually displayed makes the doctesting framework more robust.\n``````\n",
    "created_at": "2017-08-29T15:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357684",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
-found by the patchbot
-
-see
-
-https://patchbot.sagemath.org/log/14153/Gentoo%20Base%20System/2.2/x86_64/4.4.26-gentoo/sage4/2017-08-05%2017:30:09?short
+Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic. Sorting object with respect to the string that is actually displayed makes the doctesting framework more robust.
``````




---

archive/issue_comments_357685.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2017-08-29T15:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357685",
    "user": "https://github.com/koffie"
}
```

Description changed:
``````diff

``````




---

archive/issue_comments_357686.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer**",
    "created_at": "2017-08-31T13:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357686",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, Jeroen Demeyer**



---

archive/issue_comments_357687.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer** to **Jeroen Demeyer**",
    "created_at": "2017-08-31T13:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357687",
    "user": "https://github.com/fchapoton"
}
```

Changed author from **Frédéric Chapoton, Jeroen Demeyer** to **Jeroen Demeyer**



---

archive/issue_comments_357688.json:
```json
{
    "body": "Changed branch from **[u/mderickx/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/mderickx/23586)** to **[u/jdemeyer/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23586)**",
    "created_at": "2017-08-31T13:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357688",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/mderickx/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/mderickx/23586)** to **[u/jdemeyer/23586](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23586)**



---

archive/issue_comments_357689.json:
```json
{
    "body": "Changed commit from **[50e8265](https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032)** to **[394d5a4](https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066)**",
    "created_at": "2017-08-31T13:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357689",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[50e8265](https://github.com/sagemath/sagetrac-mirror/commit/50e826589372143407186dad219f86ecbe7ef032)** to **[394d5a4](https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066)**



---

archive/issue_comments_357690.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic. Sorting object with respect to the string that is actually displayed makes the doctesting framework more robust.\n+Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic.\n``````\n",
    "created_at": "2017-08-31T13:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357690",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic. Sorting object with respect to the string that is actually displayed makes the doctesting framework more robust.
+Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic.
``````




---

archive/issue_comments_357691.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066\">394d5a4</a></td><td><code>In pretty printing, sort on str() if sorting fails</code></td></tr></table>\n",
    "created_at": "2017-08-31T13:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357691",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/394d5a4f035cf9ef4c92d0288bb4da1c6e420066">394d5a4</a></td><td><code>In pretty printing, sort on str() if sorting fails</code></td></tr></table>




---

archive/issue_comments_357692.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nI'm starting to think that we don't need a general solution at all. First of all, Python 3 will help here since it will disallow sorting arbitrary objects:\n\n```\n>>> sorted([object(), object()])\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: unorderable types: object() < object()\n```\n\nSecond, this issue doesn't seem to be so severe: this optional doctest is the only place where it comes up.",
    "created_at": "2017-08-31T14:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357692",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
I'm starting to think that we don't need a general solution at all. First of all, Python 3 will help here since it will disallow sorting arbitrary objects:

```
>>> sorted([object(), object()])
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: unorderable types: object() < object()
```

Second, this issue doesn't seem to be so severe: this optional doctest is the only place where it comes up.



---

archive/issue_comments_357693.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nHi, Jeroen.\n\nI agree with your Second point. But I don't agree with your first point. \n\nYou are right that comparing arbitrary objects and hence sorting of hetrogenous collections is not allowed anymore. But I think this will actually make the situation worse, since one is still allowed to make heterogenous sets like set([object(),\"a\",1]). IPython doesn't sort the sets where sorting raises a TypeError, so for these sets it will just print them in the order that python iterates over them, which (I admittedly didn't check) I suspect to be nondeterministic.\n\nHowever as mentioned by Travis in comment 22, we can catch this error and just use sorting by string if normal sorting fails. I think this is a clean solution, so we could also just fix it for python 3 and leave the python 2 behaviour as is.",
    "created_at": "2017-08-31T15:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357693",
    "user": "https://github.com/koffie"
}
```

<a id='comment:32'>Comment 32:</a>
Hi, Jeroen.

I agree with your Second point. But I don't agree with your first point. 

You are right that comparing arbitrary objects and hence sorting of hetrogenous collections is not allowed anymore. But I think this will actually make the situation worse, since one is still allowed to make heterogenous sets like set([object(),"a",1]). IPython doesn't sort the sets where sorting raises a TypeError, so for these sets it will just print them in the order that python iterates over them, which (I admittedly didn't check) I suspect to be nondeterministic.

However as mentioned by Travis in comment 22, we can catch this error and just use sorting by string if normal sorting fails. I think this is a clean solution, so we could also just fix it for python 3 and leave the python 2 behaviour as is.



---

archive/issue_events_298987.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T15:16:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "title_is": "Pretty print: sort by string if sorting fails",
    "title_was": "Make doctest framework more robust with sets",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298987"
}
```



---

archive/issue_events_298988.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T15:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298988"
}
```



---

archive/issue_events_298989.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T15:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298989"
}
```



---

archive/issue_events_298990.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T15:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298990"
}
```



---

archive/issue_events_298991.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-31T15:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298991"
}
```



---

archive/issue_comments_357694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n-Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic.\n+Whenever IPython prints a dict or set, it tries to sort the keys for a nicer output. If the sorting fails, then no sorting is done.\n+\n+This ticket proposes instead to sort on the string representation if the usual sorting fails. That way, we almost certainly get a deterministic output, which is mainly useful for doctests.\n+\n+It must be said that sorting rarely fails on Python 2, so this would affect mostly Python 3.\n+\n+**Upstream**: https://github.com/ipython/ipython/pull/10767\n``````\n",
    "created_at": "2017-08-31T15:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357694",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,7 @@
-Even though the output of sets are sorted in sage it is done so using `__cmp__` which is often nondeterministic.
+Whenever IPython prints a dict or set, it tries to sort the keys for a nicer output. If the sorting fails, then no sorting is done.
+
+This ticket proposes instead to sort on the string representation if the usual sorting fails. That way, we almost certainly get a deterministic output, which is mainly useful for doctests.
+
+It must be said that sorting rarely fails on Python 2, so this would affect mostly Python 3.
+
+**Upstream**: https://github.com/ipython/ipython/pull/10767
``````




---

archive/issue_comments_357695.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nWhy needs review? I agree with the new description. But we still need to see if IPython accepts our PR and update ipython after it had done so.",
    "created_at": "2017-08-31T15:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357695",
    "user": "https://github.com/koffie"
}
```

<a id='comment:34'>Comment 34:</a>
Why needs review? I agree with the new description. But we still need to see if IPython accepts our PR and update ipython after it had done so.



---

archive/issue_events_298992.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-08-31T15:26:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298992"
}
```



---

archive/issue_events_298993.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-08-31T15:26:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298993"
}
```



---

archive/issue_comments_357696.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2017-08-31T15:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357696",
    "user": "https://github.com/koffie"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_357697.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nPull request has been merged...",
    "created_at": "2017-11-24T08:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357697",
    "user": "https://github.com/videlec"
}
```

<a id='comment:35'>Comment 35:</a>
Pull request has been merged...



---

archive/issue_comments_357698.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nclose as obsolete ?",
    "created_at": "2021-10-10T08:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357698",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'>Comment 36:</a>
close as obsolete ?



---

archive/issue_events_298994.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-10-10T08:34:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298994"
}
```



---

archive/issue_events_298995.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-10-10T08:34:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298995"
}
```



---

archive/issue_events_298996.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-10-10T08:34:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298996"
}
```



---

archive/issue_comments_357699.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2021-10-10T08:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357699",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_events_298997.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-10-10T08:40:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298997"
}
```



---

archive/issue_events_298998.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2021-10-10T08:40:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298998"
}
```



---

archive/issue_comments_357700.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nSeems like the people involved lost interest 4 years ago so let's obsolete it.",
    "created_at": "2021-10-10T08:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23586#issuecomment-357700",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'>Comment 37:</a>
Seems like the people involved lost interest 4 years ago so let's obsolete it.



---

archive/issue_events_298999.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-10-11T08:43:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-298999"
}
```



---

archive/issue_events_299000.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-10-11T08:43:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23586",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23586#event-299000"
}
```
