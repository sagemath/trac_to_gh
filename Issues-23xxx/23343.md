# Issue 23343: Clean up SpecializationMorphism

archive/issues_023106.json:
```json
{
    "body": "\n\nCC:  @tscrim\n\nBranch/Commit: 6766161d710d43fdcc0ec73c0a2f08196fc68789\n\nReviewer: Jeroen Demeyer, Travis Scrimshaw\n\nAuthor: Travis Scrimshaw, Jeroen Demeyer\n\nDependencies: #23337\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23343\n\n",
    "closed_at": "2017-07-26T22:12:57Z",
    "created_at": "2017-06-30T12:24:56Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Clean up SpecializationMorphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23343",
    "user": "https://github.com/jdemeyer"
}
```


CC:  @tscrim

Branch/Commit: 6766161d710d43fdcc0ec73c0a2f08196fc68789

Reviewer: Jeroen Demeyer, Travis Scrimshaw

Author: Travis Scrimshaw, Jeroen Demeyer

Dependencies: #23337

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23343





---

archive/issue_comments_438585.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-06-30T12:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438585",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_438586.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tscrim/ticket/var_names_not_symbolic_names-23337\"",
    "created_at": "2017-06-30T12:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438586",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/tscrim/ticket/var_names_not_symbolic_names-23337"



---

archive/issue_comments_438587.json:
```json
{
    "body": "Changing commit from \"\" to \"e938684edebd1693f84db659f3bdeb05e4bfb5f8\"",
    "created_at": "2017-06-30T12:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438587",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "e938684edebd1693f84db659f3bdeb05e4bfb5f8"



---

archive/issue_comments_438588.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-30T12:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438588",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438589.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#23337\"",
    "created_at": "2017-06-30T12:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438589",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#23337"



---

archive/issue_comments_438590.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n+It is checking the keys in `D`, which are actual variables and hence, do not compare with the string values. So the variable names all get included when constructing `new_vars` on this line:\n \n+```python\n+new_vars = [[[t for t in v if t not in newD.keys()], b] for v,b in old_vars]\n+```\n+I think I see a good way to fix this. I also am going to do a slight bit of cleanup of that method.\n``````\n",
    "created_at": "2017-06-30T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438590",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
+It is checking the keys in `D`, which are actual variables and hence, do not compare with the string values. So the variable names all get included when constructing `new_vars` on this line:
 
+```python
+new_vars = [[[t for t in v if t not in newD.keys()], b] for v,b in old_vars]
+```
+I think I see a good way to fix this. I also am going to do a slight bit of cleanup of that method.
``````




---

archive/issue_comments_438591.json:
```json
{
    "body": "<a id='comment:3'></a>Since you are cleaning this up anyway, I would prefer if you could also move the changes from #10483 to `flatten.py` to this branch. For example, it would allow to test whether the changes here are compatible with #10483.",
    "created_at": "2017-07-03T13:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438591",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Since you are cleaning this up anyway, I would prefer if you could also move the changes from #10483 to `flatten.py` to this branch. For example, it would allow to test whether the changes here are compatible with #10483.



---

archive/issue_comments_438592.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-03T13:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438592",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438593.json:
```json
{
    "body": "<a id='comment:4'></a>I don't think they are really compatible. Instead, I think these changes should replace those in #10483. The changes of #10483 rely on strings for keys rather than variables, which (in principle) would not work if a variable name is repeated (I haven't explicitly tested that this works in my code or if this is [suppose to be] a supported feature).",
    "created_at": "2017-07-03T14:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438593",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I don't think they are really compatible. Instead, I think these changes should replace those in #10483. The changes of #10483 rely on strings for keys rather than variables, which (in principle) would not work if a variable name is repeated (I haven't explicitly tested that this works in my code or if this is [suppose to be] a supported feature).



---

archive/issue_comments_438594.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-03T14:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438594",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438595.json:
```json
{
    "body": "<a id='comment:6'></a>OK, that wasn't clear. Thanks for the clarification.",
    "created_at": "2017-07-03T14:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438595",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>OK, that wasn't clear. Thanks for the clarification.



---

archive/issue_comments_438596.json:
```json
{
    "body": "Changing branch from \"u/tscrim/ticket/var_names_not_symbolic_names-23337\" to \"u/jdemeyer/ticket/var_names_not_symbolic_names-23337\"",
    "created_at": "2017-07-04T10:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438596",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/tscrim/ticket/var_names_not_symbolic_names-23337" to "u/jdemeyer/ticket/var_names_not_symbolic_names-23337"



---

archive/issue_comments_438597.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1 @@\n-It is checking the keys in `D`, which are actual variables and hence, do not compare with the string values. So the variable names all get included when constructing `new_vars` on this line:\n \n-```python\n-new_vars = [[[t for t in v if t not in newD.keys()], b] for v,b in old_vars]\n-```\n-I think I see a good way to fix this. I also am going to do a slight bit of cleanup of that method.\n``````\n",
    "created_at": "2017-07-04T10:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438597",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1 @@
-It is checking the keys in `D`, which are actual variables and hence, do not compare with the string values. So the variable names all get included when constructing `new_vars` on this line:
 
-```python
-new_vars = [[[t for t in v if t not in newD.keys()], b] for v,b in old_vars]
-```
-I think I see a good way to fix this. I also am going to do a slight bit of cleanup of that method.
``````




---

archive/issue_comments_438598.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-07-04T10:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438598",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_438599.json:
```json
{
    "body": "Changing author from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Jeroen Demeyer\"",
    "created_at": "2017-07-04T10:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438599",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Travis Scrimshaw" to "Travis Scrimshaw, Jeroen Demeyer"



---

archive/issue_comments_438600.json:
```json
{
    "body": "<a id='comment:8'></a>In order to understand the `SpecializationMorphism`, I ended up doing a lot more clean up. Please review my commit.\n\n---\nNew commits:",
    "created_at": "2017-07-04T10:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438600",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>In order to understand the `SpecializationMorphism`, I ended up doing a lot more clean up. Please review my commit.

---
New commits:



---

archive/issue_comments_438601.json:
```json
{
    "body": "Changing commit from \"e938684edebd1693f84db659f3bdeb05e4bfb5f8\" to \"7f4e92f1fa7d49263313fc1dd666a64e34b9e8c1\"",
    "created_at": "2017-07-04T10:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438601",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "e938684edebd1693f84db659f3bdeb05e4bfb5f8" to "7f4e92f1fa7d49263313fc1dd666a64e34b9e8c1"



---

archive/issue_comments_438602.json:
```json
{
    "body": "<a id='comment:9'></a>Inserting at the beginning of a list repeatedly is more expensive than inserting at the end and then reversing (it has to bump each entry back every time you insert). Granted, at this scale it may not be a big issue.\n\nSomewhere between paranoia and it makes the code easier to parse:\n\n```diff\n-            force_multivariate = (len(old) == 1) and is_MPolynomialRing(R)\n+            force_multivariate = ((len(old) == 1) and is_MPolynomialRing(R))\n```\n\nIs there a definitive reason to force the multivariate polynomial ring? I know you're not changing the current implementation, but I'm just wondering if that is something that is necessary since the univariates tend to be more powerful. If you don't know, then we can just leave it as is.\n\nLGTM otherwise.",
    "created_at": "2017-07-04T13:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438602",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Inserting at the beginning of a list repeatedly is more expensive than inserting at the end and then reversing (it has to bump each entry back every time you insert). Granted, at this scale it may not be a big issue.

Somewhere between paranoia and it makes the code easier to parse:

```diff
-            force_multivariate = (len(old) == 1) and is_MPolynomialRing(R)
+            force_multivariate = ((len(old) == 1) and is_MPolynomialRing(R))
```

Is there a definitive reason to force the multivariate polynomial ring? I know you're not changing the current implementation, but I'm just wondering if that is something that is necessary since the univariates tend to be more powerful. If you don't know, then we can just leave it as is.

LGTM otherwise.



---

archive/issue_comments_438603.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [tscrim](#comment%3A9):\n> Is there a definitive reason to force the multivariate polynomial ring?\n\n\nI don't know, I just didn't want to change the existing behaviour.",
    "created_at": "2017-07-04T13:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438603",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [tscrim](#comment%3A9):
> Is there a definitive reason to force the multivariate polynomial ring?


I don't know, I just didn't want to change the existing behaviour.



---

archive/issue_comments_438604.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-04T13:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438605.json:
```json
{
    "body": "Changing commit from \"7f4e92f1fa7d49263313fc1dd666a64e34b9e8c1\" to \"a28bb4e10aa59dd5291a54ce32e0707525d5ab96\"",
    "created_at": "2017-07-04T13:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7f4e92f1fa7d49263313fc1dd666a64e34b9e8c1" to "a28bb4e10aa59dd5291a54ce32e0707525d5ab96"



---

archive/issue_comments_438606.json:
```json
{
    "body": "<a id='comment:12'></a>Minor update.",
    "created_at": "2017-07-04T13:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438606",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Minor update.



---

archive/issue_comments_438607.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-04T13:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438607",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438608.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks. LGTM.",
    "created_at": "2017-07-04T13:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438608",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Thanks. LGTM.



---

archive/issue_comments_438609.json:
```json
{
    "body": "<a id='comment:14'></a>missing utf8 declaration in src/sage/rings/polynomial/flatten.py",
    "created_at": "2017-07-05T06:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438609",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>missing utf8 declaration in src/sage/rings/polynomial/flatten.py



---

archive/issue_comments_438610.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-07-05T11:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438610",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_438611.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-07-05T11:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_438612.json:
```json
{
    "body": "Changing commit from \"a28bb4e10aa59dd5291a54ce32e0707525d5ab96\" to \"6766161d710d43fdcc0ec73c0a2f08196fc68789\"",
    "created_at": "2017-07-05T11:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a28bb4e10aa59dd5291a54ce32e0707525d5ab96" to "6766161d710d43fdcc0ec73c0a2f08196fc68789"



---

archive/issue_comments_438613.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-05T11:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438613",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438614.json:
```json
{
    "body": "Changing reviewer from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Travis Scrimshaw\"",
    "created_at": "2017-07-05T11:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438614",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "Jeroen Demeyer" to "Jeroen Demeyer, Travis Scrimshaw"



---

archive/issue_comments_438615.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/var_names_not_symbolic_names-23337\" to \"6766161d710d43fdcc0ec73c0a2f08196fc68789\"",
    "created_at": "2017-07-26T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438615",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/var_names_not_symbolic_names-23337" to "6766161d710d43fdcc0ec73c0a2f08196fc68789"



---

archive/issue_events_060088.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-26T22:12:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23343#event-60088"
}
```



---

archive/issue_comments_438616.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-26T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23343#issuecomment-438616",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
