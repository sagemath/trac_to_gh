# Issue 23225: fix tuning of gf2x

archive/issues_022988.json:
```json
{
    "body": "see the last comments on #18882\n\nThere are a wrong `ASSERT` in `toom2.c` that errors out on some systems. In addition, tuning routine may link against a wrong copy of `libgf2x.so`.\n\n**CC:**  @zimmermann6 @tscrim\n\n**Branch:** [3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Volker Braun\n\n**Author:** Paul Zimmermann, Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/23225\n\n",
    "closed_at": "2017-06-15T16:45:23Z",
    "created_at": "2017-06-12T17:42:06Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "fix tuning of gf2x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23225",
    "user": "https://github.com/dimpase"
}
```
see the last comments on #18882

There are a wrong `ASSERT` in `toom2.c` that errors out on some systems. In addition, tuning routine may link against a wrong copy of `libgf2x.so`.

**CC:**  @zimmermann6 @tscrim

**Branch:** [3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Volker Braun

**Author:** Paul Zimmermann, Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/23225





---

archive/issue_comments_351175.json:
```json
{
    "body": "**Author:** Paul Zimmermann, Dima Pasechnik",
    "created_at": "2017-06-12T17:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351175",
    "user": "https://github.com/dimpase"
}
```

**Author:** Paul Zimmermann, Dima Pasechnik



---

archive/issue_comments_351176.json:
```json
{
    "body": "**Commit:** [e6b5456ff1d6178695dab727873895a6dc779aac](https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac)",
    "created_at": "2017-06-12T17:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351176",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [e6b5456ff1d6178695dab727873895a6dc779aac](https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac)



---

archive/issue_comments_351177.json:
```json
{
    "body": "**Branch:** [u/dimpase/gf2xfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gf2xfix)",
    "created_at": "2017-06-12T17:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351177",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [u/dimpase/gf2xfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gf2xfix)



---

archive/issue_comments_351178.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac\">e6b5456</a></td><td><code>fixes wrong ASSERT, as proposed by Paul on #18882</code></td></tr></table>\n",
    "created_at": "2017-06-12T17:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351178",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac">e6b5456</a></td><td><code>fixes wrong ASSERT, as proposed by Paul on #18882</code></td></tr></table>




---

archive/issue_events_206925.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-06-12T17:51:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23225#event-206925"
}
```



---

archive/issue_comments_351179.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64\">3761c47</a></td><td><code>remove old files before building, not after</code></td></tr></table>\n",
    "created_at": "2017-06-12T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64">3761c47</a></td><td><code>remove old files before building, not after</code></td></tr></table>




---

archive/issue_comments_351180.json:
```json
{
    "body": "**Changing commit** from \"[e6b5456ff1d6178695dab727873895a6dc779aac](https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac)\" to \"[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)\".",
    "created_at": "2017-06-12T18:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e6b5456ff1d6178695dab727873895a6dc779aac](https://github.com/sagemath/sagetrac-mirror/commit/e6b5456ff1d6178695dab727873895a6dc779aac)" to "[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)".



---

archive/issue_comments_351181.json:
```json
{
    "body": "<a id='comment:3'></a>\nYes the removal of the old libraries may be necessary in sage. But I don't think it should, because the linked test executable are not executed directly but through a libtool script. And that libtool script should set `{DY}LD_LIBRARY_PATH` to the the built library. I guess we could examine one of them to be sure there is no pollution from somewhere but `{DY,}LD_LIBRARY_PATH` takes precedence to rpath set during compilation.",
    "created_at": "2017-06-13T02:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351181",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Yes the removal of the old libraries may be necessary in sage. But I don't think it should, because the linked test executable are not executed directly but through a libtool script. And that libtool script should set `{DY}LD_LIBRARY_PATH` to the the built library. I guess we could examine one of them to be sure there is no pollution from somewhere but `{DY,}LD_LIBRARY_PATH` takes precedence to rpath set during compilation.



---

archive/issue_comments_351182.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2017-06-13T07:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351182",
    "user": "https://github.com/dimpase"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_events_206926.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-14T18:33:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23225#event-206926"
}
```



---

archive/issue_events_206927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-14T18:33:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23225#event-206927"
}
```



---

archive/issue_comments_351183.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2017-06-14T18:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351183",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_events_206928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-15T16:45:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23225#event-206928"
}
```



---

archive/issue_events_206929.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-15T16:45:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23225#event-206929"
}
```



---

archive/issue_comments_351184.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/gf2xfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gf2xfix)\" to \"[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)\".",
    "created_at": "2017-06-15T16:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351184",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/dimpase/gf2xfix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/gf2xfix)" to "[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)".



---

archive/issue_comments_351185.json:
```json
{
    "body": "**Changing commit** from \"[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)\" to \"\".",
    "created_at": "2017-06-26T09:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351185",
    "user": "https://github.com/emmanuelthome"
}
```

**Changing commit** from "[3761c47a88d477378b0633fe50dcca8ccf57bb64](https://github.com/sagemath/sagetrac-mirror/commit/3761c47a88d477378b0633fe50dcca8ccf57bb64)" to "".



---

archive/issue_comments_351186.json:
```json
{
    "body": "<a id='comment:7'></a>\nHi,\n\nI'm reviewing the suggested changes to gf2x in order to prepare a release.\n\nSeveral issues were raised in #18882.\n\nI don't see the point about shared libs possibly linking to an outdated version. I haven't witnessed that. If I install some libgf2x.so in the library path (say, in /usr/local), then we have the following.\n\nOn the one hand, it's true that \"ldd ./src/.libs/tunetoom\" sees the /usr/local library as a way to resolve the dependency:\n\n```\n  libgf2x.so.1 => /usr/local/lib/libgf2x.so.1\n```\n\nOn the other hand, the above is a non-issue, because in the testing procedure, libtool takes care of ensuring that the libgf2x which gets linked is the right one. I check that with\n\n```\n  cat /proc/`pidof tunetoom`/maps\n```\nwhile tunetoom is running. It does use the one in the build tree, not the /usr/local one.\n\nIs there something else that I've missed in the way you encounter a misbehaviour ?",
    "created_at": "2017-06-26T09:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351186",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:7'></a>
Hi,

I'm reviewing the suggested changes to gf2x in order to prepare a release.

Several issues were raised in #18882.

I don't see the point about shared libs possibly linking to an outdated version. I haven't witnessed that. If I install some libgf2x.so in the library path (say, in /usr/local), then we have the following.

On the one hand, it's true that "ldd ./src/.libs/tunetoom" sees the /usr/local library as a way to resolve the dependency:

```
  libgf2x.so.1 => /usr/local/lib/libgf2x.so.1
```

On the other hand, the above is a non-issue, because in the testing procedure, libtool takes care of ensuring that the libgf2x which gets linked is the right one. I check that with

```
  cat /proc/`pidof tunetoom`/maps
```
while tunetoom is running. It does use the one in the build tree, not the /usr/local one.

Is there something else that I've missed in the way you encounter a misbehaviour ?



---

archive/issue_comments_351187.json:
```json
{
    "body": "<a id='comment:8'></a>\n@ thome, I agree with you libtool wraps the command before running it. It is not foolproof but usually work well. It is not foolproof because stray .la files can introduce system path in `{DY,}LD_LIBRARY_PATH` to not so hilarious effects. But I think here, dima may not have known about libtool wrapping - which means that it looks like you are linking to a library in a system path.",
    "created_at": "2017-06-26T09:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351187",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
@ thome, I agree with you libtool wraps the command before running it. It is not foolproof but usually work well. It is not foolproof because stray .la files can introduce system path in `{DY,}LD_LIBRARY_PATH` to not so hilarious effects. But I think here, dima may not have known about libtool wrapping - which means that it looks like you are linking to a library in a system path.



---

archive/issue_comments_351188.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [thome](#comment%3A7):\n> Hi,\n> \n> I'm reviewing the suggested changes to gf2x in order to prepare a release.\n> \n> Several issues were raised in #18882.\n> \n> I don't see the point about shared libs possibly linking to an outdated version. I haven't witnessed that. If I install some libgf2x.so in the library path (say, in /usr/local), then we have the following.\n> \n> On the one hand, it's true that \"ldd ./src/.libs/tunetoom\" sees the /usr/local library as a way to resolve the dependency:\n> \n> ```\n>   libgf2x.so.1 => /usr/local/lib/libgf2x.so.1\n> ```\n> \n> On the other hand, the above is a non-issue, because in the testing procedure, libtool takes care of ensuring that the libgf2x which gets linked is the right one. I check that with\n> \n> ```\n>   cat /proc/`pidof tunetoom`/maps\n> ```\n> while tunetoom is running. It does use the one in the build tree, not the /usr/local one.\n> \n> Is there something else that I've missed in the way you encounter a misbehaviour ?\n\n\nMaybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1\nrather than to the libgf2x.so.1 currently being built.\n\nIt may also be that FreeBSD's linker behaves differently and does the wrong linking regardless...\n\nAnyway, I would be happy to test a newer version of gf2x on FreeBSD, if you don't have access to such a system.\nI have just updated the relevant ticket #22679.",
    "created_at": "2017-06-26T09:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351188",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
Replying to [thome](#comment%3A7):
> Hi,
> 
> I'm reviewing the suggested changes to gf2x in order to prepare a release.
> 
> Several issues were raised in #18882.
> 
> I don't see the point about shared libs possibly linking to an outdated version. I haven't witnessed that. If I install some libgf2x.so in the library path (say, in /usr/local), then we have the following.
> 
> On the one hand, it's true that "ldd ./src/.libs/tunetoom" sees the /usr/local library as a way to resolve the dependency:
> 
> ```
>   libgf2x.so.1 => /usr/local/lib/libgf2x.so.1
> ```
> 
> On the other hand, the above is a non-issue, because in the testing procedure, libtool takes care of ensuring that the libgf2x which gets linked is the right one. I check that with
> 
> ```
>   cat /proc/`pidof tunetoom`/maps
> ```
> while tunetoom is running. It does use the one in the build tree, not the /usr/local one.
> 
> Is there something else that I've missed in the way you encounter a misbehaviour ?


Maybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1
rather than to the libgf2x.so.1 currently being built.

It may also be that FreeBSD's linker behaves differently and does the wrong linking regardless...

Anyway, I would be happy to test a newer version of gf2x on FreeBSD, if you don't have access to such a system.
I have just updated the relevant ticket #22679.



---

archive/issue_comments_351189.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.",
    "created_at": "2017-06-26T09:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351189",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.



---

archive/issue_comments_351190.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [fbissey](#comment%3A10):\n> OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.\n\n\nIMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...",
    "created_at": "2017-06-26T10:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351190",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Replying to [fbissey](#comment%3A10):
> OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.


IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...



---

archive/issue_comments_351191.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [dimpase](#comment%3A11):\n> Replying to [fbissey](#comment%3A10):\n> > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.\n\n> \n> IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...\n\n\nlibtool is smart enough to use DYLD_LIBRARY_PATH on OS X, so that's OK. But freeBSD is an unknown, I don't know if it support any mechanism of that kind.",
    "created_at": "2017-06-26T10:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351191",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Replying to [dimpase](#comment%3A11):
> Replying to [fbissey](#comment%3A10):
> > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.

> 
> IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...


libtool is smart enough to use DYLD_LIBRARY_PATH on OS X, so that's OK. But freeBSD is an unknown, I don't know if it support any mechanism of that kind.



---

archive/issue_comments_351192.json:
```json
{
    "body": "<a id='comment:13'></a>\nDepending on the linker (--enable-new-dtags or not), either RPATH or LD_LIBRARY_PATH has precedence.",
    "created_at": "2017-06-26T11:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351192",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Depending on the linker (--enable-new-dtags or not), either RPATH or LD_LIBRARY_PATH has precedence.



---

archive/issue_comments_351193.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A9):\n> Maybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1\n> rather than to the libgf2x.so.1 currently being built.\n\n\nIt's hard to work with maybe's...\n\nI can test the following.\n1. install some gf2x in a system path\n2. run gf2x tuning from a fresh tarball\n3. make sure the tuning does not use the lib from step 1.\n\nI can also replace step 1. by \"install some gf2x in a custom path, and enable its use via LD_LIBRARY_PATH\".\n\nI can do this test on various machines. I understand you've seen issues on freebsd, I can do a test on freebsd 11.0.\n\nI can also test on macosx 11.0\n\nHowever if the procedure that led you to a misbehaviour is not within the scope of what I will be testing, chances are that I'm not going to detect anything wrong.",
    "created_at": "2017-06-26T13:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351193",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A9):
> Maybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1
> rather than to the libgf2x.so.1 currently being built.


It's hard to work with maybe's...

I can test the following.
1. install some gf2x in a system path
2. run gf2x tuning from a fresh tarball
3. make sure the tuning does not use the lib from step 1.

I can also replace step 1. by "install some gf2x in a custom path, and enable its use via LD_LIBRARY_PATH".

I can do this test on various machines. I understand you've seen issues on freebsd, I can do a test on freebsd 11.0.

I can also test on macosx 11.0

However if the procedure that led you to a misbehaviour is not within the scope of what I will be testing, chances are that I'm not going to detect anything wrong.



---

archive/issue_comments_351194.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [fbissey](#comment%3A12):\n> Replying to [dimpase](#comment%3A11):\n> > Replying to [fbissey](#comment%3A10):\n> > > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.\n\n> > \n> > IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...\n\n\nWould you mind being more precise about what you mean by \"a problem\" ?\n\nAFAIK OSX uses DYLD_LIBRARY_PATH. And so what ?\n\nIt should not be within the scope of a package I write to deal with the idiosyncrasies of all unices on earth. Libtool is for that, and precisely for that.\n\n\n> libtool is smart enough to use DYLD_LIBRARY_PATH on OS X, so that's OK. But freeBSD is an unknown, I don't know if it support any mechanism of that kind.\n\n\nYup.\n\nIt's certainly not as if freeBSD was a new kid on the block, you know... That it would be \"unsupported\" by libtool in some way would surprise me very much.\n\nE.",
    "created_at": "2017-06-26T13:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351194",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:15'></a>
Replying to [fbissey](#comment%3A12):
> Replying to [dimpase](#comment%3A11):
> > Replying to [fbissey](#comment%3A10):
> > > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.

> > 
> > IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...


Would you mind being more precise about what you mean by "a problem" ?

AFAIK OSX uses DYLD_LIBRARY_PATH. And so what ?

It should not be within the scope of a package I write to deal with the idiosyncrasies of all unices on earth. Libtool is for that, and precisely for that.


> libtool is smart enough to use DYLD_LIBRARY_PATH on OS X, so that's OK. But freeBSD is an unknown, I don't know if it support any mechanism of that kind.


Yup.

It's certainly not as if freeBSD was a new kid on the block, you know... That it would be "unsupported" by libtool in some way would surprise me very much.

E.



---

archive/issue_comments_351195.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [thome](#comment%3A14):\n> Replying to [dimpase](#comment%3A9):\n> > Maybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1\n> > rather than to the libgf2x.so.1 currently being built.\n\n> \n> It's hard to work with maybe's...\n> \n> I can test the following.\n> 1. install some gf2x in a system path\n> 2. run gf2x tuning from a fresh tarball\n> 3. make sure the tuning does not use the lib from step 1.\n> \n> I can also replace step 1. by \"install some gf2x in a custom path, and enable its use via LD_LIBRARY_PATH\".\n\n\nI presume that by `3.` you mean \"break the installed gf2x, so that tuning---if it uses it---will fail\".\n\n\n> \n> I can do this test on various machines. I understand you've seen issues on freebsd, I can do a test on freebsd 11.0.\n\n\nYes, please test on FreeBSD 11.0 with CC=clang and CXX=clang++\n(I think I saw this with clang version 4.0.0; probably the current (3.8.0) would reproduce this too).\n\nAnd also note that I am talking about gf2x-1.1. I did not try the development version yet.\n\n \n> \n> I can also test on macosx 11.0\n> \n> However if the procedure that led you to a misbehaviour is not within the scope of what I will be testing, chances are that I'm not going to detect anything wrong.\n",
    "created_at": "2017-06-26T14:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351195",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
Replying to [thome](#comment%3A14):
> Replying to [dimpase](#comment%3A9):
> > Maybe this only works when you have something in a system path; in my case I did see this wrong linking to SAGE_LOCAL/lib/libgf2x.so.1
> > rather than to the libgf2x.so.1 currently being built.

> 
> It's hard to work with maybe's...
> 
> I can test the following.
> 1. install some gf2x in a system path
> 2. run gf2x tuning from a fresh tarball
> 3. make sure the tuning does not use the lib from step 1.
> 
> I can also replace step 1. by "install some gf2x in a custom path, and enable its use via LD_LIBRARY_PATH".


I presume that by `3.` you mean "break the installed gf2x, so that tuning---if it uses it---will fail".


> 
> I can do this test on various machines. I understand you've seen issues on freebsd, I can do a test on freebsd 11.0.


Yes, please test on FreeBSD 11.0 with CC=clang and CXX=clang++
(I think I saw this with clang version 4.0.0; probably the current (3.8.0) would reproduce this too).

And also note that I am talking about gf2x-1.1. I did not try the development version yet.

 
> 
> I can also test on macosx 11.0
> 
> However if the procedure that led you to a misbehaviour is not within the scope of what I will be testing, chances are that I'm not going to detect anything wrong.




---

archive/issue_comments_351196.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [thome](#comment%3A15):\n> Replying to [fbissey](#comment%3A12):\n> > Replying to [dimpase](#comment%3A11):\n> > > Replying to [fbissey](#comment%3A10):\n> > > > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.\n\n> > > \n> > > IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...\n\n> \n> Would you mind being more precise about what you mean by \"a problem\" ?\n\n\nI merely meant to say that direct manipulation of LD_LIBRARY_PATH on OSX is not really possible, as by default OSX has some security thing turned on that basically blocks it.",
    "created_at": "2017-06-26T14:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351196",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Replying to [thome](#comment%3A15):
> Replying to [fbissey](#comment%3A12):
> > Replying to [dimpase](#comment%3A11):
> > > Replying to [fbissey](#comment%3A10):
> > > > OK, I am not actually sure that LD_LIBRARY_PATH, which is used by the libtool wrapper, works on freeBSD.

> > > 
> > > IMHO `LD_LIBRARY_PATH` is certainly a problem on OSX, thus a better way needs to be found...

> 
> Would you mind being more precise about what you mean by "a problem" ?


I merely meant to say that direct manipulation of LD_LIBRARY_PATH on OSX is not really possible, as by default OSX has some security thing turned on that basically blocks it.



---

archive/issue_comments_351197.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [dimpase](#comment%3A16):\n> Replying to [thome](#comment%3A14):\n> >   1. install some gf2x in a system path\n> >   2. run gf2x tuning from a fresh tarball\n> >   3. make sure the tuning does not use the lib from step 1.\n  \n> > \n> > [...]\n\n> \n> I presume that by `3.` you mean \"break the installed gf2x, so that tuning---if it uses it---will fail\".\n\n\nI rather had in mind a live check that tuning binaries run with the proper lib. This being said you're right. While it's trivial to do on linux with /proc/`pid xxx`/maps, it's maybe less so on other systems. So I'll probably be better off sticking an abort() in the installed gf2x and see fireworks (if any).\n\n> Yes, please test on FreeBSD 11.0 with CC=clang and CXX=clang++\n> (I think I saw this with clang version 4.0.0; probably the current (3.8.0) would reproduce this too).\n\n\nok thanks. Good to know.\n\nStruggling with our cloudstack server at the moment, but I still hope I'll be able to do that shortly.\n\n> And also note that I am talking about gf2x-1.1. I did not try the development version yet.\n\n\nI understood that. I really mean to make a release tarball, so I'm gonna check with the development version. I'll give a short go to the 1.1 version to see if I can confirm a defect.\n\nE.",
    "created_at": "2017-06-26T14:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351197",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:18'></a>
Replying to [dimpase](#comment%3A16):
> Replying to [thome](#comment%3A14):
> >   1. install some gf2x in a system path
> >   2. run gf2x tuning from a fresh tarball
> >   3. make sure the tuning does not use the lib from step 1.
  
> > 
> > [...]

> 
> I presume that by `3.` you mean "break the installed gf2x, so that tuning---if it uses it---will fail".


I rather had in mind a live check that tuning binaries run with the proper lib. This being said you're right. While it's trivial to do on linux with /proc/`pid xxx`/maps, it's maybe less so on other systems. So I'll probably be better off sticking an abort() in the installed gf2x and see fireworks (if any).

> Yes, please test on FreeBSD 11.0 with CC=clang and CXX=clang++
> (I think I saw this with clang version 4.0.0; probably the current (3.8.0) would reproduce this too).


ok thanks. Good to know.

Struggling with our cloudstack server at the moment, but I still hope I'll be able to do that shortly.

> And also note that I am talking about gf2x-1.1. I did not try the development version yet.


I understood that. I really mean to make a release tarball, so I'm gonna check with the development version. I'll give a short go to the 1.1 version to see if I can confirm a defect.

E.



---

archive/issue_comments_351198.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A17):\n> I merely meant to say that direct manipulation of LD_LIBRARY_PATH on OSX is not really possible, as by default OSX has some security thing turned on that basically blocks it.\n\n\nAh ok, that's more clear now.\n\nSigh.\n\nI knew about OSX preventing gdb for non-root users. Now LD_LIBRARY_PATH. What next ?\n\nBut anyway, as I was saying I'm convinced that I should not have to bother with library path tricks, given that nothing which is done by gf2x is super-weird to that respect.",
    "created_at": "2017-06-26T14:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351198",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A17):
> I merely meant to say that direct manipulation of LD_LIBRARY_PATH on OSX is not really possible, as by default OSX has some security thing turned on that basically blocks it.


Ah ok, that's more clear now.

Sigh.

I knew about OSX preventing gdb for non-root users. Now LD_LIBRARY_PATH. What next ?

But anyway, as I was saying I'm convinced that I should not have to bother with library path tricks, given that nothing which is done by gf2x is super-weird to that respect.



---

archive/issue_comments_351199.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [thome](#comment%3A18):\n> Replying to [dimpase](#comment%3A16):\n> > Replying to [thome](#comment%3A14):\n> > >   1. install some gf2x in a system path\n> > >   2. run gf2x tuning from a fresh tarball\n> > >   3. make sure the tuning does not use the lib from step 1.\n  \n> > > \n> > > [...]\n\n> > \n> > I presume that by `3.` you mean \"break the installed gf2x, so that tuning---if it uses it---will fail\".\n\n> \n> I rather had in mind a live check that tuning binaries run with the proper lib. This being said you're right. While it's trivial to do on linux with /proc/`pid xxx`/maps, it's maybe less so on other systems. So I'll probably be better off sticking an abort() in the installed gf2x and see fireworks (if any).\n\n\nBasically, I was changing the tuning code and not seeing any difference, until I checked the tuning routine with `ldd` and saw it linking to the wrong copy of the dynamic library.\n\nSorry for noise---no need to run any \"live\" tests, just build and check with ldd that `lt-tunetoom` is linked against the right library.",
    "created_at": "2017-06-26T14:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351199",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [thome](#comment%3A18):
> Replying to [dimpase](#comment%3A16):
> > Replying to [thome](#comment%3A14):
> > >   1. install some gf2x in a system path
> > >   2. run gf2x tuning from a fresh tarball
> > >   3. make sure the tuning does not use the lib from step 1.
  
> > > 
> > > [...]

> > 
> > I presume that by `3.` you mean "break the installed gf2x, so that tuning---if it uses it---will fail".

> 
> I rather had in mind a live check that tuning binaries run with the proper lib. This being said you're right. While it's trivial to do on linux with /proc/`pid xxx`/maps, it's maybe less so on other systems. So I'll probably be better off sticking an abort() in the installed gf2x and see fireworks (if any).


Basically, I was changing the tuning code and not seeing any difference, until I checked the tuning routine with `ldd` and saw it linking to the wrong copy of the dynamic library.

Sorry for noise---no need to run any "live" tests, just build and check with ldd that `lt-tunetoom` is linked against the right library.



---

archive/issue_comments_351200.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dimpase](#comment%3A20):\n> Basically, I was changing the tuning code and not seeing any difference, until I checked the tuning routine with `ldd` and saw it linking to the wrong copy of the dynamic library.\n> \n> Sorry for noise---no need to run any \"live\" tests, just build and check with ldd that `lt-tunetoom` is linked against the right library.\n\n\nYou're tinkering with libtool's internals, there. Theoretically, libtool's wrapper could wrap the final executable in such a way that the library paths you see with ldd on .libs/blah are irrelevant.\n\nThis being said, I've been able to reproduce your freebsd problem. I'll look into it a bit more.",
    "created_at": "2017-06-26T15:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351200",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:21'></a>
Replying to [dimpase](#comment%3A20):
> Basically, I was changing the tuning code and not seeing any difference, until I checked the tuning routine with `ldd` and saw it linking to the wrong copy of the dynamic library.
> 
> Sorry for noise---no need to run any "live" tests, just build and check with ldd that `lt-tunetoom` is linked against the right library.


You're tinkering with libtool's internals, there. Theoretically, libtool's wrapper could wrap the final executable in such a way that the library paths you see with ldd on .libs/blah are irrelevant.

This being said, I've been able to reproduce your freebsd problem. I'll look into it a bit more.



---

archive/issue_comments_351201.json:
```json
{
    "body": "<a id='comment:22'></a>\nSo. This \"tuning hits the wrong library\" issue is a libtool bug IMHO.\n\nI've committed a workaround to gf2x, but the cause of the misbehaviour is completely unrelated to gf2x itself. If you follow that same procedure of leaving an installed lib, and try to run the tuning of e.g., gmp, then you'll be testing the old library just the same.\n\nhttps://scm.gforge.inria.fr/anonscm/gitweb?p=gf2x/gf2x.git;a=commit;h=799afa342c1cf744cacd6987f28b9baef75faacf\n\nlibtool bug reported there.\n\nhttps://debbugs.gnu.org/cgi/bugreport.cgi?bug=27510",
    "created_at": "2017-06-27T21:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351201",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:22'></a>
So. This "tuning hits the wrong library" issue is a libtool bug IMHO.

I've committed a workaround to gf2x, but the cause of the misbehaviour is completely unrelated to gf2x itself. If you follow that same procedure of leaving an installed lib, and try to run the tuning of e.g., gmp, then you'll be testing the old library just the same.

https://scm.gforge.inria.fr/anonscm/gitweb?p=gf2x/gf2x.git;a=commit;h=799afa342c1cf744cacd6987f28b9baef75faacf

libtool bug reported there.

https://debbugs.gnu.org/cgi/bugreport.cgi?bug=27510



---

archive/issue_comments_351202.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks for getting to the bottom of it thome!",
    "created_at": "2017-06-27T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351202",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Thanks for getting to the bottom of it thome!



---

archive/issue_comments_351203.json:
```json
{
    "body": "<a id='comment:24'></a>\nImpressive find!",
    "created_at": "2017-06-27T22:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351203",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
Impressive find!



---

archive/issue_comments_351204.json:
```json
{
    "body": "<a id='comment:25'></a>\nWould you mind testing whether the latest release candidate looks good to you?\n\nThe page with all released tarballs is there: \nhttps://gforge.inria.fr/frs/?group_id=1874\n\nrc1 did not live long, as Paul noticed a corner case.\n\nE.",
    "created_at": "2017-06-28T13:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351204",
    "user": "https://github.com/emmanuelthome"
}
```

<a id='comment:25'></a>
Would you mind testing whether the latest release candidate looks good to you?

The page with all released tarballs is there: 
https://gforge.inria.fr/frs/?group_id=1874

rc1 did not live long, as Paul noticed a corner case.

E.



---

archive/issue_comments_351205.json:
```json
{
    "body": "<a id='comment:26'></a>\nI've created #23357 to deal with the upgrade to gf2x version 1.2.",
    "created_at": "2017-07-03T17:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23225",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23225#issuecomment-351205",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
I've created #23357 to deal with the upgrade to gf2x version 1.2.
