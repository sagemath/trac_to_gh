# Issue 23449: Fast logarithm for p-adic floats

archive/issues_023212.json:
```json
{
    "body": "This ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.\n\n\nCC:  @roed314 @saraedum\n\nKeywords: sd87, padicIMA, padicBordeaux\n\nAuthor: Xavier Caruso\n\nBranch: u/roed/padiclog\n\nStatus: new\n\nCommit: 451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26\n\nIssue created by migration from https://trac.sagemath.org/ticket/23449\n\n",
    "created_at": "2017-07-18T04:34:26Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fast logarithm for p-adic floats",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23449",
    "user": "https://github.com/xcaruso"
}
```
This ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.


CC:  @roed314 @saraedum

Keywords: sd87, padicIMA, padicBordeaux

Author: Xavier Caruso

Branch: u/roed/padiclog

Status: new

Commit: 451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26

Issue created by migration from https://trac.sagemath.org/ticket/23449





---

archive/issue_comments_440908.json:
```json
{
    "body": "Changing branch from \"\" to \"u/caruso/padiclog\"",
    "created_at": "2017-07-18T04:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440908",
    "user": "https://github.com/xcaruso"
}
```

Changing branch from "" to "u/caruso/padiclog"



---

archive/issue_comments_440909.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87\".",
    "created_at": "2017-07-18T04:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440909",
    "user": "https://github.com/xcaruso"
}
```

Changing keywords from "" to "sd87".



---

archive/issue_comments_440910.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-07-18T04:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440910",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_440911.json:
```json
{
    "body": "Changing commit from \"\" to \"3465a147454b7a018eedef903558bdff97005aff\"",
    "created_at": "2017-07-18T04:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440911",
    "user": "https://github.com/xcaruso"
}
```

Changing commit from "" to "3465a147454b7a018eedef903558bdff97005aff"



---

archive/issue_comments_440912.json:
```json
{
    "body": "Changing branch from \"u/caruso/padiclog\" to \"u/roed/padiclog\"",
    "created_at": "2017-08-03T21:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440912",
    "user": "https://github.com/roed314"
}
```

Changing branch from "u/caruso/padiclog" to "u/roed/padiclog"



---

archive/issue_comments_440913.json:
```json
{
    "body": "<a id='comment:4'></a>Xavier, what's the status of this ticket?  What still needs to be done before it's ready for review?\n\n---\nNew commits:",
    "created_at": "2017-08-03T22:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440913",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>Xavier, what's the status of this ticket?  What still needs to be done before it's ready for review?

---
New commits:



---

archive/issue_comments_440914.json:
```json
{
    "body": "Changing commit from \"3465a147454b7a018eedef903558bdff97005aff\" to \"451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26\"",
    "created_at": "2017-08-03T22:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440914",
    "user": "https://github.com/roed314"
}
```

Changing commit from "3465a147454b7a018eedef903558bdff97005aff" to "451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26"



---

archive/issue_comments_440915.json:
```json
{
    "body": "<a id='comment:5'></a>I have a question.\n\nIf x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?",
    "created_at": "2017-08-05T12:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440915",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:5'></a>I have a question.

If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?



---

archive/issue_comments_440916.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 caruso]:\n> I have a question.\n> \n> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?\n\n\nThis shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.",
    "created_at": "2017-09-22T19:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440916",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'></a>Replying to [comment:5 caruso]:
> I have a question.
> 
> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?


This shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.



---

archive/issue_comments_440917.json:
```json
{
    "body": "<a id='comment:7'></a>I'm not sure that your answer resolves my problem.\n\nSuppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.\nIf `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.\n\nIn comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).\n\nAm I mistaken?",
    "created_at": "2018-03-11T20:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440917",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:7'></a>I'm not sure that your answer resolves my problem.

Suppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.
If `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.

In comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).

Am I mistaken?



---

archive/issue_comments_440918.json:
```json
{
    "body": "Changing keywords from \"sd87\" to \"sd87, padicIMA\".",
    "created_at": "2018-07-22T20:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440918",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd87" to "sd87, padicIMA".



---

archive/issue_comments_440919.json:
```json
{
    "body": "Changing keywords from \"sd87, padicIMA\" to \"sd87, padicIMA, padicBordeaux\".",
    "created_at": "2019-09-07T12:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23449#issuecomment-440919",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd87, padicIMA" to "sd87, padicIMA, padicBordeaux".
