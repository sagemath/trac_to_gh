# Issue 23449: Fast logarithm for p-adic floats

archive/issues_023212.json:
```json
{
    "assignees": [],
    "body": "This ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.\n\n\nCC:  @roed314 @saraedum\n\nComponent: **padics**\n\nKeywords: **sd87, padicIMA, padicBordeaux**\n\nAuthor: **Xavier Caruso**\n\nBranch/Commit: **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog) @ [`451dfd3`](https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23449_\n\n",
    "created_at": "2017-07-18T04:34:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20padics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fast logarithm for p-adic floats",
    "type": "issue",
    "updated_at": "2022-12-29T01:40:01Z",
    "url": "https://github.com/sagemath/sage/issues/23449",
    "user": "https://github.com/xcaruso"
}
```
This ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.


CC:  @roed314 @saraedum

Component: **padics**

Keywords: **sd87, padicIMA, padicBordeaux**

Author: **Xavier Caruso**

Branch/Commit: **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog) @ [`451dfd3`](https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26)**

_Issue created by migration from https://trac.sagemath.org/ticket/23449_





---

archive/issue_events_323536.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-18T04:34:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23449#event-323536"
}
```



---

archive/issue_events_323537.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-18T04:34:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20padics",
    "label_color": "0000ff",
    "label_name": "c: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23449#event-323537"
}
```



---

archive/issue_events_323538.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-18T04:34:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23449#event-323538"
}
```



---

archive/issue_events_323539.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-18T04:34:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23449#event-323539"
}
```



---

archive/issue_comments_352252.json:
```json
{
    "body": "Branch: **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)**",
    "created_at": "2017-07-18T04:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352252",
    "user": "https://github.com/xcaruso"
}
```

Branch: **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)**



---

archive/issue_comments_352253.json:
```json
{
    "body": "Changed keywords from none to **sd87**",
    "created_at": "2017-07-18T04:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352253",
    "user": "https://github.com/xcaruso"
}
```

Changed keywords from none to **sd87**



---

archive/issue_comments_352254.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff\"><code>3465a14</code></a></td><td><code>Logarithm of p-adic floats</code></td></tr></table>\n",
    "created_at": "2017-07-18T04:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352254",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff"><code>3465a14</code></a></td><td><code>Logarithm of p-adic floats</code></td></tr></table>




---

archive/issue_comments_352255.json:
```json
{
    "body": "Commit: **[`3465a14`](https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff)**",
    "created_at": "2017-07-18T04:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352255",
    "user": "https://github.com/xcaruso"
}
```

Commit: **[`3465a14`](https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff)**



---

archive/issue_comments_352256.json:
```json
{
    "body": "Changed branch from **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)** to **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)**",
    "created_at": "2017-08-03T21:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352256",
    "user": "https://github.com/roed314"
}
```

Changed branch from **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)** to **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)**



---

archive/issue_comments_352257.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nXavier, what's the status of this ticket?  What still needs to be done before it's ready for review?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26\"><code>451dfd3</code></a></td><td><code>Merge branch 'u/caruso/padiclog' of git://trac.sagemath.org/sage into t/23449/padiclog</code></td></tr></table>\n",
    "created_at": "2017-08-03T22:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352257",
    "user": "https://github.com/roed314"
}
```

<div id="comment:4" align="right">comment:4</div>

Xavier, what's the status of this ticket?  What still needs to be done before it's ready for review?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26"><code>451dfd3</code></a></td><td><code>Merge branch 'u/caruso/padiclog' of git://trac.sagemath.org/sage into t/23449/padiclog</code></td></tr></table>




---

archive/issue_comments_352258.json:
```json
{
    "body": "Changed commit from **[`3465a14`](https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff)** to **[`451dfd3`](https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26)**",
    "created_at": "2017-08-03T22:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352258",
    "user": "https://github.com/roed314"
}
```

Changed commit from **[`3465a14`](https://github.com/sagemath/sagetrac-mirror/commit/3465a147454b7a018eedef903558bdff97005aff)** to **[`451dfd3`](https://github.com/sagemath/sagetrac-mirror/commit/451dfd3f6f506f67cbf2dda7f4c1f78be5b83e26)**



---

archive/issue_comments_352259.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI have a question.\n\nIf x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?",
    "created_at": "2017-08-05T12:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352259",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:5" align="right">comment:5</div>

I have a question.

If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?



---

archive/issue_comments_352260.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@xcaruso](#comment%3A5):\n> I have a question.\n> \n> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?\n\nThis shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.",
    "created_at": "2017-09-22T19:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352260",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@xcaruso](#comment%3A5):
> I have a question.
> 
> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?

This shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.



---

archive/issue_comments_352261.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm not sure that your answer resolves my problem.\n\nSuppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.\nIf `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.\n\nIn comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).\n\nAm I mistaken?",
    "created_at": "2018-03-11T20:37:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352261",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm not sure that your answer resolves my problem.

Suppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.
If `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.

In comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).

Am I mistaken?



---

archive/issue_comments_352262.json:
```json
{
    "body": "Changed keywords from **sd87** to **sd87, padicIMA**",
    "created_at": "2018-07-22T20:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352262",
    "user": "https://github.com/roed314"
}
```

Changed keywords from **sd87** to **sd87, padicIMA**



---

archive/issue_comments_352263.json:
```json
{
    "body": "Changed keywords from **sd87, padicIMA** to **sd87, padicIMA, padicBordeaux**",
    "created_at": "2019-09-07T12:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23449#issuecomment-352263",
    "user": "https://github.com/roed314"
}
```

Changed keywords from **sd87, padicIMA** to **sd87, padicIMA, padicBordeaux**



---

archive/issue_events_323540.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:40:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23449",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23449#event-323540"
}
```
