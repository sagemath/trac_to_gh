# Issue 23736: Teichmuller lift of residual element has wrong precision

archive/issues_023499.json:
```json
{
    "body": "See below:\n\n```\nsage: R = Zp(5); R\n5-adic Ring with capped relative precision 20\nsage: R.teichmuller(2)\n2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)\nsage: R.teichmuller(GF(5)(2)) % should have precision 20?\n2 + O(5)\n```\nAccording to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.\n\n\nCC:  @roed314\n\nKeywords: teichmuller lift\n\nBranch/Commit: [3de062fa0899946f36d4f4bc228b438dd60b67e4](https://github.com/sagemath/sagetrac-mirror/commit/3de062fa0899946f36d4f4bc228b438dd60b67e4)\n\nReviewer: Kiran Kedlaya\n\nAuthor: David Roe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23736\n\n",
    "closed_at": "2017-09-26T06:58:17Z",
    "created_at": "2017-08-28T17:09:24Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Teichmuller lift of residual element has wrong precision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23736",
    "user": "https://github.com/kedlaya"
}
```
See below:

```
sage: R = Zp(5); R
5-adic Ring with capped relative precision 20
sage: R.teichmuller(2)
2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)
sage: R.teichmuller(GF(5)(2)) % should have precision 20?
2 + O(5)
```
According to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.


CC:  @roed314

Keywords: teichmuller lift

Branch/Commit: [3de062fa0899946f36d4f4bc228b438dd60b67e4](https://github.com/sagemath/sagetrac-mirror/commit/3de062fa0899946f36d4f4bc228b438dd60b67e4)

Reviewer: Kiran Kedlaya

Author: David Roe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23736





---

archive/issue_comments_450271.json:
```json
{
    "body": "Changing branch from \"\" to \"u/roed/teichmuller_prec\"",
    "created_at": "2017-08-28T17:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450271",
    "user": "https://github.com/roed314"
}
```

Changing branch from "" to "u/roed/teichmuller_prec"



---

archive/issue_comments_450272.json:
```json
{
    "body": "Changing commit from \"\" to \"5745f993b4c23e11e076111aedc5ebd789710f6d\"",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450272",
    "user": "https://github.com/roed314"
}
```

Changing commit from "" to "5745f993b4c23e11e076111aedc5ebd789710f6d"



---

archive/issue_comments_450273.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450273",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450274.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[5745f99](https://github.com/sagemath/sagetrac-mirror/commit/5745f993b4c23e11e076111aedc5ebd789710f6d)|`Fix precision in teichmuller function`|",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450274",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[5745f99](https://github.com/sagemath/sagetrac-mirror/commit/5745f993b4c23e11e076111aedc5ebd789710f6d)|`Fix precision in teichmuller function`|



---

archive/issue_comments_450275.json:
```json
{
    "body": "Changing author from \"\" to \"David Roe\"",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450275",
    "user": "https://github.com/roed314"
}
```

Changing author from "" to "David Roe"



---

archive/issue_comments_450276.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450276",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_450277.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis looks good on its own; but I get some doctest failures in adjacent files:\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed\nsage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed\nsage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed\n```\nwhich all appear to be of the form\n\n```\n    PrecisionError: Precision higher than allowed by the precision cap.\n```",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450277",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:3'></a>
This looks good on its own; but I get some doctest failures in adjacent files:

```
sage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed
sage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed
sage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed
```
which all appear to be of the form

```
    PrecisionError: Precision higher than allowed by the precision cap.
```



---

archive/issue_comments_450278.json:
```json
{
    "body": "Changing commit from \"5745f993b4c23e11e076111aedc5ebd789710f6d\" to \"e20a5a0b81f045679c76b3d226fbc85fccd3463d\"",
    "created_at": "2017-08-28T18:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5745f993b4c23e11e076111aedc5ebd789710f6d" to "e20a5a0b81f045679c76b3d226fbc85fccd3463d"



---

archive/issue_comments_450279.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[e20a5a0](https://github.com/sagemath/sagetrac-mirror/commit/e20a5a0b81f045679c76b3d226fbc85fccd3463d)|`Update implementation of teichmuller so that we don't lift to too high precision`|",
    "created_at": "2017-08-28T18:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[e20a5a0](https://github.com/sagemath/sagetrac-mirror/commit/e20a5a0b81f045679c76b3d226fbc85fccd3463d)|`Update implementation of teichmuller so that we don't lift to too high precision`|



---

archive/issue_comments_450280.json:
```json
{
    "body": "<a id='comment:5'></a>\nAlright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.\n\nHowever, there are now failing tests in\n\n```\nsage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed\nsage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed\n```\nwhich look more serious.\n\nI'm going to have to come back to this in a few days, since I need to get ready for the start of classes.",
    "created_at": "2017-08-28T19:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450280",
    "user": "https://github.com/roed314"
}
```

<a id='comment:5'></a>
Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.

However, there are now failing tests in

```
sage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed
sage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed
```
which look more serious.

I'm going to have to come back to this in a few days, since I need to get ready for the start of classes.



---

archive/issue_comments_450281.json:
```json
{
    "body": "Changing commit from \"e20a5a0b81f045679c76b3d226fbc85fccd3463d\" to \"3de062fa0899946f36d4f4bc228b438dd60b67e4\"",
    "created_at": "2017-09-20T22:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450281",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e20a5a0b81f045679c76b3d226fbc85fccd3463d" to "3de062fa0899946f36d4f4bc228b438dd60b67e4"



---

archive/issue_comments_450282.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|\n|[a97dd52](https://github.com/sagemath/sagetrac-mirror/commit/a97dd52c2b5bf8205ae74dffcb555fa0617d2c85)|`Merge branch 'u/roed/teichmuller_prec' of git://trac.sagemath.org/sage into t/23736/teichmuller_prec`|\n|[3de062f](https://github.com/sagemath/sagetrac-mirror/commit/3de062fa0899946f36d4f4bc228b438dd60b67e4)|`Fix doctest errors from teichmuller change`|",
    "created_at": "2017-09-20T22:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
|[a97dd52](https://github.com/sagemath/sagetrac-mirror/commit/a97dd52c2b5bf8205ae74dffcb555fa0617d2c85)|`Merge branch 'u/roed/teichmuller_prec' of git://trac.sagemath.org/sage into t/23736/teichmuller_prec`|
|[3de062f](https://github.com/sagemath/sagetrac-mirror/commit/3de062fa0899946f36d4f4bc228b438dd60b67e4)|`Fix doctest errors from teichmuller change`|



---

archive/issue_comments_450283.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450283",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_450284.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlright, fixed it.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450284",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
Alright, fixed it.



---

archive/issue_comments_450285.json:
```json
{
    "body": "<a id='comment:8'></a>\nI just ran all tests in `src/sage` with no failures.",
    "created_at": "2017-09-20T22:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450285",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>
I just ran all tests in `src/sage` with no failures.



---

archive/issue_comments_450286.json:
```json
{
    "body": "<a id='comment:9'></a>\nLooks good to me. Positive review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450286",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:9'></a>
Looks good to me. Positive review.



---

archive/issue_comments_450287.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450287",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450288.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kiran Kedlaya\"",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450288",
    "user": "https://github.com/kedlaya"
}
```

Changing reviewer from "" to "Kiran Kedlaya"



---

archive/issue_comments_450289.json:
```json
{
    "body": "Changing branch from \"u/roed/teichmuller_prec\" to \"3de062fa0899946f36d4f4bc228b438dd60b67e4\"",
    "created_at": "2017-09-26T06:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450289",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/roed/teichmuller_prec" to "3de062fa0899946f36d4f4bc228b438dd60b67e4"



---

archive/issue_comments_450290.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-26T06:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-450290",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068933.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-26T06:58:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23736#event-68933"
}
```
