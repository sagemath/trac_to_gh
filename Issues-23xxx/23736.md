# Issue 23736: Teichmuller lift of residual element has wrong precision

archive/issues_023499.json:
```json
{
    "body": "See below:\n\n```\nsage: R = Zp(5); R\n5-adic Ring with capped relative precision 20\nsage: R.teichmuller(2)\n2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)\nsage: R.teichmuller(GF(5)(2)) % should have precision 20?\n2 + O(5)\n```\nAccording to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.\n\n\nCC:  @roed314\n\nKeywords: teichmuller lift\n\nBranch/Commit: 3de062fa0899946f36d4f4bc228b438dd60b67e4\n\nReviewer: Kiran Kedlaya\n\nAuthor: David Roe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23736\n\n",
    "closed_at": "2017-09-26T06:58:17Z",
    "created_at": "2017-08-28T17:09:24Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Teichmuller lift of residual element has wrong precision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23736",
    "user": "https://github.com/kedlaya"
}
```
See below:

```
sage: R = Zp(5); R
5-adic Ring with capped relative precision 20
sage: R.teichmuller(2)
2 + 5 + 2*5^2 + 5^3 + 3*5^4 + 4*5^5 + 2*5^6 + 3*5^7 + 3*5^9 + 2*5^10 + 2*5^11 + 4*5^13 + 5^14 + 3*5^15 + 2*5^16 + 4*5^17 + 4*5^19 + O(5^20)
sage: R.teichmuller(GF(5)(2)) % should have precision 20?
2 + O(5)
```
According to roed, this occurs because `GF(5)(2)` is first cast into `R`, with precision `5^1`, and then `R.teichmuller` respects the precision of the element. But since Teichmuller lifts are in principle exact objects, it would make more sense to have the default behavior (when the optional argument `prec` is omitted) be for the lift to be defined to the full precision of the ambient ring.


CC:  @roed314

Keywords: teichmuller lift

Branch/Commit: 3de062fa0899946f36d4f4bc228b438dd60b67e4

Reviewer: Kiran Kedlaya

Author: David Roe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23736





---

archive/issue_comments_328970.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328970",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_328971.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-08-28T17:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328971",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_328972.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328972",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_328973.json:
```json
{
    "body": "<a id='comment:3'></a>This looks good on its own; but I get some doctest failures in adjacent files:\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed\nsage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed\nsage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed\n```\nwhich all appear to be of the form\n\n```\n    PrecisionError: Precision higher than allowed by the precision cap.\n```",
    "created_at": "2017-08-28T18:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328973",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:3'></a>This looks good on its own; but I get some doctest failures in adjacent files:

```
sage -t src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed
sage -t src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx  # 1 doctest failed
sage -t src/sage/rings/padics/local_generic.py  # 1 doctest failed
```
which all appear to be of the form

```
    PrecisionError: Precision higher than allowed by the precision cap.
```



---

archive/issue_comments_328974.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-28T18:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328974",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328975.json:
```json
{
    "body": "<a id='comment:5'></a>Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.\n\nHowever, there are now failing tests in\n\n```\nsage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed\nsage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed\n```\nwhich look more serious.\n\nI'm going to have to come back to this in a few days, since I need to get ready for the start of classes.",
    "created_at": "2017-08-28T19:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328975",
    "user": "https://github.com/roed314"
}
```

<a id='comment:5'></a>Alright, I fixed those problems by adapting the way precision is handled in `teichmuller` and now all tests in `sage.rings.padics` pass.

However, there are now failing tests in

```
sage -t --warn-long 45.5 src/sage/schemes/hyperelliptic_curves/hyperelliptic_padic_field.py  # 4 doctests failed
sage -t --warn-long 45.5 src/sage/modular/overconvergent/weightspace.py  # 5 doctests failed
```
which look more serious.

I'm going to have to come back to this in a few days, since I need to get ready for the start of classes.



---

archive/issue_comments_328976.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T22:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328977.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328977",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_328978.json:
```json
{
    "body": "<a id='comment:7'></a>Alright, fixed it.",
    "created_at": "2017-09-20T22:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328978",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>Alright, fixed it.



---

archive/issue_comments_328979.json:
```json
{
    "body": "<a id='comment:8'></a>I just ran all tests in `src/sage` with no failures.",
    "created_at": "2017-09-20T22:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328979",
    "user": "https://github.com/roed314"
}
```

<a id='comment:8'></a>I just ran all tests in `src/sage` with no failures.



---

archive/issue_comments_328980.json:
```json
{
    "body": "<a id='comment:9'></a>Looks good to me. Positive review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328980",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:9'></a>Looks good to me. Positive review.



---

archive/issue_comments_328981.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-23T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328981",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_328982.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-26T06:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23736#issuecomment-328982",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-26T06:58:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23736",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23736#event-60611"
}
```
