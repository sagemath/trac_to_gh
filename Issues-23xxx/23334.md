# Issue 23334: Implementing Wells' Algorithm

archive/issues_023097.json:
```json
{
    "body": "Implementing Wells' Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.\nThis algorithm is found in Elliot Wells' Paper  \"Computing the Canonical Height of a Point in Projective Space\"\n\nAssignee: rlmiller\n\nKeywords: gsoc2017\n\nBranch/Commit: 47c1957d4fb30ceea21c84bed0d5f0e6643b68d8\n\nReviewer: Ben Hutz\n\nAuthor: Rebecca Lauren Miller, Paul Fili\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23334\n\n",
    "closed_at": "2017-08-03T22:11:22Z",
    "created_at": "2017-06-28T15:55:50Z",
    "labels": [
        "component: dynamics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Implementing Wells' Algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23334",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```
Implementing Wells' Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.
This algorithm is found in Elliot Wells' Paper  "Computing the Canonical Height of a Point in Projective Space"

Assignee: rlmiller

Keywords: gsoc2017

Branch/Commit: 47c1957d4fb30ceea21c84bed0d5f0e6643b68d8

Reviewer: Ben Hutz

Author: Rebecca Lauren Miller, Paul Fili

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23334





---

archive/issue_comments_432643.json:
```json
{
    "body": "Set assignee to rlmiller.",
    "created_at": "2017-06-28T15:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432643",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Set assignee to rlmiller.



---

archive/issue_comments_432644.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rlmiller/wells\"",
    "created_at": "2017-06-28T15:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432644",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing branch from "" to "u/rlmiller/wells"



---

archive/issue_comments_432645.json:
```json
{
    "body": "Changing commit from \"\" to \"d9e145d44c3e2e18e00409ff93620d4bee6141a2\"",
    "created_at": "2017-06-28T15:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432645",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing commit from "" to "d9e145d44c3e2e18e00409ff93620d4bee6141a2"



---

archive/issue_events_076134.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "label": "component: algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76134"
}
```



---

archive/issue_comments_432646.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-06-28T15:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432646",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from new to needs_info.



---

archive/issue_events_076135.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "label": "component: algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76135"
}
```



---

archive/issue_events_076136.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "label": "component: algebraic geometry",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76136"
}
```



---

archive/issue_comments_432647.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Implementing Well's Algorithm for GSOC 2017\n+Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don;t need to factor the resultant.\n``````\n",
    "created_at": "2017-06-28T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432647",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Implementing Well's Algorithm for GSOC 2017
+Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don;t need to factor the resultant.
``````




---

archive/issue_comments_432648.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[3c128bb](https://github.com/sagemath/sagetrac-mirror/commit/3c128bbb7de8c329528c168e49748f7a38b2f23f)|`23334 updates, added error bound`|",
    "created_at": "2017-06-30T16:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[3c128bb](https://github.com/sagemath/sagetrac-mirror/commit/3c128bbb7de8c329528c168e49748f7a38b2f23f)|`23334 updates, added error bound`|



---

archive/issue_comments_432649.json:
```json
{
    "body": "Changing commit from \"d9e145d44c3e2e18e00409ff93620d4bee6141a2\" to \"3c128bbb7de8c329528c168e49748f7a38b2f23f\"",
    "created_at": "2017-06-30T16:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d9e145d44c3e2e18e00409ff93620d4bee6141a2" to "3c128bbb7de8c329528c168e49748f7a38b2f23f"



---

archive/issue_comments_432650.json:
```json
{
    "body": "Changing branch from \"u/rlmiller/wells\" to \"u/paulfili/wells\"",
    "created_at": "2017-07-03T03:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432650",
    "user": "https://github.com/pfili"
}
```

Changing branch from "u/rlmiller/wells" to "u/paulfili/wells"



---

archive/issue_comments_432651.json:
```json
{
    "body": "Changing branch from \"u/paulfili/wells\" to \"u/rlmiller/wells\"",
    "created_at": "2017-07-04T00:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432651",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing branch from "u/paulfili/wells" to "u/rlmiller/wells"



---

archive/issue_comments_432652.json:
```json
{
    "body": "Changing author from \"\" to \"Rebecca Lauren Miller, Paul Fili\"",
    "created_at": "2017-07-04T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432652",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing author from "" to "Rebecca Lauren Miller, Paul Fili"



---

archive/issue_comments_432653.json:
```json
{
    "body": "<a id='comment:8'></a>\nFixed test errors so we are ready to review. Wondering if we should take out a new ticket so we can change all the prec to 53.",
    "created_at": "2017-07-04T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432653",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

<a id='comment:8'></a>
Fixed test errors so we are ready to review. Wondering if we should take out a new ticket so we can change all the prec to 53.



---

archive/issue_comments_432654.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don;t need to factor the resultant.\n+Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.\n+This algorithm is found in Elliot Wells' Paper  \"Computing the Canonical Height of a Point in Projective Space\"\n``````\n",
    "created_at": "2017-07-04T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432654",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don;t need to factor the resultant.
+Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.
+This algorithm is found in Elliot Wells' Paper  "Computing the Canonical Height of a Point in Projective Space"
``````




---

archive/issue_comments_432655.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-07-04T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432655",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_432656.json:
```json
{
    "body": "Changing commit from \"3c128bbb7de8c329528c168e49748f7a38b2f23f\" to \"6a14427ebd9cc17ae6a6ee46bec343339b4f41ff\"",
    "created_at": "2017-07-04T00:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432656",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing commit from "3c128bbb7de8c329528c168e49748f7a38b2f23f" to "6a14427ebd9cc17ae6a6ee46bec343339b4f41ff"



---

archive/issue_comments_432657.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-05T06:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432657",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_432658.json:
```json
{
    "body": "<a id='comment:9'></a>\ndoc does not build:\n\n```\n+[dochtml] OSError: [schemes  ] /local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_point.py:\ndocstring of sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:39:\n WARNING: Explicit markup ends without a blank line; unexpected unindent.\n```",
    "created_at": "2017-07-05T06:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432658",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
doc does not build:

```
+[dochtml] OSError: [schemes  ] /local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_point.py:
docstring of sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:39:
 WARNING: Explicit markup ends without a blank line; unexpected unindent.
```



---

archive/issue_events_076137.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2017-07-06T19:58:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76137"
}
```



---

archive/issue_comments_432659.json:
```json
{
    "body": "<a id='comment:10'></a>\nA took a first look and here are a few initial comments:\n\n- also change the description of the algorithm in canonical_height in projective_morphism\n\n- move reference to reference file and add citations here\n\n- 1031: line too long\n\n- a bunch of your earlier work is to get integer coefficients and coordinates. I'd recommend using the built in functions instead\n  - f.normalize_coordinates() - removes gcd and clears denominators\n  - Q.normalize_coordinates() - removes gcd\n  - Q.clear_denominators() - clears denominators\n\n- 'not err == None'  should be  'not err is None'\n\n- Height_I - lower case\n\n- you do a lot of extraneous variable assignment for example\n  - P = self\n  - f = F\n  - A_0, B_0\n\nyou don't need all these extra variables floating around\n\n- and something not minor: The error bound calculation seems to be failing. I put in Wells example 4.4 as a test (which I recommend you do as well) and got the appropriate value when assigning N but not when assigning err.\n\n```\nRSA768 = 1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413\nP.<x,y>=ProjectiveSpace(QQ,1)\nH=End(P)\nf=H([RSA768*x^2+y^2,x*y])\nQ=P(RSA768,1)\nQ.canonical_height(f, err=0.00000000000000001)\n930.66293109982349403319550850\nQ.canonical_height(f, N=50)\n931.18256422718194018675677246\n```\n\nsame was true for simple functions as well.",
    "created_at": "2017-07-06T19:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432659",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:10'></a>
A took a first look and here are a few initial comments:

- also change the description of the algorithm in canonical_height in projective_morphism

- move reference to reference file and add citations here

- 1031: line too long

- a bunch of your earlier work is to get integer coefficients and coordinates. I'd recommend using the built in functions instead
  - f.normalize_coordinates() - removes gcd and clears denominators
  - Q.normalize_coordinates() - removes gcd
  - Q.clear_denominators() - clears denominators

- 'not err == None'  should be  'not err is None'

- Height_I - lower case

- you do a lot of extraneous variable assignment for example
  - P = self
  - f = F
  - A_0, B_0

you don't need all these extra variables floating around

- and something not minor: The error bound calculation seems to be failing. I put in Wells example 4.4 as a test (which I recommend you do as well) and got the appropriate value when assigning N but not when assigning err.

```
RSA768 = 1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413
P.<x,y>=ProjectiveSpace(QQ,1)
H=End(P)
f=H([RSA768*x^2+y^2,x*y])
Q=P(RSA768,1)
Q.canonical_height(f, err=0.00000000000000001)
930.66293109982349403319550850
Q.canonical_height(f, N=50)
931.18256422718194018675677246
```

same was true for simple functions as well.



---

archive/issue_comments_432660.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Hutz\"",
    "created_at": "2017-07-06T19:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432660",
    "user": "https://github.com/bhutz"
}
```

Changing reviewer from "" to "Ben Hutz"



---

archive/issue_comments_432661.json:
```json
{
    "body": "Changing keywords from \"GSOC\" to \"gsoc2017\".",
    "created_at": "2017-07-06T19:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432661",
    "user": "https://github.com/bhutz"
}
```

Changing keywords from "GSOC" to "gsoc2017".



---

archive/issue_comments_432662.json:
```json
{
    "body": "<a id='comment:11'></a>\nnever mind about the error bound issue. When I use the correct parameter it works as expected.",
    "created_at": "2017-07-07T17:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432662",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:11'></a>
never mind about the error bound issue. When I use the correct parameter it works as expected.



---

archive/issue_comments_432663.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[09692fa](https://github.com/sagemath/sagetrac-mirror/commit/09692fa7d2f81ee8b0956af6fd6719bc278a1c8c)|`22334 simplified code, added example`|",
    "created_at": "2017-07-11T01:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[09692fa](https://github.com/sagemath/sagetrac-mirror/commit/09692fa7d2f81ee8b0956af6fd6719bc278a1c8c)|`22334 simplified code, added example`|



---

archive/issue_comments_432664.json:
```json
{
    "body": "Changing commit from \"6a14427ebd9cc17ae6a6ee46bec343339b4f41ff\" to \"09692fa7d2f81ee8b0956af6fd6719bc278a1c8c\"",
    "created_at": "2017-07-11T01:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6a14427ebd9cc17ae6a6ee46bec343339b4f41ff" to "09692fa7d2f81ee8b0956af6fd6719bc278a1c8c"



---

archive/issue_comments_432665.json:
```json
{
    "body": "Changing branch from \"u/rlmiller/wells\" to \"u/paulfili/wells\"",
    "created_at": "2017-07-11T02:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432665",
    "user": "https://github.com/pfili"
}
```

Changing branch from "u/rlmiller/wells" to "u/paulfili/wells"



---

archive/issue_comments_432666.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-11T15:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432666",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_432667.json:
```json
{
    "body": "<a id='comment:14'></a>\nAdded requested example and simplified code. \n\n---\nNew commits:\n|                                                                                                                                          |                                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[c525086](https://github.com/sagemath/sagetrac-mirror/commit/c525086e4ef31baafec5acf8aa54f405dfb06798)|`Fixed call to self.clear_denominators() to check that the point is`|",
    "created_at": "2017-07-11T15:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432667",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

<a id='comment:14'></a>
Added requested example and simplified code. 

---
New commits:
|                                                                                                                                          |                                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[c525086](https://github.com/sagemath/sagetrac-mirror/commit/c525086e4ef31baafec5acf8aa54f405dfb06798)|`Fixed call to self.clear_denominators() to check that the point is`|



---

archive/issue_comments_432668.json:
```json
{
    "body": "Changing commit from \"09692fa7d2f81ee8b0956af6fd6719bc278a1c8c\" to \"c525086e4ef31baafec5acf8aa54f405dfb06798\"",
    "created_at": "2017-07-11T15:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432668",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing commit from "09692fa7d2f81ee8b0956af6fd6719bc278a1c8c" to "c525086e4ef31baafec5acf8aa54f405dfb06798"



---

archive/issue_comments_432669.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe functionality works fine in tests and the notebook. However, I have a couple minor suggestions and a part I don't understand why it works.\n\n- add citation to projective morphism canonical_height\n\n- shouldn't this part go under ALGORITHM?\n\n```\nIf function is defined over ``QQ`` uses Wells Algorithm, which allows us to\n        not have to factor the resultant.\n```\n\n- Does this line really need .abs()?\n\n```\n1154: H = H + R(g).abs().log()/(d**(n+1))\n```\n\n- line 1145 Res.abs() is better than abs(Res)\n\n\n- Note sure if it is better, but couldn't you do\n\n```\nN = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d))\n```\n\n\n- lines 1157-8: you really seem to be computing\n\n```\nh = self.green_function(F, 0 , **kwds) - H + R(t).log()\n```\nI'm also slightly confused by why this is right. Doesn't Wells' paper (proposition 2.3) have\n\n```\nh = self.global_height() - self.green_function(F,0) - H\n```\nI assume that R(t).log() is the correction for the function coordinate normalization.",
    "created_at": "2017-07-13T14:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432669",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:15'></a>
The functionality works fine in tests and the notebook. However, I have a couple minor suggestions and a part I don't understand why it works.

- add citation to projective morphism canonical_height

- shouldn't this part go under ALGORITHM?

```
If function is defined over ``QQ`` uses Wells Algorithm, which allows us to
        not have to factor the resultant.
```

- Does this line really need .abs()?

```
1154: H = H + R(g).abs().log()/(d**(n+1))
```

- line 1145 Res.abs() is better than abs(Res)


- Note sure if it is better, but couldn't you do

```
N = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d))
```


- lines 1157-8: you really seem to be computing

```
h = self.green_function(F, 0 , **kwds) - H + R(t).log()
```
I'm also slightly confused by why this is right. Doesn't Wells' paper (proposition 2.3) have

```
h = self.global_height() - self.green_function(F,0) - H
```
I assume that R(t).log() is the correction for the function coordinate normalization.



---

archive/issue_comments_432670.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-13T14:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432670",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_432671.json:
```json
{
    "body": "Changing branch from \"u/paulfili/wells\" to \"u/rlmiller/wells\"",
    "created_at": "2017-07-13T17:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432671",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing branch from "u/paulfili/wells" to "u/rlmiller/wells"



---

archive/issue_comments_432672.json:
```json
{
    "body": "Changing commit from \"c525086e4ef31baafec5acf8aa54f405dfb06798\" to \"06a23c175d9588304b11838b8358580209bf315e\"",
    "created_at": "2017-07-13T17:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432672",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing commit from "c525086e4ef31baafec5acf8aa54f405dfb06798" to "06a23c175d9588304b11838b8358580209bf315e"



---

archive/issue_comments_432673.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe reason our formula looks a bit different is due to the difference between what Wells calls H_infty and what greens function actually returns for the infinite place. \n\nLeft * N = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d)) as is because that way it will look more like Well's Algorithm.\n\n---\nNew commits:\n|                                                                                                                                          |                                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|\n|[06a23c1](https://github.com/sagemath/sagetrac-mirror/commit/06a23c175d9588304b11838b8358580209bf315e)|`23334 Made updates to code, added reference. Left most as is`|",
    "created_at": "2017-07-13T17:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432673",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

<a id='comment:17'></a>
The reason our formula looks a bit different is due to the difference between what Wells calls H_infty and what greens function actually returns for the infinite place. 

Left * N = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d)) as is because that way it will look more like Well's Algorithm.

---
New commits:
|                                                                                                                                          |                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------|
|[06a23c1](https://github.com/sagemath/sagetrac-mirror/commit/06a23c175d9588304b11838b8358580209bf315e)|`23334 Made updates to code, added reference. Left most as is`|



---

archive/issue_comments_432674.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-13T17:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432674",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_432675.json:
```json
{
    "body": "<a id='comment:18'></a>\nYou should still condense those two lines down to one (1157-8) and perhaps you should add a comment about the difference in notation.",
    "created_at": "2017-07-13T18:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432675",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:18'></a>
You should still condense those two lines down to one (1157-8) and perhaps you should add a comment about the difference in notation.



---

archive/issue_comments_432676.json:
```json
{
    "body": "Changing commit from \"06a23c175d9588304b11838b8358580209bf315e\" to \"402a9067eebfcc120c73574f553d3fae38ed787c\"",
    "created_at": "2017-07-14T00:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "06a23c175d9588304b11838b8358580209bf315e" to "402a9067eebfcc120c73574f553d3fae38ed787c"



---

archive/issue_comments_432677.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[402a906](https://github.com/sagemath/sagetrac-mirror/commit/402a9067eebfcc120c73574f553d3fae38ed787c)|`23334 condensed code and added description`|",
    "created_at": "2017-07-14T00:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[402a906](https://github.com/sagemath/sagetrac-mirror/commit/402a9067eebfcc120c73574f553d3fae38ed787c)|`23334 condensed code and added description`|



---

archive/issue_comments_432678.json:
```json
{
    "body": "<a id='comment:20'></a>\ndoc still does not build :\n\n```\nsage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:79: WARNING: Literal block expected; none found.\n```\nprobably because of the RSA768 line\n\nNote that in the same function, you should not indent the content of the ALGORITHM section.\n\n**EDIT**:\n\nSomething else: in the reference file, the link to arxiv should be written\n\n```\n:arxiv:`1602.04920v1`\n```",
    "created_at": "2017-07-17T08:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432678",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
doc still does not build :

```
sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:79: WARNING: Literal block expected; none found.
```
probably because of the RSA768 line

Note that in the same function, you should not indent the content of the ALGORITHM section.

**EDIT**:

Something else: in the reference file, the link to arxiv should be written

```
:arxiv:`1602.04920v1`
```



---

archive/issue_comments_432679.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-17T08:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432679",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_432680.json:
```json
{
    "body": "<a id='comment:21'></a>\nalso when you combined 1157,1158 you left in the redundant term (you are both adding and subtracting this term)\n\n```\nR(self[1].abs()).log()\n```",
    "created_at": "2017-07-17T12:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432680",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:21'></a>
also when you combined 1157,1158 you left in the redundant term (you are both adding and subtracting this term)

```
R(self[1].abs()).log()
```



---

archive/issue_comments_432681.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[684b599](https://github.com/sagemath/sagetrac-mirror/commit/684b5991ad9cfa92340584b258a67c2b39df821c)|`23334 fixed documentaion`|",
    "created_at": "2017-07-20T16:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[684b599](https://github.com/sagemath/sagetrac-mirror/commit/684b5991ad9cfa92340584b258a67c2b39df821c)|`23334 fixed documentaion`|



---

archive/issue_comments_432682.json:
```json
{
    "body": "Changing commit from \"402a9067eebfcc120c73574f553d3fae38ed787c\" to \"684b5991ad9cfa92340584b258a67c2b39df821c\"",
    "created_at": "2017-07-20T16:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "402a9067eebfcc120c73574f553d3fae38ed787c" to "684b5991ad9cfa92340584b258a67c2b39df821c"



---

archive/issue_comments_432683.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-20T16:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432683",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_432684.json:
```json
{
    "body": "<a id='comment:24'></a>\nSeveral typos here:\n\n```\nLooks diffrent than Well's Algorithm because of the diffrence\n...\nfor the infite place\n```\n\nAlso `range(0, N)` should be `range(N)`\n\nThis\n\n```\n+            h = self.green_function(F, 0 , **kwds) - H + R(t).log()\n+            return h\n```\ncan be made in one line (no need to store h)",
    "created_at": "2017-07-21T07:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432684",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>
Several typos here:

```
Looks diffrent than Well's Algorithm because of the diffrence
...
for the infite place
```

Also `range(0, N)` should be `range(N)`

This

```
+            h = self.green_function(F, 0 , **kwds) - H + R(t).log()
+            return h
```
can be made in one line (no need to store h)



---

archive/issue_comments_432685.json:
```json
{
    "body": "Changing commit from \"684b5991ad9cfa92340584b258a67c2b39df821c\" to \"695b96dd4605eb4505d8160beef234c3e9d3a4d2\"",
    "created_at": "2017-07-21T15:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "684b5991ad9cfa92340584b258a67c2b39df821c" to "695b96dd4605eb4505d8160beef234c3e9d3a4d2"



---

archive/issue_comments_432686.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[695b96d](https://github.com/sagemath/sagetrac-mirror/commit/695b96dd4605eb4505d8160beef234c3e9d3a4d2)|`23334 fixed typos and cleaned up code`|",
    "created_at": "2017-07-21T15:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[695b96d](https://github.com/sagemath/sagetrac-mirror/commit/695b96dd4605eb4505d8160beef234c3e9d3a4d2)|`23334 fixed typos and cleaned up code`|



---

archive/issue_comments_432687.json:
```json
{
    "body": "<a id='comment:26'></a>\ndocs build and all tests pass. I this is ready.",
    "created_at": "2017-07-21T17:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432687",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:26'></a>
docs build and all tests pass. I this is ready.



---

archive/issue_comments_432688.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-21T17:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432688",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_076138.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "label": "component: algebraic geometry",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76138"
}
```



---

archive/issue_comments_432689.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-26T20:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432689",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_432690.json:
```json
{
    "body": "<a id='comment:28'></a>\nNeed to make sure all \"Wells'\", are in the correct form. Just quick typo fixes.",
    "created_at": "2017-07-26T20:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432690",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

<a id='comment:28'></a>
Need to make sure all "Wells'", are in the correct form. Just quick typo fixes.



---

archive/issue_comments_432691.json:
```json
{
    "body": "Changing commit from \"695b96dd4605eb4505d8160beef234c3e9d3a4d2\" to \"47c1957d4fb30ceea21c84bed0d5f0e6643b68d8\"",
    "created_at": "2017-07-27T02:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "695b96dd4605eb4505d8160beef234c3e9d3a4d2" to "47c1957d4fb30ceea21c84bed0d5f0e6643b68d8"



---

archive/issue_comments_432692.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[47c1957](https://github.com/sagemath/sagetrac-mirror/commit/47c1957d4fb30ceea21c84bed0d5f0e6643b68d8)|`23334 fixed to Wells'`|",
    "created_at": "2017-07-27T02:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[47c1957](https://github.com/sagemath/sagetrac-mirror/commit/47c1957d4fb30ceea21c84bed0d5f0e6643b68d8)|`23334 fixed to Wells'`|



---

archive/issue_comments_432693.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-27T02:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432693",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_076139.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "rename": {
        "from": "Implementing Well's Algorithm",
        "to": "Implementing Wells' Algorithm"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76139"
}
```



---

archive/issue_comments_432694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.\n+Implementing Wells' Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.\n This algorithm is found in Elliot Wells' Paper  \"Computing the Canonical Height of a Point in Projective Space\"\n``````\n",
    "created_at": "2017-07-27T02:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432694",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-Implementing Well's Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.
+Implementing Wells' Algorithm for GSOC 2017. A faster way to solve for canonical height in QQ and ZZ because you don't need to factor the resultant.
 This algorithm is found in Elliot Wells' Paper  "Computing the Canonical Height of a Point in Projective Space"
``````




---

archive/issue_comments_432695.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-27T11:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432695",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_432696.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-03T22:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432696",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076140.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-03T22:11:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23334#event-76140"
}
```



---

archive/issue_comments_432697.json:
```json
{
    "body": "Changing branch from \"u/rlmiller/wells\" to \"47c1957d4fb30ceea21c84bed0d5f0e6643b68d8\"",
    "created_at": "2017-08-03T22:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23334#issuecomment-432697",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rlmiller/wells" to "47c1957d4fb30ceea21c84bed0d5f0e6643b68d8"
