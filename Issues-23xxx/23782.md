# Issue 23782: fricas output and sage conversion bug

archive/issues_023545.json:
```json
{
    "assignees": [],
    "body": "In 'SageMath version 8.1.beta0, Release Date: 2017-07-29' I have the following behaviour, (at least with FriCAS 1.2.5)\n\n```\ndef elementary(k, j):\n    \"\"\"\n    sage: f = fricas.guessRat([elementary(5,j) for j in range(15)])[0]; f\n    10      9      8      7       6      5       4      3       2\n    3n   - 25n  + 50n  + 62n  - 229n  - 25n  + 320n  - 12n  - 144n\n    ---------------------------------------------------------------\n                                 11520\n\n    sage: print fricas.get(f._name)\n      10      9      8      7       6      5       4      3       2\n    3n   - 25n  + 50n  + 62n  - 229n  - 25n  + 320n  - 12n  - 144n\n    ---------------------------------------------------------------\n                                 11520\n\n    sage: f.sage()\n    NotImplementedError: The translation of the FriCAS Expression \"(3*n^10+-25*n^9+50*n^8+62*n^7+-229*n^6+-25*n^5+320*n^4+-12*n^3+-144*n^2)/11520 to sage is not yet implemented.\n    \"\"\"\n    return stirling_number1(j+1, j+1-k)\n```\nNote the bad indentation in the second line and the weird quotation mark in the third.\n\nFixing #22525 would probably fix this, too.\n\nDepends on #22525\n\nCC:  @simon-king-jena @fchapoton @rwst\n\nKeywords: **FriCAS**\n\nBranch/Commit: **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Martin Rubey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23782_\n\n",
    "closed_at": "2017-10-01T00:19:04Z",
    "created_at": "2017-09-04T19:24:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fricas output and sage conversion bug",
    "type": "issue",
    "updated_at": "2017-10-01T00:19:04Z",
    "url": "https://github.com/sagemath/sage/issues/23782",
    "user": "https://github.com/mantepse"
}
```
In 'SageMath version 8.1.beta0, Release Date: 2017-07-29' I have the following behaviour, (at least with FriCAS 1.2.5)

```
def elementary(k, j):
    """
    sage: f = fricas.guessRat([elementary(5,j) for j in range(15)])[0]; f
    10      9      8      7       6      5       4      3       2
    3n   - 25n  + 50n  + 62n  - 229n  - 25n  + 320n  - 12n  - 144n
    ---------------------------------------------------------------
                                 11520

    sage: print fricas.get(f._name)
      10      9      8      7       6      5       4      3       2
    3n   - 25n  + 50n  + 62n  - 229n  - 25n  + 320n  - 12n  - 144n
    ---------------------------------------------------------------
                                 11520

    sage: f.sage()
    NotImplementedError: The translation of the FriCAS Expression "(3*n^10+-25*n^9+50*n^8+62*n^7+-229*n^6+-25*n^5+320*n^4+-12*n^3+-144*n^2)/11520 to sage is not yet implemented.
    """
    return stirling_number1(j+1, j+1-k)
```
Note the bad indentation in the second line and the weird quotation mark in the third.

Fixing #22525 would probably fix this, too.

Depends on #22525

CC:  @simon-king-jena @fchapoton @rwst

Keywords: **FriCAS**

Branch/Commit: **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**

Reviewer: **Ralf Stephan**

Author: **Martin Rubey**

_Issue created by migration from https://trac.sagemath.org/ticket/23782_





---

archive/issue_events_312450.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-04T19:24:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312450"
}
```



---

archive/issue_events_312451.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-04T19:24:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces%3A%20optional",
    "label_color": "0000ff",
    "label_name": "component: interfaces: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312451"
}
```



---

archive/issue_events_312452.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-04T19:24:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312452"
}
```



---

archive/issue_comments_361387.json:
```json
{
    "body": "Changed keywords from **** to **FriCAS**",
    "created_at": "2017-09-05T06:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361387",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from **** to **FriCAS**



---

archive/issue_comments_361388.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThis seems to work after #21377",
    "created_at": "2017-09-06T11:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361388",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">Comment 2</div>

This seems to work after #21377



---

archive/issue_comments_361389.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nAfter #21377 I still get the bad indentation, but the error is gone.  So I vote to close...\n\nI'll put the remark concerning the bad indentation on #21377.",
    "created_at": "2017-09-06T16:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361389",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">Comment 3</div>

After #21377 I still get the bad indentation, but the error is gone.  So I vote to close...

I'll put the remark concerning the bad indentation on #21377.



---

archive/issue_comments_361390.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI just realised that I had a sage 7.5.beta3 lying around:\n\nthe display bug was introduced **after** 7.5.beta3 - the bug with the quotation mark existed **already** in 7.5.beta3!",
    "created_at": "2017-09-12T06:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361390",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:4" align="right">Comment 4</div>

I just realised that I had a sage 7.5.beta3 lying around:

the display bug was introduced **after** 7.5.beta3 - the bug with the quotation mark existed **already** in 7.5.beta3!



---

archive/issue_events_312453.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T06:16:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312453"
}
```



---

archive/issue_comments_361391.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nMoreover, there is no change in the code of `fricas.py` between sage 7.5.beta3 and 8.0.beta12, which is the first version I have on my computer where the bug appears.\n\nI have no idea what could have changed - I'm afraid I need to bisect.",
    "created_at": "2017-09-12T06:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361391",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:5" align="right">Comment 5</div>

Moreover, there is no change in the code of `fricas.py` between sage 7.5.beta3 and 8.0.beta12, which is the first version I have on my computer where the bug appears.

I have no idea what could have changed - I'm afraid I need to bisect.



---

archive/issue_comments_361392.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\n\n```\nsage:  fricas('(1 + sqrt(2))^5')\n\n+-+\n29\\|2  + 41\nsage: a= fricas('(1 + sqrt(2))^5')\nsage: print a\n+-+\n29\\|2  + 41\nsage: print fricas.get(a._name)\n   +-+\n29\\|2  + 41\nsage: repr(a)\n'+-+\\r\\n29\\\\|2  + 41'\nsage: fricas.get(a._name)\n'   +-+\\r\\n29\\\\|2  + 41'\n```",
    "created_at": "2017-09-12T06:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361392",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:6" align="right">Comment 6</div>


```
sage:  fricas('(1 + sqrt(2))^5')

+-+
29\|2  + 41
sage: a= fricas('(1 + sqrt(2))^5')
sage: print a
+-+
29\|2  + 41
sage: print fricas.get(a._name)
   +-+
29\|2  + 41
sage: repr(a)
'+-+\r\n29\\|2  + 41'
sage: fricas.get(a._name)
'   +-+\r\n29\\|2  + 41'
```



---

archive/issue_comments_361393.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nOK, I found it:\n\n```\ncommit 5082c96e79a15b34779a0c9b0b43d652cdade31c\nAuthor: Simon King <simon.king@uni-jena.de>\nDate:   Tue Mar 14 14:53:36 2017 +0100\n\n    Use single underscore _repr_ in interfaces, add more documentation concerning eval and get\n```\nintroduced this change in #22501:\n\n```\n+    def _repr_(self):\n+        \"\"\"\n+        Default implementation of a helper method for string representation.\n...\n+        \"\"\"\n+        P = self.parent()\n+        try:\n+            if self._get_using_file:\n+                return P.get_using_file(self._name).strip()\n+        except AttributeError:\n+            return self.parent().get(self._name).strip()\n```\n\nI think the strip should go away.  The other solution is to override it in `fricas.py`, but I really cannot think of a situation where we really want the `strip`.  Output will often be ascii-art in interfaces, and this is a default implementation.",
    "created_at": "2017-09-12T06:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361393",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">Comment 7</div>

OK, I found it:

```
commit 5082c96e79a15b34779a0c9b0b43d652cdade31c
Author: Simon King <simon.king@uni-jena.de>
Date:   Tue Mar 14 14:53:36 2017 +0100

    Use single underscore _repr_ in interfaces, add more documentation concerning eval and get
```
introduced this change in #22501:

```
+    def _repr_(self):
+        """
+        Default implementation of a helper method for string representation.
...
+        """
+        P = self.parent()
+        try:
+            if self._get_using_file:
+                return P.get_using_file(self._name).strip()
+        except AttributeError:
+            return self.parent().get(self._name).strip()
```

I think the strip should go away.  The other solution is to override it in `fricas.py`, but I really cannot think of a situation where we really want the `strip`.  Output will often be ascii-art in interfaces, and this is a default implementation.



---

archive/issue_comments_361394.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI want to add that I commented on #22501 that fricas tests would be passing.  This means that I made a mistake then, so the blame is on me.",
    "created_at": "2017-09-12T06:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361394",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:8" align="right">Comment 8</div>

I want to add that I commented on #22501 that fricas tests would be passing.  This means that I made a mistake then, so the blame is on me.



---

archive/issue_comments_361395.json:
```json
{
    "body": "Branch: **[u/mantepse/fricas_output_and_sage_conversion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/fricas_output_and_sage_conversion_bug)**",
    "created_at": "2017-09-12T08:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361395",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/fricas_output_and_sage_conversion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/fricas_output_and_sage_conversion_bug)**



---

archive/issue_comments_361396.json:
```json
{
    "body": "Commit: **[20f1d4b](https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61)**",
    "created_at": "2017-09-12T08:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361396",
    "user": "https://github.com/mantepse"
}
```

Commit: **[20f1d4b](https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61)**



---

archive/issue_comments_361397.json:
```json
{
    "body": "Author: **Martin Rubey**",
    "created_at": "2017-09-12T08:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361397",
    "user": "https://github.com/mantepse"
}
```

Author: **Martin Rubey**



---

archive/issue_comments_361398.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61\">20f1d4b</a></td><td><code>do not strip output in default InterfaceElement._repr_</code></td></tr></table>\n",
    "created_at": "2017-09-12T08:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361398",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:10" align="right">Comment 10</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61">20f1d4b</a></td><td><code>do not strip output in default InterfaceElement._repr_</code></td></tr></table>




---

archive/issue_events_312454.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T08:22:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312454"
}
```



---

archive/issue_comments_361399.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nI would suggest to use rstrip instead of strip.",
    "created_at": "2017-09-12T08:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361399",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">Comment 11</div>

I would suggest to use rstrip instead of strip.



---

archive/issue_comments_361400.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7\">5e72d43</a></td><td><code>add a test for the weird quotation mark issue</code></td></tr></table>\n",
    "created_at": "2017-09-12T08:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361400",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12" align="right">Comment 12</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7">5e72d43</a></td><td><code>add a test for the weird quotation mark issue</code></td></tr></table>




---

archive/issue_comments_361401.json:
```json
{
    "body": "Changed commit from **[20f1d4b](https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61)** to **[5e72d43](https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7)**",
    "created_at": "2017-09-12T08:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361401",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[20f1d4b](https://github.com/sagemath/sagetrac-mirror/commit/20f1d4b42bfc840406e0db132a8970dbf561ff61)** to **[5e72d43](https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7)**



---

archive/issue_comments_361402.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@fchapoton](#comment%3A11):\n> I would suggest to use rstrip instead of strip.\n\nI agree that this is a sensible possibility, but I'm not completely sure.\n\nCan you think of any surprising results with rstrip?",
    "created_at": "2017-09-12T08:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361402",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@fchapoton](#comment%3A11):
> I would suggest to use rstrip instead of strip.

I agree that this is a sensible possibility, but I'm not completely sure.

Can you think of any surprising results with rstrip?



---

archive/issue_comments_361403.json:
```json
{
    "body": "Changed commit from **[5e72d43](https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7)** to **[4520a6e](https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c)**",
    "created_at": "2017-09-12T09:37:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361403",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5e72d43](https://github.com/sagemath/sagetrac-mirror/commit/5e72d438cbce766972d66af7516b851c82a62ca7)** to **[4520a6e](https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c)**



---

archive/issue_comments_361404.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c\">4520a6e</a></td><td><code>use rstrip in `_repr_` (instead of original strip and instead of nothing), adapt tests</code></td></tr></table>\n",
    "created_at": "2017-09-12T09:37:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361404",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14" align="right">Comment 14</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c">4520a6e</a></td><td><code>use rstrip in `_repr_` (instead of original strip and instead of nothing), adapt tests</code></td></tr></table>




---

archive/issue_comments_361405.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI tested fricas, lie and gap3.  Unfortunately, gap3 is failing, but I do not know yet whether the failures are related to this ticket.",
    "created_at": "2017-09-12T09:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361405",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:15" align="right">Comment 15</div>

I tested fricas, lie and gap3.  Unfortunately, gap3 is failing, but I do not know yet whether the failures are related to this ticket.



---

archive/issue_comments_361406.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI get the same failures in all other versions of sage I have lying around...  So I think that this is really ready to go.  Please review!",
    "created_at": "2017-09-12T09:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361406",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:16" align="right">Comment 16</div>

I get the same failures in all other versions of sage I have lying around...  So I think that this is really ready to go.  Please review!



---

archive/issue_comments_361407.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\n`Check that #23782 is fixed:`\n\nshould be\n\n<code>Check that :trac:\\`23782\\` is fixed::</code>",
    "created_at": "2017-09-12T09:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361407",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">Comment 17</div>

`Check that #23782 is fixed:`

should be

<code>Check that :trac:\`23782\` is fixed::</code>



---

archive/issue_comments_361408.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nnote also that \"atan\" will be converted to \"arctan\" after #22525",
    "created_at": "2017-09-12T10:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361408",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">Comment 18</div>

note also that "atan" will be converted to "arctan" after #22525



---

archive/issue_comments_361409.json:
```json
{
    "body": "Changed commit from **[4520a6e](https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c)** to **[b0ab79f](https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0)**",
    "created_at": "2017-09-12T10:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361409",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4520a6e](https://github.com/sagemath/sagetrac-mirror/commit/4520a6e734c35ce816bfcc0e7e8b6c5b0b3f6c7c)** to **[b0ab79f](https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0)**



---

archive/issue_comments_361410.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0\">b0ab79f</a></td><td><code>fix reference to trac</code></td></tr></table>\n",
    "created_at": "2017-09-12T10:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361410",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19" align="right">Comment 19</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0">b0ab79f</a></td><td><code>fix reference to trac</code></td></tr></table>




---

archive/issue_comments_361411.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nReplying to [@fchapoton](#comment%3A18):\n> note also that \"atan\" will be converted to \"arctan\" after #22525\n\nyes, I just looked at it, and have a branch that only adds some testcases - I would set it to positive review there and make this one a dependency.  Or would you prefer it the other way round?",
    "created_at": "2017-09-12T10:14:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361411",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:20" align="right">Comment 20</div>

Replying to [@fchapoton](#comment%3A18):
> note also that "atan" will be converted to "arctan" after #22525

yes, I just looked at it, and have a branch that only adds some testcases - I would set it to positive review there and make this one a dependency.  Or would you prefer it the other way round?



---

archive/issue_comments_361412.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nThe branch here is slightly more problematic, because you change the behaviour of all the interfaces and this needs serious checking. The other one should be easier and go first, imho.",
    "created_at": "2017-09-12T10:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361412",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">Comment 21</div>

The branch here is slightly more problematic, because you change the behaviour of all the interfaces and this needs serious checking. The other one should be easier and go first, imho.



---

archive/issue_comments_361413.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI agree.  So let's do the other one first.  I have problems with checking out right now, though.",
    "created_at": "2017-09-12T10:19:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361413",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:22" align="right">Comment 22</div>

I agree.  So let's do the other one first.  I have problems with checking out right now, though.



---

archive/issue_comments_361414.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nI'll undo the modified line in integral.py after recompiling.",
    "created_at": "2017-09-12T10:34:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361414",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:23" align="right">Comment 23</div>

I'll undo the modified line in integral.py after recompiling.



---

archive/issue_comments_361415.json:
```json
{
    "body": "Dependencies: **#22525**",
    "created_at": "2017-09-12T10:34:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361415",
    "user": "https://github.com/mantepse"
}
```

Dependencies: **#22525**



---

archive/issue_comments_361416.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e\">c4a44f6</a></td><td><code>undo edit of test output - this is fixed by #22525 anyway</code></td></tr></table>\n",
    "created_at": "2017-09-12T11:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361416",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24" align="right">Comment 24</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e">c4a44f6</a></td><td><code>undo edit of test output - this is fixed by #22525 anyway</code></td></tr></table>




---

archive/issue_comments_361417.json:
```json
{
    "body": "Changed commit from **[b0ab79f](https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0)** to **[c4a44f6](https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e)**",
    "created_at": "2017-09-12T11:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361417",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b0ab79f](https://github.com/sagemath/sagetrac-mirror/commit/b0ab79f9b3da0cd5862a9438e6f0d34b7947c4d0)** to **[c4a44f6](https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e)**



---

archive/issue_comments_361418.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nI think this is ready now.",
    "created_at": "2017-09-12T11:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361418",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:25" align="right">Comment 25</div>

I think this is ready now.



---

archive/issue_comments_361419.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nThere will be a merge conflict - I guess it's easiest to fix it when #22525 is merged.",
    "created_at": "2017-09-12T11:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361419",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:26" align="right">Comment 26</div>

There will be a merge conflict - I guess it's easiest to fix it when #22525 is merged.



---

archive/issue_comments_361420.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3\">2521f3a</a></td><td><code>Merge branch 'develop' into t/23782/fricas_output_and_sage_conversion_bug</code></td></tr></table>\n",
    "created_at": "2017-09-22T06:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361420",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27" align="right">Comment 27</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3">2521f3a</a></td><td><code>Merge branch 'develop' into t/23782/fricas_output_and_sage_conversion_bug</code></td></tr></table>




---

archive/issue_comments_361421.json:
```json
{
    "body": "Changed commit from **[c4a44f6](https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e)** to **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**",
    "created_at": "2017-09-22T06:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361421",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c4a44f6](https://github.com/sagemath/sagetrac-mirror/commit/c4a44f633790effdff1d4123e8a7a7c3155e9c9e)** to **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**



---

archive/issue_comments_361422.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nping?",
    "created_at": "2017-09-26T07:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361422",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:29" align="right">Comment 29</div>

ping?



---

archive/issue_events_312455.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T07:39:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312455"
}
```



---

archive/issue_events_312456.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T07:39:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312456"
}
```



---

archive/issue_comments_361423.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nUsing --optional=fricas I get\n\n`sage -t --warn-long 40.1 src/sage/interfaces/fricas.py  # 3 doctests failed`",
    "created_at": "2017-09-26T07:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361423",
    "user": "https://github.com/rwst"
}
```

<div id="comment:30" align="right">Comment 30</div>

Using --optional=fricas I get

`sage -t --warn-long 40.1 src/sage/interfaces/fricas.py  # 3 doctests failed`



---

archive/issue_comments_361424.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2017-09-26T07:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361424",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_361425.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nI was told to use\n`sage -t --optional fricas,sage src/sage/interfaces/fricas.py`",
    "created_at": "2017-09-26T08:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361425",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:31" align="right">Comment 31</div>

I was told to use
`sage -t --optional fricas,sage src/sage/interfaces/fricas.py`



---

archive/issue_events_312457.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-26T08:30:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312457"
}
```



---

archive/issue_events_312458.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-26T08:30:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312458"
}
```



---

archive/issue_events_312459.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T13:09:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312459"
}
```



---

archive/issue_events_312460.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T13:09:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312460"
}
```



---

archive/issue_comments_361426.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nAlright, interesting, thanks. It passes now and looks good.",
    "created_at": "2017-09-26T13:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361426",
    "user": "https://github.com/rwst"
}
```

<div id="comment:33" align="right">Comment 33</div>

Alright, interesting, thanks. It passes now and looks good.



---

archive/issue_comments_361427.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nThank you!",
    "created_at": "2017-09-26T13:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361427",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:34" align="right">Comment 34</div>

Thank you!



---

archive/issue_comments_361428.json:
```json
{
    "body": "Changed branch from **[u/mantepse/fricas_output_and_sage_conversion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/fricas_output_and_sage_conversion_bug)** to **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**",
    "created_at": "2017-10-01T00:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23782#issuecomment-361428",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mantepse/fricas_output_and_sage_conversion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/fricas_output_and_sage_conversion_bug)** to **[2521f3a](https://github.com/sagemath/sagetrac-mirror/commit/2521f3a9556ea763d418df9e04b36e84b6137cb3)**



---

archive/issue_events_312461.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-01T00:19:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312461"
}
```



---

archive/issue_events_312462.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "64dcac954b631c343d30865e98a9dd4e598b511e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-01T00:19:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23782",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23782#event-312462"
}
```
