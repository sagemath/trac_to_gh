# Issue 23281: Change to balanced representatives for p-adics

archive/issues_023044.json:
```json
{
    "body": "We currently use representatives between 0 and p^n-1 where is the precision (either absolute or relative depending on context).   The issue below for floating point p-adics suggests that it would be better to use balanced representatives, between -p^n/2 and p^n/2.\n\nCurrently, we have:\n\n```\nsage: R = ZpFP(2)   # prec = 20\nsage: R(1+2^19) + R(1+2^19)\n2\n```\n\nIf we switch to balanced representatives, `1+2^19` is no longer a representative at precision 20; it is instead represented by 1-2^19.  The sum would be `2-2^20`.  \n\nOnce we make the switch to balanced representatives, we should first perform the addition and then round the result according to its valuation.  Negation becomes trivial.\n\nThis isn't a high priority, but would be nice.\n\n\nCC:  @roed314 @saraedum\n\nKeywords: padicIMA\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/23281\n\n",
    "created_at": "2017-06-19T21:30:09Z",
    "labels": [
        "component: padics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Change to balanced representatives for p-adics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23281",
    "user": "https://github.com/xcaruso"
}
```
We currently use representatives between 0 and p^n-1 where is the precision (either absolute or relative depending on context).   The issue below for floating point p-adics suggests that it would be better to use balanced representatives, between -p^n/2 and p^n/2.

Currently, we have:

```
sage: R = ZpFP(2)   # prec = 20
sage: R(1+2^19) + R(1+2^19)
2
```

If we switch to balanced representatives, `1+2^19` is no longer a representative at precision 20; it is instead represented by 1-2^19.  The sum would be `2-2^20`.  

Once we make the switch to balanced representatives, we should first perform the addition and then round the result according to its valuation.  Negation becomes trivial.

This isn't a high priority, but would be nice.


CC:  @roed314 @saraedum

Keywords: padicIMA

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/23281





---

archive/issue_comments_343115.json:
```json
{
    "body": "Changing keywords from \"\" to \"padicIMA\".",
    "created_at": "2018-07-22T20:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-343115",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "padicIMA".



---

archive/issue_comments_343116.json:
```json
{
    "body": "<a id='comment:2'></a>I finally have an objection :-)\n\nIf we do this, then the opposite of `x = 1` would be `y = 2^20 - 1` and `x+y` would be equal to `2^20`, meaning that we would break the axiom `x + (-x) = 0`. The correct way to handle this is to choose balanced representatives but it's a lot of work...",
    "created_at": "2018-07-27T00:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-343116",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:2'></a>I finally have an objection :-)

If we do this, then the opposite of `x = 1` would be `y = 2^20 - 1` and `x+y` would be equal to `2^20`, meaning that we would break the axiom `x + (-x) = 0`. The correct way to handle this is to choose balanced representatives but it's a lot of work...



---

archive/issue_comments_343117.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2019-09-07T13:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-343117",
    "user": "https://github.com/roed314"
}
```

Changing priority from major to minor.



---

archive/issue_comments_343118.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+We currently use representatives between 0 and p^n-1 where is the precision (either absolute or relative depending on context).   The issue below for floating point p-adics suggests that it would be better to use balanced representatives, between -p^n/2 and p^n/2.\n+\n Currently, we have:\n \n ```\n@@ -6,9 +8,12 @@\n 2\n ```\n \n-I think that the answer should rather be `2 + 2^20`, i.e. we should first perform the addition and then round the result according to its valuation. Any objection?\n+If we switch to balanced representatives, `1+2^19` is no longer a representative at precision 20; it is instead represented by 1-2^19.  The sum would be `2-2^20`.  \n \n-By the way, I believe that it does not really make sense to define the methods `precision_absolute` and `precision_relative` for a p-adic float because p-adic floats have to be considered as exact p-adics (what are non-exact are the operations on them).\n+Once we make the switch to balanced representatives, we should first perform the addition and then round the result according to its valuation.  Negation becomes trivial.\n+\n+This isn't a high priority, but would be nice.\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2019-09-07T13:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-343118",
    "user": "https://github.com/roed314"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,5 @@
+We currently use representatives between 0 and p^n-1 where is the precision (either absolute or relative depending on context).   The issue below for floating point p-adics suggests that it would be better to use balanced representatives, between -p^n/2 and p^n/2.
+
 Currently, we have:
 
 ```
@@ -6,9 +8,12 @@
 2
 ```
 
-I think that the answer should rather be `2 + 2^20`, i.e. we should first perform the addition and then round the result according to its valuation. Any objection?
+If we switch to balanced representatives, `1+2^19` is no longer a representative at precision 20; it is instead represented by 1-2^19.  The sum would be `2-2^20`.  
 
-By the way, I believe that it does not really make sense to define the methods `precision_absolute` and `precision_relative` for a p-adic float because p-adic floats have to be considered as exact p-adics (what are non-exact are the operations on them).
+Once we make the switch to balanced representatives, we should first perform the addition and then round the result according to its valuation.  Negation becomes trivial.
+
+This isn't a high priority, but would be nice.
+
 
 Comment: 1
 
```

