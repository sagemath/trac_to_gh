# Issue 23406: implement Grossman-Larson Hopf algebras of rooted forests

archive/issues_023169.json:
```json
{
    "body": "as an interesting and useful combinatorial Hopf algebra\n\nCC:  @tscrim @darijgr\n\nBranch/Commit: fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5\n\nReviewer: Darij Grinberg, Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23406\n\n",
    "closed_at": "2017-09-18T22:15:34Z",
    "created_at": "2017-07-12T09:37:57Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "implement Grossman-Larson Hopf algebras of rooted forests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23406",
    "user": "https://github.com/fchapoton"
}
```
as an interesting and useful combinatorial Hopf algebra

CC:  @tscrim @darijgr

Branch/Commit: fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5

Reviewer: Darij Grinberg, Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23406





---

archive/issue_comments_439901.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-12T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439901",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439902.json:
```json
{
    "body": "Changing commit from \"\" to \"94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e\"",
    "created_at": "2017-07-12T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439902",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e"



---

archive/issue_comments_439903.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-07-12T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439903",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_439904.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/23406\"",
    "created_at": "2017-07-12T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439904",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/23406"



---

archive/issue_comments_439905.json:
```json
{
    "body": "Changing commit from \"94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e\" to \"1ce921497ee441e3eac581eda8f28f90891334dc\"",
    "created_at": "2017-07-12T09:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e" to "1ce921497ee441e3eac581eda8f28f90891334dc"



---

archive/issue_comments_439906.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-12T09:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439907.json:
```json
{
    "body": "<a id='comment:3'></a>You have defined the `single_graft` method on class `RootedTree`, which is a class for *unordered* rooted trees. But the method clearly requires an ordering for the subtrees (which I hope mean children -- maybe this is the better word?) of `x`. Now, this may be a non-issue since you aren't saying that `t` should be of class `RootedTree`; but then I'm not sure which class it should be of. Could you clarify, or move this to a more concrete class? Thanks!",
    "created_at": "2017-07-12T14:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439907",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:3'></a>You have defined the `single_graft` method on class `RootedTree`, which is a class for *unordered* rooted trees. But the method clearly requires an ordering for the subtrees (which I hope mean children -- maybe this is the better word?) of `x`. Now, this may be a non-issue since you aren't saying that `t` should be of class `RootedTree`; but then I'm not sure which class it should be of. Could you clarify, or move this to a more concrete class? Thanks!



---

archive/issue_comments_439908.json:
```json
{
    "body": "<a id='comment:4'></a>Hello Darij, thanks for having a look.\n\nThe `single_graft` implementation uses an ordering of the subtrees (by which I mean the elements of list(t)), but the result (as a `RootedTree`) does not depend on it.\n\nIndeed, if I remember correctly, there is a planar version of the Grossman-Larson Hopf algebra, for which a planar version of `single_graft` would be used. But this is not the aim of this ticket. But maybe one want to think a bit more and implement directly the correct planar version.",
    "created_at": "2017-07-12T14:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439908",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>Hello Darij, thanks for having a look.

The `single_graft` implementation uses an ordering of the subtrees (by which I mean the elements of list(t)), but the result (as a `RootedTree`) does not depend on it.

Indeed, if I remember correctly, there is a planar version of the Grossman-Larson Hopf algebra, for which a planar version of `single_graft` would be used. But this is not the aim of this ticket. But maybe one want to think a bit more and implement directly the correct planar version.



---

archive/issue_comments_439909.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Fr\u00e9d\u00e9ric!\n\nOh, I see. The children have a fixed order, probably by `sort_key` (not sure how exactly this works).\n\nI've got a question: Is the behavior below acceptable for basis indices of a combinatorial free module?\n\n```\nsage: RT4 = RootedTrees(4)\nsage: t1 = RT4([[],[[]]])\nsage: t1\n[[], [[]]]\nsage: t2 = RT4([[[]],[]])\nsage: t2\n[[], [[]]]\nsage: t1 == t2\nTrue\nsage: t1 is t2\nFalse\nsage: LRT4 = LabelledRootedTrees(4)\nsage: t1 = LRT4(t1)\nsage: t2 = LRT4(t2)\nsage: t1 == t2\nTrue\nsage: t1 is t2\nFalse\nsage:\n```",
    "created_at": "2017-07-12T14:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439909",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:5'></a>Hi Frédéric!

Oh, I see. The children have a fixed order, probably by `sort_key` (not sure how exactly this works).

I've got a question: Is the behavior below acceptable for basis indices of a combinatorial free module?

```
sage: RT4 = RootedTrees(4)
sage: t1 = RT4([[],[[]]])
sage: t1
[[], [[]]]
sage: t2 = RT4([[[]],[]])
sage: t2
[[], [[]]]
sage: t1 == t2
True
sage: t1 is t2
False
sage: LRT4 = LabelledRootedTrees(4)
sage: t1 = LRT4(t1)
sage: t2 = LRT4(t2)
sage: t1 == t2
True
sage: t1 is t2
False
sage:
```



---

archive/issue_comments_439910.json:
```json
{
    "body": "<a id='comment:6'></a>`@`darij That behavior has always been supported in CFM (assuming `hash(a) == hash(b)`, which should happen by Python's specs):\n\n```\nsage: C = CombinatorialFreeModule(ZZ, QQ)\nsage: B = C.basis()\nsage: 1/2 is 1/2\nFalse\nsage: B[1/2] == B[1/2]\nTrue\nsage: B[1/2] is B[1/2]\nFalse\n```",
    "created_at": "2017-07-12T14:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439910",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>`@`darij That behavior has always been supported in CFM (assuming `hash(a) == hash(b)`, which should happen by Python's specs):

```
sage: C = CombinatorialFreeModule(ZZ, QQ)
sage: B = C.basis()
sage: 1/2 is 1/2
False
sage: B[1/2] == B[1/2]
True
sage: B[1/2] is B[1/2]
False
```



---

archive/issue_comments_439911.json:
```json
{
    "body": "<a id='comment:7'></a>By the way, there is an important morphism of Hopf algebras from NCSF to the one here (for one variable) that maps the generator Psi_n of NCSF to the linear tree on n vertices (n+1 if counting the root). Would it be easy to implement that, either in this ticket or after ?",
    "created_at": "2017-07-12T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439911",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>By the way, there is an important morphism of Hopf algebras from NCSF to the one here (for one variable) that maps the generator Psi_n of NCSF to the linear tree on n vertices (n+1 if counting the root). Would it be easy to implement that, either in this ticket or after ?



---

archive/issue_comments_439912.json:
```json
{
    "body": "<a id='comment:8'></a>Yes, this should be easy -- just define it by first converting to the Psi-basis.\n\nThat is, as long as the base ring has the rational numbers in it. I assume the morphism doesn't exist otherwise?",
    "created_at": "2017-07-12T15:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439912",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>Yes, this should be easy -- just define it by first converting to the Psi-basis.

That is, as long as the base ring has the rational numbers in it. I assume the morphism doesn't exist otherwise?



---

archive/issue_comments_439913.json:
```json
{
    "body": "<a id='comment:9'></a>`@`Travis: Wow; I never realized that Sage rationals aren't uniquerepresentation! Great to hear this works.",
    "created_at": "2017-07-12T15:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439913",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:9'></a>`@`Travis: Wow; I never realized that Sage rationals aren't uniquerepresentation! Great to hear this works.



---

archive/issue_comments_439914.json:
```json
{
    "body": "<a id='comment:10'></a>I would probably do it in this ticket by implementing a `_coerce_map_from_` to return a `self.module_morphism` with the correct construction data.",
    "created_at": "2017-07-12T15:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439914",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>I would probably do it in this ticket by implementing a `_coerce_map_from_` to return a `self.module_morphism` with the correct construction data.



---

archive/issue_comments_439915.json:
```json
{
    "body": "<a id='comment:11'></a>I would prefer not to make it a coercion. The thicket is already too dense around NSym, and this would be a coercion defined in dependence on the base ring, which too complicates thing. Plus, are we sure this is the most natural map NCSF -> GrossLars?",
    "created_at": "2017-07-12T15:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439915",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'></a>I would prefer not to make it a coercion. The thicket is already too dense around NSym, and this would be a coercion defined in dependence on the base ring, which too complicates thing. Plus, are we sure this is the most natural map NCSF -> GrossLars?



---

archive/issue_comments_439916.json:
```json
{
    "body": "<a id='comment:12'></a>That is what `_coerce_map_from_` is for. You can not make it a coercion if the base ring isn't a field of char 0 and it is localized to the object here. I don't see what the other coercions into/out-of NSym has to do with anything. However, there is something to be asked about if this is a natural map. My impression from comment:7 was that it was, but I'm not the person to be asking about this.",
    "created_at": "2017-07-12T15:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439916",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>That is what `_coerce_map_from_` is for. You can not make it a coercion if the base ring isn't a field of char 0 and it is localized to the object here. I don't see what the other coercions into/out-of NSym has to do with anything. However, there is something to be asked about if this is a natural map. My impression from comment:7 was that it was, but I'm not the person to be asking about this.



---

archive/issue_comments_439917.json:
```json
{
    "body": "<a id='comment:13'></a>This maps NCSF -> GL fits in a nice diagram, that I will not describe here. Anyway, let us keep it for a later ticket. I would be happy enough to have this algebra in sage.",
    "created_at": "2017-07-12T15:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439917",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>This maps NCSF -> GL fits in a nice diagram, that I will not describe here. Anyway, let us keep it for a later ticket. I would be happy enough to have this algebra in sage.



---

archive/issue_comments_439918.json:
```json
{
    "body": "<a id='comment:14'></a>Hmm.\n\n```\n+        CombinatorialFreeModule.__init__(self, R, Trees,\n+                                         latex_prefix=\"\",\n+                                         sorting_key=key,\n+                                         category=cat)\n```\nBut `Trees` is not actually a basis; it has too much chaff. Is this a problem?",
    "created_at": "2017-07-12T15:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439918",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:14'></a>Hmm.

```
+        CombinatorialFreeModule.__init__(self, R, Trees,
+                                         latex_prefix="",
+                                         sorting_key=key,
+                                         category=cat)
```
But `Trees` is not actually a basis; it has too much chaff. Is this a problem?



---

archive/issue_comments_439919.json:
```json
{
    "body": "<a id='comment:15'></a>As far as I understand, `algebra_generators` is a misnomer: the 1-vertex forests don't generate GrossLars as an algebra. (I don't know in what sense they actually generate it...)\n\nAlso, is this part\n\n```\nThey are the\n    universal enveloping algebras of free pre-Lie algebras, seen\n    as Lie algebras.\n```\ntrue in all characteristics?",
    "created_at": "2017-07-12T15:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439919",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:15'></a>As far as I understand, `algebra_generators` is a misnomer: the 1-vertex forests don't generate GrossLars as an algebra. (I don't know in what sense they actually generate it...)

Also, is this part

```
They are the
    universal enveloping algebras of free pre-Lie algebras, seen
    as Lie algebras.
```
true in all characteristics?



---

archive/issue_comments_439920.json:
```json
{
    "body": "<a id='comment:16'></a>In the doc of `degree_on_basis`, I'd clarify whether the fake root is counted or not.\n\nGenerally, the docs should be uniform about whether to speak in terms of forests or in terms of trees with a fake root. Currently, some of them do one and some the other.",
    "created_at": "2017-07-12T16:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439920",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:16'></a>In the doc of `degree_on_basis`, I'd clarify whether the fake root is counted or not.

Generally, the docs should be uniform about whether to speak in terms of forests or in terms of trees with a fake root. Currently, some of them do one and some the other.



---

archive/issue_comments_439921.json:
```json
{
    "body": "<a id='comment:17'></a>Don't you want the coercion to only require the weaker condition\n`all(x in self.variable_names() for x in R.variable_names())` instead of\n`R.variable_names() == self.variable_names()` in the coercion method?\n\nThat said, I think the `__init__` tries a bit too hard to be smart. If I provide it a 1-element alphabet, I think it shouldn't use `RootedTrees()`. Instead, it should use `LabelledRootedTrees()` with the one letter I gave it. Otherwise, algorithms written with a multi-letter alphabet in mind would break. I suggest having an extra parameter to ask for the use of `RootedTrees()`.",
    "created_at": "2017-07-12T16:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439921",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:17'></a>Don't you want the coercion to only require the weaker condition
`all(x in self.variable_names() for x in R.variable_names())` instead of
`R.variable_names() == self.variable_names()` in the coercion method?

That said, I think the `__init__` tries a bit too hard to be smart. If I provide it a 1-element alphabet, I think it shouldn't use `RootedTrees()`. Instead, it should use `LabelledRootedTrees()` with the one letter I gave it. Otherwise, algorithms written with a multi-letter alphabet in mind would break. I suggest having an extra parameter to ask for the use of `RootedTrees()`.



---

archive/issue_comments_439922.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-12T19:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439923.json:
```json
{
    "body": "Changing commit from \"1ce921497ee441e3eac581eda8f28f90891334dc\" to \"33b2b4bd7c401df5b6ecd287855f329ca2fa68e5\"",
    "created_at": "2017-07-12T19:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1ce921497ee441e3eac581eda8f28f90891334dc" to "33b2b4bd7c401df5b6ecd287855f329ca2fa68e5"



---

archive/issue_comments_439924.json:
```json
{
    "body": "<a id='comment:19'></a>Preliminary remark: this implementation has been made by copy-modifying the existing implementation of free pre-Lie algebras, which has therefore almost exactly the same issues. And something very similar was done for free Dendriform algebras recently.\n\n1) The fact that Trees is not a basis does not prevent anything from working. As stated as a comment in the code, it would be good to have classes for `LabelledRootedTrees` with restricted labellings. But this is not really required here.\n\n2) `algebra_generators` is indeed some kind of misnomer. These elements are the generators of the primitives as a free pre-Lie algebra. They also span the space on which the underlying functorial construction (vector species of labelled forests) is based. I would be ok to remove `algebra_generators` but would like to keep gen and gens\n\n3) I have tried to clarify the doc by using \"forest\" consistently\n\n4) I have changed the coercion as suggested\n\n5) Concerning the use of unlabelled trees for the case of one variable. It is important for me to have an optimised 1-variable case. And also this behaviour is the one already existing for free pre-Lie algebras. But I agree that one could propose an option for the user to choose.\n\n6) another question that you did not ask but should have : the treatment of variable names is not exactly the same as for polynomials, for example, using 'x,y' will do something strange. I do not know how to enhance this. Free pre-Lie, Zinbiel and Dendriform algebras suffer from the same strangeness.",
    "created_at": "2017-07-12T19:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439924",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>Preliminary remark: this implementation has been made by copy-modifying the existing implementation of free pre-Lie algebras, which has therefore almost exactly the same issues. And something very similar was done for free Dendriform algebras recently.

1) The fact that Trees is not a basis does not prevent anything from working. As stated as a comment in the code, it would be good to have classes for `LabelledRootedTrees` with restricted labellings. But this is not really required here.

2) `algebra_generators` is indeed some kind of misnomer. These elements are the generators of the primitives as a free pre-Lie algebra. They also span the space on which the underlying functorial construction (vector species of labelled forests) is based. I would be ok to remove `algebra_generators` but would like to keep gen and gens

3) I have tried to clarify the doc by using "forest" consistently

4) I have changed the coercion as suggested

5) Concerning the use of unlabelled trees for the case of one variable. It is important for me to have an optimised 1-variable case. And also this behaviour is the one already existing for free pre-Lie algebras. But I agree that one could propose an option for the user to choose.

6) another question that you did not ask but should have : the treatment of variable names is not exactly the same as for polynomials, for example, using 'x,y' will do something strange. I do not know how to enhance this. Free pre-Lie, Zinbiel and Dendriform algebras suffer from the same strangeness.



---

archive/issue_comments_439925.json:
```json
{
    "body": "<a id='comment:20'></a>1) Okay. Worth a warning in the doc though -- I can easily imagine some tests failing because of this, and worse, someone could try checking an identity by bruting through the basis, unaware of the fact that some of the elements don't belong into the algebra and probably don't behave accordingly.\n\n2) I am fine with `gen` and `gens`; it's just the `algebra_generators` part I don't like.\n\n3, 4) Thank you!\n\n5) I understand you want the optimized code there; all I'm saying is there should also be a way to get the non-optimized one. Ideally there should be a difference between `algebras.GrossmanLarson(QQ, ['x'])` (unoptimized) and `algebras.GrossmanLarson(QQ)` (default value None, optimized). If the `Alphabet` constructor confuses the difference between these two inputs, I'm in favor of setting an extra variable for this.\n\nIf I pass an explicit list of variable names to `algebras.GrossmanLarson`, then I want to be able to construct basis elements of this algebra in a sane way. Since `gen`/`gens` is insufficient (those aren't algebra generators), this means passing actual labelled forests. And in order to construct the forest, I need to know the labels -- ideally, the labels I provided myself. If the labels at n = 1 are different from the ones I provided, I need to write a fugly special-casing code. Now that I'm thinking this out aloud, I guess we also need to expose ROOT at the level of the `GrossmanLarson` class...\n\n6) Are you just saying that shorthands, such as `'x,y'` for `['x','y']`, are not correctly understood? I don't mind this much, although a doc warning wouldn't be out of place.\n\nI wasn't fully aware that we had free pre-Lie, Zinbiel and dendriform algebras in Sage already; time is passing fast! I'm wondering if we can make QSym into a dendriform algebra, as the relevant operations are in the code already...\n\n[By the way, I'm at my parents' home in Karlsruhe until the end of August -- consider yourself invited! In order to do any serious Sage coding, I'll have to install it on my laptop though, as opposed to sshing into Minneapolis...]",
    "created_at": "2017-07-12T21:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439925",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:20'></a>1) Okay. Worth a warning in the doc though -- I can easily imagine some tests failing because of this, and worse, someone could try checking an identity by bruting through the basis, unaware of the fact that some of the elements don't belong into the algebra and probably don't behave accordingly.

2) I am fine with `gen` and `gens`; it's just the `algebra_generators` part I don't like.

3, 4) Thank you!

5) I understand you want the optimized code there; all I'm saying is there should also be a way to get the non-optimized one. Ideally there should be a difference between `algebras.GrossmanLarson(QQ, ['x'])` (unoptimized) and `algebras.GrossmanLarson(QQ)` (default value None, optimized). If the `Alphabet` constructor confuses the difference between these two inputs, I'm in favor of setting an extra variable for this.

If I pass an explicit list of variable names to `algebras.GrossmanLarson`, then I want to be able to construct basis elements of this algebra in a sane way. Since `gen`/`gens` is insufficient (those aren't algebra generators), this means passing actual labelled forests. And in order to construct the forest, I need to know the labels -- ideally, the labels I provided myself. If the labels at n = 1 are different from the ones I provided, I need to write a fugly special-casing code. Now that I'm thinking this out aloud, I guess we also need to expose ROOT at the level of the `GrossmanLarson` class...

6) Are you just saying that shorthands, such as `'x,y'` for `['x','y']`, are not correctly understood? I don't mind this much, although a doc warning wouldn't be out of place.

I wasn't fully aware that we had free pre-Lie, Zinbiel and dendriform algebras in Sage already; time is passing fast! I'm wondering if we can make QSym into a dendriform algebra, as the relevant operations are in the code already...

[By the way, I'm at my parents' home in Karlsruhe until the end of August -- consider yourself invited! In order to do any serious Sage coding, I'll have to install it on my laptop though, as opposed to sshing into Minneapolis...]



---

archive/issue_comments_439926.json:
```json
{
    "body": "Changing commit from \"33b2b4bd7c401df5b6ecd287855f329ca2fa68e5\" to \"ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a\"",
    "created_at": "2017-07-13T08:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "33b2b4bd7c401df5b6ecd287855f329ca2fa68e5" to "ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a"



---

archive/issue_comments_439927.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-13T08:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439927",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439928.json:
```json
{
    "body": "Changing commit from \"ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a\" to \"e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f\"",
    "created_at": "2017-07-13T08:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439928",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a" to "e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f"



---

archive/issue_comments_439929.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-13T08:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439930.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks for the invitation, I will think about it.\n\nI think I have now taken all your comments into account. I removed algebra generators. I have added some doc, and changed the behaviour of single-variate case, using `None` to get unlabelled trees.\n\nI forgot to answer your question on the isomorphism with the enveloping algebra. I think it holds over ZZ.\n\nI have made a follow-up ticket in #23431, to do the similar cleanup for free pre-Lie algebras.\n\nBy the way, we do not have yet categories for all these kinds of algebras. So it is not yet possible to turn Qsym into a dendriform algebra.",
    "created_at": "2017-07-14T08:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439930",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>Thanks for the invitation, I will think about it.

I think I have now taken all your comments into account. I removed algebra generators. I have added some doc, and changed the behaviour of single-variate case, using `None` to get unlabelled trees.

I forgot to answer your question on the isomorphism with the enveloping algebra. I think it holds over ZZ.

I have made a follow-up ticket in #23431, to do the similar cleanup for free pre-Lie algebras.

By the way, we do not have yet categories for all these kinds of algebras. So it is not yet possible to turn Qsym into a dendriform algebra.



---

archive/issue_comments_439931.json:
```json
{
    "body": "<a id='comment:24'></a>Strong -1 on removing `algebra_generators`, especially in favor of `gens`, which does not take into account what structure you are considering (Darij, I think you even created the ticket about that). It makes no sense to have `gens` that constructs a tuple of a `Family` (if anything, it should just construct the tuple directly). Have the `Family` be the return value of `algebra_generators`.\n\nThere is another way to set the variable names. CFM now should take `names` and handle them properly. You can also use `_assign_names`. You may also want run either one of these (likely the former):\n\n```\nfrom sage.structure.category_object import normalize_names\nfrom sage.structure.indexed_generators import parse_indices_names\n```\nin the `__classcall_private__` for better standardization of input. I think it will be more robust than `Alphabet`, but it is a little more restrictive. At least IMO, it is easier to work with by your `gens` method (which restricts it to a finite generating set). Plus, in a way what you're doing is an abuse of the current framework. However, if you prefer the current approach, then I will not hold this ticket up for this.\n\nTechnically this comment is wrong\n\n```\n# after this line : coercion\n```\n`_element_constructor_` defines conversion.\n\nWhile the unicode does look nice, if there is no unicode support in the terminal, then the output of the examples is basically unreadable (I recently had to work with such a terminal). So I would prefer if the examples used `ascii_art`.",
    "created_at": "2017-07-14T13:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439931",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>Strong -1 on removing `algebra_generators`, especially in favor of `gens`, which does not take into account what structure you are considering (Darij, I think you even created the ticket about that). It makes no sense to have `gens` that constructs a tuple of a `Family` (if anything, it should just construct the tuple directly). Have the `Family` be the return value of `algebra_generators`.

There is another way to set the variable names. CFM now should take `names` and handle them properly. You can also use `_assign_names`. You may also want run either one of these (likely the former):

```
from sage.structure.category_object import normalize_names
from sage.structure.indexed_generators import parse_indices_names
```
in the `__classcall_private__` for better standardization of input. I think it will be more robust than `Alphabet`, but it is a little more restrictive. At least IMO, it is easier to work with by your `gens` method (which restricts it to a finite generating set). Plus, in a way what you're doing is an abuse of the current framework. However, if you prefer the current approach, then I will not hold this ticket up for this.

Technically this comment is wrong

```
# after this line : coercion
```
`_element_constructor_` defines conversion.

While the unicode does look nice, if there is no unicode support in the terminal, then the output of the examples is basically unreadable (I recently had to work with such a terminal). So I would prefer if the examples used `ascii_art`.



---

archive/issue_comments_439932.json:
```json
{
    "body": "<a id='comment:25'></a>I will come back to a proper review of this later today, but for now, a brief response about `gens`: I have gotten used to `gens` being a context-dependent portmanteau. Meanwhile, `algebra_generators` should return algebra generators.\n\nWhat about `single_vertex`?\n\nAs usual, I have nothing to say about standardization of input :/",
    "created_at": "2017-07-14T13:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439932",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:25'></a>I will come back to a proper review of this later today, but for now, a brief response about `gens`: I have gotten used to `gens` being a context-dependent portmanteau. Meanwhile, `algebra_generators` should return algebra generators.

What about `single_vertex`?

As usual, I have nothing to say about standardization of input :/



---

archive/issue_comments_439933.json:
```json
{
    "body": "<a id='comment:26'></a>I have reviewed everything except for the technical functions (`__classcall_private__`, `__init__`, `_element_constructor_`). Travis, can you take a look at these?\n\nI also have added the antipode. (No unicode in the doctests, because unicode seems to break over my ssh connection. Sorry!)\n\nWarning: branch change incoming.\n\n(And yes, `itertools.product` and `itertools.combinations` are significantly faster than `cartesian_product` and `powerset`, respectively. I would also suspect that my `child_grafts` change speeds up the `except` case, since it would be computed twice before; but I haven't checked this.)",
    "created_at": "2017-07-15T01:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439933",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:26'></a>I have reviewed everything except for the technical functions (`__classcall_private__`, `__init__`, `_element_constructor_`). Travis, can you take a look at these?

I also have added the antipode. (No unicode in the doctests, because unicode seems to break over my ssh connection. Sorry!)

Warning: branch change incoming.

(And yes, `itertools.product` and `itertools.combinations` are significantly faster than `cartesian_product` and `powerset`, respectively. I would also suspect that my `child_grafts` change speeds up the `except` case, since it would be computed twice before; but I haven't checked this.)



---

archive/issue_comments_439934.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Darij Grinberg\"",
    "created_at": "2017-07-15T01:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439934",
    "user": "https://github.com/darijgr"
}
```

Changing reviewer from "" to "Darij Grinberg"



---

archive/issue_comments_439935.json:
```json
{
    "body": "Changing commit from \"e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f\" to \"\"",
    "created_at": "2017-07-15T01:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439935",
    "user": "https://github.com/darijgr"
}
```

Changing commit from "e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f" to ""



---

archive/issue_comments_439936.json:
```json
{
    "body": "Changing branch from \"u/chapoton/23406\" to \"public/ticket/23406\"",
    "created_at": "2017-07-15T01:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439936",
    "user": "https://github.com/darijgr"
}
```

Changing branch from "u/chapoton/23406" to "public/ticket/23406"



---

archive/issue_comments_439937.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-15T01:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439937",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439938.json:
```json
{
    "body": "Changing commit from \"\" to \"e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c\"",
    "created_at": "2017-07-15T01:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c"



---

archive/issue_comments_439939.json:
```json
{
    "body": "<a id='comment:29'></a>Please move the references to the master bibliography file, `doc/en/reference/references/index.rst`.",
    "created_at": "2017-07-15T01:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439939",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>Please move the references to the master bibliography file, `doc/en/reference/references/index.rst`.



---

archive/issue_comments_439940.json:
```json
{
    "body": "Changing commit from \"e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c\" to \"b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1\"",
    "created_at": "2017-07-15T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c" to "b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1"



---

archive/issue_comments_439941.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-15T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439942.json:
```json
{
    "body": "<a id='comment:31'></a>There are some problems with `_element_constructor_` being too permissive:\n\n```\nsage: R.<x,y> = algebras.GrossmanLarson(QQ)\nsage: S.<z> = algebras.GrossmanLarson(GF(3))\nsage: R(z)\nB[#[z[]]]\nsage: R(2*z)^2\nB[#[z[z[]]]] + B[#[z[], z[]]]\nsage: (2*x)^2\n4*B[#[x[x[]]]] + 4*B[#[x[], x[]]]\n```\nThis is a *conversion*, so it doesn't care about the output of `_coerce_map_from_`. A different (but somewhat entangled) problem:\n\n```\nsage: S(x)\n...\nRuntimeError: maximum recursion depth exceeded while getting the str of an object\n```\nwhich seems to stem from the containment check `if x in self.basis().keys()`. Note that this \"works\":\n\n```\nsage: S(x.leading_support())\nB[#[x[]]]\n```\nSo the fix is to check to make sure. Same issue for\n\n```\nsage: P.<a> = QQ[]\nsage: S(2*a + 2)\n...\nRuntimeError: maximum recursion depth exceeded while getting the str of an object\n```\n\nSo does `x*y` correspond to taking the Lie bracket or their universal enveloping algebra (UEA) product? At least it seems to me that it is the latter (the former would mean `x*y = -y*x`, which is not the case), in which case they are algebra generators as every element in the Lie algebra is the commutator bracket, which then allows you to get every element the UEA by PBW. Thus it would be okay to call them `algebra_generators`.\n\nOtherwise I really do not like the fact that `gens` does not generate the Grossman-Larson algebra under any structure. In which case, you should instead override `_first_ngens` to return the corresponding variable names to allow the `R.<x,y>` syntax.\n\n`@`darij, I don't understand what you are proposing for `single_vertex`. As an alternative to `gens`?\n\nEverything else of comment:24 still applies.",
    "created_at": "2017-07-16T00:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439942",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:31'></a>There are some problems with `_element_constructor_` being too permissive:

```
sage: R.<x,y> = algebras.GrossmanLarson(QQ)
sage: S.<z> = algebras.GrossmanLarson(GF(3))
sage: R(z)
B[#[z[]]]
sage: R(2*z)^2
B[#[z[z[]]]] + B[#[z[], z[]]]
sage: (2*x)^2
4*B[#[x[x[]]]] + 4*B[#[x[], x[]]]
```
This is a *conversion*, so it doesn't care about the output of `_coerce_map_from_`. A different (but somewhat entangled) problem:

```
sage: S(x)
...
RuntimeError: maximum recursion depth exceeded while getting the str of an object
```
which seems to stem from the containment check `if x in self.basis().keys()`. Note that this "works":

```
sage: S(x.leading_support())
B[#[x[]]]
```
So the fix is to check to make sure. Same issue for

```
sage: P.<a> = QQ[]
sage: S(2*a + 2)
...
RuntimeError: maximum recursion depth exceeded while getting the str of an object
```

So does `x*y` correspond to taking the Lie bracket or their universal enveloping algebra (UEA) product? At least it seems to me that it is the latter (the former would mean `x*y = -y*x`, which is not the case), in which case they are algebra generators as every element in the Lie algebra is the commutator bracket, which then allows you to get every element the UEA by PBW. Thus it would be okay to call them `algebra_generators`.

Otherwise I really do not like the fact that `gens` does not generate the Grossman-Larson algebra under any structure. In which case, you should instead override `_first_ngens` to return the corresponding variable names to allow the `R.<x,y>` syntax.

`@`darij, I don't understand what you are proposing for `single_vertex`. As an alternative to `gens`?

Everything else of comment:24 still applies.



---

archive/issue_comments_439943.json:
```json
{
    "body": "<a id='comment:32'></a>Yes, I am suggesting `single_vertex` as an alternative name to `gens`.\n\n`x*y` corresponds to the UEA product. But the Lie algebra is not generated by the `gens` as a Lie algebra! (It is generated by them as a pre-Lie algebra.)",
    "created_at": "2017-07-16T00:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439943",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:32'></a>Yes, I am suggesting `single_vertex` as an alternative name to `gens`.

`x*y` corresponds to the UEA product. But the Lie algebra is not generated by the `gens` as a Lie algebra! (It is generated by them as a pre-Lie algebra.)



---

archive/issue_comments_439944.json:
```json
{
    "body": "<a id='comment:33'></a>This is a little outside of my knowledge zone, so please bear with me. What you are saying is the entire Lie algebra is generated by `gens` under `*`, correct? So, by extension, it generates the entire algebra.",
    "created_at": "2017-07-16T00:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439944",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>This is a little outside of my knowledge zone, so please bear with me. What you are saying is the entire Lie algebra is generated by `gens` under `*`, correct? So, by extension, it generates the entire algebra.



---

archive/issue_comments_439945.json:
```json
{
    "body": "<a id='comment:34'></a>No. The Lie algebra is not generated by the `gens`. The pre-Lie algebra is generated by them.\n\nThe notation is quite confusing: A pre-Lie algebra is *not* \"a Lie algebra without the Jacobi identity\". A pre-Lie algebra is a usual nonunital algebra whose multiplication satisfies something weaker than associativity. In order to obtain a Lie algebra from a pre-Lie algebra, you have to replace the \"product\" by its commutator (whereas obtaining a pre-Lie algebra from an associative algebra requires doing nothing). So a pre-Lie algebra should perhaps rather be called a pre-associative algebra.",
    "created_at": "2017-07-16T01:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439945",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:34'></a>No. The Lie algebra is not generated by the `gens`. The pre-Lie algebra is generated by them.

The notation is quite confusing: A pre-Lie algebra is *not* "a Lie algebra without the Jacobi identity". A pre-Lie algebra is a usual nonunital algebra whose multiplication satisfies something weaker than associativity. In order to obtain a Lie algebra from a pre-Lie algebra, you have to replace the "product" by its commutator (whereas obtaining a pre-Lie algebra from an associative algebra requires doing nothing). So a pre-Lie algebra should perhaps rather be called a pre-associative algebra.



---

archive/issue_comments_439946.json:
```json
{
    "body": "<a id='comment:35'></a>However, is the Lie algebra of primitives the Lie given by the commutators of the pre-Lie algebra given by `gens`? At least I do not understand elements are not able to be generated by `gens` under `*`.",
    "created_at": "2017-07-16T03:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439946",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>However, is the Lie algebra of primitives the Lie given by the commutators of the pre-Lie algebra given by `gens`? At least I do not understand elements are not able to be generated by `gens` under `*`.



---

archive/issue_comments_439947.json:
```json
{
    "body": "<a id='comment:36'></a>There are 3 different products at play here (plus a coproduct) :\n\n* the Lie bracket [,]\n* the UEA associative product, call it *\n* the non-associative product of free pre-Lie algebras, call it <\n\nThe Lie bracket (on the span Prim(GL) of rooted trees) is the commutator of both * and <\n\nThen \"gens\" do generate Prim(GL) as a free pre-Lie algebra (under <), but not as a Lie algebra. Think of the one variable case, where the free Lie algebra is one dimensional, whereas the free pre-Lie algebra is the span of rooted trees. It is a theorem that the space Prim(GL) is free as a Lie algebra, but on an infinite set of generators.\n\nTherefore the \"gens\" do no generate GL as an associative algebra, as the correct generators are the same infinite set.",
    "created_at": "2017-07-16T07:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439947",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>There are 3 different products at play here (plus a coproduct) :

* the Lie bracket [,]
* the UEA associative product, call it *
* the non-associative product of free pre-Lie algebras, call it <

The Lie bracket (on the span Prim(GL) of rooted trees) is the commutator of both * and <

Then "gens" do generate Prim(GL) as a free pre-Lie algebra (under <), but not as a Lie algebra. Think of the one variable case, where the free Lie algebra is one dimensional, whereas the free pre-Lie algebra is the span of rooted trees. It is a theorem that the space Prim(GL) is free as a Lie algebra, but on an infinite set of generators.

Therefore the "gens" do no generate GL as an associative algebra, as the correct generators are the same infinite set.



---

archive/issue_comments_439948.json:
```json
{
    "body": "<a id='comment:37'></a>Oh, I see, the `*` does not correspond to the pre-Lie product <, that was what I was missing. So the issue is more of the fact we only have one distributive binary operation `*`, which you want it to be the UEA product (if we were in Python3, we could use ``@``/`__matmul__` for the other). Do we want to support the pre-Lie product, and if so, how? One way would be to use `**` between two elements to mean the pre-Lie product. It would be a bit of a hackaround, but I don't see a use for `x ** y` otherwise.\n\nAs for the name, how about explicitly saying `pre_lie_generators`? I would also say we should do a custom `_first_ngens` to support `R.<x> = GL()` syntax.",
    "created_at": "2017-07-16T14:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439948",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>Oh, I see, the `*` does not correspond to the pre-Lie product <, that was what I was missing. So the issue is more of the fact we only have one distributive binary operation `*`, which you want it to be the UEA product (if we were in Python3, we could use ``@``/`__matmul__` for the other). Do we want to support the pre-Lie product, and if so, how? One way would be to use `**` between two elements to mean the pre-Lie product. It would be a bit of a hackaround, but I don't see a use for `x ** y` otherwise.

As for the name, how about explicitly saying `pre_lie_generators`? I would also say we should do a custom `_first_ngens` to support `R.<x> = GL()` syntax.



---

archive/issue_comments_439949.json:
```json
{
    "body": "<a id='comment:38'></a>Is there a pre-Lie product on the UEA at all? That's an actual question, which I am curious about. It's not per se obvious to me that a pre-Lie product on a Lie algebra automatically gives rise to a pre-Lie product on its UEA; but it sounds like the kind of statement that could be a theorem.\n\n(Baby example: Does the symmetric algebra of a commutative algebra have a canonical pre-Lie product that is different from just the usual multiplication in the symmetric algebra?)",
    "created_at": "2017-07-16T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439949",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:38'></a>Is there a pre-Lie product on the UEA at all? That's an actual question, which I am curious about. It's not per se obvious to me that a pre-Lie product on a Lie algebra automatically gives rise to a pre-Lie product on its UEA; but it sounds like the kind of statement that could be a theorem.

(Baby example: Does the symmetric algebra of a commutative algebra have a canonical pre-Lie product that is different from just the usual multiplication in the symmetric algebra?)



---

archive/issue_comments_439950.json:
```json
{
    "body": "<a id='comment:39'></a>There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.\n\nI think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.",
    "created_at": "2017-07-16T16:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439950",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.

I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.



---

archive/issue_comments_439951.json:
```json
{
    "body": "Changing commit from \"b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1\" to \"29c72a361944f53889ed9959e4af22d873527b06\"",
    "created_at": "2017-07-16T18:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1" to "29c72a361944f53889ed9959e4af22d873527b06"



---

archive/issue_comments_439952.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T18:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439953.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T19:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439954.json:
```json
{
    "body": "Changing commit from \"29c72a361944f53889ed9959e4af22d873527b06\" to \"49055e4ec6a3ae0a16ce806df2712b458e250e02\"",
    "created_at": "2017-07-16T19:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "29c72a361944f53889ed9959e4af22d873527b06" to "49055e4ec6a3ae0a16ce806df2712b458e250e02"



---

archive/issue_comments_439955.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:39 chapoton]:\n> There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.\n\n\nIt is possible to define an operation restricted to a particular subset (e.g., inverse). The question becomes do we want to have another operation defined on the primitive subspace? For Lie algebras, this is not a problem because `x.bracket(y)` goes to `Ux.bracket(Uy)` and coercion should take care of the other combinations. Also in that case, the method `bracket()` is taking the place of the second operation.\n\nI guess in either case we would want `*` to be the UEA product, so adding such a feature could be pushed off to another ticket. I'm also becoming more okay with using `gens` without such a feature, but I am not 100% there yet. However, `pre_lie_algebra_generators` is a bad name. How about `primitive_generators`?\n\n> I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.\n\n\nFor that, all you need to do is have `_construct_UEA` return the corresponding GL algebra and define `lift` for the corresponding element class. I guess you would also then need to add to `_coerce_map_from_`\n\n```\nif isinstance(L, FreePreLieAlgebra):\n    return self.coerce_map_from(L.universal_enveloping_algebra())\n```\nas `L.universal_enveloping_algebra()` automatically registers the coercion to its UEA and the coercion framework would take care of the rest. That on top of #23431 should give you what you want. However, I'm okay with that being another ticket.",
    "created_at": "2017-07-16T22:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439955",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>Replying to [comment:39 chapoton]:
> There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.


It is possible to define an operation restricted to a particular subset (e.g., inverse). The question becomes do we want to have another operation defined on the primitive subspace? For Lie algebras, this is not a problem because `x.bracket(y)` goes to `Ux.bracket(Uy)` and coercion should take care of the other combinations. Also in that case, the method `bracket()` is taking the place of the second operation.

I guess in either case we would want `*` to be the UEA product, so adding such a feature could be pushed off to another ticket. I'm also becoming more okay with using `gens` without such a feature, but I am not 100% there yet. However, `pre_lie_algebra_generators` is a bad name. How about `primitive_generators`?

> I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.


For that, all you need to do is have `_construct_UEA` return the corresponding GL algebra and define `lift` for the corresponding element class. I guess you would also then need to add to `_coerce_map_from_`

```
if isinstance(L, FreePreLieAlgebra):
    return self.coerce_map_from(L.universal_enveloping_algebra())
```
as `L.universal_enveloping_algebra()` automatically registers the coercion to its UEA and the coercion framework would take care of the rest. That on top of #23431 should give you what you want. However, I'm okay with that being another ticket.



---

archive/issue_comments_439956.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-17T09:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439957.json:
```json
{
    "body": "Changing commit from \"49055e4ec6a3ae0a16ce806df2712b458e250e02\" to \"b0dadb4ae26e6692caeb1404dc79dbe8f51118b6\"",
    "created_at": "2017-07-17T09:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "49055e4ec6a3ae0a16ce806df2712b458e250e02" to "b0dadb4ae26e6692caeb1404dc79dbe8f51118b6"



---

archive/issue_comments_439958.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-13T14:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439959.json:
```json
{
    "body": "Changing commit from \"b0dadb4ae26e6692caeb1404dc79dbe8f51118b6\" to \"117ad0da0e3a9839d8dba0af4186f89e47795e65\"",
    "created_at": "2017-09-13T14:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b0dadb4ae26e6692caeb1404dc79dbe8f51118b6" to "117ad0da0e3a9839d8dba0af4186f89e47795e65"



---

archive/issue_comments_439960.json:
```json
{
    "body": "<a id='comment:45'></a>There is still a controversy about the naming of the methods `gen`, `gens` and `algebra_generators`.\n\nMy choice by decreasing order of preference:\n\n1) use \"gen\" and \"gens\" (because these are not algebra generators)\n\n2) use \"single_vertex\"\n\n3) use \"prelie_generators\" (but they do not generate as a pre-Lie algebra !)\n\nCan we try to agree on something ?",
    "created_at": "2017-09-13T15:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439960",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:45'></a>There is still a controversy about the naming of the methods `gen`, `gens` and `algebra_generators`.

My choice by decreasing order of preference:

1) use "gen" and "gens" (because these are not algebra generators)

2) use "single_vertex"

3) use "prelie_generators" (but they do not generate as a pre-Lie algebra !)

Can we try to agree on something ?



---

archive/issue_events_060164.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-13T15:02:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23406#event-60164"
}
```



---

archive/issue_comments_439961.json:
```json
{
    "body": "<a id='comment:46'></a>I'm in favor of option 2.",
    "created_at": "2017-09-13T15:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439961",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:46'></a>I'm in favor of option 2.



---

archive/issue_comments_439962.json:
```json
{
    "body": "<a id='comment:47'></a>Okay, I had to re-familiarize myself with the discussion. So, I agree with Darij and think option 2 is the best way forward so we do not further muddy the `gens` ambiguity.\n\nPS - I just thought of the operator `<<` for the pre-Lie product, but unfortunately, that is lower priority than `+-`.",
    "created_at": "2017-09-14T05:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439962",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:47'></a>Okay, I had to re-familiarize myself with the discussion. So, I agree with Darij and think option 2 is the best way forward so we do not further muddy the `gens` ambiguity.

PS - I just thought of the operator `<<` for the pre-Lie product, but unfortunately, that is lower priority than `+-`.



---

archive/issue_comments_439963.json:
```json
{
    "body": "Changing commit from \"117ad0da0e3a9839d8dba0af4186f89e47795e65\" to \"fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5\"",
    "created_at": "2017-09-14T08:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439963",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "117ad0da0e3a9839d8dba0af4186f89e47795e65" to "fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5"



---

archive/issue_comments_439964.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T08:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439964",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439965.json:
```json
{
    "body": "<a id='comment:49'></a>Done. I used `single_vertex` and `single_vertex_all`. I also had to override `_first_ngens`.",
    "created_at": "2017-09-14T08:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439965",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:49'></a>Done. I used `single_vertex` and `single_vertex_all`. I also had to override `_first_ngens`.



---

archive/issue_comments_439966.json:
```json
{
    "body": "Changing reviewer from \"Darij Grinberg\" to \"Darij Grinberg, Travis Scrimshaw\"",
    "created_at": "2017-09-15T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439966",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Darij Grinberg" to "Darij Grinberg, Travis Scrimshaw"



---

archive/issue_comments_439967.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-15T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439967",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439968.json:
```json
{
    "body": "<a id='comment:50'></a>Thank you. Since all comments have been addressed, I am setting this to a positive review.",
    "created_at": "2017-09-15T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439968",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>Thank you. Since all comments have been addressed, I am setting this to a positive review.



---

archive/issue_comments_439969.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-18T22:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439969",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_439970.json:
```json
{
    "body": "Changing branch from \"public/ticket/23406\" to \"fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5\"",
    "created_at": "2017-09-18T22:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23406#issuecomment-439970",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/23406" to "fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5"



---

archive/issue_events_060165.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-18T22:15:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23406",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23406#event-60165"
}
```
