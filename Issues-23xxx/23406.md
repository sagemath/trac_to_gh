# Issue 23406: implement Grossman-Larson Hopf algebras of rooted forests

archive/issues_023169.json:
```json
{
    "assignees": [],
    "body": "as an interesting and useful combinatorial Hopf algebra\n\nCC:  @tscrim @darijgr\n\nBranch/Commit: **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**\n\nReviewer: **Darij Grinberg, Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23406_\n\n",
    "closed_at": "2017-09-18T22:15:34Z",
    "created_at": "2017-07-12T09:37:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement Grossman-Larson Hopf algebras of rooted forests",
    "type": "issue",
    "updated_at": "2017-09-18T22:15:34Z",
    "url": "https://github.com/sagemath/sage/issues/23406",
    "user": "https://github.com/fchapoton"
}
```
as an interesting and useful combinatorial Hopf algebra

CC:  @tscrim @darijgr

Branch/Commit: **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**

Reviewer: **Darij Grinberg, Travis Scrimshaw**

Author: **Frédéric Chapoton**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/23406_





---

archive/issue_events_325782.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-12T09:37:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325782"
}
```



---

archive/issue_events_325783.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-12T09:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325783"
}
```



---

archive/issue_events_325784.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-12T09:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325784"
}
```



---

archive/issue_events_325785.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-12T09:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325785"
}
```



---

archive/issue_events_325786.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-12T09:38:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325786"
}
```



---

archive/issue_comments_351556.json:
```json
{
    "body": "Commit: **[94d3e59](https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e)**",
    "created_at": "2017-07-12T09:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351556",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[94d3e59](https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e)**



---

archive/issue_comments_351557.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e\">94d3e59</a></td><td><code>basic implementation of the Grossman-Larson Hopf algebra of rooted forests</code></td></tr></table>\n",
    "created_at": "2017-07-12T09:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351557",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e">94d3e59</a></td><td><code>basic implementation of the Grossman-Larson Hopf algebra of rooted forests</code></td></tr></table>




---

archive/issue_comments_351558.json:
```json
{
    "body": "Branch: **[u/chapoton/23406](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23406)**",
    "created_at": "2017-07-12T09:38:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351558",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23406](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23406)**



---

archive/issue_comments_351559.json:
```json
{
    "body": "Changed commit from **[94d3e59](https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e)** to **[1ce9214](https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc)**",
    "created_at": "2017-07-12T09:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351559",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[94d3e59](https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e)** to **[1ce9214](https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc)**



---

archive/issue_comments_351560.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc\">1ce9214</a></td><td><code>doc detail on Grossman-Larson product</code></td></tr></table>\n",
    "created_at": "2017-07-12T09:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351560",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc">1ce9214</a></td><td><code>doc detail on Grossman-Larson product</code></td></tr></table>




---

archive/issue_comments_351561.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nYou have defined the `single_graft` method on class `RootedTree`, which is a class for *unordered* rooted trees. But the method clearly requires an ordering for the subtrees (which I hope mean children -- maybe this is the better word?) of `x`. Now, this may be a non-issue since you aren't saying that `t` should be of class `RootedTree`; but then I'm not sure which class it should be of. Could you clarify, or move this to a more concrete class? Thanks!",
    "created_at": "2017-07-12T14:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351561",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:3" align="right">comment:3</div>

You have defined the `single_graft` method on class `RootedTree`, which is a class for *unordered* rooted trees. But the method clearly requires an ordering for the subtrees (which I hope mean children -- maybe this is the better word?) of `x`. Now, this may be a non-issue since you aren't saying that `t` should be of class `RootedTree`; but then I'm not sure which class it should be of. Could you clarify, or move this to a more concrete class? Thanks!



---

archive/issue_comments_351562.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHello Darij, thanks for having a look.\n\nThe `single_graft` implementation uses an ordering of the subtrees (by which I mean the elements of list(t)), but the result (as a `RootedTree`) does not depend on it.\n\nIndeed, if I remember correctly, there is a planar version of the Grossman-Larson Hopf algebra, for which a planar version of `single_graft` would be used. But this is not the aim of this ticket. But maybe one want to think a bit more and implement directly the correct planar version.",
    "created_at": "2017-07-12T14:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351562",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

Hello Darij, thanks for having a look.

The `single_graft` implementation uses an ordering of the subtrees (by which I mean the elements of list(t)), but the result (as a `RootedTree`) does not depend on it.

Indeed, if I remember correctly, there is a planar version of the Grossman-Larson Hopf algebra, for which a planar version of `single_graft` would be used. But this is not the aim of this ticket. But maybe one want to think a bit more and implement directly the correct planar version.



---

archive/issue_comments_351563.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHi Fr\u00e9d\u00e9ric!\n\nOh, I see. The children have a fixed order, probably by `sort_key` (not sure how exactly this works).\n\nI've got a question: Is the behavior below acceptable for basis indices of a combinatorial free module?\n\n```\nsage: RT4 = RootedTrees(4)\nsage: t1 = RT4([[],[[]]])\nsage: t1\n[[], [[]]]\nsage: t2 = RT4([[[]],[]])\nsage: t2\n[[], [[]]]\nsage: t1 == t2\nTrue\nsage: t1 is t2\nFalse\nsage: LRT4 = LabelledRootedTrees(4)\nsage: t1 = LRT4(t1)\nsage: t2 = LRT4(t2)\nsage: t1 == t2\nTrue\nsage: t1 is t2\nFalse\nsage:\n```",
    "created_at": "2017-07-12T14:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351563",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:5" align="right">comment:5</div>

Hi Frédéric!

Oh, I see. The children have a fixed order, probably by `sort_key` (not sure how exactly this works).

I've got a question: Is the behavior below acceptable for basis indices of a combinatorial free module?

```
sage: RT4 = RootedTrees(4)
sage: t1 = RT4([[],[[]]])
sage: t1
[[], [[]]]
sage: t2 = RT4([[[]],[]])
sage: t2
[[], [[]]]
sage: t1 == t2
True
sage: t1 is t2
False
sage: LRT4 = LabelledRootedTrees(4)
sage: t1 = LRT4(t1)
sage: t2 = LRT4(t2)
sage: t1 == t2
True
sage: t1 is t2
False
sage:
```



---

archive/issue_comments_351564.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n@darijgr That behavior has always been supported in CFM (assuming `hash(a) == hash(b)`, which should happen by Python's specs):\n\n```\nsage: C = CombinatorialFreeModule(ZZ, QQ)\nsage: B = C.basis()\nsage: 1/2 is 1/2\nFalse\nsage: B[1/2] == B[1/2]\nTrue\nsage: B[1/2] is B[1/2]\nFalse\n```",
    "created_at": "2017-07-12T14:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351564",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

@darijgr That behavior has always been supported in CFM (assuming `hash(a) == hash(b)`, which should happen by Python's specs):

```
sage: C = CombinatorialFreeModule(ZZ, QQ)
sage: B = C.basis()
sage: 1/2 is 1/2
False
sage: B[1/2] == B[1/2]
True
sage: B[1/2] is B[1/2]
False
```



---

archive/issue_comments_351565.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nBy the way, there is an important morphism of Hopf algebras from NCSF to the one here (for one variable) that maps the generator Psi_n of NCSF to the linear tree on n vertices (n+1 if counting the root). Would it be easy to implement that, either in this ticket or after ?",
    "created_at": "2017-07-12T15:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351565",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

By the way, there is an important morphism of Hopf algebras from NCSF to the one here (for one variable) that maps the generator Psi_n of NCSF to the linear tree on n vertices (n+1 if counting the root). Would it be easy to implement that, either in this ticket or after ?



---

archive/issue_comments_351566.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nYes, this should be easy -- just define it by first converting to the Psi-basis.\n\nThat is, as long as the base ring has the rational numbers in it. I assume the morphism doesn't exist otherwise?",
    "created_at": "2017-07-12T15:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351566",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:8" align="right">comment:8</div>

Yes, this should be easy -- just define it by first converting to the Psi-basis.

That is, as long as the base ring has the rational numbers in it. I assume the morphism doesn't exist otherwise?



---

archive/issue_comments_351567.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n@tscrim: Wow; I never realized that Sage rationals aren't uniquerepresentation! Great to hear this works.",
    "created_at": "2017-07-12T15:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351567",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:9" align="right">comment:9</div>

@tscrim: Wow; I never realized that Sage rationals aren't uniquerepresentation! Great to hear this works.



---

archive/issue_comments_351568.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI would probably do it in this ticket by implementing a `_coerce_map_from_` to return a `self.module_morphism` with the correct construction data.",
    "created_at": "2017-07-12T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351568",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

I would probably do it in this ticket by implementing a `_coerce_map_from_` to return a `self.module_morphism` with the correct construction data.



---

archive/issue_comments_351569.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI would prefer not to make it a coercion. The thicket is already too dense around NSym, and this would be a coercion defined in dependence on the base ring, which too complicates thing. Plus, are we sure this is the most natural map NCSF -> GrossLars?",
    "created_at": "2017-07-12T15:29:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351569",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:11" align="right">comment:11</div>

I would prefer not to make it a coercion. The thicket is already too dense around NSym, and this would be a coercion defined in dependence on the base ring, which too complicates thing. Plus, are we sure this is the most natural map NCSF -> GrossLars?



---

archive/issue_comments_351570.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThat is what `_coerce_map_from_` is for. You can not make it a coercion if the base ring isn't a field of char 0 and it is localized to the object here. I don't see what the other coercions into/out-of NSym has to do with anything. However, there is something to be asked about if this is a natural map. My impression from [comment:7](#comment:7) was that it was, but I'm not the person to be asking about this.",
    "created_at": "2017-07-12T15:34:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351570",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

That is what `_coerce_map_from_` is for. You can not make it a coercion if the base ring isn't a field of char 0 and it is localized to the object here. I don't see what the other coercions into/out-of NSym has to do with anything. However, there is something to be asked about if this is a natural map. My impression from [comment:7](#comment:7) was that it was, but I'm not the person to be asking about this.



---

archive/issue_comments_351571.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis maps NCSF -> GL fits in a nice diagram, that I will not describe here. Anyway, let us keep it for a later ticket. I would be happy enough to have this algebra in sage.",
    "created_at": "2017-07-12T15:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351571",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

This maps NCSF -> GL fits in a nice diagram, that I will not describe here. Anyway, let us keep it for a later ticket. I would be happy enough to have this algebra in sage.



---

archive/issue_comments_351572.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHmm.\n\n```\n+        CombinatorialFreeModule.__init__(self, R, Trees,\n+                                         latex_prefix=\"\",\n+                                         sorting_key=key,\n+                                         category=cat)\n```\nBut `Trees` is not actually a basis; it has too much chaff. Is this a problem?",
    "created_at": "2017-07-12T15:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351572",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:14" align="right">comment:14</div>

Hmm.

```
+        CombinatorialFreeModule.__init__(self, R, Trees,
+                                         latex_prefix="",
+                                         sorting_key=key,
+                                         category=cat)
```
But `Trees` is not actually a basis; it has too much chaff. Is this a problem?



---

archive/issue_comments_351573.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAs far as I understand, `algebra_generators` is a misnomer: the 1-vertex forests don't generate GrossLars as an algebra. (I don't know in what sense they actually generate it...)\n\nAlso, is this part\n\n```\nThey are the\n    universal enveloping algebras of free pre-Lie algebras, seen\n    as Lie algebras.\n```\ntrue in all characteristics?",
    "created_at": "2017-07-12T15:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351573",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:15" align="right">comment:15</div>

As far as I understand, `algebra_generators` is a misnomer: the 1-vertex forests don't generate GrossLars as an algebra. (I don't know in what sense they actually generate it...)

Also, is this part

```
They are the
    universal enveloping algebras of free pre-Lie algebras, seen
    as Lie algebras.
```
true in all characteristics?



---

archive/issue_comments_351574.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIn the doc of `degree_on_basis`, I'd clarify whether the fake root is counted or not.\n\nGenerally, the docs should be uniform about whether to speak in terms of forests or in terms of trees with a fake root. Currently, some of them do one and some the other.",
    "created_at": "2017-07-12T16:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351574",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:16" align="right">comment:16</div>

In the doc of `degree_on_basis`, I'd clarify whether the fake root is counted or not.

Generally, the docs should be uniform about whether to speak in terms of forests or in terms of trees with a fake root. Currently, some of them do one and some the other.



---

archive/issue_comments_351575.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nDon't you want the coercion to only require the weaker condition\n`all(x in self.variable_names() for x in R.variable_names())` instead of\n`R.variable_names() == self.variable_names()` in the coercion method?\n\nThat said, I think the `__init__` tries a bit too hard to be smart. If I provide it a 1-element alphabet, I think it shouldn't use `RootedTrees()`. Instead, it should use `LabelledRootedTrees()` with the one letter I gave it. Otherwise, algorithms written with a multi-letter alphabet in mind would break. I suggest having an extra parameter to ask for the use of `RootedTrees()`.",
    "created_at": "2017-07-12T16:22:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351575",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:17" align="right">comment:17</div>

Don't you want the coercion to only require the weaker condition
`all(x in self.variable_names() for x in R.variable_names())` instead of
`R.variable_names() == self.variable_names()` in the coercion method?

That said, I think the `__init__` tries a bit too hard to be smart. If I provide it a 1-element alphabet, I think it shouldn't use `RootedTrees()`. Instead, it should use `LabelledRootedTrees()` with the one letter I gave it. Otherwise, algorithms written with a multi-letter alphabet in mind would break. I suggest having an extra parameter to ask for the use of `RootedTrees()`.



---

archive/issue_comments_351576.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5\">33b2b4b</a></td><td><code>trac 23406 some changes after reviewer's comments</code></td></tr></table>\n",
    "created_at": "2017-07-12T19:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351576",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5">33b2b4b</a></td><td><code>trac 23406 some changes after reviewer's comments</code></td></tr></table>




---

archive/issue_comments_351577.json:
```json
{
    "body": "Changed commit from **[1ce9214](https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc)** to **[33b2b4b](https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5)**",
    "created_at": "2017-07-12T19:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351577",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1ce9214](https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc)** to **[33b2b4b](https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5)**



---

archive/issue_comments_351578.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nPreliminary remark: this implementation has been made by copy-modifying the existing implementation of free pre-Lie algebras, which has therefore almost exactly the same issues. And something very similar was done for free Dendriform algebras recently.\n\n1) The fact that Trees is not a basis does not prevent anything from working. As stated as a comment in the code, it would be good to have classes for `LabelledRootedTrees` with restricted labellings. But this is not really required here.\n\n2) `algebra_generators` is indeed some kind of misnomer. These elements are the generators of the primitives as a free pre-Lie algebra. They also span the space on which the underlying functorial construction (vector species of labelled forests) is based. I would be ok to remove `algebra_generators` but would like to keep gen and gens\n\n3) I have tried to clarify the doc by using \"forest\" consistently\n\n4) I have changed the coercion as suggested\n\n5) Concerning the use of unlabelled trees for the case of one variable. It is important for me to have an optimised 1-variable case. And also this behaviour is the one already existing for free pre-Lie algebras. But I agree that one could propose an option for the user to choose.\n\n6) another question that you did not ask but should have : the treatment of variable names is not exactly the same as for polynomials, for example, using 'x,y' will do something strange. I do not know how to enhance this. Free pre-Lie, Zinbiel and Dendriform algebras suffer from the same strangeness.",
    "created_at": "2017-07-12T19:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351578",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

Preliminary remark: this implementation has been made by copy-modifying the existing implementation of free pre-Lie algebras, which has therefore almost exactly the same issues. And something very similar was done for free Dendriform algebras recently.

1) The fact that Trees is not a basis does not prevent anything from working. As stated as a comment in the code, it would be good to have classes for `LabelledRootedTrees` with restricted labellings. But this is not really required here.

2) `algebra_generators` is indeed some kind of misnomer. These elements are the generators of the primitives as a free pre-Lie algebra. They also span the space on which the underlying functorial construction (vector species of labelled forests) is based. I would be ok to remove `algebra_generators` but would like to keep gen and gens

3) I have tried to clarify the doc by using "forest" consistently

4) I have changed the coercion as suggested

5) Concerning the use of unlabelled trees for the case of one variable. It is important for me to have an optimised 1-variable case. And also this behaviour is the one already existing for free pre-Lie algebras. But I agree that one could propose an option for the user to choose.

6) another question that you did not ask but should have : the treatment of variable names is not exactly the same as for polynomials, for example, using 'x,y' will do something strange. I do not know how to enhance this. Free pre-Lie, Zinbiel and Dendriform algebras suffer from the same strangeness.



---

archive/issue_comments_351579.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n1) Okay. Worth a warning in the doc though -- I can easily imagine some tests failing because of this, and worse, someone could try checking an identity by bruting through the basis, unaware of the fact that some of the elements don't belong into the algebra and probably don't behave accordingly.\n\n2) I am fine with `gen` and `gens`; it's just the `algebra_generators` part I don't like.\n\n3, 4) Thank you!\n\n5) I understand you want the optimized code there; all I'm saying is there should also be a way to get the non-optimized one. Ideally there should be a difference between `algebras.GrossmanLarson(QQ, ['x'])` (unoptimized) and `algebras.GrossmanLarson(QQ)` (default value None, optimized). If the `Alphabet` constructor confuses the difference between these two inputs, I'm in favor of setting an extra variable for this.\n\nIf I pass an explicit list of variable names to `algebras.GrossmanLarson`, then I want to be able to construct basis elements of this algebra in a sane way. Since `gen`/`gens` is insufficient (those aren't algebra generators), this means passing actual labelled forests. And in order to construct the forest, I need to know the labels -- ideally, the labels I provided myself. If the labels at n = 1 are different from the ones I provided, I need to write a fugly special-casing code. Now that I'm thinking this out aloud, I guess we also need to expose ROOT at the level of the `GrossmanLarson` class...\n\n6) Are you just saying that shorthands, such as `'x,y'` for `['x','y']`, are not correctly understood? I don't mind this much, although a doc warning wouldn't be out of place.\n\nI wasn't fully aware that we had free pre-Lie, Zinbiel and dendriform algebras in Sage already; time is passing fast! I'm wondering if we can make QSym into a dendriform algebra, as the relevant operations are in the code already...\n\n[By the way, I'm at my parents' home in Karlsruhe until the end of August -- consider yourself invited! In order to do any serious Sage coding, I'll have to install it on my laptop though, as opposed to sshing into Minneapolis...]",
    "created_at": "2017-07-12T21:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351579",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:20" align="right">comment:20</div>

1) Okay. Worth a warning in the doc though -- I can easily imagine some tests failing because of this, and worse, someone could try checking an identity by bruting through the basis, unaware of the fact that some of the elements don't belong into the algebra and probably don't behave accordingly.

2) I am fine with `gen` and `gens`; it's just the `algebra_generators` part I don't like.

3, 4) Thank you!

5) I understand you want the optimized code there; all I'm saying is there should also be a way to get the non-optimized one. Ideally there should be a difference between `algebras.GrossmanLarson(QQ, ['x'])` (unoptimized) and `algebras.GrossmanLarson(QQ)` (default value None, optimized). If the `Alphabet` constructor confuses the difference between these two inputs, I'm in favor of setting an extra variable for this.

If I pass an explicit list of variable names to `algebras.GrossmanLarson`, then I want to be able to construct basis elements of this algebra in a sane way. Since `gen`/`gens` is insufficient (those aren't algebra generators), this means passing actual labelled forests. And in order to construct the forest, I need to know the labels -- ideally, the labels I provided myself. If the labels at n = 1 are different from the ones I provided, I need to write a fugly special-casing code. Now that I'm thinking this out aloud, I guess we also need to expose ROOT at the level of the `GrossmanLarson` class...

6) Are you just saying that shorthands, such as `'x,y'` for `['x','y']`, are not correctly understood? I don't mind this much, although a doc warning wouldn't be out of place.

I wasn't fully aware that we had free pre-Lie, Zinbiel and dendriform algebras in Sage already; time is passing fast! I'm wondering if we can make QSym into a dendriform algebra, as the relevant operations are in the code already...

[By the way, I'm at my parents' home in Karlsruhe until the end of August -- consider yourself invited! In order to do any serious Sage coding, I'll have to install it on my laptop though, as opposed to sshing into Minneapolis...]



---

archive/issue_comments_351580.json:
```json
{
    "body": "Changed commit from **[33b2b4b](https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5)** to **[ac04ea4](https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a)**",
    "created_at": "2017-07-13T08:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351580",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[33b2b4b](https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5)** to **[ac04ea4](https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a)**



---

archive/issue_comments_351581.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a\">ac04ea4</a></td><td><code>trac 23406 more improvements</code></td></tr></table>\n",
    "created_at": "2017-07-13T08:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351581",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a">ac04ea4</a></td><td><code>trac 23406 more improvements</code></td></tr></table>




---

archive/issue_comments_351582.json:
```json
{
    "body": "Changed commit from **[ac04ea4](https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a)** to **[e13fb56](https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f)**",
    "created_at": "2017-07-13T08:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351582",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ac04ea4](https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a)** to **[e13fb56](https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f)**



---

archive/issue_comments_351583.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f\">e13fb56</a></td><td><code>trac 23406 details</code></td></tr></table>\n",
    "created_at": "2017-07-13T08:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351583",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f">e13fb56</a></td><td><code>trac 23406 details</code></td></tr></table>




---

archive/issue_comments_351584.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks for the invitation, I will think about it.\n\nI think I have now taken all your comments into account. I removed algebra generators. I have added some doc, and changed the behaviour of single-variate case, using `None` to get unlabelled trees.\n\nI forgot to answer your question on the isomorphism with the enveloping algebra. I think it holds over ZZ.\n\nI have made a follow-up ticket in #23431, to do the similar cleanup for free pre-Lie algebras.\n\nBy the way, we do not have yet categories for all these kinds of algebras. So it is not yet possible to turn Qsym into a dendriform algebra.",
    "created_at": "2017-07-14T08:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351584",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks for the invitation, I will think about it.

I think I have now taken all your comments into account. I removed algebra generators. I have added some doc, and changed the behaviour of single-variate case, using `None` to get unlabelled trees.

I forgot to answer your question on the isomorphism with the enveloping algebra. I think it holds over ZZ.

I have made a follow-up ticket in #23431, to do the similar cleanup for free pre-Lie algebras.

By the way, we do not have yet categories for all these kinds of algebras. So it is not yet possible to turn Qsym into a dendriform algebra.



---

archive/issue_comments_351585.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nStrong -1 on removing `algebra_generators`, especially in favor of `gens`, which does not take into account what structure you are considering (Darij, I think you even created the ticket about that). It makes no sense to have `gens` that constructs a tuple of a `Family` (if anything, it should just construct the tuple directly). Have the `Family` be the return value of `algebra_generators`.\n\nThere is another way to set the variable names. CFM now should take `names` and handle them properly. You can also use `_assign_names`. You may also want run either one of these (likely the former):\n\n```\nfrom sage.structure.category_object import normalize_names\nfrom sage.structure.indexed_generators import parse_indices_names\n```\nin the `__classcall_private__` for better standardization of input. I think it will be more robust than `Alphabet`, but it is a little more restrictive. At least IMO, it is easier to work with by your `gens` method (which restricts it to a finite generating set). Plus, in a way what you're doing is an abuse of the current framework. However, if you prefer the current approach, then I will not hold this ticket up for this.\n\nTechnically this comment is wrong\n\n```\n# after this line : coercion\n```\n`_element_constructor_` defines conversion.\n\nWhile the unicode does look nice, if there is no unicode support in the terminal, then the output of the examples is basically unreadable (I recently had to work with such a terminal). So I would prefer if the examples used `ascii_art`.",
    "created_at": "2017-07-14T13:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351585",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Strong -1 on removing `algebra_generators`, especially in favor of `gens`, which does not take into account what structure you are considering (Darij, I think you even created the ticket about that). It makes no sense to have `gens` that constructs a tuple of a `Family` (if anything, it should just construct the tuple directly). Have the `Family` be the return value of `algebra_generators`.

There is another way to set the variable names. CFM now should take `names` and handle them properly. You can also use `_assign_names`. You may also want run either one of these (likely the former):

```
from sage.structure.category_object import normalize_names
from sage.structure.indexed_generators import parse_indices_names
```
in the `__classcall_private__` for better standardization of input. I think it will be more robust than `Alphabet`, but it is a little more restrictive. At least IMO, it is easier to work with by your `gens` method (which restricts it to a finite generating set). Plus, in a way what you're doing is an abuse of the current framework. However, if you prefer the current approach, then I will not hold this ticket up for this.

Technically this comment is wrong

```
# after this line : coercion
```
`_element_constructor_` defines conversion.

While the unicode does look nice, if there is no unicode support in the terminal, then the output of the examples is basically unreadable (I recently had to work with such a terminal). So I would prefer if the examples used `ascii_art`.



---

archive/issue_comments_351586.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI will come back to a proper review of this later today, but for now, a brief response about `gens`: I have gotten used to `gens` being a context-dependent portmanteau. Meanwhile, `algebra_generators` should return algebra generators.\n\nWhat about `single_vertex`?\n\nAs usual, I have nothing to say about standardization of input :/",
    "created_at": "2017-07-14T13:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351586",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:25" align="right">comment:25</div>

I will come back to a proper review of this later today, but for now, a brief response about `gens`: I have gotten used to `gens` being a context-dependent portmanteau. Meanwhile, `algebra_generators` should return algebra generators.

What about `single_vertex`?

As usual, I have nothing to say about standardization of input :/



---

archive/issue_comments_351587.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI have reviewed everything except for the technical functions (`__classcall_private__`, `__init__`, `_element_constructor_`). Travis, can you take a look at these?\n\nI also have added the antipode. (No unicode in the doctests, because unicode seems to break over my ssh connection. Sorry!)\n\nWarning: branch change incoming.\n\n(And yes, `itertools.product` and `itertools.combinations` are significantly faster than `cartesian_product` and `powerset`, respectively. I would also suspect that my `child_grafts` change speeds up the `except` case, since it would be computed twice before; but I haven't checked this.)",
    "created_at": "2017-07-15T01:11:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351587",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:26" align="right">comment:26</div>

I have reviewed everything except for the technical functions (`__classcall_private__`, `__init__`, `_element_constructor_`). Travis, can you take a look at these?

I also have added the antipode. (No unicode in the doctests, because unicode seems to break over my ssh connection. Sorry!)

Warning: branch change incoming.

(And yes, `itertools.product` and `itertools.combinations` are significantly faster than `cartesian_product` and `powerset`, respectively. I would also suspect that my `child_grafts` change speeds up the `except` case, since it would be computed twice before; but I haven't checked this.)



---

archive/issue_comments_351588.json:
```json
{
    "body": "Reviewer: **Darij Grinberg**",
    "created_at": "2017-07-15T01:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351588",
    "user": "https://github.com/darijgr"
}
```

Reviewer: **Darij Grinberg**



---

archive/issue_comments_351589.json:
```json
{
    "body": "Changed commit from **[e13fb56](https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f)** to none",
    "created_at": "2017-07-15T01:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351589",
    "user": "https://github.com/darijgr"
}
```

Changed commit from **[e13fb56](https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f)** to none



---

archive/issue_comments_351590.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23406](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23406)** to **[public/ticket/23406](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/23406)**",
    "created_at": "2017-07-15T01:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351590",
    "user": "https://github.com/darijgr"
}
```

Changed branch from **[u/chapoton/23406](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23406)** to **[public/ticket/23406](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/23406)**



---

archive/issue_comments_351591.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e\">94d3e59</a></td><td><code>basic implementation of the Grossman-Larson Hopf algebra of rooted forests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc\">1ce9214</a></td><td><code>doc detail on Grossman-Larson product</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5\">33b2b4b</a></td><td><code>trac 23406 some changes after reviewer's comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a\">ac04ea4</a></td><td><code>trac 23406 more improvements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f\">e13fb56</a></td><td><code>trac 23406 details</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c\">e7a5d36</a></td><td><code>review changes</code></td></tr></table>\n",
    "created_at": "2017-07-15T01:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351591",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94d3e59c6ab088f4fb3c75c3be1d126d2ca7053e">94d3e59</a></td><td><code>basic implementation of the Grossman-Larson Hopf algebra of rooted forests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ce921497ee441e3eac581eda8f28f90891334dc">1ce9214</a></td><td><code>doc detail on Grossman-Larson product</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33b2b4bd7c401df5b6ecd287855f329ca2fa68e5">33b2b4b</a></td><td><code>trac 23406 some changes after reviewer's comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac04ea4c9b60b9f12fe8d1c8686b896892b55b7a">ac04ea4</a></td><td><code>trac 23406 more improvements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e13fb56b00827d3ac8ee7fbbddf22cbdb782fe4f">e13fb56</a></td><td><code>trac 23406 details</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c">e7a5d36</a></td><td><code>review changes</code></td></tr></table>




---

archive/issue_comments_351592.json:
```json
{
    "body": "Commit: **[e7a5d36](https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c)**",
    "created_at": "2017-07-15T01:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351592",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[e7a5d36](https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c)**



---

archive/issue_comments_351593.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nPlease move the references to the master bibliography file, `doc/en/reference/references/index.rst`.",
    "created_at": "2017-07-15T01:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351593",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

Please move the references to the master bibliography file, `doc/en/reference/references/index.rst`.



---

archive/issue_comments_351594.json:
```json
{
    "body": "Changed commit from **[e7a5d36](https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c)** to **[b1afa9d](https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1)**",
    "created_at": "2017-07-15T09:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351594",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e7a5d36](https://github.com/sagemath/sagetrac-mirror/commit/e7a5d36a04b4e8ceef9d37e2797fa0fc037cae7c)** to **[b1afa9d](https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1)**



---

archive/issue_comments_351595.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1\">b1afa9d</a></td><td><code>move references to master index</code></td></tr></table>\n",
    "created_at": "2017-07-15T09:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351595",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1">b1afa9d</a></td><td><code>move references to master index</code></td></tr></table>




---

archive/issue_comments_351596.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThere are some problems with `_element_constructor_` being too permissive:\n\n```\nsage: R.<x,y> = algebras.GrossmanLarson(QQ)\nsage: S.<z> = algebras.GrossmanLarson(GF(3))\nsage: R(z)\nB[#[z[]]]\nsage: R(2*z)^2\nB[#[z[z[]]]] + B[#[z[], z[]]]\nsage: (2*x)^2\n4*B[#[x[x[]]]] + 4*B[#[x[], x[]]]\n```\nThis is a *conversion*, so it doesn't care about the output of `_coerce_map_from_`. A different (but somewhat entangled) problem:\n\n```\nsage: S(x)\n...\nRuntimeError: maximum recursion depth exceeded while getting the str of an object\n```\nwhich seems to stem from the containment check `if x in self.basis().keys()`. Note that this \"works\":\n\n```\nsage: S(x.leading_support())\nB[#[x[]]]\n```\nSo the fix is to check to make sure. Same issue for\n\n```\nsage: P.<a> = QQ[]\nsage: S(2*a + 2)\n...\nRuntimeError: maximum recursion depth exceeded while getting the str of an object\n```\n\nSo does `x*y` correspond to taking the Lie bracket or their universal enveloping algebra (UEA) product? At least it seems to me that it is the latter (the former would mean `x*y = -y*x`, which is not the case), in which case they are algebra generators as every element in the Lie algebra is the commutator bracket, which then allows you to get every element the UEA by PBW. Thus it would be okay to call them `algebra_generators`.\n\nOtherwise I really do not like the fact that `gens` does not generate the Grossman-Larson algebra under any structure. In which case, you should instead override `_first_ngens` to return the corresponding variable names to allow the `R.<x,y>` syntax.\n\n@darijgr, I don't understand what you are proposing for `single_vertex`. As an alternative to `gens`?\n\nEverything else of [comment:24](#comment:24) still applies.",
    "created_at": "2017-07-16T00:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351596",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:31" align="right">comment:31</div>

There are some problems with `_element_constructor_` being too permissive:

```
sage: R.<x,y> = algebras.GrossmanLarson(QQ)
sage: S.<z> = algebras.GrossmanLarson(GF(3))
sage: R(z)
B[#[z[]]]
sage: R(2*z)^2
B[#[z[z[]]]] + B[#[z[], z[]]]
sage: (2*x)^2
4*B[#[x[x[]]]] + 4*B[#[x[], x[]]]
```
This is a *conversion*, so it doesn't care about the output of `_coerce_map_from_`. A different (but somewhat entangled) problem:

```
sage: S(x)
...
RuntimeError: maximum recursion depth exceeded while getting the str of an object
```
which seems to stem from the containment check `if x in self.basis().keys()`. Note that this "works":

```
sage: S(x.leading_support())
B[#[x[]]]
```
So the fix is to check to make sure. Same issue for

```
sage: P.<a> = QQ[]
sage: S(2*a + 2)
...
RuntimeError: maximum recursion depth exceeded while getting the str of an object
```

So does `x*y` correspond to taking the Lie bracket or their universal enveloping algebra (UEA) product? At least it seems to me that it is the latter (the former would mean `x*y = -y*x`, which is not the case), in which case they are algebra generators as every element in the Lie algebra is the commutator bracket, which then allows you to get every element the UEA by PBW. Thus it would be okay to call them `algebra_generators`.

Otherwise I really do not like the fact that `gens` does not generate the Grossman-Larson algebra under any structure. In which case, you should instead override `_first_ngens` to return the corresponding variable names to allow the `R.<x,y>` syntax.

@darijgr, I don't understand what you are proposing for `single_vertex`. As an alternative to `gens`?

Everything else of [comment:24](#comment:24) still applies.



---

archive/issue_comments_351597.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nYes, I am suggesting `single_vertex` as an alternative name to `gens`.\n\n`x*y` corresponds to the UEA product. But the Lie algebra is not generated by the `gens` as a Lie algebra! (It is generated by them as a pre-Lie algebra.)",
    "created_at": "2017-07-16T00:28:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351597",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:32" align="right">comment:32</div>

Yes, I am suggesting `single_vertex` as an alternative name to `gens`.

`x*y` corresponds to the UEA product. But the Lie algebra is not generated by the `gens` as a Lie algebra! (It is generated by them as a pre-Lie algebra.)



---

archive/issue_comments_351598.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThis is a little outside of my knowledge zone, so please bear with me. What you are saying is the entire Lie algebra is generated by `gens` under `*`, correct? So, by extension, it generates the entire algebra.",
    "created_at": "2017-07-16T00:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351598",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">comment:33</div>

This is a little outside of my knowledge zone, so please bear with me. What you are saying is the entire Lie algebra is generated by `gens` under `*`, correct? So, by extension, it generates the entire algebra.



---

archive/issue_comments_351599.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nNo. The Lie algebra is not generated by the `gens`. The pre-Lie algebra is generated by them.\n\nThe notation is quite confusing: A pre-Lie algebra is *not* \"a Lie algebra without the Jacobi identity\". A pre-Lie algebra is a usual nonunital algebra whose multiplication satisfies something weaker than associativity. In order to obtain a Lie algebra from a pre-Lie algebra, you have to replace the \"product\" by its commutator (whereas obtaining a pre-Lie algebra from an associative algebra requires doing nothing). So a pre-Lie algebra should perhaps rather be called a pre-associative algebra.",
    "created_at": "2017-07-16T01:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351599",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:34" align="right">comment:34</div>

No. The Lie algebra is not generated by the `gens`. The pre-Lie algebra is generated by them.

The notation is quite confusing: A pre-Lie algebra is *not* "a Lie algebra without the Jacobi identity". A pre-Lie algebra is a usual nonunital algebra whose multiplication satisfies something weaker than associativity. In order to obtain a Lie algebra from a pre-Lie algebra, you have to replace the "product" by its commutator (whereas obtaining a pre-Lie algebra from an associative algebra requires doing nothing). So a pre-Lie algebra should perhaps rather be called a pre-associative algebra.



---

archive/issue_comments_351600.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHowever, is the Lie algebra of primitives the Lie given by the commutators of the pre-Lie algebra given by `gens`? At least I do not understand elements are not able to be generated by `gens` under `*`.",
    "created_at": "2017-07-16T03:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351600",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

However, is the Lie algebra of primitives the Lie given by the commutators of the pre-Lie algebra given by `gens`? At least I do not understand elements are not able to be generated by `gens` under `*`.



---

archive/issue_comments_351601.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThere are 3 different products at play here (plus a coproduct) :\n\n* the Lie bracket [,]\n* the UEA associative product, call it *\n* the non-associative product of free pre-Lie algebras, call it <\n\nThe Lie bracket (on the span Prim(GL) of rooted trees) is the commutator of both * and <\n\nThen \"gens\" do generate Prim(GL) as a free pre-Lie algebra (under <), but not as a Lie algebra. Think of the one variable case, where the free Lie algebra is one dimensional, whereas the free pre-Lie algebra is the span of rooted trees. It is a theorem that the space Prim(GL) is free as a Lie algebra, but on an infinite set of generators.\n\nTherefore the \"gens\" do no generate GL as an associative algebra, as the correct generators are the same infinite set.",
    "created_at": "2017-07-16T07:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351601",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:36" align="right">comment:36</div>

There are 3 different products at play here (plus a coproduct) :

* the Lie bracket [,]
* the UEA associative product, call it *
* the non-associative product of free pre-Lie algebras, call it <

The Lie bracket (on the span Prim(GL) of rooted trees) is the commutator of both * and <

Then "gens" do generate Prim(GL) as a free pre-Lie algebra (under <), but not as a Lie algebra. Think of the one variable case, where the free Lie algebra is one dimensional, whereas the free pre-Lie algebra is the span of rooted trees. It is a theorem that the space Prim(GL) is free as a Lie algebra, but on an infinite set of generators.

Therefore the "gens" do no generate GL as an associative algebra, as the correct generators are the same infinite set.



---

archive/issue_comments_351602.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nOh, I see, the `*` does not correspond to the pre-Lie product <, that was what I was missing. So the issue is more of the fact we only have one distributive binary operation `*`, which you want it to be the UEA product (if we were in Python3, we could use `@`/`__matmul__` for the other). Do we want to support the pre-Lie product, and if so, how? One way would be to use `**` between two elements to mean the pre-Lie product. It would be a bit of a hackaround, but I don't see a use for `x ** y` otherwise.\n\nAs for the name, how about explicitly saying `pre_lie_generators`? I would also say we should do a custom `_first_ngens` to support `R.<x> = GL()` syntax.",
    "created_at": "2017-07-16T14:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351602",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

Oh, I see, the `*` does not correspond to the pre-Lie product <, that was what I was missing. So the issue is more of the fact we only have one distributive binary operation `*`, which you want it to be the UEA product (if we were in Python3, we could use `@`/`__matmul__` for the other). Do we want to support the pre-Lie product, and if so, how? One way would be to use `**` between two elements to mean the pre-Lie product. It would be a bit of a hackaround, but I don't see a use for `x ** y` otherwise.

As for the name, how about explicitly saying `pre_lie_generators`? I would also say we should do a custom `_first_ngens` to support `R.<x> = GL()` syntax.



---

archive/issue_comments_351603.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nIs there a pre-Lie product on the UEA at all? That's an actual question, which I am curious about. It's not per se obvious to me that a pre-Lie product on a Lie algebra automatically gives rise to a pre-Lie product on its UEA; but it sounds like the kind of statement that could be a theorem.\n\n(Baby example: Does the symmetric algebra of a commutative algebra have a canonical pre-Lie product that is different from just the usual multiplication in the symmetric algebra?)",
    "created_at": "2017-07-16T14:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351603",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:38" align="right">comment:38</div>

Is there a pre-Lie product on the UEA at all? That's an actual question, which I am curious about. It's not per se obvious to me that a pre-Lie product on a Lie algebra automatically gives rise to a pre-Lie product on its UEA; but it sounds like the kind of statement that could be a theorem.

(Baby example: Does the symmetric algebra of a commutative algebra have a canonical pre-Lie product that is different from just the usual multiplication in the symmetric algebra?)



---

archive/issue_comments_351604.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThere is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.\n\nI think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.",
    "created_at": "2017-07-16T16:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351604",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:39" align="right">comment:39</div>

There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.

I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.



---

archive/issue_comments_351605.json:
```json
{
    "body": "Changed commit from **[b1afa9d](https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1)** to **[29c72a3](https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06)**",
    "created_at": "2017-07-16T18:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351605",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b1afa9d](https://github.com/sagemath/sagetrac-mirror/commit/b1afa9dec8b1356b807f37cd4e80606dbf1c8bb1)** to **[29c72a3](https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06)**



---

archive/issue_comments_351606.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a192c4aa8a9736b21df6a93e581448d5ae7a6987\">a192c4a</a></td><td><code>Merge branch 'public/ticket/23406' in 8.0.rc2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06\">29c72a3</a></td><td><code>trac 23406 ascii art instead of unicode art</code></td></tr></table>\n",
    "created_at": "2017-07-16T18:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351606",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a192c4aa8a9736b21df6a93e581448d5ae7a6987">a192c4a</a></td><td><code>Merge branch 'public/ticket/23406' in 8.0.rc2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06">29c72a3</a></td><td><code>trac 23406 ascii art instead of unicode art</code></td></tr></table>




---

archive/issue_comments_351607.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02\">49055e4</a></td><td><code>trac 23406 testing also the antipode, shorter TestSuites</code></td></tr></table>\n",
    "created_at": "2017-07-16T19:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351607",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02">49055e4</a></td><td><code>trac 23406 testing also the antipode, shorter TestSuites</code></td></tr></table>




---

archive/issue_comments_351608.json:
```json
{
    "body": "Changed commit from **[29c72a3](https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06)** to **[49055e4](https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02)**",
    "created_at": "2017-07-16T19:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351608",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[29c72a3](https://github.com/sagemath/sagetrac-mirror/commit/29c72a361944f53889ed9959e4af22d873527b06)** to **[49055e4](https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02)**



---

archive/issue_comments_351609.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@fchapoton](#comment:39):\n> There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.\n\nIt is possible to define an operation restricted to a particular subset (e.g., inverse). The question becomes do we want to have another operation defined on the primitive subspace? For Lie algebras, this is not a problem because `x.bracket(y)` goes to `Ux.bracket(Uy)` and coercion should take care of the other combinations. Also in that case, the method `bracket()` is taking the place of the second operation.\n\nI guess in either case we would want `*` to be the UEA product, so adding such a feature could be pushed off to another ticket. I'm also becoming more okay with using `gens` without such a feature, but I am not 100% there yet. However, `pre_lie_algebra_generators` is a bad name. How about `primitive_generators`?\n\n> I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.\n\nFor that, all you need to do is have `_construct_UEA` return the corresponding GL algebra and define `lift` for the corresponding element class. I guess you would also then need to add to `_coerce_map_from_`\n\n```\nif isinstance(L, FreePreLieAlgebra):\n    return self.coerce_map_from(L.universal_enveloping_algebra())\n```\nas `L.universal_enveloping_algebra()` automatically registers the coercion to its UEA and the coercion framework would take care of the rest. That on top of #23431 should give you what you want. However, I'm okay with that being another ticket.",
    "created_at": "2017-07-16T22:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351609",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@fchapoton](#comment:39):
> There is no pre-Lie product on the UEA. The pre-Lie product exists only on the primitive subspace of GL.

It is possible to define an operation restricted to a particular subset (e.g., inverse). The question becomes do we want to have another operation defined on the primitive subspace? For Lie algebras, this is not a problem because `x.bracket(y)` goes to `Ux.bracket(Uy)` and coercion should take care of the other combinations. Also in that case, the method `bracket()` is taking the place of the second operation.

I guess in either case we would want `*` to be the UEA product, so adding such a feature could be pushed off to another ticket. I'm also becoming more okay with using `gens` without such a feature, but I am not 100% there yet. However, `pre_lie_algebra_generators` is a bad name. How about `primitive_generators`?

> I think I would like (later) to have the inclusion morphism from the Lie algebra `algebras.FreePreLie` to its UEA, namely GL. But not for this ticket.

For that, all you need to do is have `_construct_UEA` return the corresponding GL algebra and define `lift` for the corresponding element class. I guess you would also then need to add to `_coerce_map_from_`

```
if isinstance(L, FreePreLieAlgebra):
    return self.coerce_map_from(L.universal_enveloping_algebra())
```
as `L.universal_enveloping_algebra()` automatically registers the coercion to its UEA and the coercion framework would take care of the rest. That on top of #23431 should give you what you want. However, I'm okay with that being another ticket.



---

archive/issue_comments_351610.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6\">b0dadb4</a></td><td><code>trac 23406 better (stricter) conversion</code></td></tr></table>\n",
    "created_at": "2017-07-17T09:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351610",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6">b0dadb4</a></td><td><code>trac 23406 better (stricter) conversion</code></td></tr></table>




---

archive/issue_comments_351611.json:
```json
{
    "body": "Changed commit from **[49055e4](https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02)** to **[b0dadb4](https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6)**",
    "created_at": "2017-07-17T09:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351611",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[49055e4](https://github.com/sagemath/sagetrac-mirror/commit/49055e4ec6a3ae0a16ce806df2712b458e250e02)** to **[b0dadb4](https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6)**



---

archive/issue_comments_351612.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/963c5eb6c741ead3e7d14acbb85a3857c7b22604\">963c5eb</a></td><td><code>Merge branch 'public/ticket/23406' in 8.1.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65\">117ad0d</a></td><td><code>trac 23406 some details</code></td></tr></table>\n",
    "created_at": "2017-09-13T14:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351612",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/963c5eb6c741ead3e7d14acbb85a3857c7b22604">963c5eb</a></td><td><code>Merge branch 'public/ticket/23406' in 8.1.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65">117ad0d</a></td><td><code>trac 23406 some details</code></td></tr></table>




---

archive/issue_comments_351613.json:
```json
{
    "body": "Changed commit from **[b0dadb4](https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6)** to **[117ad0d](https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65)**",
    "created_at": "2017-09-13T14:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351613",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b0dadb4](https://github.com/sagemath/sagetrac-mirror/commit/b0dadb4ae26e6692caeb1404dc79dbe8f51118b6)** to **[117ad0d](https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65)**



---

archive/issue_comments_351614.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThere is still a controversy about the naming of the methods `gen`, `gens` and `algebra_generators`.\n\nMy choice by decreasing order of preference:\n\n1) use \"gen\" and \"gens\" (because these are not algebra generators)\n\n2) use \"single_vertex\"\n\n3) use \"prelie_generators\" (but they do not generate as a pre-Lie algebra !)\n\nCan we try to agree on something ?",
    "created_at": "2017-09-13T15:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351614",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:45" align="right">comment:45</div>

There is still a controversy about the naming of the methods `gen`, `gens` and `algebra_generators`.

My choice by decreasing order of preference:

1) use "gen" and "gens" (because these are not algebra generators)

2) use "single_vertex"

3) use "prelie_generators" (but they do not generate as a pre-Lie algebra !)

Can we try to agree on something ?



---

archive/issue_events_325787.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-13T15:02:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325787"
}
```



---

archive/issue_events_325788.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-13T15:02:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325788"
}
```



---

archive/issue_comments_351615.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI'm in favor of option 2.",
    "created_at": "2017-09-13T15:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351615",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:46" align="right">comment:46</div>

I'm in favor of option 2.



---

archive/issue_comments_351616.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nOkay, I had to re-familiarize myself with the discussion. So, I agree with Darij and think option 2 is the best way forward so we do not further muddy the `gens` ambiguity.\n\nPS - I just thought of the operator `<<` for the pre-Lie product, but unfortunately, that is lower priority than `+-`.",
    "created_at": "2017-09-14T05:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351616",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:47" align="right">comment:47</div>

Okay, I had to re-familiarize myself with the discussion. So, I agree with Darij and think option 2 is the best way forward so we do not further muddy the `gens` ambiguity.

PS - I just thought of the operator `<<` for the pre-Lie product, but unfortunately, that is lower priority than `+-`.



---

archive/issue_comments_351617.json:
```json
{
    "body": "Changed commit from **[117ad0d](https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65)** to **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**",
    "created_at": "2017-09-14T08:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[117ad0d](https://github.com/sagemath/sagetrac-mirror/commit/117ad0da0e3a9839d8dba0af4186f89e47795e65)** to **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**



---

archive/issue_comments_351618.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5\">fbe95a9</a></td><td><code>trac 23406 using \"single_vertex\" instead of \"gen\"</code></td></tr></table>\n",
    "created_at": "2017-09-14T08:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351618",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5">fbe95a9</a></td><td><code>trac 23406 using "single_vertex" instead of "gen"</code></td></tr></table>




---

archive/issue_comments_351619.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nDone. I used `single_vertex` and `single_vertex_all`. I also had to override `_first_ngens`.",
    "created_at": "2017-09-14T08:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351619",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:49" align="right">comment:49</div>

Done. I used `single_vertex` and `single_vertex_all`. I also had to override `_first_ngens`.



---

archive/issue_comments_351620.json:
```json
{
    "body": "Changed reviewer from **Darij Grinberg** to **Darij Grinberg, Travis Scrimshaw**",
    "created_at": "2017-09-15T15:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351620",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Darij Grinberg** to **Darij Grinberg, Travis Scrimshaw**



---

archive/issue_events_325789.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T15:43:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325789"
}
```



---

archive/issue_events_325790.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T15:43:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325790"
}
```



---

archive/issue_comments_351621.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nThank you. Since all comments have been addressed, I am setting this to a positive review.",
    "created_at": "2017-09-15T15:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351621",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:50" align="right">comment:50</div>

Thank you. Since all comments have been addressed, I am setting this to a positive review.



---

archive/issue_comments_351622.json:
```json
{
    "body": "Changed branch from **[public/ticket/23406](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/23406)** to **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**",
    "created_at": "2017-09-18T22:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23406#issuecomment-351622",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/23406](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/23406)** to **[fbe95a9](https://github.com/sagemath/sagetrac-mirror/commit/fbe95a961f0d1ef74eaf5e625dbd1bae2fd44cd5)**



---

archive/issue_events_325791.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-18T22:15:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325791"
}
```



---

archive/issue_events_325792.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "eefc6e88b42e56116aa7114501379ef2a20aa854",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-18T22:15:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23406",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23406#event-325792"
}
```
