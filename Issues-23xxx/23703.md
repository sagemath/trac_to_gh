# Issue 23703: free_quadratic_module intersection returns wrong result

archive/issues_023466.json:
```json
{
    "body": "The first intersection is good. The second is nonsense.\n\n```\nsage: A=FreeQuadraticModule(ZZ,1,matrix.identity(1))\nsage: B=A.span([[1/2]])\nsage: C=B.span([[1]])\nsage: B.intersection(C)\n\nFree module of degree 1 and rank 1 over Integer Ring\nEchelon basis matrix:\n[1]\nsage: C.intersection(B)\n\nFree module of degree 1 and rank 1 over Integer Ring\nEchelon basis matrix:\n[1/2]\n```\nIt must be the free_quadratic_module code as the free module stuff seems to work\n\n```\nsage: A=FreeModule(ZZ,1)\nsage: B=A.span([[1/2]])\nsage: C=B.span([[1]])\nsage: C.intersection(B)\n\nFree module of degree 1 and rank 1 over Integer Ring\nEchelon basis matrix:\n[1]\nsage: B.intersection(C)\n\nFree module of degree 1 and rank 1 over Integer Ring\nEchelon basis matrix:\n[1]\n\n```\n\nThis also breaks functions using intersections e.g. module homomorphisms of quotients.\n\nKeywords: sd91\n\nBranch/Commit: 2e4138f03c136a2824d3164d5dcd6289687e25c4\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Simon Brandhorst\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23703\n\n",
    "closed_at": "2017-09-22T20:26:37Z",
    "created_at": "2017-08-24T17:53:18Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "free_quadratic_module intersection returns wrong result",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23703",
    "user": "https://github.com/simonbrandhorst"
}
```
The first intersection is good. The second is nonsense.

```
sage: A=FreeQuadraticModule(ZZ,1,matrix.identity(1))
sage: B=A.span([[1/2]])
sage: C=B.span([[1]])
sage: B.intersection(C)

Free module of degree 1 and rank 1 over Integer Ring
Echelon basis matrix:
[1]
sage: C.intersection(B)

Free module of degree 1 and rank 1 over Integer Ring
Echelon basis matrix:
[1/2]
```
It must be the free_quadratic_module code as the free module stuff seems to work

```
sage: A=FreeModule(ZZ,1)
sage: B=A.span([[1/2]])
sage: C=B.span([[1]])
sage: C.intersection(B)

Free module of degree 1 and rank 1 over Integer Ring
Echelon basis matrix:
[1]
sage: B.intersection(C)

Free module of degree 1 and rank 1 over Integer Ring
Echelon basis matrix:
[1]

```

This also breaks functions using intersections e.g. module homomorphisms of quotients.

Keywords: sd91

Branch/Commit: 2e4138f03c136a2824d3164d5dcd6289687e25c4

Reviewer: Frédéric Chapoton

Author: Simon Brandhorst

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23703





---

archive/issue_comments_328353.json:
```json
{
    "body": "Changing keywords from \"abelian group, quotient, homomorphism\" to \"sd91\".",
    "created_at": "2017-08-24T17:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328353",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing keywords from "abelian group, quotient, homomorphism" to "sd91".



---

archive/issue_comments_328354.json:
```json
{
    "body": "<a id='comment:3'></a>The story continues ... maybe this is the real bug?\n\n```\nsage: A=FreeQuadraticModule(ZZ,1,matrix.identity(1))\nsage: B=A.span([[1]])\nsage: B==B.ambient_vector_space()\nTrue\nsage: B=A.span([[1/2]])\nsage: B==B.ambient_vector_space()\nFalse\n```",
    "created_at": "2017-08-24T22:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328354",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:3'></a>The story continues ... maybe this is the real bug?

```
sage: A=FreeQuadraticModule(ZZ,1,matrix.identity(1))
sage: B=A.span([[1]])
sage: B==B.ambient_vector_space()
True
sage: B=A.span([[1/2]])
sage: B==B.ambient_vector_space()
False
```



---

archive/issue_comments_328355.json:
```json
{
    "body": "<a id='comment:4'></a>beware of #23646",
    "created_at": "2017-08-25T08:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328355",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>beware of #23646



---

archive/issue_comments_328356.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2017-09-19T20:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328356",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_328357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-19T20:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328357",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_328358.json:
```json
{
    "body": "<a id='comment:7'></a>You should keep all the doctests somewhere.",
    "created_at": "2017-09-20T06:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328358",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>You should keep all the doctests somewhere.



---

archive/issue_comments_328359.json:
```json
{
    "body": "<a id='comment:8'></a>I just checked: the old doctests did not even call the __richcmp__ methods defined.\nSo I will modify them old doctests.\n\nBtw in any case (old&new) we get:\n\n```\nsage: FreeQuadraticModule(ZZ,1,matrix.identity(1))==FreeQuadraticModule(ZZ,1,matrix.identity(1)*2)\nTrue\n```\nIs that a bug or a feature? I would consider two quadratic spaces with different inner products\nvery different and mathematically not equal. After all the inner product is the whole point of this class.",
    "created_at": "2017-09-20T06:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328359",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:8'></a>I just checked: the old doctests did not even call the __richcmp__ methods defined.
So I will modify them old doctests.

Btw in any case (old&new) we get:

```
sage: FreeQuadraticModule(ZZ,1,matrix.identity(1))==FreeQuadraticModule(ZZ,1,matrix.identity(1)*2)
True
```
Is that a bug or a feature? I would consider two quadratic spaces with different inner products
very different and mathematically not equal. After all the inner product is the whole point of this class.



---

archive/issue_comments_328360.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T08:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328361.json:
```json
{
    "body": "<a id='comment:10'></a>wrong syntax for the new doc.. \n\nwhen a line end with ::, it must be followd by an empty line. And the next lines must be indented by 4 spaces.",
    "created_at": "2017-09-20T11:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328361",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>wrong syntax for the new doc.. 

when a line end with ::, it must be followd by an empty line. And the next lines must be indented by 4 spaces.



---

archive/issue_comments_328362.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T13:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328363.json:
```json
{
    "body": "<a id='comment:12'></a>not fixed :\n\n```\n+    EXAMPLES::\n+\n+    We compare rank three free modules over the integers and\n+    rationals::\n+        sage: Q3 = FreeQuadraticModule(QQ,3,matrix.identity(3)) \n```",
    "created_at": "2017-09-20T15:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328363",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>not fixed :

```
+    EXAMPLES::
+
+    We compare rank three free modules over the integers and
+    rationals::
+        sage: Q3 = FreeQuadraticModule(QQ,3,matrix.identity(3)) 
```



---

archive/issue_comments_328364.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T18:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328365.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T18:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328365",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328366.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T19:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_328367.json:
```json
{
    "body": "<a id='comment:16'></a>Doctests pass and the html documentation builds (at least the free_quadratic_module part).",
    "created_at": "2017-09-20T19:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328367",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:16'></a>Doctests pass and the html documentation builds (at least the free_quadratic_module part).



---

archive/issue_comments_328368.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-21T07:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328368",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_328369.json:
```json
{
    "body": "<a id='comment:17'></a>ok then.",
    "created_at": "2017-09-21T07:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328369",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>ok then.



---

archive/issue_events_060567.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-22T20:26:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23703#event-60567"
}
```



---

archive/issue_comments_328370.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-22T20:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23703#issuecomment-328370",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
