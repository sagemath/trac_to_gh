# Issue 23352: Fix random matrix_gfpn_dense

archive/issues_023115.json:
```json
{
    "assignees": [],
    "body": "I just noticed that, when meataxe is installed and its Sage wrapper is used for matrices over `GF(p^n)` with `p` odd and `p^n<255`, then at least in some cases the random matrices aren't sufficiently random:\n\n```\nsage: random_matrix(GF(9,'x'), 5)\n[      x 2*x + 1   x + 2   x + 2       0]\n[  x + 1       x   x + 2   x + 1       0]\n[  x + 1       2   x + 1       2       0]\n[      x     2*x       x   x + 1       0]\n[2*x + 1       0 2*x + 1 2*x + 2       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      2   x + 1   x + 1 2*x + 2       0]\n[      x 2*x + 2   x + 2     2*x       0]\n[  x + 2     2*x       0 2*x + 2       0]\n[    2*x       2       2       1       0]\n[  x + 2       2     2*x       1       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      2 2*x + 1       x 2*x + 1       0]\n[2*x + 2       0 2*x + 2       x       0]\n[      2       x 2*x + 1   x + 2       0]\n[      0 2*x + 1       x       x       0]\n[      1       1       2   x + 1       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      x   x + 1       0       0       0]\n[      1   x + 1       0 2*x + 1       0]\n[      2       0       x   x + 2       0]\n[      2       0   x + 1   x + 2       0]\n[      x   x + 1     2*x       1       0]\n```\nSo, the last column always is zero, which shouldn't be the case.\n\nKeywords: **meataxe random, days88, IMA coding sprints**\n\nBranch/Commit: **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**\n\nReviewer: **Jeroen Demeyer, Travis Scrimshaw**\n\nAuthor: **Simon King**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23352_\n\n",
    "closed_at": "2017-08-29T19:51:06Z",
    "created_at": "2017-07-02T13:43:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix random matrix_gfpn_dense",
    "type": "issue",
    "updated_at": "2017-08-29T19:51:06Z",
    "url": "https://github.com/sagemath/sage/issues/23352",
    "user": "https://github.com/simon-king-jena"
}
```
I just noticed that, when meataxe is installed and its Sage wrapper is used for matrices over `GF(p^n)` with `p` odd and `p^n<255`, then at least in some cases the random matrices aren't sufficiently random:

```
sage: random_matrix(GF(9,'x'), 5)
[      x 2*x + 1   x + 2   x + 2       0]
[  x + 1       x   x + 2   x + 1       0]
[  x + 1       2   x + 1       2       0]
[      x     2*x       x   x + 1       0]
[2*x + 1       0 2*x + 1 2*x + 2       0]
sage: random_matrix(GF(9,'x'), 5)
[      2   x + 1   x + 1 2*x + 2       0]
[      x 2*x + 2   x + 2     2*x       0]
[  x + 2     2*x       0 2*x + 2       0]
[    2*x       2       2       1       0]
[  x + 2       2     2*x       1       0]
sage: random_matrix(GF(9,'x'), 5)
[      2 2*x + 1       x 2*x + 1       0]
[2*x + 2       0 2*x + 2       x       0]
[      2       x 2*x + 1   x + 2       0]
[      0 2*x + 1       x       x       0]
[      1       1       2   x + 1       0]
sage: random_matrix(GF(9,'x'), 5)
[      x   x + 1       0       0       0]
[      1   x + 1       0 2*x + 1       0]
[      2       0       x   x + 2       0]
[      2       0   x + 1   x + 2       0]
[      x   x + 1     2*x       1       0]
```
So, the last column always is zero, which shouldn't be the case.

Keywords: **meataxe random, days88, IMA coding sprints**

Branch/Commit: **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**

Author: **Simon King**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/23352_





---

archive/issue_events_326671.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326671"
}
```



---

archive/issue_events_326672.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326672"
}
```



---

archive/issue_events_326673.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326673"
}
```



---

archive/issue_events_326674.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326674"
}
```



---

archive/issue_comments_350577.json:
```json
{
    "body": "Branch: **[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)**",
    "created_at": "2017-07-07T13:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350577",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)**



---

archive/issue_comments_350578.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350578",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_350579.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.\n\nThe problem was: In the old code, the LOWEST bits of the last byte have been filled.\n\nI fixed it by explicitly assigning random numbers to the last few entries (instead of trying to fill a whole block of entries).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022\"><code>3297b21</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350579",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.

The problem was: In the old code, the LOWEST bits of the last byte have been filled.

I fixed it by explicitly assigning random numbers to the last few entries (instead of trying to fill a whole block of entries).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022"><code>3297b21</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_comments_350580.json:
```json
{
    "body": "Commit: **[`3297b21`](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)**",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350580",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`3297b21`](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)**



---

archive/issue_events_326675.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-07T13:24:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326675"
}
```



---

archive/issue_events_326676.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:18:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326676"
}
```



---

archive/issue_events_326677.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:18:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326677"
}
```



---

archive/issue_comments_350581.json:
```json
{
    "body": "Dependencies: **#21437**",
    "created_at": "2017-07-08T16:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350581",
    "user": "https://github.com/simon-king-jena"
}
```

Dependencies: **#21437**



---

archive/issue_comments_350582.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSooner or later this ticket needs to be merged with #21437. There is a merge conflict, and `git mergetool` doesn't work reasonably (namely: It shows me numerous conflicts, although the diff from this ticket is very small).\n\nTherefore I will *rebase* this ticket on top of #21437 and force-push it.",
    "created_at": "2017-07-08T16:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350582",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Sooner or later this ticket needs to be merged with #21437. There is a merge conflict, and `git mergetool` doesn't work reasonably (namely: It shows me numerous conflicts, although the diff from this ticket is very small).

Therefore I will *rebase* this ticket on top of #21437 and force-push it.



---

archive/issue_comments_350583.json:
```json
{
    "body": "Changed commit from **[`3297b21`](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)** to **[`6e33226`](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)**",
    "created_at": "2017-07-08T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350583",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3297b21`](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)** to **[`6e33226`](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)**



---

archive/issue_comments_350584.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3\"><code>291f4dc</code></a></td><td><code>Some minor tweaks for performance</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44\"><code>03ce5c0</code></a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0\"><code>5ed2269</code></a></td><td><code>Fix one doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6\"><code>d4dc794</code></a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce\"><code>413e4a9</code></a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e\"><code>d943f93</code></a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff\"><code>c929fcc</code></a></td><td><code>Remove unused MTX* environment variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681\"><code>b70bc5f</code></a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa\"><code>04e7986</code></a></td><td><code>Improve use of sig_on/off/check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0\"><code>6e33226</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-08T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350584",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3"><code>291f4dc</code></a></td><td><code>Some minor tweaks for performance</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44"><code>03ce5c0</code></a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0"><code>5ed2269</code></a></td><td><code>Fix one doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6"><code>d4dc794</code></a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce"><code>413e4a9</code></a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e"><code>d943f93</code></a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff"><code>c929fcc</code></a></td><td><code>Remove unused MTX* environment variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681"><code>b70bc5f</code></a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa"><code>04e7986</code></a></td><td><code>Improve use of sig_on/off/check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0"><code>6e33226</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_events_326678.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326678"
}
```



---

archive/issue_events_326679.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326679"
}
```



---

archive/issue_comments_350585.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDon't be scared. All but the last commit belong to #21437. Yes, I still believe that git commits *belong* to a ticket...\n\nAnyway, I think it is logical to put a ticket that fixes random meataxe matrices on top of a ticket that fixes other aspects of meataxe matrices.",
    "created_at": "2017-07-08T16:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350585",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Don't be scared. All but the last commit belong to #21437. Yes, I still believe that git commits *belong* to a ticket...

Anyway, I think it is logical to put a ticket that fixes random meataxe matrices on top of a ticket that fixes other aspects of meataxe matrices.



---

archive/issue_comments_350586.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nJeroen suggested on #21437 to distribute different aspects of the work in a new way. I think this ticket fits best for the topic \"bug fixes\". So, I'll rename the ticket a couple of commits. The tests should pass with the branch that I'll force-push in a minute.",
    "created_at": "2017-07-10T16:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350586",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

Jeroen suggested on #21437 to distribute different aspects of the work in a new way. I think this ticket fits best for the topic "bug fixes". So, I'll rename the ticket a couple of commits. The tests should pass with the branch that I'll force-push in a minute.



---

archive/issue_comments_350587.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,3 +27,7 @@\n [      x   x + 1     2*x       1       0]\n ```\n So, the last column always is zero, which shouldn't be the case.\n+\n+In addition, reading a meataxe matrix from a non-existing file would currently crash.\n+\n+And finally, the current way of pickling would be machine dependent. That should be fixed as well.\n``````\n",
    "created_at": "2017-07-10T16:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350587",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,3 +27,7 @@
 [      x   x + 1     2*x       1       0]
 ```
 So, the last column always is zero, which shouldn't be the case.
+
+In addition, reading a meataxe matrix from a non-existing file would currently crash.
+
+And finally, the current way of pickling would be machine dependent. That should be fixed as well.
``````




---

archive/issue_events_326680.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T16:35:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "title_is": "Some bug fixes for matrix_gfpn_dense",
    "title_was": "Fix random matrix_gfpn_dense",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326680"
}
```



---

archive/issue_comments_350588.json:
```json
{
    "body": "Changed commit from **[`6e33226`](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)** to **[`225afe1`](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)**",
    "created_at": "2017-07-10T16:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350588",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6e33226`](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)** to **[`225afe1`](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)**



---

archive/issue_comments_350589.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1aef56c4a1cf9e127ad3ae80b6350719edfe49f\"><code>b1aef56</code></a></td><td><code>Add MeatAxe patch that ensures correct value of FfCurrentRowSizeIo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a44a58a597e8a10e8de174eb1c61c5c6be9ac8cf\"><code>a44a58a</code></a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91ac93fb302bcbd8380371f57bdbaa7716575bcb\"><code>91ac93f</code></a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0\"><code>225afe1</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-10T16:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350589",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1aef56c4a1cf9e127ad3ae80b6350719edfe49f"><code>b1aef56</code></a></td><td><code>Add MeatAxe patch that ensures correct value of FfCurrentRowSizeIo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a44a58a597e8a10e8de174eb1c61c5c6be9ac8cf"><code>a44a58a</code></a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91ac93fb302bcbd8380371f57bdbaa7716575bcb"><code>91ac93f</code></a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0"><code>225afe1</code></a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_comments_350590.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNeeds review...",
    "created_at": "2017-07-10T16:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350590",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Needs review...



---

archive/issue_comments_350591.json:
```json
{
    "body": "Changed commit from **[`225afe1`](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)** to **[`bd1f3f1`](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)**",
    "created_at": "2017-07-10T21:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350591",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`225afe1`](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)** to **[`bd1f3f1`](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)**



---

archive/issue_comments_350592.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9\"><code>bd1f3f1</code></a></td><td><code>Fix ticket number in deprecation warning</code></td></tr></table>\n",
    "created_at": "2017-07-10T21:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350592",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9"><code>bd1f3f1</code></a></td><td><code>Fix ticket number in deprecation warning</code></td></tr></table>




---

archive/issue_comments_350593.json:
```json
{
    "body": "Changed dependencies from **#21437** to none",
    "created_at": "2017-07-11T08:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350593",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#21437** to none



---

archive/issue_comments_350594.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@simon-king-jena](#comment:6):\n> Jeroen suggested on #21437 to distribute different aspects of the work in a new way.\n\nThat's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.",
    "created_at": "2017-07-12T12:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350594",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@simon-king-jena](#comment:6):
> Jeroen suggested on #21437 to distribute different aspects of the work in a new way.

That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.



---

archive/issue_comments_350595.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment:11):\n> Replying to [@simon-king-jena](#comment:6):\n> > Jeroen suggested on #21437 to distribute different aspects of the work in a new way.\n\n> \n> That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.\n\nDo you prefer that I rebase again and split this ticket into three: One for the new MeatAxe patch (that avoids frequent calls to a C function and thus gives a speedup), one for the pickling and one for random matrices?",
    "created_at": "2017-07-12T13:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350595",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment:11):
> Replying to [@simon-king-jena](#comment:6):
> > Jeroen suggested on #21437 to distribute different aspects of the work in a new way.

> 
> That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.

Do you prefer that I rebase again and split this ticket into three: One for the new MeatAxe patch (that avoids frequent calls to a C function and thus gives a speedup), one for the pickling and one for random matrices?



---

archive/issue_comments_350596.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nYes, that would be a good idea.",
    "created_at": "2017-07-12T13:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350596",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Yes, that would be a good idea.



---

archive/issue_comments_350597.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Yes, that would be a good idea.\n\nThe first one is #23410.\n\nThe patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?",
    "created_at": "2017-07-12T14:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350597",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:13):
> Yes, that would be a good idea.

The first one is #23410.

The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?



---

archive/issue_events_326681.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "title_is": "Fix random matrix_gfpn_dense",
    "title_was": "Some bug fixes for matrix_gfpn_dense",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326681"
}
```



---

archive/issue_events_326682.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326682"
}
```



---

archive/issue_events_326683.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326683"
}
```



---

archive/issue_comments_350598.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,7 +27,3 @@\n [      x   x + 1     2*x       1       0]\n ```\n So, the last column always is zero, which shouldn't be the case.\n-\n-In addition, reading a meataxe matrix from a non-existing file would currently crash.\n-\n-And finally, the current way of pickling would be machine dependent. That should be fixed as well.\n``````\n",
    "created_at": "2017-07-12T14:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350598",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,7 +27,3 @@
 [      x   x + 1     2*x       1       0]
 ```
 So, the last column always is zero, which shouldn't be the case.
-
-In addition, reading a meataxe matrix from a non-existing file would currently crash.
-
-And finally, the current way of pickling would be machine dependent. That should be fixed as well.
``````




---

archive/issue_comments_350599.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@simon-king-jena](#comment:14):\n> The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?\n\nThe ticket that is about sanitizing sig_on/off/check and about proper Cython code style has to depend on the other tickets. But I suggest to keep the other tickets separate as much as possible, and will soon push branches accordingly.",
    "created_at": "2017-07-12T15:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350599",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@simon-king-jena](#comment:14):
> The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?

The ticket that is about sanitizing sig_on/off/check and about proper Cython code style has to depend on the other tickets. But I suggest to keep the other tickets separate as much as possible, and will soon push branches accordingly.



---

archive/issue_comments_350600.json:
```json
{
    "body": "Changed commit from **[`bd1f3f1`](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)** to **[`bbd6a61`](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)**",
    "created_at": "2017-07-12T15:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350600",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bd1f3f1`](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)** to **[`bbd6a61`](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)**



---

archive/issue_comments_350601.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879\"><code>bbd6a61</code></a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr></table>\n",
    "created_at": "2017-07-12T15:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350601",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879"><code>bbd6a61</code></a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr></table>




---

archive/issue_events_326684.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:10:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326684"
}
```



---

archive/issue_events_326685.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:10:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326685"
}
```



---

archive/issue_comments_350602.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIn the splitup process, I have already updated #23410, #23411 and #23352, making them small and independent.\n\nAbout the other parts, I plan this:\n\n- We have #21437 for proper initialisation. I plan to try to make this stand-alone as well, but only if it cleanly merges with the afore-mentioned tickets. If it doesn't merge, I'll put it on top of the other tickets.\n- We have #23400 for code cleanup. The cleanup will also concern parts of code that are touched by the other tickets. So, it will use them as dependency.\n- We have #23399 for some additions (new methods). I very much doubt that it can stay separate, but I'll try. Very likely #23399 will be on top of all other tickets.\n\nJeroen, do you support my plan?",
    "created_at": "2017-07-12T16:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350602",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

In the splitup process, I have already updated #23410, #23411 and #23352, making them small and independent.

About the other parts, I plan this:

- We have #21437 for proper initialisation. I plan to try to make this stand-alone as well, but only if it cleanly merges with the afore-mentioned tickets. If it doesn't merge, I'll put it on top of the other tickets.
- We have #23400 for code cleanup. The cleanup will also concern parts of code that are touched by the other tickets. So, it will use them as dependency.
- We have #23399 for some additions (new methods). I very much doubt that it can stay separate, but I'll try. Very likely #23399 will be on top of all other tickets.

Jeroen, do you support my plan?



---

archive/issue_comments_350603.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@simon-king-jena](#comment:2):\n> The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.\n> \n> The problem was: In the old code, the LOWEST bits of the last byte have been filled.\n\nIf I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:\n\n> Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>\u2264256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...",
    "created_at": "2017-07-13T14:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350603",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@simon-king-jena](#comment:2):
> The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.
> 
> The problem was: In the old code, the LOWEST bits of the last byte have been filled.

If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:

> Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>≤256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...



---

archive/issue_comments_350604.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment:20):\n> If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:\n> \n> > Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>\u2264256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...\n\nYes, that's what I had in mind, too, and is why I wrote the old code in the way I did. Anyway, I am now using meataxe's `FfInsert`, which should do the right thing.\n\nLet's test: If I would set the last byte inconsistent with meataxe's conventions, then multiplying a matrix with the transposed matrix (these are all using meataxe functions) would give a wrong result. \n\n```\nsage: MS = MatrixSpace(GF(9,'x'),1,5)\nsage: def sanity_check(M):\n....:     assert (M*M.transpose())[0,0] == add(e*e for e in M.list())\n....:     \nsage: while(1):\n....:     sanity_check(MS.random_element())\n....:     \n```\nworks without error. Note that in the setting above, the new code is called. Thus, I believe my code is correct and indeed the meataxe documentation provides a wrong statement.",
    "created_at": "2017-07-13T15:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350604",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment:20):
> If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:
> 
> > Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>≤256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...

Yes, that's what I had in mind, too, and is why I wrote the old code in the way I did. Anyway, I am now using meataxe's `FfInsert`, which should do the right thing.

Let's test: If I would set the last byte inconsistent with meataxe's conventions, then multiplying a matrix with the transposed matrix (these are all using meataxe functions) would give a wrong result. 

```
sage: MS = MatrixSpace(GF(9,'x'),1,5)
sage: def sanity_check(M):
....:     assert (M*M.transpose())[0,0] == add(e*e for e in M.list())
....:     
sage: while(1):
....:     sanity_check(MS.random_element())
....:     
```
works without error. Note that in the setting above, the new code is called. Thus, I believe my code is correct and indeed the meataxe documentation provides a wrong statement.



---

archive/issue_comments_350605.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWhile fixing the `randomize` method, I'd like to speed it up, by cdefining the randint function.",
    "created_at": "2017-07-14T12:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350605",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

While fixing the `randomize` method, I'd like to speed it up, by cdefining the randint function.



---

archive/issue_comments_350606.json:
```json
{
    "body": "Changed commit from **[`bbd6a61`](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)** to **[`71abd44`](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)**",
    "created_at": "2017-07-14T12:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350606",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bbd6a61`](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)** to **[`71abd44`](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)**



---

archive/issue_comments_350607.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264\"><code>71abd44</code></a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr></table>\n",
    "created_at": "2017-07-14T12:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350607",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264"><code>71abd44</code></a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr></table>




---

archive/issue_comments_350608.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nBefore the latest commit I got\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 96.98 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 5.37 \u00b5s per loop\n```\n\nWith the latest commit, I get\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 142.72 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 3.4 \u00b5s per loop\n```\n\nI think 35% gain is worth it. Also, since I'm touching the code anyway, I change to using range() in Cython.",
    "created_at": "2017-07-14T12:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350608",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

Before the latest commit I got

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 96.98 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 5.37 µs per loop
```

With the latest commit, I get

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 142.72 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.4 µs per loop
```

I think 35% gain is worth it. Also, since I'm touching the code anyway, I change to using range() in Cython.



---

archive/issue_comments_350609.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nPS: Since I am changing the code anyway, I guess I could also change the use of sig_on/off in that part of the code...",
    "created_at": "2017-07-14T12:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350609",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

PS: Since I am changing the code anyway, I guess I could also change the use of sig_on/off in that part of the code...



---

archive/issue_comments_350610.json:
```json
{
    "body": "Changed commit from **[`71abd44`](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)** to **[`e68140e`](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)**",
    "created_at": "2017-07-14T12:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350610",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`71abd44`](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)** to **[`e68140e`](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)**



---

archive/issue_comments_350611.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6\"><code>e68140e</code></a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr></table>\n",
    "created_at": "2017-07-14T12:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350611",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6"><code>e68140e</code></a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr></table>




---

archive/issue_comments_350612.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAfter replacing sig_on/off by sig_check, I get\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 146.35 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 3.05 \u00b5s per loop\n```\nThat's further 10% on top of the previous 35%.\n\nThat's slightly surprising to me. Is sig_on/off really resulting in a massive slow-down? Then why is it used? After all, another disadvantage is that it doesn't play well with Python code.",
    "created_at": "2017-07-14T12:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350612",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">comment:27</div>

After replacing sig_on/off by sig_check, I get

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 146.35 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.05 µs per loop
```
That's further 10% on top of the previous 35%.

That's slightly surprising to me. Is sig_on/off really resulting in a massive slow-down? Then why is it used? After all, another disadvantage is that it doesn't play well with Python code.



---

archive/issue_comments_350613.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@simon-king-jena](#comment:27):\n> Is sig_on/off really resulting in a massive slow-down?\n\nIt shouldn't result in a *massive* slowdown. However, if you are using it in a very tight loop, the time taken by `sig_on()` is noticable.",
    "created_at": "2017-07-17T09:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350613",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@simon-king-jena](#comment:27):
> Is sig_on/off really resulting in a massive slow-down?

It shouldn't result in a *massive* slowdown. However, if you are using it in a very tight loop, the time taken by `sig_on()` is noticable.



---

archive/issue_comments_350614.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI should also mention that `sig_on()` is essentially just a call to `sigsetjmp()`. This is a function implemented by `libc` from the OS. So the time taken by `sig_on()` could depend significantly on the system.",
    "created_at": "2017-07-17T09:38:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350614",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

I should also mention that `sig_on()` is essentially just a call to `sigsetjmp()`. This is a function implemented by `libc` from the OS. So the time taken by `sig_on()` could depend significantly on the system.



---

archive/issue_comments_350615.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nCan the review please be finished?",
    "created_at": "2017-08-18T14:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350615",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

Can the review please be finished?



---

archive/issue_comments_350616.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThe branch does not apply on latest beta.",
    "created_at": "2017-08-21T08:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350616",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:31" align="right">comment:31</div>

The branch does not apply on latest beta.



---

archive/issue_events_326686.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-21T08:02:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326686"
}
```



---

archive/issue_events_326687.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-21T08:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326687"
}
```



---

archive/issue_comments_350617.json:
```json
{
    "body": "Changed commit from **[`e68140e`](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)** to **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**",
    "created_at": "2017-08-21T10:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e68140e`](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)** to **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**



---

archive/issue_comments_350618.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44\"><code>39431d7</code></a></td><td><code>Merge branch 'develop' into t/23352/fix_random_matrix_gfpn_dense</code></td></tr></table>\n",
    "created_at": "2017-08-21T10:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350618",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44"><code>39431d7</code></a></td><td><code>Merge branch 'develop' into t/23352/fix_random_matrix_gfpn_dense</code></td></tr></table>




---

archive/issue_events_326688.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-08-21T10:41:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326688"
}
```



---

archive/issue_events_326689.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-08-21T10:41:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326689"
}
```



---

archive/issue_comments_350619.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@fchapoton](#comment:31):\n> The branch does not apply on latest beta.\n\nThanks. Fixed now...",
    "created_at": "2017-08-21T10:41:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350619",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@fchapoton](#comment:31):
> The branch does not apply on latest beta.

Thanks. Fixed now...



---

archive/issue_comments_350620.json:
```json
{
    "body": "Changed keywords from **meataxe random** to **meataxe random, days88, IMA coding sprints**",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350620",
    "user": "https://github.com/tscrim"
}
```

Changed keywords from **meataxe random** to **meataxe random, days88, IMA coding sprints**



---

archive/issue_comments_350621.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Travis Scrimshaw**",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350621",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**



---

archive/issue_events_326690.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326690"
}
```



---

archive/issue_events_326691.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326691"
}
```



---

archive/issue_comments_350622.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nLet it be so.",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350622",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Let it be so.



---

archive/issue_events_326692.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326692"
}
```



---

archive/issue_events_326693.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326693"
}
```



---

archive/issue_events_326694.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-29T19:51:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326694"
}
```



---

archive/issue_events_326695.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "71b99833574757dcfd0eedf5d9b81cae863fa97a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-29T19:51:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-326695"
}
```



---

archive/issue_comments_350623.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)** to **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**",
    "created_at": "2017-08-29T19:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-350623",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)** to **[`39431d7`](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)**
