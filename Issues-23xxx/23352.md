# Issue 23352: Fix random matrix_gfpn_dense

archive/issues_023115.json:
```json
{
    "assignees": [],
    "body": "I just noticed that, when meataxe is installed and its Sage wrapper is used for matrices over `GF(p^n)` with `p` odd and `p^n<255`, then at least in some cases the random matrices aren't sufficiently random:\n\n```\nsage: random_matrix(GF(9,'x'), 5)\n[      x 2*x + 1   x + 2   x + 2       0]\n[  x + 1       x   x + 2   x + 1       0]\n[  x + 1       2   x + 1       2       0]\n[      x     2*x       x   x + 1       0]\n[2*x + 1       0 2*x + 1 2*x + 2       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      2   x + 1   x + 1 2*x + 2       0]\n[      x 2*x + 2   x + 2     2*x       0]\n[  x + 2     2*x       0 2*x + 2       0]\n[    2*x       2       2       1       0]\n[  x + 2       2     2*x       1       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      2 2*x + 1       x 2*x + 1       0]\n[2*x + 2       0 2*x + 2       x       0]\n[      2       x 2*x + 1   x + 2       0]\n[      0 2*x + 1       x       x       0]\n[      1       1       2   x + 1       0]\nsage: random_matrix(GF(9,'x'), 5)\n[      x   x + 1       0       0       0]\n[      1   x + 1       0 2*x + 1       0]\n[      2       0       x   x + 2       0]\n[      2       0   x + 1   x + 2       0]\n[      x   x + 1     2*x       1       0]\n```\nSo, the last column always is zero, which shouldn't be the case.\n\n**Keywords:** meataxe random, days88, IMA coding sprints\n\n**Branch/Commit:** [39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)\n\n**Reviewer:** Jeroen Demeyer, Travis Scrimshaw\n\n**Author:** Simon King\n\nIssue created by migration from https://trac.sagemath.org/ticket/23352\n\n",
    "closed_at": "2017-08-29T19:51:06Z",
    "created_at": "2017-07-02T13:43:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix random matrix_gfpn_dense",
    "type": "issue",
    "updated_at": "2017-08-29T19:51:06Z",
    "url": "https://github.com/sagemath/sage/issues/23352",
    "user": "https://github.com/simon-king-jena"
}
```
I just noticed that, when meataxe is installed and its Sage wrapper is used for matrices over `GF(p^n)` with `p` odd and `p^n<255`, then at least in some cases the random matrices aren't sufficiently random:

```
sage: random_matrix(GF(9,'x'), 5)
[      x 2*x + 1   x + 2   x + 2       0]
[  x + 1       x   x + 2   x + 1       0]
[  x + 1       2   x + 1       2       0]
[      x     2*x       x   x + 1       0]
[2*x + 1       0 2*x + 1 2*x + 2       0]
sage: random_matrix(GF(9,'x'), 5)
[      2   x + 1   x + 1 2*x + 2       0]
[      x 2*x + 2   x + 2     2*x       0]
[  x + 2     2*x       0 2*x + 2       0]
[    2*x       2       2       1       0]
[  x + 2       2     2*x       1       0]
sage: random_matrix(GF(9,'x'), 5)
[      2 2*x + 1       x 2*x + 1       0]
[2*x + 2       0 2*x + 2       x       0]
[      2       x 2*x + 1   x + 2       0]
[      0 2*x + 1       x       x       0]
[      1       1       2   x + 1       0]
sage: random_matrix(GF(9,'x'), 5)
[      x   x + 1       0       0       0]
[      1   x + 1       0 2*x + 1       0]
[      2       0       x   x + 2       0]
[      2       0   x + 1   x + 2       0]
[      x   x + 1     2*x       1       0]
```
So, the last column always is zero, which shouldn't be the case.

**Keywords:** meataxe random, days88, IMA coding sprints

**Branch/Commit:** [39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)

**Reviewer:** Jeroen Demeyer, Travis Scrimshaw

**Author:** Simon King

Issue created by migration from https://trac.sagemath.org/ticket/23352





---

archive/issue_events_282487.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282487"
}
```



---

archive/issue_events_282488.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "08517b",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282488"
}
```



---

archive/issue_events_282489.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-02T13:43:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282489"
}
```



---

archive/issue_comments_353195.json:
```json
{
    "body": "**Branch:** [u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)",
    "created_at": "2017-07-07T13:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353195",
    "user": "https://github.com/simon-king-jena"
}
```

**Branch:** [u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)



---

archive/issue_comments_353196.json:
```json
{
    "body": "**Author:** Simon King",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353196",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Simon King



---

archive/issue_comments_353197.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.\n\nThe problem was: In the old code, the LOWEST bits of the last byte have been filled.\n\nI fixed it by explicitly assigning random numbers to the last few entries (instead of trying to fill a whole block of entries).\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022\">3297b21</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353197",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.

The problem was: In the old code, the LOWEST bits of the last byte have been filled.

I fixed it by explicitly assigning random numbers to the last few entries (instead of trying to fill a whole block of entries).

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022">3297b21</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_comments_353198.json:
```json
{
    "body": "**Commit:** [3297b211937dd687bd8b0fbf267ac7b52e171022](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)",
    "created_at": "2017-07-07T13:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353198",
    "user": "https://github.com/simon-king-jena"
}
```

**Commit:** [3297b211937dd687bd8b0fbf267ac7b52e171022](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)



---

archive/issue_events_282490.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-07T13:24:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282490"
}
```



---

archive/issue_events_282491.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:18:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282491"
}
```



---

archive/issue_events_282492.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:18:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282492"
}
```



---

archive/issue_comments_353199.json:
```json
{
    "body": "**Dependencies:** #21437",
    "created_at": "2017-07-08T16:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353199",
    "user": "https://github.com/simon-king-jena"
}
```

**Dependencies:** #21437



---

archive/issue_comments_353200.json:
```json
{
    "body": "<a id='comment:3'></a>\nSooner or later this ticket needs to be merged with #21437. There is a merge conflict, and `git mergetool` doesn't work reasonably (namely: It shows me numerous conflicts, although the diff from this ticket is very small).\n\nTherefore I will *rebase* this ticket on top of #21437 and force-push it.",
    "created_at": "2017-07-08T16:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353200",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
Sooner or later this ticket needs to be merged with #21437. There is a merge conflict, and `git mergetool` doesn't work reasonably (namely: It shows me numerous conflicts, although the diff from this ticket is very small).

Therefore I will *rebase* this ticket on top of #21437 and force-push it.



---

archive/issue_comments_353201.json:
```json
{
    "body": "**Changing commit** from \"[3297b211937dd687bd8b0fbf267ac7b52e171022](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)\" to \"[6e332268227e5f8abedce6259bb32f8765108df0](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)\".",
    "created_at": "2017-07-08T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353201",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[3297b211937dd687bd8b0fbf267ac7b52e171022](https://github.com/sagemath/sagetrac-mirror/commit/3297b211937dd687bd8b0fbf267ac7b52e171022)" to "[6e332268227e5f8abedce6259bb32f8765108df0](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)".



---

archive/issue_comments_353202.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3\">291f4dc</a></td><td><code>Some minor tweaks for performance</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44\">03ce5c0</a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0\">5ed2269</a></td><td><code>Fix one doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6\">d4dc794</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce\">413e4a9</a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e\">d943f93</a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff\">c929fcc</a></td><td><code>Remove unused MTX* environment variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681\">b70bc5f</a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa\">04e7986</a></td><td><code>Improve use of sig_on/off/check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0\">6e33226</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-08T16:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353202",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/291f4dc68f4588b76cf4eea4ee8135b8ab7523e3">291f4dc</a></td><td><code>Some minor tweaks for performance</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03ce5c01b33ce70069e8fad0c69f5a554fb00f44">03ce5c0</a></td><td><code>Fix bad INPUT::/OUTPUT:: blocks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ed2269ff4017c5fb76593237b26596324ad1aa0">5ed2269</a></td><td><code>Fix one doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4dc794ea462cc06807cba525ffd71250bf0aac6">d4dc794</a></td><td><code>Merge branch 'develop' into t/21437/fix-mtx-matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/413e4a93e833b6da8aed7c0cbe880d402cfd46ce">413e4a9</a></td><td><code>Remove deprecated Cython syntax, use check_malloc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d943f93124e866ea174fb9cf603af1965d833b2e">d943f93</a></td><td><code>Remove rawMatrix function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c929fcc3dcde95e6b3037a025491645a3db648ff">c929fcc</a></td><td><code>Remove unused MTX* environment variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b70bc5fb54c9329361de06d45f3a052838eae681">b70bc5f</a></td><td><code>Change some str into bytes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04e7986e6c2113417ced911f827f2ae8247af3aa">04e7986</a></td><td><code>Improve use of sig_on/off/check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0">6e33226</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_events_282493.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282493"
}
```



---

archive/issue_events_282494.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-08T16:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282494"
}
```



---

archive/issue_comments_353203.json:
```json
{
    "body": "<a id='comment:5'></a>\nDon't be scared. All but the last commit belong to #21437. Yes, I still believe that git commits *belong* to a ticket...\n\nAnyway, I think it is logical to put a ticket that fixes random meataxe matrices on top of a ticket that fixes other aspects of meataxe matrices.",
    "created_at": "2017-07-08T16:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353203",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Don't be scared. All but the last commit belong to #21437. Yes, I still believe that git commits *belong* to a ticket...

Anyway, I think it is logical to put a ticket that fixes random meataxe matrices on top of a ticket that fixes other aspects of meataxe matrices.



---

archive/issue_comments_353204.json:
```json
{
    "body": "<a id='comment:6'></a>\nJeroen suggested on #21437 to distribute different aspects of the work in a new way. I think this ticket fits best for the topic \"bug fixes\". So, I'll rename the ticket a couple of commits. The tests should pass with the branch that I'll force-push in a minute.",
    "created_at": "2017-07-10T16:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353204",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
Jeroen suggested on #21437 to distribute different aspects of the work in a new way. I think this ticket fits best for the topic "bug fixes". So, I'll rename the ticket a couple of commits. The tests should pass with the branch that I'll force-push in a minute.



---

archive/issue_comments_353205.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -27,3 +27,7 @@\n [      x   x + 1     2*x       1       0]\n ```\n So, the last column always is zero, which shouldn't be the case.\n+\n+In addition, reading a meataxe matrix from a non-existing file would currently crash.\n+\n+And finally, the current way of pickling would be machine dependent. That should be fixed as well.\n``````\n",
    "created_at": "2017-07-10T16:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353205",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -27,3 +27,7 @@
 [      x   x + 1     2*x       1       0]
 ```
 So, the last column always is zero, which shouldn't be the case.
+
+In addition, reading a meataxe matrix from a non-existing file would currently crash.
+
+And finally, the current way of pickling would be machine dependent. That should be fixed as well.
``````




---

archive/issue_events_282495.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-10T16:35:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "rename": {
        "from": "Fix random matrix_gfpn_dense",
        "to": "Some bug fixes for matrix_gfpn_dense"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282495"
}
```



---

archive/issue_comments_353206.json:
```json
{
    "body": "**Changing commit** from \"[6e332268227e5f8abedce6259bb32f8765108df0](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)\" to \"[225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)\".",
    "created_at": "2017-07-10T16:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353206",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6e332268227e5f8abedce6259bb32f8765108df0](https://github.com/sagemath/sagetrac-mirror/commit/6e332268227e5f8abedce6259bb32f8765108df0)" to "[225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)".



---

archive/issue_comments_353207.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1aef56c4a1cf9e127ad3ae80b6350719edfe49f\">b1aef56</a></td><td><code>Add MeatAxe patch that ensures correct value of FfCurrentRowSizeIo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a44a58a597e8a10e8de174eb1c61c5c6be9ac8cf\">a44a58a</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91ac93fb302bcbd8380371f57bdbaa7716575bcb\">91ac93f</a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0\">225afe1</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-10T16:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353207",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1aef56c4a1cf9e127ad3ae80b6350719edfe49f">b1aef56</a></td><td><code>Add MeatAxe patch that ensures correct value of FfCurrentRowSizeIo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a44a58a597e8a10e8de174eb1c61c5c6be9ac8cf">a44a58a</a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91ac93fb302bcbd8380371f57bdbaa7716575bcb">91ac93f</a></td><td><code>Make pickling machine independent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0">225afe1</a></td><td><code>Properly fill the last few columns of random meataxe matrices</code></td></tr></table>




---

archive/issue_comments_353208.json:
```json
{
    "body": "<a id='comment:8'></a>\nNeeds review...",
    "created_at": "2017-07-10T16:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353208",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
Needs review...



---

archive/issue_comments_353209.json:
```json
{
    "body": "**Changing commit** from \"[225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)\" to \"[bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)\".",
    "created_at": "2017-07-10T21:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353209",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0](https://github.com/sagemath/sagetrac-mirror/commit/225afe1afa8dfa4ab700d3d91d3dca956e2b6ce0)" to "[bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)".



---

archive/issue_comments_353210.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9\">bd1f3f1</a></td><td><code>Fix ticket number in deprecation warning</code></td></tr></table>\n",
    "created_at": "2017-07-10T21:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353210",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9">bd1f3f1</a></td><td><code>Fix ticket number in deprecation warning</code></td></tr></table>




---

archive/issue_comments_353211.json:
```json
{
    "body": "**Changing dependencies** from \"#21437\" to \"\".",
    "created_at": "2017-07-11T08:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353211",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing dependencies** from "#21437" to "".



---

archive/issue_comments_353212.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [@simon-king-jena](#comment%3A6):\n> Jeroen suggested on #21437 to distribute different aspects of the work in a new way.\n\nThat's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.",
    "created_at": "2017-07-12T12:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353212",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [@simon-king-jena](#comment%3A6):
> Jeroen suggested on #21437 to distribute different aspects of the work in a new way.

That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.



---

archive/issue_comments_353213.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@jdemeyer](#comment%3A11):\n> Replying to [@simon-king-jena](#comment%3A6):\n> > Jeroen suggested on #21437 to distribute different aspects of the work in a new way.\n\n> \n> That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.\n\nDo you prefer that I rebase again and split this ticket into three: One for the new MeatAxe patch (that avoids frequent calls to a C function and thus gives a speedup), one for the pickling and one for random matrices?",
    "created_at": "2017-07-12T13:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353213",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>
Replying to [@jdemeyer](#comment%3A11):
> Replying to [@simon-king-jena](#comment%3A6):
> > Jeroen suggested on #21437 to distribute different aspects of the work in a new way.

> 
> That's not quite what I said. I proposed to split up #21437. Adding more stuff to existing tickets (like this one) is actually the opposite of what I intented.

Do you prefer that I rebase again and split this ticket into three: One for the new MeatAxe patch (that avoids frequent calls to a C function and thus gives a speedup), one for the pickling and one for random matrices?



---

archive/issue_comments_353214.json:
```json
{
    "body": "<a id='comment:13'></a>\nYes, that would be a good idea.",
    "created_at": "2017-07-12T13:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353214",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Yes, that would be a good idea.



---

archive/issue_comments_353215.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@jdemeyer](#comment%3A13):\n> Yes, that would be a good idea.\n\nThe first one is #23410.\n\nThe patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?",
    "created_at": "2017-07-12T14:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353215",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
Replying to [@jdemeyer](#comment%3A13):
> Yes, that would be a good idea.

The first one is #23410.

The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?



---

archive/issue_events_282496.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "rename": {
        "from": "Some bug fixes for matrix_gfpn_dense",
        "to": "Fix random matrix_gfpn_dense"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282496"
}
```



---

archive/issue_events_282497.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282497"
}
```



---

archive/issue_events_282498.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:57:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282498"
}
```



---

archive/issue_comments_353216.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -27,7 +27,3 @@\n [      x   x + 1     2*x       1       0]\n ```\n So, the last column always is zero, which shouldn't be the case.\n-\n-In addition, reading a meataxe matrix from a non-existing file would currently crash.\n-\n-And finally, the current way of pickling would be machine dependent. That should be fixed as well.\n``````\n",
    "created_at": "2017-07-12T14:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353216",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -27,7 +27,3 @@
 [      x   x + 1     2*x       1       0]
 ```
 So, the last column always is zero, which shouldn't be the case.
-
-In addition, reading a meataxe matrix from a non-existing file would currently crash.
-
-And finally, the current way of pickling would be machine dependent. That should be fixed as well.
``````




---

archive/issue_comments_353217.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@simon-king-jena](#comment%3A14):\n> The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?\n\nThe ticket that is about sanitizing sig_on/off/check and about proper Cython code style has to depend on the other tickets. But I suggest to keep the other tickets separate as much as possible, and will soon push branches accordingly.",
    "created_at": "2017-07-12T15:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353217",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'></a>
Replying to [@simon-king-jena](#comment%3A14):
> The patches to be distributed are, as much as I see, independent. Would it be better to let the new tickets build upon each other (i.e., the git history of one ticket is included in the git history of the other tickets), or should they stay separate (i.e., each ticket provides a patch, and then they are merged only when needed)?

The ticket that is about sanitizing sig_on/off/check and about proper Cython code style has to depend on the other tickets. But I suggest to keep the other tickets separate as much as possible, and will soon push branches accordingly.



---

archive/issue_comments_353218.json:
```json
{
    "body": "**Changing commit** from \"[bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)\" to \"[bbd6a61761e4c53bd90cef5d9685648dc9012879](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)\".",
    "created_at": "2017-07-12T15:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353218",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9](https://github.com/sagemath/sagetrac-mirror/commit/bd1f3f13c7a5a5a2af51dd2b19f976515b0f3fd9)" to "[bbd6a61761e4c53bd90cef5d9685648dc9012879](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)".



---

archive/issue_comments_353219.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879\">bbd6a61</a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr></table>\n",
    "created_at": "2017-07-12T15:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353219",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879">bbd6a61</a></td><td><code>Properly fill last column of random matrix_gfpn_dense</code></td></tr></table>




---

archive/issue_events_282499.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:10:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282499"
}
```



---

archive/issue_events_282500.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:10:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282500"
}
```



---

archive/issue_comments_353220.json:
```json
{
    "body": "<a id='comment:19'></a>\nIn the splitup process, I have already updated #23410, #23411 and #23352, making them small and independent.\n\nAbout the other parts, I plan this:\n\n- We have #21437 for proper initialisation. I plan to try to make this stand-alone as well, but only if it cleanly merges with the afore-mentioned tickets. If it doesn't merge, I'll put it on top of the other tickets.\n- We have #23400 for code cleanup. The cleanup will also concern parts of code that are touched by the other tickets. So, it will use them as dependency.\n- We have #23399 for some additions (new methods). I very much doubt that it can stay separate, but I'll try. Very likely #23399 will be on top of all other tickets.\n\nJeroen, do you support my plan?",
    "created_at": "2017-07-12T16:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353220",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'></a>
In the splitup process, I have already updated #23410, #23411 and #23352, making them small and independent.

About the other parts, I plan this:

- We have #21437 for proper initialisation. I plan to try to make this stand-alone as well, but only if it cleanly merges with the afore-mentioned tickets. If it doesn't merge, I'll put it on top of the other tickets.
- We have #23400 for code cleanup. The cleanup will also concern parts of code that are touched by the other tickets. So, it will use them as dependency.
- We have #23399 for some additions (new methods). I very much doubt that it can stay separate, but I'll try. Very likely #23399 will be on top of all other tickets.

Jeroen, do you support my plan?



---

archive/issue_comments_353221.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [@simon-king-jena](#comment%3A2):\n> The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.\n> \n> The problem was: In the old code, the LOWEST bits of the last byte have been filled.\n\nIf I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:\n\n> Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>\u2264256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...",
    "created_at": "2017-07-13T14:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353221",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [@simon-king-jena](#comment%3A2):
> The matrix entries are densely packed in meataxe. Hence, in some situations, the last byte of a row in memory is only partly filled with data. And in fact the HIGHEST bits of the last byte have to be filled.
> 
> The problem was: In the old code, the LOWEST bits of the last byte have been filled.

If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:

> Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>≤256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...



---

archive/issue_comments_353222.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@jdemeyer](#comment%3A20):\n> If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:\n> \n> > Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>\u2264256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...\n\nYes, that's what I had in mind, too, and is why I wrote the old code in the way I did. Anyway, I am now using meataxe's `FfInsert`, which should do the right thing.\n\nLet's test: If I would set the last byte inconsistent with meataxe's conventions, then multiplying a matrix with the transposed matrix (these are all using meataxe functions) would give a wrong result. \n\n```\nsage: MS = MatrixSpace(GF(9,'x'),1,5)\nsage: def sanity_check(M):\n....:     assert (M*M.transpose())[0,0] == add(e*e for e in M.list())\n....:     \nsage: while(1):\n....:     sanity_check(MS.random_element())\n....:     \n```\nworks without error. Note that in the setting above, the new code is called. Thus, I believe my code is correct and indeed the meataxe documentation provides a wrong statement.",
    "created_at": "2017-07-13T15:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353222",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>
Replying to [@jdemeyer](#comment%3A20):
> If I'm reading the documentation at http://www.math.rwth-aachen.de/~MTX/doc24/group__ff.html correctly, it should be the LOWEST bytes:
> 
> > Packing of field elements is used for field orders less than 17. Let q be the field order and m the largest natural number with q<sup>m</sup>≤256. Then, m elements k<sub>0</sub>,...k<sub>n-1</sub> are packed into one byte as k<sub>0</sub>+k<sub>1</sub>q+k<sub>2</sub>q<sup>2</sup>+...

Yes, that's what I had in mind, too, and is why I wrote the old code in the way I did. Anyway, I am now using meataxe's `FfInsert`, which should do the right thing.

Let's test: If I would set the last byte inconsistent with meataxe's conventions, then multiplying a matrix with the transposed matrix (these are all using meataxe functions) would give a wrong result. 

```
sage: MS = MatrixSpace(GF(9,'x'),1,5)
sage: def sanity_check(M):
....:     assert (M*M.transpose())[0,0] == add(e*e for e in M.list())
....:     
sage: while(1):
....:     sanity_check(MS.random_element())
....:     
```
works without error. Note that in the setting above, the new code is called. Thus, I believe my code is correct and indeed the meataxe documentation provides a wrong statement.



---

archive/issue_comments_353223.json:
```json
{
    "body": "<a id='comment:22'></a>\nWhile fixing the `randomize` method, I'd like to speed it up, by cdefining the randint function.",
    "created_at": "2017-07-14T12:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353223",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'></a>
While fixing the `randomize` method, I'd like to speed it up, by cdefining the randint function.



---

archive/issue_comments_353224.json:
```json
{
    "body": "**Changing commit** from \"[bbd6a61761e4c53bd90cef5d9685648dc9012879](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)\" to \"[71abd443f2690b8fa20dfc3d177dec03155a7264](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)\".",
    "created_at": "2017-07-14T12:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353224",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bbd6a61761e4c53bd90cef5d9685648dc9012879](https://github.com/sagemath/sagetrac-mirror/commit/bbd6a61761e4c53bd90cef5d9685648dc9012879)" to "[71abd443f2690b8fa20dfc3d177dec03155a7264](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)".



---

archive/issue_comments_353225.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264\">71abd44</a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr></table>\n",
    "created_at": "2017-07-14T12:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353225",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264">71abd44</a></td><td><code>Speedup meataxe matrix randomisation</code></td></tr></table>




---

archive/issue_comments_353226.json:
```json
{
    "body": "<a id='comment:24'></a>\nBefore the latest commit I got\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 96.98 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 5.37 \u00b5s per loop\n```\n\nWith the latest commit, I get\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 142.72 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 3.4 \u00b5s per loop\n```\n\nI think 35% gain is worth it. Also, since I'm touching the code anyway, I change to using range() in Cython.",
    "created_at": "2017-07-14T12:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353226",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'></a>
Before the latest commit I got

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 96.98 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 5.37 µs per loop
```

With the latest commit, I get

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 142.72 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.4 µs per loop
```

I think 35% gain is worth it. Also, since I'm touching the code anyway, I change to using range() in Cython.



---

archive/issue_comments_353227.json:
```json
{
    "body": "<a id='comment:25'></a>\nPS: Since I am changing the code anyway, I guess I could also change the use of sig_on/off in that part of the code...",
    "created_at": "2017-07-14T12:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353227",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:25'></a>
PS: Since I am changing the code anyway, I guess I could also change the use of sig_on/off in that part of the code...



---

archive/issue_comments_353228.json:
```json
{
    "body": "**Changing commit** from \"[71abd443f2690b8fa20dfc3d177dec03155a7264](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)\" to \"[e68140e57f5eb45d7482bd50533ce2d58f99fad6](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)\".",
    "created_at": "2017-07-14T12:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353228",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[71abd443f2690b8fa20dfc3d177dec03155a7264](https://github.com/sagemath/sagetrac-mirror/commit/71abd443f2690b8fa20dfc3d177dec03155a7264)" to "[e68140e57f5eb45d7482bd50533ce2d58f99fad6](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)".



---

archive/issue_comments_353229.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6\">e68140e</a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr></table>\n",
    "created_at": "2017-07-14T12:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353229",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6">e68140e</a></td><td><code>Replace sig_on/off by sig_check in meataxe matrix randomisation</code></td></tr></table>




---

archive/issue_comments_353230.json:
```json
{
    "body": "<a id='comment:27'></a>\nAfter replacing sig_on/off by sig_check, I get\n\n```\nsage: MS = MatrixSpace(GF(9,'x'),5,17)\nsage: %timeit MS.random_element()\nThe slowest run took 146.35 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 3.05 \u00b5s per loop\n```\nThat's further 10% on top of the previous 35%.\n\nThat's slightly surprising to me. Is sig_on/off really resulting in a massive slow-down? Then why is it used? After all, another disadvantage is that it doesn't play well with Python code.",
    "created_at": "2017-07-14T12:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353230",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:27'></a>
After replacing sig_on/off by sig_check, I get

```
sage: MS = MatrixSpace(GF(9,'x'),5,17)
sage: %timeit MS.random_element()
The slowest run took 146.35 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.05 µs per loop
```
That's further 10% on top of the previous 35%.

That's slightly surprising to me. Is sig_on/off really resulting in a massive slow-down? Then why is it used? After all, another disadvantage is that it doesn't play well with Python code.



---

archive/issue_comments_353231.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [@simon-king-jena](#comment%3A27):\n> Is sig_on/off really resulting in a massive slow-down?\n\nIt shouldn't result in a *massive* slowdown. However, if you are using it in a very tight loop, the time taken by `sig_on()` is noticable.",
    "created_at": "2017-07-17T09:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353231",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [@simon-king-jena](#comment%3A27):
> Is sig_on/off really resulting in a massive slow-down?

It shouldn't result in a *massive* slowdown. However, if you are using it in a very tight loop, the time taken by `sig_on()` is noticable.



---

archive/issue_comments_353232.json:
```json
{
    "body": "<a id='comment:29'></a>\nI should also mention that `sig_on()` is essentially just a call to `sigsetjmp()`. This is a function implemented by `libc` from the OS. So the time taken by `sig_on()` could depend significantly on the system.",
    "created_at": "2017-07-17T09:38:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353232",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
I should also mention that `sig_on()` is essentially just a call to `sigsetjmp()`. This is a function implemented by `libc` from the OS. So the time taken by `sig_on()` could depend significantly on the system.



---

archive/issue_comments_353233.json:
```json
{
    "body": "<a id='comment:30'></a>\nCan the review please be finished?",
    "created_at": "2017-08-18T14:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353233",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:30'></a>
Can the review please be finished?



---

archive/issue_comments_353234.json:
```json
{
    "body": "<a id='comment:31'></a>\nThe branch does not apply on latest beta.",
    "created_at": "2017-08-21T08:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353234",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
The branch does not apply on latest beta.



---

archive/issue_events_282501.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-21T08:02:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282501"
}
```



---

archive/issue_events_282502.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-21T08:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282502"
}
```



---

archive/issue_comments_353235.json:
```json
{
    "body": "**Changing commit** from \"[e68140e57f5eb45d7482bd50533ce2d58f99fad6](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)\" to \"[39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)\".",
    "created_at": "2017-08-21T10:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353235",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e68140e57f5eb45d7482bd50533ce2d58f99fad6](https://github.com/sagemath/sagetrac-mirror/commit/e68140e57f5eb45d7482bd50533ce2d58f99fad6)" to "[39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)".



---

archive/issue_comments_353236.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44\">39431d7</a></td><td><code>Merge branch 'develop' into t/23352/fix_random_matrix_gfpn_dense</code></td></tr></table>\n",
    "created_at": "2017-08-21T10:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353236",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44">39431d7</a></td><td><code>Merge branch 'develop' into t/23352/fix_random_matrix_gfpn_dense</code></td></tr></table>




---

archive/issue_events_282503.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-08-21T10:41:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282503"
}
```



---

archive/issue_events_282504.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-08-21T10:41:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282504"
}
```



---

archive/issue_comments_353237.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@fchapoton](#comment%3A31):\n> The branch does not apply on latest beta.\n\nThanks. Fixed now...",
    "created_at": "2017-08-21T10:41:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353237",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:33'></a>
Replying to [@fchapoton](#comment%3A31):
> The branch does not apply on latest beta.

Thanks. Fixed now...



---

archive/issue_comments_353238.json:
```json
{
    "body": "**Changing keywords** from \"meataxe random\" to \"meataxe random, days88, IMA coding sprints\".",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353238",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "meataxe random" to "meataxe random, days88, IMA coding sprints".



---

archive/issue_comments_353239.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer, Travis Scrimshaw",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353239",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Jeroen Demeyer, Travis Scrimshaw



---

archive/issue_events_282505.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282505"
}
```



---

archive/issue_events_282506.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282506"
}
```



---

archive/issue_comments_353240.json:
```json
{
    "body": "<a id='comment:34'></a>\nLet it be so.",
    "created_at": "2017-08-25T22:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353240",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:34'></a>
Let it be so.



---

archive/issue_events_282507.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282507"
}
```



---

archive/issue_events_282508.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-25T22:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282508"
}
```



---

archive/issue_events_282509.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-29T19:51:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282509"
}
```



---

archive/issue_events_282510.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "71b99833574757dcfd0eedf5d9b81cae863fa97a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-29T19:51:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23352#event-282510"
}
```



---

archive/issue_comments_353241.json:
```json
{
    "body": "**Changing branch** from \"[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)\" to \"[39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)\".",
    "created_at": "2017-08-29T19:51:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23352",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23352#issuecomment-353241",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/SimonKing/fix_random_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_random_matrix_gfpn_dense)" to "[39431d7e98a19de1c3b4f0af97440922eed10f44](https://github.com/sagemath/sagetrac-mirror/commit/39431d7e98a19de1c3b4f0af97440922eed10f44)".
