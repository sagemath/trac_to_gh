# Issue 23486: Echelon form for p-adic matrices

archive/issues_023249.json:
```json
{
    "body": "This ticket implements echelon form for matrices over complete discrete valuation rings/fields.\n\nCC:  @roed314 @saraedum tristanvaccon\n\nKeywords: sd87, padicIMA, padicBordeaux\n\nReviewer: Ben Hutz, David Roe\n\nAuthor: Xavier Caruso\n\nBranch: u/caruso/padic_hermite\n\nStatus: needs_work\n\nDependencies: #23450\n\nCommit: 26f0fd223edb143de3465f454e2dde5be1c06f9c\n\nIssue created by migration from https://trac.sagemath.org/ticket/23486\n\n",
    "created_at": "2017-07-20T04:10:42Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Echelon form for p-adic matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23486",
    "user": "https://github.com/xcaruso"
}
```
This ticket implements echelon form for matrices over complete discrete valuation rings/fields.

CC:  @roed314 @saraedum tristanvaccon

Keywords: sd87, padicIMA, padicBordeaux

Reviewer: Ben Hutz, David Roe

Author: Xavier Caruso

Branch: u/caruso/padic_hermite

Status: needs_work

Dependencies: #23450

Commit: 26f0fd223edb143de3465f454e2dde5be1c06f9c

Issue created by migration from https://trac.sagemath.org/ticket/23486





---

archive/issue_comments_346187.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-07-20T04:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346187",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_346188.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-07-20T17:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_346189.json:
```json
{
    "body": "<a id='comment:4'></a>Ticket ready for review!",
    "created_at": "2017-07-20T17:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346189",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:4'></a>Ticket ready for review!



---

archive/issue_comments_346190.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-20T17:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346190",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346191.json:
```json
{
    "body": "<a id='comment:6'></a>I looked at this from a functionality perspective as opposed to looking through the algorithm line by line.\n\nAll of the examples I was able to come up with behaved as expected, so I just have a few minor issues\n\n- 2 doc test failures\n\n```\nsage -t --warn-long 72.0 rings/laurent_series_ring.py  # 1 doctest failed\nsage -t --warn-long 72.0 rings/padics/tests.py  # 1 doctest failed\n```\n\n- in a couple places you say\n\n```\nif `d_i` denotes the `(i,i)` entry of `D`\n```\nI think you means `D` to be `S`\n\n- extra word\n\n```\n'it is possible to do not'\n```\n\n- in several places you say 'also possible for rectangular matrices' where you mean 'nonrectangular'\n\n- in two different places for echelon form you state it as find the Smith normal form instead of the echelon form\n\n```\nto determine the Smith normal form\n```\n\n- is there a reason to assign\n\n```\n    else:\n        left = right = None\n```\nthey don't seem to be used later.\n\n- incorrect word\n\n```\ninteger this of this\n```\nshould be 'integer ring of this'",
    "created_at": "2017-07-20T20:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346191",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:6'></a>I looked at this from a functionality perspective as opposed to looking through the algorithm line by line.

All of the examples I was able to come up with behaved as expected, so I just have a few minor issues

- 2 doc test failures

```
sage -t --warn-long 72.0 rings/laurent_series_ring.py  # 1 doctest failed
sage -t --warn-long 72.0 rings/padics/tests.py  # 1 doctest failed
```

- in a couple places you say

```
if `d_i` denotes the `(i,i)` entry of `D`
```
I think you means `D` to be `S`

- extra word

```
'it is possible to do not'
```

- in several places you say 'also possible for rectangular matrices' where you mean 'nonrectangular'

- in two different places for echelon form you state it as find the Smith normal form instead of the echelon form

```
to determine the Smith normal form
```

- is there a reason to assign

```
    else:
        left = right = None
```
they don't seem to be used later.

- incorrect word

```
integer this of this
```
should be 'integer ring of this'



---

archive/issue_comments_346192.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-20T20:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346192",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346193.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T01:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346194.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks for your comments.\n\nI fixed the wording.\nThe failing doctests were due to the fact that, in the case of a matrix M defined over a complete discrete valuation *field* K, my function `echelon_form()` did not compute the row-echelon from of M over K but over its ring of integers (i.e. the transformation matrix has coefficients in the ring of integers and is invertible over it). I then changed the name for `integral_echelon_from()`.\n\nNB: Some of your comments are related to ticket #23450. Maybe you should look at this one as well.",
    "created_at": "2017-07-21T01:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346194",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:8'></a>Thanks for your comments.

I fixed the wording.
The failing doctests were due to the fact that, in the case of a matrix M defined over a complete discrete valuation *field* K, my function `echelon_form()` did not compute the row-echelon from of M over K but over its ring of integers (i.e. the transformation matrix has coefficients in the ring of integers and is invertible over it). I then changed the name for `integral_echelon_from()`.

NB: Some of your comments are related to ticket #23450. Maybe you should look at this one as well.



---

archive/issue_comments_346195.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-21T01:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346195",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346196.json:
```json
{
    "body": "<a id='comment:11'></a>See also #17272, which just got a positive review.\n\n---\nNew commits:",
    "created_at": "2018-05-24T20:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346196",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'></a>See also #17272, which just got a positive review.

---
New commits:



---

archive/issue_comments_346197.json:
```json
{
    "body": "<a id='comment:12'></a>Great! So, what do we do with this ticket (which is now a kind of redundant)?",
    "created_at": "2018-05-24T20:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346197",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:12'></a>Great! So, what do we do with this ticket (which is now a kind of redundant)?



---

archive/issue_comments_346198.json:
```json
{
    "body": "<a id='comment:13'></a>Are there any features here that aren't included in #17272?",
    "created_at": "2018-05-24T20:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346198",
    "user": "https://github.com/roed314"
}
```

<a id='comment:13'></a>Are there any features here that aren't included in #17272?



---

archive/issue_comments_346199.json:
```json
{
    "body": "<a id='comment:14'></a>The computation of transformation matrices, I think.\n\nMoreover, for matrices over Qp, it makes sense to have an option for computing the echelon form over Zp (that is, without renormalizing the pivots) in order to save precision. But I don't think that it's implemented in this ticket.",
    "created_at": "2018-05-24T20:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346199",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:14'></a>The computation of transformation matrices, I think.

Moreover, for matrices over Qp, it makes sense to have an option for computing the echelon form over Zp (that is, without renormalizing the pivots) in order to save precision. But I don't think that it's implemented in this ticket.



---

archive/issue_comments_346200.json:
```json
{
    "body": "Changing keywords from \"sd87\" to \"sd87, padicIMA\".",
    "created_at": "2018-07-22T20:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346200",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd87" to "sd87, padicIMA".



---

archive/issue_comments_346201.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-25T22:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346201",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346202.json:
```json
{
    "body": "<a id='comment:17'></a>New commits:",
    "created_at": "2018-07-25T22:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346202",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:17'></a>New commits:



---

archive/issue_comments_346203.json:
```json
{
    "body": "Changing keywords from \"sd87, padicIMA\" to \"sd87, padicIMA, padicBordeaux\".",
    "created_at": "2019-09-07T09:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346203",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "sd87, padicIMA" to "sd87, padicIMA, padicBordeaux".



---

archive/issue_comments_346204.json:
```json
{
    "body": "<a id='comment:20'></a>I merged in the latest beta, but this still needs to be reconciled with #17272.  I think there are features here that we want that weren't done by #17272 (for example, when the base ring is Zp), so this ticket should remain open.\n\n---\nNew commits:",
    "created_at": "2019-09-09T09:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346204",
    "user": "https://github.com/roed314"
}
```

<a id='comment:20'></a>I merged in the latest beta, but this still needs to be reconciled with #17272.  I think there are features here that we want that weren't done by #17272 (for example, when the base ring is Zp), so this ticket should remain open.

---
New commits:



---

archive/issue_comments_346205.json:
```json
{
    "body": "<a id='comment:22'></a>I noticed that there is a lot of variations between the way operations over matrices are designed:\n- `echelon_form` is directly implemented in the class `sage.matrix.matrix2.Matrix`\n- `smith_form` calls the method `_matrix_smith_form` of the base ring; concretely, this method is implemented in the class `sage.rings.padics.local_generic.LocalGeneric`\n- `hessenberg_form` calls the method `_matrix_hessenbergize` of the base ring; this method is defined in the category `sage.categories.discrete_valuation.DiscreteValuationFields` and concretely implemented in the separate file `sage.matrix.matrix_cdv`.\n\nI think it would be a good thing to uniformize all of this and, personally, I have a small preference for the third approach. What's your opinion?\n\n---\nNew commits:",
    "created_at": "2022-02-14T13:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346205",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:22'></a>I noticed that there is a lot of variations between the way operations over matrices are designed:
- `echelon_form` is directly implemented in the class `sage.matrix.matrix2.Matrix`
- `smith_form` calls the method `_matrix_smith_form` of the base ring; concretely, this method is implemented in the class `sage.rings.padics.local_generic.LocalGeneric`
- `hessenberg_form` calls the method `_matrix_hessenbergize` of the base ring; this method is defined in the category `sage.categories.discrete_valuation.DiscreteValuationFields` and concretely implemented in the separate file `sage.matrix.matrix_cdv`.

I think it would be a good thing to uniformize all of this and, personally, I have a small preference for the third approach. What's your opinion?

---
New commits:



---

archive/issue_comments_346206.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-14T13:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346206",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346207.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-16T17:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346208.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-16T17:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346208",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346209.json:
```json
{
    "body": "<a id='comment:25'></a>I followed the third approach: I put everything in the category and put the code in a separate `pyx` file. So far, most of the code is written in pure python; maybe we should move to cython at some point.\n\nThere is some code duplication due to the fact that we have separate categories for discrete valuation rings and fields but not a common category for both.\n\nAnyway, everything is supposed over all types of p-adics as well as over power series and Laurent series rings. Moreover, with the general machinery already provided by sage, this is enough to manipulate free modules over those rings, including then lattices in finite dimensional p-adic vector spaces.",
    "created_at": "2022-02-16T17:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346209",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:25'></a>I followed the third approach: I put everything in the category and put the code in a separate `pyx` file. So far, most of the code is written in pure python; maybe we should move to cython at some point.

There is some code duplication due to the fact that we have separate categories for discrete valuation rings and fields but not a common category for both.

Anyway, everything is supposed over all types of p-adics as well as over power series and Laurent series rings. Moreover, with the general machinery already provided by sage, this is enough to manipulate free modules over those rings, including then lattices in finite dimensional p-adic vector spaces.



---

archive/issue_comments_346210.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-16T17:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346211.json:
```json
{
    "body": "<a id='comment:27'></a>Have you considered putting things into a `.py` file instead? I don't think that it makes a real difference in terms of performance (and I am struggling right now to debug an (unrelated) call that uses too much Cython ;) )",
    "created_at": "2022-02-16T19:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346211",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:27'></a>Have you considered putting things into a `.py` file instead? I don't think that it makes a real difference in terms of performance (and I am struggling right now to debug an (unrelated) call that uses too much Cython ;) )



---

archive/issue_comments_346212.json:
```json
{
    "body": "<a id='comment:28'></a>The point is that `matrix_cdv.pyx` already exists with some cython code inside. But I can probably split the file in two parts and call them `matrix_cdv_python` and `matrix_cdv_cython`.",
    "created_at": "2022-02-16T19:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346212",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:28'></a>The point is that `matrix_cdv.pyx` already exists with some cython code inside. But I can probably split the file in two parts and call them `matrix_cdv_python` and `matrix_cdv_cython`.



---

archive/issue_comments_346213.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-19T19:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346213",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346214.json:
```json
{
    "body": "<a id='comment:29'></a>The patchbot reported a lot of doctest failures... :-(",
    "created_at": "2022-02-19T19:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346214",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:29'></a>The patchbot reported a lot of doctest failures... :-(



---

archive/issue_comments_346215.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T09:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346216.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-20T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346216",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346217.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T09:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346218.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T09:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346219.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T16:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346220.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T20:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346221.json:
```json
{
    "body": "<a id='comment:36'></a>Here are the test failures when I ran tests locally:\n\n```\nDoctesting 7 files using 64 threads.\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pxd\n    [0 tests, 0.00 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix_cdv.pyx\", line 710, in sage.matrix.matrix_cdv.hessenbergize_cdvf\nFailed example:\n    M.charpoly()\nExpected:\n    x^3 + (1 + 4*t + 4*t^2 + O(t^3))*x^2 + (t + 2*t^2 + O(t^3))*x + 3 + 2*t^2 + O(t^3)\nGot:\n    x^3 + (1 + 4*t + 4*t^2 + O(t^4))*x^2 + (t + 2*t^2 + O(t^3))*x + 3 + 2*t^2 + O(t^3)\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.matrix.matrix_cdv.hessenbergize_cdvf\n    [41 tests, 1 failure, 0.08 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/laurent_series_ring.py\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 119, in sage.rings.laurent_series_ring.LaurentSeriesRing\nFailed example:\n    TestSuite(F).run()\nExpected nothing\nGot:\n    Failure in _test_euclidean_degree:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py\", line 155, in _test_euclidean_degree\n        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: False != True\n    ------------------------------------------------------------\n    Failure in _test_gcd_vs_xgcd:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py\", line 119, in _test_gcd_vs_xgcd\n        tester.assertTrue(gcd==xgcd[0],\n      File \"/usr/lib/python3.8/unittest/case.py\", line 765, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in x over Rational Field:\n      gcd(x,x) = x\n     xgcd(x,x) = (1, x^-1, 0)\n    ------------------------------------------------------------\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py\", line 304, in _test_matrix_smith\n        tester.assertEqual(U.base_ring(), base)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: Laurent Series Ring in x over Rational Field != Power Series Ring in x over Rational Field\n    ------------------------------------------------------------\n    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 128, in sage.rings.laurent_series_ring.LaurentSeriesRing\nFailed example:\n    F.category()\nExpected:\n    Join of Category of complete discrete valuation fields and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets\nGot:\n    Join of Category of complete discrete valuation rings and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 130, in sage.rings.laurent_series_ring.LaurentSeriesRing\nFailed example:\n    TestSuite(F).run()\nExpected nothing\nGot:\n    Failure in _test_euclidean_degree:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py\", line 155, in _test_euclidean_degree\n        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: False != True\n    ------------------------------------------------------------\n    Failure in _test_gcd_vs_xgcd:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py\", line 119, in _test_gcd_vs_xgcd\n        tester.assertTrue(gcd==xgcd[0],\n      File \"/usr/lib/python3.8/unittest/case.py\", line 765, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in x over Finite Field of size 11:\n      gcd(x,x) = x\n     xgcd(x,x) = (1, x^-1, 0)\n    ------------------------------------------------------------\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py\", line 304, in _test_matrix_smith\n        tester.assertEqual(U.base_ring(), base)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: Laurent Series Ring in x over Finite Field of size 11 != Power Series Ring in x over Finite Field of size 11\n    ------------------------------------------------------------\n    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 151, in sage.rings.laurent_series_ring.LaurentSeriesRing\nFailed example:\n    LaurentSeriesRing(QQ, 'x').category()\nExpected:\n    Join of Category of complete discrete valuation fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets\nGot:\n    Join of Category of complete discrete valuation rings and Category of fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 227, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__\nFailed example:\n    R2.category()\nExpected:\n    Join of Category of complete discrete valuation fields and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets\nGot:\n    Join of Category of complete discrete valuation rings and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 229, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__\nFailed example:\n    TestSuite(R2).run()\nExpected nothing\nGot:\n    Failure in _test_euclidean_degree:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py\", line 155, in _test_euclidean_degree\n        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: False != True\n    ------------------------------------------------------------\n    Failure in _test_gcd_vs_xgcd:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py\", line 119, in _test_gcd_vs_xgcd\n        tester.assertTrue(gcd==xgcd[0],\n      File \"/usr/lib/python3.8/unittest/case.py\", line 765, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in t over Ring of integers modulo 2:\n      gcd(t,t) = t\n     xgcd(t,t) = (1, t^-1, 0)\n    ------------------------------------------------------------\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py\", line 304, in _test_matrix_smith\n        tester.assertEqual(U.base_ring(), base)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: Laurent Series Ring in t over Ring of integers modulo 2 != Power Series Ring in t over Ring of integers modulo 2\n    ------------------------------------------------------------\n    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 237, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__\nFailed example:\n    RQQ.category()\nExpected:\n    Join of Category of complete discrete valuation fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets\nGot:\n    Join of Category of complete discrete valuation rings and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets\n**********************************************************************\nFile \"src/sage/rings/laurent_series_ring.py\", line 239, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__\nFailed example:\n    TestSuite(RQQ).run()\nExpected nothing\nGot:\n    Failure in _test_euclidean_degree:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py\", line 155, in _test_euclidean_degree\n        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: False != True\n    ------------------------------------------------------------\n    Failure in _test_gcd_vs_xgcd:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py\", line 119, in _test_gcd_vs_xgcd\n        tester.assertTrue(gcd==xgcd[0],\n      File \"/usr/lib/python3.8/unittest/case.py\", line 765, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in t over Rational Field:\n      gcd(t,t) = t\n     xgcd(t,t) = (1, t^-1, 0)\n    ------------------------------------------------------------\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py\", line 304, in _test_matrix_smith\n        tester.assertEqual(U.base_ring(), base)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 912, in assertEqual\n        assertion_func(first, second, msg=msg)\n      File \"/usr/lib/python3.8/unittest/case.py\", line 905, in _baseAssertEqual\n        raise self.failureException(msg)\n    AssertionError: Laurent Series Ring in t over Rational Field != Power Series Ring in t over Rational Field\n    ------------------------------------------------------------\n    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith\n**********************************************************************\n2 items had failures:\n   4 of  43 in sage.rings.laurent_series_ring.LaurentSeriesRing\n   4 of  18 in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__\n    [182 tests, 8 failures, 0.21 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/multi_power_series_ring_element.py\n**********************************************************************\nFile \"src/sage/rings/multi_power_series_ring_element.py\", line 1081, in sage.rings.multi_power_series_ring_element.MPowerSeries.__mod__\nFailed example:\n    g in R\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.rings.multi_power_series_ring_element.MPowerSeries.__mod__\n    [466 tests, 1 failure, 0.27 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/categories/complete_discrete_valuation.py\n**********************************************************************\nFile \"src/sage/categories/complete_discrete_valuation.py\", line 621, in sage.categories.complete_discrete_valuation.CompleteDiscreteValuationFields\nFailed example:\n    LaurentSeriesRing(QQ,'u') in CompleteDiscreteValuationFields()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.categories.complete_discrete_valuation.CompleteDiscreteValuationFields\n    [200 tests, 1 failure, 0.24 s]\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 9855, in sage.matrix.matrix2.Matrix.inverse\nFailed example:\n    ~M\nExpected:\n    [t^-1 t^-2]\n    [   0 t^-1]\nGot:\n    [1 0]\n    [0 1]\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.matrix.matrix2.Matrix.inverse\n    [2807 tests, 1 failure, 8.67 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pyx  # 1 doctest failed\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/laurent_series_ring.py  # 8 doctests failed\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/multi_power_series_ring_element.py  # 1 doctest failed\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/categories/complete_discrete_valuation.py  # 1 doctest failed\nsage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pyx  # 1 doctest failed\n```",
    "created_at": "2022-02-20T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346221",
    "user": "https://github.com/roed314"
}
```

<a id='comment:36'></a>Here are the test failures when I ran tests locally:

```
Doctesting 7 files using 64 threads.
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pxd
    [0 tests, 0.00 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pyx
**********************************************************************
File "src/sage/matrix/matrix_cdv.pyx", line 710, in sage.matrix.matrix_cdv.hessenbergize_cdvf
Failed example:
    M.charpoly()
Expected:
    x^3 + (1 + 4*t + 4*t^2 + O(t^3))*x^2 + (t + 2*t^2 + O(t^3))*x + 3 + 2*t^2 + O(t^3)
Got:
    x^3 + (1 + 4*t + 4*t^2 + O(t^4))*x^2 + (t + 2*t^2 + O(t^3))*x + 3 + 2*t^2 + O(t^3)
**********************************************************************
1 item had failures:
   1 of  11 in sage.matrix.matrix_cdv.hessenbergize_cdvf
    [41 tests, 1 failure, 0.08 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/laurent_series_ring.py
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 119, in sage.rings.laurent_series_ring.LaurentSeriesRing
Failed example:
    TestSuite(F).run()
Expected nothing
Got:
    Failure in _test_euclidean_degree:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py", line 155, in _test_euclidean_degree
        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: False != True
    ------------------------------------------------------------
    Failure in _test_gcd_vs_xgcd:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py", line 119, in _test_gcd_vs_xgcd
        tester.assertTrue(gcd==xgcd[0],
      File "/usr/lib/python3.8/unittest/case.py", line 765, in assertTrue
        raise self.failureException(msg)
    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in x over Rational Field:
      gcd(x,x) = x
     xgcd(x,x) = (1, x^-1, 0)
    ------------------------------------------------------------
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py", line 304, in _test_matrix_smith
        tester.assertEqual(U.base_ring(), base)
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: Laurent Series Ring in x over Rational Field != Power Series Ring in x over Rational Field
    ------------------------------------------------------------
    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 128, in sage.rings.laurent_series_ring.LaurentSeriesRing
Failed example:
    F.category()
Expected:
    Join of Category of complete discrete valuation fields and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets
Got:
    Join of Category of complete discrete valuation rings and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 130, in sage.rings.laurent_series_ring.LaurentSeriesRing
Failed example:
    TestSuite(F).run()
Expected nothing
Got:
    Failure in _test_euclidean_degree:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py", line 155, in _test_euclidean_degree
        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: False != True
    ------------------------------------------------------------
    Failure in _test_gcd_vs_xgcd:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py", line 119, in _test_gcd_vs_xgcd
        tester.assertTrue(gcd==xgcd[0],
      File "/usr/lib/python3.8/unittest/case.py", line 765, in assertTrue
        raise self.failureException(msg)
    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in x over Finite Field of size 11:
      gcd(x,x) = x
     xgcd(x,x) = (1, x^-1, 0)
    ------------------------------------------------------------
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py", line 304, in _test_matrix_smith
        tester.assertEqual(U.base_ring(), base)
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: Laurent Series Ring in x over Finite Field of size 11 != Power Series Ring in x over Finite Field of size 11
    ------------------------------------------------------------
    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 151, in sage.rings.laurent_series_ring.LaurentSeriesRing
Failed example:
    LaurentSeriesRing(QQ, 'x').category()
Expected:
    Join of Category of complete discrete valuation fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets
Got:
    Join of Category of complete discrete valuation rings and Category of fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 227, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__
Failed example:
    R2.category()
Expected:
    Join of Category of complete discrete valuation fields and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets
Got:
    Join of Category of complete discrete valuation rings and Category of commutative algebras over (finite enumerated fields and subquotients of monoids and quotients of semigroups) and Category of infinite sets
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 229, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__
Failed example:
    TestSuite(R2).run()
Expected nothing
Got:
    Failure in _test_euclidean_degree:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py", line 155, in _test_euclidean_degree
        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: False != True
    ------------------------------------------------------------
    Failure in _test_gcd_vs_xgcd:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py", line 119, in _test_gcd_vs_xgcd
        tester.assertTrue(gcd==xgcd[0],
      File "/usr/lib/python3.8/unittest/case.py", line 765, in assertTrue
        raise self.failureException(msg)
    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in t over Ring of integers modulo 2:
      gcd(t,t) = t
     xgcd(t,t) = (1, t^-1, 0)
    ------------------------------------------------------------
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py", line 304, in _test_matrix_smith
        tester.assertEqual(U.base_ring(), base)
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: Laurent Series Ring in t over Ring of integers modulo 2 != Power Series Ring in t over Ring of integers modulo 2
    ------------------------------------------------------------
    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 237, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__
Failed example:
    RQQ.category()
Expected:
    Join of Category of complete discrete valuation fields and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets
Got:
    Join of Category of complete discrete valuation rings and Category of commutative algebras over (number fields and quotient fields and metric spaces) and Category of infinite sets
**********************************************************************
File "src/sage/rings/laurent_series_ring.py", line 239, in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__
Failed example:
    TestSuite(RQQ).run()
Expected nothing
Got:
    Failure in _test_euclidean_degree:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/euclidean_domains.py", line 155, in _test_euclidean_degree
        tester.assertEqual(a.euclidean_degree() == min_degree, a.is_unit())
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: False != True
    ------------------------------------------------------------
    Failure in _test_gcd_vs_xgcd:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/principal_ideal_domains.py", line 119, in _test_gcd_vs_xgcd
        tester.assertTrue(gcd==xgcd[0],
      File "/usr/lib/python3.8/unittest/case.py", line 765, in assertTrue
        raise self.failureException(msg)
    AssertionError: The methods gcd and xgcd disagree on Laurent Series Ring in t over Rational Field:
      gcd(t,t) = t
     xgcd(t,t) = (1, t^-1, 0)
    ------------------------------------------------------------
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/home/roed/sage-9.6.beta2/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/complete_discrete_valuation.py", line 304, in _test_matrix_smith
        tester.assertEqual(U.base_ring(), base)
      File "/usr/lib/python3.8/unittest/case.py", line 912, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/usr/lib/python3.8/unittest/case.py", line 905, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: Laurent Series Ring in t over Rational Field != Power Series Ring in t over Rational Field
    ------------------------------------------------------------
    The following tests failed: _test_euclidean_degree, _test_gcd_vs_xgcd, _test_matrix_smith
**********************************************************************
2 items had failures:
   4 of  43 in sage.rings.laurent_series_ring.LaurentSeriesRing
   4 of  18 in sage.rings.laurent_series_ring.LaurentSeriesRing.__init__
    [182 tests, 8 failures, 0.21 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/multi_power_series_ring_element.py
**********************************************************************
File "src/sage/rings/multi_power_series_ring_element.py", line 1081, in sage.rings.multi_power_series_ring_element.MPowerSeries.__mod__
Failed example:
    g in R
Expected:
    False
Got:
    True
**********************************************************************
1 item had failures:
   1 of   7 in sage.rings.multi_power_series_ring_element.MPowerSeries.__mod__
    [466 tests, 1 failure, 0.27 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/categories/complete_discrete_valuation.py
**********************************************************************
File "src/sage/categories/complete_discrete_valuation.py", line 621, in sage.categories.complete_discrete_valuation.CompleteDiscreteValuationFields
Failed example:
    LaurentSeriesRing(QQ,'u') in CompleteDiscreteValuationFields()
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   6 in sage.categories.complete_discrete_valuation.CompleteDiscreteValuationFields
    [200 tests, 1 failure, 0.24 s]
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pyx
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 9855, in sage.matrix.matrix2.Matrix.inverse
Failed example:
    ~M
Expected:
    [t^-1 t^-2]
    [   0 t^-1]
Got:
    [1 0]
    [0 1]
**********************************************************************
1 item had failures:
   1 of  13 in sage.matrix.matrix2.Matrix.inverse
    [2807 tests, 1 failure, 8.67 s]
----------------------------------------------------------------------
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix_cdv.pyx  # 1 doctest failed
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/laurent_series_ring.py  # 8 doctests failed
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/rings/multi_power_series_ring_element.py  # 1 doctest failed
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/categories/complete_discrete_valuation.py  # 1 doctest failed
sage -t --long --warn-long 40.9 --random-seed=317472647872885548861559054668703098865 src/sage/matrix/matrix2.pyx  # 1 doctest failed
```



---

archive/issue_comments_346222.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-20T22:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346222",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346223.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T22:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346224.json:
```json
{
    "body": "<a id='comment:39'></a>I fixed the doctest failures, except the one in `src/sage/rings/multi_power_series_ring_element.py` because I can't understand the relation with this ticket. Any idea?",
    "created_at": "2022-02-20T22:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346224",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:39'></a>I fixed the doctest failures, except the one in `src/sage/rings/multi_power_series_ring_element.py` because I can't understand the relation with this ticket. Any idea?



---

archive/issue_comments_346225.json:
```json
{
    "body": "<a id='comment:40'></a>Oh, it's just because I removed the function `__contains__` in `sage.rings.power_series_ring`.\n\nHowever, this function didn't work as expected. Typically, we had:\n\n```\nsage: R.<t> = QQ[[]]\nsage: K = R.fraction_field()\nsage: K(t) in R\nFalse\n```\n\nFalling back to the generic implementation of `__contains__`, this problem disappears but an element in `Z/2Z[This is the Trac macro *u* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#u-macro)` is considered as belonging to `Z[This is the Trac macro *u* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#u-macro)`. It's certainly not mathematically correct but the same holds for polynomials. So I'm not sure if it's better to fix the bug (I don't expect this to be easy) or the doctest.",
    "created_at": "2022-02-20T23:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346225",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:40'></a>Oh, it's just because I removed the function `__contains__` in `sage.rings.power_series_ring`.

However, this function didn't work as expected. Typically, we had:

```
sage: R.<t> = QQ[[]]
sage: K = R.fraction_field()
sage: K(t) in R
False
```

Falling back to the generic implementation of `__contains__`, this problem disappears but an element in `Z/2Z[This is the Trac macro *u* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#u-macro)` is considered as belonging to `Z[This is the Trac macro *u* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#u-macro)`. It's certainly not mathematically correct but the same holds for polynomials. So I'm not sure if it's better to fix the bug (I don't expect this to be easy) or the doctest.



---

archive/issue_comments_346226.json:
```json
{
    "body": "<a id='comment:41'></a>I think this is just a consequence of Sage's longstanding definition of containment.  It's analogous to\n\n```\nsage: mod(3, 7) in ZZ                                                                                                  \nTrue\n```\nSo I would say that restoring the generic behavior for containment is correct.",
    "created_at": "2022-02-20T23:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346226",
    "user": "https://github.com/roed314"
}
```

<a id='comment:41'></a>I think this is just a consequence of Sage's longstanding definition of containment.  It's analogous to

```
sage: mod(3, 7) in ZZ                                                                                                  
True
```
So I would say that restoring the generic behavior for containment is correct.



---

archive/issue_comments_346227.json:
```json
{
    "body": "<a id='comment:42'></a>OK. Do you agree if I just remove the failing doctest?",
    "created_at": "2022-02-20T23:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346227",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:42'></a>OK. Do you agree if I just remove the failing doctest?



---

archive/issue_comments_346228.json:
```json
{
    "body": "<a id='comment:43'></a>I agree.  In fact, the implementation of `__mod__` here does not agree with the convention in the rest of Sage, where `__mod__` returns something in the same parent rather than just changing the base ring.  But I think that's an issue for another ticket.",
    "created_at": "2022-02-21T01:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346228",
    "user": "https://github.com/roed314"
}
```

<a id='comment:43'></a>I agree.  In fact, the implementation of `__mod__` here does not agree with the convention in the rest of Sage, where `__mod__` returns something in the same parent rather than just changing the base ring.  But I think that's an issue for another ticket.



---

archive/issue_comments_346229.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-21T01:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346230.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-21T01:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346230",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346231.json:
```json
{
    "body": "<a id='comment:46'></a>Another comment (since I see you're still awake)\n\n* Anywhere you use backslashes in docstrings you need to make sure that they're raw strings (have an \"r\" before the triple quote)\n\nI'm reading through the changes now and may have more comments....",
    "created_at": "2022-02-21T01:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346231",
    "user": "https://github.com/roed314"
}
```

<a id='comment:46'></a>Another comment (since I see you're still awake)

* Anywhere you use backslashes in docstrings you need to make sure that they're raw strings (have an "r" before the triple quote)

I'm reading through the changes now and may have more comments....



---

archive/issue_comments_346232.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-21T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_060264.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-05-12T07:11:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23486#event-60264"
}
```



---

archive/issue_comments_346233.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-05-12T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346233",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346234.json:
```json
{
    "body": "<a id='comment:48'></a>red branch => needs work",
    "created_at": "2022-05-12T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346234",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:48'></a>red branch => needs work



---

archive/issue_comments_346235.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T09:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346236.json:
```json
{
    "body": "<a id='comment:50'></a>I fixed merging issues.\n\nI put needs review in order to get feedback from the patchbot.",
    "created_at": "2022-05-19T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346236",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:50'></a>I fixed merging issues.

I put needs review in order to get feedback from the patchbot.



---

archive/issue_comments_346237.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-05-19T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346237",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_346238.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T17:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346239.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T20:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346240.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T20:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346241.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T20:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346242.json:
```json
{
    "body": "<a id='comment:56'></a>Are you using any results from the articles you wrote on p-adic precision? If so, I think that it would be nice to reference the articles in the ALGORITHM sections.\n\n---\nNew commits:",
    "created_at": "2022-05-19T21:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346242",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:56'></a>Are you using any results from the articles you wrote on p-adic precision? If so, I think that it would be nice to reference the articles in the ALGORITHM sections.

---
New commits:



---

archive/issue_comments_346243.json:
```json
{
    "body": "<a id='comment:57'></a>How are these change related to this issue? Can they be reverted?\n\n```\ndiff --git a/src/sage/rings/padics/relaxed_template.pxi b/src/sage/rings/padics/relaxed_template.pxi\nindex 7269da0..42af3ea 100644\n--- a/src/sage/rings/padics/relaxed_template.pxi\n+++ b/src/sage/rings/padics/relaxed_template.pxi\n@@ -1265,19 +1265,10 @@ cdef class RelaxedElement(pAdicGenericElement):\n             sage: a.lift_to_precision(20)\n             4*5 + 4*5^2 + 5^4 + O(5^20)\n \n-        When the precision is omitted, the default precision of the parent\n-        is used::\n+        When the precision is omitted, the element is made unbounded::\n \n             sage: a.lift_to_precision()\n-            4*5 + 4*5^2 + 5^4 + O(5^10)\n-\n-        When the parent is a field, the behaviour is slightly different since\n-        the default precision of the parent becomes the relative precision\n-        of the lifted element::\n-\n-            sage: K = R.fraction_field()\n-            sage: K(a).lift_to_precision()\n-            4*5 + 4*5^2 + 5^4 + O(5^11)\n+            4*5 + 4*5^2 + 5^4 + ...\n \n         Note that the precision never decreases::\n \n@@ -1298,13 +1289,14 @@ cdef class RelaxedElement(pAdicGenericElement):\n         cdef long prec\n         cdef long default_prec = self._parent.default_prec()\n         if absprec is None:\n-            if self.prime_pow.in_field:\n-                self._jump_relative_c(1, self._precbound)\n-                if self._precrel == 0:\n-                    return self._parent.zero()\n-                prec = self._valuation + default_prec\n-            else:\n-                prec = default_prec\n+            prec = maxordp\n+            #if self.prime_pow.in_field:\n+            #    self._jump_relative_c(1, self._precbound)\n+            #    if self._precrel == 0:\n+            #        return self._parent.zero()\n+            #    prec = self._valuation + default_prec\n+            #else:\n+            #    prec = default_prec\n         else:\n             if absprec > maxordp:\n                 raise OverflowError(\"beyond the maximal precision (which is %s)\" % maxordp)\n```",
    "created_at": "2022-05-19T21:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346243",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:57'></a>How are these change related to this issue? Can they be reverted?

```
diff --git a/src/sage/rings/padics/relaxed_template.pxi b/src/sage/rings/padics/relaxed_template.pxi
index 7269da0..42af3ea 100644
--- a/src/sage/rings/padics/relaxed_template.pxi
+++ b/src/sage/rings/padics/relaxed_template.pxi
@@ -1265,19 +1265,10 @@ cdef class RelaxedElement(pAdicGenericElement):
             sage: a.lift_to_precision(20)
             4*5 + 4*5^2 + 5^4 + O(5^20)
 
-        When the precision is omitted, the default precision of the parent
-        is used::
+        When the precision is omitted, the element is made unbounded::
 
             sage: a.lift_to_precision()
-            4*5 + 4*5^2 + 5^4 + O(5^10)
-
-        When the parent is a field, the behaviour is slightly different since
-        the default precision of the parent becomes the relative precision
-        of the lifted element::
-
-            sage: K = R.fraction_field()
-            sage: K(a).lift_to_precision()
-            4*5 + 4*5^2 + 5^4 + O(5^11)
+            4*5 + 4*5^2 + 5^4 + ...
 
         Note that the precision never decreases::
 
@@ -1298,13 +1289,14 @@ cdef class RelaxedElement(pAdicGenericElement):
         cdef long prec
         cdef long default_prec = self._parent.default_prec()
         if absprec is None:
-            if self.prime_pow.in_field:
-                self._jump_relative_c(1, self._precbound)
-                if self._precrel == 0:
-                    return self._parent.zero()
-                prec = self._valuation + default_prec
-            else:
-                prec = default_prec
+            prec = maxordp
+            #if self.prime_pow.in_field:
+            #    self._jump_relative_c(1, self._precbound)
+            #    if self._precrel == 0:
+            #        return self._parent.zero()
+            #    prec = self._valuation + default_prec
+            #else:
+            #    prec = default_prec
         else:
             if absprec > maxordp:
                 raise OverflowError("beyond the maximal precision (which is %s)" % maxordp)
```



---

archive/issue_comments_346244.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T21:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346245.json:
```json
{
    "body": "<a id='comment:59'></a>Xavier, I made some review changes, trying to simplify things a bit and improving some docstrings (hopefully.)\n\nThis looks great to me, so once doctests pass again an the above comments have been adressed, this is good to be merged.\n\n---\nNew commits:",
    "created_at": "2022-05-19T21:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346245",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:59'></a>Xavier, I made some review changes, trying to simplify things a bit and improving some docstrings (hopefully.)

This looks great to me, so once doctests pass again an the above comments have been adressed, this is good to be merged.

---
New commits:



---

archive/issue_comments_346246.json:
```json
{
    "body": "<a id='comment:61'></a>It seems that your class `SharedParentMethods` does not work.\n\n```\nsage: R = Zp(5, prec=10)\nsage: R._matrix_echelonize\nTraceback (most recent call last):\n...\nAttributeError: 'pAdicRingCappedRelative_with_category' object has no attribute '_matrix_echelonize'\n```\n\n---\nNew commits:",
    "created_at": "2022-05-21T10:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346246",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:61'></a>It seems that your class `SharedParentMethods` does not work.

```
sage: R = Zp(5, prec=10)
sage: R._matrix_echelonize
Traceback (most recent call last):
...
AttributeError: 'pAdicRingCappedRelative_with_category' object has no attribute '_matrix_echelonize'
```

---
New commits:



---

archive/issue_comments_346247.json:
```json
{
    "body": "<a id='comment:62'></a>I'm getting the following warning when Sage starts:\n\n```\n/home/xcaruso/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/category.py:1592: UserWarning: CompleteDiscreteValuationRings.ParentMethods should not have a super class\n```\nSo I'm coming back to the previous version.",
    "created_at": "2022-06-02T09:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346247",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:62'></a>I'm getting the following warning when Sage starts:

```
/home/xcaruso/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/categories/category.py:1592: UserWarning: CompleteDiscreteValuationRings.ParentMethods should not have a super class
```
So I'm coming back to the previous version.



---

archive/issue_comments_346248.json:
```json
{
    "body": "<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-02T09:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346249.json:
```json
{
    "body": "<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-02T09:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346250.json:
```json
{
    "body": "<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-02T21:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:66'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346251.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-09T06:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346251",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_346252.json:
```json
{
    "body": "<a id='comment:68'></a>red branch => needs work\n\n---\nNew commits:",
    "created_at": "2022-08-09T06:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23486#issuecomment-346252",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:68'></a>red branch => needs work

---
New commits:



---

archive/issue_events_060265.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23486#event-60265"
}
```



---

archive/issue_events_060266.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23486",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23486#event-60266"
}
```
