# Issue 23683: Speed up function field doctests

archive/issues_023446.json:
```json
{
    "assignees": [],
    "body": "Followup to #23193.\n\nFunction field doctests take 10 minutes on reasonable machines. That's way too much. The changes introduced here drop this again to 7/70 seconds for the doctests/long doctests.\n\nCC:  @fchapoton @roed314 @xcaruso\n\nComponent: **commutative algebra**\n\nAuthor: **Julian R\u00fcth**\n\nBranch: **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**\n\nReviewer: **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23683_\n\n",
    "closed_at": "2017-09-04T06:10:14Z",
    "created_at": "2017-08-23T13:18:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up function field doctests",
    "type": "issue",
    "updated_at": "2023-01-08T09:36:42Z",
    "url": "https://github.com/sagemath/sage/issues/23683",
    "user": "https://github.com/saraedum"
}
```
Followup to #23193.

Function field doctests take 10 minutes on reasonable machines. That's way too much. The changes introduced here drop this again to 7/70 seconds for the doctests/long doctests.

CC:  @fchapoton @roed314 @xcaruso

Component: **commutative algebra**

Author: **Julian Rüth**

Branch: **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**

Reviewer: **Travis Scrimshaw, Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/23683_





---

archive/issue_events_326415.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-08-23T13:18:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326415"
}
```



---

archive/issue_events_326416.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-08-23T13:18:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326416"
}
```



---

archive/issue_events_326417.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-08-23T13:18:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326417"
}
```



---

archive/issue_events_326418.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-08-23T13:18:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326418"
}
```



---

archive/issue_comments_356514.json:
```json
{
    "body": "Branch: **[u/saraedum/speed_up_function_field_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/speed_up_function_field_doctests)**",
    "created_at": "2017-08-23T13:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356514",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/speed_up_function_field_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/speed_up_function_field_doctests)**



---

archive/issue_events_326419.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2017-08-23T13:51:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326419"
}
```



---

archive/issue_comments_356515.json:
```json
{
    "body": "Commit: **[`bf5f0a8`](https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878)**",
    "created_at": "2017-08-23T13:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356515",
    "user": "https://github.com/saraedum"
}
```

Commit: **[`bf5f0a8`](https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878)**



---

archive/issue_comments_356516.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878\"><code>bf5f0a8</code></a></td><td><code>Limit runs of function field test suites</code></td></tr></table>\n",
    "created_at": "2017-08-23T13:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356516",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878"><code>bf5f0a8</code></a></td><td><code>Limit runs of function field test suites</code></td></tr></table>




---

archive/issue_comments_356517.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Followup to #23193.\n \n-Function field doctests take 10 minutes on reasonable machines. That's way too much.\n+Function field doctests take 10 minutes on reasonable machines. That's way too much. The changes introduced here drop this again to 7/70 seconds for the doctests/long doctests.\n``````\n",
    "created_at": "2017-08-23T13:51:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356517",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Followup to #23193.
 
-Function field doctests take 10 minutes on reasonable machines. That's way too much.
+Function field doctests take 10 minutes on reasonable machines. That's way too much. The changes introduced here drop this again to 7/70 seconds for the doctests/long doctests.
``````




---

archive/issue_comments_356518.json:
```json
{
    "body": "Author: **Julian R\u00fcth**",
    "created_at": "2017-08-23T13:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356518",
    "user": "https://github.com/saraedum"
}
```

Author: **Julian Rüth**



---

archive/issue_comments_356519.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI think you should rather reduce the length of \"some_elements\" to at most 5 or 6. I have not chekced the current length, but it is probably much too long. IT was 3 before the ticket that caused the \"long-time doctest\" problem.",
    "created_at": "2017-08-23T13:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356519",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

I think you should rather reduce the length of "some_elements" to at most 5 or 6. I have not chekced the current length, but it is probably much too long. IT was 3 before the ticket that caused the "long-time doctest" problem.



---

archive/issue_comments_356520.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhy should some_elements be so short? This is precisely why we introduced max_runs in the first place. If I would write some_elements() manually, I would centainly come up with a list much longer than that. We actually find lots of bugs with having long some_elements lists in say p-adics code.",
    "created_at": "2017-08-23T14:00:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356520",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:6" align="right">comment:6</div>

Why should some_elements be so short? This is precisely why we introduced max_runs in the first place. If I would write some_elements() manually, I would centainly come up with a list much longer than that. We actually find lots of bugs with having long some_elements lists in say p-adics code.



---

archive/issue_comments_356521.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nok, I did not know about max_runs.",
    "created_at": "2017-08-23T14:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356521",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

ok, I did not know about max_runs.



---

archive/issue_comments_356522.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe length is typically about 50. The problem is that some doctests consider squares or triples of these. I think that max_runs is the way to go to make these doctests fast enough.",
    "created_at": "2017-08-23T14:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356522",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:8" align="right">comment:8</div>

The length is typically about 50. The problem is that some doctests consider squares or triples of these. I think that max_runs is the way to go to make these doctests fast enough.



---

archive/issue_comments_356523.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@saraedum](#comment%3A8):\n> The length is typically about 50. The problem is that some doctests consider squares or triples of these. I think that max_runs is the way to go to make these doctests fast enough.\n\n-1 because it doesn't get the same sort of coverage as to using 5-10 elements. E.g., it only does `x0 * (y * z) == (x0 * y) * z` for a fixed `x0`, which maybe too simple. So IMO, it is better to do a subset of `some_elements` (passed via `elements` to the `TestSuite`) to make sure you get more complicated elements tested, which is part of the reason you have these more complicated `some_elements()`, right?\n\nReally, `some_elements()` is designed primarily for testing rather than to tell the user something. So having smaller number of `some_elements()`, but having those elements be \"interesting\" (in an appropriate definition), is what I think it should be.",
    "created_at": "2017-08-23T14:29:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356523",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@saraedum](#comment%3A8):
> The length is typically about 50. The problem is that some doctests consider squares or triples of these. I think that max_runs is the way to go to make these doctests fast enough.

-1 because it doesn't get the same sort of coverage as to using 5-10 elements. E.g., it only does `x0 * (y * z) == (x0 * y) * z` for a fixed `x0`, which maybe too simple. So IMO, it is better to do a subset of `some_elements` (passed via `elements` to the `TestSuite`) to make sure you get more complicated elements tested, which is part of the reason you have these more complicated `some_elements()`, right?

Really, `some_elements()` is designed primarily for testing rather than to tell the user something. So having smaller number of `some_elements()`, but having those elements be "interesting" (in an appropriate definition), is what I think it should be.



---

archive/issue_comments_356524.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think this is a problem of `some_elements` or the doctests that use pairs and triples. Either `some_elements` should not just select the first few, or the doctests should generate the product in a more \"interesting\" fashion.",
    "created_at": "2017-08-23T14:43:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356524",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:10" align="right">comment:10</div>

I think this is a problem of `some_elements` or the doctests that use pairs and triples. Either `some_elements` should not just select the first few, or the doctests should generate the product in a more "interesting" fashion.



---

archive/issue_comments_356525.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI am strongly opposed to shorten some_elements. As I said, having some_elements be long has proved very useful in the past. Of course, if the pairs tested are not \"interesting\" that is very bad.",
    "created_at": "2017-08-23T14:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356525",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:11" align="right">comment:11</div>

I am strongly opposed to shorten some_elements. As I said, having some_elements be long has proved very useful in the past. Of course, if the pairs tested are not "interesting" that is very bad.



---

archive/issue_comments_356526.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThis is now #23686.",
    "created_at": "2017-08-23T14:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356526",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:12" align="right">comment:12</div>

This is now #23686.



---

archive/issue_comments_356527.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@saraedum](#comment%3A10):\n> I think this is a problem of `some_elements` or the doctests that use pairs and triples. Either `some_elements` should not just select the first few, or the doctests should generate the product in a more \"interesting\" fashion.\n\nThat would be an overengineered solution: you create a long list just to make a shorter list by sampling, which in turn, does not guarantee you get good elements. We could randomize this, but then you could have things that look like heisenbugs. So I do not think it makes any sense to have something like `_test_associative` to not go through all triples of the testing elements.",
    "created_at": "2017-08-23T15:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356527",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@saraedum](#comment%3A10):
> I think this is a problem of `some_elements` or the doctests that use pairs and triples. Either `some_elements` should not just select the first few, or the doctests should generate the product in a more "interesting" fashion.

That would be an overengineered solution: you create a long list just to make a shorter list by sampling, which in turn, does not guarantee you get good elements. We could randomize this, but then you could have things that look like heisenbugs. So I do not think it makes any sense to have something like `_test_associative` to not go through all triples of the testing elements.



---

archive/issue_comments_356528.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI can write down manually a lot of interesting elements in a p-adic ring that I would want tests to be run for. There are so many weird corner cases with precision in particular in extensions that you do not want to shorten these lists. Of course you can not test everything in all triples but that's ok. I still want almost everything be tested for the individual elements and pairs. (Actually p-adic some_elements is not so large yet because (as far as I recall) when we wrote it max_runs was not ready yet.)\nWhat is wrong about not just taking the plain cartesian product but do some deterministic sampling? How we implement that is a different question. I believe there are a few viable options by either adapting the tests or have some_elements detect that it is being queried for a prouduct.",
    "created_at": "2017-08-23T15:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356528",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:14" align="right">comment:14</div>

I can write down manually a lot of interesting elements in a p-adic ring that I would want tests to be run for. There are so many weird corner cases with precision in particular in extensions that you do not want to shorten these lists. Of course you can not test everything in all triples but that's ok. I still want almost everything be tested for the individual elements and pairs. (Actually p-adic some_elements is not so large yet because (as far as I recall) when we wrote it max_runs was not ready yet.)
What is wrong about not just taking the plain cartesian product but do some deterministic sampling? How we implement that is a different question. I believe there are a few viable options by either adapting the tests or have some_elements detect that it is being queried for a prouduct.



---

archive/issue_comments_356529.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@saraedum](#comment%3A14):\n> What is wrong about not just taking the plain cartesian product but do some deterministic sampling?\n\nBecause then you have fundamentally no control over the elements that are chosen and it can defeat the entire purpose of having a few interesting elements. Say you want 4 relatively trivial elements and 1 very complicated element in order to test interesting examples but it is too slow otherwise (perhaps in reality it would be 2x or 3x these particular numbers). It is very likely that you would sample only the trivial elements, but you would have no idea that those were the ones sampled, much less have any clear (or even feasible) way to change that. If you want to sample elements, then *you* sample the elements and pass them to the `TestSuite`. However, you have to do that for every such test, so the best solution is to make `some_elements` smaller and instead pass `elements` with more complicated elements for those other more fundamental tests.",
    "created_at": "2017-08-23T19:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356529",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@saraedum](#comment%3A14):
> What is wrong about not just taking the plain cartesian product but do some deterministic sampling?

Because then you have fundamentally no control over the elements that are chosen and it can defeat the entire purpose of having a few interesting elements. Say you want 4 relatively trivial elements and 1 very complicated element in order to test interesting examples but it is too slow otherwise (perhaps in reality it would be 2x or 3x these particular numbers). It is very likely that you would sample only the trivial elements, but you would have no idea that those were the ones sampled, much less have any clear (or even feasible) way to change that. If you want to sample elements, then *you* sample the elements and pass them to the `TestSuite`. However, you have to do that for every such test, so the best solution is to make `some_elements` smaller and instead pass `elements` with more complicated elements for those other more fundamental tests.



---

archive/issue_comments_356530.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWhatever solution is chosen at the end, you should not remove the real time indications in the comments, but update them.",
    "created_at": "2017-08-24T16:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356530",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

Whatever solution is chosen at the end, you should not remove the real time indications in the comments, but update them.



---

archive/issue_comments_356531.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI would prefer to see this solved, even if in a bad way, than to stay unsolved any second longer.",
    "created_at": "2017-08-25T15:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356531",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

I would prefer to see this solved, even if in a bad way, than to stay unsolved any second longer.



---

archive/issue_comments_356532.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tscrim](#comment%3A15):\n> Replying to [@saraedum](#comment%3A14):\n> > What is wrong about not just taking the plain cartesian product but do some deterministic sampling?\n\n> \n> Because then you have fundamentally no control over the elements that are chosen and it can defeat the entire purpose of having a few interesting elements. Say you want 4 relatively trivial elements and 1 very complicated element in order to test interesting examples but it is too slow otherwise (perhaps in reality it would be 2x or 3x these particular numbers). It is very likely that you would sample only the trivial elements, but you would have no idea that those were the ones sampled, much less have any clear (or even feasible) way to change that. If you want to sample elements, then *you* sample the elements and pass them to the `TestSuite`. However, you have to do that for every such test, so the best solution is to make `some_elements` smaller and instead pass `elements` with more complicated elements for those other more fundamental tests.\n\nI don't understand. How can I pass in pairs and triples of elements to the TestSuite? I also don't understand the proposal apart from that technicality. If I follow what you propose, then I pass in a long list of elements to most test (the ones that are linear in the number of elements) and just use the default `some_elements` for the tests that use pairs and triples?",
    "created_at": "2017-08-25T16:52:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356532",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tscrim](#comment%3A15):
> Replying to [@saraedum](#comment%3A14):
> > What is wrong about not just taking the plain cartesian product but do some deterministic sampling?

> 
> Because then you have fundamentally no control over the elements that are chosen and it can defeat the entire purpose of having a few interesting elements. Say you want 4 relatively trivial elements and 1 very complicated element in order to test interesting examples but it is too slow otherwise (perhaps in reality it would be 2x or 3x these particular numbers). It is very likely that you would sample only the trivial elements, but you would have no idea that those were the ones sampled, much less have any clear (or even feasible) way to change that. If you want to sample elements, then *you* sample the elements and pass them to the `TestSuite`. However, you have to do that for every such test, so the best solution is to make `some_elements` smaller and instead pass `elements` with more complicated elements for those other more fundamental tests.

I don't understand. How can I pass in pairs and triples of elements to the TestSuite? I also don't understand the proposal apart from that technicality. If I follow what you propose, then I pass in a long list of elements to most test (the ones that are linear in the number of elements) and just use the default `some_elements` for the tests that use pairs and triples?



---

archive/issue_comments_356533.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-08-25T16:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356533",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_356534.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.\n\nAlso, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.",
    "created_at": "2017-08-25T16:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356534",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

I've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.

Also, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.



---

archive/issue_comments_356535.json:
```json
{
    "body": "Changed commit from **[`bf5f0a8`](https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878)** to **[`a931f35`](https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c)**",
    "created_at": "2017-08-25T16:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356535",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bf5f0a8`](https://github.com/sagemath/sagetrac-mirror/commit/bf5f0a86b4d36e4967e63e0d894b3e059df3b878)** to **[`a931f35`](https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c)**



---

archive/issue_comments_356536.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c\"><code>a931f35</code></a></td><td><code>Put long time timing back in</code></td></tr></table>\n",
    "created_at": "2017-08-25T16:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356536",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c"><code>a931f35</code></a></td><td><code>Put long time timing back in</code></td></tr></table>




---

archive/issue_comments_356537.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@fchapoton](#comment%3A16):\n> Whatever solution is chosen at the end, you should not remove the real time indications in the comments, but update them.\n\nOk. I put indications back in.",
    "created_at": "2017-08-25T16:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356537",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@fchapoton](#comment%3A16):
> Whatever solution is chosen at the end, you should not remove the real time indications in the comments, but update them.

Ok. I put indications back in.



---

archive/issue_comments_356538.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment%3A19):\n> I've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.\n\nOk. Cool.\n\n> Also, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.\n\nCould you elaborate or maybe rather comment on the followup ticket?",
    "created_at": "2017-08-25T17:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356538",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment%3A19):
> I've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.

Ok. Cool.

> Also, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.

Could you elaborate or maybe rather comment on the followup ticket?



---

archive/issue_comments_356539.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@saraedum](#comment%3A22):\n> Replying to [@tscrim](#comment%3A19):\n> > I've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.\n\n> Ok. Cool.\n\nMinor typo: `# long timeA (10s)`; you can set a positive review once fixed.\n\n> > Also, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.\n\n> Could you elaborate or maybe rather comment on the followup ticket?\n\nI believe David (Roe) will post the followup ticket with perhaps more details and/or a first implementation. What we agreed upon was basically the following:\n\n- if `some_elements()^N > max_runs` and something like `max_samples` or `sampling=True` was passed:\n  * do sampling\n- else:\n  * use the direct iterator\n\nAs far as sampling goes, in order to do \"good\" sampling, we would need to decide upon a convention for where in `some_elements` the more \"interesting\" objects are at the end and we sample more heavily from there.\n\nSomething that I have used the `TestSuite` for is to increase the `max_runs` and fix failures as more interesting elements come up. So I needed that to behave in a more deterministic way as with sampling, it could be nice for `N` but fail for `N-1` because of the elements used. I also like it to work for infinite (enumerated) sets as well.",
    "created_at": "2017-08-25T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356539",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@saraedum](#comment%3A22):
> Replying to [@tscrim](#comment%3A19):
> > I've been talking with David at Days 88 about this, and I realized that I wasn't clear that I am not opposed to the current branch as a short-term solution. Julian, if you could update the timings, I will set a positive review.

> Ok. Cool.

Minor typo: `# long timeA (10s)`; you can set a positive review once fixed.

> > Also, David and I discussed implementing a sampling feature to the `TestSuite` that would not be run by default, but by passing another argument to `TestSuite` that would only be used when the number of elements was bigger than `max_runs`.

> Could you elaborate or maybe rather comment on the followup ticket?

I believe David (Roe) will post the followup ticket with perhaps more details and/or a first implementation. What we agreed upon was basically the following:

- if `some_elements()^N > max_runs` and something like `max_samples` or `sampling=True` was passed:
  * do sampling
- else:
  * use the direct iterator

As far as sampling goes, in order to do "good" sampling, we would need to decide upon a convention for where in `some_elements` the more "interesting" objects are at the end and we sample more heavily from there.

Something that I have used the `TestSuite` for is to increase the `max_runs` and fix failures as more interesting elements come up. So I needed that to behave in a more deterministic way as with sampling, it could be nice for `N` but fail for `N-1` because of the elements used. I also like it to work for infinite (enumerated) sets as well.



---

archive/issue_comments_356540.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThe followup is #23724.  I'm happy for feedback on the approach taken there.",
    "created_at": "2017-08-26T04:12:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356540",
    "user": "https://github.com/roed314"
}
```

<div id="comment:24" align="right">comment:24</div>

The followup is #23724.  I'm happy for feedback on the approach taken there.



---

archive/issue_comments_356541.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-08-26T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356541",
    "user": "https://github.com/fchapoton"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Frédéric Chapoton**



---

archive/issue_comments_356542.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nafter correcting the typo, I am setting to positive\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a\"><code>d3bd64c</code></a></td><td><code>fix typo</code></td></tr></table>\n",
    "created_at": "2017-08-26T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356542",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

after correcting the typo, I am setting to positive

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a"><code>d3bd64c</code></a></td><td><code>fix typo</code></td></tr></table>




---

archive/issue_events_326420.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-26T11:49:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326420"
}
```



---

archive/issue_events_326421.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-26T11:49:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326421"
}
```



---

archive/issue_comments_356543.json:
```json
{
    "body": "Changed branch from **[u/saraedum/speed_up_function_field_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/speed_up_function_field_doctests)** to **[public/23683](https://github.com/sagemath/sagetrac-mirror/tree/public/23683)**",
    "created_at": "2017-08-26T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356543",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/saraedum/speed_up_function_field_doctests](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/speed_up_function_field_doctests)** to **[public/23683](https://github.com/sagemath/sagetrac-mirror/tree/public/23683)**



---

archive/issue_comments_356544.json:
```json
{
    "body": "Changed commit from **[`a931f35`](https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c)** to **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**",
    "created_at": "2017-08-26T11:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356544",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`a931f35`](https://github.com/sagemath/sagetrac-mirror/commit/a931f35fa05980baa5fdce9fb555b569edabe05c)** to **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**



---

archive/issue_comments_356545.json:
```json
{
    "body": "Changed branch from **[public/23683](https://github.com/sagemath/sagetrac-mirror/tree/public/23683)** to **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**",
    "created_at": "2017-09-04T06:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356545",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/23683](https://github.com/sagemath/sagetrac-mirror/tree/public/23683)** to **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)**



---

archive/issue_events_326422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-04T06:10:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326422"
}
```



---

archive/issue_events_326423.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e8842d7da1789373f0c1fc248dc0b07159634b79",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-04T06:10:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23683#event-326423"
}
```



---

archive/issue_comments_356546.json:
```json
{
    "body": "Changed commit from **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)** to none",
    "created_at": "2023-01-08T09:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23683#issuecomment-356546",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`d3bd64c`](https://github.com/sagemath/sagetrac-mirror/commit/d3bd64cdde8c75b43b767950885fb6ec2aeedd6a)** to none
