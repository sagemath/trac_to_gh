# Issue 23925: Bulk fix of signal handling in symbolics

archive/issues_023688.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nIn Sage-8.1.beta6 this crashes:\n\n```\nsage: (x/(x^1431655765-1)).normalize()\nException (FLINT memory_manager). Unable to allocate memory.\n------------------------------------------------------------------------\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5db8)[0x7fb72168edb8]\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e25)[0x7fb72168ee25]\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8aba)[0x7fb721691aba]\n/lib64/libpthread.so.0(+0x10860)[0x7fb729d0a860]\n/lib64/libc.so.6(gsignal+0x37)[0x7fb729299fa7]\n/lib64/libc.so.6(abort+0x16a)[0x7fb72929b30a]\n/usr/local/src/sage-config/local/lib/libflint.so.13(+0x4d104)[0x7fb7148a1104]\n/usr/local/src/sage-config/local/lib/libflint.so.13(+0x534b8)[0x7fb7148a74b8]\n/usr/local/src/sage-config/local/lib/libflint.so.13(fmpz_poly_init2+0x3d)[0x7fb7148f435d]\n/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z24convertFacCF2Fmpz_poly_tP16fmpz_poly_structRK13CanonicalForm+0x3a)[0x7fb68fe03b7a]\n/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z17gcd_univar_flint0RK13CanonicalFormS1_+0x37)[0x7fb68fd4f817]\n/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z11subResGCD_0RK13CanonicalFormS1_+0x611)[0x7fb68fd4f5d1]\n/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z8gcd_polyRK13CanonicalFormS1_+0x128)[0x7fb68fcfaaa8]\n/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z3gcdRK13CanonicalFormS1_+0x3c4)[0x7fb68fcfb0d4]\n/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZN5GiNaC7gcdpolyERKNS_2exES2_PS0_S3_b+0x259)[0x7fb68915f159]\n/usr/local/src/sage-config/local/lib/libpynac.so.14(+0x120312)[0x7fb689176312]\n/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC3mul6normalERSt3mapINS_2exES2_NS_10ex_is_lessESaISt4pairIKS2_S2_EEES9_ij+0x417)[0x7fb689177587]\n/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC2ex6normalEibb+0xd6)[0x7fb689171446]\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0xd4daf)[0x7fb688da5daf]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x84cc)[0x7fb72a028cdc]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x82cc)[0x7fb72a028adc]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb72a04f4da]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe7)[0x7fb72a050a17]\n/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(Py_Main+0xc7a)[0x7fb72a06760a]\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fb7292876a5]\npython(_start+0x29)[0x400769]\n------------------------------------------------------------------------\nUnhandled SIGABRT: An abort() occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\n```\nwhile the underlying operation only aborts with `RuntimeError`:\n\n```\ngcd(x,x^1431655765-1)\nException (FLINT memory_manager). Unable to allocate memory.\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-1-468b83720c84> in <module>()\n      1 \n----> 2 gcd(x,x**Integer(1431655765)-Integer(1))\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/arith/misc.pyc in gcd(a, b, **kwargs)\n   1576     if b is not None:\n   1577         try:\n-> 1578             return a.gcd(b, **kwargs)\n   1579         except (AttributeError, TypeError):\n   1580             pass\n\n/usr/local/src/sage-config/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gcd (build/cythonized/sage/symbolic/expression.cpp:41191)()\n   6888         cdef Expression r = self.coerce_in(b)\n   6889         cdef GEx x\n-> 6890         sig_on()\n   6891         try:\n   6892             x = g_gcd(self._gobj, r._gobj)\n\nRuntimeError: Aborted\n```\n\nThe `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.\n\nComponent: **cython**\n\nAuthor: **Ralf Stephan**\n\nBranch/Commit: **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23925_\n\n",
    "closed_at": "2017-10-15T11:45:09Z",
    "created_at": "2017-09-25T06:43:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bulk fix of signal handling in symbolics",
    "type": "issue",
    "updated_at": "2017-10-15T11:45:09Z",
    "url": "https://github.com/sagemath/sage/issues/23925",
    "user": "https://github.com/rwst"
}
```
<div id="comment:0"></div>

In Sage-8.1.beta6 this crashes:

```
sage: (x/(x^1431655765-1)).normalize()
Exception (FLINT memory_manager). Unable to allocate memory.
------------------------------------------------------------------------
/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5db8)[0x7fb72168edb8]
/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e25)[0x7fb72168ee25]
/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8aba)[0x7fb721691aba]
/lib64/libpthread.so.0(+0x10860)[0x7fb729d0a860]
/lib64/libc.so.6(gsignal+0x37)[0x7fb729299fa7]
/lib64/libc.so.6(abort+0x16a)[0x7fb72929b30a]
/usr/local/src/sage-config/local/lib/libflint.so.13(+0x4d104)[0x7fb7148a1104]
/usr/local/src/sage-config/local/lib/libflint.so.13(+0x534b8)[0x7fb7148a74b8]
/usr/local/src/sage-config/local/lib/libflint.so.13(fmpz_poly_init2+0x3d)[0x7fb7148f435d]
/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z24convertFacCF2Fmpz_poly_tP16fmpz_poly_structRK13CanonicalForm+0x3a)[0x7fb68fe03b7a]
/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z17gcd_univar_flint0RK13CanonicalFormS1_+0x37)[0x7fb68fd4f817]
/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z11subResGCD_0RK13CanonicalFormS1_+0x611)[0x7fb68fd4f5d1]
/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z8gcd_polyRK13CanonicalFormS1_+0x128)[0x7fb68fcfaaa8]
/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z3gcdRK13CanonicalFormS1_+0x3c4)[0x7fb68fcfb0d4]
/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZN5GiNaC7gcdpolyERKNS_2exES2_PS0_S3_b+0x259)[0x7fb68915f159]
/usr/local/src/sage-config/local/lib/libpynac.so.14(+0x120312)[0x7fb689176312]
/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC3mul6normalERSt3mapINS_2exES2_NS_10ex_is_lessESaISt4pairIKS2_S2_EEES9_ij+0x417)[0x7fb689177587]
/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC2ex6normalEibb+0xd6)[0x7fb689171446]
/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0xd4daf)[0x7fb688da5daf]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x84cc)[0x7fb72a028cdc]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x82cc)[0x7fb72a028adc]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb72a04f4da]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe7)[0x7fb72a050a17]
/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(Py_Main+0xc7a)[0x7fb72a06760a]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fb7292876a5]
python(_start+0x29)[0x400769]
------------------------------------------------------------------------
Unhandled SIGABRT: An abort() occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
```
while the underlying operation only aborts with `RuntimeError`:

```
gcd(x,x^1431655765-1)
Exception (FLINT memory_manager). Unable to allocate memory.
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-468b83720c84> in <module>()
      1 
----> 2 gcd(x,x**Integer(1431655765)-Integer(1))

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/arith/misc.pyc in gcd(a, b, **kwargs)
   1576     if b is not None:
   1577         try:
-> 1578             return a.gcd(b, **kwargs)
   1579         except (AttributeError, TypeError):
   1580             pass

/usr/local/src/sage-config/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gcd (build/cythonized/sage/symbolic/expression.cpp:41191)()
   6888         cdef Expression r = self.coerce_in(b)
   6889         cdef GEx x
-> 6890         sig_on()
   6891         try:
   6892             x = g_gcd(self._gobj, r._gobj)

RuntimeError: Aborted
```

The `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.

Component: **cython**

Author: **Ralf Stephan**

Branch/Commit: **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23925_





---

archive/issue_events_329359.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-25T06:43:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329359"
}
```



---

archive/issue_events_329360.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-25T06:43:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329360"
}
```



---

archive/issue_events_329361.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-25T06:43:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329361"
}
```



---

archive/issue_events_329362.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-25T06:43:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329362"
}
```



---

archive/issue_events_329363.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-25T07:14:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329363"
}
```



---

archive/issue_events_329364.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-25T07:14:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "0000b0",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329364"
}
```



---

archive/issue_comments_361075.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIn the future, please remember to **POST TRACEBACKS** such that people reading this ticket can actually understand what it is about.",
    "created_at": "2017-09-25T07:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361075",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

In the future, please remember to **POST TRACEBACKS** such that people reading this ticket can actually understand what it is about.



---

archive/issue_comments_361076.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,12 +2,84 @@\n \n ```\n sage: (x/(x^1431655765-1)).normalize()\n+sage: (x/(x^1431655765-1)).normalize()\n Exception (FLINT memory_manager). Unable to allocate memory.\n+------------------------------------------------------------------------\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5db8)[0x7fb72168edb8]\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e25)[0x7fb72168ee25]\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8aba)[0x7fb721691aba]\n+/lib64/libpthread.so.0(+0x10860)[0x7fb729d0a860]\n+/lib64/libc.so.6(gsignal+0x37)[0x7fb729299fa7]\n+/lib64/libc.so.6(abort+0x16a)[0x7fb72929b30a]\n+/usr/local/src/sage-config/local/lib/libflint.so.13(+0x4d104)[0x7fb7148a1104]\n+/usr/local/src/sage-config/local/lib/libflint.so.13(+0x534b8)[0x7fb7148a74b8]\n+/usr/local/src/sage-config/local/lib/libflint.so.13(fmpz_poly_init2+0x3d)[0x7fb7148f435d]\n+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z24convertFacCF2Fmpz_poly_tP16fmpz_poly_structRK13CanonicalForm+0x3a)[0x7fb68fe03b7a]\n+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z17gcd_univar_flint0RK13CanonicalFormS1_+0x37)[0x7fb68fd4f817]\n+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z11subResGCD_0RK13CanonicalFormS1_+0x611)[0x7fb68fd4f5d1]\n+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z8gcd_polyRK13CanonicalFormS1_+0x128)[0x7fb68fcfaaa8]\n+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z3gcdRK13CanonicalFormS1_+0x3c4)[0x7fb68fcfb0d4]\n+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZN5GiNaC7gcdpolyERKNS_2exES2_PS0_S3_b+0x259)[0x7fb68915f159]\n+/usr/local/src/sage-config/local/lib/libpynac.so.14(+0x120312)[0x7fb689176312]\n+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC3mul6normalERSt3mapINS_2exES2_NS_10ex_is_lessESaISt4pairIKS2_S2_EEES9_ij+0x417)[0x7fb689177587]\n+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC2ex6normalEibb+0xd6)[0x7fb689171446]\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0xd4daf)[0x7fb688da5daf]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x84cc)[0x7fb72a028cdc]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x82cc)[0x7fb72a028adc]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb72a04f4da]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe7)[0x7fb72a050a17]\n+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(Py_Main+0xc7a)[0x7fb72a06760a]\n+/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fb7292876a5]\n+python(_start+0x29)[0x400769]\n+------------------------------------------------------------------------\n+Unhandled SIGABRT: An abort() occurred.\n+This probably occurred because a *compiled* module has a bug\n+in it and is not properly wrapped with sig_on(), sig_off().\n+Python will now terminate.\n+------------------------------------------------------------------------\n ```\n while the underlying operation only aborts with `RuntimeError`:\n \n ```\n gcd(x,x^1431655765-1)\n+Exception (FLINT memory_manager). Unable to allocate memory.\n+---------------------------------------------------------------------------\n+RuntimeError                              Traceback (most recent call last)\n+<ipython-input-1-468b83720c84> in <module>()\n+      1 \n+----> 2 gcd(x,x**Integer(1431655765)-Integer(1))\n+\n+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/arith/misc.pyc in gcd(a, b, **kwargs)\n+   1576     if b is not None:\n+   1577         try:\n+-> 1578             return a.gcd(b, **kwargs)\n+   1579         except (AttributeError, TypeError):\n+   1580             pass\n+\n+/usr/local/src/sage-config/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gcd (build/cythonized/sage/symbolic/expression.cpp:41191)()\n+   6888         cdef Expression r = self.coerce_in(b)\n+   6889         cdef GEx x\n+-> 6890         sig_on()\n+   6891         try:\n+   6892             x = g_gcd(self._gobj, r._gobj)\n+\n+RuntimeError: Aborted\n ```\n \n The `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.\n``````\n",
    "created_at": "2017-09-25T07:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361076",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,12 +2,84 @@
 
 ```
 sage: (x/(x^1431655765-1)).normalize()
+sage: (x/(x^1431655765-1)).normalize()
 Exception (FLINT memory_manager). Unable to allocate memory.
+------------------------------------------------------------------------
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5db8)[0x7fb72168edb8]
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5e25)[0x7fb72168ee25]
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8aba)[0x7fb721691aba]
+/lib64/libpthread.so.0(+0x10860)[0x7fb729d0a860]
+/lib64/libc.so.6(gsignal+0x37)[0x7fb729299fa7]
+/lib64/libc.so.6(abort+0x16a)[0x7fb72929b30a]
+/usr/local/src/sage-config/local/lib/libflint.so.13(+0x4d104)[0x7fb7148a1104]
+/usr/local/src/sage-config/local/lib/libflint.so.13(+0x534b8)[0x7fb7148a74b8]
+/usr/local/src/sage-config/local/lib/libflint.so.13(fmpz_poly_init2+0x3d)[0x7fb7148f435d]
+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z24convertFacCF2Fmpz_poly_tP16fmpz_poly_structRK13CanonicalForm+0x3a)[0x7fb68fe03b7a]
+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z17gcd_univar_flint0RK13CanonicalFormS1_+0x37)[0x7fb68fd4f817]
+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z11subResGCD_0RK13CanonicalFormS1_+0x611)[0x7fb68fd4f5d1]
+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z8gcd_polyRK13CanonicalFormS1_+0x128)[0x7fb68fcfaaa8]
+/usr/local/src/sage-config/local/lib/libfactory-4.1.0.so(_Z3gcdRK13CanonicalFormS1_+0x3c4)[0x7fb68fcfb0d4]
+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZN5GiNaC7gcdpolyERKNS_2exES2_PS0_S3_b+0x259)[0x7fb68915f159]
+/usr/local/src/sage-config/local/lib/libpynac.so.14(+0x120312)[0x7fb689176312]
+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC3mul6normalERSt3mapINS_2exES2_NS_10ex_is_lessESaISt4pairIKS2_S2_EEES9_ij+0x417)[0x7fb689177587]
+/usr/local/src/sage-config/local/lib/libpynac.so.14(_ZNK5GiNaC2ex6normalEibb+0xd6)[0x7fb689171446]
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0xd4daf)[0x7fb688da5daf]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x84cc)[0x7fb72a028cdc]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x82cc)[0x7fb72a028adc]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7f9f)[0x7fb72a0287af]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x830)[0x7fb72a02a4e0]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fb72a02a609]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fb72a04f4da]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe7)[0x7fb72a050a17]
+/usr/local/src/sage-config/local/lib/libpython2.7.so.1.0(Py_Main+0xc7a)[0x7fb72a06760a]
+/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fb7292876a5]
+python(_start+0x29)[0x400769]
+------------------------------------------------------------------------
+Unhandled SIGABRT: An abort() occurred.
+This probably occurred because a *compiled* module has a bug
+in it and is not properly wrapped with sig_on(), sig_off().
+Python will now terminate.
+------------------------------------------------------------------------
 ```
 while the underlying operation only aborts with `RuntimeError`:
 
 ```
 gcd(x,x^1431655765-1)
+Exception (FLINT memory_manager). Unable to allocate memory.
+---------------------------------------------------------------------------
+RuntimeError                              Traceback (most recent call last)
+<ipython-input-1-468b83720c84> in <module>()
+      1 
+----> 2 gcd(x,x**Integer(1431655765)-Integer(1))
+
+/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/arith/misc.pyc in gcd(a, b, **kwargs)
+   1576     if b is not None:
+   1577         try:
+-> 1578             return a.gcd(b, **kwargs)
+   1579         except (AttributeError, TypeError):
+   1580             pass
+
+/usr/local/src/sage-config/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.gcd (build/cythonized/sage/symbolic/expression.cpp:41191)()
+   6888         cdef Expression r = self.coerce_in(b)
+   6889         cdef GEx x
+-> 6890         sig_on()
+   6891         try:
+   6892             x = g_gcd(self._gobj, r._gobj)
+
+RuntimeError: Aborted
 ```
 
 The `normalize` member function is one of many where signals from underlying layers are not caught. Let's do a sweeping fix of them in this ticket.
``````




---

archive/issue_comments_361077.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,6 @@\n In Sage-8.1.beta6 this crashes:\n \n ```\n-sage: (x/(x^1431655765-1)).normalize()\n sage: (x/(x^1431655765-1)).normalize()\n Exception (FLINT memory_manager). Unable to allocate memory.\n ------------------------------------------------------------------------\n``````\n",
    "created_at": "2017-09-25T07:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361077",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,6 @@
 In Sage-8.1.beta6 this crashes:
 
 ```
-sage: (x/(x^1431655765-1)).normalize()
 sage: (x/(x^1431655765-1)).normalize()
 Exception (FLINT memory_manager). Unable to allocate memory.
 ------------------------------------------------------------------------
``````




---

archive/issue_comments_361078.json:
```json
{
    "body": "Branch: **[u/rws/bulk_fix_of_signal_handling_in_symbolics](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bulk_fix_of_signal_handling_in_symbolics)**",
    "created_at": "2017-09-25T07:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361078",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/bulk_fix_of_signal_handling_in_symbolics](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bulk_fix_of_signal_handling_in_symbolics)**



---

archive/issue_comments_361079.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120\"><code>8238d61</code></a></td><td><code>23925: Bulk fix of signal handling in symbolics</code></td></tr></table>\n",
    "created_at": "2017-09-25T07:35:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361079",
    "user": "https://github.com/rwst"
}
```

<div id="comment:4"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120"><code>8238d61</code></a></td><td><code>23925: Bulk fix of signal handling in symbolics</code></td></tr></table>




---

archive/issue_comments_361080.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2017-09-25T07:35:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361080",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_events_329365.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-25T07:35:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329365"
}
```



---

archive/issue_comments_361081.json:
```json
{
    "body": "Commit: **[`8238d61`](https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120)**",
    "created_at": "2017-09-25T07:35:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361081",
    "user": "https://github.com/rwst"
}
```

Commit: **[`8238d61`](https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120)**



---

archive/issue_comments_361082.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDon't put Python code inside `sig_on()`/`sig_off()` blocks.\n\nWhat you are doing is essentially\n\n```\nsig_on()\ntry:\n    initialize()\n    res = c_lib_call()\n    return process(res)\nfinally:\n    sig_off\n```\nInstead, it should be\n\n```\ninitialize()\nsig_on()\nres = c_lib_call()\nsig_off()\nreturn process(res)\n```",
    "created_at": "2017-09-25T07:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361082",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Don't put Python code inside `sig_on()`/`sig_off()` blocks.

What you are doing is essentially

```
sig_on()
try:
    initialize()
    res = c_lib_call()
    return process(res)
finally:
    sig_off
```
Instead, it should be

```
initialize()
sig_on()
res = c_lib_call()
sig_off()
return process(res)
```



---

archive/issue_events_329366.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-25T07:42:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329366"
}
```



---

archive/issue_events_329367.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-25T07:42:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329367"
}
```



---

archive/issue_comments_361083.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n...or, if C++ exceptions can occur, it should be:\n\n```\ninitialize()\nsig_on()\ntry:\n    res = c_lib_call()\nfinally:\n    sig_off()\nreturn process(res)\n```",
    "created_at": "2017-09-25T07:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361083",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

...or, if C++ exceptions can occur, it should be:

```
initialize()
sig_on()
try:
    res = c_lib_call()
finally:
    sig_off()
return process(res)
```



---

archive/issue_comments_361084.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAfter thinking about it a bit more... `pynac` is partially implemented in Python, right? So maybe these should be added upstream in Pynac, not in Sage.",
    "created_at": "2017-09-25T07:47:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361084",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

After thinking about it a bit more... `pynac` is partially implemented in Python, right? So maybe these should be added upstream in Pynac, not in Sage.



---

archive/issue_comments_361085.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPynac is completely C++ but calls some Python C API functions. Is there a C function `sig_on`?",
    "created_at": "2017-09-25T07:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361085",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8" align="right">comment:8</div>

Pynac is completely C++ but calls some Python C API functions. Is there a C function `sig_on`?



---

archive/issue_comments_361086.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIn theory, `cysignals` can be interfaced via C/C++ but I don't think that this has been done already.",
    "created_at": "2017-09-25T08:09:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361086",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

In theory, `cysignals` can be interfaced via C/C++ but I don't think that this has been done already.



---

archive/issue_comments_361087.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI don't think it belongs in Pynac. Several functions are called that are used by Pynac itself. Rather, if you insist on adding a code layer, it should go in the Pynac interface, e.g. `libs/pynac/wrap.h`.",
    "created_at": "2017-09-25T08:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361087",
    "user": "https://github.com/rwst"
}
```

<div id="comment:10" align="right">comment:10</div>

I don't think it belongs in Pynac. Several functions are called that are used by Pynac itself. Rather, if you insist on adding a code layer, it should go in the Pynac interface, e.g. `libs/pynac/wrap.h`.



---

archive/issue_comments_361088.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@rwst](#comment%3A10):\n> if you insist on adding a code layer\n\nI'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.",
    "created_at": "2017-09-25T08:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361088",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@rwst](#comment%3A10):
> if you insist on adding a code layer

I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.



---

archive/issue_comments_361089.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIf it goes to correctness:\n\n\"...it is possible to declare a function as potentially raising an C++ exception and converting it into a Python exception. For example,\n\n```\ncdef extern from \"some_file.h\":\n    cdef int foo() except +\n```\nThis will translate try and the C++ error into an appropriate Python exception (currently an IndexError on std::out_of_range and a RuntimeError otherwise (preserving the what() message).\"\n\nSee https://github.com/cython/cython/wiki/WrappingCPlusPlus#advanced-c-features\n\nThe relevant methods all have their \"except +\" in `libs/pynac/pynac.pxd` so why do we need the `sig_on/off` at all?",
    "created_at": "2017-09-25T13:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361089",
    "user": "https://github.com/rwst"
}
```

<div id="comment:12" align="right">comment:12</div>

If it goes to correctness:

"...it is possible to declare a function as potentially raising an C++ exception and converting it into a Python exception. For example,

```
cdef extern from "some_file.h":
    cdef int foo() except +
```
This will translate try and the C++ error into an appropriate Python exception (currently an IndexError on std::out_of_range and a RuntimeError otherwise (preserving the what() message)."

See https://github.com/cython/cython/wiki/WrappingCPlusPlus#advanced-c-features

The relevant methods all have their "except +" in `libs/pynac/pynac.pxd` so why do we need the `sig_on/off` at all?



---

archive/issue_comments_361090.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@rwst](#comment%3A12):\n> why do we need the `sig_on/off` at all?\n\n1. To allow interrupting a long-running operation.\n\n2. For error handling from low-level C libraries like FLINT (which is what this ticket is about).\n\nNone of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.\n\nWhat is true is that `cysignals` was not written with C++ in mind. Maybe one could reimplement parts of `cysignals` to be more C++-friendly, for example by raising C++ exceptions (which are then converted to Python exceptions by Cython).",
    "created_at": "2017-09-25T13:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361090",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@rwst](#comment%3A12):
> why do we need the `sig_on/off` at all?

1. To allow interrupting a long-running operation.

2. For error handling from low-level C libraries like FLINT (which is what this ticket is about).

None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.

What is true is that `cysignals` was not written with C++ in mind. Maybe one could reimplement parts of `cysignals` to be more C++-friendly, for example by raising C++ exceptions (which are then converted to Python exceptions by Cython).



---

archive/issue_comments_361091.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment%3A13):\n> None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.\n\nIt's the same layer and doing it automatically (maybe if a similar directive to `except +` is given) prevents tickets such as this.",
    "created_at": "2017-09-25T13:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361091",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment%3A13):
> None of these reasons have anything to do with C++ exceptions, so I wonder why you brought that up.

It's the same layer and doing it automatically (maybe if a similar directive to `except +` is given) prevents tickets such as this.



---

archive/issue_comments_361092.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@rwst](#comment%3A14):\n> It's the same layer and doing **it** automatically prevents tickets such as this.\n\nDoing **what** automatically?",
    "created_at": "2017-09-25T13:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361092",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@rwst](#comment%3A14):
> It's the same layer and doing **it** automatically prevents tickets such as this.

Doing **what** automatically?



---

archive/issue_comments_361093.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMore exactly. There are two possibilities, a signal handler is set when leaving Python (like `sig_on/off`) or one is set when leaving C++ and calling FLINT. The latter would be in Singular not Pynac however. With this I tend to call it a Singular/libfactory bug.",
    "created_at": "2017-09-25T13:45:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361093",
    "user": "https://github.com/rwst"
}
```

<div id="comment:16" align="right">comment:16</div>

More exactly. There are two possibilities, a signal handler is set when leaving Python (like `sig_on/off`) or one is set when leaving C++ and calling FLINT. The latter would be in Singular not Pynac however. With this I tend to call it a Singular/libfactory bug.



---

archive/issue_comments_361094.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt should be set when leaving Python. However, Pynac is a difficult case because it mixes C++ and Python. So there is no clear Python/C++ boundary.",
    "created_at": "2017-09-25T13:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361094",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

It should be set when leaving Python. However, Pynac is a difficult case because it mixes C++ and Python. So there is no clear Python/C++ boundary.



---

archive/issue_comments_361095.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIn any case cysignals has a tested implementation. Is it possible at all to reuse it from C++?",
    "created_at": "2017-09-25T14:11:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361095",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

In any case cysignals has a tested implementation. Is it possible at all to reuse it from C++?



---

archive/issue_comments_361096.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAh I see, `src/sage/rings/padics/transcendantal.c` (sic) uses cysignals.",
    "created_at": "2017-09-25T14:38:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361096",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">comment:19</div>

Ah I see, `src/sage/rings/padics/transcendantal.c` (sic) uses cysignals.



---

archive/issue_comments_361097.json:
```json
{
    "body": "Changed branch from **[u/rws/bulk_fix_of_signal_handling_in_symbolics](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bulk_fix_of_signal_handling_in_symbolics)** to **[u/rws/23925-test](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-test)**",
    "created_at": "2017-09-26T07:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361097",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/bulk_fix_of_signal_handling_in_symbolics](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/bulk_fix_of_signal_handling_in_symbolics)** to **[u/rws/23925-test](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-test)**



---

archive/issue_comments_361098.json:
```json
{
    "body": "Changed commit from **[`8238d61`](https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120)** to **[`0d7e908`](https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26)**",
    "created_at": "2017-09-26T07:27:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361098",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`8238d61`](https://github.com/sagemath/sagetrac-mirror/commit/8238d61741a6d2f85f2c5eacf77c8b6952437120)** to **[`0d7e908`](https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26)**



---

archive/issue_events_329368.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T07:27:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329368"
}
```



---

archive/issue_events_329369.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-26T07:27:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329369"
}
```



---

archive/issue_comments_361099.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThis test branch implements calling of `sig_on/off` from the Pynac interface, just for the ticket case. While C++ runtime errors are caught, the ticket case's SIGABRT is not (while it is caught in the first uploaded branch where the `sig_on/off` is called from Python).\n\nHow to proceed?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26\"><code>0d7e908</code></a></td><td><code>test</code></td></tr></table>\n",
    "created_at": "2017-09-26T07:27:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361099",
    "user": "https://github.com/rwst"
}
```

<div id="comment:21" align="right">comment:21</div>

This test branch implements calling of `sig_on/off` from the Pynac interface, just for the ticket case. While C++ runtime errors are caught, the ticket case's SIGABRT is not (while it is caught in the first uploaded branch where the `sig_on/off` is called from Python).

How to proceed?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26"><code>0d7e908</code></a></td><td><code>test</code></td></tr></table>




---

archive/issue_comments_361100.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n\n```\nException (FLINT memory_manager). Unable to allocate memory.\n------------------------------------------------------------------------\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5d55)[0x7f7af2ecfd55]\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5da5)[0x7f7af2ecfda5]\n/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8c2a)[0x7f7af2ed2c2a]\n/lib64/libpthread.so.0(+0x10b10)[0x7f7afaebcb10]\n/lib64/libc.so.6(gsignal+0x37)[0x7f7afa4398d7]\n/lib64/libc.so.6(abort+0x13a)[0x7f7afa43acaa]\n/home/ralf/sage/local/lib/libflint.so.13(+0x59194)[0x7f7ae9ffe194]\n/home/ralf/sage/local/lib/libflint.so.13(+0x5f468)[0x7f7aea004468]\n/home/ralf/sage/local/lib/libflint.so.13(_fmpz_poly_gcd_heuristic+0x6aa)[0x7f7aea06a29a]\n```",
    "created_at": "2017-09-27T05:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361100",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>


```
Exception (FLINT memory_manager). Unable to allocate memory.
------------------------------------------------------------------------
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5d55)[0x7f7af2ecfd55]
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5da5)[0x7f7af2ecfda5]
/home/ralf/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8c2a)[0x7f7af2ed2c2a]
/lib64/libpthread.so.0(+0x10b10)[0x7f7afaebcb10]
/lib64/libc.so.6(gsignal+0x37)[0x7f7afa4398d7]
/lib64/libc.so.6(abort+0x13a)[0x7f7afa43acaa]
/home/ralf/sage/local/lib/libflint.so.13(+0x59194)[0x7f7ae9ffe194]
/home/ralf/sage/local/lib/libflint.so.13(+0x5f468)[0x7f7aea004468]
/home/ralf/sage/local/lib/libflint.so.13(_fmpz_poly_gcd_heuristic+0x6aa)[0x7f7aea06a29a]
```



---

archive/issue_comments_361101.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThe reason for your problem is that Cython supports either checking for C++ exceptions (`except +`) or Python exceptions (`except something_else`), but not both at the same time.\n\nBut as I already said: no additional layer is needed, you can just add the `sig_on`/`sig_off` in the Cython file directly.",
    "created_at": "2017-09-27T12:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361101",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

The reason for your problem is that Cython supports either checking for C++ exceptions (`except +`) or Python exceptions (`except something_else`), but not both at the same time.

But as I already said: no additional layer is needed, you can just add the `sig_on`/`sig_off` in the Cython file directly.



---

archive/issue_comments_361102.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment%3A11):\n> Replying to [@rwst](#comment%3A10):\n> > if you insist on adding a code layer\n> \n> \n> I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.\n\nThe layer that is calling C library functions is the C++ layer (either `expression.pyx` translated to C++ or Singular or Pynac, all of it happens). You just said to insert the insert `sig_on()` in the Cython file. You mean `expression.pyx`, that is, just like I did in the first branch, right?",
    "created_at": "2017-09-27T13:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361102",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment%3A11):
> Replying to [@rwst](#comment%3A10):
> > if you insist on adding a code layer
> 
> 
> I'm not. I'm saying to put `sig_on()` at the *correct* layer (which is whatever layer is calling C library functions), not to add a *new* layer.

The layer that is calling C library functions is the C++ layer (either `expression.pyx` translated to C++ or Singular or Pynac, all of it happens). You just said to insert the insert `sig_on()` in the Cython file. You mean `expression.pyx`, that is, just like I did in the first branch, right?



---

archive/issue_comments_361103.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@rwst](#comment%3A24):\n> The layer that is calling C library functions is the C++ layer\n\nSorry, when I said \"C\" I meant \"C or C++\". For `cysignals`, C or C++ is the same thing. It's just the separation Python <-> C/C++ that matters.\n\n> You mean `expression.pyx`, that is, just like I did in the first branch, right?\n\nYes, like in your first branch. However, your branch had many wrong usages like\n\n```\nsig_on()\nPython code\nPynac call\nPython code\nsig_off()\n```\nThat is certainly wrong. It should be\n\n```\nPython code\nsig_on()\nPynac call\nsig_off()\nPython code\n```",
    "created_at": "2017-09-27T13:46:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361103",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@rwst](#comment%3A24):
> The layer that is calling C library functions is the C++ layer

Sorry, when I said "C" I meant "C or C++". For `cysignals`, C or C++ is the same thing. It's just the separation Python <-> C/C++ that matters.

> You mean `expression.pyx`, that is, just like I did in the first branch, right?

Yes, like in your first branch. However, your branch had many wrong usages like

```
sig_on()
Python code
Pynac call
Python code
sig_off()
```
That is certainly wrong. It should be

```
Python code
sig_on()
Pynac call
sig_off()
Python code
```



---

archive/issue_comments_361104.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe code calling `normal()` should look like\n\n```\ncdef GEx result\nsig_on()\ntry:\n    result = self._gobj.normal(0, False, True)\nfinally:\n    sig_off()\nreturn new_Expression_from_GEx(self._parent, result)\n```\nNote that `_gobj` is a `cdef` attribute, so `self._gobj` involves no Python code. Therefore, it is safe to put inside the `sig_on()` block. On the other hand, `new_Expression_from_GEx()` is unsafe since it invokes Python code like `cls.__new__(cls)` for example.",
    "created_at": "2017-09-27T13:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361104",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

The code calling `normal()` should look like

```
cdef GEx result
sig_on()
try:
    result = self._gobj.normal(0, False, True)
finally:
    sig_off()
return new_Expression_from_GEx(self._parent, result)
```
Note that `_gobj` is a `cdef` attribute, so `self._gobj` involves no Python code. Therefore, it is safe to put inside the `sig_on()` block. On the other hand, `new_Expression_from_GEx()` is unsafe since it invokes Python code like `cls.__new__(cls)` for example.



---

archive/issue_comments_361105.json:
```json
{
    "body": "Changed branch from **[u/rws/23925-test](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-test)** to **[u/rws/23925-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-1)**",
    "created_at": "2017-09-27T15:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361105",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/23925-test](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-test)** to **[u/rws/23925-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-1)**



---

archive/issue_comments_361106.json:
```json
{
    "body": "Changed commit from **[`0d7e908`](https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26)** to **[`d367956`](https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e)**",
    "created_at": "2017-09-27T15:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361106",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`0d7e908`](https://github.com/sagemath/sagetrac-mirror/commit/0d7e908eec43c7cdb7462b39c2241fe73a734b26)** to **[`d367956`](https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e)**



---

archive/issue_comments_361107.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e\"><code>d367956</code></a></td><td><code>23925: Bulk fix of signal handling in symbolics</code></td></tr></table>\n",
    "created_at": "2017-09-27T15:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361107",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e"><code>d367956</code></a></td><td><code>23925: Bulk fix of signal handling in symbolics</code></td></tr></table>




---

archive/issue_events_329370.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-27T15:07:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329370"
}
```



---

archive/issue_events_329371.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-27T15:07:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329371"
}
```



---

archive/issue_comments_361108.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThe `evalf()` code is more complicated. Maybe don't add the `sig_on()` there for now.\n\nAnd it would be more efficient to replace\n\n```\n    def _rel_equal2(self, right):\n```\nby\n\n```\n    cdef bint _rel_equal2(Expression self, Expression other) except -1:\n```\nThis way, you don't need the `cdef Expression l, r` variables.",
    "created_at": "2017-09-27T17:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361108",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

The `evalf()` code is more complicated. Maybe don't add the `sig_on()` there for now.

And it would be more efficient to replace

```
    def _rel_equal2(self, right):
```
by

```
    cdef bint _rel_equal2(Expression self, Expression other) except -1:
```
This way, you don't need the `cdef Expression l, r` variables.



---

archive/issue_events_329372.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-27T17:32:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329372"
}
```



---

archive/issue_events_329373.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-27T17:32:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329373"
}
```



---

archive/issue_comments_361109.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533\"><code>732c03f</code></a></td><td><code>23925: address reviewer's comments</code></td></tr></table>\n",
    "created_at": "2017-09-28T05:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361109",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533"><code>732c03f</code></a></td><td><code>23925: address reviewer's comments</code></td></tr></table>




---

archive/issue_comments_361110.json:
```json
{
    "body": "Changed commit from **[`d367956`](https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e)** to **[`732c03f`](https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533)**",
    "created_at": "2017-09-28T05:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361110",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d367956`](https://github.com/sagemath/sagetrac-mirror/commit/d3679562368021af54af8e3cff8673b3b0c0012e)** to **[`732c03f`](https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533)**



---

archive/issue_comments_361111.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHow come I get `SCORE src/sage/symbolic/expression.pyx: 100.0% (232 of 232)` from `sage -coverage` but the patchbot plugin fails? I'm now filling this file with useless characters just for the sake...",
    "created_at": "2017-09-28T06:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361111",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">comment:32</div>

How come I get `SCORE src/sage/symbolic/expression.pyx: 100.0% (232 of 232)` from `sage -coverage` but the patchbot plugin fails? I'm now filling this file with useless characters just for the sake...



---

archive/issue_comments_361112.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15\"><code>3fba90f</code></a></td><td><code>23925: please the coverage plugin</code></td></tr></table>\n",
    "created_at": "2017-09-28T06:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361112",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15"><code>3fba90f</code></a></td><td><code>23925: please the coverage plugin</code></td></tr></table>




---

archive/issue_comments_361113.json:
```json
{
    "body": "Changed commit from **[`732c03f`](https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533)** to **[`3fba90f`](https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15)**",
    "created_at": "2017-09-28T06:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361113",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`732c03f`](https://github.com/sagemath/sagetrac-mirror/commit/732c03f66bbe3cffea7600a585f2bb7cab1ec533)** to **[`3fba90f`](https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15)**



---

archive/issue_events_329374.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-28T06:05:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329374"
}
```



---

archive/issue_events_329375.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-28T06:05:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329375"
}
```



---

archive/issue_comments_361114.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@rwst](#comment%3A32):\n> I'm now filling this file with useless characters just for the sake...\n\nPlease don't! Use your own judgement. You are smarter than the coverage plugin.",
    "created_at": "2017-09-28T15:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361114",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@rwst](#comment%3A32):
> I'm now filling this file with useless characters just for the sake...

Please don't! Use your own judgement. You are smarter than the coverage plugin.



---

archive/issue_comments_361115.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI'll leave it as is now; declaring something a helper function is not so bad. Patchbot is go. Please review.",
    "created_at": "2017-09-29T05:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361115",
    "user": "https://github.com/rwst"
}
```

<div id="comment:36" align="right">comment:36</div>

I'll leave it as is now; declaring something a helper function is not so bad. Patchbot is go. Please review.



---

archive/issue_events_329376.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-04T13:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329376"
}
```



---

archive/issue_events_329377.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-04T13:11:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329377"
}
```



---

archive/issue_comments_361116.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nMerge conflict",
    "created_at": "2017-10-04T13:11:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361116",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Merge conflict



---

archive/issue_comments_361117.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0\"><code>b4a620d</code></a></td><td><code>Merge branch 'develop' into t/23925/23925-1</code></td></tr></table>\n",
    "created_at": "2017-10-04T13:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361117",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0"><code>b4a620d</code></a></td><td><code>Merge branch 'develop' into t/23925/23925-1</code></td></tr></table>




---

archive/issue_comments_361118.json:
```json
{
    "body": "Changed commit from **[`3fba90f`](https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15)** to **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**",
    "created_at": "2017-10-04T13:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361118",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3fba90f`](https://github.com/sagemath/sagetrac-mirror/commit/3fba90f76e57a7bda6b45e3305283f70df135c15)** to **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**



---

archive/issue_events_329378.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-04T13:36:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329378"
}
```



---

archive/issue_events_329379.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-04T13:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329379"
}
```



---

archive/issue_comments_361119.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-10-04T13:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361119",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_361120.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nGood for me if this passes patchbot testing.",
    "created_at": "2017-10-04T13:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361120",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Good for me if this passes patchbot testing.



---

archive/issue_comments_361121.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nPasses patchbots, thanks.",
    "created_at": "2017-10-05T05:31:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361121",
    "user": "https://github.com/rwst"
}
```

<div id="comment:41" align="right">comment:41</div>

Passes patchbots, thanks.



---

archive/issue_events_329380.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-05T05:31:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329380"
}
```



---

archive/issue_events_329381.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-05T05:31:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329381"
}
```



---

archive/issue_comments_361122.json:
```json
{
    "body": "Changed branch from **[u/rws/23925-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-1)** to **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**",
    "created_at": "2017-10-15T11:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23925#issuecomment-361122",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/23925-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23925-1)** to **[`b4a620d`](https://github.com/sagemath/sagetrac-mirror/commit/b4a620d01d122b254b119dd4fa0b9573c598f8f0)**



---

archive/issue_events_329382.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T11:45:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329382"
}
```



---

archive/issue_events_329383.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bda5b4d10b984c1e34f9b51cb181d1fbee1cf1c1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-15T11:45:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23925",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23925#event-329383"
}
```
