# Issue 23278: Force picklejar permissions test to pass on Cygwin

archive/issues_023041.json:
```json
{
    "body": "There's a test in `sage.structure.sage_object` like:\n\n```\n        sage: os.chmod(dir, 0o000)\n        sage: try:\n        ....:     uid = os.getuid()\n        ....: except AttributeError:\n        ....:     uid = -1\n        sage: if uid==0:\n        ....:     raise OSError('You must not run the doctests as root, geez!')\n        ....: else:\n        ....:     sage.structure.sage_object.picklejar(1, dir + '/noaccess')\n        Traceback (most recent call last):\n        ...\n        OSError: ...\n```\n\nThis test normally works for me on my personal system, even under Cygwin.  However, I'm setting up the Cygwin patchbot, and found that this test always fails.\n\nAlthough this can be worked around, this test can never be made truly reliable on Cygwin.  This is because Windows file permissions (ACLs) are much more complicated than traditional Unix permissions.  Cygwin (depending on how it's configured) can try to emulate Unix permissions on top of Windows ACLs, but there are holes in the system.  For example it's *possible* to set `0o000` on a directory, but still have it be writable by the current user, especially if that user is an Admin.  \n\nIn some sense this scenario is a misconfiguration that can be avoided.  But it's a factor external to Sage that's pretty hard to control, so this test should just be avoided on Cygwin.\n\nKeywords: windows cygwin tests\n\nBranch/Commit: 0623779045f4de82f32fc84ad3e7c4a68f7d0f6e\n\nReviewer: Travis Scrimshaw\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23278\n\n",
    "closed_at": "2017-06-22T07:23:24Z",
    "created_at": "2017-06-19T13:53:44Z",
    "labels": [
        "component: porting: cygwin",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Force picklejar permissions test to pass on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23278",
    "user": "https://github.com/embray"
}
```
There's a test in `sage.structure.sage_object` like:

```
        sage: os.chmod(dir, 0o000)
        sage: try:
        ....:     uid = os.getuid()
        ....: except AttributeError:
        ....:     uid = -1
        sage: if uid==0:
        ....:     raise OSError('You must not run the doctests as root, geez!')
        ....: else:
        ....:     sage.structure.sage_object.picklejar(1, dir + '/noaccess')
        Traceback (most recent call last):
        ...
        OSError: ...
```

This test normally works for me on my personal system, even under Cygwin.  However, I'm setting up the Cygwin patchbot, and found that this test always fails.

Although this can be worked around, this test can never be made truly reliable on Cygwin.  This is because Windows file permissions (ACLs) are much more complicated than traditional Unix permissions.  Cygwin (depending on how it's configured) can try to emulate Unix permissions on top of Windows ACLs, but there are holes in the system.  For example it's *possible* to set `0o000` on a directory, but still have it be writable by the current user, especially if that user is an Admin.  

In some sense this scenario is a misconfiguration that can be avoided.  But it's a factor external to Sage that's pretty hard to control, so this test should just be avoided on Cygwin.

Keywords: windows cygwin tests

Branch/Commit: 0623779045f4de82f32fc84ad3e7c4a68f7d0f6e

Reviewer: Travis Scrimshaw

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23278





---

archive/issue_comments_343076.json:
```json
{
    "body": "Changing keywords from \"\" to \"windows cygwin tests\".",
    "created_at": "2017-06-19T14:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343076",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "windows cygwin tests".



---

archive/issue_comments_343077.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-19T14:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343077",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343078.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-06-19T14:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343078",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_343079.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-20T01:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343079",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343080.json:
```json
{
    "body": "<a id='comment:2'></a>LGTM.",
    "created_at": "2017-06-20T01:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343080",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>LGTM.



---

archive/issue_comments_343081.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-20T07:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343081",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_343082.json:
```json
{
    "body": "<a id='comment:3'></a>Except for the in retrospect obvious syntax error.",
    "created_at": "2017-06-20T07:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343082",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Except for the in retrospect obvious syntax error.



---

archive/issue_comments_343083.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-20T07:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343084.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-20T07:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343084",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_343085.json:
```json
{
    "body": "<a id='comment:6'></a>Right... <.< >.>",
    "created_at": "2017-06-20T08:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343085",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Right... <.< >.>



---

archive/issue_comments_343086.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-20T08:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343086",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_059987.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-22T07:23:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23278#event-59987"
}
```



---

archive/issue_comments_343087.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-22T07:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23278#issuecomment-343087",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
