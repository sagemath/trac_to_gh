# Issue 23610: add --import option to sage -t

archive/issues_023373.json:
```json
{
    "body": "It would be nice to be able to use the doctesting framework of sage in packages that depend on sage.\nThis is already possible right now, but requires importing all the functions in the package every time which is quite burdensome.  \nAdding a `--import=package` option to `sage -t`  that does the equivalent of \n\n```\nfrom package import *\n```\nin the doctesting namespace would make life a lot easier.\n\nCC:  @mmasdeu\n\nReviewer: Vincent Delecroix, Jeroen Demeyer, Maarten Derickx\n\nBranch: u/mderickx/23610\n\nCommit: 0744840a4822b1ca1f54e203ce01a5ea2bc83861\n\nResolution: wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/23610\n\n",
    "closed_at": "2017-09-19T11:18:23Z",
    "created_at": "2017-08-11T13:11:27Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "add --import option to sage -t",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23610",
    "user": "https://github.com/koffie"
}
```
It would be nice to be able to use the doctesting framework of sage in packages that depend on sage.
This is already possible right now, but requires importing all the functions in the package every time which is quite burdensome.  
Adding a `--import=package` option to `sage -t`  that does the equivalent of 

```
from package import *
```
in the doctesting namespace would make life a lot easier.

CC:  @mmasdeu

Reviewer: Vincent Delecroix, Jeroen Demeyer, Maarten Derickx

Branch: u/mderickx/23610

Commit: 0744840a4822b1ca1f54e203ce01a5ea2bc83861

Resolution: wontfix

Issue created by migration from https://trac.sagemath.org/ticket/23610





---

archive/issue_comments_444646.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-11T13:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444646",
    "user": "https://github.com/koffie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_444647.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mderickx/23610\"",
    "created_at": "2017-08-11T13:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444647",
    "user": "https://github.com/koffie"
}
```

Changing branch from "" to "u/mderickx/23610"



---

archive/issue_comments_444648.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[e66c7bd](https://git.sagemath.org/sage.git/commit?id=e66c7bdff9d3d74a6bb777808be5b5620c48aee8)|`added --import option to sage -t`|\n|[0744840](https://git.sagemath.org/sage.git/commit?id=0744840a4822b1ca1f54e203ce01a5ea2bc83861)|`Merge branch 'develop' into test_external_package`|",
    "created_at": "2017-08-11T13:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444648",
    "user": "https://github.com/koffie"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[e66c7bd](https://git.sagemath.org/sage.git/commit?id=e66c7bdff9d3d74a6bb777808be5b5620c48aee8)|`added --import option to sage -t`|
|[0744840](https://git.sagemath.org/sage.git/commit?id=0744840a4822b1ca1f54e203ce01a5ea2bc83861)|`Merge branch 'develop' into test_external_package`|



---

archive/issue_comments_444649.json:
```json
{
    "body": "Changing commit from \"\" to \"0744840a4822b1ca1f54e203ce01a5ea2bc83861\"",
    "created_at": "2017-08-11T13:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444649",
    "user": "https://github.com/koffie"
}
```

Changing commit from "" to "0744840a4822b1ca1f54e203ce01a5ea2bc83861"



---

archive/issue_comments_444650.json:
```json
{
    "body": "Changing author from \"\" to \"Maarten Derickx\"",
    "created_at": "2017-08-11T13:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444650",
    "user": "https://github.com/koffie"
}
```

Changing author from "" to "Maarten Derickx"



---

archive/issue_comments_444651.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Roe\"",
    "created_at": "2017-08-11T16:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444651",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "" to "David Roe"



---

archive/issue_comments_444652.json:
```json
{
    "body": "<a id='comment:4'></a>\nGreat!  This is definitely a feature that people have requested over the years.\n\nThe code mostly looks good.  Why do you need to add quotes around numbers in a few of the tests?\n\nPositive review once tests pass.",
    "created_at": "2017-08-11T16:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444652",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>
Great!  This is definitely a feature that people have requested over the years.

The code mostly looks good.  Why do you need to add quotes around numbers in a few of the tests?

Positive review once tests pass.



---

archive/issue_comments_444653.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe quotes are not around numbers perse. It is there for the case that somewhere in the future someone adds an entry to `value_opt` that also accepts lists.  I had to do this first to make `--import` work since it accepts lists. But then later I realised that I had to special case` --import` since `options.import` is an invalid syntax.",
    "created_at": "2017-08-11T17:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444653",
    "user": "https://github.com/koffie"
}
```

<a id='comment:5'></a>
The quotes are not around numbers perse. It is there for the case that somewhere in the future someone adds an entry to `value_opt` that also accepts lists.  I had to do this first to make `--import` work since it accepts lists. But then later I realised that I had to special case` --import` since `options.import` is an invalid syntax.



---

archive/issue_comments_444654.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think the tests of the buildbots are not going to pass, since the both raise an error. Do you have an idea where these `SkipTicket(\"unsafe\")` errors in the [patchbot](https://patchbot.sagemath.org/log/Pending/23610/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-08-11%2013:41:26) is coming from? Is it because I am modifying the doctesting framework?\nAlso I think the patchbot needs some patching since it shows the status still as pending, even though it already raised an error!",
    "created_at": "2017-08-11T17:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444654",
    "user": "https://github.com/koffie"
}
```

<a id='comment:6'></a>
I think the tests of the buildbots are not going to pass, since the both raise an error. Do you have an idea where these `SkipTicket("unsafe")` errors in the [patchbot](https://patchbot.sagemath.org/log/Pending/23610/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-08-11%2013:41:26) is coming from? Is it because I am modifying the doctesting framework?
Also I think the patchbot needs some patching since it shows the status still as pending, even though it already raised an error!



---

archive/issue_comments_444655.json:
```json
{
    "body": "<a id='comment:7'></a>\nps. thanks for the quick review!",
    "created_at": "2017-08-11T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444655",
    "user": "https://github.com/koffie"
}
```

<a id='comment:7'></a>
ps. thanks for the quick review!



---

archive/issue_comments_444656.json:
```json
{
    "body": "Replying to [ticket:23610 mderickx]:\n> This is already possible right now, but requires importing all the functions in the package every time which is quite burdensome.\n\n\nOn the other hand, having *complete working examples* in the documentation is really useful. Compared to some other packages, this is one big plus for Sage: I can literally copy/paste the examples and be guaranteed that they work. In other words, at least for documentation, I'm not convinced that this new feature is a good idea.",
    "created_at": "2017-08-11T21:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444656",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23610 mderickx]:
> This is already possible right now, but requires importing all the functions in the package every time which is quite burdensome.


On the other hand, having *complete working examples* in the documentation is really useful. Compared to some other packages, this is one big plus for Sage: I can literally copy/paste the examples and be guaranteed that they work. In other words, at least for documentation, I'm not convinced that this new feature is a good idea.



---

archive/issue_comments_444657.json:
```json
{
    "body": "<a id='comment:9'></a>\nHi Jeroen,\n\nI totally agree with you that the copy pasting is really usefull. And this ticket should not change any of this for sage itself since the way we say that our users should doctest sage is still without the `--import` option. And I also did not implement this for doctesting the sage library. I implemented this for downstream packages. And right now a downstream package should start every doctest with `from downstream package import *`. The downstream package would even have to do this if it implemented something that made sure that it's functions would get imported into the global sage namespace. For example of you would add `from downstream_package import *` to init.sage this would add all your functions to the global namespace in sage but not to the doctesting namespace. I would say that it is up to the downstream package to make sure that all their functions are automatically available in the global namespace if they start sage (or if they start their own python interpreter which automatically imports all their functions). This extra option is just to make doctesting easier if the downstream package made all their functions automatically available. Maybe an even better thing to do would be to make the sage enhancements to the python doctesting framework available as a standalone python package where the location of the global namespace of the to be tested library is a parameter instead of being hardcoded to be `sage.all_cmdline`. But that is significantly more work so I chose this way of making the sage doctesting framework to be as useful for downstream packages as for sage itself.",
    "created_at": "2017-08-12T02:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444657",
    "user": "https://github.com/koffie"
}
```

<a id='comment:9'></a>
Hi Jeroen,

I totally agree with you that the copy pasting is really usefull. And this ticket should not change any of this for sage itself since the way we say that our users should doctest sage is still without the `--import` option. And I also did not implement this for doctesting the sage library. I implemented this for downstream packages. And right now a downstream package should start every doctest with `from downstream package import *`. The downstream package would even have to do this if it implemented something that made sure that it's functions would get imported into the global sage namespace. For example of you would add `from downstream_package import *` to init.sage this would add all your functions to the global namespace in sage but not to the doctesting namespace. I would say that it is up to the downstream package to make sure that all their functions are automatically available in the global namespace if they start sage (or if they start their own python interpreter which automatically imports all their functions). This extra option is just to make doctesting easier if the downstream package made all their functions automatically available. Maybe an even better thing to do would be to make the sage enhancements to the python doctesting framework available as a standalone python package where the location of the global namespace of the to be tested library is a parameter instead of being hardcoded to be `sage.all_cmdline`. But that is significantly more work so I chose this way of making the sage doctesting framework to be as useful for downstream packages as for sage itself.



---

archive/issue_comments_444658.json:
```json
{
    "body": "<a id='comment:10'></a>\nI agree with Jeroen, most Python packages do explicitely write the imports in their doctests (which is useful for the users). The first example in\n\n    http://docs.sympy.org/0.7.6/modules/mpmath/calculus/sums_limits.html\n\nstarts with `from sympy.mpmath import *`.\n\nReplying to [mderickx](#comment%3A9):\n> And right now a downstream package should start every doctest with from downstream package import *.\n\n\nwhich is good!\n\n> The downstream package would even have to do this if it implemented something that made sure that it's functions would get imported into the global sage namespace. For example of you would add `from downstream_package import *` to init.sage this would add all your functions to the global namespace in sage but not to the doctesting namespace. I would say that it is up to the downstream package to make sure that all their functions are automatically available in the global namespace if they start sage (or if they start their own python interpreter which automatically imports all their functions).\n\n\nIMHO, it is a bad practice to have the functions in the namespace implictely. And you can definitely not assume that this would be done by all users of your pakcage.",
    "created_at": "2017-08-12T08:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444658",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
I agree with Jeroen, most Python packages do explicitely write the imports in their doctests (which is useful for the users). The first example in

    http://docs.sympy.org/0.7.6/modules/mpmath/calculus/sums_limits.html

starts with `from sympy.mpmath import *`.

Replying to [mderickx](#comment%3A9):
> And right now a downstream package should start every doctest with from downstream package import *.


which is good!

> The downstream package would even have to do this if it implemented something that made sure that it's functions would get imported into the global sage namespace. For example of you would add `from downstream_package import *` to init.sage this would add all your functions to the global namespace in sage but not to the doctesting namespace. I would say that it is up to the downstream package to make sure that all their functions are automatically available in the global namespace if they start sage (or if they start their own python interpreter which automatically imports all their functions).


IMHO, it is a bad practice to have the functions in the namespace implictely. And you can definitely not assume that this would be done by all users of your pakcage.



---

archive/issue_comments_444659.json:
```json
{
    "body": "Changing reviewer from \"David Roe\" to \"Vincent Delecroix, Jeroen Demeyer, Maarten Derickx\"",
    "created_at": "2017-09-19T09:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444659",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "David Roe" to "Vincent Delecroix, Jeroen Demeyer, Maarten Derickx"



---

archive/issue_comments_444660.json:
```json
{
    "body": "<a id='comment:11'></a>\nProposal: close as wontfix.",
    "created_at": "2017-09-19T09:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444660",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Proposal: close as wontfix.



---

archive/issue_events_060460.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-19T09:40:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23610#event-60460"
}
```



---

archive/issue_comments_444661.json:
```json
{
    "body": "Changing author from \"Maarten Derickx\" to \"\"",
    "created_at": "2017-09-19T09:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444661",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Maarten Derickx" to ""



---

archive/issue_comments_444662.json:
```json
{
    "body": "<a id='comment:12'></a>\ngood for me. I would like to here Maarten comments about it.",
    "created_at": "2017-09-19T09:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444662",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>
good for me. I would like to here Maarten comments about it.



---

archive/issue_events_060461.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-09-19T11:18:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23610#event-60461"
}
```



---

archive/issue_comments_444663.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-09-19T11:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444663",
    "user": "https://github.com/koffie"
}
```

Resolution: wontfix



---

archive/issue_comments_444664.json:
```json
{
    "body": "<a id='comment:13'></a>\nI have been thinking about a little bit more recently, and my main argument was that doing: \n\n```\nfrom blah import *\n```\nfelt a bit rediculus and since sage was not doing it, I would not want to do it as well in my package. But I now better understand the differences between sage and a pip installable python package. Sage wants to be significantly more then just being a python library, it also wants to present its own user interface (either via jupyter notebook or via the commandline interface) and this is why things are different for sage and a python package. So I agree that this can be closed.\n\nThere are two bigger long term things related to this discussion which I think would be good:\n\n1) seperate our doctesting module and make it into a python package. It seems to me that the problems that all our doctesting code is trying to solve is not really sage specific and other people might want to use it as well. Therefor it might be better of as a standalone package.\n\n2) make sage also import less into the global namespace (and have more from .. import .. in the doctests) would also help wit the startup time of sage and remove the need of a lot of lazy importing. I feel less strong about this point then about point 1).",
    "created_at": "2017-09-19T11:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23610",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23610#issuecomment-444664",
    "user": "https://github.com/koffie"
}
```

<a id='comment:13'></a>
I have been thinking about a little bit more recently, and my main argument was that doing: 

```
from blah import *
```
felt a bit rediculus and since sage was not doing it, I would not want to do it as well in my package. But I now better understand the differences between sage and a pip installable python package. Sage wants to be significantly more then just being a python library, it also wants to present its own user interface (either via jupyter notebook or via the commandline interface) and this is why things are different for sage and a python package. So I agree that this can be closed.

There are two bigger long term things related to this discussion which I think would be good:

1) seperate our doctesting module and make it into a python package. It seems to me that the problems that all our doctesting code is trying to solve is not really sage specific and other people might want to use it as well. Therefor it might be better of as a standalone package.

2) make sage also import less into the global namespace (and have more from .. import .. in the doctests) would also help wit the startup time of sage and remove the need of a lot of lazy importing. I feel less strong about this point then about point 1).
