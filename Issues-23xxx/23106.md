# Issue 23106: Python scripts in src/bin are not ready for Sage + Python 3

archive/issues_022869.json:
```json
{
    "body": "Many of the scripts in `src/bin` start with `#!/usr/bin/env python` (which is Python 2) and then try to import from the Sage library. This will not work if Sage has been installed using `SAGE_PYTHON3=yes`.\n\nThese scripts need modification, and perhaps there are others:\n\n- sage-cython: `from sage.env import SAGE_SRC` -- could be modified to avoid this import, for example using `os.getenv('SAGE_SRC')`\n\n- sage-eval\n\n- sage-fixdoctests\n\n- sage-ipython: particularly important, since it is used to run Sage.\n\n- sage-list-packages\n\n- sage-notebook\n\n- sage-preparse\n\n- sage-rst2sws\n\n- sage-rst2txt\n\n- sage-run-cython\n\n- sage-runtests\n\n- sage-startuptime.py\n\n- sage-sws2rst\n\n\n**CC:**  @jdemeyer @embray\n\n**Branch/Commit:** [847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)\n\n**Reviewer:** Erik Bray\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23106\n\n",
    "closed_at": "2018-01-18T18:09:28Z",
    "created_at": "2017-05-30T21:01:07Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Python scripts in src/bin are not ready for Sage + Python 3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23106",
    "user": "https://github.com/jhpalmieri"
}
```
Many of the scripts in `src/bin` start with `#!/usr/bin/env python` (which is Python 2) and then try to import from the Sage library. This will not work if Sage has been installed using `SAGE_PYTHON3=yes`.

These scripts need modification, and perhaps there are others:

- sage-cython: `from sage.env import SAGE_SRC` -- could be modified to avoid this import, for example using `os.getenv('SAGE_SRC')`

- sage-eval

- sage-fixdoctests

- sage-ipython: particularly important, since it is used to run Sage.

- sage-list-packages

- sage-notebook

- sage-preparse

- sage-rst2sws

- sage-rst2txt

- sage-run-cython

- sage-runtests

- sage-startuptime.py

- sage-sws2rst


**CC:**  @jdemeyer @embray

**Branch/Commit:** [847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)

**Reviewer:** Erik Bray

**Author:** Frédéric Chapoton

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/23106





---

archive/issue_comments_435680.json:
```json
{
    "body": "<a id='comment:1'></a>\nIndeed,\n\n```\ngit grep -c \"from sage\"\nsage-cython:1\nsage-env-config.in:1\nsage-eval:3\nsage-fixdoctests:2\nsage-ipython:1\nsage-list-packages:1\nsage-notebook:5\nsage-preparse:3\nsage-rst2sws:3\nsage-rst2txt:1\nsage-run-cython:2\nsage-runtests:1\nsage-startuptime.py:1\nsage-sws2rst:1\n```\nsome of these are in fact `from sagenb` imports",
    "created_at": "2017-05-31T12:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435680",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
Indeed,

```
git grep -c "from sage"
sage-cython:1
sage-env-config.in:1
sage-eval:3
sage-fixdoctests:2
sage-ipython:1
sage-list-packages:1
sage-notebook:5
sage-preparse:3
sage-rst2sws:3
sage-rst2txt:1
sage-run-cython:2
sage-runtests:1
sage-startuptime.py:1
sage-sws2rst:1
```
some of these are in fact `from sagenb` imports



---

archive/issue_comments_435681.json:
```json
{
    "body": "<a id='comment:2'></a>\n- sage-notebook, sage-rst2sws, sage-rst2txt, sage-sws2rst: I would say that we don't touch these files. They all use SageNB, which is not (yet?) compatible with Python 3. SageNB is also slowly being phased out, which makes these a lower priority anyway.\n\n- sage-env-config.in is a false positive: it is a shell script and does no importing of Python modules.\n\n- sage-cython is easy to fix:\n\n```diff\ndiff --git a/src/bin/sage-cython b/src/bin/sage-cython\nindex 77ba303b39..ffff293ca2 100755\n--- a/src/bin/sage-cython\n+++ b/src/bin/sage-cython\n@@ -3,7 +3,9 @@\n import os, sys\n args = sys.argv[1:]\n \n-from sage.env import SAGE_SRC\n+if \"SAGE_SRC\" not in os.environ:\n+    raise RuntimeError(\"The environment variable SAGE_SRC must be set.\")\n+SAGE_SRC = os.environ[\"SAGE_SRC\"]\n \n # args can have length 0, in case we're printing a usage message (see trac 12207)\n pyx_file = os.path.abspath(args[-1]) if len(args) else None\n```\n\nThe others may depend on how we approach the Sage + Python 3 runtime question. If we follow the model at #23119, we can create scripts `sage3-eval`, `sage3-preparse`, etc., and call those from the main `sage` script. (The model that I propose at #23119 is that there is a top-level script called \"sage\", as now, plus a symlink to it called \"sage3\". They essentially call `src/bin/$0`, which translates to `src/bin/sage` or `src/bin/sage3`, one of which is a symlink of the other. Then that script can call `$0-eval`, `$0-preparse`, etc.)",
    "created_at": "2017-05-31T22:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435681",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
- sage-notebook, sage-rst2sws, sage-rst2txt, sage-sws2rst: I would say that we don't touch these files. They all use SageNB, which is not (yet?) compatible with Python 3. SageNB is also slowly being phased out, which makes these a lower priority anyway.

- sage-env-config.in is a false positive: it is a shell script and does no importing of Python modules.

- sage-cython is easy to fix:

```diff
diff --git a/src/bin/sage-cython b/src/bin/sage-cython
index 77ba303b39..ffff293ca2 100755
--- a/src/bin/sage-cython
+++ b/src/bin/sage-cython
@@ -3,7 +3,9 @@
 import os, sys
 args = sys.argv[1:]
 
-from sage.env import SAGE_SRC
+if "SAGE_SRC" not in os.environ:
+    raise RuntimeError("The environment variable SAGE_SRC must be set.")
+SAGE_SRC = os.environ["SAGE_SRC"]
 
 # args can have length 0, in case we're printing a usage message (see trac 12207)
 pyx_file = os.path.abspath(args[-1]) if len(args) else None
```

The others may depend on how we approach the Sage + Python 3 runtime question. If we follow the model at #23119, we can create scripts `sage3-eval`, `sage3-preparse`, etc., and call those from the main `sage` script. (The model that I propose at #23119 is that there is a top-level script called "sage", as now, plus a symlink to it called "sage3". They essentially call `src/bin/$0`, which translates to `src/bin/sage` or `src/bin/sage3`, one of which is a symlink of the other. Then that script can call `$0-eval`, `$0-preparse`, etc.)



---

archive/issue_comments_435682.json:
```json
{
    "body": "<a id='comment:3'></a>\nany progress here ?",
    "created_at": "2017-08-18T07:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435682",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
any progress here ?



---

archive/issue_events_067962.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T07:44:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23106#event-67962"
}
```



---

archive/issue_comments_435683.json:
```json
{
    "body": "<a id='comment:4'></a>\nI made #23653 for sage-cython",
    "created_at": "2017-08-19T16:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435683",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
I made #23653 for sage-cython



---

archive/issue_comments_435684.json:
```json
{
    "body": "<a id='comment:6'></a>\nMost of these just need to be fixed to use `#!/usr/bin/env sage-python23` no?",
    "created_at": "2017-08-21T13:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435684",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Most of these just need to be fixed to use `#!/usr/bin/env sage-python23` no?



---

archive/issue_comments_435685.json:
```json
{
    "body": "**Commit:** [5eb29bf3f711fe6593b89a04e0efc4dab56fd49f](https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f)",
    "created_at": "2017-08-21T14:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435685",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [5eb29bf3f711fe6593b89a04e0efc4dab56fd49f](https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f)



---

archive/issue_comments_435686.json:
```json
{
    "body": "**Branch:** [public/23106](https://github.com/sagemath/sagetrac-mirror/tree/public/23106)",
    "created_at": "2017-08-21T14:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435686",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [public/23106](https://github.com/sagemath/sagetrac-mirror/tree/public/23106)



---

archive/issue_comments_435687.json:
```json
{
    "body": "<a id='comment:7'></a>\nI had the same idea, but was rather not sure of its validity. Here is a branch doing that.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f\">5eb29bf</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>\n",
    "created_at": "2017-08-21T14:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435687",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
I had the same idea, but was rather not sure of its validity. Here is a branch doing that.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f">5eb29bf</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>




---

archive/issue_comments_435688.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2017-08-21T19:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435688",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_435689.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis seems to work smoothly. What do you think ?",
    "created_at": "2017-08-21T19:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435689",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
This seems to work smoothly. What do you think ?



---

archive/issue_comments_435690.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-08-21T19:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435690",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_435691.json:
```json
{
    "body": "<a id='comment:9'></a>\nShould we do the same for the remaining 4\n\n```\nsage-notebook\nsage-rst2sws\nsage-rst2txt\nsage-sws2rst\n```\n?",
    "created_at": "2017-08-22T08:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435691",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
Should we do the same for the remaining 4

```
sage-notebook
sage-rst2sws
sage-rst2txt
sage-sws2rst
```
?



---

archive/issue_comments_435692.json:
```json
{
    "body": "<a id='comment:10'></a>\nnaive question: why is `python` pointing to `python2` if Sage has been built with `SAGE_PYTHON3=yes`!?",
    "created_at": "2017-08-22T11:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435692",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
naive question: why is `python` pointing to `python2` if Sage has been built with `SAGE_PYTHON3=yes`!?



---

archive/issue_comments_435693.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think Volker once said that one should rather always let python point to python2.\n\nSee ticket:22582#comment:31",
    "created_at": "2017-08-22T12:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435693",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
I think Volker once said that one should rather always let python point to python2.

See ticket:22582#comment:31



---

archive/issue_comments_435694.json:
```json
{
    "body": "<a id='comment:12'></a>\nI view `sage-python23` as a build-time tool. Actually, I view the setting of `SAGE_PYTHON3` as something which only affects the Sage build, not necessarily how things are run. The Sage community has not made any decisions about how to actually run Sage using Python 3. As a result, I am somewhat wary of just using `sage-python23` everywhere. I tried to explain this in [comment:2](#comment%3A2).",
    "created_at": "2017-08-22T15:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435694",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
I view `sage-python23` as a build-time tool. Actually, I view the setting of `SAGE_PYTHON3` as something which only affects the Sage build, not necessarily how things are run. The Sage community has not made any decisions about how to actually run Sage using Python 3. As a result, I am somewhat wary of just using `sage-python23` everywhere. I tried to explain this in [comment:2](#comment%3A2).



---

archive/issue_comments_435695.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [chapoton](#comment%3A11):\n> I think Volker once said that one should rather always let python point to python2.\n> \n> See ticket:22582#comment:31\n\n\nI don't think that makes any sense. It won't be *that* long before Python 2 is deprecated and removed entirely.  `python` should just be whatever the default python is.",
    "created_at": "2017-08-24T10:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435695",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
Replying to [chapoton](#comment%3A11):
> I think Volker once said that one should rather always let python point to python2.
> 
> See ticket:22582#comment:31


I don't think that makes any sense. It won't be *that* long before Python 2 is deprecated and removed entirely.  `python` should just be whatever the default python is.



---

archive/issue_comments_435696.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> I view `sage-python23` as a build-time tool. Actually, I view the setting of `SAGE_PYTHON3` as something which only affects the Sage build, not necessarily how things are run. The Sage community has not made any decisions about how to actually run Sage using Python 3. As a result, I am somewhat wary of just using `sage-python23` everywhere. I tried to explain this in [comment:2](#comment%3A2).\n\n\nThat's a fair point. I think you're right--better it just be `/usr/bin/env python`.  I don't think it makes sense to have side-by-side Python 2 and Python 3 installations of Sage, or the ability to switch between on the fly.  That may be slightly convenient for working on Python 3 compatibility *development*, but that only affects a few people who can probably afford to have two separate builds for those purposes.  One thing I am working with \"abstract package\" support is a better way (better than setting `SAGE_PYTHON3=yes`) to select the default Python at `./configure` time, but changing that selection still requires a rebuild of anything that depends on Python.",
    "created_at": "2017-08-24T10:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435696",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Replying to [jhpalmieri](#comment%3A12):
> I view `sage-python23` as a build-time tool. Actually, I view the setting of `SAGE_PYTHON3` as something which only affects the Sage build, not necessarily how things are run. The Sage community has not made any decisions about how to actually run Sage using Python 3. As a result, I am somewhat wary of just using `sage-python23` everywhere. I tried to explain this in [comment:2](#comment%3A2).


That's a fair point. I think you're right--better it just be `/usr/bin/env python`.  I don't think it makes sense to have side-by-side Python 2 and Python 3 installations of Sage, or the ability to switch between on the fly.  That may be slightly convenient for working on Python 3 compatibility *development*, but that only affects a few people who can probably afford to have two separate builds for those purposes.  One thing I am working with "abstract package" support is a better way (better than setting `SAGE_PYTHON3=yes`) to select the default Python at `./configure` time, but changing that selection still requires a rebuild of anything that depends on Python.



---

archive/issue_comments_435697.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [embray](#comment%3A13):\n> Replying to [chapoton](#comment%3A11):\n> > I think Volker once said that one should rather always let python point to python2.\n> > \n> > See ticket:22582#comment:31\n\n> \n> I don't think that makes any sense. It won't be *that* long before Python 2 is deprecated and removed entirely.  `python` should just be whatever the default python is.\n\n\nTo clarify, it's not just that Volker once said it, it's [PEP 394](https://www.python.org/dev/peps/pep-0394/).",
    "created_at": "2017-08-24T15:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435697",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
Replying to [embray](#comment%3A13):
> Replying to [chapoton](#comment%3A11):
> > I think Volker once said that one should rather always let python point to python2.
> > 
> > See ticket:22582#comment:31

> 
> I don't think that makes any sense. It won't be *that* long before Python 2 is deprecated and removed entirely.  `python` should just be whatever the default python is.


To clarify, it's not just that Volker once said it, it's [PEP 394](https://www.python.org/dev/peps/pep-0394/).



---

archive/issue_comments_435698.json:
```json
{
    "body": "<a id='comment:16'></a>\nBoy, that PEP is a mess.  But I agree it makes sense, for shebang lines at least, that `python2` or `python3` is always specified....",
    "created_at": "2017-08-25T15:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435698",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Boy, that PEP is a mess.  But I agree it makes sense, for shebang lines at least, that `python2` or `python3` is always specified....



---

archive/issue_comments_435699.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis would now start to be really very useful (as sage starts with python3 using the experimental branch).",
    "created_at": "2017-10-15T07:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435699",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>
This would now start to be really very useful (as sage starts with python3 using the experimental branch).



---

archive/issue_comments_435700.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [chapoton](#comment%3A17):\n> This would now start to be really very useful (as sage starts with python3 using the experimental branch).\n\n\nI think we need to make a design decision before we can make progress on this ticket. Once you set `SAGE_PYTHON3=yes` (or set the appropriate configure flag, some time in the future), does that forever \"pollute\" the Sage scripts so that they use python3, or do we want to somehow allow python2 and python3 builds to live side by side? If the former, we need to either save the setting so that future incremental builds in the same directory continue to use SAGE_PYTHON3=yes, or we let users shoot themselves in the foot by building with Python 3 and then a few weeks later upgrading matplotlib and forgetting to set the variable, so it tries to use Python 2 and something goes horribly wrong.\n\nThere are a few Sage packages which depend on Python and build libraries which do not reside in `local/lib/python$VERSION/`, and those present obstacles to side-by-side builds.",
    "created_at": "2017-10-20T18:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435700",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
Replying to [chapoton](#comment%3A17):
> This would now start to be really very useful (as sage starts with python3 using the experimental branch).


I think we need to make a design decision before we can make progress on this ticket. Once you set `SAGE_PYTHON3=yes` (or set the appropriate configure flag, some time in the future), does that forever "pollute" the Sage scripts so that they use python3, or do we want to somehow allow python2 and python3 builds to live side by side? If the former, we need to either save the setting so that future incremental builds in the same directory continue to use SAGE_PYTHON3=yes, or we let users shoot themselves in the foot by building with Python 3 and then a few weeks later upgrading matplotlib and forgetting to set the variable, so it tries to use Python 2 and something goes horribly wrong.

There are a few Sage packages which depend on Python and build libraries which do not reside in `local/lib/python$VERSION/`, and those present obstacles to side-by-side builds.



---

archive/issue_comments_435701.json:
```json
{
    "body": "<a id='comment:19'></a>\nFrom a development perspective there's a convenience to allowing simultaneous Python 2 and Python 3 installations to live side-by-side.  But currently this doesn't even work since some libraries, such as Pynac, can't be be installed with Python 2 and Python 3 support simultaneously (this could be fixed, for example, by attaching the Python version to the SONAME of the library, but I don't think that's currently supported).\n\nThat said, from a more general user perspective I don't think there's much advantage.  I think it will be much, much simpler if `SAGE_PYTHON3` is treated solely as a built-time variable that indicates what Python should be used to build and run Sage.  And of course it should really be replaced with a `./configure` flag.  I think that makes the whole affair much, much simpler.\n\nOne thing that should still be possible is re-configuring with a different `--with-python=` flag, and rebuilding with that Python.  I had some success making that work in my experimental ticket #23465.",
    "created_at": "2017-10-23T08:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435701",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
From a development perspective there's a convenience to allowing simultaneous Python 2 and Python 3 installations to live side-by-side.  But currently this doesn't even work since some libraries, such as Pynac, can't be be installed with Python 2 and Python 3 support simultaneously (this could be fixed, for example, by attaching the Python version to the SONAME of the library, but I don't think that's currently supported).

That said, from a more general user perspective I don't think there's much advantage.  I think it will be much, much simpler if `SAGE_PYTHON3` is treated solely as a built-time variable that indicates what Python should be used to build and run Sage.  And of course it should really be replaced with a `./configure` flag.  I think that makes the whole affair much, much simpler.

One thing that should still be possible is re-configuring with a different `--with-python=` flag, and rebuilding with that Python.  I had some success making that work in my experimental ticket #23465.



---

archive/issue_events_067963.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-09T19:26:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23106#event-67963"
}
```



---

archive/issue_events_067964.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-09T19:26:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23106#event-67964"
}
```



---

archive/issue_comments_435702.json:
```json
{
    "body": "<a id='comment:21'></a>\nI've fixed quite a number of these in my branch just by changing the shebang lines to use `sage-python23`.  There *might* be some cases where this isn't appropriate, but I've found it to b the right way to go in most cases.",
    "created_at": "2018-01-10T13:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435702",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
I've fixed quite a number of these in my branch just by changing the shebang lines to use `sage-python23`.  There *might* be some cases where this isn't appropriate, but I've found it to b the right way to go in most cases.



---

archive/issue_comments_435703.json:
```json
{
    "body": "<a id='comment:22'></a>\nCertainly the fixes in the branch attached to this ticket are a good start.  I think we should go ahead and merge it, and leave bigger questions for a separate ticket.",
    "created_at": "2018-01-10T13:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435703",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
Certainly the fixes in the branch attached to this ticket are a good start.  I think we should go ahead and merge it, and leave bigger questions for a separate ticket.



---

archive/issue_comments_435704.json:
```json
{
    "body": "<a id='comment:23'></a>\nso, positive review ?",
    "created_at": "2018-01-10T13:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435704",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>
so, positive review ?



---

archive/issue_comments_435705.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2018-01-10T13:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435705",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_435706.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-01-10T13:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435706",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_435707.json:
```json
{
    "body": "<a id='comment:24'></a>\nFor me, yeah. I just wasn't sure if there were other objections.",
    "created_at": "2018-01-10T13:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435707",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>
For me, yeah. I just wasn't sure if there were other objections.



---

archive/issue_comments_435708.json:
```json
{
    "body": "<a id='comment:25'></a>\nTo the extent that we want to separate the build process from the runtime process, this should be a temporary solution, right? We either shouldn't be calling `sage-python23` from runtime pieces (since `sage-python23` lives in `build/bin`) or we should move it or have a new script in `src/bin` which does something similar.",
    "created_at": "2018-01-10T18:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435708",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
To the extent that we want to separate the build process from the runtime process, this should be a temporary solution, right? We either shouldn't be calling `sage-python23` from runtime pieces (since `sage-python23` lives in `build/bin`) or we should move it or have a new script in `src/bin` which does something similar.



---

archive/issue_comments_435709.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-01-13T22:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435709",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_435710.json:
```json
{
    "body": "<a id='comment:26'></a>\n\n```\nsage -t --long --warn-long 78.8 src/sage/misc/gperftools.py\n**********************************************************************\nFile \"src/sage/misc/gperftools.py\", line 244, in sage.misc.gperftools.Profiler._executable\nFailed example:\n    prof._executable()\nExpected:\n    '.../python'\nGot:\n    '/mnt/disk/home/release/Sage/local/bin/python2'\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.misc.gperftools.Profiler._executable\n    [36 tests, 1 failure, 0.94 s]\n```",
    "created_at": "2018-01-13T22:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435710",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>

```
sage -t --long --warn-long 78.8 src/sage/misc/gperftools.py
**********************************************************************
File "src/sage/misc/gperftools.py", line 244, in sage.misc.gperftools.Profiler._executable
Failed example:
    prof._executable()
Expected:
    '.../python'
Got:
    '/mnt/disk/home/release/Sage/local/bin/python2'
**********************************************************************
1 item had failures:
   1 of   4 in sage.misc.gperftools.Profiler._executable
    [36 tests, 1 failure, 0.94 s]
```



---

archive/issue_comments_435711.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00\">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa\">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>\n",
    "created_at": "2018-01-16T09:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>




---

archive/issue_comments_435712.json:
```json
{
    "body": "**Changing commit** from \"[5eb29bf3f711fe6593b89a04e0efc4dab56fd49f](https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f)\" to \"[25dddc53d545ad2400023000d62d33bb990879aa](https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa)\".",
    "created_at": "2018-01-16T09:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5eb29bf3f711fe6593b89a04e0efc4dab56fd49f](https://github.com/sagemath/sagetrac-mirror/commit/5eb29bf3f711fe6593b89a04e0efc4dab56fd49f)" to "[25dddc53d545ad2400023000d62d33bb990879aa](https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa)".



---

archive/issue_comments_435713.json:
```json
{
    "body": "<a id='comment:28'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00\">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa\">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00\">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa\">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>\n",
    "created_at": "2018-01-16T09:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435713",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c8d97fc7f9f86a191fb10d3bf42c6121f6d0a00">2c8d97f</a></td><td><code>Merge branch 'public/23106' in 8.2.b2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa">25dddc5</a></td><td><code>trac 23106 detail</code></td></tr></table>




---

archive/issue_comments_435714.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-01-16T09:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435714",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_435715.json:
```json
{
    "body": "<a id='comment:29'></a>\nThat fix won't work on Python 3--just put `.../python...` (and consider squashing)",
    "created_at": "2018-01-16T14:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435715",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
That fix won't work on Python 3--just put `.../python...` (and consider squashing)



---

archive/issue_comments_435716.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-01-16T14:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435716",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_435717.json:
```json
{
    "body": "**Changing commit** from \"[25dddc53d545ad2400023000d62d33bb990879aa](https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa)\" to \"[847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)\".",
    "created_at": "2018-01-16T14:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[25dddc53d545ad2400023000d62d33bb990879aa](https://github.com/sagemath/sagetrac-mirror/commit/25dddc53d545ad2400023000d62d33bb990879aa)" to "[847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)".



---

archive/issue_comments_435718.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324\">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>\n",
    "created_at": "2018-01-16T14:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>




---

archive/issue_comments_435719.json:
```json
{
    "body": "<a id='comment:31'></a>\ndone\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324\">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324\">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>\n",
    "created_at": "2018-01-16T14:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435719",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
done

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324">847df2c</a></td><td><code>modify scripts towards python3 compatibility</code></td></tr></table>




---

archive/issue_comments_435720.json:
```json
{
    "body": "<a id='comment:32'></a>\nThanks!",
    "created_at": "2018-01-16T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435720",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>
Thanks!



---

archive/issue_comments_435721.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2018-01-16T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435721",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_435722.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jhpalmieri](#comment%3A25):\n> To the extent that we want to separate the build process from the runtime process, this should be a temporary solution, right? We either shouldn't be calling `sage-python23` from runtime pieces (since `sage-python23` lives in `build/bin`) or we should move it or have a new script in `src/bin` which does something similar.\n\n\nI don't particularly care where the scripts live in the source code--I think that scripts are needed at build time living in `src/bin` makes sense, but don't have strong opinions about it.\n\nAll that matters to me is what happens at installation.  I think all scripts in `build/bin` should be installed to `$SAGE_LOCAL/bin`.  Similarly I'm of the opinion that most other files in `build/` should be installed somewhere under `$SAGE_LOCAL` so that, for example, one can install new packages for Sage at runtime without having a full sage source tree lying around.  That is, package installations and upgrades fully become a \"runtime\" feature of Sage.  That's all a much bigger topic beyond this though.",
    "created_at": "2018-01-16T14:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435722",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>
Replying to [jhpalmieri](#comment%3A25):
> To the extent that we want to separate the build process from the runtime process, this should be a temporary solution, right? We either shouldn't be calling `sage-python23` from runtime pieces (since `sage-python23` lives in `build/bin`) or we should move it or have a new script in `src/bin` which does something similar.


I don't particularly care where the scripts live in the source code--I think that scripts are needed at build time living in `src/bin` makes sense, but don't have strong opinions about it.

All that matters to me is what happens at installation.  I think all scripts in `build/bin` should be installed to `$SAGE_LOCAL/bin`.  Similarly I'm of the opinion that most other files in `build/` should be installed somewhere under `$SAGE_LOCAL` so that, for example, one can install new packages for Sage at runtime without having a full sage source tree lying around.  That is, package installations and upgrades fully become a "runtime" feature of Sage.  That's all a much bigger topic beyond this though.



---

archive/issue_events_067965.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-18T18:09:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23106#event-67965"
}
```



---

archive/issue_comments_435723.json:
```json
{
    "body": "**Changing branch** from \"[public/23106](https://github.com/sagemath/sagetrac-mirror/tree/public/23106)\" to \"[847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)\".",
    "created_at": "2018-01-18T18:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435723",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/23106](https://github.com/sagemath/sagetrac-mirror/tree/public/23106)" to "[847df2c99cbce5f35f4c7c15da1ecb26843f5324](https://github.com/sagemath/sagetrac-mirror/commit/847df2c99cbce5f35f4c7c15da1ecb26843f5324)".



---

archive/issue_comments_435724.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-01-18T18:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23106#issuecomment-435724",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
