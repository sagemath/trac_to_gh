# Issue 23696: Update matplotlib to 2.1.0

archive/issues_023459.json:
```json
{
    "body": "It's time we update; Debian already uses matplotlib 2.0.0.\n\nFor matplotlib 2.1.0 we need to update `setuptools_scm` and two new dependencies `backports.functools_lru_cache` and `subprocess32`.\n\nTarballs:\n* [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)\n* [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)\n* [https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz](https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz)\n* [http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz](http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz)\n\n**CC:**  @kiwifb @strogdon @egourgoulhon @EmmanuelCharpentier @fchapoton\n\n**Branch:** [ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)\n\n**Upstream:** None of the above - read trac for reasoning.\n\n**Reviewer:** Eric Gourgoulhon, Dima Pasechnik\n\n**Author:** Fran\u00e7ois Bissey, Steven Trogdon\n\nIssue created by migration from https://trac.sagemath.org/ticket/23696\n\n",
    "closed_at": "2018-02-02T12:06:11Z",
    "created_at": "2017-08-24T11:14:35Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "title": "Update matplotlib to 2.1.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/23696",
    "user": "https://github.com/dimpase"
}
```
It's time we update; Debian already uses matplotlib 2.0.0.

For matplotlib 2.1.0 we need to update `setuptools_scm` and two new dependencies `backports.functools_lru_cache` and `subprocess32`.

Tarballs:
* [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)
* [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)
* [https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz](https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz)
* [http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz](http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz)

**CC:**  @kiwifb @strogdon @egourgoulhon @EmmanuelCharpentier @fchapoton

**Branch:** [ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)

**Upstream:** None of the above - read trac for reasoning.

**Reviewer:** Eric Gourgoulhon, Dima Pasechnik

**Author:** Fran√ßois Bissey, Steven Trogdon

Issue created by migration from https://trac.sagemath.org/ticket/23696





---

archive/issue_comments_359276.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'll have to look at debian's patches sometimes tomorrow. I backed out of 2.0.2 in sage-on-gentoo a few weeks ago\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/plot/plot.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/plot/plot.py\", line 483, in sage.plot.plot\nFailed example:\n    plt.savefig(os.path.join(SAGE_TMP, 'foo.png'))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot[77]>\", line 1, in <module>\n        plt.savefig(os.path.join(SAGE_TMP, 'foo.png'))\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/pyplot.py\", line 697, in savefig\n        res = fig.savefig(*args, **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/figure.py\", line 1573, in savefig\n        self.canvas.print_figure(*args, **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/backend_bases.py\", line 2252, in print_figure\n        **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/backends/backend_agg.py\", line 545, in print_png\n        FigureCanvasAgg.draw(self)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/backends/backend_agg.py\", line 464, in draw\n        self.figure.draw(self.renderer)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/artist.py\", line 63, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/figure.py\", line 1144, in draw\n        renderer, self, dsu, self.suppressComposite)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/image.py\", line 139, in _draw_list_compositing_images\n        a.draw(renderer)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/artist.py\", line 63, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/axes/_base.py\", line 2426, in draw\n        mimage._draw_list_compositing_images(renderer, self, dsu)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/image.py\", line 139, in _draw_list_compositing_images\n        a.draw(renderer)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/artist.py\", line 63, in draw_wrapper\n        draw(artist, renderer, *args, **kwargs)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/image.py\", line 543, in draw\n        renderer, renderer.get_image_magnification())\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/image.py\", line 770, in make_image\n        unsampled=unsampled)\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/image.py\", line 426, in _make_image\n        self.get_filternorm() or 0.0, self.get_filterrad() or 0.0)\n    ValueError: 3-dimensional arrays must be of dtype unsigned byte, unsigned short, float32 or float64\n**********************************************************************\n```\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/plot/arrow.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/plot/arrow.py\", line 364, in sage.plot.arrow.Arrow._render_on_subplot\nFailed example:\n    two_stroke_re.search(contents) is None\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\nand\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx\", line 120, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data\nFailed example:\n    h, b = X.generate_histogram_data(bins = 10)\nExpected nothing\nGot:\n    doctest:warning\n      File \"/usr/lib/python-exec/python2.7/sage-runtests\", line 98, in <module>\n        err = DC.run()\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/control.py\", line 1099, in run\n        self.run_doctests()\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/control.py\", line 824, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 1777, in dispatch\n        self.parallel_dispatch()\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 1667, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 1943, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib64/python2.7/multiprocessing/process.py\", line 130, in start\n        self._popen = Popen(self)\n      File \"/usr/lib64/python2.7/multiprocessing/forking.py\", line 126, in __init__\n        code = process_obj._bootstrap()\n      File \"/usr/lib64/python2.7/multiprocessing/process.py\", line 258, in _bootstrap\n        self.run()\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 1916, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 2218, in __call__\n        result = runner.run(test)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 663, in run\n        return self._run(test, compileflags, out)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data[3]>\", line 1, in <module>\n        h, b = X.generate_histogram_data(bins = Integer(10))\n      File \"/usr/lib64/python2.7/site-packages/matplotlib/pyplot.py\", line 3075, in hist\n        mplDeprecation)\n    :\n    MatplotlibDeprecationWarning: The 'hold' keyword argument is deprecated since 2.0.\n**********************************************************************\n```\nwhich is solved by #23696.",
    "created_at": "2017-08-24T12:33:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359276",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
I'll have to look at debian's patches sometimes tomorrow. I backed out of 2.0.2 in sage-on-gentoo a few weeks ago

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/plot/plot.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/plot/plot.py", line 483, in sage.plot.plot
Failed example:
    plt.savefig(os.path.join(SAGE_TMP, 'foo.png'))
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot[77]>", line 1, in <module>
        plt.savefig(os.path.join(SAGE_TMP, 'foo.png'))
      File "/usr/lib64/python2.7/site-packages/matplotlib/pyplot.py", line 697, in savefig
        res = fig.savefig(*args, **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/figure.py", line 1573, in savefig
        self.canvas.print_figure(*args, **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/backend_bases.py", line 2252, in print_figure
        **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/backends/backend_agg.py", line 545, in print_png
        FigureCanvasAgg.draw(self)
      File "/usr/lib64/python2.7/site-packages/matplotlib/backends/backend_agg.py", line 464, in draw
        self.figure.draw(self.renderer)
      File "/usr/lib64/python2.7/site-packages/matplotlib/artist.py", line 63, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/figure.py", line 1144, in draw
        renderer, self, dsu, self.suppressComposite)
      File "/usr/lib64/python2.7/site-packages/matplotlib/image.py", line 139, in _draw_list_compositing_images
        a.draw(renderer)
      File "/usr/lib64/python2.7/site-packages/matplotlib/artist.py", line 63, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/axes/_base.py", line 2426, in draw
        mimage._draw_list_compositing_images(renderer, self, dsu)
      File "/usr/lib64/python2.7/site-packages/matplotlib/image.py", line 139, in _draw_list_compositing_images
        a.draw(renderer)
      File "/usr/lib64/python2.7/site-packages/matplotlib/artist.py", line 63, in draw_wrapper
        draw(artist, renderer, *args, **kwargs)
      File "/usr/lib64/python2.7/site-packages/matplotlib/image.py", line 543, in draw
        renderer, renderer.get_image_magnification())
      File "/usr/lib64/python2.7/site-packages/matplotlib/image.py", line 770, in make_image
        unsampled=unsampled)
      File "/usr/lib64/python2.7/site-packages/matplotlib/image.py", line 426, in _make_image
        self.get_filternorm() or 0.0, self.get_filterrad() or 0.0)
    ValueError: 3-dimensional arrays must be of dtype unsigned byte, unsigned short, float32 or float64
**********************************************************************
```

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/plot/arrow.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/plot/arrow.py", line 364, in sage.plot.arrow.Arrow._render_on_subplot
Failed example:
    two_stroke_re.search(contents) is None
Expected:
    True
Got:
    False
**********************************************************************
```
and

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx", line 120, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data
Failed example:
    h, b = X.generate_histogram_data(bins = 10)
Expected nothing
Got:
    doctest:warning
      File "/usr/lib/python-exec/python2.7/sage-runtests", line 98, in <module>
        err = DC.run()
      File "/usr/lib64/python2.7/site-packages/sage/doctest/control.py", line 1099, in run
        self.run_doctests()
      File "/usr/lib64/python2.7/site-packages/sage/doctest/control.py", line 824, in run_doctests
        self.dispatcher.dispatch()
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 1777, in dispatch
        self.parallel_dispatch()
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 1667, in parallel_dispatch
        w.start()  # This might take some time
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 1943, in start
        super(DocTestWorker, self).start()
      File "/usr/lib64/python2.7/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/usr/lib64/python2.7/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/usr/lib64/python2.7/multiprocessing/process.py", line 258, in _bootstrap
        self.run()
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 1916, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 2218, in __call__
        result = runner.run(test)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 663, in run
        return self._run(test, compileflags, out)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data[3]>", line 1, in <module>
        h, b = X.generate_histogram_data(bins = Integer(10))
      File "/usr/lib64/python2.7/site-packages/matplotlib/pyplot.py", line 3075, in hist
        mplDeprecation)
    :
    MatplotlibDeprecationWarning: The 'hold' keyword argument is deprecated since 2.0.
**********************************************************************
```
which is solved by #23696.



---

archive/issue_comments_359277.json:
```json
{
    "body": "**Dependencies:** #23689",
    "created_at": "2017-08-24T13:50:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359277",
    "user": "https://github.com/dimpase"
}
```

**Dependencies:** #23689



---

archive/issue_comments_359278.json:
```json
{
    "body": "<a id='comment:3'></a>\nSurely you meant #23689 (added to deps now).",
    "created_at": "2017-08-24T13:50:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359278",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
Surely you meant #23689 (added to deps now).



---

archive/issue_comments_359279.json:
```json
{
    "body": "<a id='comment:4'></a>\nI was nicely self referential :) No patch for these in debian, they must live with it. I thought I had more stuff like the first failure, something silly like replacing `[(0,0,0)]` by `[(0.0,0.0,0.0)]` or some such fixes it if I remember correctly.",
    "created_at": "2017-08-25T10:23:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359279",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
I was nicely self referential :) No patch for these in debian, they must live with it. I thought I had more stuff like the first failure, something silly like replacing `[(0,0,0)]` by `[(0.0,0.0,0.0)]` or some such fixes it if I remember correctly.



---

archive/issue_comments_359280.json:
```json
{
    "body": "<a id='comment:5'></a>\nI'm adding #23711 as dependency because it might be relevant to this ticket.",
    "created_at": "2017-08-25T10:26:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
I'm adding #23711 as dependency because it might be relevant to this ticket.



---

archive/issue_comments_359281.json:
```json
{
    "body": "**Changing dependencies** from \"#23689\" to \"#23689, #23711\".",
    "created_at": "2017-08-25T10:26:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359281",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#23689" to "#23689, #23711".



---

archive/issue_comments_359282.json:
```json
{
    "body": "**Changing dependencies** from \"#23689, #23711\" to \"\".",
    "created_at": "2017-09-22T13:51:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359282",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#23689, #23711" to "".



---

archive/issue_events_210671.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-18T13:05:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "rename": {
        "from": "update matplotlib to 2.0.2",
        "to": "Update matplotlib to 2.1.0"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210671"
}
```



---

archive/issue_comments_359283.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,10 @@\n-It's time we update; debian already is able to use matplotlib 2.0.\n+It's time we update; Debian already uses matplotlib 2.0.0\n+\n+Unfortunately, there are various doctest failures.\n+\n+We should also revert these lines in `src/sage/all.py` (added in #23696):\n+\n+```\n+# Ignore warnings due to matplotlib-1.5 together with numpy-1.13\n+warnings.filterwarnings('ignore', module='matplotlib[.]contour|numpy[.]ma[.]core')\n+```\n``````\n",
    "created_at": "2017-10-18T13:40:07Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359283",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,10 @@
-It's time we update; debian already is able to use matplotlib 2.0.
+It's time we update; Debian already uses matplotlib 2.0.0
+
+Unfortunately, there are various doctest failures.
+
+We should also revert these lines in `src/sage/all.py` (added in #23696):
+
+```
+# Ignore warnings due to matplotlib-1.5 together with numpy-1.13
+warnings.filterwarnings('ignore', module='matplotlib[.]contour|numpy[.]ma[.]core')
+```
``````




---

archive/issue_comments_359284.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Unfortunately, there are various doctest failures.\n \n-We should also revert these lines in `src/sage/all.py` (added in #23696):\n+We should also revert these lines in `src/sage/all.py` (added in #24063):\n \n ```\n # Ignore warnings due to matplotlib-1.5 together with numpy-1.13\n``````\n",
    "created_at": "2017-10-18T13:40:41Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359284",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Unfortunately, there are various doctest failures.
 
-We should also revert these lines in `src/sage/all.py` (added in #23696):
+We should also revert these lines in `src/sage/all.py` (added in #24063):
 
 ```
 # Ignore warnings due to matplotlib-1.5 together with numpy-1.13
``````




---

archive/issue_comments_359285.json:
```json
{
    "body": "<a id='comment:11'></a>\nWondering about the test about arrow. From the file\n\n```\n        Dashed arrows should have solid arrowheads,\n        :trac:`12852`. This test saves the plot of a dashed arrow to\n        an EPS file. Within the EPS file, ``stroke`` will be called\n        twice: once to draw the line, and again to draw the\n        arrowhead. We check that both calls do not occur while the\n        dashed line style is enabled::\n            sage: a = arrow((0,0), (1,1), linestyle='dashed')\n            sage: filename = tmp_filename(ext='.eps')\n            sage: a.save(filename=filename)\n            sage: with open(filename, 'r') as f:\n            ....:     contents = f.read().replace('\\n', ' ')\n            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'\n            sage: import re\n            sage: two_stroke_re = re.compile(two_stroke_pattern)\n            sage: two_stroke_re.search(contents) is None\n            True\n```\nWhen I look at the result of the last one I get\n\n```\nsage: two_stroke_re.search(contents)\n<_sre.SRE_Match object at 0x7f0420011bf8>\n```\nObviously not `none` but we don't know from that if what is being tested failed or not. For the other doctest, it is a case of input being integer when the interface request a \"real\" type. Replacing a `(0,0,0)` by `(0.0,0.0,0.0)` does indeed fix the test.",
    "created_at": "2017-10-23T03:36:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359285",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Wondering about the test about arrow. From the file

```
        Dashed arrows should have solid arrowheads,
        :trac:`12852`. This test saves the plot of a dashed arrow to
        an EPS file. Within the EPS file, ``stroke`` will be called
        twice: once to draw the line, and again to draw the
        arrowhead. We check that both calls do not occur while the
        dashed line style is enabled::
            sage: a = arrow((0,0), (1,1), linestyle='dashed')
            sage: filename = tmp_filename(ext='.eps')
            sage: a.save(filename=filename)
            sage: with open(filename, 'r') as f:
            ....:     contents = f.read().replace('\n', ' ')
            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'
            sage: import re
            sage: two_stroke_re = re.compile(two_stroke_pattern)
            sage: two_stroke_re.search(contents) is None
            True
```
When I look at the result of the last one I get

```
sage: two_stroke_re.search(contents)
<_sre.SRE_Match object at 0x7f0420011bf8>
```
Obviously not `none` but we don't know from that if what is being tested failed or not. For the other doctest, it is a case of input being integer when the interface request a "real" type. Replacing a `(0,0,0)` by `(0.0,0.0,0.0)` does indeed fix the test.



---

archive/issue_comments_359286.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [fbissey](#comment%3A11):\n> Wondering about the test about arrow. From the file\n> \n> ```\n>         Dashed arrows should have solid arrowheads,\n>         :trac:`12852`. This test saves the plot of a dashed arrow to\n>         an EPS file. Within the EPS file, ``stroke`` will be called\n>         twice: once to draw the line, and again to draw the\n>         arrowhead. We check that both calls do not occur while the\n>         dashed line style is enabled::\n>             sage: a = arrow((0,0), (1,1), linestyle='dashed')\n>             sage: filename = tmp_filename(ext='.eps')\n>             sage: a.save(filename=filename)\n>             sage: with open(filename, 'r') as f:\n>             ....:     contents = f.read().replace('\\n', ' ')\n>             sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'\n>             sage: import re\n>             sage: two_stroke_re = re.compile(two_stroke_pattern)\n>             sage: two_stroke_re.search(contents) is None\n>             True\n> ```\n> When I look at the result of the last one I get\n> \n> ```\n> sage: two_stroke_re.search(contents)\n> <_sre.SRE_Match object at 0x7f0420011bf8>\n> ```\n> Obviously not `none` but we don't know from that if what is being tested failed or not.\n\n\nNot sure about what `two_stroke_re.search(contents)` returns, but I think the doctest actually failed. If I replace `two_stroke_re.search(contents) is None` with `two_stroke_re.search(contents) is not None` I get `True`. If you look at the generated `.eps` file the arrow is drawn with dashed lines. So I think the Sage patch from ticket #12852 is not working. I don't have matplotlib-2.1.0, 2.0.2 was used.",
    "created_at": "2017-10-23T18:42:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359286",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:12'></a>
Replying to [fbissey](#comment%3A11):
> Wondering about the test about arrow. From the file
> 
> ```
>         Dashed arrows should have solid arrowheads,
>         :trac:`12852`. This test saves the plot of a dashed arrow to
>         an EPS file. Within the EPS file, ``stroke`` will be called
>         twice: once to draw the line, and again to draw the
>         arrowhead. We check that both calls do not occur while the
>         dashed line style is enabled::
>             sage: a = arrow((0,0), (1,1), linestyle='dashed')
>             sage: filename = tmp_filename(ext='.eps')
>             sage: a.save(filename=filename)
>             sage: with open(filename, 'r') as f:
>             ....:     contents = f.read().replace('\n', ' ')
>             sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'
>             sage: import re
>             sage: two_stroke_re = re.compile(two_stroke_pattern)
>             sage: two_stroke_re.search(contents) is None
>             True
> ```
> When I look at the result of the last one I get
> 
> ```
> sage: two_stroke_re.search(contents)
> <_sre.SRE_Match object at 0x7f0420011bf8>
> ```
> Obviously not `none` but we don't know from that if what is being tested failed or not.


Not sure about what `two_stroke_re.search(contents)` returns, but I think the doctest actually failed. If I replace `two_stroke_re.search(contents) is None` with `two_stroke_re.search(contents) is not None` I get `True`. If you look at the generated `.eps` file the arrow is drawn with dashed lines. So I think the Sage patch from ticket #12852 is not working. I don't have matplotlib-2.1.0, 2.0.2 was used.



---

archive/issue_comments_359287.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks Steve, I was working remotely so I didn't think of opening the generated `.eps`. I also use 2.0.2 right now but I am expecting 2.1.0 to be the same.",
    "created_at": "2017-10-23T20:24:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359287",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Thanks Steve, I was working remotely so I didn't think of opening the generated `.eps`. I also use 2.0.2 right now but I am expecting 2.1.0 to be the same.



---

archive/issue_comments_359288.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt seems that line 440 in `src/sage/plot/arrow.py`\n\n```\npe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle=\"solid\")])\n```\nis doing nothing. In particular `pe.Stroke()` is ignoring `linestyle=\"solid\"`. This is the piece that insures the head of the arrow is filled/solid. With `matplotlib-1.5.3` if I replace `linestyle=\"solid\"` with `linestyle=\"junk\"` I get `ValueError: Unrecognized linestyle: junk` when saving the `.eps`\n\n```\n            sage: a = arrow((0,0), (1,1), linestyle='dashed')\n            sage: filename = tmp_filename(ext='.eps')\n            sage: a.save(filename=filename)\n```\nI get no error when doing the same with `matplotlib-2.0.2` and the head of the arrow is drawn with `linestyle=\"dashed\"`.",
    "created_at": "2017-10-24T18:01:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359288",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:14'></a>
It seems that line 440 in `src/sage/plot/arrow.py`

```
pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle="solid")])
```
is doing nothing. In particular `pe.Stroke()` is ignoring `linestyle="solid"`. This is the piece that insures the head of the arrow is filled/solid. With `matplotlib-1.5.3` if I replace `linestyle="solid"` with `linestyle="junk"` I get `ValueError: Unrecognized linestyle: junk` when saving the `.eps`

```
            sage: a = arrow((0,0), (1,1), linestyle='dashed')
            sage: filename = tmp_filename(ext='.eps')
            sage: a.save(filename=filename)
```
I get no error when doing the same with `matplotlib-2.0.2` and the head of the arrow is drawn with `linestyle="dashed"`.



---

archive/issue_comments_359289.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe arrow issue has been reported upstream. See https://github.com/matplotlib/matplotlib/issues/9579",
    "created_at": "2017-10-28T23:37:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359289",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:15'></a>
The arrow issue has been reported upstream. See https://github.com/matplotlib/matplotlib/issues/9579



---

archive/issue_comments_359290.json:
```json
{
    "body": "**Upstream:** Reported upstream. No feedback yet.",
    "created_at": "2017-10-28T23:37:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359290",
    "user": "https://github.com/strogdon"
}
```

**Upstream:** Reported upstream. No feedback yet.



---

archive/issue_comments_359291.json:
```json
{
    "body": "<a id='comment:16'></a>\nApparently a not so obvious API change. The following should work for `>= 1.5.3`. The `.eps` looks (needs to be confirmed!) OK.\n\n```\n--- a/src/sage/plot/arrow.py\n+++ b/src/sage/plot/arrow.py\n@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):\n                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)\n \n             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])\n-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle=\"solid\")])\n+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])\n             p.set_path_effects([pe1, pe2])\n \n         subplot.add_patch(p)\n```\nThe doctest `./sage -t --long src/sage/plot/arrow.py` does pass on vanilla Sage with the above changes with `matplotlib-1.5.3`. However on sage-on-gentoo with `matplotlib-2.0.2` the generated `.eps` looks OK but the test still fails?\n\n```\nsage -t --long --warn-long 119.2 /usr/lib/python2.7/site-packages/sage/plot/arrow.py\n**********************************************************************\nFile \"/usr/lib/python2.7/site-packages/sage/plot/arrow.py\", line 364, in sage.plot.arrow.Arrow._render_on_subplot\nFailed example:\n    two_stroke_re.search(contents) is None\nExpected:\n    True\nGot:\n    False\n```",
    "created_at": "2017-10-29T22:30:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359291",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:16'></a>
Apparently a not so obvious API change. The following should work for `>= 1.5.3`. The `.eps` looks (needs to be confirmed!) OK.

```
--- a/src/sage/plot/arrow.py
+++ b/src/sage/plot/arrow.py
@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):
                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)
 
             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])
-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle="solid")])
+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])
             p.set_path_effects([pe1, pe2])
 
         subplot.add_patch(p)
```
The doctest `./sage -t --long src/sage/plot/arrow.py` does pass on vanilla Sage with the above changes with `matplotlib-1.5.3`. However on sage-on-gentoo with `matplotlib-2.0.2` the generated `.eps` looks OK but the test still fails?

```
sage -t --long --warn-long 119.2 /usr/lib/python2.7/site-packages/sage/plot/arrow.py
**********************************************************************
File "/usr/lib/python2.7/site-packages/sage/plot/arrow.py", line 364, in sage.plot.arrow.Arrow._render_on_subplot
Failed example:
    two_stroke_re.search(contents) is None
Expected:
    True
Got:
    False
```



---

archive/issue_comments_359292.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"None of the above - read trac for reasoning.\".",
    "created_at": "2017-10-29T22:30:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359292",
    "user": "https://github.com/strogdon"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "None of the above - read trac for reasoning.".



---

archive/issue_comments_359293.json:
```json
{
    "body": "<a id='comment:17'></a>\nWhat does `two_stroke_re.search(contents)` says (similar to ticket:23696#comment:12)?",
    "created_at": "2017-10-29T22:33:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359293",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
What does `two_stroke_re.search(contents)` says (similar to ticket:23696#comment:12)?



---

archive/issue_comments_359294.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [fbissey](#comment%3A17):\n> What does `two_stroke_re.search(contents)` says (similar to ticket:23696#comment:12)?\n\n\nBasically the same\n\n```\nsage: two_stroke_re.search(contents)\n<_sre.SRE_Match object at 0x7fabe8b8e4a8>\n```",
    "created_at": "2017-10-29T22:59:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359294",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:18'></a>
Replying to [fbissey](#comment%3A17):
> What does `two_stroke_re.search(contents)` says (similar to ticket:23696#comment:12)?


Basically the same

```
sage: two_stroke_re.search(contents)
<_sre.SRE_Match object at 0x7fabe8b8e4a8>
```



---

archive/issue_comments_359295.json:
```json
{
    "body": "<a id='comment:19'></a>\nTime to inspect the `.eps` file and figure out what we are looking for. But first, lunch :)",
    "created_at": "2017-10-29T23:01:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359295",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Time to inspect the `.eps` file and figure out what we are looking for. But first, lunch :)



---

archive/issue_comments_359296.json:
```json
{
    "body": "<a id='comment:20'></a>\nFrom what I have this `setdash.*stroke.*stroke.*setdash` is not matched in the `.eps` generated with version 1.5.3 but it is matched in the `.eps` generated with version 2.0.2. Nevertheless the `.eps` appears correct with version 2.0.2.",
    "created_at": "2017-10-30T00:20:10Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359296",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:20'></a>
From what I have this `setdash.*stroke.*stroke.*setdash` is not matched in the `.eps` generated with version 1.5.3 but it is matched in the `.eps` generated with version 2.0.2. Nevertheless the `.eps` appears correct with version 2.0.2.



---

archive/issue_comments_359297.json:
```json
{
    "body": "<a id='comment:21'></a>\nIn the `.eps` it appears that `setdash` is used with multiple `stroke` calls to draw the axis tics. So I think this is what is being found when `setdash.*stroke.*stroke.*setdash` is matched using version 2.0.2. I don't think the given matching mechanism is implementation proof.",
    "created_at": "2017-10-30T02:09:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359297",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:21'></a>
In the `.eps` it appears that `setdash` is used with multiple `stroke` calls to draw the axis tics. So I think this is what is being found when `setdash.*stroke.*stroke.*setdash` is matched using version 2.0.2. I don't think the given matching mechanism is implementation proof.



---

archive/issue_comments_359298.json:
```json
{
    "body": "<a id='comment:22'></a>\nYes, that's my conclusion too. So two choices:\n 1 Remove the test completely. That's rash, considering that enabled us to spot an interface change.\n 2 Work out something else to test. May not be possible.",
    "created_at": "2017-10-30T03:02:41Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359298",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
Yes, that's my conclusion too. So two choices:
 1 Remove the test completely. That's rash, considering that enabled us to spot an interface change.
 2 Work out something else to test. May not be possible.



---

archive/issue_comments_359299.json:
```json
{
    "body": "<a id='comment:23'></a>\nTry the following:\n\n```\n--- a/src/sage/plot/arrow.py\n+++ b/src/sage/plot/arrow.py\n@@ -354,14 +354,15 @@ class Arrow(GraphicPrimitive):\n         dashed line style is enabled::\n \n             sage: a = arrow((0,0), (1,1), linestyle='dashed')\n+            sage: a.axes(False)\n             sage: filename = tmp_filename(ext='.eps')\n             sage: a.save(filename=filename)\n             sage: with open(filename, 'r') as f:\n             ....:     contents = f.read().replace('\\n', ' ')\n-            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'\n+            sage: one_stroke_pattern = r'setdash.*stroke.*setdash.*stroke'\n             sage: import re\n-            sage: two_stroke_re = re.compile(two_stroke_pattern)\n-            sage: two_stroke_re.search(contents) is None\n+            sage: one_stroke_re = re.compile(one_stroke_pattern)\n+            sage: one_stroke_re.search(contents) is not None\n             True\n         \"\"\"\n         from sage.plot.misc import get_matplotlib_linestyle\n@@ -437,7 +438,7 @@ class Arrow(GraphicPrimitive):\n                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)\n \n             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])\n-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle=\"solid\")])\n+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])\n             p.set_path_effects([pe1, pe2])\n \n         subplot.add_patch(p)\n```\nSo I've\n    1) removed the axes\n\n    2) make sure we match `setdash.*stroke.*stroke.*setdash`\nWe want to match the above since when successful the `.eps` looks something like\n\n```\n[7.4 3.2] 0 setdash\n0.000 0.000 1.000 setrgbcolor\ngsave\n434.2 319 10.7 10.7 clipbox\n19.049231 16.833846 m\n158.203077 119.064615 296.756245 220.85409 434.708734 322.20227 c\nstroke\ngrestore\n[] 0 setdash\ngsave\n434.2 319 10.7 10.7 clipbox\n423.689492 320.311157 m\n434.708734 322.20227 l\n429.610079 312.252209 l\n423.689492 320.311157 l\ncl\ngsave\nfill\ngrestore\nstroke\n```\nThe `[] 0 setdash` is the bit that draws the `solid` arrowhead. If that line is removed from the `.eps` file then the arrowhead is drawn with the `dashed` linetype. Of course, the description will have to be changed.",
    "created_at": "2017-10-30T20:16:03Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359299",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:23'></a>
Try the following:

```
--- a/src/sage/plot/arrow.py
+++ b/src/sage/plot/arrow.py
@@ -354,14 +354,15 @@ class Arrow(GraphicPrimitive):
         dashed line style is enabled::
 
             sage: a = arrow((0,0), (1,1), linestyle='dashed')
+            sage: a.axes(False)
             sage: filename = tmp_filename(ext='.eps')
             sage: a.save(filename=filename)
             sage: with open(filename, 'r') as f:
             ....:     contents = f.read().replace('\n', ' ')
-            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'
+            sage: one_stroke_pattern = r'setdash.*stroke.*setdash.*stroke'
             sage: import re
-            sage: two_stroke_re = re.compile(two_stroke_pattern)
-            sage: two_stroke_re.search(contents) is None
+            sage: one_stroke_re = re.compile(one_stroke_pattern)
+            sage: one_stroke_re.search(contents) is not None
             True
         """
         from sage.plot.misc import get_matplotlib_linestyle
@@ -437,7 +438,7 @@ class Arrow(GraphicPrimitive):
                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)
 
             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])
-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle="solid")])
+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])
             p.set_path_effects([pe1, pe2])
 
         subplot.add_patch(p)
```
So I've
    1) removed the axes

    2) make sure we match `setdash.*stroke.*stroke.*setdash`
We want to match the above since when successful the `.eps` looks something like

```
[7.4 3.2] 0 setdash
0.000 0.000 1.000 setrgbcolor
gsave
434.2 319 10.7 10.7 clipbox
19.049231 16.833846 m
158.203077 119.064615 296.756245 220.85409 434.708734 322.20227 c
stroke
grestore
[] 0 setdash
gsave
434.2 319 10.7 10.7 clipbox
423.689492 320.311157 m
434.708734 322.20227 l
429.610079 312.252209 l
423.689492 320.311157 l
cl
gsave
fill
grestore
stroke
```
The `[] 0 setdash` is the bit that draws the `solid` arrowhead. If that line is removed from the `.eps` file then the arrowhead is drawn with the `dashed` linetype. Of course, the description will have to be changed.



---

archive/issue_comments_359300.json:
```json
{
    "body": "<a id='comment:24'></a>\nTurning things on their head a little bit. Can we look for `0 setdash` instead? Basically we draw a line with a `0` dash. So without changing the original eps, looking for something like\n\n```\nsage: zero_dashing_pattern = r'setdash.*stroke.*stroke.*0 setdash'\nsage: zero_dashing_re = re.compile(zero_dashing_pattern)\nsage: zero_dashing_re.search(contents) is not None\n```\nagain it uses `is not None` which is not great.",
    "created_at": "2017-10-30T22:51:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359300",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
Turning things on their head a little bit. Can we look for `0 setdash` instead? Basically we draw a line with a `0` dash. So without changing the original eps, looking for something like

```
sage: zero_dashing_pattern = r'setdash.*stroke.*stroke.*0 setdash'
sage: zero_dashing_re = re.compile(zero_dashing_pattern)
sage: zero_dashing_re.search(contents) is not None
```
again it uses `is not None` which is not great.



---

archive/issue_comments_359301.json:
```json
{
    "body": "<a id='comment:25'></a>\nI have been trying a few things too. And I am getting frustrated because I fell like the doctest is now meaningless. It was introduced to check the behavior of matplotlib was conforming to some expectations, with an idea of before and after state. We have lost the \"before\" state which was in sage 5.10 (anyone wants to go back there?). In the meantime matplotlib behavior has changed and the output we are looking for doesn't make sense anymore.\n\nI think we should just remove the doctest because we cannot make sense of what it should do anymore. It has become pointless and it is difficult to assert what we should test for now.",
    "created_at": "2017-10-30T23:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359301",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
I have been trying a few things too. And I am getting frustrated because I fell like the doctest is now meaningless. It was introduced to check the behavior of matplotlib was conforming to some expectations, with an idea of before and after state. We have lost the "before" state which was in sage 5.10 (anyone wants to go back there?). In the meantime matplotlib behavior has changed and the output we are looking for doesn't make sense anymore.

I think we should just remove the doctest because we cannot make sense of what it should do anymore. It has become pointless and it is difficult to assert what we should test for now.



---

archive/issue_comments_359302.json:
```json
{
    "body": "<a id='comment:26'></a>\nIt seems to me that the intent is to always draw arrows with `solid` arrowheads (perhaps for cosmetic reasons). This can be abandoned, I guess. However, if it is retained I believe this `setdash.*setdash.*stroke.*stroke.*setdash` matches when the arrowhead is drawn incorrectly but does not match when it is `solid`. This keeps the original `.eps` file.",
    "created_at": "2017-10-30T23:52:03Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359302",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:26'></a>
It seems to me that the intent is to always draw arrows with `solid` arrowheads (perhaps for cosmetic reasons). This can be abandoned, I guess. However, if it is retained I believe this `setdash.*setdash.*stroke.*stroke.*setdash` matches when the arrowhead is drawn incorrectly but does not match when it is `solid`. This keeps the original `.eps` file.



---

archive/issue_comments_359303.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis would require that two lines be changed\n\n```\n--- a/src/sage/plot/arrow.py\n+++ b/src/sage/plot/arrow.py\n@@ -358,7 +358,7 @@ class Arrow(GraphicPrimitive):\n             sage: a.save(filename=filename)\n             sage: with open(filename, 'r') as f:\n             ....:     contents = f.read().replace('\\n', ' ')\n-            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'\n+            sage: two_stroke_pattern = r'setdash.*setdash.*stroke.*stroke.*setdash'\n             sage: import re\n             sage: two_stroke_re = re.compile(two_stroke_pattern)\n             sage: two_stroke_re.search(contents) is None\n@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):\n                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)\n \n             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])\n-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle=\"solid\")])\n+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])\n             p.set_path_effects([pe1, pe2])\n \n         subplot.add_patch(p)\n```\nand perhaps some comments. This also works with version `1.5.3`",
    "created_at": "2017-10-31T00:14:38Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359303",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:27'></a>
This would require that two lines be changed

```
--- a/src/sage/plot/arrow.py
+++ b/src/sage/plot/arrow.py
@@ -358,7 +358,7 @@ class Arrow(GraphicPrimitive):
             sage: a.save(filename=filename)
             sage: with open(filename, 'r') as f:
             ....:     contents = f.read().replace('\n', ' ')
-            sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash'
+            sage: two_stroke_pattern = r'setdash.*setdash.*stroke.*stroke.*setdash'
             sage: import re
             sage: two_stroke_re = re.compile(two_stroke_pattern)
             sage: two_stroke_re.search(contents) is None
@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):
                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)
 
             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])
-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(linestyle="solid")])
+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])
             p.set_path_effects([pe1, pe2])
 
         subplot.add_patch(p)
```
and perhaps some comments. This also works with version `1.5.3`



---

archive/issue_comments_359304.json:
```json
{
    "body": "<a id='comment:28'></a>\nAfter a break I think you are right. One of the thing that bugs me is that the pattern searched for a bit too generic, it can catch a lot of things.  The only thing you are sure of with the original pattern is that you look for at least two `stroke` (there could be even more) in between two `setdash`. I think we can try better by making sure we are in the right bounding box with\n\n```\ntwo_stroke_pattern = r'\\[7\\.4 3\\.2\\] 0 setdash.*stroke.*stroke.*setdash'\n```\nThat ensure that we only look in that small box. And the result of the search should be negative. Of course I don't know if the values will stay the same across all systems or versions of matplotlib.",
    "created_at": "2017-10-31T00:15:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359304",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:28'></a>
After a break I think you are right. One of the thing that bugs me is that the pattern searched for a bit too generic, it can catch a lot of things.  The only thing you are sure of with the original pattern is that you look for at least two `stroke` (there could be even more) in between two `setdash`. I think we can try better by making sure we are in the right bounding box with

```
two_stroke_pattern = r'\[7\.4 3\.2\] 0 setdash.*stroke.*stroke.*setdash'
```
That ensure that we only look in that small box. And the result of the search should be negative. Of course I don't know if the values will stay the same across all systems or versions of matplotlib.



---

archive/issue_comments_359305.json:
```json
{
    "body": "<a id='comment:29'></a>\nCross-posting, now I see you try to have two `setdash` first because there is a total of 3 (for now) so that get rid of the uncertainty about the box.",
    "created_at": "2017-10-31T00:17:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359305",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Cross-posting, now I see you try to have two `setdash` first because there is a total of 3 (for now) so that get rid of the uncertainty about the box.



---

archive/issue_comments_359306.json:
```json
{
    "body": "<a id='comment:30'></a>\nYes, with a few more comments I think it can go that way.",
    "created_at": "2017-10-31T00:29:56Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359306",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Yes, with a few more comments I think it can go that way.



---

archive/issue_comments_359307.json:
```json
{
    "body": "**Commit:** [6a0510f35a19f907a719edb832c80dc8ecf6ffea](https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea)",
    "created_at": "2017-11-07T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359307",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [6a0510f35a19f907a719edb832c80dc8ecf6ffea](https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea)



---

archive/issue_comments_359308.json:
```json
{
    "body": "**Branch:** [u/fbissey/MPL-2.1.0](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0)",
    "created_at": "2017-11-07T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359308",
    "user": "https://github.com/kiwifb"
}
```

**Branch:** [u/fbissey/MPL-2.1.0](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0)



---

archive/issue_events_210672.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-07T22:28:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210672"
}
```



---

archive/issue_comments_359309.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,4 @@\n It's time we update; Debian already uses matplotlib 2.0.0\n \n-Unfortunately, there are various doctest failures.\n-\n-We should also revert these lines in `src/sage/all.py` (added in #24063):\n-\n-```\n-# Ignore warnings due to matplotlib-1.5 together with numpy-1.13\n-warnings.filterwarnings('ignore', module='matplotlib[.]contour|numpy[.]ma[.]core')\n-```\n+Tarball:\n+* [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)\n``````\n",
    "created_at": "2017-11-07T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359309",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,4 @@
 It's time we update; Debian already uses matplotlib 2.0.0
 
-Unfortunately, there are various doctest failures.
-
-We should also revert these lines in `src/sage/all.py` (added in #24063):
-
-```
-# Ignore warnings due to matplotlib-1.5 together with numpy-1.13
-warnings.filterwarnings('ignore', module='matplotlib[.]contour|numpy[.]ma[.]core')
-```
+Tarball:
+* [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)
``````




---

archive/issue_comments_359310.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey, Steven Trogdon",
    "created_at": "2017-11-07T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359310",
    "user": "https://github.com/kiwifb"
}
```

**Author:** Fran√ßois Bissey, Steven Trogdon



---

archive/issue_comments_359311.json:
```json
{
    "body": "<a id='comment:31'></a>\nAll right, it is time to move ahead. Please review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c35f93f1db89eea6a53827a10dac85c7a71a1ddd\">c35f93f</a></td><td><code>update matplotlib spkg. Use github in spkg-src instead of pypy (url more stable).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8630f81c26e824cc3e61e28ad98bb890abe079b\">d8630f8</a></td><td><code>matplotlib doesn't like integer in some context, and after 2.0, doesn't seem to cast them.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecf0cb7b1e5e4d036a5bf8d37317b4a3f96076f4\">ecf0cb7</a></td><td><code>fix arrow.py. 1) slight change of interface 2) in a doctest, improve the selection done by regular expression.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea\">6a0510f</a></td><td><code>Remove warning suppression needed with MPL-1.5/numpy-1.13</code></td></tr></table>\n",
    "created_at": "2017-11-07T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359311",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
All right, it is time to move ahead. Please review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c35f93f1db89eea6a53827a10dac85c7a71a1ddd">c35f93f</a></td><td><code>update matplotlib spkg. Use github in spkg-src instead of pypy (url more stable).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8630f81c26e824cc3e61e28ad98bb890abe079b">d8630f8</a></td><td><code>matplotlib doesn't like integer in some context, and after 2.0, doesn't seem to cast them.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecf0cb7b1e5e4d036a5bf8d37317b4a3f96076f4">ecf0cb7</a></td><td><code>fix arrow.py. 1) slight change of interface 2) in a doctest, improve the selection done by regular expression.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea">6a0510f</a></td><td><code>Remove warning suppression needed with MPL-1.5/numpy-1.13</code></td></tr></table>




---

archive/issue_events_210673.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-11-07T23:21:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210673"
}
```



---

archive/issue_events_210674.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2017-11-07T23:21:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210674"
}
```



---

archive/issue_comments_359312.json:
```json
{
    "body": "<a id='comment:32'></a>\nit does seem to need `libqhull`, no? \n\n```\n[matplotlib-2.1.0]     building 'matplotlib._qhull' extension\n[matplotlib-2.1.0]     gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -DMPL_DEVNULL=/dev/null -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib__qhull_ARRAY_API -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -D__STDC_FORMAT_MACROS=1 -I/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/Sage/sage-dev/local/include -I. -I/home/dima/Sage/sage-dev/local/include/python2.7 -c src/qhull_wrap.c -o build/temp.linux-x86_64-2.7/src/qhull_wrap.o\n[matplotlib-2.1.0]     gcc -pthread -shared -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib build/temp.linux-x86_64-2.7/src/qhull_wrap.o -L/home/dima/Sage/sage-dev/local/lib -L/home/dima/Sage/sage-dev/local/lib64 -L/home/dima/Sage/sage-dev/local/lib -lqhull -lpython2.7 -o build/lib.linux-x86_64-2.7/matplotlib/_qhull.so\n[matplotlib-2.1.0]     /usr/lib/gcc/x86_64-pc-linux-gnu/6.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lqhull\n[matplotlib-2.1.0]     collect2: error: ld returned 1 exit status\n```",
    "created_at": "2017-11-07T23:21:17Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359312",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
it does seem to need `libqhull`, no? 

```
[matplotlib-2.1.0]     building 'matplotlib._qhull' extension
[matplotlib-2.1.0]     gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -DMPL_DEVNULL=/dev/null -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib__qhull_ARRAY_API -DNPY_NO_DEPRECATED_API=NPY_1_7_API_VERSION -D__STDC_FORMAT_MACROS=1 -I/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/numpy/core/include -I/home/dima/Sage/sage-dev/local/include -I. -I/home/dima/Sage/sage-dev/local/include/python2.7 -c src/qhull_wrap.c -o build/temp.linux-x86_64-2.7/src/qhull_wrap.o
[matplotlib-2.1.0]     gcc -pthread -shared -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib -L/home/dima/Sage/sage-dev/local/lib -Wl,-rpath,/home/dima/Sage/sage-dev/local/lib build/temp.linux-x86_64-2.7/src/qhull_wrap.o -L/home/dima/Sage/sage-dev/local/lib -L/home/dima/Sage/sage-dev/local/lib64 -L/home/dima/Sage/sage-dev/local/lib -lqhull -lpython2.7 -o build/lib.linux-x86_64-2.7/matplotlib/_qhull.so
[matplotlib-2.1.0]     /usr/lib/gcc/x86_64-pc-linux-gnu/6.3.0/../../../../x86_64-pc-linux-gnu/bin/ld: cannot find -lqhull
[matplotlib-2.1.0]     collect2: error: ld returned 1 exit status
```



---

archive/issue_comments_359313.json:
```json
{
    "body": "<a id='comment:33'></a>\nOk, it should build its own included copy. More details please! At the beginning of the log there should be a configuration summary before it starts building proper, can you post that?",
    "created_at": "2017-11-07T23:25:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359313",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>
Ok, it should build its own included copy. More details please! At the beginning of the log there should be a configuration summary before it starts building proper, can you post that?



---

archive/issue_comments_359314.json:
```json
{
    "body": "<a id='comment:34'></a>\nThat being said while it build successfully here I think some extra dependencies will need to be added.",
    "created_at": "2017-11-07T23:29:38Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359314",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
That being said while it build successfully here I think some extra dependencies will need to be added.



---

archive/issue_comments_359315.json:
```json
{
    "body": "<a id='comment:35'></a>\nThat's what I have on in Sage:\n\n```\n$ ls -l local/lib/*qhull*\n-rw-r--r-- 1 dima dima 290024 Nov  7 23:15 local/lib/libqhullcpp.a\nlrwxrwxrwx 1 dima dima     19 Nov  7 23:15 local/lib/libqhull_r.so -> libqhull_r.so.7.2.0\n-rwxr-xr-x 1 dima dima 418128 Nov  7 23:15 local/lib/libqhull_r.so.7.2.0\n-rw-r--r-- 1 dima dima 627426 Nov  7 23:15 local/lib/libqhullstatic.a\n-rw-r--r-- 1 dima dima 618872 Nov  7 23:15 local/lib/libqhullstatic_r.a\n```\n\nCan one use that `libqhull_r` instead?\n\n\nNote that `qhull` is an optional package. However, why does one need an included copy?\nIs it a latest trend, include qhull everywhere (IIRC, scipy also builds its own copy...)? :-)\n\nhere is the config summary:\n\n```\n    REQUIRED DEPENDENCIES AND EXTENSIONS\n                     numpy: yes [version 1.13.3]\n                       six: yes [using six version 1.11.0]\n                  dateutil: yes [using dateutil version 2.5.3]\n    backports.functools_lru_cache: yes [backports.functools_lru_cache was not\n                            found. It is required forPython versions prior to\n                            3.2]\n              subprocess32: yes [subprocess32 was not found. It used  for Python\n                            versions prior to 3.2 to improves functionality on\n                            Linux and OSX]\n                      pytz: yes [using pytz version 2016.4]\n                    cycler: yes [using cycler version 0.10.0]\n                   tornado: yes [using tornado version 4.3]\n                 pyparsing: yes [using pyparsing version 2.1.5]\n                    libagg: yes [pkg-config information for 'libagg' could not\n                            be found. Using local copy.]\n                  freetype: yes [version 2.6.3]\n                       png: yes [version 1.6.29]\n                     qhull: yes [Using system Qhull (version unknown, no pkg-\n                            config info)]\n```\n\nby the way, I just installed a systemwide qhull (on gentoo), and the build works --- although that's not what we want here I suppose...",
    "created_at": "2017-11-07T23:32:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359315",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
That's what I have on in Sage:

```
$ ls -l local/lib/*qhull*
-rw-r--r-- 1 dima dima 290024 Nov  7 23:15 local/lib/libqhullcpp.a
lrwxrwxrwx 1 dima dima     19 Nov  7 23:15 local/lib/libqhull_r.so -> libqhull_r.so.7.2.0
-rwxr-xr-x 1 dima dima 418128 Nov  7 23:15 local/lib/libqhull_r.so.7.2.0
-rw-r--r-- 1 dima dima 627426 Nov  7 23:15 local/lib/libqhullstatic.a
-rw-r--r-- 1 dima dima 618872 Nov  7 23:15 local/lib/libqhullstatic_r.a
```

Can one use that `libqhull_r` instead?


Note that `qhull` is an optional package. However, why does one need an included copy?
Is it a latest trend, include qhull everywhere (IIRC, scipy also builds its own copy...)? :-)

here is the config summary:

```
    REQUIRED DEPENDENCIES AND EXTENSIONS
                     numpy: yes [version 1.13.3]
                       six: yes [using six version 1.11.0]
                  dateutil: yes [using dateutil version 2.5.3]
    backports.functools_lru_cache: yes [backports.functools_lru_cache was not
                            found. It is required forPython versions prior to
                            3.2]
              subprocess32: yes [subprocess32 was not found. It used  for Python
                            versions prior to 3.2 to improves functionality on
                            Linux and OSX]
                      pytz: yes [using pytz version 2016.4]
                    cycler: yes [using cycler version 0.10.0]
                   tornado: yes [using tornado version 4.3]
                 pyparsing: yes [using pyparsing version 2.1.5]
                    libagg: yes [pkg-config information for 'libagg' could not
                            be found. Using local copy.]
                  freetype: yes [version 2.6.3]
                       png: yes [version 1.6.29]
                     qhull: yes [Using system Qhull (version unknown, no pkg-
                            config info)]
```

by the way, I just installed a systemwide qhull (on gentoo), and the build works --- although that's not what we want here I suppose...



---

archive/issue_comments_359316.json:
```json
{
    "body": "<a id='comment:36'></a>\nThat's not the latest trend. sage has not been in the habit of unbundling as much as possible unlike some distros. For scipy my experience in gentoo is worse. We tried unbundling some dependencies only to find they were not \"pure\", i.e. scipy had introduced stuff in the code to help hook it up.\n\nIn your case it looks like the sage optional qhull package may need updating or upgrading. I'll look into that latter. I suggest we make a separate ticket for it and depend on it here.",
    "created_at": "2017-11-07T23:38:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359316",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>
That's not the latest trend. sage has not been in the habit of unbundling as much as possible unlike some distros. For scipy my experience in gentoo is worse. We tried unbundling some dependencies only to find they were not "pure", i.e. scipy had introduced stuff in the code to help hook it up.

In your case it looks like the sage optional qhull package may need updating or upgrading. I'll look into that latter. I suggest we make a separate ticket for it and depend on it here.



---

archive/issue_comments_359317.json:
```json
{
    "body": "<a id='comment:37'></a>\nto complete building Sage I also needed to do\n\n```\n./sage --pip install backports.functools_lru_cache\n```",
    "created_at": "2017-11-07T23:45:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359317",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>
to complete building Sage I also needed to do

```
./sage --pip install backports.functools_lru_cache
```



---

archive/issue_comments_359318.json:
```json
{
    "body": "<a id='comment:38'></a>\nYes, as I was mentioning there will need dependencies added.\n\nTo go back to qhull, the fact that it works once you install it system wide probably point to a bug in matplotlib's build system. Definitely more stuff to look at.",
    "created_at": "2017-11-08T00:17:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359318",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>
Yes, as I was mentioning there will need dependencies added.

To go back to qhull, the fact that it works once you install it system wide probably point to a bug in matplotlib's build system. Definitely more stuff to look at.



---

archive/issue_comments_359319.json:
```json
{
    "body": "<a id='comment:39'></a>\nNope, I must be wrong on qhull. Why does the spkg doesn't install `libqhull.so`? Because we use a basic (patched) makefile instead of using cmake to configure, build and install.\n\nMinimum fix producing `libqhull.so` or write a .pc file so `libqhull_r.so` is used. We could do a link or write a file from `spkg-install`. What is your preferred solution?",
    "created_at": "2017-11-08T00:38:44Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359319",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
Nope, I must be wrong on qhull. Why does the spkg doesn't install `libqhull.so`? Because we use a basic (patched) makefile instead of using cmake to configure, build and install.

Minimum fix producing `libqhull.so` or write a .pc file so `libqhull_r.so` is used. We could do a link or write a file from `spkg-install`. What is your preferred solution?



---

archive/issue_comments_359320.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215\">496ded5</a></td><td><code>add backports_functools_lru_cache a new dependency of MPL. Fix MPL 2.1.0 dependencies.</code></td></tr></table>\n",
    "created_at": "2017-11-08T00:55:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215">496ded5</a></td><td><code>add backports_functools_lru_cache a new dependency of MPL. Fix MPL 2.1.0 dependencies.</code></td></tr></table>




---

archive/issue_comments_359321.json:
```json
{
    "body": "**Changing commit** from \"[6a0510f35a19f907a719edb832c80dc8ecf6ffea](https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea)\" to \"[496ded5808d15c7d1830ca9662082d448a994215](https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215)\".",
    "created_at": "2017-11-08T00:55:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6a0510f35a19f907a719edb832c80dc8ecf6ffea](https://github.com/sagemath/sagetrac-mirror/commit/6a0510f35a19f907a719edb832c80dc8ecf6ffea)" to "[496ded5808d15c7d1830ca9662082d448a994215](https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215)".



---

archive/issue_comments_359322.json:
```json
{
    "body": "<a id='comment:41'></a>\nApart from the issues of qhull this should be all for the dependencies.",
    "created_at": "2017-11-08T00:56:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359322",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
Apart from the issues of qhull this should be all for the dependencies.



---

archive/issue_comments_359323.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n It's time we update; Debian already uses matplotlib 2.0.0\n \n-Tarball:\n+Tarballs:\n * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)\n+* [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)\n``````\n",
    "created_at": "2017-11-08T00:56:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359323",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
 It's time we update; Debian already uses matplotlib 2.0.0
 
-Tarball:
+Tarballs:
 * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)
+* [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)
``````




---

archive/issue_comments_359324.json:
```json
{
    "body": "<a id='comment:42'></a>\nAny obvious reason why this should be failing\n\n```\nDownload error on https://pypi.python.org/simple/setuptools_scm/: [Errno 113] No route to host -- Some packages may not be found!\nDownload error on https://pypi.python.org/simple/setuptools-scm/: [Errno 113] No route to host -- Some packages may not be found!\nDownload error on https://pypi.python.org/simple/: [Errno 110] Connection timed out -- Some packages may not be found!\nNo local packages or working download links found for setuptools_scm>=1.15.0\n```\nThe route looks good to me.",
    "created_at": "2017-11-08T01:32:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359324",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:42'></a>
Any obvious reason why this should be failing

```
Download error on https://pypi.python.org/simple/setuptools_scm/: [Errno 113] No route to host -- Some packages may not be found!
Download error on https://pypi.python.org/simple/setuptools-scm/: [Errno 113] No route to host -- Some packages may not be found!
Download error on https://pypi.python.org/simple/: [Errno 110] Connection timed out -- Some packages may not be found!
No local packages or working download links found for setuptools_scm>=1.15.0
```
The route looks good to me.



---

archive/issue_comments_359325.json:
```json
{
    "body": "<a id='comment:43'></a>\nTo get this to work here I had to modify the existing `setuptools_scm` package, download `setuptools_scm-1.15.6.tar.gz` and install it manually.",
    "created_at": "2017-11-08T04:11:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359325",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:43'></a>
To get this to work here I had to modify the existing `setuptools_scm` package, download `setuptools_scm-1.15.6.tar.gz` and install it manually.



---

archive/issue_comments_359326.json:
```json
{
    "body": "<a id='comment:44'></a>\nI think sage runs pip in a way it cannot download stuff. That's probably an unhelpful message. How did I get the stuff to install properly when all these problems exist.\n\nTODO: update `setuptools_scm` in this ticket.",
    "created_at": "2017-11-08T04:30:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359326",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
I think sage runs pip in a way it cannot download stuff. That's probably an unhelpful message. How did I get the stuff to install properly when all these problems exist.

TODO: update `setuptools_scm` in this ticket.



---

archive/issue_events_210675.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-08T04:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210675"
}
```



---

archive/issue_events_210676.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-08T04:34:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210676"
}
```



---

archive/issue_comments_359327.json:
```json
{
    "body": "<a id='comment:45'></a>\nLet's add `subprocess32` I thought it was only optional from the message but it is probably better to have it.",
    "created_at": "2017-11-08T04:34:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359327",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
Let's add `subprocess32` I thought it was only optional from the message but it is probably better to have it.



---

archive/issue_comments_359328.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746\">f6a9e53</a></td><td><code>update setuptools_scm for matplotlib-2.1.0</code></td></tr></table>\n",
    "created_at": "2017-11-08T21:27:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746">f6a9e53</a></td><td><code>update setuptools_scm for matplotlib-2.1.0</code></td></tr></table>




---

archive/issue_comments_359329.json:
```json
{
    "body": "**Changing commit** from \"[496ded5808d15c7d1830ca9662082d448a994215](https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215)\" to \"[f6a9e539143095b1cd6a0e0ba762b850339d2746](https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746)\".",
    "created_at": "2017-11-08T21:27:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[496ded5808d15c7d1830ca9662082d448a994215](https://github.com/sagemath/sagetrac-mirror/commit/496ded5808d15c7d1830ca9662082d448a994215)" to "[f6a9e539143095b1cd6a0e0ba762b850339d2746](https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746)".



---

archive/issue_comments_359330.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f\">717c3da</a></td><td><code>Add subprocess32 as a dependency of MPL-2.1.0</code></td></tr></table>\n",
    "created_at": "2017-11-08T21:38:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f">717c3da</a></td><td><code>Add subprocess32 as a dependency of MPL-2.1.0</code></td></tr></table>




---

archive/issue_comments_359331.json:
```json
{
    "body": "**Changing commit** from \"[f6a9e539143095b1cd6a0e0ba762b850339d2746](https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746)\" to \"[717c3dad0ffd8aed76ba9dd7968c90c7a745252f](https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f)\".",
    "created_at": "2017-11-08T21:38:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f6a9e539143095b1cd6a0e0ba762b850339d2746](https://github.com/sagemath/sagetrac-mirror/commit/f6a9e539143095b1cd6a0e0ba762b850339d2746)" to "[717c3dad0ffd8aed76ba9dd7968c90c7a745252f](https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f)".



---

archive/issue_comments_359332.json:
```json
{
    "body": "<a id='comment:48'></a>\nThere! Apart from the qhull issue that we should tackle separately, this is ready I believe.",
    "created_at": "2017-11-08T21:40:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359332",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>
There! Apart from the qhull issue that we should tackle separately, this is ready I believe.



---

archive/issue_events_210677.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-08T21:40:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210677"
}
```



---

archive/issue_events_210678.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-08T21:40:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210678"
}
```



---

archive/issue_comments_359333.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n Tarballs:\n * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)\n * [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)\n+* [https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz](https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz)\n+* [http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz](http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz)\n``````\n",
    "created_at": "2017-11-08T21:40:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359333",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 Tarballs:
 * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)
 * [https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz](https://pypi.python.org/packages/4e/91/0e93d9455254b7b630fb3ebe30cc57cab518660c5fad6a08aac7908a4431/backports.functools_lru_cache-1.4.tar.gz)
+* [https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz](https://pypi.python.org/packages/03/6d/aafdd01edd227ee879b691455bf19895091872af7e48192bea1758c82032/setuptools_scm-1.15.6.tar.gz)
+* [http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz](http://ftp.swin.edu.au/gentoo/distfiles/subprocess32-3.2.7.tar.gz)
``````




---

archive/issue_comments_359334.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-It's time we update; Debian already uses matplotlib 2.0.0\n+It's time we update; Debian already uses matplotlib 2.0.0.\n+\n+For matplotlib 2.1.0 we need to update `setuptools_scm` and two new dependencies `backports.functools_lru_cache` and `subprocess32`.\n \n Tarballs:\n * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)\n``````\n",
    "created_at": "2017-11-08T21:42:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359334",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-It's time we update; Debian already uses matplotlib 2.0.0
+It's time we update; Debian already uses matplotlib 2.0.0.
+
+For matplotlib 2.1.0 we need to update `setuptools_scm` and two new dependencies `backports.functools_lru_cache` and `subprocess32`.
 
 Tarballs:
 * [http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2](http://sagetrac.lipn.univ-paris13.fr/sage/matplotlib-2.1.0.tar.bz2)
``````




---

archive/issue_comments_359335.json:
```json
{
    "body": "<a id='comment:50'></a>\nIn doctesting I see two of\n\n```\nUserWarning: Attempted to set non-positive ylimits for log-scale axis; invalid limits will be ignored.\n```\nin `src/sage/plot/plot.py` which I haven't investigated. There is also numerous\n\n```\nUserWarning: The following kwargs were not used by contour: 'label'\n```\nwhere it appears that extra arguments in Sage calling functions (`src/sage/plot/graphics.py` has such a function) are incompatible with allowed extra arguments is `matplotlib` functions. This incompatibility has probably been around for some time but is now exposed by the addition of\n\n```\n        if kwargs:\n            s = \", \".join(map(repr, kwargs))\n            warnings.warn('The following kwargs were not used by contour: ' +\n                          s)\n```\nin `matplotlib/contour.py` that prints the warning. If I remove the extra arguments for the Sage function calls, I don't get the warnings. This should all probably be revised/updated in some ticket.",
    "created_at": "2017-11-08T23:19:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359335",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:50'></a>
In doctesting I see two of

```
UserWarning: Attempted to set non-positive ylimits for log-scale axis; invalid limits will be ignored.
```
in `src/sage/plot/plot.py` which I haven't investigated. There is also numerous

```
UserWarning: The following kwargs were not used by contour: 'label'
```
where it appears that extra arguments in Sage calling functions (`src/sage/plot/graphics.py` has such a function) are incompatible with allowed extra arguments is `matplotlib` functions. This incompatibility has probably been around for some time but is now exposed by the addition of

```
        if kwargs:
            s = ", ".join(map(repr, kwargs))
            warnings.warn('The following kwargs were not used by contour: ' +
                          s)
```
in `matplotlib/contour.py` that prints the warning. If I remove the extra arguments for the Sage function calls, I don't get the warnings. This should all probably be revised/updated in some ticket.



---

archive/issue_comments_359336.json:
```json
{
    "body": "<a id='comment:51'></a>\nOk, all our previous debugging was done on MPL-2.0.2 so it is fair that new things show up in 2.1.0. I should have done a doctest run.",
    "created_at": "2017-11-08T23:21:51Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359336",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>
Ok, all our previous debugging was done on MPL-2.0.2 so it is fair that new things show up in 2.1.0. I should have done a doctest run.



---

archive/issue_comments_359337.json:
```json
{
    "body": "<a id='comment:52'></a>\nAnd there is `ImportError: cannot import name delaunay` in for example `src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst`. Delaunay may be gone. I remember something about `delaunay` deprecation issues in the past.",
    "created_at": "2017-11-08T23:25:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359337",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:52'></a>
And there is `ImportError: cannot import name delaunay` in for example `src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst`. Delaunay may be gone. I remember something about `delaunay` deprecation issues in the past.



---

archive/issue_comments_359338.json:
```json
{
    "body": "<a id='comment:53'></a>\nOh yes dear `delaunay` that I tried to replace only to find nothing else was like it. Was MPL-1.3 or 1.4? We''ll have to see if there is something it can be replaced with.",
    "created_at": "2017-11-08T23:29:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359338",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>
Oh yes dear `delaunay` that I tried to replace only to find nothing else was like it. Was MPL-1.3 or 1.4? We''ll have to see if there is something it can be replaced with.



---

archive/issue_comments_359339.json:
```json
{
    "body": "<a id='comment:54'></a>\nOK in sage/plot.py` we have instances of semilog (one) and log-log (one) graph where a log axis start at 0. This is in listplot function where, if not provided, the index starts at 0 - a problem on a log scale. I will re-work those examples to have indices starting from 1.\n\nIn `sage/plot/graphics.py` one warning\n\n```\nMatplotlibDeprecationWarning: The set_linestyle function was deprecated in version 2.1.\n```\nWill need to dig. Also in `sage/graphs/generic_graph.py`, `sage/manifolds/differentiable/vectorfield.py`, `sage/manifolds/differentiable/tangent_vector.py`, `sage/combinat/posets/posets.py`, `sage/plot/arrow.py`, \n\nwill be fun to fix\n\n```\ngrep -rI set_linestyle src/sage/*\nsrc/sage/plot/ellipse.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],return_type='long'))\nsrc/sage/plot/arrow.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))\nsrc/sage/plot/arrow.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))\nsrc/sage/plot/circle.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],return_type='long'))\nsrc/sage/plot/arc.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],\nsrc/sage/plot/bezier_path.py:        bpatch.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))\nsrc/sage/plot/line.py:            p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],\n```\n\nIn `sage/plot/plot3d/list_plot3d.py` we have `delaunay` failures (13)\n\n```\n        from matplotlib import tri, delaunay\n    ImportError: cannot import name delaunay\n```\nalso in `sage/stats/distributions/discrete_gaussian_lattice.py`, `en/thematic_tutorials/_sources/explicit_methods_in_number_theory/introduction.rst`\n\nIn `sage/plot/arrow.py` strange deprecation warning to investigate\n\n```\n    MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.\n```\n\nIn `sage/plot/arc.py`\n\n```\nsage -t --long --warn-long 89.4 /usr/lib64/python2.7/site-packages/sage/plot/arc.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/plot/arc.py\", line 299, in sage.plot.arc.Arc.bezier_path\nFailed example:\n    b[0]\nExpected:\n    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)\nGot:\n    Bezier path from (0.0, -1.0) to (0.0, -1.0)\n**********************************************************************\n```\n\nIn `sage/probability/probability_distribution.pyx`\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx\", line 121, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data\nFailed example:\n    h\nExpected:\n    [1.6299999999999999,\n     0.0,\n     0.0,\n     0.0,\n     0.0,\n     1.9049999999999985,\n     0.0,\n     0.0,\n     0.0,\n     1.4650000000000003]\nGot:\n    [1.6300000000000003,\n     0.0,\n     0.0,\n     0.0,\n     0.0,\n     1.9049999999999976,\n     0.0,\n     0.0,\n     0.0,\n     1.4650000000000012]\n**********************************************************************\n```\nThe last two are curious. I am noting them but deem them suspicious until further notice.",
    "created_at": "2017-11-09T01:26:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359339",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:54'></a>
OK in sage/plot.py` we have instances of semilog (one) and log-log (one) graph where a log axis start at 0. This is in listplot function where, if not provided, the index starts at 0 - a problem on a log scale. I will re-work those examples to have indices starting from 1.

In `sage/plot/graphics.py` one warning

```
MatplotlibDeprecationWarning: The set_linestyle function was deprecated in version 2.1.
```
Will need to dig. Also in `sage/graphs/generic_graph.py`, `sage/manifolds/differentiable/vectorfield.py`, `sage/manifolds/differentiable/tangent_vector.py`, `sage/combinat/posets/posets.py`, `sage/plot/arrow.py`, 

will be fun to fix

```
grep -rI set_linestyle src/sage/*
src/sage/plot/ellipse.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],return_type='long'))
src/sage/plot/arrow.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))
src/sage/plot/arrow.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))
src/sage/plot/circle.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],return_type='long'))
src/sage/plot/arc.py:        p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],
src/sage/plot/bezier_path.py:        bpatch.set_linestyle(get_matplotlib_linestyle(options['linestyle'], return_type='long'))
src/sage/plot/line.py:            p.set_linestyle(get_matplotlib_linestyle(options['linestyle'],
```

In `sage/plot/plot3d/list_plot3d.py` we have `delaunay` failures (13)

```
        from matplotlib import tri, delaunay
    ImportError: cannot import name delaunay
```
also in `sage/stats/distributions/discrete_gaussian_lattice.py`, `en/thematic_tutorials/_sources/explicit_methods_in_number_theory/introduction.rst`

In `sage/plot/arrow.py` strange deprecation warning to investigate

```
    MatplotlibDeprecationWarning: Adding an axes using the same arguments as a previous axes currently reuses the earlier instance.  In a future version, a new instance will always be created and returned.  Meanwhile, this warning can be suppressed, and the future behavior ensured, by passing a unique label to each axes instance.
```

In `sage/plot/arc.py`

```
sage -t --long --warn-long 89.4 /usr/lib64/python2.7/site-packages/sage/plot/arc.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/plot/arc.py", line 299, in sage.plot.arc.Arc.bezier_path
Failed example:
    b[0]
Expected:
    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)
Got:
    Bezier path from (0.0, -1.0) to (0.0, -1.0)
**********************************************************************
```

In `sage/probability/probability_distribution.pyx`

```
File "/usr/lib64/python2.7/site-packages/sage/probability/probability_distribution.pyx", line 121, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data
Failed example:
    h
Expected:
    [1.6299999999999999,
     0.0,
     0.0,
     0.0,
     0.0,
     1.9049999999999985,
     0.0,
     0.0,
     0.0,
     1.4650000000000003]
Got:
    [1.6300000000000003,
     0.0,
     0.0,
     0.0,
     0.0,
     1.9049999999999976,
     0.0,
     0.0,
     0.0,
     1.4650000000000012]
**********************************************************************
```
The last two are curious. I am noting them but deem them suspicious until further notice.



---

archive/issue_events_210679.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-09T01:26:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210679"
}
```



---

archive/issue_events_210680.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-11-09T01:26:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210680"
}
```



---

archive/issue_comments_359340.json:
```json
{
    "body": "<a id='comment:55'></a>\nThis `set_linestyle` business is I believe what manifested itself with the `arrow.py` failure with version `2.0.2` and now throws a `MatplotlibDeprecationWarning` in other locations.",
    "created_at": "2017-11-09T01:44:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359340",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:55'></a>
This `set_linestyle` business is I believe what manifested itself with the `arrow.py` failure with version `2.0.2` and now throws a `MatplotlibDeprecationWarning` in other locations.



---

archive/issue_comments_359341.json:
```json
{
    "body": "<a id='comment:56'></a>\nFun bit. The stuff `plot.py` with log plots is self inflicted. The example do it on purpose but MPL didn't display a user warning before.",
    "created_at": "2017-11-09T01:50:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359341",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>
Fun bit. The stuff `plot.py` with log plots is self inflicted. The example do it on purpose but MPL didn't display a user warning before.



---

archive/issue_comments_359342.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [strogdon](#comment%3A55):\n> This `set_linestyle` business is I believe what manifested itself with the `arrow.py` failure with version `2.0.2` and now throws a `MatplotlibDeprecationWarning` in other locations.\n\n\nAny idea has to what to use instead of `set_linestyle`? Or just skip it?",
    "created_at": "2017-11-09T02:02:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359342",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>
Replying to [strogdon](#comment%3A55):
> This `set_linestyle` business is I believe what manifested itself with the `arrow.py` failure with version `2.0.2` and now throws a `MatplotlibDeprecationWarning` in other locations.


Any idea has to what to use instead of `set_linestyle`? Or just skip it?



---

archive/issue_comments_359343.json:
```json
{
    "body": "**Changing commit** from \"[717c3dad0ffd8aed76ba9dd7968c90c7a745252f](https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f)\" to \"[3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a](https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a)\".",
    "created_at": "2017-11-09T02:13:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[717c3dad0ffd8aed76ba9dd7968c90c7a745252f](https://github.com/sagemath/sagetrac-mirror/commit/717c3dad0ffd8aed76ba9dd7968c90c7a745252f)" to "[3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a](https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a)".



---

archive/issue_comments_359344.json:
```json
{
    "body": "<a id='comment:58'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f4fed4b27411651ca9e2cb0608bd2bbe4fdec6e\">2f4fed4</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a\">3508ea3</a></td><td><code>Add new user warnings in the expected output of a couple of tests</code></td></tr></table>\n",
    "created_at": "2017-11-09T02:13:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f4fed4b27411651ca9e2cb0608bd2bbe4fdec6e">2f4fed4</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a">3508ea3</a></td><td><code>Add new user warnings in the expected output of a couple of tests</code></td></tr></table>




---

archive/issue_comments_359345.json:
```json
{
    "body": "<a id='comment:59'></a>\nLooks like you have to use a `linestyle` option in the object definition rather than setting it with a method. It will take a bit of time to sort all of them but I think I have the idea.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f4fed4b27411651ca9e2cb0608bd2bbe4fdec6e\">2f4fed4</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a\">3508ea3</a></td><td><code>Add new user warnings in the expected output of a couple of tests</code></td></tr></table>\n",
    "created_at": "2017-11-09T02:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359345",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:59'></a>
Looks like you have to use a `linestyle` option in the object definition rather than setting it with a method. It will take a bit of time to sort all of them but I think I have the idea.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f4fed4b27411651ca9e2cb0608bd2bbe4fdec6e">2f4fed4</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a">3508ea3</a></td><td><code>Add new user warnings in the expected output of a couple of tests</code></td></tr></table>




---

archive/issue_comments_359346.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [fbissey](#comment%3A54):\n> \n> In `sage/plot/graphics.py` one warning\n> \n> ```\n> MatplotlibDeprecationWarning: The set_linestyle function was deprecated in version 2.1.\n> ```\n\nI don't get this in `graphics.py`. The only warning here is\n\n```\nsage -t --long src/sage/plot/graphics.py\n**********************************************************************\nFile \"src/sage/plot/graphics.py\", line 1713, in sage.plot.graphics.Graphics.show\nFailed example:\n    p.show(gridlines=[[1,0],[-1,0,1]])\nExpected nothing\nGot:\n    doctest:warning\n...\n    UserWarning: The following kwargs were not used by contour: 'label'\n```",
    "created_at": "2017-11-09T04:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359346",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:60'></a>
Replying to [fbissey](#comment%3A54):
> 
> In `sage/plot/graphics.py` one warning
> 
> ```
> MatplotlibDeprecationWarning: The set_linestyle function was deprecated in version 2.1.
> ```

I don't get this in `graphics.py`. The only warning here is

```
sage -t --long src/sage/plot/graphics.py
**********************************************************************
File "src/sage/plot/graphics.py", line 1713, in sage.plot.graphics.Graphics.show
Failed example:
    p.show(gridlines=[[1,0],[-1,0,1]])
Expected nothing
Got:
    doctest:warning
...
    UserWarning: The following kwargs were not used by contour: 'label'
```



---

archive/issue_comments_359347.json:
```json
{
    "body": "<a id='comment:61'></a>\nI need to do a new fresh build.",
    "created_at": "2017-11-09T05:02:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359347",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:61'></a>
I need to do a new fresh build.



---

archive/issue_comments_359348.json:
```json
{
    "body": "<a id='comment:62'></a>\nsage-on-gentoo with `matplotlib-2.1.0` does give the `MatplotlibDeprecationWarning` but not the `UserWarning`. So there are some odd differences.",
    "created_at": "2017-11-09T05:13:41Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359348",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:62'></a>
sage-on-gentoo with `matplotlib-2.1.0` does give the `MatplotlibDeprecationWarning` but not the `UserWarning`. So there are some odd differences.



---

archive/issue_comments_359349.json:
```json
{
    "body": "<a id='comment:63'></a>\nI see `matplotlib` is in CDEPEND, so maybe that's it.",
    "created_at": "2017-11-09T05:17:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359349",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:63'></a>
I see `matplotlib` is in CDEPEND, so maybe that's it.



---

archive/issue_comments_359350.json:
```json
{
    "body": "<a id='comment:64'></a>\nIt looks like I may something to migrate `delaunay` to. It looks like the default triangulation is delaunay now.",
    "created_at": "2017-11-09T06:54:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359350",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:64'></a>
It looks like I may something to migrate `delaunay` to. It looks like the default triangulation is delaunay now.



---

archive/issue_comments_359351.json:
```json
{
    "body": "<a id='comment:65'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2902b626d0cb27fd842bebdfca89ef4fd6ae152c\">2902b62</a></td><td><code>WIP: replace deprecated set_linestyle</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983\">e4d8039</a></td><td><code>better (correct) fix for userwarnings in plot.py</code></td></tr></table>\n",
    "created_at": "2017-11-09T20:34:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2902b626d0cb27fd842bebdfca89ef4fd6ae152c">2902b62</a></td><td><code>WIP: replace deprecated set_linestyle</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983">e4d8039</a></td><td><code>better (correct) fix for userwarnings in plot.py</code></td></tr></table>




---

archive/issue_comments_359352.json:
```json
{
    "body": "**Changing commit** from \"[3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a](https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a)\" to \"[e4d80390bfd6dc56e102623aa055bc64b8b1c983](https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983)\".",
    "created_at": "2017-11-09T20:34:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a](https://github.com/sagemath/sagetrac-mirror/commit/3508ea33211cc1eb1dff07f4fb4f2fb1fbe9c52a)" to "[e4d80390bfd6dc56e102623aa055bc64b8b1c983](https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983)".



---

archive/issue_comments_359353.json:
```json
{
    "body": "<a id='comment:66'></a>\nWe need a \"specialist\" that knows what `bezier_path` is supposed to do. The change in behavior in `arc.py` is huge. We have gone from `bezier_path` drawing arcs to drawing full ellipses.",
    "created_at": "2017-11-09T20:49:10Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359353",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:66'></a>
We need a "specialist" that knows what `bezier_path` is supposed to do. The change in behavior in `arc.py` is huge. We have gone from `bezier_path` drawing arcs to drawing full ellipses.



---

archive/issue_comments_359354.json:
```json
{
    "body": "<a id='comment:67'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82\">7c028ad</a></td><td><code>easy fix</code></td></tr></table>\n",
    "created_at": "2017-11-09T20:53:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:67'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82">7c028ad</a></td><td><code>easy fix</code></td></tr></table>




---

archive/issue_comments_359355.json:
```json
{
    "body": "**Changing commit** from \"[e4d80390bfd6dc56e102623aa055bc64b8b1c983](https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983)\" to \"[7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82](https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82)\".",
    "created_at": "2017-11-09T20:53:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e4d80390bfd6dc56e102623aa055bc64b8b1c983](https://github.com/sagemath/sagetrac-mirror/commit/e4d80390bfd6dc56e102623aa055bc64b8b1c983)" to "[7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82](https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82)".



---

archive/issue_comments_359356.json:
```json
{
    "body": "<a id='comment:68'></a>\nOK the `UserWarning: The following kwargs were not used by contour: 'label'` can be easily fixed in and of itself, the problem is that it is looks like the tip of the iceberg of some stuff that receives little testing. inside `contour_plot.py`.\n\nSome stuff in there about labels is rotting.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82\">7c028ad</a></td><td><code>easy fix</code></td></tr></table>\n",
    "created_at": "2017-11-09T21:56:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359356",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:68'></a>
OK the `UserWarning: The following kwargs were not used by contour: 'label'` can be easily fixed in and of itself, the problem is that it is looks like the tip of the iceberg of some stuff that receives little testing. inside `contour_plot.py`.

Some stuff in there about labels is rotting.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82">7c028ad</a></td><td><code>easy fix</code></td></tr></table>




---

archive/issue_comments_359357.json:
```json
{
    "body": "**Changing commit** from \"[7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82](https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82)\" to \"[5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4](https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4)\".",
    "created_at": "2017-11-09T22:00:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82](https://github.com/sagemath/sagetrac-mirror/commit/7c028ad5ffaa40fa5333b40d43b0d3d0f547dd82)" to "[5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4](https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4)".



---

archive/issue_comments_359358.json:
```json
{
    "body": "<a id='comment:69'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4\">5d27a24</a></td><td><code>contour and contourf from matplotlib do not have a \"label\" keyword argument. The whole handling of labelling and legends may need a spruce up.</code></td></tr></table>\n",
    "created_at": "2017-11-09T22:00:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4">5d27a24</a></td><td><code>contour and contourf from matplotlib do not have a "label" keyword argument. The whole handling of labelling and legends may need a spruce up.</code></td></tr></table>




---

archive/issue_comments_359359.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [git](#comment%3A69):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4\">5d27a24</a></td><td><code>contour and contourf from matplotlib do not have a \"label\" keyword argument. The whole handling of labelling and legends may need a spruce up.</code></td></tr></table>\n\nYes, I believe this is what I did to get rid of the the `label` warnings. And yes something is really wrong inside `contour_plot.py`. There is stuff there not consistent with even `matplotlib-1.5.1`, which someone needs to fix.\n\nI'm curious, even though I think the `set_linestyle` needs to be addressed, I've never gotten a warning about it's use, that is with vanilla Sage.",
    "created_at": "2017-11-09T22:11:44Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359359",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:70'></a>
Replying to [git](#comment%3A69):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4">5d27a24</a></td><td><code>contour and contourf from matplotlib do not have a "label" keyword argument. The whole handling of labelling and legends may need a spruce up.</code></td></tr></table>

Yes, I believe this is what I did to get rid of the the `label` warnings. And yes something is really wrong inside `contour_plot.py`. There is stuff there not consistent with even `matplotlib-1.5.1`, which someone needs to fix.

I'm curious, even though I think the `set_linestyle` needs to be addressed, I've never gotten a warning about it's use, that is with vanilla Sage.



---

archive/issue_comments_359360.json:
```json
{
    "body": "<a id='comment:71'></a>\nThere are certainly inconsistencies between vanilla and gentoo but I am not completely sure why yet.\n\nI think I got the `set_linestyle` that triggered the warnings but there are other all over the place. And I am not sure if there is still a function for that particular object or if it isn't tested. I added a `linestyle` argument to particular test and it didn't result in a warning so some objects haven't deprecated it yet. \n\nI am puzzled by the stuff about axes being re-used. Re-used from where? I guess even if it isn't re-used it is about it needing some label. I have a feeling that it is MPL's fault rather than sage's fault.\n\nThe next biggie is `delaunay`. I may well not have it under control until Monday (cross finger I can do something about it).",
    "created_at": "2017-11-09T22:19:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359360",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:71'></a>
There are certainly inconsistencies between vanilla and gentoo but I am not completely sure why yet.

I think I got the `set_linestyle` that triggered the warnings but there are other all over the place. And I am not sure if there is still a function for that particular object or if it isn't tested. I added a `linestyle` argument to particular test and it didn't result in a warning so some objects haven't deprecated it yet. 

I am puzzled by the stuff about axes being re-used. Re-used from where? I guess even if it isn't re-used it is about it needing some label. I have a feeling that it is MPL's fault rather than sage's fault.

The next biggie is `delaunay`. I may well not have it under control until Monday (cross finger I can do something about it).



---

archive/issue_comments_359361.json:
```json
{
    "body": "<a id='comment:72'></a>\nI have taken a look at `delaunay`. It's going to take some doing. In particular I can find no `natural neighbor (nn)` or `spline` options in the present `triangulation`. Or anything that would replicate what's presently done. But it may be hidden there somewhere.",
    "created_at": "2017-11-09T22:30:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359361",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:72'></a>
I have taken a look at `delaunay`. It's going to take some doing. In particular I can find no `natural neighbor (nn)` or `spline` options in the present `triangulation`. Or anything that would replicate what's presently done. But it may be hidden there somewhere.



---

archive/issue_comments_359362.json:
```json
{
    "body": "<a id='comment:73'></a>\nFor the record at this point in time with this branch\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 73.7 src/sage/stats/distributions/discrete_gaussian_lattice.py  # 1 doctest failed\nsage -t --long --warn-long 73.7 src/sage/plot/arrow.py  # 1 doctest failed\nsage -t --long --warn-long 73.7 src/sage/plot/plot3d/list_plot3d.py  # 13 doctests failed\nsage -t --long --warn-long 73.7 src/sage/plot/arc.py  # 1 doctest failed\nsage -t --long --warn-long 73.7 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst  # 1 doctest failed\n----------------------------------------------------------------------\n```\n17 doctest failures. 15 are failure to import delaunay and the other two are unique.",
    "created_at": "2017-11-10T00:52:44Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359362",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:73'></a>
For the record at this point in time with this branch

```
----------------------------------------------------------------------
sage -t --long --warn-long 73.7 src/sage/stats/distributions/discrete_gaussian_lattice.py  # 1 doctest failed
sage -t --long --warn-long 73.7 src/sage/plot/arrow.py  # 1 doctest failed
sage -t --long --warn-long 73.7 src/sage/plot/plot3d/list_plot3d.py  # 13 doctests failed
sage -t --long --warn-long 73.7 src/sage/plot/arc.py  # 1 doctest failed
sage -t --long --warn-long 73.7 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst  # 1 doctest failed
----------------------------------------------------------------------
```
17 doctest failures. 15 are failure to import delaunay and the other two are unique.



---

archive/issue_comments_359363.json:
```json
{
    "body": "<a id='comment:74'></a>\nThis removes the `MatplotlibDeprecationWarning` in the `src/sage/plot/arrow.py` doctest\n\n```\ndiff --git a/src/sage/plot/arrow.py b/src/sage/plot/arrow.py\nindex 2b293f17ca..fbce029306 100644\n--- a/src/sage/plot/arrow.py\n+++ b/src/sage/plot/arrow.py\n@@ -336,7 +336,7 @@ class Arrow(GraphicPrimitive):\n         this into account. See :trac:`12836`::\n \n             sage: fig = Graphics().matplotlib()\n-            sage: sp = fig.add_subplot(1,1,1)\n+            sage: sp = fig.add_subplot(1,1,1, label='axis1')\n             sage: a = arrow((0,0), (1,1))\n             sage: b = arrow((0,0), (1,1), width=20)\n             sage: p1 = a[0]._render_on_subplot(sp)\n```",
    "created_at": "2017-11-10T01:58:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359363",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:74'></a>
This removes the `MatplotlibDeprecationWarning` in the `src/sage/plot/arrow.py` doctest

```
diff --git a/src/sage/plot/arrow.py b/src/sage/plot/arrow.py
index 2b293f17ca..fbce029306 100644
--- a/src/sage/plot/arrow.py
+++ b/src/sage/plot/arrow.py
@@ -336,7 +336,7 @@ class Arrow(GraphicPrimitive):
         this into account. See :trac:`12836`::
 
             sage: fig = Graphics().matplotlib()
-            sage: sp = fig.add_subplot(1,1,1)
+            sage: sp = fig.add_subplot(1,1,1, label='axis1')
             sage: a = arrow((0,0), (1,1))
             sage: b = arrow((0,0), (1,1), width=20)
             sage: p1 = a[0]._render_on_subplot(sp)
```



---

archive/issue_comments_359364.json:
```json
{
    "body": "<a id='comment:75'></a>\nHumpf, use `label` here, `label` doesn't exist there, can't they make up their mind.",
    "created_at": "2017-11-10T08:52:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359364",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:75'></a>
Humpf, use `label` here, `label` doesn't exist there, can't they make up their mind.



---

archive/issue_comments_359365.json:
```json
{
    "body": "<a id='comment:76'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437\">87b33cf</a></td><td><code>supress last warning in arrow.py by adding a label in the right place</code></td></tr></table>\n",
    "created_at": "2017-11-10T09:16:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359365",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437">87b33cf</a></td><td><code>supress last warning in arrow.py by adding a label in the right place</code></td></tr></table>




---

archive/issue_comments_359366.json:
```json
{
    "body": "**Changing commit** from \"[5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4](https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4)\" to \"[87b33cf3f2cf959e161c857decc2be47ab824437](https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437)\".",
    "created_at": "2017-11-10T09:16:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4](https://github.com/sagemath/sagetrac-mirror/commit/5d27a242c7dfb8e8d7a9f6f030d07596e42ba5d4)" to "[87b33cf3f2cf959e161c857decc2be47ab824437](https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437)".



---

archive/issue_comments_359367.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [fbissey](#comment%3A75):\n> Humpf, use `label` here, `label` doesn't exist there, can't they make up their mind.\n\nThis is all very contorted (my opinion). Let's hope that the `fix` doesn't just cover up the real issue. But from Sage\n\n```\nsage: fig = Graphics().matplotlib()\nsage: sp = fig.add_subplot(1,1,1, label='axis1')\nsage: sp\n<matplotlib.axes._subplots.AxesSubplot object at 0x7f1648115110>\n```\nSo it would seem that `add_subplot` may call `add_axes` which then may require the `label`?",
    "created_at": "2017-11-10T16:39:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359367",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:78'></a>
Replying to [fbissey](#comment%3A75):
> Humpf, use `label` here, `label` doesn't exist there, can't they make up their mind.

This is all very contorted (my opinion). Let's hope that the `fix` doesn't just cover up the real issue. But from Sage

```
sage: fig = Graphics().matplotlib()
sage: sp = fig.add_subplot(1,1,1, label='axis1')
sage: sp
<matplotlib.axes._subplots.AxesSubplot object at 0x7f1648115110>
```
So it would seem that `add_subplot` may call `add_axes` which then may require the `label`?



---

archive/issue_comments_359368.json:
```json
{
    "body": "<a id='comment:79'></a>\nSounds like it. From the message given by MPL, that's clearly what they want you to do.",
    "created_at": "2017-11-10T19:44:07Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359368",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'></a>
Sounds like it. From the message given by MPL, that's clearly what they want you to do.



---

archive/issue_comments_359369.json:
```json
{
    "body": "<a id='comment:80'></a>\nTo deal with `delaunay` we could always taint MPL-2.1.0 (or have an optional package) with the `delaunay` stuff from MPL-2.0.2. I have tried this and it works. But yet another item to maintain.",
    "created_at": "2017-11-11T00:13:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359369",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:80'></a>
To deal with `delaunay` we could always taint MPL-2.1.0 (or have an optional package) with the `delaunay` stuff from MPL-2.0.2. I have tried this and it works. But yet another item to maintain.



---

archive/issue_comments_359370.json:
```json
{
    "body": "<a id='comment:81'></a>\nFrom the matplotlib commit\n\n```\n+Code Removal\n+````````````\n+\n+matplotlib.delaunay\n+-------------------\n+Remove the delaunay triangulation code which is now handled by Qhull\n+via ``matplotlib.tri``\n```\nSo I wonder if this is really correct?",
    "created_at": "2017-11-11T21:03:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359370",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:81'></a>
From the matplotlib commit

```
+Code Removal
+````````````
+
+matplotlib.delaunay
+-------------------
+Remove the delaunay triangulation code which is now handled by Qhull
+via ``matplotlib.tri``
```
So I wonder if this is really correct?



---

archive/issue_comments_359371.json:
```json
{
    "body": "<a id='comment:82'></a>\nThat's why I said I may have a migration path. This was definitely not the case when they first deprecated delaunay and I fought to find a replacement. So I am hopeful, but I am not working on that until tomorrow.",
    "created_at": "2017-11-11T21:53:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359371",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:82'></a>
That's why I said I may have a migration path. This was definitely not the case when they first deprecated delaunay and I fought to find a replacement. So I am hopeful, but I am not working on that until tomorrow.



---

archive/issue_comments_359372.json:
```json
{
    "body": "<a id='comment:83'></a>\nOK now I remember the problem is not the triangulation, it is the \"natural neighbor\" interpolation going away. Solutions to that:\n\n* get `delaunay` back (-1)\n* get someone else's code (0)\n* dropping \"nearest neighbor\" (0)\n\nThe last one wasn't very liked in #17618 2-3 years ago when upgrading to MPL-1.4.x. There is a couple of implementations floating around for natural neighbors. The original natgrid one that apparently has licensing issues, and I have seen at least another one with google but it may need a bit of work to \"steal\".",
    "created_at": "2017-11-12T22:14:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359372",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:83'></a>
OK now I remember the problem is not the triangulation, it is the "natural neighbor" interpolation going away. Solutions to that:

* get `delaunay` back (-1)
* get someone else's code (0)
* dropping "nearest neighbor" (0)

The last one wasn't very liked in #17618 2-3 years ago when upgrading to MPL-1.4.x. There is a couple of implementations floating around for natural neighbors. The original natgrid one that apparently has licensing issues, and I have seen at least another one with google but it may need a bit of work to "steal".



---

archive/issue_comments_359373.json:
```json
{
    "body": "<a id='comment:84'></a>\nPerhaps scipy  \n[here](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.NearestNDInterpolator.html#scipy.interpolate.NearestNDInterpolator) if one can figure out how to use it.",
    "created_at": "2017-11-13T02:52:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359373",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:84'></a>
Perhaps scipy  
[here](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.NearestNDInterpolator.html#scipy.interpolate.NearestNDInterpolator) if one can figure out how to use it.



---

archive/issue_comments_359374.json:
```json
{
    "body": "<a id='comment:85'></a>\nReplying to [strogdon](#comment%3A84):\n> Perhaps scipy  \n> [here](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.NearestNDInterpolator.html#scipy.interpolate.NearestNDInterpolator) if one can figure out how to use it.\n\n\nIt wasn't good enough in #17618, however there is one new option that may improve things. I will have to dig the old code of #17618 to do some experiments.",
    "created_at": "2017-11-13T04:09:45Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359374",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:85'></a>
Replying to [strogdon](#comment%3A84):
> Perhaps scipy  
> [here](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.NearestNDInterpolator.html#scipy.interpolate.NearestNDInterpolator) if one can figure out how to use it.


It wasn't good enough in #17618, however there is one new option that may improve things. I will have to dig the old code of #17618 to do some experiments.



---

archive/issue_comments_359375.json:
```json
{
    "body": "<a id='comment:86'></a>\nHa, forgotten the scipy stuff is \"nearest neighbor\", the stuff from delaunay is \"natural neighbor\" and they are definitely different things.\n\nAll that's available has already been tried during the upgrade to MPL 1.4. See https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8 for various way of coding things without delaunay. There is nothing available unless we adopt code from somewhere else or write our own :(",
    "created_at": "2017-11-14T01:16:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359375",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:86'></a>
Ha, forgotten the scipy stuff is "nearest neighbor", the stuff from delaunay is "natural neighbor" and they are definitely different things.

All that's available has already been tried during the upgrade to MPL 1.4. See https://github.com/sagemath/sagetrac-mirror/commit/b2c0045d3619b225008984e7631c3abcf4f382e8 for various way of coding things without delaunay. There is nothing available unless we adopt code from somewhere else or write our own :(



---

archive/issue_comments_359376.json:
```json
{
    "body": "<a id='comment:87'></a>\nThe documentation even confuses the terms `nearest neighbor` and `natural neighbor`.",
    "created_at": "2017-11-14T04:03:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359376",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:87'></a>
The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.



---

archive/issue_comments_359377.json:
```json
{
    "body": "<a id='comment:88'></a>\nReplying to [strogdon](#comment%3A87):\n> The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.\n\n\nIn scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.",
    "created_at": "2017-11-14T06:20:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359377",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:88'></a>
Replying to [strogdon](#comment%3A87):
> The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.


In scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.



---

archive/issue_comments_359378.json:
```json
{
    "body": "<a id='comment:89'></a>\nReplying to [fbissey](#comment%3A88):\n> Replying to [strogdon](#comment%3A87):\n> > The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.\n\n> \n> In scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.\n\n\nIs it this one https://en.wikipedia.org/wiki/Natural_neighbor_interpolation ?\n\nSurely Sage has more than one implementation of !Voronoi/Delaunay stuff...\nCould you explain what exactly the issue is here?",
    "created_at": "2017-11-14T10:06:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359378",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:89'></a>
Replying to [fbissey](#comment%3A88):
> Replying to [strogdon](#comment%3A87):
> > The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.

> 
> In scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.


Is it this one https://en.wikipedia.org/wiki/Natural_neighbor_interpolation ?

Surely Sage has more than one implementation of !Voronoi/Delaunay stuff...
Could you explain what exactly the issue is here?



---

archive/issue_comments_359379.json:
```json
{
    "body": "<a id='comment:90'></a>\nIf there is, I'd like to know. The only I know about is the one that was in matplotlib's delaunay. Now under the name voronoi we may find other stuff.",
    "created_at": "2017-11-14T10:09:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359379",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:90'></a>
If there is, I'd like to know. The only I know about is the one that was in matplotlib's delaunay. Now under the name voronoi we may find other stuff.



---

archive/issue_comments_359380.json:
```json
{
    "body": "<a id='comment:91'></a>\nThere is `VoronoiDiagram` in Sage, is it enough?",
    "created_at": "2017-11-14T13:22:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359380",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:91'></a>
There is `VoronoiDiagram` in Sage, is it enough?



---

archive/issue_comments_359381.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [fbissey](#comment%3A88):\n> Replying to [strogdon](#comment%3A87):\n> > The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.\n\n> \n> In scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.\n\nYes, not clear. I was referring to the Sage documentation. In `list_plot3d.py` there is\n\n```\n    OPTIONAL KEYWORDS:\n\n    - ``interpolation_type`` - 'linear', 'nn' (natural neighbor), 'spline'\n```\nand\n\n```\n      the triangulation. These points, the natural neighbors, are the ones \n      the interpolation point would connect to if inserted into the \n      triangulation.\n```\nand lastly\n\n```\n      When v is a matrix the default is to use linear interpolation, when\n      v is a list of points the default is nearest neighbor.\n```",
    "created_at": "2017-11-14T13:38:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359381",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:92'></a>
Replying to [fbissey](#comment%3A88):
> Replying to [strogdon](#comment%3A87):
> > The documentation even confuses the terms `nearest neighbor` and `natural neighbor`.

> 
> In scipy, matplotlib or sage? I thought I had done a good effort during the MPL 1.4.x upgrade in sage.

Yes, not clear. I was referring to the Sage documentation. In `list_plot3d.py` there is

```
    OPTIONAL KEYWORDS:

    - ``interpolation_type`` - 'linear', 'nn' (natural neighbor), 'spline'
```
and

```
      the triangulation. These points, the natural neighbors, are the ones 
      the interpolation point would connect to if inserted into the 
      triangulation.
```
and lastly

```
      When v is a matrix the default is to use linear interpolation, when
      v is a list of points the default is nearest neighbor.
```



---

archive/issue_comments_359382.json:
```json
{
    "body": "<a id='comment:93'></a>\n`@`steve OK. I forgot one.\n\n`@`dima That's probably a start but I doubt that's quite enough. We would need to build the interpolator based on it.",
    "created_at": "2017-11-14T19:06:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359382",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:93'></a>
`@`steve OK. I forgot one.

`@`dima That's probably a start but I doubt that's quite enough. We would need to build the interpolator based on it.



---

archive/issue_comments_359383.json:
```json
{
    "body": "<a id='comment:94'></a>\nI am making experiments to time and see what various options look like. I used the same example than in #17618 but it looks slightly different even at the linear level. I don't know if it is the example or stuff in MPL 2.1.0 yet. I am doing a vanilla 8.1.rc0 build to be sure to have a good reference of before and after. \n\nThe spline looks bad - far worse than in #17618 and that's not based on MPL but on a scipy interpolator. The main problem is in the corners. There is spurious stuff trying to go to infinity in the corners which means the region that should be interesting in the middle of the graph is squashed. As always for this kind of things, it may be useful for some graphs.\n\nI am also trialling [https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.CloughTocher2DInterpolator.html#scipy.interpolate.CloughTocher2DInterpolator](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.CloughTocher2DInterpolator.html#scipy.interpolate.CloughTocher2DInterpolator). It is fast (slightly faster than linear) and looks quite good.\n\nI'll post again when I can see what it looks like with an identical build with MPL 1.5.3.",
    "created_at": "2017-11-14T20:32:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359383",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:94'></a>
I am making experiments to time and see what various options look like. I used the same example than in #17618 but it looks slightly different even at the linear level. I don't know if it is the example or stuff in MPL 2.1.0 yet. I am doing a vanilla 8.1.rc0 build to be sure to have a good reference of before and after. 

The spline looks bad - far worse than in #17618 and that's not based on MPL but on a scipy interpolator. The main problem is in the corners. There is spurious stuff trying to go to infinity in the corners which means the region that should be interesting in the middle of the graph is squashed. As always for this kind of things, it may be useful for some graphs.

I am also trialling [https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.CloughTocher2DInterpolator.html#scipy.interpolate.CloughTocher2DInterpolator](https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.CloughTocher2DInterpolator.html#scipy.interpolate.CloughTocher2DInterpolator). It is fast (slightly faster than linear) and looks quite good.

I'll post again when I can see what it looks like with an identical build with MPL 1.5.3.



---

archive/issue_comments_359384.json:
```json
{
    "body": "<a id='comment:95'></a>\nspline are looking equally bad before and after the upgrade of MPL (since it is scipy based no surprise). Interestingly #17618 doesn't show what the spline result looks like so it is probably not new.\n\nThe linear results are different between MPL 1.5.3 and 2.1.0. If anything 2.1.0 looks more refined.",
    "created_at": "2017-11-14T21:26:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359384",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:95'></a>
spline are looking equally bad before and after the upgrade of MPL (since it is scipy based no surprise). Interestingly #17618 doesn't show what the spline result looks like so it is probably not new.

The linear results are different between MPL 1.5.3 and 2.1.0. If anything 2.1.0 looks more refined.



---

archive/attachments_020955.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL153-linear.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL153-linear.png",
    "created_at": "2017-11-14T21:30:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL153-linear.png",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_359385.json:
```json
{
    "body": "Attachment [MPL153-linear.png](https://github.com/sagemath/sage/files/ticket23696/MPL153-linear.png) by @kiwifb created at 2017-11-14 21:30:53",
    "created_at": "2017-11-14T21:30:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359385",
    "user": "https://github.com/kiwifb"
}
```

Attachment [MPL153-linear.png](https://github.com/sagemath/sage/files/ticket23696/MPL153-linear.png) by @kiwifb created at 2017-11-14 21:30:53



---

archive/attachments_020956.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL153-nn.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL153-nn.png",
    "created_at": "2017-11-14T21:31:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL153-nn.png",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_359386.json:
```json
{
    "body": "Attachment [MPL153-nn.png](https://github.com/sagemath/sage/files/ticket23696/MPL153-nn.png) by @kiwifb created at 2017-11-14 21:31:21",
    "created_at": "2017-11-14T21:31:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359386",
    "user": "https://github.com/kiwifb"
}
```

Attachment [MPL153-nn.png](https://github.com/sagemath/sage/files/ticket23696/MPL153-nn.png) by @kiwifb created at 2017-11-14 21:31:21



---

archive/attachments_020957.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL210-clough.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL210-clough.png",
    "created_at": "2017-11-14T21:31:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL210-clough.png",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_359387.json:
```json
{
    "body": "Attachment [MPL210-clough.png](https://github.com/sagemath/sage/files/ticket23696/MPL210-clough.png) by @kiwifb created at 2017-11-14 21:31:31",
    "created_at": "2017-11-14T21:31:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359387",
    "user": "https://github.com/kiwifb"
}
```

Attachment [MPL210-clough.png](https://github.com/sagemath/sage/files/ticket23696/MPL210-clough.png) by @kiwifb created at 2017-11-14 21:31:31



---

archive/attachments_020958.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL210-linear.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL210-linear.png",
    "created_at": "2017-11-14T21:44:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL210-linear.png",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_359388.json:
```json
{
    "body": "<a id='comment:96'></a>\nAttachment [MPL210-linear.png](https://github.com/sagemath/sage/files/ticket23696/MPL210-linear.png) by @kiwifb created at 2017-11-14 21:44:29\n\nSo the code is basically\n\n```\nfrom sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler\nD = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)\nS = [D() for _ in range(2^12)]\nl = [vector(v.list() + [S.count(v)]) for v in set(S)]\n%timeit P = list_plot3d(l, interpolation_type='linear', texture=\"automatic\", point_list=True)\nlist_plot3d(l, interpolation_type='spline', texture=\"automatic\", point_list=True)\n```\nwith various replacement for interpolation type.\n\nNote the variation in `z` across all examples.\n\nMPL-1.5.3, linear\n\n```\nThe slowest run took 20.64 times longer than the fastest. This could mean that an intermediate result is being cached.\n100 loops, best of 3: 4.91 ms per loop\n```\n\n![](MPL153-linear.png)\n\nMPL-1.5.3, natural neighbor (nn)\n\n```\n100 loops, best of 3: 5.8 ms per loop\n```\n\n![](MPL153-nn.png)\n\nMPL-2.1.0, linear\n\n```\nThe slowest run took 22.77 times longer than the fastest. This could mean that an intermediate result is being cached.\n100 loops, best of 3: 4.96 ms per loop\n```\n\n![](MPL210-linear.png)\n\nMPL-2.1.0, CloughTocher (new)\n\n```\n100 loops, best of 3: 4.6 ms per loop\n```\n\n![](MPL210-clough.png)\n\nI'd say MPL-2.1.0 linear looks much better than 1.5.3 and could be the new default. It is definitely smoother. We could also replace \"natural neighbor\" with \"CloughTocher\" in the selection. It is an interesting one. As the fastest in the lot and not depending on some caching (unlike linear) it is a viable default in my opinion.",
    "created_at": "2017-11-14T21:44:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359388",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:96'></a>
Attachment [MPL210-linear.png](https://github.com/sagemath/sage/files/ticket23696/MPL210-linear.png) by @kiwifb created at 2017-11-14 21:44:29

So the code is basically

```
from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler
D = DiscreteGaussianDistributionLatticeSampler(identity_matrix(2), 3.0)
S = [D() for _ in range(2^12)]
l = [vector(v.list() + [S.count(v)]) for v in set(S)]
%timeit P = list_plot3d(l, interpolation_type='linear', texture="automatic", point_list=True)
list_plot3d(l, interpolation_type='spline', texture="automatic", point_list=True)
```
with various replacement for interpolation type.

Note the variation in `z` across all examples.

MPL-1.5.3, linear

```
The slowest run took 20.64 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 3: 4.91 ms per loop
```

![](MPL153-linear.png)

MPL-1.5.3, natural neighbor (nn)

```
100 loops, best of 3: 5.8 ms per loop
```

![](MPL153-nn.png)

MPL-2.1.0, linear

```
The slowest run took 22.77 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 3: 4.96 ms per loop
```

![](MPL210-linear.png)

MPL-2.1.0, CloughTocher (new)

```
100 loops, best of 3: 4.6 ms per loop
```

![](MPL210-clough.png)

I'd say MPL-2.1.0 linear looks much better than 1.5.3 and could be the new default. It is definitely smoother. We could also replace "natural neighbor" with "CloughTocher" in the selection. It is an interesting one. As the fastest in the lot and not depending on some caching (unlike linear) it is a viable default in my opinion.



---

archive/attachments_020959.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL-2.1.0.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL-2.1.0.png",
    "created_at": "2017-11-15T01:39:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL-2.1.0.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359389.json:
```json
{
    "body": "Attachment [MPL-2.1.0.png](https://github.com/sagemath/sage/files/ticket23696/MPL-2.1.0.png) by @strogdon created at 2017-11-15 01:39:20",
    "created_at": "2017-11-15T01:39:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359389",
    "user": "https://github.com/strogdon"
}
```

Attachment [MPL-2.1.0.png](https://github.com/sagemath/sage/files/ticket23696/MPL-2.1.0.png) by @strogdon created at 2017-11-15 01:39:20



---

archive/attachments_020960.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "MPL-1.5.3.png",
    "asset_url": "tarball://root/attachments/ticket23696/MPL-1.5.3.png",
    "created_at": "2017-11-15T01:43:07Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/MPL-1.5.3.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359390.json:
```json
{
    "body": "Attachment [MPL-1.5.3.png](https://github.com/sagemath/sage/files/ticket23696/MPL-1.5.3.png) by @strogdon created at 2017-11-15 01:43:07",
    "created_at": "2017-11-15T01:43:07Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359390",
    "user": "https://github.com/strogdon"
}
```

Attachment [MPL-1.5.3.png](https://github.com/sagemath/sage/files/ticket23696/MPL-1.5.3.png) by @strogdon created at 2017-11-15 01:43:07



---

archive/issue_comments_359391.json:
```json
{
    "body": "<a id='comment:97'></a>\nWith this somewhat naive change to `list_plot3d.py` added to this branch\n\n```\ndiff --git a/src/sage/plot/plot3d/list_plot3d.py b/src/sage/plot/plot3d/list_plot3d.py\nindex c9f22dd464..dfc9aa8a51 100644\n--- a/src/sage/plot/plot3d/list_plot3d.py\n+++ b/src/sage/plot/plot3d/list_plot3d.py\n@@ -373,7 +373,7 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):\n         sage: list_plot3d([(1, 2, 3), (0, 1, 3), (2, 1, 4), (1, 0, -2)], texture='yellow', num_points=50)\n         Graphics3d Object\n     \"\"\"\n-    from matplotlib import tri, delaunay\n+    from matplotlib import tri\n     import numpy\n     import scipy\n     from random import random\n@@ -441,16 +441,13 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):\n \n     if interpolation_type == 'nn'  or interpolation_type =='default':\n \n-        T=delaunay.Triangulation(x,y)\n-        f=T.nn_interpolator(z)\n+        T=tri.Triangulation(x,y)\n+        f=tri.CubicTriInterpolator(T, z)\n         f.default_value=0.0\n         j=numpy.complex(0,1)\n-        vals=f[ymin:ymax:j*num_points,xmin:xmax:j*num_points]\n         from .parametric_surface import ParametricSurface\n         def g(x,y):\n-            i=round( (x-xmin)/(xmax-xmin)*(num_points-1) )\n-            j=round( (y-ymin)/(ymax-ymin)*(num_points-1) )\n-            z=vals[int(j),int(i)]\n+            z = f(x, y)\n             return (x,y,z)\n         G = ParametricSurface(g, (list(numpy.r_[xmin:xmax:num_points*j]), list(numpy.r_[ymin:ymax:num_points*j])), texture=texture, **kwds)\n         G._set_extra_kwds(kwds)\n```\nI get for the failing doctest in `src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst`\n\n```\n    sage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]\n    sage: list_plot3d(v, interpolation_type='nn')\n```\nthe following\n![](MPL-2.1.0.png)\n\nSo with `interpolation_type='nn'` cubics are being used. This is to be compared with the same test but using MPL-1.5.3 (natural neighbor (nn) used)\n![](MPL-1.5.3.png)\nHowever, this change exposes `DeprecationWarnings`.",
    "created_at": "2017-11-15T01:47:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359391",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:97'></a>
With this somewhat naive change to `list_plot3d.py` added to this branch

```
diff --git a/src/sage/plot/plot3d/list_plot3d.py b/src/sage/plot/plot3d/list_plot3d.py
index c9f22dd464..dfc9aa8a51 100644
--- a/src/sage/plot/plot3d/list_plot3d.py
+++ b/src/sage/plot/plot3d/list_plot3d.py
@@ -373,7 +373,7 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):
         sage: list_plot3d([(1, 2, 3), (0, 1, 3), (2, 1, 4), (1, 0, -2)], texture='yellow', num_points=50)
         Graphics3d Object
     """
-    from matplotlib import tri, delaunay
+    from matplotlib import tri
     import numpy
     import scipy
     from random import random
@@ -441,16 +441,13 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):
 
     if interpolation_type == 'nn'  or interpolation_type =='default':
 
-        T=delaunay.Triangulation(x,y)
-        f=T.nn_interpolator(z)
+        T=tri.Triangulation(x,y)
+        f=tri.CubicTriInterpolator(T, z)
         f.default_value=0.0
         j=numpy.complex(0,1)
-        vals=f[ymin:ymax:j*num_points,xmin:xmax:j*num_points]
         from .parametric_surface import ParametricSurface
         def g(x,y):
-            i=round( (x-xmin)/(xmax-xmin)*(num_points-1) )
-            j=round( (y-ymin)/(ymax-ymin)*(num_points-1) )
-            z=vals[int(j),int(i)]
+            z = f(x, y)
             return (x,y,z)
         G = ParametricSurface(g, (list(numpy.r_[xmin:xmax:num_points*j]), list(numpy.r_[ymin:ymax:num_points*j])), texture=texture, **kwds)
         G._set_extra_kwds(kwds)
```
I get for the failing doctest in `src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst`

```
    sage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]
    sage: list_plot3d(v, interpolation_type='nn')
```
the following
![](MPL-2.1.0.png)

So with `interpolation_type='nn'` cubics are being used. This is to be compared with the same test but using MPL-1.5.3 (natural neighbor (nn) used)
![](MPL-1.5.3.png)
However, this change exposes `DeprecationWarnings`.



---

archive/issue_comments_359392.json:
```json
{
    "body": "<a id='comment:98'></a>\nFor the record, this is what I used on top of this branch to get my graphs\n\n```diff\ndiff --git a/src/sage/plot/plot3d/list_plot3d.py b/src/sage/plot/plot3d/list_plot3d.py\nindex c9f22dd464..6fb03a468d 100644\n--- a/src/sage/plot/plot3d/list_plot3d.py\n+++ b/src/sage/plot/plot3d/list_plot3d.py\n@@ -373,7 +373,7 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):\n         sage: list_plot3d([(1, 2, 3), (0, 1, 3), (2, 1, 4), (1, 0, -2)], texture='yellow', num_points=50)\n         Graphics3d Object\n     \"\"\"\n-    from matplotlib import tri, delaunay\n+    from matplotlib import tri\n     import numpy\n     import scipy\n     from random import random\n@@ -427,7 +427,10 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):\n                                           #arbitrary choice - assuming more or less a nxn grid of points\n                                           # x should have n^2 entries. We sample 4 times that many points.\n \n-    if interpolation_type == 'linear':\n+    points=[[x[i],y[i]] for i in range(len(x))]\n+    j = numpy.complex(0, 1)\n+    \n+    if interpolation_type == 'linear' or interpolation_type =='default':\n         T = tri.Triangulation(x, y)\n         f = tri.LinearTriInterpolator(T, z)\n         j = numpy.complex(0, 1)\n@@ -439,19 +442,12 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):\n         G._set_extra_kwds(kwds)\n         return G\n \n-    if interpolation_type == 'nn'  or interpolation_type =='default':\n-\n-        T=delaunay.Triangulation(x,y)\n-        f=T.nn_interpolator(z)\n-        f.default_value=0.0\n-        j=numpy.complex(0,1)\n-        vals=f[ymin:ymax:j*num_points,xmin:xmax:j*num_points]\n+    if interpolation_type == 'clough':\n+        f = interpolate.CloughTocher2DInterpolator(points,z)\n         from .parametric_surface import ParametricSurface\n-        def g(x,y):\n-            i=round( (x-xmin)/(xmax-xmin)*(num_points-1) )\n-            j=round( (y-ymin)/(ymax-ymin)*(num_points-1) )\n-            z=vals[int(j),int(i)]\n-            return (x,y,z)\n+        def g(x, y):\n+            z = f([x, y])\n+            return (x, y, z)\n         G = ParametricSurface(g, (list(numpy.r_[xmin:xmax:num_points*j]), list(numpy.r_[ymin:ymax:num_points*j])), texture=texture, **kwds)\n         G._set_extra_kwds(kwds)\n         return G\n```",
    "created_at": "2017-11-15T01:55:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359392",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:98'></a>
For the record, this is what I used on top of this branch to get my graphs

```diff
diff --git a/src/sage/plot/plot3d/list_plot3d.py b/src/sage/plot/plot3d/list_plot3d.py
index c9f22dd464..6fb03a468d 100644
--- a/src/sage/plot/plot3d/list_plot3d.py
+++ b/src/sage/plot/plot3d/list_plot3d.py
@@ -373,7 +373,7 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):
         sage: list_plot3d([(1, 2, 3), (0, 1, 3), (2, 1, 4), (1, 0, -2)], texture='yellow', num_points=50)
         Graphics3d Object
     """
-    from matplotlib import tri, delaunay
+    from matplotlib import tri
     import numpy
     import scipy
     from random import random
@@ -427,7 +427,10 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):
                                           #arbitrary choice - assuming more or less a nxn grid of points
                                           # x should have n^2 entries. We sample 4 times that many points.
 
-    if interpolation_type == 'linear':
+    points=[[x[i],y[i]] for i in range(len(x))]
+    j = numpy.complex(0, 1)
+    
+    if interpolation_type == 'linear' or interpolation_type =='default':
         T = tri.Triangulation(x, y)
         f = tri.LinearTriInterpolator(T, z)
         j = numpy.complex(0, 1)
@@ -439,19 +442,12 @@ def list_plot3d_tuples(v, interpolation_type, texture, **kwds):
         G._set_extra_kwds(kwds)
         return G
 
-    if interpolation_type == 'nn'  or interpolation_type =='default':
-
-        T=delaunay.Triangulation(x,y)
-        f=T.nn_interpolator(z)
-        f.default_value=0.0
-        j=numpy.complex(0,1)
-        vals=f[ymin:ymax:j*num_points,xmin:xmax:j*num_points]
+    if interpolation_type == 'clough':
+        f = interpolate.CloughTocher2DInterpolator(points,z)
         from .parametric_surface import ParametricSurface
-        def g(x,y):
-            i=round( (x-xmin)/(xmax-xmin)*(num_points-1) )
-            j=round( (y-ymin)/(ymax-ymin)*(num_points-1) )
-            z=vals[int(j),int(i)]
-            return (x,y,z)
+        def g(x, y):
+            z = f([x, y])
+            return (x, y, z)
         G = ParametricSurface(g, (list(numpy.r_[xmin:xmax:num_points*j]), list(numpy.r_[ymin:ymax:num_points*j])), texture=texture, **kwds)
         G._set_extra_kwds(kwds)
         return G
```



---

archive/issue_comments_359393.json:
```json
{
    "body": "<a id='comment:99'></a>\nI didn't select cubic this time around because it was 16 times slower than natural neighbor in #17618. Of course that could have changed in 2.1.0.",
    "created_at": "2017-11-15T01:57:58Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359393",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:99'></a>
I didn't select cubic this time around because it was 16 times slower than natural neighbor in #17618. Of course that could have changed in 2.1.0.



---

archive/issue_comments_359394.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK, I hadn't noticed the `interpolate.` business. Yet another twist.",
    "created_at": "2017-11-15T02:20:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359394",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:0'></a>
OK, I hadn't noticed the `interpolate.` business. Yet another twist.



---

archive/issue_comments_359395.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think the only difference is that `interpolate.CloughTocher2DInterpolator` is on a regular grid while `tri.CubicTriInterpolator` is a `Clough-Tocher` cubic interpolation on a triangular grid, but I could be wrong.",
    "created_at": "2017-11-15T02:52:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359395",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:1'></a>
I think the only difference is that `interpolate.CloughTocher2DInterpolator` is on a regular grid while `tri.CubicTriInterpolator` is a `Clough-Tocher` cubic interpolation on a triangular grid, but I could be wrong.



---

archive/issue_comments_359396.json:
```json
{
    "body": "<a id='comment:2'></a>\n`CloughTocher2DInterpolator` is on unstructured data, so it can be any shape. Interestingly the input can be a delaunay triangulation, but it doesn't have to be on a grid. While it is a cubic interpolation, it is more sophisticated than `tri.CubicTriInterpolator`, in particular the scheme for evaluating the gradient (scipy) or derivatives (MPL) is vastly different.",
    "created_at": "2017-11-15T03:37:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359396",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
`CloughTocher2DInterpolator` is on unstructured data, so it can be any shape. Interestingly the input can be a delaunay triangulation, but it doesn't have to be on a grid. While it is a cubic interpolation, it is more sophisticated than `tri.CubicTriInterpolator`, in particular the scheme for evaluating the gradient (scipy) or derivatives (MPL) is vastly different.



---

archive/issue_comments_359397.json:
```json
{
    "body": "<a id='comment:3'></a>\n@ steve I just tested your example with my branch. in that case your \"nn\" picture is quite close to the linear from MPL 2.1.0. And the cubic picture is very similar to what I get for \"clough\". But I imagine cubic is much slower. Here are my timings\n\n```\nsage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]\nsage: %timeit NT=list_plot3d(v, interpolation_type='linear')\nThe slowest run took 325.09 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 83.4 \u00b5s per loop\nsage: %timeit NT=list_plot3d(v, interpolation_type='clough')\n100 loops, best of 3: 3.73 ms per loop\n```\nIn this particular case linear is blazingly fast so may be cubic has a reasonable runtime.",
    "created_at": "2017-11-15T20:43:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359397",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
@ steve I just tested your example with my branch. in that case your "nn" picture is quite close to the linear from MPL 2.1.0. And the cubic picture is very similar to what I get for "clough". But I imagine cubic is much slower. Here are my timings

```
sage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]
sage: %timeit NT=list_plot3d(v, interpolation_type='linear')
The slowest run took 325.09 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 83.4 ¬µs per loop
sage: %timeit NT=list_plot3d(v, interpolation_type='clough')
100 loops, best of 3: 3.73 ms per loop
```
In this particular case linear is blazingly fast so may be cubic has a reasonable runtime.



---

archive/issue_comments_359398.json:
```json
{
    "body": "<a id='comment:4'></a>\n`@`fran\u00e7ois, back to this.\n\nMy tests here indicate that `CloughTocher2DInterpolator` with your changes is roughly 20 times faster that `CubicTriInterpolator`. There are some subtle differences in the pictures so they are not exactly the same. A disadvantage of using `CubicTriInterpolator`\nis the `DeprecationWarning` mentioned above:\n\n```\nsage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]\nsage: %timeit NT=list_plot3d(v, interpolation_type='nn')\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1074: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.\n  col0 = _prod_vectorized(J, np.expand_dims(tri_dz[:, 0, :], axis=3))\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1075: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.\n  col1 = _prod_vectorized(J1, np.expand_dims(tri_dz[:, 1, :], axis=3))\n/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1076: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.\n  col2 = _prod_vectorized(J2, np.expand_dims(tri_dz[:, 2, :], axis=3))\n1 loop, best of 3: 241 ms per loop\n```\n`interpolation_type='nn'` does use `cubics`.\nIf I change `axis=3` to `axis=2` in the 3 offending lines in `matplotlib/tri/triinterpolate.py` then the warnings disappear. I think there may be a mistake in the `matplotlib` code. There is this [matplotlib pull](https://github.com/matplotlib/matplotlib/pull/8610) that references this [commit](https://github.com/matplotlib/matplotlib/pull/8610/commits/5cea9ce4d4ee936477bfb0bfd3462ba113749b). But I'm not sure the changes were complete enough.",
    "created_at": "2017-11-22T22:48:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359398",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
`@`fran√ßois, back to this.

My tests here indicate that `CloughTocher2DInterpolator` with your changes is roughly 20 times faster that `CubicTriInterpolator`. There are some subtle differences in the pictures so they are not exactly the same. A disadvantage of using `CubicTriInterpolator`
is the `DeprecationWarning` mentioned above:

```
sage: v = [[len(factor(n*m)) for n in [1..15]] for m in [1..15]]
sage: %timeit NT=list_plot3d(v, interpolation_type='nn')
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1074: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.
  col0 = _prod_vectorized(J, np.expand_dims(tri_dz[:, 0, :], axis=3))
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1075: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.
  col1 = _prod_vectorized(J1, np.expand_dims(tri_dz[:, 1, :], axis=3))
/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/matplotlib/tri/triinterpolate.py:1076: DeprecationWarning: Both axis > a.ndim and axis < -a.ndim - 1 are deprecated and will raise an AxisError in the future.
  col2 = _prod_vectorized(J2, np.expand_dims(tri_dz[:, 2, :], axis=3))
1 loop, best of 3: 241 ms per loop
```
`interpolation_type='nn'` does use `cubics`.
If I change `axis=3` to `axis=2` in the 3 offending lines in `matplotlib/tri/triinterpolate.py` then the warnings disappear. I think there may be a mistake in the `matplotlib` code. There is this [matplotlib pull](https://github.com/matplotlib/matplotlib/pull/8610) that references this [commit](https://github.com/matplotlib/matplotlib/pull/8610/commits/5cea9ce4d4ee936477bfb0bfd3462ba113749b). But I'm not sure the changes were complete enough.



---

archive/issue_comments_359399.json:
```json
{
    "body": "<a id='comment:5'></a>\nExact match is not required. Subtle differences are OK, it is bound to happen considering the differences in methods. I definitely think `CloughTocher2D` is more sophisticated than plain cubic and cubic are usually way nicer than linear. The factor 20 in speed is quite nice.\n\nI am not going to comment on the deprecation warning but if you think that warrant an issue in matplotlib you should go for it.",
    "created_at": "2017-11-22T23:03:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359399",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Exact match is not required. Subtle differences are OK, it is bound to happen considering the differences in methods. I definitely think `CloughTocher2D` is more sophisticated than plain cubic and cubic are usually way nicer than linear. The factor 20 in speed is quite nice.

I am not going to comment on the deprecation warning but if you think that warrant an issue in matplotlib you should go for it.



---

archive/issue_comments_359400.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab\">d29091b</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr></table>\n",
    "created_at": "2017-12-11T00:47:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab">d29091b</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr></table>




---

archive/issue_comments_359401.json:
```json
{
    "body": "**Changing commit** from \"[87b33cf3f2cf959e161c857decc2be47ab824437](https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437)\" to \"[d29091bf4a36027761bf08da8b62d06ca94a8aab](https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab)\".",
    "created_at": "2017-12-11T00:47:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[87b33cf3f2cf959e161c857decc2be47ab824437](https://github.com/sagemath/sagetrac-mirror/commit/87b33cf3f2cf959e161c857decc2be47ab824437)" to "[d29091bf4a36027761bf08da8b62d06ca94a8aab](https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab)".



---

archive/issue_comments_359402.json:
```json
{
    "body": "**Changing commit** from \"[d29091bf4a36027761bf08da8b62d06ca94a8aab](https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab)\" to \"[594df5633ec94dde7a15cc3a866cba9cfedfde9e](https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e)\".",
    "created_at": "2017-12-11T01:11:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d29091bf4a36027761bf08da8b62d06ca94a8aab](https://github.com/sagemath/sagetrac-mirror/commit/d29091bf4a36027761bf08da8b62d06ca94a8aab)" to "[594df5633ec94dde7a15cc3a866cba9cfedfde9e](https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e)".



---

archive/issue_comments_359403.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e\">594df56</a></td><td><code>MPL's delaunay module has been removed so we switch to regular triangulation (which happen to Delaunay by default in MPL) and replace Delaunay's 'natural neighbors'</code></td></tr></table>\n",
    "created_at": "2017-12-11T01:11:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e">594df56</a></td><td><code>MPL's delaunay module has been removed so we switch to regular triangulation (which happen to Delaunay by default in MPL) and replace Delaunay's 'natural neighbors'</code></td></tr></table>




---

archive/issue_comments_359404.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK. Let's try to move this. I switched to the CloughTocher2D interpolator from scipy and hopefully updated all the documentation appropriately.",
    "created_at": "2017-12-11T01:12:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359404",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
OK. Let's try to move this. I switched to the CloughTocher2D interpolator from scipy and hopefully updated all the documentation appropriately.



---

archive/issue_events_210681.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-12-11T01:12:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210681"
}
```



---

archive/issue_events_210682.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-12-11T01:12:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210682"
}
```



---

archive/issue_events_210683.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-12-11T21:09:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210683"
}
```



---

archive/issue_events_210684.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2017-12-11T21:09:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210684"
}
```



---

archive/issue_comments_359405.json:
```json
{
    "body": "<a id='comment:0'></a>\nThanks for the update!\n\nHowever, with the new version atop Sage 8.2.beta0, I've noticed that the figures illustrating the \"2D Plotting\" section of the reference manual are of bad quality. For instance compare the attached `plot-11.png` (generated with MPL-2.1.0) with that at http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html",
    "created_at": "2017-12-18T16:18:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359405",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:0'></a>
Thanks for the update!

However, with the new version atop Sage 8.2.beta0, I've noticed that the figures illustrating the "2D Plotting" section of the reference manual are of bad quality. For instance compare the attached `plot-11.png` (generated with MPL-2.1.0) with that at http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html



---

archive/issue_events_210685.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-12-18T16:18:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210685"
}
```



---

archive/issue_events_210686.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2017-12-18T16:18:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210686"
}
```



---

archive/attachments_020961.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "plot-11.png",
    "asset_url": "tarball://root/attachments/ticket23696/plot-11.png",
    "created_at": "2017-12-18T16:19:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/plot-11.png",
    "user": "https://github.com/egourgoulhon"
}
```



---

archive/issue_comments_359406.json:
```json
{
    "body": "Attachment [plot-11.png](https://github.com/sagemath/sage/files/ticket23696/plot-11.png) by @egourgoulhon created at 2017-12-18 16:19:39",
    "created_at": "2017-12-18T16:19:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359406",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [plot-11.png](https://github.com/sagemath/sage/files/ticket23696/plot-11.png) by @egourgoulhon created at 2017-12-18 16:19:39



---

archive/attachments_020962.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "latex_display_original.png",
    "asset_url": "tarball://root/attachments/ticket23696/latex_display_original.png",
    "created_at": "2017-12-18T16:47:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/latex_display_original.png",
    "user": "https://github.com/egourgoulhon"
}
```



---

archive/issue_comments_359407.json:
```json
{
    "body": "Attachment [latex_display_original.png](https://github.com/sagemath/sage/files/ticket23696/latex_display_original.png) by @egourgoulhon created at 2017-12-18 16:47:49",
    "created_at": "2017-12-18T16:47:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359407",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [latex_display_original.png](https://github.com/sagemath/sage/files/ticket23696/latex_display_original.png) by @egourgoulhon created at 2017-12-18 16:47:49



---

archive/attachments_020963.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "latex_display_MPL-2.1.0.png",
    "asset_url": "tarball://root/attachments/ticket23696/latex_display_MPL-2.1.0.png",
    "created_at": "2017-12-18T16:48:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/latex_display_MPL-2.1.0.png",
    "user": "https://github.com/egourgoulhon"
}
```



---

archive/issue_comments_359408.json:
```json
{
    "body": "Attachment [latex_display_MPL-2.1.0.png](https://github.com/sagemath/sage/files/ticket23696/latex_display_MPL-2.1.0.png) by @egourgoulhon created at 2017-12-18 16:48:09",
    "created_at": "2017-12-18T16:48:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359408",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [latex_display_MPL-2.1.0.png](https://github.com/sagemath/sage/files/ticket23696/latex_display_MPL-2.1.0.png) by @egourgoulhon created at 2017-12-18 16:48:09



---

archive/issue_comments_359409.json:
```json
{
    "body": "<a id='comment:1'></a>\nAnother issue is the display of LaTeX in axes labels or text graphic objects; consider for instance\n\n```\nsage: text(r\"$\\sin(x^2) + \\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n```\nWith MPL-2.1.0, the output is\n\n![](latex_display_MPL-2.1.0.png)\n\nwhich is ugly, compared to what we have in Sage 8.1:\n\n![](latex_display_original.png)\n\nAlso the size of the picture is different.",
    "created_at": "2017-12-18T16:53:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359409",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
Another issue is the display of LaTeX in axes labels or text graphic objects; consider for instance

```
sage: text(r"$\sin(x^2) + \int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
```
With MPL-2.1.0, the output is

![](latex_display_MPL-2.1.0.png)

which is ugly, compared to what we have in Sage 8.1:

![](latex_display_original.png)

Also the size of the picture is different.



---

archive/issue_comments_359410.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt appears matplotlib is not finding the Computer Modern fonts. Here this seems to work\n\n```\nfrom matplotlib import rc\nrc('text', usetex='True')\ntext(r\"$\\sin(x^2) + \\displaystyle\\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n```\nHere I need the `\\displaystyle` to get the correct integral sign. And apparently matplotlib has to be `told` to use the `TeX` fonts.\n\n@egourgoulhon does this work on your end?",
    "created_at": "2017-12-18T18:34:56Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359410",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:2'></a>
It appears matplotlib is not finding the Computer Modern fonts. Here this seems to work

```
from matplotlib import rc
rc('text', usetex='True')
text(r"$\sin(x^2) + \displaystyle\int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
```
Here I need the `\displaystyle` to get the correct integral sign. And apparently matplotlib has to be `told` to use the `TeX` fonts.

@egourgoulhon does this work on your end?



---

archive/issue_comments_359411.json:
```json
{
    "body": "<a id='comment:3'></a>\nActually, I think this is the desired result\n\n```\nsage: import matplotlib\nsage: matplotlib.rcParams['mathtext.fontset']='cm'\nsage: text(r\"$\\sin(x^2) + \\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n```\nI think the default `mathtext` font is `dejavusans`.",
    "created_at": "2017-12-18T19:28:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359411",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'></a>
Actually, I think this is the desired result

```
sage: import matplotlib
sage: matplotlib.rcParams['mathtext.fontset']='cm'
sage: text(r"$\sin(x^2) + \int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
```
I think the default `mathtext` font is `dejavusans`.



---

archive/issue_comments_359412.json:
```json
{
    "body": "<a id='comment:114'></a>\nReplying to [egourgoulhon](#comment%3A110):\n> Thanks for the update!\n> \n> However, with the new version atop Sage 8.2.beta0, I've noticed that the figures illustrating the \"2D Plotting\" section of the reference manual are of bad quality. For instance compare the attached `plot-11.png` (generated with MPL-2.1.0) with that at http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html\n\nSo when I do\n\n```\nsage: G = plot(cos(x), (x, -5, 5), thickness=5, color='green', title='A plot')\nsage: P = polygon([[1,2], [5,6], [5,0]], color='red')\nsage: Q = polygon([(-x,y) for x,y in P[0]], color='blue')\nsage: H = G + P + Q\nsage: H\n```\nI get a `.png` that has very good quality but the size of the file containing the `.png` is about 45% larger than `plot-11.png`. So there are differences somewhere? I wonder what is generating the `.png` file?",
    "created_at": "2017-12-18T20:32:26Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359412",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:114'></a>
Replying to [egourgoulhon](#comment%3A110):
> Thanks for the update!
> 
> However, with the new version atop Sage 8.2.beta0, I've noticed that the figures illustrating the "2D Plotting" section of the reference manual are of bad quality. For instance compare the attached `plot-11.png` (generated with MPL-2.1.0) with that at http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html

So when I do

```
sage: G = plot(cos(x), (x, -5, 5), thickness=5, color='green', title='A plot')
sage: P = polygon([[1,2], [5,6], [5,0]], color='red')
sage: Q = polygon([(-x,y) for x,y in P[0]], color='blue')
sage: H = G + P + Q
sage: H
```
I get a `.png` that has very good quality but the size of the file containing the `.png` is about 45% larger than `plot-11.png`. So there are differences somewhere? I wonder what is generating the `.png` file?



---

archive/issue_comments_359413.json:
```json
{
    "body": "<a id='comment:5'></a>\n@kiwifb\n\nFran\u00e7ois, this might be a solution to the font issue (I don't want to mess up your branch):\n\n```diff\n\ndiff --git a/build/pkgs/matplotlib/make-setup-config.py b/build/pkgs/matplotlib/make-setup-config.py\nindex caca02b71c..ba35c001e6 100644\n--- a/build/pkgs/matplotlib/make-setup-config.py\n+++ b/build/pkgs/matplotlib/make-setup-config.py\n@@ -9,6 +9,8 @@ config = SafeConfigParser()\n config.add_section('directories')\n config.set('directories', 'basedirlist', os.environ['SAGE_LOCAL'])\n \n+config.add_section('rc_options')\n+config.set('rc_options', 'mathtext.fontsel', 'cm')\n \n \n #####################################################################\n```",
    "created_at": "2017-12-19T02:52:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359413",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>
@kiwifb

Fran√ßois, this might be a solution to the font issue (I don't want to mess up your branch):

```diff

diff --git a/build/pkgs/matplotlib/make-setup-config.py b/build/pkgs/matplotlib/make-setup-config.py
index caca02b71c..ba35c001e6 100644
--- a/build/pkgs/matplotlib/make-setup-config.py
+++ b/build/pkgs/matplotlib/make-setup-config.py
@@ -9,6 +9,8 @@ config = SafeConfigParser()
 config.add_section('directories')
 config.set('directories', 'basedirlist', os.environ['SAGE_LOCAL'])
 
+config.add_section('rc_options')
+config.set('rc_options', 'mathtext.fontsel', 'cm')
 
 
 #####################################################################
```



---

archive/issue_comments_359414.json:
```json
{
    "body": "<a id='comment:116'></a>\nReplying to [strogdon](#comment%3A112):\n> It appears matplotlib is not finding the Computer Modern fonts. Here this seems to work\n> \n> ```\n> from matplotlib import rc\n> rc('text', usetex='True')\n> text(r\"$\\sin(x^2) + \\displaystyle\\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n> ```\n> Here I need the `\\displaystyle` to get the correct integral sign. And apparently matplotlib has to be `told` to use the `TeX` fonts.\n> \n> @egourgoulhon does this work on your end?\n\nNo, I get the error message:\n\n```\nsage: from matplotlib import rc\nsage: rc('text', usetex='True')\nsage: text(r\"$\\sin(x^2) + \\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n/home/eric/sage/8.2.beta0/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: [Errno 2] No such file or directory: 'dvipng'\n  RichReprWarning,\nGraphics object consisting of 1 graphics primitive\n```\nI guess this requires the package `dvipng` to be installed on my system (it is not).",
    "created_at": "2017-12-19T09:57:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359414",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:116'></a>
Replying to [strogdon](#comment%3A112):
> It appears matplotlib is not finding the Computer Modern fonts. Here this seems to work
> 
> ```
> from matplotlib import rc
> rc('text', usetex='True')
> text(r"$\sin(x^2) + \displaystyle\int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
> ```
> Here I need the `\displaystyle` to get the correct integral sign. And apparently matplotlib has to be `told` to use the `TeX` fonts.
> 
> @egourgoulhon does this work on your end?

No, I get the error message:

```
sage: from matplotlib import rc
sage: rc('text', usetex='True')
sage: text(r"$\sin(x^2) + \int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
/home/eric/sage/8.2.beta0/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py:590: RichReprWarning: Exception in _rich_repr_ while displaying object: [Errno 2] No such file or directory: 'dvipng'
  RichReprWarning,
Graphics object consisting of 1 graphics primitive
```
I guess this requires the package `dvipng` to be installed on my system (it is not).



---

archive/issue_comments_359415.json:
```json
{
    "body": "<a id='comment:117'></a>\nReplying to [strogdon](#comment%3A113):\n> Actually, I think this is the desired result\n> \n> ```\n> sage: import matplotlib\n> sage: matplotlib.rcParams['mathtext.fontset']='cm'\n> sage: text(r\"$\\sin(x^2) + \\int_0^\\pi \\sqrt{x}\\mathrm{d} x$\", (1,1), fontsize=20)\n> ```\n\n\nThis one works for me (i.e. it does not require `dvipng`).",
    "created_at": "2017-12-19T09:59:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359415",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:117'></a>
Replying to [strogdon](#comment%3A113):
> Actually, I think this is the desired result
> 
> ```
> sage: import matplotlib
> sage: matplotlib.rcParams['mathtext.fontset']='cm'
> sage: text(r"$\sin(x^2) + \int_0^\pi \sqrt{x}\mathrm{d} x$", (1,1), fontsize=20)
> ```


This one works for me (i.e. it does not require `dvipng`).



---

archive/issue_comments_359416.json:
```json
{
    "body": "<a id='comment:118'></a>\nReplying to [strogdon](#comment%3A114):\n> So when I do\n> \n> ```\n> sage: G = plot(cos(x), (x, -5, 5), thickness=5, color='green', title='A plot')\n> sage: P = polygon([[1,2], [5,6], [5,0]], color='red')\n> sage: Q = polygon([(-x,y) for x,y in P[0]], color='blue')\n> sage: H = G + P + Q\n> sage: H\n> ```\n> I get a `.png` that has very good quality but the size of the file containing the `.png` is about 45% larger than `plot-11.png`. \n\n\nIndeed, this generates a good quality figure, contrary to what happens for the same commands when building the doc with Sphinx. \n\nBesides, the resolution of the png is 630x464, while for the same plot, it is 784x575 in Sage 8.1.",
    "created_at": "2017-12-19T10:17:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359416",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:118'></a>
Replying to [strogdon](#comment%3A114):
> So when I do
> 
> ```
> sage: G = plot(cos(x), (x, -5, 5), thickness=5, color='green', title='A plot')
> sage: P = polygon([[1,2], [5,6], [5,0]], color='red')
> sage: Q = polygon([(-x,y) for x,y in P[0]], color='blue')
> sage: H = G + P + Q
> sage: H
> ```
> I get a `.png` that has very good quality but the size of the file containing the `.png` is about 45% larger than `plot-11.png`. 


Indeed, this generates a good quality figure, contrary to what happens for the same commands when building the doc with Sphinx. 

Besides, the resolution of the png is 630x464, while for the same plot, it is 784x575 in Sage 8.1.



---

archive/issue_comments_359417.json:
```json
{
    "body": "<a id='comment:9'></a>\nOne more data point: after `make doc-clean` + `make doc`, the png of 3D plots in the section `3D Graphics / Plotting Functions` of the reference manual are also of bad quality. Now, these figures are not produced by `matplotlib` but by `JMol`... Could this be due to one of the new packages installed as MPL-2.1.0 dependencies?",
    "created_at": "2017-12-19T10:47:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359417",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>
One more data point: after `make doc-clean` + `make doc`, the png of 3D plots in the section `3D Graphics / Plotting Functions` of the reference manual are also of bad quality. Now, these figures are not produced by `matplotlib` but by `JMol`... Could this be due to one of the new packages installed as MPL-2.1.0 dependencies?



---

archive/issue_comments_359418.json:
```json
{
    "body": "<a id='comment:0'></a>\nSorry for the silence - I am sick. But now I am not lethargic anymore. I think changing things in `make-setup-config.py` is the way to go. It may be possible to change the size of the png file from there if it is desirable.\nI am not sure what's happening with `jmol` the new packages are python only and `jmol` is java. What could be possible, but I don't know, is that `jmol` calls `matplotlib` to generate its png files. In that case changing `matplotlib`'s default should have an impact.",
    "created_at": "2017-12-19T19:18:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359418",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Sorry for the silence - I am sick. But now I am not lethargic anymore. I think changing things in `make-setup-config.py` is the way to go. It may be possible to change the size of the png file from there if it is desirable.
I am not sure what's happening with `jmol` the new packages are python only and `jmol` is java. What could be possible, but I don't know, is that `jmol` calls `matplotlib` to generate its png files. In that case changing `matplotlib`'s default should have an impact.



---

archive/issue_comments_359419.json:
```json
{
    "body": "**Changing commit** from \"[594df5633ec94dde7a15cc3a866cba9cfedfde9e](https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e)\" to \"[b81b49c8935bf50dd64267ce0931f45542a6ffa9](https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9)\".",
    "created_at": "2017-12-19T19:29:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[594df5633ec94dde7a15cc3a866cba9cfedfde9e](https://github.com/sagemath/sagetrac-mirror/commit/594df5633ec94dde7a15cc3a866cba9cfedfde9e)" to "[b81b49c8935bf50dd64267ce0931f45542a6ffa9](https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9)".



---

archive/issue_comments_359420.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9\">b81b49c</a></td><td><code>Add Steve's suggestion to set the default fonts in matplotlib</code></td></tr></table>\n",
    "created_at": "2017-12-19T19:29:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9">b81b49c</a></td><td><code>Add Steve's suggestion to set the default fonts in matplotlib</code></td></tr></table>




---

archive/issue_comments_359421.json:
```json
{
    "body": "<a id='comment:2'></a>\nok can you check again now?",
    "created_at": "2017-12-19T19:39:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359421",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
ok can you check again now?



---

archive/issue_comments_359422.json:
```json
{
    "body": "<a id='comment:123'></a>\nReplying to [fbissey](#comment%3A122):\n> ok can you check again now?\n\n\nThanks for the change, but it does not work: after rebuilding everything from scratch, the default font is still dejavusans. \n\nBy the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). \n\nPS: I wish you a prompt recovery!",
    "created_at": "2017-12-20T10:17:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359422",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:123'></a>
Replying to [fbissey](#comment%3A122):
> ok can you check again now?


Thanks for the change, but it does not work: after rebuilding everything from scratch, the default font is still dejavusans. 

By the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). 

PS: I wish you a prompt recovery!



---

archive/issue_comments_359423.json:
```json
{
    "body": "<a id='comment:124'></a>\nReplying to [egourgoulhon](#comment%3A123):\n> By the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). \n> \n\nMaybe the code for `sphinx_plot` in `src/doc/common/conf.py` has to be updated. At present, it is\n\n```\nplot_pre_code = \"\"\"\ndef sphinx_plot(plot):\n    import matplotlib.image as mpimg\n    from sage.misc.temporary_file import tmp_filename\n    import matplotlib.pyplot as plt\n    if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':\n        fn = tmp_filename(ext=\".png\")\n        plot.plot().save(fn)\n        img = mpimg.imread(fn)\n        plt.imshow(img)\n        plt.margins(0)\n        plt.axis(\"off\")\n        plt.tight_layout(pad=0)\n\nfrom sage.all_cmdline import *\n\"\"\"\n```",
    "created_at": "2017-12-20T10:40:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359423",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:124'></a>
Replying to [egourgoulhon](#comment%3A123):
> By the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). 
> 

Maybe the code for `sphinx_plot` in `src/doc/common/conf.py` has to be updated. At present, it is

```
plot_pre_code = """
def sphinx_plot(plot):
    import matplotlib.image as mpimg
    from sage.misc.temporary_file import tmp_filename
    import matplotlib.pyplot as plt
    if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':
        fn = tmp_filename(ext=".png")
        plot.plot().save(fn)
        img = mpimg.imread(fn)
        plt.imshow(img)
        plt.margins(0)
        plt.axis("off")
        plt.tight_layout(pad=0)

from sage.all_cmdline import *
"""
```



---

archive/issue_comments_359424.json:
```json
{
    "body": "<a id='comment:125'></a>\nReplying to [egourgoulhon](#comment%3A124):\n> Replying to [egourgoulhon](#comment%3A123):\n> > By the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). \n> > \n\n> Maybe the code for `sphinx_plot` in `src/doc/common/conf.py` has to be updated. At present, it is\n> \n> ```\n> plot_pre_code = \"\"\"\n> def sphinx_plot(plot):\n>     import matplotlib.image as mpimg\n>     from sage.misc.temporary_file import tmp_filename\n>     import matplotlib.pyplot as plt\n>     if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':\n>         fn = tmp_filename(ext=\".png\")\n>         plot.plot().save(fn)\n>         img = mpimg.imread(fn)\n>         plt.imshow(img)\n>         plt.margins(0)\n>         plt.axis(\"off\")\n>         plt.tight_layout(pad=0)\n> \n> from sage.all_cmdline import *\n> \"\"\"\n> ```\n\n\nAll right, to what? This code is only when generating plots for the doc. I am currently working on sage exclusively remotely, so I have no idea what the documentation looks like at the end. That's why I really need input from people who can see the results.",
    "created_at": "2017-12-20T10:46:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359424",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:125'></a>
Replying to [egourgoulhon](#comment%3A124):
> Replying to [egourgoulhon](#comment%3A123):
> > By the way, I confirm that the low quality of all figures in the reference manual is due to this ticket and not to any other change introduced in Sage 8.2.beta0 (I mean, it is fine with 8.2.beta0 alone). 
> > 

> Maybe the code for `sphinx_plot` in `src/doc/common/conf.py` has to be updated. At present, it is
> 
> ```
> plot_pre_code = """
> def sphinx_plot(plot):
>     import matplotlib.image as mpimg
>     from sage.misc.temporary_file import tmp_filename
>     import matplotlib.pyplot as plt
>     if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':
>         fn = tmp_filename(ext=".png")
>         plot.plot().save(fn)
>         img = mpimg.imread(fn)
>         plt.imshow(img)
>         plt.margins(0)
>         plt.axis("off")
>         plt.tight_layout(pad=0)
> 
> from sage.all_cmdline import *
> """
> ```


All right, to what? This code is only when generating plots for the doc. I am currently working on sage exclusively remotely, so I have no idea what the documentation looks like at the end. That's why I really need input from people who can see the results.



---

archive/issue_comments_359425.json:
```json
{
    "body": "<a id='comment:126'></a>\nReplying to [fbissey](#comment%3A125):\n> \n> All right, to what? This code is only when generating plots for the doc. I am currently working on sage exclusively remotely, so I have no idea what the documentation looks like at the end. That's why I really need input from people who can see the results.\n\n\nThe `sphinx_plot` code is clearly the culprit: if you run the following code in a Jupyter notebook (not in Sage console, because `plt.show()` does not work there):\n\n```\nimport matplotlib.image as mpimg\nimport matplotlib.pyplot as plt\nfn = tmp_filename(ext=\".png\")\ng = plot(sin(x^2), (x, 0, 4))\ng.plot().save(fn)\nimg = mpimg.imread(fn)\nplt.imshow(img)\nplt.margins(0)\nplt.axis(\"off\")\nplt.tight_layout(pad=0)\nplt.show()\n```\nyou get a low quality figure, while if you do the same thing with Sage 8.1, you get a nice figure.\n\nBy the way, this explains why 3D plots are also affected, because `plot.plot()` in `sphinx_plot` code transforms them into a 2D figure, which is then processed by `mpimg` and `plt`.",
    "created_at": "2017-12-20T12:27:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359425",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:126'></a>
Replying to [fbissey](#comment%3A125):
> 
> All right, to what? This code is only when generating plots for the doc. I am currently working on sage exclusively remotely, so I have no idea what the documentation looks like at the end. That's why I really need input from people who can see the results.


The `sphinx_plot` code is clearly the culprit: if you run the following code in a Jupyter notebook (not in Sage console, because `plt.show()` does not work there):

```
import matplotlib.image as mpimg
import matplotlib.pyplot as plt
fn = tmp_filename(ext=".png")
g = plot(sin(x^2), (x, 0, 4))
g.plot().save(fn)
img = mpimg.imread(fn)
plt.imshow(img)
plt.margins(0)
plt.axis("off")
plt.tight_layout(pad=0)
plt.show()
```
you get a low quality figure, while if you do the same thing with Sage 8.1, you get a nice figure.

By the way, this explains why 3D plots are also affected, because `plot.plot()` in `sphinx_plot` code transforms them into a 2D figure, which is then processed by `mpimg` and `plt`.



---

archive/issue_comments_359426.json:
```json
{
    "body": "<a id='comment:127'></a>\nReplying to [egourgoulhon](#comment%3A126):\n> \n> The `sphinx_plot` code is clearly the culprit\n\n\nIn `sphinx_plot` code, changing \n\n```\n        plt.imshow(img)\n```\nto \n\n```\n        plt.imshow(img, interpolation='spline16')\n```\ngives a much better result, still on small size as compare to the previous version though.\n\nThe doc from `plt.imshow?` says:\n\n```\ninterpolation : string, optional, default: None\n   Acceptable values are 'none', 'nearest', 'bilinear', 'bicubic',\n   'spline16', 'spline36', 'hanning', 'hamming', 'hermite', 'kaiser',\n   'quadric', 'catrom', 'gaussian', 'bessel', 'mitchell', 'sinc',\n   'lanczos'\n\n   If interpolation is None, default to rc image.interpolation. See\n   also the filternorm and filterrad parameters. If interpolation is\n   'none', then no interpolation is performed on the Agg, ps and pdf\n   backends. Other backends will fall back to 'nearest'.\n```\nSo maybe something around rc `image.interpolation` should be worked out.",
    "created_at": "2017-12-20T12:40:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359426",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:127'></a>
Replying to [egourgoulhon](#comment%3A126):
> 
> The `sphinx_plot` code is clearly the culprit


In `sphinx_plot` code, changing 

```
        plt.imshow(img)
```
to 

```
        plt.imshow(img, interpolation='spline16')
```
gives a much better result, still on small size as compare to the previous version though.

The doc from `plt.imshow?` says:

```
interpolation : string, optional, default: None
   Acceptable values are 'none', 'nearest', 'bilinear', 'bicubic',
   'spline16', 'spline36', 'hanning', 'hamming', 'hermite', 'kaiser',
   'quadric', 'catrom', 'gaussian', 'bessel', 'mitchell', 'sinc',
   'lanczos'

   If interpolation is None, default to rc image.interpolation. See
   also the filternorm and filterrad parameters. If interpolation is
   'none', then no interpolation is performed on the Agg, ps and pdf
   backends. Other backends will fall back to 'nearest'.
```
So maybe something around rc `image.interpolation` should be worked out.



---

archive/issue_comments_359427.json:
```json
{
    "body": "<a id='comment:128'></a>\nReplying to [egourgoulhon](#comment%3A123):\n> Replying to [fbissey](#comment%3A122):\n> > ok can you check again now?\n\n> \n> Thanks for the change, but it does not work: after rebuilding everything from scratch, the default font is still dejavusans.\n> \n\nThere is a typo in what I suggested. Not sure what I did, given the typo, to make the font selection work. The recent commit should change\n \n\n```\nconfig.set('rc_options', 'mathtext.fontsel', 'cm')\n```\n\nto\n\n```\nconfig.set('rc_options', 'mathtext.fontset', 'cm')\n```\n\n`fontsel -> fontset`\n\nBut even with the change, I'm unable to get `matplotlib` to recognize the font change. Something is wrong.",
    "created_at": "2017-12-20T19:57:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359427",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:128'></a>
Replying to [egourgoulhon](#comment%3A123):
> Replying to [fbissey](#comment%3A122):
> > ok can you check again now?

> 
> Thanks for the change, but it does not work: after rebuilding everything from scratch, the default font is still dejavusans.
> 

There is a typo in what I suggested. Not sure what I did, given the typo, to make the font selection work. The recent commit should change
 

```
config.set('rc_options', 'mathtext.fontsel', 'cm')
```

to

```
config.set('rc_options', 'mathtext.fontset', 'cm')
```

`fontsel -> fontset`

But even with the change, I'm unable to get `matplotlib` to recognize the font change. Something is wrong.



---

archive/issue_comments_359428.json:
```json
{
    "body": "<a id='comment:9'></a>\nPerhaps the font can't be changed unless changed in `matplotlibrc` before the install? This doesn't seem right. However, If I insert `mathtext.fontset : cm` in `local/lib/python2.7/site-packages/matplotlib/mpl-data/matplotlibrc` things seem to work.",
    "created_at": "2017-12-20T21:02:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359428",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:9'></a>
Perhaps the font can't be changed unless changed in `matplotlibrc` before the install? This doesn't seem right. However, If I insert `mathtext.fontset : cm` in `local/lib/python2.7/site-packages/matplotlib/mpl-data/matplotlibrc` things seem to work.



---

archive/issue_comments_359429.json:
```json
{
    "body": "<a id='comment:0'></a>\nThanks for all that info! I will dig into this slowly. I am still officially \"unfit for work\" (doctor's order) but a bit of activity at this stage should be alright.",
    "created_at": "2017-12-20T22:18:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359429",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Thanks for all that info! I will dig into this slowly. I am still officially "unfit for work" (doctor's order) but a bit of activity at this stage should be alright.



---

archive/issue_comments_359430.json:
```json
{
    "body": "<a id='comment:1'></a>\nAll right. `make-setup-config.py` was a nice idea, but it doesn't have an impact on the final `mpl-data/matplotlibrc`. So if we want to play with that because we think the default sucks, we'll have to tweak it at some stage. I'd like to do it post-install but is it hard to do it right for all python. It is better to patch the default one.\n\nSo the branch will be reset one commit behind and then I'll add new stuff.\n\nI am starting to compare `mpl-data/matplotlibrc` for interesting differences. For example `image.interpolation` was bilinear in 1.5.3 and is nearest in 2.1.0. Something for you to check Eric.",
    "created_at": "2017-12-21T07:20:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359430",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
All right. `make-setup-config.py` was a nice idea, but it doesn't have an impact on the final `mpl-data/matplotlibrc`. So if we want to play with that because we think the default sucks, we'll have to tweak it at some stage. I'd like to do it post-install but is it hard to do it right for all python. It is better to patch the default one.

So the branch will be reset one commit behind and then I'll add new stuff.

I am starting to compare `mpl-data/matplotlibrc` for interesting differences. For example `image.interpolation` was bilinear in 1.5.3 and is nearest in 2.1.0. Something for you to check Eric.



---

archive/issue_comments_359431.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'm pretty interested by this one. I'm trying to implement the \"exclusions\" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...",
    "created_at": "2017-12-21T07:31:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359431",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:2'></a>
I'm pretty interested by this one. I'm trying to implement the "exclusions" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...



---

archive/issue_comments_359432.json:
```json
{
    "body": "<a id='comment:133'></a>\nReplying to [charpent](#comment%3A132):\n> I'm pretty interested by this one. I'm trying to implement the \"exclusions\" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...\n\n\nFeel free to dig around and interface anything you find. However I can hear Jeroen complaining that it should have been done in a separate ticket on top of that one. But I hope you find what you want in this release. It looks like 2.1.x may be the latest branch to support python 2.7 by the way (unless I misunderstood and 2.2.0 will be it).",
    "created_at": "2017-12-21T07:36:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359432",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:133'></a>
Replying to [charpent](#comment%3A132):
> I'm pretty interested by this one. I'm trying to implement the "exclusions" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...


Feel free to dig around and interface anything you find. However I can hear Jeroen complaining that it should have been done in a separate ticket on top of that one. But I hope you find what you want in this release. It looks like 2.1.x may be the latest branch to support python 2.7 by the way (unless I misunderstood and 2.2.0 will be it).



---

archive/issue_comments_359433.json:
```json
{
    "body": "<a id='comment:4'></a>\nMy reading on the default matplotlibrc: transparency is off by default, not sure that's a big impact. Lines are thicker by default (by 0.5 points). Fonts are **smaller** by default (10 points instead of 12). Some more on fonts (`-` is 1.5.3, `+` is 2.1.0)\n\n```diff\n-#font.size           : 12.0\n-#font.serif          : Bitstream Vera Serif, New Century Schoolbook, Century Schoolbook L, Utopia, ITC Bookman, Bookman, Nimbus Roman No9 L, Times New Roman, Times, Palatino, Charter, serif\n-#font.sans-serif     : Bitstream Vera Sans, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif\n+#font.size           : 10.0\n+#font.serif          : DejaVu Serif, Bitstream Vera Serif, New Century Schoolbook, Century Schoolbook L, Utopia, ITC Bookman, Bookman, Nimbus Roman No9 L, Times New Roman, Times, Palatino, Charter, serif\n+#font.sans-serif     : DejaVu Sans, Bitstream Vera Sans, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif\n #font.cursive        : Apple Chancery, Textile, Zapf Chancery, Sand, Script MT, Felipa, cursive\n-#font.fantasy        : Comic Sans MS, Chicago, Charcoal, Impact, Western, Humor Sans, fantasy\n-#font.monospace      : Bitstream Vera Sans Mono, Andale Mono, Nimbus Mono L, Courier New, Courier, Fixed, Terminal, monospace\n+#font.fantasy        : Comic Sans MS, Chicago, Charcoal, Impact, Western, Humor Sans, xkcd, fantasy\n+#font.monospace      : DejaVu Sans Mono, Bitstream Vera Sans Mono, Andale Mono, Nimbus Mono L, Courier New, Courier, Fixed, Terminal, monospace\n```\nMainly `DejaVu` has displaced `Bitstream Vera` as the default. But more importantly in a later section\n\n```diff\n-#mathtext.fontset : cm # Should be 'cm' (Computer Modern), 'stix',\n-                       # 'stixsans' or 'custom'\n+#mathtext.fontset : dejavusans # Should be 'dejavusans' (default),\n+                               # 'dejavuserif', 'cm' (Computer Modern), 'stix',\n+                               # 'stixsans' or 'custom'\n```\nSo upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. I am for bigger fonts myself as a short sighted person.\nI suspect the following is causing the figures to be smaller - If someone wants to check\n\n```diff\n ### FIGURE\n # See http://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure\n-#figure.titlesize : medium     # size of the figure title\n+#figure.titlesize : large      # size of the figure title (Figure.suptitle())\n #figure.titleweight : normal   # weight of the figure title\n-#figure.figsize   : 8, 6    # figure size in inches\n-#figure.dpi       : 80      # figure dots per inch\n-#figure.facecolor : 0.75    # figure facecolor; 0.75 is scalar gray\n+#figure.figsize   : 6.4, 4.8   # figure size in inches\n+#figure.dpi       : 100      # figure dots per inch\n+#figure.facecolor : white   # figure facecolor; 0.75 is scalar gray\n #figure.edgecolor : white   # figure edgecolor\n #figure.autolayout : False  # When True, automatically adjust subplot\n```\nnotice that the figure is smaller (figsize) but the resolution is greater (dpi). And that's it. The rest is more fluffy compared to what we use normally.",
    "created_at": "2017-12-21T08:00:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359433",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
My reading on the default matplotlibrc: transparency is off by default, not sure that's a big impact. Lines are thicker by default (by 0.5 points). Fonts are **smaller** by default (10 points instead of 12). Some more on fonts (`-` is 1.5.3, `+` is 2.1.0)

```diff
-#font.size           : 12.0
-#font.serif          : Bitstream Vera Serif, New Century Schoolbook, Century Schoolbook L, Utopia, ITC Bookman, Bookman, Nimbus Roman No9 L, Times New Roman, Times, Palatino, Charter, serif
-#font.sans-serif     : Bitstream Vera Sans, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif
+#font.size           : 10.0
+#font.serif          : DejaVu Serif, Bitstream Vera Serif, New Century Schoolbook, Century Schoolbook L, Utopia, ITC Bookman, Bookman, Nimbus Roman No9 L, Times New Roman, Times, Palatino, Charter, serif
+#font.sans-serif     : DejaVu Sans, Bitstream Vera Sans, Lucida Grande, Verdana, Geneva, Lucid, Arial, Helvetica, Avant Garde, sans-serif
 #font.cursive        : Apple Chancery, Textile, Zapf Chancery, Sand, Script MT, Felipa, cursive
-#font.fantasy        : Comic Sans MS, Chicago, Charcoal, Impact, Western, Humor Sans, fantasy
-#font.monospace      : Bitstream Vera Sans Mono, Andale Mono, Nimbus Mono L, Courier New, Courier, Fixed, Terminal, monospace
+#font.fantasy        : Comic Sans MS, Chicago, Charcoal, Impact, Western, Humor Sans, xkcd, fantasy
+#font.monospace      : DejaVu Sans Mono, Bitstream Vera Sans Mono, Andale Mono, Nimbus Mono L, Courier New, Courier, Fixed, Terminal, monospace
```
Mainly `DejaVu` has displaced `Bitstream Vera` as the default. But more importantly in a later section

```diff
-#mathtext.fontset : cm # Should be 'cm' (Computer Modern), 'stix',
-                       # 'stixsans' or 'custom'
+#mathtext.fontset : dejavusans # Should be 'dejavusans' (default),
+                               # 'dejavuserif', 'cm' (Computer Modern), 'stix',
+                               # 'stixsans' or 'custom'
```
So upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. I am for bigger fonts myself as a short sighted person.
I suspect the following is causing the figures to be smaller - If someone wants to check

```diff
 ### FIGURE
 # See http://matplotlib.org/api/figure_api.html#matplotlib.figure.Figure
-#figure.titlesize : medium     # size of the figure title
+#figure.titlesize : large      # size of the figure title (Figure.suptitle())
 #figure.titleweight : normal   # weight of the figure title
-#figure.figsize   : 8, 6    # figure size in inches
-#figure.dpi       : 80      # figure dots per inch
-#figure.facecolor : 0.75    # figure facecolor; 0.75 is scalar gray
+#figure.figsize   : 6.4, 4.8   # figure size in inches
+#figure.dpi       : 100      # figure dots per inch
+#figure.facecolor : white   # figure facecolor; 0.75 is scalar gray
 #figure.edgecolor : white   # figure edgecolor
 #figure.autolayout : False  # When True, automatically adjust subplot
```
notice that the figure is smaller (figsize) but the resolution is greater (dpi). And that's it. The rest is more fluffy compared to what we use normally.



---

archive/issue_comments_359434.json:
```json
{
    "body": "<a id='comment:5'></a>\nWe can bluntly override the default or create a sage style-sheet [https://matplotlib.org/users/customizing.html](https://matplotlib.org/users/customizing.html) and drop it under `mpl-data/stylelib/` (where upstream is already storing them). The alternative is under `MPLCONFIGDIR` and it is not palatable because it is an individual user location. We could even submit our style for inclusion upstream.",
    "created_at": "2017-12-21T08:18:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359434",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
We can bluntly override the default or create a sage style-sheet [https://matplotlib.org/users/customizing.html](https://matplotlib.org/users/customizing.html) and drop it under `mpl-data/stylelib/` (where upstream is already storing them). The alternative is under `MPLCONFIGDIR` and it is not palatable because it is an individual user location. We could even submit our style for inclusion upstream.



---

archive/issue_comments_359435.json:
```json
{
    "body": "<a id='comment:6'></a>\nThere is a \"classic\" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before.",
    "created_at": "2017-12-21T08:29:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359435",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
There is a "classic" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before.



---

archive/issue_comments_359436.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e\">29a35c2</a></td><td><code>use the classic MPL 1.5 style in sphinx_plot</code></td></tr></table>\n",
    "created_at": "2017-12-21T08:33:16Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e">29a35c2</a></td><td><code>use the classic MPL 1.5 style in sphinx_plot</code></td></tr></table>




---

archive/issue_comments_359437.json:
```json
{
    "body": "**Changing commit** from \"[b81b49c8935bf50dd64267ce0931f45542a6ffa9](https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9)\" to \"[29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e](https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e)\".",
    "created_at": "2017-12-21T08:33:16Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b81b49c8935bf50dd64267ce0931f45542a6ffa9](https://github.com/sagemath/sagetrac-mirror/commit/b81b49c8935bf50dd64267ce0931f45542a6ffa9)" to "[29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e](https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e)".



---

archive/issue_comments_359438.json:
```json
{
    "body": "<a id='comment:138'></a>\nReplying to [fbissey](#comment%3A134):\n> So upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. \n\n\nSage being *mathematics* software, we should set `cm` as the default font, whatever upstream thinks. Mathematical formulas with `dejavusans` look really ugly and `cm` has the big advantage of making labels/legends of figures for a scientific paper/textbook coincide with those of the main text. \n\n> I am for bigger fonts myself as a short sighted person.\n\n\n+1; so for this one, we should keep MPL-2.1.0 defaults.",
    "created_at": "2017-12-21T10:27:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359438",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:138'></a>
Replying to [fbissey](#comment%3A134):
> So upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. 


Sage being *mathematics* software, we should set `cm` as the default font, whatever upstream thinks. Mathematical formulas with `dejavusans` look really ugly and `cm` has the big advantage of making labels/legends of figures for a scientific paper/textbook coincide with those of the main text. 

> I am for bigger fonts myself as a short sighted person.


+1; so for this one, we should keep MPL-2.1.0 defaults.



---

archive/issue_comments_359439.json:
```json
{
    "body": "<a id='comment:139'></a>\nReplying to [egourgoulhon](#comment%3A138):\n> Replying to [fbissey](#comment%3A134):\n> > So upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. \n\n> \n> Sage being *mathematics* software, we should set `cm` as the default font, whatever upstream thinks. Mathematical formulas with `dejavusans` look really ugly and `cm` has the big advantage of making labels/legends of figures for a scientific paper/textbook coincide with those of the main text. \n> \n> > I am for bigger fonts myself as a short sighted person.\n\n> \n> +1; so for this one, we should keep MPL-2.1.0 defaults. \n\n\nFonts are bigger in MPL 1.5.3! They are smaller in 2.1.0. But using \"classic\" should take care of that too.",
    "created_at": "2017-12-21T10:30:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359439",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:139'></a>
Replying to [egourgoulhon](#comment%3A138):
> Replying to [fbissey](#comment%3A134):
> > So upstream really thinks `DejaVu` is superior. We may be considered backward in our preferences soon. 

> 
> Sage being *mathematics* software, we should set `cm` as the default font, whatever upstream thinks. Mathematical formulas with `dejavusans` look really ugly and `cm` has the big advantage of making labels/legends of figures for a scientific paper/textbook coincide with those of the main text. 
> 
> > I am for bigger fonts myself as a short sighted person.

> 
> +1; so for this one, we should keep MPL-2.1.0 defaults. 


Fonts are bigger in MPL 1.5.3! They are smaller in 2.1.0. But using "classic" should take care of that too.



---

archive/issue_comments_359440.json:
```json
{
    "body": "<a id='comment:140'></a>\nReplying to [fbissey](#comment%3A139):\n> Replying to [egourgoulhon](#comment%3A138):\n> > \n> > > I am for bigger fonts myself as a short sighted person.\n\n> > \n> > +1; so for this one, we should keep MPL-2.1.0 defaults. \n\n> \n> Fonts are bigger in MPL 1.5.3! They are smaller in 2.1.0. \n\n\nSorry, I misunderstood. I agree with you: bigger fonts are better.",
    "created_at": "2017-12-21T10:40:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359440",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:140'></a>
Replying to [fbissey](#comment%3A139):
> Replying to [egourgoulhon](#comment%3A138):
> > 
> > > I am for bigger fonts myself as a short sighted person.

> > 
> > +1; so for this one, we should keep MPL-2.1.0 defaults. 

> 
> Fonts are bigger in MPL 1.5.3! They are smaller in 2.1.0. 


Sorry, I misunderstood. I agree with you: bigger fonts are better.



---

archive/issue_comments_359441.json:
```json
{
    "body": "<a id='comment:141'></a>\nReplying to [fbissey](#comment%3A133):\n> Replying to [charpent](#comment%3A132):\n> > I'm pretty interested by this one. I'm trying to implement the \"exclusions\" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...\n\n> \n> Feel free to dig around and interface anything you find. However I can hear Jeroen complaining that it should have been done in a separate ticket on top of that one. But I hope you find what you want in this release. It looks like 2.1.x may be the latest branch to support python 2.7 by the way (unless I misunderstood and 2.2.0 will be it).\n\n\nHuh... Jeroen would be right ... *if* I intended to suggest anything exclusions-related to the present ticket, which is not the case. It *is* another problem, indeed...\n\nMy idea was as follows : I found that `plot3d` and friends leaved a \"hole\" in the plotted surface when a vertex of a rectangular facet had `float(\"NaN\")` as z-coordinate. This can be pretty useful to represent exclusions (another way is to use `implicit_plot3d`, which is pretty costly in terms of computing time (proportional to resolution *cubed*, practically unusable....)). So I wanted to follow this to see if it entailed changes relevant to this.\n\nAnyway, I now think that I'm running in a dead-end. My idea bumps on a pretty interesting `list_plot3d` snag... More on this in a future ticket (if I can exactly corner the problem...).",
    "created_at": "2017-12-21T10:45:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359441",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:141'></a>
Replying to [fbissey](#comment%3A133):
> Replying to [charpent](#comment%3A132):
> > I'm pretty interested by this one. I'm trying to implement the "exclusions" never implemented in `parametric_plot3d`, and I might be reinventing the wheel...

> 
> Feel free to dig around and interface anything you find. However I can hear Jeroen complaining that it should have been done in a separate ticket on top of that one. But I hope you find what you want in this release. It looks like 2.1.x may be the latest branch to support python 2.7 by the way (unless I misunderstood and 2.2.0 will be it).


Huh... Jeroen would be right ... *if* I intended to suggest anything exclusions-related to the present ticket, which is not the case. It *is* another problem, indeed...

My idea was as follows : I found that `plot3d` and friends leaved a "hole" in the plotted surface when a vertex of a rectangular facet had `float("NaN")` as z-coordinate. This can be pretty useful to represent exclusions (another way is to use `implicit_plot3d`, which is pretty costly in terms of computing time (proportional to resolution *cubed*, practically unusable....)). So I wanted to follow this to see if it entailed changes relevant to this.

Anyway, I now think that I'm running in a dead-end. My idea bumps on a pretty interesting `list_plot3d` snag... More on this in a future ticket (if I can exactly corner the problem...).



---

archive/issue_comments_359442.json:
```json
{
    "body": "<a id='comment:142'></a>\nReplying to [fbissey](#comment%3A136):\n> There is a \"classic\" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. \n\n\nYes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue.",
    "created_at": "2017-12-21T10:47:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359442",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:142'></a>
Replying to [fbissey](#comment%3A136):
> There is a "classic" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. 


Yes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue.



---

archive/issue_comments_359443.json:
```json
{
    "body": "<a id='comment:143'></a>\nReplying to [egourgoulhon](#comment%3A142):\n> Replying to [fbissey](#comment%3A136):\n> > There is a \"classic\" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. \n\n> \n> Yes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue. \n\nDitto here. After a `make doc-clean && make` the figures in the docs (at least the ones I looked at) appear to be OK. But the documentation example to illustrate use of TeX fonts\n\n```\nsage: plot(exp(x), 0, 2, legend_label='$e^x$')\n```\ndoes not typeset the label with TeX fonts in the terminal. So the `mathtext.fontset` from `build/pkgs/matplotlib/make-setup-config.py` needs to be removed since it's not working there and the equivalent needs to be put somewhere. Where I don't know. And then let's hope that that doesn't mess with `plt.style.use('classic')`.",
    "created_at": "2017-12-21T17:03:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359443",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:143'></a>
Replying to [egourgoulhon](#comment%3A142):
> Replying to [fbissey](#comment%3A136):
> > There is a "classic" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. 

> 
> Yes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue. 

Ditto here. After a `make doc-clean && make` the figures in the docs (at least the ones I looked at) appear to be OK. But the documentation example to illustrate use of TeX fonts

```
sage: plot(exp(x), 0, 2, legend_label='$e^x$')
```
does not typeset the label with TeX fonts in the terminal. So the `mathtext.fontset` from `build/pkgs/matplotlib/make-setup-config.py` needs to be removed since it's not working there and the equivalent needs to be put somewhere. Where I don't know. And then let's hope that that doesn't mess with `plt.style.use('classic')`.



---

archive/issue_comments_359444.json:
```json
{
    "body": "<a id='comment:4'></a>\nI removed `mathtext.fontset` from `make-setup-config.py` in the last commit. I didn't think it was useful. So you could make the change to see if it has an impact for you. If it does, I can include it properly.\n\nNow, Eric's comment about reproducibility is quite serious and probably a lot of work. The easiest solution is of course to just copy the classic style as `matplotlibrc` in the source and may be make a copy of the original one as a MPL-2.1.0 style. sage-on-distro people will rise to linch, verbally - we are quite civilized really [yes I am part of that mob].\nSo the alternative is documentation, documentation and more documentation :( It has to show up in examples that people would follow with an explanation why. There is currently 668 `PLOT::` directives in sage's source code who's having fun yet?",
    "created_at": "2017-12-21T19:00:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359444",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
I removed `mathtext.fontset` from `make-setup-config.py` in the last commit. I didn't think it was useful. So you could make the change to see if it has an impact for you. If it does, I can include it properly.

Now, Eric's comment about reproducibility is quite serious and probably a lot of work. The easiest solution is of course to just copy the classic style as `matplotlibrc` in the source and may be make a copy of the original one as a MPL-2.1.0 style. sage-on-distro people will rise to linch, verbally - we are quite civilized really [yes I am part of that mob].
So the alternative is documentation, documentation and more documentation :( It has to show up in examples that people would follow with an explanation why. There is currently 668 `PLOT::` directives in sage's source code who's having fun yet?



---

archive/issue_comments_359445.json:
```json
{
    "body": "<a id='comment:145'></a>\nReplying to [fbissey](#comment%3A144):\n> I removed `mathtext.fontset` from `make-setup-config.py` in the last commit. I didn't think it was useful. So you could make the change to see if it has an impact for you. If it does, I can include it properly.\n> \n\n\nI hadn't merged things properly and it was still there, but now it's gone.\n\n> Now, Eric's comment about reproducibility is quite serious and probably a lot of work. The easiest solution is of course to just copy the classic style as `matplotlibrc` in the source and may be make a copy of the original one as a MPL-2.1.0 style. sage-on-distro people will rise to linch, verbally - we are quite civilized really [yes I am part of that mob].\n> So the alternative is documentation, documentation and more documentation :( It has to show up in examples that people would follow with an explanation why. There is currently 668 `PLOT::` directives in sage's source code who's having fun yet?\n\n\nI misunderstood. There are probably other items besides fonts that can show up if the `classic` style isn't available from the terminal. But here putting the `mathtext.fontset` declaration in `matplotlibrc` seems to resolve the font issue.",
    "created_at": "2017-12-21T19:26:10Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359445",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:145'></a>
Replying to [fbissey](#comment%3A144):
> I removed `mathtext.fontset` from `make-setup-config.py` in the last commit. I didn't think it was useful. So you could make the change to see if it has an impact for you. If it does, I can include it properly.
> 


I hadn't merged things properly and it was still there, but now it's gone.

> Now, Eric's comment about reproducibility is quite serious and probably a lot of work. The easiest solution is of course to just copy the classic style as `matplotlibrc` in the source and may be make a copy of the original one as a MPL-2.1.0 style. sage-on-distro people will rise to linch, verbally - we are quite civilized really [yes I am part of that mob].
> So the alternative is documentation, documentation and more documentation :( It has to show up in examples that people would follow with an explanation why. There is currently 668 `PLOT::` directives in sage's source code who's having fun yet?


I misunderstood. There are probably other items besides fonts that can show up if the `classic` style isn't available from the terminal. But here putting the `mathtext.fontset` declaration in `matplotlibrc` seems to resolve the font issue.



---

archive/issue_comments_359446.json:
```json
{
    "body": "<a id='comment:6'></a>\nThat's one of things a pre-made style help with. Unless you really, really think upstream screwed up with their choice of math fonts (I cannot really defend them myself).",
    "created_at": "2017-12-21T19:47:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359446",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
That's one of things a pre-made style help with. Unless you really, really think upstream screwed up with their choice of math fonts (I cannot really defend them myself).



---

archive/issue_comments_359447.json:
```json
{
    "body": "<a id='comment:147'></a>\nReplying to [egourgoulhon](#comment%3A142):\n> Replying to [fbissey](#comment%3A136):\n> > There is a \"classic\" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. \n\n> \n> Yes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue. \n\n\nI think trying to make docs look exactly as online help is doomed to fail, in particular as online may mean \n\n*  terminal (with figures shown by a dedicated viewer), \n*  terminal - figures in the browser\n*  Jupyter\n*  sagenb\n*  ...",
    "created_at": "2017-12-22T09:30:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359447",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:147'></a>
Replying to [egourgoulhon](#comment%3A142):
> Replying to [fbissey](#comment%3A136):
> > There is a "classic" style, classic being MPL-1.5. I'll just push a little change and if I am not mistaken the doc will just look as before. 

> 
> Yes I confirm it does look the same. However, this solution (i.e. setting `plt.style.use('classic')` in the code of `sphinx_plot`) may not be a good one, because the figures in the doc may differ from what the user get by typing the same commands, which is not desirable I guess. For instance, the doc figures are different from those produced in the console at the moment, because of the font issue. 


I think trying to make docs look exactly as online help is doomed to fail, in particular as online may mean 

*  terminal (with figures shown by a dedicated viewer), 
*  terminal - figures in the browser
*  Jupyter
*  sagenb
*  ...



---

archive/issue_comments_359448.json:
```json
{
    "body": "<a id='comment:148'></a>\nReplying to [dimpase](#comment%3A147):\n> \n> I think trying to make docs look exactly as online help is doomed to fail, in particular as online may mean \n> \n> *  terminal (with figures shown by a dedicated viewer), \n> *  terminal - figures in the browser\n> *  Jupyter\n> *  sagenb\n> *  ...\n\n\nThis may be true for 3D plots (which are not produced by matplotplib, by the way), but not for 2D plots generated by matplotlib: they all end up in a `png` file and all viewers will display this `png` figure in a unique way, whatever backend you are using (console, Jupyter, sagenb, CoCalc, SageMathCell, ...)",
    "created_at": "2017-12-22T09:52:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359448",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:148'></a>
Replying to [dimpase](#comment%3A147):
> 
> I think trying to make docs look exactly as online help is doomed to fail, in particular as online may mean 
> 
> *  terminal (with figures shown by a dedicated viewer), 
> *  terminal - figures in the browser
> *  Jupyter
> *  sagenb
> *  ...


This may be true for 3D plots (which are not produced by matplotplib, by the way), but not for 2D plots generated by matplotlib: they all end up in a `png` file and all viewers will display this `png` figure in a unique way, whatever backend you are using (console, Jupyter, sagenb, CoCalc, SageMathCell, ...)



---

archive/issue_comments_359449.json:
```json
{
    "body": "<a id='comment:9'></a>\nI now have the following failures:\n\n```\nsage -t --long src/sage/plot/arc.py\nsage -t --long src/sage/plot/plot3d/list_plot3d.py\nsage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst\n```\n\n```\nsage -t --long src/sage/plot/arc.py\n**********************************************************************\nFile \"src/sage/plot/arc.py\", line 299, in sage.plot.arc.Arc.bezier_path\nFailed example:\n    b[0]\nExpected:\n    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)\nGot:\n    Bezier path from (0.0, -1.0) to (0.0, -1.0)\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.plot.arc.Arc.bezier_path\n    [47 tests, 1 failure, 6.75 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/plot/arc.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n```\nsage -t --long src/sage/plot/plot3d/list_plot3d.py\n**********************************************************************\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 95, in sage.plot.plot3d.list_plot3d.list_plot3d\nFailed example:\n    list_plot3d(m, texture='yellow', interpolation_type='nn', frame_aspect_ratio=[1, 1, 1/3])\nExpected:\n    Graphics3d Object\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 102, in sage.plot.plot3d.list_plot3d.list_plot3d\nFailed example:\n    list_plot3d(m, texture='yellow', interpolation_type='nn', frame_aspect_ratio=[1, 1, 1/3], num_points=40)\nExpected:\n    Graphics3d Object\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 143, in sage.plot.plot3d.list_plot3d.list_plot3d\nFailed example:\n    list_plot3d(l, interpolation_type='nn', texture='yellow', num_points=100)\nExpected:\n    Graphics3d Object\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   3 of  26 in sage.plot.plot3d.list_plot3d.list_plot3d\n    [39 tests, 3 failures, 18.32 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/plot/plot3d/list_plot3d.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n\n```\nsage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst\", line 77, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction\nFailed example:\n    list_plot3d(v, interpolation_type='nn')\nException raised:\n    Traceback (most recent call last):\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction[3]>\", line 1, in <module>\n        list_plot3d(v, interpolation_type='nn')\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/plot/plot3d/list_plot3d.py\", line 212, in list_plot3d\n        return list_plot3d_array_of_arrays(v, interpolation_type, texture, **kwds)\n      File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/plot/plot3d/list_plot3d.py\", line 296, in list_plot3d_array_of_arrays\n        G._set_extra_kwds(kwds)\n    AttributeError: 'NoneType' object has no attribute '_set_extra_kwds'\n**********************************************************************\n1 item had failures:\n   1 of   9 in doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction\n    [6 tests, 1 failure, 2.22 s]\n----------------------------------------------------------------------\nsage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst  # 1 doctest failed\n----------------------------------------------------------------------\n```\nMost are related to additional `interpolation_type='nn'`. And then there is the `Bezier` business.",
    "created_at": "2017-12-23T21:42:03Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359449",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:9'></a>
I now have the following failures:

```
sage -t --long src/sage/plot/arc.py
sage -t --long src/sage/plot/plot3d/list_plot3d.py
sage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst
```

```
sage -t --long src/sage/plot/arc.py
**********************************************************************
File "src/sage/plot/arc.py", line 299, in sage.plot.arc.Arc.bezier_path
Failed example:
    b[0]
Expected:
    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)
Got:
    Bezier path from (0.0, -1.0) to (0.0, -1.0)
**********************************************************************
1 item had failures:
   1 of   7 in sage.plot.arc.Arc.bezier_path
    [47 tests, 1 failure, 6.75 s]
----------------------------------------------------------------------
sage -t --long src/sage/plot/arc.py  # 1 doctest failed
----------------------------------------------------------------------
```

```
sage -t --long src/sage/plot/plot3d/list_plot3d.py
**********************************************************************
File "src/sage/plot/plot3d/list_plot3d.py", line 95, in sage.plot.plot3d.list_plot3d.list_plot3d
Failed example:
    list_plot3d(m, texture='yellow', interpolation_type='nn', frame_aspect_ratio=[1, 1, 1/3])
Expected:
    Graphics3d Object
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/plot/plot3d/list_plot3d.py", line 102, in sage.plot.plot3d.list_plot3d.list_plot3d
Failed example:
    list_plot3d(m, texture='yellow', interpolation_type='nn', frame_aspect_ratio=[1, 1, 1/3], num_points=40)
Expected:
    Graphics3d Object
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/plot/plot3d/list_plot3d.py", line 143, in sage.plot.plot3d.list_plot3d.list_plot3d
Failed example:
    list_plot3d(l, interpolation_type='nn', texture='yellow', num_points=100)
Expected:
    Graphics3d Object
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   3 of  26 in sage.plot.plot3d.list_plot3d.list_plot3d
    [39 tests, 3 failures, 18.32 s]
----------------------------------------------------------------------
sage -t --long src/sage/plot/plot3d/list_plot3d.py  # 3 doctests failed
----------------------------------------------------------------------
```

```
sage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst", line 77, in doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction
Failed example:
    list_plot3d(v, interpolation_type='nn')
Exception raised:
    Traceback (most recent call last):
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction[3]>", line 1, in <module>
        list_plot3d(v, interpolation_type='nn')
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/plot/plot3d/list_plot3d.py", line 212, in list_plot3d
        return list_plot3d_array_of_arrays(v, interpolation_type, texture, **kwds)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/plot/plot3d/list_plot3d.py", line 296, in list_plot3d_array_of_arrays
        G._set_extra_kwds(kwds)
    AttributeError: 'NoneType' object has no attribute '_set_extra_kwds'
**********************************************************************
1 item had failures:
   1 of   9 in doc.en.thematic_tutorials.explicit_methods_in_number_theory.introduction
    [6 tests, 1 failure, 2.22 s]
----------------------------------------------------------------------
sage -t --long src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/introduction.rst  # 1 doctest failed
----------------------------------------------------------------------
```
Most are related to additional `interpolation_type='nn'`. And then there is the `Bezier` business.



---

archive/issue_comments_359450.json:
```json
{
    "body": "<a id='comment:0'></a>\nI had completely forgotten about the Bezier stuff in `arc.py`. I don't know what to do with that, the behavior is so completely different. The rest like like stuff I overlook.",
    "created_at": "2017-12-23T21:47:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359450",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
I had completely forgotten about the Bezier stuff in `arc.py`. I don't know what to do with that, the behavior is so completely different. The rest like like stuff I overlook.



---

archive/issue_comments_359451.json:
```json
{
    "body": "**Changing commit** from \"[29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e](https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e)\" to \"[8f4ca6bfe57c467b5a13594f6699782068cf86c2](https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2)\".",
    "created_at": "2017-12-23T21:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359451",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e](https://github.com/sagemath/sagetrac-mirror/commit/29a35c2fb62d0bc8ec98bb736b46d6905ecbff6e)" to "[8f4ca6bfe57c467b5a13594f6699782068cf86c2](https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2)".



---

archive/issue_comments_359452.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/91749f5f0dda58d56e3b493ba9d4d60ad0b58dd4\">91749f5</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2\">8f4ca6b</a></td><td><code>convert all instances of interpolation='nn' to 'clough'</code></td></tr></table>\n",
    "created_at": "2017-12-23T21:52:51Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/91749f5f0dda58d56e3b493ba9d4d60ad0b58dd4">91749f5</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2">8f4ca6b</a></td><td><code>convert all instances of interpolation='nn' to 'clough'</code></td></tr></table>




---

archive/issue_comments_359453.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK should only be the Bezier stuff in arc.py. If someone has a clue has to what needs to be done there.  The issue is that previously just arcs would be plotted while now we get whole ellipses. And this is why the numerical value are so different - the values are for coordinates from the start to the end of the arc. As you can see with MPL-2.1.0 the beginning is equal to the end.\n\nSo there is probably an interface to tweak, so we get only arcs again.",
    "created_at": "2017-12-23T22:01:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359453",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
OK should only be the Bezier stuff in arc.py. If someone has a clue has to what needs to be done there.  The issue is that previously just arcs would be plotted while now we get whole ellipses. And this is why the numerical value are so different - the values are for coordinates from the start to the end of the arc. As you can see with MPL-2.1.0 the beginning is equal to the end.

So there is probably an interface to tweak, so we get only arcs again.



---

archive/issue_comments_359454.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is the pull \n[request](https://github.com/matplotlib/matplotlib/pull/8047/commits/4bc50da563581eaecc0912489e8677f866ab07db) that was merged which breaks the `arc.py` doctest.",
    "created_at": "2017-12-25T02:44:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359454",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'></a>
This is the pull 
[request](https://github.com/matplotlib/matplotlib/pull/8047/commits/4bc50da563581eaecc0912489e8677f866ab07db) that was merged which breaks the `arc.py` doctest.



---

archive/issue_comments_359455.json:
```json
{
    "body": "<a id='comment:4'></a>\nLovely, if I read this correctly, they fixed a \"wrong\" behavior and sage may have been working around it - or possibly using it as a feature, that's not unprecedented - for some time. Also I notice 2.1.1 is released, may as well bump it.",
    "created_at": "2017-12-25T02:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359455",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Lovely, if I read this correctly, they fixed a "wrong" behavior and sage may have been working around it - or possibly using it as a feature, that's not unprecedented - for some time. Also I notice 2.1.1 is released, may as well bump it.



---

archive/issue_comments_359456.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think the problem may well be with `bezier_path`. This generates an arc\n\n```\nsage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))\nsage: a\n```\nHowever this generates an ellipse\n\n```\nsage: b=a[0].bezier_path()\nsage: b\n```\nand\n\n```\nsage: a[0]\nArc with center (0.0,0.0) radii (2.0,1.0) angle 0.0 inside the sector (0.628318530718,1.83259571459)\n```",
    "created_at": "2017-12-25T03:39:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359456",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>
I think the problem may well be with `bezier_path`. This generates an arc

```
sage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))
sage: a
```
However this generates an ellipse

```
sage: b=a[0].bezier_path()
sage: b
```
and

```
sage: a[0]
Arc with center (0.0,0.0) radii (2.0,1.0) angle 0.0 inside the sector (0.628318530718,1.83259571459)
```



---

archive/issue_comments_359457.json:
```json
{
    "body": "<a id='comment:6'></a>\nYup. I am still trying to work out how `bezier_path` is supposed to work. It is not exactly well explained, I had to track matplotlib classes that were not obvious. That's getting me back to high school and some stuff in first year. But why we do it, is a mystery so far. And there may be a matplotlib class that give you the same stuff, although there may be issue of it being a different class. Finally, I am unclear the stuff is ever used (even as it says it is needed for some other stuff).",
    "created_at": "2017-12-25T03:46:26Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359457",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Yup. I am still trying to work out how `bezier_path` is supposed to work. It is not exactly well explained, I had to track matplotlib classes that were not obvious. That's getting me back to high school and some stuff in first year. But why we do it, is a mystery so far. And there may be a matplotlib class that give you the same stuff, although there may be issue of it being a different class. Finally, I am unclear the stuff is ever used (even as it says it is needed for some other stuff).



---

archive/issue_comments_359458.json:
```json
{
    "body": "<a id='comment:7'></a>\n@ chapoton I am adding you to this ticket because you added `bezier_path` in `plot/arc.py` in #18939. Upgrading matplotlib to 2.1.0 makes the bezier_path whole ellipses rather that arcs. Steve Trogdon pointed out that \u200ba https://github.com/matplotlib/matplotlib/pull/8047 corrected the proportions in matplotlib and is the breaking commit. Could you advise on how to change your code?",
    "created_at": "2017-12-25T19:59:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359458",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
@ chapoton I am adding you to this ticket because you added `bezier_path` in `plot/arc.py` in #18939. Upgrading matplotlib to 2.1.0 makes the bezier_path whole ellipses rather that arcs. Steve Trogdon pointed out that ‚Äãa https://github.com/matplotlib/matplotlib/pull/8047 corrected the proportions in matplotlib and is the breaking commit. Could you advise on how to change your code?



---

archive/attachments_020964.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "bezier+arc.png",
    "asset_url": "tarball://root/attachments/ticket23696/2b24f18cb562cb1dd9b9db176bccbb97.png",
    "created_at": "2017-12-27T21:20:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/2b24f18cb562cb1dd9b9db176bccbb97.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359459.json:
```json
{
    "body": "Attachment [bezier+arc.png](https://github.com/sagemath/sage/files/ticket23696/2b24f18cb562cb1dd9b9db176bccbb97.png) by @strogdon created at 2017-12-27 21:20:57",
    "created_at": "2017-12-27T21:20:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359459",
    "user": "https://github.com/strogdon"
}
```

Attachment [bezier+arc.png](https://github.com/sagemath/sage/files/ticket23696/2b24f18cb562cb1dd9b9db176bccbb97.png) by @strogdon created at 2017-12-27 21:20:57



---

archive/issue_comments_359460.json:
```json
{
    "body": "<a id='comment:8'></a>\nFor discussion only. I'm sure all corner cases have not been addressed:\n\n```diff\ndiff --git a/src/sage/plot/arc.py b/src/sage/plot/arc.py\nindex d18e7a7b90..87dc2a04ec 100644\n--- a/src/sage/plot/arc.py\n+++ b/src/sage/plot/arc.py\n@@ -301,12 +301,24 @@ class Arc(GraphicPrimitive):\n         \"\"\"\n         from sage.plot.bezier_path import BezierPath\n         from sage.plot.graphics import Graphics\n+        from matplotlib.path import Path\n+        import numpy as np\n         ma = self._matplotlib_arc()\n-        transform = ma.get_transform().get_matrix()\n+        def theta_stretch(theta, scale):\n+            theta = np.deg2rad(theta)\n+            x = np.cos(theta)\n+            y = np.sin(theta)\n+            return np.rad2deg(np.arctan2(scale * y, x))\n+        theta1 = theta_stretch(ma.theta1, ma.width / ma.height)\n+        theta2 = theta_stretch(ma.theta2, ma.width / ma.height)\n+\n+        pa = ma\n+        pa._path = Path.arc(theta1, theta2)\n+        transform = pa.get_transform().get_matrix()\n         cA, cC, cE = transform[0]\n         cB, cD, cF = transform[1]\n         points = []\n-        for u in ma._path.vertices:\n+        for u in pa._path.vertices:\n             x, y = list(u)\n             points += [(cA * x + cC * y + cE, cB * x + cD * y + cF)]\n         cutlist = [points[0: 4]]\n```\nTo test:\n\n```\nsage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle=\"--\", color=\"red\")\nsage: b = a[0].bezier_path()\nsage: c = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))\nsage: h = c + b\nsage: h\n```\n![](bezier+arc.png)\n\ndoctest:\n\n```\nsage -t --long src/sage/plot/arc.py\n**********************************************************************\nFile \"src/sage/plot/arc.py\", line 299, in sage.plot.arc.Arc.bezier_path\nFailed example:\n    b[0]\nExpected:\n    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)\nGot:\n    Bezier path from (1.1338305413635981, 0.82377610785199551) to (-0.26557635219221642, 0.99114443967015675)\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.plot.arc.Arc.bezier_path\n    [47 tests, 1 failure, 6.77 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/plot/arc.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\nWe do get an arc. The failure is perhaps expected since the original `bezier` graph was incorrect.",
    "created_at": "2017-12-27T21:22:41Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359460",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>
For discussion only. I'm sure all corner cases have not been addressed:

```diff
diff --git a/src/sage/plot/arc.py b/src/sage/plot/arc.py
index d18e7a7b90..87dc2a04ec 100644
--- a/src/sage/plot/arc.py
+++ b/src/sage/plot/arc.py
@@ -301,12 +301,24 @@ class Arc(GraphicPrimitive):
         """
         from sage.plot.bezier_path import BezierPath
         from sage.plot.graphics import Graphics
+        from matplotlib.path import Path
+        import numpy as np
         ma = self._matplotlib_arc()
-        transform = ma.get_transform().get_matrix()
+        def theta_stretch(theta, scale):
+            theta = np.deg2rad(theta)
+            x = np.cos(theta)
+            y = np.sin(theta)
+            return np.rad2deg(np.arctan2(scale * y, x))
+        theta1 = theta_stretch(ma.theta1, ma.width / ma.height)
+        theta2 = theta_stretch(ma.theta2, ma.width / ma.height)
+
+        pa = ma
+        pa._path = Path.arc(theta1, theta2)
+        transform = pa.get_transform().get_matrix()
         cA, cC, cE = transform[0]
         cB, cD, cF = transform[1]
         points = []
-        for u in ma._path.vertices:
+        for u in pa._path.vertices:
             x, y = list(u)
             points += [(cA * x + cC * y + cE, cB * x + cD * y + cF)]
         cutlist = [points[0: 4]]
```
To test:

```
sage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle="--", color="red")
sage: b = a[0].bezier_path()
sage: c = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))
sage: h = c + b
sage: h
```
![](bezier+arc.png)

doctest:

```
sage -t --long src/sage/plot/arc.py
**********************************************************************
File "src/sage/plot/arc.py", line 299, in sage.plot.arc.Arc.bezier_path
Failed example:
    b[0]
Expected:
    Bezier path from (1.618..., 0.5877...) to (-0.5176..., 0.9659...)
Got:
    Bezier path from (1.1338305413635981, 0.82377610785199551) to (-0.26557635219221642, 0.99114443967015675)
**********************************************************************
1 item had failures:
   1 of   7 in sage.plot.arc.Arc.bezier_path
    [47 tests, 1 failure, 6.77 s]
----------------------------------------------------------------------
sage -t --long src/sage/plot/arc.py  # 1 doctest failed
----------------------------------------------------------------------
```
We do get an arc. The failure is perhaps expected since the original `bezier` graph was incorrect.



---

archive/issue_comments_359461.json:
```json
{
    "body": "<a id='comment:9'></a>\nCould you show the original, so it is clear that the graph was incorrect?",
    "created_at": "2017-12-27T21:37:41Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359461",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Could you show the original, so it is clear that the graph was incorrect?



---

archive/issue_comments_359462.json:
```json
{
    "body": "<a id='comment:160'></a>\nReplying to [fbissey](#comment%3A159):\n> Could you show the original, so it is clear that the graph was incorrect?\n\nHow to show this? The original will appear almost identical but the limits will be different. Let's try a calculation from Sage. With mpl-1.5.3 and the old code we get\n\n```\nsage: b[0]\nBezier path from (1.6180339887498949, 0.58778525229247314) to (-0.51763809020504215, 0.9659258262890682)\n```\n\nWith the revised code using mpl-2.1.0 we get\n\n```\nsage: b[0]\nBezier path from (1.1338305413635981, 0.82377610785199551) to (-0.26557635219221642, 0.99114443967015675)\n```\n\nFrom the above example, the inputs, `theta1` and `theta2` are:\n\n```\nsage: theta1 = float(pi)/5; theta1\n0.6283185307179586\nsage: theta2 = float(pi)/2+float(pi)/12; theta2\n1.832595714594046\n```\n\nThen using mpl-1.5.3 `b[0]` results, the angles are\n\n```\nsage: theta1 = arctan(0.58778525229247314/1.6180339887498949); theta1\n0.3484485055191126\ntheta2 = arctan(0.9659258262890682/-0.51763809020504215) + float(pi); theta2\n2.0627485381367054\n```\nwhich are incorrect.\n\nNow using mpl-2.1.0 `b[0]` results, the angles are\n\n```\nsage: theta1 = arctan(0.82377610785199551/1.1338305413635981); theta1\n0.6283185307179587\nsage: theta2 = arctan(0.99114443967015675/-0.26557635219221642) + float(pi); theta2\n1.8325957145940461\n```\nwhich are correct, to machine accuracy.",
    "created_at": "2017-12-27T22:22:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359462",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:160'></a>
Replying to [fbissey](#comment%3A159):
> Could you show the original, so it is clear that the graph was incorrect?

How to show this? The original will appear almost identical but the limits will be different. Let's try a calculation from Sage. With mpl-1.5.3 and the old code we get

```
sage: b[0]
Bezier path from (1.6180339887498949, 0.58778525229247314) to (-0.51763809020504215, 0.9659258262890682)
```

With the revised code using mpl-2.1.0 we get

```
sage: b[0]
Bezier path from (1.1338305413635981, 0.82377610785199551) to (-0.26557635219221642, 0.99114443967015675)
```

From the above example, the inputs, `theta1` and `theta2` are:

```
sage: theta1 = float(pi)/5; theta1
0.6283185307179586
sage: theta2 = float(pi)/2+float(pi)/12; theta2
1.832595714594046
```

Then using mpl-1.5.3 `b[0]` results, the angles are

```
sage: theta1 = arctan(0.58778525229247314/1.6180339887498949); theta1
0.3484485055191126
theta2 = arctan(0.9659258262890682/-0.51763809020504215) + float(pi); theta2
2.0627485381367054
```
which are incorrect.

Now using mpl-2.1.0 `b[0]` results, the angles are

```
sage: theta1 = arctan(0.82377610785199551/1.1338305413635981); theta1
0.6283185307179587
sage: theta2 = arctan(0.99114443967015675/-0.26557635219221642) + float(pi); theta2
1.8325957145940461
```
which are correct, to machine accuracy.



---

archive/issue_comments_359463.json:
```json
{
    "body": "<a id='comment:1'></a>\nI should have been more careful. The graph isn't correct, is it? The endpoints are not correct. It's because of how things are displayed. Let me think how to correct this?",
    "created_at": "2017-12-27T22:57:51Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359463",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:1'></a>
I should have been more careful. The graph isn't correct, is it? The endpoints are not correct. It's because of how things are displayed. Let me think how to correct this?



---

archive/attachments_020965.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "arc.png",
    "asset_url": "tarball://root/attachments/ticket23696/arc.png",
    "created_at": "2017-12-27T23:13:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/arc.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359464.json:
```json
{
    "body": "Attachment [arc.png](https://github.com/sagemath/sage/files/ticket23696/arc.png) by @strogdon created at 2017-12-27 23:13:04",
    "created_at": "2017-12-27T23:13:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359464",
    "user": "https://github.com/strogdon"
}
```

Attachment [arc.png](https://github.com/sagemath/sage/files/ticket23696/arc.png) by @strogdon created at 2017-12-27 23:13:04



---

archive/attachments_020966.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "bezier.png",
    "asset_url": "tarball://root/attachments/ticket23696/bezier.png",
    "created_at": "2017-12-27T23:14:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/bezier.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359465.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [bezier.png](https://github.com/sagemath/sage/files/ticket23696/bezier.png) by @strogdon created at 2017-12-27 23:14:33\n\nThe code\n\n```\nsage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle=\"--\", color=\"red\")\nsage: a\n```\ndisplays\n\n![](arc.png)\n\nWhile the code\n\n```\nsage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle=\"--\", color=\"red\")\nsage: b = a[0].bezier_path()\nsage: b\n```\ndisplays\n\n![](bezier.png)\n\nPreviously, I was trying to show that these two graphs are the same.",
    "created_at": "2017-12-27T23:14:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359465",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:2'></a>
Attachment [bezier.png](https://github.com/sagemath/sage/files/ticket23696/bezier.png) by @strogdon created at 2017-12-27 23:14:33

The code

```
sage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle="--", color="red")
sage: a
```
displays

![](arc.png)

While the code

```
sage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle="--", color="red")
sage: b = a[0].bezier_path()
sage: b
```
displays

![](bezier.png)

Previously, I was trying to show that these two graphs are the same.



---

archive/issue_comments_359466.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess it would help if they were on the same scale. The current display makes comparison difficult. I can believe they are the same but same scale would definitely look better.",
    "created_at": "2017-12-28T00:02:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359466",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
I guess it would help if they were on the same scale. The current display makes comparison difficult. I can believe they are the same but same scale would definitely look better.



---

archive/issue_comments_359467.json:
```json
{
    "body": "<a id='comment:164'></a>\nReplying to [fbissey](#comment%3A163):\n> I guess it would help if they were on the same scale. The current display makes comparison difficult. I can believe they are the same but same scale would definitely look better.\n\nYes, but that will require some investigating.",
    "created_at": "2017-12-28T00:06:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359467",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:164'></a>
Replying to [fbissey](#comment%3A163):
> I guess it would help if they were on the same scale. The current display makes comparison difficult. I can believe they are the same but same scale would definitely look better.

Yes, but that will require some investigating.



---

archive/attachments_020967.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "new_bezier+arc.png",
    "asset_url": "tarball://root/attachments/ticket23696/92cfa6cfbfa65e4bd039831cc2df1766.png",
    "created_at": "2017-12-28T02:02:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket23696/92cfa6cfbfa65e4bd039831cc2df1766.png",
    "user": "https://github.com/strogdon"
}
```



---

archive/issue_comments_359468.json:
```json
{
    "body": "Attachment [new_bezier+arc.png](https://github.com/sagemath/sage/files/ticket23696/92cfa6cfbfa65e4bd039831cc2df1766.png) by @strogdon created at 2017-12-28 02:02:35",
    "created_at": "2017-12-28T02:02:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359468",
    "user": "https://github.com/strogdon"
}
```

Attachment [new_bezier+arc.png](https://github.com/sagemath/sage/files/ticket23696/92cfa6cfbfa65e4bd039831cc2df1766.png) by @strogdon created at 2017-12-28 02:02:35



---

archive/issue_comments_359469.json:
```json
{
    "body": "<a id='comment:5'></a>\n\n```\nsage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle=\"--\", color=\"red\")\nsage: b = a[0].bezier_path()\nsage: b.aspect_ratio()\n'automatic'\nsage: c = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))\nsage: c.aspect_ratio()\n1.0\nsage: c.set_aspect_ratio('automatic')\nsage: h = c + b\nsage: h\n```\n\n![](new_bezier+arc.png)",
    "created_at": "2017-12-28T02:03:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359469",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>

```
sage: a = arc((0,0),2,1,0,(pi/5,pi/2+pi/12), linestyle="--", color="red")
sage: b = a[0].bezier_path()
sage: b.aspect_ratio()
'automatic'
sage: c = arc((0,0),2,1,0,(pi/5,pi/2+pi/12))
sage: c.aspect_ratio()
1.0
sage: c.set_aspect_ratio('automatic')
sage: h = c + b
sage: h
```

![](new_bezier+arc.png)



---

archive/issue_comments_359470.json:
```json
{
    "body": "<a id='comment:6'></a>\nWe'll have to start moving a bit faster. I will include stuff based on the last work by Steve. I will move all versions of sage in sage-on-gentoo to matplotlib 2.1.0 based on this ticket because 1.5.3 has been dropped.",
    "created_at": "2018-01-06T06:57:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359470",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
We'll have to start moving a bit faster. I will include stuff based on the last work by Steve. I will move all versions of sage in sage-on-gentoo to matplotlib 2.1.0 based on this ticket because 1.5.3 has been dropped.



---

archive/issue_comments_359471.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b732c5f9afe3fc557483d1e457ba5011651d78\">07b732c</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89\">0db7034</a></td><td><code>Add Steve's corrections to arc.py</code></td></tr></table>\n",
    "created_at": "2018-01-06T08:10:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b732c5f9afe3fc557483d1e457ba5011651d78">07b732c</a></td><td><code>Merge branch 'develop' into matplotlib-2.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89">0db7034</a></td><td><code>Add Steve's corrections to arc.py</code></td></tr></table>




---

archive/issue_comments_359472.json:
```json
{
    "body": "**Changing commit** from \"[8f4ca6bfe57c467b5a13594f6699782068cf86c2](https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2)\" to \"[0db703433170a8a266151229194693242499da89](https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89)\".",
    "created_at": "2018-01-06T08:10:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8f4ca6bfe57c467b5a13594f6699782068cf86c2](https://github.com/sagemath/sagetrac-mirror/commit/8f4ca6bfe57c467b5a13594f6699782068cf86c2)" to "[0db703433170a8a266151229194693242499da89](https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89)".



---

archive/issue_comments_359473.json:
```json
{
    "body": "<a id='comment:8'></a>\nPerhaps ready for review? Or is how to deal with the `classic` style still up in the air?",
    "created_at": "2018-01-06T19:12:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359473",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>
Perhaps ready for review? Or is how to deal with the `classic` style still up in the air?



---

archive/issue_events_210687.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-06T19:35:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210687"
}
```



---

archive/issue_events_210688.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-06T19:35:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210688"
}
```



---

archive/issue_comments_359474.json:
```json
{
    "body": "<a id='comment:9'></a>\nThere are still some questions I think, the `classic` style being one of them. But at this stage I think we should move forward and address new stuff in follow up tickets. There is bound to be some.",
    "created_at": "2018-01-06T19:35:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359474",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
There are still some questions I think, the `classic` style being one of them. But at this stage I think we should move forward and address new stuff in follow up tickets. There is bound to be some.



---

archive/issue_comments_359475.json:
```json
{
    "body": "<a id='comment:170'></a>\nReplying to [fbissey](#comment%3A169):\n> There are still some questions I think, the `classic` style being one of them. But at this stage I think we should move forward and address new stuff in follow up tickets. There is bound to be some.\n\n\nThanks for the new commits. I agree that it becomes rather urgent to upgrade to Matplotlib 2.1.0. However, \nsomewhat independently of the `classic` style, there remains the `computer modern` font issue. As suggested by Steve in [comment:129](#comment%3A129), it suffices to change one line (line 274) in the file\n`local/lib/python2.7/site-packages/matplotlib/mpl-data/matplotlibrc`, namely change\n\n```\nmathtext.fontset : dejavusans # Should be 'dejavusans' (default),\n```\nto\n\n```\nmathtext.fontset : cm # Should be 'dejavusans' (default),\n```\nI guess this is feasible in the post-install phase, isn't it?\n\nWithout this, many users who are taking care of plots with nice labels, will be upset. Note that the change of the default to `dejavusans` generated some debate in the Matplotlib community, see e.g. https://github.com/matplotlib/matplotlib/issues/5860/ and https://husky.wordpress.com/2017/02/02/revert-matplotlib-2-0-mathtext-default-font-style-to-computer-modern/ .",
    "created_at": "2018-01-07T11:06:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359475",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:170'></a>
Replying to [fbissey](#comment%3A169):
> There are still some questions I think, the `classic` style being one of them. But at this stage I think we should move forward and address new stuff in follow up tickets. There is bound to be some.


Thanks for the new commits. I agree that it becomes rather urgent to upgrade to Matplotlib 2.1.0. However, 
somewhat independently of the `classic` style, there remains the `computer modern` font issue. As suggested by Steve in [comment:129](#comment%3A129), it suffices to change one line (line 274) in the file
`local/lib/python2.7/site-packages/matplotlib/mpl-data/matplotlibrc`, namely change

```
mathtext.fontset : dejavusans # Should be 'dejavusans' (default),
```
to

```
mathtext.fontset : cm # Should be 'dejavusans' (default),
```
I guess this is feasible in the post-install phase, isn't it?

Without this, many users who are taking care of plots with nice labels, will be upset. Note that the change of the default to `dejavusans` generated some debate in the Matplotlib community, see e.g. https://github.com/matplotlib/matplotlib/issues/5860/ and https://husky.wordpress.com/2017/02/02/revert-matplotlib-2-0-mathtext-default-font-style-to-computer-modern/ .



---

archive/issue_comments_359476.json:
```json
{
    "body": "<a id='comment:1'></a>\nBesides (but this may be delayed to a follow up ticket), I am not sure if we shall use the `classic` style while generating the doc. Actually, this yields many differences with what the user will get in a Sage session, as illustrated in this [matplotlib page](https://matplotlib.org/users/dflt_style_changes.html). I understand that using the `classic` style in `sphinx_plot` was a workaround to get png images generated with a decent quality (in this respect, compare the two images in the section [Interpolation](https://matplotlib.org/users/dflt_style_changes.html#interpolation) of the above page: it is hard to believe that the new default is a progess...). However to restore the png quality, it is not necessary to use the whole `classic` style, but simply to set the parameter `image.interpolation` to `bilinear`, i.e. we could replace the line \n\n```\nplt.style.use('classic')\n```\nin `src/doc/common/conf.py` by\n\n```\nimport matplotlib as mpl\nmpl.rcParams['image.interpolation'] = 'bilinear'\nmpl.rcParams['image.resample'] = False\n```",
    "created_at": "2018-01-07T13:10:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359476",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
Besides (but this may be delayed to a follow up ticket), I am not sure if we shall use the `classic` style while generating the doc. Actually, this yields many differences with what the user will get in a Sage session, as illustrated in this [matplotlib page](https://matplotlib.org/users/dflt_style_changes.html). I understand that using the `classic` style in `sphinx_plot` was a workaround to get png images generated with a decent quality (in this respect, compare the two images in the section [Interpolation](https://matplotlib.org/users/dflt_style_changes.html#interpolation) of the above page: it is hard to believe that the new default is a progess...). However to restore the png quality, it is not necessary to use the whole `classic` style, but simply to set the parameter `image.interpolation` to `bilinear`, i.e. we could replace the line 

```
plt.style.use('classic')
```
in `src/doc/common/conf.py` by

```
import matplotlib as mpl
mpl.rcParams['image.interpolation'] = 'bilinear'
mpl.rcParams['image.resample'] = False
```



---

archive/issue_comments_359477.json:
```json
{
    "body": "<a id='comment:2'></a>\nThere is an option - which is not distro friendly - but could be applied post-install. Replacing the default matplotlibrc by the classic one. Possibly renaming the normal default one to something like default-2.1.0.",
    "created_at": "2018-01-07T19:40:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359477",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
There is an option - which is not distro friendly - but could be applied post-install. Replacing the default matplotlibrc by the classic one. Possibly renaming the normal default one to something like default-2.1.0.



---

archive/issue_comments_359478.json:
```json
{
    "body": "<a id='comment:173'></a>\nReplying to [fbissey](#comment%3A172):\n> There is an option - which is not distro friendly - but could be applied post-install. Replacing the default matplotlibrc by the classic one. Possibly renaming the normal default one to something like default-2.1.0.\n\n\nNote that what I proposed in [comment:170](#comment%3A170) and [comment:171](#comment%3A171) was something weaker: keep the 2.1.0 default style and simply restore the `cm` fonts for math display in plots. \nHowever, what you propose here (i.e. using the `classic` style in all Sage) sounds reasonable to make a smooth transition for the users. This would also allow us to fix all issues with the new default style (in particular, the figure size issues) and use it after the transition period is over.",
    "created_at": "2018-01-08T10:29:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359478",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:173'></a>
Replying to [fbissey](#comment%3A172):
> There is an option - which is not distro friendly - but could be applied post-install. Replacing the default matplotlibrc by the classic one. Possibly renaming the normal default one to something like default-2.1.0.


Note that what I proposed in [comment:170](#comment%3A170) and [comment:171](#comment%3A171) was something weaker: keep the 2.1.0 default style and simply restore the `cm` fonts for math display in plots. 
However, what you propose here (i.e. using the `classic` style in all Sage) sounds reasonable to make a smooth transition for the users. This would also allow us to fix all issues with the new default style (in particular, the figure size issues) and use it after the transition period is over.



---

archive/issue_comments_359479.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca9f8e2679b9acbabf9e07a21c9baae8aaafb8d7\">ca9f8e2</a></td><td><code>make the classic style (from 1.5.3) the default style for now.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521\">41c21c6</a></td><td><code>Add a comment on enforcing the classics style in sphinx_plot for sage-on-distro</code></td></tr></table>\n",
    "created_at": "2018-01-08T19:46:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca9f8e2679b9acbabf9e07a21c9baae8aaafb8d7">ca9f8e2</a></td><td><code>make the classic style (from 1.5.3) the default style for now.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521">41c21c6</a></td><td><code>Add a comment on enforcing the classics style in sphinx_plot for sage-on-distro</code></td></tr></table>




---

archive/issue_comments_359480.json:
```json
{
    "body": "**Changing commit** from \"[0db703433170a8a266151229194693242499da89](https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89)\" to \"[41c21c6ac7a6fd7f2595129b33421ce5fb2c7521](https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521)\".",
    "created_at": "2018-01-08T19:46:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0db703433170a8a266151229194693242499da89](https://github.com/sagemath/sagetrac-mirror/commit/0db703433170a8a266151229194693242499da89)" to "[41c21c6ac7a6fd7f2595129b33421ce5fb2c7521](https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521)".



---

archive/issue_comments_359481.json:
```json
{
    "body": "<a id='comment:5'></a>\nI am not 100% happy about the work around but it will do for now. I apply it pre-install because at the end of the day it is far easier to deal with both python 2 and 3. But post-install would be best as the initial template is parsed and adjusted according to options. In fact it could be best to even bring the template back from 1.5.3 (with adjustments for new options and so on). Someone who is not working remotely should check the results.",
    "created_at": "2018-01-08T19:51:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359481",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I am not 100% happy about the work around but it will do for now. I apply it pre-install because at the end of the day it is far easier to deal with both python 2 and 3. But post-install would be best as the initial template is parsed and adjusted according to options. In fact it could be best to even bring the template back from 1.5.3 (with adjustments for new options and so on). Someone who is not working remotely should check the results.



---

archive/issue_comments_359482.json:
```json
{
    "body": "<a id='comment:176'></a>\nReplying to [fbissey](#comment%3A175):\n> Someone who is not working remotely should check the results.\n\nOK, I'll check this.",
    "created_at": "2018-01-09T07:46:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359482",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:176'></a>
Replying to [fbissey](#comment%3A175):
> Someone who is not working remotely should check the results.

OK, I'll check this.



---

archive/issue_comments_359483.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon, Dima Pasechnik",
    "created_at": "2018-01-09T11:16:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359483",
    "user": "https://github.com/egourgoulhon"
}
```

**Reviewer:** Eric Gourgoulhon, Dima Pasechnik



---

archive/issue_events_210689.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-09T11:16:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210689"
}
```



---

archive/issue_events_210690.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-09T11:16:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210690"
}
```



---

archive/issue_comments_359484.json:
```json
{
    "body": "<a id='comment:7'></a>\nI've checked on a fresh install. Everything is OK, both in the documentation and in Sage sessions (console + Jupyter). \n\nThank you very much for your work on this! IMHO, we can move on --> positive review.",
    "created_at": "2018-01-09T11:16:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359484",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>
I've checked on a fresh install. Everything is OK, both in the documentation and in Sage sessions (console + Jupyter). 

Thank you very much for your work on this! IMHO, we can move on --> positive review.



---

archive/issue_events_210691.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-13T19:40:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210691"
}
```



---

archive/issue_events_210692.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-13T19:40:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210692"
}
```



---

archive/issue_comments_359485.json:
```json
{
    "body": "<a id='comment:8'></a>\n\n```\nsage -t --long --warn-long 78.8 src/sage/plot/arrow.py\n**********************************************************************\nFile \"src/sage/plot/arrow.py\", line 364, in sage.plot.arrow.Arrow._render_on_subplot\nFailed example:\n    two_stroke_re.search(contents) is None\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  18 in sage.plot.arrow.Arrow._render_on_subplot\n    [69 tests, 1 failure, 6.16 s]\n```",
    "created_at": "2018-01-13T19:40:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359485",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>

```
sage -t --long --warn-long 78.8 src/sage/plot/arrow.py
**********************************************************************
File "src/sage/plot/arrow.py", line 364, in sage.plot.arrow.Arrow._render_on_subplot
Failed example:
    two_stroke_re.search(contents) is None
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  18 in sage.plot.arrow.Arrow._render_on_subplot
    [69 tests, 1 failure, 6.16 s]
```



---

archive/issue_comments_359486.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, that's weird, we specifically patch for this test. `@`Eric `@`Dima can you reproduce the error with the branch?",
    "created_at": "2018-01-13T19:57:02Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359486",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
OK, that's weird, we specifically patch for this test. `@`Eric `@`Dima can you reproduce the error with the branch?



---

archive/issue_comments_359487.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK something changed in one of the latest revisions. The matching pattern doesn't work anymore.",
    "created_at": "2018-01-13T22:58:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359487",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
OK something changed in one of the latest revisions. The matching pattern doesn't work anymore.



---

archive/issue_comments_359488.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt looks like there are some changes to `arrow.py` that didn't get committed, that may be the source of the trouble.",
    "created_at": "2018-01-14T03:49:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359488",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
It looks like there are some changes to `arrow.py` that didn't get committed, that may be the source of the trouble.



---

archive/issue_comments_359489.json:
```json
{
    "body": "<a id='comment:182'></a>\nReplying to [fbissey](#comment%3A181):\n> It looks like there are some changes to `arrow.py` that didn't get committed, that may be the source of the trouble.\n\n\nNo they are present, I was looking at a single commit rather than the branch. \n\nWhat did it is the change to \"classic style\". This is annoying, the dashing stuff depends on the style. That makes it a fragile test in my book. I'd like to revisit it a little bit and document what's going on there a bit better.",
    "created_at": "2018-01-14T03:59:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359489",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:182'></a>
Replying to [fbissey](#comment%3A181):
> It looks like there are some changes to `arrow.py` that didn't get committed, that may be the source of the trouble.


No they are present, I was looking at a single commit rather than the branch. 

What did it is the change to "classic style". This is annoying, the dashing stuff depends on the style. That makes it a fragile test in my book. I'd like to revisit it a little bit and document what's going on there a bit better.



---

archive/issue_comments_359490.json:
```json
{
    "body": "<a id='comment:3'></a>\nOK, so I am now trying to insert the notion of matplotlib style sheet inside the plotting system and have it default to classic. I have redone the branch from scratch and I haven't corrected `arrow.py` for the dashing for now. I'd like to be sure I have everything under control.\nI think the 2D plots are OK but I think I am missing a piece of info about 3D. If someone wants to confirm the stuff lives at `u/fbissey/MPL-2.1.0b` and I'll switch the ticket to it if other people think it is a good way to deal with our current issues.",
    "created_at": "2018-01-15T02:52:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359490",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
OK, so I am now trying to insert the notion of matplotlib style sheet inside the plotting system and have it default to classic. I have redone the branch from scratch and I haven't corrected `arrow.py` for the dashing for now. I'd like to be sure I have everything under control.
I think the 2D plots are OK but I think I am missing a piece of info about 3D. If someone wants to confirm the stuff lives at `u/fbissey/MPL-2.1.0b` and I'll switch the ticket to it if other people think it is a good way to deal with our current issues.



---

archive/issue_comments_359491.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor which 3D items should one look? Perhaps incorrectly, but I have applied the changes in `u/fbisey/MPL-2.0b0` on top of this branch and docteting all under `src/sage/plot/`give no failures. Presumably this has the changes in `arrow.py`, at least they appear to be there.",
    "created_at": "2018-01-15T06:15:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359491",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
For which 3D items should one look? Perhaps incorrectly, but I have applied the changes in `u/fbisey/MPL-2.0b0` on top of this branch and docteting all under `src/sage/plot/`give no failures. Presumably this has the changes in `arrow.py`, at least they appear to be there.



---

archive/issue_comments_359492.json:
```json
{
    "body": "<a id='comment:5'></a>\nWith a pure branch MPL-2.1.0b (I am not sure how you applied that on top of MPL-2.1.0) I expect the `arrow.py` doctest to be broken (may be not - it depends on whether or not the previous changes were needed because of the new style sheet).\nI am talking about the quality of the pictures. 2D pictures seems to be OK but I think 3D are a bit small. I suspect I need to apply a style sheet in a different place for 3D plots. I am looking for confirmation of this fact and whether people think it is a good approach.",
    "created_at": "2018-01-15T06:31:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359492",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
With a pure branch MPL-2.1.0b (I am not sure how you applied that on top of MPL-2.1.0) I expect the `arrow.py` doctest to be broken (may be not - it depends on whether or not the previous changes were needed because of the new style sheet).
I am talking about the quality of the pictures. 2D pictures seems to be OK but I think 3D are a bit small. I suspect I need to apply a style sheet in a different place for 3D plots. I am looking for confirmation of this fact and whether people think it is a good approach.



---

archive/issue_comments_359493.json:
```json
{
    "body": "<a id='comment:186'></a>\nReplying to [fbissey](#comment%3A185):\n> I am looking for confirmation of this fact and whether people think it is a good approach.\n\nI am looking at the new branch this morning. I'll be back in touch soon.",
    "created_at": "2018-01-15T09:21:26Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359493",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:186'></a>
Replying to [fbissey](#comment%3A185):
> I am looking for confirmation of this fact and whether people think it is a good approach.

I am looking at the new branch this morning. I'll be back in touch soon.



---

archive/issue_comments_359494.json:
```json
{
    "body": "<a id='comment:7'></a>\nI've installed MPL-2.1.0 from scratch by pulling the new branch `u/fbisey/MPL-2.0b0` (commit d109b7593) in a fresh Sage 8.2.beta2 (just built from a fresh git clone). I confirm that the 3D plots in the doc are of low quality, while the 2D ones are OK. I also confirm that the doctest failure pointed out by Volker in [comment:178](#comment%3A178) is still there (not surprising since in [comment:183](#comment%3A183), you say it is not corrected yet).",
    "created_at": "2018-01-15T10:37:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359494",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>
I've installed MPL-2.1.0 from scratch by pulling the new branch `u/fbisey/MPL-2.0b0` (commit d109b7593) in a fresh Sage 8.2.beta2 (just built from a fresh git clone). I confirm that the 3D plots in the doc are of low quality, while the 2D ones are OK. I also confirm that the doctest failure pointed out by Volker in [comment:178](#comment%3A178) is still there (not surprising since in [comment:183](#comment%3A183), you say it is not corrected yet).



---

archive/issue_comments_359495.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. Next we'll to work out what's happening with `arrow.py`.",
    "created_at": "2018-01-15T11:00:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359495",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
I think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. Next we'll to work out what's happening with `arrow.py`.



---

archive/issue_comments_359496.json:
```json
{
    "body": "<a id='comment:189'></a>\nReplying to [fbissey](#comment%3A188):\n> I think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. \n\n\nAs I suggested in [comment:171](#comment%3A171), maybe it is not necessary to change the style in `sphinx_plot` but\nsimply insert the lines\n\n```\nimport matplotlib as mpl\nmpl.rcParams['image.interpolation'] = 'bilinear'\nmpl.rcParams['image.resample'] = False\n```\njust after\n\n```\nimport matplotlib.pyplot as plt\n```\nin the code of `sphinx_plot`.",
    "created_at": "2018-01-15T11:14:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359496",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:189'></a>
Replying to [fbissey](#comment%3A188):
> I think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. 


As I suggested in [comment:171](#comment%3A171), maybe it is not necessary to change the style in `sphinx_plot` but
simply insert the lines

```
import matplotlib as mpl
mpl.rcParams['image.interpolation'] = 'bilinear'
mpl.rcParams['image.resample'] = False
```
just after

```
import matplotlib.pyplot as plt
```
in the code of `sphinx_plot`.



---

archive/issue_comments_359497.json:
```json
{
    "body": "<a id='comment:0'></a>\nhas anyone looked into using GR backend of Mathplotlib in Sage:\nhttps://gr-framework.org/tutorials/matplotlib.html ?",
    "created_at": "2018-01-15T12:02:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359497",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
has anyone looked into using GR backend of Mathplotlib in Sage:
https://gr-framework.org/tutorials/matplotlib.html ?



---

archive/issue_comments_359498.json:
```json
{
    "body": "<a id='comment:191'></a>\nReplying to [dimpase](#comment%3A190):\n> has anyone looked into using GR backend of Mathplotlib in Sage:\n> https://gr-framework.org/tutorials/matplotlib.html ? \n\n\nNot here at any rates. Feel free to submit a new optional/experimental package. That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.",
    "created_at": "2018-01-15T19:46:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359498",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:191'></a>
Replying to [dimpase](#comment%3A190):
> has anyone looked into using GR backend of Mathplotlib in Sage:
> https://gr-framework.org/tutorials/matplotlib.html ? 


Not here at any rates. Feel free to submit a new optional/experimental package. That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.



---

archive/issue_comments_359499.json:
```json
{
    "body": "<a id='comment:192'></a>\nReplying to [egourgoulhon](#comment%3A189):\n> Replying to [fbissey](#comment%3A188):\n> > I think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. \n\n> \n> As I suggested in [comment:171](#comment%3A171), maybe it is not necessary to change the style in `sphinx_plot` but\n> simply insert the lines\n> \n> ```\n> import matplotlib as mpl\n> mpl.rcParams['image.interpolation'] = 'bilinear'\n> mpl.rcParams['image.resample'] = False\n> ```\n> just after\n> \n> ```\n> import matplotlib.pyplot as plt\n> ```\n> in the code of `sphinx_plot`.\n\n\nYes, probably less ham-fisted. Although I'll check the interpolation to match the classic style.",
    "created_at": "2018-01-15T19:48:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359499",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:192'></a>
Replying to [egourgoulhon](#comment%3A189):
> Replying to [fbissey](#comment%3A188):
> > I think I understand now. 2D figures are directly produced by matplotlib but not 3D ones. For 3D an external program like jmol, tachyon or other is used. But for saving while doing the doc they are dumped from the external application to matplotlib. The only place for applying the style is `sphinx_plot`. 

> 
> As I suggested in [comment:171](#comment%3A171), maybe it is not necessary to change the style in `sphinx_plot` but
> simply insert the lines
> 
> ```
> import matplotlib as mpl
> mpl.rcParams['image.interpolation'] = 'bilinear'
> mpl.rcParams['image.resample'] = False
> ```
> just after
> 
> ```
> import matplotlib.pyplot as plt
> ```
> in the code of `sphinx_plot`.


Yes, probably less ham-fisted. Although I'll check the interpolation to match the classic style.



---

archive/issue_comments_359500.json:
```json
{
    "body": "<a id='comment:193'></a>\nReplying to [fbissey](#comment%3A191):\n\n> That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.\n\n\nI cannot recall the exact context of this. I do have trouble with scipy+qhull on FreeBSD, is it what you mean, or is it something else?",
    "created_at": "2018-01-15T20:10:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:193'></a>
Replying to [fbissey](#comment%3A191):

> That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.


I cannot recall the exact context of this. I do have trouble with scipy+qhull on FreeBSD, is it what you mean, or is it something else?



---

archive/issue_comments_359501.json:
```json
{
    "body": "<a id='comment:4'></a>\nI finally got the new branch going. I always forget to `make doc-clean && make` to make sure the new matplotlib is used everywhere. The 3D are poorer quality and, if I've done things correctly, the generated `.png`s are smaller - 512 x 384 compared to 640 x 480. I believe this was mentioned somewhere.",
    "created_at": "2018-01-15T20:21:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359501",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
I finally got the new branch going. I always forget to `make doc-clean && make` to make sure the new matplotlib is used everywhere. The 3D are poorer quality and, if I've done things correctly, the generated `.png`s are smaller - 512 x 384 compared to 640 x 480. I believe this was mentioned somewhere.



---

archive/issue_comments_359502.json:
```json
{
    "body": "<a id='comment:195'></a>\nReplying to [dimpase](#comment%3A193):\n> Replying to [fbissey](#comment%3A191):\n> \n> > That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.\n\n> \n> I cannot recall the exact context of this. I do have trouble with scipy+qhull on FreeBSD, is it what you mean, or is it something else?\n\n\nThe problem is that `matplotlib` has its own copy of `qhull` but will happily use an already installed one. But the current spkg doesn't install library with names that `matplotlib` knows about. It detects `qhull` presence by headers and then fails to build because it cannot link. It is possible the issue with `scipy` is similar as `scipy` also ships its own `qhull`.",
    "created_at": "2018-01-15T21:15:38Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359502",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:195'></a>
Replying to [dimpase](#comment%3A193):
> Replying to [fbissey](#comment%3A191):
> 
> > That reminds me, I have to do something about the optional `qhull` spkg. Did you end up opening a ticket for it? We need to switch it from the custom basic makefile to cmake to fix your issues with it properly.

> 
> I cannot recall the exact context of this. I do have trouble with scipy+qhull on FreeBSD, is it what you mean, or is it something else?


The problem is that `matplotlib` has its own copy of `qhull` but will happily use an already installed one. But the current spkg doesn't install library with names that `matplotlib` knows about. It detects `qhull` presence by headers and then fails to build because it cannot link. It is possible the issue with `scipy` is similar as `scipy` also ships its own `qhull`.



---

archive/issue_comments_359503.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/MPL-2.1.0](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0)\" to \"[u/fbissey/MPL-2.1.0b](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0b)\".",
    "created_at": "2018-01-15T21:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359503",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/fbissey/MPL-2.1.0](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0)" to "[u/fbissey/MPL-2.1.0b](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0b)".



---

archive/issue_comments_359504.json:
```json
{
    "body": "**Work_Issues:** fix arrow.py and move qhull to cmake",
    "created_at": "2018-01-15T21:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359504",
    "user": "https://github.com/kiwifb"
}
```

**Work_Issues:** fix arrow.py and move qhull to cmake



---

archive/issue_comments_359505.json:
```json
{
    "body": "**Changing commit** from \"[41c21c6ac7a6fd7f2595129b33421ce5fb2c7521](https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521)\" to \"[9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424](https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424)\".",
    "created_at": "2018-01-15T21:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359505",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[41c21c6ac7a6fd7f2595129b33421ce5fb2c7521](https://github.com/sagemath/sagetrac-mirror/commit/41c21c6ac7a6fd7f2595129b33421ce5fb2c7521)" to "[9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424](https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424)".



---

archive/issue_comments_359506.json:
```json
{
    "body": "<a id='comment:6'></a>\nSwitch the active branch on trac. 3D plots should look nice now. Still have to fix arrow.py again. Possibly do qhull as well.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c5d53c1f537acf545a0c6579feef1cff7cd541a\">3c5d53c</a></td><td><code>Rebase MPL-2.1.0 upgrade branch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d109b7593ef7d1e8d3e234d554524e99c7e92b5e\">d109b75</a></td><td><code>WIP on inserting matplotlib style sheet as a plot option and defaulting it to classic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424\">9b90efa</a></td><td><code>Set matplotlib options in sphinx_plot so that 3D plots look nice again.</code></td></tr></table>\n",
    "created_at": "2018-01-15T21:33:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359506",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Switch the active branch on trac. 3D plots should look nice now. Still have to fix arrow.py again. Possibly do qhull as well.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c5d53c1f537acf545a0c6579feef1cff7cd541a">3c5d53c</a></td><td><code>Rebase MPL-2.1.0 upgrade branch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d109b7593ef7d1e8d3e234d554524e99c7e92b5e">d109b75</a></td><td><code>WIP on inserting matplotlib style sheet as a plot option and defaulting it to classic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424">9b90efa</a></td><td><code>Set matplotlib options in sphinx_plot so that 3D plots look nice again.</code></td></tr></table>




---

archive/issue_comments_359507.json:
```json
{
    "body": "<a id='comment:7'></a>\nI believe now when the arrowhead is drawn with `linestyle='dashed'` that the following will match\n\n```\nsage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash.*setdash'\n```\nand it will not match when the arrowhead is draw solid. To draw the arrowhead with `linestyle='dashed'` I did\n\n```diff\ndiff --git a/src/sage/plot/arrow.py b/src/sage/plot/arrow.py\nindex f8d1e033f7..596a4ab3bf 100644\n--- a/src/sage/plot/arrow.py\n+++ b/src/sage/plot/arrow.py\n@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):\n                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)\n \n             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])\n-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])\n+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke()])\n             p.set_path_effects([pe1, pe2])\n \n         subplot.add_patch(p)\n```\nThere may be a better way to do this.",
    "created_at": "2018-01-15T21:55:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359507",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:7'></a>
I believe now when the arrowhead is drawn with `linestyle='dashed'` that the following will match

```
sage: two_stroke_pattern = r'setdash.*stroke.*stroke.*setdash.*setdash'
```
and it will not match when the arrowhead is draw solid. To draw the arrowhead with `linestyle='dashed'` I did

```diff
diff --git a/src/sage/plot/arrow.py b/src/sage/plot/arrow.py
index f8d1e033f7..596a4ab3bf 100644
--- a/src/sage/plot/arrow.py
+++ b/src/sage/plot/arrow.py
@@ -437,7 +437,7 @@ class Arrow(GraphicPrimitive):
                             pe1.draw_path(renderer, gc, tpath, affine, rgbFace)
 
             pe1 = ConditionalStroke(CheckNthSubPath(p, 0), [pe.Stroke()])
-            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke(dashes={'dash_offset': 0, 'dash_list': None})])
+            pe2 = ConditionalStroke(CheckNthSubPath(p, 1), [pe.Stroke()])
             p.set_path_effects([pe1, pe2])
 
         subplot.add_patch(p)
```
There may be a better way to do this.



---

archive/issue_comments_359508.json:
```json
{
    "body": "**Changing commit** from \"[9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424](https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424)\" to \"[4005ec3dae5ab697d215d084d1e7bddea7ff110e](https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e)\".",
    "created_at": "2018-01-16T01:49:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359508",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424](https://github.com/sagemath/sagetrac-mirror/commit/9b90efadd3a8aa3dfc2ecd77c3f8e538f20cf424)" to "[4005ec3dae5ab697d215d084d1e7bddea7ff110e](https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e)".



---

archive/issue_comments_359509.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e\">4005ec3</a></td><td><code>Fix the arrow matching pattern</code></td></tr></table>\n",
    "created_at": "2018-01-16T01:49:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359509",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e">4005ec3</a></td><td><code>Fix the arrow matching pattern</code></td></tr></table>




---

archive/issue_comments_359510.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0\">3ea7b16</a></td><td><code>build qhull with cmake instead of custom script. This install can then be used by matplotlib.</code></td></tr></table>\n",
    "created_at": "2018-01-16T07:24:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0">3ea7b16</a></td><td><code>build qhull with cmake instead of custom script. This install can then be used by matplotlib.</code></td></tr></table>




---

archive/issue_comments_359511.json:
```json
{
    "body": "**Changing commit** from \"[4005ec3dae5ab697d215d084d1e7bddea7ff110e](https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e)\" to \"[3ea7b1646ea138caf8e6b3651509c4711089cea0](https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0)\".",
    "created_at": "2018-01-16T07:24:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4005ec3dae5ab697d215d084d1e7bddea7ff110e](https://github.com/sagemath/sagetrac-mirror/commit/4005ec3dae5ab697d215d084d1e7bddea7ff110e)" to "[3ea7b1646ea138caf8e6b3651509c4711089cea0](https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0)".



---

archive/issue_comments_359512.json:
```json
{
    "body": "**Changing work_issues** from \"fix arrow.py and move qhull to cmake\" to \"\".",
    "created_at": "2018-01-16T07:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359512",
    "user": "https://github.com/kiwifb"
}
```

**Changing work_issues** from "fix arrow.py and move qhull to cmake" to "".



---

archive/issue_events_210693.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-16T07:25:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210693"
}
```



---

archive/issue_events_210694.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-16T07:25:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210694"
}
```



---

archive/issue_comments_359513.json:
```json
{
    "body": "<a id='comment:0'></a>\nBonus, building with optional qhull spkg now works.  So one more time in review!",
    "created_at": "2018-01-16T07:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359513",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Bonus, building with optional qhull spkg now works.  So one more time in review!



---

archive/issue_comments_359514.json:
```json
{
    "body": "<a id='comment:201'></a>\nReplying to [fbissey](#comment%3A200):\n> Bonus, building with optional qhull spkg now works.  So one more time in review!\n\n\nThank you Fr\u00e9d\u00e9ric!\nThe 3D plots in the doc are now of good quality; however they are a little bit too small, which makes the axis labels difficult to read. To recover the same size as in Sage 8.1, it suffices to set some parameters in `sphinx_plot`. Following [these suggestions](https://matplotlib.org/users/dflt_style_changes.html#figure-size-font-size-and-screen-dpi), I've tried \n\n```diff\ndiff --git a/src/doc/common/conf.py b/src/doc/common/conf.py\nindex 5acdcda..3a6b650 100644\n--- a/src/doc/common/conf.py\n+++ b/src/doc/common/conf.py\n@@ -26,9 +26,12 @@ def sphinx_plot(plot):\n     from sage.misc.temporary_file import tmp_filename\n     import matplotlib.pyplot as plt\n     import matplotlib as mpl\n-    mpl.rcParams['image.interpolation'] = 'bilinear'\n-    mpl.rcParams['image.resample'] = False\n     if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':\n+        mpl.rcParams['image.interpolation'] = 'bilinear'\n+        mpl.rcParams['image.resample'] = False\n+        mpl.rcParams['figure.figsize'] = [8.0, 6.0]\n+        mpl.rcParams['figure.dpi'] = 80\n+        mpl.rcParams['savefig.dpi'] = 100\n         fn = tmp_filename(ext=\".png\")\n         plot.plot().save(fn)\n         img = mpimg.imread(fn)\n```\nand it works well: the original (i.e. Sage 8.1) size is restored (side note: all settings of `mpl.rcParams` are moved to the `if` block, for there is no need to run them if no plot is to be generated).",
    "created_at": "2018-01-16T10:03:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359514",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:201'></a>
Replying to [fbissey](#comment%3A200):
> Bonus, building with optional qhull spkg now works.  So one more time in review!


Thank you Fr√©d√©ric!
The 3D plots in the doc are now of good quality; however they are a little bit too small, which makes the axis labels difficult to read. To recover the same size as in Sage 8.1, it suffices to set some parameters in `sphinx_plot`. Following [these suggestions](https://matplotlib.org/users/dflt_style_changes.html#figure-size-font-size-and-screen-dpi), I've tried 

```diff
diff --git a/src/doc/common/conf.py b/src/doc/common/conf.py
index 5acdcda..3a6b650 100644
--- a/src/doc/common/conf.py
+++ b/src/doc/common/conf.py
@@ -26,9 +26,12 @@ def sphinx_plot(plot):
     from sage.misc.temporary_file import tmp_filename
     import matplotlib.pyplot as plt
     import matplotlib as mpl
-    mpl.rcParams['image.interpolation'] = 'bilinear'
-    mpl.rcParams['image.resample'] = False
     if os.environ.get('SAGE_SKIP_PLOT_DIRECTIVE', 'no') != 'yes':
+        mpl.rcParams['image.interpolation'] = 'bilinear'
+        mpl.rcParams['image.resample'] = False
+        mpl.rcParams['figure.figsize'] = [8.0, 6.0]
+        mpl.rcParams['figure.dpi'] = 80
+        mpl.rcParams['savefig.dpi'] = 100
         fn = tmp_filename(ext=".png")
         plot.plot().save(fn)
         img = mpimg.imread(fn)
```
and it works well: the original (i.e. Sage 8.1) size is restored (side note: all settings of `mpl.rcParams` are moved to the `if` block, for there is no need to run them if no plot is to be generated).



---

archive/issue_comments_359515.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt's Fran\u00e7ois actually, not Frederick. Anyway it starts to fell like setting the style would be shorter but I don't really mind that much at this stage. Incoming.",
    "created_at": "2018-01-16T10:07:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359515",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
It's Fran√ßois actually, not Frederick. Anyway it starts to fell like setting the style would be shorter but I don't really mind that much at this stage. Incoming.



---

archive/issue_comments_359516.json:
```json
{
    "body": "<a id='comment:203'></a>\nReplying to [fbissey](#comment%3A202):\n> It's Fran\u00e7ois actually, not Frederick. \n\nMy apologies about this! I know it is Fran\u00e7ois, but I had just sent an e-mail to a real Fr\u00e9d\u00e9ric, so I was still in some \"Fr\u00e9d\u00e9ric mode\".",
    "created_at": "2018-01-16T10:10:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359516",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:203'></a>
Replying to [fbissey](#comment%3A202):
> It's Fran√ßois actually, not Frederick. 

My apologies about this! I know it is Fran√ßois, but I had just sent an e-mail to a real Fr√©d√©ric, so I was still in some "Fr√©d√©ric mode".



---

archive/issue_comments_359517.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040\">3a6792e</a></td><td><code>Setting more parameters in sphinx_plot for better 3D documentation</code></td></tr></table>\n",
    "created_at": "2018-01-16T10:20:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040">3a6792e</a></td><td><code>Setting more parameters in sphinx_plot for better 3D documentation</code></td></tr></table>




---

archive/issue_comments_359518.json:
```json
{
    "body": "**Changing commit** from \"[3ea7b1646ea138caf8e6b3651509c4711089cea0](https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0)\" to \"[3a6792ea300002114fc701acfb14ea52f72fe040](https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040)\".",
    "created_at": "2018-01-16T10:20:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3ea7b1646ea138caf8e6b3651509c4711089cea0](https://github.com/sagemath/sagetrac-mirror/commit/3ea7b1646ea138caf8e6b3651509c4711089cea0)" to "[3a6792ea300002114fc701acfb14ea52f72fe040](https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040)".



---

archive/issue_comments_359519.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.\nMoreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?",
    "created_at": "2018-01-16T10:47:45Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359519",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>
Thanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.
Moreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?



---

archive/issue_events_210695.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-16T10:47:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210695"
}
```



---

archive/issue_events_210696.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-16T10:47:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210696"
}
```



---

archive/issue_comments_359520.json:
```json
{
    "body": "<a id='comment:206'></a>\nReplying to [fbissey](#comment%3A200):\n> Bonus, building with optional qhull spkg now works.  So one more time in review!\n\n\nI think we need a follow-up ticket for the following:\n\nIt seems that we need `sdh_cmake` in addition to `sdh_configure` etc we already have in\n`src/bin/sage-dist-helpers`. This would make `spkg-install` scripts where `cmake` is used more uniform and less verbose.\n\nAnd `spkg-install` ought to use already available `sdh_*` things, too.\nE.g. after `cmake` call one would only need something like\n\n```\nsdh_make\nsdh_make_install\n```",
    "created_at": "2018-01-16T10:52:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359520",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:206'></a>
Replying to [fbissey](#comment%3A200):
> Bonus, building with optional qhull spkg now works.  So one more time in review!


I think we need a follow-up ticket for the following:

It seems that we need `sdh_cmake` in addition to `sdh_configure` etc we already have in
`src/bin/sage-dist-helpers`. This would make `spkg-install` scripts where `cmake` is used more uniform and less verbose.

And `spkg-install` ought to use already available `sdh_*` things, too.
E.g. after `cmake` call one would only need something like

```
sdh_make
sdh_make_install
```



---

archive/issue_comments_359521.json:
```json
{
    "body": "<a id='comment:207'></a>\nReplying to [egourgoulhon](#comment%3A205):\n> Thanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.\n> Moreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?\n\n\nDo we want an OSX test?",
    "created_at": "2018-01-16T10:52:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359521",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:207'></a>
Replying to [egourgoulhon](#comment%3A205):
> Thanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.
> Moreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?


Do we want an OSX test?



---

archive/issue_comments_359522.json:
```json
{
    "body": "<a id='comment:208'></a>\nReplying to [dimpase](#comment%3A206):\n> Replying to [fbissey](#comment%3A200):\n> > Bonus, building with optional qhull spkg now works.  So one more time in review!\n\n> \n> I think we need a follow-up ticket for the following:\n> \n> It seems that we need `sdh_cmake` in addition to `sdh_configure` etc we already have in\n> `src/bin/sage-dist-helpers`. This would make `spkg-install` scripts where `cmake` is used more uniform and less verbose.\n> \n\n\nSure, but I think we'll only get traction on that when cmake is standard. But I thought strongly about it too.\n\n> And `spkg-install` ought to use already available `sdh_*` things, too.\n> E.g. after `cmake` call one would only need something like\n> \n> ```\n> sdh_make\n> sdh_make_install\n> ```\n\n\nI should have thought of that. I'll just tweak it.",
    "created_at": "2018-01-16T10:55:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359522",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:208'></a>
Replying to [dimpase](#comment%3A206):
> Replying to [fbissey](#comment%3A200):
> > Bonus, building with optional qhull spkg now works.  So one more time in review!

> 
> I think we need a follow-up ticket for the following:
> 
> It seems that we need `sdh_cmake` in addition to `sdh_configure` etc we already have in
> `src/bin/sage-dist-helpers`. This would make `spkg-install` scripts where `cmake` is used more uniform and less verbose.
> 


Sure, but I think we'll only get traction on that when cmake is standard. But I thought strongly about it too.

> And `spkg-install` ought to use already available `sdh_*` things, too.
> E.g. after `cmake` call one would only need something like
> 
> ```
> sdh_make
> sdh_make_install
> ```


I should have thought of that. I'll just tweak it.



---

archive/issue_comments_359523.json:
```json
{
    "body": "<a id='comment:209'></a>\nReplying to [dimpase](#comment%3A207):\n> Replying to [egourgoulhon](#comment%3A205):\n> > Thanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.\n> > Moreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?\n\n> \n> Do we want an OSX test?\n\n\nYes please. I am not expecting any bad things but I like some insurance.",
    "created_at": "2018-01-16T10:56:16Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359523",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:209'></a>
Replying to [dimpase](#comment%3A207):
> Replying to [egourgoulhon](#comment%3A205):
> > Thanks for the change in `sphinx_plot`. The 3D plots in the doc are OK now.
> > Moreover, `make ptestlong` reveals no error. Hence positive review. Dima, do you agree?

> 
> Do we want an OSX test?


Yes please. I am not expecting any bad things but I like some insurance.



---

archive/issue_events_210697.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2018-01-16T10:59:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210697"
}
```



---

archive/issue_events_210698.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2018-01-16T10:59:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210698"
}
```



---

archive/issue_comments_359524.json:
```json
{
    "body": "**Changing commit** from \"[3a6792ea300002114fc701acfb14ea52f72fe040](https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040)\" to \"[929509edcfe5278337087f280222fc9b7bb10bbd](https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd)\".",
    "created_at": "2018-01-16T10:59:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3a6792ea300002114fc701acfb14ea52f72fe040](https://github.com/sagemath/sagetrac-mirror/commit/3a6792ea300002114fc701acfb14ea52f72fe040)" to "[929509edcfe5278337087f280222fc9b7bb10bbd](https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd)".



---

archive/issue_comments_359525.json:
```json
{
    "body": "<a id='comment:0'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd\">929509e</a></td><td><code>use helper scripts in qhull</code></td></tr></table>\n",
    "created_at": "2018-01-16T10:59:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd">929509e</a></td><td><code>use helper scripts in qhull</code></td></tr></table>




---

archive/issue_comments_359526.json:
```json
{
    "body": "<a id='comment:1'></a>\nprobably something for another follow-up ticket. Running headless on OSX 10.13, atop of the clang branch (from the epic clang ticket), I get\n\n```\nsage -t --long --warn-long 476.0 src/sage/plot/plot.py\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 464, in sage.plot.plot\nFailed example:\n    P = plt.plot(t, s, linewidth=1.0)\nExpected nothing\nGot:\n    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.\n```\nwhich looks like a regression to me.\n\nIt can be reproduced at Sage prompt.",
    "created_at": "2018-01-16T17:48:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359526",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
probably something for another follow-up ticket. Running headless on OSX 10.13, atop of the clang branch (from the epic clang ticket), I get

```
sage -t --long --warn-long 476.0 src/sage/plot/plot.py
**********************************************************************
File "src/sage/plot/plot.py", line 464, in sage.plot.plot
Failed example:
    P = plt.plot(t, s, linewidth=1.0)
Expected nothing
Got:
    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.
```
which looks like a regression to me.

It can be reproduced at Sage prompt.



---

archive/issue_comments_359527.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt feels like on OS X matplotlib may want to default the renderer to something OS X specific. I am assuming you have a batch of those, not just the one? This is similar to stuff solved by this patch [https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch) in debian and I think there was ticket on trac about `DISPLAY` recently.",
    "created_at": "2018-01-16T19:30:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359527",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
It feels like on OS X matplotlib may want to default the renderer to something OS X specific. I am assuming you have a batch of those, not just the one? This is similar to stuff solved by this patch [https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch) in debian and I think there was ticket on trac about `DISPLAY` recently.



---

archive/issue_comments_359528.json:
```json
{
    "body": "<a id='comment:3'></a>\nIs `SAGE_MATPLOTLIB_GUI` set to `no` when you build headless? If not you should.",
    "created_at": "2018-01-16T19:52:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359528",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Is `SAGE_MATPLOTLIB_GUI` set to `no` when you build headless? If not you should.



---

archive/issue_comments_359529.json:
```json
{
    "body": "<a id='comment:214'></a>\nReplying to [fbissey](#comment%3A212):\n> It feels like on OS X matplotlib may want to default the renderer to something OS X specific. I am assuming you have a batch of those, not just the one? \n\n\nno, it happens just once; while I test `src/sage/plot` I get just one error. At the Sage prompt I get\n\n```\nsage: import pylab as plt\nsage: t = plt.arange(0.0, 2.0, 0.01)\nsage: s = sin(2*pi*t)\nsage: P = plt.plot(t, s)\n_RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.\n```\n\nIt's some kind of initialisation error: if I re-run the last line then no 2nd error message is shown.\n\nNote that it is indeed similar to this:\n\n>This is similar to stuff solved by this patch [https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch) in debian and I think there was ticket on trac about `DISPLAY` recently.\n\n\nIf I run (in a fresh Sage session)\n\n```\nsage: import matplotlib; matplotlib.use('Agg')\nsage: import pylab as plt\nsage: t = plt.arange(0.0, 2.0, 0.01)\nsage: s = sin(2*pi*t)\nsage: P = plt.plot(t, s)\n```\nI see no error message.\n\n---\nThis could be a clang-only issue, I don't know.",
    "created_at": "2018-01-16T22:44:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359529",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:214'></a>
Replying to [fbissey](#comment%3A212):
> It feels like on OS X matplotlib may want to default the renderer to something OS X specific. I am assuming you have a batch of those, not just the one? 


no, it happens just once; while I test `src/sage/plot` I get just one error. At the Sage prompt I get

```
sage: import pylab as plt
sage: t = plt.arange(0.0, 2.0, 0.01)
sage: s = sin(2*pi*t)
sage: P = plt.plot(t, s)
_RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.
```

It's some kind of initialisation error: if I re-run the last line then no 2nd error message is shown.

Note that it is indeed similar to this:

>This is similar to stuff solved by this patch [https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch](https://anonscm.debian.org/cgit/debian-science/packages/sagemath.git/tree/debian/patches/u1-fix-dont-require-DISPLAY.patch) in debian and I think there was ticket on trac about `DISPLAY` recently.


If I run (in a fresh Sage session)

```
sage: import matplotlib; matplotlib.use('Agg')
sage: import pylab as plt
sage: t = plt.arange(0.0, 2.0, 0.01)
sage: s = sin(2*pi*t)
sage: P = plt.plot(t, s)
```
I see no error message.

---
This could be a clang-only issue, I don't know.



---

archive/issue_comments_359530.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK, surprising but then debian didn't patch every single call either. It would be nice to figure the trigger for a window.",
    "created_at": "2018-01-16T22:48:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359530",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
OK, surprising but then debian didn't patch every single call either. It would be nice to figure the trigger for a window.



---

archive/issue_comments_359531.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt comes somewhere from the dark depths of matplotlib, this error message.\nPerhaps just add \n\n```\nimport matplotlib; matplotlib.use('Agg')\n``` \nright before this doctest and be done with?",
    "created_at": "2018-01-16T22:56:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359531",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
It comes somewhere from the dark depths of matplotlib, this error message.
Perhaps just add 

```
import matplotlib; matplotlib.use('Agg')
``` 
right before this doctest and be done with?



---

archive/issue_comments_359532.json:
```json
{
    "body": "<a id='comment:217'></a>\nReplying to [dimpase](#comment%3A216):\n> It comes somewhere from the dark depths of matplotlib, this error message.\n> Perhaps just add \n> \n> ```\n> import matplotlib; matplotlib.use('Agg')\n> ``` \n> right before this doctest and be done with? \n\n\nSure, but in that case, I'll do the debian guys a favor and fix theirs too.",
    "created_at": "2018-01-16T23:41:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359532",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:217'></a>
Replying to [dimpase](#comment%3A216):
> It comes somewhere from the dark depths of matplotlib, this error message.
> Perhaps just add 
> 
> ```
> import matplotlib; matplotlib.use('Agg')
> ``` 
> right before this doctest and be done with? 


Sure, but in that case, I'll do the debian guys a favor and fix theirs too.



---

archive/issue_comments_359533.json:
```json
{
    "body": "<a id='comment:8'></a>\nBy the way, what we see here on OSX is pure matplotlib issue. In `./sage --ipython` I see this error message just as well.\n\n```\nIn [1]: import pylab as plt\n\nIn [2]: t = plt.arange(0.0, 2.0, 0.01)\n\nIn [3]: plt.plot(t,t)\n_RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.\nOut[3]: [<matplotlib.lines.Line2D at 0x10d1446d0>]\n\nIn [4]: plt.plot(t,t)\nOut[4]: [<matplotlib.lines.Line2D at 0x10d188a90>]\n\n```",
    "created_at": "2018-01-16T23:59:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359533",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
By the way, what we see here on OSX is pure matplotlib issue. In `./sage --ipython` I see this error message just as well.

```
In [1]: import pylab as plt

In [2]: t = plt.arange(0.0, 2.0, 0.01)

In [3]: plt.plot(t,t)
_RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.
Out[3]: [<matplotlib.lines.Line2D at 0x10d1446d0>]

In [4]: plt.plot(t,t)
Out[4]: [<matplotlib.lines.Line2D at 0x10d188a90>]

```



---

archive/issue_comments_359534.json:
```json
{
    "body": "<a id='comment:9'></a>\nI never doubted it. I am also quite sure that if you build matplotlib with `SAGE_MATPLOTLIB_GUI=no` you'll be in the clear too. Because that's probably linked to the `macosx` backend like the debian guy issue wouldn't happen if they weren't building all the possible GUI backends.",
    "created_at": "2018-01-17T00:02:39Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359534",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I never doubted it. I am also quite sure that if you build matplotlib with `SAGE_MATPLOTLIB_GUI=no` you'll be in the clear too. Because that's probably linked to the `macosx` backend like the debian guy issue wouldn't happen if they weren't building all the possible GUI backends.



---

archive/issue_comments_359535.json:
```json
{
    "body": "<a id='comment:220'></a>\nReplying to [fbissey](#comment%3A219):\n> I never doubted it. I am also quite sure that if you build matplotlib with `SAGE_MATPLOTLIB_GUI=no` you'll be in the clear too. Because that's probably linked to the `macosx` backend like the debian guy issue wouldn't happen if they weren't building all the possible GUI backends.\n\nWith `matplotlib-1.5.1` the default Sage backend was `agg`. Now with 2.1.0 the default is `tkagg`. So maybe there is something wrong with `tkagg`.",
    "created_at": "2018-01-17T00:06:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359535",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:220'></a>
Replying to [fbissey](#comment%3A219):
> I never doubted it. I am also quite sure that if you build matplotlib with `SAGE_MATPLOTLIB_GUI=no` you'll be in the clear too. Because that's probably linked to the `macosx` backend like the debian guy issue wouldn't happen if they weren't building all the possible GUI backends.

With `matplotlib-1.5.1` the default Sage backend was `agg`. Now with 2.1.0 the default is `tkagg`. So maybe there is something wrong with `tkagg`.



---

archive/issue_comments_359536.json:
```json
{
    "body": "<a id='comment:1'></a>\nReally my last build shows that in `matplotlibrc` I have (without doing any special GUI settings)\n\n```\n#### CONFIGURATION BEGINS HERE\n\n# The default backend; one of GTK GTKAgg GTKCairo GTK3Agg GTK3Cairo\n# MacOSX Qt4Agg Qt5Agg TkAgg WX WXAgg Agg Cairo GDK PS PDF SVG\n# Template.\n# You can also deploy your own backend outside of matplotlib by\n# referring to the module name (which must be in the PYTHONPATH) as\n# 'module://my_backend'.\n#\n# If you omit this parameter, it will always default to \"Agg\", which is a\n# non-interactive backend.\nbackend      : agg\n```\nNow I bet Dima has `macosx` instead.",
    "created_at": "2018-01-17T00:13:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359536",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Really my last build shows that in `matplotlibrc` I have (without doing any special GUI settings)

```
#### CONFIGURATION BEGINS HERE

# The default backend; one of GTK GTKAgg GTKCairo GTK3Agg GTK3Cairo
# MacOSX Qt4Agg Qt5Agg TkAgg WX WXAgg Agg Cairo GDK PS PDF SVG
# Template.
# You can also deploy your own backend outside of matplotlib by
# referring to the module name (which must be in the PYTHONPATH) as
# 'module://my_backend'.
#
# If you omit this parameter, it will always default to "Agg", which is a
# non-interactive backend.
backend      : agg
```
Now I bet Dima has `macosx` instead.



---

archive/issue_comments_359537.json:
```json
{
    "body": "<a id='comment:2'></a>\nI didn't think I had done anything special either, but with this branch\n\n```\nsage: import matplotlib\nsage: matplotlib.get_backend()\nu'TkAgg'\n```",
    "created_at": "2018-01-17T00:42:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359537",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:2'></a>
I didn't think I had done anything special either, but with this branch

```
sage: import matplotlib
sage: matplotlib.get_backend()
u'TkAgg'
```



---

archive/issue_comments_359538.json:
```json
{
    "body": "<a id='comment:3'></a>\nOK, I have agg. And I don't have tcl/tk installed. I am wondering why I don't have some of the other backends for which you would think I have the dependencies.",
    "created_at": "2018-01-17T00:46:51Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359538",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
OK, I have agg. And I don't have tcl/tk installed. I am wondering why I don't have some of the other backends for which you would think I have the dependencies.



---

archive/issue_comments_359539.json:
```json
{
    "body": "<a id='comment:4'></a>\nI do have system tcl/tk installed. So maybe it is picking up on that. From the configure\n\n```\n   OPTIONAL BACKEND EXTENSIONS\n                    macosx: no  [skipping due to configuration]\n                    qt5agg: no  [PySide2 not found; PyQt5 not found]\n                    qt4agg: no  [PySide not found; PyQt4 not found]\n                   gtk3agg: no  [Requires pygobject to be installed.]\n                 gtk3cairo: no  [Requires cairocffi or pycairo to be installed.]\n                    gtkagg: no  [skipping due to configuration]\n                     tkagg: yes [installing; run-time loading from Python Tcl /\n                            Tk]\n                     wxagg: no  [skipping due to configuration]\n                       gtk: no  [skipping due to configuration]\n                       agg: yes [installing]\n                     cairo: no  [cairocffi or pycairo not found]\n                 windowing: no  [skipping due to configuration]\n```",
    "created_at": "2018-01-17T00:56:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359539",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
I do have system tcl/tk installed. So maybe it is picking up on that. From the configure

```
   OPTIONAL BACKEND EXTENSIONS
                    macosx: no  [skipping due to configuration]
                    qt5agg: no  [PySide2 not found; PyQt5 not found]
                    qt4agg: no  [PySide not found; PyQt4 not found]
                   gtk3agg: no  [Requires pygobject to be installed.]
                 gtk3cairo: no  [Requires cairocffi or pycairo to be installed.]
                    gtkagg: no  [skipping due to configuration]
                     tkagg: yes [installing; run-time loading from Python Tcl /
                            Tk]
                     wxagg: no  [skipping due to configuration]
                       gtk: no  [skipping due to configuration]
                       agg: yes [installing]
                     cairo: no  [cairocffi or pycairo not found]
                 windowing: no  [skipping due to configuration]
```



---

archive/issue_comments_359540.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt probably does. `tkagg` is one of the backend set to `auto` in `setup.cfg`. It looks like `gtk` and `gtkagg` need pygtk. wxagg needs wxpython. Because all that stuff is actually some kind of python bindings it would have to be installed in sage in the first place. I guess some can be installed by calling sage's pip but OS specific and tkagg are the only ones you can really get out of the box.",
    "created_at": "2018-01-17T01:24:24Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359540",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
It probably does. `tkagg` is one of the backend set to `auto` in `setup.cfg`. It looks like `gtk` and `gtkagg` need pygtk. wxagg needs wxpython. Because all that stuff is actually some kind of python bindings it would have to be installed in sage in the first place. I guess some can be installed by calling sage's pip but OS specific and tkagg are the only ones you can really get out of the box.



---

archive/issue_comments_359541.json:
```json
{
    "body": "<a id='comment:6'></a>\nSo, should `agg` be the default and let the user change to whatever? I believe this would fix things on OSX.",
    "created_at": "2018-01-17T02:30:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359541",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:6'></a>
So, should `agg` be the default and let the user change to whatever? I believe this would fix things on OSX.



---

archive/issue_comments_359542.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am not sure how things are ordered when several are available, I'll try to find out. However `agg` should always be the default in non-interactive mode. Dima and debian's problems may actually be subtle upstream bug of selection of the backend.",
    "created_at": "2018-01-17T02:34:10Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359542",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I am not sure how things are ordered when several are available, I'll try to find out. However `agg` should always be the default in non-interactive mode. Dima and debian's problems may actually be subtle upstream bug of selection of the backend.



---

archive/issue_comments_359543.json:
```json
{
    "body": "<a id='comment:228'></a>\nReplying to [fbissey](#comment%3A227):\n> I am not sure how things are ordered when several are available, I'll try to find out. However `agg` should always be the default in non-interactive mode. Dima and debian's problems may actually be subtle upstream bug of selection of the backend.\n\nI can replicate the debian problem on gentoo by simply unsetting the DISPLAY and doctesting `src/sage/plot/plot.py` and `src/sage/probability/probability_distribution.pyx`. I've seen this may times with sage-on-gentoo on Prefix where I forget to forward my DISPLAY when logging into the Prefix. I don't know about OSX, it looks like a different issue. It may be best to either configure Sage to have `agg` as the default matplotlib backend (which can be done) or to make sure that prior to using `pylab` or `pyplot` in a doctest the matplotlib backend is appropriately set.",
    "created_at": "2018-01-17T17:29:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359543",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:228'></a>
Replying to [fbissey](#comment%3A227):
> I am not sure how things are ordered when several are available, I'll try to find out. However `agg` should always be the default in non-interactive mode. Dima and debian's problems may actually be subtle upstream bug of selection of the backend.

I can replicate the debian problem on gentoo by simply unsetting the DISPLAY and doctesting `src/sage/plot/plot.py` and `src/sage/probability/probability_distribution.pyx`. I've seen this may times with sage-on-gentoo on Prefix where I forget to forward my DISPLAY when logging into the Prefix. I don't know about OSX, it looks like a different issue. It may be best to either configure Sage to have `agg` as the default matplotlib backend (which can be done) or to make sure that prior to using `pylab` or `pyplot` in a doctest the matplotlib backend is appropriately set.



---

archive/issue_comments_359544.json:
```json
{
    "body": "<a id='comment:9'></a>\nanother OSX failure of this type is here:\n\n```\nsage -t --long --warn-long 475.8 src/sage/probability/probability_distribution.pyx\n**********************************************************************\nFile \"src/sage/probability/probability_distribution.pyx\", line 120, in sage.probability.probability_distribution.ProbabilityDistribut\nion.generate_histogram_data\nFailed example:\n    h, b = X.generate_histogram_data(bins = 10)\nExpected nothing\nGot:\n    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.\n```\nIn case, on OSX the default backend is also `TkAgg`.\n\nIMHO the right place to set it to `Agg` is in the testsuite settings.\nThen no doctstring patches would be needed (there patches are not very useful as far\nas documentation is concerned, as normally speaking one does not want `Agg`).",
    "created_at": "2018-01-18T09:51:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359544",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
another OSX failure of this type is here:

```
sage -t --long --warn-long 475.8 src/sage/probability/probability_distribution.pyx
**********************************************************************
File "src/sage/probability/probability_distribution.pyx", line 120, in sage.probability.probability_distribution.ProbabilityDistribut
ion.generate_histogram_data
Failed example:
    h, b = X.generate_histogram_data(bins = 10)
Expected nothing
Got:
    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.
```
In case, on OSX the default backend is also `TkAgg`.

IMHO the right place to set it to `Agg` is in the testsuite settings.
Then no doctstring patches would be needed (there patches are not very useful as far
as documentation is concerned, as normally speaking one does not want `Agg`).



---

archive/issue_comments_359545.json:
```json
{
    "body": "<a id='comment:0'></a>\n+1 to that. Do you have a clue where that should be set.",
    "created_at": "2018-01-18T10:04:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359545",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
+1 to that. Do you have a clue where that should be set.



---

archive/issue_comments_359546.json:
```json
{
    "body": "<a id='comment:231'></a>\nReplying to [fbissey](#comment%3A230):\n> +1 to that. Do you have a clue where that should be set.\n\nSomewhere in src/sage/doctest/control.py, but where exactly? \n\nJeroen, could you tell us? We'd like the doctests to run with `import matplotlib; matplotlib.use('Agg')` executed.",
    "created_at": "2018-01-18T10:19:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359546",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:231'></a>
Replying to [fbissey](#comment%3A230):
> +1 to that. Do you have a clue where that should be set.

Somewhere in src/sage/doctest/control.py, but where exactly? 

Jeroen, could you tell us? We'd like the doctests to run with `import matplotlib; matplotlib.use('Agg')` executed.



---

archive/issue_comments_359547.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f\">1158425</a></td><td><code>Make sure agg backend is set in matplotlib when doctests are run</code></td></tr></table>\n",
    "created_at": "2018-01-20T21:56:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f">1158425</a></td><td><code>Make sure agg backend is set in matplotlib when doctests are run</code></td></tr></table>




---

archive/issue_comments_359548.json:
```json
{
    "body": "**Changing commit** from \"[929509edcfe5278337087f280222fc9b7bb10bbd](https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd)\" to \"[115842500d43cc3866c27292cf5680a317b5da3f](https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f)\".",
    "created_at": "2018-01-20T21:56:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[929509edcfe5278337087f280222fc9b7bb10bbd](https://github.com/sagemath/sagetrac-mirror/commit/929509edcfe5278337087f280222fc9b7bb10bbd)" to "[115842500d43cc3866c27292cf5680a317b5da3f](https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f)".



---

archive/issue_comments_359549.json:
```json
{
    "body": "<a id='comment:3'></a>\nAfter some thinking I came to the conclusion that it would probably be a burden to add the statement to every single doctests. Which is probably why the settings for the doctests are minimal. While I was looking for something else I noticed something neat about jmol and doctesting. I think it can be adapted here so it will only be effective on matplotlib plots.\n\nHave a go with the new commit!",
    "created_at": "2018-01-20T21:59:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359549",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
After some thinking I came to the conclusion that it would probably be a burden to add the statement to every single doctests. Which is probably why the settings for the doctests are minimal. While I was looking for something else I noticed something neat about jmol and doctesting. I think it can be adapted here so it will only be effective on matplotlib plots.

Have a go with the new commit!



---

archive/issue_comments_359550.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis seems to throw a bunch of warnings:\n\n```\n./sage -t --long src/sage/plot/plot.py\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 92, in sage.plot.plot\nFailed example:\n    plot(x^2, (x,0,5))\nExpected:\n    Graphics object consisting of 1 graphics primitive\nGot:\n    doctest:warning\n\n...\n\n    UserWarning: \n    This call to matplotlib.use() has no effect because the backend has already\n    been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,\n    or matplotlib.backends is imported for the first time.\n\n...\n\n    Graphics object consisting of 1 graphics primitive\n```\n\nThis was the only failure in `plot.py`.",
    "created_at": "2018-01-21T02:39:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359550",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
This seems to throw a bunch of warnings:

```
./sage -t --long src/sage/plot/plot.py
**********************************************************************
File "src/sage/plot/plot.py", line 92, in sage.plot.plot
Failed example:
    plot(x^2, (x,0,5))
Expected:
    Graphics object consisting of 1 graphics primitive
Got:
    doctest:warning

...

    UserWarning: 
    This call to matplotlib.use() has no effect because the backend has already
    been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
    or matplotlib.backends is imported for the first time.

...

    Graphics object consisting of 1 graphics primitive
```

This was the only failure in `plot.py`.



---

archive/issue_comments_359551.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe `UserWarning` was not complete. This is what was returned\n\n```\n    UserWarning: \n    This call to matplotlib.use() has no effect because the backend has already\n    been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,\n    or matplotlib.backends is imported for the first time.\n    <BLANKLINE>\n    The backend was *originally* set to u'TkAgg' by the following code:\n```",
    "created_at": "2018-01-21T02:42:16Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359551",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>
The `UserWarning` was not complete. This is what was returned

```
    UserWarning: 
    This call to matplotlib.use() has no effect because the backend has already
    been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
    or matplotlib.backends is imported for the first time.
    <BLANKLINE>
    The backend was *originally* set to u'TkAgg' by the following code:
```



---

archive/issue_comments_359552.json:
```json
{
    "body": "<a id='comment:6'></a>\nHum... Can you move the code in the commit up a few lines so it is above the other code I introduced to check stylesheet and try again? That block contains an import to `matplotlib.pyplot` which could be responsible for the message.",
    "created_at": "2018-01-21T02:46:13Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359552",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Hum... Can you move the code in the commit up a few lines so it is above the other code I introduced to check stylesheet and try again? That block contains an import to `matplotlib.pyplot` which could be responsible for the message.



---

archive/issue_comments_359553.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes, good spot, that gets rid of the warnings. Unfortunately I'm unable to test the OSX failures.",
    "created_at": "2018-01-21T03:05:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359553",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:7'></a>
Yes, good spot, that gets rid of the warnings. Unfortunately I'm unable to test the OSX failures.



---

archive/issue_comments_359554.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a\">8dcadff</a></td><td><code>Make sure agg backend is set in matplotlib when doctests are run and put the call in the right spot</code></td></tr></table>\n",
    "created_at": "2018-01-21T03:09:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a">8dcadff</a></td><td><code>Make sure agg backend is set in matplotlib when doctests are run and put the call in the right spot</code></td></tr></table>




---

archive/issue_comments_359555.json:
```json
{
    "body": "**Changing commit** from \"[115842500d43cc3866c27292cf5680a317b5da3f](https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f)\" to \"[8dcadff0d0dcc86aff0111749f85082f888afc7a](https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a)\".",
    "created_at": "2018-01-21T03:09:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[115842500d43cc3866c27292cf5680a317b5da3f](https://github.com/sagemath/sagetrac-mirror/commit/115842500d43cc3866c27292cf5680a317b5da3f)" to "[8dcadff0d0dcc86aff0111749f85082f888afc7a](https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a)".



---

archive/issue_comments_359556.json:
```json
{
    "body": "<a id='comment:9'></a>\nI have now redone the commit in the right spot. So Dima should be able to give it a go. Thanks for the testing (that I should have done).",
    "created_at": "2018-01-21T03:10:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359556",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I have now redone the commit in the right spot. So Dima should be able to give it a go. Thanks for the testing (that I should have done).



---

archive/issue_comments_359557.json:
```json
{
    "body": "<a id='comment:0'></a>\nGood, `src/sage/plot/plot.py` now passes the tests on OSX, but I still see\n\n```\n**********************************************************************\nFile \"src/sage/probability/probability_distribution.pyx\", line 120, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data\nFailed example:\n    h, b = X.generate_histogram_data(bins = 10)\nExpected nothing\nGot:\n    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.\n```\n\nI suppose you need to put your `agg` setting even higher.\nOtherwise this setting has be done per file, which is kind of silly, IMHO.",
    "created_at": "2018-01-21T10:34:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359557",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
Good, `src/sage/plot/plot.py` now passes the tests on OSX, but I still see

```
**********************************************************************
File "src/sage/probability/probability_distribution.pyx", line 120, in sage.probability.probability_distribution.ProbabilityDistribution.generate_histogram_data
Failed example:
    h, b = X.generate_histogram_data(bins = 10)
Expected nothing
Got:
    _RegisterApplication(), FAILED TO establish the default connection to the WindowServer, _CGSDefaultConnection() is NULL.
```

I suppose you need to put your `agg` setting even higher.
Otherwise this setting has be done per file, which is kind of silly, IMHO.



---

archive/issue_comments_359558.json:
```json
{
    "body": "<a id='comment:1'></a>\nIf I do\n\n```\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -42,6 +42,8 @@ optionaltag_regex = re.compile(r'^\\w+$')\n # Optional tags which are always automatically added\n auto_optional_tags = set(['py2' if six.PY2 else 'py3'])\n \n+import matplotlib\n+matplotlib.use('agg')\n \n class DocTestDefaults(SageObject):\n     \"\"\"\n```\nthen all the tests work.\n\n---\n\nNeedless to say, this does not affect normal running of Sage, as doctesting is not imported, unless you actually do doctesting.",
    "created_at": "2018-01-21T10:45:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359558",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
If I do

```
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -42,6 +42,8 @@ optionaltag_regex = re.compile(r'^\w+$')
 # Optional tags which are always automatically added
 auto_optional_tags = set(['py2' if six.PY2 else 'py3'])
 
+import matplotlib
+matplotlib.use('agg')
 
 class DocTestDefaults(SageObject):
     """
```
then all the tests work.

---

Needless to say, this does not affect normal running of Sage, as doctesting is not imported, unless you actually do doctesting.



---

archive/issue_comments_359559.json:
```json
{
    "body": "<a id='comment:2'></a>\nRight, I had a look and several functions of `probability_distribution.pyx` starts with `import pylab` which would take effect before my own call. I guess there is nothing for it. Let's put it in `control.py` but I think there is an issue that should be addressed in matplotlib if we could figure a simple test case not involving sage to open an issue.",
    "created_at": "2018-01-21T19:45:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359559",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Right, I had a look and several functions of `probability_distribution.pyx` starts with `import pylab` which would take effect before my own call. I guess there is nothing for it. Let's put it in `control.py` but I think there is an issue that should be addressed in matplotlib if we could figure a simple test case not involving sage to open an issue.



---

archive/issue_comments_359560.json:
```json
{
    "body": "<a id='comment:3'></a>\none way or another, \"real\" Sage library code should not be polluted by checks of whether is is being doctested.",
    "created_at": "2018-01-21T22:19:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359560",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
one way or another, "real" Sage library code should not be polluted by checks of whether is is being doctested.



---

archive/issue_comments_359561.json:
```json
{
    "body": "<a id='comment:244'></a>\nReplying to [dimpase](#comment%3A243):\n> one way or another, \"real\" Sage library code should not be polluted by checks of whether is is being doctested.\n\n\nA laudable goal but not always reachable it seems [https://github.com/sagemath/sage/blob/master/src/sage/structure/graphics_file.py#L175](https://github.com/sagemath/sage/blob/master/src/sage/structure/graphics_file.py#L175)\n\nI'll be getting code in the branch shortly (first day back to work).",
    "created_at": "2018-01-21T22:23:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359561",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:244'></a>
Replying to [dimpase](#comment%3A243):
> one way or another, "real" Sage library code should not be polluted by checks of whether is is being doctested.


A laudable goal but not always reachable it seems [https://github.com/sagemath/sage/blob/master/src/sage/structure/graphics_file.py#L175](https://github.com/sagemath/sage/blob/master/src/sage/structure/graphics_file.py#L175)

I'll be getting code in the branch shortly (first day back to work).



---

archive/issue_comments_359562.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7db6e11f284ea91727054cff866660841d952e3\">d7db6e1</a></td><td><code>Merge branch 'develop' into MPL-2.1.0b</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184\">e0534a8</a></td><td><code>Make all doctests set agg as the backend for matplotlib.</code></td></tr></table>\n",
    "created_at": "2018-01-21T23:15:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7db6e11f284ea91727054cff866660841d952e3">d7db6e1</a></td><td><code>Merge branch 'develop' into MPL-2.1.0b</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184">e0534a8</a></td><td><code>Make all doctests set agg as the backend for matplotlib.</code></td></tr></table>




---

archive/issue_comments_359563.json:
```json
{
    "body": "**Changing commit** from \"[8dcadff0d0dcc86aff0111749f85082f888afc7a](https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a)\" to \"[e0534a8c68bc60cf2495acf32598096d64579184](https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184)\".",
    "created_at": "2018-01-21T23:15:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359563",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8dcadff0d0dcc86aff0111749f85082f888afc7a](https://github.com/sagemath/sagetrac-mirror/commit/8dcadff0d0dcc86aff0111749f85082f888afc7a)" to "[e0534a8c68bc60cf2495acf32598096d64579184](https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184)".



---

archive/issue_comments_359564.json:
```json
{
    "body": "<a id='comment:6'></a>\nthe last commit leads to two test failures in \nsrc/sage/tests/startup.py - as the import statement in the last commit makes both\n\n```\n    sage: 'numpy' in sys.modules\n    False\n    sage: 'pyparsing' in sys.modules\n    False\n```\nfail. I don't know the purpose of these examples - just showing the functionality?\nWe can \nchange numpy to, say, sympy, and  pyparsing to something else, too...",
    "created_at": "2018-01-23T20:04:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359564",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
the last commit leads to two test failures in 
src/sage/tests/startup.py - as the import statement in the last commit makes both

```
    sage: 'numpy' in sys.modules
    False
    sage: 'pyparsing' in sys.modules
    False
```
fail. I don't know the purpose of these examples - just showing the functionality?
We can 
change numpy to, say, sympy, and  pyparsing to something else, too...



---

archive/issue_comments_359565.json:
```json
{
    "body": "<a id='comment:7'></a>\nYou should read the whole section\n\n```\nEnsure that certain modules are not loaded on startup.\nEXAMPLES::\n    sage: 'numpy' in sys.modules\n    False\n    sage: 'pyparsing' in sys.modules\n    False\n    sage: 'sage.libs.gap.libgap' in sys.modules\n    False\nCheck that IPython is not imported at startup (:trac:`18726`). It is\nimported by the doctest framework, so the simple test like above would\nnot work. Instead, we test this by starting a new Python process::\n    sage: from sage.tests.cmdline import test_executable\n    sage: cmd = \"from sage.all import *\\nprint('IPython' in sys.modules)\\n\"\n    sage: print(test_executable([\"sage\", \"--python\"], cmd)[0])  # long time\n    False\n```\nbasically we check that numpy and pyparsing are not imported at startup because it slows down the startup process considerably. Because of the manipulation of the last commit the tests would need to be made similar to the one for ipython. \n\nI am feeling like I am playing a game of \"whack a mole\". I may abandon the most general way to just care for the particular as it is clearly less exhausting.",
    "created_at": "2018-01-23T20:25:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359565",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
You should read the whole section

```
Ensure that certain modules are not loaded on startup.
EXAMPLES::
    sage: 'numpy' in sys.modules
    False
    sage: 'pyparsing' in sys.modules
    False
    sage: 'sage.libs.gap.libgap' in sys.modules
    False
Check that IPython is not imported at startup (:trac:`18726`). It is
imported by the doctest framework, so the simple test like above would
not work. Instead, we test this by starting a new Python process::
    sage: from sage.tests.cmdline import test_executable
    sage: cmd = "from sage.all import *\nprint('IPython' in sys.modules)\n"
    sage: print(test_executable(["sage", "--python"], cmd)[0])  # long time
    False
```
basically we check that numpy and pyparsing are not imported at startup because it slows down the startup process considerably. Because of the manipulation of the last commit the tests would need to be made similar to the one for ipython. 

I am feeling like I am playing a game of "whack a mole". I may abandon the most general way to just care for the particular as it is clearly less exhausting.



---

archive/issue_comments_359566.json:
```json
{
    "body": "<a id='comment:248'></a>\nReplying to [fbissey](#comment%3A247):\n> I am feeling like I am playing a game of \"whack a mole\". I may abandon the most general way to just care for the particular as it is clearly less exhausting.\n\nI agree with this. There is clearly something awry with OSX that maybe should be on another ticket as long as the specific case here is addressed.",
    "created_at": "2018-01-23T21:13:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359566",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:248'></a>
Replying to [fbissey](#comment%3A247):
> I am feeling like I am playing a game of "whack a mole". I may abandon the most general way to just care for the particular as it is clearly less exhausting.

I agree with this. There is clearly something awry with OSX that maybe should be on another ticket as long as the specific case here is addressed.



---

archive/issue_comments_359567.json:
```json
{
    "body": "<a id='comment:249'></a>\nReplying to [strogdon](#comment%3A248):\n> Replying to [fbissey](#comment%3A247):\n> > I am feeling like I am playing a game of \"whack a mole\". I may abandon the most general way to just care for the particular as it is clearly less exhausting.\n\n> I agree with this. There is clearly something awry with OSX that maybe should be on another ticket as long as the specific case here is addressed.\n\nWell, the change I am proposing should actually as well take care of the problem that Debian people are patching, no? And this is actually a noninvasive way; otherwise Sage starts looking a bit like that famous VW dieselgate code (for running their diesel engines in test mode differently) should have looked...",
    "created_at": "2018-01-24T01:31:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359567",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:249'></a>
Replying to [strogdon](#comment%3A248):
> Replying to [fbissey](#comment%3A247):
> > I am feeling like I am playing a game of "whack a mole". I may abandon the most general way to just care for the particular as it is clearly less exhausting.

> I agree with this. There is clearly something awry with OSX that maybe should be on another ticket as long as the specific case here is addressed.

Well, the change I am proposing should actually as well take care of the problem that Debian people are patching, no? And this is actually a noninvasive way; otherwise Sage starts looking a bit like that famous VW dieselgate code (for running their diesel engines in test mode differently) should have looked...



---

archive/issue_comments_359568.json:
```json
{
    "body": "<a id='comment:0'></a>\nTesting something different in `test/startup.py`? That misses the point the test was introduced for. [https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c](https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c) last file on that commit.",
    "created_at": "2018-01-24T01:37:14Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359568",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
Testing something different in `test/startup.py`? That misses the point the test was introduced for. [https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c](https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c) last file on that commit.



---

archive/issue_comments_359569.json:
```json
{
    "body": "<a id='comment:251'></a>\nReplying to [fbissey](#comment%3A250):\n> Testing something different in `test/startup.py`? That misses the point the test was introduced for. [https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c](https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c) last file on that commit.\n\n\nI am fine with doing tests for `numpy` and `pyparsing` the `IPython` way, as you proposed. One example how to do this in the normal setting (with libgap) looks sufficient.",
    "created_at": "2018-01-24T02:12:17Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359569",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:251'></a>
Replying to [fbissey](#comment%3A250):
> Testing something different in `test/startup.py`? That misses the point the test was introduced for. [https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c](https://github.com/sagemath/sage/commit/bff6915f037ef1d2acbda426f96cb6060509901c) last file on that commit.


I am fine with doing tests for `numpy` and `pyparsing` the `IPython` way, as you proposed. One example how to do this in the normal setting (with libgap) looks sufficient.



---

archive/issue_comments_359570.json:
```json
{
    "body": "**Changing commit** from \"[e0534a8c68bc60cf2495acf32598096d64579184](https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184)\" to \"[d5be931f48b77bb03d2d5750bea3805435e795fd](https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd)\".",
    "created_at": "2018-01-25T01:41:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e0534a8c68bc60cf2495acf32598096d64579184](https://github.com/sagemath/sagetrac-mirror/commit/e0534a8c68bc60cf2495acf32598096d64579184)" to "[d5be931f48b77bb03d2d5750bea3805435e795fd](https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd)".



---

archive/issue_comments_359571.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd\">d5be931</a></td><td><code>Change the startup test for numpy and pyparsing now that they are imported in the doctesting framework via matplotlib.</code></td></tr></table>\n",
    "created_at": "2018-01-25T01:41:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359571",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd">d5be931</a></td><td><code>Change the startup test for numpy and pyparsing now that they are imported in the doctesting framework via matplotlib.</code></td></tr></table>




---

archive/issue_comments_359572.json:
```json
{
    "body": "<a id='comment:3'></a>\nAnd I hope it is the last of it.",
    "created_at": "2018-01-25T01:42:03Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359572",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
And I hope it is the last of it.



---

archive/issue_comments_359573.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhy not use a test like\n\n```\n    sage: cmd = \"print('numpy' in sys.modules)\"\n    sage: print(test_executable([\"sage\", \"-c\", cmd])[0])  # long time\n    False\n```\nDoesn't that test this issue more directly? On my computer, this one might be a little faster, too.",
    "created_at": "2018-01-25T06:19:06Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359573",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Why not use a test like

```
    sage: cmd = "print('numpy' in sys.modules)"
    sage: print(test_executable(["sage", "-c", cmd])[0])  # long time
    False
```
Doesn't that test this issue more directly? On my computer, this one might be a little faster, too.



---

archive/issue_comments_359574.json:
```json
{
    "body": "<a id='comment:5'></a>\n(I think the current test works, so we can leave it as is, and consider changes on another ticket.)",
    "created_at": "2018-01-25T06:19:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359574",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
(I think the current test works, so we can leave it as is, and consider changes on another ticket.)



---

archive/issue_comments_359575.json:
```json
{
    "body": "<a id='comment:256'></a>\nReplying to [jhpalmieri](#comment%3A254):\n> Why not use a test like\n> \n> ```\n>     sage: cmd = \"print('numpy' in sys.modules)\"\n>     sage: print(test_executable([\"sage\", \"-c\", cmd])[0])  # long time\n>     False\n> ```\n> Doesn't that test this issue more directly? On my computer, this one might be a little faster, too.\n\n\nNow you are making me think that the ipython test that I copied is actually wrong. `sage --python` should start a python shell not sage. Correct?",
    "created_at": "2018-01-25T06:41:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359575",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:256'></a>
Replying to [jhpalmieri](#comment%3A254):
> Why not use a test like
> 
> ```
>     sage: cmd = "print('numpy' in sys.modules)"
>     sage: print(test_executable(["sage", "-c", cmd])[0])  # long time
>     False
> ```
> Doesn't that test this issue more directly? On my computer, this one might be a little faster, too.


Now you are making me think that the ipython test that I copied is actually wrong. `sage --python` should start a python shell not sage. Correct?



---

archive/issue_comments_359576.json:
```json
{
    "body": "<a id='comment:7'></a>\nNo, it is correct but yes something more direct looks possible. I should look at the ticket to see why this particular form has been chosen.",
    "created_at": "2018-01-25T06:45:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359576",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
No, it is correct but yes something more direct looks possible. I should look at the ticket to see why this particular form has been chosen.



---

archive/issue_comments_359577.json:
```json
{
    "body": "<a id='comment:258'></a>\nReplying to [fbissey](#comment%3A256):\n> Replying to [jhpalmieri](#comment%3A254):\n> > Why not use a test like\n> > \n> > ```\n> >     sage: cmd = \"print('numpy' in sys.modules)\"\n> >     sage: print(test_executable([\"sage\", \"-c\", cmd])[0])  # long time\n> >     False\n> > ```\n> > Doesn't that test this issue more directly? On my computer, this one might be a little faster, too.\n\n> \n> Now you are making me think that the ipython test that I copied is actually wrong. `sage --python` should start a python shell not sage. Correct?\n\n\nThis is correct, and in fact starting anything short of full Sage is Dieselgate approach to testing...",
    "created_at": "2018-01-25T09:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359577",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:258'></a>
Replying to [fbissey](#comment%3A256):
> Replying to [jhpalmieri](#comment%3A254):
> > Why not use a test like
> > 
> > ```
> >     sage: cmd = "print('numpy' in sys.modules)"
> >     sage: print(test_executable(["sage", "-c", cmd])[0])  # long time
> >     False
> > ```
> > Doesn't that test this issue more directly? On my computer, this one might be a little faster, too.

> 
> Now you are making me think that the ipython test that I copied is actually wrong. `sage --python` should start a python shell not sage. Correct?


This is correct, and in fact starting anything short of full Sage is Dieselgate approach to testing...



---

archive/issue_comments_359578.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5edbfe57746cc1ea0b876aeb9e13b07231955b5\">a5edbfe</a></td><td><code>Change the startup test for numpy and pyparsing now that they are imported in the doctesting framework via matplotlib.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87\">ba7f0ab</a></td><td><code>Merge branch 'develop' into MPL-2.1.0b</code></td></tr></table>\n",
    "created_at": "2018-01-31T02:16:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5edbfe57746cc1ea0b876aeb9e13b07231955b5">a5edbfe</a></td><td><code>Change the startup test for numpy and pyparsing now that they are imported in the doctesting framework via matplotlib.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87">ba7f0ab</a></td><td><code>Merge branch 'develop' into MPL-2.1.0b</code></td></tr></table>




---

archive/issue_comments_359579.json:
```json
{
    "body": "**Changing commit** from \"[d5be931f48b77bb03d2d5750bea3805435e795fd](https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd)\" to \"[ba7f0ab8dbde03cdd935233fc4228451b2cb0c87](https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87)\".",
    "created_at": "2018-01-31T02:16:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359579",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d5be931f48b77bb03d2d5750bea3805435e795fd](https://github.com/sagemath/sagetrac-mirror/commit/d5be931f48b77bb03d2d5750bea3805435e795fd)" to "[ba7f0ab8dbde03cdd935233fc4228451b2cb0c87](https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87)".



---

archive/issue_comments_359580.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK changed to `sage -c` by popular demand. Rebased on top of 8.2.beta4. Should we have a new positive review now!",
    "created_at": "2018-01-31T02:20:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359580",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
OK changed to `sage -c` by popular demand. Rebased on top of 8.2.beta4. Should we have a new positive review now!



---

archive/issue_comments_359581.json:
```json
{
    "body": "<a id='comment:261'></a>\nReplying to [fbissey](#comment%3A260):\n> OK changed to `sage -c` by popular demand. Rebased on top of 8.2.beta4. Should we have a new positive review now!\n\n\nLGTM (I've just checked it on Ubuntu, not on MacOS). Thanks again for all your work! (this is comment number 261, pfff!...).",
    "created_at": "2018-01-31T10:51:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359581",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:261'></a>
Replying to [fbissey](#comment%3A260):
> OK changed to `sage -c` by popular demand. Rebased on top of 8.2.beta4. Should we have a new positive review now!


LGTM (I've just checked it on Ubuntu, not on MacOS). Thanks again for all your work! (this is comment number 261, pfff!...).



---

archive/issue_comments_359582.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK, looks good on OSX too.",
    "created_at": "2018-01-31T12:41:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359582",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
OK, looks good on OSX too.



---

archive/issue_events_210699.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-31T12:41:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210699"
}
```



---

archive/issue_events_210700.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-31T12:41:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210700"
}
```



---

archive/issue_events_210701.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-31T13:07:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210701"
}
```



---

archive/issue_events_210702.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2018-01-31T13:07:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210702"
}
```



---

archive/issue_comments_359583.json:
```json
{
    "body": "<a id='comment:3'></a>\nSorry for removing the positive_review status, but I've just noticed the following doctest errors:\n\n```\n./sage -t --long --warn-long 46.0 src/sage/tests/startup.py\nRunning doctests with ID 2018-01-31-14-05-27-cae74607.\nGit branch: MPL2.1.0\nUsing --optional=mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 46.0 src/sage/tests/startup.py\n**********************************************************************\nFile \"src/sage/tests/startup.py\", line 25, in sage.tests.startup\nFailed example:\n    print(test_executable([\"sage\", \"-c\"], cmd)[0])  # long time\nExpected:\n    False\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/tests/startup.py\", line 28, in sage.tests.startup\nFailed example:\n    print(test_executable([\"sage\", \"-c\"], cmd)[0])  # long time\nExpected:\n    False\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage.tests.startup\n    [9 tests, 2 failures, 4.22 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 46.0 src/sage/tests/startup.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\nThis is with Ubuntu 16.04.",
    "created_at": "2018-01-31T13:07:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359583",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>
Sorry for removing the positive_review status, but I've just noticed the following doctest errors:

```
./sage -t --long --warn-long 46.0 src/sage/tests/startup.py
Running doctests with ID 2018-01-31-14-05-27-cae74607.
Git branch: MPL2.1.0
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 46.0 src/sage/tests/startup.py
**********************************************************************
File "src/sage/tests/startup.py", line 25, in sage.tests.startup
Failed example:
    print(test_executable(["sage", "-c"], cmd)[0])  # long time
Expected:
    False
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/tests/startup.py", line 28, in sage.tests.startup
Failed example:
    print(test_executable(["sage", "-c"], cmd)[0])  # long time
Expected:
    False
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   2 of  10 in sage.tests.startup
    [9 tests, 2 failures, 4.22 s]
----------------------------------------------------------------------
sage -t --long --warn-long 46.0 src/sage/tests/startup.py  # 2 doctests failed
----------------------------------------------------------------------
```
This is with Ubuntu 16.04.



---

archive/issue_comments_359584.json:
```json
{
    "body": "<a id='comment:4'></a>\nIn a Sage console, I indeed get a blank line for the same command:\n\n```\nsage: from sage.tests.cmdline import test_executable\nsage: cmd = \"print('numpy' in sys.modules)\\n\"\nsage: print(test_executable([\"sage\", \"-c\"], cmd)[0])\n\nsage: test_executable([\"sage\", \"-c\"], cmd)\n('', '', 0)\n```\nwhile I do have:\n\n```\nsage: 'numpy' in sys.modules\nFalse\n```\nIn the Linux terminal, `./sage -c \"print('numpy' in sys.modules)\"` returns `False`.",
    "created_at": "2018-01-31T13:30:26Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359584",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>
In a Sage console, I indeed get a blank line for the same command:

```
sage: from sage.tests.cmdline import test_executable
sage: cmd = "print('numpy' in sys.modules)\n"
sage: print(test_executable(["sage", "-c"], cmd)[0])

sage: test_executable(["sage", "-c"], cmd)
('', '', 0)
```
while I do have:

```
sage: 'numpy' in sys.modules
False
```
In the Linux terminal, `./sage -c "print('numpy' in sys.modules)"` returns `False`.



---

archive/issue_comments_359585.json:
```json
{
    "body": "<a id='comment:5'></a>\nPlease try the test the way I suggested in [comment:254](#comment%3A254) (`[\"sage\", \"-c\", cmd]` all in one set of square brackets). Does that work?",
    "created_at": "2018-01-31T15:55:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359585",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Please try the test the way I suggested in [comment:254](#comment%3A254) (`["sage", "-c", cmd]` all in one set of square brackets). Does that work?



---

archive/issue_comments_359586.json:
```json
{
    "body": "<a id='comment:266'></a>\nReplying to [jhpalmieri](#comment%3A265):\n> Please try the test the way I suggested in [comment:254](#comment%3A254) (`[\"sage\", \"-c\", cmd]` all in one set of square brackets). Does that work?\n\n\nYes this one works:\n\n```\nsage: from sage.tests.cmdline import test_executable\nsage: cmd = \"print('numpy' in sys.modules)\\n\"\nsage: print(test_executable([\"sage\", \"-c\", cmd])[0])\nFalse\n\nsage: test_executable([\"sage\", \"-c\", cmd])\n('False\\n', '', 0)\n```",
    "created_at": "2018-01-31T16:08:38Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359586",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:266'></a>
Replying to [jhpalmieri](#comment%3A265):
> Please try the test the way I suggested in [comment:254](#comment%3A254) (`["sage", "-c", cmd]` all in one set of square brackets). Does that work?


Yes this one works:

```
sage: from sage.tests.cmdline import test_executable
sage: cmd = "print('numpy' in sys.modules)\n"
sage: print(test_executable(["sage", "-c", cmd])[0])
False

sage: test_executable(["sage", "-c", cmd])
('False\n', '', 0)
```



---

archive/issue_comments_359587.json:
```json
{
    "body": "<a id='comment:7'></a>\nSorry I didn't pay enough attention. I'll redo this ASAP.",
    "created_at": "2018-01-31T18:51:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359587",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Sorry I didn't pay enough attention. I'll redo this ASAP.



---

archive/issue_comments_359588.json:
```json
{
    "body": "**Changing commit** from \"[ba7f0ab8dbde03cdd935233fc4228451b2cb0c87](https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87)\" to \"[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)\".",
    "created_at": "2018-01-31T21:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ba7f0ab8dbde03cdd935233fc4228451b2cb0c87](https://github.com/sagemath/sagetrac-mirror/commit/ba7f0ab8dbde03cdd935233fc4228451b2cb0c87)" to "[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)".



---

archive/issue_comments_359589.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f65ac29ed2d3e47ed4360e073ecd7ffa4810ba79\">f65ac29</a></td><td><code>Merge with develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f\">ca3b242</a></td><td><code>correct test in startup.py</code></td></tr></table>\n",
    "created_at": "2018-01-31T21:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f65ac29ed2d3e47ed4360e073ecd7ffa4810ba79">f65ac29</a></td><td><code>Merge with develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f">ca3b242</a></td><td><code>correct test in startup.py</code></td></tr></table>




---

archive/issue_comments_359590.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, it is corrected.",
    "created_at": "2018-01-31T21:08:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359590",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
OK, it is corrected.



---

archive/issue_events_210703.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-31T21:08:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210703"
}
```



---

archive/issue_events_210704.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-01-31T21:08:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210704"
}
```



---

archive/issue_events_210705.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-02-01T13:30:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210705"
}
```



---

archive/issue_events_210706.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-02-01T13:30:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210706"
}
```



---

archive/issue_comments_359591.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK, I've run the tests on the newest branch now. Apologies for a mis-review the previous time - I only checked files that didn't work before...",
    "created_at": "2018-02-01T13:30:27Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359591",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
OK, I've run the tests on the newest branch now. Apologies for a mis-review the previous time - I only checked files that didn't work before...



---

archive/issue_comments_359592.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt's also OK from my side: make ptestlong ==> \"All tests passed!\"\n\nMany thanks!",
    "created_at": "2018-02-01T14:48:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359592",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:1'></a>
It's also OK from my side: make ptestlong ==> "All tests passed!"

Many thanks!



---

archive/issue_events_210707.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210707"
}
```



---

archive/issue_events_210708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "950bdd8145d262e493321bef67d3d57d26f9c464",
    "created_at": "2018-02-02T12:06:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23696#event-210708"
}
```



---

archive/issue_comments_359593.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/MPL-2.1.0b](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0b)\" to \"[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)\".",
    "created_at": "2018-02-02T12:06:11Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359593",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/MPL-2.1.0b](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/MPL-2.1.0b)" to "[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)".



---

archive/issue_comments_359594.json:
```json
{
    "body": "**Changing commit** from \"[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)\" to \"\".",
    "created_at": "2018-02-06T13:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359594",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f](https://github.com/sagemath/sagetrac-mirror/commit/ca3b242e6d7ca2ce22d8d23ef62d0cecd95b585f)" to "".



---

archive/issue_comments_359595.json:
```json
{
    "body": "<a id='comment:3'></a>\nSee #24670 for a follow-up.",
    "created_at": "2018-02-06T13:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359595",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
See #24670 for a follow-up.



---

archive/issue_comments_359596.json:
```json
{
    "body": "<a id='comment:4'></a>\nSerious breakage at #24671.",
    "created_at": "2018-02-06T13:40:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359596",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Serious breakage at #24671.



---

archive/issue_comments_359597.json:
```json
{
    "body": "<a id='comment:5'></a>\nCan somebody explain these changes?\n\n```diff\n@@ -141,7 +140,7 @@ def list_plot3d(v, interpolation_type='default', texture=\"automatic\", point_list\n         sage: for i in range(-5, 5):\n         ....:     for j in range(-5, 5):\n         ....:         l.append((normalvariate(0, 1), normalvariate(0, 1), normalvariate(0, 1)))\n-        sage: list_plot3d(l, interpolation_type='nn', texture='yellow', num_points=100)\n+        sage: list_plot3d(l, interpolation_type='clough', texture='yellow', num_points=100)\n         Graphics3d Object\n \n     TESTS:\n```\nI'm asking because of this:\n\n```\nsage -t --long --warn-long 10.0 src/sage/plot/plot3d/list_plot3d.py\n**********************************************************************\nFile \"src/sage/plot/plot3d/list_plot3d.py\", line 143, in sage.plot.plot3d.list_plot3d.list_plot3d\nWarning, slow doctest:\n    list_plot3d(l, interpolation_type='clough', texture='yellow', num_points=100)\nTest ran for 926.47 s\n**********************************************************************\n```\n926 seconds for a plot which is not even marked `# long time`?",
    "created_at": "2018-02-28T06:51:04Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359597",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Can somebody explain these changes?

```diff
@@ -141,7 +140,7 @@ def list_plot3d(v, interpolation_type='default', texture="automatic", point_list
         sage: for i in range(-5, 5):
         ....:     for j in range(-5, 5):
         ....:         l.append((normalvariate(0, 1), normalvariate(0, 1), normalvariate(0, 1)))
-        sage: list_plot3d(l, interpolation_type='nn', texture='yellow', num_points=100)
+        sage: list_plot3d(l, interpolation_type='clough', texture='yellow', num_points=100)
         Graphics3d Object
 
     TESTS:
```
I'm asking because of this:

```
sage -t --long --warn-long 10.0 src/sage/plot/plot3d/list_plot3d.py
**********************************************************************
File "src/sage/plot/plot3d/list_plot3d.py", line 143, in sage.plot.plot3d.list_plot3d.list_plot3d
Warning, slow doctest:
    list_plot3d(l, interpolation_type='clough', texture='yellow', num_points=100)
Test ran for 926.47 s
**********************************************************************
```
926 seconds for a plot which is not even marked `# long time`?



---

archive/issue_comments_359598.json:
```json
{
    "body": "<a id='comment:6'></a>\nClearly an oversight on my part. `interpolation_type='nn'` is gone - and not coming back anytime soon. This was discussed at length in this ticket and I pinged sage-devel. Following deafening silence on the options available, I choose a new alternative that looked promising time wise on the example that I timed. As you just shown I haven't timed every single doctests otherwise I may have noticed that this one was putting the new default under stress.\n\nThat warrants a follow up ticket to deal with this.",
    "created_at": "2018-02-28T06:57:35Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359598",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Clearly an oversight on my part. `interpolation_type='nn'` is gone - and not coming back anytime soon. This was discussed at length in this ticket and I pinged sage-devel. Following deafening silence on the options available, I choose a new alternative that looked promising time wise on the example that I timed. As you just shown I haven't timed every single doctests otherwise I may have noticed that this one was putting the new default under stress.

That warrants a follow up ticket to deal with this.



---

archive/issue_comments_359599.json:
```json
{
    "body": "<a id='comment:277'></a>\nReplying to [fbissey](#comment%3A276):\n> Clearly an oversight on my part. `interpolation_type='nn'` is gone - and not coming back anytime soon. This was discussed at length in this ticket and I pinged sage-devel. Following deafening silence on the options available, I choose a new alternative that looked promising time wise on the example that I timed. As you just shown I haven't timed every single doctests otherwise I may have noticed that this one was putting the new default under stress.\n\n\nI'm not blaiming you... I didn't follow this ticket but given the number of comments, I guess it was not easy.",
    "created_at": "2018-02-28T08:41:43Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359599",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:277'></a>
Replying to [fbissey](#comment%3A276):
> Clearly an oversight on my part. `interpolation_type='nn'` is gone - and not coming back anytime soon. This was discussed at length in this ticket and I pinged sage-devel. Following deafening silence on the options available, I choose a new alternative that looked promising time wise on the example that I timed. As you just shown I haven't timed every single doctests otherwise I may have noticed that this one was putting the new default under stress.


I'm not blaiming you... I didn't follow this ticket but given the number of comments, I guess it was not easy.



---

archive/issue_comments_359600.json:
```json
{
    "body": "<a id='comment:8'></a>\nIn 8.2.beta3, the same test took about 3 seconds on the same machine. So we have a regression by a factor 300.",
    "created_at": "2018-02-28T08:49:34Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359600",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
In 8.2.beta3, the same test took about 3 seconds on the same machine. So we have a regression by a factor 300.



---

archive/issue_comments_359601.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK, let's move on to do something about it. Is there any other plots that are taking an awful long time?",
    "created_at": "2018-02-28T08:50:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359601",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
OK, let's move on to do something about it. Is there any other plots that are taking an awful long time?



---

archive/issue_comments_359602.json:
```json
{
    "body": "<a id='comment:0'></a>\nFollow-up at #24862.",
    "created_at": "2018-02-28T08:51:43Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359602",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>
Follow-up at #24862.



---

archive/issue_comments_359603.json:
```json
{
    "body": "<a id='comment:1'></a>\nWelcome to the past: we just got hit by #13135 again.",
    "created_at": "2018-02-28T13:06:31Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359603",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Welcome to the past: we just got hit by #13135 again.



---

archive/issue_comments_359604.json:
```json
{
    "body": "<a id='comment:2'></a>\nBy the way, matplotlib 2.2.0 has been released.",
    "created_at": "2018-03-08T02:02:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359604",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
By the way, matplotlib 2.2.0 has been released.



---

archive/issue_comments_359605.json:
```json
{
    "body": "<a id='comment:283'></a>\nReplying to [gh-dimpase](#comment%3A282):\n> By the way, matplotlib 2.2.0 has been released.\n\n\nIs it python-3 only? I remember reading they were getting ready for that at the next \"major\" release.",
    "created_at": "2018-03-08T02:54:01Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359605",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:283'></a>
Replying to [gh-dimpase](#comment%3A282):
> By the way, matplotlib 2.2.0 has been released.


Is it python-3 only? I remember reading they were getting ready for that at the next "major" release.



---

archive/issue_comments_359606.json:
```json
{
    "body": "<a id='comment:4'></a>\nI guess major should be vers. 3",
    "created_at": "2018-03-08T04:04:18Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359606",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
I guess major should be vers. 3



---

archive/issue_comments_359607.json:
```json
{
    "body": "<a id='comment:5'></a>\nProbably caused by commit `d109b7593ef` from this ticket: #25165.",
    "created_at": "2018-04-13T18:02:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23696#issuecomment-359607",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>
Probably caused by commit `d109b7593ef` from this ticket: #25165.
