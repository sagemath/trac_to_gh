# Issue 23582: Robustify doctest in hyperbolic_geodesic.py

archive/issues_023345.json:
```json
{
    "assignees": [],
    "body": "A doctest of the `midpoint` code in `geometry/hyperbolic_space/hyperbolic_geodesic.py` relies on exact reproduction of complicated symbolic expressions involving square roots. With recent changes in Pynac the representation of the result no longer matches, although it is mathematically identical.\n\nThe ticket changes the doctest to match results numerically.\n\n\nBranch/Commit: **[u/rws/robustify_doctest_in_hyperbolic_geodesic_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/robustify_doctest_in_hyperbolic_geodesic_py) @ [a90ce6a](https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23582_\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2017-08-05T07:07:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20geometry",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Robustify doctest in hyperbolic_geodesic.py",
    "type": "issue",
    "updated_at": "2017-12-12T08:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/23582",
    "user": "https://github.com/rwst"
}
```
A doctest of the `midpoint` code in `geometry/hyperbolic_space/hyperbolic_geodesic.py` relies on exact reproduction of complicated symbolic expressions involving square roots. With recent changes in Pynac the representation of the result no longer matches, although it is mathematically identical.

The ticket changes the doctest to match results numerically.


Branch/Commit: **[u/rws/robustify_doctest_in_hyperbolic_geodesic_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/robustify_doctest_in_hyperbolic_geodesic_py) @ [a90ce6a](https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64)**

Reviewer: **Frédéric Chapoton**

Author: **Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/23582_





---

archive/issue_events_310065.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-05T07:07:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310065"
}
```



---

archive/issue_events_310066.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-05T07:07:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "component: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310066"
}
```



---

archive/issue_events_310067.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-05T07:07:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310067"
}
```



---

archive/issue_events_310068.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-05T07:07:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310068"
}
```



---

archive/issue_comments_357581.json:
```json
{
    "body": "Branch: **[u/rws/robustify_doctest_in_hyperbolic_geodesic_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/robustify_doctest_in_hyperbolic_geodesic_py)**",
    "created_at": "2017-08-05T07:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357581",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/robustify_doctest_in_hyperbolic_geodesic_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/robustify_doctest_in_hyperbolic_geodesic_py)**



---

archive/issue_comments_357582.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2017-08-05T07:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357582",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_357583.json:
```json
{
    "body": "Commit: **[a90ce6a](https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64)**",
    "created_at": "2017-08-05T07:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357583",
    "user": "https://github.com/rwst"
}
```

Commit: **[a90ce6a](https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64)**



---

archive/issue_comments_357584.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64\">a90ce6a</a></td><td><code>23582: Robustify doctest in hyperbolic_geodesic.py</code></td></tr></table>\n",
    "created_at": "2017-08-05T07:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357584",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a90ce6a6d5eaf6f984dc863afb70c72de47e0a64">a90ce6a</a></td><td><code>23582: Robustify doctest in hyperbolic_geodesic.py</code></td></tr></table>




---

archive/issue_events_310069.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-05T07:12:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310069"
}
```



---

archive/issue_comments_357585.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-08-05T17:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357585",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_357586.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nok, looks good",
    "created_at": "2017-08-05T17:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357586",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'>Comment 3:</a>
ok, looks good



---

archive/issue_events_310070.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T17:02:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310070"
}
```



---

archive/issue_events_310071.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-05T17:02:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310071"
}
```



---

archive/issue_comments_357587.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI'm not completely sure about this. If it is mathematically identical, why not simply change the doctest with the new version of pynac? Should then all (sufficiently complicated) symbolic expressions output not be used for doctests? IMO, this makes the doctest less likely to catch errors and feels like a tiny step backwards in that regard.",
    "created_at": "2017-08-09T14:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357587",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>Comment 4:</a>
I'm not completely sure about this. If it is mathematically identical, why not simply change the doctest with the new version of pynac? Should then all (sufficiently complicated) symbolic expressions output not be used for doctests? IMO, this makes the doctest less likely to catch errors and feels like a tiny step backwards in that regard.



---

archive/issue_events_310072.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-09T14:09:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310072"
}
```



---

archive/issue_events_310073.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-09T14:09:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310073"
}
```



---

archive/issue_events_310074.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-10T06:51:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310074"
}
```



---

archive/issue_events_310075.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-10T06:51:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310075"
}
```



---

archive/issue_events_310076.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-10T06:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310076"
}
```



---

archive/issue_events_310077.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-10T06:51:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310077"
}
```



---

archive/issue_events_310078.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-08-10T06:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310078"
}
```



---

archive/issue_comments_357588.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThe change is no longer necessary because the mentioned change in Pynac didn't happen. I agree to make the ticket invalid.\n\nHowever, let me point out that it is highly unlikely that a symbolic error would pass such a numeric test. Note that such numeric tests additionally test the FP evaluation code so it's more likely to catch bugs.",
    "created_at": "2017-08-10T06:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23582#issuecomment-357588",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'>Comment 5:</a>
The change is no longer necessary because the mentioned change in Pynac didn't happen. I agree to make the ticket invalid.

However, let me point out that it is highly unlikely that a symbolic error would pass such a numeric test. Note that such numeric tests additionally test the FP evaluation code so it's more likely to catch bugs.



---

archive/issue_events_310079.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310079"
}
```



---

archive/issue_events_310080.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310080"
}
```



---

archive/issue_events_310081.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23582",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23582#event-310081"
}
```
