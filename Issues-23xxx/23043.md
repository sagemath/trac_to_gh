# Issue 23043: Fast p-adic logarithm

archive/issues_022806.json:
```json
{
    "assignees": [],
    "body": "This ticket provides a fast C implementation of the logarithm for elements of `\\mathbb Z_p`.\n\nThe gain of speed is significant:\n\n```\n    sage: from sage.rings.padics.padic_generic_element import pAdicGenericElement\n    sage: generic_log = pAdicGenericElement.log\n\n    sage: for i in range(2,11):\n    ....:     print 'At precision 2^%s:' % i\n    ....:     R = Zp(17, prec=2^i)\n    ....:     a = 1 + 17*R.random_element()\n    ....:     timeit('b = generic_log(a)')\n    ....:\n    At precision 2^2:\n    625 loops, best of 3: 243 \u00b5s per loop\n    At precision 2^3:\n    625 loops, best of 3: 377 \u00b5s per loop\n    At precision 2^4:\n    625 loops, best of 3: 709 \u00b5s per loop\n    At precision 2^5:\n    625 loops, best of 3: 1.26 ms per loop\n    At precision 2^6:\n    125 loops, best of 3: 2.47 ms per loop\n    At precision 2^7:\n    125 loops, best of 3: 4.87 ms per loop\n    At precision 2^8:\n    25 loops, best of 3: 10.3 ms per loop\n    At precision 2^9:\n    25 loops, best of 3: 22.3 ms per loop\n    At precision 2^10:\n    5 loops, best of 3: 53.6 ms per loop\n\n    sage: for i in range(2,16):\n    ....:     print 'At precision 2^%s:' % i\n    ....:     R = Zp(17, prec=2^i)\n    ....:     a = 1 + 17*R.random_element()\n    ....:     timeit('b = a.log()')\n    ....:\n    At precision 2^2:\n    625 loops, best of 3: 4.36 \u00b5s per loop\n    At precision 2^3:\n    625 loops, best of 3: 5.62 \u00b5s per loop\n    At precision 2^4:\n    625 loops, best of 3: 8.92 \u00b5s per loop\n    At precision 2^5:\n    625 loops, best of 3: 16.8 \u00b5s per loop\n    At precision 2^6:\n    625 loops, best of 3: 32.2 \u00b5s per loop\n    At precision 2^7:\n    625 loops, best of 3: 62.8 \u00b5s per loop\n    At precision 2^8:\n    625 loops, best of 3: 143 \u00b5s per loop\n    At precision 2^9:\n    625 loops, best of 3: 333 \u00b5s per loop\n    At precision 2^10:\n    625 loops, best of 3: 975 \u00b5s per loop\n    At precision 2^11:\n    125 loops, best of 3: 2.49 ms per loop\n    At precision 2^12:\n    125 loops, best of 3: 7.12 ms per loop\n    At precision 2^13:\n    25 loops, best of 3: 19.3 ms per loop\n    At precision 2^14:\n    5 loops, best of 3: 54.6 ms per loop\n    At precision 2^15:\n    5 loops, best of 3: 158 ms per loop\n```\n\nCC:  @roed314 @saraedum\n\nComponent: **padics**\n\nKeywords: **logarithm, sd86.5**\n\nAuthor: **Xavier Caruso**\n\nBranch/Commit: **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**\n\nReviewer: **David Roe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23043_\n\n",
    "closed_at": "2017-06-10T11:38:14Z",
    "created_at": "2017-05-21T15:07:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20padics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fast p-adic logarithm",
    "type": "issue",
    "updated_at": "2017-06-10T11:38:14Z",
    "url": "https://github.com/sagemath/sage/issues/23043",
    "user": "https://github.com/xcaruso"
}
```
This ticket provides a fast C implementation of the logarithm for elements of `\mathbb Z_p`.

The gain of speed is significant:

```
    sage: from sage.rings.padics.padic_generic_element import pAdicGenericElement
    sage: generic_log = pAdicGenericElement.log

    sage: for i in range(2,11):
    ....:     print 'At precision 2^%s:' % i
    ....:     R = Zp(17, prec=2^i)
    ....:     a = 1 + 17*R.random_element()
    ....:     timeit('b = generic_log(a)')
    ....:
    At precision 2^2:
    625 loops, best of 3: 243 µs per loop
    At precision 2^3:
    625 loops, best of 3: 377 µs per loop
    At precision 2^4:
    625 loops, best of 3: 709 µs per loop
    At precision 2^5:
    625 loops, best of 3: 1.26 ms per loop
    At precision 2^6:
    125 loops, best of 3: 2.47 ms per loop
    At precision 2^7:
    125 loops, best of 3: 4.87 ms per loop
    At precision 2^8:
    25 loops, best of 3: 10.3 ms per loop
    At precision 2^9:
    25 loops, best of 3: 22.3 ms per loop
    At precision 2^10:
    5 loops, best of 3: 53.6 ms per loop

    sage: for i in range(2,16):
    ....:     print 'At precision 2^%s:' % i
    ....:     R = Zp(17, prec=2^i)
    ....:     a = 1 + 17*R.random_element()
    ....:     timeit('b = a.log()')
    ....:
    At precision 2^2:
    625 loops, best of 3: 4.36 µs per loop
    At precision 2^3:
    625 loops, best of 3: 5.62 µs per loop
    At precision 2^4:
    625 loops, best of 3: 8.92 µs per loop
    At precision 2^5:
    625 loops, best of 3: 16.8 µs per loop
    At precision 2^6:
    625 loops, best of 3: 32.2 µs per loop
    At precision 2^7:
    625 loops, best of 3: 62.8 µs per loop
    At precision 2^8:
    625 loops, best of 3: 143 µs per loop
    At precision 2^9:
    625 loops, best of 3: 333 µs per loop
    At precision 2^10:
    625 loops, best of 3: 975 µs per loop
    At precision 2^11:
    125 loops, best of 3: 2.49 ms per loop
    At precision 2^12:
    125 loops, best of 3: 7.12 ms per loop
    At precision 2^13:
    25 loops, best of 3: 19.3 ms per loop
    At precision 2^14:
    5 loops, best of 3: 54.6 ms per loop
    At precision 2^15:
    5 loops, best of 3: 158 ms per loop
```

CC:  @roed314 @saraedum

Component: **padics**

Keywords: **logarithm, sd86.5**

Author: **Xavier Caruso**

Branch/Commit: **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**

Reviewer: **David Roe**

_Issue created by migration from https://trac.sagemath.org/ticket/23043_





---

archive/issue_events_318543.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-05-21T15:07:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318543"
}
```



---

archive/issue_events_318544.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-05-21T15:07:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20padics",
    "label_color": "0000ff",
    "label_name": "c: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318544"
}
```



---

archive/issue_events_318545.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-05-21T15:07:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318545"
}
```



---

archive/issue_events_318546.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-05-21T15:07:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318546"
}
```



---

archive/issue_comments_344954.json:
```json
{
    "body": "Branch: **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)**",
    "created_at": "2017-05-21T15:07:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344954",
    "user": "https://github.com/xcaruso"
}
```

Branch: **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)**



---

archive/issue_comments_344955.json:
```json
{
    "body": "Commit: **[`e83902f`](https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194)**",
    "created_at": "2017-05-21T15:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344955",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`e83902f`](https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194)**



---

archive/issue_comments_344956.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194\"><code>e83902f</code></a></td><td><code>Small fixes</code></td></tr></table>\n",
    "created_at": "2017-05-21T15:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344956",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194"><code>e83902f</code></a></td><td><code>Small fixes</code></td></tr></table>




---

archive/issue_comments_344957.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,63 +3,66 @@\n The gain of speed is significant:\n \n ```\n-    sage: R = Zp(17, 2^15)\n-    sage: a = 1 + 17*R.random_element()\n-\n     sage: from sage.rings.padics.padic_generic_element import pAdicGenericElement\n-    sage: generic_log = pAdicGenericElement.log    # old version\n+    sage: generic_log = pAdicGenericElement.log\n \n     sage: for i in range(2,11):\n     ....:     print 'At precision 2^%s:' % i\n-    ....:     timeit('b = generic_log(a,aprec=%s)' % 2^i)\n+    ....:     R = Zp(17, prec=2^i)\n+    ....:     a = 1 + 17*R.random_element()\n+    ....:     timeit('b = generic_log(a)')\n+    ....:\n     At precision 2^2:\n-    5 loops, best of 3: 44.3 ms per loop\n+    625 loops, best of 3: 243 \u00b5s per loop\n     At precision 2^3:\n-    5 loops, best of 3: 56.7 ms per loop\n+    625 loops, best of 3: 377 \u00b5s per loop\n     At precision 2^4:\n-    5 loops, best of 3: 98.4 ms per loop\n+    625 loops, best of 3: 709 \u00b5s per loop\n     At precision 2^5:\n-    5 loops, best of 3: 147 ms per loop\n+    625 loops, best of 3: 1.26 ms per loop\n     At precision 2^6:\n-    5 loops, best of 3: 253 ms per loop\n+    125 loops, best of 3: 2.47 ms per loop\n     At precision 2^7:\n-    5 loops, best of 3: 460 ms per loop\n+    125 loops, best of 3: 4.87 ms per loop\n     At precision 2^8:\n-    5 loops, best of 3: 871 ms per loop\n+    25 loops, best of 3: 10.3 ms per loop\n     At precision 2^9:\n-    5 loops, best of 3: 1.74 s per loop\n+    25 loops, best of 3: 22.3 ms per loop\n     At precision 2^10:\n-    5 loops, best of 3: 3.41 s per loop\n+    5 loops, best of 3: 53.6 ms per loop\n \n-    sage: for i in range(2,17):\n+    sage: for i in range(2,16):\n     ....:     print 'At precision 2^%s:' % i\n-    ....:     timeit('b = a.log(aprec=%s)' % 2^i)\n+    ....:     R = Zp(17, prec=2^i)\n+    ....:     a = 1 + 17*R.random_element()\n+    ....:     timeit('b = a.log()')\n+    ....:\n     At precision 2^2:\n-    625 loops, best of 3: 50.6 \u00b5s per loop\n+    625 loops, best of 3: 4.36 \u00b5s per loop\n     At precision 2^3:\n-    625 loops, best of 3: 69.6 \u00b5s per loop\n+    625 loops, best of 3: 5.62 \u00b5s per loop\n     At precision 2^4:\n-    625 loops, best of 3: 100 \u00b5s per loop\n+    625 loops, best of 3: 8.92 \u00b5s per loop\n     At precision 2^5:\n-    625 loops, best of 3: 148 \u00b5s per loop\n+    625 loops, best of 3: 16.8 \u00b5s per loop\n     At precision 2^6:\n-    625 loops, best of 3: 223 \u00b5s per loop\n+    625 loops, best of 3: 32.2 \u00b5s per loop\n     At precision 2^7:\n-    625 loops, best of 3: 350 \u00b5s per loop\n+    625 loops, best of 3: 62.8 \u00b5s per loop\n     At precision 2^8:\n-    625 loops, best of 3: 595 \u00b5s per loop\n+    625 loops, best of 3: 143 \u00b5s per loop\n     At precision 2^9:\n-    625 loops, best of 3: 1.06 ms per loop\n+    625 loops, best of 3: 333 \u00b5s per loop\n     At precision 2^10:\n-    125 loops, best of 3: 1.98 ms per loop\n+    625 loops, best of 3: 975 \u00b5s per loop\n     At precision 2^11:\n-    125 loops, best of 3: 3.99 ms per loop\n+    125 loops, best of 3: 2.49 ms per loop\n     At precision 2^12:\n-    25 loops, best of 3: 8.84 ms per loop\n+    125 loops, best of 3: 7.12 ms per loop\n     At precision 2^13:\n-    25 loops, best of 3: 21.1 ms per loop\n+    25 loops, best of 3: 19.3 ms per loop\n     At precision 2^14:\n-    5 loops, best of 3: 57 ms per loop\n+    5 loops, best of 3: 54.6 ms per loop\n     At precision 2^15:\n-    5 loops, best of 3: 153 ms per loop\n+    5 loops, best of 3: 158 ms per loop\n ```\n``````\n",
    "created_at": "2017-05-21T18:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344957",
    "user": "https://github.com/xcaruso"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,63 +3,66 @@
 The gain of speed is significant:
 
 ```
-    sage: R = Zp(17, 2^15)
-    sage: a = 1 + 17*R.random_element()
-
     sage: from sage.rings.padics.padic_generic_element import pAdicGenericElement
-    sage: generic_log = pAdicGenericElement.log    # old version
+    sage: generic_log = pAdicGenericElement.log
 
     sage: for i in range(2,11):
     ....:     print 'At precision 2^%s:' % i
-    ....:     timeit('b = generic_log(a,aprec=%s)' % 2^i)
+    ....:     R = Zp(17, prec=2^i)
+    ....:     a = 1 + 17*R.random_element()
+    ....:     timeit('b = generic_log(a)')
+    ....:
     At precision 2^2:
-    5 loops, best of 3: 44.3 ms per loop
+    625 loops, best of 3: 243 µs per loop
     At precision 2^3:
-    5 loops, best of 3: 56.7 ms per loop
+    625 loops, best of 3: 377 µs per loop
     At precision 2^4:
-    5 loops, best of 3: 98.4 ms per loop
+    625 loops, best of 3: 709 µs per loop
     At precision 2^5:
-    5 loops, best of 3: 147 ms per loop
+    625 loops, best of 3: 1.26 ms per loop
     At precision 2^6:
-    5 loops, best of 3: 253 ms per loop
+    125 loops, best of 3: 2.47 ms per loop
     At precision 2^7:
-    5 loops, best of 3: 460 ms per loop
+    125 loops, best of 3: 4.87 ms per loop
     At precision 2^8:
-    5 loops, best of 3: 871 ms per loop
+    25 loops, best of 3: 10.3 ms per loop
     At precision 2^9:
-    5 loops, best of 3: 1.74 s per loop
+    25 loops, best of 3: 22.3 ms per loop
     At precision 2^10:
-    5 loops, best of 3: 3.41 s per loop
+    5 loops, best of 3: 53.6 ms per loop
 
-    sage: for i in range(2,17):
+    sage: for i in range(2,16):
     ....:     print 'At precision 2^%s:' % i
-    ....:     timeit('b = a.log(aprec=%s)' % 2^i)
+    ....:     R = Zp(17, prec=2^i)
+    ....:     a = 1 + 17*R.random_element()
+    ....:     timeit('b = a.log()')
+    ....:
     At precision 2^2:
-    625 loops, best of 3: 50.6 µs per loop
+    625 loops, best of 3: 4.36 µs per loop
     At precision 2^3:
-    625 loops, best of 3: 69.6 µs per loop
+    625 loops, best of 3: 5.62 µs per loop
     At precision 2^4:
-    625 loops, best of 3: 100 µs per loop
+    625 loops, best of 3: 8.92 µs per loop
     At precision 2^5:
-    625 loops, best of 3: 148 µs per loop
+    625 loops, best of 3: 16.8 µs per loop
     At precision 2^6:
-    625 loops, best of 3: 223 µs per loop
+    625 loops, best of 3: 32.2 µs per loop
     At precision 2^7:
-    625 loops, best of 3: 350 µs per loop
+    625 loops, best of 3: 62.8 µs per loop
     At precision 2^8:
-    625 loops, best of 3: 595 µs per loop
+    625 loops, best of 3: 143 µs per loop
     At precision 2^9:
-    625 loops, best of 3: 1.06 ms per loop
+    625 loops, best of 3: 333 µs per loop
     At precision 2^10:
-    125 loops, best of 3: 1.98 ms per loop
+    625 loops, best of 3: 975 µs per loop
     At precision 2^11:
-    125 loops, best of 3: 3.99 ms per loop
+    125 loops, best of 3: 2.49 ms per loop
     At precision 2^12:
-    25 loops, best of 3: 8.84 ms per loop
+    125 loops, best of 3: 7.12 ms per loop
     At precision 2^13:
-    25 loops, best of 3: 21.1 ms per loop
+    25 loops, best of 3: 19.3 ms per loop
     At precision 2^14:
-    5 loops, best of 3: 57 ms per loop
+    5 loops, best of 3: 54.6 ms per loop
     At precision 2^15:
-    5 loops, best of 3: 153 ms per loop
+    5 loops, best of 3: 158 ms per loop
 ```
``````




---

archive/issue_comments_344958.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI have just launched my patchbot on this ticket.\n\nMaybe you would be interested in having a look at #12560 ? I have done my best, but it still needs some care from an expert in padics and C/cython.",
    "created_at": "2017-05-21T20:23:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344958",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

I have just launched my patchbot on this ticket.

Maybe you would be interested in having a look at #12560 ? I have done my best, but it still needs some care from an expert in padics and C/cython.



---

archive/issue_comments_344959.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOk, I'll have a look.",
    "created_at": "2017-05-22T13:54:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344959",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:5" align="right">comment:5</div>

Ok, I'll have a look.



---

archive/issue_comments_344960.json:
```json
{
    "body": "Changed commit from **[`e83902f`](https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194)** to **[`a7d40cc`](https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141)**",
    "created_at": "2017-05-27T22:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344960",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e83902f`](https://github.com/sagemath/sagetrac-mirror/commit/e83902f25c3fa2dd75f4b7180cd793f4245fb194)** to **[`a7d40cc`](https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141)**



---

archive/issue_comments_344961.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141\"><code>a7d40cc</code></a></td><td><code>Incorporate fast logarithm in ZpCA and ZpFM</code></td></tr></table>\n",
    "created_at": "2017-05-27T22:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344961",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141"><code>a7d40cc</code></a></td><td><code>Incorporate fast logarithm in ZpCA and ZpFM</code></td></tr></table>




---

archive/issue_comments_344962.json:
```json
{
    "body": "Changed commit from **[`a7d40cc`](https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141)** to **[`3381787`](https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae)**",
    "created_at": "2017-05-27T22:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344962",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a7d40cc`](https://github.com/sagemath/sagetrac-mirror/commit/a7d40cc4d4e59c6c51befbf6285aeea504c4d141)** to **[`3381787`](https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae)**



---

archive/issue_comments_344963.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae\"><code>3381787</code></a></td><td><code>Small optimization</code></td></tr></table>\n",
    "created_at": "2017-05-27T22:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344963",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae"><code>3381787</code></a></td><td><code>Small optimization</code></td></tr></table>




---

archive/issue_comments_344964.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This ticket provides a fast C implementation of the logarithm for elements of `\\mathbb Z_p`. (Only capped relative precision is supported currently.)\n+This ticket provides a fast C implementation of the logarithm for elements of `\\mathbb Z_p`.\n \n The gain of speed is significant:\n \n``````\n",
    "created_at": "2017-05-27T22:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344964",
    "user": "https://github.com/xcaruso"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This ticket provides a fast C implementation of the logarithm for elements of `\mathbb Z_p`. (Only capped relative precision is supported currently.)
+This ticket provides a fast C implementation of the logarithm for elements of `\mathbb Z_p`.
 
 The gain of speed is significant:
 
``````




---

archive/issue_events_318547.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-05-27T22:27:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318547"
}
```



---

archive/issue_comments_344965.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nPatch ready for review.\n\nNote that I've changed the behaviour of log for fixed-modulus padics: when `a` is not invertible, `log(a)` now raises an error. The reason for this is that taking logarithm decreases the absolute precision for non-units (while the absolute precision is fixed in the parent in that case). Please argue if you don't agree :-).",
    "created_at": "2017-05-27T22:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344965",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:8" align="right">comment:8</div>

Patch ready for review.

Note that I've changed the behaviour of log for fixed-modulus padics: when `a` is not invertible, `log(a)` now raises an error. The reason for this is that taking logarithm decreases the absolute precision for non-units (while the absolute precision is fixed in the parent in that case). Please argue if you don't agree :-).



---

archive/issue_comments_344966.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1\"><code>f1c7c2e</code></a></td><td><code>Memory leak problems fixed</code></td></tr></table>\n",
    "created_at": "2017-05-30T21:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344966",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1"><code>f1c7c2e</code></a></td><td><code>Memory leak problems fixed</code></td></tr></table>




---

archive/issue_comments_344967.json:
```json
{
    "body": "Changed commit from **[`3381787`](https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae)** to **[`f1c7c2e`](https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1)**",
    "created_at": "2017-05-30T21:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344967",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3381787`](https://github.com/sagemath/sagetrac-mirror/commit/33817875c41e8e182da9a7e911d7fad8562cd2ae)** to **[`f1c7c2e`](https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1)**



---

archive/issue_comments_344968.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a\"><code>af9c989</code></a></td><td><code>Doctest issue fixed</code></td></tr></table>\n",
    "created_at": "2017-05-31T06:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344968",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a"><code>af9c989</code></a></td><td><code>Doctest issue fixed</code></td></tr></table>




---

archive/issue_comments_344969.json:
```json
{
    "body": "Changed commit from **[`f1c7c2e`](https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1)** to **[`af9c989`](https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a)**",
    "created_at": "2017-05-31T06:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344969",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1c7c2e`](https://github.com/sagemath/sagetrac-mirror/commit/f1c7c2e0cba402c402f81001a357c0c986a975d1)** to **[`af9c989`](https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a)**



---

archive/issue_comments_344970.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI've improved a bit the algorithm (by making first the argument closer to 1 by raising - possibly several times - to the power p). New timings :\n\n```\nsage: for i in range(2,16):\n....:     print 'At precision 2^%s:' % i\n....:     R = Zp(17, prec=2^i)\n....:     a = 1 + 17*R.random_element()\n....:     timeit('b = a.log()')\n....:     \nAt precision 2^2:\n625 loops, best of 3: 5.51 \u00b5s per loop\nAt precision 2^3:\n625 loops, best of 3: 7.83 \u00b5s per loop\nAt precision 2^4:\n625 loops, best of 3: 11 \u00b5s per loop\nAt precision 2^5:\n625 loops, best of 3: 13.6 \u00b5s per loop\nAt precision 2^6:\n625 loops, best of 3: 21.9 \u00b5s per loop\nAt precision 2^7:\n625 loops, best of 3: 40.5 \u00b5s per loop\nAt precision 2^8:\n625 loops, best of 3: 88.7 \u00b5s per loop\nAt precision 2^9:\n625 loops, best of 3: 184 \u00b5s per loop\nAt precision 2^10:\n625 loops, best of 3: 526 \u00b5s per loop\nAt precision 2^11:\n625 loops, best of 3: 1.57 ms per loop\nAt precision 2^12:\n125 loops, best of 3: 4.59 ms per loop\nAt precision 2^13:\n25 loops, best of 3: 13.2 ms per loop\nAt precision 2^14:\n25 loops, best of 3: 38.3 ms per loop\nAt precision 2^15:\n5 loops, best of 3: 123 ms per loop\n```",
    "created_at": "2017-06-04T17:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344970",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:11" align="right">comment:11</div>

I've improved a bit the algorithm (by making first the argument closer to 1 by raising - possibly several times - to the power p). New timings :

```
sage: for i in range(2,16):
....:     print 'At precision 2^%s:' % i
....:     R = Zp(17, prec=2^i)
....:     a = 1 + 17*R.random_element()
....:     timeit('b = a.log()')
....:     
At precision 2^2:
625 loops, best of 3: 5.51 µs per loop
At precision 2^3:
625 loops, best of 3: 7.83 µs per loop
At precision 2^4:
625 loops, best of 3: 11 µs per loop
At precision 2^5:
625 loops, best of 3: 13.6 µs per loop
At precision 2^6:
625 loops, best of 3: 21.9 µs per loop
At precision 2^7:
625 loops, best of 3: 40.5 µs per loop
At precision 2^8:
625 loops, best of 3: 88.7 µs per loop
At precision 2^9:
625 loops, best of 3: 184 µs per loop
At precision 2^10:
625 loops, best of 3: 526 µs per loop
At precision 2^11:
625 loops, best of 3: 1.57 ms per loop
At precision 2^12:
125 loops, best of 3: 4.59 ms per loop
At precision 2^13:
25 loops, best of 3: 13.2 ms per loop
At precision 2^14:
25 loops, best of 3: 38.3 ms per loop
At precision 2^15:
5 loops, best of 3: 123 ms per loop
```



---

archive/issue_comments_344971.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74\"><code>47ce6c0</code></a></td><td><code>Faster algorithm (hopefully)</code></td></tr></table>\n",
    "created_at": "2017-06-04T17:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344971",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74"><code>47ce6c0</code></a></td><td><code>Faster algorithm (hopefully)</code></td></tr></table>




---

archive/issue_comments_344972.json:
```json
{
    "body": "Changed commit from **[`af9c989`](https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a)** to **[`47ce6c0`](https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74)**",
    "created_at": "2017-06-04T17:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344972",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af9c989`](https://github.com/sagemath/sagetrac-mirror/commit/af9c989bdc87c833ca2963745092e3600264699a)** to **[`47ce6c0`](https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74)**



---

archive/issue_comments_344973.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nLooks great!\n\n* p is allowed to be larger than an unsigned long.  Presumably you should fall back on the non-optimized implementation then (the precision won't be large in this case, so it shouldn't really matter much).\n\n* I think that fixed modulus logs should still work even when `a` is not invertible, in analogy with `a//p` working.\n\n* It would be good to use `sig_malloc` and `sig_free` from `cysignals/memory.pxd`, but I don't know exactly how to achieve this in a C file.\n\n* It would be good to have additional tests.  In particular, maybe have an `algorithm` keyword that allows falling back to the default implementation of p-adic logs and compare.  Adding some `TestSuite` tests (by implementing `_test_log` for example; see `padic_generic.pyx`) would also be good, checking that `log(xy) = log(x) + log(y)` for example.\n\n* I should be fairly responsive for the next 9 days or so, since I'm at a Sage Days then working with Julian on p-adics.  It would be cool to get this positively reviewed soon!",
    "created_at": "2017-06-07T04:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344973",
    "user": "https://github.com/roed314"
}
```

<div id="comment:13" align="right">comment:13</div>

Looks great!

* p is allowed to be larger than an unsigned long.  Presumably you should fall back on the non-optimized implementation then (the precision won't be large in this case, so it shouldn't really matter much).

* I think that fixed modulus logs should still work even when `a` is not invertible, in analogy with `a//p` working.

* It would be good to use `sig_malloc` and `sig_free` from `cysignals/memory.pxd`, but I don't know exactly how to achieve this in a C file.

* It would be good to have additional tests.  In particular, maybe have an `algorithm` keyword that allows falling back to the default implementation of p-adic logs and compare.  Adding some `TestSuite` tests (by implementing `_test_log` for example; see `padic_generic.pyx`) would also be good, checking that `log(xy) = log(x) + log(y)` for example.

* I should be fairly responsive for the next 9 days or so, since I'm at a Sage Days then working with Julian on p-adics.  It would be cool to get this positively reviewed soon!



---

archive/issue_events_318548.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-06-07T04:18:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318548"
}
```



---

archive/issue_events_318549.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-06-07T04:18:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318549"
}
```



---

archive/issue_comments_344974.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e3a75186e5641979dcd9698c4cdf321ee95110d\"><code>4e3a751</code></a></td><td><code>Added keywork 'algorithm'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13b1316569eebd9795f50926748e6dd4d1dcc4ec\"><code>13b1316</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7472fc1c6d296d7a844b385cfa5770454c2169d6\"><code>7472fc1</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long (second try) + clean doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/145da3c337e803644c73322eab4e267c13ac7fab\"><code>145da3c</code></a></td><td><code>More doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105\"><code>630ad02</code></a></td><td><code>Added TestSuite for p-adic logarithm</code></td></tr></table>\n",
    "created_at": "2017-06-07T22:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344974",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e3a75186e5641979dcd9698c4cdf321ee95110d"><code>4e3a751</code></a></td><td><code>Added keywork 'algorithm'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13b1316569eebd9795f50926748e6dd4d1dcc4ec"><code>13b1316</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7472fc1c6d296d7a844b385cfa5770454c2169d6"><code>7472fc1</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long (second try) + clean doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/145da3c337e803644c73322eab4e267c13ac7fab"><code>145da3c</code></a></td><td><code>More doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105"><code>630ad02</code></a></td><td><code>Added TestSuite for p-adic logarithm</code></td></tr></table>




---

archive/issue_comments_344975.json:
```json
{
    "body": "Changed commit from **[`47ce6c0`](https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74)** to **[`630ad02`](https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105)**",
    "created_at": "2017-06-07T22:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344975",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`47ce6c0`](https://github.com/sagemath/sagetrac-mirror/commit/47ce6c0dd0cad23ad777fa855e37abb6a0d8de74)** to **[`630ad02`](https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105)**



---

archive/issue_comments_344976.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nGreat! Thanks for your review!\n\nFor `sig_malloc` and `sig_free`, I also do not know how to use them in a C code.\nApart from that, I addressed all your requests.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e3a75186e5641979dcd9698c4cdf321ee95110d\"><code>4e3a751</code></a></td><td><code>Added keywork 'algorithm'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13b1316569eebd9795f50926748e6dd4d1dcc4ec\"><code>13b1316</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7472fc1c6d296d7a844b385cfa5770454c2169d6\"><code>7472fc1</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long (second try) + clean doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/145da3c337e803644c73322eab4e267c13ac7fab\"><code>145da3c</code></a></td><td><code>More doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105\"><code>630ad02</code></a></td><td><code>Added TestSuite for p-adic logarithm</code></td></tr></table>\n",
    "created_at": "2017-06-07T22:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344976",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:15" align="right">comment:15</div>

Great! Thanks for your review!

For `sig_malloc` and `sig_free`, I also do not know how to use them in a C code.
Apart from that, I addressed all your requests.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e3a75186e5641979dcd9698c4cdf321ee95110d"><code>4e3a751</code></a></td><td><code>Added keywork 'algorithm'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13b1316569eebd9795f50926748e6dd4d1dcc4ec"><code>13b1316</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7472fc1c6d296d7a844b385cfa5770454c2169d6"><code>7472fc1</code></a></td><td><code>Switch to generic algorithm when p does not fit in a long (second try) + clean doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/145da3c337e803644c73322eab4e267c13ac7fab"><code>145da3c</code></a></td><td><code>More doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105"><code>630ad02</code></a></td><td><code>Added TestSuite for p-adic logarithm</code></td></tr></table>




---

archive/issue_comments_344977.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nGreat.  Peter Bruin suggests the following for sig_malloc and sig_free:\n\n   * Include cysignals/macros.h in your transcendentals.c file.  This might be as simple as `#include <cysignals/macros.h>`, but we're not sure.\n   * Before your mallocs, call `sig_block()` and afterward, call `sig_unblock()`.  This will duplicate the effect of `sig_malloc` in `cysignals/memory.pxd`.",
    "created_at": "2017-06-07T23:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344977",
    "user": "https://github.com/roed314"
}
```

<div id="comment:16" align="right">comment:16</div>

Great.  Peter Bruin suggests the following for sig_malloc and sig_free:

   * Include cysignals/macros.h in your transcendentals.c file.  This might be as simple as `#include <cysignals/macros.h>`, but we're not sure.
   * Before your mallocs, call `sig_block()` and afterward, call `sig_unblock()`.  This will duplicate the effect of `sig_malloc` in `cysignals/memory.pxd`.



---

archive/issue_comments_344978.json:
```json
{
    "body": "Changed commit from **[`630ad02`](https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105)** to **[`b475974`](https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9)**",
    "created_at": "2017-06-08T11:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344978",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`630ad02`](https://github.com/sagemath/sagetrac-mirror/commit/630ad0290ce6b6438b365ee9ade2b5bbd81d7105)** to **[`b475974`](https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9)**



---

archive/issue_comments_344979.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9\"><code>b475974</code></a></td><td><code>Disable signal handling while memory allocation</code></td></tr></table>\n",
    "created_at": "2017-06-08T11:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9"><code>b475974</code></a></td><td><code>Disable signal handling while memory allocation</code></td></tr></table>




---

archive/issue_events_318550.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-06-08T11:56:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318550"
}
```



---

archive/issue_events_318551.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-06-08T11:56:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318551"
}
```



---

archive/issue_comments_344980.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOk, done.\nBut I am then wondering about other memory allocations (required by gmp). Are there correctly handled?",
    "created_at": "2017-06-08T11:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344980",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:18" align="right">comment:18</div>

Ok, done.
But I am then wondering about other memory allocations (required by gmp). Are there correctly handled?



---

archive/issue_comments_344981.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@xcaruso](#comment%3A18):\n> Ok, done.\n> But I am then wondering about other memory allocations (required by gmp). Are there correctly handled?\n\nI don't think there is a problem here; Sage sets the malloc/realloc/free functions to be used by GMP to `sage_sig_malloc` etc. (see `sage/ext/memory.pyx`).  Actually, it could be an option for your code to use the same malloc as GMP does.",
    "created_at": "2017-06-08T17:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344981",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@xcaruso](#comment%3A18):
> Ok, done.
> But I am then wondering about other memory allocations (required by gmp). Are there correctly handled?

I don't think there is a problem here; Sage sets the malloc/realloc/free functions to be used by GMP to `sage_sig_malloc` etc. (see `sage/ext/memory.pyx`).  Actually, it could be an option for your code to use the same malloc as GMP does.



---

archive/issue_comments_344982.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nFine.\n\nBtw, what happens exactly when the computation is interrupted by `KeyboardInterrupt`. Is the memory allocated by the function automatically free? Or should we handle this?",
    "created_at": "2017-06-08T19:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344982",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:20" align="right">comment:20</div>

Fine.

Btw, what happens exactly when the computation is interrupted by `KeyboardInterrupt`. Is the memory allocated by the function automatically free? Or should we handle this?



---

archive/issue_comments_344983.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@xcaruso](#comment%3A20):\n> Fine.\n> \n> Btw, what happens exactly when the computation is interrupted by `KeyboardInterrupt`. Is the memory allocated by the function automatically free? Or should we handle this?\n\nI don't think it's automatically freed, but I don't know how to handle it in C.  In Cython, you can use a try/finally block and free inside the finally.  I think in this case we should just live with the possibility of a memory leak.",
    "created_at": "2017-06-08T22:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344983",
    "user": "https://github.com/roed314"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@xcaruso](#comment%3A20):
> Fine.
> 
> Btw, what happens exactly when the computation is interrupted by `KeyboardInterrupt`. Is the memory allocated by the function automatically free? Or should we handle this?

I don't think it's automatically freed, but I don't know how to handle it in C.  In Cython, you can use a try/finally block and free inside the finally.  I think in this case we should just live with the possibility of a memory leak.



---

archive/issue_comments_344984.json:
```json
{
    "body": "Changed keywords from **logarithm** to **logarithm, sd86.5**",
    "created_at": "2017-06-08T22:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344984",
    "user": "https://github.com/roed314"
}
```

Changed keywords from **logarithm** to **logarithm, sd86.5**



---

archive/issue_comments_344985.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm building it now to run tests.",
    "created_at": "2017-06-08T22:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344985",
    "user": "https://github.com/roed314"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm building it now to run tests.



---

archive/issue_comments_344986.json:
```json
{
    "body": "Changed branch from **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)** to **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)**",
    "created_at": "2017-06-09T00:42:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344986",
    "user": "https://github.com/roed314"
}
```

Changed branch from **[u/caruso/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/padiclog)** to **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)**



---

archive/issue_comments_344987.json:
```json
{
    "body": "Changed commit from **[`b475974`](https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9)** to **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**",
    "created_at": "2017-06-09T00:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344987",
    "user": "https://github.com/roed314"
}
```

Changed commit from **[`b475974`](https://github.com/sagemath/sagetrac-mirror/commit/b47597412e0db06fd2a21d70736efef8c97866c9)** to **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**



---

archive/issue_comments_344988.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI've run all tests. Xavier, if you're happy with my changes (fixing a typo and changing some TestSuites to not take forever), go ahead and set this to positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95\"><code>16d8757</code></a></td><td><code>Adding limits to long tests in padic_extension_leaves, fix typo</code></td></tr></table>\n",
    "created_at": "2017-06-09T00:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344988",
    "user": "https://github.com/roed314"
}
```

<div id="comment:24" align="right">comment:24</div>

I've run all tests. Xavier, if you're happy with my changes (fixing a typo and changing some TestSuites to not take forever), go ahead and set this to positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95"><code>16d8757</code></a></td><td><code>Adding limits to long tests in padic_extension_leaves, fix typo</code></td></tr></table>




---

archive/issue_comments_344989.json:
```json
{
    "body": "Reviewer: **David Roe**",
    "created_at": "2017-06-09T00:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344989",
    "user": "https://github.com/roed314"
}
```

Reviewer: **David Roe**



---

archive/issue_events_318552.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-06-09T05:20:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318552"
}
```



---

archive/issue_events_318553.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-06-09T05:20:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318553"
}
```



---

archive/issue_comments_344990.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOk, Thanks!",
    "created_at": "2017-06-09T05:20:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344990",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:25" align="right">comment:25</div>

Ok, Thanks!



---

archive/issue_comments_344991.json:
```json
{
    "body": "Changed branch from **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)** to **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**",
    "created_at": "2017-06-10T11:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23043#issuecomment-344991",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/roed/padiclog](https://github.com/sagemath/sagetrac-mirror/tree/u/roed/padiclog)** to **[`16d8757`](https://github.com/sagemath/sagetrac-mirror/commit/16d8757c92dccab7cb8164700217c6710905cc95)**



---

archive/issue_events_318554.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-10T11:38:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318554"
}
```



---

archive/issue_events_318555.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bea0dd64a4450ac5c24ed04e12b9b1e82ec1dc3b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-10T11:38:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23043",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23043#event-318555"
}
```
