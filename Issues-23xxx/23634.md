# Issue 23634: A base class for integral quadratic forms seen as modules with a bilinear form.

archive/issues_023397.json:
```json
{
    "body": "An integral lattice is a free abelian group L together with a non-degenerate integer valued bilinear form L x L --> ZZ.\n\nIn sage a lattice should consist of:\n- an ambient QQ vector space with an inner product matrix\n- a distinguished ZZ-basis (with possibly rational entries)\n\nIntegral lattices and quadratic forms are mathematically basically the same.\nFor me the difference in thinking is that lattices live in an ambient space.\nThus, one can have several lattices in an ambient space and compare their mutual relations (containment, embedding etc.)\n\nProbably it should be derived from \nsage.modules.free_quadratic_module.FreeQuadraticModule_submodule_with_basis_pi\n\nNew methods should include \n- discriminant groups and forms\n- over and sublattices \n- Orthogonal groups\n- direct sums\n- is_even \n- is_primitive sublattice\n- orthogonal complements\n- the dual \"lattice\"\n\nKeywords: sd91\n\nReviewer: David Roe\n\nAuthor: Simon Brandhorst\n\nBranch: 707a74e27dd6fea52d3785fe4dbe1f46b61d3a84\n\nDependencies: #22720,#23703\n\nCommit: 707a74e27dd6fea52d3785fe4dbe1f46b61d3a84\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23634\n\n",
    "closed_at": "2017-10-15T09:22:23Z",
    "created_at": "2017-08-17T14:23:14Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "A base class for integral quadratic forms seen as modules with a bilinear form.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23634",
    "user": "https://github.com/simonbrandhorst"
}
```
An integral lattice is a free abelian group L together with a non-degenerate integer valued bilinear form L x L --> ZZ.

In sage a lattice should consist of:
- an ambient QQ vector space with an inner product matrix
- a distinguished ZZ-basis (with possibly rational entries)

Integral lattices and quadratic forms are mathematically basically the same.
For me the difference in thinking is that lattices live in an ambient space.
Thus, one can have several lattices in an ambient space and compare their mutual relations (containment, embedding etc.)

Probably it should be derived from 
sage.modules.free_quadratic_module.FreeQuadraticModule_submodule_with_basis_pi

New methods should include 
- discriminant groups and forms
- over and sublattices 
- Orthogonal groups
- direct sums
- is_even 
- is_primitive sublattice
- orthogonal complements
- the dual "lattice"

Keywords: sd91

Reviewer: David Roe

Author: Simon Brandhorst

Branch: 707a74e27dd6fea52d3785fe4dbe1f46b61d3a84

Dependencies: #22720,#23703

Commit: 707a74e27dd6fea52d3785fe4dbe1f46b61d3a84

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23634





---

archive/issue_comments_327055.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-18T07:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327056.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-24T14:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327056",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327057.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-29T12:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327057",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_327058.json:
```json
{
    "body": "<a id='comment:4'></a>Since lattices are parents, they should be unique (for given defining data).  I would suggest using `sage.structure.factory.Factory`, but you may be able to get away with `sage.structure.unique_representation.UniqueRepresentation` instead.",
    "created_at": "2017-08-29T12:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327058",
    "user": "https://github.com/roed314"
}
```

<a id='comment:4'></a>Since lattices are parents, they should be unique (for given defining data).  I would suggest using `sage.structure.factory.Factory`, but you may be able to get away with `sage.structure.unique_representation.UniqueRepresentation` instead.



---

archive/issue_comments_327059.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-09-14T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327059",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_327060.json:
```json
{
    "body": "<a id='comment:5'></a>The very similar classes of submodules\n\nsage.modules.free_module.FreeModule_submodule_field\nsage.modules.free_module.FreeModule_submodule_pid\nsage.modules.free_module_integer.FreeModule_submodule_with_basis_integer\nsage.modules.free_quadratic_module.FreeQuadraticModule_submodule_pid\n\nare not unique. In my view lattices are submodules of an ambient space (with certain restrictions), too. \nCan you make a case why this class should be unique while they are not?\nNote that our lattices are equipped with a distinguished basis. This could change during the runtime.\nThis seems to conflict with the uniqueness of the objects?",
    "created_at": "2017-09-14T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327060",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:5'></a>The very similar classes of submodules

sage.modules.free_module.FreeModule_submodule_field
sage.modules.free_module.FreeModule_submodule_pid
sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer
sage.modules.free_quadratic_module.FreeQuadraticModule_submodule_pid

are not unique. In my view lattices are submodules of an ambient space (with certain restrictions), too. 
Can you make a case why this class should be unique while they are not?
Note that our lattices are equipped with a distinguished basis. This could change during the runtime.
This seems to conflict with the uniqueness of the objects?



---

archive/issue_comments_327061.json:
```json
{
    "body": "<a id='comment:6'></a>Okay.  I'll look at the code again.  There's some trouble with an internal server error, so I'm trying to see if a comment changes anything.",
    "created_at": "2017-09-30T02:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327061",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>Okay.  I'll look at the code again.  There's some trouble with an internal server error, so I'm trying to see if a comment changes anything.



---

archive/issue_comments_327062.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-09-30T02:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327062",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_327063.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T19:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327064.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T22:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327065.json:
```json
{
    "body": "<a id='comment:11'></a>I'm happy with it; Simon, you should take a look at my changes.",
    "created_at": "2017-09-30T22:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327065",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'></a>I'm happy with it; Simon, you should take a look at my changes.



---

archive/issue_comments_327066.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T22:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-30T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327067",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327068.json:
```json
{
    "body": "<a id='comment:13'></a>Looks good!",
    "created_at": "2017-09-30T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327068",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:13'></a>Looks good!



---

archive/issue_comments_327069.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-10-01T02:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327069",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_327070.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-01T02:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_327071.json:
```json
{
    "body": "<a id='comment:16'></a>All doctests pass & the documentation builds.",
    "created_at": "2017-10-01T04:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327071",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:16'></a>All doctests pass & the documentation builds.



---

archive/issue_comments_327072.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-01T04:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327072",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327073.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-10-01T05:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_327074.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-01T05:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_327075.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-01T05:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327075",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327076.json:
```json
{
    "body": "<a id='comment:19'></a>Thanks for fixing those!",
    "created_at": "2017-10-01T05:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327076",
    "user": "https://github.com/roed314"
}
```

<a id='comment:19'></a>Thanks for fixing those!



---

archive/issue_comments_327077.json:
```json
{
    "body": "<a id='comment:20'></a>The documentation for IntegralLattice is wrong.",
    "created_at": "2017-10-01T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327077",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:20'></a>The documentation for IntegralLattice is wrong.



---

archive/issue_comments_327078.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-01T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327078",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_327079.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-01T17:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327080.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-01T19:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327080",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_327081.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-01T20:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327082.json:
```json
{
    "body": "<a id='comment:28'></a>Positive review if you're happy with my changes.\n\n---\nNew commits:",
    "created_at": "2017-10-01T20:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327082",
    "user": "https://github.com/roed314"
}
```

<a id='comment:28'></a>Positive review if you're happy with my changes.

---
New commits:



---

archive/issue_comments_327083.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-01T21:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327083",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327084.json:
```json
{
    "body": "<a id='comment:30'></a>\n```\nsage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py\n**********************************************************************\nFile \"src/sage/modules/free_quadratic_module_integer_symmetric.py\", line 112, in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.__init__\nFailed example:\n    TestSuite(L).run()\nExpected nothing\nGot:\n      Failure in _test_pickling:\n      Traceback (most recent call last):\n        File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 294, in run\n          test_method(tester = tester)\n        File \"sage/structure/sage_object.pyx\", line 683, in sage.structure.sage_object.SageObject._test_pickling (build/cythonized/sage/structure/sage_object.c:5952)\n          tester.assertEqual(loads(dumps(self)), self)\n        File \"/mnt/disk/home/release/Sage/local/lib/python2.7/unittest/case.py\", line 513, in assertEqual\n          assertion_func(first, second, msg=msg)\n        File \"/mnt/disk/home/release/Sage/local/lib/python2.7/unittest/case.py\", line 506, in _baseAssertEqual\n          raise self.failureException(msg)\n      AssertionError: (1, 0) != (1, 0)\n      ------------------------------------------------------------\n      The following tests failed: _test_pickling\n    Failure in _test_elements\n    The following tests failed: _test_elements\n**********************************************************************\nFile \"src/sage/modules/free_quadratic_module_integer_symmetric.py\", line 340, in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement\nFailed example:\n    L.orthogonal_complement(S)\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement[3]>\", line 1, in <module>\n        L.orthogonal_complement(S)\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/modules/free_quadratic_module_integer_symmetric.py\", line 365, in orthogonal_complement\n        return self.sublattice(self.intersection(K).basis())\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/modules/free_module.py\", line 2550, in intersection\n        raise ArithmeticError(\"self and other must be embedded in the same ambient space.\")\n    ArithmeticError: self and other must be embedded in the same ambient space.\n**********************************************************************\n2 items had failures:\n   1 of   4 in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.__init__\n   1 of   7 in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement\n    [65 tests, 2 failures, 0.64 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py  # 2 doctests failed\n----------------------------------------------------------------------\n```",
    "created_at": "2017-10-04T23:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327084",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:30'></a>
```
sage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py
**********************************************************************
File "src/sage/modules/free_quadratic_module_integer_symmetric.py", line 112, in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.__init__
Failed example:
    TestSuite(L).run()
Expected nothing
Got:
      Failure in _test_pickling:
      Traceback (most recent call last):
        File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 294, in run
          test_method(tester = tester)
        File "sage/structure/sage_object.pyx", line 683, in sage.structure.sage_object.SageObject._test_pickling (build/cythonized/sage/structure/sage_object.c:5952)
          tester.assertEqual(loads(dumps(self)), self)
        File "/mnt/disk/home/release/Sage/local/lib/python2.7/unittest/case.py", line 513, in assertEqual
          assertion_func(first, second, msg=msg)
        File "/mnt/disk/home/release/Sage/local/lib/python2.7/unittest/case.py", line 506, in _baseAssertEqual
          raise self.failureException(msg)
      AssertionError: (1, 0) != (1, 0)
      ------------------------------------------------------------
      The following tests failed: _test_pickling
    Failure in _test_elements
    The following tests failed: _test_elements
**********************************************************************
File "src/sage/modules/free_quadratic_module_integer_symmetric.py", line 340, in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement
Failed example:
    L.orthogonal_complement(S)
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement[3]>", line 1, in <module>
        L.orthogonal_complement(S)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/modules/free_quadratic_module_integer_symmetric.py", line 365, in orthogonal_complement
        return self.sublattice(self.intersection(K).basis())
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/modules/free_module.py", line 2550, in intersection
        raise ArithmeticError("self and other must be embedded in the same ambient space.")
    ArithmeticError: self and other must be embedded in the same ambient space.
**********************************************************************
2 items had failures:
   1 of   4 in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.__init__
   1 of   7 in sage.modules.free_quadratic_module_integer_symmetric.FreeQuadraticModule_integer_symmetric.orthogonal_complement
    [65 tests, 2 failures, 0.64 s]
----------------------------------------------------------------------
sage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

archive/issue_comments_327085.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-04T23:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327085",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_327086.json:
```json
{
    "body": "<a id='comment:31'></a>I cannot reproduce this :-(. Can someone else?\n\n```\n./sage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py\nRunning doctests with ID 2017-10-05-11-26-06-7db5d712.\nGit branch: t/23634/a_base_class_for_integral_quadratic_forms_seen_as_modules_with_a_bilinear_form_\nUsing --optional=atlas,ccache,mpir,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py\n    [65 tests, 1.21 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.3 seconds\n    cpu time: 0.9 seconds\n    cumulative wall time: 1.2 seconds\n```",
    "created_at": "2017-10-05T09:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327086",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:31'></a>I cannot reproduce this :-(. Can someone else?

```
./sage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py
Running doctests with ID 2017-10-05-11-26-06-7db5d712.
Git branch: t/23634/a_base_class_for_integral_quadratic_forms_seen_as_modules_with_a_bilinear_form_
Using --optional=atlas,ccache,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 64.6 src/sage/modules/free_quadratic_module_integer_symmetric.py
    [65 tests, 1.21 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.3 seconds
    cpu time: 0.9 seconds
    cumulative wall time: 1.2 seconds
```



---

archive/issue_comments_327087.json:
```json
{
    "body": "<a id='comment:32'></a>I get the failures when I test it with #23915.",
    "created_at": "2017-10-05T15:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327087",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>I get the failures when I test it with #23915.



---

archive/issue_comments_327088.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-06T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327089.json:
```json
{
    "body": "<a id='comment:35'></a>\n```\nsage: from sage.modules.free_quadratic_module_integer_symmetric import *\nsage: L=IntegralLattice(Matrix(ZZ,2,2,[0,1,1,0]))\nsage: x=L.an_element()\nsage: x == loads(dumps(x))\nTrue\nsage: x == loads(dumps(x))\nFalse\nsage: x == loads(dumps(x))\nTrue\nsage: x == loads(dumps(x))\nTrue\n```\nUhm. Is loads(dumps(x)) non-deterministic? This bug confuses me.",
    "created_at": "2017-10-06T08:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327089",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:35'></a>
```
sage: from sage.modules.free_quadratic_module_integer_symmetric import *
sage: L=IntegralLattice(Matrix(ZZ,2,2,[0,1,1,0]))
sage: x=L.an_element()
sage: x == loads(dumps(x))
True
sage: x == loads(dumps(x))
False
sage: x == loads(dumps(x))
True
sage: x == loads(dumps(x))
True
```
Uhm. Is loads(dumps(x)) non-deterministic? This bug confuses me.



---

archive/issue_comments_327090.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-06T09:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327091.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-06T09:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327091",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_327092.json:
```json
{
    "body": "<a id='comment:37'></a>Lets see what the patchbot says.",
    "created_at": "2017-10-06T09:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327092",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:37'></a>Lets see what the patchbot says.



---

archive/issue_comments_327093.json:
```json
{
    "body": "<a id='comment:38'></a>Why not just use `richcmp(lx, rx, op)`?\n\nAlso, instead of\n\n```\nself._inner_product_is_dot_product()==True\n```\nyou should just do `self._inner_product_is_dot_product()`.",
    "created_at": "2017-10-06T18:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327093",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>Why not just use `richcmp(lx, rx, op)`?

Also, instead of

```
self._inner_product_is_dot_product()==True
```
you should just do `self._inner_product_is_dot_product()`.



---

archive/issue_comments_327094.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-06T18:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327095.json:
```json
{
    "body": "<a id='comment:40'></a>Good point. Changed that.\n\n---\nNew commits:",
    "created_at": "2017-10-06T18:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327095",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:40'></a>Good point. Changed that.

---
New commits:



---

archive/issue_comments_327096.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-06T23:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327096",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327097.json:
```json
{
    "body": "<a id='comment:41'></a>Looks good to me.  The failure in `geometry/cone.py` seems to have resulted from an out-of-memory problem.",
    "created_at": "2017-10-06T23:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327097",
    "user": "https://github.com/roed314"
}
```

<a id='comment:41'></a>Looks good to me.  The failure in `geometry/cone.py` seems to have resulted from an out-of-memory problem.



---

archive/issue_events_060489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T09:22:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23634#event-60489"
}
```



---

archive/issue_comments_327098.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-15T09:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23634",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23634#issuecomment-327098",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
