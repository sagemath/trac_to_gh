# Issue 23146: Upgrade to MPIR 3.0 broke SAGE_FAT_BINARY=yes

archive/issues_022909.json:
```json
{
    "body": "\n```\n[mpir-3.0.0] gcc version 5.2.1 20151010 (Ubuntu 5.2.1-22ubuntu2)\n[mpir-3.0.0] ****************************************************\n[mpir-3.0.0] Machine type (default): x86_64-unknown-linux-gnu\n[mpir-3.0.0] Machine type (mpir): sandybridge-unknown-linux-gnu\n[mpir-3.0.0] Building a 64-bit version of MPIR.\n[mpir-3.0.0] Disable use of assembly because of GNU as < 2.23.\n[mpir-3.0.0] Building MPIR with the C++ interface and (also) static libraries.\n[mpir-3.0.0] ** Building with \"fat binary\" support for 64-bit CPUs **\n[mpir-3.0.0] ------------------------------------------------------------------------\n[mpir-3.0.0] Configuring MPIR with empty CFLAGS to determine the defaults:\n[mpir-3.0.0] checking build system type... sandybridge-unknown-linux-gnu\n[mpir-3.0.0] checking host system type... sandybridge-unknown-linux-gnu\n...\n[mpir-3.0.0] configure: error: no version of fat found in path: generic\n[mpir-3.0.0] Error configuring MPIR (with CFLAGS unset).\n[mpir-3.0.0] Consult /home/embray/src/sagemath/sage/local/var/tmp/sage/build/mpir-3.0.0/src/config.log for for details.\n```\n\nAny ideas?\n\n**CC:**  wbhart jpflori\n\n**Keywords:** mpir fat\n\n**Branch/Commit:** [8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)\n\n**Reviewer:** Jean-Pierre Flori\n\n**Author:** Erik Bray\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23146\n\n",
    "closed_at": "2017-06-10T11:38:21Z",
    "created_at": "2017-06-06T08:37:29Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade to MPIR 3.0 broke SAGE_FAT_BINARY=yes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23146",
    "user": "https://github.com/embray"
}
```

```
[mpir-3.0.0] gcc version 5.2.1 20151010 (Ubuntu 5.2.1-22ubuntu2)
[mpir-3.0.0] ****************************************************
[mpir-3.0.0] Machine type (default): x86_64-unknown-linux-gnu
[mpir-3.0.0] Machine type (mpir): sandybridge-unknown-linux-gnu
[mpir-3.0.0] Building a 64-bit version of MPIR.
[mpir-3.0.0] Disable use of assembly because of GNU as < 2.23.
[mpir-3.0.0] Building MPIR with the C++ interface and (also) static libraries.
[mpir-3.0.0] ** Building with "fat binary" support for 64-bit CPUs **
[mpir-3.0.0] ------------------------------------------------------------------------
[mpir-3.0.0] Configuring MPIR with empty CFLAGS to determine the defaults:
[mpir-3.0.0] checking build system type... sandybridge-unknown-linux-gnu
[mpir-3.0.0] checking host system type... sandybridge-unknown-linux-gnu
...
[mpir-3.0.0] configure: error: no version of fat found in path: generic
[mpir-3.0.0] Error configuring MPIR (with CFLAGS unset).
[mpir-3.0.0] Consult /home/embray/src/sagemath/sage/local/var/tmp/sage/build/mpir-3.0.0/src/config.log for for details.
```

Any ideas?

**CC:**  wbhart jpflori

**Keywords:** mpir fat

**Branch/Commit:** [8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)

**Reviewer:** Jean-Pierre Flori

**Author:** Erik Bray

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/23146





---

archive/issue_comments_436859.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think I see--the part of Sage's `spkg-install` that outputs \"Disable use of assembly because of GNU as < 2.23\" is forcing `MPN_PATH=generic` which breaks the fat build.",
    "created_at": "2017-06-06T09:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436859",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
I think I see--the part of Sage's `spkg-install` that outputs "Disable use of assembly because of GNU as < 2.23" is forcing `MPN_PATH=generic` which breaks the fat build.



---

archive/issue_comments_436860.json:
```json
{
    "body": "<a id='comment:4'></a>\nHowever,\n\n```\n$ as --version\nGNU assembler (GNU Binutils for Ubuntu) 2.24\nCopyright 2013 Free Software Foundation, Inc.\nThis program is free software; you may redistribute it under the terms of\nthe GNU General Public License version 3 or later.\nThis program has absolutely no warranty.\nThis assembler was configured for a target of `x86_64-linux-gnu'.\n```",
    "created_at": "2017-06-06T09:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436860",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
However,

```
$ as --version
GNU assembler (GNU Binutils for Ubuntu) 2.24
Copyright 2013 Free Software Foundation, Inc.
This program is free software; you may redistribute it under the terms of
the GNU General Public License version 3 or later.
This program has absolutely no warranty.
This assembler was configured for a target of `x86_64-linux-gnu'.
```



---

archive/issue_comments_436861.json:
```json
{
    "body": "<a id='comment:5'></a>\nHum, but old gnu as do not support recent assembly opcodes...",
    "created_at": "2017-06-06T09:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436861",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>
Hum, but old gnu as do not support recent assembly opcodes...



---

archive/issue_comments_436862.json:
```json
{
    "body": "<a id='comment:6'></a>\nAh, so there is something wrong with the command line detecting the `as` version!\nCan you try it in a shell?",
    "created_at": "2017-06-06T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436862",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:6'></a>
Ah, so there is something wrong with the command line detecting the `as` version!
Can you try it in a shell?



---

archive/issue_comments_436863.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2017-06-06T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436863",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_comments_436864.json:
```json
{
    "body": "**Branch:** [u/embray/mpir/ticket-23146](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/mpir/ticket-23146)",
    "created_at": "2017-06-06T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436864",
    "user": "https://github.com/embray"
}
```

**Branch:** [u/embray/mpir/ticket-23146](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/mpir/ticket-23146)



---

archive/issue_comments_436865.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis should fix it.\n\nI also explicitly disabled `SAGE_FAT_BINARY` in this case, and added an additional warning message that it won't work.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589\">5873c8d</a></td><td><code>Fix GNU as version detection.</code></td></tr></table>\n",
    "created_at": "2017-06-06T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436865",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
This should fix it.

I also explicitly disabled `SAGE_FAT_BINARY` in this case, and added an additional warning message that it won't work.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589">5873c8d</a></td><td><code>Fix GNU as version detection.</code></td></tr></table>




---

archive/issue_comments_436866.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-06-06T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436866",
    "user": "https://github.com/embray"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_436867.json:
```json
{
    "body": "**Commit:** [5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589](https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589)",
    "created_at": "2017-06-06T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436867",
    "user": "https://github.com/embray"
}
```

**Commit:** [5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589](https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589)



---

archive/issue_comments_436868.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'd say it would be better to error out when one sets `SAGE_FAT_BINARY` and only provides an old `as`.",
    "created_at": "2017-06-06T14:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436868",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>
I'd say it would be better to error out when one sets `SAGE_FAT_BINARY` and only provides an old `as`.



---

archive/issue_comments_436869.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-06-06T14:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436869",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_436870.json:
```json
{
    "body": "<a id='comment:9'></a>\nYes, I suppose you're right--otherwise the build will still proceed but you'll wind up with a broken FAT_BINARY build and (possibly) have a hard time tracking exactly where it broke.",
    "created_at": "2017-06-06T15:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436870",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Yes, I suppose you're right--otherwise the build will still proceed but you'll wind up with a broken FAT_BINARY build and (possibly) have a hard time tracking exactly where it broke.



---

archive/issue_comments_436871.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479\">c79b903</a></td><td><code>Make it an error to build with SAGE_FAT_BINARY=yes if 'as' is outdated</code></td></tr></table>\n",
    "created_at": "2017-06-08T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479">c79b903</a></td><td><code>Make it an error to build with SAGE_FAT_BINARY=yes if 'as' is outdated</code></td></tr></table>




---

archive/issue_comments_436872.json:
```json
{
    "body": "**Changing commit** from \"[5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589](https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589)\" to \"[c79b903d66c13ac26ce88bf2aee67693b9304479](https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479)\".",
    "created_at": "2017-06-08T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589](https://github.com/sagemath/sagetrac-mirror/commit/5873c8ddcd3465ebdd0c8e1604b5ec36f5ab8589)" to "[c79b903d66c13ac26ce88bf2aee67693b9304479](https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479)".



---

archive/issue_comments_436873.json:
```json
{
    "body": "<a id='comment:11'></a>\nA final minor comment: you check for version 2.24 but the message mentions \"< 2.23\".",
    "created_at": "2017-06-08T15:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436873",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:11'></a>
A final minor comment: you check for version 2.24 but the message mentions "< 2.23".



---

archive/issue_comments_436874.json:
```json
{
    "body": "**Changing commit** from \"[c79b903d66c13ac26ce88bf2aee67693b9304479](https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479)\" to \"[8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)\".",
    "created_at": "2017-06-08T15:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c79b903d66c13ac26ce88bf2aee67693b9304479](https://github.com/sagemath/sagetrac-mirror/commit/c79b903d66c13ac26ce88bf2aee67693b9304479)" to "[8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)".



---

archive/issue_comments_436875.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b\">8d25401</a></td><td><code>Fix error message accuracy</code></td></tr></table>\n",
    "created_at": "2017-06-08T15:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b">8d25401</a></td><td><code>Fix error message accuracy</code></td></tr></table>




---

archive/issue_comments_436876.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-06-08T15:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436876",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_436877.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-06-08T16:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436877",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_436878.json:
```json
{
    "body": "**Reviewer:** Jean-Pierre Flori",
    "created_at": "2017-06-08T16:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436878",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Reviewer:** Jean-Pierre Flori



---

archive/issue_comments_436879.json:
```json
{
    "body": "<a id='comment:15'></a>\nThanks for the review!",
    "created_at": "2017-06-08T16:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436879",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Thanks for the review!



---

archive/issue_comments_436880.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [embray](#comment%3A9):\n> Yes, I suppose you're right--otherwise the build will still proceed but you'll wind up with a broken FAT_BINARY build and (possibly) have a hard time tracking exactly where it broke.\n\n\nExactly. If the user sets `SAGE_FAT_BINARY=yes`, it is probably for a very good reason which cannot be ignored.",
    "created_at": "2017-06-08T18:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436880",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [embray](#comment%3A9):
> Yes, I suppose you're right--otherwise the build will still proceed but you'll wind up with a broken FAT_BINARY build and (possibly) have a hard time tracking exactly where it broke.


Exactly. If the user sets `SAGE_FAT_BINARY=yes`, it is probably for a very good reason which cannot be ignored.



---

archive/issue_events_068028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-10T11:38:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23146#event-68028"
}
```



---

archive/issue_comments_436881.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/mpir/ticket-23146](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/mpir/ticket-23146)\" to \"[8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)\".",
    "created_at": "2017-06-10T11:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436881",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/mpir/ticket-23146](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/mpir/ticket-23146)" to "[8d25401676bd431373153b10cd9d701062ca499b](https://github.com/sagemath/sagetrac-mirror/commit/8d25401676bd431373153b10cd9d701062ca499b)".



---

archive/issue_comments_436882.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-06-10T11:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23146#issuecomment-436882",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
