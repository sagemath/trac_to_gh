# Issue 23317: NULL result without error while sorting words

archive/issues_023080.json:
```json
{
    "body": "```\nsage: L = [Word([2,2], (1,2)), Word([], (1,2))]\nsage: L\n[word: 22, word: ]\nsage: sorted(L)\n---------------------------------------------------------------------------\nSystemError                               Traceback (most recent call last)\n<ipython-input-31-d66b4ccec544> in <module>()\n----> 1 sorted(L)\n\nSystemError: NULL result without error in PyObject_Call\n```\n\nThis is in [SageMath](SageMath) version 8.0.beta11, while it does work in [SageMath](SageMath) Version 7.5.beta0.\n\nBranch/Commit: a6daec2fae25b930732a807989106b91d595f07a\n\nReviewer: Martin Rubey\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23317\n\n",
    "closed_at": "2017-06-25T15:44:57Z",
    "created_at": "2017-06-23T05:50:55Z",
    "labels": [
        "component: cython",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "NULL result without error while sorting words",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23317",
    "user": "https://github.com/mantepse"
}
```
```
sage: L = [Word([2,2], (1,2)), Word([], (1,2))]
sage: L
[word: 22, word: ]
sage: sorted(L)
---------------------------------------------------------------------------
SystemError                               Traceback (most recent call last)
<ipython-input-31-d66b4ccec544> in <module>()
----> 1 sorted(L)

SystemError: NULL result without error in PyObject_Call
```

This is in [SageMath](SageMath) version 8.0.beta11, while it does work in [SageMath](SageMath) Version 7.5.beta0.

Branch/Commit: a6daec2fae25b930732a807989106b91d595f07a

Reviewer: Martin Rubey

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23317





---

archive/issue_comments_343420.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -21,7 +21,7 @@\n SystemError: NULL result without error in PyObject_Call\n ```\n \n-This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', I had no chance to test in earlier versions.  Yes, the code is stupid, but that's not the issue...\n+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T05:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343420",
    "user": "https://github.com/mantepse"
}
```

Description changed:
```diff
--- 
+++ 
@@ -21,7 +21,7 @@
 SystemError: NULL result without error in PyObject_Call
 ```
 
-This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', I had no chance to test in earlier versions.  Yes, the code is stupid, but that's not the issue...
+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...
 
 Comment: 1
 
```




---

archive/issue_comments_343421.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+```\n+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]\n+def _covers_P(w, v):\n+    def covers(c):\n+        for i in range(len(c)+1):\n+            d = list(c)\n+            d.insert(i, 1)\n+            yield Word(d, alphabet=[1,2])\n+            if i < len(c) and c[i] == 1:\n+                d = list(c)\n+                d[i] = 2\n+                yield Word(d, alphabet=[1,2])\n+                break\n+    return sum(w) == sum(v) + 1 and w in covers(v)\n \n+Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram().vertices()\n+```\n+yields\n+\n+```\n+SystemError: NULL result without error in PyObject_Call\n+```\n+\n+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T05:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343421",
    "user": "https://github.com/mantepse"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,27 @@
+```
+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]
+def _covers_P(w, v):
+    def covers(c):
+        for i in range(len(c)+1):
+            d = list(c)
+            d.insert(i, 1)
+            yield Word(d, alphabet=[1,2])
+            if i < len(c) and c[i] == 1:
+                d = list(c)
+                d[i] = 2
+                yield Word(d, alphabet=[1,2])
+                break
+    return sum(w) == sum(v) + 1 and w in covers(v)
 
+Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram().vertices()
+```
+yields
+
+```
+SystemError: NULL result without error in PyObject_Call
+```
+
+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...
 
 Comment: 1
 
```




---

archive/issue_comments_343422.json:
```json
{
    "body": "<a id='comment:3'></a>I know nothing about `Poset`, but this is a side effect of the first `word` of your list\n\n```\nsage: print V\n[word: , word: 1, word: 2, word: 11, word: 21, word: 12, word: 111, word: 22, word: 211, word: 121, word: 112, word: 1111]\nsage: P = Poset((V, lambda x,y: _covers_P(y, x)))\nsage: H = P.hasse_diagram()\nsage: print H.vertices()\nSystemError                               Traceback (most recent call last)\n...\nSystemError: NULL result without error in PyObject_Call\nsage:\nsage: V.pop(0)\nword: \nsage: P = Poset((V, lambda x,y: _covers_P(y, x)))\nsage: H = P.hasse_diagram()\nsage: print H.vertices()\n[word: 1, word: 11, word: 111, word: 1111, word: 112, word: 12, word: 121, word: 2, word: 21, word: 211, word: 22]\n```\nDon't know how to fix that.",
    "created_at": "2017-06-23T06:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343422",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>I know nothing about `Poset`, but this is a side effect of the first `word` of your list

```
sage: print V
[word: , word: 1, word: 2, word: 11, word: 21, word: 12, word: 111, word: 22, word: 211, word: 121, word: 112, word: 1111]
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
SystemError                               Traceback (most recent call last)
...
SystemError: NULL result without error in PyObject_Call
sage:
sage: V.pop(0)
word: 
sage: P = Poset((V, lambda x,y: _covers_P(y, x)))
sage: H = P.hasse_diagram()
sage: print H.vertices()
[word: 1, word: 11, word: 111, word: 1111, word: 112, word: 12, word: 121, word: 2, word: 21, word: 211, word: 22]
```
Don't know how to fix that.



---

archive/issue_comments_343423.json:
```json
{
    "body": "<a id='comment:4'></a>When reporting bugs **please copy the traceback** too in the ticket description.",
    "created_at": "2017-06-23T07:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343423",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>When reporting bugs **please copy the traceback** too in the ticket description.



---

archive/issue_comments_343424.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,41 @@\n+```\n+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]\n+def _covers_P(w, v):\n+    def covers(c):\n+        for i in range(len(c)+1):\n+            d = list(c)\n+            d.insert(i, 1)\n+            yield Word(d, alphabet=[1,2])\n+            if i < len(c) and c[i] == 1:\n+                d = list(c)\n+                d[i] = 2\n+                yield Word(d, alphabet=[1,2])\n+                break\n+    return sum(w) == sum(v) + 1 and w in covers(v)\n \n+D = Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram()\n+D.vertices()\n+```\n+yields\n+\n+```\n+sage: D.vertices()\n+---------------------------------------------------------------------------\n+SystemError                               Traceback (most recent call last)\n+<ipython-input-6-eadd6dbf25a9> in <module>()\n+----> 1 D.vertices()\n+\n+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in vertices(self, key)\n+  10130             [-8, 0, 1, 96]\n+  10131         \"\"\"\n+> 10132         return sorted(list(self.vertex_iterator()), key=key)\n+  10133 \n+  10134     def neighbors(self, vertex):\n+\n+SystemError: NULL result without error in PyObject_Call\n+```\n+\n+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T07:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343424",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,41 @@
+```
+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]
+def _covers_P(w, v):
+    def covers(c):
+        for i in range(len(c)+1):
+            d = list(c)
+            d.insert(i, 1)
+            yield Word(d, alphabet=[1,2])
+            if i < len(c) and c[i] == 1:
+                d = list(c)
+                d[i] = 2
+                yield Word(d, alphabet=[1,2])
+                break
+    return sum(w) == sum(v) + 1 and w in covers(v)
 
+D = Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram()
+D.vertices()
+```
+yields
+
+```
+sage: D.vertices()
+---------------------------------------------------------------------------
+SystemError                               Traceback (most recent call last)
+<ipython-input-6-eadd6dbf25a9> in <module>()
+----> 1 D.vertices()
+
+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in vertices(self, key)
+  10130             [-8, 0, 1, 96]
+  10131         """
+> 10132         return sorted(list(self.vertex_iterator()), key=key)
+  10133 
+  10134     def neighbors(self, vertex):
+
+SystemError: NULL result without error in PyObject_Call
+```
+
+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...
 
 Comment: 1
 
```




---

archive/issue_comments_343425.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,35 @@\n+```\n+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]\n+def _covers_P(w, v):\n+    def covers(c):\n+        for i in range(len(c)+1):\n+            d = list(c)\n+            d.insert(i, 1)\n+            yield Word(d, alphabet=[1,2])\n+            if i < len(c) and c[i] == 1:\n+                d = list(c)\n+                d[i] = 2\n+                yield Word(d, alphabet=[1,2])\n+                break\n+    return sum(w) == sum(v) + 1 and w in covers(v)\n \n+D = Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram()\n+L = list(D.vertex_iterator())[:2]\n+sorted(L)\n+```\n+yields\n+\n+```\n+sage: sorted(L)\n+---------------------------------------------------------------------------\n+SystemError                               Traceback (most recent call last)\n+<ipython-input-18-d66b4ccec544> in <module>()\n+----> 1 sorted(L)\n+\n+SystemError: NULL result without error in PyObject_Call\n+```\n+\n+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T07:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343425",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,35 @@
+```
+V = [Word(list(w), [1,2]) for k in range(5) for w in Compositions(k, max_part=2)]
+def _covers_P(w, v):
+    def covers(c):
+        for i in range(len(c)+1):
+            d = list(c)
+            d.insert(i, 1)
+            yield Word(d, alphabet=[1,2])
+            if i < len(c) and c[i] == 1:
+                d = list(c)
+                d[i] = 2
+                yield Word(d, alphabet=[1,2])
+                break
+    return sum(w) == sum(v) + 1 and w in covers(v)
 
+D = Poset((V, lambda x,y: _covers_P(y, x))).hasse_diagram()
+L = list(D.vertex_iterator())[:2]
+sorted(L)
+```
+yields
+
+```
+sage: sorted(L)
+---------------------------------------------------------------------------
+SystemError                               Traceback (most recent call last)
+<ipython-input-18-d66b4ccec544> in <module>()
+----> 1 sorted(L)
+
+SystemError: NULL result without error in PyObject_Call
+```
+
+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...
 
 Comment: 1
 
```




---

archive/issue_comments_343426.json:
```json
{
    "body": "Changing component from graph theory to cython.",
    "created_at": "2017-06-23T07:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343426",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from graph theory to cython.



---

archive/issue_comments_343427.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+```\n+sage: L = [Word([2,2], (1,2)), Word([], (1,2))]\n+sage: L\n+[word: 22, word: ]\n+sage: sorted(L)\n+---------------------------------------------------------------------------\n+SystemError                               Traceback (most recent call last)\n+<ipython-input-31-d66b4ccec544> in <module>()\n+----> 1 sorted(L)\n \n+SystemError: NULL result without error in PyObject_Call\n+\n+```\n+\n+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T07:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343427",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,18 @@
+```
+sage: L = [Word([2,2], (1,2)), Word([], (1,2))]
+sage: L
+[word: 22, word: ]
+sage: sorted(L)
+---------------------------------------------------------------------------
+SystemError                               Traceback (most recent call last)
+<ipython-input-31-d66b4ccec544> in <module>()
+----> 1 sorted(L)
 
+SystemError: NULL result without error in PyObject_Call
+
+```
+
+This is in 'SageMath version 8.0.beta11, Release Date: 2017-06-15', while it does work in 'SageMath Version 6.9.beta5, Release Date: 2015-09-04' and in 'SageMath version 7.5.beta0, Release Date: 2016-10-21'.  I had no chance to test in other versions yet.  Yes, the code is stupid, but that's not the issue...
 
 Comment: 1
 
```




---

archive/issue_comments_343428.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+```\n+sage: L = [Word([2,2], (1,2)), Word([], (1,2))]\n+sage: L\n+[word: 22, word: ]\n+sage: sorted(L)\n+---------------------------------------------------------------------------\n+SystemError                               Traceback (most recent call last)\n+<ipython-input-31-d66b4ccec544> in <module>()\n+----> 1 sorted(L)\n \n+SystemError: NULL result without error in PyObject_Call\n+```\n+\n+This is in [SageMath](SageMath) version 8.0.beta11, while it does work in [SageMath](SageMath) Version 7.5.beta0.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-06-23T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343428",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,17 @@
+```
+sage: L = [Word([2,2], (1,2)), Word([], (1,2))]
+sage: L
+[word: 22, word: ]
+sage: sorted(L)
+---------------------------------------------------------------------------
+SystemError                               Traceback (most recent call last)
+<ipython-input-31-d66b4ccec544> in <module>()
+----> 1 sorted(L)
 
+SystemError: NULL result without error in PyObject_Call
+```
+
+This is in [SageMath](SageMath) version 8.0.beta11, while it does work in [SageMath](SageMath) Version 7.5.beta0.
 
 Comment: 1
 
```




---

archive/issue_comments_343429.json:
```json
{
    "body": "<a id='comment:10'></a>New commits:",
    "created_at": "2017-06-23T10:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343429",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>New commits:



---

archive/issue_comments_343430.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-23T10:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343430",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343431.json:
```json
{
    "body": "<a id='comment:11'></a>I also fixed `longest_common_prefix/suffix` which was not handling correctly the case of an empty second argument.",
    "created_at": "2017-06-23T10:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343431",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>I also fixed `longest_common_prefix/suffix` which was not handling correctly the case of an empty second argument.



---

archive/issue_comments_343432.json:
```json
{
    "body": "<a id='comment:12'></a>Cool! I checked what I could, it seems to work flawlessly.  Thank you so much!",
    "created_at": "2017-06-23T11:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343432",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'></a>Cool! I checked what I could, it seems to work flawlessly.  Thank you so much!



---

archive/issue_comments_343433.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-23T11:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343433",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343434.json:
```json
{
    "body": "<a id='comment:14'></a>Thank you Jeroen.",
    "created_at": "2017-06-23T11:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343434",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>Thank you Jeroen.



---

archive/issue_comments_343435.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-25T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23317#issuecomment-343435",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060041.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-25T15:44:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23317",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23317#event-60041"
}
```
