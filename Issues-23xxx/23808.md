# Issue 23808: Keep embedding info when converting algebraics to number field in projective morphism

archive/issues_023571.json:
```json
{
    "body": "Given a map or point defined over QQbar, you can call _numberfield_from_algebraics to return a map over a number field. However, the resulting object cannot be converted back to QQbar since the embedding information is lost.\n\n**CC:**  @bhutz\n\n**Branch/Commit:** [693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)\n\n**Reviewer:** David Roe, Ben Hutz\n\n**Author:** Paul Fili\n\nIssue created by migration from https://trac.sagemath.org/ticket/23808\n\n",
    "closed_at": "2017-09-11T13:46:53Z",
    "created_at": "2017-09-08T16:23:45Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "title": "Keep embedding info when converting algebraics to number field in projective morphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/23808",
    "user": "https://github.com/pfili"
}
```
Given a map or point defined over QQbar, you can call _numberfield_from_algebraics to return a map over a number field. However, the resulting object cannot be converted back to QQbar since the embedding information is lost.

**CC:**  @bhutz

**Branch/Commit:** [693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)

**Reviewer:** David Roe, Ben Hutz

**Author:** Paul Fili

Issue created by migration from https://trac.sagemath.org/ticket/23808





---

archive/issue_comments_361694.json:
```json
{
    "body": "**Branch:** [u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism](https://github.com/sagemath/sagetrac-mirror/tree/u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism)",
    "created_at": "2017-09-08T16:28:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361694",
    "user": "https://github.com/pfili"
}
```

**Branch:** [u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism](https://github.com/sagemath/sagetrac-mirror/tree/u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism)



---

archive/issue_comments_361695.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe following code used to fail:\n\n```python\nR.<t>=PolynomialRing(QQ)\ns = (t^3+t+1).roots(QQbar)[0][0]\nP.<x,y>=ProjectiveSpace(QQbar,1)\nH = Hom(P,P)\nf = H([s*x^3-13*y^3, y^3-15*y^3])\nf_alg = f._number_field_from_algebraics()\nf_alg.change_ring(QQbar) # Used to fail\n```\n\nThe problem was that the number field being defined over which f_alg was defined should include an embedding, telling Sage where to send the generator in the real/complex numbers. (After all, QQbar elements all have this embedding information.) This information was present but was not being used when defining the number field (possibly due to a quirk in the code from qqbar.py). The fix now updates the code to specify this embedding when creating the number field. \n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13\">6c283cf</a></td><td><code>Redefine the number field used to contain the QQbar elements so that</code></td></tr></table>\n",
    "created_at": "2017-09-08T16:44:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361695",
    "user": "https://github.com/pfili"
}
```

<a id='comment:2'></a>
The following code used to fail:

```python
R.<t>=PolynomialRing(QQ)
s = (t^3+t+1).roots(QQbar)[0][0]
P.<x,y>=ProjectiveSpace(QQbar,1)
H = Hom(P,P)
f = H([s*x^3-13*y^3, y^3-15*y^3])
f_alg = f._number_field_from_algebraics()
f_alg.change_ring(QQbar) # Used to fail
```

The problem was that the number field being defined over which f_alg was defined should include an embedding, telling Sage where to send the generator in the real/complex numbers. (After all, QQbar elements all have this embedding information.) This information was present but was not being used when defining the number field (possibly due to a quirk in the code from qqbar.py). The fix now updates the code to specify this embedding when creating the number field. 

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13">6c283cf</a></td><td><code>Redefine the number field used to contain the QQbar elements so that</code></td></tr></table>




---

archive/issue_events_211558.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-08T16:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211558"
}
```



---

archive/issue_comments_361696.json:
```json
{
    "body": "**Author:** paulfili",
    "created_at": "2017-09-08T16:44:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361696",
    "user": "https://github.com/pfili"
}
```

**Author:** paulfili



---

archive/issue_events_211559.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-08T16:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211559"
}
```



---

archive/issue_comments_361697.json:
```json
{
    "body": "**Commit:** [6c283cfa555f0f29b2638bb7c4b35f7476b5fa13](https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13)",
    "created_at": "2017-09-08T16:44:33Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361697",
    "user": "https://github.com/pfili"
}
```

**Commit:** [6c283cfa555f0f29b2638bb7c4b35f7476b5fa13](https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13)



---

archive/issue_events_211560.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-08T16:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "component: algebraic geometry",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211560"
}
```



---

archive/issue_comments_361698.json:
```json
{
    "body": "**Reviewer:** David Roe",
    "created_at": "2017-09-08T21:17:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361698",
    "user": "https://github.com/roed314"
}
```

**Reviewer:** David Roe



---

archive/issue_events_211561.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-09-08T21:17:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211561"
}
```



---

archive/issue_events_211562.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-09-08T21:17:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211562"
}
```



---

archive/issue_comments_361699.json:
```json
{
    "body": "<a id='comment:3'></a>\nYou should add a test to show that the bug has been fixed.  You can use\n\n```\n:trac:`23808`\n```\nto refer to this ticket in the docstring.",
    "created_at": "2017-09-08T21:17:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361699",
    "user": "https://github.com/roed314"
}
```

<a id='comment:3'></a>
You should add a test to show that the bug has been fixed.  You can use

```
:trac:`23808`
```
to refer to this ticket in the docstring.



---

archive/issue_comments_361700.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01\">8548426</a></td><td><code>Added an example illustrating the fix</code></td></tr></table>\n",
    "created_at": "2017-09-08T23:05:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01">8548426</a></td><td><code>Added an example illustrating the fix</code></td></tr></table>




---

archive/issue_comments_361701.json:
```json
{
    "body": "**Changing commit** from \"[6c283cfa555f0f29b2638bb7c4b35f7476b5fa13](https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13)\" to \"[85484263dbc54db00819386193c8784fff284b01](https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01)\".",
    "created_at": "2017-09-08T23:05:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6c283cfa555f0f29b2638bb7c4b35f7476b5fa13](https://github.com/sagemath/sagetrac-mirror/commit/6c283cfa555f0f29b2638bb7c4b35f7476b5fa13)" to "[85484263dbc54db00819386193c8784fff284b01](https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01)".



---

archive/issue_comments_361702.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [roed](#comment%3A3):\n> You should add a test to show that the bug has been fixed.  You can use\n> \n> ```\n> :trac:`23808`\n> ```\n> to refer to this ticket in the docstring.\n\n\nThanks, David, I added the example.",
    "created_at": "2017-09-08T23:08:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361702",
    "user": "https://github.com/pfili"
}
```

<a id='comment:5'></a>
Replying to [roed](#comment%3A3):
> You should add a test to show that the bug has been fixed.  You can use
> 
> ```
> :trac:`23808`
> ```
> to refer to this ticket in the docstring.


Thanks, David, I added the example.



---

archive/issue_events_211563.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-08T23:08:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211563"
}
```



---

archive/issue_events_211564.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-08T23:08:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211564"
}
```



---

archive/issue_comments_361703.json:
```json
{
    "body": "<a id='comment:7'></a>\nYou should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.",
    "created_at": "2017-09-09T00:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361703",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
You should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.



---

archive/issue_events_211565.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-09-09T00:05:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211565"
}
```



---

archive/issue_events_211566.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-09-09T00:05:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211566"
}
```



---

archive/issue_comments_361704.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlso, note that there is a similar function for points that should be modified at the same time.",
    "created_at": "2017-09-09T15:43:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361704",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>
Also, note that there is a similar function for points that should be modified at the same time.



---

archive/issue_comments_361705.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc\">693578c</a></td><td><code>Changed _number_field_from_algebraics in projective point as well</code></td></tr></table>\n",
    "created_at": "2017-09-09T16:43:54Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc">693578c</a></td><td><code>Changed _number_field_from_algebraics in projective point as well</code></td></tr></table>




---

archive/issue_comments_361706.json:
```json
{
    "body": "**Changing commit** from \"[85484263dbc54db00819386193c8784fff284b01](https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01)\" to \"[693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)\".",
    "created_at": "2017-09-09T16:43:54Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[85484263dbc54db00819386193c8784fff284b01](https://github.com/sagemath/sagetrac-mirror/commit/85484263dbc54db00819386193c8784fff284b01)" to "[693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)".



---

archive/issue_comments_361707.json:
```json
{
    "body": "**Changing author** from \"paulfili\" to \"Paul Fili\".",
    "created_at": "2017-09-09T16:44:57Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361707",
    "user": "https://github.com/pfili"
}
```

**Changing author** from "paulfili" to "Paul Fili".



---

archive/issue_events_211567.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-09T16:44:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211567"
}
```



---

archive/issue_events_211568.json:
```json
{
    "actor": "https://github.com/pfili",
    "created_at": "2017-09-09T16:44:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211568"
}
```



---

archive/issue_comments_361708.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [roed](#comment%3A7):\n> You should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.\n\n\nThanks, David, I have changed that as well.",
    "created_at": "2017-09-09T16:45:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361708",
    "user": "https://github.com/pfili"
}
```

<a id='comment:11'></a>
Replying to [roed](#comment%3A7):
> You should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.


Thanks, David, I have changed that as well.



---

archive/issue_events_211569.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2017-09-09T17:30:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211569"
}
```



---

archive/issue_events_211570.json:
```json
{
    "actor": "https://github.com/bhutz",
    "created_at": "2017-09-09T17:30:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211570"
}
```



---

archive/issue_comments_361709.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Given a map or point defined over QQbar, you can call _numberfield_from_algebraics to return a map over a number field. However, the resulting object cannot be converted back to QQbar since the embedding information is lost.\n``````\n",
    "created_at": "2017-09-09T17:30:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361709",
    "user": "https://github.com/bhutz"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Given a map or point defined over QQbar, you can call _numberfield_from_algebraics to return a map over a number field. However, the resulting object cannot be converted back to QQbar since the embedding information is lost.
``````




---

archive/issue_comments_361710.json:
```json
{
    "body": "**Changing reviewer** from \"David Roe\" to \"David Roe, Ben Hutz\".",
    "created_at": "2017-09-09T17:30:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361710",
    "user": "https://github.com/bhutz"
}
```

**Changing reviewer** from "David Roe" to "David Roe, Ben Hutz".



---

archive/issue_comments_361711.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis looks fine to me. I also added a description.",
    "created_at": "2017-09-09T17:30:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361711",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:12'></a>
This looks fine to me. I also added a description.



---

archive/issue_comments_361712.json:
```json
{
    "body": "**Changing branch** from \"[u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism](https://github.com/sagemath/sagetrac-mirror/tree/u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism)\" to \"[693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)\".",
    "created_at": "2017-09-11T13:46:53Z",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23808#issuecomment-361712",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism](https://github.com/sagemath/sagetrac-mirror/tree/u/paulfili/keep_embedding_info_when_converting_algebraics_to_number_field_in_projective_morphism)" to "[693578ca32ded36f9252988917b67aebf0d2dfcc](https://github.com/sagemath/sagetrac-mirror/commit/693578ca32ded36f9252988917b67aebf0d2dfcc)".



---

archive/issue_events_211571.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-11T13:46:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211571"
}
```



---

archive/issue_events_211572.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "75bac0f167f660fe962f1ca071ca22ae21b07b51",
    "created_at": "2017-09-11T13:46:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23808",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23808#event-211572"
}
```
