# Issue 23562: Move module_list aliases to env.py

archive/issues_023562.json:
```json
{
    "body": "CC:  @embray @jhpalmieri @mkoeppe @videlec\n\nMove the aliases from `src/module_list.py` to `src/sage/env.py` such that they can be used at runtime by `cython()` too. This is needed for #22461.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23799\n\n",
    "closed_at": "2017-09-26T06:58:12Z",
    "created_at": "2017-09-07T14:46:25Z",
    "labels": [
        "component: cython"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Move module_list aliases to env.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23562",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @embray @jhpalmieri @mkoeppe @videlec

Move the aliases from `src/module_list.py` to `src/sage/env.py` such that they can be used at runtime by `cython()` too. This is needed for #22461.

Issue created by migration from https://trac.sagemath.org/ticket/23799





---

archive/issue_comments_329700.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-07T15:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329700",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_329701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-08T07:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-12T10:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329703.json:
```json
{
    "body": "Given that the procedure is the same each time\n\n```\nX_pc = pkgconfig.parse('X')\nX_libs = X_pc['libraries']\nX_library_dirs = X_pc['library_dirs']\nX_cflags = pkgconfig.cflags('X').split()\n```\ncould that be factored? (slight lie: no cflags involved for gsl, no include dirs for linbox, ... why?)",
    "created_at": "2017-09-16T09:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329703",
    "user": "https://github.com/videlec"
}
```

Given that the procedure is the same each time

```
X_pc = pkgconfig.parse('X')
X_libs = X_pc['libraries']
X_library_dirs = X_pc['library_dirs']
X_cflags = pkgconfig.cflags('X').split()
```
could that be factored? (slight lie: no cflags involved for gsl, no include dirs for linbox, ... why?)



---

archive/issue_comments_329704.json:
```json
{
    "body": "You mean messing with `globals()`? I don't like that.",
    "created_at": "2017-09-16T11:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329704",
    "user": "https://github.com/jdemeyer"
}
```

You mean messing with `globals()`? I don't like that.



---

archive/issue_comments_329705.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> You mean messing with `globals()`? I don't like that.\n\n\nI meant\n\n```\npackages = ['fflas-ffpack', 'givaro', 'linbox', 'gsl', 'singular']\nans = {}\nfor pkg in packages:\n    pc = pkgconfig.parse(pkg)\n    name = pkg.replace('-', '').upper()\n    ans['%s_LIBRARIES' %name] = pc['libraries']\n    ans['%s_LIBDIR' %name] = pc['library_dirs']\n    ans['%s_INCDIR' %name] = pc['include_dirs']\n    ans['%s_CFLAGS' %name] = pkgconfig.cflags(pkg).split()\nreturn ans\n```",
    "created_at": "2017-09-16T14:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329705",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:7 jdemeyer]:
> You mean messing with `globals()`? I don't like that.


I meant

```
packages = ['fflas-ffpack', 'givaro', 'linbox', 'gsl', 'singular']
ans = {}
for pkg in packages:
    pc = pkgconfig.parse(pkg)
    name = pkg.replace('-', '').upper()
    ans['%s_LIBRARIES' %name] = pc['libraries']
    ans['%s_LIBDIR' %name] = pc['library_dirs']
    ans['%s_INCDIR' %name] = pc['include_dirs']
    ans['%s_CFLAGS' %name] = pkgconfig.cflags(pkg).split()
return ans
```



---

archive/issue_comments_329706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-19T08:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_329707.json:
```json
{
    "body": "Good suggestion, done.",
    "created_at": "2017-09-19T08:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329707",
    "user": "https://github.com/jdemeyer"
}
```

Good suggestion, done.



---

archive/issue_comments_329708.json:
```json
{
    "body": "I like the ticket but I have one more question before setting it to positive review\n\n```diff\n@@ -881,14 +829,14 @@ ext_modules = [\n     Extension('sage.matrix.matrix_modn_dense_float',\n               sources = ['sage/matrix/matrix_modn_dense_float.pyx'],\n               language=\"c++\",\n-              libraries = linbox_libs + cblas_libs,\n+              libraries = cblas_libs,\n               library_dirs = cblas_library_dirs,\n               include_dirs = cblas_include_dirs),\n \n     Extension('sage.matrix.matrix_modn_dense_double',\n               sources = ['sage/matrix/matrix_modn_dense_double.pyx'],\n               language=\"c++\",\n-              libraries = linbox_libs + cblas_libs,\n+              libraries = cblas_libs,\n               library_dirs = cblas_library_dirs,\n               include_dirs = cblas_include_dirs,\n               extra_compile_args = [\"-D_XPG6\"]),\n```\nIt is correct that those don't link to linbox, but the linbox flags provide linking flags to fflas, ffpack and givaro that are needed. Are those brought by a dependency that can escape a cursory look? I could not find any distutils instructions in those particular files to account for the dependencies on fflas, ffpack and givaro.",
    "created_at": "2017-09-21T23:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329708",
    "user": "https://github.com/kiwifb"
}
```

I like the ticket but I have one more question before setting it to positive review

```diff
@@ -881,14 +829,14 @@ ext_modules = [
     Extension('sage.matrix.matrix_modn_dense_float',
               sources = ['sage/matrix/matrix_modn_dense_float.pyx'],
               language="c++",
-              libraries = linbox_libs + cblas_libs,
+              libraries = cblas_libs,
               library_dirs = cblas_library_dirs,
               include_dirs = cblas_include_dirs),
 
     Extension('sage.matrix.matrix_modn_dense_double',
               sources = ['sage/matrix/matrix_modn_dense_double.pyx'],
               language="c++",
-              libraries = linbox_libs + cblas_libs,
+              libraries = cblas_libs,
               library_dirs = cblas_library_dirs,
               include_dirs = cblas_include_dirs,
               extra_compile_args = ["-D_XPG6"]),
```
It is correct that those don't link to linbox, but the linbox flags provide linking flags to fflas, ffpack and givaro that are needed. Are those brought by a dependency that can escape a cursory look? I could not find any distutils instructions in those particular files to account for the dependencies on fflas, ffpack and givaro.



---

archive/issue_comments_329709.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> I like the ticket but I have one more question before setting it to positive review\n> \n> ```\n> #!diff\n> @@ -881,14 +829,14 @@ ext_modules = [\n>      Extension('sage.matrix.matrix_modn_dense_float',\n>                sources = ['sage/matrix/matrix_modn_dense_float.pyx'],\n>                language=\"c++\",\n> -              libraries = linbox_libs + cblas_libs,\n> +              libraries = cblas_libs,\n>                library_dirs = cblas_library_dirs,\n>                include_dirs = cblas_include_dirs),\n>  \n>      Extension('sage.matrix.matrix_modn_dense_double',\n>                sources = ['sage/matrix/matrix_modn_dense_double.pyx'],\n>                language=\"c++\",\n> -              libraries = linbox_libs + cblas_libs,\n> +              libraries = cblas_libs,\n>                library_dirs = cblas_library_dirs,\n>                include_dirs = cblas_include_dirs,\n>                extra_compile_args = [\"-D_XPG6\"]),\n> ```\n\n\nAs far as I know, those files do not actually depend on linbox, fflas-ffpack or givaro.",
    "created_at": "2017-09-22T06:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329709",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 fbissey]:
> I like the ticket but I have one more question before setting it to positive review
> 
> ```
> #!diff
> @@ -881,14 +829,14 @@ ext_modules = [
>      Extension('sage.matrix.matrix_modn_dense_float',
>                sources = ['sage/matrix/matrix_modn_dense_float.pyx'],
>                language="c++",
> -              libraries = linbox_libs + cblas_libs,
> +              libraries = cblas_libs,
>                library_dirs = cblas_library_dirs,
>                include_dirs = cblas_include_dirs),
>  
>      Extension('sage.matrix.matrix_modn_dense_double',
>                sources = ['sage/matrix/matrix_modn_dense_double.pyx'],
>                language="c++",
> -              libraries = linbox_libs + cblas_libs,
> +              libraries = cblas_libs,
>                library_dirs = cblas_library_dirs,
>                include_dirs = cblas_include_dirs,
>                extra_compile_args = ["-D_XPG6"]),
> ```


As far as I know, those files do not actually depend on linbox, fflas-ffpack or givaro.



---

archive/issue_comments_329710.json:
```json
{
    "body": "In sage-on-gentoo which is compiled with `--as-needed` I get\n\n```\nfbissey@moonloop ~ $ readelf -d /usr/lib64/python2.7/site-packages/sage/matrix/matrix_modn_dense_float.so\n\nDynamic section at offset 0x5ea98 contains 32 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libfflas.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libffpack.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n```\nI wouldn't expect those to be present unless some symbols are directly needed. That warrant a closer look.",
    "created_at": "2017-09-22T07:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329710",
    "user": "https://github.com/kiwifb"
}
```

In sage-on-gentoo which is compiled with `--as-needed` I get

```
fbissey@moonloop ~ $ readelf -d /usr/lib64/python2.7/site-packages/sage/matrix/matrix_modn_dense_float.so

Dynamic section at offset 0x5ea98 contains 32 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libfflas.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libffpack.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libgivaro.so.9]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libm.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
```
I wouldn't expect those to be present unless some symbols are directly needed. That warrant a closer look.



---

archive/issue_comments_329711.json:
```json
{
    "body": "Sorry, I was wrong indeed. I missed the `modn` part, I thought that this was about floating-point matrices.",
    "created_at": "2017-09-22T08:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329711",
    "user": "https://github.com/jdemeyer"
}
```

Sorry, I was wrong indeed. I missed the `modn` part, I thought that this was about floating-point matrices.



---

archive/issue_comments_329712.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> I like the ticket but I have one more question before setting it to positive review\n> \n> ```\n> #!diff\n> @@ -881,14 +829,14 @@ ext_modules = [\n>      Extension('sage.matrix.matrix_modn_dense_float',\n>                sources = ['sage/matrix/matrix_modn_dense_float.pyx'],\n>                language=\"c++\",\n> -              libraries = linbox_libs + cblas_libs,\n> +              libraries = cblas_libs,\n>                library_dirs = cblas_library_dirs,\n>                include_dirs = cblas_include_dirs),\n>  \n>      Extension('sage.matrix.matrix_modn_dense_double',\n>                sources = ['sage/matrix/matrix_modn_dense_double.pyx'],\n>                language=\"c++\",\n> -              libraries = linbox_libs + cblas_libs,\n> +              libraries = cblas_libs,\n>                library_dirs = cblas_library_dirs,\n>                include_dirs = cblas_include_dirs,\n>                extra_compile_args = [\"-D_XPG6\"]),\n> ```\n> It is correct that those don't link to linbox\n\n\nThey do actually link against linbox, but the linbox, fflas-ffpack and givaro flags are brought in by cimports of `sage.libs.linbox....` at the beginning of `src/sage/matrix/matrix_modn_dense_float.pyx` and `src/sage/matrix/matrix_modn_dense_double.pyx`",
    "created_at": "2017-09-22T11:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329712",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 fbissey]:
> I like the ticket but I have one more question before setting it to positive review
> 
> ```
> #!diff
> @@ -881,14 +829,14 @@ ext_modules = [
>      Extension('sage.matrix.matrix_modn_dense_float',
>                sources = ['sage/matrix/matrix_modn_dense_float.pyx'],
>                language="c++",
> -              libraries = linbox_libs + cblas_libs,
> +              libraries = cblas_libs,
>                library_dirs = cblas_library_dirs,
>                include_dirs = cblas_include_dirs),
>  
>      Extension('sage.matrix.matrix_modn_dense_double',
>                sources = ['sage/matrix/matrix_modn_dense_double.pyx'],
>                language="c++",
> -              libraries = linbox_libs + cblas_libs,
> +              libraries = cblas_libs,
>                library_dirs = cblas_library_dirs,
>                include_dirs = cblas_include_dirs,
>                extra_compile_args = ["-D_XPG6"]),
> ```
> It is correct that those don't link to linbox


They do actually link against linbox, but the linbox, fflas-ffpack and givaro flags are brought in by cimports of `sage.libs.linbox....` at the beginning of `src/sage/matrix/matrix_modn_dense_float.pyx` and `src/sage/matrix/matrix_modn_dense_double.pyx`



---

archive/issue_comments_329713.json:
```json
{
    "body": "Yet the final product doesn't have any symbols from linbox, otherwise it would be in the list of libraries. I am guessing the content of `sage.libs.linbox` still reflects the time when `fflas-ffpack` wasn't split yet from linbox.",
    "created_at": "2017-09-22T11:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329713",
    "user": "https://github.com/kiwifb"
}
```

Yet the final product doesn't have any symbols from linbox, otherwise it would be in the list of libraries. I am guessing the content of `sage.libs.linbox` still reflects the time when `fflas-ffpack` wasn't split yet from linbox.



---

archive/issue_comments_329714.json:
```json
{
    "body": "Replying to [comment:16 fbissey]:\n> Yet the final product doesn't have any symbols from linbox, otherwise it would be in **the list of libraries**.\n\n\nWhich list of libraries do you mean?\n\nAt least when compiling those extensions, `-llinbox -llinboxsage` is specified. This is true before and after this ticket.",
    "created_at": "2017-09-22T12:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329714",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 fbissey]:
> Yet the final product doesn't have any symbols from linbox, otherwise it would be in **the list of libraries**.


Which list of libraries do you mean?

At least when compiling those extensions, `-llinbox -llinboxsage` is specified. This is true before and after this ticket.



---

archive/issue_comments_329715.json:
```json
{
    "body": "If your comment is that `-llinbox` is specified while it is not needed: that is outside the scope of this ticket. There are probably many such cases.",
    "created_at": "2017-09-22T12:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329715",
    "user": "https://github.com/jdemeyer"
}
```

If your comment is that `-llinbox` is specified while it is not needed: that is outside the scope of this ticket. There are probably many such cases.



---

archive/issue_comments_329716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-24T01:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329716",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_329717.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> If your comment is that `-llinbox` is specified while it is not needed: that is outside the scope of this ticket. There are probably many such cases.\n\n\nThat is the case. But now I am more worried about the lack of `-lfflas -lffpack -lgivaro` but given the bot is green, I am guessing it gets in the same way as `-llinbox`. Let's move things along.",
    "created_at": "2017-09-24T01:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329717",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:18 jdemeyer]:
> If your comment is that `-llinbox` is specified while it is not needed: that is outside the scope of this ticket. There are probably many such cases.


That is the case. But now I am more worried about the lack of `-lfflas -lffpack -lgivaro` but given the bot is green, I am guessing it gets in the same way as `-llinbox`. Let's move things along.



---

archive/issue_comments_329718.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-26T06:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23562#issuecomment-329718",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060693.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-26T06:58:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23562",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23562#event-60693"
}
```
