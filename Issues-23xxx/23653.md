# Issue 23653: py3: fixing the sage-cython script

archive/issues_023416.json:
```json
{
    "body": "extracted from #23106\n\nCC:  @jdemeyer @jhpalmieri @embray\n\nBranch/Commit: dc83ab2ad478d6985550993d763816e2598e7857\n\nReviewer: John Palmieri\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23653\n\n",
    "closed_at": "2017-08-26T09:57:52Z",
    "created_at": "2017-08-19T16:30:11Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: fixing the sage-cython script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23653",
    "user": "https://github.com/fchapoton"
}
```
extracted from #23106

CC:  @jdemeyer @jhpalmieri @embray

Branch/Commit: dc83ab2ad478d6985550993d763816e2598e7857

Reviewer: John Palmieri

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23653





---

archive/issue_comments_447921.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447921",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447922.json:
```json
{
    "body": "<a id='comment:1'></a>\neasy one, please review\n\n---\nNew commits:\n|                                                                                                                                          |                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[dc83ab2](https://github.com/sagemath/sagetrac-mirror/commit/dc83ab2ad478d6985550993d763816e2598e7857)|`fixing the sage-cython script`|",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447922",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
easy one, please review

---
New commits:
|                                                                                                                                          |                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[dc83ab2](https://github.com/sagemath/sagetrac-mirror/commit/dc83ab2ad478d6985550993d763816e2598e7857)|`fixing the sage-cython script`|



---

archive/issue_comments_447923.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/23653\"",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447923",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/23653"



---

archive/issue_comments_447924.json:
```json
{
    "body": "Changing commit from \"\" to \"dc83ab2ad478d6985550993d763816e2598e7857\"",
    "created_at": "2017-08-19T16:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447924",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "dc83ab2ad478d6985550993d763816e2598e7857"



---

archive/issue_comments_447925.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think it's fine. I suppose stylistically some people might prefer\n\n```\ntry:\n    SAGE_SRC = os.environ[\"SAGE_SRC\"]\nexcept KeyError:\n    ...\n```\nbut it doesn't matter to me.",
    "created_at": "2017-08-20T20:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447925",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I think it's fine. I suppose stylistically some people might prefer

```
try:
    SAGE_SRC = os.environ["SAGE_SRC"]
except KeyError:
    ...
```
but it doesn't matter to me.



---

archive/issue_comments_447926.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2017-08-20T20:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447926",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_447927.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-20T20:28:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447927",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447928.json:
```json
{
    "body": "<a id='comment:3'></a>\nWell, I prefer `from sage.env import SAGE_SRC` personally. I am sure my sage-on-distro colleagues are of the same mind. I am not sure why trying to get `SAGE_SRC` from the shell environment is any better or fix anything. Do you want it to work while sage is not installed yet? \n\nBut that brings me to a uglier point. You are using sage's source at run time? OK, you need .pxi files that are not currently installed by \"vanilla\" sage (sage-on-gentoo does so I can point to my sage install instead). And yet another problem with that file is that it is full of .pxi which are currently being systematically phased out.\n\nVolker's already started to merge this ticket so it may be too late, but at least can someone explain the rationale for using `os.environ`?",
    "created_at": "2017-08-22T09:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447928",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Well, I prefer `from sage.env import SAGE_SRC` personally. I am sure my sage-on-distro colleagues are of the same mind. I am not sure why trying to get `SAGE_SRC` from the shell environment is any better or fix anything. Do you want it to work while sage is not installed yet? 

But that brings me to a uglier point. You are using sage's source at run time? OK, you need .pxi files that are not currently installed by "vanilla" sage (sage-on-gentoo does so I can point to my sage install instead). And yet another problem with that file is that it is full of .pxi which are currently being systematically phased out.

Volker's already started to merge this ticket so it may be too late, but at least can someone explain the rationale for using `os.environ`?



---

archive/issue_comments_447929.json:
```json
{
    "body": "<a id='comment:4'></a>\nthe reason is python3 : under a python3 sage install, \"python\" means python2, so that the import of sage.env would fail. See #23106 for another possibility, namely use \"sage-python23\" in the headline instead of \"python\"",
    "created_at": "2017-08-22T09:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447929",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
the reason is python3 : under a python3 sage install, "python" means python2, so that the import of sage.env would fail. See #23106 for another possibility, namely use "sage-python23" in the headline instead of "python"



---

archive/issue_comments_447930.json:
```json
{
    "body": "<a id='comment:5'></a>\nI see. I have other tools at my disposal for wrapping python scripts, so that particular issue doesn't exist for me. From sage-on-distro point of view, we are not thrilled by `sage-python23` in scripts. But at least it is easy to spot and fix systematically.",
    "created_at": "2017-08-22T10:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447930",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I see. I have other tools at my disposal for wrapping python scripts, so that particular issue doesn't exist for me. From sage-on-distro point of view, we are not thrilled by `sage-python23` in scripts. But at least it is easy to spot and fix systematically.



---

archive/issue_comments_447931.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447931",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_447932.json:
```json
{
    "body": "Changing branch from \"u/chapoton/23653\" to \"dc83ab2ad478d6985550993d763816e2598e7857\"",
    "created_at": "2017-08-26T09:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23653#issuecomment-447932",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/23653" to "dc83ab2ad478d6985550993d763816e2598e7857"



---

archive/issue_events_068814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-26T09:57:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23653",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23653#event-68814"
}
```
