# Issue 23510: Fraction field of fixed modulus p-adic rings should have floating point type

archive/issues_023273.json:
```json
{
    "body": "Fraction field of fixed modulus p-adic rings should have floating point type.\n\nCurrently the `change()` method requires that the type be specified, in this case, but instances such as the check `R.fraction_field() is self` occurring in _coerce_map_from_(self, R) in padic_extension_generic.pyc.\n\nCC:  @roed314\n\nKeywords: sd87, beginner\n\nReviewer: Adele Bourgeois, Julian R\u00fcth\n\nAuthor: David Roe\n\nBranch: 189ac2b4a6b37dbe49ea70ab09e6e68b8b091d59\n\nDependencies: #14825, #13591\n\nCommit: 189ac2b4a6b37dbe49ea70ab09e6e68b8b091d59\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23510\n\n",
    "closed_at": "2017-10-05T06:54:10Z",
    "created_at": "2017-07-21T18:40:02Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fraction field of fixed modulus p-adic rings should have floating point type",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23510",
    "user": "https://trac.sagemath.org/admin/accounts/users/bsinclai"
}
```
Fraction field of fixed modulus p-adic rings should have floating point type.

Currently the `change()` method requires that the type be specified, in this case, but instances such as the check `R.fraction_field() is self` occurring in _coerce_map_from_(self, R) in padic_extension_generic.pyc.

CC:  @roed314

Keywords: sd87, beginner

Reviewer: Adele Bourgeois, Julian RÃ¼th

Author: David Roe

Branch: 189ac2b4a6b37dbe49ea70ab09e6e68b8b091d59

Dependencies: #14825, #13591

Commit: 189ac2b4a6b37dbe49ea70ab09e6e68b8b091d59

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23510





---

archive/issue_comments_325320.json:
```json
{
    "body": "<a id='comment:2'></a>Last 10 new commits:",
    "created_at": "2017-07-21T20:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325320",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>Last 10 new commits:



---

archive/issue_comments_325321.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-21T20:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325321",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_325322.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87, beginner\".",
    "created_at": "2017-07-21T20:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325322",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "sd87, beginner".



---

archive/issue_comments_325323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-21T20:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325323",
    "user": "https://trac.sagemath.org/admin/accounts/users/abourgeois"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_325324.json:
```json
{
    "body": "<a id='comment:3'></a>All tests pass!",
    "created_at": "2017-07-21T20:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325324",
    "user": "https://trac.sagemath.org/admin/accounts/users/abourgeois"
}
```

<a id='comment:3'></a>All tests pass!



---

archive/issue_comments_325325.json:
```json
{
    "body": "<a id='comment:4'></a>\n```\nsage: R.<u> = ZqFM(125, 500)\nsage: R.fraction_field().coerce_map_from(R)\nUnboundLocalError: local variable 'coerce_map' referenced before assignment\n```",
    "created_at": "2017-07-23T09:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325325",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>
```
sage: R.<u> = ZqFM(125, 500)
sage: R.fraction_field().coerce_map_from(R)
UnboundLocalError: local variable 'coerce_map' referenced before assignment
```



---

archive/issue_comments_325326.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-23T09:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325326",
    "user": "https://github.com/saraedum"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_325327.json:
```json
{
    "body": "<a id='comment:6'></a>By the way, I would be in favour of implementing a p-adic field with fixed modulus precision (in which each p-adic number is truncated at the same precision encapsulated in the parent). I think it makes perfectly sense. Do you have any objections?\n\n---\nNew commits:",
    "created_at": "2017-07-29T06:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325327",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:6'></a>By the way, I would be in favour of implementing a p-adic field with fixed modulus precision (in which each p-adic number is truncated at the same precision encapsulated in the parent). I think it makes perfectly sense. Do you have any objections?

---
New commits:



---

archive/issue_comments_325328.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 caruso]:\n> By the way, I would be in favour of implementing a p-adic field with fixed modulus precision (in which each p-adic number is truncated at the same precision encapsulated in the parent). I think it makes perfectly sense. Do you have any objections?\n\n\nSo, the amount of information stored in an element is unbounded.  This seems problematic since computations can blow up.  Why do you want to have this precision type?",
    "created_at": "2017-07-29T17:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325328",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>Replying to [comment:6 caruso]:
> By the way, I would be in favour of implementing a p-adic field with fixed modulus precision (in which each p-adic number is truncated at the same precision encapsulated in the parent). I think it makes perfectly sense. Do you have any objections?


So, the amount of information stored in an element is unbounded.  This seems problematic since computations can blow up.  Why do you want to have this precision type?



---

archive/issue_comments_325329.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 roed]:\n> So, the amount of information stored in an element is unbounded.  This seems problematic since computations can blow up.\n\n\nIndeed. But is it really an issue?\nI noticed that similarly `QpCA` does not exist and that the fraction field of `ZpCA` is `QpCR` and I assume that this is for the same reason, isn't it?\n\n> Why do you want to have this precision type?\n\n\nI will maybe need it for implementing precision lattices for which I imagine an absolute cap (having a relative cap is certainly also interesting but does not solve the issue of unbounded elements in the framework of lattice precision since the precision may be spread out over several elements which have quite different valuations).\n\nHowever, besides this, I think that `QpCA` and `QpFM` make sense perfectly and should be the integer ring of `ZpCA` and `ZpFM` respectively. I don't think that it is a good idea to switch automatically between absolute and relative precision, it should be the choice of the user.\nFor instance, for now, we have the following behaviour\n\n```\n    sage: R = ZpCA(5)\n    sage: R.fraction_field().integer_ring()\n    5-adic Ring with capped relative precision 20\n    sage: R.fraction_field().integer_ring() is R\n    False\n```\n\nwhich is, I think, a bit annoying.",
    "created_at": "2017-07-30T11:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325329",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:8'></a>Replying to [comment:7 roed]:
> So, the amount of information stored in an element is unbounded.  This seems problematic since computations can blow up.


Indeed. But is it really an issue?
I noticed that similarly `QpCA` does not exist and that the fraction field of `ZpCA` is `QpCR` and I assume that this is for the same reason, isn't it?

> Why do you want to have this precision type?


I will maybe need it for implementing precision lattices for which I imagine an absolute cap (having a relative cap is certainly also interesting but does not solve the issue of unbounded elements in the framework of lattice precision since the precision may be spread out over several elements which have quite different valuations).

However, besides this, I think that `QpCA` and `QpFM` make sense perfectly and should be the integer ring of `ZpCA` and `ZpFM` respectively. I don't think that it is a good idea to switch automatically between absolute and relative precision, it should be the choice of the user.
For instance, for now, we have the following behaviour

```
    sage: R = ZpCA(5)
    sage: R.fraction_field().integer_ring()
    5-adic Ring with capped relative precision 20
    sage: R.fraction_field().integer_ring() is R
    False
```

which is, I think, a bit annoying.



---

archive/issue_comments_325330.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-03T15:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325331.json:
```json
{
    "body": "<a id='comment:11'></a>Depend on #14825 to include fixes for sections that are internal to coercion system.  Tests pass.\n\nAs for the discussion about adding `QpFM` and `QpCA`, I don't have a strong objection, but it will be very difficult to implement with the current framework in Sage.  In particular, it would require two new templates, since the `CR_template` and `FP_template` don't have the correct precision behavior, while the `CA_template` and `FM_template` don't have the right data representation (they can't store elements with negative valuation).  I don't think this is going to happen anytime soon.\n\n---\nLast 10 new commits:",
    "created_at": "2017-08-03T21:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325331",
    "user": "https://github.com/roed314"
}
```

<a id='comment:11'></a>Depend on #14825 to include fixes for sections that are internal to coercion system.  Tests pass.

As for the discussion about adding `QpFM` and `QpCA`, I don't have a strong objection, but it will be very difficult to implement with the current framework in Sage.  In particular, it would require two new templates, since the `CR_template` and `FP_template` don't have the correct precision behavior, while the `CA_template` and `FM_template` don't have the right data representation (they can't store elements with negative valuation).  I don't think this is going to happen anytime soon.

---
Last 10 new commits:



---

archive/issue_comments_325332.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-03T21:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325332",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325333.json:
```json
{
    "body": "Diff against #14825 for ease of review",
    "created_at": "2017-08-03T21:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325333",
    "user": "https://github.com/roed314"
}
```

Diff against #14825 for ease of review



---

archive/issue_comments_325334.json:
```json
{
    "body": "<a id='comment:12'></a>Attachment [23510_over_14825.diff](tarball://root/attachments/some-uuid/ticket23510/23510_over_14825.diff) by git created at 2017-08-04 02:39:00\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-08-04T02:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Attachment [23510_over_14825.diff](tarball://root/attachments/some-uuid/ticket23510/23510_over_14825.diff) by git created at 2017-08-04 02:39:00

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_325335.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-04T02:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_325336.json:
```json
{
    "body": "Attachment [23510_over_148825_and_13591.diff](tarball://root/attachments/some-uuid/ticket23510/23510_over_148825_and_13591.diff) by @roed314 created at 2017-08-04 02:45:08\n\nDiff against #14825 and #13591 for ease of review",
    "created_at": "2017-08-04T02:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325336",
    "user": "https://github.com/roed314"
}
```

Attachment [23510_over_148825_and_13591.diff](tarball://root/attachments/some-uuid/ticket23510/23510_over_148825_and_13591.diff) by @roed314 created at 2017-08-04 02:45:08

Diff against #14825 and #13591 for ease of review



---

archive/issue_comments_325337.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-04T03:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325338.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-08-21T05:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325338",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_325339.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T16:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325340.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-20T16:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325340",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_325341.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-23T14:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325341",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_325342.json:
```json
{
    "body": "<a id='comment:20'></a>See patchbot",
    "created_at": "2017-09-23T14:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325342",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>See patchbot



---

archive/issue_comments_325343.json:
```json
{
    "body": "<a id='comment:22'></a>Thanks.  Setting back to needs review for tests...\n  \n---\nNew commits:",
    "created_at": "2017-09-23T18:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325343",
    "user": "https://github.com/roed314"
}
```

<a id='comment:22'></a>Thanks.  Setting back to needs review for tests...
  
---
New commits:



---

archive/issue_comments_325344.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-23T18:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325344",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325345.json:
```json
{
    "body": "<a id='comment:23'></a>The test failures don't seem to be related to this ticket....",
    "created_at": "2017-09-25T06:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325345",
    "user": "https://github.com/roed314"
}
```

<a id='comment:23'></a>The test failures don't seem to be related to this ticket....



---

archive/issue_comments_325346.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-04T05:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325346",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_325347.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-05T06:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325347",
    "user": "https://github.com/saraedum"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_325348.json:
```json
{
    "body": "<a id='comment:25'></a>This does not fix the following problem:\n\n```\nsage: R=ZpFM(3)\nsage: K=R.fraction_field()\nsage: K.coerce_map_from(R).is_injective()\nNotImplementedError\n```",
    "created_at": "2017-10-05T06:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325348",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:25'></a>This does not fix the following problem:

```
sage: R=ZpFM(3)
sage: K=R.fraction_field()
sage: K.coerce_map_from(R).is_injective()
NotImplementedError
```



---

archive/issue_comments_325349.json:
```json
{
    "body": "<a id='comment:26'></a>Let's make this a new issue, #23965.",
    "created_at": "2017-10-05T06:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325349",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:26'></a>Let's make this a new issue, #23965.



---

archive/issue_comments_325350.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-05T06:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325350",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_060286.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:54:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23510#event-60286"
}
```



---

archive/issue_comments_325351.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-05T06:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23510#issuecomment-325351",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
