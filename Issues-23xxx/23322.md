# Issue 23322: py3: richcmp for modular symbols

archive/issues_023085.json:
```json
{
    "assignees": [],
    "body": "as another step to python3\n\nusing the very newly available decorator `@`richcmp_method\n\nCC:  @tscrim @jdemeyer\n\nBranch/Commit: **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**\n\nReviewer: **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23322_\n\n",
    "closed_at": "2017-07-26T22:13:07Z",
    "created_at": "2017-06-23T14:53:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: richcmp for modular symbols",
    "type": "issue",
    "updated_at": "2017-07-26T22:13:07Z",
    "url": "https://github.com/sagemath/sage/issues/23322",
    "user": "https://github.com/fchapoton"
}
```
as another step to python3

using the very newly available decorator `@`richcmp_method

CC:  @tscrim @jdemeyer

Branch/Commit: **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**

Reviewer: **Travis Scrimshaw, Frédéric Chapoton**

Author: **Frédéric Chapoton, Travis Scrimshaw**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/23322_





---

archive/issue_events_324704.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T14:53:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324704"
}
```



---

archive/issue_events_324705.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T14:53:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324705"
}
```



---

archive/issue_events_324706.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T14:53:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324706"
}
```



---

archive/issue_events_324707.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T14:53:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324707"
}
```



---

archive/issue_events_324708.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T14:53:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324708"
}
```



---

archive/issue_comments_349976.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f\">1f7ff21</a></td><td><code>py3: richcmp for modular symbols</code></td></tr></table>\n",
    "created_at": "2017-06-23T14:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349976",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f">1f7ff21</a></td><td><code>py3: richcmp for modular symbols</code></td></tr></table>




---

archive/issue_comments_349977.json:
```json
{
    "body": "Commit: **[`1f7ff21`](https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f)**",
    "created_at": "2017-06-23T14:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349977",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`1f7ff21`](https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f)**



---

archive/issue_comments_349978.json:
```json
{
    "body": "Branch: **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)**",
    "created_at": "2017-06-23T14:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349978",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)**



---

archive/issue_comments_349979.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n\n```\nsage -t src/sage/modular/abvar/homspace.py  # Timed out\nsage -t src/sage/modular/hecke/hecke_operator.py  # 1 doctest failed\n```",
    "created_at": "2017-06-23T15:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349979",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>


```
sage -t src/sage/modular/abvar/homspace.py  # Timed out
sage -t src/sage/modular/hecke/hecke_operator.py  # 1 doctest failed
```



---

archive/issue_events_324709.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T15:06:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324709"
}
```



---

archive/issue_events_324710.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-23T15:06:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324710"
}
```



---

archive/issue_comments_349980.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa\">4319997</a></td><td><code>trac 23322 tentative fix</code></td></tr></table>\n",
    "created_at": "2017-06-23T15:15:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349980",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa">4319997</a></td><td><code>trac 23322 tentative fix</code></td></tr></table>




---

archive/issue_comments_349981.json:
```json
{
    "body": "Changed commit from **[`1f7ff21`](https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f)** to **[`4319997`](https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa)**",
    "created_at": "2017-06-23T15:15:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349981",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1f7ff21`](https://github.com/sagemath/sagetrac-mirror/commit/1f7ff21dda9b0da4d406754497f181f98076498f)** to **[`4319997`](https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa)**



---

archive/issue_comments_349982.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nJeroen or Travis, could you please help to fix the pickling issue arising here ?\n\nI had to change some classes from old-style classes to SageObject classes in order to benefit from the new `@richcmp_method` decorator. This breaks the pickles, but I do not known how to fix that.\n\nSee patchbot report for the exact doctest failure.\n\nMaybe this is not the only issue with the branch.",
    "created_at": "2017-06-24T20:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349982",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

Jeroen or Travis, could you please help to fix the pickling issue arising here ?

I had to change some classes from old-style classes to SageObject classes in order to benefit from the new `@richcmp_method` decorator. This breaks the pickles, but I do not known how to fix that.

See patchbot report for the exact doctest failure.

Maybe this is not the only issue with the branch.



---

archive/issue_events_324711.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-24T20:26:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324711"
}
```



---

archive/issue_events_324712.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-24T20:26:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324712"
}
```



---

archive/issue_comments_349983.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI think there might be two issues here. The `H == loads(dumps(H))` might be exposing something with the decorator not being well-behaved wrt pickling. The second might be due to old-style vs new-style classes, but IDK without doing a much deeper investigation than I have time ATM.\n\nSide comment: in `HeckeOperator`, the check\n\n```\nif not isinstance(other, HeckeOperator):\n```\nseems superfluous now because the coercion framework should make them have the same parent, and hence, the same element class (at least if it is a proper, well-behaved parent).",
    "created_at": "2017-06-24T23:43:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349983",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I think there might be two issues here. The `H == loads(dumps(H))` might be exposing something with the decorator not being well-behaved wrt pickling. The second might be due to old-style vs new-style classes, but IDK without doing a much deeper investigation than I have time ATM.

Side comment: in `HeckeOperator`, the check

```
if not isinstance(other, HeckeOperator):
```
seems superfluous now because the coercion framework should make them have the same parent, and hence, the same element class (at least if it is a proper, well-behaved parent).



---

archive/issue_comments_349984.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@tscrim](#comment:5):\n> at least if it is a proper, well-behaved parent\n\nWhat do you mean with this? There is nothing in the coercion framework which says that \"equal parents\" should imply \"equal Python classes\". For *most* parents, this implication happens to be true, but it's not a general rule.",
    "created_at": "2017-06-26T07:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349984",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@tscrim](#comment:5):
> at least if it is a proper, well-behaved parent

What do you mean with this? There is nothing in the coercion framework which says that "equal parents" should imply "equal Python classes". For *most* parents, this implication happens to be true, but it's not a general rule.



---

archive/issue_comments_349985.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@fchapoton](#comment:4):\n> Jeroen or Travis, could you please help to fix the pickling issue arising here ?\n\nIt would help if you could specify exactly which \"issue\" you mean.",
    "created_at": "2017-06-26T09:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349985",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@fchapoton](#comment:4):
> Jeroen or Travis, could you please help to fix the pickling issue arising here ?

It would help if you could specify exactly which "issue" you mean.



---

archive/issue_comments_349986.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhy the `return (op == op_NE)` for non-matching types? The proper Python behaviour is `return NotImplemented` when you cannot decide a comparison.",
    "created_at": "2017-06-26T09:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349986",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Why the `return (op == op_NE)` for non-matching types? The proper Python behaviour is `return NotImplemented` when you cannot decide a comparison.



---

archive/issue_events_324713.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-26T11:29:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324713"
}
```



---

archive/issue_events_324714.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-26T11:29:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324714"
}
```



---

archive/issue_comments_349987.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWith the current branch, I get\n\n```\nsage -t src/sage/modular/hecke/ambient_module.py\n**********************************************************************\nFile \"src/sage/modular/hecke/ambient_module.py\", line 167, in sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element\nFailed example:\n    sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, 3, 2, 4)._hecke_image_of_ith_basis_element(4, 2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: Derived class <class 'sage.modular.hecke.ambient_module.AmbientHeckeModule_with_category'> should implement __cmp__\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element[0]>\", line 1, in <module>\n        sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, Integer(3), Integer(2), Integer(4))._hecke_image_of_ith_basis_element(Integer(4), Integer(2))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/ambient_module.py\", line 172, in _hecke_image_of_ith_basis_element\n        return self.hecke_operator(n)(self.gen(i))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 203, in __call__\n        T = self.hecke_module_morphism()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 142, in hecke_module_morphism\n        T = self.matrix()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py\", line 750, in matrix\n        self.__matrix = self.parent().hecke_matrix(self.__n, *args, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/algebra.py\", line 592, in hecke_matrix\n        return self.__M.hecke_matrix(n, *args, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 1389, in hecke_matrix\n        T = self._compute_hecke_matrix(n)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 220, in _compute_hecke_matrix\n        return self._compute_hecke_matrix_prime_power(F[0][0],F[0][1], **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 148, in _compute_hecke_matrix_prime_power\n        self._hecke_matrices[pow] = self._compute_hecke_matrix(pow)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 216, in _compute_hecke_matrix\n        return self._compute_hecke_matrix_prime(n, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py\", line 239, in _compute_hecke_matrix_prime\n        raise NotImplementedError(\"All subclasses must implement _compute_hecke_matrix_prime\")\n    NotImplementedError: All subclasses must implement _compute_hecke_matrix_prime\n**********************************************************************\n```\nI think it's sufficient to fix the doctest here.",
    "created_at": "2017-06-26T11:29:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349987",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

With the current branch, I get

```
sage -t src/sage/modular/hecke/ambient_module.py
**********************************************************************
File "src/sage/modular/hecke/ambient_module.py", line 167, in sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element
Failed example:
    sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, 3, 2, 4)._hecke_image_of_ith_basis_element(4, 2)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Derived class <class 'sage.modular.hecke.ambient_module.AmbientHeckeModule_with_category'> should implement __cmp__
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.hecke.ambient_module.AmbientHeckeModule._hecke_image_of_ith_basis_element[0]>", line 1, in <module>
        sage.modular.hecke.ambient_module.AmbientHeckeModule(QQ, Integer(3), Integer(2), Integer(4))._hecke_image_of_ith_basis_element(Integer(4), Integer(2))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/ambient_module.py", line 172, in _hecke_image_of_ith_basis_element
        return self.hecke_operator(n)(self.gen(i))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 203, in __call__
        T = self.hecke_module_morphism()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 142, in hecke_module_morphism
        T = self.matrix()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/hecke_operator.py", line 750, in matrix
        self.__matrix = self.parent().hecke_matrix(self.__n, *args, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/algebra.py", line 592, in hecke_matrix
        return self.__M.hecke_matrix(n, *args, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 1389, in hecke_matrix
        T = self._compute_hecke_matrix(n)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 220, in _compute_hecke_matrix
        return self._compute_hecke_matrix_prime_power(F[0][0],F[0][1], **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 148, in _compute_hecke_matrix_prime_power
        self._hecke_matrices[pow] = self._compute_hecke_matrix(pow)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 216, in _compute_hecke_matrix
        return self._compute_hecke_matrix_prime(n, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/modular/hecke/module.py", line 239, in _compute_hecke_matrix_prime
        raise NotImplementedError("All subclasses must implement _compute_hecke_matrix_prime")
    NotImplementedError: All subclasses must implement _compute_hecke_matrix_prime
**********************************************************************
```
I think it's sufficient to fix the doctest here.



---

archive/issue_comments_349988.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment:6):\n> Replying to [@tscrim](#comment:5):\n> > at least if it is a proper, well-behaved parent\n\n> \n> What do you mean with this? There is nothing in the coercion framework which says that \"equal parents\" should imply \"equal Python classes\". For *most* parents, this implication happens to be true, but it's not a general rule.\n\nI'm going to use a cop-out and say \"well-behaved\" `:P`, but yes, fair point. There is also the fact that the Hecke algebra here bypasses the usual coercion and implements its own custom `__call__`. So, we do need to keep the extra type checking and handling by `_richcmp_`.",
    "created_at": "2017-06-26T11:47:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349988",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment:6):
> Replying to [@tscrim](#comment:5):
> > at least if it is a proper, well-behaved parent

> 
> What do you mean with this? There is nothing in the coercion framework which says that "equal parents" should imply "equal Python classes". For *most* parents, this implication happens to be true, but it's not a general rule.

I'm going to use a cop-out and say "well-behaved" `:P`, but yes, fair point. There is also the fact that the Hecke algebra here bypasses the usual coercion and implements its own custom `__call__`. So, we do need to keep the extra type checking and handling by `_richcmp_`.



---

archive/issue_comments_349989.json:
```json
{
    "body": "Changed commit from **[`4319997`](https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa)** to **[`88bf1ca`](https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449)**",
    "created_at": "2017-07-05T06:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349989",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4319997`](https://github.com/sagemath/sagetrac-mirror/commit/431999798b79d4232efa345f541c195d95d3bbfa)** to **[`88bf1ca`](https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449)**



---

archive/issue_comments_349990.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a9a76d2b4c6839220c079d0a7df804767a64b6a\">5a9a76d</a></td><td><code>Merge branch 'u/chapoton/23322' in 8.0.rc0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97132951a4e1c1610f3fdf6939ede9a249b678d7\">9713295</a></td><td><code>trac 23322 changing to NotImplemented</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449\">88bf1ca</a></td><td><code>trac 23322 fixing a doctest</code></td></tr></table>\n",
    "created_at": "2017-07-05T06:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349990",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a9a76d2b4c6839220c079d0a7df804767a64b6a">5a9a76d</a></td><td><code>Merge branch 'u/chapoton/23322' in 8.0.rc0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97132951a4e1c1610f3fdf6939ede9a249b678d7">9713295</a></td><td><code>trac 23322 changing to NotImplemented</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449">88bf1ca</a></td><td><code>trac 23322 fixing a doctest</code></td></tr></table>




---

archive/issue_comments_349991.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI fixed the failing doctest and made the suggested changes (using `NotImplemented`).\n\nThere remains the 3 pickling problems, namely in\n\n```\nsage -t --long src/sage/structure/sage_object.pyx\n```\nand more precisely (see patchbot reports for more details):\n\n```\n    Failed:\n    _class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj\n    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj\n    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma_h__.sobj\n    ----------------------------------------------------------------------\n    ** This error is probably due to an old pickle failing to unpickle.\n    ** See sage.structure.sage_object.register_unpickle_override for\n    ** how to override the default unpickling methods for (old) pickles.\n    ** NOTE: pickles should never be removed from the pickle_jar! \n    ----------------------------------------------------------------------\n    Successfully unpickled 583 objects.\n    Failed to unpickle 3 objects.\n```\nPlease help to fix that, because I am not able to.",
    "created_at": "2017-07-05T06:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349991",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

I fixed the failing doctest and made the suggested changes (using `NotImplemented`).

There remains the 3 pickling problems, namely in

```
sage -t --long src/sage/structure/sage_object.pyx
```
and more precisely (see patchbot reports for more details):

```
    Failed:
    _class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj
    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj
    _class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma_h__.sobj
    ----------------------------------------------------------------------
    ** This error is probably due to an old pickle failing to unpickle.
    ** See sage.structure.sage_object.register_unpickle_override for
    ** how to override the default unpickling methods for (old) pickles.
    ** NOTE: pickles should never be removed from the pickle_jar! 
    ----------------------------------------------------------------------
    Successfully unpickled 583 objects.
    Failed to unpickle 3 objects.
```
Please help to fix that, because I am not able to.



---

archive/issue_comments_349992.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nping ? any expert on pickling ?",
    "created_at": "2017-07-07T07:02:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349992",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

ping ? any expert on pickling ?



---

archive/issue_comments_349993.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nmaybe we can just update the pickle jar ?",
    "created_at": "2017-07-07T13:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349993",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

maybe we can just update the pickle jar ?



---

archive/issue_comments_349994.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@fchapoton](#comment:14):\n> maybe we can just update the pickle jar ?\n\nNo, we really should not do that, at least not without a deprecation of the old pickles.",
    "created_at": "2017-07-07T14:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349994",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@fchapoton](#comment:14):
> maybe we can just update the pickle jar ?

No, we really should not do that, at least not without a deprecation of the old pickles.



---

archive/issue_comments_349995.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b0de65210e4b9e1d324543a2d8dfca16ae9c29e\">0b0de65</a></td><td><code>Merge branch 'u/chapoton/23322' in 8.0.rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c\">12258aa</a></td><td><code>trac 23322 fixing the pickles</code></td></tr></table>\n",
    "created_at": "2017-07-07T14:51:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349995",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b0de65210e4b9e1d324543a2d8dfca16ae9c29e">0b0de65</a></td><td><code>Merge branch 'u/chapoton/23322' in 8.0.rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c">12258aa</a></td><td><code>trac 23322 fixing the pickles</code></td></tr></table>




---

archive/issue_comments_349996.json:
```json
{
    "body": "Changed commit from **[`88bf1ca`](https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449)** to **[`12258aa`](https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c)**",
    "created_at": "2017-07-07T14:51:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349996",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`88bf1ca`](https://github.com/sagemath/sagetrac-mirror/commit/88bf1caeb412c4296f546312a9e043a5ef10c449)** to **[`12258aa`](https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c)**



---

archive/issue_comments_349997.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nok, I think that I have found a proper solution for the pickling issue. I kept a minimalist old-style class.",
    "created_at": "2017-07-07T14:52:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349997",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

ok, I think that I have found a proper solution for the pickling issue. I kept a minimalist old-style class.



---

archive/issue_events_324715.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-07T14:52:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324715"
}
```



---

archive/issue_events_324716.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-07T14:52:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324716"
}
```



---

archive/issue_comments_349998.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is a solution, but IMO it is a complete hack solution. I suspect the issues comes from the fact that the base class is now `SageObject` versus a old-style Python class:\n\n```python\nsage: class Foo(object):\n....:     def __init__(self, x):\n....:         self._x = x\n....:     def __eq__(self, other):\n....:         return self._x == other._x\nsage: F = Foo(5)\nsage: F.__class__.__mro__\n(<class '__main__.Foo'>, <type 'object'>)\nsage: class Foo:\n...\nsage: F = Foo(5)\nsage: F.__class__.__mro__\n...\nAttributeError: class Foo has no attribute '__mro__'\n```\nHowever, I'm not sure exactly how to fix this. Have you tried implementing a custom `__setstate__`?\n\nOne way to get around this should be to use a function as the unpickle override, but IIRC, classes need to go to classes, so I think this ends up not working. Yet, there is a close variant of this approach that has a simple target class with a `__setstate__`, that when called and the unpickling is done, it then sets the `self.__class__ = Foo`. I believe this is done somewhere in the codebase...",
    "created_at": "2017-07-07T15:17:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349998",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

This is a solution, but IMO it is a complete hack solution. I suspect the issues comes from the fact that the base class is now `SageObject` versus a old-style Python class:

```python
sage: class Foo(object):
....:     def __init__(self, x):
....:         self._x = x
....:     def __eq__(self, other):
....:         return self._x == other._x
sage: F = Foo(5)
sage: F.__class__.__mro__
(<class '__main__.Foo'>, <type 'object'>)
sage: class Foo:
...
sage: F = Foo(5)
sage: F.__class__.__mro__
...
AttributeError: class Foo has no attribute '__mro__'
```
However, I'm not sure exactly how to fix this. Have you tried implementing a custom `__setstate__`?

One way to get around this should be to use a function as the unpickle override, but IIRC, classes need to go to classes, so I think this ends up not working. Yet, there is a close variant of this approach that has a simple target class with a `__setstate__`, that when called and the unpickling is done, it then sets the `self.__class__ = Foo`. I believe this is done somewhere in the codebase...



---

archive/issue_events_324717.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-07T15:17:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324717"
}
```



---

archive/issue_events_324718.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-07T15:17:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324718"
}
```



---

archive/issue_comments_349999.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI have found something in `src/sage/combinat/skew_tableau.py` but not managed so far to adapt it to the current situation.",
    "created_at": "2017-07-09T10:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-349999",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

I have found something in `src/sage/combinat/skew_tableau.py` but not managed so far to adapt it to the current situation.



---

archive/issue_comments_350000.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nTrying this\n\n```\nclass G1list_old:\n    \"\"\"\n    This exists solely for unpickling old ``G1list`` objects.\n\n    TESTS::\n\n        sage: L = sage.modular.modsym.g1list.G1list_old(18)\n        sage: loads(dumps(L)) == L\n        True\n    \"\"\"\n    def __setstate__(self, state):\n        r\"\"\"\n        Unpickle old ``G1list`` objects.\n        \"\"\"\n        self.__class__ = G1list_new\n        self.__init__(state['_N'])\n```\nfails `unpickle_all()` with error:\n\n```\nline 160, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n```\nWhen changing the first line to `class G1list_old(object)`, I get another error.",
    "created_at": "2017-07-09T14:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350000",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

Trying this

```
class G1list_old:
    """
    This exists solely for unpickling old ``G1list`` objects.

    TESTS::

        sage: L = sage.modular.modsym.g1list.G1list_old(18)
        sage: loads(dumps(L)) == L
        True
    """
    def __setstate__(self, state):
        r"""
        Unpickle old ``G1list`` objects.
        """
        self.__class__ = G1list_new
        self.__init__(state['_N'])
```
fails `unpickle_all()` with error:

```
line 160, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
```
When changing the first line to `class G1list_old(object)`, I get another error.



---

archive/issue_comments_350001.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@fchapoton](#comment:20):\n> fails `unpickle_all()` with error:\n> \n> ```\n> line 160, in __setstate__\n>     self.__class__ = G1list_new\n> TypeError: __class__ must be set to a class\n> ```\n\nWriting *complete* tracebacks in tickets is very useful if people want to understand the issue.",
    "created_at": "2017-07-10T08:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350001",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@fchapoton](#comment:20):
> fails `unpickle_all()` with error:
> 
> ```
> line 160, in __setstate__
>     self.__class__ = G1list_new
> TypeError: __class__ must be set to a class
> ```

Writing *complete* tracebacks in tickets is very useful if people want to understand the issue.



---

archive/issue_comments_350002.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nHere it is (I am going to push the corresponding branch as `u/chapoton/23322_experimental`):\n\n```\nsage: from sage.structure.sage_object import *\nsage: unpickle_all()\n/home/chapoton/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2881: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/18375 for details.\n  exec(code_obj, self.user_global_ns, self.user_ns)\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.\nSee http://trac.sagemath.org/1000 for details.\n  #!/usr/bin/env python\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: This function is only used to unpickle invalid objects\nSee http://trac.sagemath.org/18848 for details.\n  #!/usr/bin/env python\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.\nSee http://trac.sagemath.org/8920 for details.\n  #!/usr/bin/env python\n * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj')\nTraceback (most recent call last):\n  File \"sage/structure/sage_object.pyx\", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)\n    object = load(os.path.join(dir,A))\n  File \"sage/structure/sage_object.pyx\", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)\n    X = loads(open(filename).read(), compress=compress)\n  File \"sage/structure/sage_object.pyx\", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)\n    return unpickler.load()\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py\", line 151, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead\nSee http://trac.sagemath.org/17451 for details.\n  #!/usr/bin/env python\n * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj')\nTraceback (most recent call last):\n  File \"sage/structure/sage_object.pyx\", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)\n    object = load(os.path.join(dir,A))\n  File \"sage/structure/sage_object.pyx\", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)\n    X = loads(open(filename).read(), compress=compress)\n  File \"sage/structure/sage_object.pyx\", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)\n    return unpickler.load()\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py\", line 151, in __setstate__\n    self.__class__ = G1list_new\nTypeError: __class__ must be set to a class\n/home/chapoton/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_constructor.py:718: DeprecationWarning: The \"pari_mod\" finite field implementation is deprecated\nSee http://trac.sagemath.org/17297 for details.\n  K = FiniteField_ext_pari(order, name, modulus)\n/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: ANRootOfUnity is deprecated\nSee http://trac.sagemath.org/19954 for details.\n  #!/usr/bin/env python\nFailed:\n_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj\n_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj\n----------------------------------------------------------------------\n** This error is probably due to an old pickle failing to unpickle.\n** See sage.structure.sage_object.register_unpickle_override for\n** how to override the default unpickling methods for (old) pickles.\n** NOTE: pickles should never be removed from the pickle_jar! \n----------------------------------------------------------------------\nSuccessfully unpickled 584 objects.\nFailed to unpickle 2 objects.\n```",
    "created_at": "2017-07-10T09:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350002",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

Here it is (I am going to push the corresponding branch as `u/chapoton/23322_experimental`):

```
sage: from sage.structure.sage_object import *
sage: unpickle_all()
/home/chapoton/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py:2881: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/18375 for details.
  exec(code_obj, self.user_global_ns, self.user_ns)
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: You unpickled an object which relies on an old data structure. Save it again to update it, for it may break in the future.
See http://trac.sagemath.org/1000 for details.
  #!/usr/bin/env python
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: This function is only used to unpickle invalid objects
See http://trac.sagemath.org/18848 for details.
  #!/usr/bin/env python
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: OrderedAlphabet is deprecated; use Alphabet instead.
See http://trac.sagemath.org/8920 for details.
  #!/usr/bin/env python
 * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj')
Traceback (most recent call last):
  File "sage/structure/sage_object.pyx", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)
    object = load(os.path.join(dir,A))
  File "sage/structure/sage_object.pyx", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)
    X = loads(open(filename).read(), compress=compress)
  File "sage/structure/sage_object.pyx", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)
    return unpickler.load()
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py", line 151, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: gen_py.pari is deprecated, use sage.libs.pari.all.pari instead
See http://trac.sagemath.org/17451 for details.
  #!/usr/bin/env python
 * unpickle failure: load('/home/chapoton/.sage/temp/pc-chapoton/15061/dir_Ctdi9T//pickle_jar/_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj')
Traceback (most recent call last):
  File "sage/structure/sage_object.pyx", line 1694, in sage.structure.sage_object.unpickle_all (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:17663)
    object = load(os.path.join(dir,A))
  File "sage/structure/sage_object.pyx", line 1089, in sage.structure.sage_object.load (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:13196)
    X = loads(open(filename).read(), compress=compress)
  File "sage/structure/sage_object.pyx", line 1489, in sage.structure.sage_object.loads (/home/chapoton/sage/src/build/cythonized/sage/structure/sage_object.c:15916)
    return unpickler.load()
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/modular/modsym/g1list.py", line 151, in __setstate__
    self.__class__ = G1list_new
TypeError: __class__ must be set to a class
/home/chapoton/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_constructor.py:718: DeprecationWarning: The "pari_mod" finite field implementation is deprecated
See http://trac.sagemath.org/17297 for details.
  K = FiniteField_ext_pari(order, name, modulus)
/home/chapoton/sage/src/bin/sage-ipython:1: DeprecationWarning: ANRootOfUnity is deprecated
See http://trac.sagemath.org/19954 for details.
  #!/usr/bin/env python
Failed:
_class__sage_modular_modform_cuspidal_submodule_CuspidalSubmodule_g1_Q__.sobj
_class__sage_modular_modsym_manin_symbols_ManinSymbolList_gamma1__.sobj
----------------------------------------------------------------------
** This error is probably due to an old pickle failing to unpickle.
** See sage.structure.sage_object.register_unpickle_override for
** how to override the default unpickling methods for (old) pickles.
** NOTE: pickles should never be removed from the pickle_jar! 
----------------------------------------------------------------------
Successfully unpickled 584 objects.
Failed to unpickle 2 objects.
```



---

archive/issue_comments_350003.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nIn the case of `SkewTableau`, the old `SkewTableau_class` was being removed and base class changed, which changed the internals and how it dealt with unpickling. So the solution (workaround?) was to subclass and write unpickling within the `__setstate__` as the unpickling did not want to take a function when it was originally a class.\n\nThe reason why you are getting an error in your case is because `G1list_old` is an old-style class, which does not have a `__class__` attribute. So I think if you were going to do the `SkewTableau` approach, it should be a subclass of `G1list_new` with a `__setstate__`.\n\nHowever, I do not think this is a good approach overall as there is no real point in having a class alias and it seems too hacky, at least without trying to handle things directly with a `__setstate__`. Now that I have 2 moments to spend, let me see if I can get something to work.",
    "created_at": "2017-07-10T23:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350003",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

In the case of `SkewTableau`, the old `SkewTableau_class` was being removed and base class changed, which changed the internals and how it dealt with unpickling. So the solution (workaround?) was to subclass and write unpickling within the `__setstate__` as the unpickling did not want to take a function when it was originally a class.

The reason why you are getting an error in your case is because `G1list_old` is an old-style class, which does not have a `__class__` attribute. So I think if you were going to do the `SkewTableau` approach, it should be a subclass of `G1list_new` with a `__setstate__`.

However, I do not think this is a good approach overall as there is no real point in having a class alias and it seems too hacky, at least without trying to handle things directly with a `__setstate__`. Now that I have 2 moments to spend, let me see if I can get something to work.



---

archive/issue_events_324719.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T00:08:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324719"
}
```



---

archive/issue_events_324720.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T00:08:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324720"
}
```



---

archive/issue_comments_350004.json:
```json
{
    "body": "Changed commit from **[`12258aa`](https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c)** to **[`1d65ef1`](https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422)**",
    "created_at": "2017-07-11T00:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350004",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`12258aa`](https://github.com/sagemath/sagetrac-mirror/commit/12258aab388f5e8eb0b256e9177f06d3db1fd65c)** to **[`1d65ef1`](https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422)**



---

archive/issue_comments_350005.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**",
    "created_at": "2017-07-11T00:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350005",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, Travis Scrimshaw**



---

archive/issue_comments_350006.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOkay, so how pickles are created for old-style classes is quite different than for new-style:\n\n```\nsage: class Foo:\n....:     def __init__(self, x):\n....:         self._x = x\nsage: F = Foo(5)\nsage: p = dumps(F)\nsage: explain_pickle(p)\npg_Foo = unpickle_global('__main__', 'Foo')\npg = unpickle_instantiate(pg_Foo, ())\npg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\nunpickle_build(pg, {'_x':pg_make_integer('5')})\npg\nsage: loads(p)._x\n5\nsage: class Foo(object):\n....:     def __init__(self, x=None):\n....:         self._x = x\n....:     def __setstate__(self, state):\n....:         print(state)\n....:         self._x = state['_x']\nsage: loads(p)._x\n('__init__', None)\n{'_x': 5}\n5\nsage: explain_pickle(dumps(Foo(5)))\npg_Foo = unpickle_global('__main__', 'Foo')\nsi = unpickle_newobj(pg_Foo, ())\npg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')\nunpickle_build(si, {'_x':pg_make_integer('5')})\nsi\nsage: loads(dumps(Foo(5)))._x\n('__init__', 5)\n{'_x': 5}\n5\n```\nSo all of the `__setstate__` logic happens **after** the `__init__` call, which makes it essentially useless for our purpose.\n\nMy solution is similar to the `SkewTableau` case, where there is a little dummy class that inherits from the main class `G1list` that just exists to handle pickles and sets its `__class__` to the base class upon `__init__`. This is a little elegant, a little hackish, but it works.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422\">1d65ef1</a></td><td><code>Fixing unpickling of old G1list pickling.</code></td></tr></table>\n",
    "created_at": "2017-07-11T00:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350006",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Okay, so how pickles are created for old-style classes is quite different than for new-style:

```
sage: class Foo:
....:     def __init__(self, x):
....:         self._x = x
sage: F = Foo(5)
sage: p = dumps(F)
sage: explain_pickle(p)
pg_Foo = unpickle_global('__main__', 'Foo')
pg = unpickle_instantiate(pg_Foo, ())
pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
unpickle_build(pg, {'_x':pg_make_integer('5')})
pg
sage: loads(p)._x
5
sage: class Foo(object):
....:     def __init__(self, x=None):
....:         self._x = x
....:     def __setstate__(self, state):
....:         print(state)
....:         self._x = state['_x']
sage: loads(p)._x
('__init__', None)
{'_x': 5}
5
sage: explain_pickle(dumps(Foo(5)))
pg_Foo = unpickle_global('__main__', 'Foo')
si = unpickle_newobj(pg_Foo, ())
pg_make_integer = unpickle_global('sage.rings.integer', 'make_integer')
unpickle_build(si, {'_x':pg_make_integer('5')})
si
sage: loads(dumps(Foo(5)))._x
('__init__', 5)
{'_x': 5}
5
```
So all of the `__setstate__` logic happens **after** the `__init__` call, which makes it essentially useless for our purpose.

My solution is similar to the `SkewTableau` case, where there is a little dummy class that inherits from the main class `G1list` that just exists to handle pickles and sets its `__class__` to the base class upon `__init__`. This is a little elegant, a little hackish, but it works.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422">1d65ef1</a></td><td><code>Fixing unpickling of old G1list pickling.</code></td></tr></table>




---

archive/issue_comments_350007.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)** to **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)**",
    "created_at": "2017-07-11T00:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350007",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)** to **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)**



---

archive/issue_comments_350008.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThanks a lot, Travis. I would never have found that myself.\n\nI did the same for the other similar case. Let me launch my patchbot on it now.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973\">ffbdbb8</a></td><td><code>trac 23322 finish fixing the old pickles</code></td></tr></table>\n",
    "created_at": "2017-07-11T06:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350008",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

Thanks a lot, Travis. I would never have found that myself.

I did the same for the other similar case. Let me launch my patchbot on it now.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973">ffbdbb8</a></td><td><code>trac 23322 finish fixing the old pickles</code></td></tr></table>




---

archive/issue_comments_350009.json:
```json
{
    "body": "Changed branch from **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)** to **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)**",
    "created_at": "2017-07-11T06:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350009",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)** to **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)**



---

archive/issue_comments_350010.json:
```json
{
    "body": "Changed commit from **[`1d65ef1`](https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422)** to **[`ffbdbb8`](https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973)**",
    "created_at": "2017-07-11T06:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350010",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`1d65ef1`](https://github.com/sagemath/sagetrac-mirror/commit/1d65ef113058ef98c9ede3df514c898323fc2422)** to **[`ffbdbb8`](https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973)**



---

archive/issue_comments_350011.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nNo problem. I'm sorry I didn't have more time to actually sit down and fix it rather than lobbing ideas over.\n\nOne other detail, we should add a test in the `__init__` of those classes to make sure the pickling is happening correctly for the new objects. Something like:\n\n```\nsage: from sage.modular.modsym.g1list import G1list\nsage: L = G1list(6)\nsage: Lp = loads(dumps(L))\nsage: L == Lp\nTrue\nsage: type(Lp) == G1list\nTrue\n```\nFeel free to add after the patchbot run.",
    "created_at": "2017-07-11T07:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350011",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

No problem. I'm sorry I didn't have more time to actually sit down and fix it rather than lobbing ideas over.

One other detail, we should add a test in the `__init__` of those classes to make sure the pickling is happening correctly for the new objects. Something like:

```
sage: from sage.modular.modsym.g1list import G1list
sage: L = G1list(6)
sage: Lp = loads(dumps(L))
sage: L == Lp
True
sage: type(Lp) == G1list
True
```
Feel free to add after the patchbot run.



---

archive/issue_comments_350012.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAlso, positive review if green patchbot (and the added tests pass).",
    "created_at": "2017-07-11T07:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350012",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Also, positive review if green patchbot (and the added tests pass).



---

archive/issue_comments_350013.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-07-11T07:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350013",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw, Frédéric Chapoton**



---

archive/issue_comments_350014.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96\">dc62f48</a></td><td><code>trac 23322 some doc for pickling</code></td></tr></table>\n",
    "created_at": "2017-07-11T08:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350014",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96">dc62f48</a></td><td><code>trac 23322 some doc for pickling</code></td></tr></table>




---

archive/issue_comments_350015.json:
```json
{
    "body": "Changed commit from **[`ffbdbb8`](https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973)** to **[`dc62f48`](https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96)**",
    "created_at": "2017-07-11T08:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350015",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ffbdbb8`](https://github.com/sagemath/sagetrac-mirror/commit/ffbdbb8bb35c78c90596978cf7878cee800bb973)** to **[`dc62f48`](https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96)**



---

archive/issue_comments_350016.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThis test fails:\n\n```\ntype(Lp) == G1list\n```\nbecause \n\n```\nsage: type(L)\n<class 'sage.modular.modsym.g1list.G1list'>\nsage: type(Lp)\n<class 'sage.modular.modsym.g1list._G1list_old_pickle'>\n```",
    "created_at": "2017-07-11T08:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350016",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:29" align="right">comment:29</div>

This test fails:

```
type(Lp) == G1list
```
because 

```
sage: type(L)
<class 'sage.modular.modsym.g1list.G1list'>
sage: type(Lp)
<class 'sage.modular.modsym.g1list._G1list_old_pickle'>
```



---

archive/issue_comments_350017.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)** to **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)**",
    "created_at": "2017-07-11T14:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350017",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/chapoton/23322](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23322)** to **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)**



---

archive/issue_comments_350018.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSo `SageObject` pickles seem to behave slightly differently than my testing above. So I explicitly added a `__setstate__` and removed the other argument from `__init__` to ensure the corresponding behavior. Now the tests pass:\n\n```\nDoctesting 2 files using 8 threads.\nsage -t src/sage/modular/modsym/g1list.py\n    [21 tests, 0.30 s]\nsage -t src/sage/modular/modsym/ghlist.py\n    [22 tests, 0.62 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f\">14602e8</a></td><td><code>Changing things slightly for unpickling SageObject subclasses.</code></td></tr></table>\n",
    "created_at": "2017-07-11T14:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350018",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

So `SageObject` pickles seem to behave slightly differently than my testing above. So I explicitly added a `__setstate__` and removed the other argument from `__init__` to ensure the corresponding behavior. Now the tests pass:

```
Doctesting 2 files using 8 threads.
sage -t src/sage/modular/modsym/g1list.py
    [21 tests, 0.30 s]
sage -t src/sage/modular/modsym/ghlist.py
    [22 tests, 0.62 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f">14602e8</a></td><td><code>Changing things slightly for unpickling SageObject subclasses.</code></td></tr></table>




---

archive/issue_comments_350019.json:
```json
{
    "body": "Changed commit from **[`dc62f48`](https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96)** to **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**",
    "created_at": "2017-07-11T14:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350019",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`dc62f48`](https://github.com/sagemath/sagetrac-mirror/commit/dc62f48a6f1fdc23b7f72e20cc8bb42755822d96)** to **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**



---

archive/issue_comments_350020.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\ngreen bot. Do we agree that it can be set to positive ?",
    "created_at": "2017-07-11T16:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350020",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:31" align="right">comment:31</div>

green bot. Do we agree that it can be set to positive ?



---

archive/issue_comments_350021.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nYep. Done.",
    "created_at": "2017-07-11T23:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350021",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Yep. Done.



---

archive/issue_events_324721.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T23:46:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324721"
}
```



---

archive/issue_events_324722.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T23:46:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324722"
}
```



---

archive/issue_events_324723.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-26T22:13:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324723"
}
```



---

archive/issue_events_324724.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "96cfc9e8749e4711e731affed3340852450bb846",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-07-26T22:13:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23322#event-324724"
}
```



---

archive/issue_comments_350022.json:
```json
{
    "body": "Changed branch from **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)** to **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**",
    "created_at": "2017-07-26T22:13:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23322",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23322#issuecomment-350022",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tscrim/richcmp_modsym-23322](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/richcmp_modsym-23322)** to **[`14602e8`](https://github.com/sagemath/sagetrac-mirror/commit/14602e8876d1a4970aee531ab5a6195b7ebdad9f)**
