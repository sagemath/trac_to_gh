# Issue 23397: Replace pip2/3-lock with a generic sage-flock command

archive/issues_023160.json:
```json
{
    "assignees": [],
    "body": "I suggested something like this on #21672 but didn't have immediate need to follow up on it.\n\nSomething like this will be useful for making Windows builds more reliable, however, as there are some operations that can fail if they are run simultaneously during parallel builds.\n\nIn particular I'm trying to trace down failures with DLL rebasing, and at least part of the problem is that rebase can fail if it's being multiple times simultaneously as can happen during a parallel build (especially toward the end of the build when lots of Python packages are being installed--these are fast and often results in multiple rebases being run simultaneously).\n\nWith tickets like #22509 it will also be possible to make further restrictions, such as not running rebase while a package is being uninstalled.\n\nCC:  @jdemeyer\n\nBranch/Commit: **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Erik Bray**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23397_\n\n",
    "closed_at": "2017-12-11T01:04:13Z",
    "created_at": "2017-07-10T14:36:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Replace pip2/3-lock with a generic sage-flock command",
    "type": "issue",
    "updated_at": "2017-12-11T01:04:13Z",
    "url": "https://github.com/sagemath/sage/issues/23397",
    "user": "https://github.com/embray"
}
```
I suggested something like this on #21672 but didn't have immediate need to follow up on it.

Something like this will be useful for making Windows builds more reliable, however, as there are some operations that can fail if they are run simultaneously during parallel builds.

In particular I'm trying to trace down failures with DLL rebasing, and at least part of the problem is that rebase can fail if it's being multiple times simultaneously as can happen during a parallel build (especially toward the end of the build when lots of Python packages are being installed--these are fast and often results in multiple rebases being run simultaneously).

With tickets like #22509 it will also be possible to make further restrictions, such as not running rebase while a package is being uninstalled.

CC:  @jdemeyer

Branch/Commit: **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**

Reviewer: **Jeroen Demeyer**

Author: **Erik Bray**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/23397_





---

archive/issue_events_325650.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-10T14:36:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325650"
}
```



---

archive/issue_events_325651.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-10T14:36:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325651"
}
```



---

archive/issue_events_325652.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-10T14:36:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325652"
}
```



---

archive/issue_events_325653.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-10T14:36:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325653"
}
```



---

archive/issue_comments_351331.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2017-07-10T14:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351331",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_351332.json:
```json
{
    "body": "Commit: **[63f4b2d](https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee)**",
    "created_at": "2017-07-10T14:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351332",
    "user": "https://github.com/embray"
}
```

Commit: **[63f4b2d](https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee)**



---

archive/issue_comments_351333.json:
```json
{
    "body": "Branch: **[u/embray/build/lockfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/lockfile)**",
    "created_at": "2017-07-10T14:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351333",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/lockfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/lockfile)**



---

archive/issue_comments_351334.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n(CC: jdemeyer, original author of the script)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee\">63f4b2d</a></td><td><code>Adds a new sage-flock command based on the original pip2-lock command, but generalized to</code></td></tr></table>\n",
    "created_at": "2017-07-10T14:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351334",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

(CC: jdemeyer, original author of the script)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee">63f4b2d</a></td><td><code>Adds a new sage-flock command based on the original pip2-lock command, but generalized to</code></td></tr></table>




---

archive/issue_events_325654.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-10T14:36:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325654"
}
```



---

archive/issue_events_325655.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-09-06T08:53:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325655"
}
```



---

archive/issue_events_325656.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-09-06T08:53:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325656"
}
```



---

archive/issue_comments_351335.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nApparently this has a bug...",
    "created_at": "2017-09-06T08:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351335",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Apparently this has a bug...



---

archive/issue_comments_351336.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f\">5e89b68</a></td><td><code>argparse.FileType can be handy, but it doesn't create directories.</code></td></tr></table>\n",
    "created_at": "2017-09-06T09:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351336",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f">5e89b68</a></td><td><code>argparse.FileType can be handy, but it doesn't create directories.</code></td></tr></table>




---

archive/issue_comments_351337.json:
```json
{
    "body": "Changed commit from **[63f4b2d](https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee)** to **[5e89b68](https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f)**",
    "created_at": "2017-09-06T09:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[63f4b2d](https://github.com/sagemath/sagetrac-mirror/commit/63f4b2ddae472cc1cf28701486e196d3fe7e1eee)** to **[5e89b68](https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f)**



---

archive/issue_events_325657.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-09-06T09:16:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325657"
}
```



---

archive/issue_events_325658.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-09-06T09:16:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325658"
}
```



---

archive/issue_comments_351338.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n*ping*\n\nI actually increasingly need this as it's difficult to get through a parallel build on Cygwin now without it failing a few times due to the lack of locking around rebase.",
    "created_at": "2017-10-19T10:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351338",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

*ping*

I actually increasingly need this as it's difficult to get through a parallel build on Cygwin now without it failing a few times due to the lack of locking around rebase.



---

archive/issue_comments_351339.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhy did you remove `sys.stderr.flush()`?",
    "created_at": "2017-10-25T09:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351339",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Why did you remove `sys.stderr.flush()`?



---

archive/issue_comments_351340.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-10-25T09:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351340",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_351341.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI think it would be good to mention somewhere in a comment that this may be used in build scripts, but only for packages depending on Python.\n\nThe help mentions\n\n```\nThe command may also be a Python module in which case it is run in the same\nPython interpreter as this script (a small optimization to avoid restarting the\nPython interpreter).\n```\nbut I don't see that in the implementation.",
    "created_at": "2017-10-25T09:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351341",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I think it would be good to mention somewhere in a comment that this may be used in build scripts, but only for packages depending on Python.

The help mentions

```
The command may also be a Python module in which case it is run in the same
Python interpreter as this script (a small optimization to avoid restarting the
Python interpreter).
```
but I don't see that in the implementation.



---

archive/issue_events_325659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T09:56:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325659"
}
```



---

archive/issue_events_325660.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T09:56:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325660"
}
```



---

archive/issue_comments_351342.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment:6):\n> Why did you remove `sys.stderr.flush()`?\n\nSee also https://mail.python.org/pipermail/python-list/2015-November/698421.html\n\nIt seems that Python 2 has unbuffered `sys.stderr` by default, which means that the flushing is not needed.\n\nBut this was changed in Python 3, so the flushing would be required there.",
    "created_at": "2017-10-25T10:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment:6):
> Why did you remove `sys.stderr.flush()`?

See also https://mail.python.org/pipermail/python-list/2015-November/698421.html

It seems that Python 2 has unbuffered `sys.stderr` by default, which means that the flushing is not needed.

But this was changed in Python 3, so the flushing would be required there.



---

archive/issue_comments_351343.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAh, good catch.  I had mistakenly assume that the `print()` function would automatically flush by default.\n\nAs for being \"only for packages depending on Python\" that has me wondering now what the best thing would be to do with this.  Maybe it should be moved to `build/bin`.  I need to use it for basically all packages, and the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).  But this script is also used at runtime (just for pip install, currently), in which case it should use Sage's Python.  Any ideas?",
    "created_at": "2017-10-25T11:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351343",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Ah, good catch.  I had mistakenly assume that the `print()` function would automatically flush by default.

As for being "only for packages depending on Python" that has me wondering now what the best thing would be to do with this.  Maybe it should be moved to `build/bin`.  I need to use it for basically all packages, and the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).  But this script is also used at runtime (just for pip install, currently), in which case it should use Sage's Python.  Any ideas?



---

archive/issue_comments_351344.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60c7670202ce210b437c940f52af26e0b0d391e0\">60c7670</a></td><td><code>removed false statement from the docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff\">e960c8a</a></td><td><code>Turns out print() does not flush I/O by default</code></td></tr></table>\n",
    "created_at": "2017-10-25T11:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351344",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60c7670202ce210b437c940f52af26e0b0d391e0">60c7670</a></td><td><code>removed false statement from the docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff">e960c8a</a></td><td><code>Turns out print() does not flush I/O by default</code></td></tr></table>




---

archive/issue_comments_351345.json:
```json
{
    "body": "Changed commit from **[5e89b68](https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f)** to **[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)**",
    "created_at": "2017-10-25T11:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351345",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5e89b68](https://github.com/sagemath/sagetrac-mirror/commit/5e89b68a1590856bb4eab77f5e479fd9ac72a17f)** to **[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)**



---

archive/issue_comments_351346.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@embray](#comment:9):\n> the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).\n\nIf I recall correctly, we require system Python 2.6 or later, which means that you can't use `argparse`.",
    "created_at": "2017-10-25T11:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351346",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@embray](#comment:9):
> the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).

If I recall correctly, we require system Python 2.6 or later, which means that you can't use `argparse`.



---

archive/issue_comments_351347.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@sagetrac-git](#comment:10):\n|                                                                                                                                                 |                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)|`Turns out print() does not flush I/O by default`|\n\nThe `flush` keyword is Python 3 only.",
    "created_at": "2017-10-25T11:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351347",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@sagetrac-git](#comment:10):
|                                                                                                                                                 |                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)|`Turns out print() does not flush I/O by default`|

The `flush` keyword is Python 3 only.



---

archive/issue_comments_351348.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nD'oh, how annoying.  In that case I'll just switch it back to `sys.stderr.write...`.",
    "created_at": "2017-10-25T12:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351348",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

D'oh, how annoying.  In that case I'll just switch it back to `sys.stderr.write...`.



---

archive/issue_comments_351349.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:11):\n> Replying to [@embray](#comment:9):\n> > the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).\n\n> \n> If I recall correctly, we require system Python 2.6 or later, which means that you can't use `argparse`.\n\nThat's not an issue.  We already addressed this some time ago... https://github.com/sagemath/sagetrac-mirror/blob/develop/build/sage_bootstrap/compat?id=3faf8d0519918feb308b3bb56fbe36e0a0c2a290\n\nThe question is, should the script live in `build/bin` or `src/bin`, and what should go in the shebang line?  This is unclear for Python scripts that we want to work at build time and run time...",
    "created_at": "2017-10-25T12:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351349",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:11):
> Replying to [@embray](#comment:9):
> > the fact that it uses Python is not an impediment to that, since build tools are allowed to use the system Python (and in fact require it).

> 
> If I recall correctly, we require system Python 2.6 or later, which means that you can't use `argparse`.

That's not an issue.  We already addressed this some time ago... https://github.com/sagemath/sagetrac-mirror/blob/develop/build/sage_bootstrap/compat?id=3faf8d0519918feb308b3bb56fbe36e0a0c2a290

The question is, should the script live in `build/bin` or `src/bin`, and what should go in the shebang line?  This is unclear for Python scripts that we want to work at build time and run time...



---

archive/issue_comments_351350.json:
```json
{
    "body": "Changed commit from **[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)** to **[6e3333d](https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982)**",
    "created_at": "2017-10-25T12:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351350",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e960c8a](https://github.com/sagemath/sagetrac-mirror/commit/e960c8aad05190eda6f4f836ce4c15dd663d82ff)** to **[6e3333d](https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982)**



---

archive/issue_comments_351351.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982\">6e3333d</a></td><td><code>Annoyingly, the flush kwarg for the print_function does not exist in Python 2...</code></td></tr></table>\n",
    "created_at": "2017-10-25T12:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351351",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982">6e3333d</a></td><td><code>Annoyingly, the flush kwarg for the print_function does not exist in Python 2...</code></td></tr></table>




---

archive/issue_comments_351352.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment:9):\n> I need to use it for basically all packages\n\nWhat is your use case?",
    "created_at": "2017-10-25T12:25:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351352",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment:9):
> I need to use it for basically all packages

What is your use case?



---

archive/issue_comments_351353.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSee description.",
    "created_at": "2017-10-25T12:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351353",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

See description.



---

archive/issue_comments_351354.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nTo clarify, the `sage-rebase` command opens, and often writes to, every DLL installed in `$SAGE_LOCAL`.  It is run at the end of every package build.  If two packages complete build/installation at the same time, then there is a race to run `sage-rebase`, and the second one can fail, causing the build to halt.  This especially happens while installing the Python packages because there are a large number of packages being installed quickly one after the other.  But it can happen (and has happened) in principle any other time.  So I need to put a lock around `sage-rebase` to prevent it from being run simultaneously for multiple packages.",
    "created_at": "2017-10-25T12:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351354",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

To clarify, the `sage-rebase` command opens, and often writes to, every DLL installed in `$SAGE_LOCAL`.  It is run at the end of every package build.  If two packages complete build/installation at the same time, then there is a race to run `sage-rebase`, and the second one can fail, causing the build to halt.  This especially happens while installing the Python packages because there are a large number of packages being installed quickly one after the other.  But it can happen (and has happened) in principle any other time.  So I need to put a lock around `sage-rebase` to prevent it from being run simultaneously for multiple packages.



---

archive/issue_comments_351355.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@embray](#comment:14):\n> what should go in the shebang line?\n\nIf you intend to use the system Python if applicable, it should be `#!/usr/bin/env python`.",
    "created_at": "2017-10-25T12:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351355",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@embray](#comment:14):
> what should go in the shebang line?

If you intend to use the system Python if applicable, it should be `#!/usr/bin/env python`.



---

archive/issue_comments_351356.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment:19):\n> Replying to [@embray](#comment:14):\n> > what should go in the shebang line?\n\n> \n> If you intend to use the system Python if applicable, it should be `#!/usr/bin/env python`.\n\nBut that's the problem, because if it's intended to be used at runtime it should in that case be using Sage's Python (I guess?), and with `SAGE_PYTHON3=yes` this is incorrect since `python` still means `python2.7`.\n\nThat said, the original use case for this was with `pip`, and running `pip` is still arguably a \"build\" action, so maybe this should just be moved to `build/bin` to emphasize that it's a build tool.  It can use the system python by default and/or Sage's Python 2 because ultimately it doesn't matter what Python this is run with since it just execs the program it wraps.",
    "created_at": "2017-10-25T12:45:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351356",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment:19):
> Replying to [@embray](#comment:14):
> > what should go in the shebang line?

> 
> If you intend to use the system Python if applicable, it should be `#!/usr/bin/env python`.

But that's the problem, because if it's intended to be used at runtime it should in that case be using Sage's Python (I guess?), and with `SAGE_PYTHON3=yes` this is incorrect since `python` still means `python2.7`.

That said, the original use case for this was with `pip`, and running `pip` is still arguably a "build" action, so maybe this should just be moved to `build/bin` to emphasize that it's a build tool.  It can use the system python by default and/or Sage's Python 2 because ultimately it doesn't matter what Python this is run with since it just execs the program it wraps.



---

archive/issue_comments_351357.json:
```json
{
    "body": "Changed commit from **[6e3333d](https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982)** to **[3ec24bc](https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7)**",
    "created_at": "2017-10-25T12:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351357",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6e3333d](https://github.com/sagemath/sagetrac-mirror/commit/6e3333d66f82e35d671a99bd5ebde41e60656982)** to **[3ec24bc](https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7)**



---

archive/issue_comments_351358.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7\">3ec24bc</a></td><td><code>Moved to build/bin to emphasize that this is primarily a build utility (under its current use cases).</code></td></tr></table>\n",
    "created_at": "2017-10-25T12:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351358",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7">3ec24bc</a></td><td><code>Moved to build/bin to emphasize that this is primarily a build utility (under its current use cases).</code></td></tr></table>




---

archive/issue_events_325661.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-25T12:49:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325661"
}
```



---

archive/issue_events_325662.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-25T12:49:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325662"
}
```



---

archive/issue_comments_351359.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nYou've convinced me (and/or I've convinced myself) that this is the best approach.",
    "created_at": "2017-10-25T12:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351359",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

You've convinced me (and/or I've convinced myself) that this is the best approach.



---

archive/issue_comments_351360.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@embray](#comment:14):\n> That's not an issue.  We already addressed this some time ago... https://github.com/sagemath/sagetrac-mirror/blob/develop/build/sage_bootstrap/compat?id=3faf8d0519918feb308b3bb56fbe36e0a0c2a290\n\nBut then you need to ensure that your script can find this `argparse` module.",
    "created_at": "2017-10-25T13:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351360",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@embray](#comment:14):
> That's not an issue.  We already addressed this some time ago... https://github.com/sagemath/sagetrac-mirror/blob/develop/build/sage_bootstrap/compat?id=3faf8d0519918feb308b3bb56fbe36e0a0c2a290

But then you need to ensure that your script can find this `argparse` module.



---

archive/issue_events_325663.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T13:17:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325663"
}
```



---

archive/issue_events_325664.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T13:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325664"
}
```



---

archive/issue_comments_351361.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOkay, I was under the mistaken assumption, for some reason, that this was added to `PYTHONPATH` during builds.",
    "created_at": "2017-10-25T13:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351361",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Okay, I was under the mistaken assumption, for some reason, that this was added to `PYTHONPATH` during builds.



---

archive/issue_comments_351362.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a\">18f9454</a></td><td><code>Move the contents of sage-flock into the sage_bootstrap package itself, and replace the sage-flock script with a boilerplate script to import and run it from sage_bootstrap</code></td></tr></table>\n",
    "created_at": "2017-10-26T09:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351362",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a">18f9454</a></td><td><code>Move the contents of sage-flock into the sage_bootstrap package itself, and replace the sage-flock script with a boilerplate script to import and run it from sage_bootstrap</code></td></tr></table>




---

archive/issue_comments_351363.json:
```json
{
    "body": "Changed commit from **[3ec24bc](https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7)** to **[18f9454](https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a)**",
    "created_at": "2017-10-26T09:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351363",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3ec24bc](https://github.com/sagemath/sagetrac-mirror/commit/3ec24bc115b2af33c48fe26f27d42eadf38793f7)** to **[18f9454](https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a)**



---

archive/issue_events_325665.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-26T09:45:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325665"
}
```



---

archive/issue_events_325666.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-26T09:45:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325666"
}
```



---

archive/issue_comments_351364.json:
```json
{
    "body": "Changed commit from **[18f9454](https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a)** to **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**",
    "created_at": "2017-10-31T15:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351364",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[18f9454](https://github.com/sagemath/sagetrac-mirror/commit/18f94549d75c43766b8ec8dc1c3d41a0e0607b9a)** to **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**



---

archive/issue_comments_351365.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5\">b6e4a62</a></td><td><code>Merely being part of the sage_bootstrap package doesn't mean we don't still have to manually try to import argparse from the bundled compat module</code></td></tr></table>\n",
    "created_at": "2017-10-31T15:25:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351365",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5">b6e4a62</a></td><td><code>Merely being part of the sage_bootstrap package doesn't mean we don't still have to manually try to import argparse from the bundled compat module</code></td></tr></table>




---

archive/issue_events_325667.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-03T12:44:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325667"
}
```



---

archive/issue_events_325668.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-03T12:44:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325668"
}
```



---

archive/issue_events_325669.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-14T09:44:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325669"
}
```



---

archive/issue_events_325670.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-14T09:44:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325670"
}
```



---

archive/issue_comments_351366.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThis is increasingly critical since not having it can lead to failures even in the patchbot base build, causing the patchbot to exit.",
    "created_at": "2017-11-14T09:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351366",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

This is increasingly critical since not having it can lead to failures even in the patchbot base build, causing the patchbot to exit.



---

archive/issue_comments_351367.json:
```json
{
    "body": "Changed branch from **[u/embray/build/lockfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/lockfile)** to **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**",
    "created_at": "2017-12-11T01:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23397#issuecomment-351367",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/build/lockfile](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/lockfile)** to **[b6e4a62](https://github.com/sagemath/sagetrac-mirror/commit/b6e4a62d7d304dd714c0c63ff35c53dc6484d0c5)**



---

archive/issue_events_325671.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:04:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325671"
}
```



---

archive/issue_events_325672.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "814d87066fa33680c36ef99d84268efb5bbca1a1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-11T01:04:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23397",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23397#event-325672"
}
```
