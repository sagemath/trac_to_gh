# Issue 23608: Riemann surfaces: homomorphisms, interfacing, sums

archive/issues_023371.json:
```json
{
    "body": "Provide simple access methods on projective and plane algebraic curves to create the corresponding Riemann surface (that way we don't have to expose anything extra in the global namespace!)\n\nAlso implement the numerical computation of homomorphisms (directly analogous to computation of endomorphisms)\n\nAlso compute disjoint sums of riemann surfaces (direct product on their complex tori), to allow easy use of homomorphism testing with decomposable jacobians.\n\nThe direct sums presently do not provide much further functionality than that their Riemann matrices are the block sums of their constituents. (By implementing that and inheriting from RiemannSurface, we get homomorphisms and endomorphisms to work for them).\n\n\n\nBranch/Commit: b7b3820e2e20954952cb7ee546ccf203be26ccc8\n\nReviewer: Jeroen Sijsling\n\nAuthor: Nils Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23608\n\n",
    "closed_at": "2017-08-21T19:24:04Z",
    "created_at": "2017-08-09T23:14:30Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Riemann surfaces: homomorphisms, interfacing, sums",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23608",
    "user": "https://github.com/nbruin"
}
```
Provide simple access methods on projective and plane algebraic curves to create the corresponding Riemann surface (that way we don't have to expose anything extra in the global namespace!)

Also implement the numerical computation of homomorphisms (directly analogous to computation of endomorphisms)

Also compute disjoint sums of riemann surfaces (direct product on their complex tori), to allow easy use of homomorphism testing with decomposable jacobians.

The direct sums presently do not provide much further functionality than that their Riemann matrices are the block sums of their constituents. (By implementing that and inheriting from RiemannSurface, we get homomorphisms and endomorphisms to work for them).



Branch/Commit: b7b3820e2e20954952cb7ee546ccf203be26ccc8

Reviewer: Jeroen Sijsling

Author: Nils Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23608





---

archive/issue_comments_438868.json:
```json
{
    "body": "Changing branch from \"\" to \"u/nbruin/riemann_surface_extend\"",
    "created_at": "2017-08-09T23:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438868",
    "user": "https://github.com/nbruin"
}
```

Changing branch from "" to "u/nbruin/riemann_surface_extend"



---

archive/issue_comments_438869.json:
```json
{
    "body": "Changing author from \"\" to \"Nils Bruin\"",
    "created_at": "2017-08-09T23:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438869",
    "user": "https://github.com/nbruin"
}
```

Changing author from "" to "Nils Bruin"



---

archive/issue_comments_438870.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|\n|[fd2363b](https://github.com/sagemath/sagetrac-mirror/commit/fd2363bc1eefc65be013aa7377b5b4e626d49cb4)|`provide interfacing for riemann_surface and implement \"+\" for them, as well as homomorphisms.`|",
    "created_at": "2017-08-09T23:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438870",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
|[fd2363b](https://github.com/sagemath/sagetrac-mirror/commit/fd2363bc1eefc65be013aa7377b5b4e626d49cb4)|`provide interfacing for riemann_surface and implement "+" for them, as well as homomorphisms.`|



---

archive/issue_events_076572.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "rename": {
        "from": "?",
        "to": "Riemann surfaces: homomorphisms, interfacing, sums"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23608#event-76572"
}
```



---

archive/issue_comments_438871.json:
```json
{
    "body": "Changing commit from \"\" to \"fd2363bc1eefc65be013aa7377b5b4e626d49cb4\"",
    "created_at": "2017-08-09T23:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438871",
    "user": "https://github.com/nbruin"
}
```

Changing commit from "" to "fd2363bc1eefc65be013aa7377b5b4e626d49cb4"



---

archive/issue_comments_438872.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,9 @@\n+Provide simple access methods on projective and plane algebraic curves to create the corresponding Riemann surface (that way we don't have to expose anything extra in the global namespace!)\n \n+Also implement the numerical computation of homomorphisms (directly analogous to computation of endomorphisms)\n+\n+Also compute disjoint sums of riemann surfaces (direct product on their complex tori), to allow easy use of homomorphism testing with decomposable jacobians.\n+\n+The direct sums presently do not provide much further functionality than that their Riemann matrices are the block sums of their constituents. (By implementing that and inheriting from RiemannSurface, we get homomorphisms and endomorphisms to work for them).\n+\n+\n``````\n",
    "created_at": "2017-08-09T23:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438872",
    "user": "https://github.com/nbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,9 @@
+Provide simple access methods on projective and plane algebraic curves to create the corresponding Riemann surface (that way we don't have to expose anything extra in the global namespace!)
 
+Also implement the numerical computation of homomorphisms (directly analogous to computation of endomorphisms)
+
+Also compute disjoint sums of riemann surfaces (direct product on their complex tori), to allow easy use of homomorphism testing with decomposable jacobians.
+
+The direct sums presently do not provide much further functionality than that their Riemann matrices are the block sums of their constituents. (By implementing that and inheriting from RiemannSurface, we get homomorphisms and endomorphisms to work for them).
+
+
``````




---

archive/issue_comments_438873.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-09T23:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438873",
    "user": "https://github.com/nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438874.json:
```json
{
    "body": "<a id='comment:3'></a>\nSome loose comments, not all of them equally important:\n\nThe affine `riemann_surface` method gives the errors\n\n```\nArithmeticError: factorization of 0 is not defined\n```\nand\n\n```\nZeroDivisionError: integer division or modulo by zero\n```\nwhen applying them to curves defined by linear polynomials. The projective version has the same problem, and does worse when we consider the surface defined by `z`, in which case it gives a segmentation fault. This is probably because in that case the algorithm is already theoretically incorrect; the requested affine patch is empty.\n\nI do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.\n\nIn the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`. Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?\n\nThe method integer_matrix_relations does not always return a result, even at high precision. This can be seen by running\n\n```\nfrom sage.schemes.riemann_surfaces.riemann_surface import integer_matrix_relations\nCC = ComplexField(300)\nM1 = Matrix(CC, [[123 + 0.1*CC.random_element(),3 + 0.1*CC.random_element()],[-7 + 0.1*CC.random_element(),6 + 0.1*CC.random_element()]])\nM2 = (1 + M1*2)^(-1) * (3 + M1*4)\ninteger_matrix_relations(M1, M2)\n```\n\nIn the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running\n\n```\nCC = ComplexField(300)\nM1 = Matrix(CC, [[10*CC.random_element(),10*CC.random_element()],[10*CC.random_element(),10*CC.random_element()]])\nB = Matrix([[5,6],[7,8]])\nM2 = (1 + M1*B)^(-1) * (3 + M1*4)\ninteger_matrix_relations(M1, M2)\n```",
    "created_at": "2017-08-16T19:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438874",
    "user": "https://github.com/JRSijsling"
}
```

<a id='comment:3'></a>
Some loose comments, not all of them equally important:

The affine `riemann_surface` method gives the errors

```
ArithmeticError: factorization of 0 is not defined
```
and

```
ZeroDivisionError: integer division or modulo by zero
```
when applying them to curves defined by linear polynomials. The projective version has the same problem, and does worse when we consider the surface defined by `z`, in which case it gives a segmentation fault. This is probably because in that case the algorithm is already theoretically incorrect; the requested affine patch is empty.

I do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.

In the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`. Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?

The method integer_matrix_relations does not always return a result, even at high precision. This can be seen by running

```
from sage.schemes.riemann_surfaces.riemann_surface import integer_matrix_relations
CC = ComplexField(300)
M1 = Matrix(CC, [[123 + 0.1*CC.random_element(),3 + 0.1*CC.random_element()],[-7 + 0.1*CC.random_element(),6 + 0.1*CC.random_element()]])
M2 = (1 + M1*2)^(-1) * (3 + M1*4)
integer_matrix_relations(M1, M2)
```

In the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running

```
CC = ComplexField(300)
M1 = Matrix(CC, [[10*CC.random_element(),10*CC.random_element()],[10*CC.random_element(),10*CC.random_element()]])
B = Matrix([[5,6],[7,8]])
M2 = (1 + M1*B)^(-1) * (3 + M1*4)
integer_matrix_relations(M1, M2)
```



---

archive/issue_comments_438875.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-16T19:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438875",
    "user": "https://github.com/JRSijsling"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438876.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[d7ccf0d](https://github.com/sagemath/sagetrac-mirror/commit/d7ccf0d98c4c92669ab34fd760534809c6cb261a)|`documentation update and some fixes`|",
    "created_at": "2017-08-16T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[d7ccf0d](https://github.com/sagemath/sagetrac-mirror/commit/d7ccf0d98c4c92669ab34fd760534809c6cb261a)|`documentation update and some fixes`|



---

archive/issue_comments_438877.json:
```json
{
    "body": "Changing commit from \"fd2363bc1eefc65be013aa7377b5b4e626d49cb4\" to \"d7ccf0d98c4c92669ab34fd760534809c6cb261a\"",
    "created_at": "2017-08-16T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fd2363bc1eefc65be013aa7377b5b4e626d49cb4" to "d7ccf0d98c4c92669ab34fd760534809c6cb261a"



---

archive/issue_comments_438878.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-16T22:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438878",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438879.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [sijsling](#comment%3A3):\n> Some loose comments, not all of them equally important:\n\n\nThanks!\n\n> The affine `riemann_surface` method gives the errors\n\n\nIndeed. Added check that polynomial is at least degree 2.\n\n(note that not absolutely irreducible curves are not handled appropriately by singular at the moment. This is something to be fixed more generally)\n\n> I do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.\n\n\nRemoved (if prec=53, it would make sense to use CDF and RDF, which are faster. However, it makes doctesting a real pain, so I disabled (and removed) it)\n\n> In the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`.\n\n\nHopefully better now\n\n> Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?\n\n\nActually, it does the latter. Documentation amended.\n\n> The method integer_matrix_relations does not always return a result, even at high precision.\n\n\nIndeed, our default scaling should take coefficient size as well as precision into account.\n\n> In the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running\n\n\nAmended (in the stated equation)",
    "created_at": "2017-08-16T22:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438879",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'></a>
Replying to [sijsling](#comment%3A3):
> Some loose comments, not all of them equally important:


Thanks!

> The affine `riemann_surface` method gives the errors


Indeed. Added check that polynomial is at least degree 2.

(note that not absolutely irreducible curves are not handled appropriately by singular at the moment. This is something to be fixed more generally)

> I do not see the use of the modification in `riemann_surface.py`, with the void `False` condition on line 300.


Removed (if prec=53, it would make sense to use CDF and RDF, which are faster. However, it makes doctesting a real pain, so I disabled (and removed) it)

> In the description of the input of homomorphism_basis, it is not quite clear to which equation coefficients are meant in the definition of `b`.


Hopefully better now

> Also, what is the mathematical reason for looking at the size of the solution, instead of how close to zero substituting them gets?


Actually, it does the latter. Documentation amended.

> The method integer_matrix_relations does not always return a result, even at high precision.


Indeed, our default scaling should take coefficient size as well as precision into account.

> In the method integer_matrix_relations, it seems that `T = (D, C ; B, A)`, instead of `T = (D, B; C, A)` as claimed in the documentation. This can be seen by running


Amended (in the stated equation)



---

archive/issue_comments_438880.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis looks great, thanks for the quick reply! One final thing: the documentation of homomorphism_basis also needs to do a single switch of B and C, since a similar thing is going on there as in integer_matrix_relations. Doing the same change there will make things true. I was worried for a minute that T would not give rise to a sublattice (up to a change of basis) because of this issue, but it does and the issue is purely one of documentation  :-)",
    "created_at": "2017-08-17T09:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438880",
    "user": "https://github.com/JRSijsling"
}
```

<a id='comment:6'></a>
This looks great, thanks for the quick reply! One final thing: the documentation of homomorphism_basis also needs to do a single switch of B and C, since a similar thing is going on there as in integer_matrix_relations. Doing the same change there will make things true. I was worried for a minute that T would not give rise to a sublattice (up to a change of basis) because of this issue, but it does and the issue is purely one of documentation  :-)



---

archive/issue_comments_438881.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-17T09:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438881",
    "user": "https://github.com/JRSijsling"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438882.json:
```json
{
    "body": "Changing commit from \"d7ccf0d98c4c92669ab34fd760534809c6cb261a\" to \"b7b3820e2e20954952cb7ee546ccf203be26ccc8\"",
    "created_at": "2017-08-17T17:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d7ccf0d98c4c92669ab34fd760534809c6cb261a" to "b7b3820e2e20954952cb7ee546ccf203be26ccc8"



---

archive/issue_comments_438883.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[b7b3820](https://github.com/sagemath/sagetrac-mirror/commit/b7b3820e2e20954952cb7ee546ccf203be26ccc8)|`Further documentation corrections`|",
    "created_at": "2017-08-17T17:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[b7b3820](https://github.com/sagemath/sagetrac-mirror/commit/b7b3820e2e20954952cb7ee546ccf203be26ccc8)|`Further documentation corrections`|



---

archive/issue_comments_438884.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-17T17:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438884",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438885.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK! correction made.\n\nI've taken the liberty of filling in the \"reviewer\" with your name.",
    "created_at": "2017-08-17T17:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438885",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'></a>
OK! correction made.

I've taken the liberty of filling in the "reviewer" with your name.



---

archive/issue_comments_438886.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Sijsling\"",
    "created_at": "2017-08-17T17:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438886",
    "user": "https://github.com/nbruin"
}
```

Changing reviewer from "" to "Jeroen Sijsling"



---

archive/issue_comments_438887.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-18T07:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438887",
    "user": "https://github.com/JRSijsling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438888.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-21T19:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438888",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076573.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-21T19:24:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23608#event-76573"
}
```



---

archive/issue_comments_438889.json:
```json
{
    "body": "Changing branch from \"u/nbruin/riemann_surface_extend\" to \"b7b3820e2e20954952cb7ee546ccf203be26ccc8\"",
    "created_at": "2017-08-21T19:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23608",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23608#issuecomment-438889",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/nbruin/riemann_surface_extend" to "b7b3820e2e20954952cb7ee546ccf203be26ccc8"
