# Issue 23160: Add a library of common helper functions for use in spkg-install

archive/issues_022923.json:
```json
{
    "body": "This idea has come up before but not been implemented.  My implementation simply adds a collection of shell functions with names prefixed by `sdh_` for Sage distribution helpers (this is somewhat inspired by, but much simpler than, the `dh_` programs from the `debhelper` package in Debian).\n\nThese functions are exported by `sage-spkg`, and so are immediately usable by any `spkg-build`, `spkg-install`, or similar scripts executed from `sage-spkg` (these are still not required to be shell scripts, but as most are having such a library is convenient).\n\nOne piece of boilerplate I replaced with a function is the check in most `spkg-install`s for `$SAGE_LOCAL`.  A downside to this is that if the script is run outside the correct environment, then rather than getting a useful error message we just get that `sdh_check_vars` is undefined.  I have two thoughts on this:\n\n1) In general these scripts shouldn't be run directly in the first place.  In the case that they are (such as testing) the person developing the package should have some awareness of the fact that these scripts are being run from `sage-spkg` and assume `sage-env` has been sourced.\n\n2) Most of the time these scripts are run, it's after they've been copied to a temporary build directory for the package.  If nothing else, `sage-spkg` could create a wrapper around these scripts that automatically sets some default assumptions (such as sourcing `sage-env` and the new `sage-dist-helpers`).\n\nIn general, though, I think having a library of helper functions will be a big improvement to the consistency and legibility of theses scripts.  \n\nThis ticket also updates the `spkg-install` for `patch` for demonstration purposes only.  I don't intend with this to go on a mass rewriting of install scripts, but having this will be helpful for some other work (e.g. #22509, #22510).\n\nBranch/Commit: 48fe6acdd25929752cba413d8ed629aef436b856\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nDependencies: #23179\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23160\n\n",
    "closed_at": "2017-08-17T20:33:26Z",
    "created_at": "2017-06-07T14:39:13Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Add a library of common helper functions for use in spkg-install",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23160",
    "user": "https://github.com/embray"
}
```
This idea has come up before but not been implemented.  My implementation simply adds a collection of shell functions with names prefixed by `sdh_` for Sage distribution helpers (this is somewhat inspired by, but much simpler than, the `dh_` programs from the `debhelper` package in Debian).

These functions are exported by `sage-spkg`, and so are immediately usable by any `spkg-build`, `spkg-install`, or similar scripts executed from `sage-spkg` (these are still not required to be shell scripts, but as most are having such a library is convenient).

One piece of boilerplate I replaced with a function is the check in most `spkg-install`s for `$SAGE_LOCAL`.  A downside to this is that if the script is run outside the correct environment, then rather than getting a useful error message we just get that `sdh_check_vars` is undefined.  I have two thoughts on this:

1) In general these scripts shouldn't be run directly in the first place.  In the case that they are (such as testing) the person developing the package should have some awareness of the fact that these scripts are being run from `sage-spkg` and assume `sage-env` has been sourced.

2) Most of the time these scripts are run, it's after they've been copied to a temporary build directory for the package.  If nothing else, `sage-spkg` could create a wrapper around these scripts that automatically sets some default assumptions (such as sourcing `sage-env` and the new `sage-dist-helpers`).

In general, though, I think having a library of helper functions will be a big improvement to the consistency and legibility of theses scripts.  

This ticket also updates the `spkg-install` for `patch` for demonstration purposes only.  I don't intend with this to go on a mass rewriting of install scripts, but having this will be helpful for some other work (e.g. #22509, #22510).

Branch/Commit: 48fe6acdd25929752cba413d8ed629aef436b856

Reviewer: Jeroen Demeyer

Author: Erik Bray

Dependencies: #23179

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23160





---

archive/issue_comments_341434.json:
```json
{
    "body": "<a id='comment:1'></a>This could also replace the `$PIP_INSTALL` variable that's used for Python packages with an `sdh_pip_install` helper, serving the same purpose, but that could be done separately.",
    "created_at": "2017-06-07T14:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341434",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>This could also replace the `$PIP_INSTALL` variable that's used for Python packages with an `sdh_pip_install` helper, serving the same purpose, but that could be done separately.



---

archive/issue_comments_341435.json:
```json
{
    "body": "<a id='comment:2'></a>The whole point of this\n\n```\nif [ -z \"$SAGE_LOCAL\" ]; then\n    echo >&2 \"Error: SAGE_LOCAL undefined - exiting...\"\n    echo >&2 \"Maybe run 'sage -sh'?\"\n    exit 1\nfi\n```\nis to abort when the variable is not defined. A plain `sdh_check_common_vars` does not do that. At least replace it by `sdh_check_common_vars || exit $?` or something like that.",
    "created_at": "2017-06-07T14:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341435",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>The whole point of this

```
if [ -z "$SAGE_LOCAL" ]; then
    echo >&2 "Error: SAGE_LOCAL undefined - exiting..."
    echo >&2 "Maybe run 'sage -sh'?"
    exit 1
fi
```
is to abort when the variable is not defined. A plain `sdh_check_common_vars` does not do that. At least replace it by `sdh_check_common_vars || exit $?` or something like that.



---

archive/issue_comments_341436.json:
```json
{
    "body": "<a id='comment:3'></a>I would also rename `sdh_check_common_vars` to something like `sdh_guard` (or `sdh_begin` or `sdh_check`). It's not important what `sdh_check_common_vars` does, only that it guards against accidental executing of `spkg-install` when the necessary variables are not defined.",
    "created_at": "2017-06-07T14:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341436",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>I would also rename `sdh_check_common_vars` to something like `sdh_guard` (or `sdh_begin` or `sdh_check`). It's not important what `sdh_check_common_vars` does, only that it guards against accidental executing of `spkg-install` when the necessary variables are not defined.



---

archive/issue_comments_341437.json:
```json
{
    "body": "<a id='comment:4'></a>I'm not sure I understand.  It's already defined to exit the script immediately.",
    "created_at": "2017-06-07T15:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341437",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>I'm not sure I understand.  It's already defined to exit the script immediately.



---

archive/issue_comments_341438.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 embray]:\n> I'm not sure I understand.  It's already defined to exit the script immediately.\n\n\nOh, you mean if it's *not* defined in the first place.",
    "created_at": "2017-06-07T15:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341438",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>Replying to [comment:4 embray]:
> I'm not sure I understand.  It's already defined to exit the script immediately.


Oh, you mean if it's *not* defined in the first place.



---

archive/issue_comments_341439.json:
```json
{
    "body": "<a id='comment:6'></a>One point I will make though, is that if more of the build functionality is moved into helper functions there's also less effect a script can have if it's run outside the sage environment.  For example if `sdh_make_install` is not defined, then nothing will be installed.  That's no a silver bullet though, so I can still see the usefulness of having this guard in place.",
    "created_at": "2017-06-07T15:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341439",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>One point I will make though, is that if more of the build functionality is moved into helper functions there's also less effect a script can have if it's run outside the sage environment.  For example if `sdh_make_install` is not defined, then nothing will be installed.  That's no a silver bullet though, so I can still see the usefulness of having this guard in place.



---

archive/issue_comments_341440.json:
```json
{
    "body": "<a id='comment:7'></a>Okay, I'd be fine with something like `sdh_guard || exit $?`.  It's still boilerplate but at least now it's only one line.",
    "created_at": "2017-06-07T15:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341440",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Okay, I'd be fine with something like `sdh_guard || exit $?`.  It's still boilerplate but at least now it's only one line.



---

archive/issue_comments_341441.json:
```json
{
    "body": "<a id='comment:8'></a>That said, this brings me back around to the idea I was mulling earlier, that maybe the `spkg-*` scripts that live in the package directories shouldn't be executable in the first place.  That as, they would not have executable permissions, and not have a shebang line.\n\n*Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.  So there's generally no danger in running it outside the correct sage environment.  \n\nThis might limit it to being a shell script, but it could still be a wrapper for a non-shell executable if desired (there are only a couple cases of this currently, such as atlas).",
    "created_at": "2017-06-08T12:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341441",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>That said, this brings me back around to the idea I was mulling earlier, that maybe the `spkg-*` scripts that live in the package directories shouldn't be executable in the first place.  That as, they would not have executable permissions, and not have a shebang line.

*Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.  So there's generally no danger in running it outside the correct sage environment.  

This might limit it to being a shell script, but it could still be a wrapper for a non-shell executable if desired (there are only a couple cases of this currently, such as atlas).



---

archive/issue_comments_341442.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 embray]:\n> *Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.\n\n\nMy gut feeling is that this is a bit too much magic. At least the `sdh_guard || exit $?` boilerplate is easy to understand with little surprises.",
    "created_at": "2017-06-08T14:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341442",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:8 embray]:
> *Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.


My gut feeling is that this is a bit too much magic. At least the `sdh_guard || exit $?` boilerplate is easy to understand with little surprises.



---

archive/issue_comments_341443.json:
```json
{
    "body": "<a id='comment:10'></a>That was my feeling too at first, which is why I dropped the idea initially.  But now that I've tried it I think it has a number of advantages, including the fact that it automatically makes these scripts more robust without their authors having to think about details that aren't immediately related to building/installing the package.",
    "created_at": "2017-06-08T14:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341443",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>That was my feeling too at first, which is why I dropped the idea initially.  But now that I've tried it I think it has a number of advantages, including the fact that it automatically makes these scripts more robust without their authors having to think about details that aren't immediately related to building/installing the package.



---

archive/issue_comments_341444.json:
```json
{
    "body": "<a id='comment:11'></a>Have a look at #23179.",
    "created_at": "2017-06-08T14:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341444",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>Have a look at #23179.



---

archive/issue_comments_341445.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-07-06T13:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_341446.json:
```json
{
    "body": "<a id='comment:13'></a>Rebased on latest version of #23179",
    "created_at": "2017-07-06T13:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341446",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Rebased on latest version of #23179



---

archive/issue_comments_341447.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-06T13:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341447",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341448.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-07T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341448",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_341449.json:
```json
{
    "body": "<a id='comment:15'></a>Needs to be rebased on the latest version of #23179. Given that I'll probably wait with a review for this ticket until after the next beta, you could also wait until then and then rebase on 8.1.beta0.",
    "created_at": "2017-07-13T10:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341449",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Needs to be rebased on the latest version of #23179. Given that I'll probably wait with a review for this ticket until after the next beta, you could also wait until then and then rebase on 8.1.beta0.



---

archive/issue_comments_341450.json:
```json
{
    "body": "<a id='comment:16'></a>True, it needs to be rebased now.  I don't mind the timing, but why specifically after the next beta?  Or is that just the next point at which #23179 will be merged into develop?",
    "created_at": "2017-07-13T13:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341450",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>True, it needs to be rebased now.  I don't mind the timing, but why specifically after the next beta?  Or is that just the next point at which #23179 will be merged into develop?



---

archive/issue_comments_341451.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-13T13:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341451",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341452.json:
```json
{
    "body": "<a id='comment:18'></a>Actually, just to be clear, if you (or anyone else) wants to review this sooner you can still see the diff between this branch and the branch for #23179 like so:\n\nhttps://git.sagemath.org/sage.git/diff?id2=u/embray/build/script-wrappers&id=u/embray/build/helpers\n\nThat should make reviewing this much easier.",
    "created_at": "2017-07-13T13:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341452",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Actually, just to be clear, if you (or anyone else) wants to review this sooner you can still see the diff between this branch and the branch for #23179 like so:

https://git.sagemath.org/sage.git/diff?id2=u/embray/build/script-wrappers&id=u/embray/build/helpers

That should make reviewing this much easier.



---

archive/issue_comments_341453.json:
```json
{
    "body": "<a id='comment:19'></a>I'd rather be sure that #23179 really is merged. It wouldn't surprise me if problems would come up with that ticket.",
    "created_at": "2017-07-14T07:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341453",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>I'd rather be sure that #23179 really is merged. It wouldn't surprise me if problems would come up with that ticket.



---

archive/issue_comments_341454.json:
```json
{
    "body": "<a id='comment:20'></a>It wouldn't surprise me either, though not much of this ticket is really strongly dependent on #23179.  It only affects how `sdh_guard` is used.  Up to you though.",
    "created_at": "2017-07-17T08:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341454",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>It wouldn't surprise me either, though not much of this ticket is really strongly dependent on #23179.  It only affects how `sdh_guard` is used.  Up to you though.



---

archive/issue_comments_341455.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-18T09:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_341456.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-18T09:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341456",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341457.json:
```json
{
    "body": "<a id='comment:23'></a>This introduces again `PKG_OLD_STYLE`. Is this a mistake in the branch or do you really think it is needed?\n\nOther than that, I have no objections by looking at the patch. I still need to test, but I will do that after you fix the `PKG_OLD_STYLE` stuff.",
    "created_at": "2017-08-09T11:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341457",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>This introduces again `PKG_OLD_STYLE`. Is this a mistake in the branch or do you really think it is needed?

Other than that, I have no objections by looking at the patch. I still need to test, but I will do that after you fix the `PKG_OLD_STYLE` stuff.



---

archive/issue_comments_341458.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-09T11:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341458",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341459.json:
```json
{
    "body": "<a id='comment:25'></a>This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is\n\n```\nsuccess() {\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error building the Lcalc package: '$1'\"\n        exit 1\n    fi\n}\n```\n\nI guess a helper function like that would be useful to have.",
    "created_at": "2017-08-09T11:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341459",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is

```
success() {
    if [ $? -ne 0 ]; then
        echo >&2 "Error building the Lcalc package: '$1'"
        exit 1
    fi
}
```

I guess a helper function like that would be useful to have.



---

archive/issue_comments_341460.json:
```json
{
    "body": "<a id='comment:26'></a>Oops, that was not intentional.  It's possible I pushed from a different computer where I still had that commit in the branch.  I'm a little confused by that because normally I would have made sure to sync up first, but it was 3 weeks ago so I don't remember.",
    "created_at": "2017-08-09T11:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341460",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>Oops, that was not intentional.  It's possible I pushed from a different computer where I still had that commit in the branch.  I'm a little confused by that because normally I would have made sure to sync up first, but it was 3 weeks ago so I don't remember.



---

archive/issue_comments_341461.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 jdemeyer]:\n> This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is\n> \n> ```\n> success() {\n>     if [ $? -ne 0 ]; then\n>         echo >&2 \"Error building the Lcalc package: '$1'\"\n>         exit 1\n>     fi\n> }\n> ```\n> \n> I guess a helper function like that would be useful to have.\n\n\nYes, I already added something like that in #22509, but it might be worth pulling into a separate ticket.  I just added it there because it became increasingly useful.",
    "created_at": "2017-08-09T11:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341461",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>Replying to [comment:25 jdemeyer]:
> This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is
> 
> ```
> success() {
>     if [ $? -ne 0 ]; then
>         echo >&2 "Error building the Lcalc package: '$1'"
>         exit 1
>     fi
> }
> ```
> 
> I guess a helper function like that would be useful to have.


Yes, I already added something like that in #22509, but it might be worth pulling into a separate ticket.  I just added it there because it became increasingly useful.



---

archive/issue_comments_341462.json:
```json
{
    "body": "<a id='comment:28'></a>I see why I'm confused. This needs to be rebased on the final version of #23179.  I don't know why you removed the dependency.  I think it's useful to have listed in the ticket even if the dependency has been completed.",
    "created_at": "2017-08-09T11:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341462",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>I see why I'm confused. This needs to be rebased on the final version of #23179.  I don't know why you removed the dependency.  I think it's useful to have listed in the ticket even if the dependency has been completed.



---

archive/issue_comments_341463.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-09T11:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_341464.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-09T11:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341464",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341465.json:
```json
{
    "body": "<a id='comment:31'></a>If you intend that `spkg-install` can be run *without* `sage-spkg` (I assume that was part of the intention of #23179), the following should be done in `spkg-install` instead of `sage-spkg`:\n\n```\n# Export package information for use from within the scripts.\nexport PKG_NAME PKG_BASE PKG_VER\n```\nThese could be handled analogously to `SAGE_ROOT` with the values hard-coded in the generated `spkg-install` file.",
    "created_at": "2017-08-09T11:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341465",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>If you intend that `spkg-install` can be run *without* `sage-spkg` (I assume that was part of the intention of #23179), the following should be done in `spkg-install` instead of `sage-spkg`:

```
# Export package information for use from within the scripts.
export PKG_NAME PKG_BASE PKG_VER
```
These could be handled analogously to `SAGE_ROOT` with the values hard-coded in the generated `spkg-install` file.



---

archive/issue_comments_341466.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-09T11:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341466",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341467.json:
```json
{
    "body": "<a id='comment:32'></a>Agreed. I already fixed that in #22509 [here](https://git.sagemath.org/sage.git/commit/?h=dbdb94788f6275e19c5fd150bec8a889188f3164&id=5f0637dbbcdb3dd87c69e803cd694d10ed86e52d).  I should have just fixed that in this branch though.",
    "created_at": "2017-08-09T11:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341467",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>Agreed. I already fixed that in #22509 [here](https://git.sagemath.org/sage.git/commit/?h=dbdb94788f6275e19c5fd150bec8a889188f3164&id=5f0637dbbcdb3dd87c69e803cd694d10ed86e52d).  I should have just fixed that in this branch though.



---

archive/issue_comments_341468.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-09T12:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341469.json:
```json
{
    "body": "<a id='comment:34'></a>If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...",
    "created_at": "2017-08-09T12:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341469",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...



---

archive/issue_comments_341470.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 embray]:\n> If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...\n\n\nOn second thought; as it stands with this ticket the helpers that it adds are few in number and trivial enough that there's not enormous advantage to using them.  This will change, however, after a few more updates that will add some additional helpers.  But maybe the feature isn't worth advertising until it's more complete.  In the meantime it will be useful to have the framework in place so that it can be built on.",
    "created_at": "2017-08-09T12:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341470",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>Replying to [comment:34 embray]:
> If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...


On second thought; as it stands with this ticket the helpers that it adds are few in number and trivial enough that there's not enormous advantage to using them.  This will change, however, after a few more updates that will add some additional helpers.  But maybe the feature isn't worth advertising until it's more complete.  In the meantime it will be useful to have the framework in place so that it can be built on.



---

archive/issue_comments_341471.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-09T12:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341471",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341472.json:
```json
{
    "body": "<a id='comment:36'></a>Works for me...",
    "created_at": "2017-08-09T12:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341472",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Works for me...



---

archive/issue_comments_341473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-09T12:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341473",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_341474.json:
```json
{
    "body": "<a id='comment:37'></a>You want this to be merged? There is no milestone set...",
    "created_at": "2017-08-14T22:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341474",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>You want this to be merged? There is no milestone set...



---

archive/issue_events_059842.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-15T05:58:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23160#event-59842"
}
```



---

archive/issue_comments_341475.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-17T20:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23160#issuecomment-341475",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-17T20:33:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23160#event-59843"
}
```
