# Issue 23160: Add a library of common helper functions for use in spkg-install

archive/issues_022923.json:
```json
{
    "assignees": [],
    "body": "This idea has come up before but not been implemented.  My implementation simply adds a collection of shell functions with names prefixed by `sdh_` for Sage distribution helpers (this is somewhat inspired by, but much simpler than, the `dh_` programs from the `debhelper` package in Debian).\n\nThese functions are exported by `sage-spkg`, and so are immediately usable by any `spkg-build`, `spkg-install`, or similar scripts executed from `sage-spkg` (these are still not required to be shell scripts, but as most are having such a library is convenient).\n\nOne piece of boilerplate I replaced with a function is the check in most `spkg-install`s for `$SAGE_LOCAL`.  A downside to this is that if the script is run outside the correct environment, then rather than getting a useful error message we just get that `sdh_check_vars` is undefined.  I have two thoughts on this:\n\n1) In general these scripts shouldn't be run directly in the first place.  In the case that they are (such as testing) the person developing the package should have some awareness of the fact that these scripts are being run from `sage-spkg` and assume `sage-env` has been sourced.\n\n2) Most of the time these scripts are run, it's after they've been copied to a temporary build directory for the package.  If nothing else, `sage-spkg` could create a wrapper around these scripts that automatically sets some default assumptions (such as sourcing `sage-env` and the new `sage-dist-helpers`).\n\nIn general, though, I think having a library of helper functions will be a big improvement to the consistency and legibility of theses scripts.  \n\nThis ticket also updates the `spkg-install` for `patch` for demonstration purposes only.  I don't intend with this to go on a mass rewriting of install scripts, but having this will be helpful for some other work (e.g. #22509, #22510).\n\nDepends on #23179\n\nComponent: **build**\n\nAuthor: **Erik Bray**\n\nBranch/Commit: **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23160_\n\n",
    "closed_at": "2017-08-17T20:33:26Z",
    "created_at": "2017-06-07T14:39:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add a library of common helper functions for use in spkg-install",
    "type": "issue",
    "updated_at": "2017-08-17T20:33:26Z",
    "url": "https://github.com/sagemath/sage/issues/23160",
    "user": "https://github.com/embray"
}
```
This idea has come up before but not been implemented.  My implementation simply adds a collection of shell functions with names prefixed by `sdh_` for Sage distribution helpers (this is somewhat inspired by, but much simpler than, the `dh_` programs from the `debhelper` package in Debian).

These functions are exported by `sage-spkg`, and so are immediately usable by any `spkg-build`, `spkg-install`, or similar scripts executed from `sage-spkg` (these are still not required to be shell scripts, but as most are having such a library is convenient).

One piece of boilerplate I replaced with a function is the check in most `spkg-install`s for `$SAGE_LOCAL`.  A downside to this is that if the script is run outside the correct environment, then rather than getting a useful error message we just get that `sdh_check_vars` is undefined.  I have two thoughts on this:

1) In general these scripts shouldn't be run directly in the first place.  In the case that they are (such as testing) the person developing the package should have some awareness of the fact that these scripts are being run from `sage-spkg` and assume `sage-env` has been sourced.

2) Most of the time these scripts are run, it's after they've been copied to a temporary build directory for the package.  If nothing else, `sage-spkg` could create a wrapper around these scripts that automatically sets some default assumptions (such as sourcing `sage-env` and the new `sage-dist-helpers`).

In general, though, I think having a library of helper functions will be a big improvement to the consistency and legibility of theses scripts.  

This ticket also updates the `spkg-install` for `patch` for demonstration purposes only.  I don't intend with this to go on a mass rewriting of install scripts, but having this will be helpful for some other work (e.g. #22509, #22510).

Depends on #23179

Component: **build**

Author: **Erik Bray**

Branch/Commit: **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23160_





---

archive/issue_events_319983.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-06-07T14:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319983"
}
```



---

archive/issue_events_319984.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-06-07T14:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319984"
}
```



---

archive/issue_events_319985.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-06-07T14:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319985"
}
```



---

archive/issue_comments_347184.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis could also replace the `$PIP_INSTALL` variable that's used for Python packages with an `sdh_pip_install` helper, serving the same purpose, but that could be done separately.",
    "created_at": "2017-06-07T14:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347184",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

This could also replace the `$PIP_INSTALL` variable that's used for Python packages with an `sdh_pip_install` helper, serving the same purpose, but that could be done separately.



---

archive/issue_comments_347185.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe whole point of this\n\n```\nif [ -z \"$SAGE_LOCAL\" ]; then\n    echo >&2 \"Error: SAGE_LOCAL undefined - exiting...\"\n    echo >&2 \"Maybe run 'sage -sh'?\"\n    exit 1\nfi\n```\nis to abort when the variable is not defined. A plain `sdh_check_common_vars` does not do that. At least replace it by `sdh_check_common_vars || exit $?` or something like that.",
    "created_at": "2017-06-07T14:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347185",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

The whole point of this

```
if [ -z "$SAGE_LOCAL" ]; then
    echo >&2 "Error: SAGE_LOCAL undefined - exiting..."
    echo >&2 "Maybe run 'sage -sh'?"
    exit 1
fi
```
is to abort when the variable is not defined. A plain `sdh_check_common_vars` does not do that. At least replace it by `sdh_check_common_vars || exit $?` or something like that.



---

archive/issue_comments_347186.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI would also rename `sdh_check_common_vars` to something like `sdh_guard` (or `sdh_begin` or `sdh_check`). It's not important what `sdh_check_common_vars` does, only that it guards against accidental executing of `spkg-install` when the necessary variables are not defined.",
    "created_at": "2017-06-07T14:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347186",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

I would also rename `sdh_check_common_vars` to something like `sdh_guard` (or `sdh_begin` or `sdh_check`). It's not important what `sdh_check_common_vars` does, only that it guards against accidental executing of `spkg-install` when the necessary variables are not defined.



---

archive/issue_comments_347187.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI'm not sure I understand.  It's already defined to exit the script immediately.",
    "created_at": "2017-06-07T15:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347187",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

I'm not sure I understand.  It's already defined to exit the script immediately.



---

archive/issue_comments_347188.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@embray](#comment%3A4):\n> I'm not sure I understand.  It's already defined to exit the script immediately.\n\nOh, you mean if it's *not* defined in the first place.",
    "created_at": "2017-06-07T15:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347188",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@embray](#comment%3A4):
> I'm not sure I understand.  It's already defined to exit the script immediately.

Oh, you mean if it's *not* defined in the first place.



---

archive/issue_comments_347189.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOne point I will make though, is that if more of the build functionality is moved into helper functions there's also less effect a script can have if it's run outside the sage environment.  For example if `sdh_make_install` is not defined, then nothing will be installed.  That's no a silver bullet though, so I can still see the usefulness of having this guard in place.",
    "created_at": "2017-06-07T15:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347189",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

One point I will make though, is that if more of the build functionality is moved into helper functions there's also less effect a script can have if it's run outside the sage environment.  For example if `sdh_make_install` is not defined, then nothing will be installed.  That's no a silver bullet though, so I can still see the usefulness of having this guard in place.



---

archive/issue_comments_347190.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOkay, I'd be fine with something like `sdh_guard || exit $?`.  It's still boilerplate but at least now it's only one line.",
    "created_at": "2017-06-07T15:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347190",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Okay, I'd be fine with something like `sdh_guard || exit $?`.  It's still boilerplate but at least now it's only one line.



---

archive/issue_comments_347191.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThat said, this brings me back around to the idea I was mulling earlier, that maybe the `spkg-*` scripts that live in the package directories shouldn't be executable in the first place.  That as, they would not have executable permissions, and not have a shebang line.\n\n*Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.  So there's generally no danger in running it outside the correct sage environment.  \n\nThis might limit it to being a shell script, but it could still be a wrapper for a non-shell executable if desired (there are only a couple cases of this currently, such as atlas).",
    "created_at": "2017-06-08T12:36:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347191",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

That said, this brings me back around to the idea I was mulling earlier, that maybe the `spkg-*` scripts that live in the package directories shouldn't be executable in the first place.  That as, they would not have executable permissions, and not have a shebang line.

*Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.  So there's generally no danger in running it outside the correct sage environment.  

This might limit it to being a shell script, but it could still be a wrapper for a non-shell executable if desired (there are only a couple cases of this currently, such as atlas).



---

archive/issue_comments_347192.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment%3A8):\n> *Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.\n\nMy gut feeling is that this is a bit too much magic. At least the `sdh_guard || exit $?` boilerplate is easy to understand with little surprises.",
    "created_at": "2017-06-08T14:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347192",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment%3A8):
> *Only* when the script is copied to the temporary install directory does it get marked executable, and gets a header automatically written which, among other things, ensures that the correct `sage-env` is sourced.

My gut feeling is that this is a bit too much magic. At least the `sdh_guard || exit $?` boilerplate is easy to understand with little surprises.



---

archive/issue_comments_347193.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThat was my feeling too at first, which is why I dropped the idea initially.  But now that I've tried it I think it has a number of advantages, including the fact that it automatically makes these scripts more robust without their authors having to think about details that aren't immediately related to building/installing the package.",
    "created_at": "2017-06-08T14:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347193",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

That was my feeling too at first, which is why I dropped the idea initially.  But now that I've tried it I think it has a number of advantages, including the fact that it automatically makes these scripts more robust without their authors having to think about details that aren't immediately related to building/installing the package.



---

archive/issue_comments_347194.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHave a look at #23179.",
    "created_at": "2017-06-08T14:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347194",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Have a look at #23179.



---

archive/issue_comments_347195.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b96a665e8e18a7df035835b268b3a08496da553\"><code>1b96a66</code></a></td><td><code>Make it a mere warning on Cygwin if any of the scripts in build/pkgs are executable, but a hard error on other platforms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1155ddfcbf19a10a240d463015e367d336c5f90\"><code>b1155dd</code></a></td><td><code>Use a heredoc instead of a quoted variable, for clarity's sake.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d28f35dce4a1f2718909ce47e24be20031ed6df3\"><code>d28f35d</code></a></td><td><code>Add an explicit variable indicating if this is an old-style package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c4941fcfc1c417dd334f3475adda1576805c7c7\"><code>4c4941f</code></a></td><td><code>Restore support old-style packages, for now, by not creating script wrappers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6163ce73554a602a484026f700849130d796665\"><code>a6163ce</code></a></td><td><code>Updated the developer docs to reflect the changes in #23179</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f523318fb2cea6b554128ea697673279d6bb28a\"><code>4f52331</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f07cb215519f2ba64d4dc2fa482560e999c11f0a\"><code>f07cb21</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55b68ab32731e4891a980077663c0a6a0190e948\"><code>55b68ab</code></a></td><td><code>Additional args shouldn't be quoted</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a01a1bd6f357b5e4866ddd5ce62ed9f37584ff35\"><code>a01a1bd</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da\"><code>2b5e33d</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>\n",
    "created_at": "2017-07-06T13:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347195",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b96a665e8e18a7df035835b268b3a08496da553"><code>1b96a66</code></a></td><td><code>Make it a mere warning on Cygwin if any of the scripts in build/pkgs are executable, but a hard error on other platforms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1155ddfcbf19a10a240d463015e367d336c5f90"><code>b1155dd</code></a></td><td><code>Use a heredoc instead of a quoted variable, for clarity's sake.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d28f35dce4a1f2718909ce47e24be20031ed6df3"><code>d28f35d</code></a></td><td><code>Add an explicit variable indicating if this is an old-style package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c4941fcfc1c417dd334f3475adda1576805c7c7"><code>4c4941f</code></a></td><td><code>Restore support old-style packages, for now, by not creating script wrappers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6163ce73554a602a484026f700849130d796665"><code>a6163ce</code></a></td><td><code>Updated the developer docs to reflect the changes in #23179</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f523318fb2cea6b554128ea697673279d6bb28a"><code>4f52331</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f07cb215519f2ba64d4dc2fa482560e999c11f0a"><code>f07cb21</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55b68ab32731e4891a980077663c0a6a0190e948"><code>55b68ab</code></a></td><td><code>Additional args shouldn't be quoted</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a01a1bd6f357b5e4866ddd5ce62ed9f37584ff35"><code>a01a1bd</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da"><code>2b5e33d</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>




---

archive/issue_comments_347196.json:
```json
{
    "body": "Changed commit from **[`cbe3643`](https://github.com/sagemath/sagetrac-mirror/commit/cbe3643b663eae073d9b127764bff4e1e0d75715)** to **[`2b5e33d`](https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da)**",
    "created_at": "2017-07-06T13:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347196",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cbe3643`](https://github.com/sagemath/sagetrac-mirror/commit/cbe3643b663eae073d9b127764bff4e1e0d75715)** to **[`2b5e33d`](https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da)**



---

archive/issue_comments_347197.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRebased on latest version of #23179",
    "created_at": "2017-07-06T13:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347197",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

Rebased on latest version of #23179



---

archive/issue_events_319986.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-06T13:22:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319986"
}
```



---

archive/issue_comments_347198.json:
```json
{
    "body": "Dependencies: **#23179**",
    "created_at": "2017-07-06T13:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347198",
    "user": "https://github.com/embray"
}
```

Dependencies: **#23179**



---

archive/issue_comments_347199.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb4a3d5fc162ffee1e98c27b34882b256012d678\"><code>bb4a3d5</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de\"><code>79ff115</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>\n",
    "created_at": "2017-07-07T13:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347199",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb4a3d5fc162ffee1e98c27b34882b256012d678"><code>bb4a3d5</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de"><code>79ff115</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>




---

archive/issue_comments_347200.json:
```json
{
    "body": "Changed commit from **[`2b5e33d`](https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da)** to **[`79ff115`](https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de)**",
    "created_at": "2017-07-07T13:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347200",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2b5e33d`](https://github.com/sagemath/sagetrac-mirror/commit/2b5e33df3bdbe1013f063b7ecf47e7eca44333da)** to **[`79ff115`](https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de)**



---

archive/issue_comments_347201.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNeeds to be rebased on the latest version of #23179. Given that I'll probably wait with a review for this ticket until after the next beta, you could also wait until then and then rebase on 8.1.beta0.",
    "created_at": "2017-07-13T10:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Needs to be rebased on the latest version of #23179. Given that I'll probably wait with a review for this ticket until after the next beta, you could also wait until then and then rebase on 8.1.beta0.



---

archive/issue_comments_347202.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nTrue, it needs to be rebased now.  I don't mind the timing, but why specifically after the next beta?  Or is that just the next point at which #23179 will be merged into develop?",
    "created_at": "2017-07-13T13:48:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347202",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

True, it needs to be rebased now.  I don't mind the timing, but why specifically after the next beta?  Or is that just the next point at which #23179 will be merged into develop?



---

archive/issue_events_319987.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T13:48:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319987"
}
```



---

archive/issue_events_319988.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T13:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319988"
}
```



---

archive/issue_comments_347203.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nActually, just to be clear, if you (or anyone else) wants to review this sooner you can still see the diff between this branch and the branch for #23179 like so:\n\nhttps://github.com/sagemath/sagetrac-mirror/compare/u/embray/build/helpers...u/embray/build/script-wrappers\n\nThat should make reviewing this much easier.",
    "created_at": "2017-07-13T13:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347203",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Actually, just to be clear, if you (or anyone else) wants to review this sooner you can still see the diff between this branch and the branch for #23179 like so:

https://github.com/sagemath/sagetrac-mirror/compare/u/embray/build/helpers...u/embray/build/script-wrappers

That should make reviewing this much easier.



---

archive/issue_comments_347204.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'd rather be sure that #23179 really is merged. It wouldn't surprise me if problems would come up with that ticket.",
    "created_at": "2017-07-14T07:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347204",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I'd rather be sure that #23179 really is merged. It wouldn't surprise me if problems would come up with that ticket.



---

archive/issue_comments_347205.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIt wouldn't surprise me either, though not much of this ticket is really strongly dependent on #23179.  It only affects how `sdh_guard` is used.  Up to you though.",
    "created_at": "2017-07-17T08:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347205",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

It wouldn't surprise me either, though not much of this ticket is really strongly dependent on #23179.  It only affects how `sdh_guard` is used.  Up to you though.



---

archive/issue_comments_347206.json:
```json
{
    "body": "Changed commit from **[`79ff115`](https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de)** to **[`3115140`](https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a)**",
    "created_at": "2017-07-18T09:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347206",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`79ff115`](https://github.com/sagemath/sagetrac-mirror/commit/79ff115067a32af55b9fe94aac6789cc752d70de)** to **[`3115140`](https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a)**



---

archive/issue_comments_347207.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c447855fc668700246a1118241940bd44919de38\"><code>c447855</code></a></td><td><code>Use a heredoc instead of a quoted variable, for clarity's sake.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f53ee4db0e0bfbf72cb6230170d749bcc73b2cff\"><code>f53ee4d</code></a></td><td><code>Updated the developer docs to reflect the changes in #23179</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e322b8079aa01a9720ebc1b67f6056ba4086b9b\"><code>6e322b8</code></a></td><td><code>Set some variables in the wrapper script itself.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/caf64bfa51ee2d3c9eb3ca9c148bde0ef22e8fd5\"><code>caf64bf</code></a></td><td><code>Fix typos in this comment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d10cc22252d834fb93130404bc77bf3676d902f\"><code>1d10cc2</code></a></td><td><code>Add an explicit variable indicating if this is an old-style package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aeb24590fe2e94568bbcc0005baba0e72dbe1d88\"><code>aeb2459</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11735613dbfefbf3ca6deac76bcd92fddd55301a\"><code>1173561</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a4fd78d832fcbfa6a5861b7ae10b1f530891a08\"><code>4a4fd78</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a\"><code>3115140</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>\n",
    "created_at": "2017-07-18T09:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347207",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c447855fc668700246a1118241940bd44919de38"><code>c447855</code></a></td><td><code>Use a heredoc instead of a quoted variable, for clarity's sake.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f53ee4db0e0bfbf72cb6230170d749bcc73b2cff"><code>f53ee4d</code></a></td><td><code>Updated the developer docs to reflect the changes in #23179</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e322b8079aa01a9720ebc1b67f6056ba4086b9b"><code>6e322b8</code></a></td><td><code>Set some variables in the wrapper script itself.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/caf64bfa51ee2d3c9eb3ca9c148bde0ef22e8fd5"><code>caf64bf</code></a></td><td><code>Fix typos in this comment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d10cc22252d834fb93130404bc77bf3676d902f"><code>1d10cc2</code></a></td><td><code>Add an explicit variable indicating if this is an old-style package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aeb24590fe2e94568bbcc0005baba0e72dbe1d88"><code>aeb2459</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11735613dbfefbf3ca6deac76bcd92fddd55301a"><code>1173561</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a4fd78d832fcbfa6a5861b7ae10b1f530891a08"><code>4a4fd78</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a"><code>3115140</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>




---

archive/issue_events_319989.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-18T09:58:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319989"
}
```



---

archive/issue_events_319990.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-18T09:58:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319990"
}
```



---

archive/issue_comments_347208.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThis introduces again `PKG_OLD_STYLE`. Is this a mistake in the branch or do you really think it is needed?\n\nOther than that, I have no objections by looking at the patch. I still need to test, but I will do that after you fix the `PKG_OLD_STYLE` stuff.",
    "created_at": "2017-08-09T11:24:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

This introduces again `PKG_OLD_STYLE`. Is this a mistake in the branch or do you really think it is needed?

Other than that, I have no objections by looking at the patch. I still need to test, but I will do that after you fix the `PKG_OLD_STYLE` stuff.



---

archive/issue_comments_347209.json:
```json
{
    "body": "Changed dependencies from **#23179** to none",
    "created_at": "2017-08-09T11:24:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347209",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#23179** to none



---

archive/issue_events_319991.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T11:24:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319991"
}
```



---

archive/issue_events_319992.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T11:24:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319992"
}
```



---

archive/issue_comments_347210.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is\n\n```\nsuccess() {\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error building the Lcalc package: '$1'\"\n        exit 1\n    fi\n}\n```\n\nI guess a helper function like that would be useful to have.",
    "created_at": "2017-08-09T11:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347210",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is

```
success() {
    if [ $? -ne 0 ]; then
        echo >&2 "Error building the Lcalc package: '$1'"
        exit 1
    fi
}
```

I guess a helper function like that would be useful to have.



---

archive/issue_comments_347211.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOops, that was not intentional.  It's possible I pushed from a different computer where I still had that commit in the branch.  I'm a little confused by that because normally I would have made sure to sync up first, but it was 3 weeks ago so I don't remember.",
    "created_at": "2017-08-09T11:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347211",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Oops, that was not intentional.  It's possible I pushed from a different computer where I still had that commit in the branch.  I'm a little confused by that because normally I would have made sure to sync up first, but it was 3 weeks ago so I don't remember.



---

archive/issue_comments_347212.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment%3A25):\n> This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is\n> \n> ```\n> success() {\n>     if [ $? -ne 0 ]; then\n>         echo >&2 \"Error building the Lcalc package: '$1'\"\n>         exit 1\n>     fi\n> }\n> ```\n> \n> I guess a helper function like that would be useful to have.\n\nYes, I already added something like that in #22509, but it might be worth pulling into a separate ticket.  I just added it there because it became increasingly useful.",
    "created_at": "2017-08-09T11:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347212",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment%3A25):
> This may or may not be for a follow-up ticket, but in `build/pkgs/lcalc/spkg-install` (and others), there is
> 
> ```
> success() {
>     if [ $? -ne 0 ]; then
>         echo >&2 "Error building the Lcalc package: '$1'"
>         exit 1
>     fi
> }
> ```
> 
> I guess a helper function like that would be useful to have.

Yes, I already added something like that in #22509, but it might be worth pulling into a separate ticket.  I just added it there because it became increasingly useful.



---

archive/issue_comments_347213.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI see why I'm confused. This needs to be rebased on the final version of #23179.  I don't know why you removed the dependency.  I think it's useful to have listed in the ticket even if the dependency has been completed.",
    "created_at": "2017-08-09T11:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347213",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

I see why I'm confused. This needs to be rebased on the final version of #23179.  I don't know why you removed the dependency.  I think it's useful to have listed in the ticket even if the dependency has been completed.



---

archive/issue_comments_347214.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7370f73e9d25cbc7ab801621fc4e1ed05891da6\"><code>b7370f7</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97203f22c4512a84da11042bb765466663d7adb4\"><code>97203f2</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7c92aa0210598d3c168b0dff1d9f05c5295c7f3\"><code>c7c92aa</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1\"><code>54da520</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>\n",
    "created_at": "2017-08-09T11:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7370f73e9d25cbc7ab801621fc4e1ed05891da6"><code>b7370f7</code></a></td><td><code>Adds initial version of sage-dist-helpers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97203f22c4512a84da11042bb765466663d7adb4"><code>97203f2</code></a></td><td><code>Use the handful of implemented helpers in 'patch' for demonstration purposes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7c92aa0210598d3c168b0dff1d9f05c5295c7f3"><code>c7c92aa</code></a></td><td><code>Add support for $SAGE_SUDO in all sdh_make_install calls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1"><code>54da520</code></a></td><td><code>As suggested, rename sdh_check_common_vars to sdh_guard</code></td></tr></table>




---

archive/issue_comments_347215.json:
```json
{
    "body": "Changed commit from **[`3115140`](https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a)** to **[`54da520`](https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1)**",
    "created_at": "2017-08-09T11:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347215",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3115140`](https://github.com/sagemath/sagetrac-mirror/commit/31151404b28cd23b5256f616d524d7414cdb1c1a)** to **[`54da520`](https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1)**



---

archive/issue_events_319993.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-08-09T11:38:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319993"
}
```



---

archive/issue_events_319994.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-08-09T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319994"
}
```



---

archive/issue_comments_347216.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIf you intend that `spkg-install` can be run *without* `sage-spkg` (I assume that was part of the intention of #23179), the following should be done in `spkg-install` instead of `sage-spkg`:\n\n```\n# Export package information for use from within the scripts.\nexport PKG_NAME PKG_BASE PKG_VER\n```\nThese could be handled analogously to `SAGE_ROOT` with the values hard-coded in the generated `spkg-install` file.",
    "created_at": "2017-08-09T11:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347216",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

If you intend that `spkg-install` can be run *without* `sage-spkg` (I assume that was part of the intention of #23179), the following should be done in `spkg-install` instead of `sage-spkg`:

```
# Export package information for use from within the scripts.
export PKG_NAME PKG_BASE PKG_VER
```
These could be handled analogously to `SAGE_ROOT` with the values hard-coded in the generated `spkg-install` file.



---

archive/issue_comments_347217.json:
```json
{
    "body": "Dependencies: **#23179**",
    "created_at": "2017-08-09T11:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347217",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#23179**



---

archive/issue_events_319995.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T11:48:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319995"
}
```



---

archive/issue_events_319996.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T11:48:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319996"
}
```



---

archive/issue_comments_347218.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nAgreed. I already fixed that in #22509 [here](https://github.com/sagemath/sagetrac-mirror/commit/5f0637dbbcdb3dd87c69e803cd694d10ed86e52d).  I should have just fixed that in this branch though.",
    "created_at": "2017-08-09T11:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347218",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

Agreed. I already fixed that in #22509 [here](https://github.com/sagemath/sagetrac-mirror/commit/5f0637dbbcdb3dd87c69e803cd694d10ed86e52d).  I should have just fixed that in this branch though.



---

archive/issue_comments_347219.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856\"><code>48fe6ac</code></a></td><td><code>Include the PKG_NAME, PKG_BASE, and PKG_VER variables directly in the</code></td></tr></table>\n",
    "created_at": "2017-08-09T12:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347219",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856"><code>48fe6ac</code></a></td><td><code>Include the PKG_NAME, PKG_BASE, and PKG_VER variables directly in the</code></td></tr></table>




---

archive/issue_comments_347220.json:
```json
{
    "body": "Changed commit from **[`54da520`](https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1)** to **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**",
    "created_at": "2017-08-09T12:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347220",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`54da520`](https://github.com/sagemath/sagetrac-mirror/commit/54da5200650d59a240cd3f12ea3abe1c0b74e7c1)** to **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**



---

archive/issue_comments_347221.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nIf this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...",
    "created_at": "2017-08-09T12:03:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347221",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...



---

archive/issue_comments_347222.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@embray](#comment%3A34):\n> If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...\n\nOn second thought; as it stands with this ticket the helpers that it adds are few in number and trivial enough that there's not enormous advantage to using them.  This will change, however, after a few more updates that will add some additional helpers.  But maybe the feature isn't worth advertising until it's more complete.  In the meantime it will be useful to have the framework in place so that it can be built on.",
    "created_at": "2017-08-09T12:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347222",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@embray](#comment%3A34):
> If this otherwise works for you, I'm also going to add some updates to the developer documentation.  Of course, I will continue to update the docs as more helpers are added...

On second thought; as it stands with this ticket the helpers that it adds are few in number and trivial enough that there's not enormous advantage to using them.  This will change, however, after a few more updates that will add some additional helpers.  But maybe the feature isn't worth advertising until it's more complete.  In the meantime it will be useful to have the framework in place so that it can be built on.



---

archive/issue_events_319997.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-08-09T12:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319997"
}
```



---

archive/issue_events_319998.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-08-09T12:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319998"
}
```



---

archive/issue_comments_347223.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nWorks for me...",
    "created_at": "2017-08-09T12:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347223",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Works for me...



---

archive/issue_comments_347224.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-08-09T12:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347224",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_319999.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T12:09:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-319999"
}
```



---

archive/issue_events_320000.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-09T12:09:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-320000"
}
```



---

archive/issue_comments_347225.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nYou want this to be merged? There is no milestone set...",
    "created_at": "2017-08-14T22:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347225",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

You want this to be merged? There is no milestone set...



---

archive/issue_events_320001.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-15T05:58:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-320001"
}
```



---

archive/issue_comments_347226.json:
```json
{
    "body": "Changed branch from **[u/embray/build/helpers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/helpers)** to **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**",
    "created_at": "2017-08-17T20:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23160#issuecomment-347226",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/build/helpers](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/helpers)** to **[`48fe6ac`](https://github.com/sagemath/sagetrac-mirror/commit/48fe6acdd25929752cba413d8ed629aef436b856)**



---

archive/issue_events_320002.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-17T20:33:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-320002"
}
```



---

archive/issue_events_320003.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3cbfcdae00ebcedff812bd9e7d3d3c910b848c15",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-17T20:33:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23160#event-320003"
}
```
