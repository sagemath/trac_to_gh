# Issue 23081: Matchings in multigraphs

archive/issues_022844.json:
```json
{
    "assignees": [],
    "body": "Enabling the graph matching method to work with multiple edges turned on.\n\nOnce this is sorted, I will create another ticket for bipartite matchings.\n\nCC:  @dcoudert @tscrim\n\nKeywords: **matching**\n\nBranch: **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**\n\nReviewer: **Travis Scrimshaw, David Coudert**\n\nAuthor: **Zach Gershkoff**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23081_\n\n",
    "closed_at": "2017-06-13T06:51:19Z",
    "created_at": "2017-05-25T23:35:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Matchings in multigraphs",
    "type": "issue",
    "updated_at": "2017-10-24T15:10:33Z",
    "url": "https://github.com/sagemath/sage/issues/23081",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```
Enabling the graph matching method to work with multiple edges turned on.

Once this is sorted, I will create another ticket for bipartite matchings.

CC:  @dcoudert @tscrim

Keywords: **matching**

Branch: **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**

Reviewer: **Travis Scrimshaw, David Coudert**

Author: **Zach Gershkoff**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/23081_





---

archive/issue_events_321844.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-25T23:35:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321844"
}
```



---

archive/issue_events_321845.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-25T23:35:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321845"
}
```



---

archive/issue_comments_345693.json:
```json
{
    "body": "Branch: **[u/zgershkoff/matchings_in_multigraphs](https://github.com/sagemath/sagetrac-mirror/tree/u/zgershkoff/matchings_in_multigraphs)**",
    "created_at": "2017-05-26T23:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345693",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Branch: **[u/zgershkoff/matchings_in_multigraphs](https://github.com/sagemath/sagetrac-mirror/tree/u/zgershkoff/matchings_in_multigraphs)**



---

archive/issue_comments_345694.json:
```json
{
    "body": "Author: **Zachary Gershkoff**",
    "created_at": "2017-05-26T23:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345694",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Author: **Zachary Gershkoff**



---

archive/issue_events_321846.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-26T23:52:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321846"
}
```



---

archive/issue_events_321847.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-26T23:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321847"
}
```



---

archive/issue_comments_345695.json:
```json
{
    "body": "Changed keywords from none to **matching**",
    "created_at": "2017-05-26T23:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345695",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Changed keywords from none to **matching**



---

archive/issue_events_321848.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-26T23:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321848"
}
```



---

archive/issue_events_321849.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-26T23:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321849"
}
```



---

archive/issue_events_321850.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-26T23:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321850"
}
```



---

archive/issue_comments_345696.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMy initial attempt was to build a new list of edges to spare the expense of creating a new graph, but when I saw how complicated that would be because of all the methods and data structures associated with the graph (an edge list, an edge iterator, a dictionary with vertex pairs as keys and edge labels as values), I decided to keep it simple, and I reset my earlier commits.\n\nIt works now, but it's a little inconsistent, and I'm not sure how to best resolve it. The problem is when the set of edge labels is a mix of other types. For simple graphs G, if an edge label is not in RR, the weight of that edge is set to `1`. Otherwise the label is used as the edge weight. (Incidentally, I need to go back to bipartite matchings and make it act like this too.) If G allows multiple edges, however, `G.allow_multiple_edges(False, keep_label='max')` will directly compare the labels of parallel edges and keep the highest one *without* first setting the weight of strings or `None` to `1`.\n\nThe solution I'm considering is to modify the code of `allow_multiple_edges` so it assigns edges a weight before comparing them, the way `matching` does now. However, this seems like it could be too broad of a change. Another solution is to trust the user to make their edge labels consistent before trying to take a weighted matching. I don't know if that is in line with the [SageMath](../wiki/SageMath) design philosphy.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9e10b1c5e40ae72f1366b8e1738d426035f42bb\"><code>e9e10b1</code></a></td><td><code>Enable matching for multigraphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51cc331dff013ab48876f365294d951a69912aa5\"><code>51cc331</code></a></td><td><code>Removed unnecessary argument</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60\"><code>98733b9</code></a></td><td><code>Need to copy the graph after all</code></td></tr></table>\n",
    "created_at": "2017-05-26T23:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345696",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:2" align="right">comment:2</div>

My initial attempt was to build a new list of edges to spare the expense of creating a new graph, but when I saw how complicated that would be because of all the methods and data structures associated with the graph (an edge list, an edge iterator, a dictionary with vertex pairs as keys and edge labels as values), I decided to keep it simple, and I reset my earlier commits.

It works now, but it's a little inconsistent, and I'm not sure how to best resolve it. The problem is when the set of edge labels is a mix of other types. For simple graphs G, if an edge label is not in RR, the weight of that edge is set to `1`. Otherwise the label is used as the edge weight. (Incidentally, I need to go back to bipartite matchings and make it act like this too.) If G allows multiple edges, however, `G.allow_multiple_edges(False, keep_label='max')` will directly compare the labels of parallel edges and keep the highest one *without* first setting the weight of strings or `None` to `1`.

The solution I'm considering is to modify the code of `allow_multiple_edges` so it assigns edges a weight before comparing them, the way `matching` does now. However, this seems like it could be too broad of a change. Another solution is to trust the user to make their edge labels consistent before trying to take a weighted matching. I don't know if that is in line with the [SageMath](../wiki/SageMath) design philosphy.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9e10b1c5e40ae72f1366b8e1738d426035f42bb"><code>e9e10b1</code></a></td><td><code>Enable matching for multigraphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51cc331dff013ab48876f365294d951a69912aa5"><code>51cc331</code></a></td><td><code>Removed unnecessary argument</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60"><code>98733b9</code></a></td><td><code>Need to copy the graph after all</code></td></tr></table>




---

archive/issue_comments_345697.json:
```json
{
    "body": "Commit: **[`98733b9`](https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60)**",
    "created_at": "2017-05-26T23:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345697",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Commit: **[`98733b9`](https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60)**



---

archive/issue_comments_345698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Enabling the graph matching method to work with multiple edges turned on.\n \n+Once this is sorted, I will create another ticked for bipartite matchings.\n``````\n",
    "created_at": "2017-05-26T23:52:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345698",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Enabling the graph matching method to work with multiple edges turned on.
 
+Once this is sorted, I will create another ticked for bipartite matchings.
``````




---

archive/issue_comments_345699.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Enabling the graph matching method to work with multiple edges turned on.\n \n-Once this is sorted, I will create another ticked for bipartite matchings.\n+Once this is sorted, I will create another ticket for bipartite matchings.\n``````\n",
    "created_at": "2017-05-26T23:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345699",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Enabling the graph matching method to work with multiple edges turned on.
 
-Once this is sorted, I will create another ticked for bipartite matchings.
+Once this is sorted, I will create another ticket for bipartite matchings.
``````




---

archive/issue_comments_345700.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWorking with loops, multiple edges and weights is a mess. The behavior and the terminology (`use_edge_labels` or `by_weights` or etc.) should be unified. For instance, you can pass a `weight_function` to `shortest_path`. This is convenient and forces the user to be careful with the kind of labels and how to use it. Such improvement is however a hard task.\n\nA problem with loops:\nI don't no why the matching method uses `self._scream_if_not_simple(allow_loops=True)`. It is not documented and it causes the following issue:\n\n```\nsage: G = Graph([(0,0),(0,1),(1,1)], loops=True)\nsage: G.matching(algorithm='LP')\n[(0, 0, None), (1, 1, None)]\nsage: G.matching(algorithm='Edmonds')\n[(0, 1, None)]\n```\n\n\nNow, if you want to make the matching method work with multiple edges, you can avoid a copy of the graph as follows. This is certainly not the most elegant method, but it's working.\n\n```\n        #self._scream_if_not_simple(allow_loops=True)\n        from sage.rings.real_mpfr import RR\n        def weight(x):\n            if x in RR:\n                return x\n            else:\n                return 1\n\n        def reorder(u, v):\n            if u < v:\n                return u, v\n            else:\n                return v, u\n\n        W = dict()\n        for u,v,l in self.edge_iterator():\n            u, v = reorder(u, v)\n            if u is v:\n                continue\n            if use_edge_labels:\n                l = weight(l)\n            if not (u, v) in W or ( (u, v) in W and use_edge_labels and W[u, v] < l ):\n                W[u, v] = l\n\n        if algorithm == \"Edmonds\":\n            import networkx\n            g = networkx.Graph()\n            if use_edge_labels:\n                for u, v in W:\n                    g.add_edge(u, v, attr_dict={\"weight\": W[u, v]})\n            else:\n                for u, v in W:\n                    g.add_edge(u, v)\n            d = networkx.max_weight_matching(g)\n            if value_only:\n                if use_edge_labels:\n                    return sum(W[u, v] for u, v in six.iteritems(d) if u < v)\n                else:\n                    return Integer(len(d) // 2)\n            else:\n                return [(u, v, W[u, v]) for u, v in six.iteritems(d) if u < v]\n\n        elif algorithm == \"LP\":\n            from sage.numerical.mip import MixedIntegerLinearProgram\n            # returns the weight of an edge considering it may not be\n            # weighted ...\n            p = MixedIntegerLinearProgram(maximization=True, solver=solver)\n            b = p.new_variable(binary=True)\n            if use_edge_labels:\n                p.set_objective( p.sum( W[u, v] * b[u, v] for u, v in W ) )\n            else:\n                p.set_objective( p.sum( b[u, v] for u, v in W ) )\n            # for any vertex v, there is at most one edge incident to v in\n            # the maximum matching\n            for v in g.vertex_iterator():\n                p.add_constraint(\n                    p.sum(b[reorder(u, v)]\n                          for u in self.neighbors(v) if u != v), max=1)\n            if value_only:\n                if use_edge_labels:\n                    return p.solve(objective_only=True, log=verbose)\n                else:\n                    return Integer(round(p.solve(objective_only=True, log=verbose)))\n            else:\n                p.solve(log=verbose)\n                b = p.get_values(b)\n                return [(u, v, W[u, v]) for u, v in W if b[u, v] == 1]\n\n        else:\n            raise ValueError('algorithm must be set to either \"Edmonds\" or \"LP\"')\n```",
    "created_at": "2017-05-27T09:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345700",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

Working with loops, multiple edges and weights is a mess. The behavior and the terminology (`use_edge_labels` or `by_weights` or etc.) should be unified. For instance, you can pass a `weight_function` to `shortest_path`. This is convenient and forces the user to be careful with the kind of labels and how to use it. Such improvement is however a hard task.

A problem with loops:
I don't no why the matching method uses `self._scream_if_not_simple(allow_loops=True)`. It is not documented and it causes the following issue:

```
sage: G = Graph([(0,0),(0,1),(1,1)], loops=True)
sage: G.matching(algorithm='LP')
[(0, 0, None), (1, 1, None)]
sage: G.matching(algorithm='Edmonds')
[(0, 1, None)]
```


Now, if you want to make the matching method work with multiple edges, you can avoid a copy of the graph as follows. This is certainly not the most elegant method, but it's working.

```
        #self._scream_if_not_simple(allow_loops=True)
        from sage.rings.real_mpfr import RR
        def weight(x):
            if x in RR:
                return x
            else:
                return 1

        def reorder(u, v):
            if u < v:
                return u, v
            else:
                return v, u

        W = dict()
        for u,v,l in self.edge_iterator():
            u, v = reorder(u, v)
            if u is v:
                continue
            if use_edge_labels:
                l = weight(l)
            if not (u, v) in W or ( (u, v) in W and use_edge_labels and W[u, v] < l ):
                W[u, v] = l

        if algorithm == "Edmonds":
            import networkx
            g = networkx.Graph()
            if use_edge_labels:
                for u, v in W:
                    g.add_edge(u, v, attr_dict={"weight": W[u, v]})
            else:
                for u, v in W:
                    g.add_edge(u, v)
            d = networkx.max_weight_matching(g)
            if value_only:
                if use_edge_labels:
                    return sum(W[u, v] for u, v in six.iteritems(d) if u < v)
                else:
                    return Integer(len(d) // 2)
            else:
                return [(u, v, W[u, v]) for u, v in six.iteritems(d) if u < v]

        elif algorithm == "LP":
            from sage.numerical.mip import MixedIntegerLinearProgram
            # returns the weight of an edge considering it may not be
            # weighted ...
            p = MixedIntegerLinearProgram(maximization=True, solver=solver)
            b = p.new_variable(binary=True)
            if use_edge_labels:
                p.set_objective( p.sum( W[u, v] * b[u, v] for u, v in W ) )
            else:
                p.set_objective( p.sum( b[u, v] for u, v in W ) )
            # for any vertex v, there is at most one edge incident to v in
            # the maximum matching
            for v in g.vertex_iterator():
                p.add_constraint(
                    p.sum(b[reorder(u, v)]
                          for u in self.neighbors(v) if u != v), max=1)
            if value_only:
                if use_edge_labels:
                    return p.solve(objective_only=True, log=verbose)
                else:
                    return Integer(round(p.solve(objective_only=True, log=verbose)))
            else:
                p.solve(log=verbose)
                b = p.get_values(b)
                return [(u, v, W[u, v]) for u, v in W if b[u, v] == 1]

        else:
            raise ValueError('algorithm must be set to either "Edmonds" or "LP"')
```



---

archive/issue_comments_345701.json:
```json
{
    "body": "Changed commit from **[`98733b9`](https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60)** to **[`a208d75`](https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0)**",
    "created_at": "2017-05-30T01:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345701",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`98733b9`](https://github.com/sagemath/sagetrac-mirror/commit/98733b97ee3e59881b7312655f5e2c535e8f0a60)** to **[`a208d75`](https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0)**



---

archive/issue_comments_345702.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cb9611f5fe387a736fb3587aef3596c3d657bdc\"><code>9cb9611</code></a></td><td><code>Build a dictionary to discard loops and multiedges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0\"><code>a208d75</code></a></td><td><code>Parallel edge label dictionary + repairs to LP method</code></td></tr></table>\n",
    "created_at": "2017-05-30T01:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345702",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cb9611f5fe387a736fb3587aef3596c3d657bdc"><code>9cb9611</code></a></td><td><code>Build a dictionary to discard loops and multiedges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0"><code>a208d75</code></a></td><td><code>Parallel edge label dictionary + repairs to LP method</code></td></tr></table>




---

archive/issue_events_321851.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-30T01:54:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321851"
}
```



---

archive/issue_events_321852.json:
```json
{
    "actor": "https://github.com/sagetrac-zgershkoff",
    "created_at": "2017-05-30T01:54:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321852"
}
```



---

archive/issue_comments_345703.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI like that implementation-- I wish I had kept mine so I could compare it, but it does seem to be much faster than copying the graph. I took out the `reorder` method because it seems that the edges are stored in an ordered way. (That is, they were ordered in all the tests I did, and digging through the sagemath and networkx code didn't prove otherwise.) The `LP` method wasn't working correctly, but it seems to be working after I put in the business about `min(u,v), max(u,v)`.\n\nI also added a test for computing the matching of a multigraph, and it passes the doctest fine.\n\nI'm a little mystified as to why some of the changes I did seemed to make it slower. David's algorithm ran at a time comparable to the old one, but around when I added the `L` dictionary, the run time practically doubled. Perhaps there were background programs on my computer that started consuming more resources.",
    "created_at": "2017-05-30T01:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345703",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:6" align="right">comment:6</div>

I like that implementation-- I wish I had kept mine so I could compare it, but it does seem to be much faster than copying the graph. I took out the `reorder` method because it seems that the edges are stored in an ordered way. (That is, they were ordered in all the tests I did, and digging through the sagemath and networkx code didn't prove otherwise.) The `LP` method wasn't working correctly, but it seems to be working after I put in the business about `min(u,v), max(u,v)`.

I also added a test for computing the matching of a multigraph, and it passes the doctest fine.

I'm a little mystified as to why some of the changes I did seemed to make it slower. David's algorithm ran at a time comparable to the old one, but around when I added the `L` dictionary, the run time practically doubled. Perhaps there were background programs on my computer that started consuming more resources.



---

archive/issue_comments_345704.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI should clarify that the doctests for graphs passed. When I tried everything, there were some problems, but the problem is likely with my installation and not with changes to `graph.py`.",
    "created_at": "2017-05-30T02:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345704",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:7" align="right">comment:7</div>

I should clarify that the doctests for graphs passed. When I tried everything, there were some problems, but the problem is likely with my installation and not with changes to `graph.py`.



---

archive/issue_comments_345705.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcb053b2a0239323500a0e72aecb2e21e3b07dbb\"><code>fcb053b</code></a></td><td><code>Enable matching for multigraphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97ed4b4ff3a9603289454a1400ed0985c04c96d3\"><code>97ed4b4</code></a></td><td><code>Removed unnecessary argument</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ec4662555b9e931f70347e87a53c781263be60\"><code>82ec466</code></a></td><td><code>Need to copy the graph after all</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5ed48daf7e5be78d85dd1dea543432d64f22649\"><code>b5ed48d</code></a></td><td><code>Build a dictionary to discard loops and multiedges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6cd9665a1c01179155721bf49169991384b7a31\"><code>d6cd966</code></a></td><td><code>Parallel edge label dictionary + repairs to LP method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50\"><code>f66a4c1</code></a></td><td><code>Merge branch 'u/zgershkoff/matchings_in_multigraphs' of git://trac.sagemath.org/sage into t/23081/matchings_in_multigraphs</code></td></tr></table>\n",
    "created_at": "2017-06-02T21:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345705",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcb053b2a0239323500a0e72aecb2e21e3b07dbb"><code>fcb053b</code></a></td><td><code>Enable matching for multigraphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97ed4b4ff3a9603289454a1400ed0985c04c96d3"><code>97ed4b4</code></a></td><td><code>Removed unnecessary argument</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ec4662555b9e931f70347e87a53c781263be60"><code>82ec466</code></a></td><td><code>Need to copy the graph after all</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5ed48daf7e5be78d85dd1dea543432d64f22649"><code>b5ed48d</code></a></td><td><code>Build a dictionary to discard loops and multiedges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6cd9665a1c01179155721bf49169991384b7a31"><code>d6cd966</code></a></td><td><code>Parallel edge label dictionary + repairs to LP method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50"><code>f66a4c1</code></a></td><td><code>Merge branch 'u/zgershkoff/matchings_in_multigraphs' of git://trac.sagemath.org/sage into t/23081/matchings_in_multigraphs</code></td></tr></table>




---

archive/issue_comments_345706.json:
```json
{
    "body": "Changed commit from **[`a208d75`](https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0)** to **[`f66a4c1`](https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50)**",
    "created_at": "2017-06-02T21:26:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345706",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a208d75`](https://github.com/sagemath/sagetrac-mirror/commit/a208d750537553564087352a76c11ce2acea20d0)** to **[`f66a4c1`](https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50)**



---

archive/issue_comments_345707.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIn the LP, the only place where you need to use `min(u,v), max(u,v)` is `p.sum(b[min(u, v), max(u,v)] for u in self.neighbors(v) if u != v), max=1)`. Here you have no guarantee that `u < v`, but each time you use `for u, v in W`,  we know that `u < v`.\n\nYou can remove the line `#self._scream_if_not_simple(allow_loops=True)`.",
    "created_at": "2017-06-03T11:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345707",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:9" align="right">comment:9</div>

In the LP, the only place where you need to use `min(u,v), max(u,v)` is `p.sum(b[min(u, v), max(u,v)] for u in self.neighbors(v) if u != v), max=1)`. Here you have no guarantee that `u < v`, but each time you use `for u, v in W`,  we know that `u < v`.

You can remove the line `#self._scream_if_not_simple(allow_loops=True)`.



---

archive/issue_comments_345708.json:
```json
{
    "body": "Changed commit from **[`f66a4c1`](https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50)** to **[`22e1530`](https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727)**",
    "created_at": "2017-06-05T00:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345708",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f66a4c1`](https://github.com/sagemath/sagetrac-mirror/commit/f66a4c1682d950ef8ba73ac08ecedbba22b23f50)** to **[`22e1530`](https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727)**



---

archive/issue_comments_345709.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1904f4270b6cc19641622e9717e5f82a297ea527\"><code>1904f42</code></a></td><td><code>Combined dictioniaries</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727\"><code>22e1530</code></a></td><td><code>Implemented reorder method</code></td></tr></table>\n",
    "created_at": "2017-06-05T00:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345709",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1904f4270b6cc19641622e9717e5f82a297ea527"><code>1904f42</code></a></td><td><code>Combined dictioniaries</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727"><code>22e1530</code></a></td><td><code>Implemented reorder method</code></td></tr></table>




---

archive/issue_comments_345710.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da\"><code>b61be27</code></a></td><td><code>Fixed broken order of boolean checks</code></td></tr></table>\n",
    "created_at": "2017-06-05T00:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345710",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da"><code>b61be27</code></a></td><td><code>Fixed broken order of boolean checks</code></td></tr></table>




---

archive/issue_comments_345711.json:
```json
{
    "body": "Changed commit from **[`22e1530`](https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727)** to **[`b61be27`](https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da)**",
    "created_at": "2017-06-05T00:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345711",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`22e1530`](https://github.com/sagemath/sagetrac-mirror/commit/22e1530eff0ceec89abbdcba57abe6178d48b727)** to **[`b61be27`](https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da)**



---

archive/issue_comments_345712.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIn the case, I've put the reorder method back.\n\nI do think this ticket needs to be completed (or loops need to be disallowed, because they caused false results as you've pointed out) but I'm still confused as to how my changes have made it so much slower.",
    "created_at": "2017-06-05T00:28:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345712",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:12" align="right">comment:12</div>

In the case, I've put the reorder method back.

I do think this ticket needs to be completed (or loops need to be disallowed, because they caused false results as you've pointed out) but I'm still confused as to how my changes have made it so much slower.



---

archive/issue_comments_345713.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nActually, I think I see it now. I'll fix it shortly.",
    "created_at": "2017-06-05T00:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345713",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:13" align="right">comment:13</div>

Actually, I think I see it now. I'll fix it shortly.



---

archive/issue_comments_345714.json:
```json
{
    "body": "Changed commit from **[`b61be27`](https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da)** to **[`bbbd73d`](https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24)**",
    "created_at": "2017-06-05T00:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345714",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b61be27`](https://github.com/sagemath/sagetrac-mirror/commit/b61be27c3d9c97d57f3d4b21d9c968aae8bb87da)** to **[`bbbd73d`](https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24)**



---

archive/issue_comments_345715.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e902a08c5ff306c48c2310d97441d1590bb94c16\"><code>e902a08</code></a></td><td><code>Reduced unnecessary calling of weight function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24\"><code>bbbd73d</code></a></td><td><code>Separated dictionaries</code></td></tr></table>\n",
    "created_at": "2017-06-05T00:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345715",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e902a08c5ff306c48c2310d97441d1590bb94c16"><code>e902a08</code></a></td><td><code>Reduced unnecessary calling of weight function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24"><code>bbbd73d</code></a></td><td><code>Separated dictionaries</code></td></tr></table>




---

archive/issue_comments_345716.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1\"><code>63b9d35</code></a></td><td><code>That one should be the weights dictionary</code></td></tr></table>\n",
    "created_at": "2017-06-05T00:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345716",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1"><code>63b9d35</code></a></td><td><code>That one should be the weights dictionary</code></td></tr></table>




---

archive/issue_comments_345717.json:
```json
{
    "body": "Changed commit from **[`bbbd73d`](https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24)** to **[`63b9d35`](https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1)**",
    "created_at": "2017-06-05T00:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345717",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bbbd73d`](https://github.com/sagemath/sagetrac-mirror/commit/bbbd73ded0d6b9c35c52d3a08aaebf4c1e89ec24)** to **[`63b9d35`](https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1)**



---

archive/issue_comments_345718.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWhile combining the dictionaries does somewhat reduce the memory footprint, the extra step of extracting from a list is probably adding up as you probably surmised. However, the extra Python calls to `reorder` might also have a detrimental effect compared to the essentially system call of `min`. It might be worthwhile to run it through `%lprun` (and `%prun`) and see what lines in particular are taking the time. Do you have a particular medium sized example that is non-trivial but not-to-big that you are testing with?",
    "created_at": "2017-06-05T01:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345718",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

While combining the dictionaries does somewhat reduce the memory footprint, the extra step of extracting from a list is probably adding up as you probably surmised. However, the extra Python calls to `reorder` might also have a detrimental effect compared to the essentially system call of `min`. It might be worthwhile to run it through `%lprun` (and `%prun`) and see what lines in particular are taking the time. Do you have a particular medium sized example that is non-trivial but not-to-big that you are testing with?



---

archive/issue_comments_345719.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e\"><code>19bf18c</code></a></td><td><code>Replaced reorder with min/max</code></td></tr></table>\n",
    "created_at": "2017-06-05T02:16:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345719",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e"><code>19bf18c</code></a></td><td><code>Replaced reorder with min/max</code></td></tr></table>




---

archive/issue_comments_345720.json:
```json
{
    "body": "Changed commit from **[`63b9d35`](https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1)** to **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**",
    "created_at": "2017-06-05T02:16:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345720",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`63b9d35`](https://github.com/sagemath/sagetrac-mirror/commit/63b9d357881cd17004f750435ac1627b44ab4eb1)** to **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**



---

archive/issue_comments_345721.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWhen I changed it to only call `weight(l)` if `allow_edge_labels` is `True`, it sped up significantly.\n\nThe example I've been using for a baseline reading is `G = graphs.CompleteGraph(500)`, which takes 1.05 seconds with `timeit()` on the develop branch, and 1.15 seconds on this branch. When I do `G.matching(allow_edge_labels=True)`, both branches take about 2.25 seconds. Since you suggested a non-trivial one, I tried `H = graphs.GeneralizedPetersenGraph(500,5)`. This one takes about 400ms on either branch regardless of edge labels.",
    "created_at": "2017-06-05T02:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345721",
    "user": "https://github.com/sagetrac-zgershkoff"
}
```

<div id="comment:18" align="right">comment:18</div>

When I changed it to only call `weight(l)` if `allow_edge_labels` is `True`, it sped up significantly.

The example I've been using for a baseline reading is `G = graphs.CompleteGraph(500)`, which takes 1.05 seconds with `timeit()` on the develop branch, and 1.15 seconds on this branch. When I do `G.matching(allow_edge_labels=True)`, both branches take about 2.25 seconds. Since you suggested a non-trivial one, I tried `H = graphs.GeneralizedPetersenGraph(500,5)`. This one takes about 400ms on either branch regardless of edge labels.



---

archive/issue_comments_345722.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOn\n\n```\nsage: H = graphs.GeneralizedPetersenGraph(600,8)\nsage: %lprun -f H.matching H.matching(use_edge_labels=True)\n```\nover 99% of the time is spent on the call to networkx:\n\n```\n  4418         1      6946726 6946726.0     99.4              d = networkx.max_weight_matching(g)\n```\nSimilarly when `use_edge_labels=False`. When I do `algorithm='LP'`, similar amount of time is spent doing the LP stuff.\n\nConclusion: There is almost no speed to be gained except on really small graphs. So there is nothing else to really optimize out, at least by these examples.",
    "created_at": "2017-06-05T05:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345722",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

On

```
sage: H = graphs.GeneralizedPetersenGraph(600,8)
sage: %lprun -f H.matching H.matching(use_edge_labels=True)
```
over 99% of the time is spent on the call to networkx:

```
  4418         1      6946726 6946726.0     99.4              d = networkx.max_weight_matching(g)
```
Similarly when `use_edge_labels=False`. When I do `algorithm='LP'`, similar amount of time is spent doing the LP stuff.

Conclusion: There is almost no speed to be gained except on really small graphs. So there is nothing else to really optimize out, at least by these examples.



---

archive/issue_comments_345723.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe patch is now good to go (passes all tests, etc.). I agree with Travis that it would be a lot of work to save small computation time.",
    "created_at": "2017-06-05T08:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345723",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">comment:20</div>

The patch is now good to go (passes all tests, etc.). I agree with Travis that it would be a lot of work to save small computation time.



---

archive/issue_comments_345724.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, David Coudert**",
    "created_at": "2017-06-05T08:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345724",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **Travis Scrimshaw, David Coudert**



---

archive/issue_events_321853.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-06-05T08:26:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321853"
}
```



---

archive/issue_events_321854.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-06-05T08:26:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321854"
}
```



---

archive/issue_events_321855.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-13T06:51:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321855"
}
```



---

archive/issue_events_321856.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f348883997666c90cc813c7421bdd4434a7832a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-13T06:51:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23081#event-321856"
}
```



---

archive/issue_comments_345725.json:
```json
{
    "body": "Changed branch from **[u/zgershkoff/matchings_in_multigraphs](https://github.com/sagemath/sagetrac-mirror/tree/u/zgershkoff/matchings_in_multigraphs)** to **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**",
    "created_at": "2017-06-13T06:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345725",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/zgershkoff/matchings_in_multigraphs](https://github.com/sagemath/sagetrac-mirror/tree/u/zgershkoff/matchings_in_multigraphs)** to **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)**



---

archive/issue_comments_345726.json:
```json
{
    "body": "Changed author from **Zachary Gershkoff** to **Zach Gershkoff**",
    "created_at": "2017-10-24T15:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345726",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Zachary Gershkoff** to **Zach Gershkoff**



---

archive/issue_comments_345727.json:
```json
{
    "body": "Changed commit from **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)** to none",
    "created_at": "2017-10-24T15:10:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23081#issuecomment-345727",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`19bf18c`](https://github.com/sagemath/sagetrac-mirror/commit/19bf18cf5ab6f6bb932974aace55082cea0b719e)** to none
