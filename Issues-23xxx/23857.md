# Issue 23857: Effective Resistance for Graphs

archive/issues_023857.json:
```json
{
    "body": "Assignee: @rajat1433\n\nKeywords: effective resistance, resitance distance, graphs, link prediction, sd90\n\nCalculate effective resistances between pairs of nodes in a graph. \n\nIssue created by migration from https://trac.sagemath.org/ticket/24094\n\n",
    "closed_at": "2019-03-14T18:13:56Z",
    "created_at": "2017-10-24T00:29:16Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Effective Resistance for Graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23857",
    "user": "https://trac.sagemath.org/admin/accounts/users/afrancis"
}
```
Assignee: @rajat1433

Keywords: effective resistance, resitance distance, graphs, link prediction, sd90

Calculate effective resistances between pairs of nodes in a graph. 

Issue created by migration from https://trac.sagemath.org/ticket/24094





---

archive/issue_comments_333961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-24T22:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-24T23:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333963.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-24T23:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333963",
    "user": "https://trac.sagemath.org/admin/accounts/users/afrancis"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_333964.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-25T07:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333964",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333965.json:
```json
{
    "body": "Welcome to Sagemath.\n\nI have several comments on your ticket, some on the presentation and some on the algorithms you use.\n\nLet's start with general comments, mostly on the presentation. I give them for the first method, but you should do the same for the other methods.\n- `effective_resistance(self,i,j)` -> `effective_resistance(self, i, j)`\n- `Returns the effective resistance between nodes i and j` -> `Return the effective resistance between nodes `i` and `j`.`\n- Please add a description of the notion of effective resistance. What is it?\n- You could add a link to the wikipedia page (e.g., in the seealso block). Should be `See :wikipedia:`Resistance_distance`` for more details\n- Text lines (comments, definition, etc. must be in 80 columns format. Some code editors like emacs help you to do that without effort\n\n- `a straight linear 2-tree on 6 vertices`. Well, I assume it's a Path graph of order 6, no?\n- then you can use: `G1 = graphs.PathGraph(6)`\n- replace `G1` with `G` since you don't have `G2`\n\n- in the test with the complete graph, you check only 1 edge. I assume you want to should that the resistance of each edge is `1/2`, right? so you could do instead:\n\n```\nsage: G = graphs.CompleteGraph(4)\nsage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=0))\nTrue\n```\n- Since I'm not familiar with this definition, it is not easy to tell which tests are important or not.\n- Could you tell us what is the expected behavior if the graph has loops, multiple edges, is empty, is not connected ?\n\nWe will get to the algorithmic part latter. I need to understand the definition first. I have the feeling that we can do something faster, may be in another ticket.",
    "created_at": "2017-10-25T07:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333965",
    "user": "https://github.com/dcoudert"
}
```

Welcome to Sagemath.

I have several comments on your ticket, some on the presentation and some on the algorithms you use.

Let's start with general comments, mostly on the presentation. I give them for the first method, but you should do the same for the other methods.
- `effective_resistance(self,i,j)` -> `effective_resistance(self, i, j)`
- `Returns the effective resistance between nodes i and j` -> `Return the effective resistance between nodes `i` and `j`.`
- Please add a description of the notion of effective resistance. What is it?
- You could add a link to the wikipedia page (e.g., in the seealso block). Should be `See :wikipedia:`Resistance_distance`` for more details
- Text lines (comments, definition, etc. must be in 80 columns format. Some code editors like emacs help you to do that without effort

- `a straight linear 2-tree on 6 vertices`. Well, I assume it's a Path graph of order 6, no?
- then you can use: `G1 = graphs.PathGraph(6)`
- replace `G1` with `G` since you don't have `G2`

- in the test with the complete graph, you check only 1 edge. I assume you want to should that the resistance of each edge is `1/2`, right? so you could do instead:

```
sage: G = graphs.CompleteGraph(4)
sage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=0))
True
```
- Since I'm not familiar with this definition, it is not easy to tell which tests are important or not.
- Could you tell us what is the expected behavior if the graph has loops, multiple edges, is empty, is not connected ?

We will get to the algorithmic part latter. I need to understand the definition first. I have the feeling that we can do something faster, may be in another ticket.



---

archive/issue_comments_333966.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-25T20:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333966",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333967.json:
```json
{
    "body": "Thanks for your very helpful comments! I think I made all the presentation changes you submitted\n\n>a straight linear 2-tree on 6 vertices. Well, I assume it's a Path graph of order 6, no? then you can use: G1 = graphs.PathGraph(6)\n\n\nNo, a straight linear 2-tree is like a ladder made out of triangles, not a path. \n\n>Since I'm not familiar with this definition, it is not easy to tell which tests are important or not.\n>Could you tell us what is the expected behavior if the graph has loops, multiple edges, is empty, is not connected ?\n\n\nMultiple edges should lower the effective resistance between pairs of nodes. A 'parallel' network transformation demonstrates how this works, but this is another method we are working on implementing at this Sagedays!\n\nAn empty graph has no node pairs, so an error should be returned for effective_resistance, and an empty matrix for effective_resistance_matrix. \n\nI hadn't thought about connected graphs.  Effective resistance between edges in different components should be infinity or return an error.  I'll work on that. Also, loops should not be allowed.  I'll fix that as well. \n\n>We will get to the algorithmic part latter. I need to understand the definition first. I have the feeling that we can do something faster, may be in another ticket.\n\n\nInteresting, I would be happy to find out that this is true!",
    "created_at": "2017-10-25T21:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333967",
    "user": "https://trac.sagemath.org/admin/accounts/users/afrancis"
}
```

Thanks for your very helpful comments! I think I made all the presentation changes you submitted

>a straight linear 2-tree on 6 vertices. Well, I assume it's a Path graph of order 6, no? then you can use: G1 = graphs.PathGraph(6)


No, a straight linear 2-tree is like a ladder made out of triangles, not a path. 

>Since I'm not familiar with this definition, it is not easy to tell which tests are important or not.
>Could you tell us what is the expected behavior if the graph has loops, multiple edges, is empty, is not connected ?


Multiple edges should lower the effective resistance between pairs of nodes. A 'parallel' network transformation demonstrates how this works, but this is another method we are working on implementing at this Sagedays!

An empty graph has no node pairs, so an error should be returned for effective_resistance, and an empty matrix for effective_resistance_matrix. 

I hadn't thought about connected graphs.  Effective resistance between edges in different components should be infinity or return an error.  I'll work on that. Also, loops should not be allowed.  I'll fix that as well. 

>We will get to the algorithmic part latter. I need to understand the definition first. I have the feeling that we can do something faster, may be in another ticket.


Interesting, I would be happy to find out that this is true!



---

archive/issue_comments_333968.json:
```json
{
    "body": "In the description of the method, use ``i`` instead of just `i`. This indicates that this is math code. It will be handled when generating the html documentation and so well displayed. You can also put latex equations if you like (e.g., `\\sqrt{x^3+1} \\leq 2`).\n\nFor wikipedia links, the `_` in `:wikipedia:`Resistance_Distance`` is needed. If corresponds to the name of the page you see in the url [https://en.wikipedia.org/wiki/Resistance_distance](https://en.wikipedia.org/wiki/Resistance_distance)\n\nWhen you have parameters with default value, don't put spaces. So `def effective_resistance_matrix(self, nonedgesonly = True):` -> `def effective_resistance_matrix(self, nonedgesonly=True):`. The same when you call the method.\n\n`if ``True`` eliminate pairs of adjacent vertices`. Well, you don't eliminate pairs, you assign them value 0. It's different, no?\n\nI prefer `self.order()` to `self.num_verts()`.\n\n\nFor `least_effective_resistance`, you should rewrite like that (should be much faster).\n\n```\n    self._scream_if_not_simple()\n    if nonedgesonly and self.is_clique():\n        return []\n    S = self.effective_resistance_matrix(nonedgesonly=nonedgesonly)\n    if nonedgesonly:\n        edges = self.complement().edges(labels=0)\n    else:\n        edges = [(i,j) for i in range(n) for j in range(i+1,n)]\n    rmin = min(S[e] for e in edges)\n    return [e for e in edges if S[e] == rmin]\n```\nThe `self._scream_if_not_simple()` will raise an error if the graph has loops or multiple edges. You don't need to add specific tests for that.\n\nFor `effective_resistance(self, i, j):`, you have to decide of what to do when `i == j` and you should check `if not i in self or not j in self:`. \n\nThe case of non connected should be treated at some point. \n- method 1: if not in same component return `+oo` or 0. Otherwise, do computation only on that component\n- method 2: you can certainly build the matrix from the results on each connected components\n- method 3: You can do computations independently on each components and collect the result (faster than working on a big matrix)",
    "created_at": "2017-10-25T21:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333968",
    "user": "https://github.com/dcoudert"
}
```

In the description of the method, use ``i`` instead of just `i`. This indicates that this is math code. It will be handled when generating the html documentation and so well displayed. You can also put latex equations if you like (e.g., `\sqrt{x^3+1} \leq 2`).

For wikipedia links, the `_` in `:wikipedia:`Resistance_Distance`` is needed. If corresponds to the name of the page you see in the url [https://en.wikipedia.org/wiki/Resistance_distance](https://en.wikipedia.org/wiki/Resistance_distance)

When you have parameters with default value, don't put spaces. So `def effective_resistance_matrix(self, nonedgesonly = True):` -> `def effective_resistance_matrix(self, nonedgesonly=True):`. The same when you call the method.

`if ``True`` eliminate pairs of adjacent vertices`. Well, you don't eliminate pairs, you assign them value 0. It's different, no?

I prefer `self.order()` to `self.num_verts()`.


For `least_effective_resistance`, you should rewrite like that (should be much faster).

```
    self._scream_if_not_simple()
    if nonedgesonly and self.is_clique():
        return []
    S = self.effective_resistance_matrix(nonedgesonly=nonedgesonly)
    if nonedgesonly:
        edges = self.complement().edges(labels=0)
    else:
        edges = [(i,j) for i in range(n) for j in range(i+1,n)]
    rmin = min(S[e] for e in edges)
    return [e for e in edges if S[e] == rmin]
```
The `self._scream_if_not_simple()` will raise an error if the graph has loops or multiple edges. You don't need to add specific tests for that.

For `effective_resistance(self, i, j):`, you have to decide of what to do when `i == j` and you should check `if not i in self or not j in self:`. 

The case of non connected should be treated at some point. 
- method 1: if not in same component return `+oo` or 0. Otherwise, do computation only on that component
- method 2: you can certainly build the matrix from the results on each connected components
- method 3: You can do computations independently on each components and collect the result (faster than working on a big matrix)



---

archive/issue_comments_333969.json:
```json
{
    "body": "you can also decide that the graph must be connected. I don't know what is best.",
    "created_at": "2017-10-25T21:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333969",
    "user": "https://github.com/dcoudert"
}
```

you can also decide that the graph must be connected. I don't know what is best.



---

archive/issue_comments_333970.json:
```json
{
    "body": "According to wikipedia definition:\nIn graph theory, the resistance distance between two vertices of a simple connected graph, G, is equal to the resistance between two equivalent points on an electrical network, constructed so as to correspond to G, with each edge being replaced by a 1 ohm resistance. It is a metric on graphs. \n\nIt assumes graph to be simple and connected, so I guess we can do the same here.\n\nCan I work further on this ticket, if nobody else is working based on the proposed changes in the review above?",
    "created_at": "2019-03-09T05:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333970",
    "user": "https://github.com/rajat1433"
}
```

According to wikipedia definition:
In graph theory, the resistance distance between two vertices of a simple connected graph, G, is equal to the resistance between two equivalent points on an electrical network, constructed so as to correspond to G, with each edge being replaced by a 1 ohm resistance. It is a metric on graphs. 

It assumes graph to be simple and connected, so I guess we can do the same here.

Can I work further on this ticket, if nobody else is working based on the proposed changes in the review above?



---

archive/issue_comments_333971.json:
```json
{
    "body": "Yes, you can.",
    "created_at": "2019-03-09T08:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333971",
    "user": "https://github.com/dcoudert"
}
```

Yes, you can.



---

archive/issue_comments_333972.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-03-09T08:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333972",
    "user": "https://github.com/rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_events_061176.json:
```json
{
    "actor": "https://github.com/rajat1433",
    "created_at": "2019-03-09T13:06:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23857#event-61176"
}
```



---

archive/issue_comments_333973.json:
```json
{
    "body": "I had a small doubt regarding should I be continue working on these functions in graph.py file or migrate them to generic_graph.py file. I guess these functions might be more suitable in latter module.",
    "created_at": "2019-03-09T15:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333973",
    "user": "https://github.com/rajat1433"
}
```

I had a small doubt regarding should I be continue working on these functions in graph.py file or migrate them to generic_graph.py file. I guess these functions might be more suitable in latter module.



---

archive/issue_comments_333974.json:
```json
{
    "body": "Is the method valid for both `Graph` and `DiGraph` ?",
    "created_at": "2019-03-09T18:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333974",
    "user": "https://github.com/dcoudert"
}
```

Is the method valid for both `Graph` and `DiGraph` ?



---

archive/issue_comments_333975.json:
```json
{
    "body": "Replying to [comment:15 dcoudert]:\n> Is the method valid for both `Graph` and `DiGraph` ?\n\nIt makes sense for Graph.\nThanks for clearing the confusion.",
    "created_at": "2019-03-09T18:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333975",
    "user": "https://github.com/rajat1433"
}
```

Replying to [comment:15 dcoudert]:
> Is the method valid for both `Graph` and `DiGraph` ?

It makes sense for Graph.
Thanks for clearing the confusion.



---

archive/issue_comments_333976.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-09T20:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333977.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-09T20:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333977",
    "user": "https://github.com/rajat1433"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-10T20:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333978",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333979.json:
```json
{
    "body": "I have pushed the modified code and passed all the tests and corner cases and also tested the documentation build.",
    "created_at": "2019-03-10T20:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333979",
    "user": "https://github.com/rajat1433"
}
```

I have pushed the modified code and passed all the tests and corner cases and also tested the documentation build.



---

archive/issue_comments_333980.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T10:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333981.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-11T15:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333981",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333982.json:
```json
{
    "body": "Another round of comments. Certainly more to come :P The goal is to obtain the best possible code. It's always easier to read, so contains less errors and is way easier to maintain.\n\n- Ensure that all comments are in 80 columns mode. For instace\n\n```diff\n-- Amanda Francis, Caitlin Lienkaemper, Kate Collins, Rajat Mittal (2019-03-10): methods for computing effective resistance\n+- Amanda Francis, Caitlin Lienkaemper, Kate Collins, Rajat Mittal (2019-03-10):\n+   methods for computing effective resistance\n```\n\n- You can use latex mode\n\n```diff\n-        OUTPUT: rational number denoting resistance between nodes i and j\n+        OUTPUT: rational number denoting resistance between nodes `i` and `j`\n```\n\n- Although `labels=0` is currently accepted, it is better to write `labels=False`\n\n```diff\n-            sage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=0))\n+            sage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=False))\n```\n\n- `not i in self:` -> `i not in self`. \n\n- some pep8 (I know it's impossible to be aware of all these rules. We try to do our best)\n\n```diff\n-            raise ValueError('The Graph is not a connected graph.')\n+            raise ValueError('the Graph is not a connected graph')\n```\n\n- It is better to give the order of the vertices to `laplacian_matrix`. Furthermore, `.vertices()` currently sort vertices by default, but you don't need that. So use either `list(self)` or `self.vertices(sort=False)`\n\n```diff\n-        vert = self.vertices()\n+        vert = list(self)\n         i1 = vert.index(i)\n         i2 = vert.index(j)\n         n = self.order()\n-        L = self.laplacian_matrix()\n+        L = self.laplacian_matrix(vertices=vert)\n```\n\n- \n\n```diff\n-        sigma = matrix(Id[i1]-Id[i2])\n-        diff = sigma* M * sigma.transpose()\n+        sigma = matrix(Id[i1] - Id[i2])\n+        diff = sigma * M * sigma.transpose()\n```\n\n- `diff[0,0]` -> `diff[0, 0]`\n\n- Improve other methods the same way\n- Add parameter `vertices` to `least_effective_resistance`",
    "created_at": "2019-03-11T15:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333982",
    "user": "https://github.com/dcoudert"
}
```

Another round of comments. Certainly more to come :P The goal is to obtain the best possible code. It's always easier to read, so contains less errors and is way easier to maintain.

- Ensure that all comments are in 80 columns mode. For instace

```diff
-- Amanda Francis, Caitlin Lienkaemper, Kate Collins, Rajat Mittal (2019-03-10): methods for computing effective resistance
+- Amanda Francis, Caitlin Lienkaemper, Kate Collins, Rajat Mittal (2019-03-10):
+   methods for computing effective resistance
```

- You can use latex mode

```diff
-        OUTPUT: rational number denoting resistance between nodes i and j
+        OUTPUT: rational number denoting resistance between nodes `i` and `j`
```

- Although `labels=0` is currently accepted, it is better to write `labels=False`

```diff
-            sage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=0))
+            sage: all(G.effective_resistance(u, v) == 1/2 for u,v in G.edge_iterator(labels=False))
```

- `not i in self:` -> `i not in self`. 

- some pep8 (I know it's impossible to be aware of all these rules. We try to do our best)

```diff
-            raise ValueError('The Graph is not a connected graph.')
+            raise ValueError('the Graph is not a connected graph')
```

- It is better to give the order of the vertices to `laplacian_matrix`. Furthermore, `.vertices()` currently sort vertices by default, but you don't need that. So use either `list(self)` or `self.vertices(sort=False)`

```diff
-        vert = self.vertices()
+        vert = list(self)
         i1 = vert.index(i)
         i2 = vert.index(j)
         n = self.order()
-        L = self.laplacian_matrix()
+        L = self.laplacian_matrix(vertices=vert)
```

- 

```diff
-        sigma = matrix(Id[i1]-Id[i2])
-        diff = sigma* M * sigma.transpose()
+        sigma = matrix(Id[i1] - Id[i2])
+        diff = sigma * M * sigma.transpose()
```

- `diff[0,0]` -> `diff[0, 0]`

- Improve other methods the same way
- Add parameter `vertices` to `least_effective_resistance`



---

archive/issue_comments_333983.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T16:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333984.json:
```json
{
    "body": "Thanks for the review.\n\nI don't think least_effective_resistance requires vertices as a perimeter as the user is generally interested in finding the least resistance wrt the whole graph. Still if it is required I can add that. Although I did add this \n\n```\n        verts = list(self)\n        verttoidx = {u: i for i, u in enumerate(verts)}\n        S = self.effective_resistance_matrix(vertices=verts, nonedgesonly=nonedgesonly)\n```",
    "created_at": "2019-03-11T16:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333984",
    "user": "https://github.com/rajat1433"
}
```

Thanks for the review.

I don't think least_effective_resistance requires vertices as a perimeter as the user is generally interested in finding the least resistance wrt the whole graph. Still if it is required I can add that. Although I did add this 

```
        verts = list(self)
        verttoidx = {u: i for i, u in enumerate(verts)}
        S = self.effective_resistance_matrix(vertices=verts, nonedgesonly=nonedgesonly)
```



---

archive/issue_comments_333985.json:
```json
{
    "body": "Right, I forgot the method returns vertices with least resistance.\n\nThis is not needed\n\n```diff\n-        verttoidx = {}\n```\n\nAlso, please improve the code as much as you can according pep8 rules.",
    "created_at": "2019-03-11T16:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333985",
    "user": "https://github.com/dcoudert"
}
```

Right, I forgot the method returns vertices with least resistance.

This is not needed

```diff
-        verttoidx = {}
```

Also, please improve the code as much as you can according pep8 rules.



---

archive/issue_comments_333986.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T16:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333986",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333987.json:
```json
{
    "body": "This is not needed\n\n-        verttoidx = {}\n\nYes I did that locally but forgot to commit :)",
    "created_at": "2019-03-11T16:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333987",
    "user": "https://github.com/rajat1433"
}
```

This is not needed

-        verttoidx = {}

Yes I did that locally but forgot to commit :)



---

archive/issue_comments_333988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T16:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333989.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-03-11T16:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333989",
    "user": "https://github.com/rajat1433"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333990.json:
```json
{
    "body": "In method `effective_resistance`:\n- I prefer this definition:\n\n```diff\n-        This is the resistance between two equivalent points of a simple connected graph\n-        replacing each edge by a 1 ohm resistance.\n+        The resistance distance between vertices `i` and `j` of a simple\n+        connected graph `G` is defined as the effective resistance between the\n+        two vertices on an electrical network constructed from `G` replacing\n+        each edge of the graph by a unit (1 ohm) resistor.\n```\n- \n\n```diff\n-              a similar method giving a matrix full of all effective resistances between all nodes\n+              a similar method giving a matrix full of all effective\n+              resistances between all nodes\n```\n- remove the '.' at the end of `raise ValueError('the Graph is not a connected graph.')`\n\nIn method `effective_resistance_matrix`\n- add similar definition than above\n- a `;` is missing\n\n```diff\n-        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True`` assign \n+        - ``nonedgesonly`` -- boolean (default: ``True``) if ``True`` assign \n```\n- remove `.` at the end of `raise ValueError('the Graph is not a connected graph.')`\n- \n\n```diff\n-        S = d*onesvec.transpose() + onesvec*d.transpose() - 2* M\n+        S = d * onesvec.transpose() + onesvec * d.transpose() - 2 * M\n```\n\nIn `least_effective_resistance`\n- add similar definition than above\n- may be simpler message\n\n```diff\n-            raise ValueError('unable to compute least resistance for an empty Graph object')\n+            raise ValueError('unable to compute least resistance on empty Graph')\n```\n- remove `.` at the end of `raise ValueError('the Graph is not a connected graph.')`\n- \n\n```diff\n-            edges = [(verts[i],verts[j]) for i in range(n) for j in range(i+1,n)]\n+            edges = [(verts[i], verts[j]) for i in range(n) for j in range(i + 1, n)]\n```",
    "created_at": "2019-03-11T17:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333990",
    "user": "https://github.com/dcoudert"
}
```

In method `effective_resistance`:
- I prefer this definition:

```diff
-        This is the resistance between two equivalent points of a simple connected graph
-        replacing each edge by a 1 ohm resistance.
+        The resistance distance between vertices `i` and `j` of a simple
+        connected graph `G` is defined as the effective resistance between the
+        two vertices on an electrical network constructed from `G` replacing
+        each edge of the graph by a unit (1 ohm) resistor.
```
- 

```diff
-              a similar method giving a matrix full of all effective resistances between all nodes
+              a similar method giving a matrix full of all effective
+              resistances between all nodes
```
- remove the '.' at the end of `raise ValueError('the Graph is not a connected graph.')`

In method `effective_resistance_matrix`
- add similar definition than above
- a `;` is missing

```diff
-        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True`` assign 
+        - ``nonedgesonly`` -- boolean (default: ``True``) if ``True`` assign 
```
- remove `.` at the end of `raise ValueError('the Graph is not a connected graph.')`
- 

```diff
-        S = d*onesvec.transpose() + onesvec*d.transpose() - 2* M
+        S = d * onesvec.transpose() + onesvec * d.transpose() - 2 * M
```

In `least_effective_resistance`
- add similar definition than above
- may be simpler message

```diff
-            raise ValueError('unable to compute least resistance for an empty Graph object')
+            raise ValueError('unable to compute least resistance on empty Graph')
```
- remove `.` at the end of `raise ValueError('the Graph is not a connected graph.')`
- 

```diff
-            edges = [(verts[i],verts[j]) for i in range(n) for j in range(i+1,n)]
+            edges = [(verts[i], verts[j]) for i in range(n) for j in range(i + 1, n)]
```



---

archive/issue_comments_333991.json:
```json
{
    "body": "```\n\n\n-        S = d*onesvec.transpose() + onesvec*d.transpose() - 2* M\n+        S = d * onesvec.transpose() + onesvec * d.transpose() - 2 * M\n\n```\n\n\nBut according to pep8\n\nYes:\n\nx = x*2 - 1\n\nhypot2 = x*x + y*y\n\nc = (a+b) * (a-b)\n\nNo:\n\nx = x * 2 - 1\n\nhypot2 = x * x + y * y\n\nc = (a + b) * (a - b)\n\nfirst one seems to be more right\n\nAm I missing something?",
    "created_at": "2019-03-11T18:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333991",
    "user": "https://github.com/rajat1433"
}
```

```


-        S = d*onesvec.transpose() + onesvec*d.transpose() - 2* M
+        S = d * onesvec.transpose() + onesvec * d.transpose() - 2 * M

```


But according to pep8

Yes:

x = x*2 - 1

hypot2 = x*x + y*y

c = (a+b) * (a-b)

No:

x = x * 2 - 1

hypot2 = x * x + y * y

c = (a + b) * (a - b)

first one seems to be more right

Am I missing something?



---

archive/issue_comments_333992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T18:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333993.json:
```json
{
    "body": "- still missing `;`\n\n```diff\n-        - ``nonedgesonly`` -- boolean (default: ``True``) if ``True`` assign \n+        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True`` assign\n```\n- Remove trailing white spaces. For instance the line above contains a useless space at the end\n- instead of `if n == 0:`, we usually use `if not n:`\n- please unify the conditions\n\n```\n+        if i not in self:\n+            raise ValueError(\"vertex ({0}) is not a vertex of the graph\".format(repr(i)))\n+        elif not j in self:\n```",
    "created_at": "2019-03-12T07:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333993",
    "user": "https://github.com/dcoudert"
}
```

- still missing `;`

```diff
-        - ``nonedgesonly`` -- boolean (default: ``True``) if ``True`` assign 
+        - ``nonedgesonly`` -- boolean (default: ``True``); if ``True`` assign
```
- Remove trailing white spaces. For instance the line above contains a useless space at the end
- instead of `if n == 0:`, we usually use `if not n:`
- please unify the conditions

```
+        if i not in self:
+            raise ValueError("vertex ({0}) is not a vertex of the graph".format(repr(i)))
+        elif not j in self:
```



---

archive/issue_comments_333994.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-12T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333995.json:
```json
{
    "body": "I couldn't find a suitable way to unify\n\n```\n+        if i not in self:\n+            raise ValueError(\"vertex ({0}) is not a vertex of the graph\".format(repr(i)))\n+        elif j not in self:\n```\nwithout printing the vertices values. If you have any suggestion I would like to know.\n\nEven in the shortest path between u and v function\n\n\n```\n        if not self.has_vertex(u):\n            raise ValueError(\"vertex '{}' is not in the (di)graph\".format(u))\n        if not self.has_vertex(v):\n            raise ValueError(\"vertex '{}' is not in the (di)graph\".format(v))\n```\n\nthis practice was followed.",
    "created_at": "2019-03-12T08:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333995",
    "user": "https://github.com/rajat1433"
}
```

I couldn't find a suitable way to unify

```
+        if i not in self:
+            raise ValueError("vertex ({0}) is not a vertex of the graph".format(repr(i)))
+        elif j not in self:
```
without printing the vertices values. If you have any suggestion I would like to know.

Even in the shortest path between u and v function


```
        if not self.has_vertex(u):
            raise ValueError("vertex '{}' is not in the (di)graph".format(u))
        if not self.has_vertex(v):
            raise ValueError("vertex '{}' is not in the (di)graph".format(v))
```

this practice was followed.



---

archive/issue_comments_333996.json:
```json
{
    "body": "it was just about the use of both forms: `if i not in self:` and `if not j in self:`. Now it's better.",
    "created_at": "2019-03-12T08:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333996",
    "user": "https://github.com/dcoudert"
}
```

it was just about the use of both forms: `if i not in self:` and `if not j in self:`. Now it's better.



---

archive/issue_comments_333997.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-13T10:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333997",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_333998.json:
```json
{
    "body": "For me this patch is not good to go.",
    "created_at": "2019-03-13T10:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333998",
    "user": "https://github.com/dcoudert"
}
```

For me this patch is not good to go.



---

archive/issue_comments_333999.json:
```json
{
    "body": "I guess you made a typo above regarding not good to go. (maybe?) :)",
    "created_at": "2019-03-13T11:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-333999",
    "user": "https://github.com/rajat1433"
}
```

I guess you made a typo above regarding not good to go. (maybe?) :)



---

archive/issue_comments_334000.json:
```json
{
    "body": "Oups !\n\nThis patch is NOW good to go.",
    "created_at": "2019-03-13T12:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-334000",
    "user": "https://github.com/dcoudert"
}
```

Oups !

This patch is NOW good to go.



---

archive/issue_comments_334001.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-14T18:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-334001",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061177.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-14T18:13:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23857#event-61177"
}
```



---

archive/issue_comments_334002.json:
```json
{
    "body": "Follow-up question at \n\n- [Ask Sage question 63701: Effective resistance matrix and `nonedgesonly=True`](https://ask.sagemath.org/question/63701)\n\nDefaulting to `nonedgesonly=False` might have seemed more natural.\n\nSince all examples and tests use `False`,\nwhy was `True` made the default?",
    "created_at": "2022-08-20T12:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-334002",
    "user": "https://github.com/slel"
}
```

Follow-up question at 

- [Ask Sage question 63701: Effective resistance matrix and `nonedgesonly=True`](https://ask.sagemath.org/question/63701)

Defaulting to `nonedgesonly=False` might have seemed more natural.

Since all examples and tests use `False`,
why was `True` made the default?



---

archive/issue_comments_334003.json:
```json
{
    "body": "May be it was useful for the original contributors ?\n\nWe can certainly change that, possibly with a deprecation for the change of default value.",
    "created_at": "2022-08-20T14:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23857",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23857#issuecomment-334003",
    "user": "https://github.com/dcoudert"
}
```

May be it was useful for the original contributors ?

We can certainly change that, possibly with a deprecation for the change of default value.
