# Issue 23867: Fix SciPy lil_matrix() with Sage Integers

archive/issues_023630.json:
```json
{
    "body": "Since the upgrade to SciPy 0.19.1, this is broken:\n\n```\nsage: from scipy.sparse import lil_matrix\nsage: lil_matrix((100,100))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-63750b5b39bc> in <module>()\n----> 1 lil_matrix((Integer(100),Integer(100)))\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/scipy/sparse/lil.py in __init__(self, arg1, shape, dtype, copy)\n    112                     self.data[i] = []\n    113             else:\n--> 114                 raise TypeError('unrecognized lil_matrix constructor usage')\n    115         else:\n    116             # assume A is dense\n\nTypeError: unrecognized lil_matrix constructor usage\n```\n\n**Upstream**:\n1. https://github.com/scipy/scipy/pull/7864\n2. https://github.com/numpy/numpy/pull/9691\n\nCC:  @zimmermann6\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nBranch: 854f588f90b22fc1d1452a9e9d81b0ee8595b649\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23867\n\n",
    "closed_at": "2017-09-20T22:26:23Z",
    "created_at": "2017-09-15T11:01:13Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fix SciPy lil_matrix() with Sage Integers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23867",
    "user": "https://github.com/jdemeyer"
}
```
Since the upgrade to SciPy 0.19.1, this is broken:

```
sage: from scipy.sparse import lil_matrix
sage: lil_matrix((100,100))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-63750b5b39bc> in <module>()
----> 1 lil_matrix((Integer(100),Integer(100)))

/usr/local/src/sage-config/local/lib/python2.7/site-packages/scipy/sparse/lil.py in __init__(self, arg1, shape, dtype, copy)
    112                     self.data[i] = []
    113             else:
--> 114                 raise TypeError('unrecognized lil_matrix constructor usage')
    115         else:
    116             # assume A is dense

TypeError: unrecognized lil_matrix constructor usage
```

**Upstream**:
1. https://github.com/scipy/scipy/pull/7864
2. https://github.com/numpy/numpy/pull/9691

CC:  @zimmermann6

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Branch: 854f588f90b22fc1d1452a9e9d81b0ee8595b649

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23867





---

archive/issue_comments_450400.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/fix_scipy_lil_matrix___with_sage_integers\"",
    "created_at": "2017-09-15T11:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450400",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/fix_scipy_lil_matrix___with_sage_integers"



---

archive/issue_comments_450401.json:
```json
{
    "body": "Changing commit from \"\" to \"854f588f90b22fc1d1452a9e9d81b0ee8595b649\"",
    "created_at": "2017-09-15T11:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450401",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "854f588f90b22fc1d1452a9e9d81b0ee8595b649"



---

archive/issue_comments_450402.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2017-09-15T11:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450402",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_450403.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-15T11:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450403",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450404.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2017-09-15T11:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450404",
    "user": "https://github.com/jdemeyer"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_450405.json:
```json
{
    "body": "<a id='comment:5'></a>is that a temporary fix, waiting for the numpy/scipy issue to be fixed, and that will be removed afterwards?",
    "created_at": "2017-09-15T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450405",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>is that a temporary fix, waiting for the numpy/scipy issue to be fixed, and that will be removed afterwards?



---

archive/issue_comments_450406.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [zimmerma](#comment%3A5):\n> is that a temporary fix, waiting for the numpy/scipy issue to be fixed, and that will be removed afterwards?\n\n\nYes, exactly.",
    "created_at": "2017-09-15T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450406",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [zimmerma](#comment%3A5):
> is that a temporary fix, waiting for the numpy/scipy issue to be fixed, and that will be removed afterwards?


Yes, exactly.



---

archive/issue_comments_450407.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\"",
    "created_at": "2017-09-15T19:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450407",
    "user": "https://github.com/jdemeyer"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug."



---

archive/issue_comments_450408.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-09-16T12:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450408",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_450409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,5 @@\n ```\n \n **Upstream**:\n-1. https://github.com/scipy/scipy/issues/7860\n+1. https://github.com/scipy/scipy/pull/7864\n 2. https://github.com/numpy/numpy/pull/9691\n``````\n",
    "created_at": "2017-09-16T14:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450409",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,5 @@
 ```
 
 **Upstream**:
-1. https://github.com/scipy/scipy/issues/7860
+1. https://github.com/scipy/scipy/pull/7864
 2. https://github.com/numpy/numpy/pull/9691
``````




---

archive/issue_comments_450410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-16T14:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450410",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_450411.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-09-16T14:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450411",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_450412.json:
```json
{
    "body": "<a id='comment:10'></a>Upstream has essentially accepted the PR, and everything else LGTM.",
    "created_at": "2017-09-16T14:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450412",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Upstream has essentially accepted the PR, and everything else LGTM.



---

archive/issue_comments_450413.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/fix_scipy_lil_matrix___with_sage_integers\" to \"854f588f90b22fc1d1452a9e9d81b0ee8595b649\"",
    "created_at": "2017-09-20T22:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450413",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/fix_scipy_lil_matrix___with_sage_integers" to "854f588f90b22fc1d1452a9e9d81b0ee8595b649"



---

archive/issue_events_060789.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-20T22:26:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23867#event-60789"
}
```



---

archive/issue_comments_450414.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450414",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_450415.json:
```json
{
    "body": "Changing commit from \"854f588f90b22fc1d1452a9e9d81b0ee8595b649\" to \"\"",
    "created_at": "2017-09-21T08:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450415",
    "user": "https://github.com/zimmermann6"
}
```

Changing commit from "854f588f90b22fc1d1452a9e9d81b0ee8595b649" to ""



---

archive/issue_comments_450416.json:
```json
{
    "body": "<a id='comment:12'></a>just a question: since this is a temporary fix, is there a way to ensure we don't forget to revert it when the issue is fixed upstream?",
    "created_at": "2017-09-21T08:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450416",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>just a question: since this is a temporary fix, is there a way to ensure we don't forget to revert it when the issue is fixed upstream?



---

archive/issue_comments_450417.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [zimmerma](#comment%3A12):\n> just a question: since this is a temporary fix, is there a way to ensure we don't forget to revert it when the issue is fixed upstream?\n\n\nIf `numpy` accepts the Sage patch, we will notice that the Sage patch to `numpy` no longer applies when we upgrade `numpy`.",
    "created_at": "2017-09-21T08:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23867#issuecomment-450417",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [zimmerma](#comment%3A12):
> just a question: since this is a temporary fix, is there a way to ensure we don't forget to revert it when the issue is fixed upstream?


If `numpy` accepts the Sage patch, we will notice that the Sage patch to `numpy` no longer applies when we upgrade `numpy`.
