# Issue 23871: Assorted doctest failures due to optional packages

archive/issues_023634.json:
```json
{
    "body": "The following tests fail on ubuntu 16.04 with all optional packages returned by `optional_packages()` except `gmp igraph libtheora mpfrcx python_igraph`\ninstalled. To be concrete this means:\n\n4ti2 atlas autotools beautifulsoup benzene biopython bliss boost brian buckygen cbc ccache cmake coxeter3 cryptominisat csdp d3js database_cremona_ellcurve database_gap database_jones_numfield database_kohel database_mutation_class database_odlyzko_zeta database_pari database_stein_watkins database_stein_watkins_mini database_symbolic_data deformation dot2tex frobby gambit gap_jupyter gap_packages gdb giacpy_sage git_trac gmpy2 gp2c guppy latte_int libbraiding libhomfly libogg lidia lrslib mcqd meataxe mercurial mpi4py mpir nibabel normaliz nose notedown openssl ore_algebra pandoc_attributes pandocfilters pari_jupyter plantri pybtex pyflakes pynormaliz pyopenssl pysingular python2 pyx qepcad qhull rst2ipynb saclib scons singular_jupyter sip sirocco sqlalchemy tdlib termcap tides topcom trac\n\nNote that on this system all test passed before installing the optional packages.\n\nI also installed the pip package `service_modules` using:\n\n```\nsage --pip install service_modules\n```\nsince this greatly reduced the amount of failures.\n\nMost of the errors were due to a failed installation of database_gap and gap_packages and could be solved using:\n\n\n```\nsage -f database_gap\nsage -f gap_packages\n```\n\nThen here are failing doctest due to the documentation not building. This can be solved by\n\n```\napt-get graphviz\n```\n\nThe doctests failures in\n\n```\nsage -t --long src/sage/tests/cmdline.py  # 5 doctests failed\n```\ncan be solved by\n\n```\napt-get pandoc\n```\nThis leaves us with:\n\n```\nsage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\nsage -t --long src/sage/rings/integer.pyx  # 1 doctest failed\n```\nwhich was caused by gmp being picked up.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23871\n\n",
    "closed_at": "2017-10-05T14:12:00Z",
    "created_at": "2017-09-15T18:53:28Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Assorted doctest failures due to optional packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23871",
    "user": "https://github.com/koffie"
}
```
The following tests fail on ubuntu 16.04 with all optional packages returned by `optional_packages()` except `gmp igraph libtheora mpfrcx python_igraph`
installed. To be concrete this means:

4ti2 atlas autotools beautifulsoup benzene biopython bliss boost brian buckygen cbc ccache cmake coxeter3 cryptominisat csdp d3js database_cremona_ellcurve database_gap database_jones_numfield database_kohel database_mutation_class database_odlyzko_zeta database_pari database_stein_watkins database_stein_watkins_mini database_symbolic_data deformation dot2tex frobby gambit gap_jupyter gap_packages gdb giacpy_sage git_trac gmpy2 gp2c guppy latte_int libbraiding libhomfly libogg lidia lrslib mcqd meataxe mercurial mpi4py mpir nibabel normaliz nose notedown openssl ore_algebra pandoc_attributes pandocfilters pari_jupyter plantri pybtex pyflakes pynormaliz pyopenssl pysingular python2 pyx qepcad qhull rst2ipynb saclib scons singular_jupyter sip sirocco sqlalchemy tdlib termcap tides topcom trac

Note that on this system all test passed before installing the optional packages.

I also installed the pip package `service_modules` using:

```
sage --pip install service_modules
```
since this greatly reduced the amount of failures.

Most of the errors were due to a failed installation of database_gap and gap_packages and could be solved using:


```
sage -f database_gap
sage -f gap_packages
```

Then here are failing doctest due to the documentation not building. This can be solved by

```
apt-get graphviz
```

The doctests failures in

```
sage -t --long src/sage/tests/cmdline.py  # 5 doctests failed
```
can be solved by

```
apt-get pandoc
```
This leaves us with:

```
sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed
```
which was caused by gmp being picked up.

Issue created by migration from https://trac.sagemath.org/ticket/23871





---

archive/issue_comments_330634.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to misc.",
    "created_at": "2017-09-15T18:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330634",
    "user": "https://github.com/koffie"
}
```

Changing component from PLEASE CHANGE to misc.



---

archive/issue_comments_330635.json:
```json
{
    "body": "Replying to [ticket:23871 mderickx]:\n> The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`\n\n\nInstead of listing the packages which are not installed, can you instead list the packages which are installed?",
    "created_at": "2017-09-15T19:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330635",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23871 mderickx]:
> The following tests fail on ubuntu 16.04 with all optional packages except `gmp igraph libtheora mpfrcx python_igraph`


Instead of listing the packages which are not installed, can you instead list the packages which are installed?



---

archive/issue_comments_330636.json:
```json
{
    "body": "Do you also have which package you installed when you first saw a failure?",
    "created_at": "2017-09-15T19:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330636",
    "user": "https://github.com/tscrim"
}
```

Do you also have which package you installed when you first saw a failure?



---

archive/issue_comments_330637.json:
```json
{
    "body": "Ok I added a list of all the optional packages installed. I do not have a list of when I first saw a failure since this was obtained by first installing as many packages as possible and then running all the tests. An automated script for doctesting in between each install would be nice indeed. I'll try to see if I can set that up and run it only on the above files. I created this ticket as an overview so that we at least know what is wrong. I certainly plan on working on making it more refined.",
    "created_at": "2017-09-15T19:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330637",
    "user": "https://github.com/koffie"
}
```

Ok I added a list of all the optional packages installed. I do not have a list of when I first saw a failure since this was obtained by first installing as many packages as possible and then running all the tests. An automated script for doctesting in between each install would be nice indeed. I'll try to see if I can set that up and run it only on the above files. I created this ticket as an overview so that we at least know what is wrong. I certainly plan on working on making it more refined.



---

archive/issue_comments_330638.json:
```json
{
    "body": "Would you mind posting the details of at least one failure? Given the number of packages there may be multiple sources but you have to start somewhere.",
    "created_at": "2017-09-15T20:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330638",
    "user": "https://github.com/kiwifb"
}
```

Would you mind posting the details of at least one failure? Given the number of packages there may be multiple sources but you have to start somewhere.



---

archive/issue_comments_330639.json:
```json
{
    "body": "There are multiple failures there that should be caused by gap_packages\n\n```\nsage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py\nsage -t --long --warn-long 46.3 src/sage/coding/guava.py\n```\npossibly a couple of others. I would have thought this particular package was well tested. I am wondering if there is a bad interaction with something else.\n\nI would like to know the details of\n\n```\nsage -t --long --warn-long 46.3 src/sage/rings/integer.pyx\nsage -t --long --warn-long 46.3 src/sage/ext/memory.pyx\n```\nthat couple is suspicious in that it would imply gmp which you said you didn't install. I wonder if it was pulled by something else.",
    "created_at": "2017-09-15T20:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330639",
    "user": "https://github.com/kiwifb"
}
```

There are multiple failures there that should be caused by gap_packages

```
sage -t --long --warn-long 46.3 src/sage/tests/gap_packages.py
sage -t --long --warn-long 46.3 src/sage/coding/guava.py
```
possibly a couple of others. I would have thought this particular package was well tested. I am wondering if there is a bad interaction with something else.

I would like to know the details of

```
sage -t --long --warn-long 46.3 src/sage/rings/integer.pyx
sage -t --long --warn-long 46.3 src/sage/ext/memory.pyx
```
that couple is suspicious in that it would imply gmp which you said you didn't install. I wonder if it was pulled by something else.



---

archive/issue_comments_330640.json:
```json
{
    "body": "Hi Francios,\n\nThank you for pointing at gmp. I did have gmp installed in the same sage install, but then later did \n\n```\nsage -i mpir\n```\nwhich removed gmp from the installed packages list returned by `installed_packages()`. Could this be the cause?",
    "created_at": "2017-09-15T21:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330640",
    "user": "https://github.com/koffie"
}
```

Hi Francios,

Thank you for pointing at gmp. I did have gmp installed in the same sage install, but then later did 

```
sage -i mpir
```
which removed gmp from the installed packages list returned by `installed_packages()`. Could this be the cause?



---

archive/issue_comments_330641.json:
```json
{
    "body": "Could be something funny happening there. Typically gmp will lead to this\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\nFailed example:\n    1 << (2^60)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate ... bytes   \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer._shift_helper[8]>\", line 1, in <module>\n        Integer(1) << (Integer(2)**Integer(60))\n      File \"sage/rings/integer.pyx\", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)\n        return (<Integer>x)._shift_helper(y, 1)\n      File \"sage/rings/integer.pyx\", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)\n        sig_on()\n    RuntimeError: Aborted\n```\nand\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx\", line 9, in sage.ext.memory\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes  \nGot:\n    gmp: overflow in mpz type\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"sage/rings/integer.pyx\", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)\n        sig_on()\n    RuntimeError: Aborted\n```",
    "created_at": "2017-09-15T22:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330641",
    "user": "https://github.com/kiwifb"
}
```

Could be something funny happening there. Typically gmp will lead to this

```
File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
Failed example:
    1 << (2^60)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate ... bytes   
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer._shift_helper[8]>", line 1, in <module>
        Integer(1) << (Integer(2)**Integer(60))
      File "sage/rings/integer.pyx", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)
        return (<Integer>x)._shift_helper(y, 1)
      File "sage/rings/integer.pyx", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)
        sig_on()
    RuntimeError: Aborted
```
and

```
File "/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx", line 9, in sage.ext.memory
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes  
Got:
    gmp: overflow in mpz type
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.ext.memory[0]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "sage/rings/integer.pyx", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)
        sig_on()
    RuntimeError: Aborted
```



---

archive/issue_comments_330642.json:
```json
{
    "body": "I just did:\n\n```\nsage -f database_gap\nsage -f gap_packages\n```\n\nand this fixed almost all of the failures. For some reason something went wrong with these two packages.",
    "created_at": "2017-09-15T22:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330642",
    "user": "https://github.com/koffie"
}
```

I just did:

```
sage -f database_gap
sage -f gap_packages
```

and this fixed almost all of the failures. For some reason something went wrong with these two packages.



---

archive/issue_comments_330643.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> Could be something funny happening there. Typically gmp will lead to this\n> \n> ```\n> File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> ...\n>     RuntimeError: Aborted\n> ```\n> \n> \n\nThese two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?",
    "created_at": "2017-09-15T22:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330643",
    "user": "https://github.com/koffie"
}
```

Replying to [comment:11 fbissey]:
> Could be something funny happening there. Typically gmp will lead to this
> 
> ```
> File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> ...
>     RuntimeError: Aborted
> ```
> 
> 

These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?



---

archive/issue_comments_330644.json:
```json
{
    "body": "Replying to [comment:14 mderickx]:\n> Replying to [comment:11 fbissey]:\n> > Could be something funny happening there. Typically gmp will lead to this\n> > \n> > ```\n> > File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> > ...\n> >     RuntimeError: Aborted\n> > ```\n> > \n> > \n\n> These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?\n\nYes, possibly in a won't fix state though. These are differences in error messages between mpir and gmp. We are more or less living with them. They are well know of sage-on-distro people since we all use gmp for \"reasons\" (including sanity).",
    "created_at": "2017-09-15T22:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330644",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:14 mderickx]:
> Replying to [comment:11 fbissey]:
> > Could be something funny happening there. Typically gmp will lead to this
> > 
> > ```
> > File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> > ...
> >     RuntimeError: Aborted
> > ```
> > 
> > 

> These two errors were exactly the two errors I got. So I guess that settles this. Is there a ticket for those?

Yes, possibly in a won't fix state though. These are differences in error messages between mpir and gmp. We are more or less living with them. They are well know of sage-on-distro people since we all use gmp for "reasons" (including sanity).



---

archive/issue_comments_330645.json:
```json
{
    "body": "I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?",
    "created_at": "2017-09-15T22:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330645",
    "user": "https://github.com/kiwifb"
}
```

I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?



---

archive/issue_comments_330646.json:
```json
{
    "body": "Replying to [comment:16 fbissey]:\n> I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?\n\n\nSorry the detail is gone by subsequent doctests. A lot of the messages were saying that I should install database_gap or gap_packages, which I already had installed. I want to try to make this entire build again from a clean sage install and see if I can reproduce the errors. This will take some time though.\n\nIn the meanwhile a lot of thanks for helping figuring all the errors out. This was a great help in reliably installing a lot of optional packages at the same time.",
    "created_at": "2017-09-15T23:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330646",
    "user": "https://github.com/koffie"
}
```

Replying to [comment:16 fbissey]:
> I am not shocked by the outcome of the gap stuff. Although I must say I wouldn't have known for a few of those. Now that you have a single test failing, can we have details?


Sorry the detail is gone by subsequent doctests. A lot of the messages were saying that I should install database_gap or gap_packages, which I already had installed. I want to try to make this entire build again from a clean sage install and see if I can reproduce the errors. This will take some time though.

In the meanwhile a lot of thanks for helping figuring all the errors out. This was a great help in reliably installing a lot of optional packages at the same time.



---

archive/issue_comments_330647.json:
```json
{
    "body": "On my `sage4` patchbot, I also saw the whole bunch of failures that Maarten initially posted on this ticket. So there must be a real issue here. Since there are a lot of `MemoryError` in the failed tests, this is almost certainly due to #23748. So there must be some optional package which has high memory usage (possibly even if it's not actually used). This could very well be `gap_packages` but then I do not understand why reinstalling `gap_packages` would help.\n\nMy strategy is now to install those packages one by one and run a few selected doctests every time to see which package is responsible for which failures.",
    "created_at": "2017-09-16T07:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330647",
    "user": "https://github.com/jdemeyer"
}
```

On my `sage4` patchbot, I also saw the whole bunch of failures that Maarten initially posted on this ticket. So there must be a real issue here. Since there are a lot of `MemoryError` in the failed tests, this is almost certainly due to #23748. So there must be some optional package which has high memory usage (possibly even if it's not actually used). This could very well be `gap_packages` but then I do not understand why reinstalling `gap_packages` would help.

My strategy is now to install those packages one by one and run a few selected doctests every time to see which package is responsible for which failures.



---

archive/issue_comments_330648.json:
```json
{
    "body": "At least some of the failures are caused by `cbc`.",
    "created_at": "2017-09-16T11:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330648",
    "user": "https://github.com/jdemeyer"
}
```

At least some of the failures are caused by `cbc`.



---

archive/issue_comments_330649.json:
```json
{
    "body": "Is cbc failing as in #22006 or is it something else?",
    "created_at": "2017-09-16T12:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330649",
    "user": "https://github.com/koffie"
}
```

Is cbc failing as in #22006 or is it something else?



---

archive/issue_comments_330650.json:
```json
{
    "body": "No, I don't mean #22006. I mean some of the failures that you originally posted in the ticket description (and which are not there anymore).",
    "created_at": "2017-09-16T19:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330650",
    "user": "https://github.com/jdemeyer"
}
```

No, I don't mean #22006. I mean some of the failures that you originally posted in the ticket description (and which are not there anymore).



---

archive/issue_comments_330651.json:
```json
{
    "body": "Replying to [ticket:23871 mderickx]:\n> This leaves us with:\n> \n> ```\n> sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\n> sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed\n> ```\n> which was caused by gmp being picked up.\n\n\nDetails please. What do you mean with \"caused by gmp being picked up\"? The Sage package `gmp` is not in your list of optional packages.",
    "created_at": "2017-09-18T10:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330651",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23871 mderickx]:
> This leaves us with:
> 
> ```
> sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
> sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed
> ```
> which was caused by gmp being picked up.


Details please. What do you mean with "caused by gmp being picked up"? The Sage package `gmp` is not in your list of optional packages.



---

archive/issue_comments_330652.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> Replying to [ticket:23871 mderickx]:\n> > This leaves us with:\n> > \n> > ```\n> > sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed\n> > sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed\n> > ```\n> > which was caused by gmp being picked up.\n\n> \n> Details please. What do you mean with \"caused by gmp being picked up\"? The Sage package `gmp` is not in your list of optional packages.\n\n\nSee #23871#comment:9",
    "created_at": "2017-09-18T10:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330652",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:24 jdemeyer]:
> Replying to [ticket:23871 mderickx]:
> > This leaves us with:
> > 
> > ```
> > sage -t --long src/sage/ext/memory.pyx  # 1 doctest failed
> > sage -t --long src/sage/rings/integer.pyx  # 1 doctest failed
> > ```
> > which was caused by gmp being picked up.

> 
> Details please. What do you mean with "caused by gmp being picked up"? The Sage package `gmp` is not in your list of optional packages.


See #23871#comment:9



---

archive/issue_comments_330653.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> Could be something funny happening there. Typically gmp will lead to this\n> \n> ```\n> File \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 6099, in sage.rings.integer.Integer._shift_helper\n> Failed example:\n>     1 << (2^60)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     MemoryError: failed to allocate ... bytes   \n> Got:\n>     gmp: overflow in mpz type\n>     Traceback (most recent call last):\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.rings.integer.Integer._shift_helper[8]>\", line 1, in <module>\n>         Integer(1) << (Integer(2)**Integer(60))\n>       File \"sage/rings/integer.pyx\", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)\n>         return (<Integer>x)._shift_helper(y, 1)\n>       File \"sage/rings/integer.pyx\", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)\n>         sig_on()\n>     RuntimeError: Aborted\n> ```\n> and\n> \n> ```\n> File \"/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx\", line 9, in sage.ext.memory\n> Failed example:\n>     2^(2^63-2)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     MemoryError: failed to allocate 1152921504606847008 bytes  \n> Got:\n>     gmp: overflow in mpz type\n>     Traceback (most recent call last):\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.ext.memory[0]>\", line 1, in <module>\n>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n>       File \"sage/rings/integer.pyx\", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)\n>         sig_on()\n>     RuntimeError: Aborted\n> ```\n\n\nI assume that this is with GMP 6 on Gentoo, right? Because Sage still ships GMP 5.1.3 (see #19706).",
    "created_at": "2017-09-18T10:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330653",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 fbissey]:
> Could be something funny happening there. Typically gmp will lead to this
> 
> ```
> File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 6099, in sage.rings.integer.Integer._shift_helper
> Failed example:
>     1 << (2^60)
> Expected:
>     Traceback (most recent call last):
>     ...
>     MemoryError: failed to allocate ... bytes   
> Got:
>     gmp: overflow in mpz type
>     Traceback (most recent call last):
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.rings.integer.Integer._shift_helper[8]>", line 1, in <module>
>         Integer(1) << (Integer(2)**Integer(60))
>       File "sage/rings/integer.pyx", line 6177, in sage.rings.integer.Integer.__lshift__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39280)
>         return (<Integer>x)._shift_helper(y, 1)
>       File "sage/rings/integer.pyx", line 6138, in sage.rings.integer.Integer._shift_helper (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:39024)
>         sig_on()
>     RuntimeError: Aborted
> ```
> and
> 
> ```
> File "/usr/lib64/python2.7/site-packages/sage/ext/memory.pyx", line 9, in sage.ext.memory
> Failed example:
>     2^(2^63-2)
> Expected:
>     Traceback (most recent call last):
>     ...
>     MemoryError: failed to allocate 1152921504606847008 bytes  
> Got:
>     gmp: overflow in mpz type
>     Traceback (most recent call last):
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.ext.memory[0]>", line 1, in <module>
>         Integer(2)**(Integer(2)**Integer(63)-Integer(2))
>       File "sage/rings/integer.pyx", line 2067, in sage.rings.integer.Integer.__pow__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:14183)
>         sig_on()
>     RuntimeError: Aborted
> ```


I assume that this is with GMP 6 on Gentoo, right? Because Sage still ships GMP 5.1.3 (see #19706).



---

archive/issue_comments_330654.json:
```json
{
    "body": "As far as I remember both `GMP` 5 and 6 will give you that message. While on the subject, the problem that stopped #19706 have now gone so we could finish it off.",
    "created_at": "2017-09-18T10:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330654",
    "user": "https://github.com/kiwifb"
}
```

As far as I remember both `GMP` 5 and 6 will give you that message. While on the subject, the problem that stopped #19706 have now gone so we could finish it off.



---

archive/issue_comments_330655.json:
```json
{
    "body": "#23713 should deal with `cbc` and `cryptominisat`",
    "created_at": "2017-10-05T10:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330655",
    "user": "https://github.com/jdemeyer"
}
```

#23713 should deal with `cbc` and `cryptominisat`



---

archive/issue_events_060793.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-10-05T11:39:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23871#event-60793"
}
```



---

archive/issue_comments_330656.json:
```json
{
    "body": "Thanks, I think this ticket can be closed as duplicate since the issues turned out to be flukes or are fixed by other tickets.",
    "created_at": "2017-10-05T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330656",
    "user": "https://github.com/koffie"
}
```

Thanks, I think this ticket can be closed as duplicate since the issues turned out to be flukes or are fixed by other tickets.



---

archive/issue_comments_330657.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-05T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330657",
    "user": "https://github.com/koffie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330658.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-05T12:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330658",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_060794.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2017-10-05T14:12:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23871#event-60794"
}
```



---

archive/issue_comments_330659.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2017-10-05T14:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330659",
    "user": "https://github.com/koffie"
}
```

Resolution: duplicate



---

archive/issue_comments_330660.json:
```json
{
    "body": "I believe that I have now created a blocker ticket for each of the issues that I could reproduce on a particular x86_64 Linux system.\n\nI could not reproduce the issue with `gap_packages` and `database_gap`: I have no idea what went wrong there. Nor could I reproduce the issue with `pandoc`, but that's probably because `pandoc` is actually installed on the system where I tested it.",
    "created_at": "2017-10-07T14:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330660",
    "user": "https://github.com/jdemeyer"
}
```

I believe that I have now created a blocker ticket for each of the issues that I could reproduce on a particular x86_64 Linux system.

I could not reproduce the issue with `gap_packages` and `database_gap`: I have no idea what went wrong there. Nor could I reproduce the issue with `pandoc`, but that's probably because `pandoc` is actually installed on the system where I tested it.



---

archive/issue_comments_330661.json:
```json
{
    "body": "I should also add that I tested *all* optional and pip packages except for `gmp`, `atlas` and `mpi4py`. So I included a few packages that you omitted.",
    "created_at": "2017-10-07T14:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330661",
    "user": "https://github.com/jdemeyer"
}
```

I should also add that I tested *all* optional and pip packages except for `gmp`, `atlas` and `mpi4py`. So I included a few packages that you omitted.



---

archive/issue_comments_330662.json:
```json
{
    "body": "Hi Jeroen thanks for putting so much energy in these optional packages,\n\nI recreated the pandoc problem and created #23985 for this with a clear traceback and explanation of why it occurs. I think the `gap_packages` and `database_gap` errors can be regarded as a mistake in installing all these optional packages from my side, because I cannot reproduce it either on the machine where it went wrong.",
    "created_at": "2017-10-07T18:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23871#issuecomment-330662",
    "user": "https://github.com/koffie"
}
```

Hi Jeroen thanks for putting so much energy in these optional packages,

I recreated the pandoc problem and created #23985 for this with a clear traceback and explanation of why it occurs. I think the `gap_packages` and `database_gap` errors can be regarded as a mistake in installing all these optional packages from my side, because I cannot reproduce it either on the machine where it went wrong.
