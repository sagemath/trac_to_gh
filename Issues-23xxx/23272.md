# Issue 23272: OpenBLAS - alterations for TARGET

archive/issues_023035.json:
```json
{
    "body": "On purchasing a new laptop, I attempted to MAKE sage as I normally have and ran into the following error:\n\n```\nError building Sage. \n\nThe following package(s) may have failed to build (not necessarily during this run of 'make all'):\n\n* package: openblas-0.2.19.p0 \n  log file: /sage/sage/logs/pkgs/openblas-0.2.19.p0.log\n  build directory: /sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0\n```\n\nThe error seemed to be really coming from:\n\n```\nmake[3]: *** [getarch_2nd] Error 1\nMakefile:123: *** OpenBLAS: Detecting CPU failed. Please set TARGET explicitly, e.g. make TARGET=your_cpu_target. Please read README for the detail..  Stop.\nmake[3]: Leaving directory '/sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/src'\nError building OpenBLAS\n```\n\n\nIt turned out that this error has been seen multiple times in Sage:\n* https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I\n* https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo\n* https://groups.google.com/d/msg/sage-devel/FhPQS_R_CTA/g-yQFXXzAgAJ\n* https://groups.google.com/d/msg/sage-devel/-Exvx0bane8/9kC8hBEFBwAJ\n* https://groups.google.com/d/msg/sage-devel/JtDS2kHafAA/DWdHpWPxAgAJ\n\netc.\n\nI noticed that updating the config (as mentioned in the threads above) accurately solved the problem, but I wanted to try and fix the problem head on rather than just temporarily solve it. With that in mind, I conversed with the OpenBLAS people:\nhttps://github.com/xianyi/OpenBLAS/issues/1204\nand they suggested I update the cpu file for the build, which I have included.\n\nAdditionally, I wanted to fix this problem for future users and thus I wanted to add a fail-safe for the code so that if this error happens again, then we automatically try the TARGET=ATOM method. But, I want to create this with the caveat that a user can change the method.\n\n\n\nBefore finalizing these changes, we should note a few things, but as I've not worked that long with sage I don't know how to address them. In essence:\n\n- Are the changes I made appropriate for the make?\n- I'm adding documentation on this as there is no documentation.\n- There was questions on why we have \"p0\" at the end of our version? I assume this is from the patch, but I don't know. \n- The programmer suggested we change the \" top level option to use -lblas (debian/ubuntu) -lopenblas (suse/fedora/epel)\". I don't know what that means in regards to us, but figured someone might be able to answer this question and maybe we can ensure this is happening.\n\nIf there are any questions feel free to ask, and if you believe this is not necessarily or if something else is better practice, let me know. I've never done a bash alteration so not sure what the details for that.\n\nThe tarball is here https://github.com/xianyi/OpenBLAS/archive/v0.2.20.tar.gz\n(using the browser to download it will give it correct name)\n\n**CC:**  jpflori @vbraun @jdemeyer @mo271\n\n**Keywords:** openblas\n\n**Branch:** [895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)\n\n**Reviewer:** Volker Braun, Dima Pasechnik\n\n**Author:** Aram Dermenjian\n\nIssue created by migration from https://trac.sagemath.org/ticket/23272\n\n",
    "closed_at": "2017-11-15T01:24:30Z",
    "created_at": "2017-06-18T18:17:08Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "OpenBLAS - alterations for TARGET",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23272",
    "user": "https://github.com/thecaligarmo"
}
```
On purchasing a new laptop, I attempted to MAKE sage as I normally have and ran into the following error:

```
Error building Sage. 

The following package(s) may have failed to build (not necessarily during this run of 'make all'):

* package: openblas-0.2.19.p0 
  log file: /sage/sage/logs/pkgs/openblas-0.2.19.p0.log
  build directory: /sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0
```

The error seemed to be really coming from:

```
make[3]: *** [getarch_2nd] Error 1
Makefile:123: *** OpenBLAS: Detecting CPU failed. Please set TARGET explicitly, e.g. make TARGET=your_cpu_target. Please read README for the detail..  Stop.
make[3]: Leaving directory '/sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/src'
Error building OpenBLAS
```


It turned out that this error has been seen multiple times in Sage:
* https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I
* https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo
* https://groups.google.com/d/msg/sage-devel/FhPQS_R_CTA/g-yQFXXzAgAJ
* https://groups.google.com/d/msg/sage-devel/-Exvx0bane8/9kC8hBEFBwAJ
* https://groups.google.com/d/msg/sage-devel/JtDS2kHafAA/DWdHpWPxAgAJ

etc.

I noticed that updating the config (as mentioned in the threads above) accurately solved the problem, but I wanted to try and fix the problem head on rather than just temporarily solve it. With that in mind, I conversed with the OpenBLAS people:
https://github.com/xianyi/OpenBLAS/issues/1204
and they suggested I update the cpu file for the build, which I have included.

Additionally, I wanted to fix this problem for future users and thus I wanted to add a fail-safe for the code so that if this error happens again, then we automatically try the TARGET=ATOM method. But, I want to create this with the caveat that a user can change the method.



Before finalizing these changes, we should note a few things, but as I've not worked that long with sage I don't know how to address them. In essence:

- Are the changes I made appropriate for the make?
- I'm adding documentation on this as there is no documentation.
- There was questions on why we have "p0" at the end of our version? I assume this is from the patch, but I don't know. 
- The programmer suggested we change the " top level option to use -lblas (debian/ubuntu) -lopenblas (suse/fedora/epel)". I don't know what that means in regards to us, but figured someone might be able to answer this question and maybe we can ensure this is happening.

If there are any questions feel free to ask, and if you believe this is not necessarily or if something else is better practice, let me know. I've never done a bash alteration so not sure what the details for that.

The tarball is here https://github.com/xianyi/OpenBLAS/archive/v0.2.20.tar.gz
(using the browser to download it will give it correct name)

**CC:**  jpflori @vbraun @jdemeyer @mo271

**Keywords:** openblas

**Branch:** [895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)

**Reviewer:** Volker Braun, Dima Pasechnik

**Author:** Aram Dermenjian

Issue created by migration from https://trac.sagemath.org/ticket/23272





---

archive/issue_comments_418474.json:
```json
{
    "body": "**Branch:** [u/aram.dermenjian/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/u/aram.dermenjian/openblas___alterations_for_target)",
    "created_at": "2017-06-18T18:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418474",
    "user": "https://github.com/thecaligarmo"
}
```

**Branch:** [u/aram.dermenjian/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/u/aram.dermenjian/openblas___alterations_for_target)



---

archive/issue_comments_418475.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ce1ab81c405128adc7a862fa602040a9648923b\">9ce1ab8</a></td><td><code>OpenBLAS changes for CPUs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5d2e424afef8a97f37ef01196fd3c3b2a4ccc80\">d5d2e42</a></td><td><code>Update trac tags</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e\">56a64c1</a></td><td><code>Merge branch 'openblas' into t/23272/openblas___alterations_for_target</code></td></tr></table>\n",
    "created_at": "2017-06-18T18:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418475",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ce1ab81c405128adc7a862fa602040a9648923b">9ce1ab8</a></td><td><code>OpenBLAS changes for CPUs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5d2e424afef8a97f37ef01196fd3c3b2a4ccc80">d5d2e42</a></td><td><code>Update trac tags</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e">56a64c1</a></td><td><code>Merge branch 'openblas' into t/23272/openblas___alterations_for_target</code></td></tr></table>




---

archive/issue_comments_418476.json:
```json
{
    "body": "**Author:** Aram Dermenjian",
    "created_at": "2017-06-18T18:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418476",
    "user": "https://github.com/thecaligarmo"
}
```

**Author:** Aram Dermenjian



---

archive/issue_comments_418477.json:
```json
{
    "body": "**Commit:** [56a64c1d6eb081d714b0ab9630f33708a6ade34e](https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e)",
    "created_at": "2017-06-18T18:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418477",
    "user": "https://github.com/thecaligarmo"
}
```

**Commit:** [56a64c1d6eb081d714b0ab9630f33708a6ade34e](https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e)



---

archive/issue_comments_418478.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-06-18T18:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418478",
    "user": "https://github.com/thecaligarmo"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_418479.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm setting the status to needs review mainly to get people's attention. I assume there will be things that need to be changed.",
    "created_at": "2017-06-18T18:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418479",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:3'></a>
I'm setting the status to needs review mainly to get people's attention. I assume there will be things that need to be changed.



---

archive/issue_comments_418480.json:
```json
{
    "body": "<a id='comment:5'></a>\nWe discussed a bit. In the long run, we would like OpenBlas to provide a short mantra\nto configure itself with \"use Atom by default if target unavailable\".\n\nFor now, I wondered about separating somewhat more the configuration part from the compilation, by adding a new dependency in OpenBlas makefile like:\n\n```\n    is_architecture_available:\n         <here the logic from the beginning of the `libs` dependency\n```\n\nand then, in spkg-install / spkg-check do first a call to\n\n```\n    make is_architecture_available\n```\ndo the additional logic if needed, and then just call make as usual.\n\nJust throwing ideas in the air; not sure this is the right thing to do.\n\nInsights anyone?",
    "created_at": "2017-06-22T21:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418480",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:5'></a>
We discussed a bit. In the long run, we would like OpenBlas to provide a short mantra
to configure itself with "use Atom by default if target unavailable".

For now, I wondered about separating somewhat more the configuration part from the compilation, by adding a new dependency in OpenBlas makefile like:

```
    is_architecture_available:
         <here the logic from the beginning of the `libs` dependency
```

and then, in spkg-install / spkg-check do first a call to

```
    make is_architecture_available
```
do the additional logic if needed, and then just call make as usual.

Just throwing ideas in the air; not sure this is the right thing to do.

Insights anyone?



---

archive/issue_comments_418481.json:
```json
{
    "body": "<a id='comment:6'></a>\nI don't really like that we are just guessing `ATOM` as a fall-back when the build failed. I would prefer to just let the failed build be failed (possibly with an error message suggesting `OPENBLAS_CONFIGURE=\"TARGET=ATOM\"` or something).\n\nAlso, if you add a patch, you should bump the version number of openblas (from `0.2.19` to `0.2.19.p0`).",
    "created_at": "2017-06-30T14:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418481",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
I don't really like that we are just guessing `ATOM` as a fall-back when the build failed. I would prefer to just let the failed build be failed (possibly with an error message suggesting `OPENBLAS_CONFIGURE="TARGET=ATOM"` or something).

Also, if you add a patch, you should bump the version number of openblas (from `0.2.19` to `0.2.19.p0`).



---

archive/issue_comments_418482.json:
```json
{
    "body": "**Changing commit** from \"[56a64c1d6eb081d714b0ab9630f33708a6ade34e](https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e)\" to \"[4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7](https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7)\".",
    "created_at": "2017-07-14T11:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[56a64c1d6eb081d714b0ab9630f33708a6ade34e](https://github.com/sagemath/sagetrac-mirror/commit/56a64c1d6eb081d714b0ab9630f33708a6ade34e)" to "[4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7](https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7)".



---

archive/issue_comments_418483.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7\">4be16f3</a></td><td><code>Check directly that Target is needed</code></td></tr></table>\n",
    "created_at": "2017-07-14T11:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7">4be16f3</a></td><td><code>Check directly that Target is needed</code></td></tr></table>




---

archive/issue_comments_418484.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7\">4be16f3</a></td><td><code>Check directly that Target is needed</code></td></tr></table>\n",
    "created_at": "2017-07-14T11:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418484",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7">4be16f3</a></td><td><code>Check directly that Target is needed</code></td></tr></table>




---

archive/issue_comments_418485.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,8 +23,11 @@\n \n \n It turned out that this error has been seen multiple times in Sage:\n-https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I\n-https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo\n+* https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I\n+* https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo\n+* https://groups.google.com/d/msg/sage-devel/FhPQS_R_CTA/g-yQFXXzAgAJ\n+* https://groups.google.com/d/msg/sage-devel/-Exvx0bane8/9kC8hBEFBwAJ\n+* https://groups.google.com/d/msg/sage-devel/JtDS2kHafAA/DWdHpWPxAgAJ\n \n etc.\n \n``````\n",
    "created_at": "2017-07-14T11:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418485",
    "user": "https://github.com/thecaligarmo"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,8 +23,11 @@
 
 
 It turned out that this error has been seen multiple times in Sage:
-https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I
-https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo
+* https://groups.google.com/forum/#!topic/sage-devel/zQsZsivts0I
+* https://groups.google.com/forum/#!topic/sage-release/3QJoAgg9bgo
+* https://groups.google.com/d/msg/sage-devel/FhPQS_R_CTA/g-yQFXXzAgAJ
+* https://groups.google.com/d/msg/sage-devel/-Exvx0bane8/9kC8hBEFBwAJ
+* https://groups.google.com/d/msg/sage-devel/JtDS2kHafAA/DWdHpWPxAgAJ
 
 etc.
 
``````




---

archive/issue_comments_418486.json:
```json
{
    "body": "<a id='comment:9'></a>\nSo the reason we are just guessing \"ATOM\" is because that was the recommended fall-back by the openblas team. (You can see the conversation I had in the link I posted)\n\nTHe problem with just letting the build fail is that as new computers come out with new CPUs these CPUs will not be included in the openblas config which tests against CPU. In other words all future computers will start having problems when new CPUs get introduced. Since OpenBLAS doesn't update regularly, we can't rely on us to \"remember\" every time a new CPU gets released.\n\nThe point of this ticket is to upgrade the openblas script through a patch so that new CPUs that have been added in the last year will now properly be able to get a target. Additionally, it will protect us for future CPUs by defaulting to ATOM until we get an update to OpenBLAS.\n\nNote that the version is already `0.2.19.p0` so I've let it as is.",
    "created_at": "2017-07-14T11:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418486",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:9'></a>
So the reason we are just guessing "ATOM" is because that was the recommended fall-back by the openblas team. (You can see the conversation I had in the link I posted)

THe problem with just letting the build fail is that as new computers come out with new CPUs these CPUs will not be included in the openblas config which tests against CPU. In other words all future computers will start having problems when new CPUs get introduced. Since OpenBLAS doesn't update regularly, we can't rely on us to "remember" every time a new CPU gets released.

The point of this ticket is to upgrade the openblas script through a patch so that new CPUs that have been added in the last year will now properly be able to get a target. Additionally, it will protect us for future CPUs by defaulting to ATOM until we get an update to OpenBLAS.

Note that the version is already `0.2.19.p0` so I've let it as is.



---

archive/issue_comments_418487.json:
```json
{
    "body": "<a id='comment:10'></a>\nTypo: OpenBAS -> OpenBLAS\n\nI agree that it would be best if OpenBLAS would just default to something sensible if it can't detect the CPU. But, unless thats implemented, we should just try a second time with TARGET=ATOM. I'd prefer if we just unconditionally try that a second time and not rely on the spelling of the logged error message, or the location of the log file.\n\nOpenBLAS 0.2.20 should be released really soon now...",
    "created_at": "2017-07-22T15:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418487",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
Typo: OpenBAS -> OpenBLAS

I agree that it would be best if OpenBLAS would just default to something sensible if it can't detect the CPU. But, unless thats implemented, we should just try a second time with TARGET=ATOM. I'd prefer if we just unconditionally try that a second time and not rely on the spelling of the logged error message, or the location of the log file.

OpenBLAS 0.2.20 should be released really soon now...



---

archive/issue_comments_418488.json:
```json
{
    "body": "<a id='comment:11'></a>\nPS: the patchlevel should be increased 0.2.19.p0 -> 0.2.19.p1 to trigger recompilation.",
    "created_at": "2017-07-22T15:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418488",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
PS: the patchlevel should be increased 0.2.19.p0 -> 0.2.19.p1 to trigger recompilation.



---

archive/issue_comments_418489.json:
```json
{
    "body": "<a id='comment:12'></a>\nI just received a notice that openblas 0.2.20 has been released\n\n```\nVersion 0.2.20\n\n24-Jul-2017\n\n\n\ncommon:\n\n        * Improved CMake support\n\n        * Fixed several thread race and locking bugs\n\n        * Fixed default LAPACK optimization level\n\n        * Updated LAPACK to 3.7.0\n\n        * Added ReLAPACK (https://github.com/HPAC/ReLAPACK, make BUILD_RELAPACK=1)\n\n\n\nPOWER:\n\n        * Optimizations for Power9\n\n        * Fixed several Power8 assembly bugs\n\n....\nx86_64:\n\n        * Detect Intel Bay Trail and Apollo Lake\n\n        * Detect Intel Sky Lake and Kaby Lake\n\n        * Detect Intel Knights Landing\n\n        * Detect AMD A8, A10, A12 and Ryzen\n\n        * Support 64bit builds with Visual Studio\n\n        * Fix building with Intel and PGI compilers\n\n        * Fix building with MINGW and TDM-GCC\n\n        * Fix cmake builds for Haswell and related cpus\n\n        * Fix building for Sandybridge with CLANG 3.9\n\n* Add support for the FLANG compiler\n\n....\n```\nWhile some of the improvements in this ticket should be kept, I think it would be best if it became an upgrade ticket.",
    "created_at": "2017-07-24T04:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418489",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
I just received a notice that openblas 0.2.20 has been released

```
Version 0.2.20

24-Jul-2017



common:

        * Improved CMake support

        * Fixed several thread race and locking bugs

        * Fixed default LAPACK optimization level

        * Updated LAPACK to 3.7.0

        * Added ReLAPACK (https://github.com/HPAC/ReLAPACK, make BUILD_RELAPACK=1)



POWER:

        * Optimizations for Power9

        * Fixed several Power8 assembly bugs

....
x86_64:

        * Detect Intel Bay Trail and Apollo Lake

        * Detect Intel Sky Lake and Kaby Lake

        * Detect Intel Knights Landing

        * Detect AMD A8, A10, A12 and Ryzen

        * Support 64bit builds with Visual Studio

        * Fix building with Intel and PGI compilers

        * Fix building with MINGW and TDM-GCC

        * Fix cmake builds for Haswell and related cpus

        * Fix building for Sandybridge with CLANG 3.9

* Add support for the FLANG compiler

....
```
While some of the improvements in this ticket should be kept, I think it would be best if it became an upgrade ticket.



---

archive/issue_comments_418490.json:
```json
{
    "body": "<a id='comment:13'></a>\nUpgrading should also get rid of us of all the current patches except for `openblas-0.2.19-SMP_conditional.patch` (because the PR for it is still sitting on my HD - real life happened and it got forgotten).",
    "created_at": "2017-07-24T05:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418490",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Upgrading should also get rid of us of all the current patches except for `openblas-0.2.19-SMP_conditional.patch` (because the PR for it is still sitting on my HD - real life happened and it got forgotten).



---

archive/issue_comments_418491.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,8 +37,7 @@\n \n Additionally, I wanted to fix this problem for future users and thus I wanted to add a fail-safe for the code so that if this error happens again, then we automatically try the TARGET=ATOM method. But, I want to create this with the caveat that a user can change the method.\n \n-Something to note: There is no planned update to OpenBLAS as the project lead has disappeared apparently:\n-https://github.com/xianyi/OpenBLAS/issues/1118\n+\n \n Before finalizing these changes, we should note a few things, but as I've not worked that long with sage I don't know how to address them. In essence:\n \n``````\n",
    "created_at": "2017-07-24T11:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418491",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,8 +37,7 @@
 
 Additionally, I wanted to fix this problem for future users and thus I wanted to add a fail-safe for the code so that if this error happens again, then we automatically try the TARGET=ATOM method. But, I want to create this with the caveat that a user can change the method.
 
-Something to note: There is no planned update to OpenBLAS as the project lead has disappeared apparently:
-https://github.com/xianyi/OpenBLAS/issues/1118
+
 
 Before finalizing these changes, we should note a few things, but as I've not worked that long with sage I don't know how to address them. In essence:
 
``````




---

archive/issue_comments_418492.json:
```json
{
    "body": "<a id='comment:14'></a>\nalive and kicking: https://github.com/xianyi/OpenBLAS/commits/develop",
    "created_at": "2017-07-24T11:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418492",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
alive and kicking: https://github.com/xianyi/OpenBLAS/commits/develop



---

archive/issue_comments_418493.json:
```json
{
    "body": "<a id='comment:15'></a>\n\n```\nif grep -q \"Detecting CPU failed. Please set TARGET explicitly\" \"${SAGE_ROOT}/logs/pkgs/openblas-$(<${SAGE_ROOT}/build/pkgs/openblas/package-version.txt).log\"; then\n```\n\nThis isn't going to work for a number reasons; for one the log files are usually appended to so this will be true for builds that failed but then later succeeded if the log files were not deleted first.\n\nBetter to explicitly tee the configure command to a separate log file and grep that.",
    "created_at": "2017-07-31T11:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418493",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>

```
if grep -q "Detecting CPU failed. Please set TARGET explicitly" "${SAGE_ROOT}/logs/pkgs/openblas-$(<${SAGE_ROOT}/build/pkgs/openblas/package-version.txt).log"; then
```

This isn't going to work for a number reasons; for one the log files are usually appended to so this will be true for builds that failed but then later succeeded if the log files were not deleted first.

Better to explicitly tee the configure command to a separate log file and grep that.



---

archive/issue_comments_418494.json:
```json
{
    "body": "**Changing commit** from \"[4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7](https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7)\" to \"[842607822d1501c2d6d0dbca9d3aa2cf750ec25d](https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d)\".",
    "created_at": "2017-08-10T14:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7](https://github.com/sagemath/sagetrac-mirror/commit/4be16f32aa2ad1b89dd6bc868b415f83c0f0e6b7)" to "[842607822d1501c2d6d0dbca9d3aa2cf750ec25d](https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d)".



---

archive/issue_comments_418495.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90e56c80614a126cebbb543a57f14c64728a1905\">90e56c8</a></td><td><code>Update OpenBLAS package and update install error handling</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39094e39774466cf2e240151e2418479948fdde9\">39094e3</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d758c5861c5e24c63c1e06b5946512bb92fa739\">5d758c5</a></td><td><code>Remove unused envar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d\">8426078</a></td><td><code>Typo fix</code></td></tr></table>\n",
    "created_at": "2017-08-10T14:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90e56c80614a126cebbb543a57f14c64728a1905">90e56c8</a></td><td><code>Update OpenBLAS package and update install error handling</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39094e39774466cf2e240151e2418479948fdde9">39094e3</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d758c5861c5e24c63c1e06b5946512bb92fa739">5d758c5</a></td><td><code>Remove unused envar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d">8426078</a></td><td><code>Typo fix</code></td></tr></table>




---

archive/issue_comments_418496.json:
```json
{
    "body": "<a id='comment:17'></a>\nSo in this update I've gone ahead and updated the version and removed the unnecessary patches (keeping the one mentioned by fbissey). I've not worked with packages before so I don't know how I'm supposed to actually get the package itself onto the servers? I personally added it directly into my personal upstream, but not sure if that is a viable solution?\n\nI've also removed the documentation test and instead went with a TARGET test like I had done before. I've gone to my old method of just retrying with \"TARGET=ATOM\" as was also suggested by vbraun.",
    "created_at": "2017-08-10T14:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418496",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:17'></a>
So in this update I've gone ahead and updated the version and removed the unnecessary patches (keeping the one mentioned by fbissey). I've not worked with packages before so I don't know how I'm supposed to actually get the package itself onto the servers? I personally added it directly into my personal upstream, but not sure if that is a viable solution?

I've also removed the documentation test and instead went with a TARGET test like I had done before. I've gone to my old method of just retrying with "TARGET=ATOM" as was also suggested by vbraun.



---

archive/issue_comments_418497.json:
```json
{
    "body": "<a id='comment:18'></a>\nWhere is the updated tarball (the one with\n\n```\n+sha1=a186074145a24823e82c65672dad1cd1ca6fe89c\n+md5=48637eb29f5b492b91459175dcc574b1\n+cksum=607023019\n```\nHow does one get it?\nPlease provide a link.",
    "created_at": "2017-08-17T09:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418497",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Where is the updated tarball (the one with

```
+sha1=a186074145a24823e82c65672dad1cd1ca6fe89c
+md5=48637eb29f5b492b91459175dcc574b1
+cksum=607023019
```
How does one get it?
Please provide a link.



---

archive/issue_comments_418498.json:
```json
{
    "body": "<a id='comment:19'></a>\nOnce the ticket is positively reviewed and merged, a copy of the tarball will be put on sagemath mirrors by the release manager.",
    "created_at": "2017-08-17T09:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418498",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Once the ticket is positively reviewed and merged, a copy of the tarball will be put on sagemath mirrors by the release manager.



---

archive/issue_comments_418499.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -47,3 +47,6 @@\n - The programmer suggested we change the \" top level option to use -lblas (debian/ubuntu) -lopenblas (suse/fedora/epel)\". I don't know what that means in regards to us, but figured someone might be able to answer this question and maybe we can ensure this is happening.\n \n If there are any questions feel free to ask, and if you believe this is not necessarily or if something else is better practice, let me know. I've never done a bash alteration so not sure what the details for that.\n+\n+The tarball is here https://github.com/xianyi/OpenBLAS/archive/v0.2.20.tar.gz\n+(using the browser to download it will give it correct name)\n``````\n",
    "created_at": "2017-08-17T09:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418499",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -47,3 +47,6 @@
 - The programmer suggested we change the " top level option to use -lblas (debian/ubuntu) -lopenblas (suse/fedora/epel)". I don't know what that means in regards to us, but figured someone might be able to answer this question and maybe we can ensure this is happening.
 
 If there are any questions feel free to ask, and if you believe this is not necessarily or if something else is better practice, let me know. I've never done a bash alteration so not sure what the details for that.
+
+The tarball is here https://github.com/xianyi/OpenBLAS/archive/v0.2.20.tar.gz
+(using the browser to download it will give it correct name)
``````




---

archive/issue_comments_418500.json:
```json
{
    "body": "<a id='comment:20'></a>\nOK, I gather it's the official openblas release tarball (md5sum is right). I've modified the ticket description accordingly.",
    "created_at": "2017-08-17T09:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
OK, I gather it's the official openblas release tarball (md5sum is right). I've modified the ticket description accordingly.



---

archive/issue_comments_418501.json:
```json
{
    "body": "<a id='comment:21'></a>\nYou might want to wait till 0.2.21. See https://github.com/xianyi/OpenBLAS/issues/1258#issuecomment-320223121",
    "created_at": "2017-08-17T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418501",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:21'></a>
You might want to wait till 0.2.21. See https://github.com/xianyi/OpenBLAS/issues/1258#issuecomment-320223121



---

archive/issue_comments_418502.json:
```json
{
    "body": "<a id='comment:22'></a>\nRelease seems to be tardy. Possibly because they were moving to a 0.3.0 release. We could adopt https://github.com/xianyi/OpenBLAS/commit/63cfa32691680505e6b9daf0997755178ddd3144 instead.",
    "created_at": "2017-08-20T23:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418502",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
Release seems to be tardy. Possibly because they were moving to a 0.3.0 release. We could adopt https://github.com/xianyi/OpenBLAS/commit/63cfa32691680505e6b9daf0997755178ddd3144 instead.



---

archive/issue_comments_418503.json:
```json
{
    "body": "<a id='comment:23'></a>\n@dimpase Yes, that was the correct one.\n\n@isuruf @kiwifb Thanks for the update. I think we might want to consider their release 0.2.21 branch (https://github.com/xianyi/OpenBLAS/tree/release-0.2.21) as it seems to include exactly the patches that are needed to fix the issue that is discussed in Issue 1258 of OpenBLAS (https://github.com/xianyi/OpenBLAS/issues/1258#issuecomment-320223121). I'm going to respond on the issue thread they have there. We'll see if they have any updates. I don't think they are waiting for 0.3.0 release as that issue was created after they had started talking about 0.3.0. So I don't believe that to be the case.",
    "created_at": "2017-08-23T01:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418503",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:23'></a>
@dimpase Yes, that was the correct one.

@isuruf @kiwifb Thanks for the update. I think we might want to consider their release 0.2.21 branch (https://github.com/xianyi/OpenBLAS/tree/release-0.2.21) as it seems to include exactly the patches that are needed to fix the issue that is discussed in Issue 1258 of OpenBLAS (https://github.com/xianyi/OpenBLAS/issues/1258#issuecomment-320223121). I'm going to respond on the issue thread they have there. We'll see if they have any updates. I don't think they are waiting for 0.3.0 release as that issue was created after they had started talking about 0.3.0. So I don't believe that to be the case.



---

archive/issue_comments_418504.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689\">341cec9</a></td><td><code>Patch up error created in v0.2.20</code></td></tr></table>\n",
    "created_at": "2017-09-01T19:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689">341cec9</a></td><td><code>Patch up error created in v0.2.20</code></td></tr></table>




---

archive/issue_comments_418505.json:
```json
{
    "body": "**Changing commit** from \"[842607822d1501c2d6d0dbca9d3aa2cf750ec25d](https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d)\" to \"[341cec9afa8cbb8204a545b1d556ad1f45fef689](https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689)\".",
    "created_at": "2017-09-01T19:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[842607822d1501c2d6d0dbca9d3aa2cf750ec25d](https://github.com/sagemath/sagetrac-mirror/commit/842607822d1501c2d6d0dbca9d3aa2cf750ec25d)" to "[341cec9afa8cbb8204a545b1d556ad1f45fef689](https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689)".



---

archive/issue_comments_418506.json:
```json
{
    "body": "<a id='comment:25'></a>\nOk, so according to the authors, v0.2.21 is likely not going to be coming out soon and that the only change is one patch which was added to master. Instead of rezipping everything, I've decided to just add this patch into our patches directory and upload that directly.\n\nEverything is working on my end and this ticket is now ready for review.",
    "created_at": "2017-09-01T19:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418506",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:25'></a>
Ok, so according to the authors, v0.2.21 is likely not going to be coming out soon and that the only change is one patch which was added to master. Instead of rezipping everything, I've decided to just add this patch into our patches directory and upload that directly.

Everything is working on my end and this ticket is now ready for review.



---

archive/issue_comments_418507.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6\">3831e40</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr></table>\n",
    "created_at": "2017-09-01T19:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418507",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6">3831e40</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr></table>




---

archive/issue_comments_418508.json:
```json
{
    "body": "**Changing commit** from \"[341cec9afa8cbb8204a545b1d556ad1f45fef689](https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689)\" to \"[3831e40be64aadb9773fb0e35a569c54c0268ec6](https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6)\".",
    "created_at": "2017-09-01T19:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418508",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[341cec9afa8cbb8204a545b1d556ad1f45fef689](https://github.com/sagemath/sagetrac-mirror/commit/341cec9afa8cbb8204a545b1d556ad1f45fef689)" to "[3831e40be64aadb9773fb0e35a569c54c0268ec6](https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6)".



---

archive/issue_comments_418509.json:
```json
{
    "body": "<a id='comment:27'></a>\nI think this needs updating for openblas-0.2.19-cygwin.patch",
    "created_at": "2017-09-28T12:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418509",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
I think this needs updating for openblas-0.2.19-cygwin.patch



---

archive/issue_comments_418510.json:
```json
{
    "body": "<a id='comment:28'></a>\nI had removed all of the patches except for one. If the cygwin patch is required I can re-add it in.",
    "created_at": "2017-09-28T13:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418510",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:28'></a>
I had removed all of the patches except for one. If the cygwin patch is required I can re-add it in.



---

archive/issue_comments_418511.json:
```json
{
    "body": "<a id='comment:29'></a>\nIt was recently added; please merge in the latest beta",
    "created_at": "2017-09-28T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418511",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
It was recently added; please merge in the latest beta



---

archive/issue_comments_418512.json:
```json
{
    "body": "<a id='comment:30'></a>\n@vbraun I don't know what you mean by the latest beta. Can you be a little more specific? (Do you have a link? I can try mergeing it in and making sure it works. Alternatively, if you've already access to the beta on your machine you can try integrating it and then I can pull and test it on mine as well?)",
    "created_at": "2017-09-28T19:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418512",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:30'></a>
@vbraun I don't know what you mean by the latest beta. Can you be a little more specific? (Do you have a link? I can try mergeing it in and making sure it works. Alternatively, if you've already access to the beta on your machine you can try integrating it and then I can pull and test it on mine as well?)



---

archive/issue_comments_418513.json:
```json
{
    "body": "<a id='comment:31'></a>\nI just mean the latest develop branch, e.g. on trac: `git remote update trac && git merge trac/develop`",
    "created_at": "2017-09-29T06:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418513",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
I just mean the latest develop branch, e.g. on trac: `git remote update trac && git merge trac/develop`



---

archive/issue_comments_418514.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c760406e4c5ef205c59bdfbe212fb9f14cda952\">4c76040</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d405e43f751f23a7383999c245d513007c7fc32\">5d405e4</a></td><td><code>update cygwin patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71\">2298700</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr></table>\n",
    "created_at": "2017-10-04T17:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418514",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c760406e4c5ef205c59bdfbe212fb9f14cda952">4c76040</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d405e43f751f23a7383999c245d513007c7fc32">5d405e4</a></td><td><code>update cygwin patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71">2298700</a></td><td><code>Merge branch 'develop' into t/23272/openblas___alterations_for_target</code></td></tr></table>




---

archive/issue_comments_418515.json:
```json
{
    "body": "**Changing commit** from \"[3831e40be64aadb9773fb0e35a569c54c0268ec6](https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6)\" to \"[229870046dfac171c0df30131ff18bb3440b4f71](https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71)\".",
    "created_at": "2017-10-04T17:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3831e40be64aadb9773fb0e35a569c54c0268ec6](https://github.com/sagemath/sagetrac-mirror/commit/3831e40be64aadb9773fb0e35a569c54c0268ec6)" to "[229870046dfac171c0df30131ff18bb3440b4f71](https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71)".



---

archive/issue_comments_418516.json:
```json
{
    "body": "<a id='comment:33'></a>\nI kept having problems merging in the cygwin patch (kept failing on my build for some reason) I fixed it and have merged again with the latest develop. It should be ready for testing now.",
    "created_at": "2017-10-04T17:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418516",
    "user": "https://github.com/thecaligarmo"
}
```

<a id='comment:33'></a>
I kept having problems merging in the cygwin patch (kept failing on my build for some reason) I fixed it and have merged again with the latest develop. It should be ready for testing now.



---

archive/issue_comments_418517.json:
```json
{
    "body": "<a id='comment:34'></a>\nI don't have much time to look into the ticket, but just wanted to confirm, that it worked for me.\n\nsage 8.1.beta7 didn't compile on a debian box with a kaby lake i7-7500U CPU, because of the 'missing target' openblas error. \n\nAfter loading this patch it worked like a charm (All tests passed). I guess it is useful to have a fix even after the problem for my specific cpu will be fixed upstream; there always will be newer cpus...",
    "created_at": "2017-10-12T20:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418517",
    "user": "https://github.com/mo271"
}
```

<a id='comment:34'></a>
I don't have much time to look into the ticket, but just wanted to confirm, that it worked for me.

sage 8.1.beta7 didn't compile on a debian box with a kaby lake i7-7500U CPU, because of the 'missing target' openblas error. 

After loading this patch it worked like a charm (All tests passed). I guess it is useful to have a fix even after the problem for my specific cpu will be fixed upstream; there always will be newer cpus...



---

archive/issue_comments_418518.json:
```json
{
    "body": "<a id='comment:35'></a>\nIn sage 8.1.beta8, I simply compiled with\n`export OPENBLAS_CONFIGURE=\"TARGET=HASWELL\"`\n(with a kabylake CPU..) seems to work.",
    "created_at": "2017-10-17T17:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418518",
    "user": "https://github.com/mo271"
}
```

<a id='comment:35'></a>
In sage 8.1.beta8, I simply compiled with
`export OPENBLAS_CONFIGURE="TARGET=HASWELL"`
(with a kabylake CPU..) seems to work.



---

archive/issue_comments_418519.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-11-06T21:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418519",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_418520.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2017-11-06T21:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418520",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_418521.json:
```json
{
    "body": "<a id='comment:37'></a>\nOn two 32-bit buildbots:\n\n```\n**********************************************************************\nFile \"src/sage/numerical/sdp.pyx\", line 100, in sage.numerical.sdp\nFailed example:\n    p.dual_variable(1)  # rel tol 1e-03\nExpected:\n    [ 85555.0 -85555.0]\n    [-85555.0  85555.0]\nGot:\n    [ 85463.87196917446 -85463.87196914306]\n    [-85463.87196914306  85463.87196917432]\nTolerance exceeded in 4 of 4:\n    85555.0 vs 85463.87196917446, tolerance 1e-03 > 1e-03\n    -85555.0 vs -85463.87196914306, tolerance 1e-03 > 1e-03\n    -85555.0 vs -85463.87196914306, tolerance 1e-03 > 1e-03\n    85555.0 vs 85463.87196917432, tolerance 1e-03 > 1e-03\n**********************************************************************\n1 item had failures:\n   1 of  41 in sage.numerical.sdp\n    [283 tests, 1 failure, 0.75 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/numerical/sdp.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2017-11-08T19:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418521",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>
On two 32-bit buildbots:

```
**********************************************************************
File "src/sage/numerical/sdp.pyx", line 100, in sage.numerical.sdp
Failed example:
    p.dual_variable(1)  # rel tol 1e-03
Expected:
    [ 85555.0 -85555.0]
    [-85555.0  85555.0]
Got:
    [ 85463.87196917446 -85463.87196914306]
    [-85463.87196914306  85463.87196917432]
Tolerance exceeded in 4 of 4:
    85555.0 vs 85463.87196917446, tolerance 1e-03 > 1e-03
    -85555.0 vs -85463.87196914306, tolerance 1e-03 > 1e-03
    -85555.0 vs -85463.87196914306, tolerance 1e-03 > 1e-03
    85555.0 vs 85463.87196917432, tolerance 1e-03 > 1e-03
**********************************************************************
1 item had failures:
   1 of  41 in sage.numerical.sdp
    [283 tests, 1 failure, 0.75 s]
----------------------------------------------------------------------
sage -t --long src/sage/numerical/sdp.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_418522.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-11-08T19:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418522",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_418523.json:
```json
{
    "body": "<a id='comment:39'></a>\nOK, I'll increase the tolerance to 2e-03 there.",
    "created_at": "2017-11-08T22:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418523",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>
OK, I'll increase the tolerance to 2e-03 there.



---

archive/issue_comments_418524.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-11-08T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418524",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_418525.json:
```json
{
    "body": "**Changing branch** from \"[u/aram.dermenjian/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/u/aram.dermenjian/openblas___alterations_for_target)\" to \"[public/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/public/openblas___alterations_for_target)\".",
    "created_at": "2017-11-08T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418525",
    "user": "https://github.com/dimpase"
}
```

**Changing branch** from "[u/aram.dermenjian/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/u/aram.dermenjian/openblas___alterations_for_target)" to "[public/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/public/openblas___alterations_for_target)".



---

archive/issue_comments_418526.json:
```json
{
    "body": "**Changing commit** from \"[229870046dfac171c0df30131ff18bb3440b4f71](https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71)\" to \"[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)\".",
    "created_at": "2017-11-08T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418526",
    "user": "https://github.com/dimpase"
}
```

**Changing commit** from "[229870046dfac171c0df30131ff18bb3440b4f71](https://github.com/sagemath/sagetrac-mirror/commit/229870046dfac171c0df30131ff18bb3440b4f71)" to "[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)".



---

archive/issue_comments_418527.json:
```json
{
    "body": "**Changing reviewer** from \"Volker Braun\" to \"Volker Braun, Dima Pasechnik\".",
    "created_at": "2017-11-08T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418527",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Volker Braun" to "Volker Braun, Dima Pasechnik".



---

archive/issue_comments_418528.json:
```json
{
    "body": "<a id='comment:40'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0af8f5b0efbf6059af99f9476c089ee73c1c2bb2\">0af8f5b</a></td><td><code>Merge branch 'u/aram.dermenjian/openblas___alterations_for_target' of trac.sagemath.org:sage into oblas</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64\">895b48f</a></td><td><code>increase tol</code></td></tr></table>\n",
    "created_at": "2017-11-08T22:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418528",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0af8f5b0efbf6059af99f9476c089ee73c1c2bb2">0af8f5b</a></td><td><code>Merge branch 'u/aram.dermenjian/openblas___alterations_for_target' of trac.sagemath.org:sage into oblas</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64">895b48f</a></td><td><code>increase tol</code></td></tr></table>




---

archive/issue_comments_418529.json:
```json
{
    "body": "<a id='comment:41'></a>\nThis fixed the build under error I was having on Ubuntu 17.10. The /proc/cpuinfo identifies the CPU as:\n\nIntel(R) Core(TM) i7-7500U CPU @ 2.70GHz",
    "created_at": "2017-11-13T01:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418529",
    "user": "https://trac.sagemath.org/admin/accounts/users/andy"
}
```

<a id='comment:41'></a>
This fixed the build under error I was having on Ubuntu 17.10. The /proc/cpuinfo identifies the CPU as:

Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz



---

archive/issue_comments_418530.json:
```json
{
    "body": "**Changing branch** from \"[public/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/public/openblas___alterations_for_target)\" to \"[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)\".",
    "created_at": "2017-11-15T01:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418530",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/openblas___alterations_for_target](https://github.com/sagemath/sagetrac-mirror/tree/public/openblas___alterations_for_target)" to "[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)".



---

archive/issue_events_067837.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-15T01:24:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23272#event-67837"
}
```



---

archive/issue_comments_418531.json:
```json
{
    "body": "**Changing commit** from \"[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)\" to \"\".",
    "created_at": "2017-11-18T22:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418531",
    "user": "https://github.com/slel"
}
```

**Changing commit** from "[895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64](https://github.com/sagemath/sagetrac-mirror/commit/895b48f4c3ed7ebee36f6ffe4ee8d804e7e47d64)" to "".



---

archive/issue_comments_418532.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,6 @@\n On purchasing a new laptop, I attempted to MAKE sage as I normally have and ran into the following error:\n \n-\n ```\n-\n Error building Sage. \n \n The following package(s) may have failed to build (not necessarily during this run of 'make all'):\n@@ -14,12 +12,12 @@\n \n The error seemed to be really coming from:\n \n-{{{                                               ^\n+```\n make[3]: *** [getarch_2nd] Error 1\n Makefile:123: *** OpenBLAS: Detecting CPU failed. Please set TARGET explicitly, e.g. make TARGET=your_cpu_target. Please read README for the detail..  Stop.\n make[3]: Leaving directory '/sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/src'\n Error building OpenBLAS\n-}}}\n+```\n \n \n It turned out that this error has been seen multiple times in Sage:\n``````\n",
    "created_at": "2017-11-18T22:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418532",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,6 @@
 On purchasing a new laptop, I attempted to MAKE sage as I normally have and ran into the following error:
 
-
 ```
-
 Error building Sage. 
 
 The following package(s) may have failed to build (not necessarily during this run of 'make all'):
@@ -14,12 +12,12 @@
 
 The error seemed to be really coming from:
 
-{{{                                               ^
+```
 make[3]: *** [getarch_2nd] Error 1
 Makefile:123: *** OpenBLAS: Detecting CPU failed. Please set TARGET explicitly, e.g. make TARGET=your_cpu_target. Please read README for the detail..  Stop.
 make[3]: Leaving directory '/sage/sage/local/var/tmp/sage/build/openblas-0.2.19.p0/src'
 Error building OpenBLAS
-}}}
+```
 
 
 It turned out that this error has been seen multiple times in Sage:
``````




---

archive/issue_comments_418533.json:
```json
{
    "body": "<a id='comment:43'></a>\n(Minor fix to ticket description formatting.)",
    "created_at": "2017-11-18T22:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23272#issuecomment-418533",
    "user": "https://github.com/slel"
}
```

<a id='comment:43'></a>
(Minor fix to ticket description formatting.)
