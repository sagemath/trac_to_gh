# Issue 23814: Fix is_preperiodic function domain check

archive/issues_023577.json:
```json
{
    "body": "Currently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point \"is\" the domain of the map will fail, as is_preperiodic currently does:\n\n```python\nsage: R.<X> = PolynomialRing(QQ)\nsage: K.<a> = NumberField(X^2 + X - 1)\nsage: P.<x,y> = ProjectiveSpace(K,1)\nsage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])\nsage: Q = P.point([a,1])\nsage: f.nth_iterate(Q,2) == Q\nTrue\nsage: Q.is_preperiodic(f)\nTraceback (most recent call last):\n...\nTypeError: point must be in domain of map\nsage: f.domain() is P\nFalse\nsage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory\nTrue\n```\nInstead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under \"is\", and then things will work as expected. This fix changes that.\n\nCC:  @bhutz\n\nBranch/Commit: 2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\n\nReviewer: Ben Hutz\n\nAuthor: Paul Fili\n\nDependencies: #23497\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23814\n\n",
    "closed_at": "2017-09-24T13:03:51Z",
    "created_at": "2017-09-09T18:04:05Z",
    "labels": [
        "component: dynamics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fix is_preperiodic function domain check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23814",
    "user": "https://github.com/pfili"
}
```
Currently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point "is" the domain of the map will fail, as is_preperiodic currently does:

```python
sage: R.<X> = PolynomialRing(QQ)
sage: K.<a> = NumberField(X^2 + X - 1)
sage: P.<x,y> = ProjectiveSpace(K,1)
sage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])
sage: Q = P.point([a,1])
sage: f.nth_iterate(Q,2) == Q
True
sage: Q.is_preperiodic(f)
Traceback (most recent call last):
...
TypeError: point must be in domain of map
sage: f.domain() is P
False
sage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory
True
```
Instead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under "is", and then things will work as expected. This fix changes that.

CC:  @bhutz

Branch/Commit: 2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610

Reviewer: Ben Hutz

Author: Paul Fili

Dependencies: #23497

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23814





---

archive/issue_comments_443645.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#23497\"",
    "created_at": "2017-09-09T18:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443645",
    "user": "https://github.com/pfili"
}
```

Changing dependencies from "" to "#23497"



---

archive/issue_comments_443646.json:
```json
{
    "body": "Changing branch from \"\" to \"u/paulfili/preperiodic-fix\"",
    "created_at": "2017-09-09T18:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443646",
    "user": "https://github.com/pfili"
}
```

Changing branch from "" to "u/paulfili/preperiodic-fix"



---

archive/issue_comments_443647.json:
```json
{
    "body": "<a id='comment:3'></a>\nLast 10 new commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[79378c3](https://github.com/sagemath/sagetrac-mirror/commit/79378c30d23f4c3da284272115634e3776ef8c81)|`Merge branch 8.1.beta3 into t/23497/arith_dyn`|\n|[80ff2e6](https://github.com/sagemath/sagetrac-mirror/commit/80ff2e673f93c961618923251d8d3d19786ad015)|`23497: some fixes from review`|\n|[fdf7265](https://github.com/sagemath/sagetrac-mirror/commit/fdf7265fbc471bbf62483e7f6ffbd645bd08393d)|`23497: doc formatting INPUT/OUTPUT`|\n|[cc50108](https://github.com/sagemath/sagetrac-mirror/commit/cc50108eb32d1fc33d030cc128eecbf6747d67a9)|`23497: use __classcall_private__`|\n|[4bbdcde](https://github.com/sagemath/sagetrac-mirror/commit/4bbdcdebe2e1b603345d8a0cf46b8148be732e82)|`Fixing things with __classcall_private__.`|\n|[7408d79](https://github.com/sagemath/sagetrac-mirror/commit/7408d79a2c8833d0c496cc32a3755f1405bc2151)|`Cleaning up the doc and improving the code.`|\n|[d00cea2](https://github.com/sagemath/sagetrac-mirror/commit/d00cea258b3b5797ca06ddd33ac55bf4e6ae701c)|`23497: a couple minor fixes`|\n|[300a3b1](https://github.com/sagemath/sagetrac-mirror/commit/300a3b1fe5773b7983736cbbed23ed13c15e20b7)|`Merge branch 8.1.beta4 into t/23497/arith_dyn-23497`|\n|[bdbf658](https://github.com/sagemath/sagetrac-mirror/commit/bdbf658dcbb2005227228a13330d5d4090d33724)|`Fixing typo in doctest.`|\n|[9c3e7cf](https://github.com/sagemath/sagetrac-mirror/commit/9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0)|`Fix domain check for is_preperiodic from \"is\" to \"==\"`|",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443647",
    "user": "https://github.com/pfili"
}
```

<a id='comment:3'></a>
Last 10 new commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[79378c3](https://github.com/sagemath/sagetrac-mirror/commit/79378c30d23f4c3da284272115634e3776ef8c81)|`Merge branch 8.1.beta3 into t/23497/arith_dyn`|
|[80ff2e6](https://github.com/sagemath/sagetrac-mirror/commit/80ff2e673f93c961618923251d8d3d19786ad015)|`23497: some fixes from review`|
|[fdf7265](https://github.com/sagemath/sagetrac-mirror/commit/fdf7265fbc471bbf62483e7f6ffbd645bd08393d)|`23497: doc formatting INPUT/OUTPUT`|
|[cc50108](https://github.com/sagemath/sagetrac-mirror/commit/cc50108eb32d1fc33d030cc128eecbf6747d67a9)|`23497: use __classcall_private__`|
|[4bbdcde](https://github.com/sagemath/sagetrac-mirror/commit/4bbdcdebe2e1b603345d8a0cf46b8148be732e82)|`Fixing things with __classcall_private__.`|
|[7408d79](https://github.com/sagemath/sagetrac-mirror/commit/7408d79a2c8833d0c496cc32a3755f1405bc2151)|`Cleaning up the doc and improving the code.`|
|[d00cea2](https://github.com/sagemath/sagetrac-mirror/commit/d00cea258b3b5797ca06ddd33ac55bf4e6ae701c)|`23497: a couple minor fixes`|
|[300a3b1](https://github.com/sagemath/sagetrac-mirror/commit/300a3b1fe5773b7983736cbbed23ed13c15e20b7)|`Merge branch 8.1.beta4 into t/23497/arith_dyn-23497`|
|[bdbf658](https://github.com/sagemath/sagetrac-mirror/commit/bdbf658dcbb2005227228a13330d5d4090d33724)|`Fixing typo in doctest.`|
|[9c3e7cf](https://github.com/sagemath/sagetrac-mirror/commit/9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0)|`Fix domain check for is_preperiodic from "is" to "=="`|



---

archive/issue_comments_443648.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443648",
    "user": "https://github.com/pfili"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_443649.json:
```json
{
    "body": "Changing commit from \"\" to \"9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0\"",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443649",
    "user": "https://github.com/pfili"
}
```

Changing commit from "" to "9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0"



---

archive/issue_comments_443650.json:
```json
{
    "body": "Changing branch from \"u/paulfili/preperiodic-fix\" to \"u/bhutz/preperiodic-fix\"",
    "created_at": "2017-09-09T18:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443650",
    "user": "https://github.com/bhutz"
}
```

Changing branch from "u/paulfili/preperiodic-fix" to "u/bhutz/preperiodic-fix"



---

archive/issue_comments_443651.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443651",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_443652.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Hutz\"",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443652",
    "user": "https://github.com/bhutz"
}
```

Changing reviewer from "" to "Ben Hutz"



---

archive/issue_comments_443653.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks fine. Just fixed a minor typo.\n\n---\nNew commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[1f1a815](https://github.com/sagemath/sagetrac-mirror/commit/1f1a815d7665b7365b7b663d313b5ac0704b591d)|`23814: minor typo fix`|",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443653",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'></a>
Looks fine. Just fixed a minor typo.

---
New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[1f1a815](https://github.com/sagemath/sagetrac-mirror/commit/1f1a815d7665b7365b7b663d313b5ac0704b591d)|`23814: minor typo fix`|



---

archive/issue_comments_443654.json:
```json
{
    "body": "Changing commit from \"9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0\" to \"1f1a815d7665b7365b7b663d313b5ac0704b591d\"",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443654",
    "user": "https://github.com/bhutz"
}
```

Changing commit from "9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0" to "1f1a815d7665b7365b7b663d313b5ac0704b591d"



---

archive/issue_comments_443655.json:
```json
{
    "body": "<a id='comment:6'></a>\nmerge conflict",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443655",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:6'></a>
merge conflict



---

archive/issue_comments_443656.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443656",
    "user": "https://github.com/bhutz"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_443657.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[2eecc68](https://github.com/sagemath/sagetrac-mirror/commit/2eecc68b05527c59db06daba1bedadc5756e8e05)|`Merge branch 8.1.beta5 into t/23497/arith_dyn-23497`|\n|[2a68ffb](https://github.com/sagemath/sagetrac-mirror/commit/2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610)|`Merge branch 't/23497/arith_dyn-23497' into t/23814/preperiodic-fix`|",
    "created_at": "2017-09-11T23:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[2eecc68](https://github.com/sagemath/sagetrac-mirror/commit/2eecc68b05527c59db06daba1bedadc5756e8e05)|`Merge branch 8.1.beta5 into t/23497/arith_dyn-23497`|
|[2a68ffb](https://github.com/sagemath/sagetrac-mirror/commit/2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610)|`Merge branch 't/23497/arith_dyn-23497' into t/23814/preperiodic-fix`|



---

archive/issue_comments_443658.json:
```json
{
    "body": "Changing commit from \"1f1a815d7665b7365b7b663d313b5ac0704b591d\" to \"2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\"",
    "created_at": "2017-09-11T23:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1f1a815d7665b7365b7b663d313b5ac0704b591d" to "2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610"



---

archive/issue_comments_443659.json:
```json
{
    "body": "<a id='comment:8'></a>\nfixed",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443659",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>
fixed



---

archive/issue_comments_443660.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443660",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_443661.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-18T18:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443661",
    "user": "https://github.com/pfili"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_443662.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-24T13:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443662",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076871.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-24T13:03:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23814#event-76871"
}
```



---

archive/issue_comments_443663.json:
```json
{
    "body": "Changing branch from \"u/bhutz/preperiodic-fix\" to \"2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\"",
    "created_at": "2017-09-24T13:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-443663",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/bhutz/preperiodic-fix" to "2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610"
