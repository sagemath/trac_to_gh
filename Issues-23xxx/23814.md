# Issue 23814: Fix is_preperiodic function domain check

archive/issues_023577.json:
```json
{
    "body": "Currently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point \"is\" the domain of the map will fail, as is_preperiodic currently does:\n\n```python\nsage: R.<X> = PolynomialRing(QQ)\nsage: K.<a> = NumberField(X^2 + X - 1)\nsage: P.<x,y> = ProjectiveSpace(K,1)\nsage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])\nsage: Q = P.point([a,1])\nsage: f.nth_iterate(Q,2) == Q\nTrue\nsage: Q.is_preperiodic(f)\nTraceback (most recent call last):\n...\nTypeError: point must be in domain of map\nsage: f.domain() is P\nFalse\nsage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory\nTrue\n```\nInstead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under \"is\", and then things will work as expected. This fix changes that.\n\nCC:  @bhutz\n\nBranch/Commit: 2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\n\nReviewer: Ben Hutz\n\nAuthor: Paul Fili\n\nDependencies: #23497\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23814\n\n",
    "closed_at": "2017-09-24T13:03:51Z",
    "created_at": "2017-09-09T18:04:05Z",
    "labels": [
        "component: dynamics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fix is_preperiodic function domain check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23814",
    "user": "https://github.com/pfili"
}
```
Currently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point "is" the domain of the map will fail, as is_preperiodic currently does:

```python
sage: R.<X> = PolynomialRing(QQ)
sage: K.<a> = NumberField(X^2 + X - 1)
sage: P.<x,y> = ProjectiveSpace(K,1)
sage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])
sage: Q = P.point([a,1])
sage: f.nth_iterate(Q,2) == Q
True
sage: Q.is_preperiodic(f)
Traceback (most recent call last):
...
TypeError: point must be in domain of map
sage: f.domain() is P
False
sage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory
True
```
Instead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under "is", and then things will work as expected. This fix changes that.

CC:  @bhutz

Branch/Commit: 2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610

Reviewer: Ben Hutz

Author: Paul Fili

Dependencies: #23497

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23814





---

archive/issue_comments_449412.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#23497\"",
    "created_at": "2017-09-09T18:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449412",
    "user": "https://github.com/pfili"
}
```

Changing dependencies from "" to "#23497"



---

archive/issue_comments_449413.json:
```json
{
    "body": "Changing branch from \"\" to \"u/paulfili/preperiodic-fix\"",
    "created_at": "2017-09-09T18:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449413",
    "user": "https://github.com/pfili"
}
```

Changing branch from "" to "u/paulfili/preperiodic-fix"



---

archive/issue_comments_449414.json:
```json
{
    "body": "<a id='comment:3'></a>Last 10 new commits:",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449414",
    "user": "https://github.com/pfili"
}
```

<a id='comment:3'></a>Last 10 new commits:



---

archive/issue_comments_449415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449415",
    "user": "https://github.com/pfili"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449416.json:
```json
{
    "body": "Changing commit from \"\" to \"9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0\"",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449416",
    "user": "https://github.com/pfili"
}
```

Changing commit from "" to "9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0"



---

archive/issue_comments_449417.json:
```json
{
    "body": "Changing branch from \"u/paulfili/preperiodic-fix\" to \"u/bhutz/preperiodic-fix\"",
    "created_at": "2017-09-09T18:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449417",
    "user": "https://github.com/bhutz"
}
```

Changing branch from "u/paulfili/preperiodic-fix" to "u/bhutz/preperiodic-fix"



---

archive/issue_comments_449418.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449418",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449419.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Ben Hutz\"",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449419",
    "user": "https://github.com/bhutz"
}
```

Changing reviewer from "" to "Ben Hutz"



---

archive/issue_comments_449420.json:
```json
{
    "body": "<a id='comment:5'></a>Looks fine. Just fixed a minor typo.\n\n---\nNew commits:",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449420",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'></a>Looks fine. Just fixed a minor typo.

---
New commits:



---

archive/issue_comments_449421.json:
```json
{
    "body": "Changing commit from \"9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0\" to \"1f1a815d7665b7365b7b663d313b5ac0704b591d\"",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449421",
    "user": "https://github.com/bhutz"
}
```

Changing commit from "9c3e7cf8f11ec5088a14f0115d6e8a4287a192c0" to "1f1a815d7665b7365b7b663d313b5ac0704b591d"



---

archive/issue_comments_449422.json:
```json
{
    "body": "<a id='comment:6'></a>merge conflict",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449422",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:6'></a>merge conflict



---

archive/issue_comments_449423.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449423",
    "user": "https://github.com/bhutz"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_449424.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-11T23:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449425.json:
```json
{
    "body": "Changing commit from \"1f1a815d7665b7365b7b663d313b5ac0704b591d\" to \"2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\"",
    "created_at": "2017-09-11T23:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1f1a815d7665b7365b7b663d313b5ac0704b591d" to "2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610"



---

archive/issue_comments_449426.json:
```json
{
    "body": "<a id='comment:8'></a>fixed",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449426",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:8'></a>fixed



---

archive/issue_comments_449427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449427",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449428.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-18T18:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449428",
    "user": "https://github.com/pfili"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449429.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-24T13:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449429",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060716.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-24T13:03:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23814#event-60716"
}
```



---

archive/issue_comments_449430.json:
```json
{
    "body": "Changing branch from \"u/bhutz/preperiodic-fix\" to \"2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610\"",
    "created_at": "2017-09-24T13:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23814#issuecomment-449430",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/bhutz/preperiodic-fix" to "2a68ffbfa56bfb7b09ef266beeb5a2c914c2c610"
