# Issue 23095: autogen/interpreters does NOT work

archive/issues_022858.json:
```json
{
    "body": "After making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.\n\nIn particular, the following should cause an error while building the interpreters, but it did not:\n\n```diff\ndiff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py\nindex 3af99b2..5a3bfbb 100644\n--- a/src/sage_setup/autogen/interpreters/generator.py\n+++ b/src/sage_setup/autogen/interpreters/generator.py\n@@ -316,6 +316,8 @@ class InterpreterGenerator(object):\n             sage: print(buff.getvalue())\n             # Automatically generated by ...\n         \"\"\"\n+        assert False\n+\n         s = self._spec\n         w = write\n         types = set()\n```\n\nThe reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):\n\n```python\n    # Although multiple files are generated by this function, since\n    # they are all generated at once it suffices to make sure if just\n    # one of the generated files is older than the generator sources\n    src_file = __file__\n    gen_file = os.path.join(dirname, '__init__.py')\n\n    if os.path.exists(gen_file):\n        if getmtime(gen_file) > getmtime(src_file) and not force:\n            return\n```\n\nCC:  @embray jpflori\n\nReviewer: Erik Bray\n\nAuthor: Jeroen Demeyer\n\nBranch: aaedeff71f36c5d55545d8594dbfee76b9ad1939\n\nCommit: aaedeff71f36c5d55545d8594dbfee76b9ad1939\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23095\n\n",
    "closed_at": "2017-06-04T10:11:03Z",
    "created_at": "2017-05-29T12:39:18Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "autogen/interpreters does NOT work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23095",
    "user": "https://github.com/jdemeyer"
}
```
After making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.

In particular, the following should cause an error while building the interpreters, but it did not:

```diff
diff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py
index 3af99b2..5a3bfbb 100644
--- a/src/sage_setup/autogen/interpreters/generator.py
+++ b/src/sage_setup/autogen/interpreters/generator.py
@@ -316,6 +316,8 @@ class InterpreterGenerator(object):
             sage: print(buff.getvalue())
             # Automatically generated by ...
         """
+        assert False
+
         s = self._spec
         w = write
         types = set()
```

The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):

```python
    # Although multiple files are generated by this function, since
    # they are all generated at once it suffices to make sure if just
    # one of the generated files is older than the generator sources
    src_file = __file__
    gen_file = os.path.join(dirname, '__init__.py')

    if os.path.exists(gen_file):
        if getmtime(gen_file) > getmtime(src_file) and not force:
            return
```

CC:  @embray jpflori

Reviewer: Erik Bray

Author: Jeroen Demeyer

Branch: aaedeff71f36c5d55545d8594dbfee76b9ad1939

Commit: aaedeff71f36c5d55545d8594dbfee76b9ad1939

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23095





---

archive/issue_comments_319249.json:
```json
{
    "body": "<a id='comment:3'></a>I think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.",
    "created_at": "2017-05-29T13:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319249",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>I think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.



---

archive/issue_comments_319250.json:
```json
{
    "body": "<a id='comment:4'></a>I think there was one point where it was `src_files` but in one of the last rebases it got messed up.",
    "created_at": "2017-05-29T13:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319250",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>I think there was one point where it was `src_files` but in one of the last rebases it got messed up.



---

archive/issue_comments_319251.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-29T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319251",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_319252.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2017-05-29T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319252",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_319253.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-29T13:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319253",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319254.json:
```json
{
    "body": "<a id='comment:7'></a>I'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.",
    "created_at": "2017-05-29T13:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319254",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>I'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.



---

archive/issue_comments_319255.json:
```json
{
    "body": "<a id='comment:8'></a>At first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.",
    "created_at": "2017-05-29T14:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319255",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>At first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.



---

archive/issue_comments_319256.json:
```json
{
    "body": "<a id='comment:9'></a>I get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like \"checking if rebuild needed failed: <actual error>\").",
    "created_at": "2017-05-29T16:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319256",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>I get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like "checking if rebuild needed failed: <actual error>").



---

archive/issue_comments_319257.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-30T15:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_319258.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-30T15:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319258",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319259.json:
```json
{
    "body": "<a id='comment:11'></a>I don't want to make this more complicated than it needs to be. This is reverting to my original idea.",
    "created_at": "2017-05-30T15:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319259",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>I don't want to make this more complicated than it needs to be. This is reverting to my original idea.



---

archive/issue_comments_319260.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-31T10:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319260",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_319261.json:
```json
{
    "body": "<a id='comment:12'></a>Okay, seems fine.",
    "created_at": "2017-05-31T10:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319261",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Okay, seems fine.



---

archive/issue_events_059752.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-04T10:11:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-59752"
}
```



---

archive/issue_comments_319262.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-04T10:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-319262",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
