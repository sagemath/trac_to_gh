# Issue 23095: autogen/interpreters does NOT work

archive/issues_022858.json:
```json
{
    "body": "After making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.\n\nIn particular, the following should cause an error while building the interpreters, but it did not:\n\n```diff\ndiff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py\nindex 3af99b2..5a3bfbb 100644\n--- a/src/sage_setup/autogen/interpreters/generator.py\n+++ b/src/sage_setup/autogen/interpreters/generator.py\n@@ -316,6 +316,8 @@ class InterpreterGenerator(object):\n             sage: print(buff.getvalue())\n             # Automatically generated by ...\n         \"\"\"\n+        assert False\n+\n         s = self._spec\n         w = write\n         types = set()\n```\n\nThe reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):\n\n```python\n    # Although multiple files are generated by this function, since\n    # they are all generated at once it suffices to make sure if just\n    # one of the generated files is older than the generator sources\n    src_file = __file__\n    gen_file = os.path.join(dirname, '__init__.py')\n\n    if os.path.exists(gen_file):\n        if getmtime(gen_file) > getmtime(src_file) and not force:\n            return\n```\n\n**CC:**  @embray jpflori\n\n**Branch/Commit:** [aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)\n\n**Reviewer:** Erik Bray\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/23095\n\n",
    "closed_at": "2017-06-04T10:11:03Z",
    "created_at": "2017-05-29T12:39:18Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "autogen/interpreters does NOT work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23095",
    "user": "https://github.com/jdemeyer"
}
```
After making a minor change to `src/sage_setup/autogen/interpreters/generator.py`, the change did not take effect. I.e. the generated file `src/sage/ext/interpreters/wrapper_rdf.pyx` did *not* change.

In particular, the following should cause an error while building the interpreters, but it did not:

```diff
diff --git a/src/sage_setup/autogen/interpreters/generator.py b/src/sage_setup/autogen/interpreters/generator.py
index 3af99b2..5a3bfbb 100644
--- a/src/sage_setup/autogen/interpreters/generator.py
+++ b/src/sage_setup/autogen/interpreters/generator.py
@@ -316,6 +316,8 @@ class InterpreterGenerator(object):
             sage: print(buff.getvalue())
             # Automatically generated by ...
         """
+        assert False
+
         s = self._spec
         w = write
         types = set()
```

The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):

```python
    # Although multiple files are generated by this function, since
    # they are all generated at once it suffices to make sure if just
    # one of the generated files is older than the generator sources
    src_file = __file__
    gen_file = os.path.join(dirname, '__init__.py')

    if os.path.exists(gen_file):
        if getmtime(gen_file) > getmtime(src_file) and not force:
            return
```

**CC:**  @embray jpflori

**Branch/Commit:** [aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)

**Reviewer:** Erik Bray

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/23095





---

archive/issue_comments_348379.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,3 +17,17 @@\n          w = write\n          types = set()\n ```\n+\n+The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):\n+\n+```python\n+    # Although multiple files are generated by this function, since\n+    # they are all generated at once it suffices to make sure if just\n+    # one of the generated files is older than the generator sources\n+    src_file = __file__\n+    gen_file = os.path.join(dirname, '__init__.py')\n+\n+    if os.path.exists(gen_file):\n+        if getmtime(gen_file) > getmtime(src_file) and not force:\n+            return\n+```\n``````\n",
    "created_at": "2017-05-29T12:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348379",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,3 +17,17 @@
          w = write
          types = set()
 ```
+
+The reason is that this only checks one source file (`src/sage_setup/autogen/interpreters/__init__.py`):
+
+```python
+    # Although multiple files are generated by this function, since
+    # they are all generated at once it suffices to make sure if just
+    # one of the generated files is older than the generator sources
+    src_file = __file__
+    gen_file = os.path.join(dirname, '__init__.py')
+
+    if os.path.exists(gen_file):
+        if getmtime(gen_file) > getmtime(src_file) and not force:
+            return
+```
``````




---

archive/issue_comments_348380.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2017-05-29T13:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348380",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_348381.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.",
    "created_at": "2017-05-29T13:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348381",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
I think at some earlier version of this (before it was merged) it did check all source files?  I don't know when it changed.



---

archive/issue_comments_348382.json:
```json
{
    "body": "<a id='comment:4'></a>\nI think there was one point where it was `src_files` but in one of the last rebases it got messed up.",
    "created_at": "2017-05-29T13:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348382",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
I think there was one point where it was `src_files` but in one of the last rebases it got messed up.



---

archive/issue_comments_348383.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)",
    "created_at": "2017-05-29T13:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348383",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)



---

archive/issue_events_205811.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-29T13:13:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205811"
}
```



---

archive/issue_comments_348384.json:
```json
{
    "body": "<a id='comment:6'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a\">82f91f2</a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>\n",
    "created_at": "2017-05-29T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348384",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a">82f91f2</a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>




---

archive/issue_comments_348385.json:
```json
{
    "body": "**Commit:** [82f91f2ba83f2fd6a000976d719556252bf6440a](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)",
    "created_at": "2017-05-29T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348385",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [82f91f2ba83f2fd6a000976d719556252bf6440a](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)



---

archive/issue_events_205812.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-29T13:18:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205812"
}
```



---

archive/issue_events_205813.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-29T13:18:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205813"
}
```



---

archive/issue_comments_348386.json:
```json
{
    "body": "<a id='comment:7'></a>\nI'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.",
    "created_at": "2017-05-29T13:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348386",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
I'm not sure why you're using `OSError` here.  ~~It doesn't really matter~~ (actually I'd say it does matter--I think a real OSError should be allowed to rise here, or at least be handled separately), but it looks odd.  If the point is just to catch some exception just a generic `Exception` would be fine.  Looks good to me otherwise; sorry for any inconvenience this might have caused.



---

archive/issue_comments_348387.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2017-05-29T13:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348387",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_348388.json:
```json
{
    "body": "<a id='comment:8'></a>\nAt first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.",
    "created_at": "2017-05-29T14:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348388",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
At first, I created a separate exception class for this (say `class NeedToRebuild(Exception)`). But then I realized that it would be good to catch `OSError` too since there are various system calls in that block of code which could potentially `raise OSError`. Since this is only in determining whether to rebuild, I figured that it shouldn't be a fatal error.



---

archive/issue_comments_348389.json:
```json
{
    "body": "<a id='comment:9'></a>\nI get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like \"checking if rebuild needed failed: <actual error>\").",
    "created_at": "2017-05-29T16:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348389",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
I get that--I guess it doesn't need to be a fatal error then, but at least some more explanation surrounding an actual `OSError` would be good (just like "checking if rebuild needed failed: <actual error>").



---

archive/issue_comments_348390.json:
```json
{
    "body": "**Changing commit** from \"[82f91f2ba83f2fd6a000976d719556252bf6440a](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)\" to \"[aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)\".",
    "created_at": "2017-05-30T15:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348390",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[82f91f2ba83f2fd6a000976d719556252bf6440a](https://github.com/sagemath/sagetrac-mirror/commit/82f91f2ba83f2fd6a000976d719556252bf6440a)" to "[aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)".



---

archive/issue_comments_348391.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939\">aaedeff</a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>\n",
    "created_at": "2017-05-30T15:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348391",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939">aaedeff</a></td><td><code>Rebuild interpreters if any source file changed</code></td></tr></table>




---

archive/issue_events_205814.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-30T15:25:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205814"
}
```



---

archive/issue_events_205815.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-30T15:25:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205815"
}
```



---

archive/issue_comments_348392.json:
```json
{
    "body": "<a id='comment:11'></a>\nI don't want to make this more complicated than it needs to be. This is reverting to my original idea.",
    "created_at": "2017-05-30T15:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348392",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I don't want to make this more complicated than it needs to be. This is reverting to my original idea.



---

archive/issue_events_205816.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-31T10:13:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205816"
}
```



---

archive/issue_events_205817.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-05-31T10:13:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205817"
}
```



---

archive/issue_comments_348393.json:
```json
{
    "body": "<a id='comment:12'></a>\nOkay, seems fine.",
    "created_at": "2017-05-31T10:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348393",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
Okay, seems fine.



---

archive/issue_events_205818.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-04T10:11:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205818"
}
```



---

archive/issue_events_205819.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-04T10:11:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23095#event-205819"
}
```



---

archive/issue_comments_348394.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)\" to \"[aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)\".",
    "created_at": "2017-06-04T10:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23095#issuecomment-348394",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/23095](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23095)" to "[aaedeff71f36c5d55545d8594dbfee76b9ad1939](https://github.com/sagemath/sagetrac-mirror/commit/aaedeff71f36c5d55545d8594dbfee76b9ad1939)".
