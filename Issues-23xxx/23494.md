# Issue 23494: Monkey-patch inspect.isfunction() to support Cython functions

archive/issues_023257.json:
```json
{
    "assignees": [],
    "body": "See http://opendreamkit.org/2017/06/09/CythonSphinx/\n\nDepends on #23360\n\nBranch/Commit: **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**\n\nReviewer: **Erik Bray**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **cython**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23494_\n\n",
    "closed_at": "2017-07-31T20:19:18Z",
    "created_at": "2017-07-20T12:23:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Monkey-patch inspect.isfunction() to support Cython functions",
    "type": "issue",
    "updated_at": "2017-07-31T20:19:18Z",
    "url": "https://github.com/sagemath/sage/issues/23494",
    "user": "https://github.com/jdemeyer"
}
```
See http://opendreamkit.org/2017/06/09/CythonSphinx/

Depends on #23360

Branch/Commit: **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**

Reviewer: **Erik Bray**

Author: **Jeroen Demeyer**

Component: **cython**

_Issue created by migration from https://trac.sagemath.org/ticket/23494_





---

archive/issue_events_326932.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-20T12:23:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326932"
}
```



---

archive/issue_events_326933.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-20T12:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "000080",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326933"
}
```



---

archive/issue_events_326934.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-20T12:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326934"
}
```



---

archive/issue_events_326935.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-20T12:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326935"
}
```



---

archive/issue_comments_353219.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)**",
    "created_at": "2017-07-20T12:31:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353219",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)**



---

archive/issue_comments_353220.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44030be5598fe725d747dd4abe3a664da37e37f2\"><code>44030be</code></a></td><td><code>Upgrade to Cython 0.26</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e\"><code>9e33fb9</code></a></td><td><code>Monkey-patch inspect.isfunction() to support Cython functions</code></td></tr></table>\n",
    "created_at": "2017-07-20T12:31:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44030be5598fe725d747dd4abe3a664da37e37f2"><code>44030be</code></a></td><td><code>Upgrade to Cython 0.26</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e"><code>9e33fb9</code></a></td><td><code>Monkey-patch inspect.isfunction() to support Cython functions</code></td></tr></table>




---

archive/issue_comments_353221.json:
```json
{
    "body": "Commit: **[`9e33fb9`](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)**",
    "created_at": "2017-07-20T12:31:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353221",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`9e33fb9`](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)**



---

archive/issue_events_326936.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-20T12:31:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326936"
}
```



---

archive/issue_comments_353222.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-07-21T11:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353222",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_353223.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm not really sure how I feel about\n\n```\nhasattr(type(obj), \"__code__\")\n```\nbut I'm not completely opposed to it.  I just don't know why we can't be more specific.",
    "created_at": "2017-07-21T11:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353223",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm not really sure how I feel about

```
hasattr(type(obj), "__code__")
```
but I'm not completely opposed to it.  I just don't know why we can't be more specific.



---

archive/issue_events_326937.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-21T11:26:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326937"
}
```



---

archive/issue_events_326938.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-21T11:26:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326938"
}
```



---

archive/issue_comments_353224.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@embray](#comment:3):\n> I'm not really sure how I feel about\n> \n> ```\n> hasattr(type(obj), \"__code__\")\n> ```\n> but I'm not completely opposed to it.  I just don't know why we can't be more specific.\n\nMy code uses the \"duck typing\" philosophy. But I'm open for suggestions...",
    "created_at": "2017-07-21T12:19:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353224",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@embray](#comment:3):
> I'm not really sure how I feel about
> 
> ```
> hasattr(type(obj), "__code__")
> ```
> but I'm not completely opposed to it.  I just don't know why we can't be more specific.

My code uses the "duck typing" philosophy. But I'm open for suggestions...



---

archive/issue_comments_353225.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).\n\nMaybe it would be good, as part of any proposal to overhaul Python's function types, if there were an ABC for functions in the sense of https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes",
    "created_at": "2017-07-21T16:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353225",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).

Maybe it would be good, as part of any proposal to overhaul Python's function types, if there were an ABC for functions in the sense of https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes



---

archive/issue_events_326939.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T10:08:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326939"
}
```



---

archive/issue_events_326940.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T10:08:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326940"
}
```



---

archive/issue_comments_353226.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDoctest failure (see patchbot)",
    "created_at": "2017-07-25T10:08:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353226",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Doctest failure (see patchbot)



---

archive/issue_comments_353227.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@embray](#comment:5):\n> I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).\n\nI think you are right. However, the `__code__` attribute seems to work in practice for my purpose, even if it's not formally documented.",
    "created_at": "2017-07-25T10:09:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353227",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@embray](#comment:5):
> I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).

I think you are right. However, the `__code__` attribute seems to work in practice for my purpose, even if it's not formally documented.



---

archive/issue_comments_353228.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAnd in any case, such duck-typing is better than the `isinstance()` check that the official `inspect` module does.",
    "created_at": "2017-07-25T10:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353228",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

And in any case, such duck-typing is better than the `isinstance()` check that the official `inspect` module does.



---

archive/issue_comments_353229.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba\"><code>434e7c2</code></a></td><td><code>Fix doctest for sage_getsource()</code></td></tr></table>\n",
    "created_at": "2017-07-25T11:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353229",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba"><code>434e7c2</code></a></td><td><code>Fix doctest for sage_getsource()</code></td></tr></table>




---

archive/issue_comments_353230.json:
```json
{
    "body": "Changed commit from **[`9e33fb9`](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)** to **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**",
    "created_at": "2017-07-25T11:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353230",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9e33fb9`](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)** to **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**



---

archive/issue_comments_353231.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nTrivial fix.",
    "created_at": "2017-07-25T11:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353231",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Trivial fix.



---

archive/issue_events_326941.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T11:24:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326941"
}
```



---

archive/issue_events_326942.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T11:24:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326942"
}
```



---

archive/issue_events_326943.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-31T20:19:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326943"
}
```



---

archive/issue_events_326944.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "17e8b80283f00edc9dd0e9104423445c4efa2531",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-07-31T20:19:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23494#event-326944"
}
```



---

archive/issue_comments_353232.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)** to **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**",
    "created_at": "2017-07-31T20:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23494#issuecomment-353232",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)** to **[`434e7c2`](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)**
