# Issue 23494: Monkey-patch inspect.isfunction() to support Cython functions

archive/issues_023257.json:
```json
{
    "body": "See http://opendreamkit.org/2017/06/09/CythonSphinx/\n\n**Branch/Commit:** [434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)\n\n**Reviewer:** Erik Bray\n\n**Author:** Jeroen Demeyer\n\n**Dependencies:** #23360\n\nIssue created by migration from https://trac.sagemath.org/ticket/23494\n\n",
    "closed_at": "2017-07-31T20:19:18Z",
    "created_at": "2017-07-20T12:23:29Z",
    "labels": [
        "component: cython",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Monkey-patch inspect.isfunction() to support Cython functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23494",
    "user": "https://github.com/jdemeyer"
}
```
See http://opendreamkit.org/2017/06/09/CythonSphinx/

**Branch/Commit:** [434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)

**Reviewer:** Erik Bray

**Author:** Jeroen Demeyer

**Dependencies:** #23360

Issue created by migration from https://trac.sagemath.org/ticket/23494





---

archive/issue_comments_423161.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)",
    "created_at": "2017-07-20T12:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423161",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)



---

archive/issue_comments_423162.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44030be5598fe725d747dd4abe3a664da37e37f2\">44030be</a></td><td><code>Upgrade to Cython 0.26</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e\">9e33fb9</a></td><td><code>Monkey-patch inspect.isfunction() to support Cython functions</code></td></tr></table>\n",
    "created_at": "2017-07-20T12:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423162",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44030be5598fe725d747dd4abe3a664da37e37f2">44030be</a></td><td><code>Upgrade to Cython 0.26</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e">9e33fb9</a></td><td><code>Monkey-patch inspect.isfunction() to support Cython functions</code></td></tr></table>




---

archive/issue_comments_423163.json:
```json
{
    "body": "**Commit:** [9e33fb9e5602ca24371477789421c3ac4182e35e](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)",
    "created_at": "2017-07-20T12:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423163",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [9e33fb9e5602ca24371477789421c3ac4182e35e](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)



---

archive/issue_comments_423164.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-07-20T12:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423164",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_423165.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2017-07-21T11:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423165",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_423166.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm not really sure how I feel about\n\n```\nhasattr(type(obj), \"__code__\")\n```\nbut I'm not completely opposed to it.  I just don't know why we can't be more specific.",
    "created_at": "2017-07-21T11:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423166",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
I'm not really sure how I feel about

```
hasattr(type(obj), "__code__")
```
but I'm not completely opposed to it.  I just don't know why we can't be more specific.



---

archive/issue_comments_423167.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-07-21T11:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423167",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_423168.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [embray](#comment%3A3):\n> I'm not really sure how I feel about\n> \n> ```\n> hasattr(type(obj), \"__code__\")\n> ```\n> but I'm not completely opposed to it.  I just don't know why we can't be more specific.\n\n\nMy code uses the \"duck typing\" philosophy. But I'm open for suggestions...",
    "created_at": "2017-07-21T12:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423168",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Replying to [embray](#comment%3A3):
> I'm not really sure how I feel about
> 
> ```
> hasattr(type(obj), "__code__")
> ```
> but I'm not completely opposed to it.  I just don't know why we can't be more specific.


My code uses the "duck typing" philosophy. But I'm open for suggestions...



---

archive/issue_comments_423169.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).\n\nMaybe it would be good, as part of any proposal to overhaul Python's function types, if there were an ABC for functions in the sense of https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes",
    "created_at": "2017-07-21T16:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423169",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).

Maybe it would be good, as part of any proposal to overhaul Python's function types, if there were an ABC for functions in the sense of https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes



---

archive/issue_comments_423170.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-07-25T10:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423170",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_423171.json:
```json
{
    "body": "<a id='comment:6'></a>\nDoctest failure (see patchbot)",
    "created_at": "2017-07-25T10:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423171",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Doctest failure (see patchbot)



---

archive/issue_comments_423172.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [embray](#comment%3A5):\n> I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).\n\n\nI think you are right. However, the `__code__` attribute seems to work in practice for my purpose, even if it's not formally documented.",
    "created_at": "2017-07-25T10:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [embray](#comment%3A5):
> I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).


I think you are right. However, the `__code__` attribute seems to work in practice for my purpose, even if it's not formally documented.



---

archive/issue_comments_423173.json:
```json
{
    "body": "<a id='comment:8'></a>\nAnd in any case, such duck-typing is better than the `isinstance()` check that the official `inspect` module does.",
    "created_at": "2017-07-25T10:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423173",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
And in any case, such duck-typing is better than the `isinstance()` check that the official `inspect` module does.



---

archive/issue_comments_423174.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba\">434e7c2</a></td><td><code>Fix doctest for sage_getsource()</code></td></tr></table>\n",
    "created_at": "2017-07-25T11:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba">434e7c2</a></td><td><code>Fix doctest for sage_getsource()</code></td></tr></table>




---

archive/issue_comments_423175.json:
```json
{
    "body": "**Changing commit** from \"[9e33fb9e5602ca24371477789421c3ac4182e35e](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)\" to \"[434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)\".",
    "created_at": "2017-07-25T11:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9e33fb9e5602ca24371477789421c3ac4182e35e](https://github.com/sagemath/sagetrac-mirror/commit/9e33fb9e5602ca24371477789421c3ac4182e35e)" to "[434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)".



---

archive/issue_comments_423176.json:
```json
{
    "body": "<a id='comment:10'></a>\nTrivial fix.",
    "created_at": "2017-07-25T11:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423176",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Trivial fix.



---

archive/issue_comments_423177.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2017-07-25T11:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423177",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_events_068171.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-31T20:19:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23494#event-68171"
}
```



---

archive/issue_comments_423178.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)\" to \"[434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)\".",
    "created_at": "2017-07-31T20:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23494#issuecomment-423178",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/23494](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/23494)" to "[434e7c2fde4cd4df9d71c529c177d7fc06ce40ba](https://github.com/sagemath/sagetrac-mirror/commit/434e7c2fde4cd4df9d71c529c177d7fc06ce40ba)".
