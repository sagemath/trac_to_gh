# Issue 23920: py3: richcmp for ideals of multivariate polynomials

archive/issues_023683.json:
```json
{
    "body": "CC:  @tscrim @jdemeyer @jhpalmieri @a-andre @kiwifb\n\nsplit off from #23787\n\nrefactoring of the comparison of ideals in multivariate polynomials\n\n* to get rid of cmp\n* consistent comparison by containment\n* when a total order is needed, compare instead by gens\n\nIssue created by migration from https://trac.sagemath.org/ticket/23920\n\n",
    "closed_at": "2017-10-01T00:18:52Z",
    "created_at": "2017-09-22T13:02:47Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "py3: richcmp for ideals of multivariate polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23920",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim @jdemeyer @jhpalmieri @a-andre @kiwifb

split off from #23787

refactoring of the comparison of ideals in multivariate polynomials

* to get rid of cmp
* consistent comparison by containment
* when a total order is needed, compare instead by gens

Issue created by migration from https://trac.sagemath.org/ticket/23920





---

archive/issue_comments_331371.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-22T13:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331371",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_331372.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T14:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331372",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331373.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T19:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331374.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-23T06:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331375.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-23T06:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331375",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331376.json:
```json
{
    "body": "This should be ready to go. This refactors the comparison of ideals in multi-variate polynomial rings. Comparison is now meaning \"for containment\" in all cases.\n\nBesides, it tries to avoid computing Grobner bases, by first comparing the generators.\n\nPlease review.",
    "created_at": "2017-09-23T06:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331376",
    "user": "https://github.com/fchapoton"
}
```

This should be ready to go. This refactors the comparison of ideals in multi-variate polynomial rings. Comparison is now meaning "for containment" in all cases.

Besides, it tries to avoid computing Grobner bases, by first comparing the generators.

Please review.



---

archive/issue_comments_331377.json:
```json
{
    "body": "green bot!",
    "created_at": "2017-09-23T09:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331377",
    "user": "https://github.com/fchapoton"
}
```

green bot!



---

archive/issue_comments_331378.json:
```json
{
    "body": "now this is going to conflict with #23814",
    "created_at": "2017-09-24T20:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331378",
    "user": "https://github.com/fchapoton"
}
```

now this is going to conflict with #23814



---

archive/issue_comments_331379.json:
```json
{
    "body": "Could someone please review this? there should be no real conflict with #23814.",
    "created_at": "2017-09-28T07:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331379",
    "user": "https://github.com/fchapoton"
}
```

Could someone please review this? there should be no real conflict with #23814.



---

archive/issue_comments_331380.json:
```json
{
    "body": "Rather than comparing gens as a list, I would compare them as sets. That way, reordering of gens doesn't require a GB computation, e.g.:\n\n```\nsage: R.<x,y> = ZZ[]\nsage: I = R.ideal([x^2, x*y - y^2 + 2])\nsage: Ip = R.ideal([x*y - y^2 + 2, x^2])\nsage: I.gens()\n[x^2, x*y - y^2 + 2]\nsage: Ip.gens()\n[x*y - y^2 + 2, x^2]\nsage: I == Ip   # Avoid GB here\nTrue\n```\n\nAlso, what is the rationale for this change:\n\n```diff\n@@ -532,8 +529,13 @@ class SchemeMorphism_polynomial_affine_space(SchemeMorphism_polynomial):\n \n         #homogenize the domain and codomain\n         A = self.domain().projective_embedding(ind[0]).codomain()\n-        B = self.codomain().projective_embedding(ind[1]).codomain()\n-        H = Hom(A, B)\n+        if self.is_endomorphism():\n+            B = A\n+            H = End(A)\n+        else:\n+            B = self.codomain().projective_embedding(ind[1]).codomain()\n+            H = Hom(A, B)\n+\n         newvar = A.ambient_space().coordinate_ring().gen(ind[0])\n \n         N = A.ambient_space().dimension_relative()\n```",
    "created_at": "2017-09-28T15:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331380",
    "user": "https://github.com/tscrim"
}
```

Rather than comparing gens as a list, I would compare them as sets. That way, reordering of gens doesn't require a GB computation, e.g.:

```
sage: R.<x,y> = ZZ[]
sage: I = R.ideal([x^2, x*y - y^2 + 2])
sage: Ip = R.ideal([x*y - y^2 + 2, x^2])
sage: I.gens()
[x^2, x*y - y^2 + 2]
sage: Ip.gens()
[x*y - y^2 + 2, x^2]
sage: I == Ip   # Avoid GB here
True
```

Also, what is the rationale for this change:

```diff
@@ -532,8 +529,13 @@ class SchemeMorphism_polynomial_affine_space(SchemeMorphism_polynomial):
 
         #homogenize the domain and codomain
         A = self.domain().projective_embedding(ind[0]).codomain()
-        B = self.codomain().projective_embedding(ind[1]).codomain()
-        H = Hom(A, B)
+        if self.is_endomorphism():
+            B = A
+            H = End(A)
+        else:
+            B = self.codomain().projective_embedding(ind[1]).codomain()
+            H = Hom(A, B)
+
         newvar = A.ambient_space().coordinate_ring().gen(ind[0])
 
         N = A.ambient_space().dimension_relative()
```



---

archive/issue_comments_331381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-29T09:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331382.json:
```json
{
    "body": "* I have modifed the comparison to use sets of gens.\n\n* The changes in scheme_morphisms and dynamical systems could probably be made independently now, even if at some point they were intertwined with the main issue here.\n\n* the precise change you talk about was made so that one could replace comparison of domains (in dynamical systems) with a call to is_endomorphism.",
    "created_at": "2017-09-29T12:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331382",
    "user": "https://github.com/fchapoton"
}
```

* I have modifed the comparison to use sets of gens.

* The changes in scheme_morphisms and dynamical systems could probably be made independently now, even if at some point they were intertwined with the main issue here.

* the precise change you talk about was made so that one could replace comparison of domains (in dynamical systems) with a call to is_endomorphism.



---

archive/issue_comments_331383.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-29T15:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331383",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331384.json:
```json
{
    "body": "Okay. LGTM. Thanks.",
    "created_at": "2017-09-29T15:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331384",
    "user": "https://github.com/tscrim"
}
```

Okay. LGTM. Thanks.



---

archive/issue_comments_331385.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-01T00:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23920#issuecomment-331385",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060877.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-01T00:18:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23920",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23920#event-60877"
}
```
