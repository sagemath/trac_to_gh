# Issue 23376: Equality testing of genera of quadratic forms over ZZ changes the genus and produces false results

archive/issues_023139.json:
```json
{
    "body": "```\nsage: D4 = QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))\nsage: G = D4.global_genus_symbol()\nsage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\nTrue\nsage: G == copy(G)\nTrue\nsage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\nFalse\n```\n\nThe reason is that various functions unintentionally modify their input. Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy.\n\nFor example sage.quadratic_forms.genera.genus.canonical_2_adic_reduction modifies its input which does not seem to be intended.\n\nKeywords: sd87, Genus, sd91\n\nReviewer: Anthony V\u00e1rilly-Alvarado, Jen Berg\n\nAuthor: Simon Brandhorst\n\nBranch: 24a5b0bcc3f31e1dcf08ce88c0c709578a8bbf7c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23376\n\n",
    "closed_at": "2017-10-05T06:54:12Z",
    "created_at": "2017-07-06T07:21:37Z",
    "labels": [
        "component: quadratic forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Equality testing of genera of quadratic forms over ZZ changes the genus and produces false results",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23376",
    "user": "https://github.com/simonbrandhorst"
}
```
```
sage: D4 = QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))
sage: G = D4.global_genus_symbol()
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
True
sage: G == copy(G)
True
sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
False
```

The reason is that various functions unintentionally modify their input. Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy.

For example sage.quadratic_forms.genera.genus.canonical_2_adic_reduction modifies its input which does not seem to be intended.

Keywords: sd87, Genus, sd91

Reviewer: Anthony VÃ¡rilly-Alvarado, Jen Berg

Author: Simon Brandhorst

Branch: 24a5b0bcc3f31e1dcf08ce88c0c709578a8bbf7c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23376





---

archive/issue_comments_344574.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-07-07T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344574",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_344575.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-07T14:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344575",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344576.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-08T22:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344576",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_344577.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-10T06:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344578.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-10T07:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344578",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_344579.json:
```json
{
    "body": "<a id='comment:6'></a>(reformatting)",
    "created_at": "2017-07-13T17:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344579",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>(reformatting)



---

archive/issue_comments_344580.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,21 +1,17 @@\n-sage: D4=QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))\n-sage: G=D4.global_genus_symbol()\n+```\n+sage: D4 = QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))\n+sage: G = D4.global_genus_symbol()\n sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\n True\n-sage: G==copy(G)\n+sage: G == copy(G)\n True\n sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)\n False\n+```\n \n-The reason is that various functions unintentionally modify their input.\n-Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy. \n+The reason is that various functions unintentionally modify their input. Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy.\n \n-For example \n-sage.quadratic_forms.genera.genus.canonical_2_adic_reduction\n-\n-modifies its input which does not seem to be intended.\n-\n-Keywords: Genus\n+For example sage.quadratic_forms.genera.genus.canonical_2_adic_reduction modifies its input which does not seem to be intended.\n \n Author: Simon Brandhorst\n \n```\n",
    "created_at": "2017-07-13T17:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344580",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,21 +1,17 @@
-sage: D4=QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))
-sage: G=D4.global_genus_symbol()
+```
+sage: D4 = QuadraticForm(Matrix(ZZ,4,4,[2,0,0,-1,0,2,0,-1,0,0,2,-1,-1,-1,-1,2]))
+sage: G = D4.global_genus_symbol()
 sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
 True
-sage: G==copy(G)
+sage: G == copy(G)
 True
 sage: sage.quadratic_forms.genera.genus.is_GlobalGenus(G)
 False
+```
 
-The reason is that various functions unintentionally modify their input.
-Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy. 
+The reason is that various functions unintentionally modify their input. Since a genus consists of lists containing lists, functions do just copy the lists but not deepcopy.
 
-For example 
-sage.quadratic_forms.genera.genus.canonical_2_adic_reduction
-
-modifies its input which does not seem to be intended.
-
-Keywords: Genus
+For example sage.quadratic_forms.genera.genus.canonical_2_adic_reduction modifies its input which does not seem to be intended.
 
 Author: Simon Brandhorst
 
```




---

archive/issue_comments_344581.json:
```json
{
    "body": "Changing keywords from \"Genus\" to \"Genus,sd87\".",
    "created_at": "2017-07-18T18:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344581",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing keywords from "Genus" to "Genus,sd87".



---

archive/issue_comments_344582.json:
```json
{
    "body": "Changing keywords from \"Genus,sd87\" to \"Genus,sd91\".",
    "created_at": "2017-08-17T13:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344582",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing keywords from "Genus,sd87" to "Genus,sd91".



---

archive/issue_comments_344583.json:
```json
{
    "body": "Changing keywords from \"Genus,sd91\" to \"sd87, Genus, sd91\".",
    "created_at": "2017-09-04T20:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344583",
    "user": "https://github.com/edgarcosta"
}
```

Changing keywords from "Genus,sd91" to "sd87, Genus, sd91".



---

archive/issue_comments_344584.json:
```json
{
    "body": "<a id='comment:9'></a>You should leave the sd87 keyword there.",
    "created_at": "2017-09-04T20:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344584",
    "user": "https://github.com/edgarcosta"
}
```

<a id='comment:9'></a>You should leave the sd87 keyword there.



---

archive/issue_comments_344585.json:
```json
{
    "body": "<a id='comment:10'></a>Doesn't follow the doctest conventions; needs empty line after TESTS::",
    "created_at": "2017-09-30T17:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344585",
    "user": "https://trac.sagemath.org/admin/accounts/users/jensberg"
}
```

<a id='comment:10'></a>Doesn't follow the doctest conventions; needs empty line after TESTS::



---

archive/issue_comments_344586.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-30T17:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344586",
    "user": "https://trac.sagemath.org/admin/accounts/users/jensberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_344587.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T17:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344588.json:
```json
{
    "body": "<a id='comment:12'></a>Fix looks good now.  Passes all doc tests and documentation builds.",
    "created_at": "2017-09-30T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344588",
    "user": "https://trac.sagemath.org/admin/accounts/users/avarilly"
}
```

<a id='comment:12'></a>Fix looks good now.  Passes all doc tests and documentation builds.



---

archive/issue_comments_344589.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-30T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344589",
    "user": "https://trac.sagemath.org/admin/accounts/users/avarilly"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_344590.json:
```json
{
    "body": "<a id='comment:13'></a>Reviewer name is missing...",
    "created_at": "2017-10-03T18:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344590",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>Reviewer name is missing...



---

archive/issue_comments_344591.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-03T18:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344591",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_344592.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-03T18:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344592",
    "user": "https://trac.sagemath.org/admin/accounts/users/jensberg"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_344593.json:
```json
{
    "body": "<a id='comment:14'></a>Added reviewer names.",
    "created_at": "2017-10-03T18:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344593",
    "user": "https://trac.sagemath.org/admin/accounts/users/jensberg"
}
```

<a id='comment:14'></a>Added reviewer names.



---

archive/issue_events_060128.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:54:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23376#event-60128"
}
```



---

archive/issue_comments_344594.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-05T06:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23376#issuecomment-344594",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
