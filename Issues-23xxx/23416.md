# Issue 23416: Provide a "sage -ipynb2rst" command

archive/issues_023179.json:
```json
{
    "body": "With jupyter as the default notebook, we need to easily transform an `.ipynb` notebook back into some source code. This ticket adds a `sage -ipynb2rst` command.\n\nA custom template is created to write code blocks as:\n\n```\n   sage: # blah\n   ....: # blah\n```\n\nand to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere). A postprocess script fixes some issues.\n\nNote that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` and `postprocess.py` into the `local/share/sage/ext/nbconvert/` directory.\n\n\nCC:  @videlec @seblabbe mlapointe\n\nKeywords: MathExp2018, days94, thursdaysbdx\n\nBranch/Commit: 6e37aa20c1cc19aaaf8648c90ffe42125f462107\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Thierry Monteil\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23416\n\n",
    "closed_at": "2018-07-08T13:05:34Z",
    "created_at": "2017-07-12T21:51:03Z",
    "labels": [
        "component: notebook"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Provide a \"sage -ipynb2rst\" command",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23416",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
With jupyter as the default notebook, we need to easily transform an `.ipynb` notebook back into some source code. This ticket adds a `sage -ipynb2rst` command.

A custom template is created to write code blocks as:

```
   sage: # blah
   ....: # blah
```

and to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere). A postprocess script fixes some issues.

Note that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` and `postprocess.py` into the `local/share/sage/ext/nbconvert/` directory.


CC:  @videlec @seblabbe mlapointe

Keywords: MathExp2018, days94, thursdaysbdx

Branch/Commit: 6e37aa20c1cc19aaaf8648c90ffe42125f462107

Reviewer: Sébastien Labbé

Author: Thierry Monteil

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23416





---

archive/issue_comments_434528.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tmonteil/provide_a__sage__ipynb2rst__command\"",
    "created_at": "2017-07-12T22:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434528",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing branch from "" to "u/tmonteil/provide_a__sage__ipynb2rst__command"



---

archive/issue_comments_434529.json:
```json
{
    "body": "Changing commit from \"\" to \"c18f853443fbaac1a5bdba14d80ec9267f496a3a\"",
    "created_at": "2017-07-12T22:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434529",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing commit from "" to "c18f853443fbaac1a5bdba14d80ec9267f496a3a"



---

archive/issue_comments_434530.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-12T22:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434530",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434531.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[c18f853](https://github.com/sagemath/sagetrac-mirror/commit/c18f853443fbaac1a5bdba14d80ec9267f496a3a)|`#23416 sage -ipynb2rst command.`|",
    "created_at": "2017-07-12T22:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434531",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[c18f853](https://github.com/sagemath/sagetrac-mirror/commit/c18f853443fbaac1a5bdba14d80ec9267f496a3a)|`#23416 sage -ipynb2rst command.`|



---

archive/issue_comments_434532.json:
```json
{
    "body": "<a id='comment:3'></a>\nUsing bash 4.4.12 on Archlinux\n\n```\n$ sage -ipynb2rst measure_simulation.ipynb \n/opt/sage/src/bin/sage-ipynb2rst: ligne 39: erreur de syntaxe pr\u00e8s du symbole inattendu \u00ab ( \u00bb\n/opt/sage/src/bin/sage-ipynb2rst: ligne 39: `        jupyter nbconvert --to rst --RSTExporter.template_path=[\\'$SAGE_EXTCODE/nbconvert/\\'] --RSTExporter.template_file='rst_sage.tpl' --stdout ${1} | sed 's/:math://g' > ${2} ( echo -e '\\n' ; help ) ;;'\n```",
    "created_at": "2017-07-15T09:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434532",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Using bash 4.4.12 on Archlinux

```
$ sage -ipynb2rst measure_simulation.ipynb 
/opt/sage/src/bin/sage-ipynb2rst: ligne 39: erreur de syntaxe près du symbole inattendu « ( »
/opt/sage/src/bin/sage-ipynb2rst: ligne 39: `        jupyter nbconvert --to rst --RSTExporter.template_path=[\'$SAGE_EXTCODE/nbconvert/\'] --RSTExporter.template_file='rst_sage.tpl' --stdout ${1} | sed 's/:math://g' > ${2} ( echo -e '\n' ; help ) ;;'
```



---

archive/issue_comments_434533.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[2ef220d](https://github.com/sagemath/sagetrac-mirror/commit/2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7)|`#23416 : typo.`|",
    "created_at": "2017-07-16T21:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[2ef220d](https://github.com/sagemath/sagetrac-mirror/commit/2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7)|`#23416 : typo.`|



---

archive/issue_comments_434534.json:
```json
{
    "body": "Changing commit from \"c18f853443fbaac1a5bdba14d80ec9267f496a3a\" to \"2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7\"",
    "created_at": "2017-07-16T21:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c18f853443fbaac1a5bdba14d80ec9267f496a3a" to "2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7"



---

archive/issue_comments_434535.json:
```json
{
    "body": "<a id='comment:5'></a>\nHmm, i copy/pasted too fast, sorry for the typo, this should work better now.",
    "created_at": "2017-07-16T21:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434535",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:5'></a>
Hmm, i copy/pasted too fast, sorry for the typo, this should work better now.



---

archive/issue_comments_434536.json:
```json
{
    "body": "Changing keywords from \"\" to \"mathexp2018\".",
    "created_at": "2018-05-29T16:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434536",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "" to "mathexp2018".



---

archive/issue_comments_434537.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[1edaf59](https://github.com/sagemath/sagetrac-mirror/commit/1edaf5967614283967891b87acd5b550de746bf2)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|\n|[4ecef2f](https://github.com/sagemath/sagetrac-mirror/commit/4ecef2fd657f5a60281a747213388f603536914f)|`#23416 : better template (output correctly displayed)`|",
    "created_at": "2018-05-29T23:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[1edaf59](https://github.com/sagemath/sagetrac-mirror/commit/1edaf5967614283967891b87acd5b550de746bf2)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|
|[4ecef2f](https://github.com/sagemath/sagetrac-mirror/commit/4ecef2fd657f5a60281a747213388f603536914f)|`#23416 : better template (output correctly displayed)`|



---

archive/issue_comments_434538.json:
```json
{
    "body": "Changing commit from \"2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7\" to \"4ecef2fd657f5a60281a747213388f603536914f\"",
    "created_at": "2018-05-29T23:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2ef220d185bfdf9eb8ac2b51e186bd0a65d2ebb7" to "4ecef2fd657f5a60281a747213388f603536914f"



---

archive/issue_comments_434539.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[d22357e](https://github.com/sagemath/sagetrac-mirror/commit/d22357e8f3907fd43737647552e9f509de7ecd5b)|`#23416 : do not start with a blank line`|\n|[2af3bfc](https://github.com/sagemath/sagetrac-mirror/commit/2af3bfc466c3bcb7e972a991851047571902d199)|`#23416 : let nbconvert write file and save images`|\n|[aa75e08](https://github.com/sagemath/sagetrac-mirror/commit/aa75e084f6a0660384cc3d8bb3fd2951963c82c6)|`#23416 : postprocessing`|",
    "created_at": "2018-06-03T18:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[d22357e](https://github.com/sagemath/sagetrac-mirror/commit/d22357e8f3907fd43737647552e9f509de7ecd5b)|`#23416 : do not start with a blank line`|
|[2af3bfc](https://github.com/sagemath/sagetrac-mirror/commit/2af3bfc466c3bcb7e972a991851047571902d199)|`#23416 : let nbconvert write file and save images`|
|[aa75e08](https://github.com/sagemath/sagetrac-mirror/commit/aa75e084f6a0660384cc3d8bb3fd2951963c82c6)|`#23416 : postprocessing`|



---

archive/issue_comments_434540.json:
```json
{
    "body": "Changing commit from \"4ecef2fd657f5a60281a747213388f603536914f\" to \"aa75e084f6a0660384cc3d8bb3fd2951963c82c6\"",
    "created_at": "2018-06-03T18:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4ecef2fd657f5a60281a747213388f603536914f" to "aa75e084f6a0660384cc3d8bb3fd2951963c82c6"



---

archive/issue_comments_434541.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n    ....: # blah\n ```\n \n-and to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere).\n+and to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere). A postprocess script fixes some issues.\n \n-Note that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` into the `local/share/sage/ext/nbconvert/` directory.\n+Note that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` and `postprocess.py` into the `local/share/sage/ext/nbconvert/` directory.\n \n``````\n",
    "created_at": "2018-06-03T18:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434541",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
    ....: # blah
 ```
 
-and to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere).
+and to make mathematics formulas the default role (hence avoiding the clumsy `:math:` notation everywhere). A postprocess script fixes some issues.
 
-Note that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` into the `local/share/sage/ext/nbconvert/` directory.
+Note that reviewers have to run `./configure` before `make` to let this ticket work in order to copy `rst_sage.tpl` and `postprocess.py` into the `local/share/sage/ext/nbconvert/` directory.
 
``````




---

archive/issue_comments_434542.json:
```json
{
    "body": "<a id='comment:9'></a>\nWe could always add improvements, but i am fine with the current behavior for a first version.",
    "created_at": "2018-06-03T18:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434542",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>
We could always add improvements, but i am fine with the current behavior for a first version.



---

archive/issue_comments_434543.json:
```json
{
    "body": "Changing keywords from \"mathexp2018\" to \"MathExp2018\".",
    "created_at": "2018-06-03T18:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434543",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "mathexp2018" to "MathExp2018".



---

archive/issue_events_076253.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-06-03T18:38:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23416#event-76253"
}
```



---

archive/issue_comments_434544.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-03T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434544",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_434545.json:
```json
{
    "body": "<a id='comment:11'></a>\nThierry, can you add a doctest [here](https://github.com/sagemath/sage/blob/854f9764d14236110b8d7f7b35a7d52017e044f8/src/sage/tests/cmdline.py#L647) in src/sage/tests/cmdline.py please?",
    "created_at": "2018-06-03T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434545",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:11'></a>
Thierry, can you add a doctest [here](https://github.com/sagemath/sage/blob/854f9764d14236110b8d7f7b35a7d52017e044f8/src/sage/tests/cmdline.py#L647) in src/sage/tests/cmdline.py please?



---

archive/issue_comments_434546.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2018-06-03T19:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434546",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_434547.json:
```json
{
    "body": "Changing commit from \"aa75e084f6a0660384cc3d8bb3fd2951963c82c6\" to \"0785497a620a405b72f45ea602c7136f5006f661\"",
    "created_at": "2018-06-03T22:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "aa75e084f6a0660384cc3d8bb3fd2951963c82c6" to "0785497a620a405b72f45ea602c7136f5006f661"



---

archive/issue_comments_434548.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[03e157c](https://github.com/sagemath/sagetrac-mirror/commit/03e157cbcee45bd16e5d0ddf9e1a30961e3b2689)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|\n|[0785497](https://github.com/sagemath/sagetrac-mirror/commit/0785497a620a405b72f45ea602c7136f5006f661)|`#23416 : command line doctest`|",
    "created_at": "2018-06-03T22:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[03e157c](https://github.com/sagemath/sagetrac-mirror/commit/03e157cbcee45bd16e5d0ddf9e1a30961e3b2689)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|
|[0785497](https://github.com/sagemath/sagetrac-mirror/commit/0785497a620a405b72f45ea602c7136f5006f661)|`#23416 : command line doctest`|



---

archive/issue_comments_434549.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-03T22:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434549",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_434550.json:
```json
{
    "body": "<a id='comment:13'></a>\nDone.",
    "created_at": "2018-06-03T22:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434550",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>
Done.



---

archive/issue_comments_434551.json:
```json
{
    "body": "<a id='comment:14'></a>\nTypo: `the header that define` -> `the header that defines`",
    "created_at": "2018-06-04T06:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434551",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Typo: `the header that define` -> `the header that defines`



---

archive/issue_comments_434552.json:
```json
{
    "body": "<a id='comment:15'></a>\nI generally don't like checks of the form\n\n```\n# tests if dependencies are available\npandoc -v > /dev/null 2>&1 || fail 'sage -ipynb2rst requires pandoc; please install it on your system.'\n```\nbecause it is not at all obvious that the `jupyter nbconvert` command will correctly execute `pandoc` if and only if that check above works. For example, if the `pandoc` command is configurable (I have no idea whether it is, but it might be), then you are doing the wrong check. Also, maybe `pandoc` fails to run because of a different reason than it not being installed (say, it is missing some library).\n\nSo unless there is a good reason to add that check, I would prefer to remove it.",
    "created_at": "2018-06-04T07:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434552",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
I generally don't like checks of the form

```
# tests if dependencies are available
pandoc -v > /dev/null 2>&1 || fail 'sage -ipynb2rst requires pandoc; please install it on your system.'
```
because it is not at all obvious that the `jupyter nbconvert` command will correctly execute `pandoc` if and only if that check above works. For example, if the `pandoc` command is configurable (I have no idea whether it is, but it might be), then you are doing the wrong check. Also, maybe `pandoc` fails to run because of a different reason than it not being installed (say, it is missing some library).

So unless there is a good reason to add that check, I would prefer to remove it.



---

archive/issue_comments_434553.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-04T07:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434553",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_434554.json:
```json
{
    "body": "Changing commit from \"0785497a620a405b72f45ea602c7136f5006f661\" to \"5ed5ab10ffc002cbc8b0d9ee23c109e50b585991\"",
    "created_at": "2018-06-04T07:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0785497a620a405b72f45ea602c7136f5006f661" to "5ed5ab10ffc002cbc8b0d9ee23c109e50b585991"



---

archive/issue_comments_434555.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[5ed5ab1](https://github.com/sagemath/sagetrac-mirror/commit/5ed5ab10ffc002cbc8b0d9ee23c109e50b585991)|`#23416 : remove depedency test to pandoc`|",
    "created_at": "2018-06-04T07:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[5ed5ab1](https://github.com/sagemath/sagetrac-mirror/commit/5ed5ab10ffc002cbc8b0d9ee23c109e50b585991)|`#23416 : remove depedency test to pandoc`|



---

archive/issue_comments_434556.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[7897736](https://github.com/sagemath/sagetrac-mirror/commit/7897736d7ae2e4b38bee1f6396629982f03be1df)|`#23416 : typo`|",
    "created_at": "2018-06-04T07:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[7897736](https://github.com/sagemath/sagetrac-mirror/commit/7897736d7ae2e4b38bee1f6396629982f03be1df)|`#23416 : typo`|



---

archive/issue_comments_434557.json:
```json
{
    "body": "Changing commit from \"5ed5ab10ffc002cbc8b0d9ee23c109e50b585991\" to \"7897736d7ae2e4b38bee1f6396629982f03be1df\"",
    "created_at": "2018-06-04T07:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5ed5ab10ffc002cbc8b0d9ee23c109e50b585991" to "7897736d7ae2e4b38bee1f6396629982f03be1df"



---

archive/issue_comments_434558.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-04T07:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434558",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_434559.json:
```json
{
    "body": "<a id='comment:18'></a>\nDone. Sorry, it seems i cannot refrain to ask for permission ;)",
    "created_at": "2018-06-04T07:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434559",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:18'></a>
Done. Sorry, it seems i cannot refrain to ask for permission ;)



---

archive/issue_comments_434560.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-06-07T21:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434560",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_434561.json:
```json
{
    "body": "<a id='comment:19'></a>\n`sage -sws2rst file.sws` puts images into a `file_media` folder. Should we follow the same idea here instead of putting the images in the `.`?",
    "created_at": "2018-06-07T21:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434561",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:19'></a>
`sage -sws2rst file.sws` puts images into a `file_media` folder. Should we follow the same idea here instead of putting the images in the `.`?



---

archive/issue_comments_434562.json:
```json
{
    "body": "<a id='comment:20'></a>\nWhy\n\n\n\n```\n        sage: L = [\"sage\", \"--ipynb2rst\", input, output]\n        sage: try:\n        ....:     _ = test_executable(['pandoc', '--version'])\n        ....: except OSError:\n        ....:     print('True')\n        ....: else:\n        ....:     _ = test_executable(L)\n        ....:     print(open(output, 'r').read() == t)\n        True\n```\n\ninstead of\n\n```\nsage: L = [\"sage\", \"--ipynb2rst\", input, output]\nsage: _ = test_executable(L)                     # optional: pandoc\nsage: print(open(output, 'r').read() == t)       # optional: pandoc\nTrue\n```\n?",
    "created_at": "2018-06-07T21:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434562",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:20'></a>
Why



```
        sage: L = ["sage", "--ipynb2rst", input, output]
        sage: try:
        ....:     _ = test_executable(['pandoc', '--version'])
        ....: except OSError:
        ....:     print('True')
        ....: else:
        ....:     _ = test_executable(L)
        ....:     print(open(output, 'r').read() == t)
        True
```

instead of

```
sage: L = ["sage", "--ipynb2rst", input, output]
sage: _ = test_executable(L)                     # optional: pandoc
sage: print(open(output, 'r').read() == t)       # optional: pandoc
True
```
?



---

archive/issue_comments_434563.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [slabbe](#comment%3A20):\n> Why\n> \n> \n> \n> \n> ```\n>         sage: L = [\"sage\", \"--ipynb2rst\", input, output]\n>         sage: try:\n>         ....:     _ = test_executable(['pandoc', '--version'])\n>         ....: except OSError:\n>         ....:     print('True')\n>         ....: else:\n>         ....:     _ = test_executable(L)\n>         ....:     print(open(output, 'r').read() == t)\n>         True\n> ```\n> \n> instead of\n> \n> \n> ```\n> sage: L = [\"sage\", \"--ipynb2rst\", input, output]\n> sage: _ = test_executable(L)                     # optional: pandoc\n> sage: print(open(output, 'r').read() == t)       # optional: pandoc\n> True\n> ```\n> ?\n\n\nBecause pandoc is not an optional package but a system dependency, so the doctest will never be run (unless someone explicitely ask for it).",
    "created_at": "2018-06-07T22:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434563",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:21'></a>
Replying to [slabbe](#comment%3A20):
> Why
> 
> 
> 
> 
> ```
>         sage: L = ["sage", "--ipynb2rst", input, output]
>         sage: try:
>         ....:     _ = test_executable(['pandoc', '--version'])
>         ....: except OSError:
>         ....:     print('True')
>         ....: else:
>         ....:     _ = test_executable(L)
>         ....:     print(open(output, 'r').read() == t)
>         True
> ```
> 
> instead of
> 
> 
> ```
> sage: L = ["sage", "--ipynb2rst", input, output]
> sage: _ = test_executable(L)                     # optional: pandoc
> sage: print(open(output, 'r').read() == t)       # optional: pandoc
> True
> ```
> ?


Because pandoc is not an optional package but a system dependency, so the doctest will never be run (unless someone explicitely ask for it).



---

archive/issue_comments_434564.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [tmonteil](#comment%3A21):\n> Replying to [slabbe](#comment%3A20):\n> > Why\n> > \n> > \n> > \n> > \n> > ```\n> >         sage: L = [\"sage\", \"--ipynb2rst\", input, output]\n> >         sage: try:\n> >         ....:     _ = test_executable(['pandoc', '--version'])\n> >         ....: except OSError:\n> >         ....:     print('True')\n> >         ....: else:\n> >         ....:     _ = test_executable(L)\n> >         ....:     print(open(output, 'r').read() == t)\n> >         True\n> > ```\n> > \n> > instead of\n> > \n> > \n> > ```\n> > sage: L = [\"sage\", \"--ipynb2rst\", input, output]\n> > sage: _ = test_executable(L)                     # optional: pandoc\n> > sage: print(open(output, 'r').read() == t)       # optional: pandoc\n> > True\n> > ```\n> > ?\n\n> \n> Because pandoc is not an optional package but a system dependency, so the doctest will never be run (unless someone explicitely ask for it).\n\n\nyou can add `has_pandoc` in `sage.doctest.external` so that it can be properly detected (see also #25305).",
    "created_at": "2018-06-08T15:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434564",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
Replying to [tmonteil](#comment%3A21):
> Replying to [slabbe](#comment%3A20):
> > Why
> > 
> > 
> > 
> > 
> > ```
> >         sage: L = ["sage", "--ipynb2rst", input, output]
> >         sage: try:
> >         ....:     _ = test_executable(['pandoc', '--version'])
> >         ....: except OSError:
> >         ....:     print('True')
> >         ....: else:
> >         ....:     _ = test_executable(L)
> >         ....:     print(open(output, 'r').read() == t)
> >         True
> > ```
> > 
> > instead of
> > 
> > 
> > ```
> > sage: L = ["sage", "--ipynb2rst", input, output]
> > sage: _ = test_executable(L)                     # optional: pandoc
> > sage: print(open(output, 'r').read() == t)       # optional: pandoc
> > True
> > ```
> > ?

> 
> Because pandoc is not an optional package but a system dependency, so the doctest will never be run (unless someone explicitely ask for it).


you can add `has_pandoc` in `sage.doctest.external` so that it can be properly detected (see also #25305).



---

archive/issue_comments_434565.json:
```json
{
    "body": "<a id='comment:23'></a>\nWhy not. Then, i will wait the next beta to avoid useless rebasing mess.",
    "created_at": "2018-06-08T18:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434565",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:23'></a>
Why not. Then, i will wait the next beta to avoid useless rebasing mess.



---

archive/issue_comments_434566.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[30806a2](https://github.com/sagemath/sagetrac-mirror/commit/30806a273cb4429cfe9a307eba0781cacf7d75af)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|\n|[f935b04](https://github.com/sagemath/sagetrac-mirror/commit/f935b04365e817cd2af37b48a27d8873b2e4892f)|`#23416 : has_pandoc doctest function`|\n|[6e37aa2](https://github.com/sagemath/sagetrac-mirror/commit/6e37aa20c1cc19aaaf8648c90ffe42125f462107)|`#23416 : update cmdline doctest`|",
    "created_at": "2018-07-02T16:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[30806a2](https://github.com/sagemath/sagetrac-mirror/commit/30806a273cb4429cfe9a307eba0781cacf7d75af)|`Merge branch 'u/tmonteil/provide_a__sage__ipynb2rst__command' of trac.sagemath.org:sage into HEAD`|
|[f935b04](https://github.com/sagemath/sagetrac-mirror/commit/f935b04365e817cd2af37b48a27d8873b2e4892f)|`#23416 : has_pandoc doctest function`|
|[6e37aa2](https://github.com/sagemath/sagetrac-mirror/commit/6e37aa20c1cc19aaaf8648c90ffe42125f462107)|`#23416 : update cmdline doctest`|



---

archive/issue_comments_434567.json:
```json
{
    "body": "Changing commit from \"7897736d7ae2e4b38bee1f6396629982f03be1df\" to \"6e37aa20c1cc19aaaf8648c90ffe42125f462107\"",
    "created_at": "2018-07-02T16:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434567",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7897736d7ae2e4b38bee1f6396629982f03be1df" to "6e37aa20c1cc19aaaf8648c90ffe42125f462107"



---

archive/issue_comments_434568.json:
```json
{
    "body": "Changing keywords from \"MathExp2018\" to \"MathExp2018, days94\".",
    "created_at": "2018-07-02T16:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434568",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "MathExp2018" to "MathExp2018, days94".



---

archive/issue_comments_434569.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-07-02T16:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434569",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_434570.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-04T19:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434570",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_434571.json:
```json
{
    "body": "Changing keywords from \"MathExp2018, days94\" to \"MathExp2018, days94, thursdaysbdx\".",
    "created_at": "2018-07-05T09:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434571",
    "user": "https://github.com/seblabbe"
}
```

Changing keywords from "MathExp2018, days94" to "MathExp2018, days94, thursdaysbdx".



---

archive/issue_comments_434572.json:
```json
{
    "body": "Changing branch from \"u/tmonteil/provide_a__sage__ipynb2rst__command\" to \"6e37aa20c1cc19aaaf8648c90ffe42125f462107\"",
    "created_at": "2018-07-08T13:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434572",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/tmonteil/provide_a__sage__ipynb2rst__command" to "6e37aa20c1cc19aaaf8648c90ffe42125f462107"



---

archive/issue_events_076254.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-08T13:05:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23416#event-76254"
}
```



---

archive/issue_comments_434573.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-08T13:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23416#issuecomment-434573",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
