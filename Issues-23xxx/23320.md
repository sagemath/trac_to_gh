# Issue 23320: Fix Expression substitution interface inconsistency

archive/issues_023083.json:
```json
{
    "body": "From tomchor on https://github.com/sagemath/sage/issues/78\n\n```\n...\n>>> a1=var('a_1')\n>>> E=x^a1\n>>> E(a1=1)\n\n a\u2081\nx  \n>>> E(a_1=1)\nx\n...\n>>> E.subs({a1:1})\nx\n```\n\n\nResolution: wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/23320\n\n",
    "closed_at": "2017-07-13T07:54:31Z",
    "created_at": "2017-06-23T12:47:04Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Fix Expression substitution interface inconsistency",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23320",
    "user": "https://github.com/rwst"
}
```
From tomchor on https://github.com/sagemath/sage/issues/78

```
...
>>> a1=var('a_1')
>>> E=x^a1
>>> E(a1=1)

 a₁
x  
>>> E(a_1=1)
x
...
>>> E.subs({a1:1})
x
```


Resolution: wontfix

Issue created by migration from https://trac.sagemath.org/ticket/23320





---

archive/issue_events_060046.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-06-23T23:24:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60046"
}
```



---

archive/issue_comments_437903.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-23T23:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437903",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437904.json:
```json
{
    "body": "<a id='comment:1'></a>I disagree. I would say this is a misuse and tomchor is backwards on what is a representation and what is a variable. `a1` is the representation (i.e., a pointer) in !Python/Sage of the variable `a_1` that is used by the symbolic expression. One reason why we should keep things the way they are is\n\n```\na1 = var('x')\na2 = var('x')\nf = (a1 + e^a2)\n```\nis a function in `x` and cannot be evaluated separately by `a1` and `a2`.",
    "created_at": "2017-06-23T23:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437904",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>I disagree. I would say this is a misuse and tomchor is backwards on what is a representation and what is a variable. `a1` is the representation (i.e., a pointer) in !Python/Sage of the variable `a_1` that is used by the symbolic expression. One reason why we should keep things the way they are is

```
a1 = var('x')
a2 = var('x')
f = (a1 + e^a2)
```
is a function in `x` and cannot be evaluated separately by `a1` and `a2`.



---

archive/issue_comments_437905.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-24T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437905",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_437906.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,7 @@\n From tomchor on https://github.com/sagemath/sage/issues/78\n \n ```\n-I recently started using Sagemath and I noticed this behavior:\n-\n+...\n >>> a1=var('a_1')\n >>> E=x^a1\n >>> E(a1=1)\n@@ -11,12 +10,11 @@\n x  \n >>> E(a_1=1)\n x\n-Should this be the behavior? I feel like this is a bug and the correct way would be to indeed use E(a1=1) because that is the name of the variable, while a_1 is just its representation. For example, if I use Sympy's syntax it works as it should:\n-\n+...\n >>> E.subs({a1:1})\n x\n-I'm using SageMath version 7.5.1 compiled for Linux Mint 18.1.\n ```\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2017-06-24T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437906",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,7 @@
 From tomchor on https://github.com/sagemath/sage/issues/78
 
 ```
-I recently started using Sagemath and I noticed this behavior:
-
+...
 >>> a1=var('a_1')
 >>> E=x^a1
 >>> E(a1=1)
@@ -11,12 +10,11 @@
 x  
 >>> E(a_1=1)
 x
-Should this be the behavior? I feel like this is a bug and the correct way would be to indeed use E(a1=1) because that is the name of the variable, while a_1 is just its representation. For example, if I use Sympy's syntax it works as it should:
-
+...
 >>> E.subs({a1:1})
 x
-I'm using SageMath version 7.5.1 compiled for Linux Mint 18.1.
 ```
+
 
 Comment: 1
 
``````




---

archive/issue_comments_437907.json:
```json
{
    "body": "<a id='comment:2'></a>I agree with your explanation. But note that this ticket is about the inconsistency between \n\n```\nsage: E.subs({a1:1})\nx\nsage: E(a1=1)\nx^a_1\n```\nIt happens because the dict key is immediately replaced but the `kwds` dict key in `a1=1` is not:\n\n```\nsage: {a1:1}\n{a_1: 1}\n```",
    "created_at": "2017-06-24T06:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437907",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>I agree with your explanation. But note that this ticket is about the inconsistency between 

```
sage: E.subs({a1:1})
x
sage: E(a1=1)
x^a_1
```
It happens because the dict key is immediately replaced but the `kwds` dict key in `a1=1` is not:

```
sage: {a1:1}
{a_1: 1}
```



---

archive/issue_events_060047.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-06-24T06:00:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60047"
}
```



---

archive/issue_events_060048.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-06-24T06:00:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60048"
}
```



---

archive/issue_events_060049.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-06-24T06:08:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60049"
}
```



---

archive/issue_events_060050.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-06-24T06:08:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60050"
}
```



---

archive/issue_comments_437908.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-24T06:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437908",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437909.json:
```json
{
    "body": "<a id='comment:3'></a>There is no way around that either because it points to the \"correct\" variable and because they key of the dict is the variable, not a string. So by the time you are doing the substitution, it is evaluated to `'a_1'`. It is the same problem if I called the Python variable `x`. It comes down to understanding the difference between a python variable and the actual symbolic variable. IMO, this is the correct behavior.",
    "created_at": "2017-06-24T06:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437909",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>There is no way around that either because it points to the "correct" variable and because they key of the dict is the variable, not a string. So by the time you are doing the substitution, it is evaluated to `'a_1'`. It is the same problem if I called the Python variable `x`. It comes down to understanding the difference between a python variable and the actual symbolic variable. IMO, this is the correct behavior.



---

archive/issue_comments_437910.json:
```json
{
    "body": "<a id='comment:4'></a>You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?",
    "created_at": "2017-06-24T07:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437910",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?



---

archive/issue_comments_437911.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 rws]:\n> You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?\n\n\nYes, I am sure. In the `kwds` dict, the input is the *string* `'a1'`, not the variable `a1`. We could search the Python namespace for a variable named `a1`. However, this has a number of shortcomings: the Python `a1` could be anything, or worse, someone did `a1 = var('x')` and then the behavior is extremely unexpected (albeit a slightly contrived of an example). Also, how would you differentiate if someone wanted to use variables `a1` and `a_1`? What about if it is defined as a local variable in a function?\n\nI believe that anytime we have to go find a variable in all Python variables (which is very [relatively] expensive) gives off a very strong code smell. In my mind, the variable is `a_1`, not the Python pointer `a1`, and we should not move away from that as it is a huge can of worms.",
    "created_at": "2017-06-24T13:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437911",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>Replying to [comment:4 rws]:
> You are sure that the entry `a1` in the `kwds` dict that is created with `E(a1=1)` cannot be replaced with `a_1`, in order to make the behaviour consistent? I disagree. The dict entry there is a string, and the problem is 'just' to get the object that is pointed to. This knowledge is somewhere in the ipython shell, isn't it?


Yes, I am sure. In the `kwds` dict, the input is the *string* `'a1'`, not the variable `a1`. We could search the Python namespace for a variable named `a1`. However, this has a number of shortcomings: the Python `a1` could be anything, or worse, someone did `a1 = var('x')` and then the behavior is extremely unexpected (albeit a slightly contrived of an example). Also, how would you differentiate if someone wanted to use variables `a1` and `a_1`? What about if it is defined as a local variable in a function?

I believe that anytime we have to go find a variable in all Python variables (which is very [relatively] expensive) gives off a very strong code smell. In my mind, the variable is `a_1`, not the Python pointer `a1`, and we should not move away from that as it is a huge can of worms.



---

archive/issue_comments_437912.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-24T13:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437912",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437913.json:
```json
{
    "body": "<a id='comment:7'></a>IMHO for this inherent inconsistency the usage of `ex.subs(a=b)` should be discouraged in favor of `ex.subs(a==b)`.",
    "created_at": "2017-06-24T14:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437913",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>IMHO for this inherent inconsistency the usage of `ex.subs(a=b)` should be discouraged in favor of `ex.subs(a==b)`.



---

archive/issue_comments_437914.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-07-13T07:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437914",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix



---

archive/issue_events_060051.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23320#event-60051"
}
```



---

archive/issue_comments_437915.json:
```json
{
    "body": "<a id='comment:8'></a>Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).",
    "created_at": "2017-07-13T07:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23320#issuecomment-437915",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).
