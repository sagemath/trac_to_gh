# Issue 23787: py3: richcmp for ideals

archive/issues_023550.json:
```json
{
    "assignees": [],
    "body": "as another small step towards py3\n\nCC:  @jdemeyer @tscrim @jhpalmieri\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**\n\nBranch: **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**\n\nReviewer: **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23787_\n\n",
    "closed_at": "2017-11-02T11:06:02Z",
    "created_at": "2017-09-05T19:28:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: richcmp for ideals",
    "type": "issue",
    "updated_at": "2017-12-08T14:53:22Z",
    "url": "https://github.com/sagemath/sage/issues/23787",
    "user": "https://github.com/fchapoton"
}
```
as another small step towards py3

CC:  @jdemeyer @tscrim @jhpalmieri

Component: **python3**

Author: **Frédéric Chapoton, Travis Scrimshaw**

Branch: **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**

Reviewer: **Travis Scrimshaw, Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/23787_





---

archive/issue_events_327634.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327634"
}
```



---

archive/issue_events_327635.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327635"
}
```



---

archive/issue_events_327636.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327636"
}
```



---

archive/issue_events_327637.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327637"
}
```



---

archive/issue_comments_358705.json:
```json
{
    "body": "Commit: **[`f227266`](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)**",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358705",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`f227266`](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)**



---

archive/issue_comments_358706.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nsome doctests are failing, needs to be investigated\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77\"><code>f227266</code></a></td><td><code>py3: rich comparison of ideals</code></td></tr></table>\n",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358706",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

some doctests are failing, needs to be investigated

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77"><code>f227266</code></a></td><td><code>py3: rich comparison of ideals</code></td></tr></table>




---

archive/issue_comments_358707.json:
```json
{
    "body": "Branch: **[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)**",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358707",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)**



---

archive/issue_events_327638.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:29:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327638"
}
```



---

archive/issue_comments_358708.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nTypically, one would replace `__cmp__` by `__richcmp__`, not `_richcmp_`.",
    "created_at": "2017-09-06T07:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358708",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Typically, one would replace `__cmp__` by `__richcmp__`, not `_richcmp_`.



---

archive/issue_comments_358709.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is work in progress.. But one has\n\n```\nclass Ideal_generic(MonoidElement)\n```\nso every ideal is an \"Element\"...",
    "created_at": "2017-09-06T08:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358709",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

This is work in progress.. But one has

```
class Ideal_generic(MonoidElement)
```
so every ideal is an "Element"...



---

archive/issue_comments_358710.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt looks like all of the failures are related to the ordering of the ideals. You have introduced at least one behavior change: Principal ideals used to be considered as smaller as non-principal ideals, but now that no longer holds on your branch. So this should fix the test failure in `rings/ideal.py`. I suspect the others are coming from your changes in `rings/number_field/number_field_ideal.py`.",
    "created_at": "2017-09-07T05:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358710",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

It looks like all of the failures are related to the ordering of the ideals. You have introduced at least one behavior change: Principal ideals used to be considered as smaller as non-principal ideals, but now that no longer holds on your branch. So this should fix the test failure in `rings/ideal.py`. I suspect the others are coming from your changes in `rings/number_field/number_field_ideal.py`.



---

archive/issue_comments_358711.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPS, this will conflict with changes on #22982. However, I suspect this will be ready first.",
    "created_at": "2017-09-07T05:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358711",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

PS, this will conflict with changes on #22982. However, I suspect this will be ready first.



---

archive/issue_comments_358712.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI suspect that this ticket here will be **hard** to fix. If it was easy, this would not be my third or 4th failing tentative to solve the issue.",
    "created_at": "2017-09-07T08:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358712",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

I suspect that this ticket here will be **hard** to fix. If it was easy, this would not be my third or 4th failing tentative to solve the issue.



---

archive/issue_comments_358713.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1815de66ed2ffb1ff9e95ff2b947cbe5f31b3f0e\"><code>1815de6</code></a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134\"><code>b0a8866</code></a></td><td><code>trac 23787 detail</code></td></tr></table>\n",
    "created_at": "2017-09-12T19:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358713",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1815de66ed2ffb1ff9e95ff2b947cbe5f31b3f0e"><code>1815de6</code></a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134"><code>b0a8866</code></a></td><td><code>trac 23787 detail</code></td></tr></table>




---

archive/issue_comments_358714.json:
```json
{
    "body": "Changed commit from **[`f227266`](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)** to **[`b0a8866`](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)**",
    "created_at": "2017-09-12T19:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358714",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f227266`](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)** to **[`b0a8866`](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)**



---

archive/issue_events_327639.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-18T13:43:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327639"
}
```



---

archive/issue_events_327640.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-18T13:43:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327640"
}
```



---

archive/issue_comments_358715.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis is now the last set of places where cmp is used.",
    "created_at": "2017-09-22T06:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358715",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">comment:9</div>

This is now the last set of places where cmp is used.



---

archive/issue_comments_358716.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think you need to decide whether you want `__richcmp__` or `_richcmp_` here. I understand why `_richcmp_` makes sense, but then you should also remove the various `isinstance()` checks that are still there.",
    "created_at": "2017-09-22T07:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358716",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

I think you need to decide whether you want `__richcmp__` or `_richcmp_` here. I understand why `_richcmp_` makes sense, but then you should also remove the various `isinstance()` checks that are still there.



---

archive/issue_comments_358717.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIn number field ideals, why add `.sage()` to the PARI instances?",
    "created_at": "2017-09-22T07:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358717",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

In number field ideals, why add `.sage()` to the PARI instances?



---

archive/issue_comments_358718.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment%3A11):\n> In number field ideals, why add `.sage()` to the PARI instances?\n\nBecause the pari objects could not be compared. If you know a better solution, please go on.",
    "created_at": "2017-09-22T07:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358718",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment%3A11):
> In number field ideals, why add `.sage()` to the PARI instances?

Because the pari objects could not be compared. If you know a better solution, please go on.



---

archive/issue_comments_358719.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHmm. It seems that MPolynomialIdeal uses two different semantics for `__lt__` and `__gt___` (for inclusion) and `__cmp__`.",
    "created_at": "2017-09-22T11:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358719",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

Hmm. It seems that MPolynomialIdeal uses two different semantics for `__lt__` and `__gt___` (for inclusion) and `__cmp__`.



---

archive/issue_comments_358720.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI have split-off #23920",
    "created_at": "2017-09-22T13:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358720",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

I have split-off #23920



---

archive/issue_comments_358721.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9\"><code>5d2c453</code></a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b8</code></td></tr></table>\n",
    "created_at": "2017-10-19T18:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358721",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9"><code>5d2c453</code></a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b8</code></td></tr></table>




---

archive/issue_comments_358722.json:
```json
{
    "body": "Changed commit from **[`b0a8866`](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)** to **[`5d2c453`](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)**",
    "created_at": "2017-10-19T18:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358722",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b0a8866`](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)** to **[`5d2c453`](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)**



---

archive/issue_comments_358723.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nJeroen, is there a way to change the following behaviour (cmp works but not richcmp on cypari Gen objects) ?\n\n```\nsage: from sage.structure.richcmp import *\nsage: K.<a, b> = NumberField([x^2 + 23, x^2 - 7])\nsage: I = K.ideal(2, (a + 2*b + 3)/2)\nsage: J = K.ideal(2, a - b)\nsage: richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n<ipython-input-24-c3ae4cea545c> in <module>()\n----> 1 richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)\n\n/home/chapoton/sage/src/sage/structure/richcmp.pyx in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:1361)()\n    103         False\n    104     \"\"\"\n--> 105     return PyObject_RichCompare(x, y, op)\n    106 \n    107 \n\ncypari2/gen.pyx in cypari2.gen.Gen.__richcmp__()\n\ncypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()\n\nPariError: forbidden comparison t_VEC (2 elts) , t_VEC (2 elts)\nsage: cmp(I.pari_rhnf(), J.pari_rhnf())\n-1\n```",
    "created_at": "2017-10-20T19:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358723",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

Jeroen, is there a way to change the following behaviour (cmp works but not richcmp on cypari Gen objects) ?

```
sage: from sage.structure.richcmp import *
sage: K.<a, b> = NumberField([x^2 + 23, x^2 - 7])
sage: I = K.ideal(2, (a + 2*b + 3)/2)
sage: J = K.ideal(2, a - b)
sage: richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
<ipython-input-24-c3ae4cea545c> in <module>()
----> 1 richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)

/home/chapoton/sage/src/sage/structure/richcmp.pyx in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:1361)()
    103         False
    104     """
--> 105     return PyObject_RichCompare(x, y, op)
    106 
    107 

cypari2/gen.pyx in cypari2.gen.Gen.__richcmp__()

cypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()

PariError: forbidden comparison t_VEC (2 elts) , t_VEC (2 elts)
sage: cmp(I.pari_rhnf(), J.pari_rhnf())
-1
```



---

archive/issue_comments_358724.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nJeroen, any idea for my previous question, please ?",
    "created_at": "2017-10-26T18:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358724",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

Jeroen, any idea for my previous question, please ?



---

archive/issue_comments_358725.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis ticket (last call to cmp anywhere) seem to be stuck..\n\nThe current branch has only 4 very mild failing doctests, that I have failed to understand and fix.\n\nOpinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?",
    "created_at": "2017-10-30T16:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358725",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

This ticket (last call to cmp anywhere) seem to be stuck..

The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.

Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?



---

archive/issue_comments_358726.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@fchapoton](#comment%3A18):\n> This ticket (last call to cmp anywhere) seem to be stuck..\n\nWow, that is amazing. Thank you for all your work so far. Now to get over this.\n\n> The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.\n\nI will look into them today. Although I don't know anything about [comment:16](#comment%3A16).\n\n> Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?\n\nI think we should try to match the existing behavior, or at least understand why the changes are necessary. The tests that have a different order are not so big IMO, but the `I < J` and `J > I` test failing should be explained.",
    "created_at": "2017-10-30T22:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358726",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@fchapoton](#comment%3A18):
> This ticket (last call to cmp anywhere) seem to be stuck..

Wow, that is amazing. Thank you for all your work so far. Now to get over this.

> The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.

I will look into them today. Although I don't know anything about [comment:16](#comment%3A16).

> Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?

I think we should try to match the existing behavior, or at least understand why the changes are necessary. The tests that have a different order are not so big IMO, but the `I < J` and `J > I` test failing should be explained.



---

archive/issue_comments_358727.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe change in the output for the `SUK = UnitGroup(K,S=21); SUK` test comes down to sorting in the `factorization` object.",
    "created_at": "2017-10-30T23:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358727",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

The change in the output for the `SUK = UnitGroup(K,S=21); SUK` test comes down to sorting in the `factorization` object.



---

archive/issue_comments_358728.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe `cmp` calls `Gen.__cmp__` calls PARI's `cmp_universal`, which has no mathematical meaning [according to the docs](https://pari.math.u-bordeaux.fr/dochtml/html-stable/Standard_monadic_or_dyadic_operators.html). So converting back to Sage objects and doing the comparison is a much better comparison IMO. Subsequently that is a test we can simply update.",
    "created_at": "2017-10-30T23:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358728",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

The `cmp` calls `Gen.__cmp__` calls PARI's `cmp_universal`, which has no mathematical meaning [according to the docs](https://pari.math.u-bordeaux.fr/dochtml/html-stable/Standard_monadic_or_dyadic_operators.html). So converting back to Sage objects and doing the comparison is a much better comparison IMO. Subsequently that is a test we can simply update.



---

archive/issue_comments_358729.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe test in `Ideal_principal._richcmp_` does not actually test that code:\n\n```\nsage: I.__class__.__mro__\n(<class 'sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal'>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr at 0x7f98c6dbc668>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_base_repr at 0x7f98c6dbc600>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_macaulay2_repr at 0x7f98c6dbc6d0>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_magma_repr at 0x7f98c6dbc598>,\n <class 'sage.rings.ideal.Ideal_generic'>,\n <type 'sage.structure.element.MonoidElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\n```\nHowever, all the same, that is not the problem. Something very strange is going on:\n\n```\nsage: [richcmp(I.gens(), J.gens(), val) for val in range(6)]  # Defines the behavior\n[False, False, False, True, True, True]\nsage: [richcmp(I, J, val) for val in range(6)]  # What?\n[True, True, False, True, False, False]\nsage: [I._richcmp_(J, val) for val in range(6)]  # What!?!?!?\n[False, False, False, True, True, True]\n```",
    "created_at": "2017-10-30T23:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358729",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

The test in `Ideal_principal._richcmp_` does not actually test that code:

```
sage: I.__class__.__mro__
(<class 'sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal'>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr at 0x7f98c6dbc668>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_base_repr at 0x7f98c6dbc600>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_macaulay2_repr at 0x7f98c6dbc6d0>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_magma_repr at 0x7f98c6dbc598>,
 <class 'sage.rings.ideal.Ideal_generic'>,
 <type 'sage.structure.element.MonoidElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
```
However, all the same, that is not the problem. Something very strange is going on:

```
sage: [richcmp(I.gens(), J.gens(), val) for val in range(6)]  # Defines the behavior
[False, False, False, True, True, True]
sage: [richcmp(I, J, val) for val in range(6)]  # What?
[True, True, False, True, False, False]
sage: [I._richcmp_(J, val) for val in range(6)]  # What!?!?!?
[False, False, False, True, True, True]
```



---

archive/issue_comments_358730.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOh, I know why. Just look at `I.__richcmp__`, which gives the multivariate comparison (using Gr\u00f6bner bases) and never even sees this code path. So I am going to remove the `I > J` and `J < I` tests.",
    "created_at": "2017-10-30T23:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358730",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Oh, I know why. Just look at `I.__richcmp__`, which gives the multivariate comparison (using Gröbner bases) and never even sees this code path. So I am going to remove the `I > J` and `J < I` tests.



---

archive/issue_comments_358731.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nCorrection, I am going to change the test to not use the multivariate code and actually test that code.",
    "created_at": "2017-10-30T23:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358731",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Correction, I am going to change the test to not use the multivariate code and actually test that code.



---

archive/issue_events_327641.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T00:09:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327641"
}
```



---

archive/issue_events_327642.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T00:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327642"
}
```



---

archive/issue_comments_358732.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358732",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw, Frédéric Chapoton**



---

archive/issue_comments_358733.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOkay, I fixed that and a bug along the way now that the code is actually being tested.\n\nThe remaining failure is the same as the other number field because it was using `cmp_universal`. So I just updated the output.\n\nNeeds review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a0ed9c9d36f5e0cda819374096187c641a3522b\"><code>4a0ed9c</code></a></td><td><code>Merge branch 'u/chapoton/23787' of git://trac.sagemath.org/sage into public/python3/richcmp_ideals-23787</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1838911ba8424748b79dc460324e028680f796f\"><code>d183891</code></a></td><td><code>Updating unit_group.py test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b6624af2fa76e8ee974eb1e51dd57b134912814\"><code>5b6624a</code></a></td><td><code>Actually test the `_richcmp_` code and fixing a bug.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a\"><code>b003684</code></a></td><td><code>Updating test because the ordering of ideals changed.</code></td></tr></table>\n",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358733",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

Okay, I fixed that and a bug along the way now that the code is actually being tested.

The remaining failure is the same as the other number field because it was using `cmp_universal`. So I just updated the output.

Needs review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a0ed9c9d36f5e0cda819374096187c641a3522b"><code>4a0ed9c</code></a></td><td><code>Merge branch 'u/chapoton/23787' of git://trac.sagemath.org/sage into public/python3/richcmp_ideals-23787</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1838911ba8424748b79dc460324e028680f796f"><code>d183891</code></a></td><td><code>Updating unit_group.py test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b6624af2fa76e8ee974eb1e51dd57b134912814"><code>5b6624a</code></a></td><td><code>Actually test the `_richcmp_` code and fixing a bug.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a"><code>b003684</code></a></td><td><code>Updating test because the ordering of ideals changed.</code></td></tr></table>




---

archive/issue_comments_358734.json:
```json
{
    "body": "Changed commit from **[`5d2c453`](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)** to **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358734",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`5d2c453`](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)** to **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**



---

archive/issue_comments_358735.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)** to **[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)**",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358735",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)** to **[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)**



---

archive/issue_comments_358736.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimsaw**",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358736",
    "user": "https://github.com/tscrim"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, Travis Scrimsaw**



---

archive/issue_comments_358737.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThanks a lot. The bot is morally green, so I am going to set this to positive review.",
    "created_at": "2017-10-31T14:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358737",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:26" align="right">comment:26</div>

Thanks a lot. The bot is morally green, so I am going to set this to positive review.



---

archive/issue_events_327643.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-31T14:20:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327643"
}
```



---

archive/issue_events_327644.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-31T14:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327644"
}
```



---

archive/issue_events_327645.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-02T11:06:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327645"
}
```



---

archive/issue_events_327646.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4ddb4717bd30ab7831b393e797f1423478b89dc7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-11-02T11:06:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-327646"
}
```



---

archive/issue_comments_358738.json:
```json
{
    "body": "Changed branch from **[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)** to **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**",
    "created_at": "2017-11-02T11:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358738",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)** to **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)**



---

archive/issue_comments_358739.json:
```json
{
    "body": "Changed commit from **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)** to none",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358739",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`b003684`](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)** to none



---

archive/issue_comments_358740.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimsaw** to **Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw**",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358740",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Frédéric Chapoton, Travis Scrimsaw** to **Frédéric Chapoton, Travis Scrimshaw**



---

archive/issue_comments_358741.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nScrimsaw sounds cool though :-)",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-358741",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Scrimsaw sounds cool though :-)
