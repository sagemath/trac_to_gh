# Issue 23787: py3: richcmp for ideals

archive/issues_023550.json:
```json
{
    "assignees": [],
    "body": "as another small step towards py3\n\n**CC:**  @jdemeyer @tscrim @jhpalmieri\n\n**Branch:** [b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)\n\n**Reviewer:** Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/23787\n\n",
    "closed_at": "2017-11-02T11:06:02Z",
    "created_at": "2017-09-05T19:28:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: richcmp for ideals",
    "type": "issue",
    "updated_at": "2017-12-08T14:53:22Z",
    "url": "https://github.com/sagemath/sage/issues/23787",
    "user": "https://github.com/fchapoton"
}
```
as another small step towards py3

**CC:**  @jdemeyer @tscrim @jhpalmieri

**Branch:** [b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)

**Reviewer:** Travis Scrimshaw, Frédéric Chapoton

**Author:** Frédéric Chapoton, Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/23787





---

archive/issue_events_287328.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287328"
}
```



---

archive/issue_events_287329.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287329"
}
```



---

archive/issue_events_287330.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287330"
}
```



---

archive/issue_comments_361325.json:
```json
{
    "body": "**Commit:** [f227266892a33010320a9b785dcd096d5b7f5c77](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361325",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [f227266892a33010320a9b785dcd096d5b7f5c77](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)



---

archive/issue_comments_361326.json:
```json
{
    "body": "<a id='comment:1'></a>\nsome doctests are failing, needs to be investigated\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77\">f227266</a></td><td><code>py3: rich comparison of ideals</code></td></tr></table>\n",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361326",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
some doctests are failing, needs to be investigated

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77">f227266</a></td><td><code>py3: rich comparison of ideals</code></td></tr></table>




---

archive/issue_comments_361327.json:
```json
{
    "body": "**Branch:** [u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)",
    "created_at": "2017-09-05T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361327",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)



---

archive/issue_events_287331.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-05T19:29:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287331"
}
```



---

archive/issue_comments_361328.json:
```json
{
    "body": "<a id='comment:2'></a>\nTypically, one would replace `__cmp__` by `__richcmp__`, not `_richcmp_`.",
    "created_at": "2017-09-06T07:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361328",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Typically, one would replace `__cmp__` by `__richcmp__`, not `_richcmp_`.



---

archive/issue_comments_361329.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is work in progress.. But one has\n\n```\nclass Ideal_generic(MonoidElement)\n```\nso every ideal is an \"Element\"...",
    "created_at": "2017-09-06T08:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361329",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
This is work in progress.. But one has

```
class Ideal_generic(MonoidElement)
```
so every ideal is an "Element"...



---

archive/issue_comments_361330.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt looks like all of the failures are related to the ordering of the ideals. You have introduced at least one behavior change: Principal ideals used to be considered as smaller as non-principal ideals, but now that no longer holds on your branch. So this should fix the test failure in `rings/ideal.py`. I suspect the others are coming from your changes in `rings/number_field/number_field_ideal.py`.",
    "created_at": "2017-09-07T05:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361330",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
It looks like all of the failures are related to the ordering of the ideals. You have introduced at least one behavior change: Principal ideals used to be considered as smaller as non-principal ideals, but now that no longer holds on your branch. So this should fix the test failure in `rings/ideal.py`. I suspect the others are coming from your changes in `rings/number_field/number_field_ideal.py`.



---

archive/issue_comments_361331.json:
```json
{
    "body": "<a id='comment:5'></a>\nPS, this will conflict with changes on #22982. However, I suspect this will be ready first.",
    "created_at": "2017-09-07T05:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361331",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
PS, this will conflict with changes on #22982. However, I suspect this will be ready first.



---

archive/issue_comments_361332.json:
```json
{
    "body": "<a id='comment:6'></a>\nI suspect that this ticket here will be **hard** to fix. If it was easy, this would not be my third or 4th failing tentative to solve the issue.",
    "created_at": "2017-09-07T08:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361332",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
I suspect that this ticket here will be **hard** to fix. If it was easy, this would not be my third or 4th failing tentative to solve the issue.



---

archive/issue_comments_361333.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1815de66ed2ffb1ff9e95ff2b947cbe5f31b3f0e\">1815de6</a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134\">b0a8866</a></td><td><code>trac 23787 detail</code></td></tr></table>\n",
    "created_at": "2017-09-12T19:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361333",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1815de66ed2ffb1ff9e95ff2b947cbe5f31b3f0e">1815de6</a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134">b0a8866</a></td><td><code>trac 23787 detail</code></td></tr></table>




---

archive/issue_comments_361334.json:
```json
{
    "body": "**Changing commit** from \"[f227266892a33010320a9b785dcd096d5b7f5c77](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)\" to \"[b0a886665b973d75a1e476860ddc33498d193134](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)\".",
    "created_at": "2017-09-12T19:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361334",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[f227266892a33010320a9b785dcd096d5b7f5c77](https://github.com/sagemath/sagetrac-mirror/commit/f227266892a33010320a9b785dcd096d5b7f5c77)" to "[b0a886665b973d75a1e476860ddc33498d193134](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)".



---

archive/issue_events_287332.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-18T13:43:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287332"
}
```



---

archive/issue_events_287333.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-09-18T13:43:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287333"
}
```



---

archive/issue_comments_361335.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis is now the last set of places where cmp is used.",
    "created_at": "2017-09-22T06:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361335",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
This is now the last set of places where cmp is used.



---

archive/issue_comments_361336.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think you need to decide whether you want `__richcmp__` or `_richcmp_` here. I understand why `_richcmp_` makes sense, but then you should also remove the various `isinstance()` checks that are still there.",
    "created_at": "2017-09-22T07:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361336",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
I think you need to decide whether you want `__richcmp__` or `_richcmp_` here. I understand why `_richcmp_` makes sense, but then you should also remove the various `isinstance()` checks that are still there.



---

archive/issue_comments_361337.json:
```json
{
    "body": "<a id='comment:11'></a>\nIn number field ideals, why add `.sage()` to the PARI instances?",
    "created_at": "2017-09-22T07:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361337",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
In number field ideals, why add `.sage()` to the PARI instances?



---

archive/issue_comments_361338.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@jdemeyer](#comment%3A11):\n> In number field ideals, why add `.sage()` to the PARI instances?\n\nBecause the pari objects could not be compared. If you know a better solution, please go on.",
    "created_at": "2017-09-22T07:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361338",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
Replying to [@jdemeyer](#comment%3A11):
> In number field ideals, why add `.sage()` to the PARI instances?

Because the pari objects could not be compared. If you know a better solution, please go on.



---

archive/issue_comments_361339.json:
```json
{
    "body": "<a id='comment:13'></a>\nHmm. It seems that MPolynomialIdeal uses two different semantics for `__lt__` and `__gt___` (for inclusion) and `__cmp__`.",
    "created_at": "2017-09-22T11:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361339",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Hmm. It seems that MPolynomialIdeal uses two different semantics for `__lt__` and `__gt___` (for inclusion) and `__cmp__`.



---

archive/issue_comments_361340.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have split-off #23920",
    "created_at": "2017-09-22T13:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361340",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
I have split-off #23920



---

archive/issue_comments_361341.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9\">5d2c453</a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b8</code></td></tr></table>\n",
    "created_at": "2017-10-19T18:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361341",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9">5d2c453</a></td><td><code>Merge branch 'u/chapoton/23787' in 8.1.b8</code></td></tr></table>




---

archive/issue_comments_361342.json:
```json
{
    "body": "**Changing commit** from \"[b0a886665b973d75a1e476860ddc33498d193134](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)\" to \"[5d2c453759ce8cb1f73e5f871b449bdc101153d9](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)\".",
    "created_at": "2017-10-19T18:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361342",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[b0a886665b973d75a1e476860ddc33498d193134](https://github.com/sagemath/sagetrac-mirror/commit/b0a886665b973d75a1e476860ddc33498d193134)" to "[5d2c453759ce8cb1f73e5f871b449bdc101153d9](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)".



---

archive/issue_comments_361343.json:
```json
{
    "body": "<a id='comment:16'></a>\nJeroen, is there a way to change the following behaviour (cmp works but not richcmp on cypari Gen objects) ?\n\n```\nsage: from sage.structure.richcmp import *\nsage: K.<a, b> = NumberField([x^2 + 23, x^2 - 7])\nsage: I = K.ideal(2, (a + 2*b + 3)/2)\nsage: J = K.ideal(2, a - b)\nsage: richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n<ipython-input-24-c3ae4cea545c> in <module>()\n----> 1 richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)\n\n/home/chapoton/sage/src/sage/structure/richcmp.pyx in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:1361)()\n    103         False\n    104     \"\"\"\n--> 105     return PyObject_RichCompare(x, y, op)\n    106 \n    107 \n\ncypari2/gen.pyx in cypari2.gen.Gen.__richcmp__()\n\ncypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()\n\nPariError: forbidden comparison t_VEC (2 elts) , t_VEC (2 elts)\nsage: cmp(I.pari_rhnf(), J.pari_rhnf())\n-1\n```",
    "created_at": "2017-10-20T19:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361343",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Jeroen, is there a way to change the following behaviour (cmp works but not richcmp on cypari Gen objects) ?

```
sage: from sage.structure.richcmp import *
sage: K.<a, b> = NumberField([x^2 + 23, x^2 - 7])
sage: I = K.ideal(2, (a + 2*b + 3)/2)
sage: J = K.ideal(2, a - b)
sage: richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
<ipython-input-24-c3ae4cea545c> in <module>()
----> 1 richcmp(I.pari_rhnf(), J.pari_rhnf() , op_LE)

/home/chapoton/sage/src/sage/structure/richcmp.pyx in sage.structure.richcmp.richcmp (build/cythonized/sage/structure/richcmp.c:1361)()
    103         False
    104     """
--> 105     return PyObject_RichCompare(x, y, op)
    106 
    107 

cypari2/gen.pyx in cypari2.gen.Gen.__richcmp__()

cypari2/handle_error.pyx in cypari2.handle_error._pari_err_handle()

PariError: forbidden comparison t_VEC (2 elts) , t_VEC (2 elts)
sage: cmp(I.pari_rhnf(), J.pari_rhnf())
-1
```



---

archive/issue_comments_361344.json:
```json
{
    "body": "<a id='comment:17'></a>\nJeroen, any idea for my previous question, please ?",
    "created_at": "2017-10-26T18:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361344",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>
Jeroen, any idea for my previous question, please ?



---

archive/issue_comments_361345.json:
```json
{
    "body": "<a id='comment:18'></a>\nThis ticket (last call to cmp anywhere) seem to be stuck..\n\nThe current branch has only 4 very mild failing doctests, that I have failed to understand and fix.\n\nOpinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?",
    "created_at": "2017-10-30T16:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361345",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
This ticket (last call to cmp anywhere) seem to be stuck..

The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.

Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?



---

archive/issue_comments_361346.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@fchapoton](#comment%3A18):\n> This ticket (last call to cmp anywhere) seem to be stuck..\n\nWow, that is amazing. Thank you for all your work so far. Now to get over this.\n\n> The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.\n\nI will look into them today. Although I don't know anything about [comment:16](#comment%3A16).\n\n> Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?\n\nI think we should try to match the existing behavior, or at least understand why the changes are necessary. The tests that have a different order are not so big IMO, but the `I < J` and `J > I` test failing should be explained.",
    "created_at": "2017-10-30T22:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361346",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [@fchapoton](#comment%3A18):
> This ticket (last call to cmp anywhere) seem to be stuck..

Wow, that is amazing. Thank you for all your work so far. Now to get over this.

> The current branch has only 4 very mild failing doctests, that I have failed to understand and fix.

I will look into them today. Although I don't know anything about [comment:16](#comment%3A16).

> Opinion required, please. Should I just fix the doctests, or should one try to match absolutely the existing behaviour ?

I think we should try to match the existing behavior, or at least understand why the changes are necessary. The tests that have a different order are not so big IMO, but the `I < J` and `J > I` test failing should be explained.



---

archive/issue_comments_361347.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe change in the output for the `SUK = UnitGroup(K,S=21); SUK` test comes down to sorting in the `factorization` object.",
    "created_at": "2017-10-30T23:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361347",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
The change in the output for the `SUK = UnitGroup(K,S=21); SUK` test comes down to sorting in the `factorization` object.



---

archive/issue_comments_361348.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe `cmp` calls `Gen.__cmp__` calls PARI's `cmp_universal`, which has no mathematical meaning [according to the docs](https://pari.math.u-bordeaux.fr/dochtml/html-stable/Standard_monadic_or_dyadic_operators.html). So converting back to Sage objects and doing the comparison is a much better comparison IMO. Subsequently that is a test we can simply update.",
    "created_at": "2017-10-30T23:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361348",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
The `cmp` calls `Gen.__cmp__` calls PARI's `cmp_universal`, which has no mathematical meaning [according to the docs](https://pari.math.u-bordeaux.fr/dochtml/html-stable/Standard_monadic_or_dyadic_operators.html). So converting back to Sage objects and doing the comparison is a much better comparison IMO. Subsequently that is a test we can simply update.



---

archive/issue_comments_361349.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe test in `Ideal_principal._richcmp_` does not actually test that code:\n\n```\nsage: I.__class__.__mro__\n(<class 'sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal'>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr at 0x7f98c6dbc668>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_base_repr at 0x7f98c6dbc600>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_macaulay2_repr at 0x7f98c6dbc6d0>,\n <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_magma_repr at 0x7f98c6dbc598>,\n <class 'sage.rings.ideal.Ideal_generic'>,\n <type 'sage.structure.element.MonoidElement'>,\n <type 'sage.structure.element.Element'>,\n <type 'sage.structure.sage_object.SageObject'>,\n <type 'object'>)\n```\nHowever, all the same, that is not the problem. Something very strange is going on:\n\n```\nsage: [richcmp(I.gens(), J.gens(), val) for val in range(6)]  # Defines the behavior\n[False, False, False, True, True, True]\nsage: [richcmp(I, J, val) for val in range(6)]  # What?\n[True, True, False, True, False, False]\nsage: [I._richcmp_(J, val) for val in range(6)]  # What!?!?!?\n[False, False, False, True, True, True]\n```",
    "created_at": "2017-10-30T23:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361349",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
The test in `Ideal_principal._richcmp_` does not actually test that code:

```
sage: I.__class__.__mro__
(<class 'sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal'>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr at 0x7f98c6dbc668>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_base_repr at 0x7f98c6dbc600>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_macaulay2_repr at 0x7f98c6dbc6d0>,
 <class sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_magma_repr at 0x7f98c6dbc598>,
 <class 'sage.rings.ideal.Ideal_generic'>,
 <type 'sage.structure.element.MonoidElement'>,
 <type 'sage.structure.element.Element'>,
 <type 'sage.structure.sage_object.SageObject'>,
 <type 'object'>)
```
However, all the same, that is not the problem. Something very strange is going on:

```
sage: [richcmp(I.gens(), J.gens(), val) for val in range(6)]  # Defines the behavior
[False, False, False, True, True, True]
sage: [richcmp(I, J, val) for val in range(6)]  # What?
[True, True, False, True, False, False]
sage: [I._richcmp_(J, val) for val in range(6)]  # What!?!?!?
[False, False, False, True, True, True]
```



---

archive/issue_comments_361350.json:
```json
{
    "body": "<a id='comment:23'></a>\nOh, I know why. Just look at `I.__richcmp__`, which gives the multivariate comparison (using Gr\u00f6bner bases) and never even sees this code path. So I am going to remove the `I > J` and `J < I` tests.",
    "created_at": "2017-10-30T23:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361350",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
Oh, I know why. Just look at `I.__richcmp__`, which gives the multivariate comparison (using Gröbner bases) and never even sees this code path. So I am going to remove the `I > J` and `J < I` tests.



---

archive/issue_comments_361351.json:
```json
{
    "body": "<a id='comment:24'></a>\nCorrection, I am going to change the test to not use the multivariate code and actually test that code.",
    "created_at": "2017-10-30T23:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361351",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
Correction, I am going to change the test to not use the multivariate code and actually test that code.



---

archive/issue_events_287334.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T00:09:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287334"
}
```



---

archive/issue_events_287335.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T00:09:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287335"
}
```



---

archive/issue_comments_361352.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361352",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw, Frédéric Chapoton



---

archive/issue_comments_361353.json:
```json
{
    "body": "<a id='comment:25'></a>\nOkay, I fixed that and a bug along the way now that the code is actually being tested.\n\nThe remaining failure is the same as the other number field because it was using `cmp_universal`. So I just updated the output.\n\nNeeds review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a0ed9c9d36f5e0cda819374096187c641a3522b\">4a0ed9c</a></td><td><code>Merge branch 'u/chapoton/23787' of git://trac.sagemath.org/sage into public/python3/richcmp_ideals-23787</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1838911ba8424748b79dc460324e028680f796f\">d183891</a></td><td><code>Updating unit_group.py test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b6624af2fa76e8ee974eb1e51dd57b134912814\">5b6624a</a></td><td><code>Actually test the `_richcmp_` code and fixing a bug.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a\">b003684</a></td><td><code>Updating test because the ordering of ideals changed.</code></td></tr></table>\n",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361353",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>
Okay, I fixed that and a bug along the way now that the code is actually being tested.

The remaining failure is the same as the other number field because it was using `cmp_universal`. So I just updated the output.

Needs review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a0ed9c9d36f5e0cda819374096187c641a3522b">4a0ed9c</a></td><td><code>Merge branch 'u/chapoton/23787' of git://trac.sagemath.org/sage into public/python3/richcmp_ideals-23787</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1838911ba8424748b79dc460324e028680f796f">d183891</a></td><td><code>Updating unit_group.py test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b6624af2fa76e8ee974eb1e51dd57b134912814">5b6624a</a></td><td><code>Actually test the `_richcmp_` code and fixing a bug.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a">b003684</a></td><td><code>Updating test because the ordering of ideals changed.</code></td></tr></table>




---

archive/issue_comments_361354.json:
```json
{
    "body": "**Changing commit** from \"[5d2c453759ce8cb1f73e5f871b449bdc101153d9](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)\" to \"[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)\".",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361354",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[5d2c453759ce8cb1f73e5f871b449bdc101153d9](https://github.com/sagemath/sagetrac-mirror/commit/5d2c453759ce8cb1f73e5f871b449bdc101153d9)" to "[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)".



---

archive/issue_comments_361355.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)\" to \"[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)\".",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361355",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/chapoton/23787](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23787)" to "[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)".



---

archive/issue_comments_361356.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Travis Scrimsaw\".",
    "created_at": "2017-10-31T00:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361356",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Travis Scrimsaw".



---

archive/issue_comments_361357.json:
```json
{
    "body": "<a id='comment:26'></a>\nThanks a lot. The bot is morally green, so I am going to set this to positive review.",
    "created_at": "2017-10-31T14:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361357",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
Thanks a lot. The bot is morally green, so I am going to set this to positive review.



---

archive/issue_events_287336.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-31T14:20:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287336"
}
```



---

archive/issue_events_287337.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-10-31T14:20:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287337"
}
```



---

archive/issue_events_287338.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-02T11:06:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287338"
}
```



---

archive/issue_events_287339.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4ddb4717bd30ab7831b393e797f1423478b89dc7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-11-02T11:06:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23787#event-287339"
}
```



---

archive/issue_comments_361358.json:
```json
{
    "body": "**Changing branch** from \"[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)\" to \"[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)\".",
    "created_at": "2017-11-02T11:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361358",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/python3/richcmp_ideals-23787](https://github.com/sagemath/sagetrac-mirror/tree/public/python3/richcmp_ideals-23787)" to "[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)".



---

archive/issue_comments_361359.json:
```json
{
    "body": "**Changing commit** from \"[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)\" to \"\".",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361359",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[b003684f2eead00ca678a8b27db0235a64396d0a](https://github.com/sagemath/sagetrac-mirror/commit/b003684f2eead00ca678a8b27db0235a64396d0a)" to "".



---

archive/issue_comments_361360.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton, Travis Scrimsaw\" to \"Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\".",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361360",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Frédéric Chapoton, Travis Scrimsaw" to "Frédéric Chapoton, Travis Scrimshaw".



---

archive/issue_comments_361361.json:
```json
{
    "body": "<a id='comment:28'></a>\nScrimsaw sounds cool though :-)",
    "created_at": "2017-12-08T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23787",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23787#issuecomment-361361",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Scrimsaw sounds cool though :-)
