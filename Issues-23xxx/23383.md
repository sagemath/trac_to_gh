# Issue 23383: Speeding up congruence-related lattice functions

archive/issues_023146.json:
```json
{
    "assignees": [],
    "body": "This patch adds precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. If `L = Posets.BooleanLattice(7)`, then we have\n\n```\nsage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n5 loops, best of 3: 4.63 s per loop\n```\n\nand after `L._hasse_diagram._precompute_intervals()`\n\n```\nsage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n5 loops, best of 3: 656 ms per loop\n```\n\nOTOH this will eat memory.\n\nCurrently this feature is well hidden, only available as a `_`-function of a `_`-variable. Later we should think about interface. A global \"save-cpu-eat-memory\" -switch or \"aux functions\" to lattices (posets?) or something else?\n\nCC:  @tscrim @fchapoton\n\nBranch/Commit: **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jori M\u00e4ntysalo**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23383_\n\n",
    "closed_at": "2017-07-29T15:30:50Z",
    "created_at": "2017-07-07T08:13:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speeding up congruence-related lattice functions",
    "type": "issue",
    "updated_at": "2017-07-29T15:30:50Z",
    "url": "https://github.com/sagemath/sage/issues/23383",
    "user": "https://github.com/jm58660"
}
```
This patch adds precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. If `L = Posets.BooleanLattice(7)`, then we have

```
sage: timeit("list(L._hasse_diagram.congruences_iterator())")
5 loops, best of 3: 4.63 s per loop
```

and after `L._hasse_diagram._precompute_intervals()`

```
sage: timeit("list(L._hasse_diagram.congruences_iterator())")
5 loops, best of 3: 656 ms per loop
```

OTOH this will eat memory.

Currently this feature is well hidden, only available as a `_`-function of a `_`-variable. Later we should think about interface. A global "save-cpu-eat-memory" -switch or "aux functions" to lattices (posets?) or something else?

CC:  @tscrim @fchapoton

Branch/Commit: **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**

Reviewer: **Travis Scrimshaw**

Author: **Jori MÃ¤ntysalo**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/23383_





---

archive/issue_events_325508.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-07T08:13:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325508"
}
```



---

archive/issue_events_325509.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-07T08:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325509"
}
```



---

archive/issue_events_325510.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-07T08:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325510"
}
```



---

archive/issue_events_325511.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-07T08:13:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325511"
}
```



---

archive/issue_comments_351174.json:
```json
{
    "body": "Branch: **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)**",
    "created_at": "2017-07-07T08:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351174",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)**



---

archive/issue_events_325512.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-07T08:14:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325512"
}
```



---

archive/issue_comments_351175.json:
```json
{
    "body": "Changed branch from **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)** to none",
    "created_at": "2017-07-07T08:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351175",
    "user": "https://github.com/jm58660"
}
```

Changed branch from **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)** to none



---

archive/issue_comments_351176.json:
```json
{
    "body": "Branch: **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)**",
    "created_at": "2017-07-07T08:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351176",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)**



---

archive/issue_comments_351177.json:
```json
{
    "body": "Commit: **[`4b183a2`](https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36)**",
    "created_at": "2017-07-07T14:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351177",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`4b183a2`](https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36)**



---

archive/issue_comments_351178.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type. Although it is part of the API for `HasseDiagram`, thus, it technically is a backwards incompatible change.\n\nAlso, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2. Also, a better way to populate `_intervals`:\n\n```\nself._intervals = {u: {v: v_up[u].intersection(v_down[v]) for v in range(n)}\n                   for u in range(n)}\n```\nThere is no need to create the empty object and you save a lot of Python calls by doing the dict comprehension.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36\">4b183a2</a></td><td><code>Precomputing intervals of HasseDiagram.</code></td></tr></table>\n",
    "created_at": "2017-07-07T14:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351178",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

I consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type. Although it is part of the API for `HasseDiagram`, thus, it technically is a backwards incompatible change.

Also, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2. Also, a better way to populate `_intervals`:

```
self._intervals = {u: {v: v_up[u].intersection(v_down[v]) for v in range(n)}
                   for u in range(n)}
```
There is no need to create the empty object and you save a lot of Python calls by doing the dict comprehension.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36">4b183a2</a></td><td><code>Precomputing intervals of HasseDiagram.</code></td></tr></table>




---

archive/issue_comments_351179.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@tscrim](#comment:4):\n\n> Also, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2.\n\nActually, even faster should be a list of lists, that needs no lookup at all.\n\n> There is no need to create the empty object and you save a lot of Python calls by doing the dict comprehension.\n\nTrue. I was thinking about lists but then somehow ended up to dict in this PoC.\n\nAnd now the most important:\n\n> I consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type.\n\nOK. I tested by adding precomputing to `__init__` of poset. Only errors I got from long test of `combinat/posets` where from `.open_interval` in `posets.py`. But I think currently intervals are given as in the linear extension order, and that is propably a good thing.",
    "created_at": "2017-07-07T16:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351179",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@tscrim](#comment:4):

> Also, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2.

Actually, even faster should be a list of lists, that needs no lookup at all.

> There is no need to create the empty object and you save a lot of Python calls by doing the dict comprehension.

True. I was thinking about lists but then somehow ended up to dict in this PoC.

And now the most important:

> I consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type.

OK. I tested by adding precomputing to `__init__` of poset. Only errors I got from long test of `combinat/posets` where from `.open_interval` in `posets.py`. But I think currently intervals are given as in the linear extension order, and that is propably a good thing.



---

archive/issue_comments_351180.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jm58660](#comment:5):\n> Replying to [@tscrim](#comment:4):\n> \n> > Also, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2.\n\n> \n> Actually, even faster should be a list of lists, that needs no lookup at all.\n\nWell, there still is a lookup, but now it is (relatively) very fast. +1 for list of lists.\n\n> > I consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type.\n\n> \n> OK. I tested by adding precomputing to `__init__` of poset. Only errors I got from long test of `combinat/posets` where from `.open_interval` in `posets.py`. But I think currently intervals are given as in the linear extension order, and that is propably a good thing.\n\nI think it would be best if the numbering was done increasing (as that is assumed to be a linear extension IIRC).",
    "created_at": "2017-07-09T06:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351180",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jm58660](#comment:5):
> Replying to [@tscrim](#comment:4):
> 
> > Also, it might be faster to have the `dict` indexed by a pair `(x,y)` as it only needs to do 1 hash and table lookup instead of 2.

> 
> Actually, even faster should be a list of lists, that needs no lookup at all.

Well, there still is a lookup, but now it is (relatively) very fast. +1 for list of lists.

> > I consider Hasse diagrams not as part of the true API, but an implementation detail of posets. So I don't see any problem with changing the output type.

> 
> OK. I tested by adding precomputing to `__init__` of poset. Only errors I got from long test of `combinat/posets` where from `.open_interval` in `posets.py`. But I think currently intervals are given as in the linear extension order, and that is propably a good thing.

I think it would be best if the numbering was done increasing (as that is assumed to be a linear extension IIRC).



---

archive/issue_comments_351181.json:
```json
{
    "body": "Changed commit from **[`4b183a2`](https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36)** to **[`0cafe94`](https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f)**",
    "created_at": "2017-07-10T09:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351181",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4b183a2`](https://github.com/sagemath/sagetrac-mirror/commit/4b183a23a044589dff27d7f3193057f9756d7f36)** to **[`0cafe94`](https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f)**



---

archive/issue_comments_351182.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f\">0cafe94</a></td><td><code>Use list of lists.</code></td></tr></table>\n",
    "created_at": "2017-07-10T09:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351182",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f">0cafe94</a></td><td><code>Use list of lists.</code></td></tr></table>




---

archive/issue_events_325513.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-10T09:24:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325513"
}
```



---

archive/issue_events_325514.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-10T09:24:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325514"
}
```



---

archive/issue_comments_351183.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHere it is. The speedup is quite big:\n\n```\nsage: L = Posets.BooleanLattice(7)\nsage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n5 loops, best of 3: 4.63 s per loop\nsage: timeit(\"L._hasse_diagram._precompute_intervals()\")\n25 loops, best of 3: 23.6 ms per loop\nsage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n5 loops, best of 3: 656 ms per loop\n```",
    "created_at": "2017-07-10T09:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351183",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:8" align="right">comment:8</div>

Here it is. The speedup is quite big:

```
sage: L = Posets.BooleanLattice(7)
sage: timeit("list(L._hasse_diagram.congruences_iterator())")
5 loops, best of 3: 4.63 s per loop
sage: timeit("L._hasse_diagram._precompute_intervals()")
25 loops, best of 3: 23.6 ms per loop
sage: timeit("list(L._hasse_diagram.congruences_iterator())")
5 loops, best of 3: 656 ms per loop
```



---

archive/issue_events_325515.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-10T09:24:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325515"
}
```



---

archive/issue_events_325516.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-10T09:24:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325516"
}
```



---

archive/issue_events_325517.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-10T15:55:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325517"
}
```



---

archive/issue_events_325518.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-10T15:55:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325518"
}
```



---

archive/issue_comments_351184.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIf you want even more speed:\n\n```diff\n-        v_up = [None] * n\n-        v_down = [None] * n\n-        for v in range(n):\n-            v_up[v] = frozenset(self.depth_first_search(v))\n-            v_down[v] = frozenset(self.depth_first_search(v, neighbors=self.neighbors_in))\n+        v_up = [frozenset(self.depth_first_search(v)) for v in range(n)]\n+        v_down = [frozenset(self.depth_first_search(v, neighbors=self.neighbors_in))\n+                  for v in range(n)]\n \n-        self._intervals = [[None] * n for _ in range(n)]\n-        for u in range(n):\n-            for v in range(n):\n-                self._intervals[u][v] = sorted(v_up[u].intersection(v_down[v]))\n+        self._intervals = [[sorted(up.intersection(down)) for down in v_down]\n+                           for up in v_up]\n```\nI've seen using list comprehension have a significant effect for things like this because of the extra Python overhead.\n\nI do not like the documentation of `_alt_interval`. It should explain what it is doing (well, really it should be similar/same as `interval`. Moreover, you should put somewhere in some documentation about this feature and how to use it. It probably is good to make this part of the API for posets somewhere with a warning about the memory usage.\n\nYou also should update the ticket description.",
    "created_at": "2017-07-10T15:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351184",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

If you want even more speed:

```diff
-        v_up = [None] * n
-        v_down = [None] * n
-        for v in range(n):
-            v_up[v] = frozenset(self.depth_first_search(v))
-            v_down[v] = frozenset(self.depth_first_search(v, neighbors=self.neighbors_in))
+        v_up = [frozenset(self.depth_first_search(v)) for v in range(n)]
+        v_down = [frozenset(self.depth_first_search(v, neighbors=self.neighbors_in))
+                  for v in range(n)]
 
-        self._intervals = [[None] * n for _ in range(n)]
-        for u in range(n):
-            for v in range(n):
-                self._intervals[u][v] = sorted(v_up[u].intersection(v_down[v]))
+        self._intervals = [[sorted(up.intersection(down)) for down in v_down]
+                           for up in v_up]
```
I've seen using list comprehension have a significant effect for things like this because of the extra Python overhead.

I do not like the documentation of `_alt_interval`. It should explain what it is doing (well, really it should be similar/same as `interval`. Moreover, you should put somewhere in some documentation about this feature and how to use it. It probably is good to make this part of the API for posets somewhere with a warning about the memory usage.

You also should update the ticket description.



---

archive/issue_comments_351185.json:
```json
{
    "body": "Changed commit from **[`0cafe94`](https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f)** to **[`5c3e75c`](https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c)**",
    "created_at": "2017-07-11T05:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351185",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0cafe94`](https://github.com/sagemath/sagetrac-mirror/commit/0cafe94f3de78f8b39336173e83ff5759afcd72f)** to **[`5c3e75c`](https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c)**



---

archive/issue_comments_351186.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c\">5c3e75c</a></td><td><code>Use list comprehension.</code></td></tr></table>\n",
    "created_at": "2017-07-11T05:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351186",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c">5c3e75c</a></td><td><code>Use list comprehension.</code></td></tr></table>




---

archive/issue_comments_351187.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n-This patch is PoC for precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. As an example, for `L = posets.BooleanLattice(6)` it takes 1070 ms to compute `L.is_isoform()`. After `L._hasse_diagram._precompute_intervals()` it drops to 560 milliseconds.\n+This patch adds precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. If `L = Posets.BooleanLattice(7)`, then we have\n \n-BUT this will also change the return type of `.interval()` in the Hasse diagram from list to frozenset. Hence I ask if this is a doable way for speedup.\n+```\n+sage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n+5 loops, best of 3: 4.63 s per loop\n+```\n \n+and after `L._hasse_diagram._precompute_intervals()`\n+\n+```\n+sage: timeit(\"list(L._hasse_diagram.congruences_iterator())\")\n+5 loops, best of 3: 656 ms per loop\n+```\n+\n+OTOH this will eat memory.\n+\n+Currently this feature is well hidden, only available as a `_`-function of a `_`-variable. Later we should think about interface. A global \"save-cpu-eat-memory\" -switch or \"aux functions\" to lattices (posets?) or something else?\n``````\n",
    "created_at": "2017-07-11T05:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351187",
    "user": "https://github.com/jm58660"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
-This patch is PoC for precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. As an example, for `L = posets.BooleanLattice(6)` it takes 1070 ms to compute `L.is_isoform()`. After `L._hasse_diagram._precompute_intervals()` it drops to 560 milliseconds.
+This patch adds precomputing intervals in the `HasseDiagram` to speed up some congruence-related lattice functions. If `L = Posets.BooleanLattice(7)`, then we have
 
-BUT this will also change the return type of `.interval()` in the Hasse diagram from list to frozenset. Hence I ask if this is a doable way for speedup.
+```
+sage: timeit("list(L._hasse_diagram.congruences_iterator())")
+5 loops, best of 3: 4.63 s per loop
+```
 
+and after `L._hasse_diagram._precompute_intervals()`
+
+```
+sage: timeit("list(L._hasse_diagram.congruences_iterator())")
+5 loops, best of 3: 656 ms per loop
+```
+
+OTOH this will eat memory.
+
+Currently this feature is well hidden, only available as a `_`-function of a `_`-variable. Later we should think about interface. A global "save-cpu-eat-memory" -switch or "aux functions" to lattices (posets?) or something else?
``````




---

archive/issue_events_325519.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-11T05:48:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325519"
}
```



---

archive/issue_events_325520.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-11T05:48:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325520"
}
```



---

archive/issue_comments_351188.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@tscrim](#comment:9):\n> If you want even more speed:\n\nDone that. And yes, it gives some milliseconds: for `Posets.BooleanLattice(10)` it took 1,65 seconds, now it takes 1,41 seconds. (Of course that means nothing when compared to time to compute congruences.) And the code is shorted and more pythonic.\n\nMuch more speedup should be possible with better algorithm: an interval from `a` with covers `a1` and `a2` to `b` is union of intervals `(a1, b)` and `(a2, b)`.\n\n> I do not like the documentation of `_alt_interval`. It should explain what it is doing (well, really it should be similar/same as `interval`. Moreover, you should put somewhere in some documentation about this feature and how to use it. It probably is good to make this part of the API for posets somewhere with a warning about the memory usage.\n> \n> You also should update the ticket description.\n\nI added a note about this to the description. Needs to think for a while.",
    "created_at": "2017-07-11T05:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351188",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@tscrim](#comment:9):
> If you want even more speed:

Done that. And yes, it gives some milliseconds: for `Posets.BooleanLattice(10)` it took 1,65 seconds, now it takes 1,41 seconds. (Of course that means nothing when compared to time to compute congruences.) And the code is shorted and more pythonic.

Much more speedup should be possible with better algorithm: an interval from `a` with covers `a1` and `a2` to `b` is union of intervals `(a1, b)` and `(a2, b)`.

> I do not like the documentation of `_alt_interval`. It should explain what it is doing (well, really it should be similar/same as `interval`. Moreover, you should put somewhere in some documentation about this feature and how to use it. It probably is good to make this part of the API for posets somewhere with a warning about the memory usage.
> 
> You also should update the ticket description.

I added a note about this to the description. Needs to think for a while.



---

archive/issue_comments_351189.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-07-11T07:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351189",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_351190.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHowever, I still would like to see a bit better of documentation for `_alt_interval` describing the algorithm (i.e., by precomputing) and what you need to do to make it work. In some ways, I don't like the implementation because you need to explicitly call another function first instead of it just working. I am see this through the eyes of someone browsing through the code and seeing this who did not read this specific ticket, which will almost certainly happen at some point.",
    "created_at": "2017-07-11T07:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351190",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

However, I still would like to see a bit better of documentation for `_alt_interval` describing the algorithm (i.e., by precomputing) and what you need to do to make it work. In some ways, I don't like the implementation because you need to explicitly call another function first instead of it just working. I am see this through the eyes of someone browsing through the code and seeing this who did not read this specific ticket, which will almost certainly happen at some point.



---

archive/issue_events_325521.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T07:16:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325521"
}
```



---

archive/issue_events_325522.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-11T07:16:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325522"
}
```



---

archive/issue_comments_351191.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFirst, a technical question: A Python function can return an internal function, i.e. this will print \"Hello\":\n\n```\ndef f():\n    def g(): print(\"Hello\")\n    return g\nf()()\n```\n\nWould it be meaningfull to use this feature, and remove `_alt_interval` from the top level of Hasse diagram?\n\nNow to the main question.\n\nThe problem is, IMO, `UniqueRepresentation`. No created poset will ever be freed from the memory, and so making test with random posets will eventually eat all the memory. And if we compute `lequal_matrix()` or `_meet` etc, those will be saved too. That's why I am worried about this.\n\nWhen should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?\n\nI will formulate longer description for `_atl_interval`.",
    "created_at": "2017-07-11T08:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351191",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:13" align="right">comment:13</div>

First, a technical question: A Python function can return an internal function, i.e. this will print "Hello":

```
def f():
    def g(): print("Hello")
    return g
f()()
```

Would it be meaningfull to use this feature, and remove `_alt_interval` from the top level of Hasse diagram?

Now to the main question.

The problem is, IMO, `UniqueRepresentation`. No created poset will ever be freed from the memory, and so making test with random posets will eventually eat all the memory. And if we compute `lequal_matrix()` or `_meet` etc, those will be saved too. That's why I am worried about this.

When should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?

I will formulate longer description for `_atl_interval`.



---

archive/issue_comments_351192.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae\">99412fe</a></td><td><code>More documentation.</code></td></tr></table>\n",
    "created_at": "2017-07-11T08:39:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351192",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae">99412fe</a></td><td><code>More documentation.</code></td></tr></table>




---

archive/issue_comments_351193.json:
```json
{
    "body": "Changed commit from **[`5c3e75c`](https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c)** to **[`99412fe`](https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae)**",
    "created_at": "2017-07-11T08:39:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351193",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5c3e75c`](https://github.com/sagemath/sagetrac-mirror/commit/5c3e75c90c8807c9fe9fde44f8ea5b471d76382c)** to **[`99412fe`](https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae)**



---

archive/issue_comments_351194.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nMore comments on this? Specially for this:\n\n> When should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?",
    "created_at": "2017-07-21T07:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351194",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:15" align="right">comment:15</div>

More comments on this? Specially for this:

> When should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?



---

archive/issue_events_325523.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-21T07:39:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325523"
}
```



---

archive/issue_events_325524.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-21T07:39:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325524"
}
```



---

archive/issue_comments_351195.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jm58660](#comment:13):\n> First, a technical question: A Python function can return an internal function, i.e. this will print \"Hello\":\n> \n> ```\n> def f():\n>     def g(): print(\"Hello\")\n>     return g\n> f()()\n> ```\n\nYes, that is correct. We return functions in a number of places within Sage too.\n\n> Would it be meaningfull to use this feature, and remove `_alt_interval` from the top level of Hasse diagram?\n\nI do not think so by default because of how much memory this would use. Although it could be something we do for small posets (less that 5 vertices?).\n\n> The problem is, IMO, `UniqueRepresentation`. No created poset will ever be freed from the memory, and so making test with random posets will eventually eat all the memory. And if we compute `lequal_matrix()` or `_meet` etc, those will be saved too. That's why I am worried about this.\n\nThat should not be true. Once you delete all references to a poset, it should be freeable as it is a weak reference (otherwise it is a memory leak bug).\n\n> When should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?\n\nProbably in none of these places, but instead we should document it as an alternative method for increasing the speed.",
    "created_at": "2017-07-21T23:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351195",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jm58660](#comment:13):
> First, a technical question: A Python function can return an internal function, i.e. this will print "Hello":
> 
> ```
> def f():
>     def g(): print("Hello")
>     return g
> f()()
> ```

Yes, that is correct. We return functions in a number of places within Sage too.

> Would it be meaningfull to use this feature, and remove `_alt_interval` from the top level of Hasse diagram?

I do not think so by default because of how much memory this would use. Although it could be something we do for small posets (less that 5 vertices?).

> The problem is, IMO, `UniqueRepresentation`. No created poset will ever be freed from the memory, and so making test with random posets will eventually eat all the memory. And if we compute `lequal_matrix()` or `_meet` etc, those will be saved too. That's why I am worried about this.

That should not be true. Once you delete all references to a poset, it should be freeable as it is a weak reference (otherwise it is a memory leak bug).

> When should this precomputing be called? In `interval()`? In `congruence()`? In, say, `is_isoform()`?

Probably in none of these places, but instead we should document it as an alternative method for increasing the speed.



---

archive/issue_comments_351196.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@tscrim](#comment:16):\n\n> That should not be true. Once you delete all references to a poset, it should be freeable as it is a weak reference (otherwise it is a memory leak bug).\n\nIf that would be true, then for example this should print the same number again and again:\n\n```\ni = 0\nj = 0\nfor P in Posets(8):\n    j += 1\n    if j % 1000 == 0:\n        print(sage.misc.getusage.get_memory_usage())\n    if P.is_connected():\n        i += 1\nprint(i)\n```\n\n(Compare this with same except `digraphs(8)` instead of `Posets(8)`.)\n\nCurrently there is no way to for example search for counter-example with random posets to unlimited time.",
    "created_at": "2017-07-22T06:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351196",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@tscrim](#comment:16):

> That should not be true. Once you delete all references to a poset, it should be freeable as it is a weak reference (otherwise it is a memory leak bug).

If that would be true, then for example this should print the same number again and again:

```
i = 0
j = 0
for P in Posets(8):
    j += 1
    if j % 1000 == 0:
        print(sage.misc.getusage.get_memory_usage())
    if P.is_connected():
        i += 1
print(i)
```

(Compare this with same except `digraphs(8)` instead of `Posets(8)`.)

Currently there is no way to for example search for counter-example with random posets to unlimited time.



---

archive/issue_comments_351197.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI know `UniqueRepresentation` is a weak cache, and I do not see anything that would explicitly nail it in the memory. What is probably happening is with the iterator populating the cache and moving around all of the memory is not giving the garbage collector time to work. If I force a garbage collection, then the memory usage (basically) does not grow:\n\n```python\nimport gc\ni = 0\nj = 0\nfor P in Posets(8):\n    j += 1\n    if j % 100 == 0:\n        gc.collect()\n        print(sage.misc.getusage.get_memory_usage())\n    if P.is_connected():\n        i += 1\nprint(i)\n```\nIIRC, Python will force a garbage collection to see if it can free up the memory before giving an out-of-memory exception. Although I've never really done anything that would cause that to happen.",
    "created_at": "2017-07-22T11:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351197",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

I know `UniqueRepresentation` is a weak cache, and I do not see anything that would explicitly nail it in the memory. What is probably happening is with the iterator populating the cache and moving around all of the memory is not giving the garbage collector time to work. If I force a garbage collection, then the memory usage (basically) does not grow:

```python
import gc
i = 0
j = 0
for P in Posets(8):
    j += 1
    if j % 100 == 0:
        gc.collect()
        print(sage.misc.getusage.get_memory_usage())
    if P.is_connected():
        i += 1
print(i)
```
IIRC, Python will force a garbage collection to see if it can free up the memory before giving an out-of-memory exception. Although I've never really done anything that would cause that to happen.



---

archive/issue_comments_351198.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@tscrim](#comment:18):\n\nFirst, thanks for `gc.collect()`! I think I have read it before, and totally forget.\n\n> IIRC, Python will force a garbage collection to see if it can free up the memory before giving an out-of-memory exception. Although I've never really done anything that would cause that to happen.\n\nThe problem is propably memory overcommit or usage of every bit of memory. When almost every byte is used, Linux is extremely slow, and so never goes to the limit where Python would give out-of-memory exception.\n\nThis should be handled in Python level or in OS level. Sage can only add some temporary workarounds.",
    "created_at": "2017-07-23T05:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351198",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@tscrim](#comment:18):

First, thanks for `gc.collect()`! I think I have read it before, and totally forget.

> IIRC, Python will force a garbage collection to see if it can free up the memory before giving an out-of-memory exception. Although I've never really done anything that would cause that to happen.

The problem is propably memory overcommit or usage of every bit of memory. When almost every byte is used, Linux is extremely slow, and so never goes to the limit where Python would give out-of-memory exception.

This should be handled in Python level or in OS level. Sage can only add some temporary workarounds.



---

archive/issue_comments_351199.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOne last trivial thing: code format <code>\\`\\`x\\`\\`</code> and <code>\\`\\`y\\`\\`</code> in `_alternate_interval`. Once done, you can set a positive review on my behalf.",
    "created_at": "2017-07-25T00:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351199",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

One last trivial thing: code format <code>\`\`x\`\`</code> and <code>\`\`y\`\`</code> in `_alternate_interval`. Once done, you can set a positive review on my behalf.



---

archive/issue_comments_351200.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4\">6f8c510</a></td><td><code>Docstring formatting.</code></td></tr></table>\n",
    "created_at": "2017-07-25T05:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351200",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4">6f8c510</a></td><td><code>Docstring formatting.</code></td></tr></table>




---

archive/issue_comments_351201.json:
```json
{
    "body": "Changed commit from **[`99412fe`](https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae)** to **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**",
    "created_at": "2017-07-25T05:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351201",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`99412fe`](https://github.com/sagemath/sagetrac-mirror/commit/99412fe92ec3987236d698fa8e2cca11edfa93ae)** to **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**



---

archive/issue_comments_351202.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment:20):\n> One last trivial thing: code format <code>\\`\\`x\\`\\`</code> and <code>\\`\\`y\\`\\`</code> in `_alternate_interval`. Once done, you can set a positive review on my behalf.\n\nDone that.",
    "created_at": "2017-07-25T05:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351202",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment:20):
> One last trivial thing: code format <code>\`\`x\`\`</code> and <code>\`\`y\`\`</code> in `_alternate_interval`. Once done, you can set a positive review on my behalf.

Done that.



---

archive/issue_events_325525.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-25T05:49:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325525"
}
```



---

archive/issue_events_325526.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-07-25T05:49:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325526"
}
```



---

archive/issue_events_325527.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T15:30:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325527"
}
```



---

archive/issue_events_325528.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f15aa1f518d2cabbd8b52fdef829f1eb901d6190",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-07-29T15:30:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23383#event-325528"
}
```



---

archive/issue_comments_351203.json:
```json
{
    "body": "Changed branch from **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)** to **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**",
    "created_at": "2017-07-29T15:30:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23383#issuecomment-351203",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jmantysalo/precompute-intervals](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/precompute-intervals)** to **[`6f8c510`](https://github.com/sagemath/sagetrac-mirror/commit/6f8c5108ad9d96fa548c61d1efcdd9ee757be3d4)**
