# Issue 23711: sage-env: do not depend on matplotlib version number

archive/issues_023474.json:
```json
{
    "body": "So we really need to know the exact matplotlib version number in `sage-env`?\n\n```sh\n# Use a matplotlib config directory specific to Sage and specific to\n# the version number of matplotlib, by setting the environment\n# variable MPLCONFIGDIR. Note that we can't find the version number by\n# importing matplotlib, because that could create matplotlib's standard\n# config directory. So we use pkg_resources.\n\"$SAGE_LOCAL/bin/python\" -c 'import pkg_resources; pkg_resources.get_distribution(\"matplotlib\").version' 2>/dev/null\nif [ $? -eq 0 ]; then\n    MPLVERSION=`\"$SAGE_LOCAL/bin/python\" -c 'import pkg_resources; print (pkg_resources.get_distribution(\"matplotlib\").version)'`\n    MPLCONFIGDIR=\"$DOT_SAGE/matplotlib-$MPLVERSION\"\n    export MPLCONFIGDIR\n    # The directory is created when Sage starts (see sage.misc.misc).\nfi\n```\n\nInstead, we could just hardcode a version number, analogous to what we do for Jupyter:\n\n```sh\nif [ -z \"$IPYTHONDIR\" ]; then\n    # We hardcode a version number in the directory name. The idea is\n    # that we keep using the same version number as long as that is\n    # possible. Only when some future IPython version really requires\n    # a new structure for the $IPYTHONDIR should this version number be\n    # changed to the new IPython version.\n    export IPYTHONDIR=\"$DOT_SAGE/ipython-5.0.0\"\nfi\n\nif [ -z \"$JUPYTER_CONFIG_DIR\" ]; then\n    # We hardcode a version number in the directory name. The idea is\n    # that we keep using the same version number as long as that is\n    # possible. Only when some future Jupyter version really requires\n    # a new structure for the $JUPYTER_CONFIG_DIR should this version\n    # number be changed to the new jupyter_core version.\n    export JUPYTER_CONFIG_DIR=\"$DOT_SAGE/jupyter-4.1\"\nfi\n```\n\nCC:  @embray\n\nBranch/Commit: [e3c1b2b3d40277029d4e609be2557d75221e3cfa](https://github.com/sagemath/sagetrac-mirror/commit/e3c1b2b3d40277029d4e609be2557d75221e3cfa)\n\nReviewer: Erik Bray, Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23711\n\n",
    "closed_at": "2017-09-10T11:57:25Z",
    "created_at": "2017-08-25T10:04:57Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "sage-env: do not depend on matplotlib version number",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23711",
    "user": "https://github.com/jdemeyer"
}
```
So we really need to know the exact matplotlib version number in `sage-env`?

```sh
# Use a matplotlib config directory specific to Sage and specific to
# the version number of matplotlib, by setting the environment
# variable MPLCONFIGDIR. Note that we can't find the version number by
# importing matplotlib, because that could create matplotlib's standard
# config directory. So we use pkg_resources.
"$SAGE_LOCAL/bin/python" -c 'import pkg_resources; pkg_resources.get_distribution("matplotlib").version' 2>/dev/null
if [ $? -eq 0 ]; then
    MPLVERSION=`"$SAGE_LOCAL/bin/python" -c 'import pkg_resources; print (pkg_resources.get_distribution("matplotlib").version)'`
    MPLCONFIGDIR="$DOT_SAGE/matplotlib-$MPLVERSION"
    export MPLCONFIGDIR
    # The directory is created when Sage starts (see sage.misc.misc).
fi
```

Instead, we could just hardcode a version number, analogous to what we do for Jupyter:

```sh
if [ -z "$IPYTHONDIR" ]; then
    # We hardcode a version number in the directory name. The idea is
    # that we keep using the same version number as long as that is
    # possible. Only when some future IPython version really requires
    # a new structure for the $IPYTHONDIR should this version number be
    # changed to the new IPython version.
    export IPYTHONDIR="$DOT_SAGE/ipython-5.0.0"
fi

if [ -z "$JUPYTER_CONFIG_DIR" ]; then
    # We hardcode a version number in the directory name. The idea is
    # that we keep using the same version number as long as that is
    # possible. Only when some future Jupyter version really requires
    # a new structure for the $JUPYTER_CONFIG_DIR should this version
    # number be changed to the new jupyter_core version.
    export JUPYTER_CONFIG_DIR="$DOT_SAGE/jupyter-4.1"
fi
```

CC:  @embray

Branch/Commit: [e3c1b2b3d40277029d4e609be2557d75221e3cfa](https://github.com/sagemath/sagetrac-mirror/commit/e3c1b2b3d40277029d4e609be2557d75221e3cfa)

Reviewer: Erik Bray, Dima Pasechnik

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23711





---

archive/issue_comments_449684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-So we really to know the matplotlib version number in `sage-env`?\n+So we really need to know the exact matplotlib version number in `sage-env`?\n \n ```sh\n # Use a matplotlib config directory specific to Sage and specific to\n``````\n",
    "created_at": "2017-08-25T10:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449684",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-So we really to know the matplotlib version number in `sage-env`?
+So we really need to know the exact matplotlib version number in `sage-env`?
 
 ```sh
 # Use a matplotlib config directory specific to Sage and specific to
``````




---

archive/issue_comments_449685.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/sage_env__do_not_depend_on_matplotlib_version_number\"",
    "created_at": "2017-08-25T10:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449685",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/sage_env__do_not_depend_on_matplotlib_version_number"



---

archive/issue_comments_449686.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-08-25T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449686",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_449687.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[1f8c22e](https://github.com/sagemath/sagetrac-mirror/commit/1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1)|`Hardcode Matplotlib version number in sage-env`|",
    "created_at": "2017-08-25T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449687",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[1f8c22e](https://github.com/sagemath/sagetrac-mirror/commit/1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1)|`Hardcode Matplotlib version number in sage-env`|



---

archive/issue_comments_449688.json:
```json
{
    "body": "Changing commit from \"\" to \"1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1\"",
    "created_at": "2017-08-25T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449688",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1"



---

archive/issue_comments_449689.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-25T10:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449689",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449690.json:
```json
{
    "body": "<a id='comment:4'></a>\nShouldn't this kind of hardcoding be delegated to `./configure` ?",
    "created_at": "2017-08-25T10:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449690",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
Shouldn't this kind of hardcoding be delegated to `./configure` ?



---

archive/issue_comments_449691.json:
```json
{
    "body": "<a id='comment:5'></a>\nThat was fast.  I'm sort of inclined to agree that the config dir really doesn't need to be updated unless an explicit need to do so is found.\n\nAn alternative approach I had in mind was to set the paths to these config files in a separate file that can be updated when upgrading the relevant packages.  This would be a good use case for #22652, which I still think would be a good idea, though it hasn't been a priority to pursue.  With #22652, individual spkgs could provide small shell snippets that are sourced at startup time.  That keeps configuration for individual software packages closer to that package, rather than scattered about arbitrarily.\n\n---\nNew commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[1f8c22e](https://github.com/sagemath/sagetrac-mirror/commit/1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1)|`Hardcode Matplotlib version number in sage-env`|",
    "created_at": "2017-08-25T10:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449691",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
That was fast.  I'm sort of inclined to agree that the config dir really doesn't need to be updated unless an explicit need to do so is found.

An alternative approach I had in mind was to set the paths to these config files in a separate file that can be updated when upgrading the relevant packages.  This would be a good use case for #22652, which I still think would be a good idea, though it hasn't been a priority to pursue.  With #22652, individual spkgs could provide small shell snippets that are sourced at startup time.  That keeps configuration for individual software packages closer to that package, rather than scattered about arbitrarily.

---
New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[1f8c22e](https://github.com/sagemath/sagetrac-mirror/commit/1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1)|`Hardcode Matplotlib version number in sage-env`|



---

archive/issue_comments_449692.json:
```json
{
    "body": "Changing author from \"Jeroen Demeyer\" to \"\"",
    "created_at": "2017-08-25T10:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449692",
    "user": "https://github.com/embray"
}
```

Changing author from "Jeroen Demeyer" to ""



---

archive/issue_comments_449693.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-08-25T10:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449693",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_449694.json:
```json
{
    "body": "<a id='comment:6'></a>\nNot sure why that happened.",
    "created_at": "2017-08-25T10:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449694",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Not sure why that happened.



---

archive/issue_comments_449695.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [dimpase](#comment%3A4):\n> Shouldn't this kind of hardcoding be delegated to `./configure` ?\n\n\nNo, how would `./configure` know which version number to hardcode?",
    "created_at": "2017-08-25T10:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449695",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [dimpase](#comment%3A4):
> Shouldn't this kind of hardcoding be delegated to `./configure` ?


No, how would `./configure` know which version number to hardcode?



---

archive/issue_comments_449696.json:
```json
{
    "body": "<a id='comment:8'></a>\nBut #22652 is probably the right way to go on the long term. Not that I should really care.",
    "created_at": "2017-08-25T10:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449696",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
But #22652 is probably the right way to go on the long term. Not that I should really care.



---

archive/issue_comments_449697.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-25T10:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449697",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449698.json:
```json
{
    "body": "<a id='comment:9'></a>\nI think this makes sense to me, especially since we're already doing the same for Jupyter.\n\nI'd still like a more general approach like I suggested above, but that can happen separately since this will give speedup times to sage startup now.",
    "created_at": "2017-08-25T10:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449698",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
I think this makes sense to me, especially since we're already doing the same for Jupyter.

I'd still like a more general approach like I suggested above, but that can happen separately since this will give speedup times to sage startup now.



---

archive/issue_comments_449699.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Erik Bray\"",
    "created_at": "2017-08-25T10:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449699",
    "user": "https://github.com/embray"
}
```

Changing reviewer from "" to "Erik Bray"



---

archive/issue_comments_449700.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'm not convinced to use #22652 to change the directory every time. Usually, it is considered a feature that a configuration directory remains in the same place.\n\nThat was the reason for hardcoding the Jupyter directories: I have some custom configuration and it's not fun if you need to copy it every time that Jupyter is upgraded in Sage.",
    "created_at": "2017-08-25T10:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
I'm not convinced to use #22652 to change the directory every time. Usually, it is considered a feature that a configuration directory remains in the same place.

That was the reason for hardcoding the Jupyter directories: I have some custom configuration and it's not fun if you need to copy it every time that Jupyter is upgraded in Sage.



---

archive/issue_comments_449701.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A7):\n> Replying to [dimpase](#comment%3A4):\n> > Shouldn't this kind of hardcoding be delegated to `./configure` ?\n\n> \n> No, how would `./configure` know which version number to hardcode?\n\n\ntrivially: by looking at `build/pkgs/*/package-version.txt`",
    "created_at": "2017-08-25T10:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449701",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A7):
> Replying to [dimpase](#comment%3A4):
> > Shouldn't this kind of hardcoding be delegated to `./configure` ?

> 
> No, how would `./configure` know which version number to hardcode?


trivially: by looking at `build/pkgs/*/package-version.txt`



---

archive/issue_comments_449702.json:
```json
{
    "body": "<a id='comment:12'></a>\nIf I remember well, the version hardcoding is meant to change when incompatible changes are made. #22652 just give the package the responsibility to increment the number, it can mimic the current behavior and only change the number at breaking point.",
    "created_at": "2017-08-25T10:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449702",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
If I remember well, the version hardcoding is meant to change when incompatible changes are made. #22652 just give the package the responsibility to increment the number, it can mimic the current behavior and only change the number at breaking point.



---

archive/issue_comments_449703.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-25T10:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449703",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_449704.json:
```json
{
    "body": "<a id='comment:13'></a>\nby right, these kinds of changes must be documented somewhere (in the developer manual, or/and in `SPKG.txt`), otherwise you're building a code spaghetti monster only you know the way around...",
    "created_at": "2017-08-25T10:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449704",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
by right, these kinds of changes must be documented somewhere (in the developer manual, or/and in `SPKG.txt`), otherwise you're building a code spaghetti monster only you know the way around...



---

archive/issue_comments_449705.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A11):\n> trivially: by looking at `build/pkgs/*/package-version.txt` \n\n\nThat's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.",
    "created_at": "2017-08-25T11:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449705",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A11):
> trivially: by looking at `build/pkgs/*/package-version.txt` 


That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.



---

archive/issue_comments_449706.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A10):\n> I'm not convinced to use #22652 to change the directory every time. Usually, it is considered a feature that a configuration directory remains in the same place.\n\n\nI'm not necessarily saying it should be changed every time.  It *could* be done that way, and more easily if the config is written, say, by the package's `spkg-install`.  My point here is that it just keeps this configuration closer to the package it's relevant to, making it easier to remember to update its configuration when desired/necessary.",
    "created_at": "2017-08-25T11:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449706",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A10):
> I'm not convinced to use #22652 to change the directory every time. Usually, it is considered a feature that a configuration directory remains in the same place.


I'm not necessarily saying it should be changed every time.  It *could* be done that way, and more easily if the config is written, say, by the package's `spkg-install`.  My point here is that it just keeps this configuration closer to the package it's relevant to, making it easier to remember to update its configuration when desired/necessary.



---

archive/issue_comments_449707.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [fbissey](#comment%3A12):\n> If I remember well, the version hardcoding is meant to change when incompatible changes are made. #22652 just give the package the responsibility to increment the number, it can mimic the current behavior and only change the number at breaking point.\n\n\nExactly^",
    "created_at": "2017-08-25T11:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449707",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Replying to [fbissey](#comment%3A12):
> If I remember well, the version hardcoding is meant to change when incompatible changes are made. #22652 just give the package the responsibility to increment the number, it can mimic the current behavior and only change the number at breaking point.


Exactly^



---

archive/issue_comments_449708.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jdemeyer](#comment%3A14):\n> Replying to [dimpase](#comment%3A11):\n> > trivially: by looking at `build/pkgs/*/package-version.txt` \n\n> \n> That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.\n\n\nTell me more about advantages of having the same number hardcoded in two different files, come on...\n\nYou are perpetuating some old crappy misdesign, not the other way around.",
    "created_at": "2017-08-25T12:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449708",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Replying to [jdemeyer](#comment%3A14):
> Replying to [dimpase](#comment%3A11):
> > trivially: by looking at `build/pkgs/*/package-version.txt` 

> 
> That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.


Tell me more about advantages of having the same number hardcoded in two different files, come on...

You are perpetuating some old crappy misdesign, not the other way around.



---

archive/issue_comments_449709.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [dimpase](#comment%3A17):\n> Replying to [jdemeyer](#comment%3A14):\n> > Replying to [dimpase](#comment%3A11):\n> > > trivially: by looking at `build/pkgs/*/package-version.txt` \n\n> > \n> > That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.\n\n> \n> Tell me more about advantages of having the same number hardcoded in two different files, come on...\n> \n> You are perpetuating some old crappy misdesign, not the other way around.\n\n\nJeroen's point is that it's *not* the same number.  The number in the config directory name is the *last* version at which the format of the configuration for that package changed in a significantly-enough backwards-incompatible way that a new configuration is needed.\n\nFor example \"jupyter-1.5.0\" means \"configuration for jupyter-1.5.0 and above\".  If jupyter 3.0 comes along and changes the layout of its config directory then we add \"jupyter-3.0\" for config of jupyter 3.0 and above.\n\nThis is as opposed to updating the config dir every time a package is updated (especially onerous when we're talking micro version updates that only contain bug fixes).  The config dirs do not track one-to-one with the version of the package.",
    "created_at": "2017-08-25T13:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449709",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Replying to [dimpase](#comment%3A17):
> Replying to [jdemeyer](#comment%3A14):
> > Replying to [dimpase](#comment%3A11):
> > > trivially: by looking at `build/pkgs/*/package-version.txt` 

> > 
> > That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.

> 
> Tell me more about advantages of having the same number hardcoded in two different files, come on...
> 
> You are perpetuating some old crappy misdesign, not the other way around.


Jeroen's point is that it's *not* the same number.  The number in the config directory name is the *last* version at which the format of the configuration for that package changed in a significantly-enough backwards-incompatible way that a new configuration is needed.

For example "jupyter-1.5.0" means "configuration for jupyter-1.5.0 and above".  If jupyter 3.0 comes along and changes the layout of its config directory then we add "jupyter-3.0" for config of jupyter 3.0 and above.

This is as opposed to updating the config dir every time a package is updated (especially onerous when we're talking micro version updates that only contain bug fixes).  The config dirs do not track one-to-one with the version of the package.



---

archive/issue_comments_449710.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [embray](#comment%3A18):\n> Replying to [dimpase](#comment%3A17):\n> > Replying to [jdemeyer](#comment%3A14):\n> > > Replying to [dimpase](#comment%3A11):\n> > > > trivially: by looking at `build/pkgs/*/package-version.txt` \n\n> > > \n> > > That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.\n\n> > \n> > Tell me more about advantages of having the same number hardcoded in two different files, come on...\n> > \n> > You are perpetuating some old crappy misdesign, not the other way around.\n\n> \n> Jeroen's point is that it's *not* the same number.  The number in the config directory name is the *last* version at which the format of the configuration for that package changed in a significantly-enough backwards-incompatible way that a new configuration is needed.\n> \n> For example \"jupyter-1.5.0\" means \"configuration for jupyter-1.5.0 and above\".  If jupyter 3.0 comes along and changes the layout of its config directory then we add \"jupyter-3.0\" for config of jupyter 3.0 and above.\n> \n> This is as opposed to updating the config dir every time a package is updated (especially onerous when we're talking micro version updates that only contain bug fixes).  The config dirs do not track one-to-one with the version of the package.\n\n\nThis is called madness in my book. I would understand these directory names being independent of the minor version, but having in `~/.sage/blah-1.1.1` configuration for `blah-2.3.4` is crazy.",
    "created_at": "2017-08-25T13:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449710",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [embray](#comment%3A18):
> Replying to [dimpase](#comment%3A17):
> > Replying to [jdemeyer](#comment%3A14):
> > > Replying to [dimpase](#comment%3A11):
> > > > trivially: by looking at `build/pkgs/*/package-version.txt` 

> > > 
> > > That's exactly what we *do not* want to do. It's a misfeature to have configuration directories depend on a version number.

> > 
> > Tell me more about advantages of having the same number hardcoded in two different files, come on...
> > 
> > You are perpetuating some old crappy misdesign, not the other way around.

> 
> Jeroen's point is that it's *not* the same number.  The number in the config directory name is the *last* version at which the format of the configuration for that package changed in a significantly-enough backwards-incompatible way that a new configuration is needed.
> 
> For example "jupyter-1.5.0" means "configuration for jupyter-1.5.0 and above".  If jupyter 3.0 comes along and changes the layout of its config directory then we add "jupyter-3.0" for config of jupyter 3.0 and above.
> 
> This is as opposed to updating the config dir every time a package is updated (especially onerous when we're talking micro version updates that only contain bug fixes).  The config dirs do not track one-to-one with the version of the package.


This is called madness in my book. I would understand these directory names being independent of the minor version, but having in `~/.sage/blah-1.1.1` configuration for `blah-2.3.4` is crazy.



---

archive/issue_comments_449711.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [dimpase](#comment%3A19):\n> having in `~/.sage/blah-1.1.1` configuration for `blah-2.3.4` is crazy.\n\n\nYou should consider the `1.1.1` to be essentially an arbitrary string. One could go with `~/.sage/blah-A` if you want. The reason that I picked `1.5.1` is because that is what is currently used, so the directory wouldn't be changed.",
    "created_at": "2017-08-25T13:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449711",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [dimpase](#comment%3A19):
> having in `~/.sage/blah-1.1.1` configuration for `blah-2.3.4` is crazy.


You should consider the `1.1.1` to be essentially an arbitrary string. One could go with `~/.sage/blah-A` if you want. The reason that I picked `1.5.1` is because that is what is currently used, so the directory wouldn't be changed.



---

archive/issue_comments_449712.json:
```json
{
    "body": "<a id='comment:21'></a>\nLet's put it this way: At the very least this ticket is just treating matplotlib's config the way we were already treating jupyter/ipython config, so if nothing else it's consistent.  I think it makes sense to name the config dir after the lowest applicable version supported by Sage, but you could just as well name them \".0\", \".1\", \".2\", etc.  This would be a debate for a separate ticket.",
    "created_at": "2017-08-25T14:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449712",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Let's put it this way: At the very least this ticket is just treating matplotlib's config the way we were already treating jupyter/ipython config, so if nothing else it's consistent.  I think it makes sense to name the config dir after the lowest applicable version supported by Sage, but you could just as well name them ".0", ".1", ".2", etc.  This would be a debate for a separate ticket.



---

archive/issue_comments_449713.json:
```json
{
    "body": "Changing commit from \"1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1\" to \"5b9481cc061ee03484020b6025b8321181793311\"",
    "created_at": "2017-08-25T14:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1f8c22ea34f2228f9fa977d79f51f19b3a85d5b1" to "5b9481cc061ee03484020b6025b8321181793311"



---

archive/issue_comments_449714.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[5b9481c](https://github.com/sagemath/sagetrac-mirror/commit/5b9481cc061ee03484020b6025b8321181793311)|`Document MPLCONFIGDIR`|",
    "created_at": "2017-08-25T14:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[5b9481c](https://github.com/sagemath/sagetrac-mirror/commit/5b9481cc061ee03484020b6025b8321181793311)|`Document MPLCONFIGDIR`|



---

archive/issue_comments_449715.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-25T14:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449715",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449716.json:
```json
{
    "body": "<a id='comment:24'></a>\nOK, thanks, this starts making sense to me. Now it remains to check that the docs build...",
    "created_at": "2017-08-25T14:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449716",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
OK, thanks, this starts making sense to me. Now it remains to check that the docs build...



---

archive/issue_comments_449717.json:
```json
{
    "body": "<a id='comment:25'></a>\ntypo \"where the configuation\"",
    "created_at": "2017-08-26T19:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449717",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
typo "where the configuation"



---

archive/issue_comments_449718.json:
```json
{
    "body": "Changing commit from \"5b9481cc061ee03484020b6025b8321181793311\" to \"e45a772568b398e8415a839a7248d2c33f2deb25\"",
    "created_at": "2017-08-28T10:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5b9481cc061ee03484020b6025b8321181793311" to "e45a772568b398e8415a839a7248d2c33f2deb25"



---

archive/issue_comments_449719.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------|\n|[e45a772](https://github.com/sagemath/sagetrac-mirror/commit/e45a772568b398e8415a839a7248d2c33f2deb25)|`Typos`|",
    "created_at": "2017-08-28T10:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------|
|[e45a772](https://github.com/sagemath/sagetrac-mirror/commit/e45a772568b398e8415a839a7248d2c33f2deb25)|`Typos`|



---

archive/issue_comments_449720.json:
```json
{
    "body": "<a id='comment:27'></a>\n**ping**",
    "created_at": "2017-09-01T12:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449720",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
**ping**



---

archive/issue_comments_449721.json:
```json
{
    "body": "<a id='comment:28'></a>\nI was waiting to see if Dima had anything more to say about this--it has positive review from me otherwise.",
    "created_at": "2017-09-01T12:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449721",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
I was waiting to see if Dima had anything more to say about this--it has positive review from me otherwise.



---

archive/issue_comments_449722.json:
```json
{
    "body": "<a id='comment:29'></a>\njust a second, I'll see if it works on top of #23023",
    "created_at": "2017-09-01T12:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449722",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
just a second, I'll see if it works on top of #23023



---

archive/issue_comments_449723.json:
```json
{
    "body": "<a id='comment:30'></a>\nOK, but how about a link to https://matplotlib.org/faq/environment_variables_faq.html#envvar-MPLCONFIGDIR\nin the place where you mention `MPLCONFIGDIR` in the docs?",
    "created_at": "2017-09-01T13:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449723",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
OK, but how about a link to https://matplotlib.org/faq/environment_variables_faq.html#envvar-MPLCONFIGDIR
in the place where you mention `MPLCONFIGDIR` in the docs?



---

archive/issue_comments_449724.json:
```json
{
    "body": "Changing commit from \"e45a772568b398e8415a839a7248d2c33f2deb25\" to \"e3c1b2b3d40277029d4e609be2557d75221e3cfa\"",
    "created_at": "2017-09-03T08:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e45a772568b398e8415a839a7248d2c33f2deb25" to "e3c1b2b3d40277029d4e609be2557d75221e3cfa"



---

archive/issue_comments_449725.json:
```json
{
    "body": "<a id='comment:31'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------|\n|[e3c1b2b](https://github.com/sagemath/sagetrac-mirror/commit/e3c1b2b3d40277029d4e609be2557d75221e3cfa)|`Add link`|",
    "created_at": "2017-09-03T08:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------|
|[e3c1b2b](https://github.com/sagemath/sagetrac-mirror/commit/e3c1b2b3d40277029d4e609be2557d75221e3cfa)|`Add link`|



---

archive/issue_comments_449726.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-03T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449726",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449727.json:
```json
{
    "body": "Changing reviewer from \"Erik Bray\" to \"Erik Bray, Dima Pasechnik\"",
    "created_at": "2017-09-03T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449727",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Erik Bray" to "Erik Bray, Dima Pasechnik"



---

archive/issue_comments_449728.json:
```json
{
    "body": "<a id='comment:32'></a>\nOK, thanks.",
    "created_at": "2017-09-03T14:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449728",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
OK, thanks.



---

archive/issue_events_068880.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T11:57:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23711#event-68880"
}
```



---

archive/issue_comments_449729.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/sage_env__do_not_depend_on_matplotlib_version_number\" to \"e3c1b2b3d40277029d4e609be2557d75221e3cfa\"",
    "created_at": "2017-09-10T11:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449729",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/sage_env__do_not_depend_on_matplotlib_version_number" to "e3c1b2b3d40277029d4e609be2557d75221e3cfa"



---

archive/issue_comments_449730.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T11:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23711#issuecomment-449730",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
