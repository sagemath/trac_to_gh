# Issue 23734: Implement iterator for generic permutations in Cython

archive/issues_023497.json:
```json
{
    "assignees": [],
    "body": "We Cythonize the permutation iterator (`__iter__` method) for speed and for any class that wants to use them but just wanted to use lists.\n\nDepends on #23702\n\n**CC:**  sage-combinat @fchapoton @darijgr @saliola\n\n**Keywords:** days88, IMA coding sprints\n\n**Branch/Commit:** [7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/23734\n\n",
    "closed_at": "2017-10-05T06:53:58Z",
    "created_at": "2017-08-28T04:51:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement iterator for generic permutations in Cython",
    "type": "issue",
    "updated_at": "2017-10-05T06:53:58Z",
    "url": "https://github.com/sagemath/sage/issues/23734",
    "user": "https://github.com/tscrim"
}
```
We Cythonize the permutation iterator (`__iter__` method) for speed and for any class that wants to use them but just wanted to use lists.

Depends on #23702

**CC:**  sage-combinat @fchapoton @darijgr @saliola

**Keywords:** days88, IMA coding sprints

**Branch/Commit:** [7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)

**Reviewer:** Vincent Delecroix

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/23734





---

archive/issue_events_286852.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T04:51:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286852"
}
```



---

archive/issue_events_286853.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T04:51:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "08517b",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286853"
}
```



---

archive/issue_events_286854.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T04:51:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286854"
}
```



---

archive/issue_comments_360592.json:
```json
{
    "body": "**Branch:** [public/combinat/cythonize_perm_iter-23734](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_perm_iter-23734)",
    "created_at": "2017-08-28T04:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360592",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/combinat/cythonize_perm_iter-23734](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_perm_iter-23734)



---

archive/issue_comments_360593.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nWe get a speedup of about 20%:\n\n```\nsage: P = Permutations([1,1,1,2,2,3,4,5])\nsage: %timeit list(P)\n100 loops, best of 3: 10.4 ms per loop\n```\nversus the old\n\n```\nsage: P = Permutations([1,1,1,2,2,3,4,5])\nsage: %timeit list(P)\n100 loops, best of 3: 12.1 ms per loop\n```\n\nThis was part of the code I used to try and get a fast monomial * monomial for #23694.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f635679eed723dbb69a47168f5eb6fcc0163c32\">3f63567</a></td><td><code>Removing unneeded imports of symmetrica and use getattr instead of eval.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b\">11e08e0</a></td><td><code>Cythonized the iterator for Permutations.</code></td></tr></table>\n",
    "created_at": "2017-08-28T04:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360593",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'>**Comment 1:**</a>
We get a speedup of about 20%:

```
sage: P = Permutations([1,1,1,2,2,3,4,5])
sage: %timeit list(P)
100 loops, best of 3: 10.4 ms per loop
```
versus the old

```
sage: P = Permutations([1,1,1,2,2,3,4,5])
sage: %timeit list(P)
100 loops, best of 3: 12.1 ms per loop
```

This was part of the code I used to try and get a fast monomial * monomial for #23694.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f635679eed723dbb69a47168f5eb6fcc0163c32">3f63567</a></td><td><code>Removing unneeded imports of symmetrica and use getattr instead of eval.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b">11e08e0</a></td><td><code>Cythonized the iterator for Permutations.</code></td></tr></table>




---

archive/issue_events_286855.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T04:54:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286855"
}
```



---

archive/issue_comments_360594.json:
```json
{
    "body": "**Commit:** [11e08e0368169533b36153eb320ef57d8eaf9d8b](https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b)",
    "created_at": "2017-08-28T04:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360594",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [11e08e0368169533b36153eb320ef57d8eaf9d8b](https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b)



---

archive/issue_comments_360595.json:
```json
{
    "body": "**Dependencies:** #23702",
    "created_at": "2017-08-28T04:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360595",
    "user": "https://github.com/tscrim"
}
```

**Dependencies:** #23702



---

archive/issue_comments_360596.json:
```json
{
    "body": "**Changing commit** from \"[11e08e0368169533b36153eb320ef57d8eaf9d8b](https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b)\" to \"[c728c1ae23e783ffd7a7932b37ad6a825c95a532](https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532)\".",
    "created_at": "2017-08-28T05:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360596",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[11e08e0368169533b36153eb320ef57d8eaf9d8b](https://github.com/sagemath/sagetrac-mirror/commit/11e08e0368169533b36153eb320ef57d8eaf9d8b)" to "[c728c1ae23e783ffd7a7932b37ad6a825c95a532](https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532)".



---

archive/issue_comments_360597.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532\">c728c1a</a></td><td><code>Cythonized the iterator for Permutations.</code></td></tr></table>\n",
    "created_at": "2017-08-28T05:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360597",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>**Comment 3:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532">c728c1a</a></td><td><code>Cythonized the iterator for Permutations.</code></td></tr></table>




---

archive/issue_comments_360598.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n1. It is bad practice to use `int` for indices (even though it is unlikely that anybody will ever use permutations with more than 2<sup>31</sup> elements). Use `Py_ssize_t` instead.\n\n2. A more general design remark: if you really just want to store an array of integers, a Python `list` is not the most efficient. More efficient would be to use a Python [array](https://docs.python.org/2/library/array.html) (essentially a C array with a Python interface) for example.",
    "created_at": "2017-08-28T10:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360598",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>**Comment 4:**</a>
1. It is bad practice to use `int` for indices (even though it is unlikely that anybody will ever use permutations with more than 2<sup>31</sup> elements). Use `Py_ssize_t` instead.

2. A more general design remark: if you really just want to store an array of integers, a Python `list` is not the most efficient. More efficient would be to use a Python [array](https://docs.python.org/2/library/array.html) (essentially a C array with a Python interface) for example.



---

archive/issue_events_286856.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-28T10:50:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286856"
}
```



---

archive/issue_events_286857.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-08-28T10:50:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286857"
}
```



---

archive/issue_comments_360599.json:
```json
{
    "body": "**Changing commit** from \"[c728c1ae23e783ffd7a7932b37ad6a825c95a532](https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532)\" to \"[5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499](https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499)\".",
    "created_at": "2017-08-28T16:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360599",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c728c1ae23e783ffd7a7932b37ad6a825c95a532](https://github.com/sagemath/sagetrac-mirror/commit/c728c1ae23e783ffd7a7932b37ad6a825c95a532)" to "[5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499](https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499)".



---

archive/issue_comments_360600.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499\">5ba97be</a></td><td><code>Use Py_ssize_t instead of int.</code></td></tr></table>\n",
    "created_at": "2017-08-28T16:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360600",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>**Comment 5:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499">5ba97be</a></td><td><code>Use Py_ssize_t instead of int.</code></td></tr></table>




---

archive/issue_comments_360601.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nReplying to [@jdemeyer](#comment%3A4):\n> 1. It is bad practice to use `int` for indices (even though it is unlikely that anybody will ever use permutations with more than 2<sup>31</sup> elements). Use `Py_ssize_t` instead.\n\nDone.\n\n> 2. A more general design remark: if you really just want to store an array of integers, a Python `list` is not the most efficient. More efficient would be to use a Python [array](https://docs.python.org/2/library/array.html) (essentially a C array with a Python interface) for example.\n\nI would except Cython doesn't seem to like them as a type. Part of me is tempted to use true C array of `Py_ssize_t`, but at the same time, that would limit the input from making this a more generic tool. Granted, enforcing `Py_ssize_t` wouldn't be such a bad thing. Do you have a thought on this?",
    "created_at": "2017-08-28T16:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360601",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'>**Comment 6:**</a>
Replying to [@jdemeyer](#comment%3A4):
> 1. It is bad practice to use `int` for indices (even though it is unlikely that anybody will ever use permutations with more than 2<sup>31</sup> elements). Use `Py_ssize_t` instead.

Done.

> 2. A more general design remark: if you really just want to store an array of integers, a Python `list` is not the most efficient. More efficient would be to use a Python [array](https://docs.python.org/2/library/array.html) (essentially a C array with a Python interface) for example.

I would except Cython doesn't seem to like them as a type. Part of me is tempted to use true C array of `Py_ssize_t`, but at the same time, that would limit the input from making this a more generic tool. Granted, enforcing `Py_ssize_t` wouldn't be such a bad thing. Do you have a thought on this?



---

archive/issue_events_286858.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T16:23:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286858"
}
```



---

archive/issue_events_286859.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-28T16:23:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286859"
}
```



---

archive/issue_comments_360602.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nReplying to [@tscrim](#comment%3A6):\n> I would except Cython doesn't seem to like them as a type.\n\nI should have mentioned http://cython.readthedocs.io/en/latest/src/tutorial/array.html",
    "created_at": "2017-08-28T20:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360602",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>**Comment 7:**</a>
Replying to [@tscrim](#comment%3A6):
> I would except Cython doesn't seem to like them as a type.

I should have mentioned http://cython.readthedocs.io/en/latest/src/tutorial/array.html



---

archive/issue_comments_360603.json:
```json
{
    "body": "**Changing commit** from \"[5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499](https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499)\" to \"[0cc85a1d6a00cd6e800ff47d76cf87762ac0a209](https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209)\".",
    "created_at": "2017-08-28T22:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360603",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499](https://github.com/sagemath/sagetrac-mirror/commit/5ba97be8282a8a1ae0cc7c6ff39d2af3a3ad4499)" to "[0cc85a1d6a00cd6e800ff47d76cf87762ac0a209](https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209)".



---

archive/issue_comments_360604.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209\">0cc85a1</a></td><td><code>Using array and skipping the check.</code></td></tr></table>\n",
    "created_at": "2017-08-28T22:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360604",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209">0cc85a1</a></td><td><code>Using array and skipping the check.</code></td></tr></table>




---

archive/issue_comments_360605.json:
```json
{
    "body": "**Changing commit** from \"[0cc85a1d6a00cd6e800ff47d76cf87762ac0a209](https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209)\" to \"[ad0ef170a5ddb3ed33bf3774b62cf7a75809704e](https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e)\".",
    "created_at": "2017-08-28T22:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360605",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0cc85a1d6a00cd6e800ff47d76cf87762ac0a209](https://github.com/sagemath/sagetrac-mirror/commit/0cc85a1d6a00cd6e800ff47d76cf87762ac0a209)" to "[ad0ef170a5ddb3ed33bf3774b62cf7a75809704e](https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e)".



---

archive/issue_comments_360606.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e\">ad0ef17</a></td><td><code>Using array and skipping the check.</code></td></tr></table>\n",
    "created_at": "2017-08-28T22:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360606",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>**Comment 9:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e">ad0ef17</a></td><td><code>Using array and skipping the check.</code></td></tr></table>




---

archive/issue_comments_360607.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nThank you, that is very useful information and will give me some more tools to speed things up. I redid the iterator using arrays, which then makes the pure iterator go 3x faster. However, it did actually make the `Permutations` iterator slower because of the extra conversion; once I implemented a custom Cython build-the-list function, I got a 7% speedup instead (9.3ms compared to the timings above). Yet, I added the flag to skip the validation checks for the element constructor and now get:\n\n```\nsage: P = Permutations([1,1,1,2,2,3,4,5])\nsage: %timeit list(P)\n100 loops, best of 3: 2.26 ms per loop\n```",
    "created_at": "2017-08-28T22:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360607",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'>**Comment 10:**</a>
Thank you, that is very useful information and will give me some more tools to speed things up. I redid the iterator using arrays, which then makes the pure iterator go 3x faster. However, it did actually make the `Permutations` iterator slower because of the extra conversion; once I implemented a custom Cython build-the-list function, I got a 7% speedup instead (9.3ms compared to the timings above). Yet, I added the flag to skip the validation checks for the element constructor and now get:

```
sage: P = Permutations([1,1,1,2,2,3,4,5])
sage: %timeit list(P)
100 loops, best of 3: 2.26 ms per loop
```



---

archive/issue_comments_360608.json:
```json
{
    "body": "**Changing commit** from \"[ad0ef170a5ddb3ed33bf3774b62cf7a75809704e](https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e)\" to \"[15c88927a333e50cebeab1b07c364ecaf2862418](https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418)\".",
    "created_at": "2017-08-31T00:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360608",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ad0ef170a5ddb3ed33bf3774b62cf7a75809704e](https://github.com/sagemath/sagetrac-mirror/commit/ad0ef170a5ddb3ed33bf3774b62cf7a75809704e)" to "[15c88927a333e50cebeab1b07c364ecaf2862418](https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418)".



---

archive/issue_comments_360609.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418\">15c8892</a></td><td><code>Using array and skipping the check.</code></td></tr></table>\n",
    "created_at": "2017-08-31T00:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360609",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>**Comment 11:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418">15c8892</a></td><td><code>Using array and skipping the check.</code></td></tr></table>




---

archive/issue_comments_360610.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nHow does the timings compare to `itertools.permutations`?\n\n```\nsage: for p in itertools.permutations([0,1,2]):\n....:     print p\n(0, 1, 2)\n(0, 2, 1)\n(1, 0, 2)\n(1, 2, 0)\n(2, 0, 1)\n(2, 1, 0)\n```\n(note: `itertools.permutations` do not handle the multisets)",
    "created_at": "2017-09-01T23:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360610",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'>**Comment 12:**</a>
How does the timings compare to `itertools.permutations`?

```
sage: for p in itertools.permutations([0,1,2]):
....:     print p
(0, 1, 2)
(0, 2, 1)
(1, 0, 2)
(1, 2, 0)
(2, 0, 1)
(2, 1, 0)
```
(note: `itertools.permutations` do not handle the multisets)



---

archive/issue_comments_360611.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\n\n```\nsage: from array import array\nsage: import itertools\nsage: def test_itertools(n):\n....:     for p in itertools.permutations(list(range(n))):\n....:         pass\nsage: def test_next_perm(n):\n....:     data = array('I', list(range(n)))\n....:     while next_perm(data):\n....:         data.tolist()\n```\ngives\n\n```\nsage: %timeit test_itertools(3)\nThe slowest run took 7.87 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.03 \u00b5s per loop\nsage: %timeit test_next_perm(3)\nThe slowest run took 5.16 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 2.31 \u00b5s per loop\nsage: %timeit test_itertools(10)\n1 loop, best of 3: 200 ms per loop\nsage: %timeit test_next_perm(10)\n1 loop, best of 3: 1.16 s per loop\n```\nHowever, if we use:\n\n```\nsage: def test_next_perm(n):\n....:     data = array('I', list(range(n)))\n....:     while next_perm(data):\n....:         pass\n```\nthen we get\n\n```\nsage: %timeit test_next_perm(3)\nThe slowest run took 8.06 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 976 ns per loop\nsage: %timeit test_next_perm(10)\n10 loops, best of 3: 108 ms per loop\nsage: %timeit test_next_perm(11)\n1 loop, best of 3: 1.19 s per loop\nsage: %timeit test_itertools(11)\n1 loop, best of 3: 2.37 s per loop\n```\nSo a *lot* of time is lost converting back to a list. However, if you can work only in arrays, then it becomes very quick.",
    "created_at": "2017-09-02T00:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360611",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'>**Comment 13:**</a>

```
sage: from array import array
sage: import itertools
sage: def test_itertools(n):
....:     for p in itertools.permutations(list(range(n))):
....:         pass
sage: def test_next_perm(n):
....:     data = array('I', list(range(n)))
....:     while next_perm(data):
....:         data.tolist()
```
gives

```
sage: %timeit test_itertools(3)
The slowest run took 7.87 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.03 µs per loop
sage: %timeit test_next_perm(3)
The slowest run took 5.16 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 2.31 µs per loop
sage: %timeit test_itertools(10)
1 loop, best of 3: 200 ms per loop
sage: %timeit test_next_perm(10)
1 loop, best of 3: 1.16 s per loop
```
However, if we use:

```
sage: def test_next_perm(n):
....:     data = array('I', list(range(n)))
....:     while next_perm(data):
....:         pass
```
then we get

```
sage: %timeit test_next_perm(3)
The slowest run took 8.06 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 976 ns per loop
sage: %timeit test_next_perm(10)
10 loops, best of 3: 108 ms per loop
sage: %timeit test_next_perm(11)
1 loop, best of 3: 1.19 s per loop
sage: %timeit test_itertools(11)
1 loop, best of 3: 2.37 s per loop
```
So a *lot* of time is lost converting back to a list. However, if you can work only in arrays, then it becomes very quick.



---

archive/issue_comments_360612.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nEssentially a green bot.",
    "created_at": "2017-09-05T19:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360612",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'>**Comment 14:**</a>
Essentially a green bot.



---

archive/issue_comments_360613.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\n`cpdef next_perm(array.array l)` -> `cpdef bint next_perm(array.array l)`\n\nAnd you can have an unsafe faster `map_to_list` as follows\n\n```\ncdef extern from \"Python.h\":\n    void Py_INCREF(PyObject *)\n\ncdef extern from \"listobject.h\":\n    list PyList_New(Py_ssize_t size)\n    void PyList_SET_ITEM(list l, Py_ssize_t, PyObject *)\n\ncdef extern from \"tupleobject.h\":\n    PyObject * PyTuple_GET_ITEM(PyObject *op, Py_ssize_t i)\n\ncpdef list map_to_list(array.array l, values, int n):\n    cdef int i\n    cdef list ret = PyList_New(n)\n    cdef PyObject * t\n    for i in range(n):\n        t = PyTuple_GET_ITEM(<PyObject *> values, l.data.as_uints[i])\n        Py_INCREF(t)\n        PyList_SET_ITEM(ret, i, t)\n    return ret\n```",
    "created_at": "2017-09-06T18:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360613",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'>**Comment 15:**</a>
`cpdef next_perm(array.array l)` -> `cpdef bint next_perm(array.array l)`

And you can have an unsafe faster `map_to_list` as follows

```
cdef extern from "Python.h":
    void Py_INCREF(PyObject *)

cdef extern from "listobject.h":
    list PyList_New(Py_ssize_t size)
    void PyList_SET_ITEM(list l, Py_ssize_t, PyObject *)

cdef extern from "tupleobject.h":
    PyObject * PyTuple_GET_ITEM(PyObject *op, Py_ssize_t i)

cpdef list map_to_list(array.array l, values, int n):
    cdef int i
    cdef list ret = PyList_New(n)
    cdef PyObject * t
    for i in range(n):
        t = PyTuple_GET_ITEM(<PyObject *> values, l.data.as_uints[i])
        Py_INCREF(t)
        PyList_SET_ITEM(ret, i, t)
    return ret
```



---

archive/issue_comments_360614.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\n(be careful to not import the C-API functions from Cython as the generated C code would be different)",
    "created_at": "2017-09-06T18:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360614",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'>**Comment 16:**</a>
(be careful to not import the C-API functions from Cython as the generated C code would be different)



---

archive/issue_comments_360615.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nSorry for letting this languish.\n\nI'm not sure what you mean by [comment:16](#comment%3A16). Are you referring to the `from cpython.list import *` line? Somewhat related is the code above gives a signature conflict with `PyList_SET_ITEM` where the third argument is an `int` in my code and a `PyObject*` in your code. Could you give me a little more information or make changes directly in the branch?",
    "created_at": "2017-09-24T17:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360615",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'>**Comment 17:**</a>
Sorry for letting this languish.

I'm not sure what you mean by [comment:16](#comment%3A16). Are you referring to the `from cpython.list import *` line? Somewhat related is the code above gives a signature conflict with `PyList_SET_ITEM` where the third argument is an `int` in my code and a `PyObject*` in your code. Could you give me a little more information or make changes directly in the branch?



---

archive/issue_comments_360616.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nIndeed. You need to import from `cpython.list` only the things you are using avoiding the functions that are declared in my version. In particular you could not use the joker `*`. The signatures in Cython files are slightly different from the one in Python headers (main change is that `PyObject *` are replaced with `object`).",
    "created_at": "2017-09-24T18:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360616",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'>**Comment 18:**</a>
Indeed. You need to import from `cpython.list` only the things you are using avoiding the functions that are declared in my version. In particular you could not use the joker `*`. The signatures in Cython files are slightly different from the one in Python headers (main change is that `PyObject *` are replaced with `object`).



---

archive/issue_comments_360617.json:
```json
{
    "body": "**Changing commit** from \"[15c88927a333e50cebeab1b07c364ecaf2862418](https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418)\" to \"[7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)\".",
    "created_at": "2017-09-24T19:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360617",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[15c88927a333e50cebeab1b07c364ecaf2862418](https://github.com/sagemath/sagetrac-mirror/commit/15c88927a333e50cebeab1b07c364ecaf2862418)" to "[7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)".



---

archive/issue_comments_360618.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bce429bd44068d25bc82bee228c67afdea34ca2a\">bce429b</a></td><td><code>23734: faster map_to_list</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5\">7eb3973</a></td><td><code>23734: proper copyright banner</code></td></tr></table>\n",
    "created_at": "2017-09-24T19:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360618",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>**Comment 19:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bce429bd44068d25bc82bee228c67afdea34ca2a">bce429b</a></td><td><code>23734: faster map_to_list</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5">7eb3973</a></td><td><code>23734: proper copyright banner</code></td></tr></table>




---

archive/issue_comments_360619.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nSee my commits.",
    "created_at": "2017-09-24T19:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360619",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'>**Comment 20:**</a>
See my commits.



---

archive/issue_comments_360620.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nThank you. Your changes LGTM. Can I consider this at a positive review?",
    "created_at": "2017-09-29T20:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360620",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'>**Comment 21:**</a>
Thank you. Your changes LGTM. Can I consider this at a positive review?



---

archive/issue_comments_360621.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2017-09-29T20:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360621",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_events_286860.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-09-30T08:10:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286860"
}
```



---

archive/issue_events_286861.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-09-30T08:10:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286861"
}
```



---

archive/issue_comments_360622.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nThank you again.",
    "created_at": "2017-09-30T15:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360622",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'>**Comment 23:**</a>
Thank you again.



---

archive/issue_events_286862.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-05T06:53:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286862"
}
```



---

archive/issue_events_286863.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "26a96021b2f30ae4afdbb24a3248a2a9a5b328c0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-05T06:53:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23734#event-286863"
}
```



---

archive/issue_comments_360623.json:
```json
{
    "body": "**Changing branch** from \"[public/combinat/cythonize_perm_iter-23734](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_perm_iter-23734)\" to \"[7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)\".",
    "created_at": "2017-10-05T06:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23734#issuecomment-360623",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/combinat/cythonize_perm_iter-23734](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/cythonize_perm_iter-23734)" to "[7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5](https://github.com/sagemath/sagetrac-mirror/commit/7eb3973d76b5a1ed1ccee8038f3c5bc7dc9538b5)".
