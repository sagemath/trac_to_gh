# Issue 23798: Fractional Chromatic Index test fails with GLPK

archive/issues_023561.json:
```json
{
    "assignees": [],
    "body": "The test\n\n```\n            sage: g = graphs.PetersenGraph()\n            sage: g.fractional_chromatic_index(solver='GLPK')\n            3.0\n```\nadded in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n\nAs a workaround, we use PPL by default in #24099.\n\n**CC:**  @dcoudert\n\n**Branch:** [public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)\n\n**Commit:** [43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** David Coudert\n\nIssue created by migration from https://trac.sagemath.org/ticket/23798\n\n",
    "created_at": "2017-09-07T11:51:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fractional Chromatic Index test fails with GLPK",
    "type": "issue",
    "updated_at": "2022-08-31T02:51:13Z",
    "url": "https://github.com/sagemath/sage/issues/23798",
    "user": "https://github.com/jdemeyer"
}
```
The test

```
            sage: g = graphs.PetersenGraph()
            sage: g.fractional_chromatic_index(solver='GLPK')
            3.0
```
added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.

As a workaround, we use PPL by default in #24099.

**CC:**  @dcoudert

**Branch:** [public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)

**Commit:** [43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)

**Reviewer:** Dima Pasechnik

**Author:** David Coudert

Issue created by migration from https://trac.sagemath.org/ticket/23798





---

archive/issue_events_287437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287437"
}
```



---

archive/issue_events_287438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "08517b",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287438"
}
```



---

archive/issue_events_287439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287439"
}
```



---

archive/issue_comments_361471.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,4 +5,4 @@\n             sage: g.fractional_chromatic_index(solver='GLPK')\n             3.0\n ```\n-added by #23658 fails with GLPK on 32-bit.\n+added by #23658 fails with GLPK-4.63 on 32-bit.\n``````\n",
    "created_at": "2017-09-07T11:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361471",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,4 +5,4 @@
             sage: g.fractional_chromatic_index(solver='GLPK')
             3.0
 ```
-added by #23658 fails with GLPK on 32-bit.
+added by #23658 fails with GLPK-4.63 on 32-bit.
``````




---

archive/issue_events_287440.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:54:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "rename": {
        "from": "Fractional Chromatic Index Infinite Loop fails with GLPK",
        "to": "Fractional Chromatic Index test fails with GLPK"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287440"
}
```



---

archive/issue_comments_361472.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,4 +5,4 @@\n             sage: g.fractional_chromatic_index(solver='GLPK')\n             3.0\n ```\n-added by #23658 fails with GLPK-4.63 on 32-bit.\n+added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n``````\n",
    "created_at": "2017-09-07T11:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361472",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,4 +5,4 @@
             sage: g.fractional_chromatic_index(solver='GLPK')
             3.0
 ```
-added by #23658 fails with GLPK-4.63 on 32-bit.
+added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.
``````




---

archive/issue_comments_361473.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nI suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. \n\nI don't have access to a 32-bit machine and so cannot test.",
    "created_at": "2017-09-07T13:31:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361473",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'>**Comment 3:**</a>
I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. 

I don't have access to a 32-bit machine and so cannot test.



---

archive/issue_comments_361474.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nYou could also forbid using a non-exact solver for this problem.",
    "created_at": "2017-09-07T15:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361474",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>**Comment 4:**</a>
You could also forbid using a non-exact solver for this problem.



---

archive/issue_comments_361475.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nSure, we can force `PPL`, but it is way slower (can sometimes be faster on small graphs).\n\n```\nsage: G = graphs.Grid2dGraph(6,6)\nsage: %time G.fractional_chromatic_index(solver='GLPK')\nCPU times: user 43.4 ms, sys: 4.9 ms, total: 48.3 ms\nWall time: 52.1 ms\n4.0\nsage: %time G.fractional_chromatic_index(solver='PPL')\nCPU times: user 1min 11s, sys: 256 ms, total: 1min 11s\nWall time: 1min 12s\n4\n```\nI agree that using a tolerance gap is not a nice solution either.",
    "created_at": "2017-09-07T17:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361475",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'>**Comment 5:**</a>
Sure, we can force `PPL`, but it is way slower (can sometimes be faster on small graphs).

```
sage: G = graphs.Grid2dGraph(6,6)
sage: %time G.fractional_chromatic_index(solver='GLPK')
CPU times: user 43.4 ms, sys: 4.9 ms, total: 48.3 ms
Wall time: 52.1 ms
4.0
sage: %time G.fractional_chromatic_index(solver='PPL')
CPU times: user 1min 11s, sys: 256 ms, total: 1min 11s
Wall time: 1min 12s
4
```
I agree that using a tolerance gap is not a nice solution either.



---

archive/issue_comments_361476.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nI don't see better solution than making `PPL` the default solver here.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11\">7485007</a></td><td><code>trac #23798: set PPL has default solver</code></td></tr></table>\n",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361476",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'>**Comment 6:**</a>
I don't see better solution than making `PPL` the default solver here.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11">7485007</a></td><td><code>trac #23798: set PPL has default solver</code></td></tr></table>




---

archive/issue_comments_361477.json:
```json
{
    "body": "**Commit:** [74850077e305024907037e4094f5956ef5a59e11](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361477",
    "user": "https://github.com/dcoudert"
}
```

**Commit:** [74850077e305024907037e4094f5956ef5a59e11](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)



---

archive/issue_comments_361478.json:
```json
{
    "body": "**Author:** David Coudert",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361478",
    "user": "https://github.com/dcoudert"
}
```

**Author:** David Coudert



---

archive/issue_events_287441.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-21T08:51:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287441"
}
```



---

archive/issue_comments_361479.json:
```json
{
    "body": "**Branch:** [u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361479",
    "user": "https://github.com/dcoudert"
}
```

**Branch:** [u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)



---

archive/issue_events_287442.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T20:05:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287442"
}
```



---

archive/issue_events_287443.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T20:05:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287443"
}
```



---

archive/issue_comments_361480.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n\"Be aware that this method may loop endlessly when using some non exact solvers on 32-bits\". I doubt that this is problem specific to 32 bits. The wording seems to imply that it's safe to use non-exact solvers on 64-bit machines.",
    "created_at": "2017-10-22T20:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361480",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>**Comment 7:**</a>
"Be aware that this method may loop endlessly when using some non exact solvers on 32-bits". I doubt that this is problem specific to 32 bits. The wording seems to imply that it's safe to use non-exact solvers on 64-bit machines.



---

archive/issue_comments_361481.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nAlso, this isn't quite correct:\n\n```\nTickets :trac:`23658` and :trac:`23798` are fixed::\n```\nfollowed by a test with GLPK.",
    "created_at": "2017-10-22T20:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361481",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>**Comment 8:**</a>
Also, this isn't quite correct:

```
Tickets :trac:`23658` and :trac:`23798` are fixed::
```
followed by a test with GLPK.



---

archive/issue_comments_361482.json:
```json
{
    "body": "**Changing commit** from \"[74850077e305024907037e4094f5956ef5a59e11](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)\" to \"[910fb839eb4612f42bf61858d0f0725fb1f2559c](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)\".",
    "created_at": "2017-10-22T21:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361482",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[74850077e305024907037e4094f5956ef5a59e11](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)" to "[910fb839eb4612f42bf61858d0f0725fb1f2559c](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)".



---

archive/issue_comments_361483.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c\">910fb83</a></td><td><code>trac #23798: reviewers comments</code></td></tr></table>\n",
    "created_at": "2017-10-22T21:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361483",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>**Comment 9:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c">910fb83</a></td><td><code>trac #23798: reviewers comments</code></td></tr></table>




---

archive/issue_comments_361484.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nIs this more appropriate ?",
    "created_at": "2017-10-22T21:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361484",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'>**Comment 10:**</a>
Is this more appropriate ?



---

archive/issue_events_287444.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-22T21:24:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287444"
}
```



---

archive/issue_events_287445.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-22T21:24:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287445"
}
```



---

archive/issue_comments_361485.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nWell, it depends. Do you consider the code here to be a fix or a workaround? I am asking because you need to decide what to do with\n\n```\nsage: g.fractional_chromatic_index(solver='GLPK') # known bug (#23798)\n```\nYou cannot say that this ticket is a known bug while at the same time fixing this ticket.",
    "created_at": "2017-10-23T07:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361485",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>**Comment 11:**</a>
Well, it depends. Do you consider the code here to be a fix or a workaround? I am asking because you need to decide what to do with

```
sage: g.fractional_chromatic_index(solver='GLPK') # known bug (#23798)
```
You cannot say that this ticket is a known bug while at the same time fixing this ticket.



---

archive/issue_events_287446.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-23T08:03:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287446"
}
```



---

archive/issue_events_287447.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-23T08:03:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287447"
}
```



---

archive/issue_comments_361486.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nThe problem is not fixed. That's why I changed the text to <code>Issue reported in :trac:\\`23658\\` and :trac:\\`23798\\` with non exact solvers::</code>. What else can I write to be more correct/specific?",
    "created_at": "2017-10-23T20:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361486",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:13'>**Comment 13:**</a>
The problem is not fixed. That's why I changed the text to <code>Issue reported in :trac:\`23658\` and :trac:\`23798\` with non exact solvers::</code>. What else can I write to be more correct/specific?



---

archive/issue_comments_361487.json:
```json
{
    "body": "**Changing commit** from \"[910fb839eb4612f42bf61858d0f0725fb1f2559c](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)\" to \"\".",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361487",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[910fb839eb4612f42bf61858d0f0725fb1f2559c](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)" to "".



---

archive/issue_comments_361488.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n             3.0\n ```\n added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n+\n+As a workaround, we use PPL by default in #24099.\n``````\n",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361488",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
             3.0
 ```
 added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.
+
+As a workaround, we use PPL by default in #24099.
``````




---

archive/issue_comments_361489.json:
```json
{
    "body": "**Changing branch** from \"[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)\" to \"\".",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361489",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)" to "".



---

archive/issue_comments_361490.json:
```json
{
    "body": "**Changing author** from \"David Coudert\" to \"\".",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361490",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "David Coudert" to "".



---

archive/issue_comments_361491.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@dcoudert](#comment%3A13):\n> The problem is not fixed.\n\nThen I'm moving your branch to a new ticket: #24099.",
    "created_at": "2017-10-24T17:18:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361491",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@dcoudert](#comment%3A13):
> The problem is not fixed.

Then I'm moving your branch to a new ticket: #24099.



---

archive/issue_comments_361492.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nOK, thanks.",
    "created_at": "2017-10-24T19:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361492",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:16'>**Comment 16:**</a>
OK, thanks.



---

archive/issue_events_287448.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:45:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287448"
}
```



---

archive/issue_events_287449.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:45:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287449"
}
```



---

archive/issue_comments_361493.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nSince #24824, we use GLPK 4.65.\nDoes anyone with access to a 32-bit machine still see the bug ?",
    "created_at": "2020-08-30T11:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361493",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'>**Comment 17:**</a>
Since #24824, we use GLPK 4.65.
Does anyone with access to a 32-bit machine still see the bug ?



---

archive/issue_events_287450.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:46:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287450"
}
```



---

archive/issue_events_287451.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:46:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287451"
}
```



---

archive/issue_events_287452.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287452"
}
```



---

archive/issue_events_287453.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287453"
}
```



---

archive/issue_comments_361494.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361494",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>**Comment 20:**</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_287454.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287454"
}
```



---

archive/issue_events_287455.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287455"
}
```



---

archive/issue_comments_361495.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nReplying to [@dcoudert](#comment%3A17):\n> Since #24824, we use GLPK 4.65.\n> Does anyone with access to a 32-bit machine still see the bug ?\n\nI still see the bug (on a 32-bit debian virtual machine). The default solver seems instantaneous, but I let `solver='GLPK'` run for about 15 minutes and did not get an answer.",
    "created_at": "2021-07-12T04:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361495",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:21'>**Comment 21:**</a>
Replying to [@dcoudert](#comment%3A17):
> Since #24824, we use GLPK 4.65.
> Does anyone with access to a 32-bit machine still see the bug ?

I still see the bug (on a 32-bit debian virtual machine). The default solver seems instantaneous, but I let `solver='GLPK'` run for about 15 minutes and did not get an answer.



---

archive/issue_comments_361496.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nThis is unfortunate.\n\nThe only solutions I see are:\n- Force to use `PPL`, but this is not nice for users with a 64 bits machine (most of the users I guess)\n- Raise an error when the solver is `glpk` on a 32 bits machine\nand none of them are satisfactory.",
    "created_at": "2021-07-12T22:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361496",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'>**Comment 22:**</a>
This is unfortunate.

The only solutions I see are:
- Force to use `PPL`, but this is not nice for users with a 64 bits machine (most of the users I guess)
- Raise an error when the solver is `glpk` on a 32 bits machine
and none of them are satisfactory.



---

archive/issue_comments_361497.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nReplying to [@dcoudert](#comment%3A3):\n> I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. \n\nUsing a tolerance is exactly the right solution. The test for exact `<= 1` and `== 1` is meaningless with a numerical LP solver. LP solvers use perturbations systematically. It is not a bug if the result is not an exact integer.",
    "created_at": "2021-07-12T22:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361497",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>**Comment 23:**</a>
Replying to [@dcoudert](#comment%3A3):
> I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. 

Using a tolerance is exactly the right solution. The test for exact `<= 1` and `== 1` is meaningless with a numerical LP solver. LP solvers use perturbations systematically. It is not a bug if the result is not an exact integer.



---

archive/issue_comments_361498.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nSee also my explanations in [#30635 comment:20](https://github.com/sagemath/sage/issues/30635#comment:20) and following.",
    "created_at": "2021-07-12T22:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361498",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'>**Comment 24:**</a>
See also my explanations in [#30635 comment:20](https://github.com/sagemath/sage/issues/30635#comment:20) and following.



---

archive/issue_comments_361499.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nthere are two LPs involved, one of them for a maximum weight matching, something that can be instead done by a combinatorial algorithm, see e.g. Blossom V in http://pub.ist.ac.at/~vnk/software.html",
    "created_at": "2021-07-13T10:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361499",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'>**Comment 25:**</a>
there are two LPs involved, one of them for a maximum weight matching, something that can be instead done by a combinatorial algorithm, see e.g. Blossom V in http://pub.ist.ac.at/~vnk/software.html



---

archive/issue_comments_361500.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nIf I force PPL on the inner (matching) LP:\n\n```diff\n--- a/src/sage/graphs/graph_coloring.pyx\n+++ b/src/sage/graphs/graph_coloring.pyx\n@@ -825,7 +825,7 @@ def fractional_chromatic_index(G, solver=\"PPL\", verbose_constraints=False, verbo\n     frozen_edges = [frozenset(e) for e in G.edges(labels=False, sort=False)]\n \n     # Initialize LP for maximum weight matching\n-    M = MixedIntegerLinearProgram(solver=solver, constraint_generation=True)\n+    M = MixedIntegerLinearProgram(solver=\"PPL\", constraint_generation=True)\n \n     # One variable per edge\n     b = M.new_variable(binary=True, nonnegative=True)\n```\nthen on a 32-bit system it's all fine (GLPK from the system, unpatched, so these extra messages)\n\n```\nsage: G=graphs.PetersenGraph()\nsage: G.fractional_chromatic_index(solver=\"GLPK\")\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\n3.0\n```",
    "created_at": "2021-07-13T10:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'>**Comment 26:**</a>
If I force PPL on the inner (matching) LP:

```diff
--- a/src/sage/graphs/graph_coloring.pyx
+++ b/src/sage/graphs/graph_coloring.pyx
@@ -825,7 +825,7 @@ def fractional_chromatic_index(G, solver="PPL", verbose_constraints=False, verbo
     frozen_edges = [frozenset(e) for e in G.edges(labels=False, sort=False)]
 
     # Initialize LP for maximum weight matching
-    M = MixedIntegerLinearProgram(solver=solver, constraint_generation=True)
+    M = MixedIntegerLinearProgram(solver="PPL", constraint_generation=True)
 
     # One variable per edge
     b = M.new_variable(binary=True, nonnegative=True)
```
then on a 32-bit system it's all fine (GLPK from the system, unpatched, so these extra messages)

```
sage: G=graphs.PetersenGraph()
sage: G.fractional_chromatic_index(solver="GLPK")
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
3.0
```



---

archive/issue_comments_361501.json:
```json
{
    "body": "**Branch:** [public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361501",
    "user": "https://github.com/dcoudert"
}
```

**Branch:** [public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)



---

archive/issue_comments_361502.json:
```json
{
    "body": "**Author:** David Coudert",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361502",
    "user": "https://github.com/dcoudert"
}
```

**Author:** David Coudert



---

archive/issue_comments_361503.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nFollowing above discussion, I added a tolerance gap for numerical LP solvers. \n\nNote that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305\">ebcde7c</a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>\n",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361503",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:27'>**Comment 27:**</a>
Following above discussion, I added a tolerance gap for numerical LP solvers. 

Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305">ebcde7c</a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>




---

archive/issue_events_287456.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-07-13T14:39:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287456"
}
```



---

archive/issue_events_287457.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-07-13T14:39:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287457"
}
```



---

archive/issue_comments_361504.json:
```json
{
    "body": "**Commit:** [ebcde7c37ea3a8377fbcebe2246aae890e9df305](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361504",
    "user": "https://github.com/dcoudert"
}
```

**Commit:** [ebcde7c37ea3a8377fbcebe2246aae890e9df305](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)



---

archive/issue_comments_361505.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nI don\u2019t  like this approach. Without explicit guarantees that these tolerances are correct, it is replacing correct algorithms with heuristics.",
    "created_at": "2021-07-13T22:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361505",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'>**Comment 28:**</a>
I don’t  like this approach. Without explicit guarantees that these tolerances are correct, it is replacing correct algorithms with heuristics.



---

archive/issue_comments_361506.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\n\n```\n         matching = [fe for fe in frozen_edges if M.get_values(b[fe]) == 1]\n```\nThis line also needs changing because the test \"== 1\" is not robust.",
    "created_at": "2021-07-13T22:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361506",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'>**Comment 29:**</a>

```
         matching = [fe for fe in frozen_edges if M.get_values(b[fe]) == 1]
```
This line also needs changing because the test "== 1" is not robust.



---

archive/issue_comments_361507.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nI don\u2019t see how one can make the oracle (the inner LP) inexact, without potentially returning a very wrong answer. \n\nThe oracle checks that there is no maximum weight matching of weight >1. Say, we let it error by epsilon, i.e we terminate with oracle returning 1+epsilon. Potentially, there could be K maximum matchings with this weight, if they are disjoint this means that the final error is K times epsilon, oops\u2026",
    "created_at": "2021-07-13T22:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361507",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'>**Comment 30:**</a>
I don’t see how one can make the oracle (the inner LP) inexact, without potentially returning a very wrong answer. 

The oracle checks that there is no maximum weight matching of weight >1. Say, we let it error by epsilon, i.e we terminate with oracle returning 1+epsilon. Potentially, there could be K maximum matchings with this weight, if they are disjoint this means that the final error is K times epsilon, oops…



---

archive/issue_events_287458.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-13T22:50:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287458"
}
```



---

archive/issue_events_287459.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-13T22:50:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287459"
}
```



---

archive/issue_comments_361508.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2021-07-13T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361508",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_361509.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nI don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends.",
    "created_at": "2021-07-14T10:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361509",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:32'>**Comment 32:**</a>
I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends.



---

archive/issue_comments_361510.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nReplying to [@dcoudert](#comment%3A32):\n> I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends. \n\nNo, my point is that without a special analysis it's not possible to argue that solving the oracle problem  (with non-integer objective function) inexactly provides a correct result, even if you \"correctly\" round 0.9999... to 1. It's because a small oracle error may get amplified a lot in the main LP. \nWelcome to floating point hell :-)|",
    "created_at": "2021-07-14T21:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361510",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'>**Comment 33:**</a>
Replying to [@dcoudert](#comment%3A32):
> I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends. 

No, my point is that without a special analysis it's not possible to argue that solving the oracle problem  (with non-integer objective function) inexactly provides a correct result, even if you "correctly" round 0.9999... to 1. It's because a small oracle error may get amplified a lot in the main LP. 
Welcome to floating point hell :-)|



---

archive/issue_comments_361511.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nReplying to [@dcoudert](#comment%3A27):\n> Following above discussion, I added a tolerance gap for numerical LP solvers. \n> \n> Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...\n\n\nThe oracle implementation here is naive, and bound to get very slow; it's integer LP without Edmonds' constraints,\ninstead of a \"normal\" LP over the matching polytope with Edmonds' constraints (aka blossom inequalities).\nSo this would need yet another oracle (as there are too exponentially many inequalities there), but well, it's polynomial time then.\nThe generated constraints can stay, so this should be fast.\n\n> ---\n> **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305\">ebcde7c</a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>\n",
    "created_at": "2021-07-15T12:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361511",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'>**Comment 34:**</a>
Replying to [@dcoudert](#comment%3A27):
> Following above discussion, I added a tolerance gap for numerical LP solvers. 
> 
> Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...


The oracle implementation here is naive, and bound to get very slow; it's integer LP without Edmonds' constraints,
instead of a "normal" LP over the matching polytope with Edmonds' constraints (aka blossom inequalities).
So this would need yet another oracle (as there are too exponentially many inequalities there), but well, it's polynomial time then.
The generated constraints can stay, so this should be fast.

> ---
> **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305">ebcde7c</a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>




---

archive/issue_comments_361512.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nI took a quick look at the function now. I would suggest the following changes:\n\n1. Before adding a new constraint to the master problem, verify that `matching` is indeed a matching. In this way, the master problem will always be a correct relaxation, even if an inexact oracle is used.\n\n2. When the numerical solver that is used for solving the separation problem does not find a matching of value greater than 1 + epsilon, you can switch to PPL - then, with a bit of luck, it can prove the bound <= 1.\n\n3. It will make sense to have separate parameters for the solver used for the master problem and the one(s) used for the separation problem.",
    "created_at": "2021-07-19T14:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361512",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'>**Comment 35:**</a>
I took a quick look at the function now. I would suggest the following changes:

1. Before adding a new constraint to the master problem, verify that `matching` is indeed a matching. In this way, the master problem will always be a correct relaxation, even if an inexact oracle is used.

2. When the numerical solver that is used for solving the separation problem does not find a matching of value greater than 1 + epsilon, you can switch to PPL - then, with a bit of luck, it can prove the bound <= 1.

3. It will make sense to have separate parameters for the solver used for the master problem and the one(s) used for the separation problem.



---

archive/issue_comments_361513.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nActually, it seems that even with PPL, the code is just wrong, as PPL does not do MILP, it only does LP, right?",
    "created_at": "2021-07-19T17:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361513",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'>**Comment 36:**</a>
Actually, it seems that even with PPL, the code is just wrong, as PPL does not do MILP, it only does LP, right?



---

archive/issue_comments_361514.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nThe PPL does have a (very limited) MIP solver.",
    "created_at": "2021-07-19T18:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361514",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'>**Comment 37:**</a>
The PPL does have a (very limited) MIP solver.



---

archive/issue_events_287460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287460"
}
```



---

archive/issue_events_287461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287461"
}
```



---

archive/issue_comments_361515.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1926be513dba64bff010ca84fb9ac5695bac020e\">1926be5</a></td><td><code>trac #23798: merged with 9.5.beta5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b\">43e8873</a></td><td><code>trac #23798: ideas from comment 35</code></td></tr></table>\n",
    "created_at": "2021-11-06T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361515",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>**Comment 39:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1926be513dba64bff010ca84fb9ac5695bac020e">1926be5</a></td><td><code>trac #23798: merged with 9.5.beta5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b">43e8873</a></td><td><code>trac #23798: ideas from comment 35</code></td></tr></table>




---

archive/issue_comments_361516.json:
```json
{
    "body": "**Changing commit** from \"[ebcde7c37ea3a8377fbcebe2246aae890e9df305](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)\" to \"[43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)\".",
    "created_at": "2021-11-06T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361516",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[ebcde7c37ea3a8377fbcebe2246aae890e9df305](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)" to "[43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)".



---

archive/issue_comments_361517.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nI tried the ideas from #comment:35. I have let some code for debugging as the code may loop forever when using `GLPK` for both master and separation problems. The patchbot will complain...\n\nWe should search for another method not relying on LP solvers, if any...",
    "created_at": "2021-11-06T16:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-361517",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:40'>**Comment 40:**</a>
I tried the ideas from #comment:35. I have let some code for debugging as the code may loop forever when using `GLPK` for both master and separation problems. The patchbot will complain...

We should search for another method not relying on LP solvers, if any...



---

archive/issue_events_287462.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287462"
}
```



---

archive/issue_events_287463.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287463"
}
```



---

archive/issue_events_287464.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287464"
}
```



---

archive/issue_events_287465.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287465"
}
```



---

archive/issue_events_287466.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287466"
}
```



---

archive/issue_events_287467.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-287467"
}
```
