# Issue 23798: Fractional Chromatic Index test fails with GLPK

archive/issues_023561.json:
```json
{
    "assignees": [],
    "body": "The test\n\n```\n            sage: g = graphs.PetersenGraph()\n            sage: g.fractional_chromatic_index(solver='GLPK')\n            3.0\n```\nadded in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n\nAs a workaround, we use PPL by default in #24099.\n\nCC:  @dcoudert\n\nComponent: **graph theory**\n\nAuthor: **David Coudert**\n\nBranch/Commit: **[public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index) @ [`43e8873`](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23798_\n\n",
    "created_at": "2017-09-07T11:51:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fractional Chromatic Index test fails with GLPK",
    "type": "issue",
    "updated_at": "2022-08-31T02:51:13Z",
    "url": "https://github.com/sagemath/sage/issues/23798",
    "user": "https://github.com/jdemeyer"
}
```
The test

```
            sage: g = graphs.PetersenGraph()
            sage: g.fractional_chromatic_index(solver='GLPK')
            3.0
```
added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.

As a workaround, we use PPL by default in #24099.

CC:  @dcoudert

Component: **graph theory**

Author: **David Coudert**

Branch/Commit: **[public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index) @ [`43e8873`](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/23798_





---

archive/issue_events_327756.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327756"
}
```



---

archive/issue_events_327757.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327757"
}
```



---

archive/issue_events_327758.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327758"
}
```



---

archive/issue_events_327759.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:51:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327759"
}
```



---

archive/issue_comments_358851.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,4 +5,4 @@\n             sage: g.fractional_chromatic_index(solver='GLPK')\n             3.0\n ```\n-added by #23658 fails with GLPK on 32-bit.\n+added by #23658 fails with GLPK-4.63 on 32-bit.\n``````\n",
    "created_at": "2017-09-07T11:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358851",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,4 +5,4 @@
             sage: g.fractional_chromatic_index(solver='GLPK')
             3.0
 ```
-added by #23658 fails with GLPK on 32-bit.
+added by #23658 fails with GLPK-4.63 on 32-bit.
``````




---

archive/issue_events_327760.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-09-07T11:54:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "title_is": "Fractional Chromatic Index test fails with GLPK",
    "title_was": "Fractional Chromatic Index Infinite Loop fails with GLPK",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327760"
}
```



---

archive/issue_comments_358852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,4 +5,4 @@\n             sage: g.fractional_chromatic_index(solver='GLPK')\n             3.0\n ```\n-added by #23658 fails with GLPK-4.63 on 32-bit.\n+added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n``````\n",
    "created_at": "2017-09-07T11:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358852",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,4 +5,4 @@
             sage: g.fractional_chromatic_index(solver='GLPK')
             3.0
 ```
-added by #23658 fails with GLPK-4.63 on 32-bit.
+added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.
``````




---

archive/issue_comments_358853.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. \n\nI don't have access to a 32-bit machine and so cannot test.",
    "created_at": "2017-09-07T13:31:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358853",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. 

I don't have access to a 32-bit machine and so cannot test.



---

archive/issue_comments_358854.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYou could also forbid using a non-exact solver for this problem.",
    "created_at": "2017-09-07T15:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358854",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

You could also forbid using a non-exact solver for this problem.



---

archive/issue_comments_358855.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSure, we can force `PPL`, but it is way slower (can sometimes be faster on small graphs).\n\n```\nsage: G = graphs.Grid2dGraph(6,6)\nsage: %time G.fractional_chromatic_index(solver='GLPK')\nCPU times: user 43.4 ms, sys: 4.9 ms, total: 48.3 ms\nWall time: 52.1 ms\n4.0\nsage: %time G.fractional_chromatic_index(solver='PPL')\nCPU times: user 1min 11s, sys: 256 ms, total: 1min 11s\nWall time: 1min 12s\n4\n```\nI agree that using a tolerance gap is not a nice solution either.",
    "created_at": "2017-09-07T17:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358855",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

Sure, we can force `PPL`, but it is way slower (can sometimes be faster on small graphs).

```
sage: G = graphs.Grid2dGraph(6,6)
sage: %time G.fractional_chromatic_index(solver='GLPK')
CPU times: user 43.4 ms, sys: 4.9 ms, total: 48.3 ms
Wall time: 52.1 ms
4.0
sage: %time G.fractional_chromatic_index(solver='PPL')
CPU times: user 1min 11s, sys: 256 ms, total: 1min 11s
Wall time: 1min 12s
4
```
I agree that using a tolerance gap is not a nice solution either.



---

archive/issue_comments_358856.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't see better solution than making `PPL` the default solver here.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11\"><code>7485007</code></a></td><td><code>trac #23798: set PPL has default solver</code></td></tr></table>\n",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358856",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't see better solution than making `PPL` the default solver here.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11"><code>7485007</code></a></td><td><code>trac #23798: set PPL has default solver</code></td></tr></table>




---

archive/issue_comments_358857.json:
```json
{
    "body": "Commit: **[`7485007`](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)**",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358857",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`7485007`](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)**



---

archive/issue_comments_358858.json:
```json
{
    "body": "Author: **David Coudert**",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358858",
    "user": "https://github.com/dcoudert"
}
```

Author: **David Coudert**



---

archive/issue_events_327761.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-21T08:51:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327761"
}
```



---

archive/issue_comments_358859.json:
```json
{
    "body": "Branch: **[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)**",
    "created_at": "2017-10-21T08:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358859",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)**



---

archive/issue_events_327762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T20:05:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327762"
}
```



---

archive/issue_events_327763.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-22T20:05:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327763"
}
```



---

archive/issue_comments_358860.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n\"Be aware that this method may loop endlessly when using some non exact solvers on 32-bits\". I doubt that this is problem specific to 32 bits. The wording seems to imply that it's safe to use non-exact solvers on 64-bit machines.",
    "created_at": "2017-10-22T20:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358860",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

"Be aware that this method may loop endlessly when using some non exact solvers on 32-bits". I doubt that this is problem specific to 32 bits. The wording seems to imply that it's safe to use non-exact solvers on 64-bit machines.



---

archive/issue_comments_358861.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAlso, this isn't quite correct:\n\n```\nTickets :trac:`23658` and :trac:`23798` are fixed::\n```\nfollowed by a test with GLPK.",
    "created_at": "2017-10-22T20:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358861",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Also, this isn't quite correct:

```
Tickets :trac:`23658` and :trac:`23798` are fixed::
```
followed by a test with GLPK.



---

archive/issue_comments_358862.json:
```json
{
    "body": "Changed commit from **[`7485007`](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)** to **[`910fb83`](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)**",
    "created_at": "2017-10-22T21:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358862",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7485007`](https://github.com/sagemath/sagetrac-mirror/commit/74850077e305024907037e4094f5956ef5a59e11)** to **[`910fb83`](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)**



---

archive/issue_comments_358863.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c\"><code>910fb83</code></a></td><td><code>trac #23798: reviewers comments</code></td></tr></table>\n",
    "created_at": "2017-10-22T21:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358863",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c"><code>910fb83</code></a></td><td><code>trac #23798: reviewers comments</code></td></tr></table>




---

archive/issue_comments_358864.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIs this more appropriate ?",
    "created_at": "2017-10-22T21:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358864",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Is this more appropriate ?



---

archive/issue_events_327764.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-22T21:24:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327764"
}
```



---

archive/issue_events_327765.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2017-10-22T21:24:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327765"
}
```



---

archive/issue_comments_358865.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWell, it depends. Do you consider the code here to be a fix or a workaround? I am asking because you need to decide what to do with\n\n```\nsage: g.fractional_chromatic_index(solver='GLPK') # known bug (#23798)\n```\nYou cannot say that this ticket is a known bug while at the same time fixing this ticket.",
    "created_at": "2017-10-23T07:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358865",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Well, it depends. Do you consider the code here to be a fix or a workaround? I am asking because you need to decide what to do with

```
sage: g.fractional_chromatic_index(solver='GLPK') # known bug (#23798)
```
You cannot say that this ticket is a known bug while at the same time fixing this ticket.



---

archive/issue_events_327766.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-23T08:03:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327766"
}
```



---

archive/issue_events_327767.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-23T08:03:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327767"
}
```



---

archive/issue_comments_358866.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe problem is not fixed. That's why I changed the text to <code>Issue reported in :trac:\\`23658\\` and :trac:\\`23798\\` with non exact solvers::</code>. What else can I write to be more correct/specific?",
    "created_at": "2017-10-23T20:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358866",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:13" align="right">comment:13</div>

The problem is not fixed. That's why I changed the text to <code>Issue reported in :trac:\`23658\` and :trac:\`23798\` with non exact solvers::</code>. What else can I write to be more correct/specific?



---

archive/issue_comments_358867.json:
```json
{
    "body": "Changed commit from **[`910fb83`](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)** to none",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358867",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`910fb83`](https://github.com/sagemath/sagetrac-mirror/commit/910fb839eb4612f42bf61858d0f0725fb1f2559c)** to none



---

archive/issue_comments_358868.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n             3.0\n ```\n added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.\n+\n+As a workaround, we use PPL by default in #24099.\n``````\n",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358868",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
             3.0
 ```
 added in `src/sage/graphs/graph.py` by #23658 fails with GLPK-4.63 on 32-bit.
+
+As a workaround, we use PPL by default in #24099.
``````




---

archive/issue_comments_358869.json:
```json
{
    "body": "Changed branch from **[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)** to none",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358869",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/dcoudert/23798](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/23798)** to none



---

archive/issue_comments_358870.json:
```json
{
    "body": "Changed author from **David Coudert** to none",
    "created_at": "2017-10-24T17:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358870",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **David Coudert** to none



---

archive/issue_comments_358871.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@dcoudert](#comment%3A13):\n> The problem is not fixed.\n\nThen I'm moving your branch to a new ticket: #24099.",
    "created_at": "2017-10-24T17:18:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358871",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@dcoudert](#comment%3A13):
> The problem is not fixed.

Then I'm moving your branch to a new ticket: #24099.



---

archive/issue_comments_358872.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOK, thanks.",
    "created_at": "2017-10-24T19:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358872",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

OK, thanks.



---

archive/issue_events_327768.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:45:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327768"
}
```



---

archive/issue_events_327769.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:45:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327769"
}
```



---

archive/issue_comments_358873.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSince #24824, we use GLPK 4.65.\nDoes anyone with access to a 32-bit machine still see the bug ?",
    "created_at": "2020-08-30T11:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358873",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:17" align="right">comment:17</div>

Since #24824, we use GLPK 4.65.
Does anyone with access to a 32-bit machine still see the bug ?



---

archive/issue_events_327770.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:46:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327770"
}
```



---

archive/issue_events_327771.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-30T11:46:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327771"
}
```



---

archive/issue_events_327772.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327772"
}
```



---

archive/issue_events_327773.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327773"
}
```



---

archive/issue_comments_358874.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358874",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_327774.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327774"
}
```



---

archive/issue_events_327775.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327775"
}
```



---

archive/issue_comments_358875.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dcoudert](#comment%3A17):\n> Since #24824, we use GLPK 4.65.\n> Does anyone with access to a 32-bit machine still see the bug ?\n\nI still see the bug (on a 32-bit debian virtual machine). The default solver seems instantaneous, but I let `solver='GLPK'` run for about 15 minutes and did not get an answer.",
    "created_at": "2021-07-12T04:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358875",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dcoudert](#comment%3A17):
> Since #24824, we use GLPK 4.65.
> Does anyone with access to a 32-bit machine still see the bug ?

I still see the bug (on a 32-bit debian virtual machine). The default solver seems instantaneous, but I let `solver='GLPK'` run for about 15 minutes and did not get an answer.



---

archive/issue_comments_358876.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis is unfortunate.\n\nThe only solutions I see are:\n- Force to use `PPL`, but this is not nice for users with a 64 bits machine (most of the users I guess)\n- Raise an error when the solver is `glpk` on a 32 bits machine\nand none of them are satisfactory.",
    "created_at": "2021-07-12T22:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358876",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

This is unfortunate.

The only solutions I see are:
- Force to use `PPL`, but this is not nice for users with a 64 bits machine (most of the users I guess)
- Raise an error when the solver is `glpk` on a 32 bits machine
and none of them are satisfactory.



---

archive/issue_comments_358877.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dcoudert](#comment%3A3):\n> I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. \n\nUsing a tolerance is exactly the right solution. The test for exact `<= 1` and `== 1` is meaningless with a numerical LP solver. LP solvers use perturbations systematically. It is not a bug if the result is not an exact integer.",
    "created_at": "2021-07-12T22:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358877",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dcoudert](#comment%3A3):
> I suspect that we need to change `if M.solve(log = verbose) <= 1:` to `if M.solve(log = verbose) <= 1 + tol:`, where `tol = 0 if solver=='PPL' else 1e-6`. I don't like this solution, but I don't know what else we can do. 

Using a tolerance is exactly the right solution. The test for exact `<= 1` and `== 1` is meaningless with a numerical LP solver. LP solvers use perturbations systematically. It is not a bug if the result is not an exact integer.



---

archive/issue_comments_358878.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSee also my explanations in [#30635 comment:20](https://github.com/sagemath/sage/issues/30635#comment:20) and following.",
    "created_at": "2021-07-12T22:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358878",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

See also my explanations in [#30635 comment:20](https://github.com/sagemath/sage/issues/30635#comment:20) and following.



---

archive/issue_comments_358879.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nthere are two LPs involved, one of them for a maximum weight matching, something that can be instead done by a combinatorial algorithm, see e.g. Blossom V in http://pub.ist.ac.at/~vnk/software.html",
    "created_at": "2021-07-13T10:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358879",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

there are two LPs involved, one of them for a maximum weight matching, something that can be instead done by a combinatorial algorithm, see e.g. Blossom V in http://pub.ist.ac.at/~vnk/software.html



---

archive/issue_comments_358880.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nIf I force PPL on the inner (matching) LP:\n\n```diff\n--- a/src/sage/graphs/graph_coloring.pyx\n+++ b/src/sage/graphs/graph_coloring.pyx\n@@ -825,7 +825,7 @@ def fractional_chromatic_index(G, solver=\"PPL\", verbose_constraints=False, verbo\n     frozen_edges = [frozenset(e) for e in G.edges(labels=False, sort=False)]\n \n     # Initialize LP for maximum weight matching\n-    M = MixedIntegerLinearProgram(solver=solver, constraint_generation=True)\n+    M = MixedIntegerLinearProgram(solver=\"PPL\", constraint_generation=True)\n \n     # One variable per edge\n     b = M.new_variable(binary=True, nonnegative=True)\n```\nthen on a 32-bit system it's all fine (GLPK from the system, unpatched, so these extra messages)\n\n```\nsage: G=graphs.PetersenGraph()\nsage: G.fractional_chromatic_index(solver=\"GLPK\")\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\nLong-step dual simplex will be used\n3.0\n```",
    "created_at": "2021-07-13T10:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358880",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

If I force PPL on the inner (matching) LP:

```diff
--- a/src/sage/graphs/graph_coloring.pyx
+++ b/src/sage/graphs/graph_coloring.pyx
@@ -825,7 +825,7 @@ def fractional_chromatic_index(G, solver="PPL", verbose_constraints=False, verbo
     frozen_edges = [frozenset(e) for e in G.edges(labels=False, sort=False)]
 
     # Initialize LP for maximum weight matching
-    M = MixedIntegerLinearProgram(solver=solver, constraint_generation=True)
+    M = MixedIntegerLinearProgram(solver="PPL", constraint_generation=True)
 
     # One variable per edge
     b = M.new_variable(binary=True, nonnegative=True)
```
then on a 32-bit system it's all fine (GLPK from the system, unpatched, so these extra messages)

```
sage: G=graphs.PetersenGraph()
sage: G.fractional_chromatic_index(solver="GLPK")
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
Long-step dual simplex will be used
3.0
```



---

archive/issue_comments_358881.json:
```json
{
    "body": "Branch: **[public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)**",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358881",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/graphs/23798_fractional_chromatic_index](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/23798_fractional_chromatic_index)**



---

archive/issue_comments_358882.json:
```json
{
    "body": "Author: **David Coudert**",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358882",
    "user": "https://github.com/dcoudert"
}
```

Author: **David Coudert**



---

archive/issue_comments_358883.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nFollowing above discussion, I added a tolerance gap for numerical LP solvers. \n\nNote that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305\"><code>ebcde7c</code></a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>\n",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358883",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:27" align="right">comment:27</div>

Following above discussion, I added a tolerance gap for numerical LP solvers. 

Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305"><code>ebcde7c</code></a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>




---

archive/issue_events_327776.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-07-13T14:39:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327776"
}
```



---

archive/issue_events_327777.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2021-07-13T14:39:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327777"
}
```



---

archive/issue_comments_358884.json:
```json
{
    "body": "Commit: **[`ebcde7c`](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)**",
    "created_at": "2021-07-13T14:39:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358884",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`ebcde7c`](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)**



---

archive/issue_comments_358885.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI don\u2019t  like this approach. Without explicit guarantees that these tolerances are correct, it is replacing correct algorithms with heuristics.",
    "created_at": "2021-07-13T22:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358885",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

I don’t  like this approach. Without explicit guarantees that these tolerances are correct, it is replacing correct algorithms with heuristics.



---

archive/issue_comments_358886.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\n\n```\n         matching = [fe for fe in frozen_edges if M.get_values(b[fe]) == 1]\n```\nThis line also needs changing because the test \"== 1\" is not robust.",
    "created_at": "2021-07-13T22:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358886",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>


```
         matching = [fe for fe in frozen_edges if M.get_values(b[fe]) == 1]
```
This line also needs changing because the test "== 1" is not robust.



---

archive/issue_comments_358887.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI don\u2019t see how one can make the oracle (the inner LP) inexact, without potentially returning a very wrong answer. \n\nThe oracle checks that there is no maximum weight matching of weight >1. Say, we let it error by epsilon, i.e we terminate with oracle returning 1+epsilon. Potentially, there could be K maximum matchings with this weight, if they are disjoint this means that the final error is K times epsilon, oops\u2026",
    "created_at": "2021-07-13T22:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358887",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

I don’t see how one can make the oracle (the inner LP) inexact, without potentially returning a very wrong answer. 

The oracle checks that there is no maximum weight matching of weight >1. Say, we let it error by epsilon, i.e we terminate with oracle returning 1+epsilon. Potentially, there could be K maximum matchings with this weight, if they are disjoint this means that the final error is K times epsilon, oops…



---

archive/issue_events_327778.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-13T22:50:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327778"
}
```



---

archive/issue_events_327779.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-07-13T22:50:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327779"
}
```



---

archive/issue_comments_358888.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-07-13T22:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358888",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_358889.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends.",
    "created_at": "2021-07-14T10:48:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358889",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:32" align="right">comment:32</div>

I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends.



---

archive/issue_comments_358890.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@dcoudert](#comment%3A32):\n> I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends. \n\nNo, my point is that without a special analysis it's not possible to argue that solving the oracle problem  (with non-integer objective function) inexactly provides a correct result, even if you \"correctly\" round 0.9999... to 1. It's because a small oracle error may get amplified a lot in the main LP. \nWelcome to floating point hell :-)|",
    "created_at": "2021-07-14T21:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358890",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@dcoudert](#comment%3A32):
> I don't like this solution either but I don't know what to do when a solver returns 0.99999... instead of 1 although we have set the variable type to binary. The solvers are aware of the type of the variable and so should return a value with the correct type and not a double. The solution might be in the backends. 

No, my point is that without a special analysis it's not possible to argue that solving the oracle problem  (with non-integer objective function) inexactly provides a correct result, even if you "correctly" round 0.9999... to 1. It's because a small oracle error may get amplified a lot in the main LP. 
Welcome to floating point hell :-)|



---

archive/issue_comments_358891.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@dcoudert](#comment%3A27):\n> Following above discussion, I added a tolerance gap for numerical LP solvers. \n> \n> Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...\n\n\nThe oracle implementation here is naive, and bound to get very slow; it's integer LP without Edmonds' constraints,\ninstead of a \"normal\" LP over the matching polytope with Edmonds' constraints (aka blossom inequalities).\nSo this would need yet another oracle (as there are too exponentially many inequalities there), but well, it's polynomial time then.\nThe generated constraints can stay, so this should be fast.\n\n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305\"><code>ebcde7c</code></a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>\n",
    "created_at": "2021-07-15T12:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358891",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@dcoudert](#comment%3A27):
> Following above discussion, I added a tolerance gap for numerical LP solvers. 
> 
> Note that we can use the `networkx` implementation of the blossom algorithm via the `matching` method, but it does not solve the issue. Actually, it's slower and worse for the rounding as I observe the issue on a 64 bits machine...


The oracle implementation here is naive, and bound to get very slow; it's integer LP without Edmonds' constraints,
instead of a "normal" LP over the matching polytope with Edmonds' constraints (aka blossom inequalities).
So this would need yet another oracle (as there are too exponentially many inequalities there), but well, it's polynomial time then.
The generated constraints can stay, so this should be fast.

> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305"><code>ebcde7c</code></a></td><td><code>trac #23798: add tolerance gap for numerical LP solvers</code></td></tr></table>




---

archive/issue_comments_358892.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI took a quick look at the function now. I would suggest the following changes:\n\n1. Before adding a new constraint to the master problem, verify that `matching` is indeed a matching. In this way, the master problem will always be a correct relaxation, even if an inexact oracle is used.\n\n2. When the numerical solver that is used for solving the separation problem does not find a matching of value greater than 1 + epsilon, you can switch to PPL - then, with a bit of luck, it can prove the bound <= 1.\n\n3. It will make sense to have separate parameters for the solver used for the master problem and the one(s) used for the separation problem.",
    "created_at": "2021-07-19T14:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358892",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

I took a quick look at the function now. I would suggest the following changes:

1. Before adding a new constraint to the master problem, verify that `matching` is indeed a matching. In this way, the master problem will always be a correct relaxation, even if an inexact oracle is used.

2. When the numerical solver that is used for solving the separation problem does not find a matching of value greater than 1 + epsilon, you can switch to PPL - then, with a bit of luck, it can prove the bound <= 1.

3. It will make sense to have separate parameters for the solver used for the master problem and the one(s) used for the separation problem.



---

archive/issue_comments_358893.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nActually, it seems that even with PPL, the code is just wrong, as PPL does not do MILP, it only does LP, right?",
    "created_at": "2021-07-19T17:25:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358893",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

Actually, it seems that even with PPL, the code is just wrong, as PPL does not do MILP, it only does LP, right?



---

archive/issue_comments_358894.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThe PPL does have a (very limited) MIP solver.",
    "created_at": "2021-07-19T18:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358894",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

The PPL does have a (very limited) MIP solver.



---

archive/issue_events_327780.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327780"
}
```



---

archive/issue_events_327781.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327781"
}
```



---

archive/issue_comments_358895.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1926be513dba64bff010ca84fb9ac5695bac020e\"><code>1926be5</code></a></td><td><code>trac #23798: merged with 9.5.beta5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b\"><code>43e8873</code></a></td><td><code>trac #23798: ideas from comment 35</code></td></tr></table>\n",
    "created_at": "2021-11-06T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358895",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1926be513dba64bff010ca84fb9ac5695bac020e"><code>1926be5</code></a></td><td><code>trac #23798: merged with 9.5.beta5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b"><code>43e8873</code></a></td><td><code>trac #23798: ideas from comment 35</code></td></tr></table>




---

archive/issue_comments_358896.json:
```json
{
    "body": "Changed commit from **[`ebcde7c`](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)** to **[`43e8873`](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)**",
    "created_at": "2021-11-06T16:25:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358896",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ebcde7c`](https://github.com/sagemath/sagetrac-mirror/commit/ebcde7c37ea3a8377fbcebe2246aae890e9df305)** to **[`43e8873`](https://github.com/sagemath/sagetrac-mirror/commit/43e8873f6ac619c93fe8f8b5b79b7c8060cfeb9b)**



---

archive/issue_comments_358897.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI tried the ideas from #comment:35. I have let some code for debugging as the code may loop forever when using `GLPK` for both master and separation problems. The patchbot will complain...\n\nWe should search for another method not relying on LP solvers, if any...",
    "created_at": "2021-11-06T16:28:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23798#issuecomment-358897",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:40" align="right">comment:40</div>

I tried the ideas from #comment:35. I have let some code for debugging as the code may loop forever when using `GLPK` for both master and separation problems. The patchbot will complain...

We should search for another method not relying on LP solvers, if any...



---

archive/issue_events_327782.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327782"
}
```



---

archive/issue_events_327783.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T00:37:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327783"
}
```



---

archive/issue_events_327784.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327784"
}
```



---

archive/issue_events_327785.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-11T17:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327785"
}
```



---

archive/issue_events_327786.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327786"
}
```



---

archive/issue_events_327787.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23798",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23798#event-327787"
}
```
