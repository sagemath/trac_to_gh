# Issue 23997: installed_packages(False) gives wrong version for Python packages with patches

archive/issues_023760.json:
```json
{
    "body": "Sage uses a convention to append `.pNUM` to indicate patched or updated packages. However, because of the logic in `installed_packages(False)`, the version number returned by `installed_packages(False)` is the version given by `pip` instead of the Sage version number.\n\nThis causes in particular that optional doctests are not run for such packages. At the moment, the only package with this problem and which has optional doctests is `dot2tex`.\n\nCC:  @koffie\n\nBranch/Commit: 8b4b3052f340736fbf551f6ae45cfb53a0492bce\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23997\n\n",
    "closed_at": "2017-10-15T09:22:03Z",
    "created_at": "2017-10-09T12:33:33Z",
    "labels": [
        "component: misc",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "installed_packages(False) gives wrong version for Python packages with patches",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23997",
    "user": "https://github.com/jdemeyer"
}
```
Sage uses a convention to append `.pNUM` to indicate patched or updated packages. However, because of the logic in `installed_packages(False)`, the version number returned by `installed_packages(False)` is the version given by `pip` instead of the Sage version number.

This causes in particular that optional doctests are not run for such packages. At the moment, the only package with this problem and which has optional doctests is `dot2tex`.

CC:  @koffie

Branch/Commit: 8b4b3052f340736fbf551f6ae45cfb53a0492bce

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23997





---

archive/issue_comments_447626.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Sage uses a convention to append `.pNUM` to indicate patched or updated packages. However, because of the logic in `installed_packages(False)`, the version number returned by `installed_packages(False)` is the version given by `pip` instead of the Sage version number.\n \n-This causes in particular that optional doctests are not run for such packages.\n+This causes in particular that optional doctests are not run for such packages. At the moment, the only package with this problem and which has optional doctests is `dot2tex`.\n``````\n",
    "created_at": "2017-10-09T12:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447626",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Sage uses a convention to append `.pNUM` to indicate patched or updated packages. However, because of the logic in `installed_packages(False)`, the version number returned by `installed_packages(False)` is the version given by `pip` instead of the Sage version number.
 
-This causes in particular that optional doctests are not run for such packages.
+This causes in particular that optional doctests are not run for such packages. At the moment, the only package with this problem and which has optional doctests is `dot2tex`.
``````




---

archive/issue_comments_447627.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/installed_packages_false__gives_wrong_version_for_python_packages_with_patches\"",
    "created_at": "2017-10-09T13:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447627",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/installed_packages_false__gives_wrong_version_for_python_packages_with_patches"



---

archive/issue_comments_447628.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[8b4b305](https://github.com/sagemath/sagetrac-mirror/commit/8b4b3052f340736fbf551f6ae45cfb53a0492bce)|`Sage package version should override pip package version`|",
    "created_at": "2017-10-09T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447628",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[8b4b305](https://github.com/sagemath/sagetrac-mirror/commit/8b4b3052f340736fbf551f6ae45cfb53a0492bce)|`Sage package version should override pip package version`|



---

archive/issue_comments_447629.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-09T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447629",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447630.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-10-09T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447630",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_447631.json:
```json
{
    "body": "Changing commit from \"\" to \"8b4b3052f340736fbf551f6ae45cfb53a0492bce\"",
    "created_at": "2017-10-09T13:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447631",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "8b4b3052f340736fbf551f6ae45cfb53a0492bce"



---

archive/issue_comments_447632.json:
```json
{
    "body": "<a id='comment:5'></a>\nMakes sense to me.",
    "created_at": "2017-10-09T15:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447632",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Makes sense to me.



---

archive/issue_comments_447633.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-10-09T15:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447633",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_447634.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-09T15:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447634",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447635.json:
```json
{
    "body": "Changing commit from \"8b4b3052f340736fbf551f6ae45cfb53a0492bce\" to \"c5ad9c5cf928cb65046e76c9d633e30879874780\"",
    "created_at": "2017-10-09T19:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447635",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8b4b3052f340736fbf551f6ae45cfb53a0492bce" to "c5ad9c5cf928cb65046e76c9d633e30879874780"



---

archive/issue_comments_447636.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-09T19:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447636",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_447637.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[c5ad9c5](https://github.com/sagemath/sagetrac-mirror/commit/c5ad9c5cf928cb65046e76c9d633e30879874780)|`Remove \"optional - dot2tex graphviz\" where it is not needed`|",
    "created_at": "2017-10-09T19:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447637",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[c5ad9c5](https://github.com/sagemath/sagetrac-mirror/commit/c5ad9c5cf928cb65046e76c9d633e30879874780)|`Remove "optional - dot2tex graphviz" where it is not needed`|



---

archive/issue_comments_447638.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-09T19:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_447639.json:
```json
{
    "body": "Changing commit from \"c5ad9c5cf928cb65046e76c9d633e30879874780\" to \"8b4b3052f340736fbf551f6ae45cfb53a0492bce\"",
    "created_at": "2017-10-09T19:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447639",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c5ad9c5cf928cb65046e76c9d633e30879874780" to "8b4b3052f340736fbf551f6ae45cfb53a0492bce"



---

archive/issue_comments_447640.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-09T19:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447640",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447641.json:
```json
{
    "body": "<a id='comment:8'></a>\nAccidentally committed on the wrong branch. Fixed it.",
    "created_at": "2017-10-09T19:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447641",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Accidentally committed on the wrong branch. Fixed it.



---

archive/issue_events_077223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T09:22:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23997#event-77223"
}
```



---

archive/issue_comments_447642.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-15T09:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447642",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_447643.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/installed_packages_false__gives_wrong_version_for_python_packages_with_patches\" to \"8b4b3052f340736fbf551f6ae45cfb53a0492bce\"",
    "created_at": "2017-10-15T09:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23997#issuecomment-447643",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/installed_packages_false__gives_wrong_version_for_python_packages_with_patches" to "8b4b3052f340736fbf551f6ae45cfb53a0492bce"
