# Issue 23089: Use Cython language_level=3 when using Python 3

archive/issues_022852.json:
```json
{
    "assignees": [],
    "body": "to enable Python 3 source code semantics.\n\nhttps://cython.readthedocs.io/en/latest/src/reference/compilation.html#compiler-directives\n\nComponent: **cython**\n\nBranch/Commit: **[u/aapitzsch/23089](https://github.com/sagemath/sagetrac-mirror/tree/u/aapitzsch/23089) @ [`33ce8cf`](https://github.com/sagemath/sagetrac-mirror/commit/33ce8cf2e00635a3560f168a145a73f9ba265517)**\n\nReviewer: **Jeroen Demeyer, Andr\u00e9 Apitzsch**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23089_\n\n",
    "closed_at": "2017-07-13T07:54:31Z",
    "created_at": "2017-05-27T09:59:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use Cython language_level=3 when using Python 3",
    "type": "issue",
    "updated_at": "2018-10-04T15:27:24Z",
    "url": "https://github.com/sagemath/sage/issues/23089",
    "user": "https://github.com/a-andre"
}
```
to enable Python 3 source code semantics.

https://cython.readthedocs.io/en/latest/src/reference/compilation.html#compiler-directives

Component: **cython**

Branch/Commit: **[u/aapitzsch/23089](https://github.com/sagemath/sagetrac-mirror/tree/u/aapitzsch/23089) @ [`33ce8cf`](https://github.com/sagemath/sagetrac-mirror/commit/33ce8cf2e00635a3560f168a145a73f9ba265517)**

Reviewer: **Jeroen Demeyer, André Apitzsch**

_Issue created by migration from https://trac.sagemath.org/ticket/23089_





---

archive/issue_events_319096.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T09:59:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319096"
}
```



---

archive/issue_events_319097.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T09:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "0000b0",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319097"
}
```



---

archive/issue_events_319098.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T09:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319098"
}
```



---

archive/issue_events_319099.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T09:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319099"
}
```



---

archive/issue_events_319100.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T09:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319100"
}
```



---

archive/issue_events_319101.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-05-27T10:04:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319101"
}
```



---

archive/issue_comments_345706.json:
```json
{
    "body": "Commit: **[`33ce8cf`](https://github.com/sagemath/sagetrac-mirror/commit/33ce8cf2e00635a3560f168a145a73f9ba265517)**",
    "created_at": "2017-05-27T10:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345706",
    "user": "https://github.com/a-andre"
}
```

Commit: **[`33ce8cf`](https://github.com/sagemath/sagetrac-mirror/commit/33ce8cf2e00635a3560f168a145a73f9ba265517)**



---

archive/issue_comments_345707.json:
```json
{
    "body": "Branch: **[u/aapitzsch/23089](https://github.com/sagemath/sagetrac-mirror/tree/u/aapitzsch/23089)**",
    "created_at": "2017-05-27T10:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345707",
    "user": "https://github.com/a-andre"
}
```

Branch: **[u/aapitzsch/23089](https://github.com/sagemath/sagetrac-mirror/tree/u/aapitzsch/23089)**



---

archive/issue_events_319102.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-27T10:36:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319102"
}
```



---

archive/issue_events_319103.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-27T10:36:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319103"
}
```



---

archive/issue_comments_345708.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nWhy?",
    "created_at": "2017-05-27T10:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345708",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Why?



---

archive/issue_comments_345709.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIn other words: which problem does this solve?",
    "created_at": "2017-05-27T10:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345709",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

In other words: which problem does this solve?



---

archive/issue_comments_345710.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-05-27T10:37:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345710",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_345711.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n> Unprefixed string literals become **str** objects when compiling with language level 2 and **unicode** objects (i.e. Python 3 **str**) with language level 3.\n\nhttps://cython.readthedocs.io/en/latest/src/tutorial/strings.html",
    "created_at": "2017-05-27T10:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345711",
    "user": "https://github.com/a-andre"
}
```

<div id="comment:5" align="right">comment:5</div>

> Unprefixed string literals become **str** objects when compiling with language level 2 and **unicode** objects (i.e. Python 3 **str**) with language level 3.

https://cython.readthedocs.io/en/latest/src/tutorial/strings.html



---

archive/issue_comments_345712.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThat doesn't answer my question.\n\nLet me rephrase my question: there are 3 reasonable choices for the `language_level` option.\n\n(A) Always `language_level=2` *(the current situation)*\n\n(B) Always `language_level=3`\n\n(C) `language_level=2` on Python 2 and `language_level=3` on Python 3\n\n**Why** is (C) better than (A)?\n\nAnd there is an additional question: why is (C) better than (B)?",
    "created_at": "2017-05-27T10:53:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345712",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

That doesn't answer my question.

Let me rephrase my question: there are 3 reasonable choices for the `language_level` option.

(A) Always `language_level=2` *(the current situation)*

(B) Always `language_level=3`

(C) `language_level=2` on Python 2 and `language_level=3` on Python 3

**Why** is (C) better than (A)?

And there is an additional question: why is (C) better than (B)?



---

archive/issue_comments_345713.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI haven't looked at (B) because I didn't want to change the behaviour of Sage on Python 2.\n\nSetting `language_level=3` on Python 3 helped to discover (some) import errors already at compile time and not at runtime. And I assume (haven't tested) that using `language_level=3` could lead to less `unicode` problems than using `language_level=2` and could simplify the way to Sage on Python 3.\n\nJeroen, you have more experience with Cython, so I assume you can provide more knowledge-based arguments for one or the other.",
    "created_at": "2017-05-27T20:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345713",
    "user": "https://github.com/a-andre"
}
```

<div id="comment:7" align="right">comment:7</div>

I haven't looked at (B) because I didn't want to change the behaviour of Sage on Python 2.

Setting `language_level=3` on Python 3 helped to discover (some) import errors already at compile time and not at runtime. And I assume (haven't tested) that using `language_level=3` could lead to less `unicode` problems than using `language_level=2` and could simplify the way to Sage on Python 3.

Jeroen, you have more experience with Cython, so I assume you can provide more knowledge-based arguments for one or the other.



---

archive/issue_comments_345714.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@a-andre](#comment%3A7):\n> Jeroen, you have more experience with Cython, so I assume you can provide more knowledge-based arguments for one or the other.\n\nIt's not really a Cython-specific thing, it's a more general philosophy. When writing Python code, you can try to\n\n(A) use Python 2 semantics as much as possible\n\n(B) use Python 3 semantics as much as possible\n\n(C) use Python 2 semantics on Python 2 and Python 3 semantics on Python 3\n\nFor plain Python, (A) is not possible in many cases because Python 3 removes a feature (for example: `__cmp__`, string literals interpreted as `bytes`, `dict.iteritems`). With Cython, the sitation for (A) is better because some Python 2 features are supported by Cython regardless of Python version.\n\nFor plain Python, (B) is often possible (using `from __future__` imports or packages like `six`).\n\nAnd (C) is usually where trouble lies (strings interpreted as `bytes`/`unicode` depending on the Python version, different division semantics...).\n\nBased on this, I believe that (C) is the worst option. Of course, this is just a personal opinion...",
    "created_at": "2017-05-27T21:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345714",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@a-andre](#comment%3A7):
> Jeroen, you have more experience with Cython, so I assume you can provide more knowledge-based arguments for one or the other.

It's not really a Cython-specific thing, it's a more general philosophy. When writing Python code, you can try to

(A) use Python 2 semantics as much as possible

(B) use Python 3 semantics as much as possible

(C) use Python 2 semantics on Python 2 and Python 3 semantics on Python 3

For plain Python, (A) is not possible in many cases because Python 3 removes a feature (for example: `__cmp__`, string literals interpreted as `bytes`, `dict.iteritems`). With Cython, the sitation for (A) is better because some Python 2 features are supported by Cython regardless of Python version.

For plain Python, (B) is often possible (using `from __future__` imports or packages like `six`).

And (C) is usually where trouble lies (strings interpreted as `bytes`/`unicode` depending on the Python version, different division semantics...).

Based on this, I believe that (C) is the worst option. Of course, this is just a personal opinion...



---

archive/issue_comments_345715.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAny more suggestions here? If not, should we close this as wontfix?",
    "created_at": "2017-06-09T12:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345715",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Any more suggestions here? If not, should we close this as wontfix?



---

archive/issue_comments_345716.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI tried to compile sage on Python 2 with `language_level=3`. There are some issues like\n\n```\nUnicode objects only support coercion to Py_UNICODE*.\n```\nwhich should be easily fixable.\nA bigger problem are errors like\n\n```\nnames = ['A{}'.format(''.join(str(x) for x in sorted(F))) for F in flats]  \n                                                     ^\n\nsage/matroids/matroid.pyx:7527:66: local variable 'F' referenced before assignment\n```\nhttps://github.com/cython/cython/issues/1159\n\nhttps://github.com/cython/cython/issues/1351\n\nIf we don't want to switch now, we should at least make the sage code as much level 3 compatible as possible to allow an easier transition later.",
    "created_at": "2017-06-10T10:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345716",
    "user": "https://github.com/a-andre"
}
```

<div id="comment:10" align="right">comment:10</div>

I tried to compile sage on Python 2 with `language_level=3`. There are some issues like

```
Unicode objects only support coercion to Py_UNICODE*.
```
which should be easily fixable.
A bigger problem are errors like

```
names = ['A{}'.format(''.join(str(x) for x in sorted(F))) for F in flats]  
                                                     ^

sage/matroids/matroid.pyx:7527:66: local variable 'F' referenced before assignment
```
https://github.com/cython/cython/issues/1159

https://github.com/cython/cython/issues/1351

If we don't want to switch now, we should at least make the sage code as much level 3 compatible as possible to allow an easier transition later.



---

archive/issue_comments_345717.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@a-andre](#comment%3A10):\n> If we don't want to switch now, we should at least make the sage code as much level 3 compatible as possible to allow an easier transition later.\n\nI agree in principle. On the other hand, I think this should literally be the last of our Python 3 worries. There is nothing really wrong with the status quo and there are plenty of other things which still need to be fixed for Python 3.\n\nSo I suggest to close this ticket as wontfix for now.",
    "created_at": "2017-06-20T15:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345717",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@a-andre](#comment%3A10):
> If we don't want to switch now, we should at least make the sage code as much level 3 compatible as possible to allow an easier transition later.

I agree in principle. On the other hand, I think this should literally be the last of our Python 3 worries. There is nothing really wrong with the status quo and there are plenty of other things which still need to be fixed for Python 3.

So I suggest to close this ticket as wontfix for now.



---

archive/issue_events_319104.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-06-25T21:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319104"
}
```



---

archive/issue_events_319105.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-06-25T21:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319105"
}
```



---

archive/issue_events_319106.json:
```json
{
    "actor": "https://github.com/a-andre",
    "created_at": "2017-06-25T21:07:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319106"
}
```



---

archive/issue_comments_345718.json:
```json
{
    "body": "Changed author from **Andr\u00e9 Apitzsch** to none",
    "created_at": "2017-06-26T07:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345718",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **André Apitzsch** to none



---

archive/issue_comments_345719.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Andr\u00e9 Apitzsch**",
    "created_at": "2017-06-26T07:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345719",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, André Apitzsch**



---

archive/issue_events_319107.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-26T07:40:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319107"
}
```



---

archive/issue_events_319108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-26T07:40:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319108"
}
```



---

archive/issue_comments_345720.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nClosing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).",
    "created_at": "2017-07-13T07:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345720",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).



---

archive/issue_events_319109.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319109"
}
```



---

archive/issue_events_319110.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319110"
}
```



---

archive/issue_events_319111.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319111"
}
```



---

archive/issue_events_319112.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-07-13T07:54:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23089#event-319112"
}
```



---

archive/issue_comments_345721.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI definitely think this is the right way to go.  It's terribly confusing when trying to port to Python 3 if you have Python 2/3 straddling pure Python code that behaves like Python 2 on Python 2 and like Python 3 on Python 3, but then totally different semantics when you cross over into Cython land.  \n\nThat said, until the Cython issue is fixed it will be hard to get very far into this.  In the short term I could write a hacky workaround by rewriting some list comprehensions as for loops (after all, in Cython there's not as much immediate benefit to list comprehensions, I don't think).  But it would be best not to do that just because Cython has a bug...",
    "created_at": "2017-09-08T08:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345721",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

I definitely think this is the right way to go.  It's terribly confusing when trying to port to Python 3 if you have Python 2/3 straddling pure Python code that behaves like Python 2 on Python 2 and like Python 3 on Python 3, but then totally different semantics when you cross over into Cython land.  

That said, until the Cython issue is fixed it will be hard to get very far into this.  In the short term I could write a hacky workaround by rewriting some list comprehensions as for loops (after all, in Cython there's not as much immediate benefit to list comprehensions, I don't think).  But it would be best not to do that just because Cython has a bug...



---

archive/issue_comments_345722.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment%3A15):\n> I definitely think this is the right way to go.  It's terribly confusing when trying to port to Python 3 if you have Python 2/3 straddling pure Python code that behaves like Python 2 on Python 2 and like Python 3 on Python 3, but then totally different semantics when you cross over into Cython land.\n\nI would argue that the confusion is more in the Python land than in the Cython land.\n\nYou are saying that we should make the code behave *more different* in Python 2 and Python 3 and that will make our life easier?  I say it's a bad thing and we should be happy that Cython allows us to worry less about Python 2/3 compatibility.",
    "created_at": "2017-09-08T08:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345722",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment%3A15):
> I definitely think this is the right way to go.  It's terribly confusing when trying to port to Python 3 if you have Python 2/3 straddling pure Python code that behaves like Python 2 on Python 2 and like Python 3 on Python 3, but then totally different semantics when you cross over into Cython land.

I would argue that the confusion is more in the Python land than in the Cython land.

You are saying that we should make the code behave *more different* in Python 2 and Python 3 and that will make our life easier?  I say it's a bad thing and we should be happy that Cython allows us to worry less about Python 2/3 compatibility.



---

archive/issue_comments_345723.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt's a problem from a maintenance standpoint.  It's bad enough going between Python and Cython as it is, and having to remember their (sometimes subtle) differences.  Now it's saying \"even if you're developing for Python 3 you have to go back to Python 2 (sort of) when you're editing Cython code\".  It also means that the idioms used to support Python 2 and 3 shift when going between Python and Cython, and it also means that extra special care is needed when passing string-like objects at the interface between Python and Cython (which, in most cases, is not an interface one should be thinking about at all).",
    "created_at": "2017-09-08T08:53:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345723",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

It's a problem from a maintenance standpoint.  It's bad enough going between Python and Cython as it is, and having to remember their (sometimes subtle) differences.  Now it's saying "even if you're developing for Python 3 you have to go back to Python 2 (sort of) when you're editing Cython code".  It also means that the idioms used to support Python 2 and 3 shift when going between Python and Cython, and it also means that extra special care is needed when passing string-like objects at the interface between Python and Cython (which, in most cases, is not an interface one should be thinking about at all).



---

archive/issue_comments_345724.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@embray](#comment%3A17):\n> it also means that extra special care is needed when passing string-like objects at the interface between Python and Cython\n\nI thought we discussed this on sage-devel. Cython knows that `str = unicode` on Python 3 and string literals are `str = unicode` on Python 3, regardless of `language_level`.\n\nNote that using `language_level=3` does turn on `from `__future__` import unicode_literals`. But on Python 3, that doesn't change anything.",
    "created_at": "2017-09-08T09:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345724",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@embray](#comment%3A17):
> it also means that extra special care is needed when passing string-like objects at the interface between Python and Cython

I thought we discussed this on sage-devel. Cython knows that `str = unicode` on Python 3 and string literals are `str = unicode` on Python 3, regardless of `language_level`.

Note that using `language_level=3` does turn on `from `__future__` import unicode_literals`. But on Python 3, that doesn't change anything.



---

archive/issue_comments_345725.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI agree that there are many issues with `bytes` vs. `unicode` in Cython code in Python 3. I agree so far. But few or none of those issues are fixed with `language_level=3`. It's a red herring, the `language_level` really doesn't change that much.",
    "created_at": "2017-09-08T09:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345725",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

I agree that there are many issues with `bytes` vs. `unicode` in Cython code in Python 3. I agree so far. But few or none of those issues are fixed with `language_level=3`. It's a red herring, the `language_level` really doesn't change that much.



---

archive/issue_comments_345726.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nJust to make sure I'm clear about this, I'm only talking about enabling `language_level=3` on python3, not python2.  The fact that all string literals become unicode on Python 3 does make a big difference in porting sanity.",
    "created_at": "2017-09-08T09:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345726",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Just to make sure I'm clear about this, I'm only talking about enabling `language_level=3` on python3, not python2.  The fact that all string literals become unicode on Python 3 does make a big difference in porting sanity.



---

archive/issue_comments_345727.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think I'm confused about this line in the docs:\n\n> Unprefixed string literals become str objects when compiling with language level 2 and unicode objects (i.e. Python 3 str) with language level 3.\n\nThe first part of the sentence doesn't specify what they mean by \"str\", because this doesn't seem to agree with my experience of turning on `language_level=3` (where suddenly string literals were being treated as unicode and breaking whenever passed to an interface that expects `char *`).\n\nAnyways, another reason to do this is that we'll probably want to use other Python 3 features eventually so it would be good to enable.",
    "created_at": "2017-09-08T09:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345727",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

I think I'm confused about this line in the docs:

> Unprefixed string literals become str objects when compiling with language level 2 and unicode objects (i.e. Python 3 str) with language level 3.

The first part of the sentence doesn't specify what they mean by "str", because this doesn't seem to agree with my experience of turning on `language_level=3` (where suddenly string literals were being treated as unicode and breaking whenever passed to an interface that expects `char *`).

Anyways, another reason to do this is that we'll probably want to use other Python 3 features eventually so it would be good to enable.



---

archive/issue_comments_345728.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@embray](#comment%3A21):\n> I think I'm confused about this line in the docs:\n> \n> > Unprefixed string literals become str objects when compiling with language level 2 and unicode objects (i.e. Python 3 str) with language level 3.\n\nIn Cython code, it's best to think of `bytes`, `str` and `unicode` as three distinct types (that's what Cython does internally). It just happes that `str is bytes` on Python 2 and `str is unicode` on Python 3.\n\nSo then, unprefixed string literals are `str` with `language_level=2` (exactly the same as in plain Python), they are `unicode` with `language_level=3` (exactly the same as in plain Python with `from `__future__` import unicode_literals`).",
    "created_at": "2017-09-08T10:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345728",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@embray](#comment%3A21):
> I think I'm confused about this line in the docs:
> 
> > Unprefixed string literals become str objects when compiling with language level 2 and unicode objects (i.e. Python 3 str) with language level 3.

In Cython code, it's best to think of `bytes`, `str` and `unicode` as three distinct types (that's what Cython does internally). It just happes that `str is bytes` on Python 2 and `str is unicode` on Python 3.

So then, unprefixed string literals are `str` with `language_level=2` (exactly the same as in plain Python), they are `unicode` with `language_level=3` (exactly the same as in plain Python with `from `__future__` import unicode_literals`).



---

archive/issue_comments_345729.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nYes, that matches my understanding, but `s/plain Python/plain Python 2/`.  On Python 3 unprefixed strings are also \"unicode\" type, so `language_level=3` is just consistent with Python 3 in this regard and better for use in conjunction with plain Python 3 code.\n\nAnyways, this is all a moot point until and unless the issues in Cython are fixed, which may be difficult.  I'm working on it but it's not high priority now.  I agree with you that it's not a big deal either way, but I do think using `language_level=2` with Python 3 is confusing and error-prone.",
    "created_at": "2017-10-18T15:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345729",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Yes, that matches my understanding, but `s/plain Python/plain Python 2/`.  On Python 3 unprefixed strings are also "unicode" type, so `language_level=3` is just consistent with Python 3 in this regard and better for use in conjunction with plain Python 3 code.

Anyways, this is all a moot point until and unless the issues in Cython are fixed, which may be difficult.  I'm working on it but it's not high priority now.  I agree with you that it's not a big deal either way, but I do think using `language_level=2` with Python 3 is confusing and error-prone.



---

archive/issue_comments_345730.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@embray](#comment%3A23):\n> Yes, that matches my understanding, but `s/plain Python/plain Python 2/`.\n\nWhat I wrote in [comment:22] is true both for Python 2 and Python 3.",
    "created_at": "2017-10-18T18:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345730",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@embray](#comment%3A23):
> Yes, that matches my understanding, but `s/plain Python/plain Python 2/`.

What I wrote in [comment:22] is true both for Python 2 and Python 3.



---

archive/issue_comments_345731.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYou wrote \"they are `unicode` with `language_level=3`\" which doesn't make sense because there is no type called \"unicode\" in Python 3.  That statement only makes sense on Python 2.",
    "created_at": "2017-10-19T10:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345731",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

You wrote "they are `unicode` with `language_level=3`" which doesn't make sense because there is no type called "unicode" in Python 3.  That statement only makes sense on Python 2.



---

archive/issue_comments_345732.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@embray](#comment%3A25):\n> You wrote \"they are `unicode` with `language_level=3`\" which doesn't make sense because there is no type called \"unicode\" in Python 3.\n\nIt does make sense if you first read the first paragraph of my comment in [comment:22]",
    "created_at": "2017-10-20T09:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345732",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@embray](#comment%3A25):
> You wrote "they are `unicode` with `language_level=3`" which doesn't make sense because there is no type called "unicode" in Python 3.

It does make sense if you first read the first paragraph of my comment in [comment:22]



---

archive/issue_comments_345733.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment%3A26):\n> Replying to [@embray](#comment%3A25):\n> > You wrote \"they are `unicode` with `language_level=3`\" which doesn't make sense because there is no type called \"unicode\" in Python 3.\n\n> \n> It does make sense if you first read the first paragraph of my comment in [comment:22]\n\nMaybe I did read that paragraph and *it* didn't make sense.",
    "created_at": "2017-10-23T08:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345733",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment%3A26):
> Replying to [@embray](#comment%3A25):
> > You wrote "they are `unicode` with `language_level=3`" which doesn't make sense because there is no type called "unicode" in Python 3.

> 
> It does make sense if you first read the first paragraph of my comment in [comment:22]

Maybe I did read that paragraph and *it* didn't make sense.



---

archive/issue_comments_345734.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nLet me clarify: when Cython compiles Cython code to C, it doesn't yet know if the C code will be compiled as Python 2 and Python 3. So when it sees a `\"string\"` literal, it doesn't really know what king of string it will be. To solve this, Cython internally really has 3 string types: `bytes`, `str` and `unicode`. Both `bytes` and `unicode` are easy to deal with, since they refer to the same type on Python 2 and Python 3 (*). To deal with `str`, it uses macros like\n\n```\n#if PY_MAJOR_VERSION >= 3\n  #define PyBaseString_Type            PyUnicode_Type\n  #define PyStringObject               PyUnicodeObject\n  #define PyString_Type                PyUnicode_Type\n  #define PyString_Check               PyUnicode_Check\n  #define PyString_CheckExact          PyUnicode_CheckExact\n#endif\n```\n\n(*) I know that they renamed `unicode` to `str` on Python 3, but that is really a superficial change in the Python language. The C API function names start with `PyUnicode`, and that is what Cython really cares about.",
    "created_at": "2017-10-23T08:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345734",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Let me clarify: when Cython compiles Cython code to C, it doesn't yet know if the C code will be compiled as Python 2 and Python 3. So when it sees a `"string"` literal, it doesn't really know what king of string it will be. To solve this, Cython internally really has 3 string types: `bytes`, `str` and `unicode`. Both `bytes` and `unicode` are easy to deal with, since they refer to the same type on Python 2 and Python 3 (*). To deal with `str`, it uses macros like

```
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#endif
```

(*) I know that they renamed `unicode` to `str` on Python 3, but that is really a superficial change in the Python language. The C API function names start with `PyUnicode`, and that is what Cython really cares about.



---

archive/issue_comments_345735.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI didn't realize that even when compiling Python 3 sources Cython still defines \"unicode\" as a built-in, which is surprising--that's part of my confusion.\n\nI was looking at the code myself just now, and I think my confusion with your explanation comes from the fact that you're referring to \"three distinct types\".  And it's true, that it has the *names* `unicode`, `str`, and `bytes` in all cases.  But that doesn't mean there are three distinct types.  On any given Python there are only two distinct types and all we're talking about is changing around which labels we assign to which types.  I'm confused when you speak of \"distinct types\" because it makes me think that Cython is reimplementing Python 2 `str`s in Python 3 which doesn't make sense to do, and I was pretty sure *wasn't* done.\n\nAnyways we're in agreement that language_level doesn't do much in the end.  It does also make some difference in how string literals are parsed which might lead to confusion somewhere, but I don't think it's critical.",
    "created_at": "2017-10-23T08:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345735",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

I didn't realize that even when compiling Python 3 sources Cython still defines "unicode" as a built-in, which is surprising--that's part of my confusion.

I was looking at the code myself just now, and I think my confusion with your explanation comes from the fact that you're referring to "three distinct types".  And it's true, that it has the *names* `unicode`, `str`, and `bytes` in all cases.  But that doesn't mean there are three distinct types.  On any given Python there are only two distinct types and all we're talking about is changing around which labels we assign to which types.  I'm confused when you speak of "distinct types" because it makes me think that Cython is reimplementing Python 2 `str`s in Python 3 which doesn't make sense to do, and I was pretty sure *wasn't* done.

Anyways we're in agreement that language_level doesn't do much in the end.  It does also make some difference in how string literals are parsed which might lead to confusion somewhere, but I don't think it's critical.



---

archive/issue_comments_345736.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@embray](#comment%3A29):\n> But that doesn't mean there are three distinct types.\n\nFrom Cython's point of view, there really are 3 types because Cython doesn't know whether the C code will be compiled as Python 2 or Python 3. It is only after the fact that it \"happens\" that str maps to bytes or unicode.\n\nBut the Cython compiler has 3 classes `BytesNode`, `UnicodeNode` and `StringNode` to deal with the 3 kinds of string constants. And this is where the `from `__future__` import unicode_literals` (which is implied by `language_level=3`) comes in: unprefixed `\"string\"` literals becomes `UnicodeNode` instead of `StringNode`.",
    "created_at": "2017-10-23T08:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345736",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@embray](#comment%3A29):
> But that doesn't mean there are three distinct types.

From Cython's point of view, there really are 3 types because Cython doesn't know whether the C code will be compiled as Python 2 or Python 3. It is only after the fact that it "happens" that str maps to bytes or unicode.

But the Cython compiler has 3 classes `BytesNode`, `UnicodeNode` and `StringNode` to deal with the 3 kinds of string constants. And this is where the `from `__future__` import unicode_literals` (which is implied by `language_level=3`) comes in: unprefixed `"string"` literals becomes `UnicodeNode` instead of `StringNode`.



---

archive/issue_comments_345737.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFWIW this is also helpful:\n\n```\n    builtin_entries = {\n\n        \"type\":   [\"((PyObject*)&PyType_Type)\", py_object_type],\n\n        \"bool\":   [\"((PyObject*)&PyBool_Type)\", py_object_type],\n        \"int\":    [\"((PyObject*)&PyInt_Type)\", py_object_type],\n        \"long\":   [\"((PyObject*)&PyLong_Type)\", py_object_type],\n        \"float\":  [\"((PyObject*)&PyFloat_Type)\", py_object_type],\n        \"complex\":[\"((PyObject*)&PyComplex_Type)\", py_object_type],\n\n        \"bytes\":  [\"((PyObject*)&PyBytes_Type)\", py_object_type],\n        \"bytearray\":   [\"((PyObject*)&PyByteArray_Type)\", py_object_type],\n        \"str\":    [\"((PyObject*)&PyString_Type)\", py_object_type],\n        \"unicode\":[\"((PyObject*)&PyUnicode_Type)\", py_object_type],\n        ...\n```\n\nThis is how it determines certain built-in names.  Incidentally Python 2 has `#define PyBytes_Type PyString_Type` in its headers, but Python 3 does not have `#define PyString_Type PyUnicode_Type` which is why Cython has to include that explicitly.\n\nI disagree with your read on the situation.  The parser/compiler may have three Node types which makes sense, but there aren't three distinct types at runtime ever.",
    "created_at": "2017-10-23T09:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345737",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

FWIW this is also helpful:

```
    builtin_entries = {

        "type":   ["((PyObject*)&PyType_Type)", py_object_type],

        "bool":   ["((PyObject*)&PyBool_Type)", py_object_type],
        "int":    ["((PyObject*)&PyInt_Type)", py_object_type],
        "long":   ["((PyObject*)&PyLong_Type)", py_object_type],
        "float":  ["((PyObject*)&PyFloat_Type)", py_object_type],
        "complex":["((PyObject*)&PyComplex_Type)", py_object_type],

        "bytes":  ["((PyObject*)&PyBytes_Type)", py_object_type],
        "bytearray":   ["((PyObject*)&PyByteArray_Type)", py_object_type],
        "str":    ["((PyObject*)&PyString_Type)", py_object_type],
        "unicode":["((PyObject*)&PyUnicode_Type)", py_object_type],
        ...
```

This is how it determines certain built-in names.  Incidentally Python 2 has `#define PyBytes_Type PyString_Type` in its headers, but Python 3 does not have `#define PyString_Type PyUnicode_Type` which is why Cython has to include that explicitly.

I disagree with your read on the situation.  The parser/compiler may have three Node types which makes sense, but there aren't three distinct types at runtime ever.



---

archive/issue_comments_345738.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSee #26403 for a related ticket that I'm working on.",
    "created_at": "2018-10-04T15:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23089",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23089#issuecomment-345738",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

See #26403 for a related ticket that I'm working on.
