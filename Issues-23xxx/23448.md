# Issue 23448: configure fails when run with a posix shell supporting $LINENO (e.g. dash 0.5.9 and many others)

archive/issues_023211.json:
```json
{
    "assignees": [],
    "body": "When using an unpatched recent version of dash to run configure, this happens:\n\n```\n$ wget http://gondor.apana.org.au/~herbert/dash/files/dash-0.5.9.1.tar.gz\n[...]\n$ tar xf dash-0.5.9.1.tar.gz\n$ cd dash-0.5.9.1\n$ ./configure && make\n[...]\n$ cd ..\n$ wget http://files.sagemath.org/devel/sage-8.0.rc2.tar.gz\n$ tar xf sage-8.0.rc2.tar.gz\n$ cd sage-8.0.rc2\n$ ../dash-0.5.9.1/src/dash ./configure\n$ ../dash-0.5.9.1/src/dash ./configure\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking whether make supports nested variables... yes\nchecking whether to enable maintainer-specific portions of Makefiles... yes\nconfigure: WARNING: you should use --build, --host, --target\nconfigure: WARNING: you should use --build, --host, --target\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make sets $(MAKE)... yes\nchecking whether make supports nested variables... yes\nchecking whether to enable maintainer-specific portions of Makefiles... yes\nchecking for root user... no\nchecking build system type... Invalid configuration `x': machine `x' not recognized\nconfigure: error: bash config/config.sub x failed\n```\nMy `/bin/sh` happens to be this shell, so just running `make` is broken in my system.\n\nAfter much suffering, I found out the code at fault in `configure.ac`:\n\n```\n#---------------------------------------------------------\n# We need to run this configure script with bash\nif test -z \"$BASH_VERSION$CONFIG_SHELL\"\nthen\n    CONFIG_SHELL=bash\n    export CONFIG_SHELL\n    if $CONFIG_SHELL -c \"exit 0\"\n    then\n        exec $CONFIG_SHELL $0 \"$@\"\n[...]\n```\nintroduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.\n\nI guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 \"$@\"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.\n\nWhen using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).\n\nHence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).\n\nCC:  @jdemeyer\n\nKeywords: **sd87**\n\nBranch/Commit: **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Gonzalo Tornar\u00eda**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23448_\n\n",
    "closed_at": "2018-01-14T10:14:44Z",
    "created_at": "2017-07-18T00:05:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "configure fails when run with a posix shell supporting $LINENO (e.g. dash 0.5.9 and many others)",
    "type": "issue",
    "updated_at": "2018-01-14T10:14:44Z",
    "url": "https://github.com/sagemath/sage/issues/23448",
    "user": "https://github.com/tornaria"
}
```
When using an unpatched recent version of dash to run configure, this happens:

```
$ wget http://gondor.apana.org.au/~herbert/dash/files/dash-0.5.9.1.tar.gz
[...]
$ tar xf dash-0.5.9.1.tar.gz
$ cd dash-0.5.9.1
$ ./configure && make
[...]
$ cd ..
$ wget http://files.sagemath.org/devel/sage-8.0.rc2.tar.gz
$ tar xf sage-8.0.rc2.tar.gz
$ cd sage-8.0.rc2
$ ../dash-0.5.9.1/src/dash ./configure
$ ../dash-0.5.9.1/src/dash ./configure
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking whether to enable maintainer-specific portions of Makefiles... yes
configure: WARNING: you should use --build, --host, --target
configure: WARNING: you should use --build, --host, --target
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking whether to enable maintainer-specific portions of Makefiles... yes
checking for root user... no
checking build system type... Invalid configuration `x': machine `x' not recognized
configure: error: bash config/config.sub x failed
```
My `/bin/sh` happens to be this shell, so just running `make` is broken in my system.

After much suffering, I found out the code at fault in `configure.ac`:

```
#---------------------------------------------------------
# We need to run this configure script with bash
if test -z "$BASH_VERSION$CONFIG_SHELL"
then
    CONFIG_SHELL=bash
    export CONFIG_SHELL
    if $CONFIG_SHELL -c "exit 0"
    then
        exec $CONFIG_SHELL $0 "$@"
[...]
```
introduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.

I guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 "$@"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.

When using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).

Hence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).

CC:  @jdemeyer

Keywords: **sd87**

Branch/Commit: **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**

Reviewer: **Dima Pasechnik**

Author: **Gonzalo Tornaría**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/23448_





---

archive/issue_events_326354.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T00:05:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326354"
}
```



---

archive/issue_events_326355.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T00:05:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326355"
}
```



---

archive/issue_events_326356.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T00:05:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326356"
}
```



---

archive/issue_events_326357.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T00:05:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326357"
}
```



---

archive/issue_comments_352310.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAfter much suffering, I found out the code at fault in `configure.ac`:\n\n```\n#---------------------------------------------------------\n# We need to run this configure script with bash\nif test -z \"$BASH_VERSION$CONFIG_SHELL\"\nthen\n    CONFIG_SHELL=bash\n    export CONFIG_SHELL\n    if $CONFIG_SHELL -c \"exit 0\"\n    then\n        exec $CONFIG_SHELL $0 \"$@\"\n[...]\n```\nintroduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.\n\nI guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 \"$@\"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.\n\nWhen using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).\n\nHence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).",
    "created_at": "2017-07-18T00:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352310",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:1" align="right">comment:1</div>

After much suffering, I found out the code at fault in `configure.ac`:

```
#---------------------------------------------------------
# We need to run this configure script with bash
if test -z "$BASH_VERSION$CONFIG_SHELL"
then
    CONFIG_SHELL=bash
    export CONFIG_SHELL
    if $CONFIG_SHELL -c "exit 0"
    then
        exec $CONFIG_SHELL $0 "$@"
[...]
```
introduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.

I guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 "$@"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.

When using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).

Hence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).



---

archive/issue_comments_352311.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a\"><code>60ac900</code></a></td><td><code>(#23448) fix configure when run with dash</code></td></tr></table>\n",
    "created_at": "2017-07-18T02:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352311",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a"><code>60ac900</code></a></td><td><code>(#23448) fix configure when run with dash</code></td></tr></table>




---

archive/issue_comments_352312.json:
```json
{
    "body": "Commit: **[`60ac900`](https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a)**",
    "created_at": "2017-07-18T02:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352312",
    "user": "https://github.com/tornaria"
}
```

Commit: **[`60ac900`](https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a)**



---

archive/issue_comments_352313.json:
```json
{
    "body": "Branch: **[u/tornaria/23448](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448)**",
    "created_at": "2017-07-18T02:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352313",
    "user": "https://github.com/tornaria"
}
```

Branch: **[u/tornaria/23448](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448)**



---

archive/issue_comments_352314.json:
```json
{
    "body": "Changed commit from **[`60ac900`](https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a)** to **[`e77704b`](https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8)**",
    "created_at": "2017-07-18T02:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60ac900`](https://github.com/sagemath/sagetrac-mirror/commit/60ac90025ebfb0b4a8617922d7e09346458b103a)** to **[`e77704b`](https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8)**



---

archive/issue_comments_352315.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8\"><code>e77704b</code></a></td><td><code>(#23448) fix configure when run with old dash</code></td></tr></table>\n",
    "created_at": "2017-07-18T02:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352315",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8"><code>e77704b</code></a></td><td><code>(#23448) fix configure when run with old dash</code></td></tr></table>




---

archive/issue_comments_352316.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe first patch makes `configure` work with new versions of dash, but it breaks with old versions of dash (unpatched 0.5.6, and also version `0.5.7-4+b1` from debian jessie.\n\nThis happens because `test -z \"$BASH_VERSION$CONFIG_SHELL\"` is incorrect, it should instead be `test -z \"$BASH_VERSION\"`, which is what the second patch does.",
    "created_at": "2017-07-18T02:38:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352316",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:4" align="right">comment:4</div>

The first patch makes `configure` work with new versions of dash, but it breaks with old versions of dash (unpatched 0.5.6, and also version `0.5.7-4+b1` from debian jessie.

This happens because `test -z "$BASH_VERSION$CONFIG_SHELL"` is incorrect, it should instead be `test -z "$BASH_VERSION"`, which is what the second patch does.



---

archive/issue_events_326358.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T02:39:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326358"
}
```



---

archive/issue_events_326359.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-18T11:46:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326359"
}
```



---

archive/issue_events_326360.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-18T11:46:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326360"
}
```



---

archive/issue_comments_352317.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI'm a bit lost here. I think I understood the problem, and I understand what your patch does. However, I don't see how that actually fixes the problem.",
    "created_at": "2017-07-18T11:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352317",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

I'm a bit lost here. I think I understood the problem, and I understand what your patch does. However, I don't see how that actually fixes the problem.



---

archive/issue_comments_352318.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,25 @@\n configure: error: bash config/config.sub x failed\n ```\n My `/bin/sh` happens to be this shell, so just running `make` is broken in my system.\n+\n+After much suffering, I found out the code at fault in `configure.ac`:\n+\n+```\n+#---------------------------------------------------------\n+# We need to run this configure script with bash\n+if test -z \"$BASH_VERSION$CONFIG_SHELL\"\n+then\n+    CONFIG_SHELL=bash\n+    export CONFIG_SHELL\n+    if $CONFIG_SHELL -c \"exit 0\"\n+    then\n+        exec $CONFIG_SHELL $0 \"$@\"\n+[...]\n+```\n+introduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.\n+\n+I guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 \"$@\"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.\n+\n+When using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).\n+\n+Hence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).\n``````\n",
    "created_at": "2017-07-18T11:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352318",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,25 @@
 configure: error: bash config/config.sub x failed
 ```
 My `/bin/sh` happens to be this shell, so just running `make` is broken in my system.
+
+After much suffering, I found out the code at fault in `configure.ac`:
+
+```
+#---------------------------------------------------------
+# We need to run this configure script with bash
+if test -z "$BASH_VERSION$CONFIG_SHELL"
+then
+    CONFIG_SHELL=bash
+    export CONFIG_SHELL
+    if $CONFIG_SHELL -c "exit 0"
+    then
+        exec $CONFIG_SHELL $0 "$@"
+[...]
+```
+introduced by e03f296685f986f89e1e12974f4c5ead9a9ff440.
+
+I guess the idea is to re-run configure ($0) with the same arguments ($@) but using bash. However, by the time we reach the line `exec $CONFIG_SHELL $0 "$@"`, the positional parameters have been obliterated by previous tests. Indeed, in the example above it happens to run `bash ./configure x make` which produces the error.
+
+When using debian's dash, it turns out that before reaching this code configure decides to rerun itself and for that reason it sets `CONFIG_SHELL=/bin/sh` (to avoid a recursion).
+
+Hence, the test above is wrong (IMO it should *only* test `$BASH_VERSION`).
``````




---

archive/issue_comments_352319.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGeneral side comment: when fixing a bug, three things have to be asked:\n\n(1) what is the problem?\n\n(2) what does the patch do?\n\n(3) how does (2) actually fix (1)?\n\nIn this case, I am missing (3).",
    "created_at": "2017-07-18T11:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352319",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

General side comment: when fixing a bug, three things have to be asked:

(1) what is the problem?

(2) what does the patch do?

(3) how does (2) actually fix (1)?

In this case, I am missing (3).



---

archive/issue_comments_352320.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks, I tried to explain it above, but I will be more detailed:\n\n(1) by the time configure reaches the line `exec $CONFIG_SHELL $0 \"$@\"`, the positional parameters have been obliterated by previous tests, so what is actually run is `exec bash ./configure x make` which is bad (configure interprets `x` as the target machine which fails).\n\n(2) the patch \u200b60ac900 moves the block of code to *before* calling other tests.\n\n(3) this fixes (1) for recent dash because now `exec $CONFIG_SHELL $0 \"$@\"` uses the correct positional parameters.",
    "created_at": "2017-07-18T13:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352320",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks, I tried to explain it above, but I will be more detailed:

(1) by the time configure reaches the line `exec $CONFIG_SHELL $0 "$@"`, the positional parameters have been obliterated by previous tests, so what is actually run is `exec bash ./configure x make` which is bad (configure interprets `x` as the target machine which fails).

(2) the patch ​60ac900 moves the block of code to *before* calling other tests.

(3) this fixes (1) for recent dash because now `exec $CONFIG_SHELL $0 "$@"` uses the correct positional parameters.



---

archive/issue_comments_352321.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIt remains to explain e77704b.\n\nI'm actually confused as to the intent of doing `test -z \"$BASH_VERSION$CONFIG_SHELL\"`, maybe this is so that if the user sets `CONFIG_SHELL` then we leave it unchanged.\n\nBut the problem is that for some older versions of dash the variable `CONFIG_SHELL` is written to if not set, so the test fails (that seems to be the status quo anyway, so nothing that \u200b60ac900 changes.\n\nMaybe it's better to change \u200b60ac900 so that the code in question is run even earlier, before `CONFIG_SHELL` gets a chance to be written to.",
    "created_at": "2017-07-18T13:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352321",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:10" align="right">comment:10</div>

It remains to explain e77704b.

I'm actually confused as to the intent of doing `test -z "$BASH_VERSION$CONFIG_SHELL"`, maybe this is so that if the user sets `CONFIG_SHELL` then we leave it unchanged.

But the problem is that for some older versions of dash the variable `CONFIG_SHELL` is written to if not set, so the test fails (that seems to be the status quo anyway, so nothing that ​60ac900 changes.

Maybe it's better to change ​60ac900 so that the code in question is run even earlier, before `CONFIG_SHELL` gets a chance to be written to.



---

archive/issue_comments_352322.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI understand better now.\n\nThe first thing `configure` does is to check whether the current shell is \"good enough\" to run configure. If not, it will try `sh`, `bash`, `ksh` and `sh5` in `/bin` or `/usr/bin`.\n\nWhen we run configure on debian, `/bin/sh` is rejected, and so `CONFIG_SHELL` ends up being set to `/bin/bash` and the whole configure script is run under bash, so everything is fine.\n\nWhen I run configure on my system, `/bin/sh` is ok, so configure keeps going with `CONFIG_SHELL` unset until it reaches the `test -z \"$BASH_VERSION$CONFIG_SHELL\"` which is true. As I explained above, this ends up running `exec bash $0 \"$@\"` which is wrong unless it is run very early. This is what \u200b60ac900 fixes.\n\nAs to e77704b, it is necessary when the following conditions are met:\na. I run configure under an old version of dash (or any \"//not// good enough\" shell)\nb. `/bin/sh` is a new version of dash (or any \"good enough shell\" which is *not* bash)  \nFor example, I could be doing\n\n```\n$ ../dash-0.5.6/src/dash ./configure\n```\nWhat happens in this case is that configure decides that the current shell (old version of dash) is not good, so it looks for a better one. It decides `/bin/sh` is good enough so it sets `CONFIG_SHELL=/bin/sh` and re-execs itself under this shell. Now the `test -z \"$BASH_VERSION$CONFIG_SHELL\"` is false, and so configure is not reexecuted with bash and things break later on [1].\n\nThe only way to fix this I could find is to change the test to `test -z \"$BASH_VERSION\"`, which is what e77704b is doing.\n\nThe suggestion of moving the test earlier is not possible: if placed before the line\n\n```\nAC_INIT([Sage], SAGE_VERSION, [sage-devel@googlegroups.com])\n```\nit is too early and it won't be included in `configure`.\n\nBut after this line it is already too late (`CONFIG_SHELL` is already set in the cases where it is a problem).\n\n\n[1] to be explicit, the first problem is the substitution `\"${!need_to_install}\"` which is not supported by dash.",
    "created_at": "2017-07-18T16:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352322",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:11" align="right">comment:11</div>

I understand better now.

The first thing `configure` does is to check whether the current shell is "good enough" to run configure. If not, it will try `sh`, `bash`, `ksh` and `sh5` in `/bin` or `/usr/bin`.

When we run configure on debian, `/bin/sh` is rejected, and so `CONFIG_SHELL` ends up being set to `/bin/bash` and the whole configure script is run under bash, so everything is fine.

When I run configure on my system, `/bin/sh` is ok, so configure keeps going with `CONFIG_SHELL` unset until it reaches the `test -z "$BASH_VERSION$CONFIG_SHELL"` which is true. As I explained above, this ends up running `exec bash $0 "$@"` which is wrong unless it is run very early. This is what ​60ac900 fixes.

As to e77704b, it is necessary when the following conditions are met:
a. I run configure under an old version of dash (or any "//not// good enough" shell)
b. `/bin/sh` is a new version of dash (or any "good enough shell" which is *not* bash)  
For example, I could be doing

```
$ ../dash-0.5.6/src/dash ./configure
```
What happens in this case is that configure decides that the current shell (old version of dash) is not good, so it looks for a better one. It decides `/bin/sh` is good enough so it sets `CONFIG_SHELL=/bin/sh` and re-execs itself under this shell. Now the `test -z "$BASH_VERSION$CONFIG_SHELL"` is false, and so configure is not reexecuted with bash and things break later on [1].

The only way to fix this I could find is to change the test to `test -z "$BASH_VERSION"`, which is what e77704b is doing.

The suggestion of moving the test earlier is not possible: if placed before the line

```
AC_INIT([Sage], SAGE_VERSION, [sage-devel@googlegroups.com])
```
it is too early and it won't be included in `configure`.

But after this line it is already too late (`CONFIG_SHELL` is already set in the cases where it is a problem).


[1] to be explicit, the first problem is the substitution `"${!need_to_install}"` which is not supported by dash.



---

archive/issue_comments_352323.json:
```json
{
    "body": "Author: **tornaria**",
    "created_at": "2017-07-18T16:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352323",
    "user": "https://github.com/tornaria"
}
```

Author: **tornaria**



---

archive/issue_events_326361.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T16:19:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326361"
}
```



---

archive/issue_events_326362.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-18T16:19:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326362"
}
```



---

archive/issue_events_326363.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-19T07:35:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326363"
}
```



---

archive/issue_events_326364.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-19T07:35:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326364"
}
```



---

archive/issue_comments_352324.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAuthor name",
    "created_at": "2017-07-19T07:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352324",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Author name



---

archive/issue_comments_352325.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWouldn't it make sense to move the block\n\n```\nif test -z \"$BASH_VERSION\"\n```\neven higher in the file, as early as possible?",
    "created_at": "2017-07-19T07:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352325",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Wouldn't it make sense to move the block

```
if test -z "$BASH_VERSION"
```
even higher in the file, as early as possible?



---

archive/issue_comments_352326.json:
```json
{
    "body": "Changed branch from **[u/tornaria/23448](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448)** to **[u/tornaria/23448-v2](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v2)**",
    "created_at": "2017-07-19T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352326",
    "user": "https://github.com/tornaria"
}
```

Changed branch from **[u/tornaria/23448](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448)** to **[u/tornaria/23448-v2](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v2)**



---

archive/issue_comments_352327.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI've changed the patch so that this is done immediately after AC_INIT, as per this paragraph in autoconf documentation:\n    If your configure script does its own option processing, it should inspect \u2018$@\u2019 or \u2018$*\u2019 immediately after calling AC_INIT, because other Autoconf macros liberally use the set command to process strings, and this has the side effect of updating \u2018$@\u2019 and \u2018$*\u2019.\nhttps://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Initializing-configure.html\n\nI put the new patch as a single commit in a new branch, I'm not sure if that's proper etiquette, please let me know otherwise.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6\"><code>16d2c3a</code></a></td><td><code>Trac #23448: fix configure when run with dash</code></td></tr></table>\n",
    "created_at": "2017-07-19T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352327",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:15" align="right">comment:15</div>

I've changed the patch so that this is done immediately after AC_INIT, as per this paragraph in autoconf documentation:
    If your configure script does its own option processing, it should inspect ‘$@’ or ‘$*’ immediately after calling AC_INIT, because other Autoconf macros liberally use the set command to process strings, and this has the side effect of updating ‘$@’ and ‘$*’.
https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Initializing-configure.html

I put the new patch as a single commit in a new branch, I'm not sure if that's proper etiquette, please let me know otherwise.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6"><code>16d2c3a</code></a></td><td><code>Trac #23448: fix configure when run with dash</code></td></tr></table>




---

archive/issue_comments_352328.json:
```json
{
    "body": "Changed author from **tornaria** to **Gonzalo Tornar\u00eda**",
    "created_at": "2017-07-19T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352328",
    "user": "https://github.com/tornaria"
}
```

Changed author from **tornaria** to **Gonzalo Tornaría**



---

archive/issue_comments_352329.json:
```json
{
    "body": "Changed commit from **[`e77704b`](https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8)** to **[`16d2c3a`](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)**",
    "created_at": "2017-07-19T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352329",
    "user": "https://github.com/tornaria"
}
```

Changed commit from **[`e77704b`](https://github.com/sagemath/sagetrac-mirror/commit/e77704be65648f5915df5f78573eb26fbc22cee8)** to **[`16d2c3a`](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)**



---

archive/issue_events_326365.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-19T20:33:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326365"
}
```



---

archive/issue_events_326366.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2017-07-19T20:33:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326366"
}
```



---

archive/issue_comments_352330.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tornaria](#comment:11):\n> The first thing `configure` does is to check whether the current shell is \"good enough\" to run configure. If not, it will try `sh`, `bash`, `ksh` and `sh5` in `/bin` or `/usr/bin`.\n\nFor the record: apparently what it means to be \"good enough\" is to support `$LINENO`. It turns out recent dash added or fixed support for `$LINENO`:\n\n    \u2014 Variable: CONFIG_SHELL\n\n        The shell with which to run configure. It must be Bourne-compatible, and the absolute name of the shell should be passed. The default is a shell that supports LINENO if available, and /bin/sh otherwise. \n\nhttps://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/config_002estatus-Invocation.html",
    "created_at": "2017-07-19T20:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352330",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tornaria](#comment:11):
> The first thing `configure` does is to check whether the current shell is "good enough" to run configure. If not, it will try `sh`, `bash`, `ksh` and `sh5` in `/bin` or `/usr/bin`.

For the record: apparently what it means to be "good enough" is to support `$LINENO`. It turns out recent dash added or fixed support for `$LINENO`:

    — Variable: CONFIG_SHELL

        The shell with which to run configure. It must be Bourne-compatible, and the absolute name of the shell should be passed. The default is a shell that supports LINENO if available, and /bin/sh otherwise. 

https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/config_002estatus-Invocation.html



---

archive/issue_comments_352331.json:
```json
{
    "body": "Changed commit from **[`16d2c3a`](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)** to **[`de73482`](https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c)**",
    "created_at": "2017-07-19T21:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`16d2c3a`](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)** to **[`de73482`](https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c)**



---

archive/issue_comments_352332.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c\"><code>de73482</code></a></td><td><code>Trac #23448: change the way we run bash</code></td></tr></table>\n",
    "created_at": "2017-07-19T21:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c"><code>de73482</code></a></td><td><code>Trac #23448: change the way we run bash</code></td></tr></table>




---

archive/issue_comments_352333.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI found another issue with the way bash is run.\n\nIt turns out that if we set `CONFIG_SHELL=bash`, this ends up into the #! for `config.status`. Eventually we get an error when this script is run later.\n\n~~~The simplest solution is to just run `exec bash $0 \"$@\"` without touching `CONFIG_SHELL`. This way configure is run under bash, and we let it decide which shell to put in the #! for `config.status`.~~~\n\nThe proper fix is to use `command -v bash` to get full path.\n\nPlease ignore `de73482` above, it was replaced with `\u200b89212b4` below.\n\n(This could also affect #23451)",
    "created_at": "2017-07-19T21:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352333",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:18" align="right">comment:18</div>

I found another issue with the way bash is run.

It turns out that if we set `CONFIG_SHELL=bash`, this ends up into the #! for `config.status`. Eventually we get an error when this script is run later.

~~~The simplest solution is to just run `exec bash $0 "$@"` without touching `CONFIG_SHELL`. This way configure is run under bash, and we let it decide which shell to put in the #! for `config.status`.~~~

The proper fix is to use `command -v bash` to get full path.

Please ignore `de73482` above, it was replaced with `​89212b4` below.

(This could also affect #23451)



---

archive/issue_comments_352334.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nFinal list of commits for this ticket, on branch [u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/commits/u/tornaria/23448-v3):\n|                                                                                                                                                 |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[16d2c3a](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)|`Trac #23448: fix configure when run with dash`|\n|[89212b4](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)|`Trac #23448: use full path for bash in configure`|",
    "created_at": "2017-07-19T22:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352334",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:19" align="right">comment:19</div>

Final list of commits for this ticket, on branch [u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/commits/u/tornaria/23448-v3):
|                                                                                                                                                 |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[16d2c3a](https://github.com/sagemath/sagetrac-mirror/commit/16d2c3a5bc98b45ec3174d2e30e06889705e0fa6)|`Trac #23448: fix configure when run with dash`|
|[89212b4](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)|`Trac #23448: use full path for bash in configure`|



---

archive/issue_comments_352335.json:
```json
{
    "body": "Changed commit from **[`de73482`](https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c)** to **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**",
    "created_at": "2017-07-19T22:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352335",
    "user": "https://github.com/tornaria"
}
```

Changed commit from **[`de73482`](https://github.com/sagemath/sagetrac-mirror/commit/de73482e6cd4d6ea667c867a7b6197c8ef29ef8c)** to **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**



---

archive/issue_comments_352336.json:
```json
{
    "body": "Changed branch from **[u/tornaria/23448-v2](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v2)** to **[u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v3)**",
    "created_at": "2017-07-19T22:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352336",
    "user": "https://github.com/tornaria"
}
```

Changed branch from **[u/tornaria/23448-v2](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v2)** to **[u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v3)**



---

archive/issue_comments_352337.json:
```json
{
    "body": "Replying to [ticket:23448 tornaria]:\n> My `/bin/sh` happens to be this shell, so just running `make` is broken in my system.\n\nSimple proposal: change the `Makefile` to run `bash configure` instead of `./configure` and error out in `configure` if the shell is not bash.\n\nI think that is a much simpler solution which would also solve your problem.\n\nComments?",
    "created_at": "2017-08-23T13:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352337",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23448 tornaria]:
> My `/bin/sh` happens to be this shell, so just running `make` is broken in my system.

Simple proposal: change the `Makefile` to run `bash configure` instead of `./configure` and error out in `configure` if the shell is not bash.

I think that is a much simpler solution which would also solve your problem.

Comments?



---

archive/issue_comments_352338.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment:20):\n> Simple proposal: change the `Makefile` to run `bash configure` instead of `./configure` and error out in `configure` if the shell is not bash.\n> \n> I think that is a much simpler solution which would also solve your problem.\n\nI wouldn't say the current proposal is not simple, in fact my current patch has this in `configure.ac`:\n\n```\n# The following needs to be immediately after calling AC_INIT\n#------------------------------------------------------------\n# We need to run this configure script with bash\nif test -z \"$BASH_VERSION\"\nthen\n    CONFIG_SHELL=`command -v bash`\n    export CONFIG_SHELL\n    if $CONFIG_SHELL -c \"exit 0\"\n    then\n        exec $CONFIG_SHELL $0 \"$@\"\n    else\n        AC_MSG_NOTICE([The 'bash' shell is needed to build AC_PACKAGE_NAME])\n        AC_MSG_NOTICE([All modern systems will have the 'bash' shell installed somewhere])\n        if test -d /opt/OpenSource/bin\n        then\n           AC_MSG_NOTICE([On HP-UX you may try adding /opt/OpenSource/bin to your path])\n        fi  \n        if test -d /opt/pware/bin\n        then\n           AC_MSG_NOTICE([On AIX you may try adding /opt/pware/bin to your path])\n        fi  \n        AC_MSG_ERROR(['bash' not found])\n    fi  \nfi\n```\nwhile for your proposal it would be:\n\n```\n#------------------------------------------------------------\n# We need to run this configure script with bash\nif test -z \"$BASH_VERSION\"\nthen\n    AC_MSG_NOTICE([The 'bash' shell is needed to build AC_PACKAGE_NAME])\n    AC_MSG_NOTICE([All modern systems will have the 'bash' shell installed somewhere])\n    if test -d /opt/OpenSource/bin\n    then\n       AC_MSG_NOTICE([On HP-UX you may try adding /opt/OpenSource/bin to your path])\n    fi  \n    if test -d /opt/pware/bin\n    then\n       AC_MSG_NOTICE([On AIX you may try adding /opt/pware/bin to your path])\n    fi  \n    AC_MSG_ERROR(['bash' not found])\nfi\n```\n\nSo it's essentially the same except the first one will try to find bash and reexec instead, we avoid tracking all the paths that lead to running configure.\n\nNote that I didn't write the code above, it was already written and the only problem was that it was moved to run too late. With the warning I added (needs to be immediately after calling AC_INIT) it should be safe.",
    "created_at": "2017-08-23T13:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352338",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment:20):
> Simple proposal: change the `Makefile` to run `bash configure` instead of `./configure` and error out in `configure` if the shell is not bash.
> 
> I think that is a much simpler solution which would also solve your problem.

I wouldn't say the current proposal is not simple, in fact my current patch has this in `configure.ac`:

```
# The following needs to be immediately after calling AC_INIT
#------------------------------------------------------------
# We need to run this configure script with bash
if test -z "$BASH_VERSION"
then
    CONFIG_SHELL=`command -v bash`
    export CONFIG_SHELL
    if $CONFIG_SHELL -c "exit 0"
    then
        exec $CONFIG_SHELL $0 "$@"
    else
        AC_MSG_NOTICE([The 'bash' shell is needed to build AC_PACKAGE_NAME])
        AC_MSG_NOTICE([All modern systems will have the 'bash' shell installed somewhere])
        if test -d /opt/OpenSource/bin
        then
           AC_MSG_NOTICE([On HP-UX you may try adding /opt/OpenSource/bin to your path])
        fi  
        if test -d /opt/pware/bin
        then
           AC_MSG_NOTICE([On AIX you may try adding /opt/pware/bin to your path])
        fi  
        AC_MSG_ERROR(['bash' not found])
    fi  
fi
```
while for your proposal it would be:

```
#------------------------------------------------------------
# We need to run this configure script with bash
if test -z "$BASH_VERSION"
then
    AC_MSG_NOTICE([The 'bash' shell is needed to build AC_PACKAGE_NAME])
    AC_MSG_NOTICE([All modern systems will have the 'bash' shell installed somewhere])
    if test -d /opt/OpenSource/bin
    then
       AC_MSG_NOTICE([On HP-UX you may try adding /opt/OpenSource/bin to your path])
    fi  
    if test -d /opt/pware/bin
    then
       AC_MSG_NOTICE([On AIX you may try adding /opt/pware/bin to your path])
    fi  
    AC_MSG_ERROR(['bash' not found])
fi
```

So it's essentially the same except the first one will try to find bash and reexec instead, we avoid tracking all the paths that lead to running configure.

Note that I didn't write the code above, it was already written and the only problem was that it was moved to run too late. With the warning I added (needs to be immediately after calling AC_INIT) it should be safe.



---

archive/issue_comments_352339.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:20):\n> I think that is a much simpler solution which would also solve your problem.\n\nAnother comment: it just happens that I'm running a new version of `dash`, while most others (e.g. debian, ubuntu, etc) are running an older version.\n\nThis will be a problem for everybody once the main distros pick up a new version of dash, so fixing this now is investing for the future :-)\n\n(same applies to #23451)",
    "created_at": "2017-08-23T13:46:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352339",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:20):
> I think that is a much simpler solution which would also solve your problem.

Another comment: it just happens that I'm running a new version of `dash`, while most others (e.g. debian, ubuntu, etc) are running an older version.

This will be a problem for everybody once the main distros pick up a new version of dash, so fixing this now is investing for the future :-)

(same applies to #23451)



---

archive/issue_comments_352340.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@tornaria](#comment:21):\n> So it's essentially the same except the first one will try to find bash and reexec instead\n\n\"apples and oranges are essentially the same except they are different\" :-)\n\nAs this ticket shows, it's precisely the reexec part which is fragile, so I suggest just dropping that.",
    "created_at": "2017-08-23T14:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352340",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@tornaria](#comment:21):
> So it's essentially the same except the first one will try to find bash and reexec instead

"apples and oranges are essentially the same except they are different" :-)

As this ticket shows, it's precisely the reexec part which is fragile, so I suggest just dropping that.



---

archive/issue_comments_352341.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Replying to [@tornaria](#comment:21):\n> > So it's essentially the same except the first one will try to find bash and reexec instead\n\n> \n> \"apples and oranges are essentially the same except they are different\" :-)\n> \n> As this ticket shows, it's precisely the reexec part which is fragile, so I suggest just dropping that.\n\nNot quite, the \"fragile\" part is using the positional parameters \"$0\" and \"$@\", but that's very clearly documented in the autoconf manual that the parameters must be used immediately after calling AC_INIT since other macros will change their value.\n\nI would argue that if configure requires `bash`, then the #! line should have `/bin/bash` instead, but that may have other problems (maybe bash is in a different location, etc), it's a bit silly to ship a script with \"#! /bin/sh\" for which the correct way to run it is `bash ./configure`.\n\nThe standard way to instal a random program from source is to run\n\n```\n./configure\nmake\n```\nwhich won't work in your proposal.",
    "created_at": "2017-08-23T14:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352341",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment:23):
> Replying to [@tornaria](#comment:21):
> > So it's essentially the same except the first one will try to find bash and reexec instead

> 
> "apples and oranges are essentially the same except they are different" :-)
> 
> As this ticket shows, it's precisely the reexec part which is fragile, so I suggest just dropping that.

Not quite, the "fragile" part is using the positional parameters "$0" and "$@", but that's very clearly documented in the autoconf manual that the parameters must be used immediately after calling AC_INIT since other macros will change their value.

I would argue that if configure requires `bash`, then the #! line should have `/bin/bash` instead, but that may have other problems (maybe bash is in a different location, etc), it's a bit silly to ship a script with "#! /bin/sh" for which the correct way to run it is `bash ./configure`.

The standard way to instal a random program from source is to run

```
./configure
make
```
which won't work in your proposal.



---

archive/issue_comments_352342.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2018-01-06T11:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352342",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_326367.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-06T11:18:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326367"
}
```



---

archive/issue_events_326368.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-06T11:18:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326368"
}
```



---

archive/issue_events_326369.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-06T11:18:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326369"
}
```



---

archive/issue_events_326370.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-06T11:18:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326370"
}
```



---

archive/issue_comments_352343.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI am seeing a similar problem on FreeBSD, where `/bin/sh` is not `bash` or `dash`. However, I have `/bin/bash`, pointing to `/usr/local/bin/bash`, and this is my default shell.\n\nMy current workaround is to simply edit `./configure` to replace every `/bin/sh` with `/bin/bash`.\n\nThe branch on this ticket does not work for me, as `/bin/sh` is not the right shell to propagate into the build files by `./configure`: I get some silly errors while running `make` (which then tries to use `/bin/sh` instead of `/bin/bash`).\n\nI think we should give up on even trying to run configure with `/bin/sh`, make `bash` a Sage pre-req, and use `/bin/bash`  (or whatever the proper shebang invocation would be e.g. `/usr/bin/env bash`) consistently throughout.",
    "created_at": "2018-01-06T11:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352343",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

I am seeing a similar problem on FreeBSD, where `/bin/sh` is not `bash` or `dash`. However, I have `/bin/bash`, pointing to `/usr/local/bin/bash`, and this is my default shell.

My current workaround is to simply edit `./configure` to replace every `/bin/sh` with `/bin/bash`.

The branch on this ticket does not work for me, as `/bin/sh` is not the right shell to propagate into the build files by `./configure`: I get some silly errors while running `make` (which then tries to use `/bin/sh` instead of `/bin/bash`).

I think we should give up on even trying to run configure with `/bin/sh`, make `bash` a Sage pre-req, and use `/bin/bash`  (or whatever the proper shebang invocation would be e.g. `/usr/bin/env bash`) consistently throughout.



---

archive/issue_events_326371.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-06T11:20:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "title_is": "configure fails when run with dash or BSD sh",
    "title_was": "configure fails when run with dash",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326371"
}
```



---

archive/issue_comments_352344.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nWould it be acceptable to simply add to `./bootstrap` the `sed` editing of the generated `./configure` to replace all the occurence of `/bin/sh` with the output of `command -v bash` ?",
    "created_at": "2018-01-07T12:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352344",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

Would it be acceptable to simply add to `./bootstrap` the `sed` editing of the generated `./configure` to replace all the occurence of `/bin/sh` with the output of `command -v bash` ?



---

archive/issue_events_326372.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2018-01-07T14:40:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "title_is": "configure fails when run with a posix shell supporting $LINENO (e.g. dash 0.5.9 and many others)",
    "title_was": "configure fails when run with dash or BSD sh",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326372"
}
```



---

archive/issue_comments_352345.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIf my solution doesn't fix your bug, then it may be different bug.\n\nCan you please document clearly what fails before/after this patches? I suggest that you include detailed information of the exact shell with version and where to get it / how to build it, as I did in my report.\n\nAFAICT the behaviour with any posix-compatible shell would be to run configure under bash. This was broken before, and it should be fixed after.\n\nDid you remember to run `./bootstrap` after switching branches?\n\nI just tried to run configure with the three BSD shells that I have available in my distro:\n\n```\n[*] loksh-6.2_1                        A Linux port of OpenBSD's ksh\n[*] mksh-R56b_1                        The MirBSD Korn Shell\n[*] oksh-0.5.9_2                       OpenBSD's version of ksh ported to Linux\n```\nI can tell you that those three exhibit the same behaviour as dash 0.5.9.1, namely configure fails in the same way before my patch, and works after my patch.\n\nWhile I was at it, I also tried all the other posix shells I have available in my distro:\n\n```\n[*] heirloom-sh-050706_3                A portable variant of the traditional Unix shell\n[*] ksh-2017.12.31_1                    AT&T's Korn shell (ksh93)\n[*] yash-2.46_1                         Yet another shell (POSIX-compliant)\n[*] zsh-5.4.2_1                         The Z SHell\n```\nwith the same result (configure is broken before, works after).\n\nNote that I am NOT claiming one can build the whole of sage with those shells, but only that configure can be run successfully. In fact, #23451 reports and fixes two issues down the line.\n\nAlso note that this works by switching to bash, so it's still a requirement, but it will pick bash from your PATH so you don't need to put it in `/bin/bash` (which you can't unless you are root)\n\n---\n\nThe patch I proposed fixes the issue I reported in a reasonable way without breaking anything that already works. It is really simple, just changing the order of some lines to match what is required explicitly by autoconf documentation, and some little details. I explained and documented everything that's going on.\n\nI documented above 8 different shells for which configure is broken and fixed by this.\n\nThe fact that there may be OTHER bugs that my patch won't fix is a non sequitur for rejecting it, and I even reported at least one more (#23451).\n\nI spent a fair number of hours back in SD87 to understand and diagnose this and the other bug, fix it and document the reasons for the bug and the fix, and the situation is that 6 months after I still cannot build Sage in [void linux](http://www.voidlinux.eu/).\n\nMore important, as I argued above, is that is only matter of time until \"more mainstream\" distros pick the new version of dash that will break sage building.\n\n---\n\nLet me summarise the situation.\n\nBefore the patch:\na. sage can be built if `/bin/sh` is bash or an old version of dash (I guess any posix shell that doesn't support `$LINENO`)\nb. configure fails if `/bin/sh` is a posix shell that supports `$LINENO`\n\nAfter the patch:\nc. nothing changes for situation (a)\nd. configure works if `/bin/sh` is a posix shell that supports `$LINENO` (tested with 8 different shells)\ne. sage can be completely built after some minor additional fixes to a couple of packages (#23451)\n\nCan we please:\n1. limit the scope of this ticket to fixing the configure step of sage when `/bin/sh` is a posix shell that supports `$LINENO`\n2. limit the review to checking my claim that\n   a. the patch won't break building in systems where it now works\n   b. it fixes the configure step under other shells (including dash 0.5.9.1)\n\nFixing other steps of the build is a non-goal of the current ticket.",
    "created_at": "2018-01-07T14:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352345",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:28" align="right">comment:28</div>

If my solution doesn't fix your bug, then it may be different bug.

Can you please document clearly what fails before/after this patches? I suggest that you include detailed information of the exact shell with version and where to get it / how to build it, as I did in my report.

AFAICT the behaviour with any posix-compatible shell would be to run configure under bash. This was broken before, and it should be fixed after.

Did you remember to run `./bootstrap` after switching branches?

I just tried to run configure with the three BSD shells that I have available in my distro:

```
[*] loksh-6.2_1                        A Linux port of OpenBSD's ksh
[*] mksh-R56b_1                        The MirBSD Korn Shell
[*] oksh-0.5.9_2                       OpenBSD's version of ksh ported to Linux
```
I can tell you that those three exhibit the same behaviour as dash 0.5.9.1, namely configure fails in the same way before my patch, and works after my patch.

While I was at it, I also tried all the other posix shells I have available in my distro:

```
[*] heirloom-sh-050706_3                A portable variant of the traditional Unix shell
[*] ksh-2017.12.31_1                    AT&T's Korn shell (ksh93)
[*] yash-2.46_1                         Yet another shell (POSIX-compliant)
[*] zsh-5.4.2_1                         The Z SHell
```
with the same result (configure is broken before, works after).

Note that I am NOT claiming one can build the whole of sage with those shells, but only that configure can be run successfully. In fact, #23451 reports and fixes two issues down the line.

Also note that this works by switching to bash, so it's still a requirement, but it will pick bash from your PATH so you don't need to put it in `/bin/bash` (which you can't unless you are root)

---

The patch I proposed fixes the issue I reported in a reasonable way without breaking anything that already works. It is really simple, just changing the order of some lines to match what is required explicitly by autoconf documentation, and some little details. I explained and documented everything that's going on.

I documented above 8 different shells for which configure is broken and fixed by this.

The fact that there may be OTHER bugs that my patch won't fix is a non sequitur for rejecting it, and I even reported at least one more (#23451).

I spent a fair number of hours back in SD87 to understand and diagnose this and the other bug, fix it and document the reasons for the bug and the fix, and the situation is that 6 months after I still cannot build Sage in [void linux](http://www.voidlinux.eu/).

More important, as I argued above, is that is only matter of time until "more mainstream" distros pick the new version of dash that will break sage building.

---

Let me summarise the situation.

Before the patch:
a. sage can be built if `/bin/sh` is bash or an old version of dash (I guess any posix shell that doesn't support `$LINENO`)
b. configure fails if `/bin/sh` is a posix shell that supports `$LINENO`

After the patch:
c. nothing changes for situation (a)
d. configure works if `/bin/sh` is a posix shell that supports `$LINENO` (tested with 8 different shells)
e. sage can be completely built after some minor additional fixes to a couple of packages (#23451)

Can we please:
1. limit the scope of this ticket to fixing the configure step of sage when `/bin/sh` is a posix shell that supports `$LINENO`
2. limit the review to checking my claim that
   a. the patch won't break building in systems where it now works
   b. it fixes the configure step under other shells (including dash 0.5.9.1)

Fixing other steps of the build is a non-goal of the current ticket.



---

archive/issue_events_326373.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2018-01-07T14:40:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326373"
}
```



---

archive/issue_events_326374.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2018-01-07T14:40:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326374"
}
```



---

archive/issue_events_326375.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-07T15:05:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326375"
}
```



---

archive/issue_events_326376.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-07T15:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326376"
}
```



---

archive/issue_comments_352346.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Jeroen Demeyer, Dima Pasechnik**",
    "created_at": "2018-01-07T15:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352346",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **Dima Pasechnik** to **Jeroen Demeyer, Dima Pasechnik**



---

archive/issue_comments_352347.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOK, sorry for noise. It looks good.",
    "created_at": "2018-01-07T15:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352347",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

OK, sorry for noise. It looks good.



---

archive/issue_comments_352348.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@dimpase](#comment:29):\n> OK, sorry for noise. It looks good.\n\nThanks, let me know if I can help you diagnosing the issue you have with FreeBSD.",
    "created_at": "2018-01-07T15:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352348",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@dimpase](#comment:29):
> OK, sorry for noise. It looks good.

Thanks, let me know if I can help you diagnosing the issue you have with FreeBSD.



---

archive/issue_comments_352349.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer, Dima Pasechnik** to **Dima Pasechnik**",
    "created_at": "2018-01-07T15:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352349",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer, Dima Pasechnik** to **Dima Pasechnik**



---

archive/issue_comments_352350.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI never said that I agreed with the current branch.",
    "created_at": "2018-01-07T15:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352350",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

I never said that I agreed with the current branch.



---

archive/issue_comments_352351.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment:31):\n> I never said that I agreed with the current branch.\n\nI take \"reviewer\" in sense of publishing, not as \"signed off by\".\n\nThis patch is an improvement for freebsd and other non-*ash shells too.",
    "created_at": "2018-01-07T15:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352351",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment:31):
> I never said that I agreed with the current branch.

I take "reviewer" in sense of publishing, not as "signed off by".

This patch is an improvement for freebsd and other non-*ash shells too.



---

archive/issue_comments_352352.json:
```json
{
    "body": "Changed branch from **[u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v3)** to **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**",
    "created_at": "2018-01-14T10:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23448#issuecomment-352352",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tornaria/23448-v3](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/23448-v3)** to **[`89212b4`](https://github.com/sagemath/sagetrac-mirror/commit/89212b447cda068b0596de93e59ca93a9104ad1e)**



---

archive/issue_events_326377.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T10:14:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326377"
}
```



---

archive/issue_events_326378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5520e00bf2422934bc7d9ec57dcaa1ca3e793452",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-14T10:14:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23448",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23448#event-326378"
}
```
