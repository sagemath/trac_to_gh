# Issue 23418: put number fields in Fields().Infinite()

archive/issues_023181.json:
```json
{
    "assignees": [],
    "body": "and the same for QQ of course.\n\nThis fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.\n\nFollow up at #24432.\n\nCC:  @nthiery @tscrim\n\nBranch/Commit: **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23418_\n\n",
    "closed_at": "2018-01-20T20:20:11Z",
    "created_at": "2017-07-13T07:01:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "put number fields in Fields().Infinite()",
    "type": "issue",
    "updated_at": "2018-01-20T20:20:11Z",
    "url": "https://github.com/sagemath/sage/issues/23418",
    "user": "https://github.com/fchapoton"
}
```
and the same for QQ of course.

This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.

Follow up at #24432.

CC:  @nthiery @tscrim

Branch/Commit: **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**

Reviewer: **Travis Scrimshaw**

Author: **Frédéric Chapoton, Vincent Delecroix**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/23418_





---

archive/issue_events_323121.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-13T07:01:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323121"
}
```



---

archive/issue_events_323122.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-13T07:01:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323122"
}
```



---

archive/issue_events_323123.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-13T07:01:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323123"
}
```



---

archive/issue_events_323124.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-13T07:01:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323124"
}
```



---

archive/issue_comments_351742.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df\"><code>2f98551</code></a></td><td><code>trac 23418 fixing some doctests in rings and category folders</code></td></tr></table>\n",
    "created_at": "2017-07-13T07:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351742",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df"><code>2f98551</code></a></td><td><code>trac 23418 fixing some doctests in rings and category folders</code></td></tr></table>




---

archive/issue_comments_351743.json:
```json
{
    "body": "Commit: **[`2f98551`](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)**",
    "created_at": "2017-07-13T07:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351743",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`2f98551`](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)**



---

archive/issue_comments_351744.json:
```json
{
    "body": "Branch: **[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)**",
    "created_at": "2017-07-13T07:08:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351744",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)**



---

archive/issue_comments_351745.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335\"><code>a06ebbc</code></a></td><td><code>trac 23418 correct more doctests</code></td></tr></table>\n",
    "created_at": "2017-07-13T10:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351745",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335"><code>a06ebbc</code></a></td><td><code>trac 23418 correct more doctests</code></td></tr></table>




---

archive/issue_comments_351746.json:
```json
{
    "body": "Changed commit from **[`2f98551`](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)** to **[`a06ebbc`](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)**",
    "created_at": "2017-07-13T10:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351746",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2f98551`](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)** to **[`a06ebbc`](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)**



---

archive/issue_comments_351747.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis triggers some problem here:\n\n```\nsage -t --long src/sage/structure/parent.pyx  # 6 doctests failed\n```",
    "created_at": "2017-07-13T10:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351747",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

This triggers some problem here:

```
sage -t --long src/sage/structure/parent.pyx  # 6 doctests failed
```



---

archive/issue_comments_351748.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt seems that the morphisms from Sets take over the morphisms from Rings..",
    "created_at": "2017-07-13T11:42:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351748",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

It seems that the morphisms from Sets take over the morphisms from Rings..



---

archive/issue_comments_351749.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFailures are related to this:\n\n```\nsage: x = QQ['x'].0\nsage: t = abs(ZZ.random_element(10^6))\nsage: K = NumberField(x^2 + 2*3*7*11, \"a\"+str(t))\nsage: a = K.gen()\n\nsage: Hom(K, a.matrix().parent())\nSet of Morphisms from Number Field in a791947 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field in Category of infinite rings\n<class 'sage.categories.homset.Homset_with_category'>\n```\ncompared to vanilla Sage:\n\n```\nsage: Hom(K, a.matrix().parent())\nSet of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field\nsage: type(Hom(K, a.matrix().parent()))\n<class 'sage.rings.homset.RingHomset_generic_with_category'>\n```\n\nThis differences comes from the fact that the category becomes a join category (in the branch) because that is the meet category computed by `Hom`:\n\n```\nsage: K.category()._meet_(a.matrix().parent().category())\nCategory of infinite rings\nsage: type(_)\n<class 'sage.categories.category.JoinCategory_with_category'>\n```\nversus vanilla:\n\n```\nsage: K.category()._meet_(a.matrix().parent().category())\nCategory of rings\nsage: type(_)\n<class 'sage.categories.rings.Rings_with_category'>\n```\nNow, `K` is not a subclass of the meet category's `parent_class`, which causes the `Cat.parent_class._Hom_` method to now raise an error:\n\n```\nsage: Cat = K.category()._meet_(a.matrix().parent().category())\nsage: Cat.parent_class\n<class 'sage.categories.category.JoinCategory.parent_class'>\nsage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-6-aa7f8d9cdf73> in <module>()\n----> 1 Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\nTypeError: unbound method _Hom_() must be called with JoinCategory.parent_class instance as first argument (got NumberField_quadratic_with_category instance instead)\n```\nversus vanilla\n\n```\nsage: Cat = K.category()._meet_(a.matrix().parent().category())\nsage: Cat.parent_class\n<class 'sage.categories.rings.Rings.parent_class'>\nsage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\nSet of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field\n```",
    "created_at": "2017-08-30T21:45:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351749",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Failures are related to this:

```
sage: x = QQ['x'].0
sage: t = abs(ZZ.random_element(10^6))
sage: K = NumberField(x^2 + 2*3*7*11, "a"+str(t))
sage: a = K.gen()

sage: Hom(K, a.matrix().parent())
Set of Morphisms from Number Field in a791947 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field in Category of infinite rings
<class 'sage.categories.homset.Homset_with_category'>
```
compared to vanilla Sage:

```
sage: Hom(K, a.matrix().parent())
Set of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field
sage: type(Hom(K, a.matrix().parent()))
<class 'sage.rings.homset.RingHomset_generic_with_category'>
```

This differences comes from the fact that the category becomes a join category (in the branch) because that is the meet category computed by `Hom`:

```
sage: K.category()._meet_(a.matrix().parent().category())
Category of infinite rings
sage: type(_)
<class 'sage.categories.category.JoinCategory_with_category'>
```
versus vanilla:

```
sage: K.category()._meet_(a.matrix().parent().category())
Category of rings
sage: type(_)
<class 'sage.categories.rings.Rings_with_category'>
```
Now, `K` is not a subclass of the meet category's `parent_class`, which causes the `Cat.parent_class._Hom_` method to now raise an error:

```
sage: Cat = K.category()._meet_(a.matrix().parent().category())
sage: Cat.parent_class
<class 'sage.categories.category.JoinCategory.parent_class'>
sage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-6-aa7f8d9cdf73> in <module>()
----> 1 Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
TypeError: unbound method _Hom_() must be called with JoinCategory.parent_class instance as first argument (got NumberField_quadratic_with_category instance instead)
```
versus vanilla

```
sage: Cat = K.category()._meet_(a.matrix().parent().category())
sage: Cat.parent_class
<class 'sage.categories.rings.Rings.parent_class'>
sage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
Set of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field
```



---

archive/issue_comments_351750.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)** to **[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)**",
    "created_at": "2017-09-21T09:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351750",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)** to **[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)**



---

archive/issue_comments_351751.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866\"><code>ba2ec5b</code></a></td><td><code>Merge commit '2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df' in 8.1.b5</code></td></tr></table>\n",
    "created_at": "2017-09-21T09:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351751",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866"><code>ba2ec5b</code></a></td><td><code>Merge commit '2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df' in 8.1.b5</code></td></tr></table>




---

archive/issue_comments_351752.json:
```json
{
    "body": "Changed commit from **[`a06ebbc`](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)** to **[`ba2ec5b`](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)**",
    "created_at": "2017-09-21T09:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351752",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`a06ebbc`](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)** to **[`ba2ec5b`](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)**



---

archive/issue_comments_351753.json:
```json
{
    "body": "Changed commit from **[`ba2ec5b`](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)** to **[`4e88b49`](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)**",
    "created_at": "2017-09-21T09:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ba2ec5b`](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)** to **[`4e88b49`](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)**



---

archive/issue_comments_351754.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121\"><code>4e88b49</code></a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2017-09-21T09:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121"><code>4e88b49</code></a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_351755.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd\"><code>6d3e532</code></a></td><td><code>trac 23418 fix</code></td></tr></table>\n",
    "created_at": "2017-09-21T11:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351755",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd"><code>6d3e532</code></a></td><td><code>trac 23418 fix</code></td></tr></table>




---

archive/issue_comments_351756.json:
```json
{
    "body": "Changed commit from **[`4e88b49`](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)** to **[`6d3e532`](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)**",
    "created_at": "2017-09-21T11:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351756",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e88b49`](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)** to **[`6d3e532`](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)**



---

archive/issue_comments_351757.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to **Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix**",
    "created_at": "2017-12-31T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351757",
    "user": "https://github.com/videlec"
}
```

Changed author from **Frédéric Chapoton** to **Frédéric Chapoton, Vincent Delecroix**



---

archive/issue_comments_351758.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n and the same for QQ of course\n+\n+follow up at #24432\n``````\n",
    "created_at": "2017-12-31T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351758",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 and the same for QQ of course
+
+follow up at #24432
``````




---

archive/issue_events_323125.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323125"
}
```



---

archive/issue_comments_351759.json:
```json
{
    "body": "Changed commit from **[`6d3e532`](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)** to **[`d2bf048`](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)**",
    "created_at": "2017-12-31T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351759",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`6d3e532`](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)** to **[`d2bf048`](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)**



---

archive/issue_comments_351760.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923\"><code>d2bf048</code></a></td><td><code>23418: number fields are infinite</code></td></tr></table>\n",
    "created_at": "2017-12-31T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351760",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923"><code>d2bf048</code></a></td><td><code>23418: number fields are infinite</code></td></tr></table>




---

archive/issue_events_323126.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323126"
}
```



---

archive/issue_events_323127.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323127"
}
```



---

archive/issue_comments_351761.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)** to **[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)**",
    "created_at": "2017-12-31T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351761",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)** to **[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)**



---

archive/issue_comments_351762.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nthe problem from [comment:5](#comment%3A5) is solved in `d2bf048` via\n\n```diff\n--- a/src/sage/categories/homset.py\n+++ b/src/sage/categories/homset.py\n@@ -402,7 +402,7 @@ def Hom(X, Y, category=None, check=True):\n                 #   will be called twice.\n                 # - This is bound to fail if X is an extension type and\n                 #   does not actually inherit from category.parent_class\n-                H = category.parent_class._Hom_(X, Y, category = category)\n+                H = X.category().parent_class._Hom_(X, Y, category = category)\n             except (AttributeError, TypeError):\n                 # By default, construct a plain homset.\n                 H = Homset(X, Y, category = category, check=check)\n```",
    "created_at": "2017-12-31T13:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351762",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

the problem from [comment:5](#comment%3A5) is solved in `d2bf048` via

```diff
--- a/src/sage/categories/homset.py
+++ b/src/sage/categories/homset.py
@@ -402,7 +402,7 @@ def Hom(X, Y, category=None, check=True):
                 #   will be called twice.
                 # - This is bound to fail if X is an extension type and
                 #   does not actually inherit from category.parent_class
-                H = category.parent_class._Hom_(X, Y, category = category)
+                H = X.category().parent_class._Hom_(X, Y, category = category)
             except (AttributeError, TypeError):
                 # By default, construct a plain homset.
                 H = Homset(X, Y, category = category, check=check)
```



---

archive/issue_comments_351763.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322\"><code>a632bf6</code></a></td><td><code>23418: number fields are infinite</code></td></tr></table>\n",
    "created_at": "2017-12-31T14:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351763",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322"><code>a632bf6</code></a></td><td><code>23418: number fields are infinite</code></td></tr></table>




---

archive/issue_comments_351764.json:
```json
{
    "body": "Changed commit from **[`d2bf048`](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)** to **[`a632bf6`](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)**",
    "created_at": "2017-12-31T14:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351764",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2bf048`](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)** to **[`a632bf6`](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)**



---

archive/issue_comments_351765.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nLooks good to me. Maybe Travis can confirm ?",
    "created_at": "2017-12-31T18:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351765",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

Looks good to me. Maybe Travis can confirm ?



---

archive/issue_events_323128.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-31T22:49:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323128"
}
```



---

archive/issue_events_323129.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-31T22:49:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323129"
}
```



---

archive/issue_comments_351766.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNo, I don't think this is correct because now it ignores the `category` input, and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`). So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?",
    "created_at": "2017-12-31T22:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351766",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

No, I don't think this is correct because now it ignores the `category` input, and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`). So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?



---

archive/issue_comments_351767.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@tscrim](#comment%3A13):\n> No, I don't think this is correct because now it ignores the `category` input\n\nStrictly speaking it does not, since the `category` argument is passed in the call\n\n```\nH = X.category().parent_class._Hom_(X, Y, category = category)\n```\n\n> and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\nDo you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\n> So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?\n\nAs you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent). Before doing my \"cheap fix\", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?\n\nIf you agree with the above, there are two concrete ways of doing this:\n- let my cheap fix pass and remove line 405 afterwards\n- remove line 405 in a dependency ticket",
    "created_at": "2018-01-01T10:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351767",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@tscrim](#comment%3A13):
> No, I don't think this is correct because now it ignores the `category` input

Strictly speaking it does not, since the `category` argument is passed in the call

```
H = X.category().parent_class._Hom_(X, Y, category = category)
```

> and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).

Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).

> So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?

As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent). Before doing my "cheap fix", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?

If you agree with the above, there are two concrete ways of doing this:
- let my cheap fix pass and remove line 405 afterwards
- remove line 405 in a dependency ticket



---

archive/issue_comments_351768.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@videlec](#comment%3A14):\n> Replying to [@tscrim](#comment%3A13):\n> > No, I don't think this is correct because now it ignores the `category` input\n\n> \n> Strictly speaking it does not, since the `category` argument is passed in the call\n> \n> ```\n> H = X.category().parent_class._Hom_(X, Y, category = category)\n> ```\n\nNo, `_Hom_` ignores the category input.\n\n> > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\n> \n> Do you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\nNo, your hack is creating new problems. For example, suppose `X` is an algebra with:\n\n- basis `{a, b}`,\n- multiplication `a^2 = b^2 = ab = a`.\n\nIf we want to construct a map `f: X -> X` given by `a,b |-> b`. This is not an algebra morphism, but instead only a module morphism. If we have `Algebras._Hom_`, which expects the category to be algebras (as it should), then this will break horribly and there is no way to use a `Modules._Hom_` (assuming it is also implemented).\n\nFor an example where this is currently implemented, we can replace `Algebras` with `HighestWeightCrystals` and `Modules` with `Crystals`. I have also constructed similar morphisms as above for my research.\n\n> > So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?\n\n> \n> As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent).\n\nI am not sure this would be the same behavior. There are two different things going on:\n\n1. If a parent does not implement a `_Hom_` method, then it should fall back to the specified category. Continuing my above example, this would only default to `Algebras._Hom_`, which would be wrong.\n2. The other behavior is if the homset returned by `X._Hom_` does not support the more general category, say, because it takes advantage of the extra structure (say, is only uses the algebra generating set and not the [possibly infinite] basis). One should expect that `X.category()._Hom_` would also take advantage of that extra structure as well and would similarly forbid more general categories.\n\n> Before doing my \"cheap fix\", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?\n\nIt doesn't make sense to me for the parent/category implementation of `_Hom_` to do super calls when something fails. I think it would create a lot of redundant logic (the error handling). Also, everything in between `X.category()` and the specified `category` would likely (needlessly) fail, making these calls significantly slower when there is a large category difference. While this is a solution, I think it is a very bad solution.\n\nI think special handling the join categories is going to be the proper fix as join categories are somewhat special in the category framework. While it may be just fixing the symptoms, it does not have the drawbacks that the other approaches have. I will push something today.",
    "created_at": "2018-01-02T18:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351768",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@videlec](#comment%3A14):
> Replying to [@tscrim](#comment%3A13):
> > No, I don't think this is correct because now it ignores the `category` input

> 
> Strictly speaking it does not, since the `category` argument is passed in the call
> 
> ```
> H = X.category().parent_class._Hom_(X, Y, category = category)
> ```

No, `_Hom_` ignores the category input.

> > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).

> 
> Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).

No, your hack is creating new problems. For example, suppose `X` is an algebra with:

- basis `{a, b}`,
- multiplication `a^2 = b^2 = ab = a`.

If we want to construct a map `f: X -> X` given by `a,b |-> b`. This is not an algebra morphism, but instead only a module morphism. If we have `Algebras._Hom_`, which expects the category to be algebras (as it should), then this will break horribly and there is no way to use a `Modules._Hom_` (assuming it is also implemented).

For an example where this is currently implemented, we can replace `Algebras` with `HighestWeightCrystals` and `Modules` with `Crystals`. I have also constructed similar morphisms as above for my research.

> > So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?

> 
> As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent).

I am not sure this would be the same behavior. There are two different things going on:

1. If a parent does not implement a `_Hom_` method, then it should fall back to the specified category. Continuing my above example, this would only default to `Algebras._Hom_`, which would be wrong.
2. The other behavior is if the homset returned by `X._Hom_` does not support the more general category, say, because it takes advantage of the extra structure (say, is only uses the algebra generating set and not the [possibly infinite] basis). One should expect that `X.category()._Hom_` would also take advantage of that extra structure as well and would similarly forbid more general categories.

> Before doing my "cheap fix", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?

It doesn't make sense to me for the parent/category implementation of `_Hom_` to do super calls when something fails. I think it would create a lot of redundant logic (the error handling). Also, everything in between `X.category()` and the specified `category` would likely (needlessly) fail, making these calls significantly slower when there is a large category difference. While this is a solution, I think it is a very bad solution.

I think special handling the join categories is going to be the proper fix as join categories are somewhat special in the category framework. While it may be just fixing the symptoms, it does not have the drawbacks that the other approaches have. I will push something today.



---

archive/issue_comments_351769.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tscrim](#comment%3A15):\n> Replying to [@videlec](#comment%3A14):\n> > Replying to [@tscrim](#comment%3A13):\n> > > No, I don't think this is correct because now it ignores the `category` input\n\n> > \n> > Strictly speaking it does not, since the `category` argument is passed in the call\n> > \n> > ```\n> > H = X.category().parent_class._Hom_(X, Y, category = category)\n> > ```\n\n> \n> No, `_Hom_` ignores the category input.\n> \n> > > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\n> > \n> > Do you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\n> \n> No, your hack is creating new problems. [SNIP]\n\nThis would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.\n \n>>> So this change is a regression [...]\n\n> I will push something today.\n\nThanks! You might want to use another ticket or update the description of this one.",
    "created_at": "2018-01-02T20:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351769",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tscrim](#comment%3A15):
> Replying to [@videlec](#comment%3A14):
> > Replying to [@tscrim](#comment%3A13):
> > > No, I don't think this is correct because now it ignores the `category` input

> > 
> > Strictly speaking it does not, since the `category` argument is passed in the call
> > 
> > ```
> > H = X.category().parent_class._Hom_(X, Y, category = category)
> > ```

> 
> No, `_Hom_` ignores the category input.
> 
> > > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).

> > 
> > Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).

> 
> No, your hack is creating new problems. [SNIP]

This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.
 
>>> So this change is a regression [...]

> I will push something today.

Thanks! You might want to use another ticket or update the description of this one.



---

archive/issue_comments_351770.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@videlec](#comment%3A16):\n> This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.\n\nI believe I have a concrete example and will add it.\n\n> >>> So this change is a regression [...]\n\n> > I will push something today.\n\n> \n> Thanks! You might want to use another ticket or update the description of this one.\n\nNo problem. Thanks for your work on this.",
    "created_at": "2018-01-03T00:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351770",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@videlec](#comment%3A16):
> This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.

I believe I have a concrete example and will add it.

> >>> So this change is a regression [...]

> > I will push something today.

> 
> Thanks! You might want to use another ticket or update the description of this one.

No problem. Thanks for your work on this.



---

archive/issue_comments_351771.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)** to **[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)**",
    "created_at": "2018-01-03T07:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351771",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)** to **[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)**



---

archive/issue_comments_351772.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-01-03T07:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351772",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_351773.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-and the same for QQ of course\n+and the same for QQ of course.\n \n-follow up at #24432\n+This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.\n+\n+Follow up at #24432.\n``````\n",
    "created_at": "2018-01-03T07:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351773",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-and the same for QQ of course
+and the same for QQ of course.
 
-follow up at #24432
+This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.
+
+Follow up at #24432.
``````




---

archive/issue_comments_351774.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nActually, from looking at it and thinking about it more, the category of highest weight crystals is a full subcategory, so it does not quite work (in contrast to algebras and modules). So instead I just manufactured a minimal example that fails with your change.\n\nHere is a branch that does special handling of `JoinCategory`. It passes all the tests that were previously failing.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39b05604d470fb73084270c746c4aca61e63f48b\"><code>39b0560</code></a></td><td><code>Merge branch 'u/vdelecroix/23418' of git://trac.sagemath.org/sage into public/number_fields/in_infinite_fields-23418</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdbc67dafaa65dc2de3cc81c57ef17a0e5b1e209\"><code>cdbc67d</code></a></td><td><code>Reverting change and adding test showing the behavior.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8\"><code>b7f3fa6</code></a></td><td><code>Special handling of the join categories for Hom.</code></td></tr></table>\n",
    "created_at": "2018-01-03T07:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351774",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

Actually, from looking at it and thinking about it more, the category of highest weight crystals is a full subcategory, so it does not quite work (in contrast to algebras and modules). So instead I just manufactured a minimal example that fails with your change.

Here is a branch that does special handling of `JoinCategory`. It passes all the tests that were previously failing.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39b05604d470fb73084270c746c4aca61e63f48b"><code>39b0560</code></a></td><td><code>Merge branch 'u/vdelecroix/23418' of git://trac.sagemath.org/sage into public/number_fields/in_infinite_fields-23418</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdbc67dafaa65dc2de3cc81c57ef17a0e5b1e209"><code>cdbc67d</code></a></td><td><code>Reverting change and adding test showing the behavior.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8"><code>b7f3fa6</code></a></td><td><code>Special handling of the join categories for Hom.</code></td></tr></table>




---

archive/issue_comments_351775.json:
```json
{
    "body": "Changed commit from **[`a632bf6`](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)** to **[`b7f3fa6`](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)**",
    "created_at": "2018-01-03T07:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351775",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[`a632bf6`](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)** to **[`b7f3fa6`](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)**



---

archive/issue_events_323130.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-03T07:32:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323130"
}
```



---

archive/issue_events_323131.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-03T07:32:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323131"
}
```



---

archive/issue_comments_351776.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe following loop is randomly choosing the last working call.\n\n```\nfor C in cats:\n    try:\n        H = C.parent_class._Hom_(X, Y, category=category)\n    except (AttributeError, TypeError):\n        pass\n```\nIf you want to keep this hack, wouldn't it be better this way\n\n```\nfor C in cats:\n    try:\n        H = C.parent_class._Hom_(X, Y, category=category)\n    except (AttributeError, TypeError):\n        pass\n    else:\n        break\n```",
    "created_at": "2018-01-03T15:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351776",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

The following loop is randomly choosing the last working call.

```
for C in cats:
    try:
        H = C.parent_class._Hom_(X, Y, category=category)
    except (AttributeError, TypeError):
        pass
```
If you want to keep this hack, wouldn't it be better this way

```
for C in cats:
    try:
        H = C.parent_class._Hom_(X, Y, category=category)
    except (AttributeError, TypeError):
        pass
    else:
        break
```



---

archive/issue_comments_351777.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb\"><code>bf01aa1</code></a></td><td><code>Break out once H is found.</code></td></tr></table>\n",
    "created_at": "2018-01-03T16:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351777",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb"><code>bf01aa1</code></a></td><td><code>Break out once H is found.</code></td></tr></table>




---

archive/issue_comments_351778.json:
```json
{
    "body": "Changed commit from **[`b7f3fa6`](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)** to **[`bf01aa1`](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)**",
    "created_at": "2018-01-03T16:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351778",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b7f3fa6`](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)** to **[`bf01aa1`](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)**



---

archive/issue_comments_351779.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nGood point; fixed.",
    "created_at": "2018-01-03T16:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351779",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

Good point; fixed.



---

archive/issue_comments_351780.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nGreen bot.",
    "created_at": "2018-01-12T18:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351780",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Green bot.



---

archive/issue_events_323132.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-12T19:17:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323132"
}
```



---

archive/issue_events_323133.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-12T19:17:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323133"
}
```



---

archive/issue_comments_351781.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSorry to have forgotten!",
    "created_at": "2018-01-12T19:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351781",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Sorry to have forgotten!



---

archive/issue_events_323134.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T13:14:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323134"
}
```



---

archive/issue_events_323135.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T13:14:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323135"
}
```



---

archive/issue_comments_351782.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n\n```\ngit reset --hard Hsage -t --long --warn-long 69.0 src/sage/structure/parent.pyx\n**********************************************************************\nFile \"src/sage/structure/parent.pyx\", line 1855, in sage.structure.parent.Parent.hom._generic_coerce_map\nFailed example:\n    QQ['x', 'y']._generic_coerce_map(QQ).category_for()\nExpected:\n    Category of unique factorization domains\nGot:\n    Category of infinite unique factorization domains\nEAD~\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.structure.parent.Parent.hom._generic_coerce_map\n    [407 tests, 1 failure, 3.07 s]\n```",
    "created_at": "2018-01-14T13:14:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351782",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:24" align="right">comment:24</div>


```
git reset --hard Hsage -t --long --warn-long 69.0 src/sage/structure/parent.pyx
**********************************************************************
File "src/sage/structure/parent.pyx", line 1855, in sage.structure.parent.Parent.hom._generic_coerce_map
Failed example:
    QQ['x', 'y']._generic_coerce_map(QQ).category_for()
Expected:
    Category of unique factorization domains
Got:
    Category of infinite unique factorization domains
EAD~
**********************************************************************
1 item had failures:
   1 of   4 in sage.structure.parent.Parent.hom._generic_coerce_map
    [407 tests, 1 failure, 3.07 s]
```



---

archive/issue_comments_351783.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI cannot reproduce this locally, so we might have to wait for the next beta. The doctest failure output should be the correct output. Yet, the test after it should probably also be `Category of infinite euclidean domains`, so something subtle might be going on too...",
    "created_at": "2018-01-15T16:23:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351783",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

I cannot reproduce this locally, so we might have to wait for the next beta. The doctest failure output should be the correct output. Yet, the test after it should probably also be `Category of infinite euclidean domains`, so something subtle might be going on too...



---

archive/issue_comments_351784.json:
```json
{
    "body": "Changed commit from **[`bf01aa1`](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)** to **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**",
    "created_at": "2018-01-19T19:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351784",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bf01aa1`](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)** to **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**



---

archive/issue_comments_351785.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2714d242fef4817d9ec6737c1a2c7c9b4d3c8d17\"><code>2714d24</code></a></td><td><code>Merge branch 'public/number_fields/in_infinite_fields-23418' in 8.2.b3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738\"><code>2008ba1</code></a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2018-01-19T19:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351785",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2714d242fef4817d9ec6737c1a2c7c9b4d3c8d17"><code>2714d24</code></a></td><td><code>Merge branch 'public/number_fields/in_infinite_fields-23418' in 8.2.b3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738"><code>2008ba1</code></a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_events_323136.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-19T19:21:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323136"
}
```



---

archive/issue_events_323137.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-19T19:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323137"
}
```



---

archive/issue_comments_351786.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI fixed the doctest",
    "created_at": "2018-01-19T19:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351786",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">comment:27</div>

I fixed the doctest



---

archive/issue_comments_351787.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSo the failure was because of #24413, whereas the second test would need a similar treatment for power series rings. This is good enough for now.",
    "created_at": "2018-01-20T06:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351787",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

So the failure was because of #24413, whereas the second test would need a similar treatment for power series rings. This is good enough for now.



---

archive/issue_events_323138.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-20T06:20:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323138"
}
```



---

archive/issue_events_323139.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-20T06:20:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323139"
}
```



---

archive/issue_events_323140.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-20T20:20:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323140"
}
```



---

archive/issue_events_323141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "115b43f4677c1bb8c1d32ea2d7ad097d97654ed8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-20T20:20:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23418#event-323141"
}
```



---

archive/issue_comments_351788.json:
```json
{
    "body": "Changed branch from **[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)** to **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**",
    "created_at": "2018-01-20T20:20:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23418#issuecomment-351788",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)** to **[`2008ba1`](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)**
