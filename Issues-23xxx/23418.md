# Issue 23418: put number fields in Fields().Infinite()

archive/issues_023181.json:
```json
{
    "body": "and the same for QQ of course.\n\nThis fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.\n\nFollow up at #24432.\n\n**CC:**  @nthiery @tscrim\n\n**Branch/Commit:** [2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/23418\n\n",
    "closed_at": "2018-01-20T20:20:11Z",
    "created_at": "2017-07-13T07:01:58Z",
    "labels": [
        "component: number fields",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "put number fields in Fields().Infinite()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23418",
    "user": "https://github.com/fchapoton"
}
```
and the same for QQ of course.

This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.

Follow up at #24432.

**CC:**  @nthiery @tscrim

**Branch/Commit:** [2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)

**Reviewer:** Travis Scrimshaw

**Author:** Frédéric Chapoton, Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/23418





---

archive/issue_comments_355946.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df\">2f98551</a></td><td><code>trac 23418 fixing some doctests in rings and category folders</code></td></tr></table>\n",
    "created_at": "2017-07-13T07:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355946",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df">2f98551</a></td><td><code>trac 23418 fixing some doctests in rings and category folders</code></td></tr></table>




---

archive/issue_comments_355947.json:
```json
{
    "body": "**Commit:** [2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)",
    "created_at": "2017-07-13T07:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355947",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)



---

archive/issue_comments_355948.json:
```json
{
    "body": "**Branch:** [u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)",
    "created_at": "2017-07-13T07:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355948",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)



---

archive/issue_comments_355949.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335\">a06ebbc</a></td><td><code>trac 23418 correct more doctests</code></td></tr></table>\n",
    "created_at": "2017-07-13T10:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335">a06ebbc</a></td><td><code>trac 23418 correct more doctests</code></td></tr></table>




---

archive/issue_comments_355950.json:
```json
{
    "body": "**Changing commit** from \"[2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)\" to \"[a06ebbcba1804cbc7bbf0f4cb347b1a022c27335](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)\".",
    "created_at": "2017-07-13T10:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df](https://github.com/sagemath/sagetrac-mirror/commit/2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df)" to "[a06ebbcba1804cbc7bbf0f4cb347b1a022c27335](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)".



---

archive/issue_comments_355951.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis triggers some problem here:\n\n```\nsage -t --long src/sage/structure/parent.pyx  # 6 doctests failed\n```",
    "created_at": "2017-07-13T10:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355951",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
This triggers some problem here:

```
sage -t --long src/sage/structure/parent.pyx  # 6 doctests failed
```



---

archive/issue_comments_355952.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt seems that the morphisms from Sets take over the morphisms from Rings..",
    "created_at": "2017-07-13T11:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355952",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
It seems that the morphisms from Sets take over the morphisms from Rings..



---

archive/issue_comments_355953.json:
```json
{
    "body": "<a id='comment:5'></a>\nFailures are related to this:\n\n```\nsage: x = QQ['x'].0\nsage: t = abs(ZZ.random_element(10^6))\nsage: K = NumberField(x^2 + 2*3*7*11, \"a\"+str(t))\nsage: a = K.gen()\n\nsage: Hom(K, a.matrix().parent())\nSet of Morphisms from Number Field in a791947 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field in Category of infinite rings\n<class 'sage.categories.homset.Homset_with_category'>\n```\ncompared to vanilla Sage:\n\n```\nsage: Hom(K, a.matrix().parent())\nSet of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field\nsage: type(Hom(K, a.matrix().parent()))\n<class 'sage.rings.homset.RingHomset_generic_with_category'>\n```\n\nThis differences comes from the fact that the category becomes a join category (in the branch) because that is the meet category computed by `Hom`:\n\n```\nsage: K.category()._meet_(a.matrix().parent().category())\nCategory of infinite rings\nsage: type(_)\n<class 'sage.categories.category.JoinCategory_with_category'>\n```\nversus vanilla:\n\n```\nsage: K.category()._meet_(a.matrix().parent().category())\nCategory of rings\nsage: type(_)\n<class 'sage.categories.rings.Rings_with_category'>\n```\nNow, `K` is not a subclass of the meet category's `parent_class`, which causes the `Cat.parent_class._Hom_` method to now raise an error:\n\n```\nsage: Cat = K.category()._meet_(a.matrix().parent().category())\nsage: Cat.parent_class\n<class 'sage.categories.category.JoinCategory.parent_class'>\nsage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-6-aa7f8d9cdf73> in <module>()\n----> 1 Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\nTypeError: unbound method _Hom_() must be called with JoinCategory.parent_class instance as first argument (got NumberField_quadratic_with_category instance instead)\n```\nversus vanilla\n\n```\nsage: Cat = K.category()._meet_(a.matrix().parent().category())\nsage: Cat.parent_class\n<class 'sage.categories.rings.Rings.parent_class'>\nsage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)\nSet of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field\n```",
    "created_at": "2017-08-30T21:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355953",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Failures are related to this:

```
sage: x = QQ['x'].0
sage: t = abs(ZZ.random_element(10^6))
sage: K = NumberField(x^2 + 2*3*7*11, "a"+str(t))
sage: a = K.gen()

sage: Hom(K, a.matrix().parent())
Set of Morphisms from Number Field in a791947 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field in Category of infinite rings
<class 'sage.categories.homset.Homset_with_category'>
```
compared to vanilla Sage:

```
sage: Hom(K, a.matrix().parent())
Set of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field
sage: type(Hom(K, a.matrix().parent()))
<class 'sage.rings.homset.RingHomset_generic_with_category'>
```

This differences comes from the fact that the category becomes a join category (in the branch) because that is the meet category computed by `Hom`:

```
sage: K.category()._meet_(a.matrix().parent().category())
Category of infinite rings
sage: type(_)
<class 'sage.categories.category.JoinCategory_with_category'>
```
versus vanilla:

```
sage: K.category()._meet_(a.matrix().parent().category())
Category of rings
sage: type(_)
<class 'sage.categories.rings.Rings_with_category'>
```
Now, `K` is not a subclass of the meet category's `parent_class`, which causes the `Cat.parent_class._Hom_` method to now raise an error:

```
sage: Cat = K.category()._meet_(a.matrix().parent().category())
sage: Cat.parent_class
<class 'sage.categories.category.JoinCategory.parent_class'>
sage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-6-aa7f8d9cdf73> in <module>()
----> 1 Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
TypeError: unbound method _Hom_() must be called with JoinCategory.parent_class instance as first argument (got NumberField_quadratic_with_category instance instead)
```
versus vanilla

```
sage: Cat = K.category()._meet_(a.matrix().parent().category())
sage: Cat.parent_class
<class 'sage.categories.rings.Rings.parent_class'>
sage: Cat.parent_class._Hom_(K, a.matrix().parent(), Cat)
Set of Homomorphisms from Number Field in a395598 with defining polynomial x^2 + 462 to Full MatrixSpace of 2 by 2 dense matrices over Rational Field
```



---

archive/issue_comments_355954.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)\" to \"[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)\".",
    "created_at": "2017-09-21T09:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355954",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/chapoton/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418)" to "[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)".



---

archive/issue_comments_355955.json:
```json
{
    "body": "<a id='comment:6'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866\">ba2ec5b</a></td><td><code>Merge commit '2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df' in 8.1.b5</code></td></tr></table>\n",
    "created_at": "2017-09-21T09:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355955",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866">ba2ec5b</a></td><td><code>Merge commit '2f98551bf0aa8fc99f98cf2cdecf2fdaf584e5df' in 8.1.b5</code></td></tr></table>




---

archive/issue_comments_355956.json:
```json
{
    "body": "**Changing commit** from \"[a06ebbcba1804cbc7bbf0f4cb347b1a022c27335](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)\" to \"[ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)\".",
    "created_at": "2017-09-21T09:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355956",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[a06ebbcba1804cbc7bbf0f4cb347b1a022c27335](https://github.com/sagemath/sagetrac-mirror/commit/a06ebbcba1804cbc7bbf0f4cb347b1a022c27335)" to "[ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)".



---

archive/issue_comments_355957.json:
```json
{
    "body": "**Changing commit** from \"[ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)\" to \"[4e88b49d6818f5ef6abd61900a6e23024f576121](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)\".",
    "created_at": "2017-09-21T09:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866](https://github.com/sagemath/sagetrac-mirror/commit/ba2ec5b2b3f1f5001541fcfeaea9597d4acc7866)" to "[4e88b49d6818f5ef6abd61900a6e23024f576121](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)".



---

archive/issue_comments_355958.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121\">4e88b49</a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2017-09-21T09:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121">4e88b49</a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_355959.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd\">6d3e532</a></td><td><code>trac 23418 fix</code></td></tr></table>\n",
    "created_at": "2017-09-21T11:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd">6d3e532</a></td><td><code>trac 23418 fix</code></td></tr></table>




---

archive/issue_comments_355960.json:
```json
{
    "body": "**Changing commit** from \"[4e88b49d6818f5ef6abd61900a6e23024f576121](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)\" to \"[6d3e53209220b9d5132a2eaa583e14306c3d92fd](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)\".",
    "created_at": "2017-09-21T11:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4e88b49d6818f5ef6abd61900a6e23024f576121](https://github.com/sagemath/sagetrac-mirror/commit/4e88b49d6818f5ef6abd61900a6e23024f576121)" to "[6d3e53209220b9d5132a2eaa583e14306c3d92fd](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)".



---

archive/issue_comments_355961.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Vincent Delecroix\".",
    "created_at": "2017-12-31T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355961",
    "user": "https://github.com/videlec"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Vincent Delecroix".



---

archive/issue_comments_355962.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n and the same for QQ of course\n+\n+follow up at #24432\n``````\n",
    "created_at": "2017-12-31T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355962",
    "user": "https://github.com/videlec"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 and the same for QQ of course
+
+follow up at #24432
``````




---

archive/issue_events_212286.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212286"
}
```



---

archive/issue_comments_355963.json:
```json
{
    "body": "**Changing commit** from \"[6d3e53209220b9d5132a2eaa583e14306c3d92fd](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)\" to \"[d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)\".",
    "created_at": "2017-12-31T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355963",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[6d3e53209220b9d5132a2eaa583e14306c3d92fd](https://github.com/sagemath/sagetrac-mirror/commit/6d3e53209220b9d5132a2eaa583e14306c3d92fd)" to "[d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)".



---

archive/issue_comments_355964.json:
```json
{
    "body": "<a id='comment:9'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923\">d2bf048</a></td><td><code>23418: number fields are infinite</code></td></tr></table>\n",
    "created_at": "2017-12-31T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355964",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923">d2bf048</a></td><td><code>23418: number fields are infinite</code></td></tr></table>




---

archive/issue_events_212287.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212287"
}
```



---

archive/issue_events_212288.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-31T13:19:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212288"
}
```



---

archive/issue_comments_355965.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)\" to \"[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)\".",
    "created_at": "2017-12-31T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355965",
    "user": "https://github.com/videlec"
}
```

**Changing branch** from "[u/chapoton/23418_bare](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23418_bare)" to "[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)".



---

archive/issue_comments_355966.json:
```json
{
    "body": "<a id='comment:10'></a>\nthe problem from [This is the Trac macro *comment:5* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:5-macro) is solved in `d2bf048` via\n\n```diff\n--- a/src/sage/categories/homset.py\n+++ b/src/sage/categories/homset.py\n@@ -402,7 +402,7 @@ def Hom(X, Y, category=None, check=True):\n                 #   will be called twice.\n                 # - This is bound to fail if X is an extension type and\n                 #   does not actually inherit from category.parent_class\n-                H = category.parent_class._Hom_(X, Y, category = category)\n+                H = X.category().parent_class._Hom_(X, Y, category = category)\n             except (AttributeError, TypeError):\n                 # By default, construct a plain homset.\n                 H = Homset(X, Y, category = category, check=check)\n```",
    "created_at": "2017-12-31T13:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355966",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
the problem from [This is the Trac macro *comment:5* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:5-macro) is solved in `d2bf048` via

```diff
--- a/src/sage/categories/homset.py
+++ b/src/sage/categories/homset.py
@@ -402,7 +402,7 @@ def Hom(X, Y, category=None, check=True):
                 #   will be called twice.
                 # - This is bound to fail if X is an extension type and
                 #   does not actually inherit from category.parent_class
-                H = category.parent_class._Hom_(X, Y, category = category)
+                H = X.category().parent_class._Hom_(X, Y, category = category)
             except (AttributeError, TypeError):
                 # By default, construct a plain homset.
                 H = Homset(X, Y, category = category, check=check)
```



---

archive/issue_comments_355967.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322\">a632bf6</a></td><td><code>23418: number fields are infinite</code></td></tr></table>\n",
    "created_at": "2017-12-31T14:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322">a632bf6</a></td><td><code>23418: number fields are infinite</code></td></tr></table>




---

archive/issue_comments_355968.json:
```json
{
    "body": "**Changing commit** from \"[d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)\" to \"[a632bf6ffe46d7cdb412a4504200e047e5852322](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)\".",
    "created_at": "2017-12-31T14:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923](https://github.com/sagemath/sagetrac-mirror/commit/d2bf048cc8da72b16e8c020d8c5fb6aa3b9ee923)" to "[a632bf6ffe46d7cdb412a4504200e047e5852322](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)".



---

archive/issue_comments_355969.json:
```json
{
    "body": "<a id='comment:12'></a>\nLooks good to me. Maybe Travis can confirm ?",
    "created_at": "2017-12-31T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355969",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
Looks good to me. Maybe Travis can confirm ?



---

archive/issue_events_212289.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-31T22:49:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212289"
}
```



---

archive/issue_events_212290.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-31T22:49:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212290"
}
```



---

archive/issue_comments_355970.json:
```json
{
    "body": "<a id='comment:13'></a>\nNo, I don't think this is correct because now it ignores the `category` input, and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`). So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?",
    "created_at": "2017-12-31T22:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355970",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
No, I don't think this is correct because now it ignores the `category` input, and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`). So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?



---

archive/issue_comments_355971.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A13):\n> No, I don't think this is correct because now it ignores the `category` input\n\n\nStrictly speaking it does not, since the `category` argument is passed in the call\n\n```\nH = X.category().parent_class._Hom_(X, Y, category = category)\n```\n\n> and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\n\nDo you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\n> So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?\n\n\nAs you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent). Before doing my \"cheap fix\", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?\n\nIf you agree with the above, there are two concrete ways of doing this:\n- let my cheap fix pass and remove line 405 afterwards\n- remove line 405 in a dependency ticket",
    "created_at": "2018-01-01T10:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355971",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A13):
> No, I don't think this is correct because now it ignores the `category` input


Strictly speaking it does not, since the `category` argument is passed in the call

```
H = X.category().parent_class._Hom_(X, Y, category = category)
```

> and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).


Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).

> So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?


As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent). Before doing my "cheap fix", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?

If you agree with the above, there are two concrete ways of doing this:
- let my cheap fix pass and remove line 405 afterwards
- remove line 405 in a dependency ticket



---

archive/issue_comments_355972.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [vdelecroix](#comment%3A14):\n> Replying to [tscrim](#comment%3A13):\n> > No, I don't think this is correct because now it ignores the `category` input\n\n> \n> Strictly speaking it does not, since the `category` argument is passed in the call\n> \n> ```\n> H = X.category().parent_class._Hom_(X, Y, category = category)\n> ```\n\n\nNo, `_Hom_` ignores the category input.\n\n> > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\n> \n> Do you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\n\nNo, your hack is creating new problems. For example, suppose `X` is an algebra with:\n\n- basis `{a, b}`,\n- multiplication `a^2 = b^2 = ab = a`.\n\nIf we want to construct a map `f: X -> X` given by `a,b |-> b`. This is not an algebra morphism, but instead only a module morphism. If we have `Algebras._Hom_`, which expects the category to be algebras (as it should), then this will break horribly and there is no way to use a `Modules._Hom_` (assuming it is also implemented).\n\nFor an example where this is currently implemented, we can replace `Algebras` with `HighestWeightCrystals` and `Modules` with `Crystals`. I have also constructed similar morphisms as above for my research.\n\n> > So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?\n\n> \n> As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent).\n\n\nI am not sure this would be the same behavior. There are two different things going on:\n\n1. If a parent does not implement a `_Hom_` method, then it should fall back to the specified category. Continuing my above example, this would only default to `Algebras._Hom_`, which would be wrong.\n2. The other behavior is if the homset returned by `X._Hom_` does not support the more general category, say, because it takes advantage of the extra structure (say, is only uses the algebra generating set and not the [possibly infinite] basis). One should expect that `X.category()._Hom_` would also take advantage of that extra structure as well and would similarly forbid more general categories.\n\n> Before doing my \"cheap fix\", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?\n\n\nIt doesn't make sense to me for the parent/category implementation of `_Hom_` to do super calls when something fails. I think it would create a lot of redundant logic (the error handling). Also, everything in between `X.category()` and the specified `category` would likely (needlessly) fail, making these calls significantly slower when there is a large category difference. While this is a solution, I think it is a very bad solution.\n\nI think special handling the join categories is going to be the proper fix as join categories are somewhat special in the category framework. While it may be just fixing the symptoms, it does not have the drawbacks that the other approaches have. I will push something today.",
    "created_at": "2018-01-02T18:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355972",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
Replying to [vdelecroix](#comment%3A14):
> Replying to [tscrim](#comment%3A13):
> > No, I don't think this is correct because now it ignores the `category` input

> 
> Strictly speaking it does not, since the `category` argument is passed in the call
> 
> ```
> H = X.category().parent_class._Hom_(X, Y, category = category)
> ```


No, `_Hom_` ignores the category input.

> > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).

> 
> Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).


No, your hack is creating new problems. For example, suppose `X` is an algebra with:

- basis `{a, b}`,
- multiplication `a^2 = b^2 = ab = a`.

If we want to construct a map `f: X -> X` given by `a,b |-> b`. This is not an algebra morphism, but instead only a module morphism. If we have `Algebras._Hom_`, which expects the category to be algebras (as it should), then this will break horribly and there is no way to use a `Modules._Hom_` (assuming it is also implemented).

For an example where this is currently implemented, we can replace `Algebras` with `HighestWeightCrystals` and `Modules` with `Crystals`. I have also constructed similar morphisms as above for my research.

> > So this change is a regression in my mind because the Homset classes do not have the inheritance of the categories. (In fact, in some ways, the error is *because* of this desired behavior.) Perhaps what we can do is do something special for join categories and testing its `super_categories`?

> 
> As you might have noticed, the call line 405 in `categories/homset.py` is already hackish. Parents implementing their own `_Hom_` method should by themselves call a super (or equivalent).


I am not sure this would be the same behavior. There are two different things going on:

1. If a parent does not implement a `_Hom_` method, then it should fall back to the specified category. Continuing my above example, this would only default to `Algebras._Hom_`, which would be wrong.
2. The other behavior is if the homset returned by `X._Hom_` does not support the more general category, say, because it takes advantage of the extra structure (say, is only uses the algebra generating set and not the [possibly infinite] basis). One should expect that `X.category()._Hom_` would also take advantage of that extra structure as well and would similarly forbid more general categories.

> Before doing my "cheap fix", I thought that the good solution would be to remove this line 405 and fix the parents. Do you agree that this would be **the** solution?


It doesn't make sense to me for the parent/category implementation of `_Hom_` to do super calls when something fails. I think it would create a lot of redundant logic (the error handling). Also, everything in between `X.category()` and the specified `category` would likely (needlessly) fail, making these calls significantly slower when there is a large category difference. While this is a solution, I think it is a very bad solution.

I think special handling the join categories is going to be the proper fix as join categories are somewhat special in the category framework. While it may be just fixing the symptoms, it does not have the drawbacks that the other approaches have. I will push something today.



---

archive/issue_comments_355973.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [tscrim](#comment%3A15):\n> Replying to [vdelecroix](#comment%3A14):\n> > Replying to [tscrim](#comment%3A13):\n> > > No, I don't think this is correct because now it ignores the `category` input\n\n> > \n> > Strictly speaking it does not, since the `category` argument is passed in the call\n> > \n> > ```\n> > H = X.category().parent_class._Hom_(X, Y, category = category)\n> > ```\n\n> \n> No, `_Hom_` ignores the category input.\n> \n> > > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).\n\n> > \n> > Do you have any example of this? I might understand the objection, but my \"cheap fix\" is indeed fixing problems and not creating new ones (as far as doctesting is complete).\n\n> \n> No, your hack is creating new problems. [SNIP]\n\n\nThis would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.\n \n>>> So this change is a regression [...]\n\n> I will push something today.\n\nThanks! You might want to use another ticket or update the description of this one.",
    "created_at": "2018-01-02T20:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355973",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Replying to [tscrim](#comment%3A15):
> Replying to [vdelecroix](#comment%3A14):
> > Replying to [tscrim](#comment%3A13):
> > > No, I don't think this is correct because now it ignores the `category` input

> > 
> > Strictly speaking it does not, since the `category` argument is passed in the call
> > 
> > ```
> > H = X.category().parent_class._Hom_(X, Y, category = category)
> > ```

> 
> No, `_Hom_` ignores the category input.
> 
> > > and there might be a situation where this works with `category` being passed in (say, `Modules()` instead of `Algebras()`).

> > 
> > Do you have any example of this? I might understand the objection, but my "cheap fix" is indeed fixing problems and not creating new ones (as far as doctesting is complete).

> 
> No, your hack is creating new problems. [SNIP]


This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.
 
>>> So this change is a regression [...]

> I will push something today.

Thanks! You might want to use another ticket or update the description of this one.



---

archive/issue_comments_355974.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [vdelecroix](#comment%3A16):\n> This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.\n\n\nI believe I have a concrete example and will add it.\n\n> >>> So this change is a regression [...]\n\n> > I will push something today.\n> \n> Thanks! You might want to use another ticket or update the description of this one.\n\n\nNo problem. Thanks for your work on this.",
    "created_at": "2018-01-03T00:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355974",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
Replying to [vdelecroix](#comment%3A16):
> This would better be doctested! Could you come up with concrete examples to be added to the branch? Especially because we are going to play with the `_Hom_` code.


I believe I have a concrete example and will add it.

> >>> So this change is a regression [...]

> > I will push something today.
> 
> Thanks! You might want to use another ticket or update the description of this one.


No problem. Thanks for your work on this.



---

archive/issue_comments_355975.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)\" to \"[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)\".",
    "created_at": "2018-01-03T07:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355975",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/vdelecroix/23418](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/23418)" to "[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)".



---

archive/issue_comments_355976.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-01-03T07:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355976",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_355977.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-and the same for QQ of course\n+and the same for QQ of course.\n \n-follow up at #24432\n+This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.\n+\n+Follow up at #24432.\n``````\n",
    "created_at": "2018-01-03T07:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355977",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-and the same for QQ of course
+and the same for QQ of course.
 
-follow up at #24432
+This fixes a bug with `Hom` where the meet computed is a join category, in which case `X` is not a subclass of `category.parent_class`. This causes problems with the number fields meeting with matrix spaces.
+
+Follow up at #24432.
``````




---

archive/issue_comments_355978.json:
```json
{
    "body": "<a id='comment:18'></a>\nActually, from looking at it and thinking about it more, the category of highest weight crystals is a full subcategory, so it does not quite work (in contrast to algebras and modules). So instead I just manufactured a minimal example that fails with your change.\n\nHere is a branch that does special handling of `JoinCategory`. It passes all the tests that were previously failing.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39b05604d470fb73084270c746c4aca61e63f48b\">39b0560</a></td><td><code>Merge branch 'u/vdelecroix/23418' of git://trac.sagemath.org/sage into public/number_fields/in_infinite_fields-23418</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cdbc67dafaa65dc2de3cc81c57ef17a0e5b1e209\">cdbc67d</a></td><td><code>Reverting change and adding test showing the behavior.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8\">b7f3fa6</a></td><td><code>Special handling of the join categories for Hom.</code></td></tr></table>\n",
    "created_at": "2018-01-03T07:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355978",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Actually, from looking at it and thinking about it more, the category of highest weight crystals is a full subcategory, so it does not quite work (in contrast to algebras and modules). So instead I just manufactured a minimal example that fails with your change.

Here is a branch that does special handling of `JoinCategory`. It passes all the tests that were previously failing.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39b05604d470fb73084270c746c4aca61e63f48b">39b0560</a></td><td><code>Merge branch 'u/vdelecroix/23418' of git://trac.sagemath.org/sage into public/number_fields/in_infinite_fields-23418</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cdbc67dafaa65dc2de3cc81c57ef17a0e5b1e209">cdbc67d</a></td><td><code>Reverting change and adding test showing the behavior.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8">b7f3fa6</a></td><td><code>Special handling of the join categories for Hom.</code></td></tr></table>




---

archive/issue_comments_355979.json:
```json
{
    "body": "**Changing commit** from \"[a632bf6ffe46d7cdb412a4504200e047e5852322](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)\" to \"[b7f3fa69fae7ca1119968e2805230a67d60c21d8](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)\".",
    "created_at": "2018-01-03T07:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355979",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[a632bf6ffe46d7cdb412a4504200e047e5852322](https://github.com/sagemath/sagetrac-mirror/commit/a632bf6ffe46d7cdb412a4504200e047e5852322)" to "[b7f3fa69fae7ca1119968e2805230a67d60c21d8](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)".



---

archive/issue_events_212291.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-03T07:32:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212291"
}
```



---

archive/issue_events_212292.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-03T07:32:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212292"
}
```



---

archive/issue_comments_355980.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe following loop is randomly choosing the last working call.\n\n```\nfor C in cats:\n    try:\n        H = C.parent_class._Hom_(X, Y, category=category)\n    except (AttributeError, TypeError):\n        pass\n```\nIf you want to keep this hack, wouldn't it be better this way\n\n```\nfor C in cats:\n    try:\n        H = C.parent_class._Hom_(X, Y, category=category)\n    except (AttributeError, TypeError):\n        pass\n    else:\n        break\n```",
    "created_at": "2018-01-03T15:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355980",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
The following loop is randomly choosing the last working call.

```
for C in cats:
    try:
        H = C.parent_class._Hom_(X, Y, category=category)
    except (AttributeError, TypeError):
        pass
```
If you want to keep this hack, wouldn't it be better this way

```
for C in cats:
    try:
        H = C.parent_class._Hom_(X, Y, category=category)
    except (AttributeError, TypeError):
        pass
    else:
        break
```



---

archive/issue_comments_355981.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb\">bf01aa1</a></td><td><code>Break out once H is found.</code></td></tr></table>\n",
    "created_at": "2018-01-03T16:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355981",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb">bf01aa1</a></td><td><code>Break out once H is found.</code></td></tr></table>




---

archive/issue_comments_355982.json:
```json
{
    "body": "**Changing commit** from \"[b7f3fa69fae7ca1119968e2805230a67d60c21d8](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)\" to \"[bf01aa19df338890295dfe5ac99a1a300399f1cb](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)\".",
    "created_at": "2018-01-03T16:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355982",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b7f3fa69fae7ca1119968e2805230a67d60c21d8](https://github.com/sagemath/sagetrac-mirror/commit/b7f3fa69fae7ca1119968e2805230a67d60c21d8)" to "[bf01aa19df338890295dfe5ac99a1a300399f1cb](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)".



---

archive/issue_comments_355983.json:
```json
{
    "body": "<a id='comment:21'></a>\nGood point; fixed.",
    "created_at": "2018-01-03T16:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355983",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Good point; fixed.



---

archive/issue_comments_355984.json:
```json
{
    "body": "<a id='comment:22'></a>\nGreen bot.",
    "created_at": "2018-01-12T18:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355984",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
Green bot.



---

archive/issue_events_212293.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-12T19:17:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212293"
}
```



---

archive/issue_events_212294.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-12T19:17:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212294"
}
```



---

archive/issue_comments_355985.json:
```json
{
    "body": "<a id='comment:23'></a>\nSorry to have forgotten!",
    "created_at": "2018-01-12T19:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355985",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Sorry to have forgotten!



---

archive/issue_events_212295.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T13:14:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212295"
}
```



---

archive/issue_events_212296.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T13:14:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212296"
}
```



---

archive/issue_comments_355986.json:
```json
{
    "body": "<a id='comment:24'></a>\n\n```\ngit reset --hard Hsage -t --long --warn-long 69.0 src/sage/structure/parent.pyx\n**********************************************************************\nFile \"src/sage/structure/parent.pyx\", line 1855, in sage.structure.parent.Parent.hom._generic_coerce_map\nFailed example:\n    QQ['x', 'y']._generic_coerce_map(QQ).category_for()\nExpected:\n    Category of unique factorization domains\nGot:\n    Category of infinite unique factorization domains\nEAD~\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.structure.parent.Parent.hom._generic_coerce_map\n    [407 tests, 1 failure, 3.07 s]\n```",
    "created_at": "2018-01-14T13:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355986",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>

```
git reset --hard Hsage -t --long --warn-long 69.0 src/sage/structure/parent.pyx
**********************************************************************
File "src/sage/structure/parent.pyx", line 1855, in sage.structure.parent.Parent.hom._generic_coerce_map
Failed example:
    QQ['x', 'y']._generic_coerce_map(QQ).category_for()
Expected:
    Category of unique factorization domains
Got:
    Category of infinite unique factorization domains
EAD~
**********************************************************************
1 item had failures:
   1 of   4 in sage.structure.parent.Parent.hom._generic_coerce_map
    [407 tests, 1 failure, 3.07 s]
```



---

archive/issue_comments_355987.json:
```json
{
    "body": "<a id='comment:25'></a>\nI cannot reproduce this locally, so we might have to wait for the next beta. The doctest failure output should be the correct output. Yet, the test after it should probably also be `Category of infinite euclidean domains`, so something subtle might be going on too...",
    "created_at": "2018-01-15T16:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355987",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>
I cannot reproduce this locally, so we might have to wait for the next beta. The doctest failure output should be the correct output. Yet, the test after it should probably also be `Category of infinite euclidean domains`, so something subtle might be going on too...



---

archive/issue_comments_355988.json:
```json
{
    "body": "**Changing commit** from \"[bf01aa19df338890295dfe5ac99a1a300399f1cb](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)\" to \"[2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)\".",
    "created_at": "2018-01-19T19:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bf01aa19df338890295dfe5ac99a1a300399f1cb](https://github.com/sagemath/sagetrac-mirror/commit/bf01aa19df338890295dfe5ac99a1a300399f1cb)" to "[2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)".



---

archive/issue_comments_355989.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2714d242fef4817d9ec6737c1a2c7c9b4d3c8d17\">2714d24</a></td><td><code>Merge branch 'public/number_fields/in_infinite_fields-23418' in 8.2.b3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738\">2008ba1</a></td><td><code>fix doctest</code></td></tr></table>\n",
    "created_at": "2018-01-19T19:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2714d242fef4817d9ec6737c1a2c7c9b4d3c8d17">2714d24</a></td><td><code>Merge branch 'public/number_fields/in_infinite_fields-23418' in 8.2.b3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738">2008ba1</a></td><td><code>fix doctest</code></td></tr></table>




---

archive/issue_events_212297.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-19T19:21:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212297"
}
```



---

archive/issue_events_212298.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-19T19:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212298"
}
```



---

archive/issue_comments_355990.json:
```json
{
    "body": "<a id='comment:27'></a>\nI fixed the doctest",
    "created_at": "2018-01-19T19:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355990",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
I fixed the doctest



---

archive/issue_comments_355991.json:
```json
{
    "body": "<a id='comment:28'></a>\nSo the failure was because of #24413, whereas the second test would need a similar treatment for power series rings. This is good enough for now.",
    "created_at": "2018-01-20T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355991",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
So the failure was because of #24413, whereas the second test would need a similar treatment for power series rings. This is good enough for now.



---

archive/issue_events_212299.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-20T06:20:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212299"
}
```



---

archive/issue_events_212300.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-01-20T06:20:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212300"
}
```



---

archive/issue_events_212301.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-20T20:20:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212301"
}
```



---

archive/issue_events_212302.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-20T20:20:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23418#event-212302"
}
```



---

archive/issue_comments_355992.json:
```json
{
    "body": "**Changing branch** from \"[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)\" to \"[2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)\".",
    "created_at": "2018-01-20T20:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23418",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23418#issuecomment-355992",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/number_fields/in_infinite_fields-23418](https://github.com/sagemath/sagetrac-mirror/tree/public/number_fields/in_infinite_fields-23418)" to "[2008ba1318c182056afdf860f2064f66d603d738](https://github.com/sagemath/sagetrac-mirror/commit/2008ba1318c182056afdf860f2064f66d603d738)".
