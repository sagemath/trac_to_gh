# Issue 23601: Gammoids

archive/issues_023364.json:
```json
{
    "body": "Implement gammoids using digraphs for data. These will use transversal matroids for taking minors or duals.\n\nCC:  zgershkoff stefan @tscrim\n\nAuthor: Zachary Gershkoff\n\nBranch: u/zgershkoff/gammoids\n\nStatus: needs_work\n\nCommit: 0d916eb7e5f14c19ebba052d2450a46cb3d1700c\n\nIssue created by migration from https://trac.sagemath.org/ticket/23601\n\n",
    "created_at": "2017-08-08T22:27:28Z",
    "labels": [
        "component: matroid theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Gammoids",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23601",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```
Implement gammoids using digraphs for data. These will use transversal matroids for taking minors or duals.

CC:  zgershkoff stefan @tscrim

Author: Zachary Gershkoff

Branch: u/zgershkoff/gammoids

Status: needs_work

Commit: 0d916eb7e5f14c19ebba052d2450a46cb3d1700c

Issue created by migration from https://trac.sagemath.org/ticket/23601





---

archive/issue_comments_348097.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-08T23:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348098.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to matroid theory.",
    "created_at": "2017-08-08T23:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348098",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing component from PLEASE CHANGE to matroid theory.



---

archive/issue_comments_348099.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+Implement gammoids using digraphs for data. These will use transversal matroids for taking minors or duals.\n \n Comment: 1\n \n```\n",
    "created_at": "2017-08-08T23:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348099",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+Implement gammoids using digraphs for data. These will use transversal matroids for taking minors or duals.
 
 Comment: 1
 
```




---

archive/issue_comments_348100.json:
```json
{
    "body": "<a id='comment:3'></a>It has a working rank function. I think the hard part will be minors from contraction.",
    "created_at": "2017-08-08T23:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348100",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:3'></a>It has a working rank function. I think the hard part will be minors from contraction.



---

archive/issue_comments_348101.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-08-08T23:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348101",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_348102.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-17T23:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348103.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-17T23:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348104.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-20T19:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348105.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-25T18:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348106.json:
```json
{
    "body": "<a id='comment:8'></a>That should be everything it needs right now.",
    "created_at": "2017-08-25T18:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348106",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:8'></a>That should be everything it needs right now.



---

archive/issue_comments_348107.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-25T18:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348107",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348108.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-27T02:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348109.json:
```json
{
    "body": "<a id='comment:10'></a>This looks fairly good, but I noticed a few issues:\n\n- this is not merging cleanly with the latest development version, so you'll have to merge and resolve the conflict.\n\n- The class documentation might explain \"linked into\", or point to a reference.\n\n- the import of `newlabel` does not appear to be needed.\n\n- the imports `from copy import copy, deepcopy` are not needed either.\n\n- The constructor should perhaps check that input `D` is in fact a digraph, or can be coerced to one.  For example, I might be surprised by\n\n```\nsage: G = graphs.CompleteGraph(3)\nsage: g = Gammoid(G, roots=[1]); g\nGammoid of rank 1 on 3 elements\nsage: g.digraph().edges()\n[(0, 1, None), (0, 2, None), (1, 2, None)]\nsage: list(g.bases())\n[frozenset({0}), frozenset({1})]\n```\nI might have expected the Gammoid derived from graph G to have bases {2} as well.  The edge list seems to have arbitrarily directed the edges of G.  For another example `Gammoid(ZZ, roots=[])` raises a messy attribute error.\n- Why doesn't _prune_vertices_ remove *all* irrelevant vertices?  And why is it not faster on bad examples?  Consider these timings with the existing code:\n\n```\nsage: d = digraphs.Circulant(201, [1, 59, 100])\nsage: %timeit Gammoid(d+digraphs.Path(1000), roots=[1,50,100,153], groundset=d.vertices())\n1 loop, best of 3: 580 ms per loop\nsage: %timeit Gammoid(d+digraphs.Path(2000), roots=[1,50,100,153], groundset=d.vertices())\n1 loop, best of 3: 1.96 s per loop\nsage: %timeit Gammoid(d+digraphs.Path(3000), roots=[1,50,100,153], groundset=d.vertices())\n1 loop, best of 3: 4.17 s per loop\n```\nHere's one way to be more thorough, and faster in these cases\n\n```\n        V = set(self._D.vertices()).difference(self._groundset)\n        if len(V) == 0:\n            return\n        v = self._D.add_vertex()\n        self._D.add_edges( (v,u) for u in self._groundset)\n        self._D.add_edges( (u,v) for u in self._roots)\n        c = self._D.strongly_connected_component_containing_vertex(v)\n        self._D.delete_vertices(V.difference(c))\n        self._D.delete_vertex(v)\n```\nNew timings:\n\n```\nsage: %timeit Gammoid(d+digraphs.Path(1000), roots=[1,50,100,153], groundset=d.vertices())\n10 loops, best of 3: 19.3 ms per loop\nsage: \nsage: %timeit Gammoid(d+digraphs.Path(2000), roots=[1,50,100,153], groundset=d.vertices())\n10 loops, best of 3: 39.7 ms per loop\nsage: %timeit Gammoid(d+digraphs.Path(3000), roots=[1,50,100,153], groundset=d.vertices())\n10 loops, best of 3: 72.4 ms per loop\n```\nAnd here's a case that, while slightly slower, the new code is more accurate in pruning.  First, with the original code:\n\n```\n%timeit Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())\n10 loops, best of 3: 49.1 ms per loop\n\nsage: g = Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())\nsage: g.digraph()\nDigraph on 3201 vertices\n```\nand with the new code\n\n```\n%timeit Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())\n10 loops, best of 3: 70 ms per loop\n\nsage: g = Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())\nsage: g.digraph()\nDigraph on 201 vertices\n```\nThe new code could be better, for example, also deleting roots if they are unreachable from the groundset, and there are of course other ways to code up the pruning.\n\n- the \"red\" colour #D55E00 looks more orange than red, to me.\n\n- every minor of a gammoid is a gammoid.  Why not have `_minor_` recognize that?\n\n- `_minor_` should have a few more test cases; there are 4 paths through the code and they could all be tested.\n\n- In the documentation for `gammoid_extension` you refer to the \"starting set\" and a \"source vertex\".  These are new terms not appearing the documentation of the class or constructor.  The documentation for the parameters does better.\n\n- The documentation for `gammoid extension` could be clearer on what it accomplishes.  Is every matroid extension of a gammoid that results in another gammoid obtained in this way?",
    "created_at": "2017-09-18T16:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348109",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

<a id='comment:10'></a>This looks fairly good, but I noticed a few issues:

- this is not merging cleanly with the latest development version, so you'll have to merge and resolve the conflict.

- The class documentation might explain "linked into", or point to a reference.

- the import of `newlabel` does not appear to be needed.

- the imports `from copy import copy, deepcopy` are not needed either.

- The constructor should perhaps check that input `D` is in fact a digraph, or can be coerced to one.  For example, I might be surprised by

```
sage: G = graphs.CompleteGraph(3)
sage: g = Gammoid(G, roots=[1]); g
Gammoid of rank 1 on 3 elements
sage: g.digraph().edges()
[(0, 1, None), (0, 2, None), (1, 2, None)]
sage: list(g.bases())
[frozenset({0}), frozenset({1})]
```
I might have expected the Gammoid derived from graph G to have bases {2} as well.  The edge list seems to have arbitrarily directed the edges of G.  For another example `Gammoid(ZZ, roots=[])` raises a messy attribute error.
- Why doesn't _prune_vertices_ remove *all* irrelevant vertices?  And why is it not faster on bad examples?  Consider these timings with the existing code:

```
sage: d = digraphs.Circulant(201, [1, 59, 100])
sage: %timeit Gammoid(d+digraphs.Path(1000), roots=[1,50,100,153], groundset=d.vertices())
1 loop, best of 3: 580 ms per loop
sage: %timeit Gammoid(d+digraphs.Path(2000), roots=[1,50,100,153], groundset=d.vertices())
1 loop, best of 3: 1.96 s per loop
sage: %timeit Gammoid(d+digraphs.Path(3000), roots=[1,50,100,153], groundset=d.vertices())
1 loop, best of 3: 4.17 s per loop
```
Here's one way to be more thorough, and faster in these cases

```
        V = set(self._D.vertices()).difference(self._groundset)
        if len(V) == 0:
            return
        v = self._D.add_vertex()
        self._D.add_edges( (v,u) for u in self._groundset)
        self._D.add_edges( (u,v) for u in self._roots)
        c = self._D.strongly_connected_component_containing_vertex(v)
        self._D.delete_vertices(V.difference(c))
        self._D.delete_vertex(v)
```
New timings:

```
sage: %timeit Gammoid(d+digraphs.Path(1000), roots=[1,50,100,153], groundset=d.vertices())
10 loops, best of 3: 19.3 ms per loop
sage: 
sage: %timeit Gammoid(d+digraphs.Path(2000), roots=[1,50,100,153], groundset=d.vertices())
10 loops, best of 3: 39.7 ms per loop
sage: %timeit Gammoid(d+digraphs.Path(3000), roots=[1,50,100,153], groundset=d.vertices())
10 loops, best of 3: 72.4 ms per loop
```
And here's a case that, while slightly slower, the new code is more accurate in pruning.  First, with the original code:

```
%timeit Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())
10 loops, best of 3: 49.1 ms per loop

sage: g = Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())
sage: g.digraph()
Digraph on 3201 vertices
```
and with the new code

```
%timeit Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())
10 loops, best of 3: 70 ms per loop

sage: g = Gammoid(d+digraphs.Circuit(3000), roots=[1,50,100,153], groundset=d.vertices())
sage: g.digraph()
Digraph on 201 vertices
```
The new code could be better, for example, also deleting roots if they are unreachable from the groundset, and there are of course other ways to code up the pruning.

- the "red" colour #D55E00 looks more orange than red, to me.

- every minor of a gammoid is a gammoid.  Why not have `_minor_` recognize that?

- `_minor_` should have a few more test cases; there are 4 paths through the code and they could all be tested.

- In the documentation for `gammoid_extension` you refer to the "starting set" and a "source vertex".  These are new terms not appearing the documentation of the class or constructor.  The documentation for the parameters does better.

- The documentation for `gammoid extension` could be clearer on what it accomplishes.  Is every matroid extension of a gammoid that results in another gammoid obtained in this way?



---

archive/issue_comments_348110.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-18T16:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23601",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23601#issuecomment-348110",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

Changing status from needs_review to needs_work.
