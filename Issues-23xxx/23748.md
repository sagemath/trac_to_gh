# Issue 23748: Run doctests with limited memory

archive/issues_023511.json:
```json
{
    "body": "There are various reasons to limit the maximal amount of memory that doctests can use:\n1. Bugs which cause large memory usage and which can cause trouble for the OS when running doctests.\n2. It is good to check that doctests do not use a large amount of memory.\n3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n\nI suggest to limit the virtual memory for doctests. The following two files contain the tests which need the most memory:\n\n```\nsrc/sage/game_theory/matching_game.py\nsrc/sage/schemes/elliptic_curves/heegner.py\n```\n\nThis branch also reduces the memory needed for `matching_game.py`, such that `heegner.py` is now the doctest which requires the most memory.\n\n**Branch:** [06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/23748\n\n",
    "closed_at": "2017-09-11T13:47:16Z",
    "created_at": "2017-08-30T08:28:11Z",
    "labels": [
        "component: doctest framework",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Run doctests with limited memory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23748",
    "user": "https://github.com/jdemeyer"
}
```
There are various reasons to limit the maximal amount of memory that doctests can use:
1. Bugs which cause large memory usage and which can cause trouble for the OS when running doctests.
2. It is good to check that doctests do not use a large amount of memory.
3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.

I suggest to limit the virtual memory for doctests. The following two files contain the tests which need the most memory:

```
src/sage/game_theory/matching_game.py
src/sage/schemes/elliptic_curves/heegner.py
```

This branch also reduces the memory needed for `matching_game.py`, such that `heegner.py` is now the doctest which requires the most memory.

**Branch:** [06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)

**Reviewer:** Travis Scrimshaw

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/23748





---

archive/issue_comments_428979.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/run_doctests_with_limited_memory](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/run_doctests_with_limited_memory)",
    "created_at": "2017-08-30T14:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428979",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/run_doctests_with_limited_memory](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/run_doctests_with_limited_memory)



---

archive/issue_comments_428980.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e\">6b2589e</a></td><td><code>Run doctests with limited memory</code></td></tr></table>\n",
    "created_at": "2017-08-30T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428980",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e">6b2589e</a></td><td><code>Run doctests with limited memory</code></td></tr></table>




---

archive/issue_comments_428981.json:
```json
{
    "body": "**Commit:** [6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e](https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e)",
    "created_at": "2017-08-30T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428981",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e](https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e)



---

archive/issue_comments_428982.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-08-30T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428982",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_428983.json:
```json
{
    "body": "<a id='comment:3'></a>\nMaybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.",
    "created_at": "2017-08-30T15:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428983",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Maybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.



---

archive/issue_comments_428984.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [tscrim](#comment%3A3):\n> Maybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.\n\n\nWith 1GB, you cannot even start Sage.\n\nAnd some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.",
    "created_at": "2017-08-30T17:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428984",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Replying to [tscrim](#comment%3A3):
> Maybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.


With 1GB, you cannot even start Sage.

And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.



---

archive/issue_comments_428985.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [tscrim](#comment%3A3):\n> doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.\n\n\nThat's precisely the reason for this patch.",
    "created_at": "2017-08-30T17:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428985",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [tscrim](#comment%3A3):
> doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.


That's precisely the reason for this patch.



---

archive/issue_comments_428986.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. I suggest to find a reasonable value of `ulimit -v` and use that to limit the virtual memory taken by doctests. This is also a check that doctests do not use too large amounts of memory.\n+Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. Also, it is good to check that doctests do not use a large amount of memory.\n+\n+I suggest to limit the virtual memory for doctests to 4GiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with 3GiB.\n``````\n",
    "created_at": "2017-08-30T17:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428986",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. I suggest to find a reasonable value of `ulimit -v` and use that to limit the virtual memory taken by doctests. This is also a check that doctests do not use too large amounts of memory.
+Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. Also, it is good to check that doctests do not use a large amount of memory.
+
+I suggest to limit the virtual memory for doctests to 4GiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with 3GiB.
``````




---

archive/issue_comments_428987.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Replying to [tscrim](#comment%3A3):\n> > Maybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.\n\n> \n> With 1GB, you cannot even start Sage.\n\n\nOh, I was thinking this was the amount of memory specifically used by any particular doctest, not Sage + doctests. What about when doctests are run in parallel? Since it is using threads, we still have the same limit of 4Gb, so I am worried we will hit this limit on systems with larger amounts of cores.\n\n> And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.\n\n\nMaybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?",
    "created_at": "2017-08-30T17:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428987",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A4):
> Replying to [tscrim](#comment%3A3):
> > Maybe this should be discussed on sage-devel, but my vote would be for 1Gb as IMO, doctests should in general not use a large amount of memory similar to the paradigm that they should be fast.

> 
> With 1GB, you cannot even start Sage.


Oh, I was thinking this was the amount of memory specifically used by any particular doctest, not Sage + doctests. What about when doctests are run in parallel? Since it is using threads, we still have the same limit of 4Gb, so I am worried we will hit this limit on systems with larger amounts of cores.

> And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.


Maybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?



---

archive/issue_comments_428988.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tscrim](#comment%3A7):\n> Oh, I was thinking this was the amount of memory specifically used by any particular doctest, not Sage + doctests.\n\n\nNo, it is the virtual memory limit for the whole process. This includes code (Python + Python modules + libraries) and data, also unused but allocated memory (like the PARI stack).\n\n> What about when doctests are run in parallel? Since it is using threads\n\n\nNo! It uses processes, not threads. The limit is per process, so we do not need to worry about that.\n\n> > And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.\n\n> \n> Maybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?\n\n\nPerhaps, but this is just a very simple limit, comparable to the absolute doctest time limit of 360s (short tests) or 1800s (long tests).",
    "created_at": "2017-08-30T19:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428988",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [tscrim](#comment%3A7):
> Oh, I was thinking this was the amount of memory specifically used by any particular doctest, not Sage + doctests.


No, it is the virtual memory limit for the whole process. This includes code (Python + Python modules + libraries) and data, also unused but allocated memory (like the PARI stack).

> What about when doctests are run in parallel? Since it is using threads


No! It uses processes, not threads. The limit is per process, so we do not need to worry about that.

> > And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.

> 
> Maybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?


Perhaps, but this is just a very simple limit, comparable to the absolute doctest time limit of 360s (short tests) or 1800s (long tests).



---

archive/issue_comments_428989.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'll try to lower the limit of 4GiB somewhat, but it certainly must be higher than 3GiB.",
    "created_at": "2017-08-30T19:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428989",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I'll try to lower the limit of 4GiB somewhat, but it certainly must be higher than 3GiB.



---

archive/issue_comments_428990.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n-Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. Also, it is good to check that doctests do not use a large amount of memory.\n+There are various reasons to limit the maximal amount of memory that doctests can use:\n+1. Bugs which cause large memory usage and which can cause trouble for the OS when running doctests.\n+2. It is good to check that doctests do not use a large amount of memory.\n+3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n \n-I suggest to limit the virtual memory for doctests to 4GiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with 3GiB.\n+I suggest to limit the virtual memory for doctests to 3400MiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` need this.\n``````\n",
    "created_at": "2017-08-30T19:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428990",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
-Sometimes, due to bugs, it can happen that doctests take a very large amount of memory, causing trouble for the OS. Also, it is good to check that doctests do not use a large amount of memory.
+There are various reasons to limit the maximal amount of memory that doctests can use:
+1. Bugs which cause large memory usage and which can cause trouble for the OS when running doctests.
+2. It is good to check that doctests do not use a large amount of memory.
+3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.
 
-I suggest to limit the virtual memory for doctests to 4GiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with 3GiB.
+I suggest to limit the virtual memory for doctests to 3400MiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` need this.
``````




---

archive/issue_comments_428991.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n 2. It is good to check that doctests do not use a large amount of memory.\n 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n \n-I suggest to limit the virtual memory for doctests to 3400MiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` need this.\n+I suggest to limit the virtual memory for doctests to 3500MiB. This may seem like a lot, but note that some doctests need this.\n``````\n",
    "created_at": "2017-08-30T19:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428991",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 2. It is good to check that doctests do not use a large amount of memory.
 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.
 
-I suggest to limit the virtual memory for doctests to 3400MiB. This may seem like a lot, but note that some doctests in `src/sage/schemes/elliptic_curves/heegner.py` need this.
+I suggest to limit the virtual memory for doctests to 3500MiB. This may seem like a lot, but note that some doctests need this.
``````




---

archive/issue_comments_428992.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010\">f8fcb51</a></td><td><code>Run doctests with limited memory</code></td></tr></table>\n",
    "created_at": "2017-08-30T19:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010">f8fcb51</a></td><td><code>Run doctests with limited memory</code></td></tr></table>




---

archive/issue_comments_428993.json:
```json
{
    "body": "**Changing commit** from \"[6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e](https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e)\" to \"[f8fcb510bcbe16103fd133b868915b94e7555010](https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010)\".",
    "created_at": "2017-08-30T19:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e](https://github.com/sagemath/sagetrac-mirror/commit/6b2589ee117284cc3dc24d58beda0aa2b3aa5a0e)" to "[f8fcb510bcbe16103fd133b868915b94e7555010](https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010)".



---

archive/issue_comments_428994.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n 2. It is good to check that doctests do not use a large amount of memory.\n 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n \n-I suggest to limit the virtual memory for doctests to 3500MiB. This may seem like a lot, but note that some doctests need this.\n+I suggest to limit the virtual memory for doctests to 3600MiB. This may seem like a lot, but some doctests need this much.\n``````\n",
    "created_at": "2017-08-30T19:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428994",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 2. It is good to check that doctests do not use a large amount of memory.
 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.
 
-I suggest to limit the virtual memory for doctests to 3500MiB. This may seem like a lot, but note that some doctests need this.
+I suggest to limit the virtual memory for doctests to 3600MiB. This may seem like a lot, but some doctests need this much.
``````




---

archive/issue_comments_428995.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jdemeyer](#comment%3A8):\n> Replying to [tscrim](#comment%3A7):\n> > What about when doctests are run in parallel? Since it is using threads\n\n> \n> No! It uses processes, not threads. The limit is per process, so we do not need to worry about that.\n\n\nWe should probably change this then:\n\n```\ntravis@apricot:~/sage/src/sage/categories$ sage -tp category.py category_types.py \n[snip]\nDoctesting 2 files using 8 threads.\n```\nAlthough I am somewhat surprised my memory usage is not higher when I am running parallel tests since each copy of Sage should take a minimum of 1Gb. *shrugs*, oh well, not important.\n\n> > > And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.\n\n> > \n> > Maybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?\n\n> \n> Perhaps, but this is just a very simple limit, comparable to the absolute doctest time limit of 360s (short tests) or 1800s (long tests).\n\n\nI don't mind 4Gb, I probably prefer it over the 3.x for simplicity.",
    "created_at": "2017-08-30T21:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428995",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [jdemeyer](#comment%3A8):
> Replying to [tscrim](#comment%3A7):
> > What about when doctests are run in parallel? Since it is using threads

> 
> No! It uses processes, not threads. The limit is per process, so we do not need to worry about that.


We should probably change this then:

```
travis@apricot:~/sage/src/sage/categories$ sage -tp category.py category_types.py 
[snip]
Doctesting 2 files using 8 threads.
```
Although I am somewhat surprised my memory usage is not higher when I am running parallel tests since each copy of Sage should take a minimum of 1Gb. *shrugs*, oh well, not important.

> > > And some doctests in `src/sage/schemes/elliptic_curves/heegner.py` do not pass with a limit of only 3GB.

> > 
> > Maybe we also want to consider a `# high memory` marker (another ticket?) or have `# long time` also allow higher memory?

> 
> Perhaps, but this is just a very simple limit, comparable to the absolute doctest time limit of 360s (short tests) or 1800s (long tests).


I don't mind 4Gb, I probably prefer it over the 3.x for simplicity.



---

archive/issue_comments_428996.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,12 @@\n 2. It is good to check that doctests do not use a large amount of memory.\n 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n \n-I suggest to limit the virtual memory for doctests to 3600MiB. This may seem like a lot, but some doctests need this much.\n+I suggest to limit the virtual memory for doctests to 4500MiB. This may seem like a lot, but these doctests do not pass with a limit of 4000MiB:\n+\n+```\n+src/sage/matrix/matrix_integer_dense.pyx\n+src/sage/rings/polynomial/pbori.pyx\n+src/sage/game_theory/matching_game.py\n+src/sage/rings/integer.pyx\n+```\n+The one requiring the most memory is `src/sage/game_theory/matching_game.py`\n``````\n",
    "created_at": "2017-08-31T08:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428996",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,12 @@
 2. It is good to check that doctests do not use a large amount of memory.
 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.
 
-I suggest to limit the virtual memory for doctests to 3600MiB. This may seem like a lot, but some doctests need this much.
+I suggest to limit the virtual memory for doctests to 4500MiB. This may seem like a lot, but these doctests do not pass with a limit of 4000MiB:
+
+```
+src/sage/matrix/matrix_integer_dense.pyx
+src/sage/rings/polynomial/pbori.pyx
+src/sage/game_theory/matching_game.py
+src/sage/rings/integer.pyx
+```
+The one requiring the most memory is `src/sage/game_theory/matching_game.py`
``````




---

archive/issue_comments_428997.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8\">b4001c6</a></td><td><code>Run doctests with limited memory</code></td></tr></table>\n",
    "created_at": "2017-08-31T08:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8">b4001c6</a></td><td><code>Run doctests with limited memory</code></td></tr></table>




---

archive/issue_comments_428998.json:
```json
{
    "body": "**Changing commit** from \"[f8fcb510bcbe16103fd133b868915b94e7555010](https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010)\" to \"[b4001c6dbad755c92abaaa4b5b2fb23867df74b8](https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8)\".",
    "created_at": "2017-08-31T08:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f8fcb510bcbe16103fd133b868915b94e7555010](https://github.com/sagemath/sagetrac-mirror/commit/f8fcb510bcbe16103fd133b868915b94e7555010)" to "[b4001c6dbad755c92abaaa4b5b2fb23867df74b8](https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8)".



---

archive/issue_comments_428999.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [tscrim](#comment%3A14):\n> each copy of Sage should take a minimum of 1Gb.\n\n\nWell, remember that this is *virtual* memory. Most of that 1GB is shared between processes. If you run 10 copies of Sage, the executable code of Sage needs to be in *physical* memory only once: the OS maps the same physical memory inside the 10 processes.\n\nThen there is also memory which is reserved but typically not used: Sage might allocate a large PARI stack and GAP memory pool for example which counts against virtual memory. However, as long as this memory is not actually used, you don't need that much physical memory.",
    "created_at": "2017-08-31T08:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-428999",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [tscrim](#comment%3A14):
> each copy of Sage should take a minimum of 1Gb.


Well, remember that this is *virtual* memory. Most of that 1GB is shared between processes. If you run 10 copies of Sage, the executable code of Sage needs to be in *physical* memory only once: the OS maps the same physical memory inside the 10 processes.

Then there is also memory which is reserved but typically not used: Sage might allocate a large PARI stack and GAP memory pool for example which counts against virtual memory. However, as long as this memory is not actually used, you don't need that much physical memory.



---

archive/issue_comments_429000.json:
```json
{
    "body": "<a id='comment:18'></a>\nIt turns out that even 4GiB is not enough... This new version uses 4500MiB which passes `make ptestlong` on my machine.",
    "created_at": "2017-08-31T08:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429000",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
It turns out that even 4GiB is not enough... This new version uses 4500MiB which passes `make ptestlong` on my machine.



---

archive/issue_comments_429001.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A17):\n> Replying to [tscrim](#comment%3A14):\n> > each copy of Sage should take a minimum of 1Gb.\n\n> \n> Well, remember that this is *virtual* memory. Most of that 1GB is shared between processes. If you run 10 copies of Sage, the executable code of Sage needs to be in *physical* memory only once: the OS maps the same physical memory inside the 10 processes.\n> \n> Then there is also memory which is reserved but typically not used: Sage might allocate a large PARI stack and GAP memory pool for example which counts against virtual memory. However, as long as this memory is not actually used, you don't need that much physical memory.\n\n\nAh, right. Thank you for the explanation.",
    "created_at": "2017-08-31T14:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429001",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A17):
> Replying to [tscrim](#comment%3A14):
> > each copy of Sage should take a minimum of 1Gb.

> 
> Well, remember that this is *virtual* memory. Most of that 1GB is shared between processes. If you run 10 copies of Sage, the executable code of Sage needs to be in *physical* memory only once: the OS maps the same physical memory inside the 10 processes.
> 
> Then there is also memory which is reserved but typically not used: Sage might allocate a large PARI stack and GAP memory pool for example which counts against virtual memory. However, as long as this memory is not actually used, you don't need that much physical memory.


Ah, right. Thank you for the explanation.



---

archive/issue_comments_429002.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jdemeyer](#comment%3A18):\n> It turns out that even 4GiB is not enough... This new version uses 4500MiB which passes `make ptestlong` on my machine.\n\n\nI am pretty sure it is this block of tests that takes the large amount of memory (with `n = 10`):\n\n```\n        sage: from itertools import permutations\n        sage: suitr_preferences = list(permutations([-i-1 for i in range(n)]))\n        sage: revr_preferences = list(permutations([i+1 for i in range(n)]))\n        sage: for player in range(n):\n        ....:     big_game.suitors()[player].pref = suitr_preferences[player]\n        ....:     big_game.reviewers()[player].pref = revr_preferences[-player]\n        sage: big_game.solve()\n        {1: -1, 2: -8, 3: -9, 4: -10, 5: -7, 6: -6, 7: -5, 8: -4, 9: -3, 10: -2}\n```\nThat is `2 * 10! * 10 == 72576000` integers plus other stuff. Might consider dropping `n = 8` instead for this example.",
    "created_at": "2017-08-31T14:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429002",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Replying to [jdemeyer](#comment%3A18):
> It turns out that even 4GiB is not enough... This new version uses 4500MiB which passes `make ptestlong` on my machine.


I am pretty sure it is this block of tests that takes the large amount of memory (with `n = 10`):

```
        sage: from itertools import permutations
        sage: suitr_preferences = list(permutations([-i-1 for i in range(n)]))
        sage: revr_preferences = list(permutations([i+1 for i in range(n)]))
        sage: for player in range(n):
        ....:     big_game.suitors()[player].pref = suitr_preferences[player]
        ....:     big_game.reviewers()[player].pref = revr_preferences[-player]
        sage: big_game.solve()
        {1: -1, 2: -8, 3: -9, 4: -10, 5: -7, 6: -6, 7: -5, 8: -4, 9: -3, 10: -2}
```
That is `2 * 10! * 10 == 72576000` integers plus other stuff. Might consider dropping `n = 8` instead for this example.



---

archive/issue_comments_429003.json:
```json
{
    "body": "<a id='comment:21'></a>\nMaybe, but I consider lowering the actual memory requirements of doctests outside the scope of this ticket.",
    "created_at": "2017-08-31T14:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429003",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Maybe, but I consider lowering the actual memory requirements of doctests outside the scope of this ticket.



---

archive/issue_comments_429004.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-08-31T15:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429004",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_429005.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis is failing badly on the patchbot",
    "created_at": "2017-08-31T15:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429005",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
This is failing badly on the patchbot



---

archive/issue_comments_429006.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe problem seems to be that `setrlimit()` is done way too late. We need to limit the memory *before* starting Sage.",
    "created_at": "2017-09-04T08:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429006",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
The problem seems to be that `setrlimit()` is done way too late. We need to limit the memory *before* starting Sage.



---

archive/issue_comments_429007.json:
```json
{
    "body": "**Changing commit** from \"[b4001c6dbad755c92abaaa4b5b2fb23867df74b8](https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8)\" to \"[38f982331680d86b3ddafbb40f58ebd63df6719b](https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b)\".",
    "created_at": "2017-09-04T09:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b4001c6dbad755c92abaaa4b5b2fb23867df74b8](https://github.com/sagemath/sagetrac-mirror/commit/b4001c6dbad755c92abaaa4b5b2fb23867df74b8)" to "[38f982331680d86b3ddafbb40f58ebd63df6719b](https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b)".



---

archive/issue_comments_429008.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b\">38f9823</a></td><td><code>Run doctests with limited memory</code></td></tr></table>\n",
    "created_at": "2017-09-04T09:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b">38f9823</a></td><td><code>Run doctests with limited memory</code></td></tr></table>




---

archive/issue_comments_429009.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,12 +3,9 @@\n 2. It is good to check that doctests do not use a large amount of memory.\n 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.\n \n-I suggest to limit the virtual memory for doctests to 4500MiB. This may seem like a lot, but these doctests do not pass with a limit of 4000MiB:\n+I suggest to limit the virtual memory for doctests. The following two files contain the tests which need the most memory:\n \n ```\n-src/sage/matrix/matrix_integer_dense.pyx\n-src/sage/rings/polynomial/pbori.pyx\n src/sage/game_theory/matching_game.py\n-src/sage/rings/integer.pyx\n+src/sage/schemes/elliptic_curves/heegner.py\n ```\n-The one requiring the most memory is `src/sage/game_theory/matching_game.py`\n``````\n",
    "created_at": "2017-09-04T09:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429009",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,12 +3,9 @@
 2. It is good to check that doctests do not use a large amount of memory.
 3. It allows to doctest graceful recovery when memory cannot be allocated by intentionally allocating more memory than available.
 
-I suggest to limit the virtual memory for doctests to 4500MiB. This may seem like a lot, but these doctests do not pass with a limit of 4000MiB:
+I suggest to limit the virtual memory for doctests. The following two files contain the tests which need the most memory:
 
 ```
-src/sage/matrix/matrix_integer_dense.pyx
-src/sage/rings/polynomial/pbori.pyx
 src/sage/game_theory/matching_game.py
-src/sage/rings/integer.pyx
+src/sage/schemes/elliptic_curves/heegner.py
 ```
-The one requiring the most memory is `src/sage/game_theory/matching_game.py`
``````




---

archive/issue_comments_429010.json:
```json
{
    "body": "<a id='comment:25'></a>\nNew attempt, this time limiting the memory in the `sage-runtests` script. Let's see what the patchbot says...",
    "created_at": "2017-09-04T09:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429010",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
New attempt, this time limiting the memory in the `sage-runtests` script. Let's see what the patchbot says...



---

archive/issue_comments_429011.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-09-04T09:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429011",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_429012.json:
```json
{
    "body": "<a id='comment:26'></a>\nHmm, patchbots won't test this because it's \"unsafe\".",
    "created_at": "2017-09-05T08:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429012",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Hmm, patchbots won't test this because it's "unsafe".



---

archive/issue_comments_429013.json:
```json
{
    "body": "<a id='comment:27'></a>\nIn case it helps, I did test this on `sardonis` (ppc64le with lots of RAM) and on my laptop (`x86_64` with 6GB of RAM) and it passed tests. 32-bit should also pass for the simple reason that the condition `memlimit <= sys.maxsize()` will be false.\n\nI just got hit again by the issue of doctests taking infinite memory, apparently this creates an infinite list:\n\n```\nsage: L = [1, 2, 3]\nsage: L.extend(-x for x in L)\n```\n\nI'm just saying that this ticket protects against stupid mistakes like this, which might otherwise cause the system to start to swap and become unresponsive.",
    "created_at": "2017-09-05T08:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429013",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
In case it helps, I did test this on `sardonis` (ppc64le with lots of RAM) and on my laptop (`x86_64` with 6GB of RAM) and it passed tests. 32-bit should also pass for the simple reason that the condition `memlimit <= sys.maxsize()` will be false.

I just got hit again by the issue of doctests taking infinite memory, apparently this creates an infinite list:

```
sage: L = [1, 2, 3]
sage: L.extend(-x for x in L)
```

I'm just saying that this ticket protects against stupid mistakes like this, which might otherwise cause the system to start to swap and become unresponsive.



---

archive/issue_comments_429014.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-09-05T14:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429014",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_429015.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jdemeyer](#comment%3A27):\n> In case it helps, I did test this on `sardonis` (ppc64le with lots of RAM) and on my laptop (`x86_64` with 6GB of RAM) and it passed tests. 32-bit should also pass for the simple reason that the condition `memlimit <= sys.maxsize()` will be false.\n\n\nEverything seems to be okay on my laptop as well (`x86_64` with 8Gb of RAM).\n\n> I just got hit again by the issue of doctests taking infinite memory, apparently this creates an infinite list:\n> \n> ```\n> sage: L = [1, 2, 3]\n> sage: L.extend(-x for x in L)\n> ```\n\n\nI'm actually slightly surprised Python doesn't catch that as it does so well (sometimes too well) with mutating `dict`s.\n\n> I'm just saying that this ticket protects against stupid mistakes like this, which might otherwise cause the system to start to swap and become unresponsive.\n\n\nIndeed. Let's kick this to the buildbots and into a beta to see if this causes any trouble.",
    "created_at": "2017-09-05T14:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429015",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
Replying to [jdemeyer](#comment%3A27):
> In case it helps, I did test this on `sardonis` (ppc64le with lots of RAM) and on my laptop (`x86_64` with 6GB of RAM) and it passed tests. 32-bit should also pass for the simple reason that the condition `memlimit <= sys.maxsize()` will be false.


Everything seems to be okay on my laptop as well (`x86_64` with 8Gb of RAM).

> I just got hit again by the issue of doctests taking infinite memory, apparently this creates an infinite list:
> 
> ```
> sage: L = [1, 2, 3]
> sage: L.extend(-x for x in L)
> ```


I'm actually slightly surprised Python doesn't catch that as it does so well (sometimes too well) with mutating `dict`s.

> I'm just saying that this ticket protects against stupid mistakes like this, which might otherwise cause the system to start to swap and become unresponsive.


Indeed. Let's kick this to the buildbots and into a beta to see if this causes any trouble.



---

archive/issue_comments_429016.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-09-05T14:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429016",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_429017.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-09-06T17:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429017",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_429018.json:
```json
{
    "body": "<a id='comment:29'></a>\nI'm getting \n\n```\nsage -t --warn-long 69.8 src/sage/game_theory/matching_game.py\n**********************************************************************\nFile \"src/sage/game_theory/matching_game.py\", line 161, in sage.game_theory.matching_game.MatchingGame\nFailed example:\n    revr_preferences = list(permutations([i+1 for i in range(n)]))\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.matching_game.MatchingGame[17]>\", line 1, in <module>\n        revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))\n    MemoryError\n```\nHere n=10, so 10! permutations...\n\nPS: This is x86_64 with 32GB ram",
    "created_at": "2017-09-06T17:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429018",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
I'm getting 

```
sage -t --warn-long 69.8 src/sage/game_theory/matching_game.py
**********************************************************************
File "src/sage/game_theory/matching_game.py", line 161, in sage.game_theory.matching_game.MatchingGame
Failed example:
    revr_preferences = list(permutations([i+1 for i in range(n)]))
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.matching_game.MatchingGame[17]>", line 1, in <module>
        revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))
    MemoryError
```
Here n=10, so 10! permutations...

PS: This is x86_64 with 32GB ram



---

archive/issue_comments_429019.json:
```json
{
    "body": "<a id='comment:30'></a>\nSame as Volker. Also x86_64 with 32GB (although `free` says 12GB are free and 25GB available).",
    "created_at": "2017-09-06T21:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429019",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
Same as Volker. Also x86_64 with 32GB (although `free` says 12GB are free and 25GB available).



---

archive/issue_comments_429020.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [vbraun](#comment%3A29):\n> I'm getting \n> \n> ```\n> sage -t --warn-long 69.8 src/sage/game_theory/matching_game.py\n> **********************************************************************\n> File \"src/sage/game_theory/matching_game.py\", line 161, in sage.game_theory.matching_game.MatchingGame\n> Failed example:\n>     revr_preferences = list(permutations([i+1 for i in range(n)]))\n> Exception raised:\n>     Traceback (most recent call last):\n>       File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.game_theory.matching_game.MatchingGame[17]>\", line 1, in <module>\n>         revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))\n>     MemoryError\n> ```\n\n\nDid you run all doctests? Is this the only file which fails?",
    "created_at": "2017-09-06T21:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429020",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [vbraun](#comment%3A29):
> I'm getting 
> 
> ```
> sage -t --warn-long 69.8 src/sage/game_theory/matching_game.py
> **********************************************************************
> File "src/sage/game_theory/matching_game.py", line 161, in sage.game_theory.matching_game.MatchingGame
> Failed example:
>     revr_preferences = list(permutations([i+1 for i in range(n)]))
> Exception raised:
>     Traceback (most recent call last):
>       File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.game_theory.matching_game.MatchingGame[17]>", line 1, in <module>
>         revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))
>     MemoryError
> ```


Did you run all doctests? Is this the only file which fails?



---

archive/issue_comments_429021.json:
```json
{
    "body": "<a id='comment:32'></a>\nFull failure\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\", line 161, in sage.game_theory.matching_game.MatchingGame\nFailed example:\n    revr_preferences = list(permutations([i+1 for i in range(n)]))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.matching_game.MatchingGame[17]>\", line 1, in <module>\n        revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))\n    MemoryError\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\", line 162, in sage.game_theory.matching_game.MatchingGame\nFailed example:\n    for player in range(n):\n        big_game.suitors()[player].pref = suitr_preferences[player]\n        big_game.reviewers()[player].pref = revr_preferences[-player]\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.matching_game.MatchingGame[18]>\", line 3, in <module>\n        big_game.reviewers()[player].pref = revr_preferences[-player]\n    NameError: name 'revr_preferences' is not defined\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\", line 165, in sage.game_theory.matching_game.MatchingGame\nFailed example:\n    big_game.solve()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.game_theory.matching_game.MatchingGame[19]>\", line 1, in <module>\n        big_game.solve()\n      File \"/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\", line 901, in solve\n        self._is_complete()\n      File \"/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py\", line 668, in _is_complete\n        raise ValueError(\"suitor preferences are not complete\")\n    ValueError: suitor preferences are not complete\n**********************************************************************\n```\nI cannot talk for Volker but this is the only file for which I have a failure related to this ticket. The other failure I got was ticket:23497#comment:39",
    "created_at": "2017-09-06T21:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429021",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
Full failure

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py", line 161, in sage.game_theory.matching_game.MatchingGame
Failed example:
    revr_preferences = list(permutations([i+1 for i in range(n)]))
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.matching_game.MatchingGame[17]>", line 1, in <module>
        revr_preferences = list(permutations([i+Integer(1) for i in range(n)]))
    MemoryError
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py", line 162, in sage.game_theory.matching_game.MatchingGame
Failed example:
    for player in range(n):
        big_game.suitors()[player].pref = suitr_preferences[player]
        big_game.reviewers()[player].pref = revr_preferences[-player]
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.matching_game.MatchingGame[18]>", line 3, in <module>
        big_game.reviewers()[player].pref = revr_preferences[-player]
    NameError: name 'revr_preferences' is not defined
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py", line 165, in sage.game_theory.matching_game.MatchingGame
Failed example:
    big_game.solve()
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.game_theory.matching_game.MatchingGame[19]>", line 1, in <module>
        big_game.solve()
      File "/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py", line 901, in solve
        self._is_complete()
      File "/usr/lib64/python2.7/site-packages/sage/game_theory/matching_game.py", line 668, in _is_complete
        raise ValueError("suitor preferences are not complete")
    ValueError: suitor preferences are not complete
**********************************************************************
```
I cannot talk for Volker but this is the only file for which I have a failure related to this ticket. The other failure I got was ticket:23497#comment:39



---

archive/issue_comments_429022.json:
```json
{
    "body": "<a id='comment:33'></a>\nThats the only file that failed for me, too",
    "created_at": "2017-09-06T22:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429022",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
Thats the only file that failed for me, too



---

archive/issue_comments_429023.json:
```json
{
    "body": "<a id='comment:34'></a>\nIf you both have only that file failing, it's a good reason to revisit those doctests after all and make them use less memory.",
    "created_at": "2017-09-07T10:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429023",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
If you both have only that file failing, it's a good reason to revisit those doctests after all and make them use less memory.



---

archive/issue_comments_429024.json:
```json
{
    "body": "<a id='comment:35'></a>\nBut it didn't fail before this ticket and this ticket doesn't touch this particular file.",
    "created_at": "2017-09-07T10:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429024",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>
But it didn't fail before this ticket and this ticket doesn't touch this particular file.



---

archive/issue_comments_429025.json:
```json
{
    "body": "**Changing commit** from \"[38f982331680d86b3ddafbb40f58ebd63df6719b](https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b)\" to \"[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)\".",
    "created_at": "2017-09-07T11:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[38f982331680d86b3ddafbb40f58ebd63df6719b](https://github.com/sagemath/sagetrac-mirror/commit/38f982331680d86b3ddafbb40f58ebd63df6719b)" to "[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)".



---

archive/issue_comments_429026.json:
```json
{
    "body": "<a id='comment:36'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5\">06d4307</a></td><td><code>Simplify doctest in matching_game.py</code></td></tr></table>\n",
    "created_at": "2017-09-07T11:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5">06d4307</a></td><td><code>Simplify doctest in matching_game.py</code></td></tr></table>




---

archive/issue_comments_429027.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-09-07T11:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429027",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_429028.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [fbissey](#comment%3A35):\n> But it didn't fail before this ticket and this ticket doesn't touch this particular file.\n\n\nThe point of this ticket is to limit the amount of memory that doctests are allowed to use. Apparently `matching_game.py` is the file which uses the most memory of all doctests. There is no reason why the testcase in the `matching_game.py` doctests must be so large. I just simplified that.",
    "created_at": "2017-09-07T11:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429028",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [fbissey](#comment%3A35):
> But it didn't fail before this ticket and this ticket doesn't touch this particular file.


The point of this ticket is to limit the amount of memory that doctests are allowed to use. Apparently `matching_game.py` is the file which uses the most memory of all doctests. There is no reason why the testcase in the `matching_game.py` doctests must be so large. I just simplified that.



---

archive/issue_comments_429029.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [fbissey](#comment%3A35):\n> But it didn't fail before this ticket and this ticket doesn't touch this particular file.\n\n\nSo what would you suggest instead? Simply increasing the limit from 3300 MiB to some higher number?",
    "created_at": "2017-09-10T09:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429029",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
Replying to [fbissey](#comment%3A35):
> But it didn't fail before this ticket and this ticket doesn't touch this particular file.


So what would you suggest instead? Simply increasing the limit from 3300 MiB to some higher number?



---

archive/issue_comments_429030.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [jdemeyer](#comment%3A38):\n> Replying to [fbissey](#comment%3A35):\n> > But it didn't fail before this ticket and this ticket doesn't touch this particular file.\n\n> \n> So what would you suggest instead? Simply increasing the limit from 3300 MiB to some higher number?\n\n\nNo, after reading the description again properly, the fact that it passed before for me is irrelevant to what you try to achieve. I'll put it back to positive review to send it back to the bots.",
    "created_at": "2017-09-10T09:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429030",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
Replying to [jdemeyer](#comment%3A38):
> Replying to [fbissey](#comment%3A35):
> > But it didn't fail before this ticket and this ticket doesn't touch this particular file.

> 
> So what would you suggest instead? Simply increasing the limit from 3300 MiB to some higher number?


No, after reading the description again properly, the fact that it passed before for me is irrelevant to what you try to achieve. I'll put it back to positive review to send it back to the bots.



---

archive/issue_comments_429031.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-09-10T09:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429031",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_429032.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,3 +9,5 @@\n src/sage/game_theory/matching_game.py\n src/sage/schemes/elliptic_curves/heegner.py\n ```\n+\n+This branch also reduces the memory needed for `matching_game.py`, such that `heegner.py` is now the doctest which requires the most memory.\n``````\n",
    "created_at": "2017-09-10T15:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429032",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,3 +9,5 @@
 src/sage/game_theory/matching_game.py
 src/sage/schemes/elliptic_curves/heegner.py
 ```
+
+This branch also reduces the memory needed for `matching_game.py`, such that `heegner.py` is now the doctest which requires the most memory.
``````




---

archive/issue_comments_429033.json:
```json
{
    "body": "<a id='comment:41'></a>\nThanks!",
    "created_at": "2017-09-10T15:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429033",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
Thanks!



---

archive/issue_comments_429034.json:
```json
{
    "body": "<a id='comment:42'></a>\nNow I get this on Volker's develop branch\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 2828, in sage.rings.integer.Integer.divisors\nFailed example:\n    for i in range(20):  # long time\n        try:\n            alarm(RDF.random_element(1e-3, 0.5))\n            _ = n.divisors()\n            cancel_alarm()  # we never get here\n        except AlarmInterrupt:\n            pass\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer.divisors[19]>\", line 4, in <module>\n        _ = n.divisors()\n      File \"sage/rings/integer.pyx\", line 2897, in sage.rings.integer.Integer.divisors (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:19409)\n        ptr = <unsigned long*>check_allocarray(divisor_count, 3 * sizeof(unsigned long))\n      File \"memory.pxd\", line 87, in cysignals.memory.check_allocarray (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:45630)\n    MemoryError: failed to allocate 33554432 * 24 bytes\n**********************************************************************\n```\nI have another failure in that file that is not related to memory, so there is probably problems with other tickets touching that file. I'll see if I can find out which one(s).",
    "created_at": "2017-09-11T09:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429034",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
Now I get this on Volker's develop branch

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/rings/integer.pyx
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 2828, in sage.rings.integer.Integer.divisors
Failed example:
    for i in range(20):  # long time
        try:
            alarm(RDF.random_element(1e-3, 0.5))
            _ = n.divisors()
            cancel_alarm()  # we never get here
        except AlarmInterrupt:
            pass
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.divisors[19]>", line 4, in <module>
        _ = n.divisors()
      File "sage/rings/integer.pyx", line 2897, in sage.rings.integer.Integer.divisors (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:19409)
        ptr = <unsigned long*>check_allocarray(divisor_count, 3 * sizeof(unsigned long))
      File "memory.pxd", line 87, in cysignals.memory.check_allocarray (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:45630)
    MemoryError: failed to allocate 33554432 * 24 bytes
**********************************************************************
```
I have another failure in that file that is not related to memory, so there is probably problems with other tickets touching that file. I'll see if I can find out which one(s).



---

archive/issue_events_068584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-11T13:47:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23748#event-68584"
}
```



---

archive/issue_comments_429035.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/run_doctests_with_limited_memory](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/run_doctests_with_limited_memory)\" to \"[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)\".",
    "created_at": "2017-09-11T13:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429035",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/run_doctests_with_limited_memory](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/run_doctests_with_limited_memory)" to "[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)".



---

archive/issue_comments_429036.json:
```json
{
    "body": "**Changing commit** from \"[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)\" to \"\".",
    "created_at": "2017-10-20T08:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429036",
    "user": "https://github.com/videlec"
}
```

**Changing commit** from "[06d43071962808d1d8adf6d527a4e762f34290b5](https://github.com/sagemath/sagetrac-mirror/commit/06d43071962808d1d8adf6d527a4e762f34290b5)" to "".



---

archive/issue_comments_429037.json:
```json
{
    "body": "<a id='comment:44'></a>\nCould this be the source of the problem in #24075?",
    "created_at": "2017-10-20T08:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429037",
    "user": "https://github.com/videlec"
}
```

<a id='comment:44'></a>
Could this be the source of the problem in #24075?



---

archive/issue_comments_429038.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [vdelecroix](#comment%3A44):\n> Could this be the source of the problem in #24075?\n\n\nI wouldn't think so but if you can repeat the failure you can just comment those two lines in `sage-runtests`\n\n```\n        if lim == resource.RLIM_INFINITY or lim > memlimit:\n            resource.setrlimit(resource.RLIMIT_AS, (memlimit, hard))\n```\nand see if it improves things.",
    "created_at": "2017-10-20T08:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429038",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
Replying to [vdelecroix](#comment%3A44):
> Could this be the source of the problem in #24075?


I wouldn't think so but if you can repeat the failure you can just comment those two lines in `sage-runtests`

```
        if lim == resource.RLIM_INFINITY or lim > memlimit:
            resource.setrlimit(resource.RLIMIT_AS, (memlimit, hard))
```
and see if it improves things.



---

archive/issue_comments_429039.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [vdelecroix](#comment%3A44):\n> Could this be the source of the problem in #24075?\n\n\nThat would be very surprising. How can runnning doctests with limited memory make something work accidentally?",
    "created_at": "2017-10-20T09:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23748#issuecomment-429039",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'></a>
Replying to [vdelecroix](#comment%3A44):
> Could this be the source of the problem in #24075?


That would be very surprising. How can runnning doctests with limited memory make something work accidentally?
