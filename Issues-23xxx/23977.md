# Issue 23977: QuadraticForm doubling convention inconsistent

archive/issues_023740.json:
```json
{
    "body": "\n```\nsage: Q1=QuadraticForm(ZZ,1,[1])\nsage: Q1.polynomial()\n2*x^2\nsage: Q1([1])\n1\nsage: Q1\nQuadratic form in 1 variables over Integer Ring with coefficients: \n[ 1 ]\nsage: Q1.Hessian_matrix()\n[2]\nsage: Q1.Gram_matrix()\n[1]\n```\nThe polynomial should rather be `x^2` as it satisfies\n`Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.\nTo make it even clearer:\n\n```\nsage: q = QuadraticForm(GF(2),2,[1,1,1])\nsage: q\nQuadratic form in 2 variables over Finite Field of size 2 with coefficients: \n[ 1 1 ]\n[ * 1 ]\nsage: q.polynomial()\n0\n```\n\n**Branch/Commit:** [12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)\n\n**Reviewer:** Anna Haensch\n\n**Author:** Simon Brandhorst\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23977\n\n",
    "closed_at": "2018-02-18T12:52:14Z",
    "created_at": "2017-10-06T09:39:30Z",
    "labels": [
        "component: quadratic forms",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "QuadraticForm doubling convention inconsistent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23977",
    "user": "https://github.com/simonbrandhorst"
}
```

```
sage: Q1=QuadraticForm(ZZ,1,[1])
sage: Q1.polynomial()
2*x^2
sage: Q1([1])
1
sage: Q1
Quadratic form in 1 variables over Integer Ring with coefficients: 
[ 1 ]
sage: Q1.Hessian_matrix()
[2]
sage: Q1.Gram_matrix()
[1]
```
The polynomial should rather be `x^2` as it satisfies
`Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.
To make it even clearer:

```
sage: q = QuadraticForm(GF(2),2,[1,1,1])
sage: q
Quadratic form in 2 variables over Finite Field of size 2 with coefficients: 
[ 1 1 ]
[ * 1 ]
sage: q.polynomial()
0
```

**Branch/Commit:** [12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)

**Reviewer:** Anna Haensch

**Author:** Simon Brandhorst

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/23977





---

archive/issue_events_069359.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "rename": {
        "from": "QuadraticForm evaluation broken.",
        "to": "QuadraticForm doubling convention inconsistent"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23977#event-69359"
}
```



---

archive/issue_comments_455207.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,17 @@\n \n ```\n-sage: Q=QuadraticForm(matrix.diagonal([2,-2]))\n-sage: Q\n-\n-Quadratic form in 2 variables over Integer Ring with coefficients: \n-[ 1 0 ]\n-[ * -1 ]\n-sage: Q.polynomial()\n-2*x0^2 - 2*x1^2\n-sage: Q(vector(ZZ,[36,25]))\n-671\n+sage: Q1=QuadraticForm(ZZ,1,[1])\n+sage: Q1.polynomial()\n+2*x^2\n+sage: Q1([1])\n+1\n+sage: Q1\n+Quadratic form in 1 variables over Integer Ring with coefficients: \n+[ 1 ]\n+sage: Q1.Hessian_matrix()\n+[2]\n+sage: Q1.Gram_matrix()\n+[1]\n ```\n-Clearly, the correct answer is 22.\n-Evaluating quadratic forms is the one thing in the quadratic forms package that MUST not have a bug. Thus this is a blocker. \n+The polynomial should rather be `x^2` as it satisfies\n+`Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.\n``````\n",
    "created_at": "2017-10-06T12:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455207",
    "user": "https://github.com/simonbrandhorst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,17 @@
 
 ```
-sage: Q=QuadraticForm(matrix.diagonal([2,-2]))
-sage: Q
-
-Quadratic form in 2 variables over Integer Ring with coefficients: 
-[ 1 0 ]
-[ * -1 ]
-sage: Q.polynomial()
-2*x0^2 - 2*x1^2
-sage: Q(vector(ZZ,[36,25]))
-671
+sage: Q1=QuadraticForm(ZZ,1,[1])
+sage: Q1.polynomial()
+2*x^2
+sage: Q1([1])
+1
+sage: Q1
+Quadratic form in 1 variables over Integer Ring with coefficients: 
+[ 1 ]
+sage: Q1.Hessian_matrix()
+[2]
+sage: Q1.Gram_matrix()
+[1]
 ```
-Clearly, the correct answer is 22.
-Evaluating quadratic forms is the one thing in the quadratic forms package that MUST not have a bug. Thus this is a blocker. 
+The polynomial should rather be `x^2` as it satisfies
+`Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.
``````




---

archive/issue_events_069360.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2017-10-06T12:48:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23977#event-69360"
}
```



---

archive/issue_events_069361.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2017-10-06T12:49:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23977#event-69361"
}
```



---

archive/issue_events_069362.json:
```json
{
    "actor": "https://github.com/simonbrandhorst",
    "created_at": "2017-10-06T12:49:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23977#event-69362"
}
```



---

archive/issue_comments_455208.json:
```json
{
    "body": "**Branch:** [u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)",
    "created_at": "2017-11-24T10:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455208",
    "user": "https://github.com/simonbrandhorst"
}
```

**Branch:** [u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)



---

archive/issue_comments_455209.json:
```json
{
    "body": "**Changing branch** from \"[u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)\" to \"\".",
    "created_at": "2017-11-24T10:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455209",
    "user": "https://github.com/simonbrandhorst"
}
```

**Changing branch** from "[u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)" to "".



---

archive/issue_comments_455210.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,3 +15,14 @@\n ```\n The polynomial should rather be `x^2` as it satisfies\n `Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.\n+To make it even clearer:\n+\n+```\n+sage: q = QuadraticForm(GF(2),2,[1,1,1])\n+sage: q\n+Quadratic form in 2 variables over Finite Field of size 2 with coefficients: \n+[ 1 1 ]\n+[ * 1 ]\n+sage: q.polynomial()\n+0\n+```\n``````\n",
    "created_at": "2017-11-24T10:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455210",
    "user": "https://github.com/simonbrandhorst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,3 +15,14 @@
 ```
 The polynomial should rather be `x^2` as it satisfies
 `Q([t]) = Q.poly().subs(x=t)` where `t` is any integer.
+To make it even clearer:
+
+```
+sage: q = QuadraticForm(GF(2),2,[1,1,1])
+sage: q
+Quadratic form in 2 variables over Finite Field of size 2 with coefficients: 
+[ 1 1 ]
+[ * 1 ]
+sage: q.polynomial()
+0
+```
``````




---

archive/issue_comments_455211.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-11-24T10:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455211",
    "user": "https://github.com/simonbrandhorst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_455212.json:
```json
{
    "body": "<a id='comment:5'></a>\nI understand the inconsistency that you're pointing out here in the description, but there doesn't appear to be any branch associated to this ticked.  Did you forget to commit and push your changes to trac?",
    "created_at": "2017-12-02T22:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455212",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:5'></a>
I understand the inconsistency that you're pointing out here in the description, but there doesn't appear to be any branch associated to this ticked.  Did you forget to commit and push your changes to trac?



---

archive/issue_comments_455213.json:
```json
{
    "body": "**Branch:** [u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)",
    "created_at": "2017-12-03T15:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455213",
    "user": "https://github.com/simonbrandhorst"
}
```

**Branch:** [u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)



---

archive/issue_comments_455214.json:
```json
{
    "body": "<a id='comment:7'></a>\nIndeed. There you go.\n  \n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da\">38f76db</a></td><td><code>No doubling anymore.</code></td></tr></table>\n",
    "created_at": "2017-12-03T15:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455214",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:7'></a>
Indeed. There you go.
  
---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da">38f76db</a></td><td><code>No doubling anymore.</code></td></tr></table>




---

archive/issue_comments_455215.json:
```json
{
    "body": "**Commit:** [38f76db03a6cea14bd1531209d7f2f019ce1e1da](https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da)",
    "created_at": "2017-12-03T15:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455215",
    "user": "https://github.com/simonbrandhorst"
}
```

**Commit:** [38f76db03a6cea14bd1531209d7f2f019ce1e1da](https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da)



---

archive/issue_comments_455216.json:
```json
{
    "body": "<a id='comment:8'></a>\nCoverage tests pass, doctests pass, the code does what it says it should. Looks good to me!",
    "created_at": "2017-12-04T17:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455216",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:8'></a>
Coverage tests pass, doctests pass, the code does what it says it should. Looks good to me!



---

archive/issue_comments_455217.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-12-04T17:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455217",
    "user": "https://github.com/annahaensch"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_455218.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou should fill the Authors and Reviewers fields with your real names.",
    "created_at": "2017-12-05T08:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455218",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
You should fill the Authors and Reviewers fields with your real names.



---

archive/issue_comments_455219.json:
```json
{
    "body": "**Author:** Simon Brandhorst",
    "created_at": "2017-12-05T11:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455219",
    "user": "https://github.com/simonbrandhorst"
}
```

**Author:** Simon Brandhorst



---

archive/issue_comments_455220.json:
```json
{
    "body": "**Reviewer:** Anna Haensch",
    "created_at": "2017-12-05T11:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455220",
    "user": "https://github.com/simonbrandhorst"
}
```

**Reviewer:** Anna Haensch



---

archive/issue_comments_455221.json:
```json
{
    "body": "<a id='comment:12'></a>\nThank you. Forgot about that.",
    "created_at": "2017-12-05T11:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455221",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:12'></a>
Thank you. Forgot about that.



---

archive/issue_comments_455222.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-12-13T22:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455222",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_455223.json:
```json
{
    "body": "<a id='comment:13'></a>\nSee patchbot",
    "created_at": "2017-12-13T22:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455223",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
See patchbot



---

archive/issue_comments_455224.json:
```json
{
    "body": "**Changing commit** from \"[38f76db03a6cea14bd1531209d7f2f019ce1e1da](https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da)\" to \"[12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)\".",
    "created_at": "2017-12-14T07:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[38f76db03a6cea14bd1531209d7f2f019ce1e1da](https://github.com/sagemath/sagetrac-mirror/commit/38f76db03a6cea14bd1531209d7f2f019ce1e1da)" to "[12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)".



---

archive/issue_comments_455225.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db\">12e50b9</a></td><td><code>Fixed a derived inconsistency in sage.rings.invariant_theory</code></td></tr></table>\n",
    "created_at": "2017-12-14T07:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db">12e50b9</a></td><td><code>Fixed a derived inconsistency in sage.rings.invariant_theory</code></td></tr></table>




---

archive/issue_comments_455226.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-12-14T07:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455226",
    "user": "https://github.com/simonbrandhorst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_455227.json:
```json
{
    "body": "<a id='comment:16'></a>\n@Volker your code in sage.rings.invariant_theory seems to assume characteristic 0?\nAt least it fails for characteristic 2.",
    "created_at": "2017-12-14T07:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455227",
    "user": "https://github.com/simonbrandhorst"
}
```

<a id='comment:16'></a>
@Volker your code in sage.rings.invariant_theory seems to assume characteristic 0?
At least it fails for characteristic 2.



---

archive/issue_comments_455228.json:
```json
{
    "body": "<a id='comment:17'></a>\nAs far as I can see this looks good and it passes all doctests. I'm ready to give it a positive review.",
    "created_at": "2018-02-16T14:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455228",
    "user": "https://github.com/annahaensch"
}
```

<a id='comment:17'></a>
As far as I can see this looks good and it passes all doctests. I'm ready to give it a positive review.



---

archive/issue_comments_455229.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-02-16T14:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455229",
    "user": "https://github.com/annahaensch"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_455230.json:
```json
{
    "body": "**Changing branch** from \"[u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)\" to \"[12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)\".",
    "created_at": "2018-02-18T12:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455230",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/sbrandhorst/quadraticform_doubling_convention_inconsistent](https://github.com/sagemath/sagetrac-mirror/tree/u/sbrandhorst/quadraticform_doubling_convention_inconsistent)" to "[12e50b9303568f18b8e1f28cf3609321f17bb6db](https://github.com/sagemath/sagetrac-mirror/commit/12e50b9303568f18b8e1f28cf3609321f17bb6db)".



---

archive/issue_comments_455231.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-02-18T12:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23977#issuecomment-455231",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_069363.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-18T12:52:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23977",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23977#event-69363"
}
```
