# Issue 23290: Graph.merge_vertices() destroys loops

archive/issues_023053.json:
```json
{
    "body": "merge_vertices() accepts a list of vertices as input, but loops are lost unless they're on the first vertex.\n\nCC:  @dcoudert @tscrim stefan\n\nReviewer: Stefan van Zwam, David Coudert\n\nAuthor: Zach Gershkoff\n\nBranch: ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23290\n\n",
    "closed_at": "2017-06-26T21:24:41Z",
    "created_at": "2017-06-21T01:57:33Z",
    "labels": [
        "component: graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Graph.merge_vertices() destroys loops",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23290",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```
merge_vertices() accepts a list of vertices as input, but loops are lost unless they're on the first vertex.

CC:  @dcoudert @tscrim stefan

Reviewer: Stefan van Zwam, David Coudert

Author: Zach Gershkoff

Branch: ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23290





---

archive/issue_comments_437362.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437362",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_437363.json:
```json
{
    "body": "Changing author from \"\" to \"Zachary Gershkoff\"",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437363",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing author from "" to "Zachary Gershkoff"



---

archive/issue_comments_437364.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437364",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_437365.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+merge_vertices() accepts a list of vertices as input, but loops are lost unless they're on the first vertex.\n``````\n",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437365",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+merge_vertices() accepts a list of vertices as input, but loops are lost unless they're on the first vertex.
``````




---

archive/issue_comments_437366.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nsage: edgelist = [(0,0,'a'), (0,1,'b'), (1,1,'c')]\nsage: G = Graph(edgelist, loops=True, multiedges=True)\nsage: G.merge_vertices([0,1]); G.edges()\n[(0,0,'a')]\n```\n\nIt looks like merge_vertices() works by computing the edge boundary between the specified set of vertices and the rest of the graph, then deleting all the vertices except the first one, then putting the edges back in.\n\nSo there are actually two issues here. (1) Loops not on the first vertex will be lost (because they're not in the edge boundary and their vertices get deleted), and (2) we'll lose other edges that are not in the edge boundary so they should become loops.\n\n(1) is certainly a defect. I'm not so certain about (2) because I don't know if it's appropriate for this method to create loops. In fact, it's probably not.",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437366",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:1'></a>

```
sage: edgelist = [(0,0,'a'), (0,1,'b'), (1,1,'c')]
sage: G = Graph(edgelist, loops=True, multiedges=True)
sage: G.merge_vertices([0,1]); G.edges()
[(0,0,'a')]
```

It looks like merge_vertices() works by computing the edge boundary between the specified set of vertices and the rest of the graph, then deleting all the vertices except the first one, then putting the edges back in.

So there are actually two issues here. (1) Loops not on the first vertex will be lost (because they're not in the edge boundary and their vertices get deleted), and (2) we'll lose other edges that are not in the edge boundary so they should become loops.

(1) is certainly a defect. I'm not so certain about (2) because I don't know if it's appropriate for this method to create loops. In fact, it's probably not.



---

archive/issue_comments_437367.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2017-06-21T02:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437367",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing priority from major to minor.



---

archive/issue_comments_437368.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt is not an easy task to decide on the good behavior. See #10357 #9807 #7304 #7159.",
    "created_at": "2017-06-21T07:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437368",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>
It is not an easy task to decide on the good behavior. See #10357 #9807 #7304 #7159.



---

archive/issue_comments_437369.json:
```json
{
    "body": "<a id='comment:3'></a>\nIn that case, I'll fix (1) and leave (2) for one of the other tickets.",
    "created_at": "2017-06-21T21:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437369",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:3'></a>
In that case, I'll fix (1) and leave (2) for one of the other tickets.



---

archive/issue_comments_437370.json:
```json
{
    "body": "Changing branch from \"\" to \"u/zgershkoff/graph_merge_vertices___destroys_loops\"",
    "created_at": "2017-06-21T22:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437370",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing branch from "" to "u/zgershkoff/graph_merge_vertices___destroys_loops"



---

archive/issue_comments_437371.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-21T22:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437371",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437372.json:
```json
{
    "body": "Changing commit from \"\" to \"412dc9082deb4ed0c7f14cdbee7a37950e0e51a7\"",
    "created_at": "2017-06-21T22:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437372",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing commit from "" to "412dc9082deb4ed0c7f14cdbee7a37950e0e51a7"



---

archive/issue_comments_437373.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt now checks if any of the (di)graph's loops are on the vertices to be deleted before deleting them, and it only adds a few steps if loops are disabled.\n\n---\nNew commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[412dc90](https://git.sagemath.org/sage.git/commit?id=412dc9082deb4ed0c7f14cdbee7a37950e0e51a7)|`moved loops from vertices before the vertices get deleted`|",
    "created_at": "2017-06-21T22:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437373",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:5'></a>
It now checks if any of the (di)graph's loops are on the vertices to be deleted before deleting them, and it only adds a few steps if loops are disabled.

---
New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[412dc90](https://git.sagemath.org/sage.git/commit?id=412dc9082deb4ed0c7f14cdbee7a37950e0e51a7)|`moved loops from vertices before the vertices get deleted`|



---

archive/issue_comments_437374.json:
```json
{
    "body": "<a id='comment:6'></a>\nBefore this gets closed: There's code at the beginning of `merge_vertices()` to check if the first vertex label is `None`, but I don't think this will ever happen because of #9362. Should I take those lines out?\n\nNevermind. A user may wish to input `None` as the first item in the list because this will give the merged vertex a new name.",
    "created_at": "2017-06-22T17:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437374",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:6'></a>
Before this gets closed: There's code at the beginning of `merge_vertices()` to check if the first vertex label is `None`, but I don't think this will ever happen because of #9362. Should I take those lines out?

Nevermind. A user may wish to input `None` as the first item in the list because this will give the merged vertex a new name.



---

archive/issue_comments_437375.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Stefan van Zwam\"",
    "created_at": "2017-06-23T04:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437375",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing reviewer from "" to "Stefan van Zwam"



---

archive/issue_comments_437376.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-23T04:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437376",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437377.json:
```json
{
    "body": "<a id='comment:7'></a>\nWorks as advertised!",
    "created_at": "2017-06-23T04:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437377",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:7'></a>
Works as advertised!



---

archive/issue_comments_437378.json:
```json
{
    "body": "Changing reviewer from \"Stefan van Zwam\" to \"Stefan van Zwam, David Coudert\"",
    "created_at": "2017-06-24T08:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437378",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "Stefan van Zwam" to "Stefan van Zwam, David Coudert"



---

archive/issue_comments_437379.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis could be more efficient\n\n```\n        u = vertices[0]\n        for v in vertices[1:]:\n            if self.has_edge(v, v):\n                if self.allows_multiple_edges():\n                    for l in self.edge_label(v, v):\n                        self.add_edge(u, u, l)\n                else:\n                    self.add_edge(u, u, self.edge_label(v, v))\n```\n\n\nCould you add a test to do nothing when `len(vertices) < 2`.\n\n```\nsage: G = Graph()\nsage: G.merge_vertices([None])\nsage: G\nGraph on 1 vertex\nsage: G.merge_vertices([None])\nsage: G\nGraph on 2 vertices\n```\n\n\nOther issue: `TESTS::` -> `TESTS:`",
    "created_at": "2017-06-24T08:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437379",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
This could be more efficient

```
        u = vertices[0]
        for v in vertices[1:]:
            if self.has_edge(v, v):
                if self.allows_multiple_edges():
                    for l in self.edge_label(v, v):
                        self.add_edge(u, u, l)
                else:
                    self.add_edge(u, u, self.edge_label(v, v))
```


Could you add a test to do nothing when `len(vertices) < 2`.

```
sage: G = Graph()
sage: G.merge_vertices([None])
sage: G
Graph on 1 vertex
sage: G.merge_vertices([None])
sage: G
Graph on 2 vertices
```


Other issue: `TESTS::` -> `TESTS:`



---

archive/issue_comments_437380.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-24T08:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437380",
    "user": "https://github.com/dcoudert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_437381.json:
```json
{
    "body": "<a id='comment:9'></a>\nAlso, when multiedges are not allowed, the behavior must be documented.\n\n```\nsage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c')]\nsage: G = Graph(edgelist, loops=True, multiedges=False)\nsage: G.merge_vertices([0,1]); G.edges()\n[(0, 0, 'c')]\nsage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c'), (1, 2, 'd'), (2, 2, 'e')]\nsage: G = Graph(edgelist, loops=True, multiedges=False)\nsage: G.merge_vertices([0,1,2]); G.edges()\n[(0, 0, 'e')]\nsage: G = Graph(edgelist, loops=True, multiedges=False)\nsage: G.merge_vertices([0,2,1]); G.edges()\n[(0, 0, 'e')]\n```",
    "created_at": "2017-06-24T08:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437381",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:9'></a>
Also, when multiedges are not allowed, the behavior must be documented.

```
sage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c')]
sage: G = Graph(edgelist, loops=True, multiedges=False)
sage: G.merge_vertices([0,1]); G.edges()
[(0, 0, 'c')]
sage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c'), (1, 2, 'd'), (2, 2, 'e')]
sage: G = Graph(edgelist, loops=True, multiedges=False)
sage: G.merge_vertices([0,1,2]); G.edges()
[(0, 0, 'e')]
sage: G = Graph(edgelist, loops=True, multiedges=False)
sage: G.merge_vertices([0,2,1]); G.edges()
[(0, 0, 'e')]
```



---

archive/issue_comments_437382.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [dcoudert](#comment%3A8):\n> This could be more efficient\n> \n> ```\n>         u = vertices[0]\n>         for v in vertices[1:]:\n>             if self.has_edge(v, v):\n>                 if self.allows_multiple_edges():\n>                     for l in self.edge_label(v, v):\n>                         self.add_edge(u, u, l)\n>                 else:\n>                     self.add_edge(u, u, self.edge_label(v, v))\n> ```\n\n\nIs this faster because it specifies the vertices, rather than iterating over a list of edges to get the loops?\n\n> \n> Could you add a test to do nothing when `len(vertices) < 2`.\n> \n> ```\n> sage: G = Graph()\n> sage: G.merge_vertices([None])\n> sage: G\n> Graph on 1 vertex\n> sage: G.merge_vertices([None])\n> sage: G\n> Graph on 2 vertices\n> ```\n\n\nIt's an undocumented feature that `None` as the first entry will give the vertex a new name, and a bug that it will create a new vertex if there's nothing to merge. I'll addressed both.\n\n> Other issue: `TESTS::` -> `TESTS:`\n\n\nIs there a guide where I can see how to correctly mark up documentation? The developer's guide doesn't seem to cover it all, and many of the other methods I've looked at use `TESTS::` and not `TESTS:`. This doesn't seem to be a standard thing for Python docstrings so I'm not sure where to look.",
    "created_at": "2017-06-25T16:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437382",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:10'></a>
Replying to [dcoudert](#comment%3A8):
> This could be more efficient
> 
> ```
>         u = vertices[0]
>         for v in vertices[1:]:
>             if self.has_edge(v, v):
>                 if self.allows_multiple_edges():
>                     for l in self.edge_label(v, v):
>                         self.add_edge(u, u, l)
>                 else:
>                     self.add_edge(u, u, self.edge_label(v, v))
> ```


Is this faster because it specifies the vertices, rather than iterating over a list of edges to get the loops?

> 
> Could you add a test to do nothing when `len(vertices) < 2`.
> 
> ```
> sage: G = Graph()
> sage: G.merge_vertices([None])
> sage: G
> Graph on 1 vertex
> sage: G.merge_vertices([None])
> sage: G
> Graph on 2 vertices
> ```


It's an undocumented feature that `None` as the first entry will give the vertex a new name, and a bug that it will create a new vertex if there's nothing to merge. I'll addressed both.

> Other issue: `TESTS::` -> `TESTS:`


Is there a guide where I can see how to correctly mark up documentation? The developer's guide doesn't seem to cover it all, and many of the other methods I've looked at use `TESTS::` and not `TESTS:`. This doesn't seem to be a standard thing for Python docstrings so I'm not sure where to look.



---

archive/issue_comments_437383.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [zgershkoff](#comment%3A10):\n> Replying to [dcoudert](#comment%3A8):\n> > This could be more efficient\n> > \n> > ```\n> >         u = vertices[0]\n> >         for v in vertices[1:]:\n> >             if self.has_edge(v, v):\n> >                 if self.allows_multiple_edges():\n> >                     for l in self.edge_label(v, v):\n> >                         self.add_edge(u, u, l)\n> >                 else:\n> >                     self.add_edge(u, u, self.edge_label(v, v))\n> > ```\n\n> \n> Is this faster because it specifies the vertices, rather than iterating over a list of edges to get the loops?\n\nThe `loop_edges` method calls the `loop_vertices` method which returns `[v for v in self if self.has_edge(v,v)]` if loops are allowed.\n\nSince `vertices` is a subset of the vertices of the graph, and we can expect this set to be small most of the time (e.g., 2), what I propose should be faster than your first proposal.\n\n \n \n\n> > Could you add a test to do nothing when `len(vertices) < 2`.\n\n \n> > {{{\n> > sage: G = Graph()\n> > sage: G.merge_vertices([None])\n> > sage: G\n> > Graph on 1 vertex\n> > sage: G.merge_vertices([None])\n> > sage: G\n> > Graph on 2 vertices\n> > }}}\n\n> \n> It's an undocumented feature that `None` as the first entry will give the vertex a new name, and a bug that it will create a new vertex if there's nothing to merge. I'll addressed both.\n\n\nIt's documented in the method, 3rd paragraph: `The new vertex is named after the first vertex in the list given in argument. If this first name is None, a new vertex is created.`\n  \n> > Other issue: `TESTS::` -> `TESTS:`\n\n> \n> Is there a guide where I can see how to correctly mark up documentation? The developer's guide doesn't seem to cover it all, and many of the other methods I've looked at use `TESTS::` and not `TESTS:`. This doesn't seem to be a standard thing for Python docstrings so I'm not sure where to look.\n\n\nTo be honest, I don't know. I checked on recent ticket, and #23255 suggests that `TESTS::` is the good form. So keep it as is.",
    "created_at": "2017-06-25T17:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437383",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:11'></a>
Replying to [zgershkoff](#comment%3A10):
> Replying to [dcoudert](#comment%3A8):
> > This could be more efficient
> > 
> > ```
> >         u = vertices[0]
> >         for v in vertices[1:]:
> >             if self.has_edge(v, v):
> >                 if self.allows_multiple_edges():
> >                     for l in self.edge_label(v, v):
> >                         self.add_edge(u, u, l)
> >                 else:
> >                     self.add_edge(u, u, self.edge_label(v, v))
> > ```

> 
> Is this faster because it specifies the vertices, rather than iterating over a list of edges to get the loops?

The `loop_edges` method calls the `loop_vertices` method which returns `[v for v in self if self.has_edge(v,v)]` if loops are allowed.

Since `vertices` is a subset of the vertices of the graph, and we can expect this set to be small most of the time (e.g., 2), what I propose should be faster than your first proposal.

 
 

> > Could you add a test to do nothing when `len(vertices) < 2`.

 
> > {{{
> > sage: G = Graph()
> > sage: G.merge_vertices([None])
> > sage: G
> > Graph on 1 vertex
> > sage: G.merge_vertices([None])
> > sage: G
> > Graph on 2 vertices
> > }}}

> 
> It's an undocumented feature that `None` as the first entry will give the vertex a new name, and a bug that it will create a new vertex if there's nothing to merge. I'll addressed both.


It's documented in the method, 3rd paragraph: `The new vertex is named after the first vertex in the list given in argument. If this first name is None, a new vertex is created.`
  
> > Other issue: `TESTS::` -> `TESTS:`

> 
> Is there a guide where I can see how to correctly mark up documentation? The developer's guide doesn't seem to cover it all, and many of the other methods I've looked at use `TESTS::` and not `TESTS:`. This doesn't seem to be a standard thing for Python docstrings so I'm not sure where to look.


To be honest, I don't know. I checked on recent ticket, and #23255 suggests that `TESTS::` is the good form. So keep it as is.



---

archive/issue_comments_437384.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[ff571d6](https://git.sagemath.org/sage.git/commit/?id=ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f)|`efficiency improvements; bug fix when input is [None]`|",
    "created_at": "2017-06-25T18:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437384",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[ff571d6](https://git.sagemath.org/sage.git/commit/?id=ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f)|`efficiency improvements; bug fix when input is [None]`|



---

archive/issue_comments_437385.json:
```json
{
    "body": "Changing commit from \"412dc9082deb4ed0c7f14cdbee7a37950e0e51a7\" to \"ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f\"",
    "created_at": "2017-06-25T18:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "412dc9082deb4ed0c7f14cdbee7a37950e0e51a7" to "ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f"



---

archive/issue_comments_437386.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [dcoudert](#comment%3A11):\n> To be honest, I don't know. I checked on recent ticket, and #23255 suggests that `TESTS::` is the good form. So keep it as is.\n\n\nJudging from that ticket, the convention is to use `::` when `sage:` follows and `:` when text follows. So in this instance, I should indeed use `TESTS:`. The usage isn't consistent throughout the file but I'm not going to try and fix it within this ticket.\n\nI made the changes you suggested, but I had to change one of the tests:\n\n```\nsage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c'), (1, 2, 'd'), (2, 2, 'e')]\nsage: G = Graph(edgelist, loops=True, multiedges=False)\nsage: G.merge_vertices([0,1,2]); G.edges()\n[(0, 0, 'e')]\nsage: G = Graph(edgelist, loops=True, multiedges=False)\nsage: G.merge_vertices([0,2,1]); G.edges()\n[(0, 0, 'e')]\n```\n\nI think the last output should be `[(0, 0, 'c')]`, and that's what the code currently returns, since it evaluates vertex `1` last and finds the label `'c'` last.",
    "created_at": "2017-06-25T18:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437386",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

<a id='comment:13'></a>
Replying to [dcoudert](#comment%3A11):
> To be honest, I don't know. I checked on recent ticket, and #23255 suggests that `TESTS::` is the good form. So keep it as is.


Judging from that ticket, the convention is to use `::` when `sage:` follows and `:` when text follows. So in this instance, I should indeed use `TESTS:`. The usage isn't consistent throughout the file but I'm not going to try and fix it within this ticket.

I made the changes you suggested, but I had to change one of the tests:

```
sage: edgelist = [(0,0,'a'),(0,1,'b'),(1,1,'c'), (1, 2, 'd'), (2, 2, 'e')]
sage: G = Graph(edgelist, loops=True, multiedges=False)
sage: G.merge_vertices([0,1,2]); G.edges()
[(0, 0, 'e')]
sage: G = Graph(edgelist, loops=True, multiedges=False)
sage: G.merge_vertices([0,2,1]); G.edges()
[(0, 0, 'e')]
```

I think the last output should be `[(0, 0, 'c')]`, and that's what the code currently returns, since it evaluates vertex `1` last and finds the label `'c'` last.



---

archive/issue_comments_437387.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-25T18:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437387",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437388.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-25T19:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437388",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437389.json:
```json
{
    "body": "<a id='comment:15'></a>\nThat's much better now. Thanks.",
    "created_at": "2017-06-25T19:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437389",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
That's much better now. Thanks.



---

archive/issue_events_059998.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-26T21:24:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23290#event-59998"
}
```



---

archive/issue_comments_437390.json:
```json
{
    "body": "Changing branch from \"u/zgershkoff/graph_merge_vertices___destroys_loops\" to \"ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f\"",
    "created_at": "2017-06-26T21:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437390",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/zgershkoff/graph_merge_vertices___destroys_loops" to "ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f"



---

archive/issue_comments_437391.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-26T21:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437391",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_437392.json:
```json
{
    "body": "Changing commit from \"ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f\" to \"\"",
    "created_at": "2017-10-24T15:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437392",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "ff571d6699ab233eedaf3b9d4a417ef6a1f6c56f" to ""



---

archive/issue_comments_437393.json:
```json
{
    "body": "Changing author from \"Zachary Gershkoff\" to \"Zach Gershkoff\"",
    "created_at": "2017-10-24T15:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23290#issuecomment-437393",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Zachary Gershkoff" to "Zach Gershkoff"
