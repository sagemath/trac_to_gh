# Issue 23411: Fix pickling of matrix_gfpn_dense

archive/issues_023174.json:
```json
{
    "assignees": [],
    "body": "There currently are two problems related with pickling of `Matrix_gfpn_dense`: \n- When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.\n- The number of bytes used holding the data of a matrix row is machine independent. However, the number of bytes actually used to store the row always is a multiple of `sizeof(long)`, which is machine dependent (at least in theory). Pickling should of course only involve the machine independent memory chunks, but currently it involves the machine dependent chunks.\n\nComponent: **packages: optional**\n\nAuthor: **Simon King**\n\nBranch/Commit: **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23411_\n\n",
    "closed_at": "2017-07-29T15:30:47Z",
    "created_at": "2017-07-12T14:19:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix pickling of matrix_gfpn_dense",
    "type": "issue",
    "updated_at": "2017-07-29T15:30:47Z",
    "url": "https://github.com/sagemath/sage/issues/23411",
    "user": "https://github.com/simon-king-jena"
}
```
There currently are two problems related with pickling of `Matrix_gfpn_dense`: 
- When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.
- The number of bytes used holding the data of a matrix row is machine independent. However, the number of bytes actually used to store the row always is a multiple of `sizeof(long)`, which is machine dependent (at least in theory). Pickling should of course only involve the machine independent memory chunks, but currently it involves the machine dependent chunks.

Component: **packages: optional**

Author: **Simon King**

Branch/Commit: **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23411_





---

archive/issue_events_322998.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:19:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-322998"
}
```



---

archive/issue_events_322999.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-322999"
}
```



---

archive/issue_events_323000.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323000"
}
```



---

archive/issue_events_323001.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T14:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323001"
}
```



---

archive/issue_comments_351572.json:
```json
{
    "body": "Branch: **[u/SimonKing/fix_pickling_of_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_pickling_of_matrix_gfpn_dense)**",
    "created_at": "2017-07-12T15:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351572",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/fix_pickling_of_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_pickling_of_matrix_gfpn_dense)**



---

archive/issue_events_323002.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:09:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323002"
}
```



---

archive/issue_comments_351573.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2017-07-12T15:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351573",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_351574.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4960a8166debbb446e7da6f26586d742e9f12f0d\"><code>4960a81</code></a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891\"><code>4e85fca</code></a></td><td><code>Make pickling of matrix_gfpn_dense machine independent</code></td></tr></table>\n",
    "created_at": "2017-07-12T15:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351574",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4960a8166debbb446e7da6f26586d742e9f12f0d"><code>4960a81</code></a></td><td><code>Fix reading mtx-matrix from non-existent file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891"><code>4e85fca</code></a></td><td><code>Make pickling of matrix_gfpn_dense machine independent</code></td></tr></table>




---

archive/issue_comments_351575.json:
```json
{
    "body": "Commit: **[`4e85fca`](https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891)**",
    "created_at": "2017-07-12T15:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351575",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[`4e85fca`](https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891)**



---

archive/issue_comments_351576.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSorry, one commit is missing",
    "created_at": "2017-07-12T15:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351576",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

Sorry, one commit is missing



---

archive/issue_events_323003.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:12:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323003"
}
```



---

archive/issue_events_323004.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:12:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323004"
}
```



---

archive/issue_comments_351577.json:
```json
{
    "body": "Changed commit from **[`4e85fca`](https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891)** to **[`f9d878a`](https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7)**",
    "created_at": "2017-07-12T15:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351577",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e85fca`](https://github.com/sagemath/sagetrac-mirror/commit/4e85fca604650a1f29ff2ae13aa1263737685891)** to **[`f9d878a`](https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7)**



---

archive/issue_comments_351578.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7\"><code>f9d878a</code></a></td><td><code>Add test for reading from non-existing file; add cimports</code></td></tr></table>\n",
    "created_at": "2017-07-12T15:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351578",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7"><code>f9d878a</code></a></td><td><code>Add test for reading from non-existing file; add cimports</code></td></tr></table>




---

archive/issue_events_323005.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:49:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323005"
}
```



---

archive/issue_events_323006.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-12T15:49:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323006"
}
```



---

archive/issue_comments_351579.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNow it builds and tests are passing...",
    "created_at": "2017-07-12T15:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351579",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Now it builds and tests are passing...



---

archive/issue_events_323007.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T09:50:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323007"
}
```



---

archive/issue_events_323008.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T09:50:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323008"
}
```



---

archive/issue_comments_351580.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.\n\n2. If you claim that this makes pickling machine-independent, it would be good to actually test that. You can hardcode a pickle in a doctest (essentially, the output of `dumps()`) and then test that.",
    "created_at": "2017-07-13T09:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351580",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.

2. If you claim that this makes pickling machine-independent, it would be good to actually test that. You can hardcode a pickle in a doctest (essentially, the output of `dumps()`) and then test that.



---

archive/issue_comments_351581.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jdemeyer](#comment%3A6):\n> 1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.\n\nYou also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.\n\n> 2. If you claim that this makes pickling machine-independent, it would be good to actually test that. You can hardcode a pickle in a doctest (essentially, the output of `dumps()`) and then test that.\n\nOK. Just to be on the safe side: You do not say that I should imitate a pickle string that results from a machine where, say, `sizeof(long)==3`? Cause otherwise we would never see the deprecation warning.",
    "created_at": "2017-07-13T10:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351581",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jdemeyer](#comment%3A6):
> 1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.

You also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.

> 2. If you claim that this makes pickling machine-independent, it would be good to actually test that. You can hardcode a pickle in a doctest (essentially, the output of `dumps()`) and then test that.

OK. Just to be on the safe side: You do not say that I should imitate a pickle string that results from a machine where, say, `sizeof(long)==3`? Cause otherwise we would never see the deprecation warning.



---

archive/issue_comments_351582.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@simon-king-jena](#comment%3A7):\n> You also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.\n\nPS: Adding such patch would also imply to modify the lines where I import the `PyString...` functions, which means that there will be further conflicts with #21437.",
    "created_at": "2017-07-13T10:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351582",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@simon-king-jena](#comment%3A7):
> You also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.

PS: Adding such patch would also imply to modify the lines where I import the `PyString...` functions, which means that there will be further conflicts with #21437.



---

archive/issue_comments_351583.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa\"><code>e477948</code></a></td><td><code>Test meataxe unpickling being machine independent</code></td></tr></table>\n",
    "created_at": "2017-07-13T11:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351583",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa"><code>e477948</code></a></td><td><code>Test meataxe unpickling being machine independent</code></td></tr></table>




---

archive/issue_comments_351584.json:
```json
{
    "body": "Changed commit from **[`f9d878a`](https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7)** to **[`e477948`](https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa)**",
    "created_at": "2017-07-13T11:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351584",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f9d878a`](https://github.com/sagemath/sagetrac-mirror/commit/f9d878abdf0c0742ffaeefe2176c5217521b3dd7)** to **[`e477948`](https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa)**



---

archive/issue_comments_351585.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIn the latest commit, I add a test that should demonstrate machine independence of pickling (provided that the patchbots provide a whole lot of different architectures, including little and big endian and different sizes of `long`). I also add a test that triggers the deprecation warning.\n\nI am not really happy about doing part of the code cleanup here. Would you accept to do all cleanup on a separate ticket. If you do, then please consider this ticket as \"needs review\".",
    "created_at": "2017-07-13T11:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351585",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

In the latest commit, I add a test that should demonstrate machine independence of pickling (provided that the patchbots provide a whole lot of different architectures, including little and big endian and different sizes of `long`). I also add a test that triggers the deprecation warning.

I am not really happy about doing part of the code cleanup here. Would you accept to do all cleanup on a separate ticket. If you do, then please consider this ticket as "needs review".



---

archive/issue_comments_351586.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSetting it to \"needs review\" in order to allow the patchbots to test the ticket.",
    "created_at": "2017-07-13T11:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351586",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

Setting it to "needs review" in order to allow the patchbots to test the ticket.



---

archive/issue_events_323009.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T11:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323009"
}
```



---

archive/issue_events_323010.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T11:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323010"
}
```



---

archive/issue_comments_351587.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a\"><code>01e2c0d</code></a></td><td><code>Mark new meataxe test 'optional'</code></td></tr></table>\n",
    "created_at": "2017-07-13T12:37:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351587",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a"><code>01e2c0d</code></a></td><td><code>Mark new meataxe test 'optional'</code></td></tr></table>




---

archive/issue_comments_351588.json:
```json
{
    "body": "Changed commit from **[`e477948`](https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa)** to **[`01e2c0d`](https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a)**",
    "created_at": "2017-07-13T12:37:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351588",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e477948`](https://github.com/sagemath/sagetrac-mirror/commit/e477948bb0a393997082fffea411e1724517ecaa)** to **[`01e2c0d`](https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a)**



---

archive/issue_comments_351589.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nQuestion: Will the buildbot automatically test with and without meataxe being installed? If not: How can I advice the buildbot to do so?",
    "created_at": "2017-07-13T12:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351589",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

Question: Will the buildbot automatically test with and without meataxe being installed? If not: How can I advice the buildbot to do so?



---

archive/issue_comments_351590.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@simon-king-jena](#comment%3A7):\n> Replying to [@jdemeyer](#comment%3A6):\n> > 1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.\n\n> \n> You also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.\n\nIt's just a bit strange that you write \"unclean\" code in one ticket and then at the same time have another ticket to clean it up.\n\nBut that's not a big deal since the old code also uses strings.",
    "created_at": "2017-07-13T13:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351590",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@simon-king-jena](#comment%3A7):
> Replying to [@jdemeyer](#comment%3A6):
> > 1. As I mentioned on some other ticket, use `bytes` instead of `str` for pickling.

> 
> You also said I should split my original patchbomb into smaller parts. That's why I wanted to leave the transition from `str` to `bytes` for a ticket dedicated to cleaning code.

It's just a bit strange that you write "unclean" code in one ticket and then at the same time have another ticket to clean it up.

But that's not a big deal since the old code also uses strings.



---

archive/issue_comments_351591.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAlso in some other ticket, I made the comment that you should use floor division (`//`) if that's what you want.",
    "created_at": "2017-07-13T13:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351591",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Also in some other ticket, I made the comment that you should use floor division (`//`) if that's what you want.



---

archive/issue_events_323011.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T13:39:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323011"
}
```



---

archive/issue_events_323012.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T13:39:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323012"
}
```



---

archive/issue_comments_351592.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nPlease do not use the `for ... from ...` syntax. Cython understands `range()`.",
    "created_at": "2017-07-13T13:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351592",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Please do not use the `for ... from ...` syntax. Cython understands `range()`.



---

archive/issue_comments_351593.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWhen unpickling, it seems that there is no protecting against reading out of bounds. The case where `x` is too short should be handled gracefully. The code should be more like:\n\n```\nif len(Data) == expected_size:\n    # Handle new-style pickle\nelif len(Data) == expected_size_for_old_pickle:\n    # Handle deprecated pickle\nelse:\n    raise ValueError(f\"expected a pickle with {expected_size} bytes, got {len(Data)} instead\")\n```\nEDIT: note the swapped conditions. It is possible that `expected_size == expected_size_for_old_pickle`.\n\nAnd a small detail: you write twice `x = PyString_AsString(Data)` while once (outside the branch) should be sufficient.",
    "created_at": "2017-07-13T13:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351593",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

When unpickling, it seems that there is no protecting against reading out of bounds. The case where `x` is too short should be handled gracefully. The code should be more like:

```
if len(Data) == expected_size:
    # Handle new-style pickle
elif len(Data) == expected_size_for_old_pickle:
    # Handle deprecated pickle
else:
    raise ValueError(f"expected a pickle with {expected_size} bytes, got {len(Data)} instead")
```
EDIT: note the swapped conditions. It is possible that `expected_size == expected_size_for_old_pickle`.

And a small detail: you write twice `x = PyString_AsString(Data)` while once (outside the branch) should be sufficient.



---

archive/issue_comments_351594.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment%3A14):\n> It's just a bit strange that you write \"unclean\" code in one ticket and then at the same time have another ticket to clean it up.\n> \n> But that's not a big deal since the old code also uses strings.\n\nRight. And you spotted further problems with the code added by this ticket.\n\nSo, I guess it is better to clean the new code, although it will imply manual merging in other tickets.",
    "created_at": "2017-07-13T14:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351594",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment%3A14):
> It's just a bit strange that you write "unclean" code in one ticket and then at the same time have another ticket to clean it up.
> 
> But that's not a big deal since the old code also uses strings.

Right. And you spotted further problems with the code added by this ticket.

So, I guess it is better to clean the new code, although it will imply manual merging in other tickets.



---

archive/issue_comments_351595.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIf I were you, I would first focus on getting these first tickets accepted, otherwise you will be forever merging and rebasing :-)",
    "created_at": "2017-07-13T14:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351595",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

If I were you, I would first focus on getting these first tickets accepted, otherwise you will be forever merging and rebasing :-)



---

archive/issue_comments_351596.json:
```json
{
    "body": "Changed commit from **[`01e2c0d`](https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a)** to **[`d174835`](https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea)**",
    "created_at": "2017-07-13T14:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351596",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`01e2c0d`](https://github.com/sagemath/sagetrac-mirror/commit/01e2c0dcbcf05ef8dbe4b1f83b8334873ebd6f5a)** to **[`d174835`](https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea)**



---

archive/issue_comments_351597.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea\"><code>d174835</code></a></td><td><code>Check bounds when unpickling meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-13T14:38:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351597",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea"><code>d174835</code></a></td><td><code>Check bounds when unpickling meataxe matrices</code></td></tr></table>




---

archive/issue_events_323013.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T14:39:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323013"
}
```



---

archive/issue_events_323014.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-13T14:39:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323014"
}
```



---

archive/issue_comments_351598.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment%3A19):\n> If I were you, I would first focus on getting these first tickets accepted, otherwise you will be forever merging and rebasing :-)\n\nHooray, it merges cleanly into #21437...\n\nI guess I'll wait a while till I move on to #23400.",
    "created_at": "2017-07-13T14:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351598",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment%3A19):
> If I were you, I would first focus on getting these first tickets accepted, otherwise you will be forever merging and rebasing :-)

Hooray, it merges cleanly into #21437...

I guess I'll wait a while till I move on to #23400.



---

archive/issue_comments_351599.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nPS: Perhaps it would have been better to *first* clean the existing code, and then do the bug fixes and additions. But I suppose I shouldn't change the order of tickets again, or should I?",
    "created_at": "2017-07-13T14:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351599",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

PS: Perhaps it would have been better to *first* clean the existing code, and then do the bug fixes and additions. But I suppose I shouldn't change the order of tickets again, or should I?



---

archive/issue_events_323015.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T14:57:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323015"
}
```



---

archive/issue_events_323016.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-13T14:57:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323016"
}
```



---

archive/issue_comments_351600.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis is a potential division by zero:\n\n```\ncdef size_t pickled_rowsize = lenData//nr\n```\nIt would be good to add a doctest for the case `nr == 0`.\n\nI think the best solution is to replace the condition `if Data` by `if nr`.",
    "created_at": "2017-07-13T14:57:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351600",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

This is a potential division by zero:

```
cdef size_t pickled_rowsize = lenData//nr
```
It would be good to add a doctest for the case `nr == 0`.

I think the best solution is to replace the condition `if Data` by `if nr`.



---

archive/issue_comments_351601.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd\"><code>8873330</code></a></td><td><code>Mark further meataxe tests optional; fix potential zero division</code></td></tr></table>\n",
    "created_at": "2017-07-15T11:39:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351601",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd"><code>8873330</code></a></td><td><code>Mark further meataxe tests optional; fix potential zero division</code></td></tr></table>




---

archive/issue_comments_351602.json:
```json
{
    "body": "Changed commit from **[`d174835`](https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea)** to **[`8873330`](https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd)**",
    "created_at": "2017-07-15T11:39:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351602",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d174835`](https://github.com/sagemath/sagetrac-mirror/commit/d1748351fe1ab0201647ce98b83c29188534a2ea)** to **[`8873330`](https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd)**



---

archive/issue_comments_351603.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766\"><code>7a1ed5a</code></a></td><td><code>Meataxe unpickling: Further consistency checks</code></td></tr></table>\n",
    "created_at": "2017-07-15T11:48:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351603",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766"><code>7a1ed5a</code></a></td><td><code>Meataxe unpickling: Further consistency checks</code></td></tr></table>




---

archive/issue_comments_351604.json:
```json
{
    "body": "Changed commit from **[`8873330`](https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd)** to **[`7a1ed5a`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766)**",
    "created_at": "2017-07-15T11:48:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351604",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8873330`](https://github.com/sagemath/sagetrac-mirror/commit/8873330db79f5aa72de43f9be0e7babba07b05dd)** to **[`7a1ed5a`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766)**



---

archive/issue_events_323017.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-15T11:50:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323017"
}
```



---

archive/issue_events_323018.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-15T11:50:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323018"
}
```



---

archive/issue_comments_351605.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAssertions are meant to guard against bugs, not against invalid input. Your `assert` should be a `raise ValueError`.",
    "created_at": "2017-07-17T08:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351605",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Assertions are meant to guard against bugs, not against invalid input. Your `assert` should be a `raise ValueError`.



---

archive/issue_events_323019.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-17T08:38:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323019"
}
```



---

archive/issue_events_323020.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-17T08:38:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323020"
}
```



---

archive/issue_comments_351606.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nIt would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.",
    "created_at": "2017-07-17T08:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351606",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

It would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.



---

archive/issue_comments_351607.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment%3A28):\n> Assertions are meant to guard against bugs, not against invalid input. Your `assert` should be a `raise ValueError`.\n\nOK. And I guess since I am touching some sub-optimal code here (using `PyString...`), it'd be better to clean this here, not in #23400",
    "created_at": "2017-07-17T08:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351607",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment%3A28):
> Assertions are meant to guard against bugs, not against invalid input. Your `assert` should be a `raise ValueError`.

OK. And I guess since I am touching some sub-optimal code here (using `PyString...`), it'd be better to clean this here, not in #23400



---

archive/issue_comments_351608.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jdemeyer](#comment%3A29):\n> It would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.\n\nDo you mean a test with hard-coded pickle string? Or a test in the form `loads(dumps(M))==M`?",
    "created_at": "2017-07-17T08:43:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351608",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jdemeyer](#comment%3A29):
> It would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.

Do you mean a test with hard-coded pickle string? Or a test in the form `loads(dumps(M))==M`?



---

archive/issue_comments_351609.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@simon-king-jena](#comment%3A31):\n> Replying to [@jdemeyer](#comment%3A29):\n> > It would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.\n\n> \n> Do you mean a test with hard-coded pickle string? Or a test in the form `loads(dumps(M))==M`?\n\nI meant the latter.  Although an explicit call to `mtx_unpickle` with empty `Data` would be good also.",
    "created_at": "2017-07-17T08:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351609",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@simon-king-jena](#comment%3A31):
> Replying to [@jdemeyer](#comment%3A29):
> > It would be good to add doctests for *correct* unpickling of matrices with zero rows or columns.

> 
> Do you mean a test with hard-coded pickle string? Or a test in the form `loads(dumps(M))==M`?

I meant the latter.  Although an explicit call to `mtx_unpickle` with empty `Data` would be good also.



---

archive/issue_comments_351610.json:
```json
{
    "body": "Replying to [ticket:23411 SimonKing]:\n> - When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.\n\nI don't like your fix for this for several reasons:\n\n1. I can't actually reproduce the issue. Without this patch, the doctest that you added passes. I think this is because the memory for Python objects is automatically initialized with all zeros.\n\n2. If the result of `__cinit__` is really invalid in some way, then it means that there is something wrong with `__cinit__`. Most importantly, `__cinit__` should already return an object which doesn't cause segfaults.\n\n3. A non-existing file should be an error, not something to be silently ignored.\n\n4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? At a minimum, you should document in a comment why you are doing it this way.\n\nFrom reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.",
    "created_at": "2017-07-17T09:10:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351610",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23411 SimonKing]:
> - When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.

I don't like your fix for this for several reasons:

1. I can't actually reproduce the issue. Without this patch, the doctest that you added passes. I think this is because the memory for Python objects is automatically initialized with all zeros.

2. If the result of `__cinit__` is really invalid in some way, then it means that there is something wrong with `__cinit__`. Most importantly, `__cinit__` should already return an object which doesn't cause segfaults.

3. A non-existing file should be an error, not something to be silently ignored.

4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? At a minimum, you should document in a comment why you are doing it this way.

From reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.



---

archive/issue_comments_351611.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b\"><code>f274beb</code></a></td><td><code>Meataxe unpickling: Further corner cases</code></td></tr></table>\n",
    "created_at": "2017-07-17T09:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351611",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b"><code>f274beb</code></a></td><td><code>Meataxe unpickling: Further corner cases</code></td></tr></table>




---

archive/issue_comments_351612.json:
```json
{
    "body": "Changed commit from **[`7a1ed5a`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766)** to **[`f274beb`](https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b)**",
    "created_at": "2017-07-17T09:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351612",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7a1ed5a`](https://github.com/sagemath/sagetrac-mirror/commit/7a1ed5adf98cdbfbc4300205faa584df83728766)** to **[`f274beb`](https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b)**



---

archive/issue_comments_351613.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jdemeyer](#comment%3A33):\n> Replying to [ticket:23411 SimonKing]:\n> > - When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.\n\n> \n> I don't like your fix for this for several reasons:\n> \n> 1. I can't actually reproduce the issue.\n\nStrange. has there been a recent change in Cython? If I recall correctly, reading from a non-existing file left the matrix in an undefined state. In particular, it was possible that the `self.Data` pointer was *not* NULL.\n\n> 3. A non-existing file should be an error, not something to be silently ignored.\n\nOK.\n \n> 4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? At a minimum, you should document in a comment why you are doing it this way.\n> \n> From reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.\n\nIf it is really the case that I can rely on `self.Data` being initialised to NULL, then I guess removing `__cinit__` is fine.",
    "created_at": "2017-07-17T09:24:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351613",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jdemeyer](#comment%3A33):
> Replying to [ticket:23411 SimonKing]:
> > - When a string is provided as argument to `__init__`, it is interpreted as the name of a file from which data are read by some MeatAxe command. If the file doesn't exist, it was intended to have an uninitialised matrix (to be properly initialised later). But currently it crashes, which needs to be fixed.

> 
> I don't like your fix for this for several reasons:
> 
> 1. I can't actually reproduce the issue.

Strange. has there been a recent change in Cython? If I recall correctly, reading from a non-existing file left the matrix in an undefined state. In particular, it was possible that the `self.Data` pointer was *not* NULL.

> 3. A non-existing file should be an error, not something to be silently ignored.

OK.
 
> 4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? At a minimum, you should document in a comment why you are doing it this way.
> 
> From reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.

If it is really the case that I can rely on `self.Data` being initialised to NULL, then I guess removing `__cinit__` is fine.



---

archive/issue_comments_351614.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc\"><code>6586e97</code></a></td><td><code>Sanitise meataxe matrix initialisation</code></td></tr></table>\n",
    "created_at": "2017-07-17T09:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351614",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc"><code>6586e97</code></a></td><td><code>Sanitise meataxe matrix initialisation</code></td></tr></table>




---

archive/issue_comments_351615.json:
```json
{
    "body": "Changed commit from **[`f274beb`](https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b)** to **[`6586e97`](https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc)**",
    "created_at": "2017-07-17T09:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351615",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f274beb`](https://github.com/sagemath/sagetrac-mirror/commit/f274beb66bfee75ff975b72795ffbafb5cdd178b)** to **[`6586e97`](https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc)**



---

archive/issue_comments_351616.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment%3A33):\n> Replying to [ticket:23411 SimonKing]:\n> 2. If the result of `__cinit__` is really invalid in some way, then it means that there is something wrong with `__cinit__`. Most importantly, `__cinit__` should already return an object which doesn't cause segfaults.\n\nThat is the case, provided that `self.Data` is correctly initialised to NULL by cython.\n \n> 3. A non-existing file should be an error, not something to be silently ignored.\n\nDone. Now, an error raised by MeatAxe is propagated.\n\n> 4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? \n\nNo, one can simply catch the resulting error, if one likes...\n\n> From reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.\n\nDone. And the tests pass :)",
    "created_at": "2017-07-17T09:59:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351616",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment%3A33):
> Replying to [ticket:23411 SimonKing]:
> 2. If the result of `__cinit__` is really invalid in some way, then it means that there is something wrong with `__cinit__`. Most importantly, `__cinit__` should already return an object which doesn't cause segfaults.

That is the case, provided that `self.Data` is correctly initialised to NULL by cython.
 
> 3. A non-existing file should be an error, not something to be silently ignored.

Done. Now, an error raised by MeatAxe is propagated.

> 4. Do you really need to open the file in Python and then close it and then let MeatAxe open it again? 

No, one can simply catch the resulting error, if one likes...

> From reading the code, I think the best solution would be to remove `__cinit__` completely and handle all initialization in `__init__`.

Done. And the tests pass :)



---

archive/issue_events_323021.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T09:59:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323021"
}
```



---

archive/issue_events_323022.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T09:59:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323022"
}
```



---

archive/issue_comments_351617.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThere is something wrong with the indentation here:\n\n```\n        5. Creating a matrix from a file in MeatAxe format. If the file doesn't exist,\n            an error raised by the MeatAxe library is propagated::\n\n            sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe\n            Traceback (most recent call last):\n            ...\n            SystemError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)\n```\nCorrect indentation would be\n\n```\n        5.  Creating a matrix from a file in MeatAxe format. If the file doesn't exist,\n            an error raised by the MeatAxe library is propagated::\n\n                sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe\n                Traceback (most recent call last):\n                ...\n                SystemError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)\n```\n(note the double space after `5.` to make allow 4 spaces of indentation on the next line)",
    "created_at": "2017-07-17T11:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351617",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

There is something wrong with the indentation here:

```
        5. Creating a matrix from a file in MeatAxe format. If the file doesn't exist,
            an error raised by the MeatAxe library is propagated::

            sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe
            Traceback (most recent call last):
            ...
            SystemError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)
```
Correct indentation would be

```
        5.  Creating a matrix from a file in MeatAxe format. If the file doesn't exist,
            an error raised by the MeatAxe library is propagated::

                sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe
                Traceback (most recent call last):
                ...
                SystemError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)
```
(note the double space after `5.` to make allow 4 spaces of indentation on the next line)



---

archive/issue_events_323023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-17T11:49:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323023"
}
```



---

archive/issue_events_323024.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-17T11:49:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323024"
}
```



---

archive/issue_comments_351618.json:
```json
{
    "body": "Changed commit from **[`6586e97`](https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc)** to **[`77bc58b`](https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2)**",
    "created_at": "2017-07-17T11:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351618",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6586e97`](https://github.com/sagemath/sagetrac-mirror/commit/6586e97ae1f092eb3a8d2ad9d0da4c7728a87cdc)** to **[`77bc58b`](https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2)**



---

archive/issue_comments_351619.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2\"><code>77bc58b</code></a></td><td><code>Fix indentation in meataxe matrix `__init__` doc</code></td></tr></table>\n",
    "created_at": "2017-07-17T11:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351619",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2"><code>77bc58b</code></a></td><td><code>Fix indentation in meataxe matrix `__init__` doc</code></td></tr></table>




---

archive/issue_events_323025.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T11:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323025"
}
```



---

archive/issue_events_323026.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T11:54:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323026"
}
```



---

archive/issue_comments_351620.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nWhat is the purpose of\n\n```\n            if not parent:\n                self._cache == {}\n```\n\nIt seems that you want to allow `Matrix_gfpn_dense(\"\")` to return an uninitialized matrix but I wonder why. If you *really* want that for some reason, it would be better to replace `if parent is None` above by `if not parent`.",
    "created_at": "2017-07-17T11:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351620",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

What is the purpose of

```
            if not parent:
                self._cache == {}
```

It seems that you want to allow `Matrix_gfpn_dense("")` to return an uninitialized matrix but I wonder why. If you *really* want that for some reason, it would be better to replace `if parent is None` above by `if not parent`.



---

archive/issue_comments_351621.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nExcept for my last comment, this ticket is fine for me.",
    "created_at": "2017-07-17T11:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351621",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Except for my last comment, this ticket is fine for me.



---

archive/issue_comments_351622.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@jdemeyer](#comment%3A42):\n> What is the purpose of\n> \n> ```\n>             if not parent:\n>                 self._cache == {}\n> ```\n> \n> It seems that you want to allow `Matrix_gfpn_dense(\"\")` to return an uninitialized matrix but I wonder why. If you *really* want that for some reason, it would be better to replace `if parent is None` above by `if not parent`.\n\nI do use uninitialised meataxe matrices in some application (of course in my group cohomology package), namely when I want to create a `Matrix_gfpn_dense` from an existing `Matrix_t*`. But your suggestion makes perfect sense.",
    "created_at": "2017-07-17T12:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351622",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@jdemeyer](#comment%3A42):
> What is the purpose of
> 
> ```
>             if not parent:
>                 self._cache == {}
> ```
> 
> It seems that you want to allow `Matrix_gfpn_dense("")` to return an uninitialized matrix but I wonder why. If you *really* want that for some reason, it would be better to replace `if parent is None` above by `if not parent`.

I do use uninitialised meataxe matrices in some application (of course in my group cohomology package), namely when I want to create a `Matrix_gfpn_dense` from an existing `Matrix_t*`. But your suggestion makes perfect sense.



---

archive/issue_comments_351623.json:
```json
{
    "body": "Changed commit from **[`77bc58b`](https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2)** to **[`5106ebb`](https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c)**",
    "created_at": "2017-07-17T12:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351623",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`77bc58b`](https://github.com/sagemath/sagetrac-mirror/commit/77bc58b647af83ca457798bd57e7c57b57a1a6a2)** to **[`5106ebb`](https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c)**



---

archive/issue_comments_351624.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c\"><code>5106ebb</code></a></td><td><code>Simplified code path for uninitialised meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-17T12:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351624",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c"><code>5106ebb</code></a></td><td><code>Simplified code path for uninitialised meataxe matrices</code></td></tr></table>




---

archive/issue_comments_351625.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nDone!",
    "created_at": "2017-07-17T12:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351625",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

Done!



---

archive/issue_comments_351626.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@simon-king-jena](#comment%3A44):\n> I do use uninitialised meataxe matrices in some application\n\nI would argue that the *proper* way to get an \"uninitialised meataxe matrix\" is precisely to do `Matrix_gfpn_dense.__new__(Matrix_gfpn_dense)`.\n\nThis idiom of using `__new__` and then manually filling in a data structure is used a lot in Sage. For example, in the `numerator` method for rational numbers:\n\n```\n    def numerator(self):\n        cdef Integer n = Integer.__new__(Integer)\n        n.set_from_mpz(mpq_numref(self.value))\n        return n\n```",
    "created_at": "2017-07-17T12:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351626",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@simon-king-jena](#comment%3A44):
> I do use uninitialised meataxe matrices in some application

I would argue that the *proper* way to get an "uninitialised meataxe matrix" is precisely to do `Matrix_gfpn_dense.__new__(Matrix_gfpn_dense)`.

This idiom of using `__new__` and then manually filling in a data structure is used a lot in Sage. For example, in the `numerator` method for rational numbers:

```
    def numerator(self):
        cdef Integer n = Integer.__new__(Integer)
        n.set_from_mpz(mpq_numref(self.value))
        return n
```



---

archive/issue_events_323027.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T12:26:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323027"
}
```



---

archive/issue_events_323028.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T12:26:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323028"
}
```



---

archive/issue_comments_351627.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@jdemeyer](#comment%3A47):\n> I would argue that the *proper* way to get an \"uninitialised meataxe matrix\" is precisely to do `Matrix_gfpn_dense.__new__(Matrix_gfpn_dense)`.\n\nActually I just checked: I am using the `.__new__` thing in some part of my cohomology code, and in some other parts I'd really better do it as well. I suppose it should be removed.",
    "created_at": "2017-07-17T12:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351627",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@jdemeyer](#comment%3A47):
> I would argue that the *proper* way to get an "uninitialised meataxe matrix" is precisely to do `Matrix_gfpn_dense.__new__(Matrix_gfpn_dense)`.

Actually I just checked: I am using the `.__new__` thing in some part of my cohomology code, and in some other parts I'd really better do it as well. I suppose it should be removed.



---

archive/issue_comments_351628.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nPS: Also note the statement in the docstring of `__init__`, where I say that the case `parent = None` is used for unpickling --- which is not true, as I am using `__new__` there as well!",
    "created_at": "2017-07-17T12:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351628",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:49" align="right">comment:49</div>

PS: Also note the statement in the docstring of `__init__`, where I say that the case `parent = None` is used for unpickling --- which is not true, as I am using `__new__` there as well!



---

archive/issue_comments_351629.json:
```json
{
    "body": "Changed commit from **[`5106ebb`](https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c)** to **[`3d94133`](https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272)**",
    "created_at": "2017-07-17T12:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351629",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5106ebb`](https://github.com/sagemath/sagetrac-mirror/commit/5106ebb42dcc69206b33d15c4a96f8a14fbc2f8c)** to **[`3d94133`](https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272)**



---

archive/issue_comments_351630.json:
```json
{
    "body": "<div id=\"comment:50\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272\"><code>3d94133</code></a></td><td><code>Remove codepath for creating uninitialised meataxe matrix</code></td></tr></table>\n",
    "created_at": "2017-07-17T12:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351630",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:50"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272"><code>3d94133</code></a></td><td><code>Remove codepath for creating uninitialised meataxe matrix</code></td></tr></table>




---

archive/issue_comments_351631.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nAvoid `six` in Cython files if possible! Please revert to `basestring`.",
    "created_at": "2017-07-17T12:39:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351631",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Avoid `six` in Cython files if possible! Please revert to `basestring`.



---

archive/issue_comments_351632.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@jdemeyer](#comment%3A51):\n> Avoid `six` in Cython files if possible! Please revert to `basestring`.\n\nReally? I thought this was needed to make things Python3 compliant. OK, I'll revert it.\n\nSomething else: If the MeatAxe function `MatLoad` gets an empty file name, it apparently just returns the NULL pointer, but doesn't raise an error. What shall I do? Shall I change\n`Matrix_t *MatLoad(char *fn) except NULL` into `Matrix_t *MatLoad(char *fn) except? NULL` (or what's the syntax if NULL can also be returned without an error)?",
    "created_at": "2017-07-17T12:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351632",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@jdemeyer](#comment%3A51):
> Avoid `six` in Cython files if possible! Please revert to `basestring`.

Really? I thought this was needed to make things Python3 compliant. OK, I'll revert it.

Something else: If the MeatAxe function `MatLoad` gets an empty file name, it apparently just returns the NULL pointer, but doesn't raise an error. What shall I do? Shall I change
`Matrix_t *MatLoad(char *fn) except NULL` into `Matrix_t *MatLoad(char *fn) except? NULL` (or what's the syntax if NULL can also be returned without an error)?



---

archive/issue_comments_351633.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@simon-king-jena](#comment%3A52):\n> I thought this was needed to make things Python3 compliant.\n\nYes, `six` is needed to make things Python 3 compliant.\n\nHowever, Cython is a language by itself. Cython is not Python 2 and it's not Python 3. Cython tries to be compatible with Python 2 and Python 3. This makes porting Cython code to Python 3 much easier than porting Python code.\n\nOf course, some Cython code is really just Python code and that code can depend on the Python version. And there are some incompatibilities that Cython cannot fix: support for `__cmp__` is gone in Python 3, there is nothing that Cython can do about that.",
    "created_at": "2017-07-17T12:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351633",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@simon-king-jena](#comment%3A52):
> I thought this was needed to make things Python3 compliant.

Yes, `six` is needed to make things Python 3 compliant.

However, Cython is a language by itself. Cython is not Python 2 and it's not Python 3. Cython tries to be compatible with Python 2 and Python 3. This makes porting Cython code to Python 3 much easier than porting Python code.

Of course, some Cython code is really just Python code and that code can depend on the Python version. And there are some incompatibilities that Cython cannot fix: support for `__cmp__` is gone in Python 3, there is nothing that Cython can do about that.



---

archive/issue_comments_351634.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@simon-king-jena](#comment%3A52):\n> Replying to [@jdemeyer](#comment%3A51):\n> > Avoid `six` in Cython files if possible! Please revert to `basestring`.\n\n> \n> Really? I thought this was needed to make things Python3 compliant. OK, I'll revert it.\n> \n> Something else: If the MeatAxe function `MatLoad` gets an empty file name, it apparently just returns the NULL pointer, but doesn't raise an error. What shall I do? Shall I change\n> `Matrix_t *MatLoad(char *fn) except NULL` into `Matrix_t *MatLoad(char *fn) except? NULL` (or what's the syntax if NULL can also be returned without an error)?\n\nYes, `except? NULL` is fine. I would still raise a Python exception in this case though.",
    "created_at": "2017-07-17T12:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351634",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@simon-king-jena](#comment%3A52):
> Replying to [@jdemeyer](#comment%3A51):
> > Avoid `six` in Cython files if possible! Please revert to `basestring`.

> 
> Really? I thought this was needed to make things Python3 compliant. OK, I'll revert it.
> 
> Something else: If the MeatAxe function `MatLoad` gets an empty file name, it apparently just returns the NULL pointer, but doesn't raise an error. What shall I do? Shall I change
> `Matrix_t *MatLoad(char *fn) except NULL` into `Matrix_t *MatLoad(char *fn) except? NULL` (or what's the syntax if NULL can also be returned without an error)?

Yes, `except? NULL` is fine. I would still raise a Python exception in this case though.



---

archive/issue_comments_351635.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@jdemeyer](#comment%3A54):\n> Yes, `except? NULL` is fine. I would still raise a Python exception in this case though.\n\nIf you want an error being raised on `Matrix_gfpn_dense('')`, then I need to re-introduce the test `if not parent` (but then raise an error). Is that OK for you?\n\nIn any case, changing the function header of `MatLoad` should be done.",
    "created_at": "2017-07-17T12:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351635",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@jdemeyer](#comment%3A54):
> Yes, `except? NULL` is fine. I would still raise a Python exception in this case though.

If you want an error being raised on `Matrix_gfpn_dense('')`, then I need to re-introduce the test `if not parent` (but then raise an error). Is that OK for you?

In any case, changing the function header of `MatLoad` should be done.



---

archive/issue_comments_351636.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@simon-king-jena](#comment%3A55):\n> Replying to [@jdemeyer](#comment%3A54):\n> > Yes, `except? NULL` is fine. I would still raise a Python exception in this case though.\n\n> \n> If you want an error being raised on `Matrix_gfpn_dense('')`, then I need to re-introduce the test `if not parent` (but then raise an error). Is that OK for you?\n\nBut you say that MeatAxe returns `NULL` without exception in this case. So it suffices to check the result of `MatLoad()`.",
    "created_at": "2017-07-17T13:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351636",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@simon-king-jena](#comment%3A55):
> Replying to [@jdemeyer](#comment%3A54):
> > Yes, `except? NULL` is fine. I would still raise a Python exception in this case though.

> 
> If you want an error being raised on `Matrix_gfpn_dense('')`, then I need to re-introduce the test `if not parent` (but then raise an error). Is that OK for you?

But you say that MeatAxe returns `NULL` without exception in this case. So it suffices to check the result of `MatLoad()`.



---

archive/issue_comments_351637.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@jdemeyer](#comment%3A56):\n> But you say that MeatAxe returns `NULL` without exception in this case. So it suffices to check the result of `MatLoad()`.\n\nFrom my perspective, one could simply return an empty 0x0-matrix over an unspecified field in that special case. But if you prefer an error being raised (`ValueError(\"Received NULL pointer from initialisation of MeatAxe matrix\")`, perhaps?), I can do that.",
    "created_at": "2017-07-17T13:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351637",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@jdemeyer](#comment%3A56):
> But you say that MeatAxe returns `NULL` without exception in this case. So it suffices to check the result of `MatLoad()`.

From my perspective, one could simply return an empty 0x0-matrix over an unspecified field in that special case. But if you prefer an error being raised (`ValueError("Received NULL pointer from initialisation of MeatAxe matrix")`, perhaps?), I can do that.



---

archive/issue_comments_351638.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI consider it a bug that `MatLoad(\"\")` returns `NULL` without an error. So we are just working around a MeatAxe bug here...",
    "created_at": "2017-07-17T14:00:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351638",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

I consider it a bug that `MatLoad("")` returns `NULL` without an error. So we are just working around a MeatAxe bug here...



---

archive/issue_comments_351639.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/564104e5c3c09769b921c10a10788063c9c39096\"><code>564104e</code></a></td><td><code>Don't use six.string_types, but basestring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a\"><code>982755f</code></a></td><td><code>Workaround: MeatAxe's MatLoad returns NULL on empty filename without setting error</code></td></tr></table>\n",
    "created_at": "2017-07-17T14:11:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351639",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/564104e5c3c09769b921c10a10788063c9c39096"><code>564104e</code></a></td><td><code>Don't use six.string_types, but basestring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a"><code>982755f</code></a></td><td><code>Workaround: MeatAxe's MatLoad returns NULL on empty filename without setting error</code></td></tr></table>




---

archive/issue_comments_351640.json:
```json
{
    "body": "Changed commit from **[`3d94133`](https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272)** to **[`982755f`](https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a)**",
    "created_at": "2017-07-17T14:11:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351640",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3d94133`](https://github.com/sagemath/sagetrac-mirror/commit/3d94133f7514a2d5f3887aabeb2a6068e981a272)** to **[`982755f`](https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a)**



---

archive/issue_events_323029.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T14:11:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323029"
}
```



---

archive/issue_events_323030.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-17T14:11:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323030"
}
```



---

archive/issue_comments_351641.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-07-25T09:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351641",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_323031.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T09:58:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323031"
}
```



---

archive/issue_events_323032.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T09:58:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323032"
}
```



---

archive/issue_comments_351642.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nAs expected, this \"machine dependent\" doctest may fail depending on the machine:\n\n```\n        sage: t = 'Uq\\x82\\x00\\x00\\x00\\x00\\x00\\xa7\\x8bh\\x00\\x00\\x00\\x00\\x00'\n        sage: len(t)\n        16\n        sage: N == mtx_unpickle(MS, 2, 5, t, True)           # optional: meataxe\n```",
    "created_at": "2017-07-25T09:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351642",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

As expected, this "machine dependent" doctest may fail depending on the machine:

```
        sage: t = 'Uq\x82\x00\x00\x00\x00\x00\xa7\x8bh\x00\x00\x00\x00\x00'
        sage: len(t)
        16
        sage: N == mtx_unpickle(MS, 2, 5, t, True)           # optional: meataxe
```



---

archive/issue_comments_351643.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nOn a 32-bit system, this gives:\n\n```\nsage -t --long --warn-long 87.3 src/sage/matrix/matrix_gfpn_dense.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix_gfpn_dense.pyx\", line 1635, in sage.matrix.matrix_gfpn_dense.mtx_unpickle\nFailed example:\n    N == mtx_unpickle(MS, 2, 5, t, True)           # optional: meataxe\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 509, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 872, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_gfpn_dense.mtx_unpickle[18]>\", line 1, in <module>\n        N == mtx_unpickle(MS, Integer(2), Integer(5), t, True)           # optional: meataxe\n      File \"sage/matrix/matrix_gfpn_dense.pyx\", line 1712, in sage.matrix.matrix_gfpn_dense.mtx_unpickle (/home/jdemeyer/sage-git/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:14936)\n        raise ValueError(f\"Expected a pickle with {FfCurrentRowSizeIo}*{nr} bytes per row, got {lenData} instead\")\n    ValueError: Expected a pickle with 3*2 bytes per row, got 16 instead\n**********************************************************************\n```",
    "created_at": "2017-07-25T09:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351643",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

On a 32-bit system, this gives:

```
sage -t --long --warn-long 87.3 src/sage/matrix/matrix_gfpn_dense.pyx
**********************************************************************
File "src/sage/matrix/matrix_gfpn_dense.pyx", line 1635, in sage.matrix.matrix_gfpn_dense.mtx_unpickle
Failed example:
    N == mtx_unpickle(MS, 2, 5, t, True)           # optional: meataxe
Exception raised:
    Traceback (most recent call last):
      File "/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_gfpn_dense.mtx_unpickle[18]>", line 1, in <module>
        N == mtx_unpickle(MS, Integer(2), Integer(5), t, True)           # optional: meataxe
      File "sage/matrix/matrix_gfpn_dense.pyx", line 1712, in sage.matrix.matrix_gfpn_dense.mtx_unpickle (/home/jdemeyer/sage-git/src/build/cythonized/sage/matrix/matrix_gfpn_dense.c:14936)
        raise ValueError(f"Expected a pickle with {FfCurrentRowSizeIo}*{nr} bytes per row, got {lenData} instead")
    ValueError: Expected a pickle with 3*2 bytes per row, got 16 instead
**********************************************************************
```



---

archive/issue_comments_351644.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jdemeyer](#comment%3A62):\n> On a 32-bit system, this gives:\n> \n> ```\n> sage -t --long --warn-long 87.3 src/sage/matrix/matrix_gfpn_dense.pyx\n> ...\n>     ValueError: Expected a pickle with 3*2 bytes per row, got 16 instead\n> **********************************************************************\n> ```\n\nThank you for testing on different architectures!\n\nSo, what shall we do with that test?\n- On the one hand, that test is about a pickling format that is known to be machine dependent and is therefore deprecated. That's an argument for removing it (which I would like to avoid).\n- On the other hand, I could try to do better and make unpickling work in that case as well.\n\nI think I prefer the second way.",
    "created_at": "2017-07-25T12:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351644",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jdemeyer](#comment%3A62):
> On a 32-bit system, this gives:
> 
> ```
> sage -t --long --warn-long 87.3 src/sage/matrix/matrix_gfpn_dense.pyx
> ...
>     ValueError: Expected a pickle with 3*2 bytes per row, got 16 instead
> **********************************************************************
> ```

Thank you for testing on different architectures!

So, what shall we do with that test?
- On the one hand, that test is about a pickling format that is known to be machine dependent and is therefore deprecated. That's an argument for removing it (which I would like to avoid).
- On the other hand, I could try to do better and make unpickling work in that case as well.

I think I prefer the second way.



---

archive/issue_comments_351645.json:
```json
{
    "body": "<div id=\"comment:64\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a\"><code>78d7b21</code></a></td><td><code>MeatAxe: Enable unpickling of deprecated pickle created with different machine architecture</code></td></tr></table>\n",
    "created_at": "2017-07-25T12:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351645",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:64"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a"><code>78d7b21</code></a></td><td><code>MeatAxe: Enable unpickling of deprecated pickle created with different machine architecture</code></td></tr></table>




---

archive/issue_comments_351646.json:
```json
{
    "body": "Changed commit from **[`982755f`](https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a)** to **[`78d7b21`](https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a)**",
    "created_at": "2017-07-25T12:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351646",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`982755f`](https://github.com/sagemath/sagetrac-mirror/commit/982755f103b4d1225051c060f93e9a4069deb87a)** to **[`78d7b21`](https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a)**



---

archive/issue_comments_351647.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nDone! And I demonstrate that a deprecated pickle can be opened even if it was created on a silly machine with `sizeof(long)==9`.",
    "created_at": "2017-07-25T12:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351647",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">comment:65</div>

Done! And I demonstrate that a deprecated pickle can be opened even if it was created on a silly machine with `sizeof(long)==9`.



---

archive/issue_events_323033.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-25T12:52:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323033"
}
```



---

archive/issue_events_323034.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-25T12:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323034"
}
```



---

archive/issue_comments_351648.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nCool test! Now, we are still missing a doctest for the `else` case, when `elif pickled_rowsize < FfCurrentRowSizeIo`",
    "created_at": "2017-07-25T14:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351648",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:66" align="right">comment:66</div>

Cool test! Now, we are still missing a doctest for the `else` case, when `elif pickled_rowsize < FfCurrentRowSizeIo`



---

archive/issue_events_323035.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T14:44:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323035"
}
```



---

archive/issue_events_323036.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-25T14:44:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323036"
}
```



---

archive/issue_comments_351649.json:
```json
{
    "body": "<div id=\"comment:67\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157\"><code>ba72aba</code></a></td><td><code>Test another code path in unpickling meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-26T11:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351649",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:67"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157"><code>ba72aba</code></a></td><td><code>Test another code path in unpickling meataxe matrices</code></td></tr></table>




---

archive/issue_comments_351650.json:
```json
{
    "body": "Changed commit from **[`78d7b21`](https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a)** to **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**",
    "created_at": "2017-07-26T11:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351650",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`78d7b21`](https://github.com/sagemath/sagetrac-mirror/commit/78d7b21fe53577926bf0af4ab5dad5f426ca780a)** to **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**



---

archive/issue_comments_351651.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nDone!\n\nThere is now one test where the number of bytes is not divisible by the number of rows and one test where the number is divisible but too small to contain a matrix of the given dimensions. Together with the existing tests, I think it covers all code paths.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157\"><code>ba72aba</code></a></td><td><code>Test another code path in unpickling meataxe matrices</code></td></tr></table>\n",
    "created_at": "2017-07-26T11:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351651",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:68" align="right">comment:68</div>

Done!

There is now one test where the number of bytes is not divisible by the number of rows and one test where the number is divisible but too small to contain a matrix of the given dimensions. Together with the existing tests, I think it covers all code paths.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157"><code>ba72aba</code></a></td><td><code>Test another code path in unpickling meataxe matrices</code></td></tr></table>




---

archive/issue_events_323037.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-26T11:47:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323037"
}
```



---

archive/issue_events_323038.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2017-07-26T11:47:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323038"
}
```



---

archive/issue_events_323039.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-27T09:26:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323039"
}
```



---

archive/issue_events_323040.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-07-27T09:26:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323040"
}
```



---

archive/issue_comments_351652.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/fix_pickling_of_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_pickling_of_matrix_gfpn_dense)** to **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**",
    "created_at": "2017-07-29T15:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23411#issuecomment-351652",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/SimonKing/fix_pickling_of_matrix_gfpn_dense](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_pickling_of_matrix_gfpn_dense)** to **[`ba72aba`](https://github.com/sagemath/sagetrac-mirror/commit/ba72abac8a53b3d292df570d31709ab5c2f57157)**



---

archive/issue_events_323041.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T15:30:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323041"
}
```



---

archive/issue_events_323042.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "19f48ef1f0f817414df141118d15d097d7b2fc80",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-07-29T15:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23411",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23411#event-323042"
}
```
