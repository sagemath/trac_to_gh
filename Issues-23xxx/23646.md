# Issue 23646: py3 rich comparison for modules

archive/issues_023409.json:
```json
{
    "assignees": [],
    "body": "as another mini-step in the direction of python3\n\n**CC:**  @tscrim @jdemeyer @jhpalmieri\n\n**Branch/Commit:** [c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/23646\n\n",
    "closed_at": "2017-08-26T09:57:57Z",
    "created_at": "2017-08-18T15:26:16Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3 rich comparison for modules",
    "type": "issue",
    "updated_at": "2017-08-26T09:57:57Z",
    "url": "https://github.com/sagemath/sage/issues/23646",
    "user": "https://github.com/fchapoton"
}
```
as another mini-step in the direction of python3

**CC:**  @tscrim @jdemeyer @jhpalmieri

**Branch/Commit:** [c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)

**Reviewer:** Travis Scrimshaw

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/23646





---

archive/issue_events_285888.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T15:26:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285888"
}
```



---

archive/issue_events_285889.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T15:26:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285889"
}
```



---

archive/issue_events_285890.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T15:26:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285890"
}
```



---

archive/issue_comments_358486.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d\">65c8be9</a></td><td><code>py3: rich comparison for modules</code></td></tr></table>\n",
    "created_at": "2017-08-18T15:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358486",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d">65c8be9</a></td><td><code>py3: rich comparison for modules</code></td></tr></table>




---

archive/issue_comments_358487.json:
```json
{
    "body": "**Branch:** [u/chapoton/23646](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23646)",
    "created_at": "2017-08-18T15:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358487",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23646](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23646)



---

archive/issue_events_285891.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T15:26:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285891"
}
```



---

archive/issue_comments_358488.json:
```json
{
    "body": "**Commit:** [65c8be9149be1d8c10702634ca9db0e8d85a914d](https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d)",
    "created_at": "2017-08-18T15:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358488",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [65c8be9149be1d8c10702634ca9db0e8d85a914d](https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d)



---

archive/issue_comments_358489.json:
```json
{
    "body": "<a id='comment:2'></a>\none failing doctest   `:(`",
    "created_at": "2017-08-18T20:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358489",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
one failing doctest   `:(`



---

archive/issue_events_285892.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T20:10:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285892"
}
```



---

archive/issue_events_285893.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-18T20:10:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285893"
}
```



---

archive/issue_comments_358490.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962\">4e7cace</a></td><td><code>trac 23646 fixing a typo in richcmp</code></td></tr></table>\n",
    "created_at": "2017-08-19T06:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358490",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962">4e7cace</a></td><td><code>trac 23646 fixing a typo in richcmp</code></td></tr></table>




---

archive/issue_comments_358491.json:
```json
{
    "body": "**Changing commit** from \"[65c8be9149be1d8c10702634ca9db0e8d85a914d](https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d)\" to \"[4e7cacedcad2bbf06d55ef10633e956de2633962](https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962)\".",
    "created_at": "2017-08-19T06:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358491",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[65c8be9149be1d8c10702634ca9db0e8d85a914d](https://github.com/sagemath/sagetrac-mirror/commit/65c8be9149be1d8c10702634ca9db0e8d85a914d)" to "[4e7cacedcad2bbf06d55ef10633e956de2633962](https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962)".



---

archive/issue_events_285894.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-19T06:47:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285894"
}
```



---

archive/issue_events_285895.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-08-19T06:47:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285895"
}
```



---

archive/issue_comments_358492.json:
```json
{
    "body": "<a id='comment:4'></a>\nshould be fixed now",
    "created_at": "2017-08-19T06:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358492",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
should be fixed now



---

archive/issue_comments_358493.json:
```json
{
    "body": "<a id='comment:5'></a>\ngreen bot, please review",
    "created_at": "2017-08-19T09:52:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358493",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
green bot, please review



---

archive/issue_comments_358494.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-08-19T17:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358494",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_358495.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhy this change:\n\n```diff\n@@ -49,7 +49,7 @@ V_{d-1}`. In the above example, this means that\n \n That is::\n \n-    sage: V.get_degree(0) == V\n+    sage: V.get_degree(0) == V.span([r1,r2,r3])\n     True\n     sage: V.get_degree(1) == V.span([r1, r2])\n     True\n```\nI don't fundamentally disagree with it, but I am just wondering if it was necessary to make the doctest pass. If it is just for clarity, then positive review.",
    "created_at": "2017-08-19T17:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358495",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Why this change:

```diff
@@ -49,7 +49,7 @@ V_{d-1}`. In the above example, this means that
 
 That is::
 
-    sage: V.get_degree(0) == V
+    sage: V.get_degree(0) == V.span([r1,r2,r3])
     True
     sage: V.get_degree(1) == V.span([r1, r2])
     True
```
I don't fundamentally disagree with it, but I am just wondering if it was necessary to make the doctest pass. If it is just for clarity, then positive review.



---

archive/issue_comments_358496.json:
```json
{
    "body": "<a id='comment:7'></a>\nSadly, this change was necessary to make the doctest pass. Otherwise, we are comparing a filtered vector-space (V) and a bare vector-space V.get_degree(0). And they are no longer considered to be equal. \n\nMaybe one can consider that the doctest did pass, but should not have. Otherwise, one needs to restore the old behaviour somehow.",
    "created_at": "2017-08-19T17:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358496",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
Sadly, this change was necessary to make the doctest pass. Otherwise, we are comparing a filtered vector-space (V) and a bare vector-space V.get_degree(0). And they are no longer considered to be equal. 

Maybe one can consider that the doctest did pass, but should not have. Otherwise, one needs to restore the old behaviour somehow.



---

archive/issue_comments_358497.json:
```json
{
    "body": "<a id='comment:8'></a>\nI see. I am slightly surprised the result did change. Anyways, now the question becomes do we want a filtered (or graded) version of an object to compare equal to its non-filtered (resp. graded) version. My thought is no to differentiate the extra structure, but there is a case to be made that it should be in the category with lesser structure (similar to how a coercion equality works).",
    "created_at": "2017-08-19T18:07:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358497",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
I see. I am slightly surprised the result did change. Anyways, now the question becomes do we want a filtered (or graded) version of an object to compare equal to its non-filtered (resp. graded) version. My thought is no to differentiate the extra structure, but there is a case to be made that it should be in the category with lesser structure (similar to how a coercion equality works).



---

archive/issue_comments_358498.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d\">c5cf1e3</a></td><td><code>trac 23646 restore previous doctest</code></td></tr></table>\n",
    "created_at": "2017-08-20T07:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358498",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d">c5cf1e3</a></td><td><code>trac 23646 restore previous doctest</code></td></tr></table>




---

archive/issue_comments_358499.json:
```json
{
    "body": "**Changing commit** from \"[4e7cacedcad2bbf06d55ef10633e956de2633962](https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962)\" to \"[c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)\".",
    "created_at": "2017-08-20T07:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358499",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4e7cacedcad2bbf06d55ef10633e956de2633962](https://github.com/sagemath/sagetrac-mirror/commit/4e7cacedcad2bbf06d55ef10633e956de2633962)" to "[c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)".



---

archive/issue_comments_358500.json:
```json
{
    "body": "<a id='comment:10'></a>\nIn fact, the doctest\n\n```\nV.get_degree(0) == V\n```\nstill passes (is True) but the opposite comparison\n\n```\nV == V.get_degree(0)\n```\nis False. I do not know if this was the existing behaviour, but probably. This is because the `__eq__` for free module accepts everything that acts as a free module, whereas the `__eq__` for filtered modules only accepts filtered modules.\n\nI think (but this should be checked) that we are not changing the current behaviour.",
    "created_at": "2017-08-20T07:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358500",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
In fact, the doctest

```
V.get_degree(0) == V
```
still passes (is True) but the opposite comparison

```
V == V.get_degree(0)
```
is False. I do not know if this was the existing behaviour, but probably. This is because the `__eq__` for free module accepts everything that acts as a free module, whereas the `__eq__` for filtered modules only accepts filtered modules.

I think (but this should be checked) that we are not changing the current behaviour.



---

archive/issue_comments_358501.json:
```json
{
    "body": "<a id='comment:11'></a>\nVanilla sage:\n\n```\nsage: r1 = (1, 0, 5)\nsage: r2 = (0, 1, 2)\nsage: r3 = (1, 2, 1)\nsage: V = FilteredVectorSpace({0:[r1, r2, r3], 1:[r1, r2], 3:[r1]}) \nsage: V == V.get_degree(0)\nFalse\nsage: V.get_degree(0) == V\nTrue\n```",
    "created_at": "2017-08-20T16:29:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358501",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
Vanilla sage:

```
sage: r1 = (1, 0, 5)
sage: r2 = (0, 1, 2)
sage: r3 = (1, 2, 1)
sage: V = FilteredVectorSpace({0:[r1, r2, r3], 1:[r1, r2], 3:[r1]}) 
sage: V == V.get_degree(0)
False
sage: V.get_degree(0) == V
True
```



---

archive/issue_events_285896.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-20T16:31:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285896"
}
```



---

archive/issue_events_285897.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-08-20T16:31:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285897"
}
```



---

archive/issue_comments_358502.json:
```json
{
    "body": "<a id='comment:12'></a>\nThanks for looking into this (you actually just beat me to posting). I agree that it is not good behavior, but that should be something for a separate ticket (and possibly a sage-devel discussion).",
    "created_at": "2017-08-20T16:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358502",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Thanks for looking into this (you actually just beat me to posting). I agree that it is not good behavior, but that should be something for a separate ticket (and possibly a sage-devel discussion).



---

archive/issue_events_285898.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-26T09:57:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285898"
}
```



---

archive/issue_events_285899.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5fe00d0b6e5cf86dc4ab97f773768346446b7514",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-26T09:57:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23646#event-285899"
}
```



---

archive/issue_comments_358503.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23646](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23646)\" to \"[c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)\".",
    "created_at": "2017-08-26T09:57:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23646#issuecomment-358503",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/23646](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23646)" to "[c5cf1e359b7d3fce24140de671b4f8eba205c63d](https://github.com/sagemath/sagetrac-mirror/commit/c5cf1e359b7d3fce24140de671b4f8eba205c63d)".
