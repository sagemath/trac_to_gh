# Issue 23044: py3: tolerance for u prefix in doctests

archive/issues_022807.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nAs a preparation step to py3:\n\n**One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n\nThis is done by a parsing that calls an internal method of cython.\n\nThis parsing  may not be perfect, but works in most simple enough cases.\n\nCC:  @jdemeyer @embray @vbraun @tscrim\n\nComponent: **python3**\n\nKeywords: **unicode**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23044_\n\n",
    "closed_at": "2017-06-09T18:37:54Z",
    "created_at": "2017-05-21T15:48:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: tolerance for u prefix in doctests",
    "type": "issue",
    "updated_at": "2017-06-09T18:37:54Z",
    "url": "https://github.com/sagemath/sage/issues/23044",
    "user": "https://github.com/fchapoton"
}
```
<div id="comment:0"></div>

As a preparation step to py3:

**One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'

This is done by a parsing that calls an internal method of cython.

This parsing  may not be perfect, but works in most simple enough cases.

CC:  @jdemeyer @embray @vbraun @tscrim

Component: **python3**

Keywords: **unicode**

Author: **Frédéric Chapoton**

Branch/Commit: **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/23044_





---

archive/issue_events_318556.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:48:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318556"
}
```



---

archive/issue_events_318557.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318557"
}
```



---

archive/issue_events_318558.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318558"
}
```



---

archive/issue_events_318559.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318559"
}
```



---

archive/issue_comments_344992.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nlet us wait for a bot's opinion\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66\"><code>4e7d985</code></a></td><td><code>trac 23044 conversion to unicode of sageinspect, relax doctest of strings</code></td></tr></table>\n",
    "created_at": "2017-05-21T15:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344992",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

let us wait for a bot's opinion

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66"><code>4e7d985</code></a></td><td><code>trac 23044 conversion to unicode of sageinspect, relax doctest of strings</code></td></tr></table>




---

archive/issue_events_318560.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:52:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318560"
}
```



---

archive/issue_comments_344993.json:
```json
{
    "body": "Commit: **[`4e7d985`](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)**",
    "created_at": "2017-05-21T15:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344993",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`4e7d985`](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)**



---

archive/issue_comments_344994.json:
```json
{
    "body": "Branch: **[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)**",
    "created_at": "2017-05-21T15:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344994",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)**



---

archive/issue_comments_344995.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n+This ticket is getting rid of two calls to \"unicode\".\n \n-\n``````\n",
    "created_at": "2017-05-21T15:55:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344995",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
+This ticket is getting rid of two calls to "unicode".
 
-
``````




---

archive/issue_comments_344996.json:
```json
{
    "body": "Changed keywords from none to **unicode**",
    "created_at": "2017-05-21T16:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344996",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from none to **unicode**



---

archive/issue_comments_344997.json:
```json
{
    "body": "Changed commit from **[`4e7d985`](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)** to **[`1a736be`](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)**",
    "created_at": "2017-05-21T19:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344997",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e7d985`](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)** to **[`1a736be`](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)**



---

archive/issue_comments_344998.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5\"><code>1a736be</code></a></td><td><code>trac 23044 better removal of u, fixing imports of six</code></td></tr></table>\n",
    "created_at": "2017-05-21T19:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344998",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5"><code>1a736be</code></a></td><td><code>trac 23044 better removal of u, fixing imports of six</code></td></tr></table>




---

archive/issue_comments_344999.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSome tests are failing on the patchbot. Some are trivial (in a way) and others not so much.",
    "created_at": "2017-05-22T01:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-344999",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Some tests are failing on the patchbot. Some are trivial (in a way) and others not so much.



---

archive/issue_events_318561.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-22T06:36:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318561"
}
```



---

archive/issue_events_318562.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-22T06:36:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318562"
}
```



---

archive/issue_comments_345000.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nyes, in particular the doc does not build.. needs to be investigated",
    "created_at": "2017-05-22T06:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345000",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

yes, in particular the doc does not build.. needs to be investigated



---

archive/issue_comments_345001.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a\"><code>ea80844</code></a></td><td><code>trac 23044 fixing the easy failing doctests</code></td></tr></table>\n",
    "created_at": "2017-05-22T19:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345001",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a"><code>ea80844</code></a></td><td><code>trac 23044 fixing the easy failing doctests</code></td></tr></table>




---

archive/issue_comments_345002.json:
```json
{
    "body": "Changed commit from **[`1a736be`](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)** to **[`ea80844`](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)**",
    "created_at": "2017-05-22T19:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1a736be`](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)** to **[`ea80844`](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)**



---

archive/issue_comments_345003.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190\"><code>81a8ca7</code></a></td><td><code>trac 23044 one detail</code></td></tr></table>\n",
    "created_at": "2017-05-22T19:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345003",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190"><code>81a8ca7</code></a></td><td><code>trac 23044 one detail</code></td></tr></table>




---

archive/issue_comments_345004.json:
```json
{
    "body": "Changed commit from **[`ea80844`](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)** to **[`81a8ca7`](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)**",
    "created_at": "2017-05-22T19:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345004",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ea80844`](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)** to **[`81a8ca7`](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)**



---

archive/issue_comments_345005.json:
```json
{
    "body": "Changed commit from **[`81a8ca7`](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)** to **[`45a3be7`](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)**",
    "created_at": "2017-05-23T07:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`81a8ca7`](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)** to **[`45a3be7`](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)**



---

archive/issue_comments_345006.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97\"><code>45a3be7</code></a></td><td><code>trac 23044 do not switch to unicode yet</code></td></tr></table>\n",
    "created_at": "2017-05-23T07:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345006",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97"><code>45a3be7</code></a></td><td><code>trac 23044 do not switch to unicode yet</code></td></tr></table>




---

archive/issue_events_318563.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318563"
}
```



---

archive/issue_events_318564.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318564"
}
```



---

archive/issue_comments_345007.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\ngreen bot, please review !",
    "created_at": "2017-05-23T13:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345007",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

green bot, please review !



---

archive/issue_events_318565.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "title_is": "py3: tolerance for u prefix in doctests",
    "title_was": "py3: use unicode in sageinspect",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318565"
}
```



---

archive/issue_comments_345008.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n-preparation to py3\n+As a preparation step to py3:\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n-This ticket is getting rid of two calls to \"unicode\".\n+This is done by a parsing which is not perfect, but works in most simple enough cases.\n \n+This ticket is also getting rid of two calls to \"unicode\".\n+\n+And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.\n``````\n",
    "created_at": "2017-05-23T13:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345008",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
-preparation to py3
+As a preparation step to py3:
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
-This ticket is getting rid of two calls to "unicode".
+This is done by a parsing which is not perfect, but works in most simple enough cases.
 
+This ticket is also getting rid of two calls to "unicode".
+
+And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.
``````




---

archive/issue_comments_345009.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n1. From the patch:\n\n```\nBut this breaks on something like \"[u\"Singular's stuff\", u'good']\" !!!\n```\n\nYou may want to consider using [strip_string_literals](https://github.com/cython/cython/blob/master/Cython/Build/Dependencies.py#L277) for a more robust implementation.\n\n2. The `[u\"Singular's stuff\", u'good']` example should be a doctest (depending on your opinion on 1, either to show that it works or to show how it breaks).\n\n3. Revert this:\n\n```diff\ndiff --git a/src/sage/misc/six.py b/src/sage/misc/six.py\nindex 37295c7..eed7d9a 100644\n--- a/src/sage/misc/six.py\n+++ b/src/sage/misc/six.py\n@@ -5,7 +5,7 @@ Python 2 and 3 Compatibility\n \n from __future__ import absolute_import\n \n-from six import *\n+from six import text_type, binary_type\n \n \n def with_metaclass(meta, *bases):\n```\nThe `import *` is intentional: the idea is that `sage.misc.six` can replace the standard `six` module.\n\n4. Since the commits don't really make sense, I suggest to squash this to 1 commit.",
    "created_at": "2017-05-23T13:46:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345009",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

1. From the patch:

```
But this breaks on something like "[u"Singular's stuff", u'good']" !!!
```

You may want to consider using [strip_string_literals](https://github.com/cython/cython/blob/master/Cython/Build/Dependencies.py#L277) for a more robust implementation.

2. The `[u"Singular's stuff", u'good']` example should be a doctest (depending on your opinion on 1, either to show that it works or to show how it breaks).

3. Revert this:

```diff
diff --git a/src/sage/misc/six.py b/src/sage/misc/six.py
index 37295c7..eed7d9a 100644
--- a/src/sage/misc/six.py
+++ b/src/sage/misc/six.py
@@ -5,7 +5,7 @@ Python 2 and 3 Compatibility
 
 from __future__ import absolute_import
 
-from six import *
+from six import text_type, binary_type
 
 
 def with_metaclass(meta, *bases):
```
The `import *` is intentional: the idea is that `sage.misc.six` can replace the standard `six` module.

4. Since the commits don't really make sense, I suggest to squash this to 1 commit.



---

archive/issue_events_318566.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-23T13:46:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318566"
}
```



---

archive/issue_events_318567.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-23T13:46:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318567"
}
```



---

archive/issue_comments_345010.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286\"><code>04568d6</code></a></td><td><code>trac 23044 relax doctest of strings, preparation for unicode in sageinspect</code></td></tr></table>\n",
    "created_at": "2017-05-23T13:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345010",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286"><code>04568d6</code></a></td><td><code>trac 23044 relax doctest of strings, preparation for unicode in sageinspect</code></td></tr></table>




---

archive/issue_comments_345011.json:
```json
{
    "body": "Changed commit from **[`45a3be7`](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)** to **[`04568d6`](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)**",
    "created_at": "2017-05-23T13:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345011",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`45a3be7`](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)** to **[`04568d6`](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)**



---

archive/issue_comments_345012.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThanks for the suggestion to use `strip_string_literals`. But I do not understand how I could use it and what it does, given that is has no doctest.",
    "created_at": "2017-05-23T14:01:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345012",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

Thanks for the suggestion to use `strip_string_literals`. But I do not understand how I could use it and what it does, given that is has no doctest.



---

archive/issue_comments_345013.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIt's not clear to me what you mean with \"**internal** unicode u markers\" (if you stress the word `**internal**`, explain what it means).",
    "created_at": "2017-05-23T14:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345013",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

It's not clear to me what you mean with "**internal** unicode u markers" (if you stress the word `**internal**`, explain what it means).



---

archive/issue_comments_345014.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWell, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.",
    "created_at": "2017-05-23T14:05:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345014",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.



---

archive/issue_comments_345015.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@fchapoton](#comment%3A15):\n> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.\n\nDon't explain on Trac, explain in the docstring.",
    "created_at": "2017-05-23T14:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345015",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@fchapoton](#comment%3A15):
> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.

Don't explain on Trac, explain in the docstring.



---

archive/issue_comments_345016.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@fchapoton](#comment%3A15):\n> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.\n\nI think the word `**internal**` adds more confusion than it solves. I would remove it.",
    "created_at": "2017-05-23T14:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345016",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@fchapoton](#comment%3A15):
> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.

I think the word `**internal**` adds more confusion than it solves. I would remove it.



---

archive/issue_comments_345017.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4\"><code>7bb1929</code></a></td><td><code>trac 23044 more explanation in remove_unicode_u</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4"><code>7bb1929</code></a></td><td><code>trac 23044 more explanation in remove_unicode_u</code></td></tr></table>




---

archive/issue_comments_345018.json:
```json
{
    "body": "Changed commit from **[`04568d6`](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)** to **[`7bb1929`](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)**",
    "created_at": "2017-05-23T14:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345018",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`04568d6`](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)** to **[`7bb1929`](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)**



---

archive/issue_comments_345019.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nhere is more doc for remove_unicode_u",
    "created_at": "2017-05-23T14:12:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345019",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

here is more doc for remove_unicode_u



---

archive/issue_comments_345020.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm not totally convinced by the logic in the doctest framework. I think we should call `remove_unicode_u` on the output unconditionally. I know that this will break existing doctests, but those doctests would break anyway on Python 3. And it's better to fix it now that there are not so many doctests with `u''`.",
    "created_at": "2017-05-23T14:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345020",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm not totally convinced by the logic in the doctest framework. I think we should call `remove_unicode_u` on the output unconditionally. I know that this will break existing doctests, but those doctests would break anyway on Python 3. And it's better to fix it now that there are not so many doctests with `u''`.



---

archive/issue_comments_345021.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n\n```\nsage: remove_unicode_u(\"'\u20ac'\")\n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n<ipython-input-7-8e5f967a743e> in <module>()\n----> 1 remove_unicode_u(\"'\u20ac'\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/parsing.pyc in remove_unicode_u(string)\n    106             final.append(\"'\")\n    107         parity += 1\n--> 108     string1 = u''.join(final[:-1])\n    109 \n    110     # same for u\"\n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 1: ordinal not in range(128)\n```",
    "created_at": "2017-05-23T14:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345021",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>


```
sage: remove_unicode_u("'€'")
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-7-8e5f967a743e> in <module>()
----> 1 remove_unicode_u("'€'")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/parsing.pyc in remove_unicode_u(string)
    106             final.append("'")
    107         parity += 1
--> 108     string1 = u''.join(final[:-1])
    109 
    110     # same for u"

UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 1: ordinal not in range(128)
```



---

archive/issue_comments_345022.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI was thinking to 2 things:\n\n1) do not spend more time in the doctests\n\n2) the failing doctests in python3 can be cared of somewhere else (how many are there ?)",
    "created_at": "2017-05-23T14:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345022",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

I was thinking to 2 things:

1) do not spend more time in the doctests

2) the failing doctests in python3 can be cared of somewhere else (how many are there ?)



---

archive/issue_comments_345023.json:
```json
{
    "body": "Changed commit from **[`7bb1929`](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)** to **[`f314d07`](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)**",
    "created_at": "2017-05-23T14:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345023",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7bb1929`](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)** to **[`f314d07`](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)**



---

archive/issue_comments_345024.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca\"><code>f314d07</code></a></td><td><code>trac 23044 support bytes as possible input</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345024",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca"><code>f314d07</code></a></td><td><code>trac 23044 support bytes as possible input</code></td></tr></table>




---

archive/issue_comments_345025.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nnow works with bytes input (still return unicode)",
    "created_at": "2017-05-23T14:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345025",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:24" align="right">comment:24</div>

now works with bytes input (still return unicode)



---

archive/issue_comments_345026.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n* do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n\n* I would prefer not to apply \"remove_unicode_u\" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.",
    "created_at": "2017-05-23T20:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345026",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

* do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?

* I would prefer not to apply "remove_unicode_u" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.



---

archive/issue_events_318568.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T20:25:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318568"
}
```



---

archive/issue_events_318569.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T20:25:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318569"
}
```



---

archive/issue_comments_345027.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI don't think the level of complexity in this is really necessary (making sure a closing quote is found, etc.).  Astropy's doctest checker just uses a [simple regex](https://github.com/astropy/astropy/blob/master/astropy/tests/output_checker.py#L43) which, given knowledge of Python syntax and typical `repr`s of Python objects, is almost always going to be a positive match.  It's true one can come up with examples where it would be a false positive but I don't think it's ever occurred in practice.\n\nThat said, Sage has a lot more doctests and a lot more odd cases, and you've already worked out a way to do this that's perhaps more robust so I wouldn't toss it out if it works.  I would just eliminate the code duplication, perhaps by making an inline function, like:\n\n```python\ndef strip_u_prefix(s, q):\n    prefix = 'u' + q\n    initial = s.split(prefix)\n    parity = 0\n    final = []\n    for part in initial:\n        parity += part.count(q)\n        final.append(part)\n        if parity % 2:\n            final.append(prefix)\n        else:\n            final.append(q)\n        parity += 1\n    return u''.join(final[:-1])\n\ns = strip_u_prefix(s, '\"')\nreturn strip_u_prefix(s, \"'\")\n```\n\nor something like that.",
    "created_at": "2017-05-24T08:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345027",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

I don't think the level of complexity in this is really necessary (making sure a closing quote is found, etc.).  Astropy's doctest checker just uses a [simple regex](https://github.com/astropy/astropy/blob/master/astropy/tests/output_checker.py#L43) which, given knowledge of Python syntax and typical `repr`s of Python objects, is almost always going to be a positive match.  It's true one can come up with examples where it would be a false positive but I don't think it's ever occurred in practice.

That said, Sage has a lot more doctests and a lot more odd cases, and you've already worked out a way to do this that's perhaps more robust so I wouldn't toss it out if it works.  I would just eliminate the code duplication, perhaps by making an inline function, like:

```python
def strip_u_prefix(s, q):
    prefix = 'u' + q
    initial = s.split(prefix)
    parity = 0
    final = []
    for part in initial:
        parity += part.count(q)
        final.append(part)
        if parity % 2:
            final.append(prefix)
        else:
            final.append(q)
        parity += 1
    return u''.join(final[:-1])

s = strip_u_prefix(s, '"')
return strip_u_prefix(s, "'")
```

or something like that.



---

archive/issue_comments_345028.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@fchapoton](#comment%3A25):\n> * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n\nIt seems overcomplicated.\n\n> * I would prefer not to apply \"remove_unicode_u\" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.\n\nI'd be surprised if this really had any impact on speed in the grand scheme of things.  In a full test run it might add up to a few seconds.  But if you can demonstrate otherwise, a simple regexp as I suggested above might mitigate somewhat.\n\nI think it's simpler to apply this on all tests by default since it's very easy to forget otherwise, but there should probably be an option to disable it on a specific test in the rare case where it removes a false positive.",
    "created_at": "2017-05-24T08:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345028",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@fchapoton](#comment%3A25):
> * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?

It seems overcomplicated.

> * I would prefer not to apply "remove_unicode_u" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.

I'd be surprised if this really had any impact on speed in the grand scheme of things.  In a full test run it might add up to a few seconds.  But if you can demonstrate otherwise, a simple regexp as I suggested above might mitigate somewhat.

I think it's simpler to apply this on all tests by default since it's very easy to forget otherwise, but there should probably be an option to disable it on a specific test in the rare case where it removes a false positive.



---

archive/issue_comments_345029.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475\"><code>ec37fd4</code></a></td><td><code>trac 23044 let us try to always remove the offending u</code></td></tr></table>\n",
    "created_at": "2017-05-24T11:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345029",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475"><code>ec37fd4</code></a></td><td><code>trac 23044 let us try to always remove the offending u</code></td></tr></table>




---

archive/issue_comments_345030.json:
```json
{
    "body": "Changed commit from **[`f314d07`](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)** to **[`ec37fd4`](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)**",
    "created_at": "2017-05-24T11:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345030",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f314d07`](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)** to **[`ec37fd4`](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)**



---

archive/issue_comments_345031.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@embray](#comment%3A27):\n> Replying to [@fchapoton](#comment%3A25):\n> > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n> \n> \n> It seems overcomplicated.\n\nI would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.\n\nI must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.",
    "created_at": "2017-05-24T11:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345031",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@embray](#comment%3A27):
> Replying to [@fchapoton](#comment%3A25):
> > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?
> 
> 
> It seems overcomplicated.

I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.

I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.



---

archive/issue_comments_345032.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment%3A29):\n> Replying to [@embray](#comment%3A27):\n> > Replying to [@fchapoton](#comment%3A25):\n> > > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n> > \n> > \n> > It seems overcomplicated.\n> \n> \n> I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.\n> \n> I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.\n\nNormally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.  I don't think it's a good idea to rely on miscellaneous undocumented functions somewhere in another package that isn't all that related to what you're actually using it for (granted, at least in Cython's case, it is related to parsing Python).\n\nI think if, for this case, one wanted to reuse some existing machinery the stdlib's [ast](https://docs.python.org/2/library/ast.html#ast-helpers) module would be a better choice.  This can be used to parse output for Python literals and interpret them as needed (and if the output isn't a valid Python literal then we probably shouldn't try to interpret it as such).  But I still think that's overkill for this purpose, where in my experience as simple regexp has almost always worked.\n\nOn a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there *are* bound to be corner cases eventually.",
    "created_at": "2017-05-24T11:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345032",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment%3A29):
> Replying to [@embray](#comment%3A27):
> > Replying to [@fchapoton](#comment%3A25):
> > > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?
> > 
> > 
> > It seems overcomplicated.
> 
> 
> I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.
> 
> I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.

Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.  I don't think it's a good idea to rely on miscellaneous undocumented functions somewhere in another package that isn't all that related to what you're actually using it for (granted, at least in Cython's case, it is related to parsing Python).

I think if, for this case, one wanted to reuse some existing machinery the stdlib's [ast](https://docs.python.org/2/library/ast.html#ast-helpers) module would be a better choice.  This can be used to parse output for Python literals and interpret them as needed (and if the output isn't a valid Python literal then we probably shouldn't try to interpret it as such).  But I still think that's overkill for this purpose, where in my experience as simple regexp has almost always worked.

On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there *are* bound to be corner cases eventually.



---

archive/issue_comments_345033.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@embray](#comment%3A30):\n> Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.\n\nWhile there is no *guarantee*, we can rely on it as long as Cython provides that function. For the record: that function has existed for almost 7 years with the current functionality. In the case that Cython moves/deletes/changes that function, we can always adapt Sage. In the worst case, we just copy that function to the Sage sources.\n\nI disagree with `ast` since that's almost certainly going to be a lot slower. I believe that `strip_string_literals()` is the right tool for the job.\n\n> On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. \n\nI have no idea what you mean with this.",
    "created_at": "2017-05-24T12:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@embray](#comment%3A30):
> Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.

While there is no *guarantee*, we can rely on it as long as Cython provides that function. For the record: that function has existed for almost 7 years with the current functionality. In the case that Cython moves/deletes/changes that function, we can always adapt Sage. In the worst case, we just copy that function to the Sage sources.

I disagree with `ast` since that's almost certainly going to be a lot slower. I believe that `strip_string_literals()` is the right tool for the job.

> On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. 

I have no idea what you mean with this.



---

archive/issue_comments_345034.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)** to **[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)**",
    "created_at": "2017-05-24T12:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345034",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)** to **[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)**



---

archive/issue_comments_345035.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nIn my last commit, I'm using `strip_string_literals()` to simplify and correct `remove_unicode_u()`. I just wanted to show how simple the function becomes; if you still feel that this isn't the right solution, feel free to remove that commit.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/665497473c7577e4edb9e79c7538b807e8573dc7\"><code>6654974</code></a></td><td><code>No need for binary_type, bytes works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4\"><code>d447eaa</code></a></td><td><code>Use strip_string_literals() in remove_unicode_u()</code></td></tr></table>\n",
    "created_at": "2017-05-24T12:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345035",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

In my last commit, I'm using `strip_string_literals()` to simplify and correct `remove_unicode_u()`. I just wanted to show how simple the function becomes; if you still feel that this isn't the right solution, feel free to remove that commit.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/665497473c7577e4edb9e79c7538b807e8573dc7"><code>6654974</code></a></td><td><code>No need for binary_type, bytes works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4"><code>d447eaa</code></a></td><td><code>Use strip_string_literals() in remove_unicode_u()</code></td></tr></table>




---

archive/issue_comments_345036.json:
```json
{
    "body": "Changed commit from **[`ec37fd4`](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)** to **[`d447eaa`](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)**",
    "created_at": "2017-05-24T12:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345036",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`ec37fd4`](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)** to **[`d447eaa`](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)**



---

archive/issue_comments_345037.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment%3A31):\n> Replying to [@embray](#comment%3A30):\n> > On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. \n> \n> \n> I have no idea what you mean with this.\n\nWhat I mean is that when you have some code that parses output from doctests, one can sometimes stumble upon corner cases where it doesn't work properly for a test you're working on. So it's convenient to be able to easily tweak the code in the rare instances that that occurs.  Of course it is usually rare, but I write from experience on this.\n\nI disagree with everything else--I don't think it's wise to be cherry-picking random code from other Python packages that are not designed as libraries to be used by third-parties.  But it's ultimately up to Fr\u00e9d\u00e9ric if he's doing the work.",
    "created_at": "2017-05-24T13:39:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345037",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment%3A31):
> Replying to [@embray](#comment%3A30):
> > On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. 
> 
> 
> I have no idea what you mean with this.

What I mean is that when you have some code that parses output from doctests, one can sometimes stumble upon corner cases where it doesn't work properly for a test you're working on. So it's convenient to be able to easily tweak the code in the rare instances that that occurs.  Of course it is usually rare, but I write from experience on this.

I disagree with everything else--I don't think it's wise to be cherry-picking random code from other Python packages that are not designed as libraries to be used by third-parties.  But it's ultimately up to Frédéric if he's doing the work.



---

archive/issue_comments_345038.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\n\n```\n+    from Cython.Build.Dependencies import strip_string_literals\n```\n\nI don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.",
    "created_at": "2017-05-24T13:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345038",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>


```
+    from Cython.Build.Dependencies import strip_string_literals
```

I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.



---

archive/issue_comments_345039.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nIndeed, it sound like a good solution to use \"strip_string_literals\". Thanks to Jeroen for showing how to do that. I am not very worried about using an arcane function found somewhere inside cython.\n\nGiven the large quantity of failing doctests triggered by the general application of the replacement rule (see patchbot report), I would very much prefer if we postpone this general application to a later ticket. I think that this should probably be coordinated with a fully unicode-aware doctest framework (#14153).",
    "created_at": "2017-05-24T14:50:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345039",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:36" align="right">comment:36</div>

Indeed, it sound like a good solution to use "strip_string_literals". Thanks to Jeroen for showing how to do that. I am not very worried about using an arcane function found somewhere inside cython.

Given the large quantity of failing doctests triggered by the general application of the replacement rule (see patchbot report), I would very much prefer if we postpone this general application to a later ticket. I think that this should probably be coordinated with a fully unicode-aware doctest framework (#14153).



---

archive/issue_comments_345040.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHere is a branch, on top of Jeroen's branch, that does not try the systematic replacement. I propose to do that later in another ticket, because there are some  issues in relation with our unicode-unfriendly doc-framework.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56918aa6c64ce1af8508ccde92f996c94cdb9256\"><code>56918aa</code></a></td><td><code>Merge branch 'u/jdemeyer/23044' in 8.0.b8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91\"><code>18ff284</code></a></td><td><code>trac 23044 back to not systematic removal of u</code></td></tr></table>\n",
    "created_at": "2017-05-25T09:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345040",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:37" align="right">comment:37</div>

Here is a branch, on top of Jeroen's branch, that does not try the systematic replacement. I propose to do that later in another ticket, because there are some  issues in relation with our unicode-unfriendly doc-framework.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56918aa6c64ce1af8508ccde92f996c94cdb9256"><code>56918aa</code></a></td><td><code>Merge branch 'u/jdemeyer/23044' in 8.0.b8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91"><code>18ff284</code></a></td><td><code>trac 23044 back to not systematic removal of u</code></td></tr></table>




---

archive/issue_comments_345041.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)** to **[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)**",
    "created_at": "2017-05-25T09:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345041",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)** to **[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)**



---

archive/issue_comments_345042.json:
```json
{
    "body": "Changed commit from **[`d447eaa`](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)** to **[`18ff284`](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)**",
    "created_at": "2017-05-25T09:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345042",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`d447eaa`](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)** to **[`18ff284`](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)**



---

archive/issue_comments_345043.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@embray](#comment%3A35):\n> \n> ```\n> +    from Cython.Build.Dependencies import strip_string_literals\n> ```\n> \n> I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.\n\nSorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?",
    "created_at": "2017-05-27T18:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345043",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@embray](#comment%3A35):
> 
> ```
> +    from Cython.Build.Dependencies import strip_string_literals
> ```
> 
> I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.

Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?



---

archive/issue_comments_345044.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nDo you think that I should split off the \"trivial\" parts of this ticket ?",
    "created_at": "2017-05-30T12:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345044",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:39" align="right">comment:39</div>

Do you think that I should split off the "trivial" parts of this ticket ?



---

archive/issue_comments_345045.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@fchapoton](#comment%3A38):\n> Replying to [@embray](#comment%3A35):\n> > \n> > ```\n> > +    from Cython.Build.Dependencies import strip_string_literals\n> > ```\n> > \n> > I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.\n> \n> \n> Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?\n\nYes, the only reason to put an import inside a function definition is in special cases, such as where use of that function will be rare and a possibly expensive import should be avoided if not needed, or where it's needed to avoid a circular import or something like that.",
    "created_at": "2017-05-30T12:27:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345045",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@fchapoton](#comment%3A38):
> Replying to [@embray](#comment%3A35):
> > 
> > ```
> > +    from Cython.Build.Dependencies import strip_string_literals
> > ```
> > 
> > I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.
> 
> 
> Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?

Yes, the only reason to put an import inside a function definition is in special cases, such as where use of that function will be rare and a possibly expensive import should be avoided if not needed, or where it's needed to avoid a circular import or something like that.



---

archive/issue_comments_345046.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d\"><code>fbb5aa5</code></a></td><td><code>trac 23044 moving import to the top of file</code></td></tr></table>\n",
    "created_at": "2017-05-31T11:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345046",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d"><code>fbb5aa5</code></a></td><td><code>trac 23044 moving import to the top of file</code></td></tr></table>




---

archive/issue_comments_345047.json:
```json
{
    "body": "Changed commit from **[`18ff284`](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)** to **[`fbb5aa5`](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)**",
    "created_at": "2017-05-31T11:46:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345047",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`18ff284`](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)** to **[`fbb5aa5`](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)**



---

archive/issue_comments_345048.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nGreen bot.\n\nDoes anybody strongly object if we postpone the switch to (always preparse by remove_unicode_u) to another ticket ?",
    "created_at": "2017-05-31T19:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345048",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:42" align="right">comment:42</div>

Green bot.

Does anybody strongly object if we postpone the switch to (always preparse by remove_unicode_u) to another ticket ?



---

archive/issue_events_318570.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T19:28:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318570"
}
```



---

archive/issue_events_318571.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T19:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318571"
}
```



---

archive/issue_comments_345049.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nping ?",
    "created_at": "2017-06-05T08:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345049",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:43" align="right">comment:43</div>

ping ?



---

archive/issue_comments_345050.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nNo objection from me.",
    "created_at": "2017-06-05T09:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345050",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:44" align="right">comment:44</div>

No objection from me.



---

archive/issue_comments_345051.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nWould it be possible to do in this ticket just the minimal changes which are needed to support the \"u\" prefix in doctests? Because this ticket does that plus various unrelated fixes. I always find it hard to review tickets which combine new features with unrelated cleanup.",
    "created_at": "2017-06-06T09:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345051",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Would it be possible to do in this ticket just the minimal changes which are needed to support the "u" prefix in doctests? Because this ticket does that plus various unrelated fixes. I always find it hard to review tickets which combine new features with unrelated cleanup.



---

archive/issue_comments_345052.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI agree. I will try to do the split, but this is not in my git confidence area..",
    "created_at": "2017-06-06T09:26:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345052",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:46" align="right">comment:46</div>

I agree. I will try to do the split, but this is not in my git confidence area..



---

archive/issue_comments_345053.json:
```json
{
    "body": "Changed commit from **[`fbb5aa5`](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)** to **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**",
    "created_at": "2017-06-06T09:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345053",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`fbb5aa5`](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)** to **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**



---

archive/issue_comments_345054.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43\"><code>691a2de</code></a></td><td><code>py3: tolerance for u prefix in doctests</code></td></tr></table>\n",
    "created_at": "2017-06-06T09:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345054",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:47"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43"><code>691a2de</code></a></td><td><code>py3: tolerance for u prefix in doctests</code></td></tr></table>




---

archive/issue_comments_345055.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,6 @@\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n-This is done by a parsing which is not perfect, but works in most simple enough cases.\n+This is done by a parsing that calls an internal method of cython.\n \n-This ticket is also getting rid of two calls to \"unicode\".\n-\n-And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.\n+This parsing  may not be perfect, but works in most simple enough cases.\n``````\n",
    "created_at": "2017-06-06T09:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345055",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,6 @@
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
-This is done by a parsing which is not perfect, but works in most simple enough cases.
+This is done by a parsing that calls an internal method of cython.
 
-This ticket is also getting rid of two calls to "unicode".
-
-And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.
+This parsing  may not be perfect, but works in most simple enough cases.
``````




---

archive/issue_comments_345056.json:
```json
{
    "body": "Changed branch from **[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)** to **[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)**",
    "created_at": "2017-06-06T09:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345056",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)** to **[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)**



---

archive/issue_comments_345057.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nDone. Other changes are split off as #23147",
    "created_at": "2017-06-06T09:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345057",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:48" align="right">comment:48</div>

Done. Other changes are split off as #23147



---

archive/issue_comments_345058.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nEDIT: wrong ticket, sorry",
    "created_at": "2017-06-06T09:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345058",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:49" align="right">comment:49</div>

EDIT: wrong ticket, sorry



---

archive/issue_events_318572.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:58:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318572"
}
```



---

archive/issue_events_318573.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:58:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318573"
}
```



---

archive/issue_events_318574.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T10:03:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318574"
}
```



---

archive/issue_events_318575.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T10:03:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318575"
}
```



---

archive/issue_events_318576.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-07T07:43:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318576"
}
```



---

archive/issue_events_318577.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-07T07:43:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318577"
}
```



---

archive/issue_comments_345059.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nThanks!",
    "created_at": "2017-06-07T07:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345059",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Thanks!



---

archive/issue_comments_345060.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-06-07T07:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345060",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_318578.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-09T18:37:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318578"
}
```



---

archive/issue_events_318579.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bf41596da9aaf7aa882b5bfe69c2dea694834e48",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-09T18:37:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-318579"
}
```



---

archive/issue_comments_345061.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)** to **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**",
    "created_at": "2017-06-09T18:37:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-345061",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)** to **[`691a2de`](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)**
