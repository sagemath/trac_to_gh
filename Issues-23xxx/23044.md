# Issue 23044: py3: tolerance for u prefix in doctests

archive/issues_022807.json:
```json
{
    "body": "As a preparation step to py3:\n\n**One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n\nThis is done by a parsing that calls an internal method of cython.\n\nThis parsing  may not be perfect, but works in most simple enough cases.\n\n**CC:**  @jdemeyer @embray @vbraun @tscrim\n\n**Keywords:** unicode\n\n**Branch/Commit:** [691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/23044\n\n",
    "closed_at": "2017-06-09T18:37:54Z",
    "created_at": "2017-05-21T15:48:40Z",
    "labels": [
        "component: python3",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "title": "py3: tolerance for u prefix in doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/23044",
    "user": "https://github.com/fchapoton"
}
```
As a preparation step to py3:

**One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'

This is done by a parsing that calls an internal method of cython.

This parsing  may not be perfect, but works in most simple enough cases.

**CC:**  @jdemeyer @embray @vbraun @tscrim

**Keywords:** unicode

**Branch/Commit:** [691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)

**Reviewer:** Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/23044





---

archive/issue_comments_347572.json:
```json
{
    "body": "<a id='comment:1'></a>\nlet us wait for a bot's opinion\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66\">4e7d985</a></td><td><code>trac 23044 conversion to unicode of sageinspect, relax doctest of strings</code></td></tr></table>\n",
    "created_at": "2017-05-21T15:52:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347572",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
let us wait for a bot's opinion

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66">4e7d985</a></td><td><code>trac 23044 conversion to unicode of sageinspect, relax doctest of strings</code></td></tr></table>




---

archive/issue_events_205413.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-21T15:52:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205413"
}
```



---

archive/issue_comments_347573.json:
```json
{
    "body": "**Commit:** [4e7d98535d4a24395572f57e1131f471fab1ec66](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)",
    "created_at": "2017-05-21T15:52:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347573",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [4e7d98535d4a24395572f57e1131f471fab1ec66](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)



---

archive/issue_comments_347574.json:
```json
{
    "body": "**Branch:** [u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)",
    "created_at": "2017-05-21T15:52:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347574",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)



---

archive/issue_comments_347575.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n+This ticket is getting rid of two calls to \"unicode\".\n \n-\n``````\n",
    "created_at": "2017-05-21T15:55:26Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347575",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
+This ticket is getting rid of two calls to "unicode".
 
-
``````




---

archive/issue_comments_347576.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"unicode\".",
    "created_at": "2017-05-21T16:19:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347576",
    "user": "https://github.com/fchapoton"
}
```

**Changing keywords** from "" to "unicode".



---

archive/issue_comments_347577.json:
```json
{
    "body": "**Changing commit** from \"[4e7d98535d4a24395572f57e1131f471fab1ec66](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)\" to \"[1a736beefca12466c37319ba1947b59cba9dd9e5](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)\".",
    "created_at": "2017-05-21T19:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347577",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4e7d98535d4a24395572f57e1131f471fab1ec66](https://github.com/sagemath/sagetrac-mirror/commit/4e7d98535d4a24395572f57e1131f471fab1ec66)" to "[1a736beefca12466c37319ba1947b59cba9dd9e5](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)".



---

archive/issue_comments_347578.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5\">1a736be</a></td><td><code>trac 23044 better removal of u, fixing imports of six</code></td></tr></table>\n",
    "created_at": "2017-05-21T19:54:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347578",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5">1a736be</a></td><td><code>trac 23044 better removal of u, fixing imports of six</code></td></tr></table>




---

archive/issue_comments_347579.json:
```json
{
    "body": "<a id='comment:5'></a>\nSome tests are failing on the patchbot. Some are trivial (in a way) and others not so much.",
    "created_at": "2017-05-22T01:29:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347579",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Some tests are failing on the patchbot. Some are trivial (in a way) and others not so much.



---

archive/issue_events_205414.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-22T06:36:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205414"
}
```



---

archive/issue_events_205415.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-22T06:36:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205415"
}
```



---

archive/issue_comments_347580.json:
```json
{
    "body": "<a id='comment:6'></a>\nyes, in particular the doc does not build.. needs to be investigated",
    "created_at": "2017-05-22T06:36:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347580",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
yes, in particular the doc does not build.. needs to be investigated



---

archive/issue_comments_347581.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a\">ea80844</a></td><td><code>trac 23044 fixing the easy failing doctests</code></td></tr></table>\n",
    "created_at": "2017-05-22T19:19:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a">ea80844</a></td><td><code>trac 23044 fixing the easy failing doctests</code></td></tr></table>




---

archive/issue_comments_347582.json:
```json
{
    "body": "**Changing commit** from \"[1a736beefca12466c37319ba1947b59cba9dd9e5](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)\" to \"[ea80844217612fcca87cf34f90fe8502ae8d7a4a](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)\".",
    "created_at": "2017-05-22T19:19:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1a736beefca12466c37319ba1947b59cba9dd9e5](https://github.com/sagemath/sagetrac-mirror/commit/1a736beefca12466c37319ba1947b59cba9dd9e5)" to "[ea80844217612fcca87cf34f90fe8502ae8d7a4a](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)".



---

archive/issue_comments_347583.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190\">81a8ca7</a></td><td><code>trac 23044 one detail</code></td></tr></table>\n",
    "created_at": "2017-05-22T19:52:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190">81a8ca7</a></td><td><code>trac 23044 one detail</code></td></tr></table>




---

archive/issue_comments_347584.json:
```json
{
    "body": "**Changing commit** from \"[ea80844217612fcca87cf34f90fe8502ae8d7a4a](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)\" to \"[81a8ca78ea6c5557aed182f8a041cc54594d9190](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)\".",
    "created_at": "2017-05-22T19:52:12Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ea80844217612fcca87cf34f90fe8502ae8d7a4a](https://github.com/sagemath/sagetrac-mirror/commit/ea80844217612fcca87cf34f90fe8502ae8d7a4a)" to "[81a8ca78ea6c5557aed182f8a041cc54594d9190](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)".



---

archive/issue_comments_347585.json:
```json
{
    "body": "**Changing commit** from \"[81a8ca78ea6c5557aed182f8a041cc54594d9190](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)\" to \"[45a3be70f51497c634d126693d802d235a3e8f97](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)\".",
    "created_at": "2017-05-23T07:08:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347585",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[81a8ca78ea6c5557aed182f8a041cc54594d9190](https://github.com/sagemath/sagetrac-mirror/commit/81a8ca78ea6c5557aed182f8a041cc54594d9190)" to "[45a3be70f51497c634d126693d802d235a3e8f97](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)".



---

archive/issue_comments_347586.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97\">45a3be7</a></td><td><code>trac 23044 do not switch to unicode yet</code></td></tr></table>\n",
    "created_at": "2017-05-23T07:08:46Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347586",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97">45a3be7</a></td><td><code>trac 23044 do not switch to unicode yet</code></td></tr></table>




---

archive/issue_events_205416.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205416"
}
```



---

archive/issue_events_205417.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205417"
}
```



---

archive/issue_comments_347587.json:
```json
{
    "body": "<a id='comment:10'></a>\ngreen bot, please review !",
    "created_at": "2017-05-23T13:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347587",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
green bot, please review !



---

archive/issue_events_205418.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T13:29:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "rename": {
        "from": "py3: use unicode in sageinspect",
        "to": "py3: tolerance for u prefix in doctests"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205418"
}
```



---

archive/issue_comments_347588.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n-preparation to py3\n+As a preparation step to py3:\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n-This ticket is getting rid of two calls to \"unicode\".\n+This is done by a parsing which is not perfect, but works in most simple enough cases.\n \n+This ticket is also getting rid of two calls to \"unicode\".\n+\n+And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.\n``````\n",
    "created_at": "2017-05-23T13:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347588",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
-preparation to py3
+As a preparation step to py3:
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
-This ticket is getting rid of two calls to "unicode".
+This is done by a parsing which is not perfect, but works in most simple enough cases.
 
+This ticket is also getting rid of two calls to "unicode".
+
+And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.
``````




---

archive/issue_comments_347589.json:
```json
{
    "body": "<a id='comment:11'></a>\n1. From the patch:\n\n```\nBut this breaks on something like \"[u\"Singular's stuff\", u'good']\" !!!\n```\n\nYou may want to consider using [strip_string_literals](https://github.com/cython/cython/blob/master/Cython/Build/Dependencies.py#L277) for a more robust implementation.\n\n2. The `[u\"Singular's stuff\", u'good']` example should be a doctest (depending on your opinion on 1, either to show that it works or to show how it breaks).\n\n3. Revert this:\n\n```diff\ndiff --git a/src/sage/misc/six.py b/src/sage/misc/six.py\nindex 37295c7..eed7d9a 100644\n--- a/src/sage/misc/six.py\n+++ b/src/sage/misc/six.py\n@@ -5,7 +5,7 @@ Python 2 and 3 Compatibility\n \n from __future__ import absolute_import\n \n-from six import *\n+from six import text_type, binary_type\n \n \n def with_metaclass(meta, *bases):\n```\nThe `import *` is intentional: the idea is that `sage.misc.six` can replace the standard `six` module.\n\n4. Since the commits don't really make sense, I suggest to squash this to 1 commit.",
    "created_at": "2017-05-23T13:46:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347589",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
1. From the patch:

```
But this breaks on something like "[u"Singular's stuff", u'good']" !!!
```

You may want to consider using [strip_string_literals](https://github.com/cython/cython/blob/master/Cython/Build/Dependencies.py#L277) for a more robust implementation.

2. The `[u"Singular's stuff", u'good']` example should be a doctest (depending on your opinion on 1, either to show that it works or to show how it breaks).

3. Revert this:

```diff
diff --git a/src/sage/misc/six.py b/src/sage/misc/six.py
index 37295c7..eed7d9a 100644
--- a/src/sage/misc/six.py
+++ b/src/sage/misc/six.py
@@ -5,7 +5,7 @@ Python 2 and 3 Compatibility
 
 from __future__ import absolute_import
 
-from six import *
+from six import text_type, binary_type
 
 
 def with_metaclass(meta, *bases):
```
The `import *` is intentional: the idea is that `sage.misc.six` can replace the standard `six` module.

4. Since the commits don't really make sense, I suggest to squash this to 1 commit.



---

archive/issue_events_205419.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-23T13:46:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205419"
}
```



---

archive/issue_events_205420.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-05-23T13:46:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205420"
}
```



---

archive/issue_comments_347590.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286\">04568d6</a></td><td><code>trac 23044 relax doctest of strings, preparation for unicode in sageinspect</code></td></tr></table>\n",
    "created_at": "2017-05-23T13:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286">04568d6</a></td><td><code>trac 23044 relax doctest of strings, preparation for unicode in sageinspect</code></td></tr></table>




---

archive/issue_comments_347591.json:
```json
{
    "body": "**Changing commit** from \"[45a3be70f51497c634d126693d802d235a3e8f97](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)\" to \"[04568d6e40751ba4b27c28d2b95975166132b286](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)\".",
    "created_at": "2017-05-23T13:56:36Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[45a3be70f51497c634d126693d802d235a3e8f97](https://github.com/sagemath/sagetrac-mirror/commit/45a3be70f51497c634d126693d802d235a3e8f97)" to "[04568d6e40751ba4b27c28d2b95975166132b286](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)".



---

archive/issue_comments_347592.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for the suggestion to use `strip_string_literals`. But I do not understand how I could use it and what it does, given that is has no doctest.",
    "created_at": "2017-05-23T14:01:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347592",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Thanks for the suggestion to use `strip_string_literals`. But I do not understand how I could use it and what it does, given that is has no doctest.



---

archive/issue_comments_347593.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt's not clear to me what you mean with \"**internal** unicode u markers\" (if you stress the word `**internal**`, explain what it means).",
    "created_at": "2017-05-23T14:01:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347593",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
It's not clear to me what you mean with "**internal** unicode u markers" (if you stress the word `**internal**`, explain what it means).



---

archive/issue_comments_347594.json:
```json
{
    "body": "<a id='comment:15'></a>\nWell, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.",
    "created_at": "2017-05-23T14:05:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347594",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.



---

archive/issue_comments_347595.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [chapoton](#comment%3A15):\n> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.\n\n\nDon't explain on Trac, explain in the docstring.",
    "created_at": "2017-05-23T14:06:38Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347595",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [chapoton](#comment%3A15):
> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.


Don't explain on Trac, explain in the docstring.



---

archive/issue_comments_347596.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [chapoton](#comment%3A15):\n> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.\n\n\nI think the word `**internal**` adds more confusion than it solves. I would remove it.",
    "created_at": "2017-05-23T14:07:17Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347596",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [chapoton](#comment%3A15):
> Well, the input is a string (typically the doc of a sage method) and some of the letters u that it contains are there to mark the presence of unicode strings inside. This is the meaning of internal. That the input string itself is unicode or not, we do not care.


I think the word `**internal**` adds more confusion than it solves. I would remove it.



---

archive/issue_comments_347597.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4\">7bb1929</a></td><td><code>trac 23044 more explanation in remove_unicode_u</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:12:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4">7bb1929</a></td><td><code>trac 23044 more explanation in remove_unicode_u</code></td></tr></table>




---

archive/issue_comments_347598.json:
```json
{
    "body": "**Changing commit** from \"[04568d6e40751ba4b27c28d2b95975166132b286](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)\" to \"[7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)\".",
    "created_at": "2017-05-23T14:12:29Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[04568d6e40751ba4b27c28d2b95975166132b286](https://github.com/sagemath/sagetrac-mirror/commit/04568d6e40751ba4b27c28d2b95975166132b286)" to "[7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)".



---

archive/issue_comments_347599.json:
```json
{
    "body": "<a id='comment:19'></a>\nhere is more doc for remove_unicode_u",
    "created_at": "2017-05-23T14:12:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347599",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
here is more doc for remove_unicode_u



---

archive/issue_comments_347600.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'm not totally convinced by the logic in the doctest framework. I think we should call `remove_unicode_u` on the output unconditionally. I know that this will break existing doctests, but those doctests would break anyway on Python 3. And it's better to fix it now that there are not so many doctests with `u''`.",
    "created_at": "2017-05-23T14:14:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347600",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
I'm not totally convinced by the logic in the doctest framework. I think we should call `remove_unicode_u` on the output unconditionally. I know that this will break existing doctests, but those doctests would break anyway on Python 3. And it's better to fix it now that there are not so many doctests with `u''`.



---

archive/issue_comments_347601.json:
```json
{
    "body": "<a id='comment:21'></a>\n\n```\nsage: remove_unicode_u(\"'\u20ac'\")\n---------------------------------------------------------------------------\nUnicodeDecodeError                        Traceback (most recent call last)\n<ipython-input-7-8e5f967a743e> in <module>()\n----> 1 remove_unicode_u(\"'\u20ac'\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/parsing.pyc in remove_unicode_u(string)\n    106             final.append(\"'\")\n    107         parity += 1\n--> 108     string1 = u''.join(final[:-1])\n    109 \n    110     # same for u\"\n\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 1: ordinal not in range(128)\n```",
    "created_at": "2017-05-23T14:19:32Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347601",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>

```
sage: remove_unicode_u("'€'")
---------------------------------------------------------------------------
UnicodeDecodeError                        Traceback (most recent call last)
<ipython-input-7-8e5f967a743e> in <module>()
----> 1 remove_unicode_u("'€'")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/parsing.pyc in remove_unicode_u(string)
    106             final.append("'")
    107         parity += 1
--> 108     string1 = u''.join(final[:-1])
    109 
    110     # same for u"

UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 1: ordinal not in range(128)
```



---

archive/issue_comments_347602.json:
```json
{
    "body": "<a id='comment:22'></a>\nI was thinking to 2 things:\n\n1) do not spend more time in the doctests\n\n2) the failing doctests in python3 can be cared of somewhere else (how many are there ?)",
    "created_at": "2017-05-23T14:21:25Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347602",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>
I was thinking to 2 things:

1) do not spend more time in the doctests

2) the failing doctests in python3 can be cared of somewhere else (how many are there ?)



---

archive/issue_comments_347603.json:
```json
{
    "body": "**Changing commit** from \"[7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)\" to \"[f314d0745b23d606da9f9d49c87a7b60e2ecf9ca](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)\".",
    "created_at": "2017-05-23T14:27:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4](https://github.com/sagemath/sagetrac-mirror/commit/7bb1929e40f337c4cf4c49032f044bbb1f0c6ae4)" to "[f314d0745b23d606da9f9d49c87a7b60e2ecf9ca](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)".



---

archive/issue_comments_347604.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca\">f314d07</a></td><td><code>trac 23044 support bytes as possible input</code></td></tr></table>\n",
    "created_at": "2017-05-23T14:27:30Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca">f314d07</a></td><td><code>trac 23044 support bytes as possible input</code></td></tr></table>




---

archive/issue_comments_347605.json:
```json
{
    "body": "<a id='comment:24'></a>\nnow works with bytes input (still return unicode)",
    "created_at": "2017-05-23T14:28:48Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347605",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>
now works with bytes input (still return unicode)



---

archive/issue_comments_347606.json:
```json
{
    "body": "<a id='comment:25'></a>\n* do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n\n* I would prefer not to apply \"remove_unicode_u\" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.",
    "created_at": "2017-05-23T20:25:15Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347606",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
* do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?

* I would prefer not to apply "remove_unicode_u" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.



---

archive/issue_events_205421.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T20:25:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205421"
}
```



---

archive/issue_events_205422.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-23T20:25:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205422"
}
```



---

archive/issue_comments_347607.json:
```json
{
    "body": "<a id='comment:26'></a>\nI don't think the level of complexity in this is really necessary (making sure a closing quote is found, etc.).  Astropy's doctest checker just uses a [simple regex](https://github.com/astropy/astropy/blob/master/astropy/tests/output_checker.py#L43) which, given knowledge of Python syntax and typical `repr`s of Python objects, is almost always going to be a positive match.  It's true one can come up with examples where it would be a false positive but I don't think it's ever occurred in practice.\n\nThat said, Sage has a lot more doctests and a lot more odd cases, and you've already worked out a way to do this that's perhaps more robust so I wouldn't toss it out if it works.  I would just eliminate the code duplication, perhaps by making an inline function, like:\n\n```python\ndef strip_u_prefix(s, q):\n    prefix = 'u' + q\n    initial = s.split(prefix)\n    parity = 0\n    final = []\n    for part in initial:\n        parity += part.count(q)\n        final.append(part)\n        if parity % 2:\n            final.append(prefix)\n        else:\n            final.append(q)\n        parity += 1\n    return u''.join(final[:-1])\n\ns = strip_u_prefix(s, '\"')\nreturn strip_u_prefix(s, \"'\")\n```\n\nor something like that.",
    "created_at": "2017-05-24T08:03:47Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347607",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>
I don't think the level of complexity in this is really necessary (making sure a closing quote is found, etc.).  Astropy's doctest checker just uses a [simple regex](https://github.com/astropy/astropy/blob/master/astropy/tests/output_checker.py#L43) which, given knowledge of Python syntax and typical `repr`s of Python objects, is almost always going to be a positive match.  It's true one can come up with examples where it would be a false positive but I don't think it's ever occurred in practice.

That said, Sage has a lot more doctests and a lot more odd cases, and you've already worked out a way to do this that's perhaps more robust so I wouldn't toss it out if it works.  I would just eliminate the code duplication, perhaps by making an inline function, like:

```python
def strip_u_prefix(s, q):
    prefix = 'u' + q
    initial = s.split(prefix)
    parity = 0
    final = []
    for part in initial:
        parity += part.count(q)
        final.append(part)
        if parity % 2:
            final.append(prefix)
        else:
            final.append(q)
        parity += 1
    return u''.join(final[:-1])

s = strip_u_prefix(s, '"')
return strip_u_prefix(s, "'")
```

or something like that.



---

archive/issue_comments_347608.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [chapoton](#comment%3A25):\n> * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n\n\nIt seems overcomplicated.\n\n> * I would prefer not to apply \"remove_unicode_u\" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.\n\n\nI'd be surprised if this really had any impact on speed in the grand scheme of things.  In a full test run it might add up to a few seconds.  But if you can demonstrate otherwise, a simple regexp as I suggested above might mitigate somewhat.\n\nI think it's simpler to apply this on all tests by default since it's very easy to forget otherwise, but there should probably be an option to disable it on a specific test in the rare case where it removes a false positive.",
    "created_at": "2017-05-24T08:07:28Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347608",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
Replying to [chapoton](#comment%3A25):
> * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?


It seems overcomplicated.

> * I would prefer not to apply "remove_unicode_u" to all doctests, one reason is that it is not working perfectly, another is for speed, and another is to keep our current doctests with u for the moment.


I'd be surprised if this really had any impact on speed in the grand scheme of things.  In a full test run it might add up to a few seconds.  But if you can demonstrate otherwise, a simple regexp as I suggested above might mitigate somewhat.

I think it's simpler to apply this on all tests by default since it's very easy to forget otherwise, but there should probably be an option to disable it on a specific test in the rare case where it removes a false positive.



---

archive/issue_comments_347609.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475\">ec37fd4</a></td><td><code>trac 23044 let us try to always remove the offending u</code></td></tr></table>\n",
    "created_at": "2017-05-24T11:20:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475">ec37fd4</a></td><td><code>trac 23044 let us try to always remove the offending u</code></td></tr></table>




---

archive/issue_comments_347610.json:
```json
{
    "body": "**Changing commit** from \"[f314d0745b23d606da9f9d49c87a7b60e2ecf9ca](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)\" to \"[ec37fd4c1531cca3249674e5e40b51e45bb11475](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)\".",
    "created_at": "2017-05-24T11:20:22Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347610",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f314d0745b23d606da9f9d49c87a7b60e2ecf9ca](https://github.com/sagemath/sagetrac-mirror/commit/f314d0745b23d606da9f9d49c87a7b60e2ecf9ca)" to "[ec37fd4c1531cca3249674e5e40b51e45bb11475](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)".



---

archive/issue_comments_347611.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [embray](#comment%3A27):\n> Replying to [chapoton](#comment%3A25):\n> > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n \n> \n> It seems overcomplicated.\n\n\nI would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.\n\nI must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.",
    "created_at": "2017-05-24T11:33:19Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347611",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [embray](#comment%3A27):
> Replying to [chapoton](#comment%3A25):
> > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?
 
> 
> It seems overcomplicated.


I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.

I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.



---

archive/issue_comments_347612.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [jdemeyer](#comment%3A29):\n> Replying to [embray](#comment%3A27):\n> > Replying to [chapoton](#comment%3A25):\n> > > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?\n \n> > \n> > It seems overcomplicated.\n\n> \n> I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.\n> \n> I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.\n\n\nNormally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.  I don't think it's a good idea to rely on miscellaneous undocumented functions somewhere in another package that isn't all that related to what you're actually using it for (granted, at least in Cython's case, it is related to parsing Python).\n\nI think if, for this case, one wanted to reuse some existing machinery the stdlib's [ast](https://docs.python.org/2/library/ast.html#ast-helpers) module would be a better choice.  This can be used to parse output for Python literals and interpret them as needed (and if the output isn't a valid Python literal then we probably shouldn't try to interpret it as such).  But I still think that's overkill for this purpose, where in my experience as simple regexp has almost always worked.\n\nOn a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there *are* bound to be corner cases eventually.",
    "created_at": "2017-05-24T11:49:37Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347612",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
Replying to [jdemeyer](#comment%3A29):
> Replying to [embray](#comment%3A27):
> > Replying to [chapoton](#comment%3A25):
> > > * do you think there is a way to use `strip_string_literals` or do you instead suggest to get inspired by the code ?
 
> > 
> > It seems overcomplicated.

> 
> I would argue the opposite: if you can re-use an existing function which does most of the work, things become *less* complicated.
> 
> I must add that I haven't actually checked if `strip_string_literals` can be used. But if yes, that seems the way to go.


Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.  I don't think it's a good idea to rely on miscellaneous undocumented functions somewhere in another package that isn't all that related to what you're actually using it for (granted, at least in Cython's case, it is related to parsing Python).

I think if, for this case, one wanted to reuse some existing machinery the stdlib's [ast](https://docs.python.org/2/library/ast.html#ast-helpers) module would be a better choice.  This can be used to parse output for Python literals and interpret them as needed (and if the output isn't a valid Python literal then we probably shouldn't try to interpret it as such).  But I still think that's overkill for this purpose, where in my experience as simple regexp has almost always worked.

On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there *are* bound to be corner cases eventually.



---

archive/issue_comments_347613.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [embray](#comment%3A30):\n> Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.\n\n\nWhile there is no *guarantee*, we can rely on it as long as Cython provides that function. For the record: that function has existed for almost 7 years with the current functionality. In the case that Cython moves/deletes/changes that function, we can always adapt Sage. In the worst case, we just copy that function to the Sage sources.\n\nI disagree with `ast` since that's almost certainly going to be a lot slower. I believe that `strip_string_literals()` is the right tool for the job.\n\n> On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. \n\n\nI have no idea what you mean with this.",
    "created_at": "2017-05-24T12:36:00Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347613",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [embray](#comment%3A30):
> Normally I would agree of course, but not in the case of an undocumented function, buried in Cython's internals, which I don't believe guarantee a stable API of any sort.


While there is no *guarantee*, we can rely on it as long as Cython provides that function. For the record: that function has existed for almost 7 years with the current functionality. In the case that Cython moves/deletes/changes that function, we can always adapt Sage. In the worst case, we just copy that function to the Sage sources.

I disagree with `ast` since that's almost certainly going to be a lot slower. I believe that `strip_string_literals()` is the right tool for the job.

> On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. 


I have no idea what you mean with this.



---

archive/issue_comments_347614.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)\" to \"[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)\".",
    "created_at": "2017-05-24T12:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347614",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/chapoton/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044)" to "[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)".



---

archive/issue_comments_347615.json:
```json
{
    "body": "<a id='comment:33'></a>\nIn my last commit, I'm using `strip_string_literals()` to simplify and correct `remove_unicode_u()`. I just wanted to show how simple the function becomes; if you still feel that this isn't the right solution, feel free to remove that commit.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/665497473c7577e4edb9e79c7538b807e8573dc7\">6654974</a></td><td><code>No need for binary_type, bytes works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4\">d447eaa</a></td><td><code>Use strip_string_literals() in remove_unicode_u()</code></td></tr></table>\n",
    "created_at": "2017-05-24T12:54:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347615",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
In my last commit, I'm using `strip_string_literals()` to simplify and correct `remove_unicode_u()`. I just wanted to show how simple the function becomes; if you still feel that this isn't the right solution, feel free to remove that commit.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/665497473c7577e4edb9e79c7538b807e8573dc7">6654974</a></td><td><code>No need for binary_type, bytes works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4">d447eaa</a></td><td><code>Use strip_string_literals() in remove_unicode_u()</code></td></tr></table>




---

archive/issue_comments_347616.json:
```json
{
    "body": "**Changing commit** from \"[ec37fd4c1531cca3249674e5e40b51e45bb11475](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)\" to \"[d447eaa790e8d03db15cc5cea3912674a6c836e4](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)\".",
    "created_at": "2017-05-24T12:54:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347616",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ec37fd4c1531cca3249674e5e40b51e45bb11475](https://github.com/sagemath/sagetrac-mirror/commit/ec37fd4c1531cca3249674e5e40b51e45bb11475)" to "[d447eaa790e8d03db15cc5cea3912674a6c836e4](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)".



---

archive/issue_comments_347617.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A31):\n> Replying to [embray](#comment%3A30):\n> > On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. \n\n> \n> I have no idea what you mean with this.\n\n\nWhat I mean is that when you have some code that parses output from doctests, one can sometimes stumble upon corner cases where it doesn't work properly for a test you're working on. So it's convenient to be able to easily tweak the code in the rare instances that that occurs.  Of course it is usually rare, but I write from experience on this.\n\nI disagree with everything else--I don't think it's wise to be cherry-picking random code from other Python packages that are not designed as libraries to be used by third-parties.  But it's ultimately up to Fr\u00e9d\u00e9ric if he's doing the work.",
    "created_at": "2017-05-24T13:39:10Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347617",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A31):
> Replying to [embray](#comment%3A30):
> > On a final note, for something like checking doctest output you also want a lot more immediate control over the details, since there are bound to be corner cases eventually. 

> 
> I have no idea what you mean with this.


What I mean is that when you have some code that parses output from doctests, one can sometimes stumble upon corner cases where it doesn't work properly for a test you're working on. So it's convenient to be able to easily tweak the code in the rare instances that that occurs.  Of course it is usually rare, but I write from experience on this.

I disagree with everything else--I don't think it's wise to be cherry-picking random code from other Python packages that are not designed as libraries to be used by third-parties.  But it's ultimately up to Frédéric if he's doing the work.



---

archive/issue_comments_347618.json:
```json
{
    "body": "<a id='comment:35'></a>\n\n```\n+    from Cython.Build.Dependencies import strip_string_literals\n```\n\nI don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.",
    "created_at": "2017-05-24T13:40:20Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347618",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>

```
+    from Cython.Build.Dependencies import strip_string_literals
```

I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.



---

archive/issue_comments_347619.json:
```json
{
    "body": "<a id='comment:36'></a>\nIndeed, it sound like a good solution to use \"strip_string_literals\". Thanks to Jeroen for showing how to do that. I am not very worried about using an arcane function found somewhere inside cython.\n\nGiven the large quantity of failing doctests triggered by the general application of the replacement rule (see patchbot report), I would very much prefer if we postpone this general application to a later ticket. I think that this should probably be coordinated with a fully unicode-aware doctest framework (#14153).",
    "created_at": "2017-05-24T14:50:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347619",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>
Indeed, it sound like a good solution to use "strip_string_literals". Thanks to Jeroen for showing how to do that. I am not very worried about using an arcane function found somewhere inside cython.

Given the large quantity of failing doctests triggered by the general application of the replacement rule (see patchbot report), I would very much prefer if we postpone this general application to a later ticket. I think that this should probably be coordinated with a fully unicode-aware doctest framework (#14153).



---

archive/issue_comments_347620.json:
```json
{
    "body": "<a id='comment:37'></a>\nHere is a branch, on top of Jeroen's branch, that does not try the systematic replacement. I propose to do that later in another ticket, because there are some  issues in relation with our unicode-unfriendly doc-framework.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56918aa6c64ce1af8508ccde92f996c94cdb9256\">56918aa</a></td><td><code>Merge branch 'u/jdemeyer/23044' in 8.0.b8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91\">18ff284</a></td><td><code>trac 23044 back to not systematic removal of u</code></td></tr></table>\n",
    "created_at": "2017-05-25T09:17:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347620",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:37'></a>
Here is a branch, on top of Jeroen's branch, that does not try the systematic replacement. I propose to do that later in another ticket, because there are some  issues in relation with our unicode-unfriendly doc-framework.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56918aa6c64ce1af8508ccde92f996c94cdb9256">56918aa</a></td><td><code>Merge branch 'u/jdemeyer/23044' in 8.0.b8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91">18ff284</a></td><td><code>trac 23044 back to not systematic removal of u</code></td></tr></table>




---

archive/issue_comments_347621.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)\" to \"[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)\".",
    "created_at": "2017-05-25T09:17:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347621",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/jdemeyer/23044](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/23044)" to "[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)".



---

archive/issue_comments_347622.json:
```json
{
    "body": "**Changing commit** from \"[d447eaa790e8d03db15cc5cea3912674a6c836e4](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)\" to \"[18ff284c8ccbcfef2a75dd8d8d4c266230e96b91](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)\".",
    "created_at": "2017-05-25T09:17:50Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347622",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[d447eaa790e8d03db15cc5cea3912674a6c836e4](https://github.com/sagemath/sagetrac-mirror/commit/d447eaa790e8d03db15cc5cea3912674a6c836e4)" to "[18ff284c8ccbcfef2a75dd8d8d4c266230e96b91](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)".



---

archive/issue_comments_347623.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [embray](#comment%3A35):\n> \n> ```\n> +    from Cython.Build.Dependencies import strip_string_literals\n> ```\n> \n> I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.\n\n\nSorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?",
    "created_at": "2017-05-27T18:49:52Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347623",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:38'></a>
Replying to [embray](#comment%3A35):
> 
> ```
> +    from Cython.Build.Dependencies import strip_string_literals
> ```
> 
> I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.


Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?



---

archive/issue_comments_347624.json:
```json
{
    "body": "<a id='comment:39'></a>\nDo you think that I should split off the \"trivial\" parts of this ticket ?",
    "created_at": "2017-05-30T12:10:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347624",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>
Do you think that I should split off the "trivial" parts of this ticket ?



---

archive/issue_comments_347625.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [chapoton](#comment%3A38):\n> Replying to [embray](#comment%3A35):\n> > \n> > ```\n> > +    from Cython.Build.Dependencies import strip_string_literals\n> > ```\n> > \n> > I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.\n\n> \n> Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?\n\n\nYes, the only reason to put an import inside a function definition is in special cases, such as where use of that function will be rare and a possibly expensive import should be avoided if not needed, or where it's needed to avoid a circular import or something like that.",
    "created_at": "2017-05-30T12:27:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347625",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
Replying to [chapoton](#comment%3A38):
> Replying to [embray](#comment%3A35):
> > 
> > ```
> > +    from Cython.Build.Dependencies import strip_string_literals
> > ```
> > 
> > I don't see why the in-line import is used here.  This generally shouldn't be done unless there's a good reason.

> 
> Sorry, I do not understand what this means. Should I put this import at the beginning of the file instead ?


Yes, the only reason to put an import inside a function definition is in special cases, such as where use of that function will be rare and a possibly expensive import should be avoided if not needed, or where it's needed to avoid a circular import or something like that.



---

archive/issue_comments_347626.json:
```json
{
    "body": "<a id='comment:41'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d\">fbb5aa5</a></td><td><code>trac 23044 moving import to the top of file</code></td></tr></table>\n",
    "created_at": "2017-05-31T11:46:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347626",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d">fbb5aa5</a></td><td><code>trac 23044 moving import to the top of file</code></td></tr></table>




---

archive/issue_comments_347627.json:
```json
{
    "body": "**Changing commit** from \"[18ff284c8ccbcfef2a75dd8d8d4c266230e96b91](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)\" to \"[fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)\".",
    "created_at": "2017-05-31T11:46:09Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347627",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[18ff284c8ccbcfef2a75dd8d8d4c266230e96b91](https://github.com/sagemath/sagetrac-mirror/commit/18ff284c8ccbcfef2a75dd8d8d4c266230e96b91)" to "[fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)".



---

archive/issue_comments_347628.json:
```json
{
    "body": "<a id='comment:42'></a>\nGreen bot.\n\nDoes anybody strongly object if we postpone the switch to (always preparse by remove_unicode_u) to another ticket ?",
    "created_at": "2017-05-31T19:28:03Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347628",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:42'></a>
Green bot.

Does anybody strongly object if we postpone the switch to (always preparse by remove_unicode_u) to another ticket ?



---

archive/issue_events_205423.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T19:28:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205423"
}
```



---

archive/issue_events_205424.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-05-31T19:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205424"
}
```



---

archive/issue_comments_347629.json:
```json
{
    "body": "<a id='comment:43'></a>\nping ?",
    "created_at": "2017-06-05T08:40:49Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347629",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>
ping ?



---

archive/issue_comments_347630.json:
```json
{
    "body": "<a id='comment:44'></a>\nNo objection from me.",
    "created_at": "2017-06-05T09:10:07Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347630",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>
No objection from me.



---

archive/issue_comments_347631.json:
```json
{
    "body": "<a id='comment:45'></a>\nWould it be possible to do in this ticket just the minimal changes which are needed to support the \"u\" prefix in doctests? Because this ticket does that plus various unrelated fixes. I always find it hard to review tickets which combine new features with unrelated cleanup.",
    "created_at": "2017-06-06T09:23:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347631",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>
Would it be possible to do in this ticket just the minimal changes which are needed to support the "u" prefix in doctests? Because this ticket does that plus various unrelated fixes. I always find it hard to review tickets which combine new features with unrelated cleanup.



---

archive/issue_comments_347632.json:
```json
{
    "body": "<a id='comment:46'></a>\nI agree. I will try to do the split, but this is not in my git confidence area..",
    "created_at": "2017-06-06T09:26:05Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347632",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'></a>
I agree. I will try to do the split, but this is not in my git confidence area..



---

archive/issue_comments_347633.json:
```json
{
    "body": "**Changing commit** from \"[fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)\" to \"[691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)\".",
    "created_at": "2017-06-06T09:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347633",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d](https://github.com/sagemath/sagetrac-mirror/commit/fbb5aa5ec8ec9b6ee3c79a98983f478cbf0e094d)" to "[691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)".



---

archive/issue_comments_347634.json:
```json
{
    "body": "<a id='comment:47'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43\">691a2de</a></td><td><code>py3: tolerance for u prefix in doctests</code></td></tr></table>\n",
    "created_at": "2017-06-06T09:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347634",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:47'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43">691a2de</a></td><td><code>py3: tolerance for u prefix in doctests</code></td></tr></table>




---

archive/issue_comments_347635.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,8 +2,6 @@\n \n **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'\n \n-This is done by a parsing which is not perfect, but works in most simple enough cases.\n+This is done by a parsing that calls an internal method of cython.\n \n-This ticket is also getting rid of two calls to \"unicode\".\n-\n-And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.\n+This parsing  may not be perfect, but works in most simple enough cases.\n``````\n",
    "created_at": "2017-06-06T09:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347635",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,8 +2,6 @@
 
 **One important change**: allows any doctest to pass if sage returns u'blabla' and the doctest requires 'blabla'
 
-This is done by a parsing which is not perfect, but works in most simple enough cases.
+This is done by a parsing that calls an internal method of cython.
 
-This ticket is also getting rid of two calls to "unicode".
-
-And it also prepares for unicode in sageinspect, but does not turn it on, because it would break the doc building and sagenb.
+This parsing  may not be perfect, but works in most simple enough cases.
``````




---

archive/issue_comments_347636.json:
```json
{
    "body": "**Changing branch** from \"[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)\" to \"[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)\".",
    "created_at": "2017-06-06T09:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347636",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[public/23044](https://github.com/sagemath/sagetrac-mirror/tree/public/23044)" to "[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)".



---

archive/issue_comments_347637.json:
```json
{
    "body": "<a id='comment:48'></a>\nDone. Other changes are split off as #23147",
    "created_at": "2017-06-06T09:57:08Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347637",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:48'></a>
Done. Other changes are split off as #23147



---

archive/issue_comments_347638.json:
```json
{
    "body": "<a id='comment:49'></a>\nEDIT: wrong ticket, sorry",
    "created_at": "2017-06-06T09:58:21Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347638",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:49'></a>
EDIT: wrong ticket, sorry



---

archive/issue_events_205425.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:58:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205425"
}
```



---

archive/issue_events_205426.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:58:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205426"
}
```



---

archive/issue_events_205427.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T10:03:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205427"
}
```



---

archive/issue_events_205428.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T10:03:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205428"
}
```



---

archive/issue_events_205429.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-07T07:43:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205429"
}
```



---

archive/issue_events_205430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-06-07T07:43:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205430"
}
```



---

archive/issue_comments_347639.json:
```json
{
    "body": "<a id='comment:51'></a>\nThanks!",
    "created_at": "2017-06-07T07:43:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347639",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>
Thanks!



---

archive/issue_comments_347640.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-06-07T07:43:59Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347640",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_205431.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-09T18:37:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205431"
}
```



---

archive/issue_events_205432.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-09T18:37:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23044#event-205432"
}
```



---

archive/issue_comments_347641.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)\" to \"[691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)\".",
    "created_at": "2017-06-09T18:37:54Z",
    "issue": "https://github.com/sagemath/sage/issues/23044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23044#issuecomment-347641",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/23044v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23044v2)" to "[691a2dea644bed1749e224f53b9f9822aac39a43](https://github.com/sagemath/sagetrac-mirror/commit/691a2dea644bed1749e224f53b9f9822aac39a43)".
