# Issue 23819: Speed up AlternatingSignMatrix.from_corner_sum

archive/issues_023582.json:
```json
{
    "body": "old:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.6 s per loop\n```\n\nnew:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1) \n1 loops, best of 1: 2.33 s per loop\n```\n\nCC:  @jessicapalencia @kevindilks\n\nReviewer: Travis Scrimshaw, Vincent Delecroix\n\nAuthor: Martin Rubey\n\nBranch: 5d4806beace6cd865cfd3897d51ccdf0447a0076\n\nCommit: 5d4806beace6cd865cfd3897d51ccdf0447a0076\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23819\n\n",
    "closed_at": "2017-09-18T22:15:27Z",
    "created_at": "2017-09-10T07:46:52Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Speed up AlternatingSignMatrix.from_corner_sum",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23819",
    "user": "https://github.com/mantepse"
}
```
old:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.6 s per loop
```

new:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1) 
1 loops, best of 1: 2.33 s per loop
```

CC:  @jessicapalencia @kevindilks

Reviewer: Travis Scrimshaw, Vincent Delecroix

Author: Martin Rubey

Branch: 5d4806beace6cd865cfd3897d51ccdf0447a0076

Commit: 5d4806beace6cd865cfd3897d51ccdf0447a0076

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23819





---

archive/issue_comments_330063.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-10T07:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330063",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330064.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-09-10T07:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330064",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_330065.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2017-09-10T07:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330065",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_330066.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-10T07:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330067.json:
```json
{
    "body": "<a id='comment:5'></a>Florian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that\n\n```\n        n = len(list(corner))-1\n        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]\n                for j in range(n)]\n               for i in range(n)]\n        return AlternatingSignMatrix(asm)\n```\nis the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?",
    "created_at": "2017-09-11T14:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330067",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>Florian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that

```
        n = len(list(corner))-1
        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]
                for j in range(n)]
               for i in range(n)]
        return AlternatingSignMatrix(asm)
```
is the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?



---

archive/issue_comments_330068.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-11T16:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330069.json:
```json
{
    "body": "<a id='comment:7'></a>The new version is *slightly* (:-) faster:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 3.14159265359...s per loop\n```\n8.1.beta4:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.4159265359...s per loop\n```",
    "created_at": "2017-09-11T17:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330069",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:7'></a>The new version is *slightly* (:-) faster:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 3.14159265359...s per loop
```
8.1.beta4:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.4159265359...s per loop
```



---

archive/issue_comments_330070.json:
```json
{
    "body": "<a id='comment:8'></a>Those can't be real timings.",
    "created_at": "2017-09-11T17:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330070",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>Those can't be real timings.



---

archive/issue_comments_330071.json:
```json
{
    "body": "<a id='comment:9'></a>I admit that they are imaginary - but correct to one or two decimal positions.",
    "created_at": "2017-09-11T18:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330071",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'></a>I admit that they are imaginary - but correct to one or two decimal positions.



---

archive/issue_comments_330072.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-11T20:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330073.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-11T21:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330074.json:
```json
{
    "body": "<a id='comment:12'></a>There is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:\n\n```\ndiff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py\nindex 30b5d49..fe07455 100644\n--- a/src/sage/combinat/alternating_sign_matrix.py\n+++ b/src/sage/combinat/alternating_sign_matrix.py\n@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):\n         for i in range(len(mt)):\n             for j in range(len(mt[i])):\n                 ssyt[i][j] = mt[j][-(i+1)]\n-        return SemistandardTableau(ssyt)\n+        return SemistandardTableau(ssyt, check=False)\n \n     def left_key(self):\n         r\"\"\"\ndiff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py\nindex 377ad9e..418627b 100644\n--- a/src/sage/combinat/tableau.py\n+++ b/src/sage/combinat/tableau.py\n@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):\n         ValueError: entries must be positive integers\n     \"\"\"\n     @staticmethod\n-    def __classcall_private__(self, t):\n+    def __classcall_private__(self, t, check=True):\n         r\"\"\"\n         This ensures that a SemistandardTableau is only ever constructed as an\n         element_class call of an appropriate parent.\n@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         if isinstance(t, SemistandardTableau):\n             return t\n-        elif t in SemistandardTableaux():\n-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)\n+        elif not check or t in SemistandardTableaux():\n+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)\n \n         # t is not a semistandard tableau so we give an appropriate error message\n         if t not in Tableaux():\n@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):\n         raise ValueError('%s is not a column strict tableau' % t)\n \n \n-    def __init__(self, parent, t):\n+    def __init__(self, parent, t, check=True):\n         r\"\"\"\n         Initialize a semistandard tableau.\n \n@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         super(SemistandardTableau, self).__init__(parent, t)\n \n+        if not check:\n+            return\n         # Tableau() has checked that t is tableau, so it remains to check that\n         # the entries of t are positive integers which are weakly increasing\n         # along rows\n```",
    "created_at": "2017-09-12T04:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330074",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'></a>There is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:

```
diff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py
index 30b5d49..fe07455 100644
--- a/src/sage/combinat/alternating_sign_matrix.py
+++ b/src/sage/combinat/alternating_sign_matrix.py
@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):
         for i in range(len(mt)):
             for j in range(len(mt[i])):
                 ssyt[i][j] = mt[j][-(i+1)]
-        return SemistandardTableau(ssyt)
+        return SemistandardTableau(ssyt, check=False)
 
     def left_key(self):
         r"""
diff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py
index 377ad9e..418627b 100644
--- a/src/sage/combinat/tableau.py
+++ b/src/sage/combinat/tableau.py
@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):
         ValueError: entries must be positive integers
     """
     @staticmethod
-    def __classcall_private__(self, t):
+    def __classcall_private__(self, t, check=True):
         r"""
         This ensures that a SemistandardTableau is only ever constructed as an
         element_class call of an appropriate parent.
@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):
         """
         if isinstance(t, SemistandardTableau):
             return t
-        elif t in SemistandardTableaux():
-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)
+        elif not check or t in SemistandardTableaux():
+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)
 
         # t is not a semistandard tableau so we give an appropriate error message
         if t not in Tableaux():
@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):
         raise ValueError('%s is not a column strict tableau' % t)
 
 
-    def __init__(self, parent, t):
+    def __init__(self, parent, t, check=True):
         r"""
         Initialize a semistandard tableau.
 
@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):
         """
         super(SemistandardTableau, self).__init__(parent, t)
 
+        if not check:
+            return
         # Tableau() has checked that t is tableau, so it remains to check that
         # the entries of t are positive integers which are weakly increasing
         # along rows
```



---

archive/issue_comments_330075.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-12T13:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330075",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_330076.json:
```json
{
    "body": "<a id='comment:13'></a>I do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\nYou also do not need the `else` in that `try-except` block.",
    "created_at": "2017-09-12T13:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330076",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>I do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

You also do not need the `else` in that `try-except` block.



---

archive/issue_comments_330077.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 tscrim]:\n> I do not like general exception catching: it can hide real errors.\n\n\nMe neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.\n\n> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n\nActually, it is the other way round.\n \n> You also do not need the `else` in that `try-except` block.\n\n\nI know, but I think it makes the code much clearer - it is easy to overlook the return just before.",
    "created_at": "2017-09-12T14:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330077",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:14'></a>Replying to [comment:13 tscrim]:
> I do not like general exception catching: it can hide real errors.


Me neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.

> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.


Actually, it is the other way round.
 
> You also do not need the `else` in that `try-except` block.


I know, but I think it makes the code much clearer - it is easy to overlook the return just before.



---

archive/issue_comments_330078.json:
```json
{
    "body": "<a id='comment:15'></a>> I don't know what would be better to catch in line 1199 though.\n\n\nJust checked, it's also `(TypeError, ValueError)`.\n\nThanks!",
    "created_at": "2017-09-12T14:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330078",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>> I don't know what would be better to catch in line 1199 though.


Just checked, it's also `(TypeError, ValueError)`.

Thanks!



---

archive/issue_comments_330079.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-12T14:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330080.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-12T14:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330080",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330081.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:14 mantepse]:\n> Replying to [comment:13 tscrim]:\n> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> \n> Actually, it is the other way round.\n\n\nI remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> > You also do not need the `else` in that `try-except` block.\n\n> \n> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n\nI disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\nIn a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\nJessica, Kevin, do you have any comments?",
    "created_at": "2017-09-12T14:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330081",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Replying to [comment:14 mantepse]:
> Replying to [comment:13 tscrim]:
> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> 
> Actually, it is the other way round.


I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> > You also do not need the `else` in that `try-except` block.

> 
> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.


I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

Jessica, Kevin, do you have any comments?



---

archive/issue_comments_330082.json:
```json
{
    "body": "<a id='comment:19'></a>Hi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!",
    "created_at": "2017-09-12T14:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330082",
    "user": "https://github.com/jessicapalencia"
}
```

<a id='comment:19'></a>Hi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!



---

archive/issue_comments_330083.json:
```json
{
    "body": "<a id='comment:20'></a>There's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.",
    "created_at": "2017-09-12T18:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330083",
    "user": "https://github.com/kevindilks"
}
```

<a id='comment:20'></a>There's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.



---

archive/issue_comments_330084.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-12T20:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330085.json:
```json
{
    "body": "<a id='comment:22'></a>> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > \n> > Actually, it is the other way round.\n\n> \n> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n\nThe hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\n`Exception` catches a strict superset of `StandardError`.  For example, you can try:\n\n```\ndef testit1():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except Exception as e:\n        print e\ndef testit2():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except StandardError as e:\n        print e\n```\n\n> > > You also do not need the `else` in that `try-except` block.\n\n> > \n> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> \n> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\n\nwell, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\n> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\n\nYes, unless there is an easy way to check, python prefers to try.",
    "created_at": "2017-09-12T20:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330085",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:22'></a>> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > 
> > Actually, it is the other way round.

> 
> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?


The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy

`Exception` catches a strict superset of `StandardError`.  For example, you can try:

```
def testit1():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except Exception as e:
        print e
def testit2():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except StandardError as e:
        print e
```

> > > You also do not need the `else` in that `try-except` block.

> > 
> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> 
> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.


well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.

> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.


Yes, unless there is an easy way to check, python prefers to try.



---

archive/issue_comments_330086.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 mantepse]:\n> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > > \n> > > Actually, it is the other way round.\n\n> > \n> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> \n> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\n\nThank you for the reference.\n\n> > > > You also do not need the `else` in that `try-except` block.\n\n> > > \n> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> > \n> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\n> \n> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\n\nThank you.\n\n> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\n> \n> Yes, unless there is an easy way to check, python prefers to try.\n\n\nThat depends on how you define \"easy\". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.\n\nAlso, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.",
    "created_at": "2017-09-14T05:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330086",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>Replying to [comment:22 mantepse]:
> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > > 
> > > Actually, it is the other way round.

> > 
> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> 
> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy


Thank you for the reference.

> > > > You also do not need the `else` in that `try-except` block.

> > > 
> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> > 
> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

> 
> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.


Thank you.

> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

> 
> Yes, unless there is an easy way to check, python prefers to try.


That depends on how you define "easy". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.

Also, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.



---

archive/issue_comments_330087.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T05:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330088.json:
```json
{
    "body": "<a id='comment:25'></a>You are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.\n\n---\nNew commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[23433b1](https://git.sagemath.org/sage.git/commit?id=23433b173f615c7315799458e4a9d5a26efd1b7b)|`add a test for 1x1 matrices`|\n---\nNew commits:",
    "created_at": "2017-09-14T05:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330088",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:25'></a>You are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.

---
New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[23433b1](https://git.sagemath.org/sage.git/commit?id=23433b173f615c7315799458e4a9d5a26efd1b7b)|`add a test for 1x1 matrices`|
---
New commits:



---

archive/issue_comments_330089.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T20:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330089",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330090.json:
```json
{
    "body": "<a id='comment:27'></a>Instead of\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]\n           for j in range(n)]\n            for i in range(n)]\nself._matrix_space(asm)\n```\nYou should use matrix operations\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n```\nAs I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win\n\n```\nsage: n = 5\nsage: corner = random_matrix(ZZ, n+1)\nsage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])\n10000 loops, best of 3: 108 \u00b5s per loop\nsage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n10000 loops, best of 3: 34.5 \u00b5s per loop\n```\n(In numpy it would have been tremendous!)",
    "created_at": "2017-09-15T08:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330090",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'></a>Instead of

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]
           for j in range(n)]
            for i in range(n)]
self._matrix_space(asm)
```
You should use matrix operations

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
```
As I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win

```
sage: n = 5
sage: corner = random_matrix(ZZ, n+1)
sage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])
10000 loops, best of 3: 108 µs per loop
sage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
10000 loops, best of 3: 34.5 µs per loop
```
(In numpy it would have been tremendous!)



---

archive/issue_comments_330091.json:
```json
{
    "body": "<a id='comment:28'></a>That's brilliant!",
    "created_at": "2017-09-15T09:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330091",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:28'></a>That's brilliant!



---

archive/issue_comments_330092.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-15T10:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330093.json:
```json
{
    "body": "<a id='comment:30'></a>Could you update the timings in the ticket description? (we were at 25.5s with your version)",
    "created_at": "2017-09-15T13:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330093",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>Could you update the timings in the ticket description? (we were at 25.5s with your version)



---

archive/issue_comments_330094.json:
```json
{
    "body": "<a id='comment:31'></a>This conversion is not needed anymore\n\n```\nself._matrix_space(asm)\n```\nIf you really feel there should be something, just add the line\n\n```\nassert asm.parent() is self._matrix_space\n```",
    "created_at": "2017-09-15T13:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330094",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'></a>This conversion is not needed anymore

```
self._matrix_space(asm)
```
If you really feel there should be something, just add the line

```
assert asm.parent() is self._matrix_space
```



---

archive/issue_comments_330095.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-15T14:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330095",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330096.json:
```json
{
    "body": "<a id='comment:34'></a>Haaa. Looks better now ;-)",
    "created_at": "2017-09-15T14:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330096",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'></a>Haaa. Looks better now ;-)



---

archive/issue_comments_330097.json:
```json
{
    "body": "<a id='comment:35'></a>Given the speed we've gained, I am setting this to positive review (unless anyone has any objections).",
    "created_at": "2017-09-15T19:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330097",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>Given the speed we've gained, I am setting this to positive review (unless anyone has any objections).



---

archive/issue_comments_330098.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-15T19:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330098",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330099.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:34 vdelecroix]:\n> Haaa. Looks better now ;-)\n\n\nI agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!",
    "created_at": "2017-09-15T19:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330099",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:36'></a>Replying to [comment:34 vdelecroix]:
> Haaa. Looks better now ;-)


I agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!



---

archive/issue_comments_330100.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-18T22:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23819#issuecomment-330100",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-18T22:15:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23819",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23819#event-60726"
}
```
