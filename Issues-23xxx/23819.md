# Issue 23819: Speed up AlternatingSignMatrix.from_corner_sum

archive/issues_023582.json:
```json
{
    "assignees": [],
    "body": "old:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.6 s per loop\n```\n\nnew:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1) \n1 loops, best of 1: 2.33 s per loop\n```\n\nCC:  @jessicapalencia @kevindilks\n\nBranch/Commit: **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**\n\nReviewer: **Travis Scrimshaw, Vincent Delecroix**\n\nAuthor: **Martin Rubey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23819_\n\n",
    "closed_at": "2017-09-18T22:15:27Z",
    "created_at": "2017-09-10T07:46:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up AlternatingSignMatrix.from_corner_sum",
    "type": "issue",
    "updated_at": "2017-09-18T22:15:27Z",
    "url": "https://github.com/sagemath/sage/issues/23819",
    "user": "https://github.com/mantepse"
}
```
old:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.6 s per loop
```

new:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1) 
1 loops, best of 1: 2.33 s per loop
```

CC:  @jessicapalencia @kevindilks

Branch/Commit: **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**

Reviewer: **Travis Scrimshaw, Vincent Delecroix**

Author: **Martin Rubey**

_Issue created by migration from https://trac.sagemath.org/ticket/23819_





---

archive/issue_events_301731.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:46:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301731"
}
```



---

archive/issue_events_301732.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:46:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301732"
}
```



---

archive/issue_comments_362069.json:
```json
{
    "body": "Branch: **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)**",
    "created_at": "2017-09-10T07:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362069",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)**



---

archive/issue_comments_362070.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n+old:\n \n+```\n+sage: timeit(\"[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n+1 loops, best of 1: 35.2 s per loop\n+```\n+\n+new:\n+\n+```\n+sage: timeit(\"[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n+1 loops, best of 1: 25.5 s per loop\n+```\n``````\n",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362070",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,13 @@
+old:
 
+```
+sage: timeit("[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
+1 loops, best of 1: 35.2 s per loop
+```
+
+new:
+
+```
+sage: timeit("[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
+1 loops, best of 1: 25.5 s per loop
+```
``````




---

archive/issue_comments_362071.json:
```json
{
    "body": "Commit: **[f34394d](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)**",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362071",
    "user": "https://github.com/mantepse"
}
```

Commit: **[f34394d](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)**



---

archive/issue_events_301733.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301733"
}
```



---

archive/issue_events_301734.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301734"
}
```



---

archive/issue_comments_362072.json:
```json
{
    "body": "Author: **Martin Rubey**",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362072",
    "user": "https://github.com/mantepse"
}
```

Author: **Martin Rubey**



---

archive/issue_events_301735.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301735"
}
```



---

archive/issue_comments_362073.json:
```json
{
    "body": "Changed commit from **[f34394d](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)** to **[eab4f57](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)**",
    "created_at": "2017-09-10T07:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362073",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f34394d](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)** to **[eab4f57](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)**



---

archive/issue_comments_362074.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15\">eab4f57</a></td><td><code>speed up from_corner_sum</code></td></tr></table>\n",
    "created_at": "2017-09-10T07:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362074",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15">eab4f57</a></td><td><code>speed up from_corner_sum</code></td></tr></table>




---

archive/issue_comments_362075.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nFlorian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that\n\n```\n        n = len(list(corner))-1\n        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]\n                for j in range(n)]\n               for i in range(n)]\n        return AlternatingSignMatrix(asm)\n```\nis the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?",
    "created_at": "2017-09-11T14:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362075",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'>Comment 5:</a>
Florian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that

```
        n = len(list(corner))-1
        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]
                for j in range(n)]
               for i in range(n)]
        return AlternatingSignMatrix(asm)
```
is the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?



---

archive/issue_comments_362076.json:
```json
{
    "body": "Changed commit from **[eab4f57](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)** to **[cf5643f](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)**",
    "created_at": "2017-09-11T16:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362076",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eab4f57](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)** to **[cf5643f](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)**



---

archive/issue_comments_362077.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e\">cf5643f</a></td><td><code>simplify from_corner_sum, use matrices</code></td></tr></table>\n",
    "created_at": "2017-09-11T16:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362077",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e">cf5643f</a></td><td><code>simplify from_corner_sum, use matrices</code></td></tr></table>




---

archive/issue_comments_362078.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nThe new version is *slightly* (:-) faster:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 3.14159265359...s per loop\n```\n8.1.beta4:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.4159265359...s per loop\n```",
    "created_at": "2017-09-11T17:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362078",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:7'>Comment 7:</a>
The new version is *slightly* (:-) faster:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 3.14159265359...s per loop
```
8.1.beta4:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.4159265359...s per loop
```



---

archive/issue_comments_362079.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThose can't be real timings.",
    "created_at": "2017-09-11T17:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362079",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'>Comment 8:</a>
Those can't be real timings.



---

archive/issue_comments_362080.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI admit that they are imaginary - but correct to one or two decimal positions.",
    "created_at": "2017-09-11T18:02:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362080",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'>Comment 9:</a>
I admit that they are imaginary - but correct to one or two decimal positions.



---

archive/issue_comments_362081.json:
```json
{
    "body": "Changed commit from **[cf5643f](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)** to **[450e6c4](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)**",
    "created_at": "2017-09-11T20:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362081",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cf5643f](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)** to **[450e6c4](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)**



---

archive/issue_comments_362082.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bca94484c66b3b80ba1e1cb551ae7612c3205b8a\">bca9448</a></td><td><code>speed up initialization code, allow to bypass checking of arguments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc\">450e6c4</a></td><td><code>trivial simplification in height_function</code></td></tr></table>\n",
    "created_at": "2017-09-11T20:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362082",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bca94484c66b3b80ba1e1cb551ae7612c3205b8a">bca9448</a></td><td><code>speed up initialization code, allow to bypass checking of arguments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc">450e6c4</a></td><td><code>trivial simplification in height_function</code></td></tr></table>




---

archive/issue_comments_362083.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e\">c73fd43</a></td><td><code>trivial simplification in to_monotone_triangle</code></td></tr></table>\n",
    "created_at": "2017-09-11T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362083",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e">c73fd43</a></td><td><code>trivial simplification in to_monotone_triangle</code></td></tr></table>




---

archive/issue_comments_362084.json:
```json
{
    "body": "Changed commit from **[450e6c4](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)** to **[c73fd43](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)**",
    "created_at": "2017-09-11T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362084",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[450e6c4](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)** to **[c73fd43](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)**



---

archive/issue_comments_362085.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nThere is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:\n\n```\ndiff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py\nindex 30b5d49..fe07455 100644\n--- a/src/sage/combinat/alternating_sign_matrix.py\n+++ b/src/sage/combinat/alternating_sign_matrix.py\n@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):\n         for i in range(len(mt)):\n             for j in range(len(mt[i])):\n                 ssyt[i][j] = mt[j][-(i+1)]\n-        return SemistandardTableau(ssyt)\n+        return SemistandardTableau(ssyt, check=False)\n \n     def left_key(self):\n         r\"\"\"\ndiff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py\nindex 377ad9e..418627b 100644\n--- a/src/sage/combinat/tableau.py\n+++ b/src/sage/combinat/tableau.py\n@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):\n         ValueError: entries must be positive integers\n     \"\"\"\n     @staticmethod\n-    def __classcall_private__(self, t):\n+    def __classcall_private__(self, t, check=True):\n         r\"\"\"\n         This ensures that a SemistandardTableau is only ever constructed as an\n         element_class call of an appropriate parent.\n@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         if isinstance(t, SemistandardTableau):\n             return t\n-        elif t in SemistandardTableaux():\n-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)\n+        elif not check or t in SemistandardTableaux():\n+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)\n \n         # t is not a semistandard tableau so we give an appropriate error message\n         if t not in Tableaux():\n@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):\n         raise ValueError('%s is not a column strict tableau' % t)\n \n \n-    def __init__(self, parent, t):\n+    def __init__(self, parent, t, check=True):\n         r\"\"\"\n         Initialize a semistandard tableau.\n \n@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         super(SemistandardTableau, self).__init__(parent, t)\n \n+        if not check:\n+            return\n         # Tableau() has checked that t is tableau, so it remains to check that\n         # the entries of t are positive integers which are weakly increasing\n         # along rows\n```",
    "created_at": "2017-09-12T04:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362085",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'>Comment 12:</a>
There is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:

```
diff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py
index 30b5d49..fe07455 100644
--- a/src/sage/combinat/alternating_sign_matrix.py
+++ b/src/sage/combinat/alternating_sign_matrix.py
@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):
         for i in range(len(mt)):
             for j in range(len(mt[i])):
                 ssyt[i][j] = mt[j][-(i+1)]
-        return SemistandardTableau(ssyt)
+        return SemistandardTableau(ssyt, check=False)
 
     def left_key(self):
         r"""
diff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py
index 377ad9e..418627b 100644
--- a/src/sage/combinat/tableau.py
+++ b/src/sage/combinat/tableau.py
@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):
         ValueError: entries must be positive integers
     """
     @staticmethod
-    def __classcall_private__(self, t):
+    def __classcall_private__(self, t, check=True):
         r"""
         This ensures that a SemistandardTableau is only ever constructed as an
         element_class call of an appropriate parent.
@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):
         """
         if isinstance(t, SemistandardTableau):
             return t
-        elif t in SemistandardTableaux():
-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)
+        elif not check or t in SemistandardTableaux():
+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)
 
         # t is not a semistandard tableau so we give an appropriate error message
         if t not in Tableaux():
@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):
         raise ValueError('%s is not a column strict tableau' % t)
 
 
-    def __init__(self, parent, t):
+    def __init__(self, parent, t, check=True):
         r"""
         Initialize a semistandard tableau.
 
@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):
         """
         super(SemistandardTableau, self).__init__(parent, t)
 
+        if not check:
+            return
         # Tableau() has checked that t is tableau, so it remains to check that
         # the entries of t are positive integers which are weakly increasing
         # along rows
```



---

archive/issue_events_301736.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-12T13:49:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301736"
}
```



---

archive/issue_events_301737.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-12T13:49:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301737"
}
```



---

archive/issue_comments_362086.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\nYou also do not need the `else` in that `try-except` block.",
    "created_at": "2017-09-12T13:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362086",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'>Comment 13:</a>
I do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

You also do not need the `else` in that `try-except` block.



---

archive/issue_comments_362087.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@tscrim](#comment%3A13):\n> I do not like general exception catching: it can hide real errors.\n\nMe neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.\n\n> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\nActually, it is the other way round.\n \n> You also do not need the `else` in that `try-except` block.\n\nI know, but I think it makes the code much clearer - it is easy to overlook the return just before.",
    "created_at": "2017-09-12T14:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362087",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@tscrim](#comment%3A13):
> I do not like general exception catching: it can hide real errors.

Me neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.

> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

Actually, it is the other way round.
 
> You also do not need the `else` in that `try-except` block.

I know, but I think it makes the code much clearer - it is easy to overlook the return just before.



---

archive/issue_comments_362088.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n> I don't know what would be better to catch in line 1199 though.\n\nJust checked, it's also `(TypeError, ValueError)`.\n\nThanks!",
    "created_at": "2017-09-12T14:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362088",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'>Comment 15:</a>
> I don't know what would be better to catch in line 1199 though.

Just checked, it's also `(TypeError, ValueError)`.

Thanks!



---

archive/issue_comments_362089.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152\">2d5a744</a></td><td><code>replace StandardError with two more specific errors</code></td></tr></table>\n",
    "created_at": "2017-09-12T14:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362089",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152">2d5a744</a></td><td><code>replace StandardError with two more specific errors</code></td></tr></table>




---

archive/issue_comments_362090.json:
```json
{
    "body": "Changed commit from **[c73fd43](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)** to **[2d5a744](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)**",
    "created_at": "2017-09-12T14:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362090",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c73fd43](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)** to **[2d5a744](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)**



---

archive/issue_events_301738.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T14:16:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301738"
}
```



---

archive/issue_events_301739.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T14:16:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301739"
}
```



---

archive/issue_comments_362091.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@mantepse](#comment%3A14):\n> Replying to [@tscrim](#comment%3A13):\n> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> \n> Actually, it is the other way round.\n\nI remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> > You also do not need the `else` in that `try-except` block.\n\n> \n> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\nI disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\nIn a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\nJessica, Kevin, do you have any comments?",
    "created_at": "2017-09-12T14:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362091",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@mantepse](#comment%3A14):
> Replying to [@tscrim](#comment%3A13):
> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> 
> Actually, it is the other way round.

I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> > You also do not need the `else` in that `try-except` block.

> 
> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

Jessica, Kevin, do you have any comments?



---

archive/issue_comments_362092.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nHi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!",
    "created_at": "2017-09-12T14:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362092",
    "user": "https://github.com/jessicapalencia"
}
```

<a id='comment:19'>Comment 19:</a>
Hi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!



---

archive/issue_comments_362093.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nThere's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.",
    "created_at": "2017-09-12T18:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362093",
    "user": "https://github.com/kevindilks"
}
```

<a id='comment:20'>Comment 20:</a>
There's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.



---

archive/issue_comments_362094.json:
```json
{
    "body": "Changed commit from **[2d5a744](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)** to **[1148495](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)**",
    "created_at": "2017-09-12T20:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362094",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2d5a744](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)** to **[1148495](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)**



---

archive/issue_comments_362095.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221\">1148495</a></td><td><code>remove an else by reviewer's request</code></td></tr></table>\n",
    "created_at": "2017-09-12T20:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362095",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221">1148495</a></td><td><code>remove an else by reviewer's request</code></td></tr></table>




---

archive/issue_comments_362096.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > \n> > Actually, it is the other way round.\n\n> \n> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\nThe hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\n`Exception` catches a strict superset of `StandardError`.  For example, you can try:\n\n```\ndef testit1():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except Exception as e:\n        print e\ndef testit2():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except StandardError as e:\n        print e\n```\n\n> > > You also do not need the `else` in that `try-except` block.\n\n> > \n> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> \n> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\nwell, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\n> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\nYes, unless there is an easy way to check, python prefers to try.",
    "created_at": "2017-09-12T20:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362096",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:22'>Comment 22:</a>
> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > 
> > Actually, it is the other way round.

> 
> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy

`Exception` catches a strict superset of `StandardError`.  For example, you can try:

```
def testit1():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except Exception as e:
        print e
def testit2():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except StandardError as e:
        print e
```

> > > You also do not need the `else` in that `try-except` block.

> > 
> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> 
> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.

> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

Yes, unless there is an easy way to check, python prefers to try.



---

archive/issue_comments_362097.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@mantepse](#comment%3A22):\n> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > > \n> > > Actually, it is the other way round.\n\n> > \n> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> \n> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\nThank you for the reference.\n\n> > > > You also do not need the `else` in that `try-except` block.\n\n> > > \n> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> > \n> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\n> \n> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\nThank you.\n\n> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\n> \n> Yes, unless there is an easy way to check, python prefers to try.\n\nThat depends on how you define \"easy\". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.\n\nAlso, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.",
    "created_at": "2017-09-14T05:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362097",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@mantepse](#comment%3A22):
> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > > 
> > > Actually, it is the other way round.

> > 
> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> 
> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy

Thank you for the reference.

> > > > You also do not need the `else` in that `try-except` block.

> > > 
> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> > 
> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

> 
> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.

Thank you.

> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

> 
> Yes, unless there is an easy way to check, python prefers to try.

That depends on how you define "easy". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.

Also, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.



---

archive/issue_comments_362098.json:
```json
{
    "body": "Changed commit from **[1148495](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)** to **[23433b1](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)**",
    "created_at": "2017-09-14T05:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362098",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1148495](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)** to **[23433b1](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)**



---

archive/issue_comments_362099.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n",
    "created_at": "2017-09-14T05:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362099",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>




---

archive/issue_comments_362100.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nYou are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n",
    "created_at": "2017-09-14T05:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362100",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:25'>Comment 25:</a>
You are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b">23433b1</a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>




---

archive/issue_comments_362101.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957\">572930c</a></td><td><code>better construction of matrices, fix a typo</code></td></tr></table>\n",
    "created_at": "2017-09-14T20:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362101",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:26'>Comment 26:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957">572930c</a></td><td><code>better construction of matrices, fix a typo</code></td></tr></table>




---

archive/issue_comments_362102.json:
```json
{
    "body": "Changed commit from **[23433b1](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)** to **[572930c](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)**",
    "created_at": "2017-09-14T20:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362102",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[23433b1](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)** to **[572930c](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)**



---

archive/issue_comments_362103.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nInstead of\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]\n           for j in range(n)]\n            for i in range(n)]\nself._matrix_space(asm)\n```\nYou should use matrix operations\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n```\nAs I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win\n\n```\nsage: n = 5\nsage: corner = random_matrix(ZZ, n+1)\nsage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])\n10000 loops, best of 3: 108 \u00b5s per loop\nsage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n10000 loops, best of 3: 34.5 \u00b5s per loop\n```\n(In numpy it would have been tremendous!)",
    "created_at": "2017-09-15T08:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362103",
    "user": "https://github.com/videlec"
}
```

<a id='comment:27'>Comment 27:</a>
Instead of

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]
           for j in range(n)]
            for i in range(n)]
self._matrix_space(asm)
```
You should use matrix operations

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
```
As I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win

```
sage: n = 5
sage: corner = random_matrix(ZZ, n+1)
sage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])
10000 loops, best of 3: 108 s per loop
sage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
10000 loops, best of 3: 34.5 s per loop
```
(In numpy it would have been tremendous!)



---

archive/issue_comments_362104.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThat's brilliant!",
    "created_at": "2017-09-15T09:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362104",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:28'>Comment 28:</a>
That's brilliant!



---

archive/issue_comments_362105.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004\">1e5fd41</a></td><td><code>use matrix operations in from_corner_sum</code></td></tr></table>\n",
    "created_at": "2017-09-15T10:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362105",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004">1e5fd41</a></td><td><code>use matrix operations in from_corner_sum</code></td></tr></table>




---

archive/issue_comments_362106.json:
```json
{
    "body": "Changed commit from **[572930c](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)** to **[1e5fd41](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)**",
    "created_at": "2017-09-15T10:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362106",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[572930c](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)** to **[1e5fd41](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)**



---

archive/issue_comments_362107.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nCould you update the timings in the ticket description? (we were at 25.5s with your version)",
    "created_at": "2017-09-15T13:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362107",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'>Comment 30:</a>
Could you update the timings in the ticket description? (we were at 25.5s with your version)



---

archive/issue_comments_362108.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nThis conversion is not needed anymore\n\n```\nself._matrix_space(asm)\n```\nIf you really feel there should be something, just add the line\n\n```\nassert asm.parent() is self._matrix_space\n```",
    "created_at": "2017-09-15T13:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362108",
    "user": "https://github.com/videlec"
}
```

<a id='comment:31'>Comment 31:</a>
This conversion is not needed anymore

```
self._matrix_space(asm)
```
If you really feel there should be something, just add the line

```
assert asm.parent() is self._matrix_space
```



---

archive/issue_comments_362109.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076\">5d4806b</a></td><td><code>remove unnecessary conversion to matrix</code></td></tr></table>\n",
    "created_at": "2017-09-15T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362109",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076">5d4806b</a></td><td><code>remove unnecessary conversion to matrix</code></td></tr></table>




---

archive/issue_comments_362110.json:
```json
{
    "body": "Changed commit from **[1e5fd41](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)** to **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**",
    "created_at": "2017-09-15T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362110",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1e5fd41](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)** to **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**



---

archive/issue_comments_362111.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,15 @@\n old:\n \n ```\n-sage: timeit(\"[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n-1 loops, best of 1: 35.2 s per loop\n+sage: A = AlternatingSignMatrices(6)\n+sage: lC = [a.corner_sum_matrix() for a in A]\n+sage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n+1 loops, best of 1: 31.6 s per loop\n ```\n \n new:\n \n ```\n-sage: timeit(\"[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n-1 loops, best of 1: 25.5 s per loop\n+sage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1) \n+1 loops, best of 1: 2.33 s per loop\n ```\n``````\n",
    "created_at": "2017-09-15T14:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362111",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,15 @@
 old:
 
 ```
-sage: timeit("[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
-1 loops, best of 1: 35.2 s per loop
+sage: A = AlternatingSignMatrices(6)
+sage: lC = [a.corner_sum_matrix() for a in A]
+sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
+1 loops, best of 1: 31.6 s per loop
 ```
 
 new:
 
 ```
-sage: timeit("[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
-1 loops, best of 1: 25.5 s per loop
+sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1) 
+1 loops, best of 1: 2.33 s per loop
 ```
``````




---

archive/issue_comments_362112.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nHaaa. Looks better now ;-)",
    "created_at": "2017-09-15T14:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362112",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'>Comment 34:</a>
Haaa. Looks better now ;-)



---

archive/issue_comments_362113.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nGiven the speed we've gained, I am setting this to positive review (unless anyone has any objections).",
    "created_at": "2017-09-15T19:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362113",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'>Comment 35:</a>
Given the speed we've gained, I am setting this to positive review (unless anyone has any objections).



---

archive/issue_events_301740.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T19:55:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301740"
}
```



---

archive/issue_events_301741.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T19:55:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301741"
}
```



---

archive/issue_comments_362114.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Vincent Delecroix**",
    "created_at": "2017-09-15T19:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362114",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw, Vincent Delecroix**



---

archive/issue_comments_362115.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nReplying to [@videlec](#comment%3A34):\n> Haaa. Looks better now ;-)\n\nI agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!",
    "created_at": "2017-09-15T19:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362115",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:36'>Comment 36:</a>
Replying to [@videlec](#comment%3A34):
> Haaa. Looks better now ;-)

I agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!



---

archive/issue_comments_362116.json:
```json
{
    "body": "Changed branch from **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)** to **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**",
    "created_at": "2017-09-18T22:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-362116",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)** to **[5d4806b](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**



---

archive/issue_events_301742.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-18T22:15:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301742"
}
```



---

archive/issue_events_301743.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f6916314b7a26922e3c951a3e867f22715c2232",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-18T22:15:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-301743"
}
```
