# Issue 23819: Speed up AlternatingSignMatrix.from_corner_sum

archive/issues_023582.json:
```json
{
    "assignees": [],
    "body": "old:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.6 s per loop\n```\n\nnew:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1) \n1 loops, best of 1: 2.33 s per loop\n```\n\nCC:  @jessicapalencia @kevindilks\n\nComponent: **combinatorics**\n\nAuthor: **Martin Rubey**\n\nBranch/Commit: **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**\n\nReviewer: **Travis Scrimshaw, Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23819_\n\n",
    "closed_at": "2017-09-18T22:15:27Z",
    "created_at": "2017-09-10T07:46:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up AlternatingSignMatrix.from_corner_sum",
    "type": "issue",
    "updated_at": "2017-09-18T22:15:27Z",
    "url": "https://github.com/sagemath/sage/issues/23819",
    "user": "https://github.com/mantepse"
}
```
old:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.6 s per loop
```

new:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1) 
1 loops, best of 1: 2.33 s per loop
```

CC:  @jessicapalencia @kevindilks

Component: **combinatorics**

Author: **Martin Rubey**

Branch/Commit: **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**

Reviewer: **Travis Scrimshaw, Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/23819_





---

archive/issue_events_328120.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:46:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328120"
}
```



---

archive/issue_events_328121.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:46:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328121"
}
```



---

archive/issue_comments_359319.json:
```json
{
    "body": "Branch: **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)**",
    "created_at": "2017-09-10T07:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359319",
    "user": "https://github.com/mantepse"
}
```

Branch: **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)**



---

archive/issue_comments_359320.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,13 @@\n+old:\n \n+```\n+sage: timeit(\"[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n+1 loops, best of 1: 35.2 s per loop\n+```\n+\n+new:\n+\n+```\n+sage: timeit(\"[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n+1 loops, best of 1: 25.5 s per loop\n+```\n``````\n",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359320",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,13 @@
+old:
 
+```
+sage: timeit("[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
+1 loops, best of 1: 35.2 s per loop
+```
+
+new:
+
+```
+sage: timeit("[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
+1 loops, best of 1: 25.5 s per loop
+```
``````




---

archive/issue_comments_359321.json:
```json
{
    "body": "Commit: **[`f34394d`](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)**",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359321",
    "user": "https://github.com/mantepse"
}
```

Commit: **[`f34394d`](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)**



---

archive/issue_events_328122.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328122"
}
```



---

archive/issue_events_328123.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328123"
}
```



---

archive/issue_comments_359322.json:
```json
{
    "body": "Author: **Martin Rubey**",
    "created_at": "2017-09-10T07:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359322",
    "user": "https://github.com/mantepse"
}
```

Author: **Martin Rubey**



---

archive/issue_events_328124.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-10T07:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328124"
}
```



---

archive/issue_comments_359323.json:
```json
{
    "body": "Changed commit from **[`f34394d`](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)** to **[`eab4f57`](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)**",
    "created_at": "2017-09-10T07:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359323",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f34394d`](https://github.com/sagemath/sagetrac-mirror/commit/f34394d84ed07c4ed492479136fed334abd14b19)** to **[`eab4f57`](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)**



---

archive/issue_comments_359324.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15\"><code>eab4f57</code></a></td><td><code>speed up from_corner_sum</code></td></tr></table>\n",
    "created_at": "2017-09-10T07:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359324",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15"><code>eab4f57</code></a></td><td><code>speed up from_corner_sum</code></td></tr></table>




---

archive/issue_comments_359325.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nFlorian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that\n\n```\n        n = len(list(corner))-1\n        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]\n                for j in range(n)]\n               for i in range(n)]\n        return AlternatingSignMatrix(asm)\n```\nis the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?",
    "created_at": "2017-09-11T14:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359325",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:5" align="right">comment:5</div>

Florian Aigner just pointed out to me that `a_i,j=c_{i,j}+c_{i-1,j-1}-c_{i-1,j}-c_{i,j-1}`.  I would expect that

```
        n = len(list(corner))-1
        asm = [[corner[i+1][j+1]+corner[i][j]-corner[i][j+1]-corner[i+1][j]
                for j in range(n)]
               for i in range(n)]
        return AlternatingSignMatrix(asm)
```
is the fastest version possible.  Curiously, this is not the case, it is even slower than the original version.  Why?



---

archive/issue_comments_359326.json:
```json
{
    "body": "Changed commit from **[`eab4f57`](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)** to **[`cf5643f`](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)**",
    "created_at": "2017-09-11T16:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359326",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eab4f57`](https://github.com/sagemath/sagetrac-mirror/commit/eab4f573aa46c0a46828d1424cdc88e2199d3f15)** to **[`cf5643f`](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)**



---

archive/issue_comments_359327.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e\"><code>cf5643f</code></a></td><td><code>simplify from_corner_sum, use matrices</code></td></tr></table>\n",
    "created_at": "2017-09-11T16:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359327",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e"><code>cf5643f</code></a></td><td><code>simplify from_corner_sum, use matrices</code></td></tr></table>




---

archive/issue_comments_359328.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe new version is *slightly* (:-) faster:\n\n```\nsage: A = AlternatingSignMatrices(6)\nsage: lC = [a.corner_sum_matrix() for a in A]\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 3.14159265359...s per loop\n```\n8.1.beta4:\n\n```\nsage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n1 loops, best of 1: 31.4159265359...s per loop\n```",
    "created_at": "2017-09-11T17:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359328",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:7" align="right">comment:7</div>

The new version is *slightly* (:-) faster:

```
sage: A = AlternatingSignMatrices(6)
sage: lC = [a.corner_sum_matrix() for a in A]
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 3.14159265359...s per loop
```
8.1.beta4:

```
sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
1 loops, best of 1: 31.4159265359...s per loop
```



---

archive/issue_comments_359329.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThose can't be real timings.",
    "created_at": "2017-09-11T17:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359329",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Those can't be real timings.



---

archive/issue_comments_359330.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI admit that they are imaginary - but correct to one or two decimal positions.",
    "created_at": "2017-09-11T18:02:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359330",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:9" align="right">comment:9</div>

I admit that they are imaginary - but correct to one or two decimal positions.



---

archive/issue_comments_359331.json:
```json
{
    "body": "Changed commit from **[`cf5643f`](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)** to **[`450e6c4`](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)**",
    "created_at": "2017-09-11T20:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cf5643f`](https://github.com/sagemath/sagetrac-mirror/commit/cf5643fb93a85d8f6bca44cadd6ca6c841d5016e)** to **[`450e6c4`](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)**



---

archive/issue_comments_359332.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bca94484c66b3b80ba1e1cb551ae7612c3205b8a\"><code>bca9448</code></a></td><td><code>speed up initialization code, allow to bypass checking of arguments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc\"><code>450e6c4</code></a></td><td><code>trivial simplification in height_function</code></td></tr></table>\n",
    "created_at": "2017-09-11T20:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bca94484c66b3b80ba1e1cb551ae7612c3205b8a"><code>bca9448</code></a></td><td><code>speed up initialization code, allow to bypass checking of arguments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc"><code>450e6c4</code></a></td><td><code>trivial simplification in height_function</code></td></tr></table>




---

archive/issue_comments_359333.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e\"><code>c73fd43</code></a></td><td><code>trivial simplification in to_monotone_triangle</code></td></tr></table>\n",
    "created_at": "2017-09-11T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359333",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e"><code>c73fd43</code></a></td><td><code>trivial simplification in to_monotone_triangle</code></td></tr></table>




---

archive/issue_comments_359334.json:
```json
{
    "body": "Changed commit from **[`450e6c4`](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)** to **[`c73fd43`](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)**",
    "created_at": "2017-09-11T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359334",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`450e6c4`](https://github.com/sagemath/sagetrac-mirror/commit/450e6c4d4323cd08234e44cbfa8fe20c4e8488dc)** to **[`c73fd43`](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)**



---

archive/issue_comments_359335.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThere is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:\n\n```\ndiff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py\nindex 30b5d49..fe07455 100644\n--- a/src/sage/combinat/alternating_sign_matrix.py\n+++ b/src/sage/combinat/alternating_sign_matrix.py\n@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):\n         for i in range(len(mt)):\n             for j in range(len(mt[i])):\n                 ssyt[i][j] = mt[j][-(i+1)]\n-        return SemistandardTableau(ssyt)\n+        return SemistandardTableau(ssyt, check=False)\n \n     def left_key(self):\n         r\"\"\"\ndiff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py\nindex 377ad9e..418627b 100644\n--- a/src/sage/combinat/tableau.py\n+++ b/src/sage/combinat/tableau.py\n@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):\n         ValueError: entries must be positive integers\n     \"\"\"\n     @staticmethod\n-    def __classcall_private__(self, t):\n+    def __classcall_private__(self, t, check=True):\n         r\"\"\"\n         This ensures that a SemistandardTableau is only ever constructed as an\n         element_class call of an appropriate parent.\n@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         if isinstance(t, SemistandardTableau):\n             return t\n-        elif t in SemistandardTableaux():\n-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)\n+        elif not check or t in SemistandardTableaux():\n+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)\n \n         # t is not a semistandard tableau so we give an appropriate error message\n         if t not in Tableaux():\n@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):\n         raise ValueError('%s is not a column strict tableau' % t)\n \n \n-    def __init__(self, parent, t):\n+    def __init__(self, parent, t, check=True):\n         r\"\"\"\n         Initialize a semistandard tableau.\n \n@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):\n         \"\"\"\n         super(SemistandardTableau, self).__init__(parent, t)\n \n+        if not check:\n+            return\n         # Tableau() has checked that t is tableau, so it remains to check that\n         # the entries of t are positive integers which are weakly increasing\n         # along rows\n```",
    "created_at": "2017-09-12T04:48:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359335",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:12" align="right">comment:12</div>

There is one further, very important optimization, but I feel it belongs into a separate ticket.  It consists of the following patch, introducing the possibility to bypass checking in `SemistandardTableau`:

```
diff --git a/src/sage/combinat/alternating_sign_matrix.py b/src/sage/combinat/alternating_sign_matrix.py
index 30b5d49..fe07455 100644
--- a/src/sage/combinat/alternating_sign_matrix.py
+++ b/src/sage/combinat/alternating_sign_matrix.py
@@ -938,7 +938,7 @@ class AlternatingSignMatrix(Element):
         for i in range(len(mt)):
             for j in range(len(mt[i])):
                 ssyt[i][j] = mt[j][-(i+1)]
-        return SemistandardTableau(ssyt)
+        return SemistandardTableau(ssyt, check=False)
 
     def left_key(self):
         r"""
diff --git a/src/sage/combinat/tableau.py b/src/sage/combinat/tableau.py
index 377ad9e..418627b 100644
--- a/src/sage/combinat/tableau.py
+++ b/src/sage/combinat/tableau.py
@@ -4137,7 +4137,7 @@ class SemistandardTableau(Tableau):
         ValueError: entries must be positive integers
     """
     @staticmethod
-    def __classcall_private__(self, t):
+    def __classcall_private__(self, t, check=True):
         r"""
         This ensures that a SemistandardTableau is only ever constructed as an
         element_class call of an appropriate parent.
@@ -4156,8 +4156,8 @@ class SemistandardTableau(Tableau):
         """
         if isinstance(t, SemistandardTableau):
             return t
-        elif t in SemistandardTableaux():
-            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t)
+        elif not check or t in SemistandardTableaux():
+            return SemistandardTableaux_all().element_class(SemistandardTableaux_all(), t, check=check)
 
         # t is not a semistandard tableau so we give an appropriate error message
         if t not in Tableaux():
@@ -4173,7 +4173,7 @@ class SemistandardTableau(Tableau):
         raise ValueError('%s is not a column strict tableau' % t)
 
 
-    def __init__(self, parent, t):
+    def __init__(self, parent, t, check=True):
         r"""
         Initialize a semistandard tableau.
 
@@ -4197,6 +4197,8 @@ class SemistandardTableau(Tableau):
         """
         super(SemistandardTableau, self).__init__(parent, t)
 
+        if not check:
+            return
         # Tableau() has checked that t is tableau, so it remains to check that
         # the entries of t are positive integers which are weakly increasing
         # along rows
```



---

archive/issue_events_328125.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-12T13:49:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328125"
}
```



---

archive/issue_events_328126.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-12T13:49:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328126"
}
```



---

archive/issue_comments_359336.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\nYou also do not need the `else` in that `try-except` block.",
    "created_at": "2017-09-12T13:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359336",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

I do not like general exception catching: it can hide real errors. Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

You also do not need the `else` in that `try-except` block.



---

archive/issue_comments_359337.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@tscrim](#comment%3A13):\n> I do not like general exception catching: it can hide real errors.\n\nMe neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.\n\n> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\nActually, it is the other way round.\n \n> You also do not need the `else` in that `try-except` block.\n\nI know, but I think it makes the code much clearer - it is easy to overlook the return just before.",
    "created_at": "2017-09-12T14:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359337",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@tscrim](#comment%3A13):
> I do not like general exception catching: it can hide real errors.

Me neither, but in the case at hand it is necessary.  However, I agree that `StandardError` should be replaced with `(TypeError, ValueError)` in line 1196.  I don't know what would be better to catch in line 1199 though.

> Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

Actually, it is the other way round.
 
> You also do not need the `else` in that `try-except` block.

I know, but I think it makes the code much clearer - it is easy to overlook the return just before.



---

archive/issue_comments_359338.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n> I don't know what would be better to catch in line 1199 though.\n\nJust checked, it's also `(TypeError, ValueError)`.\n\nThanks!",
    "created_at": "2017-09-12T14:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359338",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:15" align="right">comment:15</div>

> I don't know what would be better to catch in line 1199 though.

Just checked, it's also `(TypeError, ValueError)`.

Thanks!



---

archive/issue_comments_359339.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152\"><code>2d5a744</code></a></td><td><code>replace StandardError with two more specific errors</code></td></tr></table>\n",
    "created_at": "2017-09-12T14:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359339",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152"><code>2d5a744</code></a></td><td><code>replace StandardError with two more specific errors</code></td></tr></table>




---

archive/issue_comments_359340.json:
```json
{
    "body": "Changed commit from **[`c73fd43`](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)** to **[`2d5a744`](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)**",
    "created_at": "2017-09-12T14:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359340",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c73fd43`](https://github.com/sagemath/sagetrac-mirror/commit/c73fd4354c350e3c75a6d80773298a3223b1b07e)** to **[`2d5a744`](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)**



---

archive/issue_events_328127.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T14:16:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328127"
}
```



---

archive/issue_events_328128.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2017-09-12T14:16:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328128"
}
```



---

archive/issue_comments_359341.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mantepse](#comment%3A14):\n> Replying to [@tscrim](#comment%3A13):\n> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> \n> Actually, it is the other way round.\n\nI remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> > You also do not need the `else` in that `try-except` block.\n\n> \n> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\nI disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\nIn a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\nJessica, Kevin, do you have any comments?",
    "created_at": "2017-09-12T14:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359341",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mantepse](#comment%3A14):
> Replying to [@tscrim](#comment%3A13):
> > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> 
> Actually, it is the other way round.

I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> > You also do not need the `else` in that `try-except` block.

> 
> I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

Jessica, Kevin, do you have any comments?



---

archive/issue_comments_359342.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!",
    "created_at": "2017-09-12T14:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359342",
    "user": "https://github.com/jessicapalencia"
}
```

<div id="comment:19" align="right">comment:19</div>

Hi all, I don't have any comments on the specifics, except to say that when I wrote this method originally, I was aiming to write something that worked rather than something that was fast. So I appreciate your efforts to speed it up!



---

archive/issue_comments_359343.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThere's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.",
    "created_at": "2017-09-12T18:17:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359343",
    "user": "https://github.com/kevindilks"
}
```

<div id="comment:20" align="right">comment:20</div>

There's some kind of connection issue keeping me and the Patchbots from pulling the code and testing it right now, but I'm fine with everything that I see in the diff file.



---

archive/issue_comments_359344.json:
```json
{
    "body": "Changed commit from **[`2d5a744`](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)** to **[`1148495`](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)**",
    "created_at": "2017-09-12T20:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359344",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2d5a744`](https://github.com/sagemath/sagetrac-mirror/commit/2d5a7447c1a5323f9a5ddad1efcf4b17d1623152)** to **[`1148495`](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)**



---

archive/issue_comments_359345.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221\"><code>1148495</code></a></td><td><code>remove an else by reviewer's request</code></td></tr></table>\n",
    "created_at": "2017-09-12T20:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359345",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221"><code>1148495</code></a></td><td><code>remove an else by reviewer's request</code></td></tr></table>




---

archive/issue_comments_359346.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > \n> > Actually, it is the other way round.\n\n> \n> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\nThe hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\n`Exception` catches a strict superset of `StandardError`.  For example, you can try:\n\n```\ndef testit1():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except Exception as e:\n        print e\ndef testit2():\n    try:\n        l = iter([1,2,3])\n        while True:\n            print l.next()\n    except StandardError as e:\n        print e\n```\n\n> > > You also do not need the `else` in that `try-except` block.\n\n> > \n> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> \n> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\nwell, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\n> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\nYes, unless there is an easy way to check, python prefers to try.",
    "created_at": "2017-09-12T20:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359346",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:22" align="right">comment:22</div>

> > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > 
> > Actually, it is the other way round.

> 
> I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy

`Exception` catches a strict superset of `StandardError`.  For example, you can try:

```
def testit1():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except Exception as e:
        print e
def testit2():
    try:
        l = iter([1,2,3])
        while True:
            print l.next()
    except StandardError as e:
        print e
```

> > > You also do not need the `else` in that `try-except` block.

> > 
> > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> 
> I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.

> In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

Yes, unless there is an easy way to check, python prefers to try.



---

archive/issue_comments_359347.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mantepse](#comment%3A22):\n> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.\n\n> > > \n> > > Actually, it is the other way round.\n\n> > \n> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?\n\n> \n> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy\n\nThank you for the reference.\n\n> > > > You also do not need the `else` in that `try-except` block.\n\n> > > \n> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.\n\n> > \n> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the \"error handling\" portion. Although I would not hold up this ticket because of this.\n\n> \n> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.\n\nThank you.\n\n> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.\n\n> \n> Yes, unless there is an easy way to check, python prefers to try.\n\nThat depends on how you define \"easy\". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.\n\nAlso, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.",
    "created_at": "2017-09-14T05:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359347",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mantepse](#comment%3A22):
> > > > Also, you should catch `Exception` as I think `StandardError` would also catch more serious errors and interrupts (e.g., ctrl-C) that should rise up.

> > > 
> > > Actually, it is the other way round.

> > 
> > I remember being told that if you want a general exception catching, you should do `Exception`. Maybe that does everything except interrupts? Maybe I am thinking of a different error class that is bad?

> 
> The hierarchy of classes is here: https://docs.python.org/2/library/exceptions.html#exception-hierarchy

Thank you for the reference.

> > > > You also do not need the `else` in that `try-except` block.

> > > 
> > > I know, but I think it makes the code much clearer - it is easy to overlook the return just before.

> > 
> > I disagree. It suggests extra logic as opposed to the fact that it should just fall through and the indented `except` block is the "error handling" portion. Although I would not hold up this ticket because of this.

> 
> well, the `m = self._matrix_space(asm)` is also indented.  But anyway, I removed the `else`.

Thank you.

> > In a way, I am not usually satisfied using errors to control program flow, but I think this is a necessary evil to differentiate the input in a fast way.

> 
> Yes, unless there is an easy way to check, python prefers to try.

That depends on how you define "easy". If you mean in terms of readability and robustness, then the containment check is better IMO. However, the speed-up is clear.

Also, I don't think we also have to worry about 1x1 matrices versus size 1 arrays. However, it is an internal behavior change because it now considers it as a matrix instead of an array.



---

archive/issue_comments_359348.json:
```json
{
    "body": "Changed commit from **[`1148495`](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)** to **[`23433b1`](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)**",
    "created_at": "2017-09-14T05:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359348",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1148495`](https://github.com/sagemath/sagetrac-mirror/commit/11484958ccb747af349db836d672e19bdc042221)** to **[`23433b1`](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)**



---

archive/issue_comments_359349.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n",
    "created_at": "2017-09-14T05:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359349",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>




---

archive/issue_comments_359350.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYou are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b\"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>\n",
    "created_at": "2017-09-14T05:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359350",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:25" align="right">comment:25</div>

You are very attentive!  I actually checked the 1x1 matrix, but was too lazy to write a test.  Fixed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b"><code>23433b1</code></a></td><td><code>add a test for 1x1 matrices</code></td></tr></table>




---

archive/issue_comments_359351.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957\"><code>572930c</code></a></td><td><code>better construction of matrices, fix a typo</code></td></tr></table>\n",
    "created_at": "2017-09-14T20:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359351",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957"><code>572930c</code></a></td><td><code>better construction of matrices, fix a typo</code></td></tr></table>




---

archive/issue_comments_359352.json:
```json
{
    "body": "Changed commit from **[`23433b1`](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)** to **[`572930c`](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)**",
    "created_at": "2017-09-14T20:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359352",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`23433b1`](https://github.com/sagemath/sagetrac-mirror/commit/23433b173f615c7315799458e4a9d5a26efd1b7b)** to **[`572930c`](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)**



---

archive/issue_comments_359353.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nInstead of\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]\n           for j in range(n)]\n            for i in range(n)]\nself._matrix_space(asm)\n```\nYou should use matrix operations\n\n```\ncorner = MatrixSpace(ZZ, n+1)(corner)\nasm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n```\nAs I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win\n\n```\nsage: n = 5\nsage: corner = random_matrix(ZZ, n+1)\nsage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])\n10000 loops, best of 3: 108 \u00b5s per loop\nsage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]\n10000 loops, best of 3: 34.5 \u00b5s per loop\n```\n(In numpy it would have been tremendous!)",
    "created_at": "2017-09-15T08:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359353",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

Instead of

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = [[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j]
           for j in range(n)]
            for i in range(n)]
self._matrix_space(asm)
```
You should use matrix operations

```
corner = MatrixSpace(ZZ, n+1)(corner)
asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
```
As I mentioned in #23819, a Python loop is a bad idea if you want speed. Though matrix slices are not seriously optimized in Sage (we are not using memory views), but still there is a win

```
sage: n = 5
sage: corner = random_matrix(ZZ, n+1)
sage: %timeit asm = matrix([[corner[i+1,j+1]+corner[i,j]-corner[i,j+1]-corner[i+1,j] for j in range(n)] for i in range(n)])
10000 loops, best of 3: 108 µs per loop
sage: %timeit asm = corner[1:,1:] + corner[:n,:n] - corner[:n,1:] - corner[1:,:n]
10000 loops, best of 3: 34.5 µs per loop
```
(In numpy it would have been tremendous!)



---

archive/issue_comments_359354.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThat's brilliant!",
    "created_at": "2017-09-15T09:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359354",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:28" align="right">comment:28</div>

That's brilliant!



---

archive/issue_comments_359355.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004\"><code>1e5fd41</code></a></td><td><code>use matrix operations in from_corner_sum</code></td></tr></table>\n",
    "created_at": "2017-09-15T10:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359355",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004"><code>1e5fd41</code></a></td><td><code>use matrix operations in from_corner_sum</code></td></tr></table>




---

archive/issue_comments_359356.json:
```json
{
    "body": "Changed commit from **[`572930c`](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)** to **[`1e5fd41`](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)**",
    "created_at": "2017-09-15T10:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359356",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`572930c`](https://github.com/sagemath/sagetrac-mirror/commit/572930cae7aa079cbd28313d0fc83b468f74e957)** to **[`1e5fd41`](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)**



---

archive/issue_comments_359357.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nCould you update the timings in the ticket description? (we were at 25.5s with your version)",
    "created_at": "2017-09-15T13:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359357",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

Could you update the timings in the ticket description? (we were at 25.5s with your version)



---

archive/issue_comments_359358.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThis conversion is not needed anymore\n\n```\nself._matrix_space(asm)\n```\nIf you really feel there should be something, just add the line\n\n```\nassert asm.parent() is self._matrix_space\n```",
    "created_at": "2017-09-15T13:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359358",
    "user": "https://github.com/videlec"
}
```

<div id="comment:31" align="right">comment:31</div>

This conversion is not needed anymore

```
self._matrix_space(asm)
```
If you really feel there should be something, just add the line

```
assert asm.parent() is self._matrix_space
```



---

archive/issue_comments_359359.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076\"><code>5d4806b</code></a></td><td><code>remove unnecessary conversion to matrix</code></td></tr></table>\n",
    "created_at": "2017-09-15T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359359",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076"><code>5d4806b</code></a></td><td><code>remove unnecessary conversion to matrix</code></td></tr></table>




---

archive/issue_comments_359360.json:
```json
{
    "body": "Changed commit from **[`1e5fd41`](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)** to **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**",
    "created_at": "2017-09-15T14:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359360",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e5fd41`](https://github.com/sagemath/sagetrac-mirror/commit/1e5fd41c9520b0298b2c70790c0b220b5b31d004)** to **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**



---

archive/issue_comments_359361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,15 @@\n old:\n \n ```\n-sage: timeit(\"[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n-1 loops, best of 1: 35.2 s per loop\n+sage: A = AlternatingSignMatrices(6)\n+sage: lC = [a.corner_sum_matrix() for a in A]\n+sage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1)\n+1 loops, best of 1: 31.6 s per loop\n ```\n \n new:\n \n ```\n-sage: timeit(\"[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]\", number=1, repeat=1)\n-1 loops, best of 1: 25.5 s per loop\n+sage: timeit(\"[A.from_corner_sum(corner) for corner in lC]\", number=1, repeat=1) \n+1 loops, best of 1: 2.33 s per loop\n ```\n``````\n",
    "created_at": "2017-09-15T14:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359361",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,15 @@
 old:
 
 ```
-sage: timeit("[asm.parent().from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
-1 loops, best of 1: 35.2 s per loop
+sage: A = AlternatingSignMatrices(6)
+sage: lC = [a.corner_sum_matrix() for a in A]
+sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1)
+1 loops, best of 1: 31.6 s per loop
 ```
 
 new:
 
 ```
-sage: timeit("[from_corner_sum(asm.corner_sum_matrix()) for asm in AlternatingSignMatrices(6)]", number=1, repeat=1)
-1 loops, best of 1: 25.5 s per loop
+sage: timeit("[A.from_corner_sum(corner) for corner in lC]", number=1, repeat=1) 
+1 loops, best of 1: 2.33 s per loop
 ```
``````




---

archive/issue_comments_359362.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nHaaa. Looks better now ;-)",
    "created_at": "2017-09-15T14:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359362",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Haaa. Looks better now ;-)



---

archive/issue_comments_359363.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nGiven the speed we've gained, I am setting this to positive review (unless anyone has any objections).",
    "created_at": "2017-09-15T19:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359363",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Given the speed we've gained, I am setting this to positive review (unless anyone has any objections).



---

archive/issue_events_328129.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T19:55:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328129"
}
```



---

archive/issue_events_328130.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-15T19:55:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328130"
}
```



---

archive/issue_comments_359364.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Vincent Delecroix**",
    "created_at": "2017-09-15T19:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359364",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw, Vincent Delecroix**



---

archive/issue_comments_359365.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@videlec](#comment%3A34):\n> Haaa. Looks better now ;-)\n\nI agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!",
    "created_at": "2017-09-15T19:59:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359365",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@videlec](#comment%3A34):
> Haaa. Looks better now ;-)

I agree!  The new version is much faster **and** much easier to understand!  Thank you (and Florian)!



---

archive/issue_comments_359366.json:
```json
{
    "body": "Changed branch from **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)** to **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**",
    "created_at": "2017-09-18T22:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23819#issuecomment-359366",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/speed_up_alternatingsignmatrix_from_corner_sum)** to **[`5d4806b`](https://github.com/sagemath/sagetrac-mirror/commit/5d4806beace6cd865cfd3897d51ccdf0447a0076)**



---

archive/issue_events_328131.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-18T22:15:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328131"
}
```



---

archive/issue_events_328132.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2f6916314b7a26922e3c951a3e867f22715c2232",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-09-18T22:15:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23819",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23819#event-328132"
}
```
