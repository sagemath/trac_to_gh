# Issue 23960: Doctest SymPy's test_sage.py on installation

archive/issues_023723.json:
```json
{
    "body": "The SymPy-->Sage interface is theoretically tested in SymPy's `sympy/external/tests/test_sage.py` but practically it does not happen in the SymPy repo even if the file is changed, because of Travis limitations (a Sage installation is needed). The file header states:\n\n```\n# Execute this test inside Sage, e.g. with:\n# sage -python bin/test sympy/external/tests/test_sage.py\n#\n# This file can be tested by Sage itself by:\n# sage -t sympy/external/tests/test_sage.py\n# and if all tests pass, it should be copied (verbatim) to Sage, so that it is\n# automatically doctested by Sage.  Note that this second method imports the\n# version of SymPy in Sage, whereas the -python method imports the local version\n# of SymPy (both use the local version of the tests, however).\n```\n\nIn the present version the file fails two doctests so these should be fixed in SymPy. This ticket should then add the patch to the Sage SymPy install and change the SymPy install script to automatically copy the file into Sage's `tests/` directory.\n\nThe SymPy fixes are in https://github.com/sympy/sympy/pull/13392\n\nBranch: [u/rws/23960-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23960-1)\n\nCommit: [b4c5106a0057c2a955a3c5b025f9ede724257b10](https://github.com/sagemath/sagetrac-mirror/commit/b4c5106a0057c2a955a3c5b025f9ede724257b10)\n\nAuthor: Ralf Stephan\n\nResolution: wontfix\n\nIssue created by migration from https://trac.sagemath.org/ticket/23960\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2017-10-03T14:13:22Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Doctest SymPy's test_sage.py on installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23960",
    "user": "https://github.com/rwst"
}
```
The SymPy-->Sage interface is theoretically tested in SymPy's `sympy/external/tests/test_sage.py` but practically it does not happen in the SymPy repo even if the file is changed, because of Travis limitations (a Sage installation is needed). The file header states:

```
# Execute this test inside Sage, e.g. with:
# sage -python bin/test sympy/external/tests/test_sage.py
#
# This file can be tested by Sage itself by:
# sage -t sympy/external/tests/test_sage.py
# and if all tests pass, it should be copied (verbatim) to Sage, so that it is
# automatically doctested by Sage.  Note that this second method imports the
# version of SymPy in Sage, whereas the -python method imports the local version
# of SymPy (both use the local version of the tests, however).
```

In the present version the file fails two doctests so these should be fixed in SymPy. This ticket should then add the patch to the Sage SymPy install and change the SymPy install script to automatically copy the file into Sage's `tests/` directory.

The SymPy fixes are in https://github.com/sympy/sympy/pull/13392

Branch: [u/rws/23960-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/23960-1)

Commit: [b4c5106a0057c2a955a3c5b025f9ede724257b10](https://github.com/sagemath/sagetrac-mirror/commit/b4c5106a0057c2a955a3c5b025f9ede724257b10)

Author: Ralf Stephan

Resolution: wontfix

Issue created by migration from https://trac.sagemath.org/ticket/23960





---

archive/issue_comments_454765.json:
```json
{
    "body": "<a id='comment:1'></a>\nAfter adding: `sage: from sympy.external.tests.test_sage import *` the fails are:\n\n```\n**********************************************************************\nFile \"test_sage.py\", line 260, in test_sage.test_abstract_function\nFailed example:\n    test_undefined_function()\nExpected:\n    sage  test_abstract_function()\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"test_sage.py\", line 265, in test_sage.test_abstract_function\nFailed example:\n    check_expression(\"lucas(x)\", \"x\")\nExpected:\n    Traceback (most recent call last):\n    ...\n    AttributeError: 'module' object has no attribute 'lucas'\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest test_sage.test_abstract_function[17]>\", line 1, in <module>\n        check_expression(\"lucas(x)\", \"x\")\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/external/tests/test_sage.py\", line 71, in check_expression\n        e_sage = _sage_method(sympy.S(e_sympy))\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/function.py\", line 720, in _sage_\n        raise AttributeError\n    AttributeError\n```",
    "created_at": "2017-10-03T14:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454765",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
After adding: `sage: from sympy.external.tests.test_sage import *` the fails are:

```
**********************************************************************
File "test_sage.py", line 260, in test_sage.test_abstract_function
Failed example:
    test_undefined_function()
Expected:
    sage  test_abstract_function()
Got:
    <BLANKLINE>
**********************************************************************
File "test_sage.py", line 265, in test_sage.test_abstract_function
Failed example:
    check_expression("lucas(x)", "x")
Expected:
    Traceback (most recent call last):
    ...
    AttributeError: 'module' object has no attribute 'lucas'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest test_sage.test_abstract_function[17]>", line 1, in <module>
        check_expression("lucas(x)", "x")
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/external/tests/test_sage.py", line 71, in check_expression
        e_sage = _sage_method(sympy.S(e_sympy))
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/function.py", line 720, in _sage_
        raise AttributeError
    AttributeError
```



---

archive/issue_comments_454766.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,5 @@\n ```\n \n In the present version the file fails two doctests so these should be fixed in SymPy. This ticket should then add the patch to the Sage SymPy install and change the SymPy install script to automatically copy the file into Sage's `tests/` directory.\n+\n+The SymPy fixes are in https://github.com/sympy/sympy/pull/13392\n``````\n",
    "created_at": "2017-10-03T14:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454766",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,5 @@
 ```
 
 In the present version the file fails two doctests so these should be fixed in SymPy. This ticket should then add the patch to the Sage SymPy install and change the SymPy install script to automatically copy the file into Sage's `tests/` directory.
+
+The SymPy fixes are in https://github.com/sympy/sympy/pull/13392
``````




---

archive/issue_comments_454767.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/copy_sympy_s_test_sage_py_into_sage_s_tests_\"",
    "created_at": "2017-10-03T15:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454767",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/copy_sympy_s_test_sage_py_into_sage_s_tests_"



---

archive/issue_comments_454768.json:
```json
{
    "body": "Changing commit from \"\" to \"eb3f077007cb9d87269130f1934ba59c4cfe4c70\"",
    "created_at": "2017-10-03T15:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454768",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "eb3f077007cb9d87269130f1934ba59c4cfe4c70"



---

archive/issue_comments_454769.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-03T15:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454769",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454770.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-10-03T15:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454770",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_454771.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[eb3f077](https://github.com/sagemath/sagetrac-mirror/commit/eb3f077007cb9d87269130f1934ba59c4cfe4c70)|`23960: Copy SymPy's test_sage.py into Sage's tests/`|",
    "created_at": "2017-10-03T15:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454771",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[eb3f077](https://github.com/sagemath/sagetrac-mirror/commit/eb3f077007cb9d87269130f1934ba59c4cfe4c70)|`23960: Copy SymPy's test_sage.py into Sage's tests/`|



---

archive/issue_comments_454772.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't think that copying files into the Sage source tree is acceptable.\n\nInstead, we could run the testsuite in the `spkg-check` file of `sympy`.",
    "created_at": "2017-10-04T12:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454772",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
I don't think that copying files into the Sage source tree is acceptable.

Instead, we could run the testsuite in the `spkg-check` file of `sympy`.



---

archive/issue_comments_454773.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-04T12:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454773",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454774.json:
```json
{
    "body": "<a id='comment:6'></a>\nWait a minute, this testsuite is actually installed anyway in `site-packages/sympy`?\n\nSo instead of copying that file, why not run the standard doctester on it?\n\n```\nsage: from sympy.external.tests import test_sage\nsage: import doctest\nsage: doctest.testmod(test_sage)\n```\n\nThis is using the standard Python doctest framework, so the tests should be written with `>>>` instead of `sage:` and the tests should be put in real docstrings. A string somewhere in the middle of a `.py` file isn't a docstring.",
    "created_at": "2017-10-04T13:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454774",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Wait a minute, this testsuite is actually installed anyway in `site-packages/sympy`?

So instead of copying that file, why not run the standard doctester on it?

```
sage: from sympy.external.tests import test_sage
sage: import doctest
sage: doctest.testmod(test_sage)
```

This is using the standard Python doctest framework, so the tests should be written with `>>>` instead of `sage:` and the tests should be put in real docstrings. A string somewhere in the middle of a `.py` file isn't a docstring.



---

archive/issue_comments_454775.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A5):\n> Instead, we could run the testsuite in the `spkg-check` file of `sympy`.\n\n\nIsn't that run after package installation? You need full Sage for it.",
    "created_at": "2017-10-04T13:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454775",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A5):
> Instead, we could run the testsuite in the `spkg-check` file of `sympy`.


Isn't that run after package installation? You need full Sage for it.



---

archive/issue_comments_454776.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [rws](#comment%3A7):\n> Isn't that run after package installation?\n\n\nYes, it is.\n\n> You need full Sage for it.\n\n\nProbably not \"full Sage\", or do you? It is possible to add `$(SAGERUNTIME)` to `build/pkgs/sympy/dependencies` if you require Sage. But that is not \"full Sage\", just a minimal Sage.\n\nIn any case, the solution from [comment:6] is simpler.",
    "created_at": "2017-10-04T13:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [rws](#comment%3A7):
> Isn't that run after package installation?


Yes, it is.

> You need full Sage for it.


Probably not "full Sage", or do you? It is possible to add `$(SAGERUNTIME)` to `build/pkgs/sympy/dependencies` if you require Sage. But that is not "full Sage", just a minimal Sage.

In any case, the solution from [comment:6] is simpler.



---

archive/issue_comments_454777.json:
```json
{
    "body": "Changing branch from \"u/rws/copy_sympy_s_test_sage_py_into_sage_s_tests_\" to \"u/rws/23960-1\"",
    "created_at": "2017-10-04T15:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454777",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/copy_sympy_s_test_sage_py_into_sage_s_tests_" to "u/rws/23960-1"



---

archive/issue_events_069325.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "rename": {
        "from": "Copy SymPy's test_sage.py into Sage's tests/",
        "to": "Doctest SymPy's test_sage.py on installation"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23960#event-69325"
}
```



---

archive/issue_comments_454778.json:
```json
{
    "body": "Changing commit from \"eb3f077007cb9d87269130f1934ba59c4cfe4c70\" to \"22cc992dd679bc36fe22aecf59d37cd8de3aef6d\"",
    "created_at": "2017-10-04T15:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454778",
    "user": "https://github.com/rwst"
}
```

Changing commit from "eb3f077007cb9d87269130f1934ba59c4cfe4c70" to "22cc992dd679bc36fe22aecf59d37cd8de3aef6d"



---

archive/issue_comments_454779.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-04T15:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454779",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454780.json:
```json
{
    "body": "<a id='comment:10'></a>\nI copied this solution from the giacpy package so I assume it will work on a new Sage install as well (which I didn't test, I only tested with `sage -p` and 'SAGE_CHECK=yes' on a compiled Sage).\n\n---\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[22cc992](https://github.com/sagemath/sagetrac-mirror/commit/22cc992dd679bc36fe22aecf59d37cd8de3aef6d)|`23960: Doctest SymPy's test_sage.py on installation`|",
    "created_at": "2017-10-04T15:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454780",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
I copied this solution from the giacpy package so I assume it will work on a new Sage install as well (which I didn't test, I only tested with `sage -p` and 'SAGE_CHECK=yes' on a compiled Sage).

---
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[22cc992](https://github.com/sagemath/sagetrac-mirror/commit/22cc992dd679bc36fe22aecf59d37cd8de3aef6d)|`23960: Doctest SymPy's test_sage.py on installation`|



---

archive/issue_comments_454781.json:
```json
{
    "body": "<a id='comment:11'></a>\nI can test it. I don't understand this comment though: `# --force-lib because we dont want sage -t to compile test-sage.py`\n\nAlso, indent with 4 spaces.",
    "created_at": "2017-10-04T15:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454781",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
I can test it. I don't understand this comment though: `# --force-lib because we dont want sage -t to compile test-sage.py`

Also, indent with 4 spaces.



---

archive/issue_comments_454782.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A11):\n> I can test it. I don't understand this comment though: `# --force-lib because we dont want sage -t to compile test-sage.py`\n\n\nI'll remove it. Is `--force-lib` necessary at all?\n\n> Also, indent with 4 spaces.",
    "created_at": "2017-10-05T05:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454782",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A11):
> I can test it. I don't understand this comment though: `# --force-lib because we dont want sage -t to compile test-sage.py`


I'll remove it. Is `--force-lib` necessary at all?

> Also, indent with 4 spaces.



---

archive/issue_comments_454783.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-05T08:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454783",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454784.json:
```json
{
    "body": "<a id='comment:13'></a>\n\n```\nFile \"src/sympy/external/tests/test_sage.py\", line 258, in sympy.external.tests.test_sage.test_abstract_function\nFailed example:\n    test_issue_4023()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sympy.external.tests.test_sage.test_abstract_function[14]>\", line 1, in <module>\n        test_issue_4023()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sympy/external/tests/test_sage.py\", line 198, in test_issue_4023\n        assert s == (a*log(1 + a) - a*log(a) + log(1 + a) - 1)/a\n      File \"sage/symbolic/expression.pyx\", line 2764, in sage.symbolic.expression.Expression.__nonzero__ (build/cythonized/sage/symbolic/expression.cpp:19169)\n        return test_relation_maxima(self)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/symbolic/relation.py\", line 467, in test_relation_maxima\n        m = relation._maxima_()\n      File \"sage/symbolic/expression.pyx\", line 798, in sage.symbolic.expression.Expression._maxima_ (build/cythonized/sage/symbolic/expression.cpp:7820)\n        return super(Expression, self)._interface_(maxima)\n      File \"sage/structure/sage_object.pyx\", line 734, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6513)\n        nm = I.name()\n      File \"sage/misc/lazy_import.pyx\", line 322, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3546)\n        return getattr(self.get_object(), attr)\n      File \"sage/misc/lazy_import.pyx\", line 189, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2198)\n        return self._get_object()\n      File \"sage/misc/lazy_import.pyx\", line 221, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2468)\n        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 104, in <module>\n        ecl_eval(\"(require 'maxima)\")\n      File \"sage/libs/ecl.pyx\", line 1322, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:10817)\n        cpdef EclObject ecl_eval(bytes s):\n      File \"sage/libs/ecl.pyx\", line 1337, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:10756)\n        o=ecl_safe_eval(o)\n      File \"sage/libs/ecl.pyx\", line 349, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:5807)\n        raise RuntimeError(\"ECL says: \"+ecl_base_string_pointer_safe(s))\n    RuntimeError: ECL says: Module error: Don't know how to REQUIRE MAXIMA.\n```",
    "created_at": "2017-10-05T08:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454784",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>

```
File "src/sympy/external/tests/test_sage.py", line 258, in sympy.external.tests.test_sage.test_abstract_function
Failed example:
    test_issue_4023()
Exception raised:
    Traceback (most recent call last):
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sympy.external.tests.test_sage.test_abstract_function[14]>", line 1, in <module>
        test_issue_4023()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sympy/external/tests/test_sage.py", line 198, in test_issue_4023
        assert s == (a*log(1 + a) - a*log(a) + log(1 + a) - 1)/a
      File "sage/symbolic/expression.pyx", line 2764, in sage.symbolic.expression.Expression.__nonzero__ (build/cythonized/sage/symbolic/expression.cpp:19169)
        return test_relation_maxima(self)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/symbolic/relation.py", line 467, in test_relation_maxima
        m = relation._maxima_()
      File "sage/symbolic/expression.pyx", line 798, in sage.symbolic.expression.Expression._maxima_ (build/cythonized/sage/symbolic/expression.cpp:7820)
        return super(Expression, self)._interface_(maxima)
      File "sage/structure/sage_object.pyx", line 734, in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6513)
        nm = I.name()
      File "sage/misc/lazy_import.pyx", line 322, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3546)
        return getattr(self.get_object(), attr)
      File "sage/misc/lazy_import.pyx", line 189, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2198)
        return self._get_object()
      File "sage/misc/lazy_import.pyx", line 221, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2468)
        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 104, in <module>
        ecl_eval("(require 'maxima)")
      File "sage/libs/ecl.pyx", line 1322, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:10817)
        cpdef EclObject ecl_eval(bytes s):
      File "sage/libs/ecl.pyx", line 1337, in sage.libs.ecl.ecl_eval (build/cythonized/sage/libs/ecl.c:10756)
        o=ecl_safe_eval(o)
      File "sage/libs/ecl.pyx", line 349, in sage.libs.ecl.ecl_safe_eval (build/cythonized/sage/libs/ecl.c:5807)
        raise RuntimeError("ECL says: "+ecl_base_string_pointer_safe(s))
    RuntimeError: ECL says: Module error: Don't know how to REQUIRE MAXIMA.
```



---

archive/issue_comments_454785.json:
```json
{
    "body": "<a id='comment:14'></a>\nAh the proof machinery, easy fix.",
    "created_at": "2017-10-05T08:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454785",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Ah the proof machinery, easy fix.



---

archive/issue_comments_454786.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe Sage doctest framework needs to determine whether to load the file to be doctested or not. If the file to be tested is part of a package (as opposed to a stand-alone script), then it is never loaded. If `--force-lib` is given, it is also not loaded.\n\nIn this case, `--force-lib` is not needed because the file `test_sage.py` is part of a package.",
    "created_at": "2017-10-05T09:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454786",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
The Sage doctest framework needs to determine whether to load the file to be doctested or not. If the file to be tested is part of a package (as opposed to a stand-alone script), then it is never loaded. If `--force-lib` is given, it is also not loaded.

In this case, `--force-lib` is not needed because the file `test_sage.py` is part of a package.



---

archive/issue_comments_454787.json:
```json
{
    "body": "Changing commit from \"22cc992dd679bc36fe22aecf59d37cd8de3aef6d\" to \"fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1\"",
    "created_at": "2017-10-05T13:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "22cc992dd679bc36fe22aecf59d37cd8de3aef6d" to "fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1"



---

archive/issue_comments_454788.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[fb92cb7](https://github.com/sagemath/sagetrac-mirror/commit/fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1)|`23960: add SymPy patch that avoids proving equality in test_sage.py`|",
    "created_at": "2017-10-05T13:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[fb92cb7](https://github.com/sagemath/sagetrac-mirror/commit/fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1)|`23960: add SymPy patch that avoids proving equality in test_sage.py`|



---

archive/issue_comments_454789.json:
```json
{
    "body": "<a id='comment:17'></a>\nSee for both SymPy patches:\n\n- https://github.com/sympy/sympy/pull/13392\n- https://github.com/sympy/sympy/pull/13402\n\nAgain, unfortunately I can't test this myself.",
    "created_at": "2017-10-05T13:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454789",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>
See for both SymPy patches:

- https://github.com/sympy/sympy/pull/13392
- https://github.com/sympy/sympy/pull/13402

Again, unfortunately I can't test this myself.



---

archive/issue_comments_454790.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-05T13:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454790",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-05T13:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454791",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454792.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[dfb4b23](https://github.com/sagemath/sagetrac-mirror/commit/dfb4b237a97642c39f591505251f3b71fbe536e9)|`23960: address reviewer's comments`|",
    "created_at": "2017-10-05T13:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[dfb4b23](https://github.com/sagemath/sagetrac-mirror/commit/dfb4b237a97642c39f591505251f3b71fbe536e9)|`23960: address reviewer's comments`|



---

archive/issue_comments_454793.json:
```json
{
    "body": "Changing commit from \"fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1\" to \"dfb4b237a97642c39f591505251f3b71fbe536e9\"",
    "created_at": "2017-10-05T13:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fb92cb7d1610ec8fd929b32b9700f895d1e6f4a1" to "dfb4b237a97642c39f591505251f3b71fbe536e9"



---

archive/issue_comments_454794.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-05T13:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454794",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454795.json:
```json
{
    "body": "<a id='comment:21'></a>\nAccording to the git Trac plugin, you added an empty file as patch.",
    "created_at": "2017-10-05T13:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454795",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
According to the git Trac plugin, you added an empty file as patch.



---

archive/issue_comments_454796.json:
```json
{
    "body": "Changing commit from \"dfb4b237a97642c39f591505251f3b71fbe536e9\" to \"056502a2b9483883073f9d31c91d84b21d6457c2\"",
    "created_at": "2017-10-05T14:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dfb4b237a97642c39f591505251f3b71fbe536e9" to "056502a2b9483883073f9d31c91d84b21d6457c2"



---

archive/issue_comments_454797.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[056502a](https://github.com/sagemath/sagetrac-mirror/commit/056502a2b9483883073f9d31c91d84b21d6457c2)|`23960: add SymPy patch that avoids proving equality in test_sage.py`|",
    "created_at": "2017-10-05T14:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[056502a](https://github.com/sagemath/sagetrac-mirror/commit/056502a2b9483883073f9d31c91d84b21d6457c2)|`23960: add SymPy patch that avoids proving equality in test_sage.py`|



---

archive/issue_comments_454798.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-05T14:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454798",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454799.json:
```json
{
    "body": "<a id='comment:23'></a>\nApparently I tested an empty file, thanks.",
    "created_at": "2017-10-05T14:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454799",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'></a>
Apparently I tested an empty file, thanks.



---

archive/issue_comments_454800.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[b4c5106](https://github.com/sagemath/sagetrac-mirror/commit/b4c5106a0057c2a955a3c5b025f9ede724257b10)|`23960: fix patch`|",
    "created_at": "2017-10-05T15:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[b4c5106](https://github.com/sagemath/sagetrac-mirror/commit/b4c5106a0057c2a955a3c5b025f9ede724257b10)|`23960: fix patch`|



---

archive/issue_comments_454801.json:
```json
{
    "body": "Changing commit from \"056502a2b9483883073f9d31c91d84b21d6457c2\" to \"b4c5106a0057c2a955a3c5b025f9ede724257b10\"",
    "created_at": "2017-10-05T15:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "056502a2b9483883073f9d31c91d84b21d6457c2" to "b4c5106a0057c2a955a3c5b025f9ede724257b10"



---

archive/issue_comments_454802.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-05T15:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454802",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454803.json:
```json
{
    "body": "<a id='comment:26'></a>\nThis ticket actually seems the ONLY way to test the SymPy/Sage interface because the same attempt on SymPy Travis never worked, see https://github.com/sympy/sympy/issues/13395",
    "created_at": "2017-10-10T14:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454803",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'></a>
This ticket actually seems the ONLY way to test the SymPy/Sage interface because the same attempt on SymPy Travis never worked, see https://github.com/sympy/sympy/issues/13395



---

archive/issue_comments_454804.json:
```json
{
    "body": "<a id='comment:27'></a>\nSee also #24006.",
    "created_at": "2017-10-10T15:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454804",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'></a>
See also #24006.



---

archive/issue_comments_454805.json:
```json
{
    "body": "<a id='comment:28'></a>\nThis is obsoleted by #24006.",
    "created_at": "2017-10-15T15:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454805",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
This is obsoleted by #24006.



---

archive/issue_events_069326.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-15T15:28:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23960#event-69326"
}
```



---

archive/issue_comments_454806.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-15T15:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454806",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_069327.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23960#event-69327"
}
```



---

archive/issue_comments_454807.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23960#issuecomment-454807",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix
