# Issue 23431: enhancements to free pre-Lie algebras

archive/issues_023194.json:
```json
{
    "body": "to keep them inline with #23406\n\n* changes the behaviour of single-variable case\n\n* adds the category \"LieAlgebras\"\n\n* enhance coercion\n\nCC:  @tscrim @darijgr @hivert\n\nKeywords: pre-lie algebras, trees, operads\n\nBranch/Commit: c2608098170d7daf2c77ff24dcdca7e0399fd9df\n\nReviewer: Darij Grinberg, Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23431\n\n",
    "closed_at": "2017-07-26T22:11:57Z",
    "created_at": "2017-07-14T07:59:15Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "enhancements to free pre-Lie algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23431",
    "user": "https://github.com/fchapoton"
}
```
to keep them inline with #23406

* changes the behaviour of single-variable case

* adds the category "LieAlgebras"

* enhance coercion

CC:  @tscrim @darijgr @hivert

Keywords: pre-lie algebras, trees, operads

Branch/Commit: c2608098170d7daf2c77ff24dcdca7e0399fd9df

Reviewer: Darij Grinberg, Travis Scrimshaw

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23431





---

archive/issue_comments_440526.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2017-07-14T07:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440526",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_440527.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-14T07:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440527",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_440528.json:
```json
{
    "body": "Changing commit from \"\" to \"b5d7fe7fabb36482230ab4e8a59096dcaf8fd213\"",
    "created_at": "2017-07-14T07:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440528",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "b5d7fe7fabb36482230ab4e8a59096dcaf8fd213"



---

archive/issue_comments_440529.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/23431\"",
    "created_at": "2017-07-14T07:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440529",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/23431"



---

archive/issue_comments_440530.json:
```json
{
    "body": "<a id='comment:2'></a>Why have you removed this doctest?\n\n```\n-            sage: F = algebras.FreePreLie(QQ, ZZ)\n-            sage: elts = F.some_elements()[:-1] # Skip the last element\n-            sage: TestSuite(F).run(some_elements=elts) # long time\n```\nHaving an infinite generating set looks like a reasonable use case to me. If the test suite fails for stupid reasons, then I'm still in favor of manually testing some computations with elements.\n\nOther than this, LGTM with my little review commits.\n\n---\nNew commits:",
    "created_at": "2017-07-16T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440530",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:2'></a>Why have you removed this doctest?

```
-            sage: F = algebras.FreePreLie(QQ, ZZ)
-            sage: elts = F.some_elements()[:-1] # Skip the last element
-            sage: TestSuite(F).run(some_elements=elts) # long time
```
Having an infinite generating set looks like a reasonable use case to me. If the test suite fails for stupid reasons, then I'm still in favor of manually testing some computations with elements.

Other than this, LGTM with my little review commits.

---
New commits:



---

archive/issue_comments_440531.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Darij Grinberg\"",
    "created_at": "2017-07-16T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440531",
    "user": "https://github.com/darijgr"
}
```

Changing reviewer from "" to "Darij Grinberg"



---

archive/issue_comments_440532.json:
```json
{
    "body": "Changing keywords from \"\" to \"pre-lie algebras, trees, operads\".",
    "created_at": "2017-07-16T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440532",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "" to "pre-lie algebras, trees, operads".



---

archive/issue_comments_440533.json:
```json
{
    "body": "Changing branch from \"u/chapoton/23431\" to \"public/ticket/23431\"",
    "created_at": "2017-07-16T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440533",
    "user": "https://github.com/darijgr"
}
```

Changing branch from "u/chapoton/23431" to "public/ticket/23431"



---

archive/issue_comments_440534.json:
```json
{
    "body": "Changing commit from \"b5d7fe7fabb36482230ab4e8a59096dcaf8fd213\" to \"a58067d2524488e7f37586a1242ea90f6951570f\"",
    "created_at": "2017-07-16T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440534",
    "user": "https://github.com/darijgr"
}
```

Changing commit from "b5d7fe7fabb36482230ab4e8a59096dcaf8fd213" to "a58067d2524488e7f37586a1242ea90f6951570f"



---

archive/issue_comments_440535.json:
```json
{
    "body": "<a id='comment:3'></a>I removed it because it seems to me that the TestSuite takes much too long.",
    "created_at": "2017-07-16T11:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440535",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>I removed it because it seems to me that the TestSuite takes much too long.



---

archive/issue_comments_440536.json:
```json
{
    "body": "Changing commit from \"a58067d2524488e7f37586a1242ea90f6951570f\" to \"117df27df7646e5cc39c2693b265297b648d4dd4\"",
    "created_at": "2017-07-16T11:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a58067d2524488e7f37586a1242ea90f6951570f" to "117df27df7646e5cc39c2693b265297b648d4dd4"



---

archive/issue_comments_440537.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T11:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440538.json:
```json
{
    "body": "<a id='comment:5'></a>OK, then I'm adding a manual version. If you like my changes, this is positively reviewed.",
    "created_at": "2017-07-16T11:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440538",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:5'></a>OK, then I'm adding a manual version. If you like my changes, this is positively reviewed.



---

archive/issue_comments_440539.json:
```json
{
    "body": "<a id='comment:6'></a>Looks good, except I have a doubt about\n\n```\n+    .. [ChLi]_\n+\n+    .. [Liv2006]_\n```\nthat I would rather write\n\n```\n+    - [ChLi]_\n+\n+    - [Liv2006]_\n```\nBut one needs to check that the doc builds in either way..",
    "created_at": "2017-07-16T12:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440539",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>Looks good, except I have a doubt about

```
+    .. [ChLi]_
+
+    .. [Liv2006]_
```
that I would rather write

```
+    - [ChLi]_
+
+    - [Liv2006]_
```
But one needs to check that the doc builds in either way..



---

archive/issue_comments_440540.json:
```json
{
    "body": "<a id='comment:7'></a>I'm afraid I cannot test doc in reasonable time from here :/",
    "created_at": "2017-07-16T12:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440540",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:7'></a>I'm afraid I cannot test doc in reasonable time from here :/



---

archive/issue_comments_440541.json:
```json
{
    "body": "<a id='comment:8'></a>I have launched my bots on it, and will also build the doc on my own machines (takes many hours..)",
    "created_at": "2017-07-16T12:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440541",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>I have launched my bots on it, and will also build the doc on my own machines (takes many hours..)



---

archive/issue_comments_440542.json:
```json
{
    "body": "Changing commit from \"117df27df7646e5cc39c2693b265297b648d4dd4\" to \"76ee53620f5233c3bc9bf3771baf5565e30984e1\"",
    "created_at": "2017-07-16T14:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "117df27df7646e5cc39c2693b265297b648d4dd4" to "76ee53620f5233c3bc9bf3771baf5565e30984e1"



---

archive/issue_comments_440543.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T14:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440544.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-16T14:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440544",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440545.json:
```json
{
    "body": "<a id='comment:10'></a>Ok, ref corrected. For info, if you use something like `.. [Name2018]_` then nothing appears in the REFERENCE block. Better use `- [Name2018]_`.\n\nSetting to positive, thanks for the review.",
    "created_at": "2017-07-16T14:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440545",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Ok, ref corrected. For info, if you use something like `.. [Name2018]_` then nothing appears in the REFERENCE block. Better use `- [Name2018]_`.

Setting to positive, thanks for the review.



---

archive/issue_comments_440546.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-16T14:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440546",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_440547.json:
```json
{
    "body": "<a id='comment:11'></a>I think you should make the variable names truly optional by setting a default value `names=None` in `__classcall_private__`. Subsequently, it does not make sense to have a non-`None` `self._alphabet`. I feel it mixes the two cases.\n\nWhat about changing to use `normalize_names` and passing `names` to the `Parent.__init__` (CFM now handles them properly, so there should be no need to work around it)? In particular, doing something like\n\n```\ntry:\n    names = normalize_names(-1, names)\nexcept (TypeError, ValueError):\n    names = Alphabet(names)\n```",
    "created_at": "2017-07-16T14:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440547",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>I think you should make the variable names truly optional by setting a default value `names=None` in `__classcall_private__`. Subsequently, it does not make sense to have a non-`None` `self._alphabet`. I feel it mixes the two cases.

What about changing to use `normalize_names` and passing `names` to the `Parent.__init__` (CFM now handles them properly, so there should be no need to work around it)? In particular, doing something like

```
try:
    names = normalize_names(-1, names)
except (TypeError, ValueError):
    names = Alphabet(names)
```



---

archive/issue_comments_440548.json:
```json
{
    "body": "Changing commit from \"76ee53620f5233c3bc9bf3771baf5565e30984e1\" to \"4e60c200c2e784fab6dd477c6db334d170a23d8d\"",
    "created_at": "2017-07-16T18:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "76ee53620f5233c3bc9bf3771baf5565e30984e1" to "4e60c200c2e784fab6dd477c6db334d170a23d8d"



---

archive/issue_comments_440549.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T18:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440550.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T18:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440551.json:
```json
{
    "body": "Changing commit from \"4e60c200c2e784fab6dd477c6db334d170a23d8d\" to \"66214a96bcc6f5fa4dba1a5779b187d4e99a96fd\"",
    "created_at": "2017-07-16T18:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4e60c200c2e784fab6dd477c6db334d170a23d8d" to "66214a96bcc6f5fa4dba1a5779b187d4e99a96fd"



---

archive/issue_comments_440552.json:
```json
{
    "body": "Changing commit from \"66214a96bcc6f5fa4dba1a5779b187d4e99a96fd\" to \"c2608098170d7daf2c77ff24dcdca7e0399fd9df\"",
    "created_at": "2017-07-17T09:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "66214a96bcc6f5fa4dba1a5779b187d4e99a96fd" to "c2608098170d7daf2c77ff24dcdca7e0399fd9df"



---

archive/issue_comments_440553.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-17T09:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440554.json:
```json
{
    "body": "<a id='comment:15'></a>Could we maybe (for the moment) keep the existing way to handle names here (and do the same in Grossman-Larsson) ? Using normalize_names would change a lot of things..",
    "created_at": "2017-07-20T18:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440554",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>Could we maybe (for the moment) keep the existing way to handle names here (and do the same in Grossman-Larsson) ? Using normalize_names would change a lot of things..



---

archive/issue_comments_440555.json:
```json
{
    "body": "<a id='comment:16'></a>That's okay with me. I just wanted to give that option, in particular as this input differs from polynomial rings:\n\n```\nalgebras.FreePreLie(QQ, 'x,y,z')\nFree PreLie algebra on 4 generators ['x', ',', 'y', 'z'] over Rational Field\n```",
    "created_at": "2017-07-20T22:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440555",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>That's okay with me. I just wanted to give that option, in particular as this input differs from polynomial rings:

```
algebras.FreePreLie(QQ, 'x,y,z')
Free PreLie algebra on 4 generators ['x', ',', 'y', 'z'] over Rational Field
```



---

archive/issue_comments_440556.json:
```json
{
    "body": "<a id='comment:17'></a>Since you have addressed all of the issues I brought up and a green bot, I am treating this as in the needs_review state and setting a positive review. Thanks.",
    "created_at": "2017-07-21T23:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440556",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>Since you have addressed all of the issues I brought up and a green bot, I am treating this as in the needs_review state and setting a positive review. Thanks.



---

archive/issue_comments_440557.json:
```json
{
    "body": "Changing reviewer from \"Darij Grinberg\" to \"Darij Grinberg, Travis Scrimshaw\"",
    "created_at": "2017-07-21T23:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440557",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "Darij Grinberg" to "Darij Grinberg, Travis Scrimshaw"



---

archive/issue_comments_440558.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-07-21T23:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440558",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_060197.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-26T22:11:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23431#event-60197"
}
```



---

archive/issue_comments_440559.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-26T22:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440559",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_440560.json:
```json
{
    "body": "Changing branch from \"public/ticket/23431\" to \"c2608098170d7daf2c77ff24dcdca7e0399fd9df\"",
    "created_at": "2017-07-26T22:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23431#issuecomment-440560",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/23431" to "c2608098170d7daf2c77ff24dcdca7e0399fd9df"
