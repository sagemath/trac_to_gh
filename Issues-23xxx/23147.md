# Issue 23147: py3: little cleanup of six and unicode

archive/issues_022910.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nvarious small changes, split off from #23044\n\nCC:  @jdemeyer @tscrim @jhpalmieri\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch: **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**\n\nReviewer: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/23147_\n\n",
    "closed_at": "2017-06-11T09:13:19Z",
    "created_at": "2017-06-06T09:53:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: little cleanup of six and unicode",
    "type": "issue",
    "updated_at": "2017-09-05T15:44:15Z",
    "url": "https://github.com/sagemath/sage/issues/23147",
    "user": "https://github.com/fchapoton"
}
```
<div id="comment:0"></div>

various small changes, split off from #23044

CC:  @jdemeyer @tscrim @jhpalmieri

Component: **python3**

Author: **Frédéric Chapoton**

Branch: **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**

Reviewer: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/23147_





---

archive/issue_events_319828.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:53:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319828"
}
```



---

archive/issue_events_319829.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319829"
}
```



---

archive/issue_events_319830.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319830"
}
```



---

archive/issue_events_319831.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T09:53:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319831"
}
```



---

archive/issue_comments_346985.json:
```json
{
    "body": "Branch: **[u/chapoton/23147](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23147)**",
    "created_at": "2017-06-06T09:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346985",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/23147](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23147)**



---

archive/issue_comments_346986.json:
```json
{
    "body": "Commit: **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**",
    "created_at": "2017-06-06T09:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346986",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**



---

archive/issue_comments_346987.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e\"><code>d3f012d</code></a></td><td><code>some cleanup of unicode and six</code></td></tr></table>\n",
    "created_at": "2017-06-06T09:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346987",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e"><code>d3f012d</code></a></td><td><code>some cleanup of unicode and six</code></td></tr></table>




---

archive/issue_events_319832.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-06-06T18:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319832"
}
```



---

archive/issue_comments_346988.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2017-06-06T21:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346988",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_346989.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nMake this change and I'll be happy with it:\n\n```diff\ndiff --git a/src/sage/algebras/commutative_dga.py b/src/sage/algebras/commutative_dga.py\nindex e571a51c30..a5071198f1 100644\n--- a/src/sage/algebras/commutative_dga.py\n+++ b/src/sage/algebras/commutative_dga.py\n@@ -71,7 +71,7 @@ AUTHORS:\n # (at your option) any later version.\n #                  http://www.gnu.org/licenses/\n #*****************************************************************************\n-from __future__ import print_function, absolute_import\n+from __future__ import print_function\n from six import string_types\n \n from sage.misc.six import with_metaclass\n```",
    "created_at": "2017-06-06T21:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346989",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

Make this change and I'll be happy with it:

```diff
diff --git a/src/sage/algebras/commutative_dga.py b/src/sage/algebras/commutative_dga.py
index e571a51c30..a5071198f1 100644
--- a/src/sage/algebras/commutative_dga.py
+++ b/src/sage/algebras/commutative_dga.py
@@ -71,7 +71,7 @@ AUTHORS:
 # (at your option) any later version.
 #                  http://www.gnu.org/licenses/
 #*****************************************************************************
-from __future__ import print_function, absolute_import
+from __future__ import print_function
 from six import string_types
 
 from sage.misc.six import with_metaclass
```



---

archive/issue_comments_346990.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThanks for the review.\n\nConcerning your suggestion, sorry, but why ?\n\nIdeally, we should have this \"absolute_import\" in all of our .py files, to help for the transition for python3 and prevent possible regressions. Adding this should do no harm at all, once the file has been checked.",
    "created_at": "2017-06-07T05:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346990",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

Thanks for the review.

Concerning your suggestion, sorry, but why ?

Ideally, we should have this "absolute_import" in all of our .py files, to help for the transition for python3 and prevent possible regressions. Adding this should do no harm at all, once the file has been checked.



---

archive/issue_comments_346991.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI didn't see the point to it. It is not necessary for `from six import ...` since we're not in the `sage.misc` directory. So why add extra lines that are not needed? But I don't care that much.",
    "created_at": "2017-06-07T14:46:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346991",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

I didn't see the point to it. It is not necessary for `from six import ...` since we're not in the `sage.misc` directory. So why add extra lines that are not needed? But I don't care that much.



---

archive/issue_comments_346992.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nYou are right. So maybe we should rather move on to work on something else, no ?",
    "created_at": "2017-06-07T14:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346992",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

You are right. So maybe we should rather move on to work on something else, no ?



---

archive/issue_comments_346993.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSo ? positive review ?",
    "created_at": "2017-06-08T19:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346993",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

So ? positive review ?



---

archive/issue_events_319833.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-06-08T20:23:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319833"
}
```



---

archive/issue_events_319834.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2017-06-08T20:23:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319834"
}
```



---

archive/issue_comments_346994.json:
```json
{
    "body": "Changed branch from **[u/chapoton/23147](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23147)** to **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**",
    "created_at": "2017-06-11T09:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346994",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/23147](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/23147)** to **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)**



---

archive/issue_events_319835.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-11T09:13:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319835"
}
```



---

archive/issue_events_319836.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c32cc6e52e46500e8499d6a11811f45d248b4b78",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-06-11T09:13:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/23147#event-319836"
}
```



---

archive/issue_comments_346995.json:
```json
{
    "body": "Changed commit from **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)** to none",
    "created_at": "2017-09-05T14:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346995",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`d3f012d`](https://github.com/sagemath/sagetrac-mirror/commit/d3f012d5001ffd879e08cfb5a382f6587d672f1e)** to none



---

archive/issue_comments_346996.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis part doesn't make a lot of sense to me:\n\n```diff\n@@ -1635,7 +1636,7 @@ def _sage_getdoc_unformatted(obj):\n     # not a 'getset_descriptor' or similar.\n     if not isinstance(r, string_types):\n         return ''\n-    elif isinstance(r, unicode):\n+    elif isinstance(r, text_type):  # unicode (py2) = str (py3)\n         return r.encode('utf-8', 'ignore')\n     else:\n         return r\n```\n\nnot your patch specifically--replacing `unicode` with `text_type` makes sense.  But the `r.encode` that was there in the first place isn't right.  It actually causes a crash for me at startup, because the return value from this function is later consumed by code that's expected text, not bytes.  In other words, this code might have made slight sense from a Python 2 perspective, but for Python 3 it only makes sense here to leave `str` as `str`.",
    "created_at": "2017-09-05T14:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346996",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

This part doesn't make a lot of sense to me:

```diff
@@ -1635,7 +1636,7 @@ def _sage_getdoc_unformatted(obj):
     # not a 'getset_descriptor' or similar.
     if not isinstance(r, string_types):
         return ''
-    elif isinstance(r, unicode):
+    elif isinstance(r, text_type):  # unicode (py2) = str (py3)
         return r.encode('utf-8', 'ignore')
     else:
         return r
```

not your patch specifically--replacing `unicode` with `text_type` makes sense.  But the `r.encode` that was there in the first place isn't right.  It actually causes a crash for me at startup, because the return value from this function is later consumed by code that's expected text, not bytes.  In other words, this code might have made slight sense from a Python 2 perspective, but for Python 3 it only makes sense here to leave `str` as `str`.



---

archive/issue_comments_346997.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nindeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)",
    "created_at": "2017-09-05T14:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346997",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)



---

archive/issue_comments_346998.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@fchapoton](#comment%3A11):\n> indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)\n\nRight. I see now that you did this in your branch.",
    "created_at": "2017-09-05T15:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/23147",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/23147#issuecomment-346998",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@fchapoton](#comment%3A11):
> indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)

Right. I see now that you did this in your branch.
