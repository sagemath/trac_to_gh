# Issue 23882: really return fast iterator for subwords

archive/issues_023645.json:
```json
{
    "body": "new:\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit [x for x in S.__iter__()]\n10 loops, best of 3: 85.1 ms per loop\n```\nold:\n\n```\nsage: %timeit [x for x in S.__iter__()]\n1 loop, best of 3: 320 ms per loop\n\nsage: A = [x for x in S.__iter_new__()]\nsage: B = [x for x in S.__iter__()]\nsage: A == B\nTrue\n```\nThe reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.\n\nCC:  @videlec\n\nBranch/Commit: e9ce136ca7810be46edf7f90b5ff598f91214bf3\n\nReviewer: Simon King, Jeroen Demeyer\n\nAuthor: Martin Rubey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/23882\n\n",
    "closed_at": "2017-09-20T22:26:02Z",
    "created_at": "2017-09-18T13:09:39Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "really return fast iterator for subwords",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23882",
    "user": "https://github.com/mantepse"
}
```
new:

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit [x for x in S.__iter__()]
10 loops, best of 3: 85.1 ms per loop
```
old:

```
sage: %timeit [x for x in S.__iter__()]
1 loop, best of 3: 320 ms per loop

sage: A = [x for x in S.__iter_new__()]
sage: B = [x for x in S.__iter__()]
sage: A == B
True
```
The reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.

CC:  @videlec

Branch/Commit: e9ce136ca7810be46edf7f90b5ff598f91214bf3

Reviewer: Simon King, Jeroen Demeyer

Author: Martin Rubey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/23882





---

archive/issue_comments_450841.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mantepse/really_return_fast_iterator_for_subwords\"",
    "created_at": "2017-09-18T13:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450841",
    "user": "https://github.com/mantepse"
}
```

Changing branch from "" to "u/mantepse/really_return_fast_iterator_for_subwords"



---

archive/issue_comments_450842.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450842",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450843.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450843",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_450844.json:
```json
{
    "body": "Changing commit from \"\" to \"e9ce136ca7810be46edf7f90b5ff598f91214bf3\"",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450844",
    "user": "https://github.com/mantepse"
}
```

Changing commit from "" to "e9ce136ca7810be46edf7f90b5ff598f91214bf3"



---

archive/issue_comments_450845.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450845",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_450846.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Rubey\"",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450846",
    "user": "https://github.com/mantepse"
}
```

Changing author from "" to "Martin Rubey"



---

archive/issue_comments_450847.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n+```\n+sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\n+sage: %timeit [x for x in S.__iter_new__()]\n+10 loops, best of 3: 85.1 ms per loop\n+sage: %timeit [x for x in S.__iter__()]\n+1 loop, best of 3: 320 ms per loop\n \n+sage: A = [x for x in S.__iter_new__()]\n+sage: B = [x for x in S.__iter__()]\n+sage: A == B\n+True\n+```\n``````\n",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450847",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
+```
+sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
+sage: %timeit [x for x in S.__iter_new__()]
+10 loops, best of 3: 85.1 ms per loop
+sage: %timeit [x for x in S.__iter__()]
+1 loop, best of 3: 320 ms per loop
 
+sage: A = [x for x in S.__iter_new__()]
+sage: B = [x for x in S.__iter__()]
+sage: A == B
+True
+```
``````




---

archive/issue_comments_450848.json:
```json
{
    "body": "<a id='comment:3'></a>doctest? You can check the output of `S.__iter__()` which should be different.",
    "created_at": "2017-09-18T13:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450848",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>doctest? You can check the output of `S.__iter__()` which should be different.



---

archive/issue_comments_450849.json:
```json
{
    "body": "<a id='comment:4'></a>The ticket description is misleading: You are not introducing a new method `__iter_new__`, but you change the existing `__iter__` method to make it faster, and test the old versus the new version.\n\nIn particular, Vincent, there should be no new doctest, as the result of iteration should remain the same (as will be tested in all existing doctests that do `for x in S`).",
    "created_at": "2017-09-18T13:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450849",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>The ticket description is misleading: You are not introducing a new method `__iter_new__`, but you change the existing `__iter__` method to make it faster, and test the old versus the new version.

In particular, Vincent, there should be no new doctest, as the result of iteration should remain the same (as will be tested in all existing doctests that do `for x in S`).



---

archive/issue_comments_450850.json:
```json
{
    "body": "<a id='comment:5'></a>Do we really want to doctest an implementation detail?  I guess the right thing to do would be to have a test that takes forever with the old implementation and is fast with the new one...",
    "created_at": "2017-09-18T13:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450850",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>Do we really want to doctest an implementation detail?  I guess the right thing to do would be to have a test that takes forever with the old implementation and is fast with the new one...



---

archive/issue_comments_450851.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,13 @@\n+new:\n+\n ```\n sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\n-sage: %timeit [x for x in S.__iter_new__()]\n+sage: %timeit [x for x in S.__iter__()]\n 10 loops, best of 3: 85.1 ms per loop\n+```\n+old:\n+\n+```\n sage: %timeit [x for x in S.__iter__()]\n 1 loop, best of 3: 320 ms per loop\n \n@@ -10,3 +16,4 @@\n sage: A == B\n True\n ```\n+The reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.\n``````\n",
    "created_at": "2017-09-18T13:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450851",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,13 @@
+new:
+
 ```
 sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
-sage: %timeit [x for x in S.__iter_new__()]
+sage: %timeit [x for x in S.__iter__()]
 10 loops, best of 3: 85.1 ms per loop
+```
+old:
+
+```
 sage: %timeit [x for x in S.__iter__()]
 1 loop, best of 3: 320 ms per loop
 
@@ -10,3 +16,4 @@
 sage: A == B
 True
 ```
+The reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.
``````




---

archive/issue_comments_450852.json:
```json
{
    "body": "<a id='comment:7'></a>One shouldn't use private/magic double underscore methods directly in the tests. Examples shouldn't too much depend on implementation details, but tests may depend on implementation. Anyway, I think one doesn't need to change the existing tests here.\n\nTo make the speed comparison clearer: Old version is (on my laptop)\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit L = list(S)\n10 loops, best of 3: 33.8 ms per loop\n```\nNew version is\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit L = list(S)\n100 loops, best of 3: 9.42 ms per loop\n```\n\nThe change looks good to me, provided that the doctests all pass.",
    "created_at": "2017-09-18T13:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450852",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>One shouldn't use private/magic double underscore methods directly in the tests. Examples shouldn't too much depend on implementation details, but tests may depend on implementation. Anyway, I think one doesn't need to change the existing tests here.

To make the speed comparison clearer: Old version is (on my laptop)

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
10 loops, best of 3: 33.8 ms per loop
```
New version is

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
100 loops, best of 3: 9.42 ms per loop
```

The change looks good to me, provided that the doctests all pass.



---

archive/issue_comments_450853.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Simon King, Jeroen Demeyer\"",
    "created_at": "2017-09-19T09:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450853",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Simon King, Jeroen Demeyer"



---

archive/issue_comments_450854.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-19T09:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450854",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_060830.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-20T22:26:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23882#event-60830"
}
```



---

archive/issue_comments_450855.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450855",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_450856.json:
```json
{
    "body": "Changing branch from \"u/mantepse/really_return_fast_iterator_for_subwords\" to \"e9ce136ca7810be46edf7f90b5ff598f91214bf3\"",
    "created_at": "2017-09-20T22:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23882#issuecomment-450856",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mantepse/really_return_fast_iterator_for_subwords" to "e9ce136ca7810be46edf7f90b5ff598f91214bf3"
