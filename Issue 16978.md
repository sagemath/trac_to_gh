# Issue 16978: Normal vector to a polyhedron at a point...

Issue created by migration from https://trac.sagemath.org/ticket/17215

Original creator: darij

Original creation time: 2014-10-24 16:21:48

CC:  @laisrast @kliem chapoton nailuj

Keywords: polytopes, linear programming, linear optimization

... assuming that the point is a vertex or a point on a bounding line/ray. Is there a simple way to get it in Sage? Otherwise, this should be added.


---

Comment by vbraun created at 2014-10-25 11:37:11

All backends right now compute both H/V-representation; the dual is of course a much more complete certificate that a vertex is really a vertex. Also, the bounding hyperplane is not canonical---which one to pick? If you really need one you can construct one from the incident hyperplane equations of the vertex (or, more generally, d-dimensional face). 

```
sage: P = polytopes.n_cube(3)
sage: v = P.vertices()[0]
sage: v
A vertex at (-1, -1, -1)
sage: A = sum(h.A() for h in v.incident())
sage: b = sum(h.b() for h in v.incident())
sage: b, A
(3, (1, 1, 1))
sage: Polyhedron(eqns=[[b] + list(A)]) & P
A 0-dimensional polyhedron in QQ^3 defined as the convex hull of 1 vertex
```



---

Comment by darij created at 2014-10-26 14:52:01

Thanks, this makes it a lot easier.


---

Comment by moritz created at 2017-08-23 17:46:43

Should this remain open?


---

Comment by moritz created at 2017-08-23 17:46:43

Changing status from new to needs_info.


---

Comment by jipilab created at 2017-08-23 20:18:02

Not sure... perhaps there could be a method in the class for `polyhedron_faces` giving the corresponding normal cone?


---

Comment by @kliem created at 2019-06-15 12:56:26

To my understanding such a method for each face of a Polyhedron would also help #27973, such that one could construct a wedge over a face (not just a facet).


---

Comment by jipilab created at 2019-07-23 07:44:02

Changing status from needs_info to needs_work.


---

Comment by jipilab created at 2019-07-23 07:44:02

Changing keywords from "polytopes, linear programming, linear optimization" to "polytopes, linear programming, linear optimization, days100".


---

Comment by jipilab created at 2019-07-23 07:44:02

Changing component from combinatorics to geometry.


---

Comment by jipilab created at 2019-07-23 08:34:42

New commits:


---

Comment by jipilab created at 2019-07-24 12:34:59

Changing type from task to enhancement.


---

Comment by @kliem created at 2019-07-24 14:41:09

If you construct the polyhedron with via `the_poly.parent()` similar to e.g. many examples in #27926 you can avoid the import of the constructor.

Don't know if that's better.


---

Comment by jipilab created at 2019-07-24 15:41:15

Replying to [comment:13 gh-kliem]:
> If you construct the polyhedron with via `the_poly.parent()` similar to e.g. many examples in #27926 you can avoid the import of the constructor.
> 
> Don't know if that's better.

Yes, might be cleaner yes...


---

Comment by git created at 2019-07-28 12:23:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-07-28 12:25:18

Now, only waiting for the wedge to get merged. After that, I would change some constructions to make use of this new function to deduplicate some code...


---

Comment by jipilab created at 2019-10-25 09:57:47

I decided to leave the wedge and face truncation construction as they are since they do not need an explicit polyhedron.
----
New commits:


---

Comment by jipilab created at 2019-10-25 09:57:47

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-10-28 08:00:47

You did not consider the case, where the polyhedron has equations.

In this case your considering one of two possible rays. Probably should only append rays for inequalities, but I'm not sure.

One question: How do we construct the hyperplane that interesects exactly the face from this (see description of ticket).


---

Comment by @kliem created at 2019-10-28 08:00:47

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2019-11-19 05:37:35

#28646 changes the order of faces, which affects a doctest in this ticket.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by jipilab created at 2020-01-31 10:30:06

New commits:


---

Comment by jipilab created at 2020-01-31 10:30:06

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-01-31 10:30:20

Rebased due to conflict. Needs review.


---

Comment by @LaisRast created at 2020-01-31 10:59:31

You put the method under the function `combinatorial_face_to_polyhedral_face`.
You need to change its location. Otherwise it is not accessible.


---

Comment by @LaisRast created at 2020-01-31 10:59:31

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-01-31 11:05:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-01-31 11:05:37

Changing status from needs_work to needs_review.


---

Comment by @LaisRast created at 2020-01-31 12:04:18

I changed it to "needs_work" because it still does not work for non-full-dimensional polytopes.

On a (very) related topic, the method `normal_fan` of Polyhedron returns

```
ValueError: the normal fan is only defined for full-dimensional polytopes
```

for non-full-dimensional polytopes. It should return "not implemented" since `normal_fan` is defined for non-full-dimensional polytopes.


---

Comment by @LaisRast created at 2020-01-31 12:04:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-02-04 12:56:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-02-04 12:56:50

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2020-02-04 12:57:59

Replying to [comment:26 gh-LaisRast]:
> I changed it to "needs_work" because it still does not work for non-full-dimensional polytopes.
> 
> On a (very) related topic, the method `normal_fan` of Polyhedron returns
> {{{
> ValueError: the normal fan is only defined for full-dimensional polytopes
> }}}
> for non-full-dimensional polytopes. It should return "not implemented" since `normal_fan` is defined for non-full-dimensional polytopes.

This should be addressed in a different ticket...


---

Comment by @kliem created at 2020-02-05 10:00:30

Reading carefully your doctests, one sees a bug, which will be fixed in #29155.

Instead of using `faces` for iteration you can use the new method `face_generator`.


---

Comment by jipilab created at 2020-02-06 12:44:09

Replying to [comment:30 gh-kliem]:
> Reading carefully your doctests, one sees a bug, which will be fixed in #29155.

Aa ha!! I see I was also somehow confused by that, but did not think more about it.

> 
> Instead of using `faces` for iteration you can use the new method `face_generator`.

Good suggestion.


---

Comment by git created at 2020-02-07 09:47:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-02-07 10:19:05

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-02-07 10:19:05

I think the following is more direct:


```diff
-        origin = parent.zero().vertices()[0].vector()
+        origin = self.ambient_space().zero()
```


Otherwise you can put it positive review on my behalf. Maybe wait for bots yet.


---

Comment by git created at 2020-02-07 10:20:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-02-07 10:21:57

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-02-07 15:30:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-02-07 15:31:15

There was an error... `ambient_space` doesn't exist for faces... So I fixed it.


---

Comment by @kliem created at 2020-02-07 20:25:40

LGTM. Note that #28880 fixes the pyflakes warning.


---

Comment by @kliem created at 2020-02-07 20:25:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-17 23:16:17

Resolution: fixed
