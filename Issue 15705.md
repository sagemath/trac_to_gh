# Issue 15705: fix md5 in sage-spkg

archive/issues_015705.json:
```json
{
    "body": "\n```\nactual=`md5 $file | sed 's/[^0-9a-f].*//'`\n```\n\nmakes no sense, because that's not what's returned (at least on Macs).\n\n```\nmd5 -q\n```\n\nactually does work, though I don't know how portable this is.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15942\n\n",
    "created_at": "2014-03-14T16:28:02Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "fix md5 in sage-spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15705",
    "user": "kcrisman"
}
```

```
actual=`md5 $file | sed 's/[^0-9a-f].*//'`
```

makes no sense, because that's not what's returned (at least on Macs).

```
md5 -q
```

actually does work, though I don't know how portable this is.

Issue created by migration from https://trac.sagemath.org/ticket/15942





---

archive/issue_comments_203320.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-03-17T17:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203320",
    "user": "kcrisman"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_203321.json:
```json
{
    "body": "I'm putting this as blocker, since any system with only md5 and not the other options for checksums simply will refuse to build, and presumably some systems are that barebones.  (Not just old ones?)",
    "created_at": "2014-03-17T17:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203321",
    "user": "kcrisman"
}
```

I'm putting this as blocker, since any system with only md5 and not the other options for checksums simply will refuse to build, and presumably some systems are that barebones.  (Not just old ones?)



---

archive/issue_comments_203322.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-03-17T21:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203322",
    "user": "vbraun"
}
```

New commits:



---

archive/issue_comments_203323.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-17T21:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203323",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_203324.json:
```json
{
    "body": "I can't guarantee this will work on other systems with possibly different `md5` implementation, but at any rate the sed doesn't mess things up, as makes sense.  For reference, with `-q`, `md5` on Mac outputs\n\n```\n$ md5 Downloads/974230_10103787412222420_571824162_n.jpg\nMD5 (Downloads/974230_10103787412222420_571824162_n.jpg) = bf36ca4308ce426d74d095681ebd5a18\nmd5 -q Downloads/974230_10103787412222420_571824162_n.jpg  | sed 's/[^0-9a-f].*//'\nbf36ca4308ce426d74d095681ebd5a18\n```\n\nSo fine with me, but maybe someone else should be asked as well who knows about such things?",
    "created_at": "2014-03-18T01:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203324",
    "user": "kcrisman"
}
```

I can't guarantee this will work on other systems with possibly different `md5` implementation, but at any rate the sed doesn't mess things up, as makes sense.  For reference, with `-q`, `md5` on Mac outputs

```
$ md5 Downloads/974230_10103787412222420_571824162_n.jpg
MD5 (Downloads/974230_10103787412222420_571824162_n.jpg) = bf36ca4308ce426d74d095681ebd5a18
md5 -q Downloads/974230_10103787412222420_571824162_n.jpg  | sed 's/[^0-9a-f].*//'
bf36ca4308ce426d74d095681ebd5a18
```

So fine with me, but maybe someone else should be asked as well who knows about such things?



---

archive/issue_comments_203325.json:
```json
{
    "body": "`md5` is not posix so whats your question? IMHO we can only try it out and see if its better. The real solution is to not try a handful different non-posix utilities. Instead use Python and the standard md5 Python module.",
    "created_at": "2014-03-18T17:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203325",
    "user": "vbraun"
}
```

`md5` is not posix so whats your question? IMHO we can only try it out and see if its better. The real solution is to not try a handful different non-posix utilities. Instead use Python and the standard md5 Python module.



---

archive/issue_comments_203326.json:
```json
{
    "body": "Why do we use different invocations of `md5` in `sage-spkg` vs. `sage-fix-pkg-checksums`? We could instead change `sage-spkg` to use\n\n```\nactual=`md5 $file | sed 's/.*= *//'`\n```\n\nThis works for me after I disable `shasum` and `md5sum` on my Mac. (I suppose I have the same questions about invoking `shasum` and `md5sum` in the two scripts, but since `md5` is the one causing the problems, that's obviously the most relevant.)",
    "created_at": "2014-03-18T18:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203326",
    "user": "jhpalmieri"
}
```

Why do we use different invocations of `md5` in `sage-spkg` vs. `sage-fix-pkg-checksums`? We could instead change `sage-spkg` to use

```
actual=`md5 $file | sed 's/.*= *//'`
```

This works for me after I disable `shasum` and `md5sum` on my Mac. (I suppose I have the same questions about invoking `shasum` and `md5sum` in the two scripts, but since `md5` is the one causing the problems, that's obviously the most relevant.)



---

archive/issue_comments_203327.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-18T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203327",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_203328.json:
```json
{
    "body": "I don't really care, we should just pick one bandaid until we replace the whole cruft with a python script",
    "created_at": "2014-03-18T18:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203328",
    "user": "vbraun"
}
```

I don't really care, we should just pick one bandaid until we replace the whole cruft with a python script



---

archive/issue_comments_203329.json:
```json
{
    "body": "I can't test this \"live\" right now but it looks like a right syntax as well to solve the problem.",
    "created_at": "2014-03-18T20:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203329",
    "user": "kcrisman"
}
```

I can't test this "live" right now but it looks like a right syntax as well to solve the problem.



---

archive/issue_comments_203330.json:
```json
{
    "body": "Testing \"live\" ... works, as expected.  I like the alternate fix better, so let's go with that.",
    "created_at": "2014-03-25T20:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203330",
    "user": "kcrisman"
}
```

Testing "live" ... works, as expected.  I like the alternate fix better, so let's go with that.



---

archive/issue_comments_203331.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-25T20:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203331",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_203332.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-31T15:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15705#issuecomment-203332",
    "user": "vbraun"
}
```

Resolution: fixed
