# Issue 15705: fix md5 in sage-spkg

Issue created by migration from https://trac.sagemath.org/ticket/15942

Original creator: kcrisman

Original creation time: 2014-03-14 16:28:02


```
actual=`md5 $file | sed 's/[^0-9a-f].*//'`
```

makes no sense, because that's not what's returned (at least on Macs).

```
md5 -q
```

actually does work, though I don't know how portable this is.


---

Comment by kcrisman created at 2014-03-17 17:36:21

Changing priority from major to blocker.


---

Comment by kcrisman created at 2014-03-17 17:36:21

I'm putting this as blocker, since any system with only md5 and not the other options for checksums simply will refuse to build, and presumably some systems are that barebones.  (Not just old ones?)


---

Comment by vbraun created at 2014-03-17 21:40:03

New commits:


---

Comment by vbraun created at 2014-03-17 21:40:03

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-03-18 01:26:07

I can't guarantee this will work on other systems with possibly different `md5` implementation, but at any rate the sed doesn't mess things up, as makes sense.  For reference, with `-q`, `md5` on Mac outputs

```
$ md5 Downloads/974230_10103787412222420_571824162_n.jpg
MD5 (Downloads/974230_10103787412222420_571824162_n.jpg) = bf36ca4308ce426d74d095681ebd5a18
md5 -q Downloads/974230_10103787412222420_571824162_n.jpg  | sed 's/[^0-9a-f].*//'
bf36ca4308ce426d74d095681ebd5a18
```

So fine with me, but maybe someone else should be asked as well who knows about such things?


---

Comment by vbraun created at 2014-03-18 17:33:05

`md5` is not posix so whats your question? IMHO we can only try it out and see if its better. The real solution is to not try a handful different non-posix utilities. Instead use Python and the standard md5 Python module.


---

Comment by jhpalmieri created at 2014-03-18 18:05:31

Why do we use different invocations of `md5` in `sage-spkg` vs. `sage-fix-pkg-checksums`? We could instead change `sage-spkg` to use

```
actual=`md5 $file | sed 's/.*= *//'`
```

This works for me after I disable `shasum` and `md5sum` on my Mac. (I suppose I have the same questions about invoking `shasum` and `md5sum` in the two scripts, but since `md5` is the one causing the problems, that's obviously the most relevant.)


---

Comment by git created at 2014-03-18 18:15:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-03-18 18:15:56

I don't really care, we should just pick one bandaid until we replace the whole cruft with a python script


---

Comment by kcrisman created at 2014-03-18 20:58:42

I can't test this "live" right now but it looks like a right syntax as well to solve the problem.


---

Comment by kcrisman created at 2014-03-25 20:42:51

Testing "live" ... works, as expected.  I like the alternate fix better, so let's go with that.


---

Comment by kcrisman created at 2014-03-25 20:42:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-31 15:01:13

Resolution: fixed
