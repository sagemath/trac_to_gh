# Issue 31916: Refactor _repr_ of some Terms

Issue created by migration from https://trac.sagemath.org/ticket/32153

Original creator: @thhagelmayer

Original creation time: 2021-07-07 15:31:34

CC:  cheuberg behackl dkrenn

Keywords: gsoc21, asymptotics

Refactor ExactTerm._repr_ and TermWithCoefficient._repr_


---

Comment by @thhagelmayer created at 2021-07-07 16:46:50

Changing status from new to needs_review.


---

Comment by @thhagelmayer created at 2021-07-07 16:46:50

This has now the refactored `TermWithCoefficient._product_repr_`.

I get two doctest failures. Something to do with `<BLANKLINE>`.



```
File "src/sage/rings/asymptotic/term_monoid.py", line 1119, in sage.rings.asymptotic.term_monoid.GenericTerm.is_little_o_of_one
```



```
File "src/sage/rings/asymptotic/term_monoid.py", line 3015, in sage.rings.asymptotic.term_monoid.TermWithCoefficient._calculate_pow_
```


----
New commits:


---

Comment by behackl created at 2021-07-07 17:10:24

I'll investigate the doctest failures later. The refactor looks good to me in general!

I have a slight preference for keeping the old `TermWithCoefficient._repr_`.


---

Comment by behackl created at 2021-07-08 14:05:02

Changing status from needs_review to needs_work.


---

Comment by behackl created at 2021-07-08 14:05:02

The failing doctests are caused by two representation strings that have not been adapted yet: 


```diff
--- a/src/sage/rings/asymptotic/term_monoid.py
+++ b/src/sage/rings/asymptotic/term_monoid.py
@@ -1119,7 +1119,7 @@ class GenericTerm(MultiplicativeGroupElement):
             sage: T.an_element().is_little_o_of_one()
             Traceback (most recent call last):
             ...
-            NotImplementedError: Cannot check whether Term with coefficient 1/2 and growth x
+            NotImplementedError: Cannot check whether Term with coefficient 1/2*x
             is o(1) in the abstract base class
             Generic Term Monoid x^ZZ with (implicit) coefficients in Rational Field.
         """
@@ -3015,8 +3015,8 @@ class TermWithCoefficient(GenericTerm):
             sage: T(G.an_element(), coefficient=CIF(RIF(-1,1), RIF(-1,1)))._calculate_pow_(I)
             Traceback (most recent call last):
             ...
-            ArithmeticError: Cannot take Term with coefficient 0.? + 0.?*I and
-            growth z to the exponent I in Generic Term Monoid z^ZZ with
+            ArithmeticError: Cannot take Term with coefficient (0.? + 0.?*I)*z
+            to the exponent I in Generic Term Monoid z^ZZ with
             (implicit) coefficients in Complex Interval Field with
             53 bits of precision since its coefficient 0.? + 0.?*I
```


I also want to briefly clarify: semantically, I do think that "Term with coefficient C and growth G" is easier to read than "Term with coefficient C*G", but at the same time these generic terms are not really user-facing. I'll leave it up to you which version you choose; the important thing is that the code for formatting the coefficient-growth product is now easily accessible via `_product_repr_`.


---

Comment by git created at 2021-07-08 18:15:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @thhagelmayer created at 2021-07-08 18:17:40

I reverted back the changes to `TermWithCoefficient._repr_`, because I think it is more descriptive. For eg:


```
Term with coefficient 1 and growth x
```


vs.


```
Term with coefficient x
```



---

Comment by @thhagelmayer created at 2021-07-08 18:17:40

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2021-07-09 08:39:32

I guess, we should use `_repr_product_` instead of `_product_repr_` because

```
dakrenn@nops:~$ sage -grep " _[a-zA-Z].*_repr_*(" | wc -l
50
dakrenn@nops:~$ sage -grep " _repr_[a-zA-Z].*(" | wc -l
338
```



---

Comment by dkrenn created at 2021-07-09 08:40:27


```
+        return self._product_repr_(latex)
```

I think we should simply pass on all (keyword) arguments, i.e.

```
+        return self._product_repr_(**kwds)
```



---

Comment by dkrenn created at 2021-07-09 08:41:26

Apart from the above, code LGTM.


---

Comment by dkrenn created at 2021-07-09 08:41:26

Changing status from needs_review to needs_work.


---

Comment by behackl created at 2021-07-09 08:43:28

Great! If you have a look at [what the patchbot reports](https://patchbot.sagemath.org/ticket/32153/), you can see that it complains about the coverage going down.

Please add a docstring and a simple doctest for `TermWithCoefficient._product_repr_`.


---

Comment by behackl created at 2021-07-09 08:47:58

Replying to [comment:8 dkrenn]:
> {{{
> +        return self._product_repr_(latex)
> }}}
> I think we should simply pass on all (keyword) arguments, i.e.
> {{{
> +        return self._product_repr_(**kwds)
> }}}

But that would mean that the header of `_repr_` needs to be something like `def _repr_(self, **kwds)` instead of the more explicit `def _repr_(self, latex=...)`. I don't think that is an actual improvement, can you elaborate?


---

Comment by dkrenn created at 2021-07-09 12:18:56

Replying to [comment:11 behackl]:
> Replying to [comment:8 dkrenn]:
> > {{{
> > +        return self._product_repr_(latex)
> > }}}
> > I think we should simply pass on all (keyword) arguments, i.e.
> > {{{
> > +        return self._product_repr_(**kwds)
> > }}}
> 
> But that would mean that the header of `_repr_` needs to be something like `def _repr_(self, **kwds)` instead of the more explicit `def _repr_(self, latex=...)`. I don't think that is an actual improvement, can you elaborate?

Ideally, I would like to do

```
sage: class A(object):
....:     def sun(self):
....:         pass
....: class B(A):
....:     rain = sun
```

but this raises

```
NameError: name 'sun' is not defined
```

so I thought the next best thing is to pass on all arguments by `**kwds`. However, I agree that explicit might be better in this case, so keeping the method-definition and using

```
    return self._product_repr_(latex=latex)
```

seems to be a good compromise.


---

Comment by behackl created at 2021-07-09 12:25:14

Replying to [comment:12 dkrenn]:
>
> [...], so keeping the method-definition and using
> {{{
>     return self._product_repr_(latex=latex)
> }}}
> seems to be a good compromise.

+1, passing the keyword argument `latex` explicitly is a good idea. I'm also happy with this. This means that there are three minor things to do here:

1. Rename `_product_repr_` to `_repr_product_`,
2. Add a short docstring with a doctest (you can use the same doctest as for `TermWithCoefficient._repr_`),
3. Change the call to the product representation in `ExactTerm._repr_` to `self._product_repr_(latex=latex)`.


---

Comment by git created at 2021-07-11 07:47:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @thhagelmayer created at 2021-07-11 07:51:31

1. Rename `_product_repr_` to `_repr_product_`,
2. Add a short docstring with a doctest (you can use the same doctest as for `TermWithCoefficient._repr_`),
3. Change the call to the product representation in `ExactTerm._repr_` to `self._product_repr_(latex=latex)`. 

I addressed the above three items in the latest commits.


---

Comment by @thhagelmayer created at 2021-07-11 07:51:31

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2021-07-11 17:34:41

Replying to [comment:15 gh-thhagelmayer]:
> 1. Rename `_product_repr_` to `_repr_product_`,
> 2. Add a short docstring with a doctest (you can use the same doctest as for `TermWithCoefficient._repr_`),
> 3. Change the call to the product representation in `ExactTerm._repr_` to `self._product_repr_(latex=latex)`. 
> 
> I addressed the above three items in the latest commits.

Thank you very much. Fixed one missing full stop. LGTM
----
New commits:


---

Comment by dkrenn created at 2021-07-11 17:34:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-24 15:28:11

Resolution: fixed


---

Comment by tscrim created at 2021-08-12 00:49:35

Changing keywords from "gsoc21, asymptotics" to "gsoc2021, asymptotics".
