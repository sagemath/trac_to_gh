# Issue 14687: Counting points on a toric variety over a finite field

Issue created by migration from https://trac.sagemath.org/ticket/14891

Original creator: asalerno

Original creation time: 2013-07-15 01:21:20

Assignee: mhampton

Keywords: toric varieties

This function uses a formula by Fulton to count points on toric varieties over finite fields.


---

Attachment


---

Comment by asalerno created at 2013-07-15 01:22:12

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-07-15 04:00:38

Thanks, looks solid. I have a few implementation suggestions to harmonize it with the way points are counted on elliptic curves. There, you'd write

```
sage: E = EllipticCurve([3,2])
sage: E.change_ring(GF(11)).count_points()
13
```

The Python convention is to use underscore as method names (like `count_points`)
and CamelCase for class names. 

* Use the current `base_ring()` to get the field over which to count points 
* Maybe take an optional integer argument `n` for finite fields with `p^n` elements, see the elliptic curve `count_points()` method.
* If the base ring is not finite, then raise a `TypeError`
* If the toric variety is not smooth, raise a `NotImplementedError` since one can presumably implement it later.

Also, the docstring should start with a short title like "Return the number of points" before any explanatory sentences. You can use dollar signs or backticks for math (like `$F_q$`), try building the documentation with `sage -docbuild all html`


---

Comment by novoselt created at 2013-07-15 05:40:39

Missed Volker's comment before writing a patch over which goes more or less along the same lines, but returns infinity for infinite rings. I don't think there is any need for extra parameters, `p^n` finite fields also can be specified as base ones and for varieties constructed from the same fan there will be no overhead.

Also, it is always a good idea to check how your documentation looks like after compiling: the original patch does not treat references and code blocks properly ;-)


---

Comment by novoselt created at 2013-07-15 05:49:43

Rewrote examples via `change_ring` which is certainly more pleasant than reconstructing varieties.


---

Comment by vbraun created at 2013-07-15 12:57:39

I would still be in favor of calling it `count_points` to match the elliptic curve code.


---

Attachment

OK, `count_points` now, although I think that `npoints` or something similar is more natural and there are plenty of methods that start with `n...` or `n_...` ;-)


---

Comment by malmskog created at 2013-07-15 21:53:26

Wow, thanks for doing all that.  Looks great.


---

Comment by novoselt created at 2013-07-15 22:14:54

Replying to [comment:7 malmskog]:
> Wow, thanks for doing all that.  Looks great.

Meaning you agree with changes and want to set it to "positive review"?

Please also take a look at what is changed and why (for why http://sagemath.org/doc/developer/conventions.html is a good reference together with links to PEP8 and PEP257). In addition to Volker's comments and the fact that documentation did not have correct syntax for compiling, there were too long lines (over 79 characters), inconsistent whitespacing, and creating variables for stuff that is used only once to get further stuff:

```
fan = self.fan() 
cones=fan.cones()
```

has no advantage over

```
cones = self.fan().cones()
```

but is longer, and if `cones` are used only once, even better to plug `self.fan().cones()` directly there. (I may have overdone it with folding into 2 lines only, but original 10 were a bit over verbose.)


---

Comment by malmskog created at 2013-07-15 22:53:51

We do agree with your changes and take your point on the formatting and programming best practices.  Of course we think it should have a positive review :).  Thanks for working on this.


---

Comment by novoselt created at 2013-07-15 23:07:21

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-08-02 15:28:19

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-08-02 15:28:19

This patch conflicts with #12900. One should be rebased on top of the other.


---

Comment by chapoton created at 2013-08-02 17:53:26

I have made the other ticket (#12900) depend on this one. Back to positive review for this one.


---

Comment by chapoton created at 2013-08-02 17:53:26

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-08-16 21:14:35

Resolution: fixed
