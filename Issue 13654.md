# Issue 13654: update M4RI to newest upstream release

Issue created by migration from Trac.

Original creator: malb

Original creation time: 2012-12-21 18:31:30

Assignee: tbd

A new version of M4RI is available which mainly improves performance.


---

Comment by leif created at 2012-12-21 19:47:19

So where's the spkg? ;-)


---

Comment by malb created at 2012-12-21 20:02:52

Working on it, I needed a ticket number for SPKG.txt


---

Comment by malb created at 2012-12-21 20:39:57

Changing status from new to needs_review.


---

Comment by malb created at 2012-12-21 20:39:57

Changing keywords from "" to "m4ri".


---

Comment by leif created at 2012-12-21 20:48:03

Ah, zu Weihnachten 'ne Zeitmaschine bekommen und gleich mal drei Tage zurÃ¼ckgereist.

Hat der Weltuntergang also nicht stattgefunden?


---

Comment by malb created at 2012-12-21 20:49:39

It only works for M4RI releases though.


---

Comment by leif created at 2013-02-22 16:12:17

We should probably add `-L{SAGE_LOCAL}/lib` to `LDFLAGS`, or set (`PNG_CFLAGS` and) `PNG_LIBS` [on Darwin [if `pkg-config` isn't installed or functional]]; cf. David Joyner's report for Sage 5.7.rc0 on sage-release.


---

Comment by leif created at 2013-02-22 16:16:53

Replying to [comment:6 leif]:
> cf. David Joyner's report for Sage 5.7.rc0 on sage-release.


```
I had less luck on 10.8.2 (2.66 GHz Intel Core 2 Duo):

...
Found package conway_polynomials-0.4 in
spkg/standard/conway_polynomials-0.4.spkg
conway_polynomials-0.4
====================================================
Extracting package
/Users/wdj/sagefiles/sage-5.7.rc0/spkg/standard/conway_polynomials-0.4.spkg
-rw-r--r--  1 wdj  staff  227035 Feb 16 06:30
/Users/wdj/sagefiles/sage-5.7.rc0/spkg/standard/conway_polynomials-0.4.spkg
Finished extraction
****************************************************
Host system:
Darwin jeeves.home 12.2.0 Darwin Kernel Version 12.2.0: Sat Aug 25
00:48:52 PDT 2012; root:xnu-2050.18.24~1/RELEASE_X86_64 x86_64
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Users/wdj/sagefiles/sage-5.7.rc0/local/libexec/gcc/x86_64-apple-darwin12.2.0/4.6.3/lto-wrapper
Target: x86_64-apple-darwin12.2.0
Configured with: ../src/configure
--prefix=/Users/wdj/sagefiles/sage-5.7.rc0/local
--with-local-prefix=/Users/wdj/sagefiles/sage-5.7.rc0/local
--with-gmp=/Users/wdj/sagefiles/sage-5.7.rc0/local
--with-mpfr=/Users/wdj/sagefiles/sage-5.7.rc0/local
--with-mpc=/Users/wdj/sagefiles/sage-5.7.rc0/local --with-system-zlib
--disable-multilib
Thread model: posix
gcc version 4.6.3 (GCC)
****************************************************
Traceback (most recent call last):
  File "./spkg-install", line 4, in <module>
    from sage.all import save
  File "/Users/wdj/sagefiles/sage-5.7.rc0/local/lib/python2.7/site-packages/sage/all.py",
line 70, in <module>
    from sage.matrix.all     import *
  File "/Users/wdj/sagefiles/sage-5.7.rc0/local/lib/python2.7/site-packages/sage/matrix/all.py",
line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/Users/wdj/sagefiles/sage-5.7.rc0/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py",
line 37, in <module>
    import matrix_modn_dense
  File "matrix_modn_dense_template_header.pxi", line 11, in init
sage.matrix.matrix_modn_dense (sage/matrix/matrix_modn_dense.c:13872)
  File "matrix_integer_dense.pxd", line 12, in init
sage.matrix.matrix_modn_dense_float
(sage/matrix/matrix_modn_dense_float.cpp:16875)
  File "matrix_mod2_dense.pxd", line 7, in init
sage.matrix.matrix_integer_dense
(sage/matrix/matrix_integer_dense.c:43160)
ImportError: dlopen(/Users/wdj/sagefiles/sage-5.7.rc0/local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.so,
2): Library not loaded: /usr/local/lib/libpng12.0.dylib
  Referenced from:
/Users/wdj/sagefiles/sage-5.7.rc0/local/lib/libm4ri-0.0.20120613.dylib
  Reason: Incompatible library version: libm4ri-0.0.20120613.dylib
requires version 40.0.0 or later, but libpng12.0.dylib provides
version 36.0.0

real	0m3.444s
user	0m0.470s
sys	0m0.368s
************************************************************************
Error installing package conway_polynomials-0.4
************************************************************************
...
```



---

Comment by leif created at 2013-02-22 18:43:33

Hmmm, doesn't look like libm4ri['s `spkg-install`] was the culprit though:

```
...
/bin/sh ./libtool --tag=CC   --mode=link gcc -std=gnu99 -mmmx -msse -msse2 -msse3   -I/Users/wdj/sagefiles/sage-5.7.rc0/local/include -g -fPIC -Wall -pedantic -O2 -release 0.0.20120613 -no-undefined  -o libm4ri.la -rpath /Users/wdj/sagefiles/sage-5.7.rc0/local/lib brilliantrussian.lo misc.lo mzd.lo graycode.lo strassen.lo mzp.lo triangular.lo triangular_russian.lo ple.lo ple_russian.lo solve.lo echelonform.lo mmc.lo debug_dump.lo io.lo -lpng12 
libtool: link: gcc -dynamiclib  -o .libs/libm4ri-0.0.20120613.dylib  .libs/brilliantrussian.o .libs/misc.o .libs/mzd.o .libs/graycode.o .libs/strassen.o .libs/mzp.o .libs/triangular.o .libs/triangular_russian.o .libs/ple.o .libs/ple_russian.o .libs/solve.o .libs/echelonform.o .libs/mmc.o .libs/debug_dump.o .libs/io.o   /Users/wdj/sagefiles/sage-5.7.rc0/local/lib/libpng12.dylib  -mmmx -msse -msse2 -msse3 -O2   -install_name  /Users/wdj/sagefiles/sage-5.7.rc0/local/lib/libm4ri-0.0.20120613.dylib  -Wl,-single_module
...
```



---

Comment by malb created at 2013-03-22 13:51:39

See http://trac.sagemath.org/sage_trac/ticket/14335 for a more recent version/ticket. This one here should be closed.


---

Comment by tscrim created at 2013-04-01 17:08:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-03 15:12:10

Resolution: duplicate
