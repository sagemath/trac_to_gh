# Issue 32477: WSL: Add how to handle strange permission error

Issue created by migration from https://trac.sagemath.org/ticket/32714

Original creator: @tobiasdiez

Original creation time: 2021-10-18 20:39:43

CC:  mkoeppe




---

Comment by @tobiasdiez created at 2021-10-18 20:39:49

Changing status from new to needs_review.


---

Comment by git created at 2021-10-18 20:39:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-10-18 20:47:47

It would be more idiomatic to use just `SAGE_BUILD_DIR="~/tmp/sage" make`, not `eval SAGE_BUILD_DIR="~/tmp/sage" make`


---

Comment by mkoeppe created at 2021-10-18 20:49:50

Is your Sage source tree somewhere in `/mnt/c`?


---

Comment by @tobiasdiez created at 2021-10-18 23:07:25

Replying to [comment:4 mkoeppe]:
> It would be more idiomatic to use just `SAGE_BUILD_DIR="~/tmp/sage" make`, not `eval SAGE_BUILD_DIR="~/tmp/sage" make`
> 

I think I tried this first and ended up with a `~` folder in the root sage project folder.


---

Comment by @tobiasdiez created at 2021-10-18 23:10:22

Replying to [comment:5 mkoeppe]:
> Is your Sage source tree somewhere in `/mnt/c`?

Yes, the source files are in the Windows file system (as I want to use git etc from Windows). I know it's not ideal and might switch to the linux file system in the future. But apart from this permission error everything is working.


---

Comment by mkoeppe created at 2021-10-19 04:20:05

Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.


---

Comment by git created at 2021-10-26 13:43:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-10-26 13:49:03

Replying to [comment:8 mkoeppe]:
> Perhaps then better advice to give to the user would be to use `configure --prefix=/SOME/LINUX/DIRECTORY`? That would solve the problem too and is easier to explain.

Good suggestion! I tried it and confirmed it worked as well. Changed the docs accordingly now.

sage-conf etc are still not working, since they seem to respect neither prefix nor build dir. But that's something for another ticket.


---

Comment by mkoeppe created at 2021-10-26 18:22:25

`--prefix` is not some kind of temporary directory. It is the installation prefix. See `README.md`


---

Comment by @tobiasdiez created at 2021-10-26 20:04:21

I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted? I'm not familiar with the linux conventions, what would be a good folder? `/var/tmp`?


---

Comment by mkoeppe created at 2021-10-26 20:30:19

Replying to [comment:12 gh-tobiasdiez]:
> I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted?

No. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.

Its subdirectory, `SAGE_LOCAL/var/tmp/sage/build` is used for temporary files during the build.

What I am saying is, we should give users on WSL the advice to create the installation hierarchy (`SAGE_LOCAL`) in a WSL directory, not a /mnt directory.
This should be general advice for from source installs in WSL; not troubleshooting advice ("how to fix a problem").


---

Comment by @tobiasdiez created at 2021-10-26 21:52:35

Replying to [comment:13 mkoeppe]:
> Replying to [comment:12 gh-tobiasdiez]:
> > I know, but aren't these build artifacts some kind of semi-temporary files that can "easily" be recreated in case they got deleted?
> 
> No. `--prefix` sets the `SAGE_LOCAL` directory. You can delete everything but this directory and have a working Sage.

I understood this, but thought I edited the "developer" guide where you would treat this as only as a semi-temporary build output and not as a valid installation that you try to keep. Will change that later.


---

Comment by mkoeppe created at 2021-10-27 00:16:46

Everything is sort of temporary, of course. But in a Unix context, `/tmp` is a directory that one can expect to be emptied at a reboot; and `/var/tmp` is a directory that will be emptied periodically, at the discretion of a system administrator or scripts. Neither of these two fits a typical use case of what a developers does with `--prefix`.


---

Comment by mkoeppe created at 2021-10-28 06:29:12

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-11-26 15:45:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-11-26 15:51:54

I've now added a recommendation to put the source files in the linux file system so that the error doesn't occur in the first place. However, WSL has a few limitations and performance problems if you try to access files across the Windows <> Linux bridge; thus in some cases you might still prefer to put the files under the windows file system. In this case the workaround is still necessary. 

Also I've changed the workaround back to use use `SAGE_BUILD_DIR` as setting the prefix slowed down the build process considerably and had other issues.


---

Comment by @tobiasdiez created at 2021-11-26 15:51:54

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-11-26 21:36:02

The rst markup doesn't look quite right, have you built the HTML doc?


---

Comment by git created at 2021-11-28 15:38:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-11-28 15:38:52

Sorry, still living to much in a markdown world. Should be fine now.


---

Comment by mkoeppe created at 2021-11-29 01:52:28

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2021-11-29 08:55:10

Thanks


---

Comment by vbraun created at 2021-12-19 11:47:38

Resolution: fixed
