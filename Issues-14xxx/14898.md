# Issue 14898: Poincaré-Birkhoff-Witt and dual bases

archive/issues_014694.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "Implements:\n- the Poincar\u00e9-Birkhoff-Witt basis of the free algebra and several related functions\n- the dual basis of the previous one in the shuffle algebra.\n\nAlso puts `FreeAlgebra` in the category of `AlgebrasWithBases`.\n\nApply: [attachment: trac_14898-pbw_folded-ts.patch](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)\n\nCC:  @darijgr\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Matthieu Deneufch\u00e2tel**\n\nMerged: **sage-5.13.beta0**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14898_\n\n",
    "closed_at": "2013-10-02T06:36:13Z",
    "created_at": "2013-07-16T10:28:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Poincar\u00e9-Birkhoff-Witt and dual bases",
    "type": "issue",
    "updated_at": "2013-10-02T06:36:13Z",
    "url": "https://github.com/sagemath/sage/issues/14898",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```
Implements:
- the Poincaré-Birkhoff-Witt basis of the free algebra and several related functions
- the dual basis of the previous one in the shuffle algebra.

Also puts `FreeAlgebra` in the category of `AlgebrasWithBases`.

Apply: [attachment: trac_14898-pbw_folded-ts.patch](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)

CC:  @darijgr

Reviewer: **Travis Scrimshaw**

Author: **Matthieu Deneufchâtel**

Merged: **sage-5.13.beta0**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/14898_





---

archive/issue_events_209944.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-07-16T10:28:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209944"
}
```



---

archive/issue_events_209945.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-07-16T10:28:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209945"
}
```



---

archive/issue_events_209946.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-07-16T10:28:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209946"
}
```



---

archive/issue_events_209947.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-07-16T10:28:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209947"
}
```



---

archive/issue_events_209948.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2013-07-16T10:28:07Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "subject": "https://github.com/sagetrac-deneufchatel",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209948"
}
```



---

archive/issue_comments_182759.json:
```json
{
    "body": "Attachment: **[trac_18484_PBW_basis.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_18484_PBW_basis.patch.gz)**",
    "created_at": "2013-07-16T10:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182759",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Attachment: **[trac_18484_PBW_basis.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_18484_PBW_basis.patch.gz)**



---

archive/issue_comments_182760.json:
```json
{
    "body": "Attachment: **[pbw.patch.gz](https://github.com/sagemath/sage/files/ticket14898/pbw.patch.gz)**",
    "created_at": "2013-07-22T11:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182760",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Attachment: **[pbw.patch.gz](https://github.com/sagemath/sage/files/ticket14898/pbw.patch.gz)**



---

archive/issue_comments_182761.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Implements the Poincar\u00e9-Birkhoff-Witt basis of the free algebra and several related functions.\n+Implements:\n+- the Poincar\u00e9-Birkhoff-Witt basis of the free algebra and several related functions\n+- the dual basis of the previous one in the shuffle algebra.\n``````\n",
    "created_at": "2013-07-27T14:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182761",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Implements the Poincaré-Birkhoff-Witt basis of the free algebra and several related functions.
+Implements:
+- the Poincaré-Birkhoff-Witt basis of the free algebra and several related functions
+- the dual basis of the previous one in the shuffle algebra.
``````




---

archive/issue_events_209949.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-07-27T14:48:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "title_is": "Poincar\u00e9-Birkhoff-Witt and dual bases",
    "title_was": "Poincar\u00e9-Birkhoff-Witt basis of the free algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209949"
}
```



---

archive/issue_comments_182762.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[14898.patch.gz](https://github.com/sagemath/sage/files/ticket14898/14898.patch.gz)**\n\nWhat exactly is the Poincar\u00e9-Birkhoff-Witt basis of a free algebra? Free algebras have exponential growth, and PBW bases have polynomial growth, so I don't see how a free algebra can have a PBW basis.\n\nI may very well be missing something, but I think you need to explain what this term means in this context, and probably provide a reference.",
    "created_at": "2013-07-27T15:36:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182762",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[14898.patch.gz](https://github.com/sagemath/sage/files/ticket14898/14898.patch.gz)**

What exactly is the Poincaré-Birkhoff-Witt basis of a free algebra? Free algebras have exponential growth, and PBW bases have polynomial growth, so I don't see how a free algebra can have a PBW basis.

I may very well be missing something, but I think you need to explain what this term means in this context, and probably provide a reference.



---

archive/issue_comments_182763.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe reference which I would cite is Reutenauer, Free Lie algebra.\nThe name I gave is probably confusing. Indeed, the basis is in fact the Poincar\u00e9-Birkhoff-Witt basis of the free Lie algebra whose enveloping algebra is the free algebra.\nIs it clearer?",
    "created_at": "2013-07-27T17:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182763",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:4" align="right">comment:4</div>

The reference which I would cite is Reutenauer, Free Lie algebra.
The name I gave is probably confusing. Indeed, the basis is in fact the Poincaré-Birkhoff-Witt basis of the free Lie algebra whose enveloping algebra is the free algebra.
Is it clearer?



---

archive/issue_comments_182764.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nMaybe instead of putting this into `free_algebra.py`, you should create `free_lie_algebra.py` and put it there? Anyway, if this is a basis for the Lie algebra, not for its enveloping algebra, then the documentation so far looks a little misleading. Feel free to add plenty of mathematical documentation to the code -- see the top of `algebras/steenrod/steenrod_algebra.py`, for example -- so that people will understand what you've implemented.",
    "created_at": "2013-07-27T18:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182764",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Maybe instead of putting this into `free_algebra.py`, you should create `free_lie_algebra.py` and put it there? Anyway, if this is a basis for the Lie algebra, not for its enveloping algebra, then the documentation so far looks a little misleading. Feel free to add plenty of mathematical documentation to the code -- see the top of `algebras/steenrod/steenrod_algebra.py`, for example -- so that people will understand what you've implemented.



---

archive/issue_comments_182765.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFollowing Reutenauer, chapter 5, it might be a better idea to call the basis I implemented the Lyndon basis of the free algebra. \nIt might be a good idea to start from the underlying Lie algebra but there is still much to do for Lie algebras and I don't think I am able to do it yet.\nAnyway, I added mathematical documentation. Hope it is enough...",
    "created_at": "2013-07-30T13:21:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182765",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:6" align="right">comment:6</div>

Following Reutenauer, chapter 5, it might be a better idea to call the basis I implemented the Lyndon basis of the free algebra. 
It might be a good idea to start from the underlying Lie algebra but there is still much to do for Lie algebras and I don't think I am able to do it yet.
Anyway, I added mathematical documentation. Hope it is enough...



---

archive/issue_comments_182766.json:
```json
{
    "body": "Attachment: **[Lyndon_dual_bases.patch.gz](https://github.com/sagemath/sage/files/ticket14898/Lyndon_dual_bases.patch.gz)**",
    "created_at": "2013-07-30T13:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182766",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Attachment: **[Lyndon_dual_bases.patch.gz](https://github.com/sagemath/sage/files/ticket14898/Lyndon_dual_bases.patch.gz)**



---

archive/issue_comments_182767.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRight now I'm working on an initial version of Lie algebra's on #14901 (of which, I have a good amount of work done on the combinat queue and can post the [incomplete] patch on trac if desired), and it sounds like we should make sure to say in sync to not duplicate code and to have these play together.\n\nCurrently #14901 depends on #10963, so I think we're better of finishing the part on the free algebra first and making #14901 depend on this ticket.\n\nA few things from glancing over the patches:\n\n- Make sure all methods you add have docstrings and doctests.\n- Could you fold all of the patches into a single patch? This makes it easier to review.\n- Set it to \"needs_review\" when you're ready for someone to do the review. (which I volunteer)\n- Did you work on this during Sage Days 49? If so, could you add \"days49\" to the keywords.\n\nHope everything is going well.\n\nThanks,\n\nTravis",
    "created_at": "2013-08-03T11:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182767",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Right now I'm working on an initial version of Lie algebra's on #14901 (of which, I have a good amount of work done on the combinat queue and can post the [incomplete] patch on trac if desired), and it sounds like we should make sure to say in sync to not duplicate code and to have these play together.

Currently #14901 depends on #10963, so I think we're better of finishing the part on the free algebra first and making #14901 depend on this ticket.

A few things from glancing over the patches:

- Make sure all methods you add have docstrings and doctests.
- Could you fold all of the patches into a single patch? This makes it easier to review.
- Set it to "needs_review" when you're ready for someone to do the review. (which I volunteer)
- Did you work on this during Sage Days 49? If so, could you add "days49" to the keywords.

Hope everything is going well.

Thanks,

Travis



---

archive/issue_comments_182768.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMake sure all methods you add have docstrings and doctests.\n\n> I will do it as soon as possible (currently, I am in a new flat without electricty!).\n\nCould you fold all of the patches into a single patch? This makes it easier to review.\n\n> This is what I wanted to do, but when I followed the method described by Fr\u00e9d\u00e9ric Chapoton here (https://groups.google.com/forum/#!topic/sage-devel/TmkXXg2UW_4) it produced a patch which only contains the modifications with respect to the previous one. What should I do ?\n\nSet it to \"needs_review\" when you're ready for someone to do the review. (which I volunteer)\n\n> Ok, I didn't know who is supposed to do it!\n\nDid you work on this during Sage Days 49? If so, could you add \"days49\" to the keywords. \n\n> Well, I got the informations I needed to start modifying Sage source code during these days, but I did not really work on this patch.",
    "created_at": "2013-08-04T14:39:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182768",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:8" align="right">comment:8</div>

Make sure all methods you add have docstrings and doctests.

> I will do it as soon as possible (currently, I am in a new flat without electricty!).

Could you fold all of the patches into a single patch? This makes it easier to review.

> This is what I wanted to do, but when I followed the method described by Frédéric Chapoton here (https://groups.google.com/forum/#!topic/sage-devel/TmkXXg2UW_4) it produced a patch which only contains the modifications with respect to the previous one. What should I do ?

Set it to "needs_review" when you're ready for someone to do the review. (which I volunteer)

> Ok, I didn't know who is supposed to do it!

Did you work on this during Sage Days 49? If so, could you add "days49" to the keywords. 

> Well, I got the informations I needed to start modifying Sage source code during these days, but I did not really work on this patch.



---

archive/issue_comments_182769.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHey Matthieu,\n\nSorry for falling behind on this.\n\nSo to fold a patch, start at \"base.patch\", then run \n\n```\nsage -hg qfold second.patch third.patch ...\n```\n(also for the record, if you want to rename your patch, you can run `sage -hg qrename renamed.patch`).\n\nOnce that is done and the new version is uploaded, I'll continue the review. One other thing, if you keep the same name, please check the \"replace previous file\" box in the uploads.\n\nThanks,\n\nTravis",
    "created_at": "2013-08-18T16:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182769",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

Hey Matthieu,

Sorry for falling behind on this.

So to fold a patch, start at "base.patch", then run 

```
sage -hg qfold second.patch third.patch ...
```
(also for the record, if you want to rename your patch, you can run `sage -hg qrename renamed.patch`).

Once that is done and the new version is uploaded, I'll continue the review. One other thing, if you keep the same name, please check the "replace previous file" box in the uploads.

Thanks,

Travis



---

archive/issue_comments_182770.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThank you for your answer. I got lost somewhere: the different patches I uploaded are on the trac server but I don't know where they actually are on my computer (and I deleted the file produced by the method of Fr\u00e9d\u00e9ric cited above). Should I download the different patches attached to this ticket, fold them and upload the result? \nSince I did not change anything since the last time I uploaded something, when I try to produce a new patch, there is nothing in the diff... Sorry for these questions but I am a not-so-quick newbie! \nMatthieu",
    "created_at": "2013-08-19T10:34:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182770",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:10" align="right">comment:10</div>

Thank you for your answer. I got lost somewhere: the different patches I uploaded are on the trac server but I don't know where they actually are on my computer (and I deleted the file produced by the method of Frédéric cited above). Should I download the different patches attached to this ticket, fold them and upload the result? 
Since I did not change anything since the last time I uploaded something, when I try to produce a new patch, there is nothing in the diff... Sorry for these questions but I am a not-so-quick newbie! 
Matthieu



---

archive/issue_comments_182771.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@sagetrac-deneufchatel](#comment:10):\n> Thank you for your answer. I got lost somewhere: the different patches I uploaded are on the trac server but I don't know where they actually are on my computer (and I deleted the file produced by the method of Fr\u00e9d\u00e9ric cited above).\n\nThey should be in `$SAGE_ROOT/devel/sage/.hg/patches`, however you will want to run those commands in the source folders, i.e. in a subfolder of `$SAGE_ROOT/devel/sage/sage/`.\n\n> Should I download the different patches attached to this ticket, fold them and upload the result? \n\nYou can if you've removed them from your queue (or installed a new version of Sage); just make sure to run `sage -hg qimport first.patch ...` in the source folders.\n\n> Since I did not change anything since the last time I uploaded something, when I try to produce a new patch, there is nothing in the diff...\n\nBecause nothing has changed, there is no need for a new patch, which just records the differences.\n\n> Sorry for these questions but I am a not-so-quick newbie! \n\nNot a problem. Hope this helps.\n\nBest,\n\nTravis",
    "created_at": "2013-08-19T15:19:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182771",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@sagetrac-deneufchatel](#comment:10):
> Thank you for your answer. I got lost somewhere: the different patches I uploaded are on the trac server but I don't know where they actually are on my computer (and I deleted the file produced by the method of Frédéric cited above).

They should be in `$SAGE_ROOT/devel/sage/.hg/patches`, however you will want to run those commands in the source folders, i.e. in a subfolder of `$SAGE_ROOT/devel/sage/sage/`.

> Should I download the different patches attached to this ticket, fold them and upload the result? 

You can if you've removed them from your queue (or installed a new version of Sage); just make sure to run `sage -hg qimport first.patch ...` in the source folders.

> Since I did not change anything since the last time I uploaded something, when I try to produce a new patch, there is nothing in the diff...

Because nothing has changed, there is no need for a new patch, which just records the differences.

> Sorry for these questions but I am a not-so-quick newbie! 

Not a problem. Hope this helps.

Best,

Travis



---

archive/issue_comments_182772.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOk, the different patches are in /devel/sage-test/.hg/patches, thus I should be able to fold them in one file.\nI tried \nsage -hg qnew 14898_r.patch then sage -hg qfold trac_14898.patch trac_14898_PBW.patch trac_14898_Lyndon.patch \nand got this answer:\nqfold cannot fold already applied patch trac_14898_PBW.patch\nWhat should I do?\nMatthieu",
    "created_at": "2013-08-19T15:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182772",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:12" align="right">comment:12</div>

Ok, the different patches are in /devel/sage-test/.hg/patches, thus I should be able to fold them in one file.
I tried 
sage -hg qnew 14898_r.patch then sage -hg qfold trac_14898.patch trac_14898_PBW.patch trac_14898_Lyndon.patch 
and got this answer:
qfold cannot fold already applied patch trac_14898_PBW.patch
What should I do?
Matthieu



---

archive/issue_comments_182773.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIt seems like you are in the right folder, but just to make sure could you tell me what folder were you in?\n\nAlso the patch you want to fold everything into should be the top patch.\n\nEXAMPLE: You have the patches `first.patch`, `second.patch`, `third.patch` in that order in your queue and you want to fold `second.patch` and `third.patch` into `first.patch`. You will run: `sage -hg qfold second.patch third.patch` when `sage -hg qtop` returns `first.patch`. If it does not, you will have to run `sage -hg qpop` to \"pop off\", i.e. unapply, those patches until you're at `first.patch`.\n\nHope that makes sense and helps.",
    "created_at": "2013-08-19T16:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182773",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

It seems like you are in the right folder, but just to make sure could you tell me what folder were you in?

Also the patch you want to fold everything into should be the top patch.

EXAMPLE: You have the patches `first.patch`, `second.patch`, `third.patch` in that order in your queue and you want to fold `second.patch` and `third.patch` into `first.patch`. You will run: `sage -hg qfold second.patch third.patch` when `sage -hg qtop` returns `first.patch`. If it does not, you will have to run `sage -hg qpop` to "pop off", i.e. unapply, those patches until you're at `first.patch`.

Hope that makes sense and helps.



---

archive/issue_comments_182774.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nsage -hg qtop returns \"no patches applied\"!\nI was in the folder /devel/sage-test/sage/algebras...",
    "created_at": "2013-08-19T16:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182774",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:14" align="right">comment:14</div>

sage -hg qtop returns "no patches applied"!
I was in the folder /devel/sage-test/sage/algebras...



---

archive/issue_comments_182775.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAre you also doing `sage -hg qtop` in the same folder? This is in conflict with your previous post where it seems like the patches are already applied. Perchance did you run `sage -hg clone` with your patches applied?",
    "created_at": "2013-08-19T17:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182775",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Are you also doing `sage -hg qtop` in the same folder? This is in conflict with your previous post where it seems like the patches are already applied. Perchance did you run `sage -hg clone` with your patches applied?



---

archive/issue_comments_182776.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nYou are right, I was not in the same folder since in /devel/sage-test/.hg/patches, when I run sage -hg qtop, it returns trac_14898_r.patch which is the last patch I created.",
    "created_at": "2013-08-19T19:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182776",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:16" align="right">comment:16</div>

You are right, I was not in the same folder since in /devel/sage-test/.hg/patches, when I run sage -hg qtop, it returns trac_14898_r.patch which is the last patch I created.



---

archive/issue_comments_182777.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAnd what do I have to do about this?\nI tried sage -hg qnew 14898_r.patch then sage -hg qfold trac_14898.patch trac_14898_PBW.patch trac_14898_Lyndon.patch and got this answer: qfold cannot fold already applied patch trac_14898_PBW.patch",
    "created_at": "2013-08-19T19:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182777",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:17" align="right">comment:17</div>

And what do I have to do about this?
I tried sage -hg qnew 14898_r.patch then sage -hg qfold trac_14898.patch trac_14898_PBW.patch trac_14898_Lyndon.patch and got this answer: qfold cannot fold already applied patch trac_14898_PBW.patch



---

archive/issue_comments_182778.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nRun `sage -hg qpop` in that directory until you're at the base patch you want.",
    "created_at": "2013-08-19T22:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182778",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

Run `sage -hg qpop` in that directory until you're at the base patch you want.



---

archive/issue_comments_182779.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe patch I want to use is called trac_14898_r.patch. \n[matthieu@localhost patches]$ ls\nseries  trac_14898_Lyndon.patch  trac_14898_PBW.patch  trac_14914_stuffle.patch\nstatus  trac_14898.patch         trac_14898_r.patch\n\nI pushed it on top of the queue (but sage said that it was empty) if I am right:\n[matthieu@localhost patches]$ sage -hg qtop\ntrac_14898_r.patch\n\nBut it does not want to fold the patch trac_14898_PBW.patch\n[matthieu@localhost patches]$ sage -hg qfold trac_14898_PBW.patch trac_14898_Lyndon.patch trac_14898.patch \nabort: qfold cannot fold already applied patch trac_14898_PBW.patch\n\nSorry for the delay, I do not have a reliable internet connection.",
    "created_at": "2013-08-21T09:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182779",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:19" align="right">comment:19</div>

The patch I want to use is called trac_14898_r.patch. 
[matthieu@localhost patches]$ ls
series  trac_14898_Lyndon.patch  trac_14898_PBW.patch  trac_14914_stuffle.patch
status  trac_14898.patch         trac_14898_r.patch

I pushed it on top of the queue (but sage said that it was empty) if I am right:
[matthieu@localhost patches]$ sage -hg qtop
trac_14898_r.patch

But it does not want to fold the patch trac_14898_PBW.patch
[matthieu@localhost patches]$ sage -hg qfold trac_14898_PBW.patch trac_14898_Lyndon.patch trac_14898.patch 
abort: qfold cannot fold already applied patch trac_14898_PBW.patch

Sorry for the delay, I do not have a reliable internet connection.



---

archive/issue_comments_182780.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nFrom your series file, `trac_13898_r.patch` is the *last* patch that is applied, i.e. all the previous patches are also applied and why you are gettign the error message. Just to make sure we are on the same page, you should get the following\n\n```\n$ sage -hg qapplied\ntrac_14898_Lyndon.patch\ntrac_14898_PBW.patch\ntrac_14914_stuffle.patch\nstatus\ntrac_14898.patch\ntrac_14898_r.patch\n```\nwhere `$ blah` means you run command `blah` from the terminal in the `$SAGE_ROOT/devel/sage/sage` folder.\n\nSo what you should do is the following (the `#` and anything after is a comment):\n\n```\n$ sage -hg qpop trac_14898_Lyndon.patch    # This is the first patch applied\n$ sage -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch     # Fold all subsequent patches in (in order)\n$ sage -hg qrename trac_14898-folded-md.patch   # Give the new patch a different name\n$ sage -hg qrefresh -e     # Make sure there is a good commit message\n```\n\nHope that helps,\n\nTravis",
    "created_at": "2013-08-22T18:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182780",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

From your series file, `trac_13898_r.patch` is the *last* patch that is applied, i.e. all the previous patches are also applied and why you are gettign the error message. Just to make sure we are on the same page, you should get the following

```
$ sage -hg qapplied
trac_14898_Lyndon.patch
trac_14898_PBW.patch
trac_14914_stuffle.patch
status
trac_14898.patch
trac_14898_r.patch
```
where `$ blah` means you run command `blah` from the terminal in the `$SAGE_ROOT/devel/sage/sage` folder.

So what you should do is the following (the `#` and anything after is a comment):

```
$ sage -hg qpop trac_14898_Lyndon.patch    # This is the first patch applied
$ sage -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch     # Fold all subsequent patches in (in order)
$ sage -hg qrename trac_14898-folded-md.patch   # Give the new patch a different name
$ sage -hg qrefresh -e     # Make sure there is a good commit message
```

Hope that helps,

Travis



---

archive/issue_comments_182781.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThank you for your help.\n\nI followed the steps above (in the $SAGE_ROOT/devel/sage/sage folder), but when I ran \n\n$ sage -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch\n\nI still got this\n\nabort: qfold cannot fold already applied patch trac_14898_PBW.patch",
    "created_at": "2013-08-23T09:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182781",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:21" align="right">comment:21</div>

Thank you for your help.

I followed the steps above (in the $SAGE_ROOT/devel/sage/sage folder), but when I ran 

$ sage -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch

I still got this

abort: qfold cannot fold already applied patch trac_14898_PBW.patch



---

archive/issue_comments_182782.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWhat's the output when you run `$ sage -hg qapplied`? Actually, just e-mail me: tscrim at ucdavis.edu, we'll do it off trac to stop some spam.",
    "created_at": "2013-08-23T15:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182782",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

What's the output when you run `$ sage -hg qapplied`? Actually, just e-mail me: tscrim at ucdavis.edu, we'll do it off trac to stop some spam.



---

archive/issue_comments_182783.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n[matthieu@localhost sage]$ sage -hg qapplied\n\ntrac_14898_PBW.patch\n\ntrac_14914_stuffle.patch\n\ntrac_14898.patch\n\ntrac_14898-folded-md.patch",
    "created_at": "2013-08-23T16:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182783",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:23" align="right">comment:23</div>

[matthieu@localhost sage]$ sage -hg qapplied

trac_14898_PBW.patch

trac_14914_stuffle.patch

trac_14898.patch

trac_14898-folded-md.patch



---

archive/issue_comments_182784.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nRun\n\n```\n$ sage -hg qpop trac_14898_PBW.patch\n$ sage -hg qfold trac_14898.patch trac_14898-folded-md.patch\n```\nThat should have all of the patches folded into a single patch.",
    "created_at": "2013-08-23T16:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182784",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Run

```
$ sage -hg qpop trac_14898_PBW.patch
$ sage -hg qfold trac_14898.patch trac_14898-folded-md.patch
```
That should have all of the patches folded into a single patch.



---

archive/issue_comments_182785.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI just remembered that I have two versions of Sage on my computer and the last version (Sage 5.10), which is the version I worked with, is called sage10.\n\nIn fact,\n\n[matthieu@localhost sage]$ sage10 -hg qapplied\n\nanswers\n\ntrac_14898_PBW.patch\n\nI checked that I am in the right folder (sage-5.10/devel/sage/sage). \n\n$ sage10 -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch\nanswers \nabort: no patches applied.\n\nI am sorry for my mistake. What does this last information change?",
    "created_at": "2013-08-23T17:18:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182785",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:25" align="right">comment:25</div>

I just remembered that I have two versions of Sage on my computer and the last version (Sage 5.10), which is the version I worked with, is called sage10.

In fact,

[matthieu@localhost sage]$ sage10 -hg qapplied

answers

trac_14898_PBW.patch

I checked that I am in the right folder (sage-5.10/devel/sage/sage). 

$ sage10 -hg qfold trac_14898_PBW.patch trac_14898.patch trac_14898_r.patch
answers 
abort: no patches applied.

I am sorry for my mistake. What does this last information change?



---

archive/issue_comments_182786.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n[matthieu@localhost sage-5.10]$ sage10 -hg qapplied\n\n[matthieu@localhost sage-5.10]$ sage10 -hg qunapplied  \n\n[matthieu@localhost sage-5.10]$ cat devel/sage/.hg/patches/series \n\ntrac_14898_PBW.patch\n\ntrac_14914_stuffle.patch\n\ntrac_14898.patch\n\ntrac_14898-folded-md.patch\n\ntrac_14898_r.patch\n",
    "created_at": "2013-08-24T09:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182786",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:26" align="right">comment:26</div>

[matthieu@localhost sage-5.10]$ sage10 -hg qapplied

[matthieu@localhost sage-5.10]$ sage10 -hg qunapplied  

[matthieu@localhost sage-5.10]$ cat devel/sage/.hg/patches/series 

trac_14898_PBW.patch

trac_14914_stuffle.patch

trac_14898.patch

trac_14898-folded-md.patch

trac_14898_r.patch




---

archive/issue_comments_182787.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n[matthieu@localhost sage-5.10]$ cd devel/sage/sage\n\n[matthieu@localhost sage]$ sage10 -hg qapplied\n\ntrac_14914_stuffle.patch\n\n[matthieu@localhost sage]$ sage10 -hg qunapplied\n\n[matthieu@localhost sage]$ sage10 -hg qfold trac_14898.patch trac_14898-folded-md.patch \ntrac_14898_r.patch\n\nabort: patch trac_14898.patch not in series\n\n[matthieu@localhost sage]$ sage10 -hg qpop trac_14898_PBW.patch\n\nabort: patch trac_14898_PBW.patch not in series\n\nI don't know if this is important but I work with clones. I switched back to the main branch since you tell me that I have to work in the devel/sage/sage folder. But the files I modified are in the devel/sage-test/sage folder?",
    "created_at": "2013-08-24T15:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182787",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:27" align="right">comment:27</div>

[matthieu@localhost sage-5.10]$ cd devel/sage/sage

[matthieu@localhost sage]$ sage10 -hg qapplied

trac_14914_stuffle.patch

[matthieu@localhost sage]$ sage10 -hg qunapplied

[matthieu@localhost sage]$ sage10 -hg qfold trac_14898.patch trac_14898-folded-md.patch 
trac_14898_r.patch

abort: patch trac_14898.patch not in series

[matthieu@localhost sage]$ sage10 -hg qpop trac_14898_PBW.patch

abort: patch trac_14898_PBW.patch not in series

I don't know if this is important but I work with clones. I switched back to the main branch since you tell me that I have to work in the devel/sage/sage folder. But the files I modified are in the devel/sage-test/sage folder?



---

archive/issue_comments_182788.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIt is important because I think we've had a miscommunication. The `devel/sage` is the current branch (which you call a clone) you are working in (it's a link), which we want it to be `sage-test`; the main branch is `devel/sage-main`.",
    "created_at": "2013-08-24T16:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182788",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

It is important because I think we've had a miscommunication. The `devel/sage` is the current branch (which you call a clone) you are working in (it's a link), which we want it to be `sage-test`; the main branch is `devel/sage-main`.



---

archive/issue_comments_182789.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOk, so I switched back to the sage-test branch and went into the sage-test/sage folder.\n\nI tried the commands you wanted me to try and I get something new!\n\n[matthieu@localhost sage]$ sage10 -b test\n\n\n\n---\n\nsage: Building and installing modified Sage library files.\n\n\n\n\n\nInstalling c_lib\n\nscons: `install' is up to date.\n\nUpdating Cython code....\n\nFinished compiling Cython code (time = 3.23941302299 seconds)\n\nrunning install\n\nrunning build\n\nrunning build_py\n\nwarning: build_py: byte-compiling is disabled, skipping.\n\n\n\nrunning build_ext\n\nExecuting 0 commands (using 1 thread)\n\nTime to execute 0 commands: 0.00467801094055 seconds\n\nTotal time spent compiling C/C++ extensions:  0.139641046524 seconds.\n\nrunning install_lib\n\nwarning: install_lib: byte-compiling is disabled, skipping.\n\n\n\nrunning install_egg_info\n\nRemoving /home/matthieu/sage-5.10/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\n\nWriting /home/matthieu/sage-5.10/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info\n\n\n\nreal    0m5.383s\n\nuser    0m4.775s\n\nsys     0m0.414s\n\n[matthieu@localhost sage]$ cd ..\n\n[matthieu@localhost sage]$ cd ..\n\n[matthieu@localhost devel]$ ls\n\next@  ext-main/  old/  sage@  sage-main/  sagenb@  sagenb-main/  sage-test/  sage-test_stuffle/\n \n[matthieu@localhost devel]$ cd sage-test\n\n[matthieu@localhost sage-test]$ cd sage\n\n[matthieu@localhost sage]$ sage10 -hg qapplied\n\ntrac_14898_PBW.patch\n\n[matthieu@localhost sage]$ sage10 -hg qunapplied\n\ntrac_14914_stuffle.patch\n\ntrac_14898.patch\n\ntrac_14898-folded-md.patch\n\ntrac_14898_r.patch\n\n[matthieu@localhost sage]$ sage10 -hg qpop trac_14898_PBW.patch\n\nqpop: trac_14898_PBW.patch is already at the top\n\n[matthieu@localhost sage]$ sage10 -hg qfold trac_14898.patch trac_14898-folded-md.patch [BR]] trac_14898_r.patch\n\npatching file sage/algebras/free_algebra.py\n\nHunk #1 FAILED at 954\n\n1 out of 1 hunks FAILED -- saving rejects to file sage/algebras/free_algebra.py.rej\n\npatching file sage/algebras/shuffle_algebra.py\n\nHunk #1 FAILED at 476\n\n1 out of 1 hunks FAILED -- saving rejects to file sage/algebras/shuffle_algebra.py.rej\n\npatch failed, unable to continue (try -v)\n\nabort: error folding patch trac_14898.patch\n",
    "created_at": "2013-08-24T16:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182789",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:29" align="right">comment:29</div>

Ok, so I switched back to the sage-test branch and went into the sage-test/sage folder.

I tried the commands you wanted me to try and I get something new!

[matthieu@localhost sage]$ sage10 -b test



---

sage: Building and installing modified Sage library files.





Installing c_lib

scons: `install' is up to date.

Updating Cython code....

Finished compiling Cython code (time = 3.23941302299 seconds)

running install

running build

running build_py

warning: build_py: byte-compiling is disabled, skipping.



running build_ext

Executing 0 commands (using 1 thread)

Time to execute 0 commands: 0.00467801094055 seconds

Total time spent compiling C/C++ extensions:  0.139641046524 seconds.

running install_lib

warning: install_lib: byte-compiling is disabled, skipping.



running install_egg_info

Removing /home/matthieu/sage-5.10/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info

Writing /home/matthieu/sage-5.10/local/lib/python2.7/site-packages/sage-0.0.0-py2.7.egg-info



real    0m5.383s

user    0m4.775s

sys     0m0.414s

[matthieu@localhost sage]$ cd ..

[matthieu@localhost sage]$ cd ..

[matthieu@localhost devel]$ ls

ext@  ext-main/  old/  sage@  sage-main/  sagenb@  sagenb-main/  sage-test/  sage-test_stuffle/
 
[matthieu@localhost devel]$ cd sage-test

[matthieu@localhost sage-test]$ cd sage

[matthieu@localhost sage]$ sage10 -hg qapplied

trac_14898_PBW.patch

[matthieu@localhost sage]$ sage10 -hg qunapplied

trac_14914_stuffle.patch

trac_14898.patch

trac_14898-folded-md.patch

trac_14898_r.patch

[matthieu@localhost sage]$ sage10 -hg qpop trac_14898_PBW.patch

qpop: trac_14898_PBW.patch is already at the top

[matthieu@localhost sage]$ sage10 -hg qfold trac_14898.patch trac_14898-folded-md.patch [BR]] trac_14898_r.patch

patching file sage/algebras/free_algebra.py

Hunk #1 FAILED at 954

1 out of 1 hunks FAILED -- saving rejects to file sage/algebras/free_algebra.py.rej

patching file sage/algebras/shuffle_algebra.py

Hunk #1 FAILED at 476

1 out of 1 hunks FAILED -- saving rejects to file sage/algebras/shuffle_algebra.py.rej

patch failed, unable to continue (try -v)

abort: error folding patch trac_14898.patch




---

archive/issue_comments_182790.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIt seems like the patches got out of order...post the `trac_14898_r.patch` and I'll fold the results together along with some of my review changes.\n\nAfter I post the folded patch, you'll want to run\n\n```\n$ sage -hg qpop -a         # this pops off all patches\n$ sage -hg qunapplied\n$ sage -hg qremove [all patches outputted from above related to #14898]\n$ sage -hg qimport [my folded patch that you'll download]\n```\n\nAlso, when you copy output text, it's best to put it in triple squiggly brackets: `{{{` and `}}}`. This gives it the nice formatting like what I have in this comment and you don't have to put in the `\n`.\n\nBest,\n\nTravis",
    "created_at": "2013-08-24T16:36:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182790",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

It seems like the patches got out of order...post the `trac_14898_r.patch` and I'll fold the results together along with some of my review changes.

After I post the folded patch, you'll want to run

```
$ sage -hg qpop -a         # this pops off all patches
$ sage -hg qunapplied
$ sage -hg qremove [all patches outputted from above related to #14898]
$ sage -hg qimport [my folded patch that you'll download]
```

Also, when you copy output text, it's best to put it in triple squiggly brackets: `{{{` and `}}}`. This gives it the nice formatting like what I have in this comment and you don't have to put in the `
`.

Best,

Travis



---

archive/issue_comments_182791.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nWhen I am in the /sage-test/.hg/patches folder, \n\ncat trac_14898_r.patch\n\nreturns\n\n\\# HG changeset patch\n\n\\# Parent cfc68d83b7cc7ea7eec71175337f3712a45e0ced\n\nand nothing more. It seems that it is empty...",
    "created_at": "2013-08-24T17:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182791",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:31" align="right">comment:31</div>

When I am in the /sage-test/.hg/patches folder, 

cat trac_14898_r.patch

returns

\# HG changeset patch

\# Parent cfc68d83b7cc7ea7eec71175337f3712a45e0ced

and nothing more. It seems that it is empty...



---

archive/issue_comments_182792.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHey Matthieu,\n\nOkay, since that patch is empty we can ignore (or remove) it. However I can't apply the patches, it seems like something is missing. Could you (re)post all of your current patches?\n\nThanks,\n\nTravis",
    "created_at": "2013-08-25T00:51:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182792",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Hey Matthieu,

Okay, since that patch is empty we can ignore (or remove) it. However I can't apply the patches, it seems like something is missing. Could you (re)post all of your current patches?

Thanks,

Travis



---

archive/issue_comments_182793.json:
```json
{
    "body": "trac_14898.patch",
    "created_at": "2013-08-25T11:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182793",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

trac_14898.patch



---

archive/issue_comments_182794.json:
```json
{
    "body": "Attachment: **[trac_14898.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898.patch.gz)**\n\nAttachment: **[trac_14898_r.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898_r.patch.gz)**",
    "created_at": "2013-08-25T11:39:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182794",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Attachment: **[trac_14898.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898.patch.gz)**

Attachment: **[trac_14898_r.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898_r.patch.gz)**



---

archive/issue_comments_182795.json:
```json
{
    "body": "Attachment: **[trac_14898-folded-md.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898-folded-md.patch.gz)**\n\nAttachment: **[trac_14898_PBW.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898_PBW.patch.gz)**",
    "created_at": "2013-08-25T11:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182795",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

Attachment: **[trac_14898-folded-md.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898-folded-md.patch.gz)**

Attachment: **[trac_14898_PBW.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898_PBW.patch.gz)**



---

archive/issue_comments_182796.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nDone!",
    "created_at": "2013-08-25T11:42:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182796",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:33" align="right">comment:33</div>

Done!



---

archive/issue_comments_182797.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nHmmm...could you tell me the content of each of the series file in your branches? Thanks.",
    "created_at": "2013-08-25T18:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182797",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:34" align="right">comment:34</div>

Hmmm...could you tell me the content of each of the series file in your branches? Thanks.



---

archive/issue_comments_182798.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nActually, better idea: send it to me in an e-mail along with the current versions of all the files you've modified for this patch, in particular `free_algebra.py`. Thanks.",
    "created_at": "2013-08-25T18:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182798",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Actually, better idea: send it to me in an e-mail along with the current versions of all the files you've modified for this patch, in particular `free_algebra.py`. Thanks.



---

archive/issue_comments_182799.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nHey Matthieu,\n\nHere's the folded patch which:\n\n- Makes your functions into methods of the correct classes.\n- Implements coercion between the bases.\n- Moves `FreeAlgebra` into the category of `AlgebrasWithBases`.\n- Makes every function have a doctest.\n\nThis is the patch which applies for me on sage 5.11 and 5.12.beta3. You'll probably want to delete using `sage -hg qremove` all of the patches related to this ticket and then `sage -hg qimport /path/to/this/file` and `sage -hg qpush`.\n\nLet me know if you're happy with my changes.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_14898-pbw_folded-ts.patch",
    "created_at": "2013-08-27T03:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182799",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:36" align="right">comment:36</div>

Hey Matthieu,

Here's the folded patch which:

- Makes your functions into methods of the correct classes.
- Implements coercion between the bases.
- Moves `FreeAlgebra` into the category of `AlgebrasWithBases`.
- Makes every function have a doctest.

This is the patch which applies for me on sage 5.11 and 5.12.beta3. You'll probably want to delete using `sage -hg qremove` all of the patches related to this ticket and then `sage -hg qimport /path/to/this/file` and `sage -hg qpush`.

Let me know if you're happy with my changes.

Best,

Travis

For patchbot:

Apply: trac_14898-pbw_folded-ts.patch



---

archive/issue_events_209950.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-27T03:22:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209950"
}
```



---

archive/issue_comments_182800.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n Implements:\n - the Poincar\u00e9-Birkhoff-Witt basis of the free algebra and several related functions\n - the dual basis of the previous one in the shuffle algebra.\n+\n+Also puts `FreeAlgebra` in the category of `AlgebrasWithBases`.\n+\n+Apply: [attachment: trac_14898-pbw_folded-ts.patch]\n``````\n",
    "created_at": "2013-08-27T03:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182800",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
 Implements:
 - the Poincaré-Birkhoff-Witt basis of the free algebra and several related functions
 - the dual basis of the previous one in the shuffle algebra.
+
+Also puts `FreeAlgebra` in the category of `AlgebrasWithBases`.
+
+Apply: [attachment: trac_14898-pbw_folded-ts.patch]
``````




---

archive/issue_comments_182801.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2013-08-27T03:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182801",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_182802.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThanks for your help. I have a problem that may be due to the fact that I use sage-5.10.\u00a0\n\n[matthieu@localhost patches]$ sage10 -hg /home/matthieu/T\u00e9l\u00e9chargements/tr\n\ntrac_14898-pbw_folded-ts (1).patch \u00a0trac_14898-pbw_folded-ts.patch \u00a0 \u00a0 \u00a0\n\n[matthieu@localhost patches]$ sage10 -hg qimport /home/matthieu/T\u00e9l\u00e9chargements/trac_14898-pbw_folded-ts.patch \u00a0\n\nadding trac_14898-pbw_folded-ts.patch to series file\n\n[matthieu@localhost patches]$ sage10 -hg qpush tr\n\ntrac_14898-pbw_folded-ts.patch \u00a0trac_14914_stuffle.patch \u00a0 \u00a0 \u00a0 \u00a0\n\n[matthieu@localhost patches]$ sage10 -hg qpush trac_14898-pbw_folded-ts.patch\u00a0\n\napplying trac_14898-pbw_folded-ts.patch\n\npatching file sage/combinat/words/word.py\n\nHunk !#2 FAILED at 43\n\nHunk !#4 FAILED at 182\n\n2 out of 4 hunks FAILED -- saving rejects to file sage/combinat/words/word.py.rej\n\npatch failed, unable to continue (try -v)\n\npatch failed, rejects left in working dir\n\nerrors during apply, please fix and refresh trac_14898-pbw_folded-ts.patch\n\nShould I install sage-5.x?",
    "created_at": "2013-08-27T10:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182802",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:37" align="right">comment:37</div>

Thanks for your help. I have a problem that may be due to the fact that I use sage-5.10. 

[matthieu@localhost patches]$ sage10 -hg /home/matthieu/Téléchargements/tr

trac_14898-pbw_folded-ts (1).patch  trac_14898-pbw_folded-ts.patch      

[matthieu@localhost patches]$ sage10 -hg qimport /home/matthieu/Téléchargements/trac_14898-pbw_folded-ts.patch  

adding trac_14898-pbw_folded-ts.patch to series file

[matthieu@localhost patches]$ sage10 -hg qpush tr

trac_14898-pbw_folded-ts.patch  trac_14914_stuffle.patch        

[matthieu@localhost patches]$ sage10 -hg qpush trac_14898-pbw_folded-ts.patch 

applying trac_14898-pbw_folded-ts.patch

patching file sage/combinat/words/word.py

Hunk !#2 FAILED at 43

Hunk !#4 FAILED at 182

2 out of 4 hunks FAILED -- saving rejects to file sage/combinat/words/word.py.rej

patch failed, unable to continue (try -v)

patch failed, rejects left in working dir

errors during apply, please fix and refresh trac_14898-pbw_folded-ts.patch

Should I install sage-5.x?



---

archive/issue_comments_182803.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI had a look at the patch you uploaded without applying it and it is fine with me.",
    "created_at": "2013-08-27T15:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182803",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:38" align="right">comment:38</div>

I had a look at the patch you uploaded without applying it and it is fine with me.



---

archive/issue_comments_182804.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nSince you're getting those rejects in `word.py`, it should be because you're using 5.10. Try it with 5.11, I believe it should apply there.",
    "created_at": "2013-08-27T16:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182804",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

Since you're getting those rejects in `word.py`, it should be because you're using 5.10. Try it with 5.11, I believe it should apply there.



---

archive/issue_comments_182805.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nSo I compiled sage-5.11 and tried to apply your patch but I still have a problem:\n\n[matthieu@localhost sage-5.11]$ ./sage -hg qimport /home/matthieu/T\u00e9l\u00e9chargements/trac_14898-pbw_folded-ts.patch\u00a0\n\nadding trac_14898-pbw_folded-ts.patch to series file\n\n[matthieu@localhost sage-5.11]$ sage11 -hg qpush trac_14898-pbw_folded-ts.patch\n\napplying trac_14898-pbw_folded-ts.patch\n\npatch failed, unable to continue (try -v)\n\npatch failed, rejects left in working dir\n\nerrors during apply, please fix and refresh trac_14898-pbw_folded-ts.patch\n\nIs there a \"log file\"?",
    "created_at": "2013-08-28T23:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182805",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:40" align="right">comment:40</div>

So I compiled sage-5.11 and tried to apply your patch but I still have a problem:

[matthieu@localhost sage-5.11]$ ./sage -hg qimport /home/matthieu/Téléchargements/trac_14898-pbw_folded-ts.patch 

adding trac_14898-pbw_folded-ts.patch to series file

[matthieu@localhost sage-5.11]$ sage11 -hg qpush trac_14898-pbw_folded-ts.patch

applying trac_14898-pbw_folded-ts.patch

patch failed, unable to continue (try -v)

patch failed, rejects left in working dir

errors during apply, please fix and refresh trac_14898-pbw_folded-ts.patch

Is there a "log file"?



---

archive/issue_comments_182806.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nFinally, I think it works but I get lost: the actual branch I work with is sage-test\n\n[matthieu@localhost sage-main]$ sage11 -branch\n\ntest\n\nbut the files modified by the application of the patch are the file of the main branch\n\n[matthieu@localhost sage-main]$ cat sage/algebras/free_algebra.py\n\n##### Tests #####\n\n\\# Check that expansion \\circ to_pbw is the identity #\n\n#PBW = PBWBasisOfFreeAlgebra(QQ,2)\n\n#to_pbw(expansion(PBW.basis()[PBW._mon.1 * PBW._mon.0]))==PBW.basis()[PBW._mon.1 * PBW._mon.0]\n\n#sage: M.<x0,x1>=FreeMonoid(2)\n\n#sage: PBW=PBWBasisOfFreeAlgebra(QQ,2)\n\n#sage: L=[]\n\n#sage: for i in range(6):\n\n#....: \u00a0 \u00a0 \u00a0for j in Words(M.gens(),i).list():\n\n#....: \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0L.append(to_monoid_element(j))\n\n#....:\n\n#sage: for i in L:\n\n#....: \u00a0 \u00a0 \u00a0to_pbw(expansion(PBW.basis()[i]))==PBW.basis()[i]\n\n#....:\n\n[matthieu@localhost sage-main]$ less sage/algebras/free_algebra.py\n\nwhereas I would expect the files in sage-test to have been changed...",
    "created_at": "2013-08-29T07:48:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182806",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:41" align="right">comment:41</div>

Finally, I think it works but I get lost: the actual branch I work with is sage-test

[matthieu@localhost sage-main]$ sage11 -branch

test

but the files modified by the application of the patch are the file of the main branch

[matthieu@localhost sage-main]$ cat sage/algebras/free_algebra.py

##### Tests #####

\# Check that expansion \circ to_pbw is the identity #

#PBW = PBWBasisOfFreeAlgebra(QQ,2)

#to_pbw(expansion(PBW.basis()[PBW._mon.1 * PBW._mon.0]))==PBW.basis()[PBW._mon.1 * PBW._mon.0]

#sage: M.<x0,x1>=FreeMonoid(2)

#sage: PBW=PBWBasisOfFreeAlgebra(QQ,2)

#sage: L=[]

#sage: for i in range(6):

#....:      for j in Words(M.gens(),i).list():

#....:                      L.append(to_monoid_element(j))

#....:

#sage: for i in L:

#....:      to_pbw(expansion(PBW.basis()[i]))==PBW.basis()[i]

#....:

[matthieu@localhost sage-main]$ less sage/algebras/free_algebra.py

whereas I would expect the files in sage-test to have been changed...



---

archive/issue_comments_182807.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nDoes this patch require the patches of Sage Combinat to be installed?\n\nWhen I (successfully) apply the patch, I get an error when I rebuild the library: \u00a0\n\nFile \"/home/matthieu/sage-5.11/local/lib/python2.7/site-packages/sage/combinat/permutation.py\", line 211, in <module>\n\n\u00a0 \u00a0 from sage.combinat.composition import Composition\n\nImportError: cannot import name Composition",
    "created_at": "2013-08-29T10:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182807",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:42" align="right">comment:42</div>

Does this patch require the patches of Sage Combinat to be installed?

When I (successfully) apply the patch, I get an error when I rebuild the library:  

File "/home/matthieu/sage-5.11/local/lib/python2.7/site-packages/sage/combinat/permutation.py", line 211, in <module>

    from sage.combinat.composition import Composition

ImportError: cannot import name Composition



---

archive/issue_comments_182808.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n Also puts `FreeAlgebra` in the category of `AlgebrasWithBases`.\n \n-Apply: [attachment: trac_14898-pbw_folded-ts.patch]\n+Apply: [attachment: trac_14898-pbw_folded-ts.patch](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)\n``````\n",
    "created_at": "2013-08-29T16:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182808",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 Also puts `FreeAlgebra` in the category of `AlgebrasWithBases`.
 
-Apply: [attachment: trac_14898-pbw_folded-ts.patch]
+Apply: [attachment: trac_14898-pbw_folded-ts.patch](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)
``````




---

archive/issue_comments_182809.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nAs for why the files in `sage-main` were modified, did you run the `sage -hg qimport` in the `sage-main` folder?\n\nHmmm....strange. I'm guessing my import statements are causing a circular dependency without #14772? (I did some reworking of the import statements and I recall they were very fickle.) Try moving the added import statements into the functions where we actually call the imported object(s).\n\nIf that doesn't work, perhaps it is worthwhile (IMO, it is even if the above does work) to install sage-combinat by doing the following:\n\n```\n$ sage -b main\n$ cd /to/sage-main\n$ sage -hg qpop -a     # Because cloning will take the current changes to any patches that are applied\n$ sage -combinat install    # This will take a few minutes\n$ cd /to/sage-combinat\n$ sage -hg qpop trac_14898-pbw_folded-ts.patch   # It's in the combinat queue already\n```\n\nBest,\n\nTravis\n\nPS - Sorry for the delay",
    "created_at": "2013-08-29T16:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182809",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

As for why the files in `sage-main` were modified, did you run the `sage -hg qimport` in the `sage-main` folder?

Hmmm....strange. I'm guessing my import statements are causing a circular dependency without #14772? (I did some reworking of the import statements and I recall they were very fickle.) Try moving the added import statements into the functions where we actually call the imported object(s).

If that doesn't work, perhaps it is worthwhile (IMO, it is even if the above does work) to install sage-combinat by doing the following:

```
$ sage -b main
$ cd /to/sage-main
$ sage -hg qpop -a     # Because cloning will take the current changes to any patches that are applied
$ sage -combinat install    # This will take a few minutes
$ cd /to/sage-combinat
$ sage -hg qpop trac_14898-pbw_folded-ts.patch   # It's in the combinat queue already
```

Best,

Travis

PS - Sorry for the delay



---

archive/issue_comments_182810.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nIt works. Thanks.\nMatthieu",
    "created_at": "2013-08-30T15:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182810",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:44" align="right">comment:44</div>

It works. Thanks.
Matthieu



---

archive/issue_comments_182811.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nGreat!\n\nHowever here's a new version of the patch which now has the multiplication agreeing between the monomials and the PBW basis. If you're happy with the patch after my changes, you can go ahead and set this to positive review.\n\nBest,\n\nTravis",
    "created_at": "2013-08-30T21:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182811",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Great!

However here's a new version of the patch which now has the multiplication agreeing between the monomials and the PBW basis. If you're happy with the patch after my changes, you can go ahead and set this to positive review.

Best,

Travis



---

archive/issue_comments_182812.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI don't agree with your implementation of the multiplication. If u and v are two words, P_u P_v = P_{uv} iff the Lyndon factorization of uv is (u,v); if this is not the case, you have to look at the Lyndon factorization of uv and it is not so straightforward and this is why I did not add it so far.\n\nAm I right?",
    "created_at": "2013-08-30T23:49:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182812",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:46" align="right">comment:46</div>

I don't agree with your implementation of the multiplication. If u and v are two words, P_u P_v = P_{uv} iff the Lyndon factorization of uv is (u,v); if this is not the case, you have to look at the Lyndon factorization of uv and it is not so straightforward and this is why I did not add it so far.

Am I right?



---

archive/issue_comments_182813.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nThe statement in my last comment is false. But in most cases, P_u P_v \\neq P_{uv} (it is true if v is a Lyndon word such that \\ell_n \\geq v where \\ell_n is the last factor of the Lyndon factorization of u).",
    "created_at": "2013-08-31T08:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182813",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:47" align="right">comment:47</div>

The statement in my last comment is false. But in most cases, P_u P_v \neq P_{uv} (it is true if v is a Lyndon word such that \ell_n \geq v where \ell_n is the last factor of the Lyndon factorization of u).



---

archive/issue_comments_182814.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nBecause it was driving me slightly nuts (because the basis is a free mult. basis indexed by Lyndon words), I've changed the output of `PBW[y*x]` to `PBW[y]*PBW[x]`. Is there anything else that you think should be changed Matthieu?\n\nFor patchbot:\n\nApply: trac_14898-pbw_folded-ts.patch",
    "created_at": "2013-09-01T17:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182814",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:48" align="right">comment:48</div>

Because it was driving me slightly nuts (because the basis is a free mult. basis indexed by Lyndon words), I've changed the output of `PBW[y*x]` to `PBW[y]*PBW[x]`. Is there anything else that you think should be changed Matthieu?

For patchbot:

Apply: trac_14898-pbw_folded-ts.patch



---

archive/issue_comments_182815.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI also marked one of the tests in `_repr_term()` as `# indirect doctest` so `sage -coverage` (and other people) knows it's been doctest.\n\nFor patchbot:\n\nApply: trac_14898-pbw_folded-ts.patch",
    "created_at": "2013-09-01T17:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182815",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

I also marked one of the tests in `_repr_term()` as `# indirect doctest` so `sage -coverage` (and other people) knows it's been doctest.

For patchbot:

Apply: trac_14898-pbw_folded-ts.patch



---

archive/issue_comments_182816.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI think that your last modification addresses the problem of the product that I was talking about; you did not make any other \"theoretical\" modification if I am right. In that case, I think I am ok.\n\nMatthieu",
    "created_at": "2013-09-01T18:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182816",
    "user": "https://github.com/sagetrac-deneufchatel"
}
```

<div id="comment:50" align="right">comment:50</div>

I think that your last modification addresses the problem of the product that I was talking about; you did not make any other "theoretical" modification if I am right. In that case, I think I am ok.

Matthieu



---

archive/issue_comments_182817.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nYep, no changes except the output format. Then I'll give you the honor of setting this to a positive review.\n\nBest,\n\nTravis",
    "created_at": "2013-09-01T18:46:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182817",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Yep, no changes except the output format. Then I'll give you the honor of setting this to a positive review.

Best,

Travis



---

archive/issue_events_209951.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-09-01T19:17:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209951"
}
```



---

archive/issue_events_209952.json:
```json
{
    "actor": "https://github.com/sagetrac-deneufchatel",
    "created_at": "2013-09-01T19:17:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209952"
}
```



---

archive/issue_comments_182818.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThere is a doctest failure:\n\n```\nsage -t devel/sage/sage/rings/ring.pyx\n**********************************************************************\nFile \"devel/sage/sage/rings/ring.pyx\", line 403, in sage.rings.ring.Ring.category\nFailed example:\n    FreeAlgebra(QQ, 3, 'x').category() # todo: use a ring which is not an algebra!\nExpected:\n    Category of algebras over Rational Field\nGot:\n    Category of algebras with basis over Rational Field\n**********************************************************************\n```",
    "created_at": "2013-09-03T09:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182818",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

There is a doctest failure:

```
sage -t devel/sage/sage/rings/ring.pyx
**********************************************************************
File "devel/sage/sage/rings/ring.pyx", line 403, in sage.rings.ring.Ring.category
Failed example:
    FreeAlgebra(QQ, 3, 'x').category() # todo: use a ring which is not an algebra!
Expected:
    Category of algebras over Rational Field
Got:
    Category of algebras with basis over Rational Field
**********************************************************************
```



---

archive/issue_events_209953.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-03T09:49:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209953"
}
```



---

archive/issue_events_209954.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-03T09:49:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209954"
}
```



---

archive/issue_comments_182819.json:
```json
{
    "body": "Attachment: **[trac_14898-pbw_folded-ts.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)**",
    "created_at": "2013-09-03T17:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182819",
    "user": "https://github.com/tscrim"
}
```

Attachment: **[trac_14898-pbw_folded-ts.patch.gz](https://github.com/sagemath/sage/files/ticket14898/trac_14898-pbw_folded-ts.patch.gz)**



---

archive/issue_events_209955.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T17:31:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209955"
}
```



---

archive/issue_events_209956.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-09-03T17:31:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209956"
}
```



---

archive/issue_comments_182820.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nFixed.\n\nFor patchbot:\n\nApply: trac_14898-pbw_folded-ts.patch",
    "created_at": "2013-09-03T17:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182820",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:54" align="right">comment:54</div>

Fixed.

For patchbot:

Apply: trac_14898-pbw_folded-ts.patch



---

archive/issue_events_209957.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209957"
}
```



---

archive/issue_events_209958.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209958"
}
```



---

archive/issue_events_209959.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:36:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209959"
}
```



---

archive/issue_events_209960.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:36:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14898#event-209960"
}
```



---

archive/issue_comments_182821.json:
```json
{
    "body": "Merged: **sage-5.13.beta0**",
    "created_at": "2013-10-02T06:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14898#issuecomment-182821",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.beta0**
