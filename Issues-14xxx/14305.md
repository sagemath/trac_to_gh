# Issue 14305: Doctest: Immediate simplifications of symbolic powers

archive/issues_014101.json:
```json
{
    "assignees": [],
    "body": "in Sage 5.7 we get:\n\n```\nsage: sqrt(x^2).simplify_radical()           \nx\n```\nThis is wrong (consider x=-1 for example). Even:\n\n```\nsage: assume(x<0)\nsage: sqrt(x^2).simplify_radical()\nx\n```\nPreviously it was \n\n```\nsage: sqrt(x^2).simplify_radical()\nabs(x)\n```\n\nNote: this invalidates a whole part of our book (in french) about Sage at\nhttp://sagebook.gforge.inria.fr/\n\nDepends on #23325\n\nAssignee: **@burcin**\n\nCC:  @orlitzky @burcin @rwst\n\nBranch/Commit: **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14305_\n\n",
    "closed_at": "2017-10-29T10:32:25Z",
    "created_at": "2013-03-19T09:20:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Doctest: Immediate simplifications of symbolic powers",
    "type": "issue",
    "updated_at": "2017-10-29T10:32:25Z",
    "url": "https://github.com/sagemath/sage/issues/14305",
    "user": "https://github.com/zimmermann6"
}
```
in Sage 5.7 we get:

```
sage: sqrt(x^2).simplify_radical()           
x
```
This is wrong (consider x=-1 for example). Even:

```
sage: assume(x<0)
sage: sqrt(x^2).simplify_radical()
x
```
Previously it was 

```
sage: sqrt(x^2).simplify_radical()
abs(x)
```

Note: this invalidates a whole part of our book (in french) about Sage at
http://sagebook.gforge.inria.fr/

Depends on #23325

Assignee: **@burcin**

CC:  @orlitzky @burcin @rwst

Branch/Commit: **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**

Reviewer: **Jeroen Demeyer**

Author: **Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/14305_





---

archive/issue_events_178676.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-03-19T09:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178676"
}
```



---

archive/issue_events_178677.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-03-19T09:20:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "component: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178677"
}
```



---

archive/issue_events_178678.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-03-19T09:20:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178678"
}
```



---

archive/issue_events_178679.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2013-03-19T09:20:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178679"
}
```



---

archive/issue_comments_173972.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nRegarding these three tickets (#14305, #14306, #14308 (thanks for the pointer, Paul!)) perhaps it would be good to get that book in the standard documentation under fr/ so that it can be part of doctests?  Just a brainstorm, perhaps it is not a good idea for various reasons.",
    "created_at": "2013-03-19T13:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173972",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'>Comment 1:</a>
Regarding these three tickets (#14305, #14306, #14308 (thanks for the pointer, Paul!)) perhaps it would be good to get that book in the standard documentation under fr/ so that it can be part of doctests?  Just a brainstorm, perhaps it is not a good idea for various reasons.



---

archive/issue_comments_173973.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,8 @@\n in Sage 5.7 we get:\n \n ```\n-sage: (x^2).simplify_radical()           \n-x^2\n+sage: sqrt(x^2).simplify_radical()           \n+x\n ```\n This is wrong (consider x=-1 for example). Even:\n \n@@ -11,6 +11,12 @@\n sage: sqrt(x^2).simplify_radical()\n x\n ```\n+Previously it was \n+\n+```\n+sage: sqrt(x^2).simplify_radical()\n+abs(x)\n+```\n \n Note: this invalidates a whole part of our book (in french) about Sage at\n http://sagebook.gforge.inria.fr/\n``````\n",
    "created_at": "2013-03-19T13:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173973",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,8 @@
 in Sage 5.7 we get:
 
 ```
-sage: (x^2).simplify_radical()           
-x^2
+sage: sqrt(x^2).simplify_radical()           
+x
 ```
 This is wrong (consider x=-1 for example). Even:
 
@@ -11,6 +11,12 @@
 sage: sqrt(x^2).simplify_radical()
 x
 ```
+Previously it was 
+
+```
+sage: sqrt(x^2).simplify_radical()
+abs(x)
+```
 
 Note: this invalidates a whole part of our book (in french) about Sage at
 http://sagebook.gforge.inria.fr/
``````




---

archive/issue_comments_173974.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis is the problem.\n\n```\n(%i1) radcan(sqrt(x^2));\n(%o1)                               abs(x)\n(%i2) domain:complex;\n(%o2)                               complex\n(%i3) radcan(sqrt(x^2));\n(%o3)                                  x\n```\nExcept this was not exposed before, apparently - it is the case in older Sage as well.  This is due to #12780.",
    "created_at": "2013-03-19T13:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173974",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'>Comment 2:</a>
This is the problem.

```
(%i1) radcan(sqrt(x^2));
(%o1)                               abs(x)
(%i2) domain:complex;
(%o2)                               complex
(%i3) radcan(sqrt(x^2));
(%o3)                                  x
```
Except this was not exposed before, apparently - it is the case in older Sage as well.  This is due to #12780.



---

archive/issue_comments_173975.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nKarl-Dieter, I guess you mean #14308 instead of #14307?\n\nYes of course, in fact some chapters are already included, see `tests/french_book`.\n\nOther chapters are waiting for work or reviewers: #10983, #11745. Feel free to help!\n\nPaul",
    "created_at": "2013-03-19T13:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173975",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:3'>Comment 3:</a>
Karl-Dieter, I guess you mean #14308 instead of #14307?

Yes of course, in fact some chapters are already included, see `tests/french_book`.

Other chapters are waiting for work or reviewers: #10983, #11745. Feel free to help!

Paul



---

archive/issue_comments_173976.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\n> This is the problem.\n> \n> ```\n> (%i1) radcan(sqrt(x^2));\n> (%o1)                               abs(x)\n> (%i2) domain:complex;\n> (%o2)                               complex\n> (%i3) radcan(sqrt(x^2));\n> (%o3)                                  x\n> ```\n\nBy the way, I should point out that Maxima folks probably won't consider this a bug, for the same reasons as discussed in the past on other tickets, and expressed best by [Richard Fateman here](http://ask.sagemath.org/question/767/simplification-errors-in-simple-expressions).  But if we don't want this, we'll have to figure out how to deal with this.\n> Except this was not exposed before, apparently - it is the case in older Sage as well.  This is due to #12780.\n\nI've also posted a comment there, hopefully mjo or someone else will respond.",
    "created_at": "2013-03-19T13:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173976",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'>Comment 4:</a>
> This is the problem.
> 
> ```
> (%i1) radcan(sqrt(x^2));
> (%o1)                               abs(x)
> (%i2) domain:complex;
> (%o2)                               complex
> (%i3) radcan(sqrt(x^2));
> (%o3)                                  x
> ```

By the way, I should point out that Maxima folks probably won't consider this a bug, for the same reasons as discussed in the past on other tickets, and expressed best by [Richard Fateman here](http://ask.sagemath.org/question/767/simplification-errors-in-simple-expressions).  But if we don't want this, we'll have to figure out how to deal with this.
> Except this was not exposed before, apparently - it is the case in older Sage as well.  This is due to #12780.

I've also posted a comment there, hopefully mjo or someone else will respond.



---

archive/issue_comments_173977.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nany news on this ticket?\n\nPaul",
    "created_at": "2013-05-07T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173977",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'>Comment 5:</a>
any news on this ticket?

Paul



---

archive/issue_comments_173978.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nJeroen asked a similar question a few months ago:\n\nhttps://groups.google.com/forum/?fromgroups=#!topic/sage-support/jhCJujRtNA4/discussion\n\nMaxima should notice that `x` is real (if you make the assumption), but it doesn't. The simplification of `sqrt(x^2)` to `abs(x)` relies on the \"simplification domain\" in Maxima being set to `real` -- in fact, if I remember correctly, that's the only thing the simplification domain does affect. To get the answer from sage <5.6, you'd need,\n\n```\nsage: maxima_lib.eval('domain: real;')\n'real'\nsage: sqrt(x^2).simplify()            \nabs(x)\n```\n\nIt sucks that you have to do that, and we should really add either a global method or a property of `maxima_lib` that lets you change it. That's one solution.\n\nA better approach would be to notice when an expression contains only real variables, and to set the simplification domain appropriately. This could be done in either Maxima or Sage (pynac/ginac), but probably belongs in both. Symbols in sage have an associated domain, too:\n\n```\nsage: x = SR.symbol('x', domain='real')\nsage: sqrt(x^2)\nsqrt(x^2)\n```\n\nThis never passes through Maxima, so arguably, Sage should simplify it if we can convince Maxima to do the same thing. But it's not at all easy to determine whether an expression is real; otherwise, I would have written it a long time ago! I mainly work over the reals myself and would love to have a solution that doesn't involve manually fooling with Maxima.",
    "created_at": "2013-05-07T15:01:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173978",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:6'>Comment 6:</a>
Jeroen asked a similar question a few months ago:

https://groups.google.com/forum/?fromgroups=#!topic/sage-support/jhCJujRtNA4/discussion

Maxima should notice that `x` is real (if you make the assumption), but it doesn't. The simplification of `sqrt(x^2)` to `abs(x)` relies on the "simplification domain" in Maxima being set to `real` -- in fact, if I remember correctly, that's the only thing the simplification domain does affect. To get the answer from sage <5.6, you'd need,

```
sage: maxima_lib.eval('domain: real;')
'real'
sage: sqrt(x^2).simplify()            
abs(x)
```

It sucks that you have to do that, and we should really add either a global method or a property of `maxima_lib` that lets you change it. That's one solution.

A better approach would be to notice when an expression contains only real variables, and to set the simplification domain appropriately. This could be done in either Maxima or Sage (pynac/ginac), but probably belongs in both. Symbols in sage have an associated domain, too:

```
sage: x = SR.symbol('x', domain='real')
sage: sqrt(x^2)
sqrt(x^2)
```

This never passes through Maxima, so arguably, Sage should simplify it if we can convince Maxima to do the same thing. But it's not at all easy to determine whether an expression is real; otherwise, I would have written it a long time ago! I mainly work over the reals myself and would love to have a solution that doesn't involve manually fooling with Maxima.



---

archive/issue_comments_173979.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nbefore #12780, the default domain was 'real', and `sqrt(x^2).simplify_radical()` was correctly simplified to `abs(x)`.\n\nAfter #12780, the default domain is that of Maxima (which is 'complex' in Sage 5.9), and `sqrt(x^2).simplify_radical()` is incorrectly simplified to `x`.\n\nI believe the authors of #12780 should fix that issue.\n\nPaul",
    "created_at": "2013-05-07T18:43:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173979",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'>Comment 7:</a>
before #12780, the default domain was 'real', and `sqrt(x^2).simplify_radical()` was correctly simplified to `abs(x)`.

After #12780, the default domain is that of Maxima (which is 'complex' in Sage 5.9), and `sqrt(x^2).simplify_radical()` is incorrectly simplified to `x`.

I believe the authors of #12780 should fix that issue.

Paul



---

archive/issue_comments_173980.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@zimmermann6](#comment%3A7):\n> before #12780, the default domain was 'real', and `sqrt(x^2).simplify_radical()` was correctly simplified to `abs(x)`.\n> \n\n\nThis isn't true. Before #12780, the domain everywhere in Sage *except the `simplify_radical` function* was 'complex'. The `simplify_radical` function would secretly change the domain to 'real', call `radcan()`, and then switch the domain back to 'complex'.\n\nThere is no simplification of `sqrt(x^2)` that is equal to `abs(x)`, unless you know that `x` is real. Everywhere else in Sage, `x` is complex. Before sage-5.7, you got what you want, but you want a wrong answer.\n\nI realize there's no other nice way to get the answer you want (that sucks, I want it too, it's not my fault, etc.), but that's not a good justification for adding back wrong behavior.",
    "created_at": "2013-05-07T20:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173980",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@zimmermann6](#comment%3A7):
> before #12780, the default domain was 'real', and `sqrt(x^2).simplify_radical()` was correctly simplified to `abs(x)`.
> 


This isn't true. Before #12780, the domain everywhere in Sage *except the `simplify_radical` function* was 'complex'. The `simplify_radical` function would secretly change the domain to 'real', call `radcan()`, and then switch the domain back to 'complex'.

There is no simplification of `sqrt(x^2)` that is equal to `abs(x)`, unless you know that `x` is real. Everywhere else in Sage, `x` is complex. Before sage-5.7, you got what you want, but you want a wrong answer.

I realize there's no other nice way to get the answer you want (that sucks, I want it too, it's not my fault, etc.), but that's not a good justification for adding back wrong behavior.



---

archive/issue_comments_173981.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@orlitzky](#comment%3A8):\n> There is no simplification of `sqrt(x^2)` that is equal to `abs(x)`, unless you know that `x` is real. Everywhere else in Sage, `x` is complex. Before sage-5.7, you got what you want, but you want a wrong answer.\n\nI'm not sure you can dispose of the problem just by declaring it invalid. We do accept `assume(x<0)` and with that assumption in place the answer we get back really IS wrong (since the assumption implies that `x` is real). I know we're not going to fix/improve maxima's assumption system any time soon, but there are cases where this bug is going to be a \"won't fix\" rather than an \"invalid\".",
    "created_at": "2013-05-07T20:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173981",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@orlitzky](#comment%3A8):
> There is no simplification of `sqrt(x^2)` that is equal to `abs(x)`, unless you know that `x` is real. Everywhere else in Sage, `x` is complex. Before sage-5.7, you got what you want, but you want a wrong answer.

I'm not sure you can dispose of the problem just by declaring it invalid. We do accept `assume(x<0)` and with that assumption in place the answer we get back really IS wrong (since the assumption implies that `x` is real). I know we're not going to fix/improve maxima's assumption system any time soon, but there are cases where this bug is going to be a "won't fix" rather than an "invalid".



---

archive/issue_comments_173982.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nWe also accept `assume('x is a very pretty boy')`, so I'm not sure we should use that as our guide!\n\nI'm not disagreeing that there should be an easy way to do this. Maxima should just simplify it when `x` is assumed real. That's probably the first bug I would target to get it fixed properly.\n\nA second step would be to have ginac or pynac perform the same simplification on expressions of the simple form `sqrt(x^2)` where `x` is a single symbol and the domain of `x` is 'real'.\n\nFinally (this is the most work), Maxima could be made to recognize when an expression `y` is real, and then, `simplify()` could turn `sqrt(y^2)` into `abs(y)`. Determining whether an expression is real or not seems rather complicated, though.",
    "created_at": "2013-05-08T00:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173982",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'>Comment 10:</a>
We also accept `assume('x is a very pretty boy')`, so I'm not sure we should use that as our guide!

I'm not disagreeing that there should be an easy way to do this. Maxima should just simplify it when `x` is assumed real. That's probably the first bug I would target to get it fixed properly.

A second step would be to have ginac or pynac perform the same simplification on expressions of the simple form `sqrt(x^2)` where `x` is a single symbol and the domain of `x` is 'real'.

Finally (this is the most work), Maxima could be made to recognize when an expression `y` is real, and then, `simplify()` could turn `sqrt(y^2)` into `abs(y)`. Determining whether an expression is real or not seems rather complicated, though.



---

archive/issue_comments_173983.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nPlease take a look at #14630 which provides an easy way to get this simplification.",
    "created_at": "2013-05-23T00:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173983",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'>Comment 11:</a>
Please take a look at #14630 which provides an easy way to get this simplification.



---

archive/issue_comments_173984.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nThanks, that looks like a good step to take.  Am I correct in saying it doesn't fix the [point Nils makes](#comment%3A9) about `assume(x<0)` (that is, when one doesn't use #14630, since the typical user would think it wasn't relevant...)?",
    "created_at": "2013-05-23T13:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173984",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'>Comment 12:</a>
Thanks, that looks like a good step to take.  Am I correct in saying it doesn't fix the [point Nils makes](#comment%3A9) about `assume(x<0)` (that is, when one doesn't use #14630, since the typical user would think it wasn't relevant...)?



---

archive/issue_comments_173985.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@kcrisman](#comment%3A12):\n> Thanks, that looks like a good step to take.  Am I correct in saying it doesn't fix the [point Nils makes](#comment%3A9) about `assume(x<0)` (that is, when one doesn't use #14630, since the typical user would think it wasn't relevant...)?\n\nCorrect, #14630 just provides a way to get the simplification in the description, as an alternative to setting the Maxima domain manually.",
    "created_at": "2013-05-24T16:49:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173985",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@kcrisman](#comment%3A12):
> Thanks, that looks like a good step to take.  Am I correct in saying it doesn't fix the [point Nils makes](#comment%3A9) about `assume(x<0)` (that is, when one doesn't use #14630, since the typical user would think it wasn't relevant...)?

Correct, #14630 just provides a way to get the simplification in the description, as an alternative to setting the Maxima domain manually.



---

archive/issue_events_178680.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178680"
}
```



---

archive/issue_events_178681.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178681"
}
```



---

archive/issue_comments_173986.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nwhile trying to see how we could tell Maxima that `x` is real after `assume(x>0)`, I noticed that the examples with `assume(x,'real')` in Sage are fake:\n\n1) in `misc/functional.py` we have:\n\n```\n        sage: a, b, c = var(\"a, b, c\")                                          \n        sage: assume((a, 'real'), (b, 'real'), (c, 'real'))                     \n        sage: z = a + b*I                                                       \n        sage: bool(norm(z).simplify() == a^2 + b^2)                             \n        True\n```\nbut the same works without `assume`:\n\n```\n+--------------------------------------------------------------------+\n| Sage Version 5.11, Release Date: 2013-08-13                        |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n+--------------------------------------------------------------------+\nsage: a, b, c = var(\"a, b, c\")\nsage: z = a + b*I\nsage: norm(z).simplify()\na^2 + b^2\n```\n\n2) in `symbolic/expression.pyx` we have\n\n```\n            sage: a,b = var('a,b')\n            sage: assume((a, 'real'), (b, 'real'))\n            sage: f = a + b*I\n            sage: f.rectform()\n            a + I*b\n```\nand again it works without `assume`:\n\n```\n+--------------------------------------------------------------------+\n| Sage Version 5.11, Release Date: 2013-08-13                        |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n+--------------------------------------------------------------------+\nsage: a,b = var('a,b')\nsage: f = a + b*I\nsage: f.rectform()\na + I*b\n```\nPaul",
    "created_at": "2013-08-23T14:31:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173986",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:15'>Comment 15:</a>
while trying to see how we could tell Maxima that `x` is real after `assume(x>0)`, I noticed that the examples with `assume(x,'real')` in Sage are fake:

1) in `misc/functional.py` we have:

```
        sage: a, b, c = var("a, b, c")                                          
        sage: assume((a, 'real'), (b, 'real'), (c, 'real'))                     
        sage: z = a + b*I                                                       
        sage: bool(norm(z).simplify() == a^2 + b^2)                             
        True
```
but the same works without `assume`:

```
+--------------------------------------------------------------------+
| Sage Version 5.11, Release Date: 2013-08-13                        |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
+--------------------------------------------------------------------+
sage: a, b, c = var("a, b, c")
sage: z = a + b*I
sage: norm(z).simplify()
a^2 + b^2
```

2) in `symbolic/expression.pyx` we have

```
            sage: a,b = var('a,b')
            sage: assume((a, 'real'), (b, 'real'))
            sage: f = a + b*I
            sage: f.rectform()
            a + I*b
```
and again it works without `assume`:

```
+--------------------------------------------------------------------+
| Sage Version 5.11, Release Date: 2013-08-13                        |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
+--------------------------------------------------------------------+
sage: a,b = var('a,b')
sage: f = a + b*I
sage: f.rectform()
a + I*b
```
Paul



---

archive/issue_comments_173987.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nInteresting.  Maybe that is a function of having upgraded Maxima or something?  I presume that this wasn't the case at some time, but presumptions can be presumptuous.",
    "created_at": "2013-08-23T15:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173987",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'>Comment 16:</a>
Interesting.  Maybe that is a function of having upgraded Maxima or something?  I presume that this wasn't the case at some time, but presumptions can be presumptuous.



---

archive/issue_comments_173988.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nmaybe `simplify` and `rectform` secretly change the domain of variables to the real domain (as `simplify_radical` previously did)?\n\nPaul",
    "created_at": "2013-08-23T16:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173988",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:17'>Comment 17:</a>
maybe `simplify` and `rectform` secretly change the domain of variables to the real domain (as `simplify_radical` previously did)?

Paul



---

archive/issue_comments_173989.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nNo, that is not it - `simplify` certainly doesn't, and `rectform` is just\n\n```\nreturn self.maxima_methods().rectform()\n```\nSorry, that would have been easier to deal with.  I particularly don't like the `rectform` example working without assuming real.",
    "created_at": "2013-08-23T18:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173989",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'>Comment 18:</a>
No, that is not it - `simplify` certainly doesn't, and `rectform` is just

```
return self.maxima_methods().rectform()
```
Sorry, that would have been easier to deal with.  I particularly don't like the `rectform` example working without assuming real.



---

archive/issue_comments_173990.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI remember the first example, from #12845. This is the full test:\n\n```\nsage: a, b, c = var(\"a, b, c\")\nsage: assume((a, 'real'), (b, 'real'), (c, 'real'))\nsage: z = a + b*I\nsage: bool(norm(z).simplify() == a^2 + b^2)\nTrue\nsage: norm(a + b).simplify()\na^2 + 2*a*b + b^2\nsage: v = vector([a, b, c])\nsage: bool(norm(v).simplify() == sqrt(a^2 + b^2 + c^2))\nTrue\nsage: forget()\n```\n\nThe assumptions aren't needed for the first result, but they are for the last one (the norm of the vector).\n\nThe `rectform()` test is also mine, but the reasoning I've forgotten.",
    "created_at": "2013-08-24T16:54:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173990",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'>Comment 19:</a>
I remember the first example, from #12845. This is the full test:

```
sage: a, b, c = var("a, b, c")
sage: assume((a, 'real'), (b, 'real'), (c, 'real'))
sage: z = a + b*I
sage: bool(norm(z).simplify() == a^2 + b^2)
True
sage: norm(a + b).simplify()
a^2 + 2*a*b + b^2
sage: v = vector([a, b, c])
sage: bool(norm(v).simplify() == sqrt(a^2 + b^2 + c^2))
True
sage: forget()
```

The assumptions aren't needed for the first result, but they are for the last one (the norm of the vector).

The `rectform()` test is also mine, but the reasoning I've forgotten.



---

archive/issue_comments_173991.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\n> The assumptions aren't needed for the first result, but they are for the last one (the norm of the vector).\n\nmaybe then the first test could be removed, if unrelated to `assume`?\nOr at least the `assume` call moved after the first test?\n\nAnyway the following is very annoying:\n\n```\nsage: (x*conjugate(x)).simplify()\nx^2\n```\nPaul",
    "created_at": "2013-08-26T08:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173991",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:20'>Comment 20:</a>
> The assumptions aren't needed for the first result, but they are for the last one (the norm of the vector).

maybe then the first test could be removed, if unrelated to `assume`?
Or at least the `assume` call moved after the first test?

Anyway the following is very annoying:

```
sage: (x*conjugate(x)).simplify()
x^2
```
Paul



---

archive/issue_comments_173992.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\n> Anyway the following is very annoying:\n> \n> ```\n> sage: (x*conjugate(x)).simplify()\n> x^2\n> ```\n\nWow, agreed.  Unfortunately, Maxima needs to declare this.\n\n```\nsage: assume(x,'complex')\nsage: (x*conjugate(x)).simplify()\nx*conjugate(x)\n```\n\nI guess a possible workaround would be to have all SR variables declared `complex` in Maxima when first starting Maxima, and then thereafter... but it would be very hackish and slow.",
    "created_at": "2013-08-26T13:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173992",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'>Comment 21:</a>
> Anyway the following is very annoying:
> 
> ```
> sage: (x*conjugate(x)).simplify()
> x^2
> ```

Wow, agreed.  Unfortunately, Maxima needs to declare this.

```
sage: assume(x,'complex')
sage: (x*conjugate(x)).simplify()
x*conjugate(x)
```

I guess a possible workaround would be to have all SR variables declared `complex` in Maxima when first starting Maxima, and then thereafter... but it would be very hackish and slow.



---

archive/issue_comments_173993.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nTurns out that it's possible to get all variables used so far in Maxima with `values`, and one could do a blanket `declare` on all of them.  (Of course, one might not want to do this to all of them...)  Fateman also has the following enigmatic response to me on the Maxima list.\n\n```\nI think the understanding of complex variables is at best spotty, and if you want to do \"a LOT\" of\nthings with them you better check out exactly what Maxima does, and perhaps even  make it work\nwith names that have no special properties.\n```\nAnyway, I really don't want to go back to assuming things in Maxima on every variable defined in Sage (or even every SR variable) but I think we might have to go that way.  Maybe there is a flag we could set as an underscore attribute in the SR vars indicating whether it has been declared complex in Maxima yet, which would be dealt with appropriately for ones which aren't complex, or have been assumed real, etc. - i.e., the *next* time one went into Maxima, they would be in a queue that was then declared complex. Not sure how hawkish that would be, but hopefully at least not slowing down Pynac variables appreciably.",
    "created_at": "2013-08-26T16:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173993",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'>Comment 22:</a>
Turns out that it's possible to get all variables used so far in Maxima with `values`, and one could do a blanket `declare` on all of them.  (Of course, one might not want to do this to all of them...)  Fateman also has the following enigmatic response to me on the Maxima list.

```
I think the understanding of complex variables is at best spotty, and if you want to do "a LOT" of
things with them you better check out exactly what Maxima does, and perhaps even  make it work
with names that have no special properties.
```
Anyway, I really don't want to go back to assuming things in Maxima on every variable defined in Sage (or even every SR variable) but I think we might have to go that way.  Maybe there is a flag we could set as an underscore attribute in the SR vars indicating whether it has been declared complex in Maxima yet, which would be dealt with appropriately for ones which aren't complex, or have been assumed real, etc. - i.e., the *next* time one went into Maxima, they would be in a queue that was then declared complex. Not sure how hawkish that would be, but hopefully at least not slowing down Pynac variables appreciably.



---

archive/issue_comments_173994.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\n> a possible workaround would be to have all SR variables declared complex in Maxima\n\nindeed, maybe we could declare each new variable as complex whenever `var` is called (without `domain` argument or with `domain='complex'`).\nThis is by the way what the documentation of `var` says:\n\n```\nsage: var?\n...\n   By default, var returns a complex variable. To define real or\n   positive variables we can specify the domain as:\n```\nMaybe we can add a call to `assume` in the function `symbol` of `symbolic/ring.pyx`?\n\nPaul",
    "created_at": "2013-08-27T07:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173994",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:23'>Comment 23:</a>
> a possible workaround would be to have all SR variables declared complex in Maxima

indeed, maybe we could declare each new variable as complex whenever `var` is called (without `domain` argument or with `domain='complex'`).
This is by the way what the documentation of `var` says:

```
sage: var?
...
   By default, var returns a complex variable. To define real or
   positive variables we can specify the domain as:
```
Maybe we can add a call to `assume` in the function `symbol` of `symbolic/ring.pyx`?

Paul



---

archive/issue_comments_173995.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nUnfortunately, that would \n* start up Maxima the first time, which takes quite a while\n* use Maxima each and every time we create a symbolic variable, which would take some time\n\nI don't think people would be pleased with the slowdown this would cause.  That's why I'm wondering whether there might be some other workaround along these lines but less draconian.  Variables *are* complex by default, just not when we send them to Maxima.",
    "created_at": "2013-08-27T12:05:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173995",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'>Comment 24:</a>
Unfortunately, that would 
* start up Maxima the first time, which takes quite a while
* use Maxima each and every time we create a symbolic variable, which would take some time

I don't think people would be pleased with the slowdown this would cause.  That's why I'm wondering whether there might be some other workaround along these lines but less draconian.  Variables *are* complex by default, just not when we send them to Maxima.



---

archive/issue_comments_173996.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nthen we could record the list of created variables (with corresponding domains), and each time a `simplify` function from Maxima would be called, we could make the corresponding assumptions in Maxima, along the lines of what you suggest in comment [comment:22].\n\nPaul",
    "created_at": "2013-08-27T12:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173996",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:25'>Comment 25:</a>
then we could record the list of created variables (with corresponding domains), and each time a `simplify` function from Maxima would be called, we could make the corresponding assumptions in Maxima, along the lines of what you suggest in comment [comment:22].

Paul



---

archive/issue_comments_173997.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nThe problem with the Maxima interface mixing up variable domains is #6862. This could be fixed with #8734 by changing the Maxima conversion (in the libmaxima interface) to work directly off the pynac expression tree (instead of going through strings / parsers) and set the corresponding flag in the temporary variables it creates. I'm not sure if anybody has time to implement this though.",
    "created_at": "2013-08-28T17:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173997",
    "user": "https://github.com/burcin"
}
```

<a id='comment:26'>Comment 26:</a>
The problem with the Maxima interface mixing up variable domains is #6862. This could be fixed with #8734 by changing the Maxima conversion (in the libmaxima interface) to work directly off the pynac expression tree (instead of going through strings / parsers) and set the corresponding flag in the temporary variables it creates. I'm not sure if anybody has time to implement this though.



---

archive/issue_comments_173998.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@burcin](#comment%3A26):\n> The problem with the Maxima interface mixing up variable domains is #6862. This could be fixed with #8734 by changing the Maxima conversion (in the libmaxima interface) to work directly off the pynac expression tree (instead of going through strings / parsers)\n\nAnd that is largely available already via the functions `sage.interfaces.maxima_lib.sr_to_max` and `sage.interfaces.maxima_lib.max_to_sr`, which already get used for, for instance, limits and integrals. Currently it asks the strings-based translator (once) for how to convert, but the information is all there to convert variables more intelligently.\n\nOf course, a formula translation routine can't go and purposely change the global state of maxima (you wouldn't know when to convert back!), but it could store required global settings somewhere else, so that they can be applied when the actual functionality is called upon and undone afterwards.\n\nImplementing this will indeed be a tedious and thankless job. It would feel a lot more worthwhile if first almost all of calculus were moved to using `sr_to_max`. Then is gets easier to start letting maxima_lib have different conversion semantics than maxima.",
    "created_at": "2013-09-03T18:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173998",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@burcin](#comment%3A26):
> The problem with the Maxima interface mixing up variable domains is #6862. This could be fixed with #8734 by changing the Maxima conversion (in the libmaxima interface) to work directly off the pynac expression tree (instead of going through strings / parsers)

And that is largely available already via the functions `sage.interfaces.maxima_lib.sr_to_max` and `sage.interfaces.maxima_lib.max_to_sr`, which already get used for, for instance, limits and integrals. Currently it asks the strings-based translator (once) for how to convert, but the information is all there to convert variables more intelligently.

Of course, a formula translation routine can't go and purposely change the global state of maxima (you wouldn't know when to convert back!), but it could store required global settings somewhere else, so that they can be applied when the actual functionality is called upon and undone afterwards.

Implementing this will indeed be a tedious and thankless job. It would feel a lot more worthwhile if first almost all of calculus were moved to using `sr_to_max`. Then is gets easier to start letting maxima_lib have different conversion semantics than maxima.



---

archive/issue_events_178682.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178682"
}
```



---

archive/issue_events_178683.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178683"
}
```



---

archive/issue_events_178684.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178684"
}
```



---

archive/issue_events_178685.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178685"
}
```



---

archive/issue_events_178686.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178686"
}
```



---

archive/issue_events_178687.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178687"
}
```



---

archive/issue_comments_173999.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nChanging the description, as this isn't really about `simplify_radical`/its successor any more.  In fact, I'm not really sure what this one is about, but I feel like #14630 and #6862 don't cover everything mentioned here.",
    "created_at": "2014-12-06T20:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-173999",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:31'>Comment 31:</a>
Changing the description, as this isn't really about `simplify_radical`/its successor any more.  In fact, I'm not really sure what this one is about, but I feel like #14630 and #6862 don't cover everything mentioned here.



---

archive/issue_events_178688.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-06T20:22:44Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "title_is": "Clarify assumptions and domains in Maxima",
    "title_was": "bug in simplify_radical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178688"
}
```



---

archive/issue_comments_174000.json:
```json
{
    "body": "Dependencies: **pynac-0.7.9**",
    "created_at": "2017-06-23T14:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174000",
    "user": "https://github.com/rwst"
}
```

Dependencies: **pynac-0.7.9**



---

archive/issue_comments_174001.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@orlitzky](#comment%3A10):\n> A second step would be to have ginac or pynac perform the same simplification on expressions of the simple form `sqrt(x^2)` where `x` is a single symbol and the domain of `x` is 'real'.\n\nI believe this is fixed in Pynac master:\nhttps://github.com/pynac/pynac/commit/0a3979a4ed8bdb3ed1be4c6ee5d328a9b2c690b8\n\n```\nsage: sqrt(x^2)\nsqrt(x^2)\nsage: x = SR.symbol('x', domain='real')\nsage: sqrt(x^2)\nabs(x)\nsage: forget()\nsage: assume(x<0)\nsage: sqrt(x^2)\n-x\nsage: sqrt(x^4)\nx^2\nsage: forget()\nsage: x = SR.symbol('x', domain='real')\nsage: sqrt(x^4)\nx^2\nsage: sqrt(sin(x)^2)\nabs(sin(x))\nsage: sqrt((x+1)^2)\nabs(x + 1)\nsage: (x^3)^(1/3)\n(x^3)^(1/3)\nsage: (x^4)^(1/4)\nabs(x)\nsage: (x^8)^(1/4)\nx^2\nsage: (x^-4)^(1/4)\n1/abs(x)\nsage: (x^-8)^(1/4)\nx^(-2)\nsage: forget()\nsage: assume(x<0)\nsage: sqrt((x-1)^2)\n-x + 1\n```\nThis is immediate expansion. You can see it's not restricted to the inner exponent `2`, and it also works on arbitrary expressions not just symbols.\n\nThe ticket should add the above (or any additions) as doctests.",
    "created_at": "2017-06-23T14:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174001",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@orlitzky](#comment%3A10):
> A second step would be to have ginac or pynac perform the same simplification on expressions of the simple form `sqrt(x^2)` where `x` is a single symbol and the domain of `x` is 'real'.

I believe this is fixed in Pynac master:
https://github.com/pynac/pynac/commit/0a3979a4ed8bdb3ed1be4c6ee5d328a9b2c690b8

```
sage: sqrt(x^2)
sqrt(x^2)
sage: x = SR.symbol('x', domain='real')
sage: sqrt(x^2)
abs(x)
sage: forget()
sage: assume(x<0)
sage: sqrt(x^2)
-x
sage: sqrt(x^4)
x^2
sage: forget()
sage: x = SR.symbol('x', domain='real')
sage: sqrt(x^4)
x^2
sage: sqrt(sin(x)^2)
abs(sin(x))
sage: sqrt((x+1)^2)
abs(x + 1)
sage: (x^3)^(1/3)
(x^3)^(1/3)
sage: (x^4)^(1/4)
abs(x)
sage: (x^8)^(1/4)
x^2
sage: (x^-4)^(1/4)
1/abs(x)
sage: (x^-8)^(1/4)
x^(-2)
sage: forget()
sage: assume(x<0)
sage: sqrt((x-1)^2)
-x + 1
```
This is immediate expansion. You can see it's not restricted to the inner exponent `2`, and it also works on arbitrary expressions not just symbols.

The ticket should add the above (or any additions) as doctests.



---

archive/issue_comments_174002.json:
```json
{
    "body": "Changed dependencies from **pynac-0.7.9** to **#23325**",
    "created_at": "2017-06-26T07:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174002",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **pynac-0.7.9** to **#23325**



---

archive/issue_comments_174003.json:
```json
{
    "body": "Branch: **[u/rws/clarify_assumptions_and_domains_in_maxima](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/clarify_assumptions_and_domains_in_maxima)**",
    "created_at": "2017-09-06T05:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174003",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/clarify_assumptions_and_domains_in_maxima](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/clarify_assumptions_and_domains_in_maxima)**



---

archive/issue_comments_174004.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2017-09-06T05:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174004",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_events_178689.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-06T05:35:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178689"
}
```



---

archive/issue_events_178690.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-06T05:35:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178690"
}
```



---

archive/issue_events_178691.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-06T05:35:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178691"
}
```



---

archive/issue_comments_174005.json:
```json
{
    "body": "Commit: **[6125bd6](https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65)**",
    "created_at": "2017-09-06T05:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174005",
    "user": "https://github.com/rwst"
}
```

Commit: **[6125bd6](https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65)**



---

archive/issue_events_178692.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-09-06T05:35:51Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "title_is": "Doctest: Immediate simplifications of symbolic powers",
    "title_was": "Clarify assumptions and domains in Maxima",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178692"
}
```



---

archive/issue_comments_174006.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65\">6125bd6</a></td><td><code>14305: Doctest: Immediate simplifications of symbolic powers</code></td></tr></table>\n",
    "created_at": "2017-09-06T05:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174006",
    "user": "https://github.com/rwst"
}
```

<a id='comment:35'>Comment 35:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65">6125bd6</a></td><td><code>14305: Doctest: Immediate simplifications of symbolic powers</code></td></tr></table>




---

archive/issue_comments_174007.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\na small typo:\n`Immediate simplification are applied`\nshould be:\n`Immediate simplifications are applied`.",
    "created_at": "2017-09-06T06:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174007",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:36'>Comment 36:</a>
a small typo:
`Immediate simplification are applied`
should be:
`Immediate simplifications are applied`.



---

archive/issue_comments_174008.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890\">e5d5ba0</a></td><td><code>14305: fix typo</code></td></tr></table>\n",
    "created_at": "2017-09-06T07:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174008",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>Comment 37:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890">e5d5ba0</a></td><td><code>14305: fix typo</code></td></tr></table>




---

archive/issue_comments_174009.json:
```json
{
    "body": "Changed commit from **[6125bd6](https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65)** to **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**",
    "created_at": "2017-09-06T07:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174009",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6125bd6](https://github.com/sagemath/sagetrac-mirror/commit/6125bd6f28f36c29752c3bf7cfba0c206652ec65)** to **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**



---

archive/issue_comments_174010.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-10-25T13:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174010",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_178693.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T13:25:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178693"
}
```



---

archive/issue_events_178694.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T13:25:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178694"
}
```



---

archive/issue_comments_174011.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThanks.",
    "created_at": "2017-10-25T13:33:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174011",
    "user": "https://github.com/rwst"
}
```

<a id='comment:39'>Comment 39:</a>
Thanks.



---

archive/issue_comments_174012.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nI wonder why `(x<sup>3)</sup>(1/3)` is not simplified for real `x` though...",
    "created_at": "2017-10-25T13:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174012",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>Comment 40:</a>
I wonder why `(x<sup>3)</sup>(1/3)` is not simplified for real `x` though...



---

archive/issue_comments_174013.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\ntry `x=-1`...",
    "created_at": "2017-10-25T13:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174013",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:41'>Comment 41:</a>
try `x=-1`...



---

archive/issue_comments_174014.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\n\n```\nsage: var(x, domain='real')\nx\nsage: (x^3)^(1/3)\n(x^3)^(1/3)\nsage: assume(x > 0)\nsage: (x^3)^(1/3)\nx\n```",
    "created_at": "2017-10-25T13:45:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174014",
    "user": "https://github.com/rwst"
}
```

<a id='comment:42'>Comment 42:</a>

```
sage: var(x, domain='real')
x
sage: (x^3)^(1/3)
(x^3)^(1/3)
sage: assume(x > 0)
sage: (x^3)^(1/3)
x
```



---

archive/issue_comments_174015.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nI don't get this. Why should it matter whether `x < 0` or `x > 0`?\n\nWhy is it valid to say that `1^(1/3) = 1` but not `(-1)^(1/3) = -1` for real numbers?",
    "created_at": "2017-10-25T13:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174015",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'>Comment 43:</a>
I don't get this. Why should it matter whether `x < 0` or `x > 0`?

Why is it valid to say that `1^(1/3) = 1` but not `(-1)^(1/3) = -1` for real numbers?



---

archive/issue_comments_174016.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nI opened https://github.com/pynac/pynac/issues/283",
    "created_at": "2017-10-25T14:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174016",
    "user": "https://github.com/rwst"
}
```

<a id='comment:44'>Comment 44:</a>
I opened https://github.com/pynac/pynac/issues/283



---

archive/issue_comments_174017.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nz<sup>1/n</sup> for z a complex number is defined as the principal branch, which is that having the least argument, see for example https://en.wikipedia.org/wiki/Nth_root.\n\nThus the square root of -1 is I, having argument pi/2, whereas -I has argument 3*pi/2.\n\nThe cube root of -1 is 1/2 + I*sqrt(3)/2, having argument pi/3.",
    "created_at": "2017-10-25T14:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174017",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:45'>Comment 45:</a>
z<sup>1/n</sup> for z a complex number is defined as the principal branch, which is that having the least argument, see for example https://en.wikipedia.org/wiki/Nth_root.

Thus the square root of -1 is I, having argument pi/2, whereas -I has argument 3*pi/2.

The cube root of -1 is 1/2 + I*sqrt(3)/2, having argument pi/3.



---

archive/issue_comments_174018.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nReplying to [@zimmermann6](#comment%3A45):\n> The cube root of -1 is 1/2 + I*sqrt(3)/2, having argument pi/3.\n\nOne or three cube roots of -1 exist?",
    "created_at": "2017-10-25T14:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174018",
    "user": "https://github.com/rwst"
}
```

<a id='comment:46'>Comment 46:</a>
Replying to [@zimmermann6](#comment%3A45):
> The cube root of -1 is 1/2 + I*sqrt(3)/2, having argument pi/3.

One or three cube roots of -1 exist?



---

archive/issue_comments_174019.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nthere are three complex numbers `t` such that `t^3=z`, but when you write `z^(1/3)`, the computer algebra system must choose one of them, for example to evaluate numerically, and the usual choice is the principal branch.\n\nI recommend reading the paper \"Branch Cuts in Computer Algebra\" by Adam Dingle and Richard Fateman.",
    "created_at": "2017-10-25T14:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174019",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:47'>Comment 47:</a>
there are three complex numbers `t` such that `t^3=z`, but when you write `z^(1/3)`, the computer algebra system must choose one of them, for example to evaluate numerically, and the usual choice is the principal branch.

I recommend reading the paper "Branch Cuts in Computer Algebra" by Adam Dingle and Richard Fateman.



---

archive/issue_comments_174020.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nReplying to [@zimmermann6](#comment%3A47):\n> there are three complex numbers `t` such that `t^3=z`, but when you write `z^(1/3)`, the computer algebra system must choose one of them, for example to evaluate numerically, and the usual choice is the principal branch.\n> \n> I recommend reading the paper \"Branch Cuts in Computer Algebra\" by Adam Dingle and Richard Fateman.\n\nI'm not evaluating numerically, `t^3=z` does not per se represent a function, just an expression. If your argument were true, I could not even solve for -1.",
    "created_at": "2017-10-25T15:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174020",
    "user": "https://github.com/rwst"
}
```

<a id='comment:48'>Comment 48:</a>
Replying to [@zimmermann6](#comment%3A47):
> there are three complex numbers `t` such that `t^3=z`, but when you write `z^(1/3)`, the computer algebra system must choose one of them, for example to evaluate numerically, and the usual choice is the principal branch.
> 
> I recommend reading the paper "Branch Cuts in Computer Algebra" by Adam Dingle and Richard Fateman.

I'm not evaluating numerically, `t^3=z` does not per se represent a function, just an expression. If your argument were true, I could not even solve for -1.



---

archive/issue_comments_174021.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nI mean why do I even argument, Jeroen is a better math, so I trust him when he objects.",
    "created_at": "2017-10-25T15:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174021",
    "user": "https://github.com/rwst"
}
```

<a id='comment:49'>Comment 49:</a>
I mean why do I even argument, Jeroen is a better math, so I trust him when he objects.



---

archive/issue_comments_174022.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nPaul, maybe the problem is that you transfer the fact that RR is in CC to that \"expressions with real variables\" behave like \"expressions with complex variables\"?",
    "created_at": "2017-10-25T15:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174022",
    "user": "https://github.com/rwst"
}
```

<a id='comment:50'>Comment 50:</a>
Paul, maybe the problem is that you transfer the fact that RR is in CC to that "expressions with real variables" behave like "expressions with complex variables"?



---

archive/issue_comments_174023.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@rwst](#comment%3A49):\n> Jeroen is a better math, so I trust him when he objects.\n\nNot sure why you say that. I understand Paul's reasoning. It's hard to tell who is right. If only variables have a domain (as opposed to constants), then `(-1)^(1/3)` must indeed evaluate to a complex number because we can't guess whether the `-1` represents the real or complex `-1`.",
    "created_at": "2017-10-25T15:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174023",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@rwst](#comment%3A49):
> Jeroen is a better math, so I trust him when he objects.

Not sure why you say that. I understand Paul's reasoning. It's hard to tell who is right. If only variables have a domain (as opposed to constants), then `(-1)^(1/3)` must indeed evaluate to a complex number because we can't guess whether the `-1` represents the real or complex `-1`.



---

archive/issue_comments_174024.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nA complex function is not necessarily a complex-variable function, that's maybe the mistake I made.",
    "created_at": "2017-10-25T15:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174024",
    "user": "https://github.com/rwst"
}
```

<a id='comment:52'>Comment 52:</a>
A complex function is not necessarily a complex-variable function, that's maybe the mistake I made.



---

archive/issue_comments_174025.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nindeed we cannot know in advance whether `-1` represents a real or complex number.\nHowever, another point is that the \"simplication rule\" should be consistent between the real and complex numbers: when a complex number `z` tends to the real number `-1`, you want that `z^(1/3)` tends to `(-1)^(1/3)`, except maybe on a line (called the branch cut) going out from 0. The principal branch gives this consistency.",
    "created_at": "2017-10-25T15:56:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174025",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:53'>Comment 53:</a>
indeed we cannot know in advance whether `-1` represents a real or complex number.
However, another point is that the "simplication rule" should be consistent between the real and complex numbers: when a complex number `z` tends to the real number `-1`, you want that `z^(1/3)` tends to `(-1)^(1/3)`, except maybe on a line (called the branch cut) going out from 0. The principal branch gives this consistency.



---

archive/issue_comments_174026.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nThis is messy largely because we have never decided on what `sqrt` or e.g. `x^(1/3)` is supposed to do, particularly when applied to a symbolic expression.\n\n* Is it a function from the real numbers to the real numbers (choose the positive root)?\n* Is it a function from the complex numbers to the complex numbers (choose the principal branch)?\n* Is the codomain of `sqrt` the same as a \"domain\" of its argument? For example, if `x` is a variable with `domain=real`, should `sqrt(x)` be an expression whose domain is `\"real\"`?\n* Do we want `sqrt` and friends to be functions at all? When solving equations, it'd be nice if we had access to both square roots.\n\netc.\n\nIf you ask five different people, you'll get five different answers. I'm wary of any \"simplification\" that might return an incorrect result to any of those people: simplification should be unambiguous and obviously correct. Any other more-powerful but less-straightforward operation should be called something else, like we've done with `x.canonicalize_radical()`.",
    "created_at": "2017-10-25T16:02:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174026",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:54'>Comment 54:</a>
This is messy largely because we have never decided on what `sqrt` or e.g. `x^(1/3)` is supposed to do, particularly when applied to a symbolic expression.

* Is it a function from the real numbers to the real numbers (choose the positive root)?
* Is it a function from the complex numbers to the complex numbers (choose the principal branch)?
* Is the codomain of `sqrt` the same as a "domain" of its argument? For example, if `x` is a variable with `domain=real`, should `sqrt(x)` be an expression whose domain is `"real"`?
* Do we want `sqrt` and friends to be functions at all? When solving equations, it'd be nice if we had access to both square roots.

etc.

If you ask five different people, you'll get five different answers. I'm wary of any "simplification" that might return an incorrect result to any of those people: simplification should be unambiguous and obviously correct. Any other more-powerful but less-straightforward operation should be called something else, like we've done with `x.canonicalize_radical()`.



---

archive/issue_comments_174027.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nReplying to [@rwst](#comment%3A49):\n> I mean why do I even argument, Jeroen is a better math, so I trust him when he objects.\n\nI just reread that and yes I forgot to add \"than me\", opening unintended interpretations.",
    "created_at": "2017-10-25T16:17:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174027",
    "user": "https://github.com/rwst"
}
```

<a id='comment:55'>Comment 55:</a>
Replying to [@rwst](#comment%3A49):
> I mean why do I even argument, Jeroen is a better math, so I trust him when he objects.

I just reread that and yes I forgot to add "than me", opening unintended interpretations.



---

archive/issue_comments_174028.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\n> If you ask five different people, you'll get five different answers. I'm wary of any \"simplification\" that might return an incorrect result to any of those people: simplification should be unambiguous and obviously correct. Any other more-powerful but less-straightforward operation should be called something else, like we've done with x.canonicalize_radical().\n\nCorrect, this whole thread is exactly the same thing.  Basically, is `sqrt(x)` a symbol or a function?  If you want long (and undoubtedly correct in at least one interpretation) answers to this, ask Fateman :-) with whom we had long discussions about it.",
    "created_at": "2017-10-25T17:26:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174028",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:56'>Comment 56:</a>
> If you ask five different people, you'll get five different answers. I'm wary of any "simplification" that might return an incorrect result to any of those people: simplification should be unambiguous and obviously correct. Any other more-powerful but less-straightforward operation should be called something else, like we've done with x.canonicalize_radical().

Correct, this whole thread is exactly the same thing.  Basically, is `sqrt(x)` a symbol or a function?  If you want long (and undoubtedly correct in at least one interpretation) answers to this, ask Fateman :-) with whom we had long discussions about it.



---

archive/issue_comments_174029.json:
```json
{
    "body": "Changed branch from **[u/rws/clarify_assumptions_and_domains_in_maxima](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/clarify_assumptions_and_domains_in_maxima)** to **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**",
    "created_at": "2017-10-29T10:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14305#issuecomment-174029",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/clarify_assumptions_and_domains_in_maxima](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/clarify_assumptions_and_domains_in_maxima)** to **[e5d5ba0](https://github.com/sagemath/sagetrac-mirror/commit/e5d5ba0b7b43dd21852984d6f43c28ef334d5890)**



---

archive/issue_events_178695.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-29T10:32:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178695"
}
```



---

archive/issue_events_178696.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3e7031cef8d95f559d9ac0a75b90d4e702ccf221",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-29T10:32:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14305",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14305#event-178696"
}
```
