# Issue 14927: NSym (NCSF): Verschiebung, doc improvements, meet and join of compositions

archive/issues_014927.json:
```json
{
    "body": "CC:  @tscrim sage-combinat @zabrocki @nthiery\n\nKeywords: sage-combinat, NSym, NCSF, symmetric functions\n\nThis patch does the following:\n\n* Implement the Verschiebung map on NSym (the map adjoint to the Frobenius on QSym implemented in #15094). The current implementation handles all bases by coercion to the homogeneous one. I planned to implement the Psi, Phi, R and L bases separately, but I am unable to (see below).\n\n* Add a `to_descent_algebra` map to the newly implemented (#14981) descent algebra. The difference between the signature of my map, `to_descent_algebra(self, n)`, and that of the old map to the symmetric group algebra, `to_symmetric_group_algebra(self)`, is intentional: My map takes a noncommutative symmetric function `self` and an integer `n` and projects the `n`-th homogeneous component of `self` on the `n`-th descent algebra; the map `to_symmetric_group_algebra` takes just a noncommutative symmetric function `self` and projects it on the `deg(self)`-th symmetric group algebra if `self` is homogeneous, otherwise throws an exception. If `self` is 0, then it outputs the int 0 (because 0 doesn't have a degree). In my opinion, my signature is the better one, not least because it handles 0 correctly.\n\n* Clean up some of the doc and add definitions for the most important bases. The inaptly named \"MultiplicativeBasesOnGroupLikeElements\" class now has a more explanatory docstring. The incorrect claim about m_to_s_stat always outputting an integer has been removed. Dependency on the base ring being a QQ-algebra has been made clearer.\n\n* The meet and the join of two compositions wrt the refinement order have been implemented.\n\nHere are things I wanted to change/add but got too confused:\n\n* I don't understand why the internal product is implemented in `generic_basis_code.py` rather than `ncsf.py`. Isn't `generic_basis_code.py` for methods shared between QSym and NSym? There is no internal product on QSym.\n\n* This here is a doctest which has been around before me:\n\n```\n                sage: N = NonCommutativeSymmetricFunctions(QQ)\n                sage: S = N.complete()\n                sage: S.internal_product\n                Generic endomorphism of Non-Commutative Symmetric Functions over the Rational Field in the Complete basis\n```\nThe output makes no sense: The internal product is not an endomorphism of anything.\n\n* I am trying to overshadow the `verschiebung` function I implemented on a generic NSym basis by a specific implementation on the ribbon basis. So I've added it under `class ElementMethods:` in the `class Ribbon`. But it doesn't get precedence over the generic implementation at runtime! What am I doing wrong?\n\n* [Fixed by Travis, #15170.] This is probably for Travis: is it intentional that the `to_symmetric_group_algebra` method in `descent_algebra.py` is defined only on the D-basis, rather than on every basis or globally on the whole descent algebra?\n\nApply:\n\n* [attachment:trac_15164-NSym-verschiebung-dg.patch\u200b]\n* [attachment:trac_15164-review-ts.patch\u200b]\n\nIssue created by migration from https://trac.sagemath.org/ticket/15164\n\n",
    "closed_at": "2013-10-12T10:22:00Z",
    "created_at": "2013-09-06T02:20:59Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "NSym (NCSF): Verschiebung, doc improvements, meet and join of compositions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14927",
    "user": "https://github.com/darijgr"
}
```
CC:  @tscrim sage-combinat @zabrocki @nthiery

Keywords: sage-combinat, NSym, NCSF, symmetric functions

This patch does the following:

* Implement the Verschiebung map on NSym (the map adjoint to the Frobenius on QSym implemented in #15094). The current implementation handles all bases by coercion to the homogeneous one. I planned to implement the Psi, Phi, R and L bases separately, but I am unable to (see below).

* Add a `to_descent_algebra` map to the newly implemented (#14981) descent algebra. The difference between the signature of my map, `to_descent_algebra(self, n)`, and that of the old map to the symmetric group algebra, `to_symmetric_group_algebra(self)`, is intentional: My map takes a noncommutative symmetric function `self` and an integer `n` and projects the `n`-th homogeneous component of `self` on the `n`-th descent algebra; the map `to_symmetric_group_algebra` takes just a noncommutative symmetric function `self` and projects it on the `deg(self)`-th symmetric group algebra if `self` is homogeneous, otherwise throws an exception. If `self` is 0, then it outputs the int 0 (because 0 doesn't have a degree). In my opinion, my signature is the better one, not least because it handles 0 correctly.

* Clean up some of the doc and add definitions for the most important bases. The inaptly named "MultiplicativeBasesOnGroupLikeElements" class now has a more explanatory docstring. The incorrect claim about m_to_s_stat always outputting an integer has been removed. Dependency on the base ring being a QQ-algebra has been made clearer.

* The meet and the join of two compositions wrt the refinement order have been implemented.

Here are things I wanted to change/add but got too confused:

* I don't understand why the internal product is implemented in `generic_basis_code.py` rather than `ncsf.py`. Isn't `generic_basis_code.py` for methods shared between QSym and NSym? There is no internal product on QSym.

* This here is a doctest which has been around before me:

```
                sage: N = NonCommutativeSymmetricFunctions(QQ)
                sage: S = N.complete()
                sage: S.internal_product
                Generic endomorphism of Non-Commutative Symmetric Functions over the Rational Field in the Complete basis
```
The output makes no sense: The internal product is not an endomorphism of anything.

* I am trying to overshadow the `verschiebung` function I implemented on a generic NSym basis by a specific implementation on the ribbon basis. So I've added it under `class ElementMethods:` in the `class Ribbon`. But it doesn't get precedence over the generic implementation at runtime! What am I doing wrong?

* [Fixed by Travis, #15170.] This is probably for Travis: is it intentional that the `to_symmetric_group_algebra` method in `descent_algebra.py` is defined only on the D-basis, rather than on every basis or globally on the whole descent algebra?

Apply:

* [attachment:trac_15164-NSym-verschiebung-dg.patch​]
* [attachment:trac_15164-review-ts.patch​]

Issue created by migration from https://trac.sagemath.org/ticket/15164





---

archive/issue_comments_190416.json:
```json
{
    "body": "Attachment [trac_15164-NSym-verschiebung-dg.patch](tarball://root/attachments/some-uuid/ticket15164/trac_15164-NSym-verschiebung-dg.patch) by @darijgr created at 2013-09-06 02:21:48",
    "created_at": "2013-09-06T02:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190416",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_15164-NSym-verschiebung-dg.patch](tarball://root/attachments/some-uuid/ticket15164/trac_15164-NSym-verschiebung-dg.patch) by @darijgr created at 2013-09-06 02:21:48



---

archive/issue_comments_190417.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-06T02:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190417",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_190418.json:
```json
{
    "body": "Hey Darij,\n\nI only defined `to_symmetric_group_algebra()` on the `D` basis since that is where the natural coercion occurred. It looks like I forgot to implement a method to extend it to the other bases via coercion.",
    "created_at": "2013-09-06T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190418",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

I only defined `to_symmetric_group_algebra()` on the `D` basis since that is where the natural coercion occurred. It looks like I forgot to implement a method to extend it to the other bases via coercion.



---

archive/issue_comments_190419.json:
```json
{
    "body": "Hi Travis,\n\nOK. Who of us should fix it? And in this ticket or in a new one?",
    "created_at": "2013-09-06T21:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190419",
    "user": "https://github.com/darijgr"
}
```

Hi Travis,

OK. Who of us should fix it? And in this ticket or in a new one?



---

archive/issue_comments_190420.json:
```json
{
    "body": "I'll take care of it in #15170.",
    "created_at": "2013-09-06T21:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190420",
    "user": "https://github.com/tscrim"
}
```

I'll take care of it in #15170.



---

archive/issue_comments_190421.json:
```json
{
    "body": "I will review this in the next few days. Promise.",
    "created_at": "2013-09-14T01:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190421",
    "user": "https://github.com/tscrim"
}
```

I will review this in the next few days. Promise.



---

archive/issue_comments_190422.json:
```json
{
    "body": "Hey Darij,\n\nHere's my review patch which adds `sup() / inf()` aliases for `join() / meet()` (resp.), moves the description block for `internal_product`, and makes some minor docstring tweaks elsewhere. If you're happy with my changes, go ahead and set this to positive review.\n\nBest,\n\nTravis",
    "created_at": "2013-09-17T15:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190422",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

Here's my review patch which adds `sup() / inf()` aliases for `join() / meet()` (resp.), moves the description block for `internal_product`, and makes some minor docstring tweaks elsewhere. If you're happy with my changes, go ahead and set this to positive review.

Best,

Travis



---

archive/issue_comments_190423.json:
```json
{
    "body": "Hi Travis,\n\nthanks for the review -- there's only a few things I'd like you to fix.\n\n1) The line\n\n```\nLet us check the defining property in degree `4`::\n```\nis not good. While the duality between internal coproduct and internal product is currently the only thing explaining the internal product in the docstring, it is not the usual definition of the internal product, and should not be called its \"defining property\". Just say \"the duality between internal product and internal coproduct\" instead.\n\n2) \n\n```\n                `i_1`, `i_2`, \\ldots, `i_k` are divisible by `n`, and to `0` \n```\nThe \\ldots here are outside of mathmode; do they work?\n\n3)\n\n```\n                integer `r` with `n \\mid r`, it satisfes \n```\nPlease put back the \\nmid that you replaced by \\mid here.\n\nI won't come home until in the evening, and I won't have much time by then, which is why I'm not doing these changes myself. Sorry. Once you're done, please set this to positive_review.",
    "created_at": "2013-09-17T16:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190423",
    "user": "https://github.com/darijgr"
}
```

Hi Travis,

thanks for the review -- there's only a few things I'd like you to fix.

1) The line

```
Let us check the defining property in degree `4`::
```
is not good. While the duality between internal coproduct and internal product is currently the only thing explaining the internal product in the docstring, it is not the usual definition of the internal product, and should not be called its "defining property". Just say "the duality between internal product and internal coproduct" instead.

2) 

```
                `i_1`, `i_2`, \ldots, `i_k` are divisible by `n`, and to `0` 
```
The \ldots here are outside of mathmode; do they work?

3)

```
                integer `r` with `n \mid r`, it satisfes 
```
Please put back the \nmid that you replaced by \mid here.

I won't come home until in the evening, and I won't have much time by then, which is why I'm not doing these changes myself. Sorry. Once you're done, please set this to positive_review.



---

archive/issue_comments_190424.json:
```json
{
    "body": "Attachment [trac_15164-review-ts.patch](tarball://root/attachments/some-uuid/ticket15164/trac_15164-review-ts.patch) by @tscrim created at 2013-09-17 17:39:29",
    "created_at": "2013-09-17T17:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190424",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_15164-review-ts.patch](tarball://root/attachments/some-uuid/ticket15164/trac_15164-review-ts.patch) by @tscrim created at 2013-09-17 17:39:29



---

archive/issue_comments_190425.json:
```json
{
    "body": "Done all 3 (I replaced it with `\\not\\mid` since apparently `\\nmid` has some mathjax issues). Thanks for your work Darij.",
    "created_at": "2013-09-17T17:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190425",
    "user": "https://github.com/tscrim"
}
```

Done all 3 (I replaced it with `\not\mid` since apparently `\nmid` has some mathjax issues). Thanks for your work Darij.



---

archive/issue_comments_190426.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-17T17:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190426",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_190427.json:
```json
{
    "body": "Thank you for reviewing this. I've moved my unanswered questions into #15205, if you are interested.",
    "created_at": "2013-09-17T20:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190427",
    "user": "https://github.com/darijgr"
}
```

Thank you for reviewing this. I've moved my unanswered questions into #15205, if you are interested.



---

archive/issue_comments_190428.json:
```json
{
    "body": "for the patchbot if it is still listening:\n\napply trac_15164-NSym-verschiebung-dg.patch\u200b trac_15164-review-ts.patch\u200b",
    "created_at": "2013-09-17T21:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190428",
    "user": "https://github.com/darijgr"
}
```

for the patchbot if it is still listening:

apply trac_15164-NSym-verschiebung-dg.patch​ trac_15164-review-ts.patch​



---

archive/issue_events_043732.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14927#event-43732"
}
```



---

archive/issue_comments_190429.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-12T10:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14927#issuecomment-190429",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_043733.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-12T10:22:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14927",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14927#event-43733"
}
```
