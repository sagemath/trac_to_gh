# Issue 14265: Compile Python with -D__C99FEATURES__ on Solaris

archive/issues_014061.json:
```json
{
    "assignees": [],
    "body": "The new doctesting framework (#12415) on Solaris gives lots of warnings like\n\n```\nsage -t --long devel/sage/sage/plot/plot.py\n**********************************************************************\nFile \"devel/sage/sage/plot/plot.py\", line 236, in sage.plot.plot\nFailed example:\n    (g1+g2).show(ticks=pi/6, tick_formatter=pi)  # show their sum, nicely formatted\nExpected nothing\nGot:\n    Warning: invalid value encountered in isinf\n    Warning: invalid value encountered in isinf\n    Warning: invalid value encountered in isinf\n    [...]\n    Warning: invalid value encountered in isinf\n    Warning: invalid value encountered in isinf\n    Warning: invalid value encountered in isinf\n```\nThese warnings are actually harmless and are indirectly caused by the fact that Python doesn't find the `isinf()` C library function. From `spkg/logs/python-2.7.3.p5.log`:\n\n```\n[...]\nchecking whether isinf is declared... no\nchecking whether isnan is declared... yes\nchecking whether isfinite is declared... no\n[...]\n```\nThese functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled with -D__C99FEATURES__. So we should add a compiler flag to fix this.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n\nTo test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n\n### python-2.7.3.p6 (Jeroen Demeyer, 24 March 2013)\n* Trac #14265: Compile with -D__C99FEATURES__ on Solaris.\n* Remove workaround for http://bugs.python.org/issue6954\n  (which is fixed upstream).\n* Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for\n  consistency with other packages and allow it to be set by the user.\n* Add check that the ctypes and readline (required for IPython) and\n  socket (required for setuptools) modules can be imported.\n* Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds\n  this flag for Clang).\n\n\nAssignee: **@jdemeyer**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.9.beta3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14265_\n\n",
    "closed_at": "2013-03-29T04:05:35Z",
    "created_at": "2013-03-13T12:47:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Compile Python with -D__C99FEATURES__ on Solaris",
    "type": "issue",
    "updated_at": "2013-03-29T04:05:35Z",
    "url": "https://github.com/sagemath/sage/issues/14265",
    "user": "https://github.com/jdemeyer"
}
```
The new doctesting framework (#12415) on Solaris gives lots of warnings like

```
sage -t --long devel/sage/sage/plot/plot.py
**********************************************************************
File "devel/sage/sage/plot/plot.py", line 236, in sage.plot.plot
Failed example:
    (g1+g2).show(ticks=pi/6, tick_formatter=pi)  # show their sum, nicely formatted
Expected nothing
Got:
    Warning: invalid value encountered in isinf
    Warning: invalid value encountered in isinf
    Warning: invalid value encountered in isinf
    [...]
    Warning: invalid value encountered in isinf
    Warning: invalid value encountered in isinf
    Warning: invalid value encountered in isinf
```
These warnings are actually harmless and are indirectly caused by the fact that Python doesn't find the `isinf()` C library function. From `spkg/logs/python-2.7.3.p5.log`:

```
[...]
checking whether isinf is declared... no
checking whether isnan is declared... yes
checking whether isfinite is declared... no
[...]
```
These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled with -D__C99FEATURES__. So we should add a compiler flag to fix this.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)

To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).

### python-2.7.3.p6 (Jeroen Demeyer, 24 March 2013)
* Trac #14265: Compile with -D__C99FEATURES__ on Solaris.
* Remove workaround for http://bugs.python.org/issue6954
  (which is fixed upstream).
* Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for
  consistency with other packages and allow it to be set by the user.
* Add check that the ctypes and readline (required for IPython) and
  socket (required for setuptools) modules can be imported.
* Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds
  this flag for Clang).


Assignee: **@jdemeyer**

Reviewer: **Fran√ßois Bissey**

Author: **Jeroen Demeyer**

Merged: **sage-5.9.beta3**

_Issue created by migration from https://trac.sagemath.org/ticket/14265_





---

archive/issue_events_184432.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T12:47:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184432"
}
```



---

archive/issue_events_184433.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T12:47:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184433"
}
```



---

archive/issue_events_184434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T12:47:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184434"
}
```



---

archive/issue_events_184435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T12:47:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184435"
}
```



---

archive/issue_events_184436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T14:10:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184436"
}
```



---

archive/issue_comments_173100.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,12 @@\n **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n \n To test: build this spkg and rebuild numpy.\n+\n+### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)\n+* Trac #14265: Compile Python in C99 mode.\n+* Remove workaround for http://bugs.python.org/issue6954\n+  (which is fixed upstream).\n+* Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for\n+  consistency with other packages and allow it to be set by the user.\n+* Add check that the readline module can be imported.\n+\n``````\n",
    "created_at": "2013-03-13T14:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173100",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,12 @@
 **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
 
 To test: build this spkg and rebuild numpy.
+
+### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)
+* Trac #14265: Compile Python in C99 mode.
+* Remove workaround for http://bugs.python.org/issue6954
+  (which is fixed upstream).
+* Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for
+  consistency with other packages and allow it to be set by the user.
+* Add check that the readline module can be imported.
+
``````




---

archive/issue_comments_173101.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNote that this also affects any Python extension module built with distutils, as the latter (by default) use the flags Python was built with.  (This also applies to C++ files btw. ...)\n\nSo for testing, one should at least rebuild the whole Sage library as well (e.g. with `./sage -ba-force`).\n\n\n\n\nSolaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).",
    "created_at": "2013-03-14T03:29:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173101",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'>Comment 3:</a>
Note that this also affects any Python extension module built with distutils, as the latter (by default) use the flags Python was built with.  (This also applies to C++ files btw. ...)

So for testing, one should at least rebuild the whole Sage library as well (e.g. with `./sage -ba-force`).




Solaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).



---

archive/issue_comments_173102.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@nexttime](#comment%3A3):\n> Solaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).\n\nI think GCC never defaults to gnu99/c99. It must be that glibc always declares isinf(), even in C89 mode.",
    "created_at": "2013-03-14T08:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173102",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@nexttime](#comment%3A3):
> Solaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).

I think GCC never defaults to gnu99/c99. It must be that glibc always declares isinf(), even in C89 mode.



---

archive/issue_comments_173103.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@jdemeyer](#comment%3A4):\n> Replying to [@nexttime](#comment%3A3):\n> > Solaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).\n\n> I think GCC never defaults to gnu99/c99. It must be that glibc always declares isinf(), even in C89 mode.\n\nConfused that with `__STDC__`, which GCC defines on anything but Solaris by default.\n\nGLIBC's `math.h` only defines `isinf()` etc. if `__USE_ISOC99` is defined, but that's apparently \"frequently\" the case (see `features.h`.)",
    "created_at": "2013-03-14T09:33:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173103",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@jdemeyer](#comment%3A4):
> Replying to [@nexttime](#comment%3A3):
> > Solaris is the only OS I'm aware of (and Sage supports) where GCC does **not** default to `gnu99` (for C input files).

> I think GCC never defaults to gnu99/c99. It must be that glibc always declares isinf(), even in C89 mode.

Confused that with `__STDC__`, which GCC defines on anything but Solaris by default.

GLIBC's `math.h` only defines `isinf()` etc. if `__USE_ISOC99` is defined, but that's apparently "frequently" the case (see `features.h`.)



---

archive/issue_comments_173104.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nOn `sage.math` at least, `isinf()` is declared in `gnu89` mode, but not in `c89` mode (which is a sensible choice).",
    "created_at": "2013-03-14T09:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
On `sage.math` at least, `isinf()` is declared in `gnu89` mode, but not in `c89` mode (which is a sensible choice).



---

archive/issue_comments_173105.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@jdemeyer](#comment%3A6):\n> On `sage.math` at least, `isinf()` is declared in `gnu89` mode, but not in `c89` mode (which is a sensible choice).\n\nSame on 10.04.4.",
    "created_at": "2013-03-14T09:50:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173105",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@jdemeyer](#comment%3A6):
> On `sage.math` at least, `isinf()` is declared in `gnu89` mode, but not in `c89` mode (which is a sensible choice).

Same on 10.04.4.



---

archive/issue_comments_173106.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@nexttime](#comment%3A3):\n> Note that this also affects any Python extension module built with distutils, as the latter (by default) use the flags Python was built with.  (This also applies to C++ files btw. ...)\n\nTrue, it applies to C++ also, but this doesn't seem to cause problems:\n\n```\ngcc -fno-strict-aliasing -std=gnu99 -fwrapv -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/release/merger/sage-5.9.beta0/local/include -I/release/merger/sage-5.9.beta0/local/include/csage -I/release/merger/sage-5.9.beta0/devel/sage/sage/ext -I/release/merger/sage-5.9.beta0/local/include/python2.7 -c sage/rings/number_field/number_field_element.cpp -o build/temp.linux-x86_64-2.7/sage/rings/number_field/number_field_element.o -w\ncc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]\ng++ -pthread -shared -L/release/merger/sage-5.9.beta0/local/lib build/temp.linux-x86_64-2.7/sage/rings/number_field/number_field_element.o -L/release/merger/sage-5.9.beta0/local/lib -L/release/merger/sage-5.9.beta0/local/lib -lcsage -lntl -lgmp -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/rings/number_field/number_field_element.so\n```",
    "created_at": "2013-03-14T10:01:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173106",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@nexttime](#comment%3A3):
> Note that this also affects any Python extension module built with distutils, as the latter (by default) use the flags Python was built with.  (This also applies to C++ files btw. ...)

True, it applies to C++ also, but this doesn't seem to cause problems:

```
gcc -fno-strict-aliasing -std=gnu99 -fwrapv -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/release/merger/sage-5.9.beta0/local/include -I/release/merger/sage-5.9.beta0/local/include/csage -I/release/merger/sage-5.9.beta0/devel/sage/sage/ext -I/release/merger/sage-5.9.beta0/local/include/python2.7 -c sage/rings/number_field/number_field_element.cpp -o build/temp.linux-x86_64-2.7/sage/rings/number_field/number_field_element.o -w
cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]
g++ -pthread -shared -L/release/merger/sage-5.9.beta0/local/lib build/temp.linux-x86_64-2.7/sage/rings/number_field/number_field_element.o -L/release/merger/sage-5.9.beta0/local/lib -L/release/merger/sage-5.9.beta0/local/lib -lcsage -lntl -lgmp -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/rings/number_field/number_field_element.so
```



---

archive/issue_comments_173107.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\n\n```sh\n$ gcc-4.6.3 -std=gnu99 -c -x c++ /dev/null -o /dev/null\ncc1plus: warning: command line option \u2018-std=gnu99\u2019 is valid for C/ObjC but not for C++ [enabled by default]\n```\n\n:-)",
    "created_at": "2013-03-14T11:02:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173107",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'>Comment 9:</a>

```sh
$ gcc-4.6.3 -std=gnu99 -c -x c++ /dev/null -o /dev/null
cc1plus: warning: command line option ‚Äò-std=gnu99‚Äô is valid for C/ObjC but not for C++ [enabled by default]
```

:-)



---

archive/issue_comments_173108.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nMore weirdness:\n\n```\njdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null\ncc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]\ncc1plus: warning: command line option '-std=gnu99' is valid for C/ObjC but not for C++ [enabled by default]\n```\n\n```\njdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null -w\ncc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]\n```\n\nAnyway, it's a strange thing that Python uses `CC` and `CFLAGS` to compile C++ code.",
    "created_at": "2013-03-14T12:28:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173108",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
More weirdness:

```
jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null
cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]
cc1plus: warning: command line option '-std=gnu99' is valid for C/ObjC but not for C++ [enabled by default]
```

```
jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null -w
cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]
```

Anyway, it's a strange thing that Python uses `CC` and `CFLAGS` to compile C++ code.



---

archive/issue_comments_173109.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@jdemeyer](#comment%3A10):\n> More weirdness:\n> \n> ```\n> jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null\n> cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]\n> cc1plus: warning: command line option '-std=gnu99' is valid for C/ObjC but not for C++ [enabled by default]\n> ```\n> \n> ```\n> jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null -w\n> cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]\n> ```\n> \n> Anyway, it's a strange thing that Python uses `CC` and `CFLAGS` to compile C++ code.\n\nYeah, I'll one day fix these (by removing the invalid options if `lang==\"c++\"`) ...",
    "created_at": "2013-03-14T12:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173109",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@jdemeyer](#comment%3A10):
> More weirdness:
> 
> ```
> jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null
> cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]
> cc1plus: warning: command line option '-std=gnu99' is valid for C/ObjC but not for C++ [enabled by default]
> ```
> 
> ```
> jdemeyer@sage:~$ gcc -std=gnu99 -Wstrict-prototypes -c -x c++ /dev/null -o /dev/null -w
> cc1plus: warning: command line option '-Wstrict-prototypes' is valid for C/ObjC but not for C++ [enabled by default]
> ```
> 
> Anyway, it's a strange thing that Python uses `CC` and `CFLAGS` to compile C++ code.

Yeah, I'll one day fix these (by removing the invalid options if `lang=="c++"`) ...



---

archive/issue_comments_173110.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@nexttime](#comment%3A11):\n> Yeah, I'll one day fix these (by removing the invalid options if `lang==\"c++\"`) ...\n\nIt's a distutils problem, not a Sage problem: [http://bugs.python.org/issue1222585](http://bugs.python.org/issue1222585)",
    "created_at": "2013-03-14T12:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173110",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@nexttime](#comment%3A11):
> Yeah, I'll one day fix these (by removing the invalid options if `lang=="c++"`) ...

It's a distutils problem, not a Sage problem: [http://bugs.python.org/issue1222585](http://bugs.python.org/issue1222585)



---

archive/issue_comments_173111.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nGiven that:\n1. this has been tested on the buildbot with no issues,\n2. it fixes an issue on Solaris,\n3. the fact that Distutils compiles C++ files as C files is not easily solved,\nI think this ticket is still ready for review.\n\nI added a patch to remove the c99 options which are currently in `module_list.py`.",
    "created_at": "2013-03-14T13:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173111",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Given that:
1. this has been tested on the buildbot with no issues,
2. it fixes an issue on Solaris,
3. the fact that Distutils compiles C++ files as C files is not easily solved,
I think this ticket is still ready for review.

I added a patch to remove the c99 options which are currently in `module_list.py`.



---

archive/issue_comments_173112.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,7 +29,9 @@\n \n **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n \n-To test: build this spkg and rebuild numpy.\n+**apply** [attachment: 14265_remove_c99.patch.gz](https://github.com/sagemath/sage/files/ticket14265/14265_remove_c99.patch.gz) to the Sage library.\n+\n+To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n \n ### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)\n * Trac #14265: Compile Python in C99 mode.\n``````\n",
    "created_at": "2013-03-14T13:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173112",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,7 +29,9 @@
 
 **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
 
-To test: build this spkg and rebuild numpy.
+**apply** [attachment: 14265_remove_c99.patch.gz](https://github.com/sagemath/sage/files/ticket14265/14265_remove_c99.patch.gz) to the Sage library.
+
+To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).
 
 ### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)
 * Trac #14265: Compile Python in C99 mode.
``````




---

archive/issue_comments_173113.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@jdemeyer](#comment%3A13):\n> I added a patch to remove the c99 options which are currently in `module_list.py`.\n\nI also thought about doing so, but I think we shouldn't, as you can still override Python's `CFLAGS`, and it's good to have documented which modules actually (seem to) require C99...",
    "created_at": "2013-03-14T13:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173113",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@jdemeyer](#comment%3A13):
> I added a patch to remove the c99 options which are currently in `module_list.py`.

I also thought about doing so, but I think we shouldn't, as you can still override Python's `CFLAGS`, and it's good to have documented which modules actually (seem to) require C99...



---

archive/issue_comments_173114.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@nexttime](#comment%3A14):\n> Replying to [@jdemeyer](#comment%3A13):\n> > I added a patch to remove the c99 options which are currently in `module_list.py`.\n\n> \n> I also thought about doing so, but I think we shouldn't, as you can still override Python's `CFLAGS`, and it's good to have documented which modules actually (seem to) require C99...\n\nTo be more precise (tried a few hours ago, but forgot):  the `-std=gnu99` only appears in my Sage library build logs if I **unset** `CFLAGS`. (For \"safety\", I actually also unset `CPPFLAGS` and `CXXFLAGS`, FWIW).",
    "created_at": "2013-03-14T13:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173114",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@nexttime](#comment%3A14):
> Replying to [@jdemeyer](#comment%3A13):
> > I added a patch to remove the c99 options which are currently in `module_list.py`.

> 
> I also thought about doing so, but I think we shouldn't, as you can still override Python's `CFLAGS`, and it's good to have documented which modules actually (seem to) require C99...

To be more precise (tried a few hours ago, but forgot):  the `-std=gnu99` only appears in my Sage library build logs if I **unset** `CFLAGS`. (For "safety", I actually also unset `CPPFLAGS` and `CXXFLAGS`, FWIW).



---

archive/issue_comments_173115.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nP.S.: Unsetting `CFLAGS` is sufficient to get all of Python's.",
    "created_at": "2013-03-14T13:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173115",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'>Comment 16:</a>
P.S.: Unsetting `CFLAGS` is sufficient to get all of Python's.



---

archive/issue_comments_173116.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@nexttime](#comment%3A14):\n> as you can still override Python's `CFLAGS`\n\nNot really, Python's `spkg-install` would always add the C99 flag.\n\n> it's good to have documented which modules actually (seem to) require C99...\n\nWhy, what's the added value?  Removing all those extra C99 flags simplifies `module_list.py` and I'm always in favour of simplification.",
    "created_at": "2013-03-14T13:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173116",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@nexttime](#comment%3A14):
> as you can still override Python's `CFLAGS`

Not really, Python's `spkg-install` would always add the C99 flag.

> it's good to have documented which modules actually (seem to) require C99...

Why, what's the added value?  Removing all those extra C99 flags simplifies `module_list.py` and I'm always in favour of simplification.



---

archive/issue_comments_173117.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nOK, removing the C99 flags can be moved to a new ticket: #14268",
    "created_at": "2013-03-14T13:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173117",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
OK, removing the C99 flags can be moved to a new ticket: #14268



---

archive/issue_comments_173118.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,8 +29,6 @@\n \n **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n \n-**apply** [attachment: 14265_remove_c99.patch.gz](https://github.com/sagemath/sage/files/ticket14265/14265_remove_c99.patch.gz) to the Sage library.\n-\n To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n \n ### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)\n``````\n",
    "created_at": "2013-03-14T13:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173118",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,8 +29,6 @@
 
 **spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
 
-**apply** [attachment: 14265_remove_c99.patch.gz](https://github.com/sagemath/sage/files/ticket14265/14265_remove_c99.patch.gz) to the Sage library.
-
 To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).
 
 ### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)
``````




---

archive/issue_comments_173119.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@jdemeyer](#comment%3A17):\n> Replying to [@nexttime](#comment%3A14):\n> > as you can still override Python's `CFLAGS`\n\n> Not really, Python's `spkg-install` would always add the C99 flag.\n\nYou probably misunderstood me.\n\nDo `env CFLAGS=\"-DFOO\" ./sage -ba` and the `-std=gnu99` vanishes, so we must not remove `-std=c99` from the `extra_compile_flags` (or what it's called).\n\nAs an alternative (I see no reason for), unconditionally (except for C++ sources perhaps) explicitly add `-std=gnu99` in `setup.py`.",
    "created_at": "2013-03-14T14:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173119",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@jdemeyer](#comment%3A17):
> Replying to [@nexttime](#comment%3A14):
> > as you can still override Python's `CFLAGS`

> Not really, Python's `spkg-install` would always add the C99 flag.

You probably misunderstood me.

Do `env CFLAGS="-DFOO" ./sage -ba` and the `-std=gnu99` vanishes, so we must not remove `-std=c99` from the `extra_compile_flags` (or what it's called).

As an alternative (I see no reason for), unconditionally (except for C++ sources perhaps) explicitly add `-std=gnu99` in `setup.py`.



---

archive/issue_comments_173120.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -38,4 +38,5 @@\n * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for\n   consistency with other packages and allow it to be set by the user.\n * Add check that the readline module can be imported.\n-\n+* Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds\n+  this flag for Clang).\n``````\n",
    "created_at": "2013-03-14T15:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173120",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -38,4 +38,5 @@
 * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for
   consistency with other packages and allow it to be set by the user.
 * Add check that the readline module can be imported.
-
+* Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds
+  this flag for Clang).
``````




---

archive/issue_comments_173121.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBuilding Sage 5.8.rc0 from scratch with this spkg on mark (Solaris 5.10, GCC 4.7.0, CFLAGS et al. not set), I get a lot of (additional, I think) warnings, and at least SageNB and the Sage library fail to build:\n\n```\n...\nBuilding modified file sage/ext/interpreters/wrapper_el.pyx.\nExecuting 341 commands (using 1 thread)\nTraceback (most recent call last):\n  File \"setup.py\", line 835, in <module>\n    execute_list_of_commands(queue)\n  File \"setup.py\", line 278, in execute_list_of_commands\n    execute_list_of_commands_in_parallel(command_list, nthreads)\n  File \"setup.py\", line 226, in execute_list_of_commands_in_parallel\n    from multiprocessing import Pool\n  File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python/multiprocessing/__init__.py\", line 84, in <module>\n    import _multiprocessing\nImportError: No module named _multiprocessing\nError installing modified sage library code.\nERROR installing Sage\n```\n(Haven't investigated the Python build log yet.)\n\nSageNB:\n\n```\n...\nProcessing zope.interface-4.0.3.tar.gz\nRunning zope.interface-4.0.3/setup.py -q bdist_egg --dist-dir /tmp/easy_install-TRxDqq/zope.interface-4.0.3/egg-dist-tmp-5XxIwA\nIn file included from /usr/include/limits.h:18:0,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:169,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/syslimits.h:7,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:34,\n                 from /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/Python.h:19,\n                 from src/zope/interface/_zope_interface_coptimizations.c:15:\n/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h\n:341:2: error: #error \"Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications\"\n********************************************************************************\nWARNING:\n\n        An optional code optimization (C extension) could not be compiled.\n\n        Optimizations for this package will not be available!\n()\ncommand 'gcc' failed with exit status 1\n********************************************************************************\nAdding zope.interface 4.0.3 to easy-install.pth file\n...\nRunning Twisted-12.3.0/setup.py -q bdist_egg --dist-dir /tmp/easy_install-lSWXxx/Twisted-12.3.0/egg-dist-tmp-mH8uhP\nIn file included from /usr/include/sys/types.h:18:0,\n                 from /usr/include/rpc/types.h:16,\n                 from /usr/include/rpc/rpc.h:19,\n                 from conftest.c:1:\n/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h\n:341:2: error: #error \"Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications\"\nIn file included from /usr/include/rpc/rpcb_clnt.h:31:0,\n                 from /usr/include/rpc/rpc.h:46,\n                 from conftest.c:1:\n/usr/include/rpc/rpcb_prot.h:162:3: error: unknown type name 'u_int'\n/usr/include/rpc/rpcb_prot.h:198:3: error: unknown type name 'u_int'\n/usr/include/rpc/rpcb_prot.h:226:2: error: unknown type name 'u_int'\n/usr/include/rpc/rpcb_prot.h:479:1: error: unknown type name 'u_int'\n/usr/include/rpc/rpcb_prot.h:492:1: error: unknown type name 'u_int'\nconftest.c:1:23: fatal error: sys/epoll.h: No such file or directory\ncompilation terminated.\nIn file included from /usr/include/limits.h:18:0,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:169,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/syslimits.h:7,\n                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:34,\n                 from /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/Python.h:19,\n                 from twisted/test/raiser.c:4:\n/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h\n:341:2: error: #error \"Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications\"\nerror: Setup script exited with error: command 'gcc' failed with exit status 1\nError installing Twisted-12.3.0.tar.bz2 !\n\nreal    0m28.292s\nuser    0m8.691s\nsys     0m2.294s\n************************************************************************\nError installing package sagenb-0.10.4\n************************************************************************\n```\n\nCountless warnings like\n\n```\n.../sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/pyconfig.h:1136:0: warning: \"_FILE_OFFSET_BITS\" redefined [enabled by default]\n```",
    "created_at": "2013-03-14T20:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173121",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'>Comment 21:</a>
Building Sage 5.8.rc0 from scratch with this spkg on mark (Solaris 5.10, GCC 4.7.0, CFLAGS et al. not set), I get a lot of (additional, I think) warnings, and at least SageNB and the Sage library fail to build:

```
...
Building modified file sage/ext/interpreters/wrapper_el.pyx.
Executing 341 commands (using 1 thread)
Traceback (most recent call last):
  File "setup.py", line 835, in <module>
    execute_list_of_commands(queue)
  File "setup.py", line 278, in execute_list_of_commands
    execute_list_of_commands_in_parallel(command_list, nthreads)
  File "setup.py", line 226, in execute_list_of_commands_in_parallel
    from multiprocessing import Pool
  File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python/multiprocessing/__init__.py", line 84, in <module>
    import _multiprocessing
ImportError: No module named _multiprocessing
Error installing modified sage library code.
ERROR installing Sage
```
(Haven't investigated the Python build log yet.)

SageNB:

```
...
Processing zope.interface-4.0.3.tar.gz
Running zope.interface-4.0.3/setup.py -q bdist_egg --dist-dir /tmp/easy_install-TRxDqq/zope.interface-4.0.3/egg-dist-tmp-5XxIwA
In file included from /usr/include/limits.h:18:0,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:169,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/syslimits.h:7,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:34,
                 from /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/Python.h:19,
                 from src/zope/interface/_zope_interface_coptimizations.c:15:
/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h
:341:2: error: #error "Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications"
********************************************************************************
WARNING:

        An optional code optimization (C extension) could not be compiled.

        Optimizations for this package will not be available!
()
command 'gcc' failed with exit status 1
********************************************************************************
Adding zope.interface 4.0.3 to easy-install.pth file
...
Running Twisted-12.3.0/setup.py -q bdist_egg --dist-dir /tmp/easy_install-lSWXxx/Twisted-12.3.0/egg-dist-tmp-mH8uhP
In file included from /usr/include/sys/types.h:18:0,
                 from /usr/include/rpc/types.h:16,
                 from /usr/include/rpc/rpc.h:19,
                 from conftest.c:1:
/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h
:341:2: error: #error "Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications"
In file included from /usr/include/rpc/rpcb_clnt.h:31:0,
                 from /usr/include/rpc/rpc.h:46,
                 from conftest.c:1:
/usr/include/rpc/rpcb_prot.h:162:3: error: unknown type name 'u_int'
/usr/include/rpc/rpcb_prot.h:198:3: error: unknown type name 'u_int'
/usr/include/rpc/rpcb_prot.h:226:2: error: unknown type name 'u_int'
/usr/include/rpc/rpcb_prot.h:479:1: error: unknown type name 'u_int'
/usr/include/rpc/rpcb_prot.h:492:1: error: unknown type name 'u_int'
conftest.c:1:23: fatal error: sys/epoll.h: No such file or directory
compilation terminated.
In file included from /usr/include/limits.h:18:0,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:169,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/syslimits.h:7,
                 from /usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/limits.h:34,
                 from /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/Python.h:19,
                 from twisted/test/raiser.c:4:
/usr/local/gcc-4.7.0/sparc-SunOS-ultrasparc3/lib/gcc/sparc-sun-solaris2.10/4.7.0/include-fixed/sys/feature_tests.h
:341:2: error: #error "Compiler or options invalid for pre-UNIX 03 X/Open applications  and pre-2001 POSIX applications"
error: Setup script exited with error: command 'gcc' failed with exit status 1
Error installing Twisted-12.3.0.tar.bz2 !

real    0m28.292s
user    0m8.691s
sys     0m2.294s
************************************************************************
Error installing package sagenb-0.10.4
************************************************************************
```

Countless warnings like

```
.../sage-5.8.rc0-gcc-4.7.0/local/include/python2.7/pyconfig.h:1136:0: warning: "_FILE_OFFSET_BITS" redefined [enabled by default]
```



---

archive/issue_comments_173122.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nP.S.:  Nearly one year ago, I managed to successfully build Sage 5.0.beta13 (presumably with a couple of fixed spkgs) with GCC 4.7.0 on mark2.",
    "created_at": "2013-03-14T20:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173122",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'>Comment 22:</a>
P.S.:  Nearly one year ago, I managed to successfully build Sage 5.0.beta13 (presumably with a couple of fixed spkgs) with GCC 4.7.0 on mark2.



---

archive/issue_comments_173123.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI have updated my spkg at some point, did you try the most recent version?",
    "created_at": "2013-03-14T23:07:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173123",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
I have updated my spkg at some point, did you try the most recent version?



---

archive/issue_comments_173124.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@jdemeyer](#comment%3A23):\n> I have updated my spkg at some point, did you try the most recent version?\n\nMost recent is a moving target...  I took the one dated March 13th 14:19 UTC.  (I didn't see any relevant changes in the changelog or the comments, so didn't bother to grab a new one later.  Now I see `-std=gnu99` meanwhile gets **ap**pended to `CFLAGS`, and IIRC adding `-D_XPG6` on Solaris is also new; any other relevant changes?)",
    "created_at": "2013-03-15T05:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173124",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@jdemeyer](#comment%3A23):
> I have updated my spkg at some point, did you try the most recent version?

Most recent is a moving target...  I took the one dated March 13th 14:19 UTC.  (I didn't see any relevant changes in the changelog or the comments, so didn't bother to grab a new one later.  Now I see `-std=gnu99` meanwhile gets **ap**pended to `CFLAGS`, and IIRC adding `-D_XPG6` on Solaris is also new; any other relevant changes?)



---

archive/issue_comments_173125.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI've now installed your updated Python spkg and `make`'d the rest (without setting `SAGE_UPGRADING`) on mark.\n\nDocumentation built, ptestlong in progress.",
    "created_at": "2013-03-15T11:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173125",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'>Comment 25:</a>
I've now installed your updated Python spkg and `make`'d the rest (without setting `SAGE_UPGRADING`) on mark.

Documentation built, ptestlong in progress.



---

archive/issue_comments_173126.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nI get a couple of doctest \"errors\" of the form (still on mark):\n\n```\nExpected:\n    foo\nGot:\n    WARNING: IPython GUI event loop requires ctypes, %gui will not be available\n    foo\n```\n\n:-)",
    "created_at": "2013-03-15T14:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173126",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'>Comment 26:</a>
I get a couple of doctest "errors" of the form (still on mark):

```
Expected:
    foo
Got:
    WARNING: IPython GUI event loop requires ctypes, %gui will not be available
    foo
```

:-)



---

archive/issue_comments_173127.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@nexttime](#comment%3A26):\n> I get a couple of doctest \"errors\" of the form (still on mark):\n> \n> ```\n> Expected:\n>     foo\n> Got:\n>     WARNING: IPython GUI event loop requires ctypes, %gui will not be available\n>     foo\n> ```\n\nAnd where do you get these errors, it would help if you mention the exact test.",
    "created_at": "2013-03-16T14:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173127",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@nexttime](#comment%3A26):
> I get a couple of doctest "errors" of the form (still on mark):
> 
> ```
> Expected:
>     foo
> Got:
>     WARNING: IPython GUI event loop requires ctypes, %gui will not be available
>     foo
> ```

And where do you get these errors, it would help if you mention the exact test.



---

archive/issue_comments_173128.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@nexttime](#comment%3A24):\n> I see `-std=gnu99` meanwhile gets **ap**pended to `CFLAGS`\n\nThat was a mistake, it should be prepended, fixed now.\n\n> adding `-D_XPG6` on Solaris is also new\n\nIndeed, it is required at least for OpenSolaris (hawk).\n\n> any other relevant changes?\n\nRemoving `-fwrapv` since Python's `configure` now adds it for compilers named `*clang*`.",
    "created_at": "2013-03-16T14:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173128",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@nexttime](#comment%3A24):
> I see `-std=gnu99` meanwhile gets **ap**pended to `CFLAGS`

That was a mistake, it should be prepended, fixed now.

> adding `-D_XPG6` on Solaris is also new

Indeed, it is required at least for OpenSolaris (hawk).

> any other relevant changes?

Removing `-fwrapv` since Python's `configure` now adds it for compilers named `*clang*`.



---

archive/issue_comments_173129.json:
```json
{
    "body": "Assignee: **@jdemeyer**",
    "created_at": "2013-03-16T14:45:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173129",
    "user": "https://github.com/jdemeyer"
}
```

Assignee: **@jdemeyer**



---

archive/issue_comments_173130.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@jdemeyer](#comment%3A27):\n> Replying to [@nexttime](#comment%3A26):\n> > I get a couple of doctest \"errors\" of the form (still on mark):\n> > \n> > ```\n> > Expected:\n> >     foo\n> > Got:\n> >     WARNING: IPython GUI event loop requires ctypes, %gui will not be available\n> >     foo\n> > ```\n\n> And where do you get these errors, it would help if you mention the exact test.\n\nHaven't investigated further yet (will rebuild parts and rerun ptestlong later), but *I think<sup>TM</sup>* most of the following failures are of that kind:\n\n```\n\tsage -t  --long -force_lib devel/sage/sage/crypto/mq/sr.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/libs/ppl.pyx # 8 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense.pyx # 5 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense_template.pxi # 5 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/misc/interpreter.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/misc/temporary_file.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/parallel/decorate.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/tests/cmdline.py # 9 doctests failed\n```\n\nMore details later;  [here](http://boxen.math.washington.edu/home/leif/Sage/tmp/sage-5.8.rc0+14265-gcc-4.7.0-mark.ptestlong.v1.log)'s the \"preliminary\" log.",
    "created_at": "2013-03-16T15:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173130",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@jdemeyer](#comment%3A27):
> Replying to [@nexttime](#comment%3A26):
> > I get a couple of doctest "errors" of the form (still on mark):
> > 
> > ```
> > Expected:
> >     foo
> > Got:
> >     WARNING: IPython GUI event loop requires ctypes, %gui will not be available
> >     foo
> > ```

> And where do you get these errors, it would help if you mention the exact test.

Haven't investigated further yet (will rebuild parts and rerun ptestlong later), but *I think<sup>TM</sup>* most of the following failures are of that kind:

```
	sage -t  --long -force_lib devel/sage/sage/crypto/mq/sr.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/libs/ppl.pyx # 8 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense.pyx # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense_template.pxi # 5 doctests failed
	sage -t  --long -force_lib devel/sage/sage/misc/interpreter.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/misc/temporary_file.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/parallel/decorate.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/tests/cmdline.py # 9 doctests failed
```

More details later;  [here](http://boxen.math.washington.edu/home/leif/Sage/tmp/sage-5.8.rc0+14265-gcc-4.7.0-mark.ptestlong.v1.log)'s the "preliminary" log.



---

archive/issue_comments_173131.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\n`sage/parallel/decorate.py` passed now (tested separately; no rebuilds yet).\n\nAll failures in `sage/libs/ppl.pyx` are (apparently reproducibly) `Expected: foo Got: WARNING: ... foo`.  Same for `sage/misc/interpreter.py`; similar for `sage/misc/temporary_file.py` and `sage/tests/cmdline.py`.\n\nWhy t!** f!*** is IPython involved at all?\n\nWhen testing `sage/crypto/mq/sr.py`, I also get the warning at the beginning (but not in `Got:`), then a `RuntimeError: Bus Error`.  Same for `sage/matrix/matrix_modn_dense{.pyx,_template.pxi}`, plus some errors due to the previous bus error(s) I think.",
    "created_at": "2013-03-17T08:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173131",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'>Comment 30:</a>
`sage/parallel/decorate.py` passed now (tested separately; no rebuilds yet).

All failures in `sage/libs/ppl.pyx` are (apparently reproducibly) `Expected: foo Got: WARNING: ... foo`.  Same for `sage/misc/interpreter.py`; similar for `sage/misc/temporary_file.py` and `sage/tests/cmdline.py`.

Why t!** f!*** is IPython involved at all?

When testing `sage/crypto/mq/sr.py`, I also get the warning at the beginning (but not in `Got:`), then a `RuntimeError: Bus Error`.  Same for `sage/matrix/matrix_modn_dense{.pyx,_template.pxi}`, plus some errors due to the previous bus error(s) I think.



---

archive/issue_comments_173132.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nJust found\n\n```\n.../spkg/build/python-2.7.3.p6/src/Modules/_ctypes/libffi/src/sparc/v9.o: file not recognized: Bad value\ncollect2: error: ld returned 1 exit status\n\nPython build finished, but the necessary bits to build these modules were not found:\n_bsddb             _ssl               _tkinter        \nbsddb185           gdbm               linuxaudiodev   \nossaudiodev                                           \nTo find the necessary bits, look in setup.py in detect_modules() for the module's name.\n\n\nFailed to build these modules:\n_ctypes            _curses            _curses_panel   \n```\nwhen (re)building the updated Python spkg.  So apparently `_ctypes` cannot be built because some objects are built 64-bit.",
    "created_at": "2013-03-17T09:21:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173132",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'>Comment 31:</a>
Just found

```
.../spkg/build/python-2.7.3.p6/src/Modules/_ctypes/libffi/src/sparc/v9.o: file not recognized: Bad value
collect2: error: ld returned 1 exit status

Python build finished, but the necessary bits to build these modules were not found:
_bsddb             _ssl               _tkinter        
bsddb185           gdbm               linuxaudiodev   
ossaudiodev                                           
To find the necessary bits, look in setup.py in detect_modules() for the module's name.


Failed to build these modules:
_ctypes            _curses            _curses_panel   
```
when (re)building the updated Python spkg.  So apparently `_ctypes` cannot be built because some objects are built 64-bit.



---

archive/issue_comments_173133.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nI added a check in the spkg that `ctypes` can be imported, but I cannot reproduce your problem.",
    "created_at": "2013-03-17T14:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173133",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'>Comment 32:</a>
I added a check in the spkg that `ctypes` can be imported, but I cannot reproduce your problem.



---

archive/issue_comments_173134.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@jdemeyer](#comment%3A32):\n> I added a check in the spkg that `ctypes` can be imported, but I cannot reproduce your problem.\n\nWell, it previously worked without `_ctypes`, so why require it now?  Just for `%gui`?\n\nSomething with IPython (or doctesting) is broken, so that should (also) get fixed.  (I don't think the spkg here is causing it.)",
    "created_at": "2013-03-17T16:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173134",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@jdemeyer](#comment%3A32):
> I added a check in the spkg that `ctypes` can be imported, but I cannot reproduce your problem.

Well, it previously worked without `_ctypes`, so why require it now?  Just for `%gui`?

Something with IPython (or doctesting) is broken, so that should (also) get fixed.  (I don't think the spkg here is causing it.)



---

archive/issue_comments_173135.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nReplying to [@nexttime](#comment%3A31):\n> \n> ```\n> .../src/Modules/_ctypes/libffi/src/sparc/v9.o: file not recognized: Bad value\n> collect2: error: ld returned 1 exit status\n> ...\n> Failed to build these modules:\n> _ctypes            _curses            _curses_panel   \n> ```\n\nThis goes back to Sage 5.2 and 5.0, with GCC 4.7.0, but apparently never caused a problem.",
    "created_at": "2013-03-17T16:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173135",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:34'>Comment 34:</a>
Replying to [@nexttime](#comment%3A31):
> 
> ```
> .../src/Modules/_ctypes/libffi/src/sparc/v9.o: file not recognized: Bad value
> collect2: error: ld returned 1 exit status
> ...
> Failed to build these modules:
> _ctypes            _curses            _curses_panel   
> ```

This goes back to Sage 5.2 and 5.0, with GCC 4.7.0, but apparently never caused a problem.



---

archive/issue_comments_173136.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nWith yesterday's spkg, it gets even weirder now:\n\n```\nWARNING: IPython GUI event loop requires ctypes, %gui will not be available\nTraceback (most recent call last):\n  File \"./spkg-install\", line 4, in <module>\n    from sage.all import save\n  File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/all.py\", line 70, in <module>\n    from sage.matrix.all     import *\n  File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/all.py\", line 1, in <module>\n    from matrix_space import MatrixSpace, is_MatrixSpace\n  File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 37, in <module>\n    import matrix_modn_dense\n  File \"matrix_modn_dense_template_header.pxi\", line 11, in init sage.matrix.matrix_modn_dense (sage/matrix/matrix_modn_dense.c:13934)\n  File \"matrix_integer_dense.pxd\", line 12, in init sage.matrix.matrix_modn_dense_float (sage/matrix/matrix_modn_dense_float.cpp:16937)\n  File \"linbox.pxd\", line 7, in init sage.matrix.matrix_integer_dense (sage/matrix/matrix_integer_dense.c:43265)\nImportError: ld.so.1: python2.7: fatal: relocation error: file /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/liblinboxsage.so.0: symbol _ZN6LinBox17NotImplementedYet12_errorStreamE: referenced symbol not found\n\nreal    0m16.342s\nuser    0m3.614s\nsys     0m1.785s\n************************************************************************\nError installing package conway_polynomials-0.4.p0\n************************************************************************\n```",
    "created_at": "2013-03-17T17:42:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173136",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'>Comment 35:</a>
With yesterday's spkg, it gets even weirder now:

```
WARNING: IPython GUI event loop requires ctypes, %gui will not be available
Traceback (most recent call last):
  File "./spkg-install", line 4, in <module>
    from sage.all import save
  File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/all.py", line 70, in <module>
    from sage.matrix.all     import *
  File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/all.py", line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 37, in <module>
    import matrix_modn_dense
  File "matrix_modn_dense_template_header.pxi", line 11, in init sage.matrix.matrix_modn_dense (sage/matrix/matrix_modn_dense.c:13934)
  File "matrix_integer_dense.pxd", line 12, in init sage.matrix.matrix_modn_dense_float (sage/matrix/matrix_modn_dense_float.cpp:16937)
  File "linbox.pxd", line 7, in init sage.matrix.matrix_integer_dense (sage/matrix/matrix_integer_dense.c:43265)
ImportError: ld.so.1: python2.7: fatal: relocation error: file /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/liblinboxsage.so.0: symbol _ZN6LinBox17NotImplementedYet12_errorStreamE: referenced symbol not found

real    0m16.342s
user    0m3.614s
sys     0m1.785s
************************************************************************
Error installing package conway_polynomials-0.4.p0
************************************************************************
```



---

archive/issue_comments_173137.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nReplying to [@nexttime](#comment%3A33):\n> Something with IPython (or doctesting) is broken\n\nIf the new IPython requires `ctypes`, then we should check for it.\n\nI feel like we're wandering away too much away from the essence of this ticket, which is ensuring that Python compiles the `isinf()` function. The fact that it doesn't work with GCC-4.7.0 doesn't matter for now.",
    "created_at": "2013-03-17T17:48:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173137",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'>Comment 36:</a>
Replying to [@nexttime](#comment%3A33):
> Something with IPython (or doctesting) is broken

If the new IPython requires `ctypes`, then we should check for it.

I feel like we're wandering away too much away from the essence of this ticket, which is ensuring that Python compiles the `isinf()` function. The fact that it doesn't work with GCC-4.7.0 doesn't matter for now.



---

archive/issue_comments_173138.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@jdemeyer](#comment%3A36):\n> Replying to [@nexttime](#comment%3A33):\n> > Something with IPython (or doctesting) is broken\n\n> If the new IPython requires `ctypes`, then we should check for it.\n\nWell it doesn't, otherwise it wouldn't build, or issue an error message instead of just a warning.\n\nAnd as said, previous versions did build and work with GCC 4.7.0, so there's a regression.",
    "created_at": "2013-03-17T17:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173138",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@jdemeyer](#comment%3A36):
> Replying to [@nexttime](#comment%3A33):
> > Something with IPython (or doctesting) is broken

> If the new IPython requires `ctypes`, then we should check for it.

Well it doesn't, otherwise it wouldn't build, or issue an error message instead of just a warning.

And as said, previous versions did build and work with GCC 4.7.0, so there's a regression.



---

archive/issue_comments_173139.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,7 +27,7 @@\n ```\n These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled as C99. So we should add a compiler flag to fix this.\n \n-**spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n \n To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n \n``````\n",
    "created_at": "2013-03-18T09:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173139",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,7 +27,7 @@
 ```
 These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled as C99. So we should add a compiler flag to fix this.
 
-**spkg**: [http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
 
 To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).
 
``````




---

archive/issue_comments_173140.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nReplying to [@nexttime](#comment%3A37):\n> And as said, previous versions did build and work with GCC 4.7.0, so there's a regression.\n\nDo you mean GCC-4.7.0 with GNU ld which is installed system-wide on mark or do you mean a custom-built GCC-4.7.0 with Sun ld? Because building Sage on mark with GNU ld never worked for me (at least `libpng` doesn't build).\n\nI'm going to try building Sage on mark with GCC-4.7.2 (the optional spkg) + Sun ld. If that works with this spkg, I think there is no reason to hold up this ticket.",
    "created_at": "2013-03-18T11:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173140",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'>Comment 39:</a>
Replying to [@nexttime](#comment%3A37):
> And as said, previous versions did build and work with GCC 4.7.0, so there's a regression.

Do you mean GCC-4.7.0 with GNU ld which is installed system-wide on mark or do you mean a custom-built GCC-4.7.0 with Sun ld? Because building Sage on mark with GNU ld never worked for me (at least `libpng` doesn't build).

I'm going to try building Sage on mark with GCC-4.7.2 (the optional spkg) + Sun ld. If that works with this spkg, I think there is no reason to hold up this ticket.



---

archive/issue_comments_173141.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nReplying to [@jdemeyer](#comment%3A39):\n> Replying to [@nexttime](#comment%3A37):\n> > And as said, previous versions did build and work with GCC 4.7.0, so there's a regression.\n\n> Do you mean GCC-4.7.0 with GNU ld which is installed system-wide on mark or do you mean a custom-built GCC-4.7.0 with Sun ld? Because building Sage on mark with GNU ld never worked for me (at least `libpng` doesn't build).\n\nThe system-wide GCC 4.7.0 (which is configured to use GNU ld).\n\nUnfortunately, with the default setup on the skynet machines (`/usr/local/skynet_bash_profile`), the Sun linker comes first in `PATH`, so some packages get confused, assuming the wrong linker.\n\nE.g. to build libpng, you have to\n\n```sh\nexport LD=/usr/local/binutils-2.22/sparc-SunOS-ultrasparc3-gcc-4.6.2-without-zlib/bin/ld\n```\n\n\n\n> I'm going to try building Sage on mark with GCC-4.7.2 (the optional spkg) + Sun ld. If that works with this spkg, I think there is no reason to hold up this ticket.\n\nYes.  I was going to try that as well.  (I'll open a ticket for building Singular with GCC 4.7.x on Solaris soon; only needs a trivial patch to `kernel/bigintmat.cc`.)\n\nThe odd IPython warnings (and/or making Python properly build `_ctypes` on Solaris SPARC) should be fixed on another ticket.\n\nHopefully Sage 5.9.beta* gets out soon... ;-)",
    "created_at": "2013-03-18T12:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173141",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'>Comment 40:</a>
Replying to [@jdemeyer](#comment%3A39):
> Replying to [@nexttime](#comment%3A37):
> > And as said, previous versions did build and work with GCC 4.7.0, so there's a regression.

> Do you mean GCC-4.7.0 with GNU ld which is installed system-wide on mark or do you mean a custom-built GCC-4.7.0 with Sun ld? Because building Sage on mark with GNU ld never worked for me (at least `libpng` doesn't build).

The system-wide GCC 4.7.0 (which is configured to use GNU ld).

Unfortunately, with the default setup on the skynet machines (`/usr/local/skynet_bash_profile`), the Sun linker comes first in `PATH`, so some packages get confused, assuming the wrong linker.

E.g. to build libpng, you have to

```sh
export LD=/usr/local/binutils-2.22/sparc-SunOS-ultrasparc3-gcc-4.6.2-without-zlib/bin/ld
```



> I'm going to try building Sage on mark with GCC-4.7.2 (the optional spkg) + Sun ld. If that works with this spkg, I think there is no reason to hold up this ticket.

Yes.  I was going to try that as well.  (I'll open a ticket for building Singular with GCC 4.7.x on Solaris soon; only needs a trivial patch to `kernel/bigintmat.cc`.)

The odd IPython warnings (and/or making Python properly build `_ctypes` on Solaris SPARC) should be fixed on another ticket.

Hopefully Sage 5.9.beta* gets out soon... ;-)



---

archive/issue_comments_173142.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nReplying to [@nexttime](#comment%3A40):\n> (I'll open a ticket for building Singular with GCC 4.7.x on Solaris soon; only needs a trivial patch to `kernel/bigintmat.cc`.)\n\nP.S.:  A patched version of `bigintmat.cc` is [here](http://boxen.math.washington.edu/home/leif/Sage/tmp/bigintmat.cc).",
    "created_at": "2013-03-18T12:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173142",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:41'>Comment 41:</a>
Replying to [@nexttime](#comment%3A40):
> (I'll open a ticket for building Singular with GCC 4.7.x on Solaris soon; only needs a trivial patch to `kernel/bigintmat.cc`.)

P.S.:  A patched version of `bigintmat.cc` is [here](http://boxen.math.washington.edu/home/leif/Sage/tmp/bigintmat.cc).



---

archive/issue_comments_173143.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nSee #14296 for `$LD` troubles.",
    "created_at": "2013-03-18T13:26:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173143",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'>Comment 42:</a>
See #14296 for `$LD` troubles.



---

archive/issue_comments_173144.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nReplying to [@nexttime](#comment%3A35):\n> With yesterday's spkg, it gets even weirder now:\n> \n> ```\n> WARNING: IPython GUI event loop requires ctypes, %gui will not be available\n> Traceback (most recent call last):\n>   File \"./spkg-install\", line 4, in <module>\n>     from sage.all import save\n>   File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/all.py\", line 70, in <module>\n>     from sage.matrix.all     import *\n>   File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/all.py\", line 1, in <module>\n>     from matrix_space import MatrixSpace, is_MatrixSpace\n>   File \"/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 37, in <module>\n>     import matrix_modn_dense\n>   File \"matrix_modn_dense_template_header.pxi\", line 11, in init sage.matrix.matrix_modn_dense (sage/matrix/matrix_modn_dense.c:13934)\n>   File \"matrix_integer_dense.pxd\", line 12, in init sage.matrix.matrix_modn_dense_float (sage/matrix/matrix_modn_dense_float.cpp:16937)\n>   File \"linbox.pxd\", line 7, in init sage.matrix.matrix_integer_dense (sage/matrix/matrix_integer_dense.c:43265)\n> ImportError: ld.so.1: python2.7: fatal: relocation error: file /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/liblinboxsage.so.0: symbol _ZN6LinBox17NotImplementedYet12_errorStreamE: referenced symbol not found\n> \n> real    0m16.342s\n> user    0m3.614s\n> sys     0m1.785s\n> ************************************************************************\n> Error installing package conway_polynomials-0.4.p0\n> ************************************************************************\n> ```\n\nI've now successfully built *vanilla* Sage 5.8.rc0 (plus the fix for Singular, cf. #14295) on mark2 (with `CFLAGS` et al. set, FWIW), and while I still get the IPython warnings, Sage at least starts up without errors.\n\nCurrently building the docs to afterwards run ptestlong.",
    "created_at": "2013-03-18T18:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173144",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'>Comment 43:</a>
Replying to [@nexttime](#comment%3A35):
> With yesterday's spkg, it gets even weirder now:
> 
> ```
> WARNING: IPython GUI event loop requires ctypes, %gui will not be available
> Traceback (most recent call last):
>   File "./spkg-install", line 4, in <module>
>     from sage.all import save
>   File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/all.py", line 70, in <module>
>     from sage.matrix.all     import *
>   File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/all.py", line 1, in <module>
>     from matrix_space import MatrixSpace, is_MatrixSpace
>   File "/home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 37, in <module>
>     import matrix_modn_dense
>   File "matrix_modn_dense_template_header.pxi", line 11, in init sage.matrix.matrix_modn_dense (sage/matrix/matrix_modn_dense.c:13934)
>   File "matrix_integer_dense.pxd", line 12, in init sage.matrix.matrix_modn_dense_float (sage/matrix/matrix_modn_dense_float.cpp:16937)
>   File "linbox.pxd", line 7, in init sage.matrix.matrix_integer_dense (sage/matrix/matrix_integer_dense.c:43265)
> ImportError: ld.so.1: python2.7: fatal: relocation error: file /home/leif/Sage/release/build/mark/sage-5.8.rc0-gcc-4.7.0/local/lib/liblinboxsage.so.0: symbol _ZN6LinBox17NotImplementedYet12_errorStreamE: referenced symbol not found
> 
> real    0m16.342s
> user    0m3.614s
> sys     0m1.785s
> ************************************************************************
> Error installing package conway_polynomials-0.4.p0
> ************************************************************************
> ```

I've now successfully built *vanilla* Sage 5.8.rc0 (plus the fix for Singular, cf. #14295) on mark2 (with `CFLAGS` et al. set, FWIW), and while I still get the IPython warnings, Sage at least starts up without errors.

Currently building the docs to afterwards run ptestlong.



---

archive/issue_comments_173145.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nIt seems that OpenSolaris is much more strict about C99. In particular, there doesn't seem to be a clean way to compile both C and C++ with the same compiler options.\n\nSo perhaps we should try compiling C89 but with `-D__C99FEATURES__` which enables a few things from C99 such as `isinf()`.",
    "created_at": "2013-03-19T09:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173145",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'>Comment 44:</a>
It seems that OpenSolaris is much more strict about C99. In particular, there doesn't seem to be a clean way to compile both C and C++ with the same compiler options.

So perhaps we should try compiling C89 but with `-D__C99FEATURES__` which enables a few things from C99 such as `isinf()`.



---

archive/issue_comments_173146.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nReplying to [@jdemeyer](#comment%3A44):\n> So perhaps we should try compiling C89 but with `-D__C99FEATURES__` which enables a few things from C99 such as `isinf()`.\n\nSeems much better.  `-D_XPG6` is a hack anyway, as both `_XOPEN_SOURCE=600` and _POSIX_C_SOURCE=200112L` require C99.\n\nOr define your own macros `#ifndef`... ;-)",
    "created_at": "2013-03-19T10:33:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173146",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'>Comment 45:</a>
Replying to [@jdemeyer](#comment%3A44):
> So perhaps we should try compiling C89 but with `-D__C99FEATURES__` which enables a few things from C99 such as `isinf()`.

Seems much better.  `-D_XPG6` is a hack anyway, as both `_XOPEN_SOURCE=600` and _POSIX_C_SOURCE=200112L` require C99.

Or define your own macros `#ifndef`... ;-)



---

archive/issue_events_184437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-19T10:43:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "title_is": "Compile Python with -D__C99FEATURES__ on Solaris",
    "title_was": "Compile Python as C99",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184437"
}
```



---

archive/issue_comments_173147.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,18 +25,18 @@\n checking whether isfinite is declared... no\n [...]\n ```\n-These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled as C99. So we should add a compiler flag to fix this.\n+These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled with -D__C99FEATURES__. So we should add a compiler flag to fix this.\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)\n \n To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n \n-### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)\n-* Trac #14265: Compile Python in C99 mode.\n+### python-2.7.3.p6 (Jeroen Demeyer, 19 March 2013)\n+* Trac #14265: Compile with -D__C99FEATURES__ on Solaris.\n * Remove workaround for http://bugs.python.org/issue6954\n   (which is fixed upstream).\n * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for\n   consistency with other packages and allow it to be set by the user.\n-* Add check that the readline module can be imported.\n+* Add check that the ctypes and readline modules can be imported.\n * Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds\n   this flag for Clang).\n``````\n",
    "created_at": "2013-03-19T10:43:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173147",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,18 +25,18 @@
 checking whether isfinite is declared... no
 [...]
 ```
-These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled as C99. So we should add a compiler flag to fix this.
+These functions are defined by C99 and Python's `configure` does find `isinf` and `isfinite` when compiled with -D__C99FEATURES__. So we should add a compiler flag to fix this.
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/python-2.7.3.p6.spkg)
 
 To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).
 
-### python-2.7.3.p6 (Jeroen Demeyer, 13 March 2013)
-* Trac #14265: Compile Python in C99 mode.
+### python-2.7.3.p6 (Jeroen Demeyer, 19 March 2013)
+* Trac #14265: Compile with -D__C99FEATURES__ on Solaris.
 * Remove workaround for http://bugs.python.org/issue6954
   (which is fixed upstream).
 * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for
   consistency with other packages and allow it to be set by the user.
-* Add check that the readline module can be imported.
+* Add check that the ctypes and readline modules can be imported.
 * Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds
   this flag for Clang).
``````




---

archive/issue_comments_173148.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nReplying to [@nexttime](#comment%3A26):\n> I get a couple of doctest \"errors\" of the form (still on mark):\n> \n> ```\n> Expected:\n>     foo\n> Got:\n>     WARNING: IPython GUI event loop requires ctypes, %gui will not be available\n>     foo\n> ```\n\nThis is now #14309.",
    "created_at": "2013-03-19T10:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173148",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:47'>Comment 47:</a>
Replying to [@nexttime](#comment%3A26):
> I get a couple of doctest "errors" of the form (still on mark):
> 
> ```
> Expected:
>     foo
> Got:
>     WARNING: IPython GUI event loop requires ctypes, %gui will not be available
>     foo
> ```

This is now #14309.



---

archive/issue_comments_173149.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nThis spkg has been completely buildbot-tested and works fine. Needs review...",
    "created_at": "2013-03-22T08:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173149",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'>Comment 48:</a>
This spkg has been completely buildbot-tested and works fine. Needs review...



---

archive/issue_comments_173150.json:
```json
{
    "body": "Diff for the Python spkg, for review only",
    "created_at": "2013-03-24T14:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173150",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the Python spkg, for review only



---

archive/issue_comments_173151.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nAttachment: **[python-2.7.3.p6.diff.gz](https://github.com/sagemath/sage/files/ticket14265/python-2.7.3.p6.diff.gz)**",
    "created_at": "2013-03-24T14:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173151",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'>Comment 49:</a>
Attachment: **[python-2.7.3.p6.diff.gz](https://github.com/sagemath/sage/files/ticket14265/python-2.7.3.p6.diff.gz)**



---

archive/issue_comments_173152.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,12 +31,14 @@\n \n To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).\n \n-### python-2.7.3.p6 (Jeroen Demeyer, 19 March 2013)\n+### python-2.7.3.p6 (Jeroen Demeyer, 24 March 2013)\n * Trac #14265: Compile with -D__C99FEATURES__ on Solaris.\n * Remove workaround for http://bugs.python.org/issue6954\n   (which is fixed upstream).\n * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for\n   consistency with other packages and allow it to be set by the user.\n-* Add check that the ctypes and readline modules can be imported.\n+* Add check that the ctypes and readline (required for IPython) and\n+  socket (required for setuptools) modules can be imported.\n * Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds\n   this flag for Clang).\n+\n``````\n",
    "created_at": "2013-03-24T14:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173152",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,12 +31,14 @@
 
 To test: build this spkg, rebuild numpy (optionally: rebuild everything which depends on Python, including the Sage library).
 
-### python-2.7.3.p6 (Jeroen Demeyer, 19 March 2013)
+### python-2.7.3.p6 (Jeroen Demeyer, 24 March 2013)
 * Trac #14265: Compile with -D__C99FEATURES__ on Solaris.
 * Remove workaround for http://bugs.python.org/issue6954
   (which is fixed upstream).
 * Rename environment variable EXTRAFLAGS to PYTHON_CONFIGURE for
   consistency with other packages and allow it to be set by the user.
-* Add check that the ctypes and readline modules can be imported.
+* Add check that the ctypes and readline (required for IPython) and
+  socket (required for setuptools) modules can be imported.
 * Don't add the -fwrapv flag (no longer needed since Python-2.7.3 adds
   this flag for Clang).
+
``````




---

archive/issue_comments_173153.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nOK I bite. I note from the diff that on OS X you prepend --disable-toolbox-glue rather than appending it to PYTHON_CONFIGURE. Does it mean that it is safe for user to override this option? If it is safe why is it disabled by default?",
    "created_at": "2013-03-28T10:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173153",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:50'>Comment 50:</a>
OK I bite. I note from the diff that on OS X you prepend --disable-toolbox-glue rather than appending it to PYTHON_CONFIGURE. Does it mean that it is safe for user to override this option? If it is safe why is it disabled by default?



---

archive/issue_comments_173154.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@kiwifb](#comment%3A50):\n> I note from the diff that on OS X you prepend --disable-toolbox-glue rather than appending it to PYTHON_CONFIGURE. Does it mean that it is safe for user to override this option?\n\nNo.\n\nIt's all about giving the user at least the *possibility* to override this option. In general, we should never force things on the user, it the user wants to do stupid things, he should be able to.",
    "created_at": "2013-03-28T17:13:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173154",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@kiwifb](#comment%3A50):
> I note from the diff that on OS X you prepend --disable-toolbox-glue rather than appending it to PYTHON_CONFIGURE. Does it mean that it is safe for user to override this option?

No.

It's all about giving the user at least the *possibility* to override this option. In general, we should never force things on the user, it the user wants to do stupid things, he should be able to.



---

archive/issue_events_184438.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-29T03:55:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184438"
}
```



---

archive/issue_events_184439.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-03-29T03:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184439"
}
```



---

archive/issue_comments_173155.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nI am ok with that line of reasonning. It was different from the original handling. spkg looks ok to me and only touch solaris which has been tested positive that.",
    "created_at": "2013-03-29T03:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173155",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:52'>Comment 52:</a>
I am ok with that line of reasonning. It was different from the original handling. spkg looks ok to me and only touch solaris which has been tested positive that.



---

archive/issue_comments_173156.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2013-03-29T04:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173156",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_events_184440.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-29T04:05:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184440"
}
```



---

archive/issue_events_184441.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-29T04:05:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14265#event-184441"
}
```



---

archive/issue_comments_173157.json:
```json
{
    "body": "Merged: **sage-5.9.beta3**",
    "created_at": "2013-03-29T04:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14265",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14265#issuecomment-173157",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.beta3**
