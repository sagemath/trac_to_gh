# Issue 14887: libgap package

archive/issues_014683.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nlibgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package. This is planned with libgap-2.0.\n\nThe known workarounds don't work with OSX toolchains, so it doesn't make sense to merge them. For now, sagelib must be patched for packaging on systems without libgap.\n\nDepends on #14807\n\nUpstream: **None of the above - read trac for reasoning.**\n\nCC:  @jpflori @kiwifb\n\nComponent: **distribution**\n\nKeywords: **libgap**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14887_\n\n",
    "closed_at": "2017-03-21T10:59:05Z",
    "created_at": "2013-07-13T05:26:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "libgap package",
    "type": "issue",
    "updated_at": "2017-03-21T10:59:05Z",
    "url": "https://github.com/sagemath/sage/issues/14887",
    "user": "https://github.com/sagetrac-felixs"
}
```
<div id="comment:0"></div>

libgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package. This is planned with libgap-2.0.

The known workarounds don't work with OSX toolchains, so it doesn't make sense to merge them. For now, sagelib must be patched for packaging on systems without libgap.

Depends on #14807

Upstream: **None of the above - read trac for reasoning.**

CC:  @jpflori @kiwifb

Component: **distribution**

Keywords: **libgap**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/14887_





---

archive/issue_events_209741.json:
```json
{
    "actor": "https://github.com/sagetrac-felixs",
    "created_at": "2013-07-13T05:26:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209741"
}
```



---

archive/issue_events_209742.json:
```json
{
    "actor": "https://github.com/sagetrac-felixs",
    "created_at": "2013-07-13T05:26:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209742"
}
```



---

archive/issue_events_209743.json:
```json
{
    "actor": "https://github.com/sagetrac-felixs",
    "created_at": "2013-07-13T05:26:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209743"
}
```



---

archive/issue_comments_182476.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMaybe it would be nice to discuss your plans with me, unless you want to take over future libGAP development. Exposing all of the GAP symbols is a feature, it allows me to experiment with the GAP kernel easily just from !Python/Cython. Obviously one can reduce namespace pollution by only exporting select symbols but that would make future development much harder, in particular since the GAP kernel internals are only rather sparsely documented.",
    "created_at": "2013-07-13T05:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182476",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

Maybe it would be nice to discuss your plans with me, unless you want to take over future libGAP development. Exposing all of the GAP symbols is a feature, it allows me to experiment with the GAP kernel easily just from !Python/Cython. Obviously one can reduce namespace pollution by only exporting select symbols but that would make future development much harder, in particular since the GAP kernel internals are only rather sparsely documented.



---

archive/issue_comments_182477.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@vbraun](#comment%3A2):\n> Maybe it would be nice to discuss your plans with me.\n\nThe discussion so far has not lead to a solution for the issue, I didn't mean to bug you more about it until I have a clear concept... but here you are:\n\nI have implemented a wrapper library that wraps all symbols that don't match lib[gG][aA][pP]_*. currently this is in proof of concept state and is intended to work without libgap package (everything compiles and links, but something's wrong).\n\nI have not factored in that you might want to experiment with python/cython, but it should be easy to switch to another libgap.so to replace the the wrapper (of course somebody would have to maintain the fork...)\n\nHow is your planned c++-wrapper intended to implement experiments with gap internals?",
    "created_at": "2013-07-13T06:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182477",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@vbraun](#comment%3A2):
> Maybe it would be nice to discuss your plans with me.

The discussion so far has not lead to a solution for the issue, I didn't mean to bug you more about it until I have a clear concept... but here you are:

I have implemented a wrapper library that wraps all symbols that don't match lib[gG][aA][pP]_*. currently this is in proof of concept state and is intended to work without libgap package (everything compiles and links, but something's wrong).

I have not factored in that you might want to experiment with python/cython, but it should be easy to switch to another libgap.so to replace the the wrapper (of course somebody would have to maintain the fork...)

How is your planned c++-wrapper intended to implement experiments with gap internals?



---

archive/issue_comments_182478.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWho is going to maintain the wrapper library and the necessary changes to the GAP build system, you or upstream? And if its not going into upstream, then it looks to me like we are jut debianizing GAP here which will make Sage less distributable, not more.\n\nReplying to [@sagetrac-felixs](#comment%3A3):\n> How is your planned c++-wrapper intended to implement experiments with gap internals?\n\nThat would be after libgap integration in Sage is complete, which would end up a fairly comprehensive api to the gap kernel. Then we wouldn't need to eperiment with the gap kernel regularly, so it would be fine to hide all the gap private symbols and only expose a C++ api that matches the class hierarchy in Sage. \n\nBut first we need to wrap GAP permutations and then switch permutation groups from the gap interface to libgap.",
    "created_at": "2013-07-13T13:15:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182478",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

Who is going to maintain the wrapper library and the necessary changes to the GAP build system, you or upstream? And if its not going into upstream, then it looks to me like we are jut debianizing GAP here which will make Sage less distributable, not more.

Replying to [@sagetrac-felixs](#comment%3A3):
> How is your planned c++-wrapper intended to implement experiments with gap internals?

That would be after libgap integration in Sage is complete, which would end up a fairly comprehensive api to the gap kernel. Then we wouldn't need to eperiment with the gap kernel regularly, so it would be fine to hide all the gap private symbols and only expose a C++ api that matches the class hierarchy in Sage. 

But first we need to wrap GAP permutations and then switch permutation groups from the gap interface to libgap.



---

archive/issue_comments_182479.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@vbraun](#comment%3A4):\n> Who is going to maintain the wrapper library and the necessary changes to the GAP build system, you or upstream? And if its not going into upstream, then it looks to me like we are jut debianizing GAP here which will make Sage less distributable, not more.\n\nthere are no upstream changes involved. and it has nothing to do with debian, the implementation also works (well, almost...) on top of sage, no more no less.\n\n> Replying to [@sagetrac-felixs](#comment%3A3):\n> > How is your planned c++-wrapper intended to implement experiments with gap internals?\n> \n> \n> That would be after libgap integration in Sage is complete, which would end up a fairly comprehensive api to the gap kernel. Then we wouldn't need to eperiment with the gap kernel regularly, so it would be fine to hide all the gap private symbols and only expose a C++ api that matches the class hierarchy in Sage.\n\nfor the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.\n \n> But first we need to wrap GAP permutations and then switch permutation groups from the gap interface to libgap.\n\nWon't it be easier to implement the permutation thing only once, after the C++-wrapper exists?\n\nWill the planned C++ wrapper be a part of sagelib or replace libgap or be another gap fork or something else (before it will be merged into gap-upstream)?",
    "created_at": "2013-07-13T16:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182479",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@vbraun](#comment%3A4):
> Who is going to maintain the wrapper library and the necessary changes to the GAP build system, you or upstream? And if its not going into upstream, then it looks to me like we are jut debianizing GAP here which will make Sage less distributable, not more.

there are no upstream changes involved. and it has nothing to do with debian, the implementation also works (well, almost...) on top of sage, no more no less.

> Replying to [@sagetrac-felixs](#comment%3A3):
> > How is your planned c++-wrapper intended to implement experiments with gap internals?
> 
> 
> That would be after libgap integration in Sage is complete, which would end up a fairly comprehensive api to the gap kernel. Then we wouldn't need to eperiment with the gap kernel regularly, so it would be fine to hide all the gap private symbols and only expose a C++ api that matches the class hierarchy in Sage.

for the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.
 
> But first we need to wrap GAP permutations and then switch permutation groups from the gap interface to libgap.

Won't it be easier to implement the permutation thing only once, after the C++-wrapper exists?

Will the planned C++ wrapper be a part of sagelib or replace libgap or be another gap fork or something else (before it will be merged into gap-upstream)?



---

archive/issue_comments_182480.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@sagetrac-felixs](#comment%3A5):\n> for the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.\n\nAnd by \"one\" I hope you mean \"Felix\" if you decide to change things.\n  \n> Won't it be easier to implement the permutation thing only once, after the C++-wrapper exists?\n\nThe problem isn't implementing it, the problem is figuring out how to interact with the GAP kernel correctly.\n\nWhile we are on the topic of feature requests: GMP integers don't work with libgap currently, only GAP's older native integer implementation.",
    "created_at": "2013-07-13T18:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182480",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@sagetrac-felixs](#comment%3A5):
> for the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.

And by "one" I hope you mean "Felix" if you decide to change things.
  
> Won't it be easier to implement the permutation thing only once, after the C++-wrapper exists?

The problem isn't implementing it, the problem is figuring out how to interact with the GAP kernel correctly.

While we are on the topic of feature requests: GMP integers don't work with libgap currently, only GAP's older native integer implementation.



---

archive/issue_comments_182481.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAlso, what do you mean by \"no upstream changes\"? You definitely need to compile as PIC code for a shared library, make the GAP signal handler optional, and provide a mechanism to hook into input/output. \n\nThe C++ api library will be libgap-2.0 and supersede (but not conflict with) the current libgap.",
    "created_at": "2013-07-13T18:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182481",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Also, what do you mean by "no upstream changes"? You definitely need to compile as PIC code for a shared library, make the GAP signal handler optional, and provide a mechanism to hook into input/output. 

The C++ api library will be libgap-2.0 and supersede (but not conflict with) the current libgap.



---

archive/issue_comments_182482.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@vbraun](#comment%3A6):\n> Replying to [@sagetrac-felixs](#comment%3A5):\n> > for the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.\n> \n> \n> And by \"one\" I hope you mean \"Felix\" if you decide to change things.\n\nI am not so sure whether experiments without libgap are necessary, but we can talk about that later. also, I am not \"changing\" things, i'm implementing a way aroung libgap (which is not packageable), I am not going to break libgap use.\n\n> > Won't it be easier to implement the permutation thing only once, after the C++-wrapper exists?\n> \n> \n> The problem isn't implementing it, the problem is figuring out how to interact with the GAP kernel correctly.\n\nAnd the kernel is changing that fast?",
    "created_at": "2013-07-13T18:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182482",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@vbraun](#comment%3A6):
> Replying to [@sagetrac-felixs](#comment%3A5):
> > for the experiments one could adapt your gapify script to generate modified headers and a more `complete` linker script.
> 
> 
> And by "one" I hope you mean "Felix" if you decide to change things.

I am not so sure whether experiments without libgap are necessary, but we can talk about that later. also, I am not "changing" things, i'm implementing a way aroung libgap (which is not packageable), I am not going to break libgap use.

> > Won't it be easier to implement the permutation thing only once, after the C++-wrapper exists?
> 
> 
> The problem isn't implementing it, the problem is figuring out how to interact with the GAP kernel correctly.

And the kernel is changing that fast?



---

archive/issue_comments_182483.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@vbraun](#comment%3A7):\n> Also, what do you mean by \"no upstream changes\"? You definitely need to compile as PIC code for a shared library, make the GAP signal handler optional, and provide a mechanism to hook into input/output. \n\nfPIC is a compile flag, not an upstrem change. the signal handler and i/o can be compiled independently.\n\n> The C++ api library will be libgap-2.0 and supersede (but not conflict with) the current libgap.\n\nyet another fork...",
    "created_at": "2013-07-13T18:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182483",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@vbraun](#comment%3A7):
> Also, what do you mean by "no upstream changes"? You definitely need to compile as PIC code for a shared library, make the GAP signal handler optional, and provide a mechanism to hook into input/output. 

fPIC is a compile flag, not an upstrem change. the signal handler and i/o can be compiled independently.

> The C++ api library will be libgap-2.0 and supersede (but not conflict with) the current libgap.

yet another fork...



---

archive/issue_comments_182484.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@sagetrac-felixs](#comment%3A8):\n> I am not so sure whether experiments without libgap are necessary\n\nMaybe not, but if it does make development of libgap significantly more difficult then its not going into Sage anytime soon.\n\n> i'm implementing a way aroung libgap (which is not packageable)\n\nIs packageable and has been packaged before.",
    "created_at": "2013-07-13T19:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182484",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@sagetrac-felixs](#comment%3A8):
> I am not so sure whether experiments without libgap are necessary

Maybe not, but if it does make development of libgap significantly more difficult then its not going into Sage anytime soon.

> i'm implementing a way aroung libgap (which is not packageable)

Is packageable and has been packaged before.



---

archive/issue_comments_182485.json:
```json
{
    "body": "Dependencies: **#14807**",
    "created_at": "2013-07-15T19:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182485",
    "user": "https://github.com/sagetrac-felixs"
}
```

Dependencies: **#14807**



---

archive/issue_comments_182486.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@vbraun](#comment%3A10):\n> Maybe not, but if it does make development of libgap significantly more difficult then its not going into Sage anytime soon.\n\nI have pushed a preview into my WIP branch on github. it uses a linker script to prefix the symbols and does not recompile anything. now, sagelib works with or without libgap on sage and on debian (but the gap debian package has not been uploaded yet).\n\ncurrently, libgap_wrap.h is generated manually. it probably should just contain all typedefs, the definitions and the externs from the gap headers eventually. if you don't insist on keeping libgap, i can adapt the libggapify script to do that automatically.\n\n> (libgap) Is packageable and has been packaged before.\n\nyes, like the patched cliquer has been packaged.",
    "created_at": "2013-07-15T19:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182486",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@vbraun](#comment%3A10):
> Maybe not, but if it does make development of libgap significantly more difficult then its not going into Sage anytime soon.

I have pushed a preview into my WIP branch on github. it uses a linker script to prefix the symbols and does not recompile anything. now, sagelib works with or without libgap on sage and on debian (but the gap debian package has not been uploaded yet).

currently, libgap_wrap.h is generated manually. it probably should just contain all typedefs, the definitions and the externs from the gap headers eventually. if you don't insist on keeping libgap, i can adapt the libggapify script to do that automatically.

> (libgap) Is packageable and has been packaged before.

yes, like the patched cliquer has been packaged.



---

archive/issue_comments_182487.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWe shouldn't copy whole GAP source files into GAP, it is is under continual development and there are regular changes to the sources. Any necessary changes should be in the form of patches to the GAP sources.\n\nAlso, the GAP shared library should be usable as a stand-alone project. Having it used outside of Sage is probably the only chance to convince upstream to integrate patches for a shared library.\n\nYour github WIP branch doesn't have `libgap_wrap.h` or the linker script, so I haven't seen them yet. In principle I don't care whether the symbols are renamed before or after compiling. But note that it has to work with the OSX and Solaris toolchains, not just with GNU.\n\n> > (libgap) Is packageable and has been packaged before.\n> \n> yes, like the patched cliquer has been packaged.\n\nAt least that one did not just copy the cliquer sources into the Sage library ;-)",
    "created_at": "2013-07-15T20:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182487",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

We shouldn't copy whole GAP source files into GAP, it is is under continual development and there are regular changes to the sources. Any necessary changes should be in the form of patches to the GAP sources.

Also, the GAP shared library should be usable as a stand-alone project. Having it used outside of Sage is probably the only chance to convince upstream to integrate patches for a shared library.

Your github WIP branch doesn't have `libgap_wrap.h` or the linker script, so I haven't seen them yet. In principle I don't care whether the symbols are renamed before or after compiling. But note that it has to work with the OSX and Solaris toolchains, not just with GNU.

> > (libgap) Is packageable and has been packaged before.
> 
> yes, like the patched cliquer has been packaged.

At least that one did not just copy the cliquer sources into the Sage library ;-)



---

archive/issue_comments_182488.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAlso, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.",
    "created_at": "2013-07-15T22:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182488",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Also, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.



---

archive/issue_comments_182489.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@vbraun](#comment%3A12):\n> We shouldn't copy whole GAP source files into GAP,\n\ninto sagelib? I agree.\n\n> Also, the GAP shared library should be usable as a stand-alone project. Having it used outside of Sage is probably the only chance to convince upstream to integrate patches for a shared library.\n\nas long as it's not a stand alone project it should not be packaged as such, because that exposes the hacked/duplicate headers/library.\n\n> Your github WIP branch doesn't have `libgap_wrap.h` or the linker script, so I haven't seen them yet.\n\nbecause i forgot to add them. i intended to autogenerate them earlier (sorry)\n\n> In principle I don't care whether the symbols are renamed before or after compiling. But note that it has to work with the OSX and Solaris toolchains, not just with GNU.\n\nisn't sage gcc only? are there any limitations to libtool that i should know about?\n\n> > > (libgap) Is packageable and has been packaged before.\n> > \n> > yes, like the patched cliquer has been packaged.\n> \n> \n> At least that one did not just copy the cliquer sources into the Sage library ;-)\n\ni have moved the non-upstream parts to the sage library, to resolve the patchwork.",
    "created_at": "2013-07-16T05:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182489",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@vbraun](#comment%3A12):
> We shouldn't copy whole GAP source files into GAP,

into sagelib? I agree.

> Also, the GAP shared library should be usable as a stand-alone project. Having it used outside of Sage is probably the only chance to convince upstream to integrate patches for a shared library.

as long as it's not a stand alone project it should not be packaged as such, because that exposes the hacked/duplicate headers/library.

> Your github WIP branch doesn't have `libgap_wrap.h` or the linker script, so I haven't seen them yet.

because i forgot to add them. i intended to autogenerate them earlier (sorry)

> In principle I don't care whether the symbols are renamed before or after compiling. But note that it has to work with the OSX and Solaris toolchains, not just with GNU.

isn't sage gcc only? are there any limitations to libtool that i should know about?

> > > (libgap) Is packageable and has been packaged before.
> > 
> > yes, like the patched cliquer has been packaged.
> 
> 
> At least that one did not just copy the cliquer sources into the Sage library ;-)

i have moved the non-upstream parts to the sage library, to resolve the patchwork.



---

archive/issue_comments_182490.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@vbraun](#comment%3A13):\n> Also, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.\n\nhopefully this isn't a real problem. gap/spkg-install also needs to compile the objects accordingly on cygwin...",
    "created_at": "2013-07-16T05:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182490",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@vbraun](#comment%3A13):
> Also, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.

hopefully this isn't a real problem. gap/spkg-install also needs to compile the objects accordingly on cygwin...



---

archive/issue_comments_182491.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-felixs](#comment%3A15):\n> Replying to [@vbraun](#comment%3A13):\n> > Also, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.\n> \n> \n> hopefully this isn't a real problem. gap/spkg-install also needs to compile the objects accordingly on cygwin...\n\nNot really unfortunately.\n\nThe problem is that libtool will refuse to gather object files into a shared library if it does not find the corresponding .lo files he produces when it is used to compile the files.\nA \"fix\" for that is to directly invoke the linker (ld, or ld through gcc/g++, on Cygwin), but of course you lose the benefits from using libtool.\n\nIn fact on Linux already you can see it ranting about that.\nOn Cygwin it will not only rant, but also abort.",
    "created_at": "2013-07-16T08:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182491",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-felixs](#comment%3A15):
> Replying to [@vbraun](#comment%3A13):
> > Also, this is similar to the hack that I introduced in the new ATLAS-3,10 to build shared libraries with the ATLAS-3.8 names. There, Jean-Pierre Flori found that libtool on Cygwin fails to build shared libraries from objects that it didn't compile itself.
> 
> 
> hopefully this isn't a real problem. gap/spkg-install also needs to compile the objects accordingly on cygwin...

Not really unfortunately.

The problem is that libtool will refuse to gather object files into a shared library if it does not find the corresponding .lo files he produces when it is used to compile the files.
A "fix" for that is to directly invoke the linker (ld, or ld through gcc/g++, on Cygwin), but of course you lose the benefits from using libtool.

In fact on Linux already you can see it ranting about that.
On Cygwin it will not only rant, but also abort.



---

archive/issue_comments_182492.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@sagetrac-felixs](#comment%3A14):\n> isn't sage gcc only? are there any limitations to libtool that i should know about?\n\nWe rely on GCC as the compiler, but the linker is not necessarily GNU ld. On OSX the Darwin linker is totally different. On Solaris one can in principle use both GNU ld and !Sun/Oracle ld but in practice Sage can only be built with Sun ld. I decided on renaming symbols before compilation because I didn't want to wade into that portability mess, though perhaps it could be sorted out. We'd need to be quite sure that it can be done on all supported and suppported-soon platforms, though.\n\nA similar approach would be to use the objcopy utility from the GNU binutils to rename symbols in object files, but that is not portable to OSX either.",
    "created_at": "2013-07-16T12:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182492",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@sagetrac-felixs](#comment%3A14):
> isn't sage gcc only? are there any limitations to libtool that i should know about?

We rely on GCC as the compiler, but the linker is not necessarily GNU ld. On OSX the Darwin linker is totally different. On Solaris one can in principle use both GNU ld and !Sun/Oracle ld but in practice Sage can only be built with Sun ld. I decided on renaming symbols before compilation because I didn't want to wade into that portability mess, though perhaps it could be sorted out. We'd need to be quite sure that it can be done on all supported and suppported-soon platforms, though.

A similar approach would be to use the objcopy utility from the GNU binutils to rename symbols in object files, but that is not portable to OSX either.



---

archive/issue_comments_182493.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\ni have now seperated the patches from gap upstream source (for convenience) and also moved to objcopy instead of using an ld script. also i've replaced the manually created libGAP_-headers by a modified GAPify.py. and the related doctests eventually pass.\n\nit's really difficult to simplify this any further -- other than drop libgap compatibilty and then get rid of the prefixing. (I should have done it like that, but I didn't know better).\n\nReplying to [@vbraun](#comment%3A18):\n> A similar approach would be to use the objcopy utility from the GNU binutils to rename symbols in object files, but that is not portable to OSX either.\n\nif objcopy doesn't work for OSX, there must be some alternative. all that is required is the --redefine-syms functionality. here, e.g. somebody claims that an ld will cut it:\nhttp://stackoverflow.com/questions/3475854/an-objcopy-equivalent-for-mac-iphone.",
    "created_at": "2013-07-21T22:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182493",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:19" align="right">comment:19</div>

i have now seperated the patches from gap upstream source (for convenience) and also moved to objcopy instead of using an ld script. also i've replaced the manually created libGAP_-headers by a modified GAPify.py. and the related doctests eventually pass.

it's really difficult to simplify this any further -- other than drop libgap compatibilty and then get rid of the prefixing. (I should have done it like that, but I didn't know better).

Replying to [@vbraun](#comment%3A18):
> A similar approach would be to use the objcopy utility from the GNU binutils to rename symbols in object files, but that is not portable to OSX either.

if objcopy doesn't work for OSX, there must be some alternative. all that is required is the --redefine-syms functionality. here, e.g. somebody claims that an ld will cut it:
http://stackoverflow.com/questions/3475854/an-objcopy-equivalent-for-mac-iphone.



---

archive/issue_comments_182494.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nDoes it work on all OSX versions? In particular, the old PPC toolchain.. \n\nThis all sounds like a rather platform-specific hack for a problem that is currently solved in a completely portable way.",
    "created_at": "2013-07-21T23:46:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182494",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:20" align="right">comment:20</div>

Does it work on all OSX versions? In particular, the old PPC toolchain.. 

This all sounds like a rather platform-specific hack for a problem that is currently solved in a completely portable way.



---

archive/issue_comments_182495.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@vbraun](#comment%3A20):\n> Does it work on all OSX versions? In particular, the old PPC toolchain.. \n\ni don't know.\n\n> This all sounds like a rather platform-specific hack for a problem that is currently solved in a completely portable way.\n\nthis depends on what you call a solution, imo forking is certainly not. If you intend to remove the symbol-renaming weirdness with libgap-2.0 (which looks like a requirement for upstream inclusion), no further platform-specific hacking will be required some day.",
    "created_at": "2013-08-06T09:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182495",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@vbraun](#comment%3A20):
> Does it work on all OSX versions? In particular, the old PPC toolchain.. 

i don't know.

> This all sounds like a rather platform-specific hack for a problem that is currently solved in a completely portable way.

this depends on what you call a solution, imo forking is certainly not. If you intend to remove the symbol-renaming weirdness with libgap-2.0 (which looks like a requirement for upstream inclusion), no further platform-specific hacking will be required some day.



---

archive/issue_comments_182496.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@sagetrac-felixs](#comment%3A21):\n> i don't know.\n\nSo, basically, your hack is neither in the interest of Sage, GAP, nor LibGAP development and serves only to make your Sage-on-debian fork easier. To me, that means you fail the primary goal of your GSoC project.",
    "created_at": "2013-08-06T13:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182496",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@sagetrac-felixs](#comment%3A21):
> i don't know.

So, basically, your hack is neither in the interest of Sage, GAP, nor LibGAP development and serves only to make your Sage-on-debian fork easier. To me, that means you fail the primary goal of your GSoC project.



---

archive/issue_comments_182497.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@vbraun](#comment%3A22):\n> So, basically, your hack is neither in the interest of Sage, GAP, nor LibGAP development and serves only to make your Sage-on-debian fork easier. \n\njust to be sure, [http://en.wikipedia.org/wiki/Fork_(software_development)](http://en.wikipedia.org/wiki/Fork_(software_development)).",
    "created_at": "2013-08-07T08:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182497",
    "user": "https://github.com/sagetrac-felixs"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@vbraun](#comment%3A22):
> So, basically, your hack is neither in the interest of Sage, GAP, nor LibGAP development and serves only to make your Sage-on-debian fork easier. 

just to be sure, [http://en.wikipedia.org/wiki/Fork_(software_development)](http://en.wikipedia.org/wiki/Fork_(software_development)).



---

archive/issue_comments_182498.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-libgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package.\n+libgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package. This is planned with libgap-2.0.\n+\n+The known workarounds don't work with OSX toolchains, so it doesn't make sense to merge them. For now, sagelib must be patched for packaging on systems without libgap.\n``````\n",
    "created_at": "2013-08-07T08:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182498",
    "user": "https://github.com/sagetrac-felixs"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-libgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package.
+libgap is a gap fork that installs a library that exposes all gap internals. this can be implemented as a wrapper library, without forking much, without exposing and without an extra libgap package. This is planned with libgap-2.0.
+
+The known workarounds don't work with OSX toolchains, so it doesn't make sense to merge them. For now, sagelib must be patched for packaging on systems without libgap.
``````




---

archive/issue_comments_182499.json:
```json
{
    "body": "Upstream: **None of the above - read trac for reasoning.**",
    "created_at": "2013-08-07T08:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182499",
    "user": "https://github.com/sagetrac-felixs"
}
```

Upstream: **None of the above - read trac for reasoning.**



---

archive/issue_events_209744.json:
```json
{
    "actor": "https://github.com/sagetrac-felixs",
    "created_at": "2013-08-07T08:24:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209744"
}
```



---

archive/issue_events_209745.json:
```json
{
    "actor": "https://github.com/sagetrac-felixs",
    "created_at": "2013-08-07T08:24:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209745"
}
```



---

archive/issue_events_209746.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209746"
}
```



---

archive/issue_events_209747.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209747"
}
```



---

archive/issue_events_209748.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209748"
}
```



---

archive/issue_events_209749.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209749"
}
```



---

archive/issue_events_209750.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209750"
}
```



---

archive/issue_events_209751.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209751"
}
```



---

archive/issue_comments_182500.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-03-21T10:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182500",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_209752.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-21T10:59:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209752"
}
```



---

archive/issue_comments_182501.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nObsoleted by #22626.",
    "created_at": "2017-03-21T10:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182501",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Obsoleted by #22626.



---

archive/issue_events_209753.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-21T10:59:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209753"
}
```



---

archive/issue_events_209754.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-21T10:59:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "c6c6c6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209754"
}
```



---

archive/issue_comments_182502.json:
```json
{
    "body": "Changed author from **Felix Salfelder** to none",
    "created_at": "2017-03-21T10:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14887#issuecomment-182502",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Felix Salfelder** to none



---

archive/issue_events_209755.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-03-21T10:59:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14887",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14887#event-209755"
}
```
