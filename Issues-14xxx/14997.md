# Issue 14997: remove redundant lines from LinearCode.shortened() and speed up LinearCode.punctured()

archive/issues_014760.json:
```json
{
    "body": "1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.\n\n```\n         Cdpd = Cdp.dual_code()\n-        Gs = Cdpd.gen_mat()\n-        return LinearCode(Gs)\n```\n2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.\n\n```\ndef puncture(C, coords):\n    G = C.gen_mat()\n    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])\n    r = G.rank()\n    if r < G.nrows():\n        G.echelonize()\n        G = G[:r]\n    return LinearCode(G)\n\nC = BinaryReedMullerCode(1, 3); C\nLinear code of length 8, dimension 4 over Finite Field of size 2\n\ntimeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n125 loops, best of 3: 946 \u00b5s per loop\nLinear code of length 3, dimension 3 over Finite Field of size 2\n\ntimeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n625 loops, best of 3: 221 \u00b5s per loop\nLinear code of length 3, dimension 3 over Finite Field of size 2\n\nC = BinaryReedMullerCode(3, 9); C\nLinear code of length 512, dimension 130 over Finite Field of size 2\n\ntimeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n5 loops, best of 3: 164 ms per loop\nLinear code of length 507, dimension 130 over Finite Field of size 2\n\ntimeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n25 loops, best of 3: 8.27 ms per loop\nLinear code of length 507, dimension 130 over Finite Field of size 2\n```\n\n---\nApply [attachment:trac_14997.patch] to `devel/sage`\n\nCC:  @dimpase\n\nReviewer: Dmitrii Pasechnik\n\nAuthor: Punarbasu Purkayastha\n\nMerged: sage-5.12.beta3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14997\n\n",
    "closed_at": "2013-08-20T13:00:16Z",
    "created_at": "2013-08-03T17:43:14Z",
    "labels": [
        "component: coding theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "remove redundant lines from LinearCode.shortened() and speed up LinearCode.punctured()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14997",
    "user": "https://github.com/ppurka"
}
```
1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.

```
         Cdpd = Cdp.dual_code()
-        Gs = Cdpd.gen_mat()
-        return LinearCode(Gs)
```
2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.

```
def puncture(C, coords):
    G = C.gen_mat()
    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])
    r = G.rank()
    if r < G.nrows():
        G.echelonize()
        G = G[:r]
    return LinearCode(G)

C = BinaryReedMullerCode(1, 3); C
Linear code of length 8, dimension 4 over Finite Field of size 2

timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
125 loops, best of 3: 946 µs per loop
Linear code of length 3, dimension 3 over Finite Field of size 2

timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
625 loops, best of 3: 221 µs per loop
Linear code of length 3, dimension 3 over Finite Field of size 2

C = BinaryReedMullerCode(3, 9); C
Linear code of length 512, dimension 130 over Finite Field of size 2

timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
5 loops, best of 3: 164 ms per loop
Linear code of length 507, dimension 130 over Finite Field of size 2

timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
25 loops, best of 3: 8.27 ms per loop
Linear code of length 507, dimension 130 over Finite Field of size 2
```

---
Apply [attachment:trac_14997.patch] to `devel/sage`

CC:  @dimpase

Reviewer: Dmitrii Pasechnik

Author: Punarbasu Purkayastha

Merged: sage-5.12.beta3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14997





---

archive/issue_comments_232876.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n Minor change, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.\n+\n+---\n+Apply [attachment:trac_14997.patch] to `devel/sage`\n``````\n",
    "created_at": "2013-08-03T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232876",
    "user": "https://github.com/ppurka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 Minor change, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.
+
+---
+Apply [attachment:trac_14997.patch] to `devel/sage`
``````




---

archive/issue_comments_232877.json:
```json
{
    "body": "Changing author from \"\" to \"Punarbasu Purkayastha\"",
    "created_at": "2013-08-03T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232877",
    "user": "https://github.com/ppurka"
}
```

Changing author from "" to "Punarbasu Purkayastha"



---

archive/issue_comments_232878.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-03T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232878",
    "user": "https://github.com/ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232879.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,44 @@\n-Minor change, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.\n+1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.\n+\n+```\n+         Cdpd = Cdp.dual_code()\n+-        Gs = Cdpd.gen_mat()\n+-        return LinearCode(Gs)\n+```\n+2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.\n+\n+```\n+def puncture(C, coords):\n+    G = C.gen_mat()\n+    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])\n+    r = G.rank()\n+    if r < G.nrows():\n+        G.echelonize()\n+        G = G[:r]\n+    return LinearCode(G)\n+\n+C = BinaryReedMullerCode(1, 3); C\n+Linear code of length 8, dimension 4 over Finite Field of size 2\n+\n+timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n+125 loops, best of 3: 946 \u00b5s per loop\n+Linear code of length 3, dimension 3 over Finite Field of size 2\n+\n+timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n+625 loops, best of 3: 221 \u00b5s per loop\n+Linear code of length 3, dimension 3 over Finite Field of size 2\n+\n+C = BinaryReedMullerCode(3, 9); C\n+Linear code of length 512, dimension 130 over Finite Field of size 2\n+\n+timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n+5 loops, best of 3: 164 ms per loop\n+Linear code of length 507, dimension 130 over Finite Field of size 2\n+\n+timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n+25 loops, best of 3: 8.27 ms per loop\n+Linear code of length 507, dimension 130 over Finite Field of size 2\n+```\n \n ---\n Apply [attachment:trac_14997.patch] to `devel/sage`\n``````\n",
    "created_at": "2013-08-03T18:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232879",
    "user": "https://github.com/ppurka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,44 @@
-Minor change, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.
+1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.
+
+```
+         Cdpd = Cdp.dual_code()
+-        Gs = Cdpd.gen_mat()
+-        return LinearCode(Gs)
+```
+2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.
+
+```
+def puncture(C, coords):
+    G = C.gen_mat()
+    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])
+    r = G.rank()
+    if r < G.nrows():
+        G.echelonize()
+        G = G[:r]
+    return LinearCode(G)
+
+C = BinaryReedMullerCode(1, 3); C
+Linear code of length 8, dimension 4 over Finite Field of size 2
+
+timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
+125 loops, best of 3: 946 µs per loop
+Linear code of length 3, dimension 3 over Finite Field of size 2
+
+timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
+625 loops, best of 3: 221 µs per loop
+Linear code of length 3, dimension 3 over Finite Field of size 2
+
+C = BinaryReedMullerCode(3, 9); C
+Linear code of length 512, dimension 130 over Finite Field of size 2
+
+timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
+5 loops, best of 3: 164 ms per loop
+Linear code of length 507, dimension 130 over Finite Field of size 2
+
+timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
+25 loops, best of 3: 8.27 ms per loop
+Linear code of length 507, dimension 130 over Finite Field of size 2
+```
 
 ---
 Apply [attachment:trac_14997.patch] to `devel/sage`
``````




---

archive/issue_events_057220.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "rename": {
        "from": "remove redundant lines from LinearCode.shortened()",
        "to": "remove redundant lines from LinearCode.shortened() and speed up LinearCode.punctured()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14997#event-57220"
}
```



---

archive/issue_comments_232880.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_14997.patch](tarball://root/attachments/some-uuid/ticket14997/trac_14997.patch) by @ppurka created at 2013-08-03 22:39:05",
    "created_at": "2013-08-03T22:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232880",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:3'></a>
Attachment [trac_14997.patch](tarball://root/attachments/some-uuid/ticket14997/trac_14997.patch) by @ppurka created at 2013-08-03 22:39:05



---

archive/issue_comments_232881.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-04T20:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232881",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232882.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2013-08-17T08:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232882",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_232883.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T13:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232883",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_232884.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.12.beta3\"",
    "created_at": "2013-08-20T13:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-232884",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.12.beta3"



---

archive/issue_events_057221.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T13:00:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14997#event-57221"
}
```
