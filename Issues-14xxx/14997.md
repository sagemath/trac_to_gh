# Issue 14997: remove redundant lines from LinearCode.shortened() and speed up LinearCode.punctured()

archive/issues_014760.json:
```json
{
    "body": "CC:  @dimpase\n\n1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.\n\n```\n         Cdpd = Cdp.dual_code()\n-        Gs = Cdpd.gen_mat()\n-        return LinearCode(Gs)\n```\n2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.\n\n```\ndef puncture(C, coords):\n    G = C.gen_mat()\n    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])\n    r = G.rank()\n    if r < G.nrows():\n        G.echelonize()\n        G = G[:r]\n    return LinearCode(G)\n\nC = BinaryReedMullerCode(1, 3); C\nLinear code of length 8, dimension 4 over Finite Field of size 2\n\ntimeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n125 loops, best of 3: 946 \u00b5s per loop\nLinear code of length 3, dimension 3 over Finite Field of size 2\n\ntimeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n625 loops, best of 3: 221 \u00b5s per loop\nLinear code of length 3, dimension 3 over Finite Field of size 2\n\nC = BinaryReedMullerCode(3, 9); C\nLinear code of length 512, dimension 130 over Finite Field of size 2\n\ntimeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])\n5 loops, best of 3: 164 ms per loop\nLinear code of length 507, dimension 130 over Finite Field of size 2\n\ntimeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])\n25 loops, best of 3: 8.27 ms per loop\nLinear code of length 507, dimension 130 over Finite Field of size 2\n```\n\n---\nApply [attachment:trac_14997.patch] to `devel/sage`\n\nIssue created by migration from https://trac.sagemath.org/ticket/14997\n\n",
    "closed_at": "2013-08-20T13:00:16Z",
    "created_at": "2013-08-03T17:43:14Z",
    "labels": [
        "component: coding theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "remove redundant lines from LinearCode.shortened() and speed up LinearCode.punctured()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14997",
    "user": "https://github.com/ppurka"
}
```
CC:  @dimpase

1. Minor change in `LinearCode.shortened()`, as mentioned in the title. The following two lines are not required since we already get a `LinearCode` instance from the `dual_code()` method.

```
         Cdpd = Cdp.dual_code()
-        Gs = Cdpd.gen_mat()
-        return LinearCode(Gs)
```
2. `LinearCode.punctured()` goes through the row space and then generates the basis vectors. This is very inefficient. Simply echelonizing the matrix speeds up the computations 4x for small generator matrices and over 18x for larger generator matrices.

```
def puncture(C, coords):
    G = C.gen_mat()
    G = G.matrix_from_columns([i for i in range(G.ncols()) if i not in coords])
    r = G.rank()
    if r < G.nrows():
        G.echelonize()
        G = G[:r]
    return LinearCode(G)

C = BinaryReedMullerCode(1, 3); C
Linear code of length 8, dimension 4 over Finite Field of size 2

timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
125 loops, best of 3: 946 µs per loop
Linear code of length 3, dimension 3 over Finite Field of size 2

timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
625 loops, best of 3: 221 µs per loop
Linear code of length 3, dimension 3 over Finite Field of size 2

C = BinaryReedMullerCode(3, 9); C
Linear code of length 512, dimension 130 over Finite Field of size 2

timeit('C.punctured([0, 1, 2, 3, 7])'); C.punctured([0, 1, 2, 3, 7])
5 loops, best of 3: 164 ms per loop
Linear code of length 507, dimension 130 over Finite Field of size 2

timeit('puncture(C, [0, 1, 2, 3, 7])'); puncture(C, [0, 1, 2, 3, 7])
25 loops, best of 3: 8.27 ms per loop
Linear code of length 507, dimension 130 over Finite Field of size 2
```

---
Apply [attachment:trac_14997.patch] to `devel/sage`

Issue created by migration from https://trac.sagemath.org/ticket/14997





---

archive/issue_comments_187981.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-03T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-187981",
    "user": "https://github.com/ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187982.json:
```json
{
    "body": "Attachment [trac_14997.patch](tarball://root/attachments/some-uuid/ticket14997/trac_14997.patch) by @ppurka created at 2013-08-03 22:39:05",
    "created_at": "2013-08-03T22:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-187982",
    "user": "https://github.com/ppurka"
}
```

Attachment [trac_14997.patch](tarball://root/attachments/some-uuid/ticket14997/trac_14997.patch) by @ppurka created at 2013-08-03 22:39:05



---

archive/issue_comments_187983.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-04T20:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-187983",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187984.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T13:00:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14997#issuecomment-187984",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_043097.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T13:00:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14997",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14997#event-43097"
}
```
