# Issue 14723: Doctest conversion from SymPy of unevaluated integrals

archive/issues_014519.json:
```json
{
    "assignees": [],
    "body": "When SymPy can't evaluate an integral, such as `integrate((log(x)*log(log(x))), x, algorithm='sympy')`, it returns \"AttributeError: 'Integral' object has no attribute '_sage_'\". It should just return an unevaluated integral, the way it does when Maxima is used.\n\nAnother example from #15256:\n\n```\nsage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') \n...\n\n \n/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.pyc in sympy_integrator(expression, v, a, b)\n     37     else:\n     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))\n---> 39     return result._sage_()\n     40\n     41 def mma_free_integrator(expression, v, a=None, b=None):\n \nAttributeError: 'Integral' object has no attribute '_sage_'\nsage: \nsage: \nsage: %debug\n> /usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py(39)sympy_integrator()\n     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))\n---> 39     return result._sage_()\n     40 \n \nipdb> print result\nIntegral(sin(x)*tan(x), x)\n```\n\nDepends on #20204\n\nAssignee: **@burcin**\n\nCC:  @kcrisman @sagetrac-asmeurer @williamstein\n\nKeywords: **sympy, integrate**\n\nBranch/Commit: **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14723_\n\n",
    "closed_at": "2017-12-11T01:04:05Z",
    "created_at": "2013-06-11T19:29:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Doctest conversion from SymPy of unevaluated integrals",
    "type": "issue",
    "updated_at": "2017-12-11T01:04:05Z",
    "url": "https://github.com/sagemath/sage/issues/14723",
    "user": "https://github.com/eviatarbach"
}
```
When SymPy can't evaluate an integral, such as `integrate((log(x)*log(log(x))), x, algorithm='sympy')`, it returns "AttributeError: 'Integral' object has no attribute '_sage_'". It should just return an unevaluated integral, the way it does when Maxima is used.

Another example from #15256:

```
sage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') 
...

 
/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.pyc in sympy_integrator(expression, v, a, b)
     37     else:
     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
---> 39     return result._sage_()
     40
     41 def mma_free_integrator(expression, v, a=None, b=None):
 
AttributeError: 'Integral' object has no attribute '_sage_'
sage: 
sage: 
sage: %debug
> /usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py(39)sympy_integrator()
     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
---> 39     return result._sage_()
     40 
 
ipdb> print result
Integral(sin(x)*tan(x), x)
```

Depends on #20204

Assignee: **@burcin**

CC:  @kcrisman @sagetrac-asmeurer @williamstein

Keywords: **sympy, integrate**

Branch/Commit: **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**

Reviewer: **Travis Scrimshaw**

Author: **Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/14723_





---

archive/issue_events_191843.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-11T19:29:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191843"
}
```



---

archive/issue_events_191844.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-11T19:29:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "component: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191844"
}
```



---

archive/issue_events_191845.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-11T19:29:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191845"
}
```



---

archive/issue_events_191846.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-11T19:29:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191846"
}
```



---

archive/issue_comments_181932.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAttachment: **[14723.patch.gz](https://github.com/sagemath/sage/files/ticket14723/14723.patch.gz)**\n\nWith the patch, `integrate(log(x)*log(log(x)), x)` is returned.",
    "created_at": "2013-06-11T19:32:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181932",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:1" align="right">Comment 1</div>

Attachment: **[14723.patch.gz](https://github.com/sagemath/sage/files/ticket14723/14723.patch.gz)**

With the patch, `integrate(log(x)*log(log(x)), x)` is returned.



---

archive/issue_events_191847.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-12T19:25:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191847"
}
```



---

archive/issue_events_191848.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-12T19:31:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191848"
}
```



---

archive/issue_events_191849.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-12T19:31:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191849"
}
```



---

archive/issue_events_191850.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191850"
}
```



---

archive/issue_events_191851.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191851"
}
```



---

archive/issue_comments_181933.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nJust looking at the patch, that doesn't look like it does the right thing for definite integrals.",
    "created_at": "2013-08-27T05:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181933",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<div id="comment:7" align="right">Comment 7</div>

Just looking at the patch, that doesn't look like it does the right thing for definite integrals.



---

archive/issue_events_191852.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191852"
}
```



---

archive/issue_events_191853.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191853"
}
```



---

archive/issue_events_191854.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191854"
}
```



---

archive/issue_events_191855.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191855"
}
```



---

archive/issue_comments_181934.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nThis is a dup of #15256.  Not sure which one should be closed.",
    "created_at": "2014-06-17T12:34:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181934",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">Comment 10</div>

This is a dup of #15256.  Not sure which one should be closed.



---

archive/issue_comments_181935.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,28 @@\n When SymPy can't evaluate an integral, such as `integrate((log(x)*log(log(x))), x, algorithm='sympy')`, it returns \"AttributeError: 'Integral' object has no attribute '_sage_'\". It should just return an unevaluated integral, the way it does when Maxima is used.\n+\n+Another example from #15256:\n+\n+```\n+sage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') \n+...\n+\n+ \n+/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.pyc in sympy_integrator(expression, v, a, b)\n+     37     else:\n+     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))\n+---> 39     return result._sage_()\n+     40\n+     41 def mma_free_integrator(expression, v, a=None, b=None):\n+ \n+AttributeError: 'Integral' object has no attribute '_sage_'\n+sage: \n+sage: \n+sage: %debug\n+> /usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py(39)sympy_integrator()\n+     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))\n+---> 39     return result._sage_()\n+     40 \n+ \n+ipdb> print result\n+Integral(sin(x)*tan(x), x)\n+```\n``````\n",
    "created_at": "2014-06-17T13:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181935",
    "user": "https://github.com/ppurka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,28 @@
 When SymPy can't evaluate an integral, such as `integrate((log(x)*log(log(x))), x, algorithm='sympy')`, it returns "AttributeError: 'Integral' object has no attribute '_sage_'". It should just return an unevaluated integral, the way it does when Maxima is used.
+
+Another example from #15256:
+
+```
+sage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') 
+...
+
+ 
+/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.pyc in sympy_integrator(expression, v, a, b)
+     37     else:
+     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
+---> 39     return result._sage_()
+     40
+     41 def mma_free_integrator(expression, v, a=None, b=None):
+ 
+AttributeError: 'Integral' object has no attribute '_sage_'
+sage: 
+sage: 
+sage: %debug
+> /usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py(39)sympy_integrator()
+     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
+---> 39     return result._sage_()
+     40 
+ 
+ipdb> print result
+Integral(sin(x)*tan(x), x)
+```
``````




---

archive/issue_events_191856.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191856"
}
```



---

archive/issue_events_191857.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191857"
}
```



---

archive/issue_comments_181936.json:
```json
{
    "body": "Work Issues: **handle definite integrals too**",
    "created_at": "2014-08-12T13:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181936",
    "user": "https://github.com/rwst"
}
```

Work Issues: **handle definite integrals too**



---

archive/issue_comments_181937.json:
```json
{
    "body": "Changed keywords from none to **sympy, integrate**",
    "created_at": "2014-08-12T13:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181937",
    "user": "https://github.com/rwst"
}
```

Changed keywords from none to **sympy, integrate**



---

archive/issue_comments_181938.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThe original case is now working in sympy:\n\n```\nsage: integrate(sin(x)*tan(x), x, algorithm='sympy') \n1/2*log(sin(x) + 1) - 1/2*log(sin(x) - 1) - sin(x)\n```\nso we need a more complicated one:\n\n```\nsage: integrate(sin(x)*tan(x)/(1-cos(x)), x, algorithm='sympy')\nintegrate(-sin(x)*tan(x)/(cos(x) - 1), x)\n```\nHowever, [comment:7](#comment%3A7) is right regarding definite integrals:\n\n```\nsage: integrate(sin(x)*tan(x)/(1-cos(x)), x, a, b, algorithm='sympy')\nintegrate(-sin(x)*tan(x)/(cos(x) - 1), x)\n```",
    "created_at": "2014-08-12T13:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181938",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">Comment 13</div>

The original case is now working in sympy:

```
sage: integrate(sin(x)*tan(x), x, algorithm='sympy') 
1/2*log(sin(x) + 1) - 1/2*log(sin(x) - 1) - sin(x)
```
so we need a more complicated one:

```
sage: integrate(sin(x)*tan(x)/(1-cos(x)), x, algorithm='sympy')
integrate(-sin(x)*tan(x)/(cos(x) - 1), x)
```
However, [comment:7](#comment%3A7) is right regarding definite integrals:

```
sage: integrate(sin(x)*tan(x)/(1-cos(x)), x, a, b, algorithm='sympy')
integrate(-sin(x)*tan(x)/(cos(x) - 1), x)
```



---

archive/issue_comments_181939.json:
```json
{
    "body": "Author: **Eviatar Bach**",
    "created_at": "2014-08-12T13:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181939",
    "user": "https://github.com/rwst"
}
```

Author: **Eviatar Bach**



---

archive/issue_comments_181940.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nIt is a matter of either\n* adding a `_sage_` method to the upstream sympy code in `sympy/integrals/integrals.py` or     \n* catching the exception in `sage.symbolic.integration.external.sympy_integrator()`\n\nEDIT: The problem with the latter is, all sorts of elementary sympy functions have a `_sage_` method, so why not add one to `sympy.Integral` or even do a bulk upgrade of sympy (e.g. `gamma._sage_` is missing too)?\n\nActually, this is https://github.com/sympy/sympy/issues/3444",
    "created_at": "2014-12-06T15:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181940",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">Comment 14</div>

It is a matter of either
* adding a `_sage_` method to the upstream sympy code in `sympy/integrals/integrals.py` or     
* catching the exception in `sage.symbolic.integration.external.sympy_integrator()`

EDIT: The problem with the latter is, all sorts of elementary sympy functions have a `_sage_` method, so why not add one to `sympy.Integral` or even do a bulk upgrade of sympy (e.g. `gamma._sage_` is missing too)?

Actually, this is https://github.com/sympy/sympy/issues/3444



---

archive/issue_comments_181941.json:
```json
{
    "body": "Changed work issues from **handle definite integrals too** to **fix in sympy**",
    "created_at": "2014-12-06T15:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181941",
    "user": "https://github.com/rwst"
}
```

Changed work issues from **handle definite integrals too** to **fix in sympy**



---

archive/issue_comments_181942.json:
```json
{
    "body": "Upstream: **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2014-12-06T15:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181942",
    "user": "https://github.com/rwst"
}
```

Upstream: **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_181943.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nEventually we may want to start looking into switching to SymPy for the default integration method, or possibly trying both by default (not sure how long that would take, though).  Before that, we'd probably want to work with #7763, though - and what about #2787?  I personally don't know that I like deprecating it, but all of this is part of the same package of taking *advantage* of the capabilities out there by having a more consistent interface.",
    "created_at": "2014-12-06T20:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181943",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">Comment 16</div>

Eventually we may want to start looking into switching to SymPy for the default integration method, or possibly trying both by default (not sure how long that would take, though).  Before that, we'd probably want to work with #7763, though - and what about #2787?  I personally don't know that I like deprecating it, but all of this is part of the same package of taking *advantage* of the capabilities out there by having a more consistent interface.



---

archive/issue_comments_181944.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Completely fixed; Fix reported upstream**",
    "created_at": "2014-12-09T09:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181944",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Completely fixed; Fix reported upstream**



---

archive/issue_comments_181945.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThis Sympy patch completely fixes the issue. A pull request containing it was reported there and waits for review.\n\nhttps://github.com/sympy/sympy/pull/8592\n\n```\ndiff --git a/sympy/integrals/integrals.py b/sympy/integrals/integrals.py\nindex 2a3ccfe..ac434c5 100644\n--- a/sympy/integrals/integrals.py\n+++ b/sympy/integrals/integrals.py\n@@ -1070,6 +1070,27 @@ def as_sum(self, n, method=\"midpoint\"):\n             result += self.function.subs(sym, xi)\n         return result*dx\n \n+    def _sage_(self, ):\n+        from sage.symbolic.integration.integral import definite_integral, indefinite_integral\n+        f, limits = self.function, list(self.limits)\n+        limit = limits.pop(-1)\n+        if len(limit) >= 2:\n+            if len(limit) == 2:\n+                x, b = limit\n+                a = None\n+            else:\n+                x, a, b = limit\n+            return definite_integral(f._sage_(),\n+                                        x._sage_(),\n+                                        a._sage_(),\n+                                        b._sage_(),\n+                                        hold=True)\n+        else:\n+            x = limit[0]\n+            return indefinite_integral(f._sage_(),\n+                                       x._sage_(),\n+                                       hold=True)\n+\n \n @xthreaded\n def integrate(*args, **kwargs):\n```",
    "created_at": "2014-12-09T09:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181945",
    "user": "https://github.com/rwst"
}
```

<div id="comment:17" align="right">Comment 17</div>

This Sympy patch completely fixes the issue. A pull request containing it was reported there and waits for review.

https://github.com/sympy/sympy/pull/8592

```
diff --git a/sympy/integrals/integrals.py b/sympy/integrals/integrals.py
index 2a3ccfe..ac434c5 100644
--- a/sympy/integrals/integrals.py
+++ b/sympy/integrals/integrals.py
@@ -1070,6 +1070,27 @@ def as_sum(self, n, method="midpoint"):
             result += self.function.subs(sym, xi)
         return result*dx
 
+    def _sage_(self, ):
+        from sage.symbolic.integration.integral import definite_integral, indefinite_integral
+        f, limits = self.function, list(self.limits)
+        limit = limits.pop(-1)
+        if len(limit) >= 2:
+            if len(limit) == 2:
+                x, b = limit
+                a = None
+            else:
+                x, a, b = limit
+            return definite_integral(f._sage_(),
+                                        x._sage_(),
+                                        a._sage_(),
+                                        b._sage_(),
+                                        hold=True)
+        else:
+            x = limit[0]
+            return indefinite_integral(f._sage_(),
+                                       x._sage_(),
+                                       hold=True)
+
 
 @xthreaded
 def integrate(*args, **kwargs):
```



---

archive/issue_comments_181946.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nHuh, that looks pretty straightforward.  Of course one would want to test it with a variety of round-trips, especially involving infinity or symbolic variables as endpoints.  How would it hold up with multivariate functions?",
    "created_at": "2014-12-09T13:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181946",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">Comment 18</div>

Huh, that looks pretty straightforward.  Of course one would want to test it with a variety of round-trips, especially involving infinity or symbolic variables as endpoints.  How would it hold up with multivariate functions?



---

archive/issue_comments_181947.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@kcrisman](#comment%3A18):\n> Huh, that looks pretty straightforward.  Of course one would want to test it with a variety of round-trips, especially involving infinity or symbolic variables as endpoints.  How would it hold up with multivariate functions?\n\nWell, if that SymPy object parameter you are talking about has a `_sage_` method, it will be called and does the right thing before it's given to the Sage function as parameter. This patch is only about SymPy's `Integral` object itself, not its parameters.",
    "created_at": "2014-12-09T14:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181947",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@kcrisman](#comment%3A18):
> Huh, that looks pretty straightforward.  Of course one would want to test it with a variety of round-trips, especially involving infinity or symbolic variables as endpoints.  How would it hold up with multivariate functions?

Well, if that SymPy object parameter you are talking about has a `_sage_` method, it will be called and does the right thing before it's given to the Sage function as parameter. This patch is only about SymPy's `Integral` object itself, not its parameters.



---

archive/issue_comments_181948.json:
```json
{
    "body": "Branch: **[u/rws/i14723](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/i14723)**",
    "created_at": "2014-12-11T09:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181948",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/i14723](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/i14723)**



---

archive/issue_comments_181949.json:
```json
{
    "body": "Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**",
    "created_at": "2014-12-11T09:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181949",
    "user": "https://github.com/rwst"
}
```

Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**



---

archive/issue_comments_181950.json:
```json
{
    "body": "Commit: **[8c345ce](https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55)**",
    "created_at": "2014-12-11T09:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181950",
    "user": "https://github.com/rwst"
}
```

Commit: **[8c345ce](https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55)**



---

archive/issue_events_191858.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-11T09:11:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191858"
}
```



---

archive/issue_events_191859.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-11T09:11:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191859"
}
```



---

archive/issue_comments_181951.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI decided to patch our own sympy until that sympy pull request gets pulled. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55\">8c345ce</a></td><td><code>14723: implement Integrate._sage_ in intalled sympy</code></td></tr></table>\n",
    "created_at": "2014-12-11T09:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181951",
    "user": "https://github.com/rwst"
}
```

<div id="comment:21" align="right">Comment 21</div>

I decided to patch our own sympy until that sympy pull request gets pulled. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55">8c345ce</a></td><td><code>14723: implement Integrate._sage_ in intalled sympy</code></td></tr></table>




---

archive/issue_comments_181952.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6\">cf6f7b1</a></td><td><code>14723: change patchlevel too</code></td></tr></table>\n",
    "created_at": "2014-12-11T09:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181952",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22" align="right">Comment 22</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6">cf6f7b1</a></td><td><code>14723: change patchlevel too</code></td></tr></table>




---

archive/issue_comments_181953.json:
```json
{
    "body": "Changed commit from **[8c345ce](https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55)** to **[cf6f7b1](https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6)**",
    "created_at": "2014-12-11T09:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181953",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8c345ce](https://github.com/sagemath/sagetrac-mirror/commit/8c345ce80f75b1936218b60b34ebc070ce1f9b55)** to **[cf6f7b1](https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6)**



---

archive/issue_comments_181954.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nSome issues surfaced, see Sympy pull request.",
    "created_at": "2014-12-15T09:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181954",
    "user": "https://github.com/rwst"
}
```

<div id="comment:23" align="right">Comment 23</div>

Some issues surfaced, see Sympy pull request.



---

archive/issue_events_191860.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-15T09:37:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191860"
}
```



---

archive/issue_events_191861.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-15T09:37:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191861"
}
```



---

archive/issue_comments_181955.json:
```json
{
    "body": "Dependencies: **#2787**",
    "created_at": "2014-12-15T14:13:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181955",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#2787**



---

archive/issue_comments_181956.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@kcrisman](#comment%3A16):\n> Eventually we may want to start looking into switching to SymPy for the default integration method, or possibly trying both by default (not sure how long that would take, though).  Before that, we'd probably want to work with #7763, though - and what about #2787?  I personally don't know that I like deprecating it, but all of this is part of the same package of taking *advantage* of the capabilities out there by having a more consistent interface.\n\nI see, I just stumbled over the necessity for #2787 for this ticket because of #17507. I'll dupe #17507 and make #2787 a dependency for this one.",
    "created_at": "2014-12-15T14:13:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181956",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@kcrisman](#comment%3A16):
> Eventually we may want to start looking into switching to SymPy for the default integration method, or possibly trying both by default (not sure how long that would take, though).  Before that, we'd probably want to work with #7763, though - and what about #2787?  I personally don't know that I like deprecating it, but all of this is part of the same package of taking *advantage* of the capabilities out there by having a more consistent interface.

I see, I just stumbled over the necessity for #2787 for this ticket because of #17507. I'll dupe #17507 and make #2787 a dependency for this one.



---

archive/issue_comments_181957.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nInteresting!  Just be careful - *particularly* for something so heavily used by non-experts (including their instructors) as integrals, we would really need a deprecation period - see [this example](https://github.com/sagemath/sage/issues/2787#comment:2) for a particularly irksome decision that would have to be made.",
    "created_at": "2014-12-15T14:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181957",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">Comment 25</div>

Interesting!  Just be careful - *particularly* for something so heavily used by non-experts (including their instructors) as integrals, we would really need a deprecation period - see [this example](https://github.com/sagemath/sage/issues/2787#comment:2) for a particularly irksome decision that would have to be made.



---

archive/issue_comments_181958.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nI take that completely back. I was in error, #17507 is only a misleading error message. The interface is consistent. Sorry.",
    "created_at": "2014-12-15T15:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181958",
    "user": "https://github.com/rwst"
}
```

<div id="comment:26" align="right">Comment 26</div>

I take that completely back. I was in error, #17507 is only a misleading error message. The interface is consistent. Sorry.



---

archive/issue_comments_181959.json:
```json
{
    "body": "Changed dependencies from **#2787** to none",
    "created_at": "2014-12-15T15:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181959",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#2787** to none



---

archive/issue_comments_181960.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\n> Some issues surfaced, see Sympy pull request.\n\nI assume you mean issues beyond whitespace and tests?  We can still include a patch for now if necessary, without just updating upstream.",
    "created_at": "2014-12-15T20:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181960",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:27" align="right">Comment 27</div>

> Some issues surfaced, see Sympy pull request.

I assume you mean issues beyond whitespace and tests?  We can still include a patch for now if necessary, without just updating upstream.



---

archive/issue_comments_181961.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@kcrisman](#comment%3A27):\n> > Some issues surfaced, see Sympy pull request.\n\n> I assume you mean issues beyond whitespace and tests?\n\nYes, I forgot to handle multiple integrals. SymPy has implemented the issue of #2787 with its `Integrate`.",
    "created_at": "2014-12-16T06:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181961",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@kcrisman](#comment%3A27):
> > Some issues surfaced, see Sympy pull request.

> I assume you mean issues beyond whitespace and tests?

Yes, I forgot to handle multiple integrals. SymPy has implemented the issue of #2787 with its `Integrate`.



---

archive/issue_comments_181962.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nSympy's \"antiderivative at\" will not have an equivalent in Sage:\n\n```\nsage: sympy.Integral(sympy.sin(x),(x,0)).doit()\n-1\nsage: integral(sin(x),x,0,hold=True)\nintegrate(sin(x), x, x, 0)\nsage: _.simplify()\ncos(x) - 1\n```\nEDIT: second problem deleted, wasn't.",
    "created_at": "2014-12-16T09:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181962",
    "user": "https://github.com/rwst"
}
```

<div id="comment:29" align="right">Comment 29</div>

Sympy's "antiderivative at" will not have an equivalent in Sage:

```
sage: sympy.Integral(sympy.sin(x),(x,0)).doit()
-1
sage: integral(sin(x),x,0,hold=True)
integrate(sin(x), x, x, 0)
sage: _.simplify()
cos(x) - 1
```
EDIT: second problem deleted, wasn't.



---

archive/issue_comments_181963.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\n> Sympy's \"antiderivative at\" will not have an equivalent in Sage:\n\nWhat is that supposed to be mathematically?  Maybe Maxima has something like this that we already translate for them?   Do you think there is a way to deal with this by raising an error upon translation back to Sage (if that's appropriate)?  Sorry for the questions; each software has a slightly different philosophy.",
    "created_at": "2014-12-16T14:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181963",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">Comment 30</div>

> Sympy's "antiderivative at" will not have an equivalent in Sage:

What is that supposed to be mathematically?  Maybe Maxima has something like this that we already translate for them?   Do you think there is a way to deal with this by raising an error upon translation back to Sage (if that's appropriate)?  Sorry for the questions; each software has a slightly different philosophy.



---

archive/issue_comments_181964.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf\">099b9f6</a></td><td><code>14723: handle multiple integrals from SymPy too</code></td></tr></table>\n",
    "created_at": "2014-12-16T14:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181964",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31" align="right">Comment 31</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf">099b9f6</a></td><td><code>14723: handle multiple integrals from SymPy too</code></td></tr></table>




---

archive/issue_comments_181965.json:
```json
{
    "body": "Changed commit from **[cf6f7b1](https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6)** to **[099b9f6](https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf)**",
    "created_at": "2014-12-16T14:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181965",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cf6f7b1](https://github.com/sagemath/sagetrac-mirror/commit/cf6f7b1b64cdde5ec0fb4a33fff3e58db6ac59d6)** to **[099b9f6](https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf)**



---

archive/issue_comments_181966.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@kcrisman](#comment%3A30):\n> > Sympy's \"antiderivative at\" will not have an equivalent in Sage:\n\n> \n> What is that supposed to be mathematically?\n\nThe indefinite integral value at the given point. I.e., if `F(x) = integral(f(x),x)` then `F(a) = sympy.Integral(f(x), x, a)`.\n\n> Maybe Maxima has something like this that we already translate for them?\n\nCouldn't find such a thing.\n\n> Do you think there is a way to deal with this by raising an error upon translation back to Sage (if that's appropriate)?  Sorry for the questions; each software has a slightly different philosophy.\n\nComputation would be 1. compute the indef. integral; 2. if succesful substitute. So not difficult I guess.",
    "created_at": "2014-12-16T15:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181966",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@kcrisman](#comment%3A30):
> > Sympy's "antiderivative at" will not have an equivalent in Sage:

> 
> What is that supposed to be mathematically?

The indefinite integral value at the given point. I.e., if `F(x) = integral(f(x),x)` then `F(a) = sympy.Integral(f(x), x, a)`.

> Maybe Maxima has something like this that we already translate for them?

Couldn't find such a thing.

> Do you think there is a way to deal with this by raising an error upon translation back to Sage (if that's appropriate)?  Sorry for the questions; each software has a slightly different philosophy.

Computation would be 1. compute the indef. integral; 2. if succesful substitute. So not difficult I guess.



---

archive/issue_comments_181967.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@rwst](#comment%3A32):\n> Computation would be 1. compute the indef. integral; 2. if succesful substitute. So not difficult I guess.\n\nHowever, we are getting unevaluated Integral objects, so nothing would be necessary IF #12438 would not change the parameters via `_normalize_integral_input()`, so a fix of that function would be necessary as well.",
    "created_at": "2014-12-16T15:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181967",
    "user": "https://github.com/rwst"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@rwst](#comment%3A32):
> Computation would be 1. compute the indef. integral; 2. if succesful substitute. So not difficult I guess.

However, we are getting unevaluated Integral objects, so nothing would be necessary IF #12438 would not change the parameters via `_normalize_integral_input()`, so a fix of that function would be necessary as well.



---

archive/issue_comments_181968.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\n> The indefinite integral value at the given point.\n\nYeah, I never know what to do with this - even though there is no \"the\" indefinite integral most systems just return a convenient one.  I think that there is a problem with actually having this syntax, though, because in general there are lots of times (esp. with complicated trig stuff) that the integral you get before simplifying is one thing, the one you get if you simplify or do some trig expansion first is different, **and** they differ by a non-zero constant!  It would be very bad to have\n\n```\nsage: F(x) = complicated stuff\nsage: integral(f, x, 0, hold=True).simplify()\n0\nsage: integral(f.some_simplification_routine(), x, 0, hold=True).simplify()\n1/2\n```\n\nSee also #13221 for the thought process behind #12438, though hopefully without too much of a hack it would be possible to support both, if that were desired.",
    "created_at": "2014-12-16T15:20:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181968",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:34" align="right">Comment 34</div>

> The indefinite integral value at the given point.

Yeah, I never know what to do with this - even though there is no "the" indefinite integral most systems just return a convenient one.  I think that there is a problem with actually having this syntax, though, because in general there are lots of times (esp. with complicated trig stuff) that the integral you get before simplifying is one thing, the one you get if you simplify or do some trig expansion first is different, **and** they differ by a non-zero constant!  It would be very bad to have

```
sage: F(x) = complicated stuff
sage: integral(f, x, 0, hold=True).simplify()
0
sage: integral(f.some_simplification_routine(), x, 0, hold=True).simplify()
1/2
```

See also #13221 for the thought process behind #12438, though hopefully without too much of a hack it would be possible to support both, if that were desired.



---

archive/issue_comments_181969.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nI would argue there is actually no scenario where Sympy would return such an antiderivative unevaluated when asked from Sage for an integral, just because #12438 rewrites the parameters *before* handing it to Sympy with `algorithm='sympy'`.\n\nSo, we do not want it, we won't get it. Please open an enhancement ticket if you think it's a necessary feature. Please review.",
    "created_at": "2014-12-16T15:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181969",
    "user": "https://github.com/rwst"
}
```

<div id="comment:35" align="right">Comment 35</div>

I would argue there is actually no scenario where Sympy would return such an antiderivative unevaluated when asked from Sage for an integral, just because #12438 rewrites the parameters *before* handing it to Sympy with `algorithm='sympy'`.

So, we do not want it, we won't get it. Please open an enhancement ticket if you think it's a necessary feature. Please review.



---

archive/issue_events_191862.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-16T15:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191862"
}
```



---

archive/issue_events_191863.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-16T15:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191863"
}
```



---

archive/issue_comments_181970.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nThe SymPy integral at a point is used by the differential equation solver in some cases where it would otherwise have to introduce a new constant for the lower limit of integration (or use negative infinity, which might not even converge). There are some examples at http://docs.sympy.org/latest/modules/solvers/ode.html. The result always ends up being correct because there always ends up being a + C1 in the solution. The syntax was borrowed from Maple, which uses it for the same purpose. Note that this syntax was introduced (by me) before we had an unevaluated Subs object. If it had existed at the time, I probably would have just used it instead.",
    "created_at": "2014-12-16T17:29:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181970",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<div id="comment:36" align="right">Comment 36</div>

The SymPy integral at a point is used by the differential equation solver in some cases where it would otherwise have to introduce a new constant for the lower limit of integration (or use negative infinity, which might not even converge). There are some examples at http://docs.sympy.org/latest/modules/solvers/ode.html. The result always ends up being correct because there always ends up being a + C1 in the solution. The syntax was borrowed from Maple, which uses it for the same purpose. Note that this syntax was introduced (by me) before we had an unevaluated Subs object. If it had existed at the time, I probably would have just used it instead.



---

archive/issue_comments_181971.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nMinor notes:\n* I think the first revision is `.p0`, not `.p1`, as Python counts starting at zero.  (Very minor note!)\n* You should have at least one example for a definite integral (the one in [comment:13](#comment%3A13) is really slow, though).\n* Is it possible to have a multiple integral example, or is the point that Sympy might want to translate a multiple integral to Sage, but not vice versa?\n\nAnyway, this is fine and hopefully in the long run will lead to more Sage-Sympy helping each other out, always a good thing.  Though I guess I'd feel most comfortable actually merging it once upstream has done so in their unstable, if they have such a concept (could be sage-pending until then).",
    "created_at": "2014-12-16T18:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181971",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:37" align="right">Comment 37</div>

Minor notes:
* I think the first revision is `.p0`, not `.p1`, as Python counts starting at zero.  (Very minor note!)
* You should have at least one example for a definite integral (the one in [comment:13](#comment%3A13) is really slow, though).
* Is it possible to have a multiple integral example, or is the point that Sympy might want to translate a multiple integral to Sage, but not vice versa?

Anyway, this is fine and hopefully in the long run will lead to more Sage-Sympy helping each other out, always a good thing.  Though I guess I'd feel most comfortable actually merging it once upstream has done so in their unstable, if they have such a concept (could be sage-pending until then).



---

archive/issue_comments_181972.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f\">af20fad</a></td><td><code>14723: better testing, patchlevel</code></td></tr></table>\n",
    "created_at": "2014-12-17T09:29:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181972",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38" align="right">Comment 38</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f">af20fad</a></td><td><code>14723: better testing, patchlevel</code></td></tr></table>




---

archive/issue_comments_181973.json:
```json
{
    "body": "Changed commit from **[099b9f6](https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf)** to **[af20fad](https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f)**",
    "created_at": "2014-12-17T09:29:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181973",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[099b9f6](https://github.com/sagemath/sagetrac-mirror/commit/099b9f6f1a67a865978bb84fd6c3a2ce29427aaf)** to **[af20fad](https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f)**



---

archive/issue_comments_181974.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nOf course we didn't need an unsolvable integral for testing this. Setting pending. Can positive be set too?",
    "created_at": "2014-12-17T09:32:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181974",
    "user": "https://github.com/rwst"
}
```

<div id="comment:39" align="right">Comment 39</div>

Of course we didn't need an unsolvable integral for testing this. Setting pending. Can positive be set too?



---

archive/issue_events_191864.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-17T09:32:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191864"
}
```



---

archive/issue_events_191865.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-12-17T09:32:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191865"
}
```



---

archive/issue_comments_181975.json:
```json
{
    "body": "Reviewer: **Ralf Stephan, Karl-Dieter Crisman**",
    "created_at": "2014-12-17T13:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181975",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Ralf Stephan, Karl-Dieter Crisman**



---

archive/issue_events_191866.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-17T13:38:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191866"
}
```



---

archive/issue_events_191867.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-17T13:38:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191867"
}
```



---

archive/issue_comments_181976.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nOh, I guess we don't have to have an undoable one.  Though my preference would be to keep it so that it raises a doctest error when Sympy can do it, which will alert us to it :-) as well as dealing with the actual reported issue on the ticket, which is our usual practice.  That said, I understand the point of testing the underlying issue.  What do you think?\n\nJust waiting on testing this new patch for the other thing you asked about... okay!",
    "created_at": "2014-12-17T13:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181976",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:40" align="right">Comment 40</div>

Oh, I guess we don't have to have an undoable one.  Though my preference would be to keep it so that it raises a doctest error when Sympy can do it, which will alert us to it :-) as well as dealing with the actual reported issue on the ticket, which is our usual practice.  That said, I understand the point of testing the underlying issue.  What do you think?

Just waiting on testing this new patch for the other thing you asked about... okay!



---

archive/issue_comments_181977.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nI do get an unrelated error (also on develop) - ever seen this?\n\n```\n\nsage -t src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 10566, in sage.symbolic.expression.get_dynamic_class_for_function\nFailed example:\n    import sagenb.misc.support as s\nExpected nothing\nGot:\n    doctest:14: ImportWarning: Not importing directory '/Users/.../sage/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py\n**********************************************************************\n```\nIt's probably related to my messing around with sagenb, no worries.",
    "created_at": "2014-12-17T13:41:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181977",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:41" align="right">Comment 41</div>

I do get an unrelated error (also on develop) - ever seen this?

```

sage -t src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10566, in sage.symbolic.expression.get_dynamic_class_for_function
Failed example:
    import sagenb.misc.support as s
Expected nothing
Got:
    doctest:14: ImportWarning: Not importing directory '/Users/.../sage/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py
**********************************************************************
```
It's probably related to my messing around with sagenb, no worries.



---

archive/issue_comments_181978.json:
```json
{
    "body": "Changed commit from **[af20fad](https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f)** to **[4c450f8](https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f)**",
    "created_at": "2014-12-17T16:10:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181978",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[af20fad](https://github.com/sagemath/sagetrac-mirror/commit/af20fadfbbbbbff27f6cd7779ed79bf1f494551f)** to **[4c450f8](https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f)**



---

archive/issue_events_191868.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-17T16:10:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191868"
}
```



---

archive/issue_events_191869.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-17T16:10:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191869"
}
```



---

archive/issue_comments_181979.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f\">4c450f8</a></td><td><code>14723: the crux of the biscuit is the apostrophe</code></td></tr></table>\n",
    "created_at": "2014-12-17T16:10:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181979",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42" align="right">Comment 42</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f">4c450f8</a></td><td><code>14723: the crux of the biscuit is the apostrophe</code></td></tr></table>




---

archive/issue_comments_181980.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nThat was a good catch.",
    "created_at": "2014-12-17T16:15:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181980",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">Comment 43</div>

That was a good catch.



---

archive/issue_events_191870.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-17T16:15:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191870"
}
```



---

archive/issue_events_191871.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-17T16:15:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191871"
}
```



---

archive/issue_comments_181981.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nYou can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that.",
    "created_at": "2014-12-18T03:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181981",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<div id="comment:44" align="right">Comment 44</div>

You can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that.



---

archive/issue_comments_181982.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\n> You can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that. \n\nAre you saying we *should* test the integrals that can't be solved to properly test this?  I don't think there is a test like this in the current patch.",
    "created_at": "2014-12-18T04:41:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181982",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:45" align="right">Comment 45</div>

> You can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that. 

Are you saying we *should* test the integrals that can't be solved to properly test this?  I don't think there is a test like this in the current patch.



---

archive/issue_comments_181983.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@kcrisman](#comment%3A45):\n> > You can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that. \n\n> \n> Are you saying we *should* test the integrals that can't be solved to properly test this?  I don't think there is a test like this in the current patch.\n\nContrary, the code of this ticket is only invoked when SymPy returns an unevaluated integral. What he suggested was replacing `x` with `f(x)` (for clarity I guess).",
    "created_at": "2014-12-18T06:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181983",
    "user": "https://github.com/rwst"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@kcrisman](#comment%3A45):
> > You can't just test integral(f(x), x), where f is an unevaluated function (Function('f') in SymPy)? SymPy will always return an unevaluated integral for that. 

> 
> Are you saying we *should* test the integrals that can't be solved to properly test this?  I don't think there is a test like this in the current patch.

Contrary, the code of this ticket is only invoked when SymPy returns an unevaluated integral. What he suggested was replacing `x` with `f(x)` (for clarity I guess).



---

archive/issue_comments_181984.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nMy point is just if you want to have an \"unsolvable\" integral that is the best one.",
    "created_at": "2014-12-18T06:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181984",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<div id="comment:47" align="right">Comment 47</div>

My point is just if you want to have an "unsolvable" integral that is the best one.



---

archive/issue_comments_181985.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nOh, that would need a `_sage_` method for `sympy.core.function.UndefinedFunction` as well. Let's do that, for completeness.",
    "created_at": "2014-12-18T08:20:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181985",
    "user": "https://github.com/rwst"
}
```

<div id="comment:48" align="right">Comment 48</div>

Oh, that would need a `_sage_` method for `sympy.core.function.UndefinedFunction` as well. Let's do that, for completeness.



---

archive/issue_comments_181986.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b\">dd4f7ff</a></td><td><code>14723: accept undefined functions from SymPy</code></td></tr></table>\n",
    "created_at": "2014-12-18T10:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181986",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49" align="right">Comment 49</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b">dd4f7ff</a></td><td><code>14723: accept undefined functions from SymPy</code></td></tr></table>




---

archive/issue_comments_181987.json:
```json
{
    "body": "Changed commit from **[4c450f8](https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f)** to **[dd4f7ff](https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b)**",
    "created_at": "2014-12-18T10:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181987",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4c450f8](https://github.com/sagemath/sagetrac-mirror/commit/4c450f8bb5ddf4253a3db347f865a7a115abfb8f)** to **[dd4f7ff](https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b)**



---

archive/issue_events_191872.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-18T10:46:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191872"
}
```



---

archive/issue_events_191873.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-18T10:46:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191873"
}
```



---

archive/issue_comments_181988.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nI presume that the latest commit, with its`class UndefinedFunction(FunctionClass):` is the equivalent of one of the changes in the same file at [the pull request](https://github.com/sympy/sympy/pull/8592/files), or does that need to be added upstream as well?\n\nGiven that asmeurer has also weighed in here, I think I am happy with accepting this before the pull request upstream formally joins in, though, so I'll give a positive review once I have a chance to test this a bit more (not this morning EST, my apologies).",
    "created_at": "2014-12-18T13:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181988",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:50" align="right">Comment 50</div>

I presume that the latest commit, with its`class UndefinedFunction(FunctionClass):` is the equivalent of one of the changes in the same file at [the pull request](https://github.com/sympy/sympy/pull/8592/files), or does that need to be added upstream as well?

Given that asmeurer has also weighed in here, I think I am happy with accepting this before the pull request upstream formally joins in, though, so I'll give a positive review once I have a chance to test this a bit more (not this morning EST, my apologies).



---

archive/issue_comments_181989.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nReplying to [@kcrisman](#comment%3A50):\n> ... or does that need to be added upstream as well?\n\nYes, it's now added.",
    "created_at": "2014-12-18T15:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181989",
    "user": "https://github.com/rwst"
}
```

<div id="comment:51" align="right">Comment 51</div>

Replying to [@kcrisman](#comment%3A50):
> ... or does that need to be added upstream as well?

Yes, it's now added.



---

archive/issue_comments_181990.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nAlong these lines, we have\n\n```\nsage: integrate(integrate(integrate(f,x),y),z)\nintegrate(integrate(integrate(f(x, y, z), x), y), z)\n```\nbut\n\n```\nsage: var('y z')\n(y, z)\nsage: f = function('f',x,y,z)\nsage: f\nf(x, y, z)\nsage: integrate(integrate(integrate(f,x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')\n---------------------------------------------------------------------------\n<snip>\n    690             return f_sympy(*sympy.sympify(g, evaluate=False))\n    691         else:\n--> 692             raise NotImplementedError(\"SymPy function '%s' doesn't exist\" % f)\n    693 \n    694 sympy = SympyConverter()\n\nNotImplementedError: SymPy function 'f' doesn't exist\nsage: integrate(integrate(integrate(f,x),y),z)\n```\nPerhaps it would be good to fix that here, or elsewhere?\n\nBut I like that\n\n```\nsage: integrate(integrate(integrate(abs(x),x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')\nintegrate(y*z*abs(x), x)\nsage: integrate(integrate(integrate(abs(x*y*z),x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')\nintegrate(integrate(integrate(abs(x*y*z), x), y), z)\n```\nso otherwise I think we should be good to go.",
    "created_at": "2014-12-18T19:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181990",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:52" align="right">Comment 52</div>

Along these lines, we have

```
sage: integrate(integrate(integrate(f,x),y),z)
integrate(integrate(integrate(f(x, y, z), x), y), z)
```
but

```
sage: var('y z')
(y, z)
sage: f = function('f',x,y,z)
sage: f
f(x, y, z)
sage: integrate(integrate(integrate(f,x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')
---------------------------------------------------------------------------
<snip>
    690             return f_sympy(*sympy.sympify(g, evaluate=False))
    691         else:
--> 692             raise NotImplementedError("SymPy function '%s' doesn't exist" % f)
    693 
    694 sympy = SympyConverter()

NotImplementedError: SymPy function 'f' doesn't exist
sage: integrate(integrate(integrate(f,x),y),z)
```
Perhaps it would be good to fix that here, or elsewhere?

But I like that

```
sage: integrate(integrate(integrate(abs(x),x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')
integrate(y*z*abs(x), x)
sage: integrate(integrate(integrate(abs(x*y*z),x,algorithm='sympy'),y,algorithm='sympy'),z,algorithm='sympy')
integrate(integrate(integrate(abs(x*y*z), x), y), z)
```
so otherwise I think we should be good to go.



---

archive/issue_comments_181991.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d\">e2f0713</a></td><td><code>14723: sage-style doctests; conversion of symbolic fns to SymPy</code></td></tr></table>\n",
    "created_at": "2014-12-19T09:46:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181991",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:53" align="right">Comment 53</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d">e2f0713</a></td><td><code>14723: sage-style doctests; conversion of symbolic fns to SymPy</code></td></tr></table>




---

archive/issue_comments_181992.json:
```json
{
    "body": "Changed commit from **[dd4f7ff](https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b)** to **[e2f0713](https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d)**",
    "created_at": "2014-12-19T09:46:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181992",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dd4f7ff](https://github.com/sagemath/sagetrac-mirror/commit/dd4f7ffae3eb5a98734430f5c94347d9c785989b)** to **[e2f0713](https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d)**



---

archive/issue_events_191874.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-19T13:33:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191874"
}
```



---

archive/issue_events_191875.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-19T13:33:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191875"
}
```



---

archive/issue_comments_181993.json:
```json
{
    "body": "Changed work issues from **fix in sympy** to none",
    "created_at": "2014-12-19T13:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181993",
    "user": "https://github.com/kcrisman"
}
```

Changed work issues from **fix in sympy** to none



---

archive/issue_comments_181994.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nThanks, this is really a much more robust patch now.  I'm sure there are still some things we won't get right, but this goes a long ways toward better Sage-Sympy integration.  Just waiting on some basic tests for positive review.",
    "created_at": "2014-12-19T13:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181994",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:54" align="right">Comment 54</div>

Thanks, this is really a much more robust patch now.  I'm sure there are still some things we won't get right, but this goes a long ways toward better Sage-Sympy integration.  Just waiting on some basic tests for positive review.



---

archive/issue_comments_181995.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nGlad I ran the tests - this is a good one to have fail, though :-)\n\n```\n**********************************************************************\nFile \"src/sage/symbolic/function.pyx\", line 634, in sage.symbolic.function.Function._sympy_init_\nFailed example:\n    g(x)._sympy_()\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: SymPy function 'gg' doesn't exist\nGot:\n    gg(x)\n**********************************************************************\n```\nI do love that we code errors in the tests, because it's always gratifying to see when someone has fixed one.  (Can you think of another way to test that error branch, incidentally? I have to admit I can't offhand, unless it's a (very unusual!) Sage symbolic function not in Sympy, maybe something number-theoretic, or maybe just a fake function?)",
    "created_at": "2014-12-19T13:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181995",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:55" align="right">Comment 55</div>

Glad I ran the tests - this is a good one to have fail, though :-)

```
**********************************************************************
File "src/sage/symbolic/function.pyx", line 634, in sage.symbolic.function.Function._sympy_init_
Failed example:
    g(x)._sympy_()
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: SymPy function 'gg' doesn't exist
Got:
    gg(x)
**********************************************************************
```
I do love that we code errors in the tests, because it's always gratifying to see when someone has fixed one.  (Can you think of another way to test that error branch, incidentally? I have to admit I can't offhand, unless it's a (very unusual!) Sage symbolic function not in Sympy, maybe something number-theoretic, or maybe just a fake function?)



---

archive/issue_comments_181996.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf\">880a617</a></td><td><code>14723: fix doctest</code></td></tr></table>\n",
    "created_at": "2014-12-19T14:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181996",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56" align="right">Comment 56</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf">880a617</a></td><td><code>14723: fix doctest</code></td></tr></table>




---

archive/issue_comments_181997.json:
```json
{
    "body": "Changed commit from **[e2f0713](https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d)** to **[880a617](https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf)**",
    "created_at": "2014-12-19T14:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181997",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e2f0713](https://github.com/sagemath/sagetrac-mirror/commit/e2f0713047e65e20969361725e3c29090379eb0d)** to **[880a617](https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf)**



---

archive/issue_events_191876.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-19T14:12:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191876"
}
```



---

archive/issue_events_191877.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-12-19T14:12:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191877"
}
```



---

archive/issue_comments_181998.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nThanks for all the work here.",
    "created_at": "2014-12-19T14:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181998",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:57" align="right">Comment 57</div>

Thanks for all the work here.



---

archive/issue_events_191878.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-19T14:18:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191878"
}
```



---

archive/issue_events_191879.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-12-19T14:18:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191879"
}
```



---

archive/issue_comments_181999.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\nThanks for the review.",
    "created_at": "2014-12-19T14:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-181999",
    "user": "https://github.com/rwst"
}
```

<div id="comment:58" align="right">Comment 58</div>

Thanks for the review.



---

archive/issue_comments_182000.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nPSA: Once you want the ticket merged you can set a milestone to something else than \"sage-pending\"",
    "created_at": "2015-01-29T15:50:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182000",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:59" align="right">Comment 59</div>

PSA: Once you want the ticket merged you can set a milestone to something else than "sage-pending"



---

archive/issue_comments_182001.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nThanks; in this case I think we are waiting for [https://github.com/sympy/sympy/pull/8817](https://github.com/sympy/sympy/pull/8817) to be merged in upstream unstable.",
    "created_at": "2015-01-29T16:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182001",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:60" align="right">Comment 60</div>

Thanks; in this case I think we are waiting for [https://github.com/sympy/sympy/pull/8817](https://github.com/sympy/sympy/pull/8817) to be merged in upstream unstable.



---

archive/issue_comments_182002.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nI have merged the upstream PR.",
    "created_at": "2015-01-29T17:22:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182002",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<div id="comment:61" align="right">Comment 61</div>

I have merged the upstream PR.



---

archive/issue_events_191880.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-01-29T17:24:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191880"
}
```



---

archive/issue_events_191881.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-01-29T17:24:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191881"
}
```



---

archive/issue_comments_182003.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nAwesome, thanks.",
    "created_at": "2015-01-29T17:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182003",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:62" align="right">Comment 62</div>

Awesome, thanks.



---

archive/issue_comments_182004.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nConflicts with #17493",
    "created_at": "2015-02-07T09:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182004",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:63" align="right">Comment 63</div>

Conflicts with #17493



---

archive/issue_comments_182005.json:
```json
{
    "body": "Changed commit from **[880a617](https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf)** to **[6c74620](https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4)**",
    "created_at": "2015-02-07T13:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182005",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[880a617](https://github.com/sagemath/sagetrac-mirror/commit/880a6177ed7f1b260c19e2b3b92eef0f0f516daf)** to **[6c74620](https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4)**



---

archive/issue_events_191882.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-02-07T13:41:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191882"
}
```



---

archive/issue_events_191883.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2015-02-07T13:41:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191883"
}
```



---

archive/issue_comments_182006.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/813e19fff28608513be685177186efa8688b7f86\">813e19f</a></td><td><code>14723: fix conflict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dccb4ed967b691cac2d3c51a687f8d2dfa84787\">3dccb4e</a></td><td><code>17493: add `_sage_` method to ComplexInfinity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ca600ad4bd10ee2295d47ac505dacb61fc882bd\">7ca600a</a></td><td><code>17493: doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4928fa4b58f9aa301b9fb5942cdce04fa54e6a52\">4928fa4</a></td><td><code>17493: remove unrelated patchfile</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1aff5f2b4d856a1324f544040e5984dfdcc80734\">1aff5f2</a></td><td><code>Merge branch 'develop' into t/17493/bind_sympy_s_complexinfinity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27e2fc707687c7c55434608464952075be7a3b25\">27e2fc7</a></td><td><code>17493: add unsigned_infinity conversion to sympy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a514394ee5045c5d3a06968ba2d00d0bb179f7ae\">a514394</a></td><td><code>Reviewer patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4\">6c74620</a></td><td><code>Merge branch 'u/kcrisman/ticket/17493' of trac.sagemath.org:sage into t/14723/i14723</code></td></tr></table>\n",
    "created_at": "2015-02-07T13:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182006",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:64" align="right">Comment 64</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/813e19fff28608513be685177186efa8688b7f86">813e19f</a></td><td><code>14723: fix conflict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dccb4ed967b691cac2d3c51a687f8d2dfa84787">3dccb4e</a></td><td><code>17493: add `_sage_` method to ComplexInfinity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ca600ad4bd10ee2295d47ac505dacb61fc882bd">7ca600a</a></td><td><code>17493: doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4928fa4b58f9aa301b9fb5942cdce04fa54e6a52">4928fa4</a></td><td><code>17493: remove unrelated patchfile</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1aff5f2b4d856a1324f544040e5984dfdcc80734">1aff5f2</a></td><td><code>Merge branch 'develop' into t/17493/bind_sympy_s_complexinfinity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27e2fc707687c7c55434608464952075be7a3b25">27e2fc7</a></td><td><code>17493: add unsigned_infinity conversion to sympy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a514394ee5045c5d3a06968ba2d00d0bb179f7ae">a514394</a></td><td><code>Reviewer patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4">6c74620</a></td><td><code>Merge branch 'u/kcrisman/ticket/17493' of trac.sagemath.org:sage into t/14723/i14723</code></td></tr></table>




---

archive/issue_comments_182007.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nMerged #14723. Please review fix.",
    "created_at": "2015-02-07T13:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182007",
    "user": "https://github.com/rwst"
}
```

<div id="comment:65" align="right">Comment 65</div>

Merged #14723. Please review fix.



---

archive/issue_comments_182008.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nThe following test failure may be related to the changes in this ticket (no time to check right now, sorry).\n\n```\n**********************************************************************\nFile \"src/sage/tests/french_book/recequadiff.py\", line 387, in sage.tests.french_book.recequadiff\nFailed example:\n    rsolve(f, u(n), {u(0):-1,u(1):1})\nException raised:\n    Traceback (most recent call last):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 488, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 850, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.french_book.recequadiff[107]>\", line 1, in <module>\n        rsolve(f, u(n), {u(Integer(0)):-Integer(1),u(Integer(1)):Integer(1)})\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sympy/solvers/recurr.py\", line 733, in rsolve\n        \"'%s(%s+k)' expected, got '%s'\" % (y.func, n, h))\n    ValueError: 'u(n+k)' expected, got 'u(n + 1)'\n**********************************************************************\n```",
    "created_at": "2015-02-07T15:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182008",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:66" align="right">Comment 66</div>

The following test failure may be related to the changes in this ticket (no time to check right now, sorry).

```
**********************************************************************
File "src/sage/tests/french_book/recequadiff.py", line 387, in sage.tests.french_book.recequadiff
Failed example:
    rsolve(f, u(n), {u(0):-1,u(1):1})
Exception raised:
    Traceback (most recent call last):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 850, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.french_book.recequadiff[107]>", line 1, in <module>
        rsolve(f, u(n), {u(Integer(0)):-Integer(1),u(Integer(1)):Integer(1)})
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sympy/solvers/recurr.py", line 733, in rsolve
        "'%s(%s+k)' expected, got '%s'" % (y.func, n, h))
    ValueError: 'u(n+k)' expected, got 'u(n + 1)'
**********************************************************************
```



---

archive/issue_comments_182009.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nI don't get this error. Please recheck.",
    "created_at": "2015-02-08T06:43:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182009",
    "user": "https://github.com/rwst"
}
```

<div id="comment:67" align="right">Comment 67</div>

I don't get this error. Please recheck.



---

archive/issue_comments_182010.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [@rwst](#comment%3A67):\n> I don't get this error. Please recheck.\n\nApparently I had an older version of your branch. The problem goes away with the last version. Sorry for the noise.",
    "created_at": "2015-02-08T09:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182010",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [@rwst](#comment%3A67):
> I don't get this error. Please recheck.

Apparently I had an older version of your branch. The problem goes away with the last version. Sorry for the noise.



---

archive/issue_events_191884.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-08T09:22:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191884"
}
```



---

archive/issue_events_191885.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-08T09:22:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191885"
}
```



---

archive/issue_comments_182011.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nAnd now I've compiled a version of sage including all positively reviewed changes, and the test fails again. Do you see any other ticket that may be the cause the problem? I will also launch a brute force `git bisect`, but it may take a while to complete.",
    "created_at": "2015-02-08T13:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182011",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:69" align="right">Comment 69</div>

And now I've compiled a version of sage including all positively reviewed changes, and the test fails again. Do you see any other ticket that may be the cause the problem? I will also launch a brute force `git bisect`, but it may take a while to complete.



---

archive/issue_comments_182012.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">Comment 70</div>\n\nCan only be a Sympy problem, or the way Sympy is used. Did you do `make` to include the patches from #17493 and #14723 into your Sage?",
    "created_at": "2015-02-08T14:08:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182012",
    "user": "https://github.com/rwst"
}
```

<div id="comment:70" align="right">Comment 70</div>

Can only be a Sympy problem, or the way Sympy is used. Did you do `make` to include the patches from #17493 and #14723 into your Sage?



---

archive/issue_comments_182013.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">Comment 71</div>\n\nReplying to [@rwst](#comment%3A70):\n> Can only be a Sympy problem, or the way Sympy is used.\n\nYup, that's why I thought the problem may come from this ticket.\n\n> Did you do `make` to include the patches from #17493 and #14723 into your Sage?\n\nYes.",
    "created_at": "2015-02-08T14:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182013",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:71" align="right">Comment 71</div>

Replying to [@rwst](#comment%3A70):
> Can only be a Sympy problem, or the way Sympy is used.

Yup, that's why I thought the problem may come from this ticket.

> Did you do `make` to include the patches from #17493 and #14723 into your Sage?

Yes.



---

archive/issue_comments_182014.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nReplying to [@mezzarobba](#comment%3A69):\n> I will also launch a brute force `git bisect`, but it may take a while to complete.\n\nNo success with that, there are commits where sage fails to build or similar situations that make it a pain.\n\nIf I understand correctly, the `n` in `result = h.args[0].match(n + k)` (`recurr.py:727`) somehow ends up being different than the one in appearing in the argument of `h`, so that the match fails. I suspect there is a conversion from sympy to sage and back going on somewhere, but I have no idea how this all works...",
    "created_at": "2015-02-09T13:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182014",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:72" align="right">Comment 72</div>

Replying to [@mezzarobba](#comment%3A69):
> I will also launch a brute force `git bisect`, but it may take a while to complete.

No success with that, there are commits where sage fails to build or similar situations that make it a pain.

If I understand correctly, the `n` in `result = h.args[0].match(n + k)` (`recurr.py:727`) somehow ends up being different than the one in appearing in the argument of `h`, so that the match fails. I suspect there is a conversion from sympy to sage and back going on somewhere, but I have no idea how this all works...



---

archive/issue_comments_182015.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nCan you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?",
    "created_at": "2015-02-09T13:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182015",
    "user": "https://github.com/rwst"
}
```

<div id="comment:73" align="right">Comment 73</div>

Can you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?



---

archive/issue_comments_182016.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">Comment 74</div>\n\nReplying to [@rwst](#comment%3A73):\n> Can you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?\n\nI pushed to `u/mmezzarobba/tmp/sympy` a branch that contains all the commits I was playing with yesterday (if I remember correctly) plus some, and with which the test still fails. In the meantime I am rebuilding the current `trac/develop` plus the branch from this ticket...",
    "created_at": "2015-02-09T14:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182016",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:74" align="right">Comment 74</div>

Replying to [@rwst](#comment%3A73):
> Can you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?

I pushed to `u/mmezzarobba/tmp/sympy` a branch that contains all the commits I was playing with yesterday (if I remember correctly) plus some, and with which the test still fails. In the meantime I am rebuilding the current `trac/develop` plus the branch from this ticket...



---

archive/issue_comments_182017.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nReplying to [@mezzarobba](#comment%3A74):\n> Replying to [@rwst](#comment%3A73):\n> > Can you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?\n\n> \n> I pushed to `u/mmezzarobba/tmp/sympy` a branch that contains all the commits I was playing with yesterday (if I remember correctly) plus some, and with which the test still fails. In the meantime I am rebuilding the current `trac/develop` plus the branch from this ticket...\n\n...and the test still fails with that build, even after `./sage -i -f sympy ; make build`.",
    "created_at": "2015-02-09T14:39:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182017",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:75" align="right">Comment 75</div>

Replying to [@mezzarobba](#comment%3A74):
> Replying to [@rwst](#comment%3A73):
> > Can you attach here a diff against develop of your all-positive branch so that I can try to confirm your result at least?

> 
> I pushed to `u/mmezzarobba/tmp/sympy` a branch that contains all the commits I was playing with yesterday (if I remember correctly) plus some, and with which the test still fails. In the meantime I am rebuilding the current `trac/develop` plus the branch from this ticket...

...and the test still fails with that build, even after `./sage -i -f sympy ; make build`.



---

archive/issue_comments_182018.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nI don't think I can download your branch, keeps asking me for a password.",
    "created_at": "2015-02-09T15:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182018",
    "user": "https://github.com/rwst"
}
```

<div id="comment:76" align="right">Comment 76</div>

I don't think I can download your branch, keeps asking me for a password.



---

archive/issue_comments_182019.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">Comment 77</div>\n\nSee this link, though:\nhttps://github.com/sagemath/sagetrac-mirror/commit/29e862a147f129c5694f5cbd83338826f9a9e468&h=u%2Fmmezzarobba%2Ftmp%2Fsympy",
    "created_at": "2015-02-09T15:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182019",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:77" align="right">Comment 77</div>

See this link, though:
https://github.com/sagemath/sagetrac-mirror/commit/29e862a147f129c5694f5cbd83338826f9a9e468&h=u%2Fmmezzarobba%2Ftmp%2Fsympy



---

archive/issue_comments_182020.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">Comment 78</div>\n\nReplying to [@rwst](#comment%3A76):\n> I don't think I can download your branch, keeps asking me for a password. \n\nI don't know what is going on, but in view of my previous comment, it doesn't matter...",
    "created_at": "2015-02-09T15:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182020",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:78" align="right">Comment 78</div>

Replying to [@rwst](#comment%3A76):
> I don't think I can download your branch, keeps asking me for a password. 

I don't know what is going on, but in view of my previous comment, it doesn't matter...



---

archive/issue_events_191886.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-09T16:04:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191886"
}
```



---

archive/issue_events_191887.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-09T16:04:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191887"
}
```



---

archive/issue_comments_182021.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">Comment 80</div>\n\nOK, it's definitely the integrate patch, i.e., this ticket (not the other).",
    "created_at": "2015-02-09T16:34:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182021",
    "user": "https://github.com/rwst"
}
```

<div id="comment:80" align="right">Comment 80</div>

OK, it's definitely the integrate patch, i.e., this ticket (not the other).



---

archive/issue_comments_182022.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">Comment 81</div>\n\nIn Sympy master it works fine, maybe there is something with our `01_no-mpmath.patch`. I'd rather wait for sympy-0.7.7 which doesn't need it anymore.",
    "created_at": "2015-02-09T17:07:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182022",
    "user": "https://github.com/rwst"
}
```

<div id="comment:81" align="right">Comment 81</div>

In Sympy master it works fine, maybe there is something with our `01_no-mpmath.patch`. I'd rather wait for sympy-0.7.7 which doesn't need it anymore.



---

archive/issue_events_191888.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-13T13:49:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191888"
}
```



---

archive/issue_events_191889.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-13T13:49:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191889"
}
```



---

archive/issue_comments_182023.json:
```json
{
    "body": "Dependencies: **#20815**",
    "created_at": "2016-03-14T15:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182023",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#20815**



---

archive/issue_comments_182024.json:
```json
{
    "body": "Changed dependencies from **#20815** to **#20185**",
    "created_at": "2016-03-14T15:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182024",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#20815** to **#20185**



---

archive/issue_comments_182025.json:
```json
{
    "body": "Changed dependencies from **#20185** to **#20204**",
    "created_at": "2016-08-06T09:07:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182025",
    "user": "https://github.com/rwst"
}
```

Changed dependencies from **#20185** to **#20204**



---

archive/issue_comments_182026.json:
```json
{
    "body": "Changed upstream from **Completely fixed; Fix reported upstream** to **None of the above - read trac for reasoning.**",
    "created_at": "2016-08-06T09:07:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182026",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **Completely fixed; Fix reported upstream** to **None of the above - read trac for reasoning.**



---

archive/issue_comments_182027.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">Comment 85</div>\n\nSummary:\n\nThe Sympy patch of this branch contains two hunks, one patches `integral.py`, the other `function.py`. The latter one adds a `_sage_` method to `AppliedUndef` but uses a deprecated call method. The added `_sage_` method is already there in sympy-1 but gets deleted by a patch in #20185 because it triggers the same error in #20185 as Marc reported here (I was too stupid to rebuild Sympy to see it). So the problem actually exists. However, without the patch this branch does not work.\n\nThe first part (the one for `integral.py`) is no longer necessary because it is in Sympy already.\n\nSo what needs to be done is to fix in Sympy and/or Sage the described error. It is investigated in #20185 and its dedicated ticket is #20204, so we depend on that.",
    "created_at": "2016-08-06T09:07:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182027",
    "user": "https://github.com/rwst"
}
```

<div id="comment:85" align="right">Comment 85</div>

Summary:

The Sympy patch of this branch contains two hunks, one patches `integral.py`, the other `function.py`. The latter one adds a `_sage_` method to `AppliedUndef` but uses a deprecated call method. The added `_sage_` method is already there in sympy-1 but gets deleted by a patch in #20185 because it triggers the same error in #20185 as Marc reported here (I was too stupid to rebuild Sympy to see it). So the problem actually exists. However, without the patch this branch does not work.

The first part (the one for `integral.py`) is no longer necessary because it is in Sympy already.

So what needs to be done is to fix in Sympy and/or Sage the described error. It is investigated in #20185 and its dedicated ticket is #20204, so we depend on that.



---

archive/issue_comments_182028.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">Comment 86</div>\n\nWhile trying to debug #23496, I noticed that assumptions are lost going to/from Sympy and Sage, which was causing different Sympy `Symbol`s to be created. This may cause some subtle problems at some point if we just work around the problem on #23496 instead of fixing it.",
    "created_at": "2017-09-02T16:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182028",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:86" align="right">Comment 86</div>

While trying to debug #23496, I noticed that assumptions are lost going to/from Sympy and Sage, which was causing different Sympy `Symbol`s to be created. This may cause some subtle problems at some point if we just work around the problem on #23496 instead of fixing it.



---

archive/issue_comments_182029.json:
```json
{
    "body": "Changed upstream from **None of the above - read trac for reasoning.** to none",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182029",
    "user": "https://github.com/rwst"
}
```

Changed upstream from **None of the above - read trac for reasoning.** to none



---

archive/issue_comments_182030.json:
```json
{
    "body": "Changed author from **Eviatar Bach, Ralf Stephan** to none",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182030",
    "user": "https://github.com/rwst"
}
```

Changed author from **Eviatar Bach, Ralf Stephan** to none



---

archive/issue_comments_182031.json:
```json
{
    "body": "Changed branch from **[u/rws/i14723](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/i14723)** to none",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182031",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/i14723](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/i14723)** to none



---

archive/issue_comments_182032.json:
```json
{
    "body": "Changed commit from **[6c74620](https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4)** to none",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182032",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[6c74620](https://github.com/sagemath/sagetrac-mirror/commit/6c746203fff98cdafe01b4a6cd95e7c2880366c4)** to none



---

archive/issue_events_191890.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:17:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191890"
}
```



---

archive/issue_events_191891.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:17:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191891"
}
```



---

archive/issue_comments_182033.json:
```json
{
    "body": "Changed reviewer from **Ralf Stephan, Karl-Dieter Crisman** to none",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182033",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Ralf Stephan, Karl-Dieter Crisman** to none



---

archive/issue_comments_182034.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">Comment 87</div>\n\nAll conversion problems were resolved in 8.1.rc0. The problematic integrals in this tickets, including the triple one, work now without any additional code. What remains for this ticket is to add doctests.",
    "created_at": "2017-11-09T08:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182034",
    "user": "https://github.com/rwst"
}
```

<div id="comment:87" align="right">Comment 87</div>

All conversion problems were resolved in 8.1.rc0. The problematic integrals in this tickets, including the triple one, work now without any additional code. What remains for this ticket is to add doctests.



---

archive/issue_comments_182035.json:
```json
{
    "body": "Branch: **[u/rws/14723-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/14723-1)**",
    "created_at": "2017-11-09T08:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182035",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/14723-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/14723-1)**



---

archive/issue_comments_182036.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">Comment 89</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d\">119f46f</a></td><td><code>14723: Doctest conversion from SymPy of unevaluated integrals</code></td></tr></table>\n",
    "created_at": "2017-11-09T08:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182036",
    "user": "https://github.com/rwst"
}
```

<div id="comment:89" align="right">Comment 89</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d">119f46f</a></td><td><code>14723: Doctest conversion from SymPy of unevaluated integrals</code></td></tr></table>




---

archive/issue_events_191892.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:35:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191892"
}
```



---

archive/issue_events_191893.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:35:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191893"
}
```



---

archive/issue_comments_182037.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2017-11-09T08:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182037",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_182038.json:
```json
{
    "body": "Commit: **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**",
    "created_at": "2017-11-09T08:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182038",
    "user": "https://github.com/rwst"
}
```

Commit: **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**



---

archive/issue_events_191894.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:35:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191894"
}
```



---

archive/issue_events_191895.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-11-09T08:35:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "title_is": "Doctest conversion from SymPy of unevaluated integrals",
    "title_was": "Error when SymPy can't evaluate an integral",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191895"
}
```



---

archive/issue_comments_182039.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-11-09T09:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182039",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_191896.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-09T09:11:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191896"
}
```



---

archive/issue_events_191897.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-09T09:11:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191897"
}
```



---

archive/issue_comments_182040.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">Comment 90</div>\n\nLGTM.",
    "created_at": "2017-11-09T09:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182040",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:90" align="right">Comment 90</div>

LGTM.



---

archive/issue_comments_182041.json:
```json
{
    "body": "Changed branch from **[u/rws/14723-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/14723-1)** to **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**",
    "created_at": "2017-12-11T01:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14723#issuecomment-182041",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/14723-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/14723-1)** to **[119f46f](https://github.com/sagemath/sagetrac-mirror/commit/119f46f5119e535c53daaeb2404281714b348f6d)**



---

archive/issue_events_191898.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:04:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191898"
}
```



---

archive/issue_events_191899.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ce5cb6c79a1eab1157d832dc3bc3e57118f08f0e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-11T01:04:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14723",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14723#event-191899"
}
```
