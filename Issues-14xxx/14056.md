# Issue 14056: Distance matrix

archive/issues_013852.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/nathanncohen",
        "https://github.com/rlmill"
    ],
    "body": "Hello!\n\nWe have the **adjacency_matrix** and **kirchhoff_matrix** methods for graphs. I am very much missing a method for the distance_matrix since in the current project I am working with requires us to study some algebraic proprieties of the distance matrix.  \n\nIt is obviously trivial to implement independently but I am tired of writing distance_matrix(G) all the time.\n\nSo before adding a patch implementing that I am wondering if you other guys agree with that and if perhaps I have overlooked that functionality.\n\nApply:\n\n* [attachment: trac_14056_distancem.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)\n* [attachment: trac_14056_distancem.2.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)\n* [attachment: trac_14056-rev.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)\n\nCC:  @rbeezer @nathanncohen @dcoudert @Stefan\n\nReviewer: **Nathann Cohen**\n\nAuthor: **Jernej Azarija**\n\nMerged: **sage-5.10.beta5**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14056_\n\n",
    "closed_at": "2013-05-22T08:18:08Z",
    "created_at": "2013-02-04T20:31:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Distance matrix",
    "type": "issue",
    "updated_at": "2013-05-22T08:18:08Z",
    "url": "https://github.com/sagemath/sage/issues/14056",
    "user": "https://github.com/sagetrac-azi"
}
```
Hello!

We have the **adjacency_matrix** and **kirchhoff_matrix** methods for graphs. I am very much missing a method for the distance_matrix since in the current project I am working with requires us to study some algebraic proprieties of the distance matrix.  

It is obviously trivial to implement independently but I am tired of writing distance_matrix(G) all the time.

So before adding a patch implementing that I am wondering if you other guys agree with that and if perhaps I have overlooked that functionality.

Apply:

* [attachment: trac_14056_distancem.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)
* [attachment: trac_14056_distancem.2.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)
* [attachment: trac_14056-rev.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)

CC:  @rbeezer @nathanncohen @dcoudert @Stefan

Reviewer: **Nathann Cohen**

Author: **Jernej Azarija**

Merged: **sage-5.10.beta5**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/14056_





---

archive/issue_events_195723.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195723"
}
```



---

archive/issue_events_195724.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195724"
}
```



---

archive/issue_events_195725.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195725"
}
```



---

archive/issue_events_195726.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195726"
}
```



---

archive/issue_events_195727.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195727"
}
```



---

archive/issue_events_195728.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195728"
}
```



---

archive/issue_events_195729.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2013-02-04T20:31:01Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195729"
}
```



---

archive/issue_comments_166930.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nSo far you can get the distances as a dict of dict but not as a matrix. \n\nI think it could be useful.",
    "created_at": "2013-02-04T20:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166930",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1" align="right">comment:1</div>

So far you can get the distances as a dict of dict but not as a matrix. 

I think it could be useful.



---

archive/issue_comments_166931.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI also think this would be useful.  The dict of dicts is a bit cumbersome to work with sometimes.\n\nPlus, it would be nice to have\n\n- the 0-1 matrix for vertex pairs at distance `i` apart (the adjacency matrix of the distance graphs, which are implemented)\n\n- the actual set (list) of vertices at distance `i` from a given vertex `v`\n\nYou might give some thought to the name, I tend to think of \"distance matrix\" as the 0-1 matrix just above and not the matrix of distances, even though that is a perfectly rational choice.  `matrix_of_distances`?",
    "created_at": "2013-02-04T21:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166931",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:2" align="right">comment:2</div>

I also think this would be useful.  The dict of dicts is a bit cumbersome to work with sometimes.

Plus, it would be nice to have

- the 0-1 matrix for vertex pairs at distance `i` apart (the adjacency matrix of the distance graphs, which are implemented)

- the actual set (list) of vertices at distance `i` from a given vertex `v`

You might give some thought to the name, I tend to think of "distance matrix" as the 0-1 matrix just above and not the matrix of distances, even though that is a perfectly rational choice.  `matrix_of_distances`?



---

archive/issue_comments_166932.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks for the feedback guys!\n\nAs far as the name goes, I would like to have distance_matrix for the distance matrix  since this is usually what it is referred to in graph theory (http://en.wikipedia.org/wiki/Distance_matrix)\n\nAs for the (0,1)-matrix of vertices at distance i, this sounds like a generalization of the adjacency_matrix and I would suggest it is implemented by introducing an additional parameter to adjacency_matrix. Like\n\n```\ndef adjacency_matrix(self, pairs_at_dist=1):\n```\n\nWhat you guys think?",
    "created_at": "2013-02-04T22:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166932",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks for the feedback guys!

As far as the name goes, I would like to have distance_matrix for the distance matrix  since this is usually what it is referred to in graph theory (http://en.wikipedia.org/wiki/Distance_matrix)

As for the (0,1)-matrix of vertices at distance i, this sounds like a generalization of the adjacency_matrix and I would suggest it is implemented by introducing an additional parameter to adjacency_matrix. Like

```
def adjacency_matrix(self, pairs_at_dist=1):
```

What you guys think?



---

archive/issue_comments_166933.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHello !\n\nWell, I think that it is a matrix only if all vertices are numbered from 0 to n-1, which is not the case in Sage. The reason why distance_all_pairs returns a dict of dict is precisely because vertices are not necessarily integers.\n\nIf you prefer to have a matrix instead, and because I am always scared of the number of functions we have in graph, I would prefer (whatever you want the future name to be.. By the way distance_matrix is nice indeed) that distance_all_pairs disappear, and become an optional result of distance_matrix.\n\nLike `distance_matrix(as_dictionary = True)` ? What do you think of it ?\nThe point is that `distance_all_pairs` really is `distance_matrix`. Vertices just aren't integers.\n\nI had a lot of wine, and a lot of good duck, and a lot of good cheese. I may make more sense tomorrow. Anyway, have fun ! `:-)`\n\nNathann",
    "created_at": "2013-02-04T22:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166933",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

Hello !

Well, I think that it is a matrix only if all vertices are numbered from 0 to n-1, which is not the case in Sage. The reason why distance_all_pairs returns a dict of dict is precisely because vertices are not necessarily integers.

If you prefer to have a matrix instead, and because I am always scared of the number of functions we have in graph, I would prefer (whatever you want the future name to be.. By the way distance_matrix is nice indeed) that distance_all_pairs disappear, and become an optional result of distance_matrix.

Like `distance_matrix(as_dictionary = True)` ? What do you think of it ?
The point is that `distance_all_pairs` really is `distance_matrix`. Vertices just aren't integers.

I had a lot of wine, and a lot of good duck, and a lot of good cheese. I may make more sense tomorrow. Anyway, have fun ! `:-)`

Nathann



---

archive/issue_comments_166934.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI agree with distance_matrix returning a matrix and this function could have an argument to return a binary matrix for pairs at distances i. \n\nI disagree with adjacency_matrix returning the binary matrix, and I don't like the proposition of Nathann of a function called distance_matrix able to return a dictionary.\n\nBut Nathann is right that the distance_matrix works only for graphs with vertices labeled from 0 to n-1. A solution is to return the map vertex->int as well.",
    "created_at": "2013-02-04T22:38:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166934",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

I agree with distance_matrix returning a matrix and this function could have an argument to return a binary matrix for pairs at distances i. 

I disagree with adjacency_matrix returning the binary matrix, and I don't like the proposition of Nathann of a function called distance_matrix able to return a dictionary.

But Nathann is right that the distance_matrix works only for graphs with vertices labeled from 0 to n-1. A solution is to return the map vertex->int as well.



---

archive/issue_comments_166935.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHello!\n\nNathann I don't think its polite to mention your dinner without offering it to us as well!!! At least for the cheese :)))\n\nAs for the comments! \n\nThe distance matrix is an algebraic object and is not \"affected\" by  the ordering of the vertices. In the same manner as the adjacency_matrix does not return a vertex -> int map.\n\nIf you still think it makes to return a map then we could add (analogously to the automorphism_group function) an option \"translation=True\" in order to return such a map as well. We'd need to add this to the adjacency_matrix()  as well for the sake of consistency.\n\nAs for the pair at distances k. The adjacency matrix of a graph is defined as the (0,1) matrix such that an entry (i,j) has a 1 if and only if the vertices v_i,v_j are at distance 1. Hence to me it makes pretty much sense to add an option here to generalize this to the case when v_i,v_j are at distance k.\n\nWhy don't you agree dcoudert?\n\nThanks for the comments and have a nice day!",
    "created_at": "2013-02-06T12:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166935",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:6" align="right">comment:6</div>

Hello!

Nathann I don't think its polite to mention your dinner without offering it to us as well!!! At least for the cheese :)))

As for the comments! 

The distance matrix is an algebraic object and is not "affected" by  the ordering of the vertices. In the same manner as the adjacency_matrix does not return a vertex -> int map.

If you still think it makes to return a map then we could add (analogously to the automorphism_group function) an option "translation=True" in order to return such a map as well. We'd need to add this to the adjacency_matrix()  as well for the sake of consistency.

As for the pair at distances k. The adjacency matrix of a graph is defined as the (0,1) matrix such that an entry (i,j) has a 1 if and only if the vertices v_i,v_j are at distance 1. Hence to me it makes pretty much sense to add an option here to generalize this to the case when v_i,v_j are at distance k.

Why don't you agree dcoudert?

Thanks for the comments and have a nice day!



---

archive/issue_comments_166936.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis is a good idea to return map only if an optional argument is set to True. \n\nFor the matrix of vertices at distance k, I don't know which is the best terminology/method. This is also related to the transitive closure of the graph. I let you choose.\n\nYou could also have a method returning all such matrices at once to avoid recomputing all the distances.\n\nDavid.",
    "created_at": "2013-02-06T12:34:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166936",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

This is a good idea to return map only if an optional argument is set to True. 

For the matrix of vertices at distance k, I don't know which is the best terminology/method. This is also related to the transitive closure of the graph. I let you choose.

You could also have a method returning all such matrices at once to avoid recomputing all the distances.

David.



---

archive/issue_comments_166937.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHelloooooooooo !!!\n\n> Nathann I don't think its polite to mention your dinner without offering it to us as well!!! At least for the cheese :)))\n\nSorry about that. I'll be looking for a home in the next months, and you will be welcome there to eat cheese and drink wine to compensate `:-)`\n\n> The distance matrix is an algebraic object and is not \"affected\" by  the ordering of the vertices. In the same manner as the adjacency_matrix does not return a vertex -> int map.\n\n`O_o`\n\nWell .... How would you get the distance between two vertices of your graph given the adjacency matrix unless you know how they are associated to each other ? `^^;`\n\n> If you still think it makes to return a map then we could add (analogously to the automorphism_group function) an option \"translation=True\" in order to return such a map as well. We'd need to add this to the adjacency_matrix()  as well for the sake of consistency.\n\nYep. Less easy to use than what we have right now, but then we uselessly store `n` times each label. I almost think that what we need is a \"LabeledMatrix\" class `:-D`\n\n> As for the pair at distances k. The adjacency matrix of a graph is defined as the (0,1) matrix such that an entry (i,j) has a 1 if and only if the vertices v_i,v_j are at distance 1. Hence to me it makes pretty much sense to add an option here to generalize this to the case when v_i,v_j are at distance k.\n\nI think that he would like to have something like `pairs_at_distance[i] = [(u,v) for u in g for v in g if g.distance(u,v) == i]`. The information is contained in the distance matrix, but not in the same order : it's hard to get the list of allentries equal to `i`.\n\nMy opinion on that is that it is \"personal code\". Stuff that you need yourself but isn't really relevant for Sage...\n\nHave fuuuuuuuuuuuuuuuuuuuuuuunn !!\n\nNathann",
    "created_at": "2013-02-06T14:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166937",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">comment:8</div>

Helloooooooooo !!!

> Nathann I don't think its polite to mention your dinner without offering it to us as well!!! At least for the cheese :)))

Sorry about that. I'll be looking for a home in the next months, and you will be welcome there to eat cheese and drink wine to compensate `:-)`

> The distance matrix is an algebraic object and is not "affected" by  the ordering of the vertices. In the same manner as the adjacency_matrix does not return a vertex -> int map.

`O_o`

Well .... How would you get the distance between two vertices of your graph given the adjacency matrix unless you know how they are associated to each other ? `^^;`

> If you still think it makes to return a map then we could add (analogously to the automorphism_group function) an option "translation=True" in order to return such a map as well. We'd need to add this to the adjacency_matrix()  as well for the sake of consistency.

Yep. Less easy to use than what we have right now, but then we uselessly store `n` times each label. I almost think that what we need is a "LabeledMatrix" class `:-D`

> As for the pair at distances k. The adjacency matrix of a graph is defined as the (0,1) matrix such that an entry (i,j) has a 1 if and only if the vertices v_i,v_j are at distance 1. Hence to me it makes pretty much sense to add an option here to generalize this to the case when v_i,v_j are at distance k.

I think that he would like to have something like `pairs_at_distance[i] = [(u,v) for u in g for v in g if g.distance(u,v) == i]`. The information is contained in the distance matrix, but not in the same order : it's hard to get the list of allentries equal to `i`.

My opinion on that is that it is "personal code". Stuff that you need yourself but isn't really relevant for Sage...

Have fuuuuuuuuuuuuuuuuuuuuuuunn !!

Nathann



---

archive/issue_comments_166938.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHm..\n\nLabeledMatrix class appears exactly as what we need - that would be nice!\n\nAs for the \"personal code\" remark, I am not sure! The notion of the distance matrix is a standard one in graph theory (http://en.wikipedia.org/wiki/Distance_matrix). If we have the adjacency matrix, Kirchhoff matrix and incidence matrix I don't see a reason why we should not have the distance matrix as well.\n\nIn addition, Mathematica has a function returning the distance matrix of a graph (http://mathworld.wolfram.com/GraphDistanceMatrix.html) hence I am not really sure it is just a personal thing of me :)",
    "created_at": "2013-02-06T15:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166938",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:9" align="right">comment:9</div>

Hm..

LabeledMatrix class appears exactly as what we need - that would be nice!

As for the "personal code" remark, I am not sure! The notion of the distance matrix is a standard one in graph theory (http://en.wikipedia.org/wiki/Distance_matrix). If we have the adjacency matrix, Kirchhoff matrix and incidence matrix I don't see a reason why we should not have the distance matrix as well.

In addition, Mathematica has a function returning the distance matrix of a graph (http://mathworld.wolfram.com/GraphDistanceMatrix.html) hence I am not really sure it is just a personal thing of me :)



---

archive/issue_comments_166939.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> LabeledMatrix class appears exactly as what we need - that would be nice!\n\nYou mean that it exists in Sage already ? That would be Cooooooooool !! `O_o`\n\n> As for the \"personal code\" remark, I am not sure! \n\n???\n\nNonono, my \"personal code\" thing was about David's `pairs_at_distance_i` list of lists of pairs. I mean, we need this for some code we work on, but to me that's just our very specific use case, not something that Sage should natively handle.\n\nNathann",
    "created_at": "2013-02-06T15:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166939",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

> LabeledMatrix class appears exactly as what we need - that would be nice!

You mean that it exists in Sage already ? That would be Cooooooooool !! `O_o`

> As for the "personal code" remark, I am not sure! 

???

Nonono, my "personal code" thing was about David's `pairs_at_distance_i` list of lists of pairs. I mean, we need this for some code we work on, but to me that's just our very specific use case, not something that Sage should natively handle.

Nathann



---

archive/issue_events_195730.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-14T07:30:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195730"
}
```



---

archive/issue_comments_166940.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHello!\n\nAttached you will find the patch for the distance matrix and some additional documentation for the incidence matrix. \n\nLet me know if there is anything to fix.\n\nJernej",
    "created_at": "2013-05-14T07:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166940",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:11" align="right">comment:11</div>

Hello!

Attached you will find the patch for the distance matrix and some additional documentation for the incidence matrix. 

Let me know if there is anything to fix.

Jernej



---

archive/issue_comments_166941.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAttachment: **[trac_14056_distancem.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)**\n\nWell, my comment from 3 months ago about `distance_all_pairs` for a start.\n\nNathann",
    "created_at": "2013-05-14T08:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166941",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

Attachment: **[trac_14056_distancem.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)**

Well, my comment from 3 months ago about `distance_all_pairs` for a start.

Nathann



---

archive/issue_events_195731.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T08:06:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195731"
}
```



---

archive/issue_events_195732.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T08:06:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195732"
}
```



---

archive/issue_comments_166942.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI also don't get why the method should only work on strongly connected graphs.\n\nNathann",
    "created_at": "2013-05-14T08:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166942",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

I also don't get why the method should only work on strongly connected graphs.

Nathann



---

archive/issue_comments_166943.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHello!\n\nAs far as I see the distances in a weakly connected digraph are not defined for all pair of vertices!",
    "created_at": "2013-05-14T08:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166943",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:14" align="right">comment:14</div>

Hello!

As far as I see the distances in a weakly connected digraph are not defined for all pair of vertices!



---

archive/issue_comments_166944.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWhat's wrong with setting those entries to infinity ? And what about merging distances all pairs and the distance matrix into the same function ?\n\nNathann",
    "created_at": "2013-05-14T08:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166944",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

What's wrong with setting those entries to infinity ? And what about merging distances all pairs and the distance matrix into the same function ?

Nathann



---

archive/issue_comments_166945.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@nathanncohen](#comment%3A12):\n> Well, my comment from 3 months ago about `distance_all_pairs` for a start.\n> \n> Nathann\n\nWhat exactly? I am a bit confused since at that time you had some debate about your research code or something and when I asked about that you said it's related to some code of David?",
    "created_at": "2013-05-14T08:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166945",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@nathanncohen](#comment%3A12):
> Well, my comment from 3 months ago about `distance_all_pairs` for a start.
> 
> Nathann

What exactly? I am a bit confused since at that time you had some debate about your research code or something and when I asked about that you said it's related to some code of David?



---

archive/issue_comments_166946.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n(just merging the distance_all_pairs and distance_matrix. Distance matrix would return the distance matrix by default, and if you ask for labels you would get either a Labeled matrix if such a thing exists somewhere, or the current double dictionary ?)\n\nNathann",
    "created_at": "2013-05-14T08:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166946",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

(just merging the distance_all_pairs and distance_matrix. Distance matrix would return the distance matrix by default, and if you ask for labels you would get either a Labeled matrix if such a thing exists somewhere, or the current double dictionary ?)

Nathann



---

archive/issue_comments_166947.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWe can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. At least for consistency with adjacency,incidence and Kirchhoff matrix.\n\nAs for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...",
    "created_at": "2013-05-14T08:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166947",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:18" align="right">comment:18</div>

We can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. At least for consistency with adjacency,incidence and Kirchhoff matrix.

As for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...



---

archive/issue_comments_166948.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n> We can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. \n\nWhat do you mean ? `O_o` ``distance_all_pairs`` has no argument `O_o`\n\n> At least for consistency with adjacency,incidence and Kirchhoff matrix.\n\nI don't understand what you mean here either.\n\n> As for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...\n\nOokok.. I don't like it, but it makes sense.\n\nNathann",
    "created_at": "2013-05-14T08:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166948",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:19" align="right">comment:19</div>

> We can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. 

What do you mean ? `O_o` ``distance_all_pairs`` has no argument `O_o`

> At least for consistency with adjacency,incidence and Kirchhoff matrix.

I don't understand what you mean here either.

> As for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...

Ookok.. I don't like it, but it makes sense.

Nathann



---

archive/issue_comments_166949.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@nathanncohen](#comment%3A19):\n> > We can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. \n\n> \n> What do you mean ? `O_o` ``distance_all_pairs`` has no argument `O_o`\n> \n> > At least for consistency with adjacency,incidence and Kirchhoff matrix.\n\n> \n> I don't understand what you mean here either.\n\nWhat I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!\n\nThat being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm. Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.\n\nWhat do you think\n\n> \n> > As for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...\n\n> \n> Ookok.. I don't like it, but it makes sense.\n> \n> Nathann",
    "created_at": "2013-05-14T08:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166949",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@nathanncohen](#comment%3A19):
> > We can do that as well, though I would then still like to have a method distance_matrix() calling distance_all_pairs with the appropriate argument. 

> 
> What do you mean ? `O_o` ``distance_all_pairs`` has no argument `O_o`
> 
> > At least for consistency with adjacency,incidence and Kirchhoff matrix.

> 
> I don't understand what you mean here either.

What I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!

That being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm. Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.

What do you think

> 
> > As for infinity.. Well I like to think of these matrices as well defined algebraic objects and I am not even sure if a matrix can digest Infinity as its entry...

> 
> Ookok.. I don't like it, but it makes sense.
> 
> Nathann



---

archive/issue_comments_166950.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n> What I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. \n\nWhaaaattttttt ??`O_o`\n\n\"call distance_all_pairs asking for the distance matrix\" ? What does that mean ?\n\nWhat I described above was a function names \"distance_matrix\" which returns the distance matrix when no optional flags are given, and which returns the current result of \"distance_all_pairs\" when an optional flag, say `labels = True`, is added to it.\n\nAnd `distance_all_pairs` would be removed from generic_graph.\n\nWhat about this ?\n\n> And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!\n\nIs that still contradicting what I said above ? I don't understand it either.\n\n> That being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm.\n\nWhy would we mix \"distance matrix\" with a shortest path algorithm ? The `distance_all_pairs` method is written in Cython and actually creates a C array filled with the content of the distance matrix.\n\n> Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.\n> \n> What do you think\n\nLet's make our previous messages clear for a start `:-P`\n\nSorry, I have been exchanging a couple of angry messages this morning so I am probably a bit unpleasant to deal with this morning `>_<`\n\nNathann",
    "created_at": "2013-05-14T08:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166950",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

> What I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. 

Whaaaattttttt ??`O_o`

"call distance_all_pairs asking for the distance matrix" ? What does that mean ?

What I described above was a function names "distance_matrix" which returns the distance matrix when no optional flags are given, and which returns the current result of "distance_all_pairs" when an optional flag, say `labels = True`, is added to it.

And `distance_all_pairs` would be removed from generic_graph.

What about this ?

> And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!

Is that still contradicting what I said above ? I don't understand it either.

> That being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm.

Why would we mix "distance matrix" with a shortest path algorithm ? The `distance_all_pairs` method is written in Cython and actually creates a C array filled with the content of the distance matrix.

> Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.
> 
> What do you think

Let's make our previous messages clear for a start `:-P`

Sorry, I have been exchanging a couple of angry messages this morning so I am probably a bit unpleasant to deal with this morning `>_<`

Nathann



---

archive/issue_comments_166951.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@nathanncohen](#comment%3A21):\n> \n> > What I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. \n\n> \n> Whaaaattttttt ??`O_o`\n> \n> \"call distance_all_pairs asking for the distance matrix\" ? What does that mean ?\n> \n> What I described above was a function names \"distance_matrix\" which returns the distance matrix when no optional flags are given, and which returns the current result of \"distance_all_pairs\" when an optional flag, say `labels = True`, is added to it.\n> \n> And `distance_all_pairs` would be removed from generic_graph.\n\nOookay now I think I *do* understand you. Somehow I still like it more the way it is structured now (an algorithmically inclined guy would look for the distance_all_pairs method) a math guy for the distance matrix and since we already have the distance_all_pairs method I don't see any good reasons for removing it. \n\nThat said, why would you like this specific change?\n\n> \n> What about this ?\n> \n> > And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!\n\n> \n> Is that still contradicting what I said above ? I don't understand it either.\n> \n> > That being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm.\n\n> \n> Why would we mix \"distance matrix\" with a shortest path algorithm ? The `distance_all_pairs` method is written in Cython and actually creates a C array filled with the content of the distance matrix.\n> \n> > Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.\n> > \n> > What do you think\n\n> \n> Let's make our previous messages clear for a start `:-P`\n> \n> Sorry, I have been exchanging a couple of angry messages this morning so I am probably a bit unpleasant to deal with this morning `>_<`\n\nHahaha. No worries, I am also quite tense (GSOC is building unnecessary pressure :S). I can hardly imagining you writing unpleasant emails btw :-)\n\n> \n> Nathann",
    "created_at": "2013-05-14T09:28:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166951",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@nathanncohen](#comment%3A21):
> 
> > What I meant was that If we choose to put this thing under distance_all_pairs and add an argument returning the distance matrix, then I would still like to have a method called distance_matrix() that would call distance_all_pairs asking for the distance matrix. 

> 
> Whaaaattttttt ??`O_o`
> 
> "call distance_all_pairs asking for the distance matrix" ? What does that mean ?
> 
> What I described above was a function names "distance_matrix" which returns the distance matrix when no optional flags are given, and which returns the current result of "distance_all_pairs" when an optional flag, say `labels = True`, is added to it.
> 
> And `distance_all_pairs` would be removed from generic_graph.

Oookay now I think I *do* understand you. Somehow I still like it more the way it is structured now (an algorithmically inclined guy would look for the distance_all_pairs method) a math guy for the distance matrix and since we already have the distance_all_pairs method I don't see any good reasons for removing it. 

That said, why would you like this specific change?

> 
> What about this ?
> 
> > And I would want to have that since I would like to have a method called distance_matrix() as we do for the other mentioned matrices!

> 
> Is that still contradicting what I said above ? I don't understand it either.
> 
> > That being said I am now starting to doubt it is a good idea to mix this distance matrix with the shortest path algorithm.

> 
> Why would we mix "distance matrix" with a shortest path algorithm ? The `distance_all_pairs` method is written in Cython and actually creates a C array filled with the content of the distance matrix.
> 
> > Especially if  we don't have the indexed matrix thing and since (apperently) infinity is not digested by matrices.
> > 
> > What do you think

> 
> Let's make our previous messages clear for a start `:-P`
> 
> Sorry, I have been exchanging a couple of angry messages this morning so I am probably a bit unpleasant to deal with this morning `>_<`

Hahaha. No worries, I am also quite tense (GSOC is building unnecessary pressure :S). I can hardly imagining you writing unpleasant emails btw :-)

> 
> Nathann



---

archive/issue_comments_166952.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> Oookay now I think I *do* understand you. Somehow I still like it more the way it is structured now (an algorithmically inclined guy would look for the distance_all_pairs method) a math guy for the distance matrix and since we already have the distance_all_pairs method I don't see any good reasons for removing it. \n> \n> That said, why would you like this specific change?\n\nHmmmmmm... Because we already have far too much functions in the Graph classes to have aliases.\nBut you convinced me anyway. Let's forget it !\n\n> Hahaha. No worries, I am also quite tense (GSOC is building unnecessary pressure :S).\n\nAhahaha. Well, there's nothing to do before the 27th of May, is there ? `;-)`\n\n> I can hardly imagining you writing unpleasant emails btw :-)\n\nAhahahahahah `:-D`\n\nHalf of the world can't, indeed. The other half can't picture me as doing anything else but waste their time. Usually, those are my colleagues `:-P`\n\nHave fuuuuuuuuuuuuuuuuuuuuunnn !!\n\nNathann",
    "created_at": "2013-05-14T09:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166952",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:23" align="right">comment:23</div>

> Oookay now I think I *do* understand you. Somehow I still like it more the way it is structured now (an algorithmically inclined guy would look for the distance_all_pairs method) a math guy for the distance matrix and since we already have the distance_all_pairs method I don't see any good reasons for removing it. 
> 
> That said, why would you like this specific change?

Hmmmmmm... Because we already have far too much functions in the Graph classes to have aliases.
But you convinced me anyway. Let's forget it !

> Hahaha. No worries, I am also quite tense (GSOC is building unnecessary pressure :S).

Ahahaha. Well, there's nothing to do before the 27th of May, is there ? `;-)`

> I can hardly imagining you writing unpleasant emails btw :-)

Ahahahahahah `:-D`

Half of the world can't, indeed. The other half can't picture me as doing anything else but waste their time. Usually, those are my colleagues `:-P`

Have fuuuuuuuuuuuuuuuuuuuuunnn !!

Nathann



---

archive/issue_events_195733.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T10:06:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195733"
}
```



---

archive/issue_events_195734.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T10:06:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195734"
}
```



---

archive/issue_comments_166953.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOk, nowwwwwwwww the review !\n\n* Would be nice to add in the documentation that this method ignores edge labels\n* You can probably save some time by replacing \n\n```\nfor i in xrange(n): \n    for j in xrange(i+1,n): \n        d = (dist[V[i]])[V[j]] \n```\n    with\n\n```\nfor i,Vi in enumerate(V.values()): \n    for j,dj in enumerate(Vi.values()):\n        d = dj \n```\n\n    I think that you cannot trust the dictionary for returning its elements in the same ordering on all architectures, but you probably can trust it for always returning its elements in the same ordering on the same machines. Especially when you have several dictionaries containing the very same keys. Would be good to check, though. I'll ask on Sage-devel.\n* You do not have to import infinity, nor to test equality. If `d>n` should be enough.\n* Could you add a warning in the docstring saying that we do not expect the ordering in the vertices of the matrix to correspond to anything meaningful ? Unless we do expect it to correspond to something meaningul that I can't guess right now ?\n* Could you also add a \"SEEALSO\" field in this method and in `distances_all_pairs` so that one points toward the other ?\n\nThinking about it again, if you replace the loop by what I just said, then you cannot save some time by doing `ret[i,j] = ret[j,i] = d` anymore. Hmmmm... `O_o`\n\nNathann",
    "created_at": "2013-05-14T10:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166953",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">comment:24</div>

Ok, nowwwwwwwww the review !

* Would be nice to add in the documentation that this method ignores edge labels
* You can probably save some time by replacing 

```
for i in xrange(n): 
    for j in xrange(i+1,n): 
        d = (dist[V[i]])[V[j]] 
```
    with

```
for i,Vi in enumerate(V.values()): 
    for j,dj in enumerate(Vi.values()):
        d = dj 
```

    I think that you cannot trust the dictionary for returning its elements in the same ordering on all architectures, but you probably can trust it for always returning its elements in the same ordering on the same machines. Especially when you have several dictionaries containing the very same keys. Would be good to check, though. I'll ask on Sage-devel.
* You do not have to import infinity, nor to test equality. If `d>n` should be enough.
* Could you add a warning in the docstring saying that we do not expect the ordering in the vertices of the matrix to correspond to anything meaningful ? Unless we do expect it to correspond to something meaningul that I can't guess right now ?
* Could you also add a "SEEALSO" field in this method and in `distances_all_pairs` so that one points toward the other ?

Thinking about it again, if you replace the loop by what I just said, then you cannot save some time by doing `ret[i,j] = ret[j,i] = d` anymore. Hmmmm... `O_o`

Nathann



---

archive/issue_events_195735.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T10:06:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195735"
}
```



---

archive/issue_events_195736.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-14T10:06:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195736"
}
```



---

archive/issue_comments_166954.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHellooooooo again !\n\nOk, then this change in the loops is a wrong idea. If you want your \"distance_matrix\" to run fast on large instances though [1] you could implement the code of this distance_matrix function directly in the distances_all_pairs.pyx file. This way you would not have to go through a dictionary, and more importantly Sage would not create a dictionary from a matrix only to create a matrix from the dictionary afterwards. \n\nBefore the dictionary is created, all the data is contained in a C array that is much easier to transform into a matrix than this dictionary.\n\nNot to mention that it takes MUuuuuuuuuuuuchh less space in memory.\n\nHave fuuuuuuuuuuuuuuuuuuuuuuuunnn !!\n\nNathann\n\n[1] Really, if you want. Otherwise this patch is fine without it",
    "created_at": "2013-05-14T10:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166954",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">comment:26</div>

Hellooooooo again !

Ok, then this change in the loops is a wrong idea. If you want your "distance_matrix" to run fast on large instances though [1] you could implement the code of this distance_matrix function directly in the distances_all_pairs.pyx file. This way you would not have to go through a dictionary, and more importantly Sage would not create a dictionary from a matrix only to create a matrix from the dictionary afterwards. 

Before the dictionary is created, all the data is contained in a C array that is much easier to transform into a matrix than this dictionary.

Not to mention that it takes MUuuuuuuuuuuuchh less space in memory.

Have fuuuuuuuuuuuuuuuuuuuuuuuunnn !!

Nathann

[1] Really, if you want. Otherwise this patch is fine without it



---

archive/issue_comments_166955.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nHelloo!!\n\nFor now I'd prefer to leave this as is because I think there are some other places (backend,khm,khm?) in which a speedup fix is required more than here!",
    "created_at": "2013-05-14T10:55:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166955",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:27" align="right">comment:27</div>

Helloo!!

For now I'd prefer to leave this as is because I think there are some other places (backend,khm,khm?) in which a speedup fix is required more than here!



---

archive/issue_comments_166956.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n> For now I'd prefer to leave this as is because I think there are some other places (backend,khm,khm?) in which a speedup fix is required more than here!\n\nNo prob !\n\nNathann",
    "created_at": "2013-05-14T10:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166956",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:28" align="right">comment:28</div>

> For now I'd prefer to leave this as is because I think there are some other places (backend,khm,khm?) in which a speedup fix is required more than here!

No prob !

Nathann



---

archive/issue_comments_166957.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nShould we flag this as done then sir??",
    "created_at": "2013-05-14T11:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166957",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:29" align="right">comment:29</div>

Should we flag this as done then sir??



---

archive/issue_comments_166958.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n> Should we flag this as done then sir??\n\nWell, unless you tell me why you think that all comments about doc and infinity are irrelevant ?...\n\nNathann",
    "created_at": "2013-05-14T11:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166958",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:30" align="right">comment:30</div>

> Should we flag this as done then sir??

Well, unless you tell me why you think that all comments about doc and infinity are irrelevant ?...

Nathann



---

archive/issue_comments_166959.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThey were irrelevant because I completely forgot about them sorry. Will fix that I agree with them!",
    "created_at": "2013-05-14T11:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166959",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:31" align="right">comment:31</div>

They were irrelevant because I completely forgot about them sorry. Will fix that I agree with them!



---

archive/issue_comments_166960.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nBtw, should seealso be added like\n\n```\n.. SEEALSO::\n\n - :meth:`sage.graphs.generic_graph.distance_all_pairs`\n```",
    "created_at": "2013-05-14T11:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166960",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:32" align="right">comment:32</div>

Btw, should seealso be added like

```
.. SEEALSO::

 - :meth:`sage.graphs.generic_graph.distance_all_pairs`
```



---

archive/issue_comments_166961.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n> Btw, should seealso be added like\n> \n> ```\n> .. SEEALSO::\n> \n>  - :meth:`sage.graphs.generic_graph.distance_all_pairs`\n> ```\n\nI think that it's ok like that, but you should probably check by building the doc (`sage -docbuild reference/graph html` only builds the graph doc) because it's tricky sometimes. Note that if you write add an `~` in the link then it will only appear as `distance_all_pairs` and not as `sage.graphs.generic_graph.distance_all_pairs`\n\n```\n:meth:`~sage.graphs.generic_graph.distance_all_pairs`\n```\n\nIt's up to you !\n\nNathann",
    "created_at": "2013-05-14T11:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166961",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:33" align="right">comment:33</div>

> Btw, should seealso be added like
> 
> ```
> .. SEEALSO::
> 
>  - :meth:`sage.graphs.generic_graph.distance_all_pairs`
> ```

I think that it's ok like that, but you should probably check by building the doc (`sage -docbuild reference/graph html` only builds the graph doc) because it's tricky sometimes. Note that if you write add an `~` in the link then it will only appear as `distance_all_pairs` and not as `sage.graphs.generic_graph.distance_all_pairs`

```
:meth:`~sage.graphs.generic_graph.distance_all_pairs`
```

It's up to you !

Nathann



---

archive/issue_comments_166962.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAttachment: **[trac_14056_distancem.2.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)**\n\nTook me a while to make this last changes since I wanted to make sure the docs are rendered properly. I think that the patch fixes everything you suggested.",
    "created_at": "2013-05-15T10:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166962",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:34" align="right">comment:34</div>

Attachment: **[trac_14056_distancem.2.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)**

Took me a while to make this last changes since I wanted to make sure the docs are rendered properly. I think that the patch fixes everything you suggested.



---

archive/issue_comments_166963.json:
```json
{
    "body": "Reviewer: **Nathann Cohen**",
    "created_at": "2013-05-15T12:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166963",
    "user": "https://github.com/nathanncohen"
}
```

Reviewer: **Nathann Cohen**



---

archive/issue_comments_166964.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHelloooooooooo !!\n\nThere were some trailing whitespaces in your patch, and Sage's dogma says that this is wrong. I also added a warning saying that the ordering of vertices in the matrix may not be the ordering of vertices in ``g.vertices()``.\n\nIf you agree with this patch, then you can set the ticket to `positive_review` !\n\nNathann",
    "created_at": "2013-05-15T12:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166964",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:35" align="right">comment:35</div>

Helloooooooooo !!

There were some trailing whitespaces in your patch, and Sage's dogma says that this is wrong. I also added a warning saying that the ordering of vertices in the matrix may not be the ordering of vertices in ``g.vertices()``.

If you agree with this patch, then you can set the ticket to `positive_review` !

Nathann



---

archive/issue_comments_166965.json:
```json
{
    "body": "Author: **Jernej Azarija**",
    "created_at": "2013-05-15T12:47:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166965",
    "user": "https://github.com/nathanncohen"
}
```

Author: **Jernej Azarija**



---

archive/issue_events_195737.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-15T12:47:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195737"
}
```



---

archive/issue_events_195738.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-15T12:47:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195738"
}
```



---

archive/issue_comments_166966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,8 @@\n \n So before adding a patch implementing that I am wondering if you other guys agree with that and if perhaps I have overlooked that functionality.\n \n+Apply:\n \n-\n+* [attachment: trac_14056_distancem.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)\n+* [attachment: trac_14056_distancem.2.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)\n+* [attachment: trac_14056-rev.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)\n``````\n",
    "created_at": "2013-05-15T12:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166966",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,8 @@
 
 So before adding a patch implementing that I am wondering if you other guys agree with that and if perhaps I have overlooked that functionality.
 
+Apply:
 
-
+* [attachment: trac_14056_distancem.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.patch.gz)
+* [attachment: trac_14056_distancem.2.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056_distancem.2.patch.gz)
+* [attachment: trac_14056-rev.patch](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)
``````




---

archive/issue_comments_166967.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAttachment: **[trac_14056-rev.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)**",
    "created_at": "2013-05-15T12:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166967",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:36" align="right">comment:36</div>

Attachment: **[trac_14056-rev.patch.gz](https://github.com/sagemath/sage/files/ticket14056/trac_14056-rev.patch.gz)**



---

archive/issue_events_195739.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-17T09:52:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195739"
}
```



---

archive/issue_events_195740.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-17T09:52:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195740"
}
```



---

archive/issue_comments_166968.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nHello!\n\nI agree with your modifications. Thank you for the review.\n\nJernej",
    "created_at": "2013-05-17T09:53:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166968",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:38" align="right">comment:38</div>

Hello!

I agree with your modifications. Thank you for the review.

Jernej



---

archive/issue_events_195741.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T08:18:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195741"
}
```



---

archive/issue_events_195742.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T08:18:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14056#event-195742"
}
```



---

archive/issue_comments_166969.json:
```json
{
    "body": "Merged: **sage-5.10.beta5**",
    "created_at": "2013-05-22T08:18:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14056#issuecomment-166969",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.10.beta5**
