# Issue 14346: Document/report/fix PARI patches

archive/issues_014142.json:
```json
{
    "body": "This spkg has many patches, with the following:\n\nGood:\n* get_ld.patch: author known, pure packaging\n* get_tests.patch: author known, pure packaging\n* install_doc_no_make.patch: author known, pure packaging\n* perl_path.patch: author known, pure packaging\n* cygwin_dll_a.patch: author known, pure packaging\n* GCC_PR49330.patch: author mentioned, discussed with upstream, upstream decided not to fix this\n* get_dlcflags.patch: author known, partially accepted by upstream\n* KERNELCFLAGS.patch: author known, forwarded upstream\n* trac_13902_determinant.patch: author mentioned, upstream backport\n* polred.patch: author mentioned, upstream backport\n\nBad:\n* get_config_options.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't\n* get_fltk.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't\n* get_X11.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't\n* mp.c.patch: author unknown, should be replaced by a Sage library patch.\n\nAssignee: tbd\n\nCC:  @jdemeyer\n\nReviewer: Jeroen Demeyer\n\nDependencies: #14539\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14346\n\n",
    "closed_at": "2015-03-17T18:19:55Z",
    "created_at": "2013-03-23T09:19:17Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Document/report/fix PARI patches",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14346",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
This spkg has many patches, with the following:

Good:
* get_ld.patch: author known, pure packaging
* get_tests.patch: author known, pure packaging
* install_doc_no_make.patch: author known, pure packaging
* perl_path.patch: author known, pure packaging
* cygwin_dll_a.patch: author known, pure packaging
* GCC_PR49330.patch: author mentioned, discussed with upstream, upstream decided not to fix this
* get_dlcflags.patch: author known, partially accepted by upstream
* KERNELCFLAGS.patch: author known, forwarded upstream
* trac_13902_determinant.patch: author mentioned, upstream backport
* polred.patch: author mentioned, upstream backport

Bad:
* get_config_options.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't
* get_fltk.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't
* get_X11.patch: author known, upstream-worthy, no comment says it was forwarded, which probably means it wasn't
* mp.c.patch: author unknown, should be replaced by a Sage library patch.

Assignee: tbd

CC:  @jdemeyer

Reviewer: Jeroen Demeyer

Dependencies: #14539

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14346





---

archive/issue_comments_177201.json:
```json
{
    "body": "<a id='comment:1'></a>Does this apply to the PARI library, or `gp`?\n\n(Of course `gp` uses the PARI library, but *I think<sup>TM</sup>* the stand-alone `gp` wouldn't need patching for Sage.)",
    "created_at": "2013-03-23T10:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177201",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>Does this apply to the PARI library, or `gp`?

(Of course `gp` uses the PARI library, but *I think<sup>TM</sup>* the stand-alone `gp` wouldn't need patching for Sage.)



---

archive/issue_comments_177202.json:
```json
{
    "body": "<a id='comment:2'></a>Both the library and the executable come out of the same spkg anyway so I don't see how the distinction matters...",
    "created_at": "2013-03-23T16:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177202",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:2'></a>Both the library and the executable come out of the same spkg anyway so I don't see how the distinction matters...



---

archive/issue_comments_177203.json:
```json
{
    "body": "<a id='comment:3'></a>Have to second that discusion on debian. I have actually pushed almost every single sage patch to pari in sage-on-gentoo. I think it is ok when they are patches included upstream. I hadn't looked at the particulars of polred. Which yes alter the ABI somewhat. Was the change necessary and will it be picked up upstream?",
    "created_at": "2013-03-23T22:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177203",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>Have to second that discusion on debian. I have actually pushed almost every single sage patch to pari in sage-on-gentoo. I think it is ok when they are patches included upstream. I hadn't looked at the particulars of polred. Which yes alter the ABI somewhat. Was the change necessary and will it be picked up upstream?



---

archive/issue_comments_177204.json:
```json
{
    "body": "<a id='comment:4'></a>If you read B.A.'s comment on my debian bug report, I think it's 100% sure they won't take it in the stable branch, as it breaks ABI. Now for another branch, the question is open -- but since this polred.patch is based on upstream commits, they might have better up their sleeve already!",
    "created_at": "2013-03-24T08:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177204",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:4'></a>If you read B.A.'s comment on my debian bug report, I think it's 100% sure they won't take it in the stable branch, as it breaks ABI. Now for another branch, the question is open -- but since this polred.patch is based on upstream commits, they might have better up their sleeve already!



---

archive/issue_comments_177205.json:
```json
{
    "body": "<a id='comment:5'></a>IIRC PARI 2.6 release sould happen quite soon, so hopefully the commits we used are from this devel branch, see http://pari.math.u-bordeaux1.fr/timeline.html",
    "created_at": "2013-03-26T14:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177205",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>IIRC PARI 2.6 release sould happen quite soon, so hopefully the commits we used are from this devel branch, see http://pari.math.u-bordeaux1.fr/timeline.html



---

archive/issue_comments_177206.json:
```json
{
    "body": "<a id='comment:6'></a>The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.\n\nSo yes, we can hope that when sage will package pari 2.6.0, then it will stop forking pari and become compatible with something debian can package seriously.",
    "created_at": "2013-03-26T17:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177206",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:6'></a>The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.

So yes, we can hope that when sage will package pari 2.6.0, then it will stop forking pari and become compatible with something debian can package seriously.



---

archive/issue_comments_177207.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 Snark]:\n> The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.\n\nI thought backporting patches from later upstream versions is standard practice.",
    "created_at": "2013-04-10T10:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177207",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:6 Snark]:
> The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.

I thought backporting patches from later upstream versions is standard practice.



---

archive/issue_comments_177208.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2013-04-10T11:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177208",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from defect to enhancement.



---

archive/issue_events_040667.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-10T11:02:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14346#event-40667"
}
```



---

archive/issue_comments_177209.json:
```json
{
    "body": "Replying to [ticket:14346 Snark]:\n> The pari package is full of patches\n\nSo what? Since when is patching a package a bug?\n\n> some of which should have been proposed upstream\n\nWhich patches are you refering to?\n\n> the correct solution would be for sage to *add* what is needed to the sage library instead of patching upstream.\n\nPlease elaborate how we should add PARI patches to the Sage library.",
    "created_at": "2013-04-10T11:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177209",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:14346 Snark]:
> The pari package is full of patches

So what? Since when is patching a package a bug?

> some of which should have been proposed upstream

Which patches are you refering to?

> the correct solution would be for sage to *add* what is needed to the sage library instead of patching upstream.

Please elaborate how we should add PARI patches to the Sage library.



---

archive/issue_comments_177210.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:6 Snark]:\n> > The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.\n\n> I thought backporting patches from later upstream versions is standard practice.\n\nI'll have a shot at that one but it's probably nothing new to you. It depends on the trade off. Backporting in a distro like debian that is keeping fixed version of the software has much as possible is good.... so long as you preserve API. If the patch breaks API that means potentially all dependencies will need patching for the new API. So the trade off is between the number of dependencies you have to patch for the new API and how badly you want/need the backport. \n\nIt applies also to sage but the scale is a priori less than in a full distro. In the case of pari in particular, I don't think the list of dependencies (especially dependencies not in sage) affected by your change is very long (make that non existant until proven otherwise).\n\nDebian may have enshrined the above discussion in a precise policy but I am not a deban-er.",
    "created_at": "2013-04-10T11:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177210",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 Snark]:
> > The commits used were from upstream, but the patch is **based** on those commits -- it's not just them. That means that the pari in sage is neither compatible with upstream's 2.5.3, nor with the upcoming 2.6.0.

> I thought backporting patches from later upstream versions is standard practice.

I'll have a shot at that one but it's probably nothing new to you. It depends on the trade off. Backporting in a distro like debian that is keeping fixed version of the software has much as possible is good.... so long as you preserve API. If the patch breaks API that means potentially all dependencies will need patching for the new API. So the trade off is between the number of dependencies you have to patch for the new API and how badly you want/need the backport. 

It applies also to sage but the scale is a priori less than in a full distro. In the case of pari in particular, I don't think the list of dependencies (especially dependencies not in sage) affected by your change is very long (make that non existant until proven otherwise).

Debian may have enshrined the above discussion in a precise policy but I am not a deban-er.



---

archive/issue_comments_177211.json:
```json
{
    "body": "<a id='comment:11'></a>Backporting is standard practice, to gain a bugfix or a new feature which is only available in a later version.\n\nThe current situation is different : some modifications are backports, and some are new code.\n\nThe backported patches have their places in the pari spkg, but the new code should be in the sage library.",
    "created_at": "2013-04-10T11:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177211",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:11'></a>Backporting is standard practice, to gain a bugfix or a new feature which is only available in a later version.

The current situation is different : some modifications are backports, and some are new code.

The backported patches have their places in the pari spkg, but the new code should be in the sage library.



---

archive/issue_comments_177212.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 fbissey]:\n> If the patch breaks API\n\nIn which sense does the polred patch \"break API\" (I probably don't understand what you mean exactly with \"breaks API\")",
    "created_at": "2013-04-10T11:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177212",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:10 fbissey]:
> If the patch breaks API

In which sense does the polred patch "break API" (I probably don't understand what you mean exactly with "breaks API")



---

archive/issue_comments_177213.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 Snark]:\n> the new code should be in the sage library.\n\nWhich code are you refering too?\n\nDetails please, this is all so vague...",
    "created_at": "2013-04-10T11:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:11 Snark]:
> the new code should be in the sage library.

Which code are you refering too?

Details please, this is all so vague...



---

archive/issue_comments_177214.json:
```json
{
    "body": "<a id='comment:14'></a>Ok, let's be explicit:\n1. in general there are fifteen patches in this spkg, which is way too much ;\n2. in particular polred.patch is a mix between a backport and a new development.\n\nI claim putting new developments in a package is against standard packaging practice.\n\nAnd I use the verb \"break\" because that's what will happen when sage will want to include the next pari version...",
    "created_at": "2013-04-10T14:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177214",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:14'></a>Ok, let's be explicit:
1. in general there are fifteen patches in this spkg, which is way too much ;
2. in particular polred.patch is a mix between a backport and a new development.

I claim putting new developments in a package is against standard packaging practice.

And I use the verb "break" because that's what will happen when sage will want to include the next pari version...



---

archive/issue_comments_177215.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 Snark]:\n> Ok, let's be explicit:\n\nThat's not explicit at all, that's essentially just repeating what you already said. To make it easier for you, I changed the description and let you fill in the blanks.",
    "created_at": "2013-04-10T15:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177215",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:14 Snark]:
> Ok, let's be explicit:

That's not explicit at all, that's essentially just repeating what you already said. To make it easier for you, I changed the description and let you fill in the blanks.



---

archive/issue_comments_177216.json:
```json
{
    "body": "<a id='comment:17'></a>So I did a bit more digging because it is a case of show me the code, I will say that after looking at it carefully I have reached a pragmatic view on this and I don't actually mind the change in question. If Julien is worried about some other code he can put it on display. So in the polred patch\n\n```\ndiff -ruN src/src/headers/paridecl.h b/src/headers/paridecl.h\n--- src/src/headers/paridecl.h\t2012-09-25 23:10:47.000000000 +0200\n+++ b/src/headers/paridecl.h\t2013-01-31 14:49:05.557525771 +0100\n@@ -889,6 +889,7 @@\n GEN     polredabs0(GEN x, long flag);\n GEN     polredabs2(GEN x);\n GEN     polredabsall(GEN x, long flun);\n+GEN     polredbest(GEN x, long flag);\n GEN     smallpolred(GEN x);\n GEN     smallpolred2(GEN x);\n GEN     tschirnhaus(GEN x);\n```\nThat's technically a change in API you are exposing more functions than in the original. That kind of change is unlikely to break anything. All the rest of the code apart from the new function is private and shouldn't be called directly, so _it_ doesn't matter.\nA more disturbing change would have been changing the way a public function is called. If someone has been using a private function in their code and it breaks, honestly they get what they deserve.\n\nI haven't looked upstream, Julien may be worried that this extra function is not upstream or will be upstream under another name or call structure. It is the only thing that I can think could be extracted and put separately inside the sage library. And it technically could be done. BUT I haven't digged the code deep to see if it was possible without calling private functions from pari. I think I said something before about calling private functions... \n\nThere used to be some very invasive change in pari 2.3.xx where the sage spkg added some error handling mechanism. I cannot see it anymore. In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.",
    "created_at": "2013-04-10T21:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177216",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>So I did a bit more digging because it is a case of show me the code, I will say that after looking at it carefully I have reached a pragmatic view on this and I don't actually mind the change in question. If Julien is worried about some other code he can put it on display. So in the polred patch

```
diff -ruN src/src/headers/paridecl.h b/src/headers/paridecl.h
--- src/src/headers/paridecl.h	2012-09-25 23:10:47.000000000 +0200
+++ b/src/headers/paridecl.h	2013-01-31 14:49:05.557525771 +0100
@@ -889,6 +889,7 @@
 GEN     polredabs0(GEN x, long flag);
 GEN     polredabs2(GEN x);
 GEN     polredabsall(GEN x, long flun);
+GEN     polredbest(GEN x, long flag);
 GEN     smallpolred(GEN x);
 GEN     smallpolred2(GEN x);
 GEN     tschirnhaus(GEN x);
```
That's technically a change in API you are exposing more functions than in the original. That kind of change is unlikely to break anything. All the rest of the code apart from the new function is private and shouldn't be called directly, so _it_ doesn't matter.
A more disturbing change would have been changing the way a public function is called. If someone has been using a private function in their code and it breaks, honestly they get what they deserve.

I haven't looked upstream, Julien may be worried that this extra function is not upstream or will be upstream under another name or call structure. It is the only thing that I can think could be extracted and put separately inside the sage library. And it technically could be done. BUT I haven't digged the code deep to see if it was possible without calling private functions from pari. I think I said something before about calling private functions... 

There used to be some very invasive change in pari 2.3.xx where the sage spkg added some error handling mechanism. I cannot see it anymore. In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.



---

archive/issue_comments_177217.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 fbissey]:\n> That's technically a change in API you are exposing more functions than in the original.\n\nAs I tried to tell you several times, this patch is a backport from upstream PARI-2.6, the added function comes from PARI-2.6.\n\n> In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.\n\nSo we can close this ticket as invalid ;-)",
    "created_at": "2013-04-11T06:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177217",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:17 fbissey]:
> That's technically a change in API you are exposing more functions than in the original.

As I tried to tell you several times, this patch is a backport from upstream PARI-2.6, the added function comes from PARI-2.6.

> In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.

So we can close this ticket as invalid ;-)



---

archive/issue_comments_177218.json:
```json
{
    "body": "<a id='comment:19'></a>I played weather van a bit on that one. I would like to see if Julien has anything more to say. If he doesn't I'll happilly review it as invalid for you",
    "created_at": "2013-04-11T07:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177218",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>I played weather van a bit on that one. I would like to see if Julien has anything more to say. If he doesn't I'll happilly review it as invalid for you



---

archive/issue_comments_177219.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:11 Snark]:\n> Backporting is standard practice, to gain a bugfix or a new feature which is only available in a later version.\n\nBy this criterion, moving `polred.patch` to GOOD.",
    "created_at": "2013-04-11T10:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177219",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Replying to [comment:11 Snark]:
> Backporting is standard practice, to gain a bugfix or a new feature which is only available in a later version.

By this criterion, moving `polred.patch` to GOOD.



---

archive/issue_comments_177220.json:
```json
{
    "body": "<a id='comment:23'></a>FYI, the cygwin_dll_a.patch is upstream, see http://trac.sagemath.org/sage_trac/ticket/13333, corresponding upstream commits are mentioned there.",
    "created_at": "2013-04-11T10:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177220",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:23'></a>FYI, the cygwin_dll_a.patch is upstream, see http://trac.sagemath.org/sage_trac/ticket/13333, corresponding upstream commits are mentioned there.



---

archive/issue_comments_177221.json:
```json
{
    "body": "<a id='comment:26'></a>Honest question: why is \"patch submitted upstream but upstream ignored it\" so much better than \"patch not submitted upstream\"? Because the end result is the same.",
    "created_at": "2013-04-11T10:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177221",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>Honest question: why is "patch submitted upstream but upstream ignored it" so much better than "patch not submitted upstream"? Because the end result is the same.



---

archive/issue_comments_177222.json:
```json
{
    "body": "<a id='comment:27'></a>Scanning the gcc bugzilla entry associated with  GCC_PR49330.patch it seems like gcc dev think people are just doing stuff they shouldn't with pointer arythmetics. i.e. the source code should be fixed - not that i completely understand the discussion mind you. And I learned in that entry that you can pessimize!",
    "created_at": "2013-04-11T11:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177222",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>Scanning the gcc bugzilla entry associated with  GCC_PR49330.patch it seems like gcc dev think people are just doing stuff they shouldn't with pointer arythmetics. i.e. the source code should be fixed - not that i completely understand the discussion mind you. And I learned in that entry that you can pessimize!



---

archive/issue_comments_177223.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:17 fbissey]:\n> So I did a bit more digging because it is a case of show me the code, I will say that after looking at it carefully I have reached a pragmatic view on this and I don't actually mind the change in question. If Julien is worried about some other code he can put it on display. So in the polred patch\n> \n> ```\n> diff -ruN src/src/headers/paridecl.h b/src/headers/paridecl.h\n> --- src/src/headers/paridecl.h\t2012-09-25 23:10:47.000000000 +0200\n> +++ b/src/headers/paridecl.h\t2013-01-31 14:49:05.557525771 +0100\n> @@ -889,6 +889,7 @@\n>  GEN     polredabs0(GEN x, long flag);\n>  GEN     polredabs2(GEN x);\n>  GEN     polredabsall(GEN x, long flun);\n> +GEN     polredbest(GEN x, long flag);\n>  GEN     smallpolred(GEN x);\n>  GEN     smallpolred2(GEN x);\n>  GEN     tschirnhaus(GEN x);\n> ```\n> That's technically a change in API you are exposing more functions than in the original. That kind of change is unlikely to break anything. All the rest of the code apart from the new function is private and shouldn't be called directly, so _it_ doesn't matter.\n> A more disturbing change would have been changing the way a public function is called. If someone has been using a private function in their code and it breaks, honestly they get what they deserve.\n> \n> I haven't looked upstream, Julien may be worried that this extra function is not upstream or will be upstream under another name or call structure. \n\nI just checked and in PARI's git at least, it's just the same:\n* http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/headers/paridecl.h;h=01e6378eac8e329e9da34ee414f2b2f19f1770f8;hb=HEAD#l1263\nbut I cannot tell you what will be in PARI 2.6.\n>It is the only thing that I can think could be extracted and put separately inside the sage library. And it technically could be done. BUT I haven't digged the code deep to see if it was possible without calling private functions from pari. I think I said something before about calling private functions... \n> \n> There used to be some very invasive change in pari 2.3.xx where the sage spkg added some error handling mechanism. I cannot see it anymore. In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.",
    "created_at": "2013-04-11T12:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177223",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>Replying to [comment:17 fbissey]:
> So I did a bit more digging because it is a case of show me the code, I will say that after looking at it carefully I have reached a pragmatic view on this and I don't actually mind the change in question. If Julien is worried about some other code he can put it on display. So in the polred patch
> 
> ```
> diff -ruN src/src/headers/paridecl.h b/src/headers/paridecl.h
> --- src/src/headers/paridecl.h	2012-09-25 23:10:47.000000000 +0200
> +++ b/src/headers/paridecl.h	2013-01-31 14:49:05.557525771 +0100
> @@ -889,6 +889,7 @@
>  GEN     polredabs0(GEN x, long flag);
>  GEN     polredabs2(GEN x);
>  GEN     polredabsall(GEN x, long flun);
> +GEN     polredbest(GEN x, long flag);
>  GEN     smallpolred(GEN x);
>  GEN     smallpolred2(GEN x);
>  GEN     tschirnhaus(GEN x);
> ```
> That's technically a change in API you are exposing more functions than in the original. That kind of change is unlikely to break anything. All the rest of the code apart from the new function is private and shouldn't be called directly, so _it_ doesn't matter.
> A more disturbing change would have been changing the way a public function is called. If someone has been using a private function in their code and it breaks, honestly they get what they deserve.
> 
> I haven't looked upstream, Julien may be worried that this extra function is not upstream or will be upstream under another name or call structure. 

I just checked and in PARI's git at least, it's just the same:
* http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/headers/paridecl.h;h=01e6378eac8e329e9da34ee414f2b2f19f1770f8;hb=HEAD#l1263
but I cannot tell you what will be in PARI 2.6.
>It is the only thing that I can think could be extracted and put separately inside the sage library. And it technically could be done. BUT I haven't digged the code deep to see if it was possible without calling private functions from pari. I think I said something before about calling private functions... 
> 
> There used to be some very invasive change in pari 2.3.xx where the sage spkg added some error handling mechanism. I cannot see it anymore. In fact looking at the patchset more closely than I did for some time, it is much cleaner than it used to be.



---

archive/issue_comments_177224.json:
```json
{
    "body": "<a id='comment:30'></a>I checked too, and indeed polredbest looks like it's upstream, so I confirm that I was wrong and that polred.patch isn't that bad.\n\nLet me notice that patches without a properly identified author could probably go in the \"Needs documentation\" list.",
    "created_at": "2013-04-11T14:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177224",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:30'></a>I checked too, and indeed polredbest looks like it's upstream, so I confirm that I was wrong and that polred.patch isn't that bad.

Let me notice that patches without a properly identified author could probably go in the "Needs documentation" list.



---

archive/issue_comments_177225.json:
```json
{
    "body": "<a id='comment:34'></a>In #14539, I updated the patches README. Please verify that all needed documentation has been added.\n\nI remove the mention of `galoisanalysis_p4.patch` since that patch is upstream in PARI-2.5.4 and therefore not needed anymore.",
    "created_at": "2013-05-06T15:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177225",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>In #14539, I updated the patches README. Please verify that all needed documentation has been added.

I remove the mention of `galoisanalysis_p4.patch` since that patch is upstream in PARI-2.5.4 and therefore not needed anymore.



---

archive/issue_comments_177226.json:
```json
{
    "body": "<a id='comment:36'></a>The documentation is much better, but it looks like sage-the-distribution is going to ship with a 'polredbest' function which will not be in pari 2.5.4 ; it will hence not be compatible with what other distributions will ship. Can't this function's code go into **sage**'s codebase instead?",
    "created_at": "2013-05-10T21:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177226",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:36'></a>The documentation is much better, but it looks like sage-the-distribution is going to ship with a 'polredbest' function which will not be in pari 2.5.4 ; it will hence not be compatible with what other distributions will ship. Can't this function's code go into **sage**'s codebase instead?



---

archive/issue_comments_177227.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:36 Snark]:\n> Can't this function's code go into **sage**'s codebase instead?\n\nWhy should it go into Sage's codebase? Sage is probably always going to need PARI + extra patches, not just vanilla PARI. So what's the point of moving this one patch into Sage?",
    "created_at": "2013-05-11T09:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177227",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>Replying to [comment:36 Snark]:
> Can't this function's code go into **sage**'s codebase instead?

Why should it go into Sage's codebase? Sage is probably always going to need PARI + extra patches, not just vanilla PARI. So what's the point of moving this one patch into Sage?



---

archive/issue_comments_177228.json:
```json
{
    "body": "<a id='comment:38'></a>I guess the point is to ease integration of Sage into Debian (or other distributions).\nIt may be against Debian rules to change the ABI, I don't really know.",
    "created_at": "2013-05-11T10:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177228",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:38'></a>I guess the point is to ease integration of Sage into Debian (or other distributions).
It may be against Debian rules to change the ABI, I don't really know.



---

archive/issue_comments_177229.json:
```json
{
    "body": "<a id='comment:39'></a>Well, I don't agree that we should add extra complications to Sage to please distributions. And moving pieces of PARI into the Sage library sounds like a non-trivial thing to do.",
    "created_at": "2013-05-11T10:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177229",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>Well, I don't agree that we should add extra complications to Sage to please distributions. And moving pieces of PARI into the Sage library sounds like a non-trivial thing to do.



---

archive/issue_comments_177230.json:
```json
{
    "body": "<a id='comment:40'></a>Yup, I agree with that, I was just trying to get Julien's point.\n\nAnyway, for Debian, I guess he'll just have to wait for PARI 2.6 which is supposedly not that far away (unless things changed since the workshop).",
    "created_at": "2013-05-11T10:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177230",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:40'></a>Yup, I agree with that, I was just trying to get Julien's point.

Anyway, for Debian, I guess he'll just have to wait for PARI 2.6 which is supposedly not that far away (unless things changed since the workshop).



---

archive/issue_comments_177231.json:
```json
{
    "body": "<a id='comment:41'></a>I don't think this particular code should go in sage. As Jeroen said it wouldn't be trivial. It looks to like pari internal functions are called. If you could implement it only with public functions it would be fine to just stick it in sage - and that would be the way to go in my opinion. But I don't see that as being the case with polredbest.\n\nGentoo policy on that case is it's ok if upstream intends to include the code which is the case here I believe. But really I have more freedom than Julien here.",
    "created_at": "2013-05-11T10:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177231",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>I don't think this particular code should go in sage. As Jeroen said it wouldn't be trivial. It looks to like pari internal functions are called. If you could implement it only with public functions it would be fine to just stick it in sage - and that would be the way to go in my opinion. But I don't see that as being the case with polredbest.

Gentoo policy on that case is it's ok if upstream intends to include the code which is the case here I believe. But really I have more freedom than Julien here.



---

archive/issue_comments_177232.json:
```json
{
    "body": "<a id='comment:42'></a>It is again a problem of confusion between sage-the-distribution and sage-the-software ; the current sage-the-software won't work with pari 2.5.4, because it depends on polredbest (at least).\n\nThis is a problem for debian ; see the discussion about my\n[debian bug report](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=703116).\n\nI'm not sure pari 2.6 will be a solution real soon: I just tried to make a pari 2.6 spkg from an upstream snapshot (taking the current spkg and removing the patches) :\n1. it compiled ok ;\n2. eclib compiled ;\n3. genus2reduction didn't compile (error: \u2018arither1\u2019 undeclared) ;\n4. lcalc didn't compile (error: too few arguments to function \u2018long int* ellinit(GEN, GEN, long int)');\n5. sagelib didn't compile (quite a few different problems).",
    "created_at": "2013-05-11T14:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177232",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:42'></a>It is again a problem of confusion between sage-the-distribution and sage-the-software ; the current sage-the-software won't work with pari 2.5.4, because it depends on polredbest (at least).

This is a problem for debian ; see the discussion about my
[debian bug report](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=703116).

I'm not sure pari 2.6 will be a solution real soon: I just tried to make a pari 2.6 spkg from an upstream snapshot (taking the current spkg and removing the patches) :
1. it compiled ok ;
2. eclib compiled ;
3. genus2reduction didn't compile (error: ‘arither1’ undeclared) ;
4. lcalc didn't compile (error: too few arguments to function ‘long int* ellinit(GEN, GEN, long int)');
5. sagelib didn't compile (quite a few different problems).



---

archive/issue_comments_177233.json:
```json
{
    "body": "<a id='comment:43'></a>I think #15767 will fix that bug too.",
    "created_at": "2014-04-10T17:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177233",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:43'></a>I think #15767 will fix that bug too.



---

archive/issue_comments_177234.json:
```json
{
    "body": "<a id='comment:44'></a>What should be done with this ticket now? Do you still consider it relevant?",
    "created_at": "2015-03-13T10:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177234",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>What should be done with this ticket now? Do you still consider it relevant?



---

archive/issue_comments_177235.json:
```json
{
    "body": "<a id='comment:45'></a>Well, things changed a lot : I vote for close.",
    "created_at": "2015-03-13T13:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177235",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:45'></a>Well, things changed a lot : I vote for close.



---

archive/issue_comments_177236.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-13T17:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177236",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_events_040668.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-13T17:22:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14346#event-40668"
}
```



---

archive/issue_events_040669.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-13T17:22:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14346#event-40669"
}
```



---

archive/issue_comments_177237.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-13T17:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177237",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177238.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-17T18:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14346#issuecomment-177238",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_040670.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-17T18:19:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14346",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14346#event-40670"
}
```
