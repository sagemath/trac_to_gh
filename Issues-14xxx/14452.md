# Issue 14452: Upgrade to Cython 0.19

archive/issues_014248.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "Upgrade to Cython 0.19.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz))\n\n**upstream**:\n1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)\n2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)\n3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)\n4. Bug with `cpdef` keyword arguments in `lazy_import.pyx`: [http://trac.cython.org/cython_trac/ticket/810](http://trac.cython.org/cython_trac/ticket/810)\n\nWith this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.\n\nOn Itanium, there is a doctest failure\n\n```\nsage -t --long devel/sage/sage/structure/element.pyx\n**********************************************************************\nFile \"devel/sage/sage/structure/element.pyx\", line 1733, in sage.structure.element.RingElement.__pow__\nFailed example:\n    p(a,2,1)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: __pow__ dummy argument not used\nGot:\n    202\n**********************************************************************\n```\nThis is likely a bug in GCC-4.7.3, but no further investigation has been done. Compiling `sage/structure/element.pyx` with `-Os` works around the problem, see patch.\n\n**apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)\n\nDepends on #13826\n\nCC:  @robertwb\n\nUpstream: **None of the above - read trac for reasoning.**\n\nReviewer: **Robert Bradshaw**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.9.rc0**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14452_\n\n",
    "closed_at": "2013-04-23T19:08:37Z",
    "created_at": "2013-04-15T12:04:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to Cython 0.19",
    "type": "issue",
    "updated_at": "2013-04-24T12:25:29Z",
    "url": "https://github.com/sagemath/sage/issues/14452",
    "user": "https://github.com/jdemeyer"
}
```
Upgrade to Cython 0.19.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz))

**upstream**:
1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)
2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)
3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)
4. Bug with `cpdef` keyword arguments in `lazy_import.pyx`: [http://trac.cython.org/cython_trac/ticket/810](http://trac.cython.org/cython_trac/ticket/810)

With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.

On Itanium, there is a doctest failure

```
sage -t --long devel/sage/sage/structure/element.pyx
**********************************************************************
File "devel/sage/sage/structure/element.pyx", line 1733, in sage.structure.element.RingElement.__pow__
Failed example:
    p(a,2,1)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: __pow__ dummy argument not used
Got:
    202
**********************************************************************
```
This is likely a bug in GCC-4.7.3, but no further investigation has been done. Compiling `sage/structure/element.pyx` with `-Os` works around the problem, see patch.

**apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)

Depends on #13826

CC:  @robertwb

Upstream: **None of the above - read trac for reasoning.**

Reviewer: **Robert Bradshaw**

Author: **Jeroen Demeyer**

Merged: **sage-5.9.rc0**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/14452_





---

archive/issue_events_205255.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T12:04:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205255"
}
```



---

archive/issue_events_205256.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T12:04:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205256"
}
```



---

archive/issue_events_205257.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T12:04:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205257"
}
```



---

archive/issue_events_205258.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T12:04:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205258"
}
```



---

archive/issue_events_205259.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T12:04:02Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205259"
}
```



---

archive/issue_comments_174100.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Upgrade to Cython 0.19 when it's released.\n+\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))\n``````\n",
    "created_at": "2013-04-15T12:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174100",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Upgrade to Cython 0.19 when it's released.
+
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))
``````




---

archive/issue_comments_174101.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nRobert, I think there is a serious Cython bug: the `__new__` method of a class might actually use the wrong class: in `devel/sage/sage/libs/gap/element.pyx`, the code\n\n```\ndef GapElement_Record r = GapElement_Record.__new__(GapElement_Record)\n```\ngenerates\n\n```\n__pyx_t_1 = __pyx_tp_new_4sage_4libs_3gap_7element_GapElement(((PyTypeObject *)((PyObject*)__pyx_ptype_4sage_4libs_3gap_7element_GapElement_Record)), ((PyObject *)__pyx_empty_tuple), NULL);\n```\nNote the call to the `tp_new` function of `GapElement` (a child class), not `GapElement_Record`.",
    "created_at": "2013-04-16T17:30:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174101",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Robert, I think there is a serious Cython bug: the `__new__` method of a class might actually use the wrong class: in `devel/sage/sage/libs/gap/element.pyx`, the code

```
def GapElement_Record r = GapElement_Record.__new__(GapElement_Record)
```
generates

```
__pyx_t_1 = __pyx_tp_new_4sage_4libs_3gap_7element_GapElement(((PyTypeObject *)((PyObject*)__pyx_ptype_4sage_4libs_3gap_7element_GapElement_Record)), ((PyObject *)__pyx_empty_tuple), NULL);
```
Note the call to the `tp_new` function of `GapElement` (a child class), not `GapElement_Record`.



---

archive/issue_comments_174102.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2013-04-16T18:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174102",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_174103.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Upgrade to Cython 0.19 when it's released.\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))\n+\n+**upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n``````\n",
    "created_at": "2013-04-16T18:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174103",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Upgrade to Cython 0.19 when it's released.
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))
+
+**upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
``````




---

archive/issue_comments_174104.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nhttps://github.com/cython/cython/pull/214",
    "created_at": "2013-04-17T05:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174104",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:4" align="right">comment:4</div>

https://github.com/cython/cython/pull/214



---

archive/issue_comments_174105.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2013-04-17T05:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174105",
    "user": "https://github.com/robertwb"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_174106.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)**",
    "created_at": "2013-04-17T18:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174106",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)**



---

archive/issue_comments_174107.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))\n \n **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n+\n+With this spkg, all doctests pass, but the docbuilder crashes: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)\n``````\n",
    "created_at": "2013-04-17T18:13:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174107",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))
 
 **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
+
+With this spkg, all doctests pass, but the docbuilder crashes: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)
``````




---

archive/issue_comments_174108.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Upgrade to Cython 0.19 when it's released.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)\n \n **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n \n``````\n",
    "created_at": "2013-04-17T18:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174108",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Upgrade to Cython 0.19 when it's released.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on [Cython-0.19 beta2](http://mail.python.org/pipermail/cython-devel/2013-April/003564.html))
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)
 
 **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
 
``````




---

archive/issue_comments_174109.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHere is what I found about the docbuilder crash: it works with Cython 0.18, not with current master at `0ee15b1829125b6844ac13f437c2d9bd61a4ceca`.\n\nIn `lazy_import.pyx`, somehow `self._object` becomes `NULL` in the line\n\n```\nsetattr(cls, alias, self._object)\n```\nwhich is compiled to\n\n```\n           __pyx_t_1 = __pyx_v_self->_object;                                      \n           __Pyx_INCREF(__pyx_t_1);\n           __pyx_t_10 = PyObject_SetAttr(__pyx_v_cls, __pyx_v_alias, __pyx_t_1); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __py\n           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;                                 \n```\nI don't see anything suspicious here.",
    "created_at": "2013-04-18T08:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174109",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Here is what I found about the docbuilder crash: it works with Cython 0.18, not with current master at `0ee15b1829125b6844ac13f437c2d9bd61a4ceca`.

In `lazy_import.pyx`, somehow `self._object` becomes `NULL` in the line

```
setattr(cls, alias, self._object)
```
which is compiled to

```
           __pyx_t_1 = __pyx_v_self->_object;                                      
           __Pyx_INCREF(__pyx_t_1);
           __pyx_t_10 = PyObject_SetAttr(__pyx_v_cls, __pyx_v_alias, __pyx_t_1); if (unlikely(__pyx_t_10 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __py
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;                                 
```
I don't see anything suspicious here.



---

archive/issue_comments_174110.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGenerating just `lazy_import.c` with Cython-0.18 makes the documentation build.",
    "created_at": "2013-04-18T08:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174110",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Generating just `lazy_import.c` with Cython-0.18 makes the documentation build.



---

archive/issue_comments_174111.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nRobert, I feel like I can not do much more to debug the docbuilding since I don't really understand the mechanics of `lazy_import`.",
    "created_at": "2013-04-18T08:42:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174111",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Robert, I feel like I can not do much more to debug the docbuilding since I don't really understand the mechanics of `lazy_import`.



---

archive/issue_comments_174112.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n \n-With this spkg, all doctests pass, but the docbuilder crashes: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)\n+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)\n``````\n",
    "created_at": "2013-04-18T08:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174112",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 **upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
 
-With this spkg, all doctests pass, but the docbuilder crashes: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)
+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)
``````




---

archive/issue_comments_174113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)\n \n-**upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n+**upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n \n With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)\n``````\n",
    "created_at": "2013-04-18T08:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174113",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 **spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)
 
-**upstream** bug report causing segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
+**upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
 
 With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)
``````




---

archive/issue_comments_174114.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n **upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n \n-With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)\n+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) If the file `lazy_import.c` is generated with Cython 0.18, the problem goes away.\n``````\n",
    "created_at": "2013-04-18T11:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174114",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 **upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
 
-With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log)
+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) If the file `lazy_import.c` is generated with Cython 0.18, the problem goes away.
``````




---

archive/issue_comments_174115.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI don't see anything suspicious there either. Can you try compiling lazy_import.pyx with -O0? What's the diff of this file between 0.18 and 0.19?",
    "created_at": "2013-04-18T22:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174115",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:13" align="right">comment:13</div>

I don't see anything suspicious there either. Can you try compiling lazy_import.pyx with -O0? What's the diff of this file between 0.18 and 0.19?



---

archive/issue_comments_174116.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@robertwb](#comment:13):\n> Can you try compiling lazy_import.pyx with -O0?\n\nI did, and it didn't help. I could try to bisect the Cython git repo for the bug.",
    "created_at": "2013-04-19T06:17:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174116",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@robertwb](#comment:13):
> Can you try compiling lazy_import.pyx with -O0?

I did, and it didn't help. I could try to bisect the Cython git repo for the bug.



---

archive/issue_comments_174117.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nResults of bisecting:\n\n* commit `19c0408476515c89a60655b753f08a3bd18eec83` is good\n\n* commit `d44a0845fc91bf7ade61dee431358f375c580f44` is bad\n\nAll commits in between simply fail to compile.",
    "created_at": "2013-04-19T10:41:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174117",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Results of bisecting:

* commit `19c0408476515c89a60655b753f08a3bd18eec83` is good

* commit `d44a0845fc91bf7ade61dee431358f375c580f44` is bad

All commits in between simply fail to compile.



---

archive/issue_comments_174118.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe relevant change seems to be the line\n\n```\nobj = self._get_object(owner=owner)\n```\n\nwhich was compiled in the **good** way as\n\n```\n  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s___get_object); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}\n  __Pyx_GOTREF(__pyx_t_1);\n  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}\n  __Pyx_GOTREF(((PyObject *)__pyx_t_2));\n  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__owner), __pyx_v_owner) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}\n  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}\n  __Pyx_GOTREF(__pyx_t_3);\n  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;\n  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;\n  __pyx_v_obj = __pyx_t_3;\n  __pyx_t_3 = 0;\n```\n\nand in the **bad** way as\n\n```\n  __pyx_t_2.__pyx_n = 1;\n  __pyx_t_2.owner = __pyx_v_owner;\n  __pyx_t_1 = ((struct __pyx_vtabstruct_4sage_4misc_11lazy_import_LazyImport *)__pyx_v_self->__pyx_vtab)->_get_object(__pyx_v_self, 0, &__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}\n  __Pyx_GOTREF(__pyx_t_1);\n  __pyx_v_obj = __pyx_t_1;\n  __pyx_t_1 = 0;\n```",
    "created_at": "2013-04-19T14:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174118",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

The relevant change seems to be the line

```
obj = self._get_object(owner=owner)
```

which was compiled in the **good** way as

```
  __pyx_t_1 = PyObject_GetAttr(((PyObject *)__pyx_v_self), __pyx_n_s___get_object); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyDict_New(); if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(((PyObject *)__pyx_t_2));
  if (PyDict_SetItem(__pyx_t_2, ((PyObject *)__pyx_n_s__owner), __pyx_v_owner) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_t_3 = PyObject_Call(__pyx_t_1, ((PyObject *)__pyx_empty_tuple), ((PyObject *)__pyx_t_2)); if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  __pyx_v_obj = __pyx_t_3;
  __pyx_t_3 = 0;
```

and in the **bad** way as

```
  __pyx_t_2.__pyx_n = 1;
  __pyx_t_2.owner = __pyx_v_owner;
  __pyx_t_1 = ((struct __pyx_vtabstruct_4sage_4misc_11lazy_import_LazyImport *)__pyx_v_self->__pyx_vtab)->_get_object(__pyx_v_self, 0, &__pyx_t_2); if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_obj = __pyx_t_1;
  __pyx_t_1 = 0;
```



---

archive/issue_comments_174119.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAlternatively, changing the line\n\n```\ncpdef _get_object(self, owner=None):\n```\nto\n\n```\ndef _get_object(self, owner=None):\n```\nalso fixes the problem. I am applying this workaround in [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz).",
    "created_at": "2013-04-19T14:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174119",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Alternatively, changing the line

```
cpdef _get_object(self, owner=None):
```
to

```
def _get_object(self, owner=None):
```
also fixes the problem. I am applying this workaround in [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz).



---

archive/issue_comments_174120.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n-Upgrade to Cython 0.19 when it's released.\n+Upgrade to Cython 0.19.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg)\n \n **upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n \n-With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) If the file `lazy_import.c` is generated with Cython 0.18, the problem goes away.\n+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.\n+\n+**apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)\n``````\n",
    "created_at": "2013-04-19T14:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174120",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
-Upgrade to Cython 0.19 when it's released.
+Upgrade to Cython 0.19.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg) (based on Cython master)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg)
 
 **upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
 
-With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) If the file `lazy_import.c` is generated with Cython 0.18, the problem goes away.
+With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.
+
+**apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)
``````




---

archive/issue_events_205260.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-19T14:53:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205260"
}
```



---

archive/issue_events_205261.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-19T18:54:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205261"
}
```



---

archive/issue_events_205262.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-19T18:54:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205262"
}
```



---

archive/issue_comments_174121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,11 @@\n Upgrade to Cython 0.19.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg)\n \n-**upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)\n+**upstream**:\n+1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)\n+2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)\n+3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)\n \n With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.\n \n``````\n",
    "created_at": "2013-04-21T15:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174121",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,11 @@
 Upgrade to Cython 0.19.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg)
 
-**upstream** bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808)
+**upstream**:
+1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)
+2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)
+3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)
 
 With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.
 
``````




---

archive/issue_comments_174122.json:
```json
{
    "body": "Changed upstream from **Fixed upstream, but not in a stable release.** to **None of the above - read trac for reasoning.**",
    "created_at": "2013-04-21T15:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174122",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Fixed upstream, but not in a stable release.** to **None of the above - read trac for reasoning.**



---

archive/issue_comments_174123.json:
```json
{
    "body": "spkg diff",
    "created_at": "2013-04-21T15:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174123",
    "user": "https://github.com/jdemeyer"
}
```

spkg diff



---

archive/issue_comments_174124.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[cython-0.19.p0.diff.gz](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz)**",
    "created_at": "2013-04-21T15:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174124",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[cython-0.19.p0.diff.gz](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz)**



---

archive/issue_comments_174125.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Upgrade to Cython 0.19.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz))\n \n **upstream**:\n 1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)\n``````\n",
    "created_at": "2013-04-21T15:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174125",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Upgrade to Cython 0.19.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/cython-0.19.p0.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14452/cython-0.19.p0.diff.gz))
 
 **upstream**:
 1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)
``````




---

archive/issue_comments_174126.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,4 +9,22 @@\n \n With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.\n \n+On Itanium, there is a doctest failure\n+\n+```\n+sage -t --long devel/sage/sage/structure/element.pyx\n+**********************************************************************\n+File \"devel/sage/sage/structure/element.pyx\", line 1733, in sage.structure.element.RingElement.__pow__\n+Failed example:\n+    p(a,2,1)\n+Expected:\n+    Traceback (most recent call last):\n+    ...\n+    RuntimeError: __pow__ dummy argument not used\n+Got:\n+    202\n+**********************************************************************\n+```\n+This is likely a bug in GCC-4.7.3, but no further investigation has been done. Compiling `sage/structure/element.pyx` with `-Os` works around the problem, see patch.\n+\n **apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)\n``````\n",
    "created_at": "2013-04-22T12:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174126",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,4 +9,22 @@
 
 With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.
 
+On Itanium, there is a doctest failure
+
+```
+sage -t --long devel/sage/sage/structure/element.pyx
+**********************************************************************
+File "devel/sage/sage/structure/element.pyx", line 1733, in sage.structure.element.RingElement.__pow__
+Failed example:
+    p(a,2,1)
+Expected:
+    Traceback (most recent call last):
+    ...
+    RuntimeError: __pow__ dummy argument not used
+Got:
+    202
+**********************************************************************
+```
+This is likely a bug in GCC-4.7.3, but no further investigation has been done. Compiling `sage/structure/element.pyx` with `-Os` works around the problem, see patch.
+
 **apply** [attachment: 14452_cython_0.19.patch](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)
``````




---

archive/issue_comments_174127.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWith these patches, all fine on the buildbot.",
    "created_at": "2013-04-22T12:04:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174127",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

With these patches, all fine on the buildbot.



---

archive/issue_comments_174128.json:
```json
{
    "body": "Attachment: **[14452_cython_0.19.patch.gz](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)**",
    "created_at": "2013-04-23T10:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174128",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[14452_cython_0.19.patch.gz](https://github.com/sagemath/sage/files/ticket14452/14452_cython_0.19.patch.gz)**



---

archive/issue_comments_174129.json:
```json
{
    "body": "Dependencies: **#13826**",
    "created_at": "2013-04-23T10:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174129",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#13826**



---

archive/issue_comments_174130.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nRebased to #13826.",
    "created_at": "2013-04-23T10:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174130",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Rebased to #13826.



---

archive/issue_events_205263.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T18:38:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205263"
}
```



---

archive/issue_events_205264.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T18:38:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205264"
}
```



---

archive/issue_events_205265.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-04-23T18:51:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205265"
}
```



---

archive/issue_events_205266.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2013-04-23T18:51:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205266"
}
```



---

archive/issue_comments_174131.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThanks for debugging this! I filed http://trac.cython.org/cython_trac/ticket/810 about (what I think is) the underlying bug you uncovered with the lazy import stuff.",
    "created_at": "2013-04-23T18:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174131",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:26" align="right">comment:26</div>

Thanks for debugging this! I filed http://trac.cython.org/cython_trac/ticket/810 about (what I think is) the underlying bug you uncovered with the lazy import stuff.



---

archive/issue_events_205267.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T19:08:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205267"
}
```



---

archive/issue_events_205268.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T19:08:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14452#event-205268"
}
```



---

archive/issue_comments_174132.json:
```json
{
    "body": "Merged: **sage-5.9.rc0**",
    "created_at": "2013-04-23T19:08:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174132",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.rc0**



---

archive/issue_comments_174133.json:
```json
{
    "body": "Reviewer: **Robert Bradshaw**",
    "created_at": "2013-04-23T19:08:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174133",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Robert Bradshaw**



---

archive/issue_comments_174134.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@robertwb](#comment:26):\n> Thanks for debugging this! I filed http://trac.cython.org/cython_trac/ticket/810 about (what I think is) the underlying bug you uncovered with the lazy import stuff. \n\nDo you have a better idea about what precisely is wrong? I isolated the problem, but I don't know why it segfaults.",
    "created_at": "2013-04-24T12:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174134",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@robertwb](#comment:26):
> Thanks for debugging this! I filed http://trac.cython.org/cython_trac/ticket/810 about (what I think is) the underlying bug you uncovered with the lazy import stuff. 

Do you have a better idea about what precisely is wrong? I isolated the problem, but I don't know why it segfaults.



---

archive/issue_comments_174135.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n 1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)\n 2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)\n 3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)\n+4. Bug with `cpdef` keyword arguments in `lazy_import.pyx`: [http://trac.cython.org/cython_trac/ticket/810](http://trac.cython.org/cython_trac/ticket/810)\n \n With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.\n \n``````\n",
    "created_at": "2013-04-24T12:25:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14452",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14452#issuecomment-174135",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 1. Bug report about segfaults in libGAP: [http://trac.cython.org/cython_trac/ticket/808](http://trac.cython.org/cython_trac/ticket/808) (fixed in Cython 0.19)
 2. Bug with g++ on Solaris: [http://trac.cython.org/cython_trac/ticket/809](http://trac.cython.org/cython_trac/ticket/809) (patch in spkg and submitted upstream)
 3. Bug with g++ on Solaris: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=57025) (deny it's a bug)
+4. Bug with `cpdef` keyword arguments in `lazy_import.pyx`: [http://trac.cython.org/cython_trac/ticket/810](http://trac.cython.org/cython_trac/ticket/810)
 
 With this spkg, all doctests pass, but the docbuilder (in particular the command `./sage --docbuild reference/combinat html`) crashes due to a problem with `lazy_import`: [attachment: sage_crash_W7eVMu.log](https://github.com/sagemath/sage/files/ticket14452/sage_crash_W7eVMu.log) The Sage library patch works around this problem.
 
``````

