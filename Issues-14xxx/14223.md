# Issue 14223: Fix 3d plots to not ignore user prespecified aspect_ratio.

archive/issues_014019.json:
```json
{
    "body": "In the following, the user specified aspect ratio is currently ignored:\n\n```\n    sage: p = sphere()\n    sage: p.aspect_ratio([10,1,1])\n    sage: p.show()\n```\n\nThe attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.\n\n---\nApply [attachment:trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch) to devel/sage.\n\n**Assignee:** @jasongrout, @williamstein\n\n**Reviewer:** Tobias Weich\n\n**Author:** Punarbasu Purkayastha\n\n**Merged:** sage-5.13.beta1\n\nIssue created by migration from https://trac.sagemath.org/ticket/14223\n\n",
    "closed_at": "2013-10-12T09:46:14Z",
    "created_at": "2013-03-03T23:11:26Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "title": "Fix 3d plots to not ignore user prespecified aspect_ratio.",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/14223",
    "user": "https://github.com/nthiery"
}
```
In the following, the user specified aspect ratio is currently ignored:

```
    sage: p = sphere()
    sage: p.aspect_ratio([10,1,1])
    sage: p.show()
```

The attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.

---
Apply [attachment:trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch) to devel/sage.

**Assignee:** @jasongrout, @williamstein

**Reviewer:** Tobias Weich

**Author:** Punarbasu Purkayastha

**Merged:** sage-5.13.beta1

Issue created by migration from https://trac.sagemath.org/ticket/14223





---

archive/attachments_019848.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14223-plot-aspect_ratio-nt.patch",
    "asset_url": "tarball://root/attachments/ticket14223/trac_14223-plot-aspect_ratio-nt.patch",
    "created_at": "2013-03-03T23:12:41Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket14223/trac_14223-plot-aspect_ratio-nt.patch",
    "user": "https://github.com/nthiery"
}
```



---

archive/issue_comments_172248.json:
```json
{
    "body": "**Attachment:** [trac_14223-plot-aspect_ratio-nt.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-plot-aspect_ratio-nt.patch)",
    "created_at": "2013-03-03T23:12:41Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172248",
    "user": "https://github.com/nthiery"
}
```

**Attachment:** [trac_14223-plot-aspect_ratio-nt.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-plot-aspect_ratio-nt.patch)



---

archive/issue_comments_172249.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is quite tricky. I think the modification to the `aspect_ratio` should be made much earlier since the scaling of the `frame_aspect_ratio` depends on the value of `aspect_ratio`. Will look into this.",
    "created_at": "2013-03-05T06:18:01Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172249",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:1'></a>
This is quite tricky. I think the modification to the `aspect_ratio` should be made much earlier since the scaling of the `frame_aspect_ratio` depends on the value of `aspect_ratio`. Will look into this.



---

archive/issue_comments_172250.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [@ppurka](#comment%3A1):\n> This is quite tricky. I think the modification to the `aspect_ratio` should be made much earlier since the scaling of the `frame_aspect_ratio` depends on the value of `aspect_ratio`. Will look into this.\n\nThanks!",
    "created_at": "2013-03-06T03:55:52Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172250",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>
Replying to [@ppurka](#comment%3A1):
> This is quite tricky. I think the modification to the `aspect_ratio` should be made much earlier since the scaling of the `frame_aspect_ratio` depends on the value of `aspect_ratio`. Will look into this.

Thanks!



---

archive/issue_events_122843.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2013-08-05T14:50:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122843"
}
```



---

archive/issue_events_122844.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2013-08-05T14:50:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122844"
}
```



---

archive/issue_comments_172251.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,3 +7,6 @@\n ```\n \n The attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.\n+\n+---\n+Apply [Attachment:trac_14223-fix_3d_aspect_ratio.patch] to devel/sage.\n``````\n",
    "created_at": "2013-08-05T14:50:33Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172251",
    "user": "https://github.com/ppurka"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,3 +7,6 @@
 ```
 
 The attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.
+
+---
+Apply [Attachment:trac_14223-fix_3d_aspect_ratio.patch] to devel/sage.
``````




---

archive/issue_events_122845.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2013-08-05T14:50:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122845"
}
```



---

archive/issue_comments_172252.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttached is the patch to fix this bug.\n\nPatchbot apply trac_14223-fix_3d_aspect_ratio.patch",
    "created_at": "2013-08-05T14:50:33Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172252",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:3'></a>
Attached is the patch to fix this bug.

Patchbot apply trac_14223-fix_3d_aspect_ratio.patch



---

archive/issue_comments_172253.json:
```json
{
    "body": "**Author:** Punarbasu Purkayastha",
    "created_at": "2013-08-05T14:50:33Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172253",
    "user": "https://github.com/ppurka"
}
```

**Author:** Punarbasu Purkayastha



---

archive/issue_comments_172254.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi,\n\nI wanted to test this patch but unfortunately I already failed applying the patch to the latest stable version (5.11). I get\n\n```\nsage: hg_sage.apply(\"/home/xyz/trac_14223-fix_3d_aspect_ratio.patch\")\ncd \"/usr/local/sage-5.0.1/devel/sage\" && sage --hg import   \"/home/tobi/Sync/Projekte/SageDev_linestyle/review_aspect/trac_14223-fix_3d_aspect_ratio.patch\"\napplying /home/xyz/trac_14223-fix_3d_aspect_ratio.patch\nabort: failed to synchronize metadata for \"sage/plot/plot3d/base.pyx\"\n```\n\nBeing rather inexperienced it might well be that it is my mistake (especially as the patchbot seems to be ok with the patch). Do I have to apply it to the latest pre-release? Or do you have any other ideas what's wrong?",
    "created_at": "2013-09-05T21:41:43Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172254",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:5'></a>
Hi,

I wanted to test this patch but unfortunately I already failed applying the patch to the latest stable version (5.11). I get

```
sage: hg_sage.apply("/home/xyz/trac_14223-fix_3d_aspect_ratio.patch")
cd "/usr/local/sage-5.0.1/devel/sage" && sage --hg import   "/home/tobi/Sync/Projekte/SageDev_linestyle/review_aspect/trac_14223-fix_3d_aspect_ratio.patch"
applying /home/xyz/trac_14223-fix_3d_aspect_ratio.patch
abort: failed to synchronize metadata for "sage/plot/plot3d/base.pyx"
```

Being rather inexperienced it might well be that it is my mistake (especially as the patchbot seems to be ok with the patch). Do I have to apply it to the latest pre-release? Or do you have any other ideas what's wrong?



---

archive/issue_comments_172255.json:
```json
{
    "body": "<a id='comment:6'></a>\n\n```\nsage: hg_sage.apply(\"/home/xyz/trac_14223-fix_3d_aspect_ratio.patch\")\ncd \"/usr/local/sage-5.0.1/devel/sage\" && <snip>\n```\nThere you go. It is trying to apply to sage-5.0.1 instead of sage-5.11.",
    "created_at": "2013-09-06T07:11:30Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172255",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:6'></a>

```
sage: hg_sage.apply("/home/xyz/trac_14223-fix_3d_aspect_ratio.patch")
cd "/usr/local/sage-5.0.1/devel/sage" && <snip>
```
There you go. It is trying to apply to sage-5.0.1 instead of sage-5.11.



---

archive/issue_comments_172256.json:
```json
{
    "body": "<a id='comment:7'></a>\nNo I don't think so. The folder name is missleading. I upgraded sage several times and the upgrades seem not to change the folder names.\n\nOn which version is the patch based on? I'll install the most recent pre-release and try whether I can apply it there...",
    "created_at": "2013-09-06T19:59:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172256",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:7'></a>
No I don't think so. The folder name is missleading. I upgraded sage several times and the upgrades seem not to change the folder names.

On which version is the patch based on? I'll install the most recent pre-release and try whether I can apply it there...



---

archive/issue_comments_172257.json:
```json
{
    "body": "<a id='comment:8'></a>\nIIRC, the patch is based on either sage-5.11-beta3 or sage-5.11-rc0. It should apply even to recent 5.12 prereleases since no one touches these graphics code. `:-)` The patchbot of course agrees!",
    "created_at": "2013-09-06T22:40:06Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172257",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:8'></a>
IIRC, the patch is based on either sage-5.11-beta3 or sage-5.11-rc0. It should apply even to recent 5.12 prereleases since no one touches these graphics code. `:-)` The patchbot of course agrees!



---

archive/issue_comments_172258.json:
```json
{
    "body": "<a id='comment:9'></a>\nstrange... The problem persists even with the most recent version:\n\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                                                                                                          \n\u2502 Sage Version 5.12.beta4, Release Date: 2013-08-30                  \u2502                                                                                                                          \n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502                                                                                                                                                                                                         \n\u2502 Type \"help()\" for help.                                            \u2502                                                                                                                                                                                                         \n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                                                                                                                                                                                         \n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513                                                                                                                                                                                                         \n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503                                                                                                                                                                                                         \n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b                                                                                                                                                                                                         \nsage: hg_sage.apply(\"/home/xyz/trac_14223-fix_3d_aspect_ratio.patch\")                                                                                                                                                           \ncd \"/usr/local/sage-5.12.beta4/devel/sage\" && sage --hg import   \"/home/tobi/Sync/Projekte/SageDev_linestyle/review_aspect/trac_14223-fix_3d_aspect_ratio.patch\"                                                                                                               \napplying /home/xyz/trac_14223-fix_3d_aspect_ratio.patch                                                                                                                                                                         \nabort: failed to synchronize metadata for \"sage/plot/plot3d/base.pyx\"                 \n\n\n```\n\nI somehow still suspect that the problem is on my side. Do you have any Ideas? Or could you check whether you can apply it to 5.12beta4?\n\nThanks,\n\nTobi",
    "created_at": "2013-09-08T12:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172258",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:9'></a>
strange... The problem persists even with the most recent version:


```
┌────────────────────────────────────────────────────────────────────┐                                                                                                                          
│ Sage Version 5.12.beta4, Release Date: 2013-08-30                  │                                                                                                                          
│ Type "notebook()" for the browser-based notebook interface.        │                                                                                                                                                                                                         
│ Type "help()" for help.                                            │                                                                                                                                                                                                         
└────────────────────────────────────────────────────────────────────┘                                                                                                                                                                                                         
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓                                                                                                                                                                                                         
┃ Warning: this is a prerelease version, and it may be unstable.     ┃                                                                                                                                                                                                         
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛                                                                                                                                                                                                         
sage: hg_sage.apply("/home/xyz/trac_14223-fix_3d_aspect_ratio.patch")                                                                                                                                                           
cd "/usr/local/sage-5.12.beta4/devel/sage" && sage --hg import   "/home/tobi/Sync/Projekte/SageDev_linestyle/review_aspect/trac_14223-fix_3d_aspect_ratio.patch"                                                                                                               
applying /home/xyz/trac_14223-fix_3d_aspect_ratio.patch                                                                                                                                                                         
abort: failed to synchronize metadata for "sage/plot/plot3d/base.pyx"                 


```

I somehow still suspect that the problem is on my side. Do you have any Ideas? Or could you check whether you can apply it to 5.12beta4?

Thanks,

Tobi



---

archive/issue_comments_172259.json:
```json
{
    "body": "<a id='comment:10'></a>\nI can apply it to sage-5.12beta4. The aspect ratio comes out correct - see [this plot](http://i.imgur.com/cylVkcR.jpg).\n\nAlso, the patch applies correctly.\n\n```\n...age-5.12.beta4/devel/sage\u00bb ../../sage \n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 5.12.beta4, Release Date: 2013-08-30                  \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: hg_sa\nhg_sage    hg_sagenb  \nsage: hg_sage.apply(\"http://trac.sagemath.org/raw-attachment/ticket/14223/trac_14223-fix_3d_aspect_ratio.patch\")\nAttempting to load remote file: http://trac.sagemath.org/raw-attachment/ticket/14223/trac_14223-fix_3d_aspect_ratio.patch\nLoading: [.]\ncd \"/home/punarbasu/Installations/sage-5.12.beta4/devel/sage\" && sage --hg import   \"/home/punarbasu/.sage/temp/ub2/25836/tmp_uGrWYL.patch\"\napplying /home/punarbasu/.sage/temp/ub2/25836/tmp_uGrWYL.patch\n```",
    "created_at": "2013-09-09T07:41:20Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172259",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:10'></a>
I can apply it to sage-5.12beta4. The aspect ratio comes out correct - see [this plot](http://i.imgur.com/cylVkcR.jpg).

Also, the patch applies correctly.

```
...age-5.12.beta4/devel/sage» ../../sage 
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 5.12.beta4, Release Date: 2013-08-30                  │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: hg_sa
hg_sage    hg_sagenb  
sage: hg_sage.apply("http://trac.sagemath.org/raw-attachment/ticket/14223/trac_14223-fix_3d_aspect_ratio.patch")
Attempting to load remote file: http://trac.sagemath.org/raw-attachment/ticket/14223/trac_14223-fix_3d_aspect_ratio.patch
Loading: [.]
cd "/home/punarbasu/Installations/sage-5.12.beta4/devel/sage" && sage --hg import   "/home/punarbasu/.sage/temp/ub2/25836/tmp_uGrWYL.patch"
applying /home/punarbasu/.sage/temp/ub2/25836/tmp_uGrWYL.patch
```



---

archive/issue_comments_172260.json:
```json
{
    "body": "<a id='comment:11'></a>\nok, this is strange...:\n\nAfter I downloaded the patch once more it applies perfectly to 5.11 and 5.12beta4. Probably there was just an error in the downloaded file. Thanks for your support and sorry that I didn't check this before, but I didn't expect something like this.\n\nI'll now have a closer look at this patch!",
    "created_at": "2013-09-09T08:08:51Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172260",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:11'></a>
ok, this is strange...:

After I downloaded the patch once more it applies perfectly to 5.11 and 5.12beta4. Probably there was just an error in the downloaded file. Thanks for your support and sorry that I didn't check this before, but I didn't expect something like this.

I'll now have a closer look at this patch!



---

archive/issue_comments_172261.json:
```json
{
    "body": "<a id='comment:12'></a>\nHi Basu,\n\nhere my remarks on the patch. It applies perfectly and in almost all cases which I tested it fixes the bug. I only found the following case, where setting the aspect ratio seems still to be ignored:\n\n\n```\nvar('x,y')\nP=plot3d(x^2-9*y^2,(x,-3,3),(y,-1,1))\nP.aspect_ratio((1,1,1))\nP.show()\n```\n\nis different from\n\n```\nvar('x,y')\nP=plot3d(x^2-9*y^2,(x,-3,3),(y,-1,1))\nP.show(aspect_ratio=(1,1,1))\n```\n\nfurthermore I observed that by this patch\n\n```\nP.show(aspect_ratio=(1,2,3))\n```\nchanges the value of\n\n```\nP._aspect_ratio\n```\nand thus also the behaviour in all following show() commands. One can surely discuss if this is usefull or not, but I think in the 2d plots the setting of aspect ration in a show command only affects this plot and not the following. I think the 3d behavior should be consistent.",
    "created_at": "2013-09-12T15:53:36Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172261",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:12'></a>
Hi Basu,

here my remarks on the patch. It applies perfectly and in almost all cases which I tested it fixes the bug. I only found the following case, where setting the aspect ratio seems still to be ignored:


```
var('x,y')
P=plot3d(x^2-9*y^2,(x,-3,3),(y,-1,1))
P.aspect_ratio((1,1,1))
P.show()
```

is different from

```
var('x,y')
P=plot3d(x^2-9*y^2,(x,-3,3),(y,-1,1))
P.show(aspect_ratio=(1,1,1))
```

furthermore I observed that by this patch

```
P.show(aspect_ratio=(1,2,3))
```
changes the value of

```
P._aspect_ratio
```
and thus also the behaviour in all following show() commands. One can surely discuss if this is usefull or not, but I think in the 2d plots the setting of aspect ration in a show command only affects this plot and not the following. I think the 3d behavior should be consistent.



---

archive/issue_events_122846.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/twch",
    "created_at": "2013-09-12T15:54:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122846"
}
```



---

archive/issue_events_122847.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/twch",
    "created_at": "2013-09-12T15:54:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122847"
}
```



---

archive/issue_comments_172262.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks for finding out some bad examples. I will look into fixing these problems sometime next week.",
    "created_at": "2013-09-12T15:59:58Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172262",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:14'></a>
Thanks for finding out some bad examples. I will look into fixing these problems sometime next week.



---

archive/issue_comments_172263.json:
```json
{
    "body": "<a id='comment:15'></a>\nI have tried to address both the concerns. The output should look the same now in all cases.\n\nPatchbot apply trac_14223-fix_3d_aspect_ratio.patch",
    "created_at": "2013-09-22T09:32:45Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172263",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:15'></a>
I have tried to address both the concerns. The output should look the same now in all cases.

Patchbot apply trac_14223-fix_3d_aspect_ratio.patch



---

archive/issue_events_122848.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2013-09-22T09:32:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122848"
}
```



---

archive/issue_events_122849.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2013-09-22T09:32:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122849"
}
```



---

archive/issue_comments_172264.json:
```json
{
    "body": "<a id='comment:16'></a>\nHi!\n\nThanks for fixing these issues. All the problems which I reported above are indeed fixed. \n\nI'm sorry to come up with another one: \n\nThe problem occurs if one has plots, with very different axes scales e.g. \n\n```\nvar('x,y')\nP=plot3d(x^2-100*y^2,(x,-10,10),(y,-1,1))\n```\nWithout the patch the aspect ratio was automatically chosen such that all axes are equally long, if the user didn't set the aspect ratio. Now the aspect is automatically 1 which produces very degenerate plots, where one cannot see much. The user has thus to adjust the ration manually which seems a drawback to me. \n\nAs far as I understand in my limited view the problem is the following:\n\n-the default value of self.aspect_ratio() is (1,1,1)\n-the default show option for aspect ratio is 'automatic'\n-before it has been ignored if self.aspect_ratio() has been set manually and if there was no aspect ratio argument in show(), now the show argument aspect_ratio='automatic' is ignored and instead self.aspect_ratio() is taken. I the user didn't change anything, this is however equal to (1,1,1) and produces a different result. \n\nI'm not sure how to fix this, but here some ideas which might hopefully be helpful. Is it maybe possible, that the default value of self.aspect_ratio() is 'automatic'? Then there would be no degenerate plots if the user doesn't change anything.\nBut even then we would have a problem: If the user sets the aspect by \n`self.aspect_ratio((1,2,3))` \nand later wants a plot with the automatic aspect ratio\n`P.show(aspect_ratio='automatic')`\nthen this would again be ignored. Wouldn't it accordingly be also necessary to set the SHOW_DEFAULT of aspect_ratio to None??? If the show option aspect_ratio is None, we replace it by `self.aspect_ratio()` which is be default \"automatic\". This would allow to distinguish between no user input and the input 'automatic' but still return the automatic aspect_ration if the user does nothing at all.",
    "created_at": "2013-09-24T21:22:17Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172264",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:16'></a>
Hi!

Thanks for fixing these issues. All the problems which I reported above are indeed fixed. 

I'm sorry to come up with another one: 

The problem occurs if one has plots, with very different axes scales e.g. 

```
var('x,y')
P=plot3d(x^2-100*y^2,(x,-10,10),(y,-1,1))
```
Without the patch the aspect ratio was automatically chosen such that all axes are equally long, if the user didn't set the aspect ratio. Now the aspect is automatically 1 which produces very degenerate plots, where one cannot see much. The user has thus to adjust the ration manually which seems a drawback to me. 

As far as I understand in my limited view the problem is the following:

-the default value of self.aspect_ratio() is (1,1,1)
-the default show option for aspect ratio is 'automatic'
-before it has been ignored if self.aspect_ratio() has been set manually and if there was no aspect ratio argument in show(), now the show argument aspect_ratio='automatic' is ignored and instead self.aspect_ratio() is taken. I the user didn't change anything, this is however equal to (1,1,1) and produces a different result. 

I'm not sure how to fix this, but here some ideas which might hopefully be helpful. Is it maybe possible, that the default value of self.aspect_ratio() is 'automatic'? Then there would be no degenerate plots if the user doesn't change anything.
But even then we would have a problem: If the user sets the aspect by 
`self.aspect_ratio((1,2,3))` 
and later wants a plot with the automatic aspect ratio
`P.show(aspect_ratio='automatic')`
then this would again be ignored. Wouldn't it accordingly be also necessary to set the SHOW_DEFAULT of aspect_ratio to None??? If the show option aspect_ratio is None, we replace it by `self.aspect_ratio()` which is be default "automatic". This would allow to distinguish between no user input and the input 'automatic' but still return the automatic aspect_ration if the user does nothing at all.



---

archive/issue_comments_172265.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis is actually a side effect of fixing the problem you mentioned in  [comment:12](#comment%3A12). The frame aspect ratio was being set to `(1, 1, 1)` when aspect ratio was \"automatic\". This resulted in the discrepancy you pointed out. Now the frame aspect ratio is always computed from the aspect ratio as it should be.\n\n\n I can revert the patch back to the previous case while making sure that aspect ratio is not stored when it is passed on to `show().`",
    "created_at": "2013-09-25T00:28:25Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172265",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:17'></a>
This is actually a side effect of fixing the problem you mentioned in  [comment:12](#comment%3A12). The frame aspect ratio was being set to `(1, 1, 1)` when aspect ratio was "automatic". This resulted in the discrepancy you pointed out. Now the frame aspect ratio is always computed from the aspect ratio as it should be.


 I can revert the patch back to the previous case while making sure that aspect ratio is not stored when it is passed on to `show().`



---

archive/issue_comments_172266.json:
```json
{
    "body": "<a id='comment:18'></a>\nWell if it is not easily possible to distinguish whether the aspect ration has been set by the user to (1,1,1) with `{self.aspect_ratio((1,1,1))` or if it is still the default, then I think it is better that the default behavior is, that a reasonable aspect ratio is determined automatically as before. especially with function plots it happens quite often, that the axes have different scales and it is very unconfortable to figure out which aspect ratio is usefull if one just wants a fas glanc at the function.",
    "created_at": "2013-09-25T21:03:09Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172266",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:18'></a>
Well if it is not easily possible to distinguish whether the aspect ration has been set by the user to (1,1,1) with `{self.aspect_ratio((1,1,1))` or if it is still the default, then I think it is better that the default behavior is, that a reasonable aspect ratio is determined automatically as before. especially with function plots it happens quite often, that the axes have different scales and it is very unconfortable to figure out which aspect ratio is usefull if one just wants a fas glanc at the function.



---

archive/attachments_019849.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14223-fix_3d_aspect_ratio.patch",
    "asset_url": "tarball://root/attachments/ticket14223/trac_14223-fix_3d_aspect_ratio.patch",
    "created_at": "2013-09-28T12:24:27Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_172267.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Attachment:** [trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch)\n\nOk. I updated the patch and also fixed this bug:\n\n```\nsage: show(cube(), frame_aspect_ratio=1)\n...\nTypeError: 'sage.rings.integer.Integer' object is not iterable\n```\n\nThe inconsistency in [comment:12](#comment%3A12) remains, but it can not be reliably fixed.\nWe can check for `aspect_ratio=[1.0,1.0,1.0]` in addition to\n`aspect_ratio='automatic'`, but then a small change in `aspect_ratio`, for\nexample, `aspect_ratio=[1.1, 1.0, 1.0]` will again lead to inconsistency in\nthe computation of `frame_aspect_ratio`.\n\nPatchbot apply trac_14223-fix_3d_aspect_ratio.patch",
    "created_at": "2013-09-28T12:24:27Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172267",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:19'></a>
**Attachment:** [trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch)

Ok. I updated the patch and also fixed this bug:

```
sage: show(cube(), frame_aspect_ratio=1)
...
TypeError: 'sage.rings.integer.Integer' object is not iterable
```

The inconsistency in [comment:12](#comment%3A12) remains, but it can not be reliably fixed.
We can check for `aspect_ratio=[1.0,1.0,1.0]` in addition to
`aspect_ratio='automatic'`, but then a small change in `aspect_ratio`, for
example, `aspect_ratio=[1.1, 1.0, 1.0]` will again lead to inconsistency in
the computation of `frame_aspect_ratio`.

Patchbot apply trac_14223-fix_3d_aspect_ratio.patch



---

archive/issue_comments_172268.json:
```json
{
    "body": "<a id='comment:20'></a>\nSorry it took some days until I was able to have a closer look.\n\nEverything except the inconsistency you mention works fine now. Also some other test produced the expected outcome.\n\nAdditionally I was playing Patchbot on my system and tested against 5.12beta3:\n\n-patch applies without errors\n\n-source builds without errors\n\n-patch doesn't provoke any errors for a full doctest\n\n-reference builds without problems and the changes lead to reasonable output\n\nSo there seems no reason not to give a positive review...",
    "created_at": "2013-10-06T11:02:38Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172268",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

<a id='comment:20'></a>
Sorry it took some days until I was able to have a closer look.

Everything except the inconsistency you mention works fine now. Also some other test produced the expected outcome.

Additionally I was playing Patchbot on my system and tested against 5.12beta3:

-patch applies without errors

-source builds without errors

-patch doesn't provoke any errors for a full doctest

-reference builds without problems and the changes lead to reasonable output

So there seems no reason not to give a positive review...



---

archive/issue_events_122850.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/twch",
    "created_at": "2013-10-06T11:03:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122850"
}
```



---

archive/issue_events_122851.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/twch",
    "created_at": "2013-10-06T11:03:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122851"
}
```



---

archive/issue_comments_172269.json:
```json
{
    "body": "**Reviewer:** Tobias Weich",
    "created_at": "2013-10-06T11:03:27Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172269",
    "user": "https://trac.sagemath.org/admin/accounts/users/twch"
}
```

**Reviewer:** Tobias Weich



---

archive/issue_comments_172270.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,4 +9,4 @@\n The attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.\n \n ---\n-Apply [Attachment:trac_14223-fix_3d_aspect_ratio.patch] to devel/sage.\n+Apply [attachment:trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch) to devel/sage.\n``````\n",
    "created_at": "2013-10-06T21:32:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172270",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,4 +9,4 @@
 The attached patch is but a proof-of-concept of solution. I don't know well enough the plot code to see if this is the right thing to do.
 
 ---
-Apply [Attachment:trac_14223-fix_3d_aspect_ratio.patch] to devel/sage.
+Apply [attachment:trac_14223-fix_3d_aspect_ratio.patch](https://github.com/sagemath/sage/files/ticket14223/trac_14223-fix_3d_aspect_ratio.patch) to devel/sage.
``````




---

archive/issue_events_122852.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-12T09:46:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122852"
}
```



---

archive/issue_events_122853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-12T09:46:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14223#event-122853"
}
```



---

archive/issue_comments_172271.json:
```json
{
    "body": "**Merged:** sage-5.13.beta1",
    "created_at": "2013-10-12T09:46:14Z",
    "issue": "https://github.com/sagemath/sage/issues/14223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14223#issuecomment-172271",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.13.beta1
