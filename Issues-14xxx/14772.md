# Issue 14772: Remove CombinatorialClass from Permutations

archive/issues_014568.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-sage-combinat"
    ],
    "body": "Part of #12913.\n\n---\n\nApply: [attachment: trac_14772-remove_cc_permutations-ts.patch](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)\n\nDepends on #8386\nDepends on #14519\nDepends on #14808\nDepends on #14143\nDepends on #14015\nDepends on #14516\nDepends on #14863\n\nCC:  @sagetrac-sage-combinat @zabrocki @sagetrac-alubovsky @nthiery\n\nComponent: **combinatorics**\n\nKeywords: **days49**\n\nAuthor: **Travis Scrimshaw**\n\nReviewer: **Mike Hansen, Darij Grinberg, Jeff Ferreira**\n\nMerged: **sage-5.12.beta3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14772_\n\n",
    "closed_at": "2013-08-20T12:56:23Z",
    "created_at": "2013-06-19T09:22:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove CombinatorialClass from Permutations",
    "type": "issue",
    "updated_at": "2013-08-20T12:56:23Z",
    "url": "https://github.com/sagemath/sage/issues/14772",
    "user": "https://github.com/tscrim"
}
```
Part of #12913.

---

Apply: [attachment: trac_14772-remove_cc_permutations-ts.patch](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)

Depends on #8386
Depends on #14519
Depends on #14808
Depends on #14143
Depends on #14015
Depends on #14516
Depends on #14863

CC:  @sagetrac-sage-combinat @zabrocki @sagetrac-alubovsky @nthiery

Component: **combinatorics**

Keywords: **days49**

Author: **Travis Scrimshaw**

Reviewer: **Mike Hansen, Darij Grinberg, Jeff Ferreira**

Merged: **sage-5.12.beta3**

_Issue created by migration from https://trac.sagemath.org/ticket/14772_





---

archive/issue_events_207819.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-19T09:22:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207819"
}
```



---

archive/issue_events_207820.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-19T09:22:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207820"
}
```



---

archive/issue_events_207821.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-19T09:22:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207821"
}
```



---

archive/issue_events_207822.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-19T09:22:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207822"
}
```



---

archive/issue_events_207823.json:
```json
{
    "actor": "https://github.com/sagetrac-sage-combinat",
    "created_at": "2013-06-19T09:22:52Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "subject": "https://github.com/tscrim",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207823"
}
```



---

archive/issue_comments_180179.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nMinor dependency on #8386 due to use of `Permutation_class`.",
    "created_at": "2013-06-28T16:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180179",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:1" align="right">comment:1</div>

Minor dependency on #8386 due to use of `Permutation_class`.



---

archive/issue_comments_180180.json:
```json
{
    "body": "Dependencies: **#8386**",
    "created_at": "2013-06-28T16:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180180",
    "user": "https://github.com/tscrim"
}
```

Dependencies: **#8386**



---

archive/issue_events_207824.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-28T16:41:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207824"
}
```



---

archive/issue_comments_180181.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLet's try it with #14519 as a dependency.",
    "created_at": "2013-06-30T17:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180181",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

Let's try it with #14519 as a dependency.



---

archive/issue_comments_180182.json:
```json
{
    "body": "Changed dependencies from **#8386** to **#8386 #14519**",
    "created_at": "2013-06-30T17:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180182",
    "user": "https://github.com/tscrim"
}
```

Changed dependencies from **#8386** to **#8386 #14519**



---

archive/issue_comments_180183.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nLooks good to me.  The main issue is that there are two classcall_private methods with out tests; however, they are tested in the the doctest for init.  I don't think it makes sense to duplicate the tests.  Maybe just a note that it is tested via the init doctests?",
    "created_at": "2013-07-01T12:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180183",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:3" align="right">comment:3</div>

Looks good to me.  The main issue is that there are two classcall_private methods with out tests; however, they are tested in the the doctest for init.  I don't think it makes sense to duplicate the tests.  Maybe just a note that it is tested via the init doctests?



---

archive/issue_comments_180184.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI added some (simple) doctests to the `__classcall_private__()` functions.",
    "created_at": "2013-07-01T13:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180184",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

I added some (simple) doctests to the `__classcall_private__()` functions.



---

archive/issue_comments_180185.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAll doctest errors should be fixed now.",
    "created_at": "2013-07-12T05:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180185",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

All doctest errors should be fixed now.



---

archive/issue_comments_180186.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis conflicts with #14808 again. Travis, could you update #14808 please? Thank you.",
    "created_at": "2013-07-12T17:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180186",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:8" align="right">comment:8</div>

This conflicts with #14808 again. Travis, could you update #14808 please? Thank you.



---

archive/issue_comments_180187.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI put this over #14808, so I'm putting that as a dependency now.",
    "created_at": "2013-07-12T19:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180187",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">comment:9</div>

I put this over #14808, so I'm putting that as a dependency now.



---

archive/issue_comments_180188.json:
```json
{
    "body": "Changed dependencies from **#8386 #14519** to **#8386 #14519 #14808**",
    "created_at": "2013-07-12T19:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180188",
    "user": "https://github.com/tscrim"
}
```

Changed dependencies from **#8386 #14519** to **#8386 #14519 #14808**



---

archive/issue_comments_180189.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIt'll probably need some rebase, though.",
    "created_at": "2013-07-12T19:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180189",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:10" align="right">comment:10</div>

It'll probably need some rebase, though.



---

archive/issue_comments_180190.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI already had #14808 applied in the combinat queue, so it shouldn't need rebasing.",
    "created_at": "2013-07-12T19:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180190",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

I already had #14808 applied in the combinat queue, so it shouldn't need rebasing.



---

archive/issue_comments_180191.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOOPS, you're right. Sorry; I had an obsolete patch in my .hg/patches folder.",
    "created_at": "2013-07-12T19:54:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180191",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:12" align="right">comment:12</div>

OOPS, you're right. Sorry; I had an obsolete patch in my .hg/patches folder.



---

archive/issue_comments_180192.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nBut the `number_of_inversions(self)` docstring is still unfixed, or am I totally wrong about it?",
    "created_at": "2013-07-12T20:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180192",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:13" align="right">comment:13</div>

But the `number_of_inversions(self)` docstring is still unfixed, or am I totally wrong about it?



---

archive/issue_comments_180193.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n\n```diff\n@@ -1542,10 +1561,10 @@ class Permutation_class(CombinatorialObj\n \n     def number_of_inversions(self):\n         r\"\"\"\n-        Returns the number of inversions in the permutation p.\n-\n-        An inversion of a permutation is a pair of elements (p[i],p[j])\n-        with i < j and p[i] > p[j].\n+        Return the number of inversions in ``self``.\n+\n+        An inversion of a permutation is a pair of elements `(p_i,p_j)`\n+        with `i < j` and `p_i > p_j`.\n \n         REFERENCES:\n \n```",
    "created_at": "2013-07-13T04:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180193",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>


```diff
@@ -1542,10 +1561,10 @@ class Permutation_class(CombinatorialObj
 
     def number_of_inversions(self):
         r"""
-        Returns the number of inversions in the permutation p.
-
-        An inversion of a permutation is a pair of elements (p[i],p[j])
-        with i < j and p[i] > p[j].
+        Return the number of inversions in ``self``.
+
+        An inversion of a permutation is a pair of elements `(p_i,p_j)`
+        with `i < j` and `p_i > p_j`.
 
         REFERENCES:
 
```



---

archive/issue_comments_180194.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI wasn't speaking about the syntax. It should say \"a pair of elements `(i, j)`\", not \"a pair of elements `(p_i, p_j)`\", so as not to confuse the reader about the output of the `inversions()` method.",
    "created_at": "2013-07-13T08:30:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180194",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:15" align="right">comment:15</div>

I wasn't speaking about the syntax. It should say "a pair of elements `(i, j)`", not "a pair of elements `(p_i, p_j)`", so as not to confuse the reader about the output of the `inversions()` method.



---

archive/issue_comments_180195.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAh. Fixed. I also added some latex options for permutations and being able to display them as words (which is how I generally look at them, transpositions on positions). I made some other minor changes to other docstrings I noticed, so I apologize in advance if you have to rebase.",
    "created_at": "2013-07-13T10:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180195",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Ah. Fixed. I also added some latex options for permutations and being able to display them as words (which is how I generally look at them, transpositions on positions). I made some other minor changes to other docstrings I noticed, so I apologize in advance if you have to rebase.



---

archive/issue_comments_180196.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWith the following patches applied on `5.11.beta3`\n\n```\ntscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -hg qapplied\ntrac_14610-LSenergy-ms.patch\ntrac9107_nesting_nested_classes.patch\ntrac_9107_fix_cross_reference.patch\ntrac_13589-categories-c3_under_control-nt.patch\ntrac_14714_latex_dyckword_fix.patch\ntrac_14748_deprecationwarning.patch\ntrac_14748_doctest.patch\ntrac_14748-review-ts.patch\ntrac_14787-gyw_stats-bs.patch\ntrac_14762-fix_ASM_ne-ts.patch\ntrac_12940_affine_permutations-td.patch\ntrac_14573-path_realizations-ts.patch\ntrac_14507-tropical_semiring-ts.patch\ntrac_11407-list_clone_improve-fh.patch\ntrac_14516-crystals_speedup-ts.patch\ntrac_7983-major_index_and_other_tableau_fixes-dg.patch\ntrac_7983-review-ts.patch\ntrac_12882-matrix_as_dynkin_diagram-ts.patch\ntrac_14722-lazy_import_at_startup-nt.patch\ntrac_8386_really_just_moving-fc.patch\ntrac_8386_big_clean_fc.patch\ntrac_8386_assert_removal.patch\ntrac_14808-recoils_of_permutations-ts.patch\ntrac_10630-vector_partition-ap.patch\ntrac_14870-fix_int_mod_QQ-ts.patch\ntrac_14882-backtrack_longtime-dg.patch\ntrac_14469_repr_graphics.patch\ntrac_14519-cynthonize_element_wrapper-ts.patch\ntrac_12250-ktableaux-as.patch\ntrac_14776-strong-ktableaux-mz.patch\ntrac_14772-remove_cc_permutations-ts.patch\n```\nI cannot reproduce the doctest failure from the patchbot\n\n```\ntscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -tp --long combinat.py\nRunning doctests with ID 2013-07-13-19-05-23-2a0e8ee8.\nDoctesting 1 file using 2 threads.\nsage -t --long combinat.py\n    [428 tests, 6.61 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 6.9 seconds\n    cpu time: 2.4 seconds\n    cumulative wall time: 6.6 seconds\n```\nOnly #12250 and #14476 do not have a positive review and this commutes with those patches. So I don't know why that doctest is failing for the patchbot...",
    "created_at": "2013-07-13T13:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180196",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

With the following patches applied on `5.11.beta3`

```
tscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -hg qapplied
trac_14610-LSenergy-ms.patch
trac9107_nesting_nested_classes.patch
trac_9107_fix_cross_reference.patch
trac_13589-categories-c3_under_control-nt.patch
trac_14714_latex_dyckword_fix.patch
trac_14748_deprecationwarning.patch
trac_14748_doctest.patch
trac_14748-review-ts.patch
trac_14787-gyw_stats-bs.patch
trac_14762-fix_ASM_ne-ts.patch
trac_12940_affine_permutations-td.patch
trac_14573-path_realizations-ts.patch
trac_14507-tropical_semiring-ts.patch
trac_11407-list_clone_improve-fh.patch
trac_14516-crystals_speedup-ts.patch
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_7983-review-ts.patch
trac_12882-matrix_as_dynkin_diagram-ts.patch
trac_14722-lazy_import_at_startup-nt.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14808-recoils_of_permutations-ts.patch
trac_10630-vector_partition-ap.patch
trac_14870-fix_int_mod_QQ-ts.patch
trac_14882-backtrack_longtime-dg.patch
trac_14469_repr_graphics.patch
trac_14519-cynthonize_element_wrapper-ts.patch
trac_12250-ktableaux-as.patch
trac_14776-strong-ktableaux-mz.patch
trac_14772-remove_cc_permutations-ts.patch
```
I cannot reproduce the doctest failure from the patchbot

```
tscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -tp --long combinat.py
Running doctests with ID 2013-07-13-19-05-23-2a0e8ee8.
Doctesting 1 file using 2 threads.
sage -t --long combinat.py
    [428 tests, 6.61 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.9 seconds
    cpu time: 2.4 seconds
    cumulative wall time: 6.6 seconds
```
Only #12250 and #14476 do not have a positive review and this commutes with those patches. So I don't know why that doctest is failing for the patchbot...



---

archive/issue_comments_180197.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nLooks like MRO. The class Arrangements inherits from Permutations. Permutations of a multiset have their own cardinality() method, which gives the (wrong) 1260 answer in this case. The correct 22 answer is obtained by the standard cardinality() method of FiniteEnumeratedSets (?) which just takes the length of the list().",
    "created_at": "2013-07-13T13:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180197",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:18" align="right">comment:18</div>

Looks like MRO. The class Arrangements inherits from Permutations. Permutations of a multiset have their own cardinality() method, which gives the (wrong) 1260 answer in this case. The correct 22 answer is obtained by the standard cardinality() method of FiniteEnumeratedSets (?) which just takes the length of the list().



---

archive/issue_comments_180198.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nStrange that it wasn't showing up when I was running my doctests (although it did appear when I did it in sage). Typically I get the other behavior. Fixed. Thank Darij.",
    "created_at": "2013-07-14T04:07:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180198",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Strange that it wasn't showing up when I was running my doctests (although it did appear when I did it in sage). Typically I get the other behavior. Fixed. Thank Darij.



---

archive/issue_comments_180199.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nMike, do you think you could do a re-review of this patch? Thanks.",
    "created_at": "2013-07-16T10:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180199",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Mike, do you think you could do a re-review of this patch? Thanks.



---

archive/issue_comments_180200.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nDarij, since Mike hasn't responding, do you think you could do the final review of this patch? Thanks.",
    "created_at": "2013-07-18T03:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180200",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

Darij, since Mike hasn't responding, do you think you could do the final review of this patch? Thanks.



---

archive/issue_comments_180201.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI've started the review -- but I'm stuck at `PermutationOptions` now. You have these doctests:\n\n```\n    EXAMPLES::\n    \n        sage: p213 = Permutation([2,1,3])\n        sage: p312 = Permutation([3,1,2])\n        sage: PermutationOptions(mult='l2r', display='list')\n        sage: po = PermutationOptions()\n        sage: po['display']\n        'list'\n        sage: p213\n        [2, 1, 3]\n        sage: PermutationOptions(display='cycle')\n        sage: p213\n        (1,2)\n        sage: PermutationOptions(display='singleton')\n        sage: p213\n        (1,2)(3)\n        sage: PermutationOptions(display='list')\n```\n\nBut when I try to run them ingame, they don't behave that nicely:\n\n```\nsage:         sage: p213 = Permutation([2,1,3])\nsage:         sage: p312 = Permutation([3,1,2])\nsage:         sage: PermutationOptions(mult='l2r', display='list')\nsage:         sage: po = PermutationOptions()\nCurrent options for permutations\n  - display:        list\n  - generator_name: s\n  - latex:          list\n  - mult:           l2r\nsage:         sage: po['display']\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-49-b0a2d723e60c> in <module>()\n----> 1 po['display']\n\nTypeError: 'NoneType' object has no attribute '__getitem__'\n```\n\nI have a feeling that they are not recognized as doctests due to the weird place they're in... And I don't know what to do about this.",
    "created_at": "2013-07-19T01:42:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180201",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:22" align="right">comment:22</div>

I've started the review -- but I'm stuck at `PermutationOptions` now. You have these doctests:

```
    EXAMPLES::
    
        sage: p213 = Permutation([2,1,3])
        sage: p312 = Permutation([3,1,2])
        sage: PermutationOptions(mult='l2r', display='list')
        sage: po = PermutationOptions()
        sage: po['display']
        'list'
        sage: p213
        [2, 1, 3]
        sage: PermutationOptions(display='cycle')
        sage: p213
        (1,2)
        sage: PermutationOptions(display='singleton')
        sage: p213
        (1,2)(3)
        sage: PermutationOptions(display='list')
```

But when I try to run them ingame, they don't behave that nicely:

```
sage:         sage: p213 = Permutation([2,1,3])
sage:         sage: p312 = Permutation([3,1,2])
sage:         sage: PermutationOptions(mult='l2r', display='list')
sage:         sage: po = PermutationOptions()
Current options for permutations
  - display:        list
  - generator_name: s
  - latex:          list
  - mult:           l2r
sage:         sage: po['display']
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-49-b0a2d723e60c> in <module>()
----> 1 po['display']

TypeError: 'NoneType' object has no attribute '__getitem__'
```

I have a feeling that they are not recognized as doctests due to the weird place they're in... And I don't know what to do about this.



---

archive/issue_comments_180202.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAck...I forgot to check the global options tests. That syntax is from the old sytle, it should be ``Permutations.global_options``. I'll fix them.\n\nYou're also correct in that the doctest framework does not pick up dynamically created docstrings (unfortunately).\n\nThanks,\n\nTravis",
    "created_at": "2013-07-19T03:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180202",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Ack...I forgot to check the global options tests. That syntax is from the old sytle, it should be ``Permutations.global_options``. I'll fix them.

You're also correct in that the doctest framework does not pick up dynamically created docstrings (unfortunately).

Thanks,

Travis



---

archive/issue_comments_180203.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI've made the fixes, but I can't upload it due to the filesize (the limit has been lowered to 256kB on the new server). I've asked Andrew Ohana to see if he can raise that limit a bit. If not, I'll split the patch and reupload.\n\nBest,\n\nTravis",
    "created_at": "2013-07-19T03:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180203",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

I've made the fixes, but I can't upload it due to the filesize (the limit has been lowered to 256kB on the new server). I've asked Andrew Ohana to see if he can raise that limit a bit. If not, I'll split the patch and reupload.

Best,

Travis



---

archive/issue_comments_180204.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOkay, here's the new version.",
    "created_at": "2013-07-19T04:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180204",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">comment:25</div>

Okay, here's the new version.



---

archive/issue_comments_180205.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nIn case noone disagrees, I'll remove the \"like composition of functions\" from this:\n\n```\n  * \"l2r\" -- left to right like composition of functions (p_1  *\n    p_2)(x) = p_2(p_1(x))\n```\nbecause it's extremely misleading. Of course, the whole idea of global variables for this is bad, but that's for a later ticket.",
    "created_at": "2013-07-19T11:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180205",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:26" align="right">comment:26</div>

In case noone disagrees, I'll remove the "like composition of functions" from this:

```
  * "l2r" -- left to right like composition of functions (p_1  *
    p_2)(x) = p_2(p_1(x))
```
because it's extremely misleading. Of course, the whole idea of global variables for this is bad, but that's for a later ticket.



---

archive/issue_comments_180206.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nSorry for the spam but I'll be updating this thread with anything potentially controversial I'm doing in my review patch.\n\nThe latex method for permutations in reduced-word notation returns an empty string when the permutation is id. I'll replace this by a \"1\".",
    "created_at": "2013-07-19T11:43:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180206",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:27" align="right">comment:27</div>

Sorry for the spam but I'll be updating this thread with anything potentially controversial I'm doing in my review patch.

The latex method for permutations in reduced-word notation returns an empty string when the permutation is id. I'll replace this by a "1".



---

archive/issue_comments_180207.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nHow about 'e' or the empty set instead as to avoid potential conflicts? Or better yet, add a global option about that.",
    "created_at": "2013-07-19T11:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180207",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

How about 'e' or the empty set instead as to avoid potential conflicts? Or better yet, add a global option about that.



---

archive/issue_comments_180208.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nYou mean an additional one, or allow several different values for the \"latex\" option?\n\n(On another note: You have changed a \"spam.eggs.blah.method(x)\" pattern to \"from spam.eggs.blah import method; method(x)\" pattern several times; is that an example I should follow in my code?)",
    "created_at": "2013-07-19T11:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180208",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:29" align="right">comment:29</div>

You mean an additional one, or allow several different values for the "latex" option?

(On another note: You have changed a "spam.eggs.blah.method(x)" pattern to "from spam.eggs.blah import method; method(x)" pattern several times; is that an example I should follow in my code?)



---

archive/issue_comments_180209.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI mean add 1 additional global option of the form `latex_identity_word` which will follow the `latex_diagram_str` global option in `partition.py`.\n\n(I think this pattern leads to more readable code; although it seems to make circular imports more prone to breaking.)",
    "created_at": "2013-07-19T11:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180209",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

I mean add 1 additional global option of the form `latex_identity_word` which will follow the `latex_diagram_str` global option in `partition.py`.

(I think this pattern leads to more readable code; although it seems to make circular imports more prone to breaking.)



---

archive/issue_comments_180210.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI've done that change -- feel free to comment.\n\nIn other news, Sage doesn't consider the empty permutation to avoid `[1]`. Do we consider this a bug? (The chances of being bitten by this are nigh 0.)",
    "created_at": "2013-07-19T14:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180210",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:31" align="right">comment:31</div>

I've done that change -- feel free to comment.

In other news, Sage doesn't consider the empty permutation to avoid `[1]`. Do we consider this a bug? (The chances of being bitten by this are nigh 0.)



---

archive/issue_comments_180211.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHi Darij,  Can you clarify what you mean?  `Permutation([]).avoids([1])` returns `True` for me.  If that were not the case, I would consider that a bug.",
    "created_at": "2013-07-19T14:16:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180211",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:32" align="right">comment:32</div>

Hi Darij,  Can you clarify what you mean?  `Permutation([]).avoids([1])` returns `True` for me.  If that were not the case, I would consider that a bug.



---

archive/issue_comments_180212.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOh, but:\n\n```\nsage: Permutations(0, avoiding=[1]).list()\n[]\nsage: Permutations(0, avoiding=[1,2]).list()\n[[]]\nsage: Permutations(0, avoiding=[1,2,3,4,5]).list()\n#doesn't terminate\n```\nI guess this is a backtrack.py issue...",
    "created_at": "2013-07-19T14:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180212",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:33" align="right">comment:33</div>

Oh, but:

```
sage: Permutations(0, avoiding=[1]).list()
[]
sage: Permutations(0, avoiding=[1,2]).list()
[[]]
sage: Permutations(0, avoiding=[1,2,3,4,5]).list()
#doesn't terminate
```
I guess this is a backtrack.py issue...



---

archive/issue_comments_180213.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nShould I fix this bug:\n\n```\nsage: S = Permutations(['c','a'])\nsage: elt = S(['c','c','c'])\nsage: elt in S\nTrue\n```\n\nor is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?",
    "created_at": "2013-07-19T14:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180213",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:34" align="right">comment:34</div>

Should I fix this bug:

```
sage: S = Permutations(['c','a'])
sage: elt = S(['c','c','c'])
sage: elt in S
True
```

or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?



---

archive/issue_comments_180214.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@darijgr](#comment%3A34):\n> Should I fix this bug:\n> \n> ```\n> sage: S = Permutations(['c','a'])\n> sage: elt = S(['c','c','c'])\n> sage: elt in S\n> True\n> ```\n> \n> or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?\n\nI think it should be fixed. I suspect it's something I introduced... (especially in that case)\n\nI also can't reproduce the avoidance part:\n\n```\nsage: [] in Permutations(0, avoiding=[1])\nTrue\nsage: [] in Permutations(avoiding=[1])   \nTrue\n```\nbut the backtrack error is something that should be fixed. I'll see if I can do it in a few lines, otherwise I'll say push it to another ticket.",
    "created_at": "2013-07-19T14:45:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180214",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@darijgr](#comment%3A34):
> Should I fix this bug:
> 
> ```
> sage: S = Permutations(['c','a'])
> sage: elt = S(['c','c','c'])
> sage: elt in S
> True
> ```
> 
> or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?

I think it should be fixed. I suspect it's something I introduced... (especially in that case)

I also can't reproduce the avoidance part:

```
sage: [] in Permutations(0, avoiding=[1])
True
sage: [] in Permutations(avoiding=[1])   
True
```
but the backtrack error is something that should be fixed. I'll see if I can do it in a few lines, otherwise I'll say push it to another ticket.



---

archive/issue_comments_180215.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI tried this change to the `check` element method of class `Permutations_set`:\n\n```\n@@ -3845,10 +3879,20 @@ class Permutations_mset(Permutations):\n                 sage: S = Permutations(['c','a','c'])\n                 sage: elt = S(['c','c','a'])\n                 sage: elt.check()\n+                sage: elt2 = S(['c','c','c'])\n+                Traceback (most recent call last):\n+                ...\n+                ValueError: Invalid permutation\n             \"\"\"\n             mset = self.parent().mset\n+            selfdict = {}\n             for val in self:\n-                if val not in mset:\n+                if val in selfdict:\n+                    selfdict[val] += 1\n+                else:\n+                    selfdict[val] = 1\n+            for (val, mult) in selfdict.items():\n+                if mult != mset.count(val):\n                     raise ValueError(\"Invalid permutation\")\n \n     def _repr_(self):\n```\n\nBut this breaks various doctests since apparently the same `check` method is used for permutations of length k. I have reverted that change for now.\n\nIf you ask me, it is a stupid idea to have permutations of length k inherit from permutations anyway...",
    "created_at": "2013-07-19T15:04:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180215",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:36" align="right">comment:36</div>

I tried this change to the `check` element method of class `Permutations_set`:

```
@@ -3845,10 +3879,20 @@ class Permutations_mset(Permutations):
                 sage: S = Permutations(['c','a','c'])
                 sage: elt = S(['c','c','a'])
                 sage: elt.check()
+                sage: elt2 = S(['c','c','c'])
+                Traceback (most recent call last):
+                ...
+                ValueError: Invalid permutation
             """
             mset = self.parent().mset
+            selfdict = {}
             for val in self:
-                if val not in mset:
+                if val in selfdict:
+                    selfdict[val] += 1
+                else:
+                    selfdict[val] = 1
+            for (val, mult) in selfdict.items():
+                if mult != mset.count(val):
                     raise ValueError("Invalid permutation")
 
     def _repr_(self):
```

But this breaks various doctests since apparently the same `check` method is used for permutations of length k. I have reverted that change for now.

If you ask me, it is a stupid idea to have permutations of length k inherit from permutations anyway...



---

archive/issue_comments_180216.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n`Permutations` is suppose to be a common abstract base class for all permutations (in some way it models the category of all types of permutations), so having permutations of length k inherit from it makes sense. However I think we need to implement a stronger `__contains__()` for the non-standard permutations, perhaps a stupid `return x in list(self)` (which, somewhat surprisingly to me, the category of `FiniteEnumeratedSets` does not provide by default).\n\nAlso, to fix the backtracker issue, what needs to be done is some simple corner case checking in the `__iter__` methods for `n == 0`. Only if `n > 0` do you call `PatternAvoider`.\n\nBest,\n\nTravis",
    "created_at": "2013-07-19T16:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180216",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

`Permutations` is suppose to be a common abstract base class for all permutations (in some way it models the category of all types of permutations), so having permutations of length k inherit from it makes sense. However I think we need to implement a stronger `__contains__()` for the non-standard permutations, perhaps a stupid `return x in list(self)` (which, somewhat surprisingly to me, the category of `FiniteEnumeratedSets` does not provide by default).

Also, to fix the backtracker issue, what needs to be done is some simple corner case checking in the `__iter__` methods for `n == 0`. Only if `n > 0` do you call `PatternAvoider`.

Best,

Travis



---

archive/issue_comments_180217.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI'm getting `SyntaxError: 'return' with argument inside generator` when I try to fix this. Can you fix that one?",
    "created_at": "2013-07-19T16:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180217",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:38" align="right">comment:38</div>

I'm getting `SyntaxError: 'return' with argument inside generator` when I try to fix this. Can you fix that one?



---

archive/issue_comments_180218.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n(The review patch I just uploaded includes this error -- feel free to directly edit my review patch rather than your base patch. Maybe you could fix your multiset permutation bug while we're at that, or shadow the `__check__` method in the appropriate classes so that my fix won't break other things. I hate to admit but I still don't see through the logic of the various classes defined in permutation.py. I'd also love it if you could sketch what changes you have made to the structure; the .patch file is mostly unreadable due to a bad diff encoding algorithm.)\n\nI won't return to this ticket in the next 3 or so hours.)",
    "created_at": "2013-07-19T16:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180218",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:39" align="right">comment:39</div>

(The review patch I just uploaded includes this error -- feel free to directly edit my review patch rather than your base patch. Maybe you could fix your multiset permutation bug while we're at that, or shadow the `__check__` method in the appropriate classes so that my fix won't break other things. I hate to admit but I still don't see through the logic of the various classes defined in permutation.py. I'd also love it if you could sketch what changes you have made to the structure; the .patch file is mostly unreadable due to a bad diff encoding algorithm.)

I won't return to this ticket in the next 3 or so hours.)



---

archive/issue_comments_180219.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI can't reupload over your review patch. Is it okay if I just fold it in to the main one?",
    "created_at": "2013-07-19T16:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180219",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:40" align="right">comment:40</div>

I can't reupload over your review patch. Is it okay if I just fold it in to the main one?



---

archive/issue_comments_180220.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nYes, that's OK (as long as you look over my review patch, too -- there are some things in it that might need reviewing, in turn). Thanks a lot!\n\n(The code I commented out -- `#l[pos_im1] = i-1` and similar -- was just doing nothing.)",
    "created_at": "2013-07-19T16:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180220",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:41" align="right">comment:41</div>

Yes, that's OK (as long as you look over my review patch, too -- there are some things in it that might need reviewing, in turn). Thanks a lot!

(The code I commented out -- `#l[pos_im1] = i-1` and similar -- was just doing nothing.)



---

archive/issue_comments_180221.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI hacked around it:\n\n```\nif n > 0:\n    return iter(PatternAvoider(self, self._p))\nreturn iter([self.element_class(self, [])])\n```\nit's a python issue that putting a yield in the function makes it into a generator, which can't return anything at all, including iterators. This makes sense because python a priori doesn't know that it will be an iterator; plus the can of worms whether it should continue the iteration from that point with that iterator.\n\nAll combined and back to you Darij.",
    "created_at": "2013-07-19T16:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180221",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

I hacked around it:

```
if n > 0:
    return iter(PatternAvoider(self, self._p))
return iter([self.element_class(self, [])])
```
it's a python issue that putting a yield in the function makes it into a generator, which can't return anything at all, including iterators. This makes sense because python a priori doesn't know that it will be an iterator; plus the can of worms whether it should continue the iteration from that point with that iterator.

All combined and back to you Darij.



---

archive/issue_comments_180222.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n Part of #12913.\n+\n+---\n+\n+Apply: [attachment: trac_14772-remove_cc_permutations-ts.patch](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)\n``````\n",
    "created_at": "2013-07-19T16:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180222",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
 Part of #12913.
+
+---
+
+Apply: [attachment: trac_14772-remove_cc_permutations-ts.patch](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)
``````




---

archive/issue_comments_180223.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-07-19T16:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180223",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_180224.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nGreat!\n\nI'll look into the multisets issue, but as for now here is a fix for another bug:\n\n```\nsage: Permutations(descents=[1,3,4]).list()\n```\ngave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the \"correct\" n would be the maximum entry of the list `[1, 3, 4]` plus 2. I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.\n\nWould you agree with axing the syntax?",
    "created_at": "2013-07-19T17:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180224",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:44" align="right">comment:44</div>

Great!

I'll look into the multisets issue, but as for now here is a fix for another bug:

```
sage: Permutations(descents=[1,3,4]).list()
```
gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the "correct" n would be the maximum entry of the list `[1, 3, 4]` plus 2. I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.

Would you agree with axing the syntax?



---

archive/issue_comments_180225.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI'm going out for a walk, but here is a fix for the overly liberal check() method of multiset/set permutations. I have relegated the checking to `__contains__`; is that OK in terms of coding style?\n\nNote that I have not tested for speed regressions. I fear there might be some.\n\nAlso, am I seeing it right that `Permutations_set` doesn't inherit from `Permutations_mset`? Is that an issue?",
    "created_at": "2013-07-19T18:06:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180225",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:45" align="right">comment:45</div>

I'm going out for a walk, but here is a fix for the overly liberal check() method of multiset/set permutations. I have relegated the checking to `__contains__`; is that OK in terms of coding style?

Note that I have not tested for speed regressions. I fear there might be some.

Also, am I seeing it right that `Permutations_set` doesn't inherit from `Permutations_mset`? Is that an issue?



---

archive/issue_comments_180226.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@darijgr](#comment%3A44):\n> Great!\n> \n> I'll look into the multisets issue, but as for now here is a fix for another bug:\n> \n> ```\n> sage: Permutations(descents=[1,3,4]).list()\n> ```\n> gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the \"correct\" n would be the maximum entry of the list `[1, 3, 4]` plus 2.\n\nMmmmm...zero based indexing errors. I completely forgot to fix the containment issue when folding in the review patch. Sorry.\n\n> I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.\n\nI wouldn't think it would be able to handle the descents composition (even without considering the doc which explicitly states this).\n\n> \n> Would you agree with axing the syntax?\n\n I'm not opposed to deprecating that form of input (it's not syntax strictly speaking), so if `descents` is passed in and no `n`, then it raises a deprecation warning.\n\nI'll be going to sleep now (I'm in India in case you're curious), so you won't get a reply for at least 8 hours from me. Although at this rate I think there won't be a single bug left anywhere near permutations. XP\n\nThanks,\n\nTravis",
    "created_at": "2013-07-19T18:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180226",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@darijgr](#comment%3A44):
> Great!
> 
> I'll look into the multisets issue, but as for now here is a fix for another bug:
> 
> ```
> sage: Permutations(descents=[1,3,4]).list()
> ```
> gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the "correct" n would be the maximum entry of the list `[1, 3, 4]` plus 2.

Mmmmm...zero based indexing errors. I completely forgot to fix the containment issue when folding in the review patch. Sorry.

> I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.

I wouldn't think it would be able to handle the descents composition (even without considering the doc which explicitly states this).

> 
> Would you agree with axing the syntax?

 I'm not opposed to deprecating that form of input (it's not syntax strictly speaking), so if `descents` is passed in and no `n`, then it raises a deprecation warning.

I'll be going to sleep now (I'm in India in case you're curious), so you won't get a reply for at least 8 hours from me. Although at this rate I think there won't be a single bug left anywhere near permutations. XP

Thanks,

Travis



---

archive/issue_comments_180227.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI've deprecated it now -- but I still wouldn't mind seeing this way of generating permutations removed, seeing that before my fix today it would raise errors the first time one would try to do anything with it (unless the descents list was set to be the empty list)...\n\nAnyway, on to the more interesting parts of the file.",
    "created_at": "2013-07-19T21:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180227",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:47" align="right">comment:47</div>

I've deprecated it now -- but I still wouldn't mind seeing this way of generating permutations removed, seeing that before my fix today it would raise errors the first time one would try to do anything with it (unless the descents list was set to be the empty list)...

Anyway, on to the more interesting parts of the file.



---

archive/issue_comments_180228.json:
```json
{
    "body": "review patch. finished!",
    "created_at": "2013-07-19T23:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180228",
    "user": "https://github.com/darijgr"
}
```

review patch. finished!



---

archive/issue_comments_180229.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nAttachment: **[trac_14772-review-dg.patch.gz](https://github.com/sagemath/sage/files/ticket14772/trac_14772-review-dg.patch.gz)**\n\nI've done the part of the review I think I was competent enough for. Not covered are:\n\n-- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.\n\n-- Same for `__setstate__`.\n\n-- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).\n\n-- A docstring says that `__call__` is a close variant of `__call__`:\n\n```\n    def __call__(self, x):\n        \"\"\"\n        A close variant of ``__call__`` which just attempts to extend\n        the permutation.\n```\nThis used to be:\n\n```\n    def __call__(self, x):\n        \"\"\"\n        A close variant of CombinatorialClass.__call__ which just\n        attempts to extend the permutation\n```\nSince you probably understand this better than I do, it's best if you fix this docstring.\n\n-- Speed might be worth testing after I added those `__contains__`es.\n\nAltogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!\n\nFinally, an observation I wish I had made earlier: kdiff3 is much better at deltaing your changes than mercurial...",
    "created_at": "2013-07-19T23:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180229",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:48" align="right">comment:48</div>

Attachment: **[trac_14772-review-dg.patch.gz](https://github.com/sagemath/sage/files/ticket14772/trac_14772-review-dg.patch.gz)**

I've done the part of the review I think I was competent enough for. Not covered are:

-- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.

-- Same for `__setstate__`.

-- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).

-- A docstring says that `__call__` is a close variant of `__call__`:

```
    def __call__(self, x):
        """
        A close variant of ``__call__`` which just attempts to extend
        the permutation.
```
This used to be:

```
    def __call__(self, x):
        """
        A close variant of CombinatorialClass.__call__ which just
        attempts to extend the permutation
```
Since you probably understand this better than I do, it's best if you fix this docstring.

-- Speed might be worth testing after I added those `__contains__`es.

Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!

Finally, an observation I wish I had made earlier: kdiff3 is much better at deltaing your changes than mercurial...



---

archive/issue_comments_180230.json:
```json
{
    "body": "Reviewer: **Mike Hansen, Darij Grinberg**",
    "created_at": "2013-07-20T04:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180230",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Mike Hansen, Darij Grinberg**



---

archive/issue_events_207825.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-07-20T04:59:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207825"
}
```



---

archive/issue_events_207826.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-07-20T04:59:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207826"
}
```



---

archive/issue_comments_180231.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@darijgr](#comment%3A48):\n> I've done the part of the review I think I was competent enough for. Not covered are:\n> \n> -- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.\n\nWhen doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.\n\n> -- Same for `__setstate__`.\n\nIt's used in pickling. This is called when something is trying to be unpickled, ex. `loads(dumps(obj))`.\n\n> -- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).\n\nI can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.\n\n> -- A docstring says that `__call__` is a close variant of `__call__`:\n> \n> ```\n>     def __call__(self, x):\n>         \"\"\"\n>         A close variant of ``__call__`` which just attempts to extend\n>         the permutation.\n> ```\n> This used to be:\n> \n> ```\n>     def __call__(self, x):\n>         \"\"\"\n>         A close variant of CombinatorialClass.__call__ which just\n>         attempts to extend the permutation\n> ```\n> Since you probably understand this better than I do, it's best if you fix this docstring.\n\nI've tweaked the docstring a bit so that it's more clear.\n\n> -- Speed might be worth testing after I added those `__contains__`es.\n\nSeems okay to me. It's better that it's done correctly anyways.\n\n> Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!\n\nThank you Darij!",
    "created_at": "2013-07-20T04:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180231",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@darijgr](#comment%3A48):
> I've done the part of the review I think I was competent enough for. Not covered are:
> 
> -- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.

When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.

> -- Same for `__setstate__`.

It's used in pickling. This is called when something is trying to be unpickled, ex. `loads(dumps(obj))`.

> -- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).

I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.

> -- A docstring says that `__call__` is a close variant of `__call__`:
> 
> ```
>     def __call__(self, x):
>         """
>         A close variant of ``__call__`` which just attempts to extend
>         the permutation.
> ```
> This used to be:
> 
> ```
>     def __call__(self, x):
>         """
>         A close variant of CombinatorialClass.__call__ which just
>         attempts to extend the permutation
> ```
> Since you probably understand this better than I do, it's best if you fix this docstring.

I've tweaked the docstring a bit so that it's more clear.

> -- Speed might be worth testing after I added those `__contains__`es.

Seems okay to me. It's better that it's done correctly anyways.

> Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!

Thank you Darij!



---

archive/issue_comments_180232.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nNice! Thanks for the tweaks.\n\n> When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.\n\nOkay. What is the difference to `__classcall__()`?\n\n> I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.\n\nI'm surprised by the fact that #14883 still applies; since it does, of course, it's better to just leave it separated.",
    "created_at": "2013-07-20T09:07:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180232",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:50" align="right">comment:50</div>

Nice! Thanks for the tweaks.

> When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.

Okay. What is the difference to `__classcall__()`?

> I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.

I'm surprised by the fact that #14883 still applies; since it does, of course, it's better to just leave it separated.



---

archive/issue_comments_180233.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@darijgr](#comment%3A50):\n> Okay. What is the difference to `__classcall__()`?\n\nThe difference is `__classcall_private__()` is not inherited (in the sense that it is not called).",
    "created_at": "2013-07-20T09:12:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180233",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@darijgr](#comment%3A50):
> Okay. What is the difference to `__classcall__()`?

The difference is `__classcall_private__()` is not inherited (in the sense that it is not called).



---

archive/issue_comments_180234.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAh, I see.",
    "created_at": "2013-07-20T09:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180234",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:52" align="right">comment:52</div>

Ah, I see.



---

archive/issue_events_207827.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:09:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207827"
}
```



---

archive/issue_events_207828.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:09:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207828"
}
```



---

archive/issue_comments_180235.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nWhy 5.12? There's currently a ton of stuff depending on this patch, and merging will not become easier just because we wait a few more weeks...",
    "created_at": "2013-07-21T21:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180235",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:54" align="right">comment:54</div>

Why 5.12? There's currently a ton of stuff depending on this patch, and merging will not become easier just because we wait a few more weeks...



---

archive/issue_events_207829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:47:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207829"
}
```



---

archive/issue_events_207830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:47:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207830"
}
```



---

archive/issue_comments_180236.json:
```json
{
    "body": "Changed dependencies from **#8386 #14519 #14808** to **#8386 #14519 #14808 #14143 #14015 #14516**",
    "created_at": "2013-08-02T14:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180236",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#8386 #14519 #14808** to **#8386 #14519 #14808 #14143 #14015 #14516**



---

archive/issue_events_207831.json:
```json
{
    "actor": "https://github.com/jeffpferreira",
    "created_at": "2013-08-07T22:31:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207831"
}
```



---

archive/issue_events_207832.json:
```json
{
    "actor": "https://github.com/jeffpferreira",
    "created_at": "2013-08-07T22:31:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207832"
}
```



---

archive/issue_comments_180237.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nWith this applied to 5.11.rc0:\n\n```\n$ hg qapplied\ntrac_7983-major_index_and_other_tableau_fixes-dg.patch\ntrac_7983-review-ts.patch\ntrac_8386_really_just_moving-fc.patch\ntrac_8386_big_clean_fc.patch\ntrac_8386_assert_removal.patch\ntrac_14516-crystals_speedup-ts.patch\ntrac_14519-cynthonize_element_wrapper-ts.patch\ntrac_14808-recoils_of_permutations-ts.patch\ntrac_14772-remove_cc_permutations-ts.patch\n```\n\nI get a doctest error:\n\n```\n$ sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py\n...\n1 item had failures:\n   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests\n    [327 tests, 1 failure, 88.66 s]\n----------------------------------------------------------------------\nsage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nNo error when I `qpop` trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-07T22:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180237",
    "user": "https://github.com/jeffpferreira"
}
```

<div id="comment:56" align="right">comment:56</div>

With this applied to 5.11.rc0:

```
$ hg qapplied
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_7983-review-ts.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14516-crystals_speedup-ts.patch
trac_14519-cynthonize_element_wrapper-ts.patch
trac_14808-recoils_of_permutations-ts.patch
trac_14772-remove_cc_permutations-ts.patch
```

I get a doctest error:

```
$ sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py
...
1 item had failures:
   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests
    [327 tests, 1 failure, 88.66 s]
----------------------------------------------------------------------
sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py  # 1 doctest failed
----------------------------------------------------------------------
```

No error when I `qpop` trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_180238.json:
```json
{
    "body": "Changed reviewer from **Mike Hansen, Darij Grinberg** to **Mike Hansen, Darij Grinberg, Jeff Ferreira**",
    "created_at": "2013-08-07T23:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180238",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Mike Hansen, Darij Grinberg** to **Mike Hansen, Darij Grinberg, Jeff Ferreira**



---

archive/issue_events_207833.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207833"
}
```



---

archive/issue_events_207834.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207834"
}
```



---

archive/issue_events_207835.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207835"
}
```



---

archive/issue_events_207836.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207836"
}
```



---

archive/issue_comments_180239.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nFixed. I think I removed a test from the options after I did a check on the sources. Thanks for catching that.\n\n```\nDoctesting 1 file.\nsage -t --long ../doctest/sources.py\n    [327 tests, 130.57 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 131.0 seconds\n    cpu time: 121.6 seconds\n    cumulative wall time: 130.6 seconds\n```\n\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-07T23:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180239",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:57" align="right">comment:57</div>

Fixed. I think I removed a test from the options after I did a check on the sources. Thanks for catching that.

```
Doctesting 1 file.
sage -t --long ../doctest/sources.py
    [327 tests, 130.57 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 131.0 seconds
    cpu time: 121.6 seconds
    cumulative wall time: 130.6 seconds
```

For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_180240.json:
```json
{
    "body": "Attachment: **[trac_14772-remove_cc_permutations-ts.patch.gz](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)**",
    "created_at": "2013-08-16T18:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180240",
    "user": "https://github.com/tscrim"
}
```

Attachment: **[trac_14772-remove_cc_permutations-ts.patch.gz](https://github.com/sagemath/sage/files/ticket14772/trac_14772-remove_cc_permutations-ts.patch.gz)**



---

archive/issue_comments_180241.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nTrivial rebase over #14863.\n\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-16T18:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180241",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:58" align="right">comment:58</div>

Trivial rebase over #14863.

For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_180242.json:
```json
{
    "body": "Changed dependencies from **#8386 #14519 #14808 #14143 #14015 #14516** to **#8386 #14519 #14808 #14143 #14015 #14516 #14863**",
    "created_at": "2013-08-16T18:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180242",
    "user": "https://github.com/tscrim"
}
```

Changed dependencies from **#8386 #14519 #14808 #14143 #14015 #14516** to **#8386 #14519 #14808 #14143 #14015 #14516 #14863**



---

archive/issue_events_207837.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T12:04:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207837"
}
```



---

archive/issue_events_207838.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T12:04:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207838"
}
```



---

archive/issue_comments_180243.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThere is something wrong !\n\nBefore applying this patch:\n\n```\nsage: Permutation([3,2,1])\n```\n\nAfter applying this patch:\n\n``` \nsage: Permutation([3,2,1])\nTraceback (most recent call last)\n...\nTypeError: __init__() got multiple values for keyword argument 'parent'\n```\n\nHow can that be an error (and what does that error message tell me)?",
    "created_at": "2013-08-19T12:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180243",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:59" align="right">comment:59</div>

There is something wrong !

Before applying this patch:

```
sage: Permutation([3,2,1])
```

After applying this patch:

``` 
sage: Permutation([3,2,1])
Traceback (most recent call last)
...
TypeError: __init__() got multiple values for keyword argument 'parent'
```

How can that be an error (and what does that error message tell me)?



---

archive/issue_comments_180244.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nWeird, because I'm not getting this error. Can you quote the whole traceback maybe?",
    "created_at": "2013-08-19T12:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180244",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:60" align="right">comment:60</div>

Weird, because I'm not getting this error. Can you quote the whole traceback maybe?



---

archive/issue_comments_180245.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI'm glad that this is not intentional.  I was worried that this patch made more significant changes to the use of the `Permutation` class.\n\n```\nsage: Permutation([3,2,1])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-b3e6779bea6e> in <module>()\n----> 1 Permutation([Integer(3),Integer(2),Integer(1)])\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1224)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/combinat/permutation.pyc in __classcall_private__(cls, l, check_input)\n    499 \n    500         # otherwise, it gets processed by CombinatorialObject's __init__.\n--> 501         return Permutations()(l, check_input=check_input)\n    502 \n    503     def __init__(self, parent, l, check_input=True):\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8154)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4278)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4089)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in _element_constructor_from_element_class(self, *args, **keywords)\n    337                 17\n    338             \"\"\"\n--> 339             return self.element_class(parent = self, *args, **keywords)\n    340 \n    341         def is_parent_of(self, element):\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1243)()\n\nTypeError: __init__() got multiple values for keyword argument 'parent'\n```",
    "created_at": "2013-08-19T12:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180245",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:61" align="right">comment:61</div>

I'm glad that this is not intentional.  I was worried that this patch made more significant changes to the use of the `Permutation` class.

```
sage: Permutation([3,2,1])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-b3e6779bea6e> in <module>()
----> 1 Permutation([Integer(3),Integer(2),Integer(1)])

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1224)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/combinat/permutation.pyc in __classcall_private__(cls, l, check_input)
    499 
    500         # otherwise, it gets processed by CombinatorialObject's __init__.
--> 501         return Permutations()(l, check_input=check_input)
    502 
    503     def __init__(self, parent, l, check_input=True):

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8154)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4278)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4089)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in _element_constructor_from_element_class(self, *args, **keywords)
    337                 17
    338             """
--> 339             return self.element_class(parent = self, *args, **keywords)
    340 
    341         def is_parent_of(self, element):

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1243)()

TypeError: __init__() got multiple values for keyword argument 'parent'
```



---

archive/issue_comments_180246.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI think this is because you don't have #14519 applied. Is that so?",
    "created_at": "2013-08-19T12:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180246",
    "user": "https://github.com/darijgr"
}
```

<div id="comment:62" align="right">comment:62</div>

I think this is because you don't have #14519 applied. Is that so?



---

archive/issue_comments_180247.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nYes.  That was missing and it seems to work fine.  This was my fault.  Thanks for helping.",
    "created_at": "2013-08-19T13:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180247",
    "user": "https://github.com/zabrocki"
}
```

<div id="comment:63" align="right">comment:63</div>

Yes.  That was missing and it seems to work fine.  This was my fault.  Thanks for helping.



---

archive/issue_events_207839.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T13:08:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207839"
}
```



---

archive/issue_events_207840.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T13:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207840"
}
```



---

archive/issue_comments_180248.json:
```json
{
    "body": "Merged: **sage-5.12.beta3**",
    "created_at": "2013-08-20T12:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14772#issuecomment-180248",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta3**



---

archive/issue_events_207841.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207841"
}
```



---

archive/issue_events_207842.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14772",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14772#event-207842"
}
```
