# Issue 14772: Remove CombinatorialClass from Permutations

archive/issues_014568.json:
```json
{
    "body": "Part of #12913.\n\n---\n\nApply: [attachment:trac_14772-remove_cc_permutations-ts.patch]\n\n**Assignee:** sage-combinat\n\n**CC:**  sage-combinat @zabrocki alubovsky @nthiery\n\n**Keywords:** days49\n\n**Reviewer:** Mike Hansen, Darij Grinberg, Jeff Ferreira\n\n**Author:** Travis Scrimshaw\n\n**Merged:** sage-5.12.beta3\n\n**Dependencies:** #8386 #14519 #14808 #14143 #14015 #14516 #14863\n\nIssue created by migration from https://trac.sagemath.org/ticket/14772\n\n",
    "closed_at": "2013-08-20T12:56:23Z",
    "created_at": "2013-06-19T09:22:52Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Remove CombinatorialClass from Permutations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14772",
    "user": "https://github.com/tscrim"
}
```
Part of #12913.

---

Apply: [attachment:trac_14772-remove_cc_permutations-ts.patch]

**Assignee:** sage-combinat

**CC:**  sage-combinat @zabrocki alubovsky @nthiery

**Keywords:** days49

**Reviewer:** Mike Hansen, Darij Grinberg, Jeff Ferreira

**Author:** Travis Scrimshaw

**Merged:** sage-5.12.beta3

**Dependencies:** #8386 #14519 #14808 #14143 #14015 #14516 #14863

Issue created by migration from https://trac.sagemath.org/ticket/14772





---

archive/issue_comments_184201.json:
```json
{
    "body": "<a id='comment:1'></a>\nMinor dependency on #8386 due to use of `Permutation_class`.",
    "created_at": "2013-06-28T16:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184201",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
Minor dependency on #8386 due to use of `Permutation_class`.



---

archive/issue_comments_184202.json:
```json
{
    "body": "**Dependencies:** #8386",
    "created_at": "2013-06-28T16:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184202",
    "user": "https://github.com/tscrim"
}
```

**Dependencies:** #8386



---

archive/issue_events_131969.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-28T16:41:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131969"
}
```



---

archive/issue_comments_184203.json:
```json
{
    "body": "<a id='comment:2'></a>\nLet's try it with #14519 as a dependency.",
    "created_at": "2013-06-30T17:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184203",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
Let's try it with #14519 as a dependency.



---

archive/issue_comments_184204.json:
```json
{
    "body": "**Changing dependencies** from \"#8386\" to \"#8386 #14519\".",
    "created_at": "2013-06-30T17:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184204",
    "user": "https://github.com/tscrim"
}
```

**Changing dependencies** from "#8386" to "#8386 #14519".



---

archive/issue_comments_184205.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks good to me.  The main issue is that there are two classcall_private methods with out tests; however, they are tested in the the doctest for init.  I don't think it makes sense to duplicate the tests.  Maybe just a note that it is tested via the init doctests?",
    "created_at": "2013-07-01T12:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184205",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
Looks good to me.  The main issue is that there are two classcall_private methods with out tests; however, they are tested in the the doctest for init.  I don't think it makes sense to duplicate the tests.  Maybe just a note that it is tested via the init doctests?



---

archive/issue_comments_184206.json:
```json
{
    "body": "<a id='comment:4'></a>\nI added some (simple) doctests to the `__classcall_private__()` functions.",
    "created_at": "2013-07-01T13:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184206",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
I added some (simple) doctests to the `__classcall_private__()` functions.



---

archive/issue_comments_184207.json:
```json
{
    "body": "<a id='comment:7'></a>\nAll doctest errors should be fixed now.",
    "created_at": "2013-07-12T05:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184207",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
All doctest errors should be fixed now.



---

archive/issue_comments_184208.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis conflicts with #14808 again. Travis, could you update #14808 please? Thank you.",
    "created_at": "2013-07-12T17:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184208",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>
This conflicts with #14808 again. Travis, could you update #14808 please? Thank you.



---

archive/issue_comments_184209.json:
```json
{
    "body": "<a id='comment:9'></a>\nI put this over #14808, so I'm putting that as a dependency now.",
    "created_at": "2013-07-12T19:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184209",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
I put this over #14808, so I'm putting that as a dependency now.



---

archive/issue_comments_184210.json:
```json
{
    "body": "**Changing dependencies** from \"#8386 #14519\" to \"#8386 #14519 #14808\".",
    "created_at": "2013-07-12T19:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184210",
    "user": "https://github.com/tscrim"
}
```

**Changing dependencies** from "#8386 #14519" to "#8386 #14519 #14808".



---

archive/issue_comments_184211.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt'll probably need some rebase, though.",
    "created_at": "2013-07-12T19:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184211",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'></a>
It'll probably need some rebase, though.



---

archive/issue_comments_184212.json:
```json
{
    "body": "<a id='comment:11'></a>\nI already had #14808 applied in the combinat queue, so it shouldn't need rebasing.",
    "created_at": "2013-07-12T19:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184212",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
I already had #14808 applied in the combinat queue, so it shouldn't need rebasing.



---

archive/issue_comments_184213.json:
```json
{
    "body": "<a id='comment:12'></a>\nOOPS, you're right. Sorry; I had an obsolete patch in my .hg/patches folder.",
    "created_at": "2013-07-12T19:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184213",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:12'></a>
OOPS, you're right. Sorry; I had an obsolete patch in my .hg/patches folder.



---

archive/issue_comments_184214.json:
```json
{
    "body": "<a id='comment:13'></a>\nBut the `number_of_inversions(self)` docstring is still unfixed, or am I totally wrong about it?",
    "created_at": "2013-07-12T20:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184214",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'></a>
But the `number_of_inversions(self)` docstring is still unfixed, or am I totally wrong about it?



---

archive/issue_comments_184215.json:
```json
{
    "body": "<a id='comment:14'></a>\n\n```diff\n@@ -1542,10 +1561,10 @@ class Permutation_class(CombinatorialObj\n \n     def number_of_inversions(self):\n         r\"\"\"\n-        Returns the number of inversions in the permutation p.\n-\n-        An inversion of a permutation is a pair of elements (p[i],p[j])\n-        with i < j and p[i] > p[j].\n+        Return the number of inversions in ``self``.\n+\n+        An inversion of a permutation is a pair of elements `(p_i,p_j)`\n+        with `i < j` and `p_i > p_j`.\n \n         REFERENCES:\n \n```",
    "created_at": "2013-07-13T04:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184215",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>

```diff
@@ -1542,10 +1561,10 @@ class Permutation_class(CombinatorialObj
 
     def number_of_inversions(self):
         r"""
-        Returns the number of inversions in the permutation p.
-
-        An inversion of a permutation is a pair of elements (p[i],p[j])
-        with i < j and p[i] > p[j].
+        Return the number of inversions in ``self``.
+
+        An inversion of a permutation is a pair of elements `(p_i,p_j)`
+        with `i < j` and `p_i > p_j`.
 
         REFERENCES:
 
```



---

archive/issue_comments_184216.json:
```json
{
    "body": "<a id='comment:15'></a>\nI wasn't speaking about the syntax. It should say \"a pair of elements `(i, j)`\", not \"a pair of elements `(p_i, p_j)`\", so as not to confuse the reader about the output of the `inversions()` method.",
    "created_at": "2013-07-13T08:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184216",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:15'></a>
I wasn't speaking about the syntax. It should say "a pair of elements `(i, j)`", not "a pair of elements `(p_i, p_j)`", so as not to confuse the reader about the output of the `inversions()` method.



---

archive/issue_comments_184217.json:
```json
{
    "body": "<a id='comment:16'></a>\nAh. Fixed. I also added some latex options for permutations and being able to display them as words (which is how I generally look at them, transpositions on positions). I made some other minor changes to other docstrings I noticed, so I apologize in advance if you have to rebase.",
    "created_at": "2013-07-13T10:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184217",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Ah. Fixed. I also added some latex options for permutations and being able to display them as words (which is how I generally look at them, transpositions on positions). I made some other minor changes to other docstrings I noticed, so I apologize in advance if you have to rebase.



---

archive/issue_comments_184218.json:
```json
{
    "body": "<a id='comment:17'></a>\nWith the following patches applied on `5.11.beta3`\n\n```\ntscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -hg qapplied\ntrac_14610-LSenergy-ms.patch\ntrac9107_nesting_nested_classes.patch\ntrac_9107_fix_cross_reference.patch\ntrac_13589-categories-c3_under_control-nt.patch\ntrac_14714_latex_dyckword_fix.patch\ntrac_14748_deprecationwarning.patch\ntrac_14748_doctest.patch\ntrac_14748-review-ts.patch\ntrac_14787-gyw_stats-bs.patch\ntrac_14762-fix_ASM_ne-ts.patch\ntrac_12940_affine_permutations-td.patch\ntrac_14573-path_realizations-ts.patch\ntrac_14507-tropical_semiring-ts.patch\ntrac_11407-list_clone_improve-fh.patch\ntrac_14516-crystals_speedup-ts.patch\ntrac_7983-major_index_and_other_tableau_fixes-dg.patch\ntrac_7983-review-ts.patch\ntrac_12882-matrix_as_dynkin_diagram-ts.patch\ntrac_14722-lazy_import_at_startup-nt.patch\ntrac_8386_really_just_moving-fc.patch\ntrac_8386_big_clean_fc.patch\ntrac_8386_assert_removal.patch\ntrac_14808-recoils_of_permutations-ts.patch\ntrac_10630-vector_partition-ap.patch\ntrac_14870-fix_int_mod_QQ-ts.patch\ntrac_14882-backtrack_longtime-dg.patch\ntrac_14469_repr_graphics.patch\ntrac_14519-cynthonize_element_wrapper-ts.patch\ntrac_12250-ktableaux-as.patch\ntrac_14776-strong-ktableaux-mz.patch\ntrac_14772-remove_cc_permutations-ts.patch\n```\nI cannot reproduce the doctest failure from the patchbot\n\n```\ntscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -tp --long combinat.py\nRunning doctests with ID 2013-07-13-19-05-23-2a0e8ee8.\nDoctesting 1 file using 2 threads.\nsage -t --long combinat.py\n    [428 tests, 6.61 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 6.9 seconds\n    cpu time: 2.4 seconds\n    cumulative wall time: 6.6 seconds\n```\nOnly #12250 and #14476 do not have a positive review and this commutes with those patches. So I don't know why that doctest is failing for the patchbot...",
    "created_at": "2013-07-13T13:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184218",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
With the following patches applied on `5.11.beta3`

```
tscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -hg qapplied
trac_14610-LSenergy-ms.patch
trac9107_nesting_nested_classes.patch
trac_9107_fix_cross_reference.patch
trac_13589-categories-c3_under_control-nt.patch
trac_14714_latex_dyckword_fix.patch
trac_14748_deprecationwarning.patch
trac_14748_doctest.patch
trac_14748-review-ts.patch
trac_14787-gyw_stats-bs.patch
trac_14762-fix_ASM_ne-ts.patch
trac_12940_affine_permutations-td.patch
trac_14573-path_realizations-ts.patch
trac_14507-tropical_semiring-ts.patch
trac_11407-list_clone_improve-fh.patch
trac_14516-crystals_speedup-ts.patch
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_7983-review-ts.patch
trac_12882-matrix_as_dynkin_diagram-ts.patch
trac_14722-lazy_import_at_startup-nt.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14808-recoils_of_permutations-ts.patch
trac_10630-vector_partition-ap.patch
trac_14870-fix_int_mod_QQ-ts.patch
trac_14882-backtrack_longtime-dg.patch
trac_14469_repr_graphics.patch
trac_14519-cynthonize_element_wrapper-ts.patch
trac_12250-ktableaux-as.patch
trac_14776-strong-ktableaux-mz.patch
trac_14772-remove_cc_permutations-ts.patch
```
I cannot reproduce the doctest failure from the patchbot

```
tscrim@as96:~/sage-5.11.beta3/devel/sage-combinat/sage/combinat$ sage -tp --long combinat.py
Running doctests with ID 2013-07-13-19-05-23-2a0e8ee8.
Doctesting 1 file using 2 threads.
sage -t --long combinat.py
    [428 tests, 6.61 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.9 seconds
    cpu time: 2.4 seconds
    cumulative wall time: 6.6 seconds
```
Only #12250 and #14476 do not have a positive review and this commutes with those patches. So I don't know why that doctest is failing for the patchbot...



---

archive/issue_comments_184219.json:
```json
{
    "body": "<a id='comment:18'></a>\nLooks like MRO. The class Arrangements inherits from Permutations. Permutations of a multiset have their own cardinality() method, which gives the (wrong) 1260 answer in this case. The correct 22 answer is obtained by the standard cardinality() method of FiniteEnumeratedSets (?) which just takes the length of the list().",
    "created_at": "2013-07-13T13:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184219",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:18'></a>
Looks like MRO. The class Arrangements inherits from Permutations. Permutations of a multiset have their own cardinality() method, which gives the (wrong) 1260 answer in this case. The correct 22 answer is obtained by the standard cardinality() method of FiniteEnumeratedSets (?) which just takes the length of the list().



---

archive/issue_comments_184220.json:
```json
{
    "body": "<a id='comment:19'></a>\nStrange that it wasn't showing up when I was running my doctests (although it did appear when I did it in sage). Typically I get the other behavior. Fixed. Thank Darij.",
    "created_at": "2013-07-14T04:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184220",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Strange that it wasn't showing up when I was running my doctests (although it did appear when I did it in sage). Typically I get the other behavior. Fixed. Thank Darij.



---

archive/issue_comments_184221.json:
```json
{
    "body": "<a id='comment:20'></a>\nMike, do you think you could do a re-review of this patch? Thanks.",
    "created_at": "2013-07-16T10:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184221",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Mike, do you think you could do a re-review of this patch? Thanks.



---

archive/issue_comments_184222.json:
```json
{
    "body": "<a id='comment:21'></a>\nDarij, since Mike hasn't responding, do you think you could do the final review of this patch? Thanks.",
    "created_at": "2013-07-18T03:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184222",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Darij, since Mike hasn't responding, do you think you could do the final review of this patch? Thanks.



---

archive/issue_comments_184223.json:
```json
{
    "body": "<a id='comment:22'></a>\nI've started the review -- but I'm stuck at `PermutationOptions` now. You have these doctests:\n\n```\n    EXAMPLES::\n    \n        sage: p213 = Permutation([2,1,3])\n        sage: p312 = Permutation([3,1,2])\n        sage: PermutationOptions(mult='l2r', display='list')\n        sage: po = PermutationOptions()\n        sage: po['display']\n        'list'\n        sage: p213\n        [2, 1, 3]\n        sage: PermutationOptions(display='cycle')\n        sage: p213\n        (1,2)\n        sage: PermutationOptions(display='singleton')\n        sage: p213\n        (1,2)(3)\n        sage: PermutationOptions(display='list')\n```\n\nBut when I try to run them ingame, they don't behave that nicely:\n\n```\nsage:         sage: p213 = Permutation([2,1,3])\nsage:         sage: p312 = Permutation([3,1,2])\nsage:         sage: PermutationOptions(mult='l2r', display='list')\nsage:         sage: po = PermutationOptions()\nCurrent options for permutations\n  - display:        list\n  - generator_name: s\n  - latex:          list\n  - mult:           l2r\nsage:         sage: po['display']\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-49-b0a2d723e60c> in <module>()\n----> 1 po['display']\n\nTypeError: 'NoneType' object has no attribute '__getitem__'\n```\n\nI have a feeling that they are not recognized as doctests due to the weird place they're in... And I don't know what to do about this.",
    "created_at": "2013-07-19T01:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184223",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:22'></a>
I've started the review -- but I'm stuck at `PermutationOptions` now. You have these doctests:

```
    EXAMPLES::
    
        sage: p213 = Permutation([2,1,3])
        sage: p312 = Permutation([3,1,2])
        sage: PermutationOptions(mult='l2r', display='list')
        sage: po = PermutationOptions()
        sage: po['display']
        'list'
        sage: p213
        [2, 1, 3]
        sage: PermutationOptions(display='cycle')
        sage: p213
        (1,2)
        sage: PermutationOptions(display='singleton')
        sage: p213
        (1,2)(3)
        sage: PermutationOptions(display='list')
```

But when I try to run them ingame, they don't behave that nicely:

```
sage:         sage: p213 = Permutation([2,1,3])
sage:         sage: p312 = Permutation([3,1,2])
sage:         sage: PermutationOptions(mult='l2r', display='list')
sage:         sage: po = PermutationOptions()
Current options for permutations
  - display:        list
  - generator_name: s
  - latex:          list
  - mult:           l2r
sage:         sage: po['display']
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-49-b0a2d723e60c> in <module>()
----> 1 po['display']

TypeError: 'NoneType' object has no attribute '__getitem__'
```

I have a feeling that they are not recognized as doctests due to the weird place they're in... And I don't know what to do about this.



---

archive/issue_comments_184224.json:
```json
{
    "body": "<a id='comment:23'></a>\nAck...I forgot to check the global options tests. That syntax is from the old sytle, it should be ``Permutations.global_options``. I'll fix them.\n\nYou're also correct in that the doctest framework does not pick up dynamically created docstrings (unfortunately).\n\nThanks,\n\nTravis",
    "created_at": "2013-07-19T03:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184224",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
Ack...I forgot to check the global options tests. That syntax is from the old sytle, it should be ``Permutations.global_options``. I'll fix them.

You're also correct in that the doctest framework does not pick up dynamically created docstrings (unfortunately).

Thanks,

Travis



---

archive/issue_comments_184225.json:
```json
{
    "body": "<a id='comment:24'></a>\nI've made the fixes, but I can't upload it due to the filesize (the limit has been lowered to 256kB on the new server). I've asked Andrew Ohana to see if he can raise that limit a bit. If not, I'll split the patch and reupload.\n\nBest,\n\nTravis",
    "created_at": "2013-07-19T03:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184225",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
I've made the fixes, but I can't upload it due to the filesize (the limit has been lowered to 256kB on the new server). I've asked Andrew Ohana to see if he can raise that limit a bit. If not, I'll split the patch and reupload.

Best,

Travis



---

archive/issue_comments_184226.json:
```json
{
    "body": "<a id='comment:25'></a>\nOkay, here's the new version.",
    "created_at": "2013-07-19T04:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184226",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>
Okay, here's the new version.



---

archive/issue_comments_184227.json:
```json
{
    "body": "<a id='comment:26'></a>\nIn case noone disagrees, I'll remove the \"like composition of functions\" from this:\n\n```\n  * \"l2r\" -- left to right like composition of functions (p_1  *\n    p_2)(x) = p_2(p_1(x))\n```\nbecause it's extremely misleading. Of course, the whole idea of global variables for this is bad, but that's for a later ticket.",
    "created_at": "2013-07-19T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184227",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:26'></a>
In case noone disagrees, I'll remove the "like composition of functions" from this:

```
  * "l2r" -- left to right like composition of functions (p_1  *
    p_2)(x) = p_2(p_1(x))
```
because it's extremely misleading. Of course, the whole idea of global variables for this is bad, but that's for a later ticket.



---

archive/issue_comments_184228.json:
```json
{
    "body": "<a id='comment:27'></a>\nSorry for the spam but I'll be updating this thread with anything potentially controversial I'm doing in my review patch.\n\nThe latex method for permutations in reduced-word notation returns an empty string when the permutation is id. I'll replace this by a \"1\".",
    "created_at": "2013-07-19T11:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184228",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:27'></a>
Sorry for the spam but I'll be updating this thread with anything potentially controversial I'm doing in my review patch.

The latex method for permutations in reduced-word notation returns an empty string when the permutation is id. I'll replace this by a "1".



---

archive/issue_comments_184229.json:
```json
{
    "body": "<a id='comment:28'></a>\nHow about 'e' or the empty set instead as to avoid potential conflicts? Or better yet, add a global option about that.",
    "created_at": "2013-07-19T11:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184229",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
How about 'e' or the empty set instead as to avoid potential conflicts? Or better yet, add a global option about that.



---

archive/issue_comments_184230.json:
```json
{
    "body": "<a id='comment:29'></a>\nYou mean an additional one, or allow several different values for the \"latex\" option?\n\n(On another note: You have changed a \"spam.eggs.blah.method(x)\" pattern to \"from spam.eggs.blah import method; method(x)\" pattern several times; is that an example I should follow in my code?)",
    "created_at": "2013-07-19T11:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184230",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:29'></a>
You mean an additional one, or allow several different values for the "latex" option?

(On another note: You have changed a "spam.eggs.blah.method(x)" pattern to "from spam.eggs.blah import method; method(x)" pattern several times; is that an example I should follow in my code?)



---

archive/issue_comments_184231.json:
```json
{
    "body": "<a id='comment:30'></a>\nI mean add 1 additional global option of the form `latex_identity_word` which will follow the `latex_diagram_str` global option in `partition.py`.\n\n(I think this pattern leads to more readable code; although it seems to make circular imports more prone to breaking.)",
    "created_at": "2013-07-19T11:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184231",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>
I mean add 1 additional global option of the form `latex_identity_word` which will follow the `latex_diagram_str` global option in `partition.py`.

(I think this pattern leads to more readable code; although it seems to make circular imports more prone to breaking.)



---

archive/issue_comments_184232.json:
```json
{
    "body": "<a id='comment:31'></a>\nI've done that change -- feel free to comment.\n\nIn other news, Sage doesn't consider the empty permutation to avoid `[1]`. Do we consider this a bug? (The chances of being bitten by this are nigh 0.)",
    "created_at": "2013-07-19T14:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184232",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:31'></a>
I've done that change -- feel free to comment.

In other news, Sage doesn't consider the empty permutation to avoid `[1]`. Do we consider this a bug? (The chances of being bitten by this are nigh 0.)



---

archive/issue_comments_184233.json:
```json
{
    "body": "<a id='comment:32'></a>\nHi Darij,  Can you clarify what you mean?  `Permutation([]).avoids([1])` returns `True` for me.  If that were not the case, I would consider that a bug.",
    "created_at": "2013-07-19T14:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184233",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:32'></a>
Hi Darij,  Can you clarify what you mean?  `Permutation([]).avoids([1])` returns `True` for me.  If that were not the case, I would consider that a bug.



---

archive/issue_comments_184234.json:
```json
{
    "body": "<a id='comment:33'></a>\nOh, but:\n\n```\nsage: Permutations(0, avoiding=[1]).list()\n[]\nsage: Permutations(0, avoiding=[1,2]).list()\n[[]]\nsage: Permutations(0, avoiding=[1,2,3,4,5]).list()\n#doesn't terminate\n```\nI guess this is a backtrack.py issue...",
    "created_at": "2013-07-19T14:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184234",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:33'></a>
Oh, but:

```
sage: Permutations(0, avoiding=[1]).list()
[]
sage: Permutations(0, avoiding=[1,2]).list()
[[]]
sage: Permutations(0, avoiding=[1,2,3,4,5]).list()
#doesn't terminate
```
I guess this is a backtrack.py issue...



---

archive/issue_comments_184235.json:
```json
{
    "body": "<a id='comment:34'></a>\nShould I fix this bug:\n\n```\nsage: S = Permutations(['c','a'])\nsage: elt = S(['c','c','c'])\nsage: elt in S\nTrue\n```\n\nor is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?",
    "created_at": "2013-07-19T14:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184235",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:34'></a>
Should I fix this bug:

```
sage: S = Permutations(['c','a'])
sage: elt = S(['c','c','c'])
sage: elt in S
True
```

or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?



---

archive/issue_comments_184236.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [darij](#comment%3A34):\n> Should I fix this bug:\n> \n> ```\n> sage: S = Permutations(['c','a'])\n> sage: elt = S(['c','c','c'])\n> sage: elt in S\n> True\n> ```\n> \n> or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?\n\n\nI think it should be fixed. I suspect it's something I introduced... (especially in that case)\n\nI also can't reproduce the avoidance part:\n\n```\nsage: [] in Permutations(0, avoiding=[1])\nTrue\nsage: [] in Permutations(avoiding=[1])   \nTrue\n```\nbut the backtrack error is something that should be fixed. I'll see if I can do it in a few lines, otherwise I'll say push it to another ticket.",
    "created_at": "2013-07-19T14:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184236",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
Replying to [darij](#comment%3A34):
> Should I fix this bug:
> 
> ```
> sage: S = Permutations(['c','a'])
> sage: elt = S(['c','c','c'])
> sage: elt in S
> True
> ```
> 
> or is it used in some other files to hack around permutations restrictions similarly to how we use(d?) nonstandard permutations?


I think it should be fixed. I suspect it's something I introduced... (especially in that case)

I also can't reproduce the avoidance part:

```
sage: [] in Permutations(0, avoiding=[1])
True
sage: [] in Permutations(avoiding=[1])   
True
```
but the backtrack error is something that should be fixed. I'll see if I can do it in a few lines, otherwise I'll say push it to another ticket.



---

archive/issue_comments_184237.json:
```json
{
    "body": "<a id='comment:36'></a>\nI tried this change to the `check` element method of class `Permutations_set`:\n\n```\n@@ -3845,10 +3879,20 @@ class Permutations_mset(Permutations):\n                 sage: S = Permutations(['c','a','c'])\n                 sage: elt = S(['c','c','a'])\n                 sage: elt.check()\n+                sage: elt2 = S(['c','c','c'])\n+                Traceback (most recent call last):\n+                ...\n+                ValueError: Invalid permutation\n             \"\"\"\n             mset = self.parent().mset\n+            selfdict = {}\n             for val in self:\n-                if val not in mset:\n+                if val in selfdict:\n+                    selfdict[val] += 1\n+                else:\n+                    selfdict[val] = 1\n+            for (val, mult) in selfdict.items():\n+                if mult != mset.count(val):\n                     raise ValueError(\"Invalid permutation\")\n \n     def _repr_(self):\n```\n\nBut this breaks various doctests since apparently the same `check` method is used for permutations of length k. I have reverted that change for now.\n\nIf you ask me, it is a stupid idea to have permutations of length k inherit from permutations anyway...",
    "created_at": "2013-07-19T15:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184237",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:36'></a>
I tried this change to the `check` element method of class `Permutations_set`:

```
@@ -3845,10 +3879,20 @@ class Permutations_mset(Permutations):
                 sage: S = Permutations(['c','a','c'])
                 sage: elt = S(['c','c','a'])
                 sage: elt.check()
+                sage: elt2 = S(['c','c','c'])
+                Traceback (most recent call last):
+                ...
+                ValueError: Invalid permutation
             """
             mset = self.parent().mset
+            selfdict = {}
             for val in self:
-                if val not in mset:
+                if val in selfdict:
+                    selfdict[val] += 1
+                else:
+                    selfdict[val] = 1
+            for (val, mult) in selfdict.items():
+                if mult != mset.count(val):
                     raise ValueError("Invalid permutation")
 
     def _repr_(self):
```

But this breaks various doctests since apparently the same `check` method is used for permutations of length k. I have reverted that change for now.

If you ask me, it is a stupid idea to have permutations of length k inherit from permutations anyway...



---

archive/issue_comments_184238.json:
```json
{
    "body": "<a id='comment:37'></a>\n`Permutations` is suppose to be a common abstract base class for all permutations (in some way it models the category of all types of permutations), so having permutations of length k inherit from it makes sense. However I think we need to implement a stronger `__contains__()` for the non-standard permutations, perhaps a stupid `return x in list(self)` (which, somewhat surprisingly to me, the category of `FiniteEnumeratedSets` does not provide by default).\n\nAlso, to fix the backtracker issue, what needs to be done is some simple corner case checking in the `__iter__` methods for `n == 0`. Only if `n > 0` do you call `PatternAvoider`.\n\nBest,\n\nTravis",
    "created_at": "2013-07-19T16:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184238",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>
`Permutations` is suppose to be a common abstract base class for all permutations (in some way it models the category of all types of permutations), so having permutations of length k inherit from it makes sense. However I think we need to implement a stronger `__contains__()` for the non-standard permutations, perhaps a stupid `return x in list(self)` (which, somewhat surprisingly to me, the category of `FiniteEnumeratedSets` does not provide by default).

Also, to fix the backtracker issue, what needs to be done is some simple corner case checking in the `__iter__` methods for `n == 0`. Only if `n > 0` do you call `PatternAvoider`.

Best,

Travis



---

archive/issue_comments_184239.json:
```json
{
    "body": "<a id='comment:38'></a>\nI'm getting `SyntaxError: 'return' with argument inside generator` when I try to fix this. Can you fix that one?",
    "created_at": "2013-07-19T16:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184239",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:38'></a>
I'm getting `SyntaxError: 'return' with argument inside generator` when I try to fix this. Can you fix that one?



---

archive/issue_comments_184240.json:
```json
{
    "body": "<a id='comment:39'></a>\n(The review patch I just uploaded includes this error -- feel free to directly edit my review patch rather than your base patch. Maybe you could fix your multiset permutation bug while we're at that, or shadow the `__check__` method in the appropriate classes so that my fix won't break other things. I hate to admit but I still don't see through the logic of the various classes defined in permutation.py. I'd also love it if you could sketch what changes you have made to the structure; the .patch file is mostly unreadable due to a bad diff encoding algorithm.)\n\nI won't return to this ticket in the next 3 or so hours.)",
    "created_at": "2013-07-19T16:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184240",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:39'></a>
(The review patch I just uploaded includes this error -- feel free to directly edit my review patch rather than your base patch. Maybe you could fix your multiset permutation bug while we're at that, or shadow the `__check__` method in the appropriate classes so that my fix won't break other things. I hate to admit but I still don't see through the logic of the various classes defined in permutation.py. I'd also love it if you could sketch what changes you have made to the structure; the .patch file is mostly unreadable due to a bad diff encoding algorithm.)

I won't return to this ticket in the next 3 or so hours.)



---

archive/issue_comments_184241.json:
```json
{
    "body": "<a id='comment:40'></a>\nI can't reupload over your review patch. Is it okay if I just fold it in to the main one?",
    "created_at": "2013-07-19T16:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184241",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
I can't reupload over your review patch. Is it okay if I just fold it in to the main one?



---

archive/issue_comments_184242.json:
```json
{
    "body": "<a id='comment:41'></a>\nYes, that's OK (as long as you look over my review patch, too -- there are some things in it that might need reviewing, in turn). Thanks a lot!\n\n(The code I commented out -- `#l[pos_im1] = i-1` and similar -- was just doing nothing.)",
    "created_at": "2013-07-19T16:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184242",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:41'></a>
Yes, that's OK (as long as you look over my review patch, too -- there are some things in it that might need reviewing, in turn). Thanks a lot!

(The code I commented out -- `#l[pos_im1] = i-1` and similar -- was just doing nothing.)



---

archive/issue_comments_184243.json:
```json
{
    "body": "<a id='comment:42'></a>\nI hacked around it:\n\n```\nif n > 0:\n    return iter(PatternAvoider(self, self._p))\nreturn iter([self.element_class(self, [])])\n```\nit's a python issue that putting a yield in the function makes it into a generator, which can't return anything at all, including iterators. This makes sense because python a priori doesn't know that it will be an iterator; plus the can of worms whether it should continue the iteration from that point with that iterator.\n\nAll combined and back to you Darij.",
    "created_at": "2013-07-19T16:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184243",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>
I hacked around it:

```
if n > 0:
    return iter(PatternAvoider(self, self._p))
return iter([self.element_class(self, [])])
```
it's a python issue that putting a yield in the function makes it into a generator, which can't return anything at all, including iterators. This makes sense because python a priori doesn't know that it will be an iterator; plus the can of worms whether it should continue the iteration from that point with that iterator.

All combined and back to you Darij.



---

archive/issue_comments_184244.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n Part of #12913.\n+\n+---\n+\n+Apply: [attachment:trac_14772-remove_cc_permutations-ts.patch]\n``````\n",
    "created_at": "2013-07-19T16:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184244",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,5 @@
 Part of #12913.
+
+---
+
+Apply: [attachment:trac_14772-remove_cc_permutations-ts.patch]
``````




---

archive/issue_comments_184245.json:
```json
{
    "body": "<a id='comment:43'></a>\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-07-19T16:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184245",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_184246.json:
```json
{
    "body": "<a id='comment:44'></a>\nGreat!\n\nI'll look into the multisets issue, but as for now here is a fix for another bug:\n\n```\nsage: Permutations(descents=[1,3,4]).list()\n```\ngave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the \"correct\" n would be the maximum entry of the list `[1, 3, 4]` plus 2. I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.\n\nWould you agree with axing the syntax?",
    "created_at": "2013-07-19T17:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184246",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:44'></a>
Great!

I'll look into the multisets issue, but as for now here is a fix for another bug:

```
sage: Permutations(descents=[1,3,4]).list()
```
gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the "correct" n would be the maximum entry of the list `[1, 3, 4]` plus 2. I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.

Would you agree with axing the syntax?



---

archive/issue_comments_184247.json:
```json
{
    "body": "<a id='comment:45'></a>\nI'm going out for a walk, but here is a fix for the overly liberal check() method of multiset/set permutations. I have relegated the checking to `__contains__`; is that OK in terms of coding style?\n\nNote that I have not tested for speed regressions. I fear there might be some.\n\nAlso, am I seeing it right that `Permutations_set` doesn't inherit from `Permutations_mset`? Is that an issue?",
    "created_at": "2013-07-19T18:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184247",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:45'></a>
I'm going out for a walk, but here is a fix for the overly liberal check() method of multiset/set permutations. I have relegated the checking to `__contains__`; is that OK in terms of coding style?

Note that I have not tested for speed regressions. I fear there might be some.

Also, am I seeing it right that `Permutations_set` doesn't inherit from `Permutations_mset`? Is that an issue?



---

archive/issue_comments_184248.json:
```json
{
    "body": "<a id='comment:46'></a>\nReplying to [darij](#comment%3A44):\n> Great!\n> \n> I'll look into the multisets issue, but as for now here is a fix for another bug:\n> \n> ```\n> sage: Permutations(descents=[1,3,4]).list()\n> ```\n> gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the \"correct\" n would be the maximum entry of the list `[1, 3, 4]` plus 2.\n\n\nMmmmm...zero based indexing errors. I completely forgot to fix the containment issue when folding in the review patch. Sorry.\n\n> I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.\n\n\nI wouldn't think it would be able to handle the descents composition (even without considering the doc which explicitly states this).\n\n> \n> Would you agree with axing the syntax?\n\n\n I'm not opposed to deprecating that form of input (it's not syntax strictly speaking), so if `descents` is passed in and no `n`, then it raises a deprecation warning.\n\nI'll be going to sleep now (I'm in India in case you're curious), so you won't get a reply for at least 8 hours from me. Although at this rate I think there won't be a single bug left anywhere near permutations. XP\n\nThanks,\n\nTravis",
    "created_at": "2013-07-19T18:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184248",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>
Replying to [darij](#comment%3A44):
> Great!
> 
> I'll look into the multisets issue, but as for now here is a fix for another bug:
> 
> ```
> sage: Permutations(descents=[1,3,4]).list()
> ```
> gave an error. It turns out that, lacking an n-value in the input, the code would automatically set n to be the maximum entry of the list `[1, 3, 4]` plus 1 (btw, that causes another bug when the list is empty; fixed as well), but whoever wrote that must have missed the fact that the positions start with 0 (so a presence of 3 in the list really means that the permutations will have a descent at 4, i. e., their value at 4 will be larger than their value at 5), so the "correct" n would be the maximum entry of the list `[1, 3, 4]` plus 2.


Mmmmm...zero based indexing errors. I completely forgot to fix the containment issue when folding in the review patch. Sorry.

> I think this is a completely stupid convention to make, and the syntax (giving the set of descents as a list without the n, having Sage automatically choose the n) should not be supported (no doctests in permutation.py use this syntax). Note that it only allows constructing permutations where the penultimate position is a descent; all the others require the long syntax with the n given! Also, it is misleading, because `descents=[1,3,4]` sounds like it should give the permutations with descent composition `[1,3,4]`, but the role of `[1,3,4]` here is absolutely not that of a composition.


I wouldn't think it would be able to handle the descents composition (even without considering the doc which explicitly states this).

> 
> Would you agree with axing the syntax?


 I'm not opposed to deprecating that form of input (it's not syntax strictly speaking), so if `descents` is passed in and no `n`, then it raises a deprecation warning.

I'll be going to sleep now (I'm in India in case you're curious), so you won't get a reply for at least 8 hours from me. Although at this rate I think there won't be a single bug left anywhere near permutations. XP

Thanks,

Travis



---

archive/issue_comments_184249.json:
```json
{
    "body": "<a id='comment:47'></a>\nI've deprecated it now -- but I still wouldn't mind seeing this way of generating permutations removed, seeing that before my fix today it would raise errors the first time one would try to do anything with it (unless the descents list was set to be the empty list)...\n\nAnyway, on to the more interesting parts of the file.",
    "created_at": "2013-07-19T21:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184249",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:47'></a>
I've deprecated it now -- but I still wouldn't mind seeing this way of generating permutations removed, seeing that before my fix today it would raise errors the first time one would try to do anything with it (unless the descents list was set to be the empty list)...

Anyway, on to the more interesting parts of the file.



---

archive/issue_comments_184250.json:
```json
{
    "body": "review patch. finished!",
    "created_at": "2013-07-19T23:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184250",
    "user": "https://github.com/darijgr"
}
```

review patch. finished!



---

archive/attachments_019876.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14772-review-dg.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14772/trac_14772-review-dg.patch",
    "created_at": "2013-07-19T23:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/darijgr"
}
```



---

archive/issue_comments_184251.json:
```json
{
    "body": "<a id='comment:48'></a>\nI've done the part of the review I think I was competent enough for. Not covered are:\n\n-- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.\n\n-- Same for `__setstate__`.\n\n-- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).\n\n-- A docstring says that `__call__` is a close variant of `__call__`:\n\n```\n    def __call__(self, x):\n        \"\"\"\n        A close variant of ``__call__`` which just attempts to extend\n        the permutation.\n```\nThis used to be:\n\n```\n    def __call__(self, x):\n        \"\"\"\n        A close variant of CombinatorialClass.__call__ which just\n        attempts to extend the permutation\n```\nSince you probably understand this better than I do, it's best if you fix this docstring.\n\n-- Speed might be worth testing after I added those `__contains__`es.\n\nAltogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!\n\nFinally, an observation I wish I had made earlier: kdiff3 is much better at deltaing your changes than mercurial...",
    "created_at": "2013-07-19T23:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184251",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:48'></a>
I've done the part of the review I think I was competent enough for. Not covered are:

-- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.

-- Same for `__setstate__`.

-- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).

-- A docstring says that `__call__` is a close variant of `__call__`:

```
    def __call__(self, x):
        """
        A close variant of ``__call__`` which just attempts to extend
        the permutation.
```
This used to be:

```
    def __call__(self, x):
        """
        A close variant of CombinatorialClass.__call__ which just
        attempts to extend the permutation
```
Since you probably understand this better than I do, it's best if you fix this docstring.

-- Speed might be worth testing after I added those `__contains__`es.

Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!

Finally, an observation I wish I had made earlier: kdiff3 is much better at deltaing your changes than mercurial...



---

archive/issue_comments_184252.json:
```json
{
    "body": "**Reviewer:** Mike Hansen, Darij Grinberg",
    "created_at": "2013-07-20T04:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184252",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Mike Hansen, Darij Grinberg



---

archive/issue_events_131970.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-07-20T04:59:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131970"
}
```



---

archive/issue_events_131971.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-07-20T04:59:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131971"
}
```



---

archive/issue_comments_184253.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [darij](#comment%3A48):\n> I've done the part of the review I think I was competent enough for. Not covered are:\n> \n> -- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.\n\n\nWhen doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.\n\n> -- Same for `__setstate__`.\n\n\nIt's used in pickling. This is called when something is trying to be unpickled, ex. `loads(dumps(obj))`.\n\n> -- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).\n\n\nI can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.\n\n> -- A docstring says that `__call__` is a close variant of `__call__`:\n> \n> ```\n>     def __call__(self, x):\n>         \"\"\"\n>         A close variant of ``__call__`` which just attempts to extend\n>         the permutation.\n> ```\n> This used to be:\n> \n> ```\n>     def __call__(self, x):\n>         \"\"\"\n>         A close variant of CombinatorialClass.__call__ which just\n>         attempts to extend the permutation\n> ```\n> Since you probably understand this better than I do, it's best if you fix this docstring.\n\n\nI've tweaked the docstring a bit so that it's more clear.\n\n> -- Speed might be worth testing after I added those `__contains__`es.\n\n\nSeems okay to me. It's better that it's done correctly anyways.\n\n> Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!\n\n\nThank you Darij!",
    "created_at": "2013-07-20T04:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184253",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:49'></a>
Replying to [darij](#comment%3A48):
> I've done the part of the review I think I was competent enough for. Not covered are:
> 
> -- I hope the `__classcall_private__` methods are actually doing what they should; while this is likely given the many doctests, I am not making any claims about this because I don't know what the heck `_classcall_private__` means to begin with.


When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.

> -- Same for `__setstate__`.


It's used in pickling. This is called when something is trying to be unpickled, ex. `loads(dumps(obj))`.

> -- `sage/combinat/set_partition_ordered.py`: I'd like you to remove that change and qfold the (IMHO more logical) #14883 into this patch instead (once you've cast an eye on what it does to ensure I did nothing wrong there).


I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.

> -- A docstring says that `__call__` is a close variant of `__call__`:
> 
> ```
>     def __call__(self, x):
>         """
>         A close variant of ``__call__`` which just attempts to extend
>         the permutation.
> ```
> This used to be:
> 
> ```
>     def __call__(self, x):
>         """
>         A close variant of CombinatorialClass.__call__ which just
>         attempts to extend the permutation
> ```
> Since you probably understand this better than I do, it's best if you fix this docstring.


I've tweaked the docstring a bit so that it's more clear.

> -- Speed might be worth testing after I added those `__contains__`es.


Seems okay to me. It's better that it's done correctly anyways.

> Altogether, great job. If you're fine with my review patch and handle the above five bullet points, feel free to set this to positive review!


Thank you Darij!



---

archive/issue_comments_184254.json:
```json
{
    "body": "<a id='comment:50'></a>\nNice! Thanks for the tweaks.\n\n> When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.\n\n\nOkay. What is the difference to `__classcall__()`?\n\n> I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.\n\n\nI'm surprised by the fact that #14883 still applies; since it does, of course, it's better to just leave it separated.",
    "created_at": "2013-07-20T09:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184254",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:50'></a>
Nice! Thanks for the tweaks.

> When doing something like `Permutation([1,2,3])`, what happens is first `__classcall_private__()` is called which should process the information and return the correct object (it's super function will call the class's `__init__()` if called). So in the above example, it creates puts the permutation in the correct parent class. For `Permutations`, it returns the correct parent object based upon the input.


Okay. What is the difference to `__classcall__()`?

> I can't change this back because I have to make it use the correct class (because there is no longer a `Permutation_class`). I'll review #14883 however.


I'm surprised by the fact that #14883 still applies; since it does, of course, it's better to just leave it separated.



---

archive/issue_comments_184255.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [darij](#comment%3A50):\n> Okay. What is the difference to `__classcall__()`?\n\n\nThe difference is `__classcall_private__()` is not inherited (in the sense that it is not called).",
    "created_at": "2013-07-20T09:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184255",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:51'></a>
Replying to [darij](#comment%3A50):
> Okay. What is the difference to `__classcall__()`?


The difference is `__classcall_private__()` is not inherited (in the sense that it is not called).



---

archive/issue_comments_184256.json:
```json
{
    "body": "<a id='comment:52'></a>\nAh, I see.",
    "created_at": "2013-07-20T09:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184256",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:52'></a>
Ah, I see.



---

archive/issue_events_131972.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:09:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131972"
}
```



---

archive/issue_events_131973.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:09:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131973"
}
```



---

archive/issue_comments_184257.json:
```json
{
    "body": "<a id='comment:54'></a>\nWhy 5.12? There's currently a ton of stuff depending on this patch, and merging will not become easier just because we wait a few more weeks...",
    "created_at": "2013-07-21T21:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184257",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:54'></a>
Why 5.12? There's currently a ton of stuff depending on this patch, and merging will not become easier just because we wait a few more weeks...



---

archive/issue_events_131974.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:47:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131974"
}
```



---

archive/issue_events_131975.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:47:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131975"
}
```



---

archive/issue_comments_184258.json:
```json
{
    "body": "**Changing dependencies** from \"#8386 #14519 #14808\" to \"#8386 #14519 #14808 #14143 #14015 #14516\".",
    "created_at": "2013-08-02T14:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184258",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#8386 #14519 #14808" to "#8386 #14519 #14808 #14143 #14015 #14516".



---

archive/issue_events_131976.json:
```json
{
    "actor": "https://github.com/jeffpferreira",
    "created_at": "2013-08-07T22:31:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131976"
}
```



---

archive/issue_events_131977.json:
```json
{
    "actor": "https://github.com/jeffpferreira",
    "created_at": "2013-08-07T22:31:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131977"
}
```



---

archive/issue_comments_184259.json:
```json
{
    "body": "<a id='comment:56'></a>\nWith this applied to 5.11.rc0:\n\n```\n$ hg qapplied\ntrac_7983-major_index_and_other_tableau_fixes-dg.patch\ntrac_7983-review-ts.patch\ntrac_8386_really_just_moving-fc.patch\ntrac_8386_big_clean_fc.patch\ntrac_8386_assert_removal.patch\ntrac_14516-crystals_speedup-ts.patch\ntrac_14519-cynthonize_element_wrapper-ts.patch\ntrac_14808-recoils_of_permutations-ts.patch\ntrac_14772-remove_cc_permutations-ts.patch\n```\n\nI get a doctest error:\n\n```\n$ sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py\n...\n1 item had failures:\n   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests\n    [327 tests, 1 failure, 88.66 s]\n----------------------------------------------------------------------\nsage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nNo error when I `qpop` trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-07T22:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184259",
    "user": "https://github.com/jeffpferreira"
}
```

<a id='comment:56'></a>
With this applied to 5.11.rc0:

```
$ hg qapplied
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_7983-review-ts.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14516-crystals_speedup-ts.patch
trac_14519-cynthonize_element_wrapper-ts.patch
trac_14808-recoils_of_permutations-ts.patch
trac_14772-remove_cc_permutations-ts.patch
```

I get a doctest error:

```
$ sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py
...
1 item had failures:
   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests
    [327 tests, 1 failure, 88.66 s]
----------------------------------------------------------------------
sage -t --long /Applications/sage/devel/sage/sage/doctest/sources.py  # 1 doctest failed
----------------------------------------------------------------------
```

No error when I `qpop` trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_184260.json:
```json
{
    "body": "**Changing reviewer** from \"Mike Hansen, Darij Grinberg\" to \"Mike Hansen, Darij Grinberg, Jeff Ferreira\".",
    "created_at": "2013-08-07T23:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184260",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Mike Hansen, Darij Grinberg" to "Mike Hansen, Darij Grinberg, Jeff Ferreira".



---

archive/issue_events_131978.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131978"
}
```



---

archive/issue_events_131979.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131979"
}
```



---

archive/issue_events_131980.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131980"
}
```



---

archive/issue_events_131981.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-07T23:20:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131981"
}
```



---

archive/issue_comments_184261.json:
```json
{
    "body": "<a id='comment:57'></a>\nFixed. I think I removed a test from the options after I did a check on the sources. Thanks for catching that.\n\n```\nDoctesting 1 file.\nsage -t --long ../doctest/sources.py\n    [327 tests, 130.57 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 131.0 seconds\n    cpu time: 121.6 seconds\n    cumulative wall time: 130.6 seconds\n```\n\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-07T23:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184261",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:57'></a>
Fixed. I think I removed a test from the options after I did a check on the sources. Thanks for catching that.

```
Doctesting 1 file.
sage -t --long ../doctest/sources.py
    [327 tests, 130.57 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 131.0 seconds
    cpu time: 121.6 seconds
    cumulative wall time: 130.6 seconds
```

For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/attachments_019877.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14772-remove_cc_permutations-ts.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14772/trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-16T18:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_184262.json:
```json
{
    "body": "",
    "created_at": "2013-08-16T18:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184262",
    "user": "https://github.com/tscrim"
}
```





---

archive/issue_comments_184263.json:
```json
{
    "body": "<a id='comment:58'></a>\nTrivial rebase over #14863.\n\nFor patchbot:\n\nApply: trac_14772-remove_cc_permutations-ts.patch",
    "created_at": "2013-08-16T18:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184263",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:58'></a>
Trivial rebase over #14863.

For patchbot:

Apply: trac_14772-remove_cc_permutations-ts.patch



---

archive/issue_comments_184264.json:
```json
{
    "body": "**Changing dependencies** from \"#8386 #14519 #14808 #14143 #14015 #14516\" to \"#8386 #14519 #14808 #14143 #14015 #14516 #14863\".",
    "created_at": "2013-08-16T18:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184264",
    "user": "https://github.com/tscrim"
}
```

**Changing dependencies** from "#8386 #14519 #14808 #14143 #14015 #14516" to "#8386 #14519 #14808 #14143 #14015 #14516 #14863".



---

archive/issue_events_131982.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T12:04:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131982"
}
```



---

archive/issue_events_131983.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T12:04:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131983"
}
```



---

archive/issue_comments_184265.json:
```json
{
    "body": "<a id='comment:59'></a>\nThere is something wrong !\n\nBefore applying this patch:\n\n```\nsage: Permutation([3,2,1])\n```\n\nAfter applying this patch:\n\n``` \nsage: Permutation([3,2,1])\nTraceback (most recent call last)\n...\nTypeError: __init__() got multiple values for keyword argument 'parent'\n```\n\nHow can that be an error (and what does that error message tell me)?",
    "created_at": "2013-08-19T12:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184265",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:59'></a>
There is something wrong !

Before applying this patch:

```
sage: Permutation([3,2,1])
```

After applying this patch:

``` 
sage: Permutation([3,2,1])
Traceback (most recent call last)
...
TypeError: __init__() got multiple values for keyword argument 'parent'
```

How can that be an error (and what does that error message tell me)?



---

archive/issue_comments_184266.json:
```json
{
    "body": "<a id='comment:60'></a>\nWeird, because I'm not getting this error. Can you quote the whole traceback maybe?",
    "created_at": "2013-08-19T12:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184266",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:60'></a>
Weird, because I'm not getting this error. Can you quote the whole traceback maybe?



---

archive/issue_comments_184267.json:
```json
{
    "body": "<a id='comment:61'></a>\nI'm glad that this is not intentional.  I was worried that this patch made more significant changes to the use of the `Permutation` class.\n\n```\nsage: Permutation([3,2,1])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-b3e6779bea6e> in <module>()\n----> 1 Permutation([Integer(3),Integer(2),Integer(1)])\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1224)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/combinat/permutation.pyc in __classcall_private__(cls, l, check_input)\n    499 \n    500         # otherwise, it gets processed by CombinatorialObject's __init__.\n--> 501         return Permutations()(l, check_input=check_input)\n    502 \n    503     def __init__(self, parent, l, check_input=True):\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8154)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4278)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4089)()\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in _element_constructor_from_element_class(self, *args, **keywords)\n    337                 17\n    338             \"\"\"\n--> 339             return self.element_class(parent = self, *args, **keywords)\n    340 \n    341         def is_parent_of(self, element):\n\n/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1243)()\n\nTypeError: __init__() got multiple values for keyword argument 'parent'\n```",
    "created_at": "2013-08-19T12:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184267",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:61'></a>
I'm glad that this is not intentional.  I was worried that this patch made more significant changes to the use of the `Permutation` class.

```
sage: Permutation([3,2,1])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-b3e6779bea6e> in <module>()
----> 1 Permutation([Integer(3),Integer(2),Integer(1)])

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1224)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/combinat/permutation.pyc in __classcall_private__(cls, l, check_input)
    499 
    500         # otherwise, it gets processed by CombinatorialObject's __init__.
--> 501         return Permutations()(l, check_input=check_input)
    502 
    503     def __init__(self, parent, l, check_input=True):

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8154)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4278)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (sage/structure/coerce_maps.c:4089)()

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/categories/sets_cat.pyc in _element_constructor_from_element_class(self, *args, **keywords)
    337                 17
    338             """
--> 339             return self.element_class(parent = self, *args, **keywords)
    340 
    341         def is_parent_of(self, element):

/Applications/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/misc/classcall_metaclass.so in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (sage/misc/classcall_metaclass.c:1243)()

TypeError: __init__() got multiple values for keyword argument 'parent'
```



---

archive/issue_comments_184268.json:
```json
{
    "body": "<a id='comment:62'></a>\nI think this is because you don't have #14519 applied. Is that so?",
    "created_at": "2013-08-19T12:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184268",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:62'></a>
I think this is because you don't have #14519 applied. Is that so?



---

archive/issue_comments_184269.json:
```json
{
    "body": "<a id='comment:63'></a>\nYes.  That was missing and it seems to work fine.  This was my fault.  Thanks for helping.",
    "created_at": "2013-08-19T13:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184269",
    "user": "https://github.com/zabrocki"
}
```

<a id='comment:63'></a>
Yes.  That was missing and it seems to work fine.  This was my fault.  Thanks for helping.



---

archive/issue_events_131984.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T13:08:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131984"
}
```



---

archive/issue_events_131985.json:
```json
{
    "actor": "https://github.com/zabrocki",
    "created_at": "2013-08-19T13:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131985"
}
```



---

archive/issue_comments_184270.json:
```json
{
    "body": "**Merged:** sage-5.12.beta3",
    "created_at": "2013-08-20T12:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14772#issuecomment-184270",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.12.beta3



---

archive/issue_events_131986.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131986"
}
```



---

archive/issue_events_131987.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:56:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14772",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14772#event-131987"
}
```
