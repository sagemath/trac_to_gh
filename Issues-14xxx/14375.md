# Issue 14375: Indicate escape codes in doctest output

archive/issues_014171.json:
```json
{
    "assignees": [],
    "body": "Split off from #14290.\n\n**Apply** [and [attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/31a93527a651e9cbb198efee55ce81ac.patch](https://github.com/sagemath/sage/files/ticket14375/6a95bfac957d777bae0c0e18f3a51617.patch))\n\n**Assignee:** @roed314\n\n**CC:**  @vbraun\n\n**Reviewer:** Jeroen Demeyer, Volker Braun\n\n**Author:** Volker Braun\n\n**Merged:** sage-5.10.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/14375\n\n",
    "closed_at": "2013-05-13T13:24:46Z",
    "created_at": "2013-03-28T19:08:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Indicate escape codes in doctest output",
    "type": "issue",
    "updated_at": "2013-05-13T13:24:46Z",
    "url": "https://github.com/sagemath/sage/issues/14375",
    "user": "https://github.com/jdemeyer"
}
```
Split off from #14290.

**Apply** [and [attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/31a93527a651e9cbb198efee55ce81ac.patch](https://github.com/sagemath/sage/files/ticket14375/6a95bfac957d777bae0c0e18f3a51617.patch))

**Assignee:** @roed314

**CC:**  @vbraun

**Reviewer:** Jeroen Demeyer, Volker Braun

**Author:** Volker Braun

**Merged:** sage-5.10.beta3

Issue created by migration from https://trac.sagemath.org/ticket/14375





---

archive/issue_comments_175243.json:
```json
{
    "body": "**Attachment:** [trac_14375_ansi_escapes_indication.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.patch.gz)",
    "created_at": "2013-03-28T19:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175243",
    "user": "https://github.com/roed314"
}
```

**Attachment:** [trac_14375_ansi_escapes_indication.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.patch.gz)



---

archive/issue_comments_175244.json:
```json
{
    "body": "<a id='comment:1'></a>\nApparently CSI stands for Control Sequence Introducer (see [wikipedia](http://en.wikipedia.org/wiki/ANSI_escape_code)).",
    "created_at": "2013-03-28T19:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175244",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>
Apparently CSI stands for Control Sequence Introducer (see [wikipedia](http://en.wikipedia.org/wiki/ANSI_escape_code)).



---

archive/issue_comments_175245.json:
```json
{
    "body": "<a id='comment:2'></a>\nAs for \\x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.",
    "created_at": "2013-03-28T19:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175245",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>
As for \x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.



---

archive/issue_comments_175246.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@roed314](#comment%3A2):\n> As for \\x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.\n\nAnd how are you going to distinguish between `\\x9b` appearing as part of a UTF-8 code?",
    "created_at": "2013-03-28T19:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175246",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Replying to [@roed314](#comment%3A2):
> As for \x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.

And how are you going to distinguish between `\x9b` appearing as part of a UTF-8 code?



---

archive/issue_comments_175247.json:
```json
{
    "body": "<a id='comment:4'></a>\nDon't shoot the messenger about the \\x9b CSI, I just implemented the specs ;-)\n\nAs far as I know the whole Python 2.x doctesting just operates on byte strings without any unicode awareness (see also #14359). How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8?",
    "created_at": "2013-03-28T20:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175247",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Don't shoot the messenger about the \x9b CSI, I just implemented the specs ;-)

As far as I know the whole Python 2.x doctesting just operates on byte strings without any unicode awareness (see also #14359). How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8?



---

archive/issue_events_124775.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
    "label_color": "08517b",
    "label_name": "component: doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124775"
}
```



---

archive/issue_events_124776.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
    "label_color": "08517b",
    "label_name": "component: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124776"
}
```



---

archive/issue_comments_175248.json:
```json
{
    "body": "**Changing assignee** from mvngu to @roed314.",
    "created_at": "2013-03-28T23:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175248",
    "user": "https://github.com/roed314"
}
```

**Changing assignee** from mvngu to @roed314.



---

archive/issue_comments_175249.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@vbraun](#comment%3A4):\n> How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8? \n\nIt's essentially undefined, it could be anything. But it could be UTF-8 with a `\\x9b` byte appearing not from a CSI.\n\nUnrelated: I really like Python's `.*?` for regular expressions, this is a nice use of that.",
    "created_at": "2013-03-29T05:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175249",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [@vbraun](#comment%3A4):
> How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8? 

It's essentially undefined, it could be anything. But it could be UTF-8 with a `\x9b` byte appearing not from a CSI.

Unrelated: I really like Python's `.*?` for regular expressions, this is a nice use of that.



---

archive/issue_comments_175250.json:
```json
{
    "body": "<a id='comment:7'></a>\nWe don't have a doctest that spews wide UTF-8 characters containing \\x1b or \\x9b. The proper solution is to make the doctest framework use unicode instead of byte strings. We will have to revisit this when we switch to python 3. But at this point I don't think there is anything that I can do on this ticket.",
    "created_at": "2013-03-29T10:38:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175250",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
We don't have a doctest that spews wide UTF-8 characters containing \x1b or \x9b. The proper solution is to make the doctest framework use unicode instead of byte strings. We will have to revisit this when we switch to python 3. But at this point I don't think there is anything that I can do on this ticket.



---

archive/issue_comments_175251.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@vbraun](#comment%3A7):\n> We don't have a doctest that spews wide UTF-8 characters containing \\x1b or \\x9b.\n\n....yet\n\n> The proper solution is to make the doctest framework use unicode instead of byte strings.\n\nIndeed, see #14153.\n\n> But at this point I don't think there is anything that I can do on this ticket.\n\nSince those `\\x9b` codes are rarely/never actually used, simply leave them alone. I think that would be a good compromise.",
    "created_at": "2013-03-29T16:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175251",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [@vbraun](#comment%3A7):
> We don't have a doctest that spews wide UTF-8 characters containing \x1b or \x9b.

....yet

> The proper solution is to make the doctest framework use unicode instead of byte strings.

Indeed, see #14153.

> But at this point I don't think there is anything that I can do on this ticket.

Since those `\x9b` codes are rarely/never actually used, simply leave them alone. I think that would be a good compromise.



---

archive/issue_comments_175252.json:
```json
{
    "body": "<a id='comment:9'></a>\nCan we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings. \n\nIf/when we switch to a unicode framework we just replace the byte string regex by its unicode version. There is still a single code point `U+009B` for CSI in addition to the two code point version `U+001B[`. There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.",
    "created_at": "2013-03-29T17:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175252",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings. 

If/when we switch to a unicode framework we just replace the byte string regex by its unicode version. There is still a single code point `U+009B` for CSI in addition to the two code point version `U+001B[`. There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.



---

archive/issue_comments_175253.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@vbraun](#comment%3A9):\n> Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings.\n\nWe're actually using quite little of the Python doctest module. Besides, with Python's duck-typing, there is not that much difference between strings and unicode strings.\n\n> There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.\n\nWhat I'm trying to say is that the current string version of the doctesting framework might see byte strings encoded as UTF-8, even when not using the `unicode` type. Remember that Sage uses UTF-8 encoded source files, so any strings defined in doctests will be encoded as UTF-8.",
    "created_at": "2013-03-29T17:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175253",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [@vbraun](#comment%3A9):
> Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings.

We're actually using quite little of the Python doctest module. Besides, with Python's duck-typing, there is not that much difference between strings and unicode strings.

> There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.

What I'm trying to say is that the current string version of the doctesting framework might see byte strings encoded as UTF-8, even when not using the `unicode` type. Remember that Sage uses UTF-8 encoded source files, so any strings defined in doctests will be encoded as UTF-8.



---

archive/issue_comments_175254.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2013-03-29T17:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175254",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Volker Braun



---

archive/issue_comments_175255.json:
```json
{
    "body": "<a id='comment:11'></a>\nMix & matching byte string and unicode mostly works if you are willing to ignore the UnicodeWarning ;-)\n\nI agree that the doctest code can see arbitrary binary data (including UTF-8) right now as anything might be printed by the code being tested. Its possible (but unlikely) that some of the non-ascii garbage will be translated into `<ESC-?>` by this patch. So what? The end goal should be unicode + 100% coverage of ansi control sequences, and this patch is closer to that goal than leaving out some random control sequences because they aren't used much.",
    "created_at": "2013-03-29T18:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175255",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Mix & matching byte string and unicode mostly works if you are willing to ignore the UnicodeWarning ;-)

I agree that the doctest code can see arbitrary binary data (including UTF-8) right now as anything might be printed by the code being tested. Its possible (but unlikely) that some of the non-ascii garbage will be translated into `<ESC-?>` by this patch. So what? The end goal should be unicode + 100% coverage of ansi control sequences, and this patch is closer to that goal than leaving out some random control sequences because they aren't used much.



---

archive/issue_comments_175256.json:
```json
{
    "body": "<a id='comment:12'></a>\nPut it a different way: imagine we see a `\\x9b` in doctest output, which is more likely:\n1. It is part of a UTF-8 sequence.\n2. It is a CSI code in a different encoding.\n\nI would say the first is more likely.",
    "created_at": "2013-03-29T18:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175256",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Put it a different way: imagine we see a `\x9b` in doctest output, which is more likely:
1. It is part of a UTF-8 sequence.
2. It is a CSI code in a different encoding.

I would say the first is more likely.



---

archive/issue_events_124777.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-03-29T18:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124777"
}
```



---

archive/issue_comments_175257.json:
```json
{
    "body": "<a id='comment:13'></a>\nSince all doctests pass with this ticket I'm pretty sure we are talking about the empty set. Both are currently equally likely, with probability zero.",
    "created_at": "2013-03-29T18:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175257",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Since all doctests pass with this ticket I'm pretty sure we are talking about the empty set. Both are currently equally likely, with probability zero.



---

archive/issue_comments_175258.json:
```json
{
    "body": "<a id='comment:14'></a>\nAny conclusion on `\\x9b`?",
    "created_at": "2013-04-03T08:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175258",
    "user": "https://github.com/roed314"
}
```

<a id='comment:14'></a>
Any conclusion on `\x9b`?



---

archive/issue_comments_175259.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@roed314](#comment%3A14):\n> Any conclusion on `\\x9b`?\n\nYes, unfortunately, two different conclusions depending on who you ask :-)",
    "created_at": "2013-04-03T08:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175259",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [@roed314](#comment%3A14):
> Any conclusion on `\x9b`?

Yes, unfortunately, two different conclusions depending on who you ask :-)



---

archive/issue_comments_175260.json:
```json
{
    "body": "Version with the wrong regex",
    "created_at": "2013-04-03T12:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175260",
    "user": "https://github.com/vbraun"
}
```

Version with the wrong regex



---

archive/issue_comments_175261.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Attachment:** [trac_14375_ansi_escapes_indication.2.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz)\n\nSince incomplete coverage of escape codes is still better than doing nothing at all, here is a version of the patch with the wrong regex.",
    "created_at": "2013-04-03T12:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175261",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
**Attachment:** [trac_14375_ansi_escapes_indication.2.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz)

Since incomplete coverage of escape codes is still better than doing nothing at all, here is a version of the patch with the wrong regex.



---

archive/issue_comments_175262.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe \"right\" regex would obviously be the UTF-8 encoded version of `\\x9b`, not the byte `\\x9b` itself.",
    "created_at": "2013-04-03T18:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175262",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
The "right" regex would obviously be the UTF-8 encoded version of `\x9b`, not the byte `\x9b` itself.



---

archive/issue_comments_175263.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe UTF-8 encoded `\\x1b` / `x9b` won't match escape sequences unless we encode the output of the doctest in UTF-8. Right now its byte strings. Once we switch to unicode we have to match the `U+001B` / `U+009B` code points. At no point is it a good idea to match for UTF-8 encoded escape sequences imho.",
    "created_at": "2013-04-03T18:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175263",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
The UTF-8 encoded `\x1b` / `x9b` won't match escape sequences unless we encode the output of the doctest in UTF-8. Right now its byte strings. Once we switch to unicode we have to match the `U+001B` / `U+009B` code points. At no point is it a good idea to match for UTF-8 encoded escape sequences imho.



---

archive/issue_comments_175264.json:
```json
{
    "body": "<a id='comment:19'></a>\nIf we ever have a `\\x9b` byte coming out of a doctest, I'd like it to fail doctesting so that we can figure out what it actually was.  Perhaps we should look for that byte and raise an error message referencing this ticket?",
    "created_at": "2013-04-03T18:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175264",
    "user": "https://github.com/roed314"
}
```

<a id='comment:19'></a>
If we ever have a `\x9b` byte coming out of a doctest, I'd like it to fail doctesting so that we can figure out what it actually was.  Perhaps we should look for that byte and raise an error message referencing this ticket?



---

archive/issue_comments_175265.json:
```json
{
    "body": "<a id='comment:20'></a>\nOr you take the first version of the patch and it'll be printed as CSI.",
    "created_at": "2013-04-03T19:18:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175265",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>
Or you take the first version of the patch and it'll be printed as CSI.



---

archive/issue_comments_175266.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@vbraun](#comment%3A20):\n> Or you take the first version of the patch and it'll be printed as CSI.\n\nYeah.  I'm fine with that, but apparently Jeroen isn't.",
    "created_at": "2013-04-03T19:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175266",
    "user": "https://github.com/roed314"
}
```

<a id='comment:21'></a>
Replying to [@vbraun](#comment%3A20):
> Or you take the first version of the patch and it'll be printed as CSI.

Yeah.  I'm fine with that, but apparently Jeroen isn't.



---

archive/issue_comments_175267.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@vbraun](#comment%3A18):\n> Right now its byte strings.\n\nWhich simply means that the encoding is \"undefined\". It's not the opposite of UTF-8. It's maybe UTF-8, maybe something else.\n\n> Once we switch to unicode\n\n\"We\" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.\n\n> At no point is it a good idea to match for UTF-8 encoded escape sequences imho.\n\nFair enough, but I think matching literal `\\x9b` bytes is even worse.",
    "created_at": "2013-04-03T20:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175267",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [@vbraun](#comment%3A18):
> Right now its byte strings.

Which simply means that the encoding is "undefined". It's not the opposite of UTF-8. It's maybe UTF-8, maybe something else.

> Once we switch to unicode

"We" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.

> At no point is it a good idea to match for UTF-8 encoded escape sequences imho.

Fair enough, but I think matching literal `\x9b` bytes is even worse.



---

archive/issue_comments_175268.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@jdemeyer](#comment%3A22):\n> \"We\" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.\n\nThe terminal has no say in doctesting. The \"want\" is UTF-8 (or at least comes from the UTF-8 encoded sage source), but the \"got\" is whatever byte string was printed by the worker.",
    "created_at": "2013-04-03T21:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175268",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>
Replying to [@jdemeyer](#comment%3A22):
> "We" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.

The terminal has no say in doctesting. The "want" is UTF-8 (or at least comes from the UTF-8 encoded sage source), but the "got" is whatever byte string was printed by the worker.



---

archive/issue_comments_175269.json:
```json
{
    "body": "<a id='comment:24'></a>\nPlease review my reviewer patch.",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175269",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Please review my reviewer patch.



---

archive/issue_comments_175270.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175270",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_175271.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Split off from #14290.\n+\n+**Apply** [and [attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/31a93527a651e9cbb198efee55ce81ac.patch](https://github.com/sagemath/sage/files/ticket14375/6a95bfac957d777bae0c0e18f3a51617.patch))\n``````\n",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175271",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Split off from #14290.
+
+**Apply** [and [attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/31a93527a651e9cbb198efee55ce81ac.patch](https://github.com/sagemath/sage/files/ticket14375/6a95bfac957d777bae0c0e18f3a51617.patch))
``````




---

archive/issue_comments_175272.json:
```json
{
    "body": "<a id='comment:25'></a>\n*** ping ***\n\n[attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch) needs review.",
    "created_at": "2013-05-09T07:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175272",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
*** ping ***

[attachment:14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch) needs review.



---

archive/issue_events_124778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-09T08:34:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124778"
}
```



---

archive/issue_events_124779.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-09T08:34:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124779"
}
```



---

archive/issue_comments_175273.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Volker Braun\".",
    "created_at": "2013-05-09T08:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175273",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Volker Braun".



---

archive/issue_comments_175274.json:
```json
{
    "body": "<a id='comment:26'></a>\nI don't agree with it but its still an improvement over the current state, so positive review.",
    "created_at": "2013-05-09T08:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175274",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
I don't agree with it but its still an improvement over the current state, so positive review.



---

archive/issue_events_124780.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-10T07:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124780"
}
```



---

archive/issue_events_124781.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-10T07:54:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124781"
}
```



---

archive/issue_comments_175275.json:
```json
{
    "body": "<a id='comment:27'></a>\n\n```\n! Package inputenc Error: Keyboard character used is undefined\n(inputenc)                in inputencoding `utf8x'.\n\nSee the inputenc package documentation for explanation.\nType  H <return>  for immediate help.\n ...                                              \n                                                  \nl.3239 ...is is ^^[[1mbold^^[[0m text}\\PYG{l+s}{'}\n                                                  \n? \n! Emergency stop.\n ...                                              \n                                                  \nl.3239 ...is is ^^[[1mbold^^[[0m text}\\PYG{l+s}{'}\n                                                  \n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on doctest.log.\n```",
    "created_at": "2013-05-10T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175275",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>

```
! Package inputenc Error: Keyboard character used is undefined
(inputenc)                in inputencoding `utf8x'.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.3239 ...is is ^^[[1mbold^^[[0m text}\PYG{l+s}{'}
                                                  
? 
! Emergency stop.
 ...                                              
                                                  
l.3239 ...is is ^^[[1mbold^^[[0m text}\PYG{l+s}{'}
                                                  
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on doctest.log.
```



---

archive/issue_comments_175276.json:
```json
{
    "body": "<a id='comment:28'></a>\nOh we are still building pdf docs, that uses the deprecated utf8x that doesn't even ship with TeXlive-2012 any more. Here is first version of a patch that fixes that. Still needs some work...",
    "created_at": "2013-05-10T11:38:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175276",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
Oh we are still building pdf docs, that uses the deprecated utf8x that doesn't even ship with TeXlive-2012 any more. Here is first version of a patch that fixes that. Still needs some work...



---

archive/issue_comments_175277.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-05-10T13:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175277",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_175278.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Attachment:** [14375_inputenc.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_inputenc.patch.gz)\n\nEverything works now for me...",
    "created_at": "2013-05-10T13:58:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175278",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
**Attachment:** [14375_inputenc.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_inputenc.patch.gz)

Everything works now for me...



---

archive/issue_events_124782.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-10T13:58:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124782"
}
```



---

archive/issue_events_124783.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-10T13:58:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124783"
}
```



---

archive/issue_comments_175279.json:
```json
{
    "body": "**Attachment:** [14375_review.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)",
    "created_at": "2013-05-11T12:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175279",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [14375_review.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)



---

archive/issue_comments_175280.json:
```json
{
    "body": "<a id='comment:30'></a>\nVolker, I confirm the utf8 problem, but that's for a different ticket (I don't know enough about `TeX` to review that): #14571.\n\nI fixed the problem on this ticket by simply using a `r\"\"\"` string instead of `\"\"\"`. Needs review.",
    "created_at": "2013-05-12T09:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Volker, I confirm the utf8 problem, but that's for a different ticket (I don't know enough about `TeX` to review that): #14571.

I fixed the problem on this ticket by simply using a `r"""` string instead of `"""`. Needs review.



---

archive/issue_comments_175281.json:
```json
{
    "body": "<a id='comment:31'></a>\nWell I can't test it because TeXlive doesn't ship utf8x any more.",
    "created_at": "2013-05-12T09:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175281",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
Well I can't test it because TeXlive doesn't ship utf8x any more.



---

archive/issue_events_124784.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T09:44:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124784"
}
```



---

archive/issue_events_124785.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T09:44:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124785"
}
```



---

archive/issue_comments_175282.json:
```json
{
    "body": "**Merged:** sage-5.10.beta3",
    "created_at": "2013-05-13T13:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-175282",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.beta3



---

archive/issue_events_124786.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:24:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124786"
}
```



---

archive/issue_events_124787.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:24:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-124787"
}
```
