# Issue 14375: Indicate escape codes in doctest output

archive/issues_014171.json:
```json
{
    "assignees": [
        "https://github.com/roed314"
    ],
    "body": "Split off from #14290.\n\n**Apply** [attachment: trac_14375_ansi_escapes_indication.2.patch](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz) and [attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)\n\nCC:  @vbraun\n\nReviewer: **Jeroen Demeyer, Volker Braun**\n\nAuthor: **Volker Braun**\n\nMerged: **sage-5.10.beta3**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14375_\n\n",
    "closed_at": "2013-05-13T13:24:46Z",
    "created_at": "2013-03-28T19:08:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Indicate escape codes in doctest output",
    "type": "issue",
    "updated_at": "2013-05-13T13:24:46Z",
    "url": "https://github.com/sagemath/sage/issues/14375",
    "user": "https://github.com/jdemeyer"
}
```
Split off from #14290.

**Apply** [attachment: trac_14375_ansi_escapes_indication.2.patch](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz) and [attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)

CC:  @vbraun

Reviewer: **Jeroen Demeyer, Volker Braun**

Author: **Volker Braun**

Merged: **sage-5.10.beta3**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/14375_





---

archive/issue_events_201193.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-28T19:08:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201193"
}
```



---

archive/issue_events_201194.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-28T19:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201194"
}
```



---

archive/issue_events_201195.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-28T19:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201195"
}
```



---

archive/issue_events_201196.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-28T19:08:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201196"
}
```



---

archive/issue_events_201197.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2013-03-28T19:08:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201197"
}
```



---

archive/issue_comments_172840.json:
```json
{
    "body": "Attachment: **[trac_14375_ansi_escapes_indication.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.patch.gz)**",
    "created_at": "2013-03-28T19:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172840",
    "user": "https://github.com/roed314"
}
```

Attachment: **[trac_14375_ansi_escapes_indication.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.patch.gz)**



---

archive/issue_comments_172841.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nApparently CSI stands for Control Sequence Introducer (see [wikipedia](http://en.wikipedia.org/wiki/ANSI_escape_code)).",
    "created_at": "2013-03-28T19:14:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172841",
    "user": "https://github.com/roed314"
}
```

<div id="comment:1" align="right">comment:1</div>

Apparently CSI stands for Control Sequence Introducer (see [wikipedia](http://en.wikipedia.org/wiki/ANSI_escape_code)).



---

archive/issue_comments_172842.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs for \\x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.",
    "created_at": "2013-03-28T19:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172842",
    "user": "https://github.com/roed314"
}
```

<div id="comment:2" align="right">comment:2</div>

As for \x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.



---

archive/issue_comments_172843.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@roed314](#comment:2):\n> As for \\x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.\n\nAnd how are you going to distinguish between `\\x9b` appearing as part of a UTF-8 code?",
    "created_at": "2013-03-28T19:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172843",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@roed314](#comment:2):
> As for \x9b, I don't have a strong opinion.  I guess I would lean toward escaping it, since it is a valid CSI.

And how are you going to distinguish between `\x9b` appearing as part of a UTF-8 code?



---

archive/issue_comments_172844.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDon't shoot the messenger about the \\x9b CSI, I just implemented the specs ;-)\n\nAs far as I know the whole Python 2.x doctesting just operates on byte strings without any unicode awareness (see also #14359). How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8?",
    "created_at": "2013-03-28T20:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172844",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

Don't shoot the messenger about the \x9b CSI, I just implemented the specs ;-)

As far as I know the whole Python 2.x doctesting just operates on byte strings without any unicode awareness (see also #14359). How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8?



---

archive/issue_events_201198.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201198"
}
```



---

archive/issue_events_201199.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201199"
}
```



---

archive/issue_events_201200.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "subject": "https://github.com/roed314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201200"
}
```



---

archive/issue_events_201201.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T23:28:46Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "subject": "https://github.com/roed314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201201"
}
```



---

archive/issue_comments_172845.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@vbraun](#comment:4):\n> How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8? \n\nIt's essentially undefined, it could be anything. But it could be UTF-8 with a `\\x9b` byte appearing not from a CSI.\n\nUnrelated: I really like Python's `.*?` for regular expressions, this is a nice use of that.",
    "created_at": "2013-03-29T05:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172845",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@vbraun](#comment:4):
> How do you specify the encoding of the doctest output, for starters? Since when is it UTF-8? 

It's essentially undefined, it could be anything. But it could be UTF-8 with a `\x9b` byte appearing not from a CSI.

Unrelated: I really like Python's `.*?` for regular expressions, this is a nice use of that.



---

archive/issue_comments_172846.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWe don't have a doctest that spews wide UTF-8 characters containing \\x1b or \\x9b. The proper solution is to make the doctest framework use unicode instead of byte strings. We will have to revisit this when we switch to python 3. But at this point I don't think there is anything that I can do on this ticket.",
    "created_at": "2013-03-29T10:38:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172846",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

We don't have a doctest that spews wide UTF-8 characters containing \x1b or \x9b. The proper solution is to make the doctest framework use unicode instead of byte strings. We will have to revisit this when we switch to python 3. But at this point I don't think there is anything that I can do on this ticket.



---

archive/issue_comments_172847.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@vbraun](#comment:7):\n> We don't have a doctest that spews wide UTF-8 characters containing \\x1b or \\x9b.\n\n....yet\n\n> The proper solution is to make the doctest framework use unicode instead of byte strings.\n\nIndeed, see #14153.\n\n> But at this point I don't think there is anything that I can do on this ticket.\n\nSince those `\\x9b` codes are rarely/never actually used, simply leave them alone. I think that would be a good compromise.",
    "created_at": "2013-03-29T16:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172847",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@vbraun](#comment:7):
> We don't have a doctest that spews wide UTF-8 characters containing \x1b or \x9b.

....yet

> The proper solution is to make the doctest framework use unicode instead of byte strings.

Indeed, see #14153.

> But at this point I don't think there is anything that I can do on this ticket.

Since those `\x9b` codes are rarely/never actually used, simply leave them alone. I think that would be a good compromise.



---

archive/issue_comments_172848.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nCan we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings. \n\nIf/when we switch to a unicode framework we just replace the byte string regex by its unicode version. There is still a single code point `U+009B` for CSI in addition to the two code point version `U+001B[`. There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.",
    "created_at": "2013-03-29T17:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172848",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings. 

If/when we switch to a unicode framework we just replace the byte string regex by its unicode version. There is still a single code point `U+009B` for CSI in addition to the two code point version `U+001B[`. There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.



---

archive/issue_comments_172849.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@vbraun](#comment:9):\n> Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings.\n\nWe're actually using quite little of the Python doctest module. Besides, with Python's duck-typing, there is not that much difference between strings and unicode strings.\n\n> There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.\n\nWhat I'm trying to say is that the current string version of the doctesting framework might see byte strings encoded as UTF-8, even when not using the `unicode` type. Remember that Sage uses UTF-8 encoded source files, so any strings defined in doctests will be encoded as UTF-8.",
    "created_at": "2013-03-29T17:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172849",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@vbraun](#comment:9):
> Can we actually finish #14153 before switching to python 3? Without checking, I would guess that there are tons of things that will go wrong when feeding the python 2.7 doctest module with unicode strings.

We're actually using quite little of the Python doctest module. Besides, with Python's duck-typing, there is not that much difference between strings and unicode strings.

> There is no compromise needed since the byte string version of this ticket should never meet the unicode version of the doctest framework.

What I'm trying to say is that the current string version of the doctesting framework might see byte strings encoded as UTF-8, even when not using the `unicode` type. Remember that Sage uses UTF-8 encoded source files, so any strings defined in doctests will be encoded as UTF-8.



---

archive/issue_comments_172850.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2013-03-29T17:53:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172850",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Volker Braun**



---

archive/issue_comments_172851.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMix & matching byte string and unicode mostly works if you are willing to ignore the UnicodeWarning ;-)\n\nI agree that the doctest code can see arbitrary binary data (including UTF-8) right now as anything might be printed by the code being tested. Its possible (but unlikely) that some of the non-ascii garbage will be translated into `<ESC-?>` by this patch. So what? The end goal should be unicode + 100% coverage of ansi control sequences, and this patch is closer to that goal than leaving out some random control sequences because they aren't used much.",
    "created_at": "2013-03-29T18:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172851",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Mix & matching byte string and unicode mostly works if you are willing to ignore the UnicodeWarning ;-)

I agree that the doctest code can see arbitrary binary data (including UTF-8) right now as anything might be printed by the code being tested. Its possible (but unlikely) that some of the non-ascii garbage will be translated into `<ESC-?>` by this patch. So what? The end goal should be unicode + 100% coverage of ansi control sequences, and this patch is closer to that goal than leaving out some random control sequences because they aren't used much.



---

archive/issue_comments_172852.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nPut it a different way: imagine we see a `\\x9b` in doctest output, which is more likely:\n1. It is part of a UTF-8 sequence.\n2. It is a CSI code in a different encoding.\n\nI would say the first is more likely.",
    "created_at": "2013-03-29T18:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172852",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Put it a different way: imagine we see a `\x9b` in doctest output, which is more likely:
1. It is part of a UTF-8 sequence.
2. It is a CSI code in a different encoding.

I would say the first is more likely.



---

archive/issue_events_201202.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-03-29T18:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201202"
}
```



---

archive/issue_comments_172853.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSince all doctests pass with this ticket I'm pretty sure we are talking about the empty set. Both are currently equally likely, with probability zero.",
    "created_at": "2013-03-29T18:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172853",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

Since all doctests pass with this ticket I'm pretty sure we are talking about the empty set. Both are currently equally likely, with probability zero.



---

archive/issue_comments_172854.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAny conclusion on `\\x9b`?",
    "created_at": "2013-04-03T08:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172854",
    "user": "https://github.com/roed314"
}
```

<div id="comment:14" align="right">comment:14</div>

Any conclusion on `\x9b`?



---

archive/issue_comments_172855.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@roed314](#comment:14):\n> Any conclusion on `\\x9b`?\n\nYes, unfortunately, two different conclusions depending on who you ask :-)",
    "created_at": "2013-04-03T08:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172855",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@roed314](#comment:14):
> Any conclusion on `\x9b`?

Yes, unfortunately, two different conclusions depending on who you ask :-)



---

archive/issue_comments_172856.json:
```json
{
    "body": "Version with the wrong regex",
    "created_at": "2013-04-03T12:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172856",
    "user": "https://github.com/vbraun"
}
```

Version with the wrong regex



---

archive/issue_comments_172857.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_14375_ansi_escapes_indication.2.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz)**\n\nSince incomplete coverage of escape codes is still better than doing nothing at all, here is a version of the patch with the wrong regex.",
    "created_at": "2013-04-03T12:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172857",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_14375_ansi_escapes_indication.2.patch.gz](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz)**

Since incomplete coverage of escape codes is still better than doing nothing at all, here is a version of the patch with the wrong regex.



---

archive/issue_comments_172858.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe \"right\" regex would obviously be the UTF-8 encoded version of `\\x9b`, not the byte `\\x9b` itself.",
    "created_at": "2013-04-03T18:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172858",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

The "right" regex would obviously be the UTF-8 encoded version of `\x9b`, not the byte `\x9b` itself.



---

archive/issue_comments_172859.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe UTF-8 encoded `\\x1b` / `x9b` won't match escape sequences unless we encode the output of the doctest in UTF-8. Right now its byte strings. Once we switch to unicode we have to match the `U+001B` / `U+009B` code points. At no point is it a good idea to match for UTF-8 encoded escape sequences imho.",
    "created_at": "2013-04-03T18:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172859",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

The UTF-8 encoded `\x1b` / `x9b` won't match escape sequences unless we encode the output of the doctest in UTF-8. Right now its byte strings. Once we switch to unicode we have to match the `U+001B` / `U+009B` code points. At no point is it a good idea to match for UTF-8 encoded escape sequences imho.



---

archive/issue_comments_172860.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIf we ever have a `\\x9b` byte coming out of a doctest, I'd like it to fail doctesting so that we can figure out what it actually was.  Perhaps we should look for that byte and raise an error message referencing this ticket?",
    "created_at": "2013-04-03T18:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172860",
    "user": "https://github.com/roed314"
}
```

<div id="comment:19" align="right">comment:19</div>

If we ever have a `\x9b` byte coming out of a doctest, I'd like it to fail doctesting so that we can figure out what it actually was.  Perhaps we should look for that byte and raise an error message referencing this ticket?



---

archive/issue_comments_172861.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOr you take the first version of the patch and it'll be printed as CSI.",
    "created_at": "2013-04-03T19:18:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172861",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:20" align="right">comment:20</div>

Or you take the first version of the patch and it'll be printed as CSI.



---

archive/issue_comments_172862.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@vbraun](#comment:20):\n> Or you take the first version of the patch and it'll be printed as CSI.\n\nYeah.  I'm fine with that, but apparently Jeroen isn't.",
    "created_at": "2013-04-03T19:23:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172862",
    "user": "https://github.com/roed314"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@vbraun](#comment:20):
> Or you take the first version of the patch and it'll be printed as CSI.

Yeah.  I'm fine with that, but apparently Jeroen isn't.



---

archive/issue_comments_172863.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@vbraun](#comment:18):\n> Right now its byte strings.\n\nWhich simply means that the encoding is \"undefined\". It's not the opposite of UTF-8. It's maybe UTF-8, maybe something else.\n\n> Once we switch to unicode\n\n\"We\" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.\n\n> At no point is it a good idea to match for UTF-8 encoded escape sequences imho.\n\nFair enough, but I think matching literal `\\x9b` bytes is even worse.",
    "created_at": "2013-04-03T20:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172863",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@vbraun](#comment:18):
> Right now its byte strings.

Which simply means that the encoding is "undefined". It's not the opposite of UTF-8. It's maybe UTF-8, maybe something else.

> Once we switch to unicode

"We" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.

> At no point is it a good idea to match for UTF-8 encoded escape sequences imho.

Fair enough, but I think matching literal `\x9b` bytes is even worse.



---

archive/issue_comments_172864.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment:22):\n> \"We\" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.\n\nThe terminal has no say in doctesting. The \"want\" is UTF-8 (or at least comes from the UTF-8 encoded sage source), but the \"got\" is whatever byte string was printed by the worker.",
    "created_at": "2013-04-03T21:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172864",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment:22):
> "We" already partially switched to UTF-8: Sage source files are UTF-8 and some terminals (more and more these days) use UTF-8 encoding by default.

The terminal has no say in doctesting. The "want" is UTF-8 (or at least comes from the UTF-8 encoded sage source), but the "got" is whatever byte string was printed by the worker.



---

archive/issue_comments_172865.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nPlease review my reviewer patch.",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172865",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Please review my reviewer patch.



---

archive/issue_comments_172866.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172866",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_172867.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Split off from #14290.\n+\n+**Apply** [attachment: trac_14375_ansi_escapes_indication.2.patch](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz) and [attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)\n``````\n",
    "created_at": "2013-05-01T07:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172867",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Split off from #14290.
+
+**Apply** [attachment: trac_14375_ansi_escapes_indication.2.patch](https://github.com/sagemath/sage/files/ticket14375/trac_14375_ansi_escapes_indication.2.patch.gz) and [attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)
``````




---

archive/issue_comments_172868.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n*** ping ***\n\n[attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz) needs review.",
    "created_at": "2013-05-09T07:43:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172868",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

*** ping ***

[attachment: 14375_review.patch](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz) needs review.



---

archive/issue_events_201203.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-09T08:34:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201203"
}
```



---

archive/issue_events_201204.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-09T08:34:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201204"
}
```



---

archive/issue_comments_172869.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Volker Braun**",
    "created_at": "2013-05-09T08:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172869",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Volker Braun**



---

archive/issue_comments_172870.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI don't agree with it but its still an improvement over the current state, so positive review.",
    "created_at": "2013-05-09T08:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172870",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:26" align="right">comment:26</div>

I don't agree with it but its still an improvement over the current state, so positive review.



---

archive/issue_events_201205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-10T07:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201205"
}
```



---

archive/issue_events_201206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-10T07:54:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201206"
}
```



---

archive/issue_comments_172871.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n\n```\n! Package inputenc Error: Keyboard character used is undefined\n(inputenc)                in inputencoding `utf8x'.\n\nSee the inputenc package documentation for explanation.\nType  H <return>  for immediate help.\n ...                                              \n                                                  \nl.3239 ...is is ^^[[1mbold^^[[0m text}\\PYG{l+s}{'}\n                                                  \n? \n! Emergency stop.\n ...                                              \n                                                  \nl.3239 ...is is ^^[[1mbold^^[[0m text}\\PYG{l+s}{'}\n                                                  \n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on doctest.log.\n```",
    "created_at": "2013-05-10T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172871",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>


```
! Package inputenc Error: Keyboard character used is undefined
(inputenc)                in inputencoding `utf8x'.

See the inputenc package documentation for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.3239 ...is is ^^[[1mbold^^[[0m text}\PYG{l+s}{'}
                                                  
? 
! Emergency stop.
 ...                                              
                                                  
l.3239 ...is is ^^[[1mbold^^[[0m text}\PYG{l+s}{'}
                                                  
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on doctest.log.
```



---

archive/issue_comments_172872.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOh we are still building pdf docs, that uses the deprecated utf8x that doesn't even ship with TeXlive-2012 any more. Here is first version of a patch that fixes that. Still needs some work...",
    "created_at": "2013-05-10T11:38:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172872",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">comment:28</div>

Oh we are still building pdf docs, that uses the deprecated utf8x that doesn't even ship with TeXlive-2012 any more. Here is first version of a patch that fixes that. Still needs some work...



---

archive/issue_comments_172873.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-05-10T13:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172873",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_172874.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAttachment: **[14375_inputenc.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_inputenc.patch.gz)**\n\nEverything works now for me...",
    "created_at": "2013-05-10T13:58:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172874",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

Attachment: **[14375_inputenc.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_inputenc.patch.gz)**

Everything works now for me...



---

archive/issue_events_201207.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-10T13:58:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201207"
}
```



---

archive/issue_events_201208.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-10T13:58:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201208"
}
```



---

archive/issue_comments_172875.json:
```json
{
    "body": "Attachment: **[14375_review.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)**",
    "created_at": "2013-05-11T12:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172875",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[14375_review.patch.gz](https://github.com/sagemath/sage/files/ticket14375/14375_review.patch.gz)**



---

archive/issue_comments_172876.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nVolker, I confirm the utf8 problem, but that's for a different ticket (I don't know enough about `TeX` to review that): #14571.\n\nI fixed the problem on this ticket by simply using a `r\"\"\"` string instead of `\"\"\"`. Needs review.",
    "created_at": "2013-05-12T09:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172876",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Volker, I confirm the utf8 problem, but that's for a different ticket (I don't know enough about `TeX` to review that): #14571.

I fixed the problem on this ticket by simply using a `r"""` string instead of `"""`. Needs review.



---

archive/issue_comments_172877.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nWell I can't test it because TeXlive doesn't ship utf8x any more.",
    "created_at": "2013-05-12T09:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172877",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:31" align="right">comment:31</div>

Well I can't test it because TeXlive doesn't ship utf8x any more.



---

archive/issue_events_201209.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T09:44:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201209"
}
```



---

archive/issue_events_201210.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T09:44:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201210"
}
```



---

archive/issue_comments_172878.json:
```json
{
    "body": "Merged: **sage-5.10.beta3**",
    "created_at": "2013-05-13T13:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14375#issuecomment-172878",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.10.beta3**



---

archive/issue_events_201211.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:24:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201211"
}
```



---

archive/issue_events_201212.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:24:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14375",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14375#event-201212"
}
```
