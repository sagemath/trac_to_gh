# Issue 14746: Clean up S-class group, S-unit and Selmer group code

archive/issues_014542.json:
```json
{
    "assignees": [],
    "body": "The code for S-class groups, S-units and Selmer groups of number fields, and more generally \u00e9tale algebras, is not entirely satisfactory in the following respects:\n\n1. The code for computing Selmer groups is somewhat convoluted. Conceptually, the computation of the generators for principal ideals of the form gen<sup>order</sup> belongs in selmer_group, not _S_class_group_and_units. It would be more correct to return, as S-class group generators, pairs (gen, order) instead of triples (gen, order, pr), and leave the computation of the principal ideal generators to selmer_group.\n\n2. The docstrings are not very clear. The sentences are very long and contain awkward constructions (\"a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order\"; \"principal generator\").\n\n3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n\nThe attached patch does the following things:\n\n1. Move computation of generators of principal ideals from NumberField._S_class_group_and_units to NumberField.selmer_group.\n\n2. Add a method _S_decomposition to PolynomialQuotientRing_generic, which computes the decomposition of an \u00e9tale algebra as a product of number fields.  Use this function in S_class_group, S_units and selmer_group.\n\n3. Delete PolynomialQuotientRing_generic._S_class_group_and_units, and move its code and doctests to S_class_group, class_group, S_units and units.\n\n4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.\n\n5. Make the documentation more precise.\n\nApply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)\n\n\nDepends on #14489\n\nAssignee: **@loefflerd**\n\nCC:  ArgaezG akoutsianas\n\nKeywords: **S-class group, S-units, Selmer group, sd51**\n\nReviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**\n\nAuthor: **Peter Bruin**\n\nMerged: **sage-5.12.beta2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14746_\n\n",
    "closed_at": "2013-08-16T21:19:31Z",
    "created_at": "2013-06-15T15:08:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Clean up S-class group, S-unit and Selmer group code",
    "type": "issue",
    "updated_at": "2014-06-18T11:43:37Z",
    "url": "https://github.com/sagemath/sage/issues/14746",
    "user": "https://github.com/pjbruin"
}
```
The code for S-class groups, S-units and Selmer groups of number fields, and more generally étale algebras, is not entirely satisfactory in the following respects:

1. The code for computing Selmer groups is somewhat convoluted. Conceptually, the computation of the generators for principal ideals of the form gen<sup>order</sup> belongs in selmer_group, not _S_class_group_and_units. It would be more correct to return, as S-class group generators, pairs (gen, order) instead of triples (gen, order, pr), and leave the computation of the principal ideal generators to selmer_group.

2. The docstrings are not very clear. The sentences are very long and contain awkward constructions ("a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order"; "principal generator").

3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.

The attached patch does the following things:

1. Move computation of generators of principal ideals from NumberField._S_class_group_and_units to NumberField.selmer_group.

2. Add a method _S_decomposition to PolynomialQuotientRing_generic, which computes the decomposition of an étale algebra as a product of number fields.  Use this function in S_class_group, S_units and selmer_group.

3. Delete PolynomialQuotientRing_generic._S_class_group_and_units, and move its code and doctests to S_class_group, class_group, S_units and units.

4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.

5. Make the documentation more precise.

Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)


Depends on #14489

Assignee: **@loefflerd**

CC:  ArgaezG akoutsianas

Keywords: **S-class group, S-units, Selmer group, sd51**

Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**

Author: **Peter Bruin**

Merged: **sage-5.12.beta2**

_Issue created by migration from https://trac.sagemath.org/ticket/14746_





---

archive/issue_events_192197.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192197"
}
```



---

archive/issue_events_192198.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192198"
}
```



---

archive/issue_events_192199.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192199"
}
```



---

archive/issue_events_192200.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192200"
}
```



---

archive/issue_comments_182276.json:
```json
{
    "body": "based on 5.10.rc1 + #14489",
    "created_at": "2013-06-15T15:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182276",
    "user": "https://github.com/pjbruin"
}
```

based on 5.10.rc1 + #14489



---

archive/issue_comments_182277.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nAttachment: **[trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)**",
    "created_at": "2013-06-15T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182277",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:1'>Comment 1:</a>
Attachment: **[trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)**



---

archive/issue_events_192201.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:13:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192201"
}
```



---

archive/issue_comments_182278.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n 2. The docstrings are not very clear. The sentences are very long and contain awkward constructions (\"a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order\"; \"principal generator\").\n \n-3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, genorder can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n+3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n \n The attached patch does the following things:\n \n``````\n",
    "created_at": "2013-06-15T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182278",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 2. The docstrings are not very clear. The sentences are very long and contain awkward constructions ("a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order"; "principal generator").
 
-3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, genorder can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.
+3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.
 
 The attached patch does the following things:
 
``````




---

archive/issue_comments_182279.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,5 @@\n 4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.\n \n 5. Make the documentation more precise.\n+\n+Apply: trac_14746_selmer_group_cleanup.patch\n``````\n",
    "created_at": "2013-06-15T15:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182279",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,5 @@
 4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.
 
 5. Make the documentation more precise.
+
+Apply: trac_14746_selmer_group_cleanup.patch
``````




---

archive/issue_comments_182280.json:
```json
{
    "body": "Attachment: **[trac_14746_doctests_32_64_bit_undo.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz)**\n\nundo the effect of trac_14489_doctests_32_64_bit.patch",
    "created_at": "2013-07-05T18:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182280",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14746_doctests_32_64_bit_undo.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz)**

undo the effect of trac_14489_doctests_32_64_bit.patch



---

archive/issue_comments_182281.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,4 +18,5 @@\n \n 5. Make the documentation more precise.\n \n-Apply: trac_14746_selmer_group_cleanup.patch\n+Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)\n+\n``````\n",
    "created_at": "2013-07-05T18:49:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182281",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,4 +18,5 @@
 
 5. Make the documentation more precise.
 
-Apply: trac_14746_selmer_group_cleanup.patch
+Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)
+
``````




---

archive/issue_comments_182282.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nFor patchbot:\n\nApply trac_14746_doctests_32_64_bit_undo.patch, trac_14746_selmer_group_cleanup.patch",
    "created_at": "2013-07-15T21:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182282",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'>Comment 4:</a>
For patchbot:

Apply trac_14746_doctests_32_64_bit_undo.patch, trac_14746_selmer_group_cleanup.patch



---

archive/issue_comments_182283.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,5 +18,5 @@\n \n 5. Make the documentation more precise.\n \n-Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)\n+Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)\n \n``````\n",
    "created_at": "2013-07-16T13:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182283",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,5 +18,5 @@
 
 5. Make the documentation more precise.
 
-Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)
+Apply: [[attachment: trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)(https://github.com/sagemath/sage/files/ticket14746/e7794a52a39a65a6fa56ba9246c991d1.gz)
 
``````




---

archive/issue_comments_182284.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThe source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/",
    "created_at": "2013-07-17T20:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182284",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'>Comment 6:</a>
The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/



---

archive/issue_comments_182285.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@vbraun](#comment%3A6):\n> The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/\n\nMy patch fixes that as well, by adding a line `# -*- coding: utf-8 -*-` at the beginning (I forgot to mention this in the patch description).  Does this conform to the expected syntax?",
    "created_at": "2013-07-17T21:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182285",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@vbraun](#comment%3A6):
> The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/

My patch fixes that as well, by adding a line `# -*- coding: utf-8 -*-` at the beginning (I forgot to mention this in the patch description).  Does this conform to the expected syntax?



---

archive/issue_comments_182286.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAfter checking the documentation, I doubt that the 'raw' declaration (changing `\"\"\"` to `r\"\"\"`) is the right fix.  Should `u\"\"\"` be used instead, or is `\"\"\"` OK as long as the file is declared to be UTF-8?",
    "created_at": "2013-07-17T21:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182286",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'>Comment 8:</a>
After checking the documentation, I doubt that the 'raw' declaration (changing `"""` to `r"""`) is the right fix.  Should `u"""` be used instead, or is `"""` OK as long as the file is declared to be UTF-8?



---

archive/issue_comments_182287.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nOK, I didn't see the last patch in context. The **r**aw only concerns backlashes but handy to not have to escape `\\TeX` commands. No need for **u**nicode strings.",
    "created_at": "2013-07-17T23:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182287",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'>Comment 9:</a>
OK, I didn't see the last patch in context. The **r**aw only concerns backlashes but handy to not have to escape `\TeX` commands. No need for **u**nicode strings.



---

archive/issue_comments_182288.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI removed the second part of the patch, which changed `\"\"\"` to `r\"\"\"`.",
    "created_at": "2013-07-18T07:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182288",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'>Comment 10:</a>
I removed the second part of the patch, which changed `"""` to `r"""`.



---

archive/issue_comments_182289.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?",
    "created_at": "2013-07-18T20:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182289",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'>Comment 11:</a>
I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?



---

archive/issue_comments_182290.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nTest failure in my 32-bit VM:\n\n```\nFile \"sage/rings/polynomial/polynomial_quotient_ring.py\", line 926, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic._S_decomposition\nFailed example:\n    S._S_decomposition(tuple(K.primes_above(3)))\nExpected:\n    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field,\n      Number Field in x1 with defining polynomial x^2 + 31 over its base field],\n     [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324\n      Defn: y0 |--> y0,\n       0),\n      (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676\n      Defn: y1 |--> y1,\n       1)],\n     [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324,\n       [Fractional ideal (3, 1/4*y0^2 + 1/2*y0 + 11/2),\n        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8),\n        Fractional ideal (3, 1/36*y0^3 + 1/4*y0^2 + 5/9*y0 + 13/2),\n        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]),\n      (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676,\n       [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1),\n        Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])\nGot:\n    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field, Number Field in x1 with defining polynomial x^2 + 31 over its base field], [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324\n      Defn: y0 |--> y0, 0), (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676\n      Defn: y1 |--> y1, 1)], [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324, [Fractional ideal (3, -1/4*y0^2 - 1/2*y0 - 11/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8), Fractional ideal (3, 1/36*y0^3 - 1/4*y0^2 + 14/9*y0 - 17/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]), (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676, [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1), Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])\n```\nEdit: sorry had the wrong ticket number, this is the failure I'm getting.",
    "created_at": "2013-07-19T01:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182290",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'>Comment 12:</a>
Test failure in my 32-bit VM:

```
File "sage/rings/polynomial/polynomial_quotient_ring.py", line 926, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic._S_decomposition
Failed example:
    S._S_decomposition(tuple(K.primes_above(3)))
Expected:
    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field,
      Number Field in x1 with defining polynomial x^2 + 31 over its base field],
     [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324
      Defn: y0 |--> y0,
       0),
      (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676
      Defn: y1 |--> y1,
       1)],
     [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324,
       [Fractional ideal (3, 1/4*y0^2 + 1/2*y0 + 11/2),
        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8),
        Fractional ideal (3, 1/36*y0^3 + 1/4*y0^2 + 5/9*y0 + 13/2),
        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]),
      (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676,
       [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1),
        Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])
Got:
    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field, Number Field in x1 with defining polynomial x^2 + 31 over its base field], [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324
      Defn: y0 |--> y0, 0), (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676
      Defn: y1 |--> y1, 1)], [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324, [Fractional ideal (3, -1/4*y0^2 - 1/2*y0 - 11/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8), Fractional ideal (3, 1/36*y0^3 - 1/4*y0^2 + 14/9*y0 - 17/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]), (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676, [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1), Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])
```
Edit: sorry had the wrong ticket number, this is the failure I'm getting.



---

archive/issue_comments_182291.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@JohnCremona](#comment%3A11):\n> I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?\n\nIt doesn't add new (user-level) functionality, but the clean-up might make it easier to add this in the future.",
    "created_at": "2013-07-19T09:04:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182291",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@JohnCremona](#comment%3A11):
> I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?

It doesn't add new (user-level) functionality, but the clean-up might make it easier to add this in the future.



---

archive/issue_comments_182292.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@vbraun](#comment%3A12):\n> Test failure in my 32-bit VM:\n\nWith hindsight I could have guessed that the new doctest would create another 32/64-bit difference...  I am preparing a patch that\n* adds a bit more explanation to the docstring;\n* instead of checking the generators of the primes lying above 3, just checks whether the number of such primes is correct;\n* makes a trivial simplification in the code;\n* changes back `\"\"\"` to `r\"\"\"` in two docstrings, since they contain backslashes.",
    "created_at": "2013-07-19T09:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182292",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@vbraun](#comment%3A12):
> Test failure in my 32-bit VM:

With hindsight I could have guessed that the new doctest would create another 32/64-bit difference...  I am preparing a patch that
* adds a bit more explanation to the docstring;
* instead of checking the generators of the primes lying above 3, just checks whether the number of such primes is correct;
* makes a trivial simplification in the code;
* changes back `"""` to `r"""` in two docstrings, since they contain backslashes.



---

archive/issue_comments_182293.json:
```json
{
    "body": "Attachment: **[trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)**\n\nadd doctest, utf-8 declaration, r\"\"\" for backslashes, trivial edit in code",
    "created_at": "2013-07-19T09:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182293",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)**

add doctest, utf-8 declaration, r""" for backslashes, trivial edit in code



---

archive/issue_comments_182294.json:
```json
{
    "body": "Changed keywords from **S-class group, S-units, Selmer group** to **S-class group, S-units, Selmer group, sd51**",
    "created_at": "2013-07-22T13:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182294",
    "user": "https://github.com/loefflerd"
}
```

Changed keywords from **S-class group, S-units, Selmer group** to **S-class group, S-units, Selmer group, sd51**



---

archive/issue_comments_182295.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nAll three patches apply fine to (5.11.beta3 + the two patches from #14489).\nMost of the changes here are cosmetic, moving code around and improving the documentation, and they look fine to me.  Testing now...",
    "created_at": "2013-07-24T12:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182295",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:16'>Comment 16:</a>
All three patches apply fine to (5.11.beta3 + the two patches from #14489).
Most of the changes here are cosmetic, moving code around and improving the documentation, and they look fine to me.  Testing now...



---

archive/issue_comments_182296.json:
```json
{
    "body": "Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**",
    "created_at": "2013-07-24T12:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182296",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**



---

archive/issue_comments_182297.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nAll tests (including long) pass in sage/rings, so I'll give this a positive review.",
    "created_at": "2013-07-24T13:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182297",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'>Comment 18:</a>
All tests (including long) pass in sage/rings, so I'll give this a positive review.



---

archive/issue_events_192202.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-24T13:35:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192202"
}
```



---

archive/issue_events_192203.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-24T13:35:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192203"
}
```



---

archive/issue_events_192204.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-25T06:50:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192204"
}
```



---

archive/issue_events_192205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-25T06:50:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192205"
}
```



---

archive/issue_events_192206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:19:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192206"
}
```



---

archive/issue_events_192207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:19:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-192207"
}
```



---

archive/issue_comments_182298.json:
```json
{
    "body": "Merged: **sage-5.12.beta2**",
    "created_at": "2013-08-16T21:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182298",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta2**



---

archive/issue_comments_182299.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nSee #16496.",
    "created_at": "2014-06-18T11:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-182299",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'>Comment 22:</a>
See #16496.
