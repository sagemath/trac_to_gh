# Issue 14746: Clean up S-class group, S-unit and Selmer group code

archive/issues_014542.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "The code for S-class groups, S-units and Selmer groups of number fields, and more generally \u00e9tale algebras, is not entirely satisfactory in the following respects:\n\n1. The code for computing Selmer groups is somewhat convoluted. Conceptually, the computation of the generators for principal ideals of the form gen<sup>order</sup> belongs in selmer_group, not _S_class_group_and_units. It would be more correct to return, as S-class group generators, pairs (gen, order) instead of triples (gen, order, pr), and leave the computation of the principal ideal generators to selmer_group.\n\n2. The docstrings are not very clear. The sentences are very long and contain awkward constructions (\"a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order\"; \"principal generator\").\n\n3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n\nThe attached patch does the following things:\n\n1. Move computation of generators of principal ideals from NumberField._S_class_group_and_units to NumberField.selmer_group.\n\n2. Add a method _S_decomposition to PolynomialQuotientRing_generic, which computes the decomposition of an \u00e9tale algebra as a product of number fields.  Use this function in S_class_group, S_units and selmer_group.\n\n3. Delete PolynomialQuotientRing_generic._S_class_group_and_units, and move its code and doctests to S_class_group, class_group, S_units and units.\n\n4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.\n\n5. Make the documentation more precise.\n\nApply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)\n\n\nDepends on #14489\n\nCC:  @sagetrac-ArgaezG @sagetrac-akoutsianas\n\nComponent: **number fields**\n\nKeywords: **S-class group, S-units, Selmer group, sd51**\n\nAuthor: **Peter Bruin**\n\nReviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**\n\nMerged: **sage-5.12.beta2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14746_\n\n",
    "closed_at": "2013-08-16T21:19:31Z",
    "created_at": "2013-06-15T15:08:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Clean up S-class group, S-unit and Selmer group code",
    "type": "issue",
    "updated_at": "2014-06-18T11:43:37Z",
    "url": "https://github.com/sagemath/sage/issues/14746",
    "user": "https://github.com/pjbruin"
}
```
The code for S-class groups, S-units and Selmer groups of number fields, and more generally étale algebras, is not entirely satisfactory in the following respects:

1. The code for computing Selmer groups is somewhat convoluted. Conceptually, the computation of the generators for principal ideals of the form gen<sup>order</sup> belongs in selmer_group, not _S_class_group_and_units. It would be more correct to return, as S-class group generators, pairs (gen, order) instead of triples (gen, order, pr), and leave the computation of the principal ideal generators to selmer_group.

2. The docstrings are not very clear. The sentences are very long and contain awkward constructions ("a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order"; "principal generator").

3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.

The attached patch does the following things:

1. Move computation of generators of principal ideals from NumberField._S_class_group_and_units to NumberField.selmer_group.

2. Add a method _S_decomposition to PolynomialQuotientRing_generic, which computes the decomposition of an étale algebra as a product of number fields.  Use this function in S_class_group, S_units and selmer_group.

3. Delete PolynomialQuotientRing_generic._S_class_group_and_units, and move its code and doctests to S_class_group, class_group, S_units and units.

4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.

5. Make the documentation more precise.

Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)


Depends on #14489

CC:  @sagetrac-ArgaezG @sagetrac-akoutsianas

Component: **number fields**

Keywords: **S-class group, S-units, Selmer group, sd51**

Author: **Peter Bruin**

Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**

Merged: **sage-5.12.beta2**

_Issue created by migration from https://trac.sagemath.org/ticket/14746_





---

archive/issue_events_207430.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207430"
}
```



---

archive/issue_events_207431.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207431"
}
```



---

archive/issue_events_207432.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207432"
}
```



---

archive/issue_events_207433.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207433"
}
```



---

archive/issue_events_207434.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2013-06-15T15:08:25Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "subject": "https://github.com/pjbruin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207434"
}
```



---

archive/issue_comments_179801.json:
```json
{
    "body": "based on 5.10.rc1 + #14489",
    "created_at": "2013-06-15T15:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179801",
    "user": "https://github.com/pjbruin"
}
```

based on 5.10.rc1 + #14489



---

archive/issue_comments_179802.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)**",
    "created_at": "2013-06-15T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179802",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_14746_selmer_group_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)**



---

archive/issue_events_207435.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-06-15T15:13:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207435"
}
```



---

archive/issue_comments_179803.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n \n 2. The docstrings are not very clear. The sentences are very long and contain awkward constructions (\"a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order\"; \"principal generator\").\n \n-3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, genorder can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n+3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.\n \n The attached patch does the following things:\n \n``````\n",
    "created_at": "2013-06-15T15:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179803",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 
 2. The docstrings are not very clear. The sentences are very long and contain awkward constructions ("a fractional ideal representative of the S-class group generator whose order (in the S-class group) is order"; "principal generator").
 
-3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, genorder can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.
+3. The docstring of NumberField._S_class_group_and_units suggests that to obtain a principal ideal, gen<sup>order</sup> can be multiplied by any fractional ideal J whose class is in the subgroup of the class group generated by ideals in S. However, the condition is more strict: J must be in the subgroup of the ideal group generated by ideals in S.
 
 The attached patch does the following things:
 
``````




---

archive/issue_comments_179804.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,5 @@\n 4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.\n \n 5. Make the documentation more precise.\n+\n+Apply: trac_14746_selmer_group_cleanup.patch\n``````\n",
    "created_at": "2013-06-15T15:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179804",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,5 @@
 4. Reimplement PolynomialQuotientRing_generic.selmer_group to compute the Selmer group as the product of the Selmer groups of the distinct components, instead of imitating the algorithm of NumberField.selmer_group.
 
 5. Make the documentation more precise.
+
+Apply: trac_14746_selmer_group_cleanup.patch
``````




---

archive/issue_comments_179805.json:
```json
{
    "body": "Attachment: **[trac_14746_doctests_32_64_bit_undo.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz)**\n\nundo the effect of trac_14489_doctests_32_64_bit.patch",
    "created_at": "2013-07-05T18:47:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179805",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14746_doctests_32_64_bit_undo.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz)**

undo the effect of trac_14489_doctests_32_64_bit.patch



---

archive/issue_comments_179806.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,4 +18,5 @@\n \n 5. Make the documentation more precise.\n \n-Apply: trac_14746_selmer_group_cleanup.patch\n+Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)\n+\n``````\n",
    "created_at": "2013-07-05T18:49:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179806",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,4 +18,5 @@
 
 5. Make the documentation more precise.
 
-Apply: trac_14746_selmer_group_cleanup.patch
+Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)
+
``````




---

archive/issue_comments_179807.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFor patchbot:\n\nApply trac_14746_doctests_32_64_bit_undo.patch, trac_14746_selmer_group_cleanup.patch",
    "created_at": "2013-07-15T21:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179807",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

For patchbot:

Apply trac_14746_doctests_32_64_bit_undo.patch, trac_14746_selmer_group_cleanup.patch



---

archive/issue_comments_179808.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,5 +18,5 @@\n \n 5. Make the documentation more precise.\n \n-Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)\n+Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)\n \n``````\n",
    "created_at": "2013-07-16T13:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179808",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,5 +18,5 @@
 
 5. Make the documentation more precise.
 
-Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz)
+Apply: [attachment: trac_14746_doctests_32_64_bit_undo.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_doctests_32_64_bit_undo.patch.gz), [attachment: trac_14746_selmer_group_cleanup.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_selmer_group_cleanup.patch.gz), [attachment: trac_14746_docstring_fixes.patch](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)
 
``````




---

archive/issue_comments_179809.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/",
    "created_at": "2013-07-17T20:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179809",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/



---

archive/issue_comments_179810.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@vbraun](#comment%3A6):\n> The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/\n\nMy patch fixes that as well, by adding a line `# -*- coding: utf-8 -*-` at the beginning (I forgot to mention this in the patch description).  Does this conform to the expected syntax?",
    "created_at": "2013-07-17T21:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179810",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@vbraun](#comment%3A6):
> The source file needs to specify UTF-8 encoding if you want to use non-ascii characters, but `rings/polynomial/polynomial_quotient_ring.py` does not. See http://www.python.org/dev/peps/pep-0263/

My patch fixes that as well, by adding a line `# -*- coding: utf-8 -*-` at the beginning (I forgot to mention this in the patch description).  Does this conform to the expected syntax?



---

archive/issue_comments_179811.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAfter checking the documentation, I doubt that the 'raw' declaration (changing `\"\"\"` to `r\"\"\"`) is the right fix.  Should `u\"\"\"` be used instead, or is `\"\"\"` OK as long as the file is declared to be UTF-8?",
    "created_at": "2013-07-17T21:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179811",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

After checking the documentation, I doubt that the 'raw' declaration (changing `"""` to `r"""`) is the right fix.  Should `u"""` be used instead, or is `"""` OK as long as the file is declared to be UTF-8?



---

archive/issue_comments_179812.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOK, I didn't see the last patch in context. The **r**aw only concerns backlashes but handy to not have to escape `\\TeX` commands. No need for **u**nicode strings.",
    "created_at": "2013-07-17T23:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179812",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

OK, I didn't see the last patch in context. The **r**aw only concerns backlashes but handy to not have to escape `\TeX` commands. No need for **u**nicode strings.



---

archive/issue_comments_179813.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI removed the second part of the patch, which changed `\"\"\"` to `r\"\"\"`.",
    "created_at": "2013-07-18T07:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179813",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

I removed the second part of the patch, which changed `"""` to `r"""`.



---

archive/issue_comments_179814.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?",
    "created_at": "2013-07-18T20:41:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179814",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?



---

archive/issue_comments_179815.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nTest failure in my 32-bit VM:\n\n```\nFile \"sage/rings/polynomial/polynomial_quotient_ring.py\", line 926, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic._S_decomposition\nFailed example:\n    S._S_decomposition(tuple(K.primes_above(3)))\nExpected:\n    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field,\n      Number Field in x1 with defining polynomial x^2 + 31 over its base field],\n     [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324\n      Defn: y0 |--> y0,\n       0),\n      (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676\n      Defn: y1 |--> y1,\n       1)],\n     [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324,\n       [Fractional ideal (3, 1/4*y0^2 + 1/2*y0 + 11/2),\n        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8),\n        Fractional ideal (3, 1/36*y0^3 + 1/4*y0^2 + 5/9*y0 + 13/2),\n        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]),\n      (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676,\n       [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1),\n        Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])\nGot:\n    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field, Number Field in x1 with defining polynomial x^2 + 31 over its base field], [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324\n      Defn: y0 |--> y0, 0), (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676\n      Defn: y1 |--> y1, 1)], [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324, [Fractional ideal (3, -1/4*y0^2 - 1/2*y0 - 11/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8), Fractional ideal (3, 1/36*y0^3 - 1/4*y0^2 + 14/9*y0 - 17/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]), (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676, [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1), Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])\n```\nEdit: sorry had the wrong ticket number, this is the failure I'm getting.",
    "created_at": "2013-07-19T01:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179815",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

Test failure in my 32-bit VM:

```
File "sage/rings/polynomial/polynomial_quotient_ring.py", line 926, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic._S_decomposition
Failed example:
    S._S_decomposition(tuple(K.primes_above(3)))
Expected:
    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field,
      Number Field in x1 with defining polynomial x^2 + 31 over its base field],
     [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324
      Defn: y0 |--> y0,
       0),
      (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676
      Defn: y1 |--> y1,
       1)],
     [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324,
       [Fractional ideal (3, 1/4*y0^2 + 1/2*y0 + 11/2),
        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8),
        Fractional ideal (3, 1/36*y0^3 + 1/4*y0^2 + 5/9*y0 + 13/2),
        Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]),
      (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676,
       [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1),
        Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])
Got:
    ([Number Field in x0 with defining polynomial x^2 + 23 over its base field, Number Field in x1 with defining polynomial x^2 + 31 over its base field], [(Ring endomorphism of Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324
      Defn: y0 |--> y0, 0), (Ring endomorphism of Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676
      Defn: y1 |--> y1, 1)], [(Number Field in y0 with defining polynomial x^4 + 56*x^2 + 324, [Fractional ideal (3, -1/4*y0^2 - 1/2*y0 - 11/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 8), Fractional ideal (3, 1/36*y0^3 - 1/4*y0^2 + 14/9*y0 - 17/2), Fractional ideal (3, 1/72*y0^3 + 1/4*y0^2 + 19/36*y0 + 6)]), (Number Field in y1 with defining polynomial x^4 + 72*x^2 + 676, [Fractional ideal (3, -1/52*y1^3 - 23/26*y1 - 1), Fractional ideal (3, -1/52*y1^3 - 23/26*y1 + 1)])])
```
Edit: sorry had the wrong ticket number, this is the failure I'm getting.



---

archive/issue_comments_179816.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@JohnCremona](#comment%3A11):\n> I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?\n\nIt doesn't add new (user-level) functionality, but the clean-up might make it easier to add this in the future.",
    "created_at": "2013-07-19T09:04:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179816",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@JohnCremona](#comment%3A11):
> I hope I can look at this and get it finished next week.  Does it provide a class for S-units like the class for units?

It doesn't add new (user-level) functionality, but the clean-up might make it easier to add this in the future.



---

archive/issue_comments_179817.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@vbraun](#comment%3A12):\n> Test failure in my 32-bit VM:\n\nWith hindsight I could have guessed that the new doctest would create another 32/64-bit difference...  I am preparing a patch that\n* adds a bit more explanation to the docstring;\n* instead of checking the generators of the primes lying above 3, just checks whether the number of such primes is correct;\n* makes a trivial simplification in the code;\n* changes back `\"\"\"` to `r\"\"\"` in two docstrings, since they contain backslashes.",
    "created_at": "2013-07-19T09:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179817",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@vbraun](#comment%3A12):
> Test failure in my 32-bit VM:

With hindsight I could have guessed that the new doctest would create another 32/64-bit difference...  I am preparing a patch that
* adds a bit more explanation to the docstring;
* instead of checking the generators of the primes lying above 3, just checks whether the number of such primes is correct;
* makes a trivial simplification in the code;
* changes back `"""` to `r"""` in two docstrings, since they contain backslashes.



---

archive/issue_comments_179818.json:
```json
{
    "body": "Attachment: **[trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)**\n\nadd doctest, utf-8 declaration, r\"\"\" for backslashes, trivial edit in code",
    "created_at": "2013-07-19T09:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179818",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14746_docstring_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket14746/trac_14746_docstring_fixes.patch.gz)**

add doctest, utf-8 declaration, r""" for backslashes, trivial edit in code



---

archive/issue_comments_179819.json:
```json
{
    "body": "Changed keywords from **S-class group, S-units, Selmer group** to **S-class group, S-units, Selmer group, sd51**",
    "created_at": "2013-07-22T13:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179819",
    "user": "https://github.com/loefflerd"
}
```

Changed keywords from **S-class group, S-units, Selmer group** to **S-class group, S-units, Selmer group, sd51**



---

archive/issue_comments_179820.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAll three patches apply fine to (5.11.beta3 + the two patches from #14489).\nMost of the changes here are cosmetic, moving code around and improving the documentation, and they look fine to me.  Testing now...",
    "created_at": "2013-07-24T12:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179820",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

All three patches apply fine to (5.11.beta3 + the two patches from #14489).
Most of the changes here are cosmetic, moving code around and improving the documentation, and they look fine to me.  Testing now...



---

archive/issue_comments_179821.json:
```json
{
    "body": "Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**",
    "created_at": "2013-07-24T12:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179821",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona, Alejandro Argaez, Angelos Koutsianas**



---

archive/issue_comments_179822.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAll tests (including long) pass in sage/rings, so I'll give this a positive review.",
    "created_at": "2013-07-24T13:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179822",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:18" align="right">comment:18</div>

All tests (including long) pass in sage/rings, so I'll give this a positive review.



---

archive/issue_events_207436.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-24T13:35:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207436"
}
```



---

archive/issue_events_207437.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-07-24T13:35:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207437"
}
```



---

archive/issue_events_207438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-25T06:50:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207438"
}
```



---

archive/issue_events_207439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-25T06:50:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207439"
}
```



---

archive/issue_events_207440.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:19:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207440"
}
```



---

archive/issue_events_207441.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:19:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14746#event-207441"
}
```



---

archive/issue_comments_179823.json:
```json
{
    "body": "Merged: **sage-5.12.beta2**",
    "created_at": "2013-08-16T21:19:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179823",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta2**



---

archive/issue_comments_179824.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSee #16496.",
    "created_at": "2014-06-18T11:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14746#issuecomment-179824",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:22" align="right">comment:22</div>

See #16496.
