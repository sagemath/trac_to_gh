# Issue 14806: Immutable graph backend

archive/issues_014602.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/nathanncohen",
        "https://github.com/rlmill"
    ],
    "body": "As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n\n```\nsage: g = graphs.CompleteGraph(400)                                 \nsage: gi = Graph(g,data_structure=\"static_sparse\")\nsage: %timeit g.edges()                                             \n1 loops, best of 3: 512 ms per loop\nsage: %timeit gi.edges()\n10 loops, best of 3: 30.3 ms per loop\n```\n\nThe patch : \n\n* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n* Updates the static_sparse_graph data structure to handle labels\n* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n\nI tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:\n* (if the backend is not static) build a copy of self using a static backend\n* Check that both are equal, and otherwise scream in panic\n\nThis being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.\n\nI don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n\nNathann\n\nDepends on #14805\n\nCC:  @dimpase @sagetrac-azi @sagetrac-Slani @simon-king-jena @vbraun @sagetrac-Stefan @nthiery @hivert\n\nReviewer: **Jernej Azarija**\n\nAuthor: **Nathann Cohen**\n\nMerged: **sage-5.12.beta4**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14806_\n\n",
    "closed_at": "2013-08-30T07:12:53Z",
    "created_at": "2013-06-22T12:35:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Immutable graph backend",
    "type": "issue",
    "updated_at": "2013-08-30T08:51:45Z",
    "url": "https://github.com/sagemath/sage/issues/14806",
    "user": "https://github.com/nathanncohen"
}
```
As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.

```
sage: g = graphs.CompleteGraph(400)                                 
sage: gi = Graph(g,data_structure="static_sparse")
sage: %timeit g.edges()                                             
1 loops, best of 3: 512 ms per loop
sage: %timeit gi.edges()
10 loops, best of 3: 30.3 ms per loop
```

The patch : 

* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
* Updates the static_sparse_graph data structure to handle labels
* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.

I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:
* (if the backend is not static) build a copy of self using a static backend
* Check that both are equal, and otherwise scream in panic

This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.

I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`

Nathann

Depends on #14805

CC:  @dimpase @sagetrac-azi @sagetrac-Slani @simon-king-jena @vbraun @sagetrac-Stefan @nthiery @hivert

Reviewer: **Jernej Azarija**

Author: **Nathann Cohen**

Merged: **sage-5.12.beta4**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/14806_





---

archive/issue_events_210425.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-22T12:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210425"
}
```



---

archive/issue_events_210426.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-22T12:35:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210426"
}
```



---

archive/issue_events_210427.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-22T12:35:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210427"
}
```



---

archive/issue_comments_181100.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n Nathann\n+\n+(not ready for a review yet)\n``````\n",
    "created_at": "2013-06-22T12:37:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181100",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
 Nathann
+
+(not ready for a review yet)
``````




---

archive/issue_comments_181101.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n+\n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n \n Nathann\n \n``````\n",
    "created_at": "2013-06-22T13:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181101",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
 As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
+
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
 
 Nathann
 
``````




---

archive/issue_comments_181102.json:
```json
{
    "body": "Dependencies: **#14806**",
    "created_at": "2013-06-22T13:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181102",
    "user": "https://github.com/nathanncohen"
}
```

Dependencies: **#14806**



---

archive/issue_comments_181103.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,16 @@\n 10 loops, best of 3: 30.3 ms per loop\n ```\n \n+Content of [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz) :\n+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n+* Updates the static_sparse_graph data structure to handle labels\n+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+\n+Content of [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz) :\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+\n Nathann\n \n-(not ready for a review yet)\n+Apply:\n+* [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)\n+* [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz)\n``````\n",
    "created_at": "2013-06-22T14:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181103",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,16 @@
 10 loops, best of 3: 30.3 ms per loop
 ```
 
+Content of [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz) :
+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
+* Updates the static_sparse_graph data structure to handle labels
+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+
+Content of [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz) :
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+
 Nathann
 
-(not ready for a review yet)
+Apply:
+* [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)
+* [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz)
``````




---

archive/issue_comments_181104.json:
```json
{
    "body": "Changed dependencies from **#14806** to **#14805**",
    "created_at": "2013-06-22T14:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181104",
    "user": "https://github.com/nathanncohen"
}
```

Changed dependencies from **#14806** to **#14805**



---

archive/issue_comments_181105.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,11 +14,11 @@\n * Updates the static_sparse_graph data structure to handle labels\n * Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n \n-Content of [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz) :\n+Content of [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz) :\n * Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n \n Nathann\n \n Apply:\n * [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)\n-* [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz)\n+* [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz)\n``````\n",
    "created_at": "2013-06-22T14:20:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181105",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,11 +14,11 @@
 * Updates the static_sparse_graph data structure to handle labels
 * Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
 
-Content of [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz) :
+Content of [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz) :
 * Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
 
 Nathann
 
 Apply:
 * [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)
-* [attachment: trac_14806-keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-keyword.patch.gz)
+* [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz)
``````




---

archive/issue_events_210428.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-24T09:05:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210428"
}
```



---

archive/issue_events_210429.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-24T09:05:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210429"
}
```



---

archive/issue_events_210430.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2013-06-24T09:05:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "subject": "https://github.com/nathanncohen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210430"
}
```



---

archive/issue_events_210431.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-24T09:05:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210431"
}
```



---

archive/issue_comments_181106.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,13 +9,20 @@\n 10 loops, best of 3: 30.3 ms per loop\n ```\n \n-Content of [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz) :\n+The patch : \n+\n * Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n * Updates the static_sparse_graph data structure to handle labels\n * Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n \n-Content of [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz) :\n-* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:\n+* (if the backend is not static) build a copy of self using a static backend\n+* Check that both are equal, and otherwise scream in panic\n+\n+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.\n+\n+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n \n Nathann\n \n``````\n",
    "created_at": "2013-06-24T09:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181106",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,13 +9,20 @@
 10 loops, best of 3: 30.3 ms per loop
 ```
 
-Content of [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz) :
+The patch : 
+
 * Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
 * Updates the static_sparse_graph data structure to handle labels
 * Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
 
-Content of [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz) :
-* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:
+* (if the backend is not static) build a copy of self using a static backend
+* Check that both are equal, and otherwise scream in panic
+
+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.
+
+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`
 
 Nathann
 
``````




---

archive/issue_comments_181107.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,7 +25,3 @@\n I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n \n Nathann\n-\n-Apply:\n-* [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)\n-* [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz)\n``````\n",
    "created_at": "2013-06-24T09:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181107",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,7 +25,3 @@
 I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`
 
 Nathann
-
-Apply:
-* [attachment: trac_14806.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806.patch.gz)
-* [attachment: trac_14806-update_keyword.patch](https://github.com/sagemath/sage/files/ticket14806/trac_14806-update_keyword.patch.gz)
``````




---

archive/issue_events_210432.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-06-24T09:20:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210432"
}
```



---

archive/issue_comments_181108.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n* Its either \"Thou shalt not add a vertex to an immutable graph!\"\n  (Shakespeare) or \"cannot add vertex to an immutable graph\"\n  (Python). In particular, lower case and no exclamation mark at the\n  end ;)\n\n* Methods that fail due to being immutable should raise `ValueError`,\n  not `NotImplementedError` (are you going to implement it in the\n  future?)\n\n* It would be nice if INPUT/OUTPUT were consistent and would actually\n  list all arguments, for example (though there are many more)\n  `StaticSparseBackend.degree` does not document the \"directed\"\n  argument.\n\n* static_sparse_backend module docstring \"Two classes\" names the same\n  class twice.\n\n* StaticSparseCGraph docstring: \":mod:`CGraph\n  <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs\n  <sage.graphs.base.static_dense_graph>`\". I don't know what thats\n  supposed to mean.\n\n* The Python special `__copy__()` method does not allow any\n  arguments. In particular, `copy(graph)` should return a mutable copy\n  if the original `graph` is immutable.\n\n* Having to write `data_structure=\"sparse\"` is a lot less intuitive\n  than the old `sparse=True`. It would be better to allow for both\n  and raise a `ValueError` if both are changed from their default\n  values.",
    "created_at": "2013-06-24T11:57:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181108",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

* Its either "Thou shalt not add a vertex to an immutable graph!"
  (Shakespeare) or "cannot add vertex to an immutable graph"
  (Python). In particular, lower case and no exclamation mark at the
  end ;)

* Methods that fail due to being immutable should raise `ValueError`,
  not `NotImplementedError` (are you going to implement it in the
  future?)

* It would be nice if INPUT/OUTPUT were consistent and would actually
  list all arguments, for example (though there are many more)
  `StaticSparseBackend.degree` does not document the "directed"
  argument.

* static_sparse_backend module docstring "Two classes" names the same
  class twice.

* StaticSparseCGraph docstring: ":mod:`CGraph
  <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs
  <sage.graphs.base.static_dense_graph>`". I don't know what thats
  supposed to mean.

* The Python special `__copy__()` method does not allow any
  arguments. In particular, `copy(graph)` should return a mutable copy
  if the original `graph` is immutable.

* Having to write `data_structure="sparse"` is a lot less intuitive
  than the old `sparse=True`. It would be better to allow for both
  and raise a `ValueError` if both are changed from their default
  values.



---

archive/issue_comments_181109.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHello !\n\n> * Its either \"Thou shalt not add a vertex to an immutable graph!\"\n>   (Shakespeare) or \"cannot add vertex to an immutable graph\"\n>   (Python). In particular, lower case and no exclamation mark at the\n>   end ;)\n\nI obviously chosed the \"Thou shalt not add a vertex to an immutable graph\".\n\n> * Methods that fail due to being immutable should raise `ValueError`,\n>   not `NotImplementedError` (are you going to implement it in the\n>   future?)\n\nI change my mind so often that I wouldn't put it beyond reach. But just to please you I fixed it `:-P`\n\n> * It would be nice if INPUT/OUTPUT were consistent and would actually\n>   list all arguments, for example (though there are many more)\n>   `StaticSparseBackend.degree` does not document the \"directed\"\n>   argument.\n\nWell, I defined the \"INPUT\" where it was not, but usually the outputs are pretty clear... Not to mention that those are rather meant to Sage developpers.\n\n> * static_sparse_backend module docstring \"Two classes\" names the same\n>   class twice.\n\nIt's a poetic license.\n \n> * StaticSparseCGraph docstring: \":mod:`CGraph\n>   <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs\n>   <sage.graphs.base.static_dense_graph>`\". I don't know what thats\n>   supposed to mean.\n\nThat it uses static sparse graphs as a data structure. By the way, the link and the name did not match. I rephrased it.\n\n> * The Python special `__copy__()` method does not allow any\n>   arguments. In particular, `copy(graph)` should return a mutable copy\n>   if the original `graph` is immutable.\n\nThere were arguments there before I learnt that Sage existed, and it is because this method can also be used through `G.copy(whatever)`. This being said, I don't see why one should get a mutable graph as a copy of an immutable one. Copying a tuple certainly does not make it a list, and it would produce rather unexpected behaviour `O_o`\n\n> * Having to write `data_structure=\"sparse\"` is a lot less intuitive\n>   than the old `sparse=True`. It would be better to allow for both\n>   and raise a `ValueError` if both are changed from their default\n>   values.\n\nYou have no idea how many hours I wasted on that. Unfortunately, you are right. I reversed those modifications and both keywords can now be used.\n\nPatch updated !\n\nNathann",
    "created_at": "2013-06-24T13:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181109",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:9" align="right">comment:9</div>

Hello !

> * Its either "Thou shalt not add a vertex to an immutable graph!"
>   (Shakespeare) or "cannot add vertex to an immutable graph"
>   (Python). In particular, lower case and no exclamation mark at the
>   end ;)

I obviously chosed the "Thou shalt not add a vertex to an immutable graph".

> * Methods that fail due to being immutable should raise `ValueError`,
>   not `NotImplementedError` (are you going to implement it in the
>   future?)

I change my mind so often that I wouldn't put it beyond reach. But just to please you I fixed it `:-P`

> * It would be nice if INPUT/OUTPUT were consistent and would actually
>   list all arguments, for example (though there are many more)
>   `StaticSparseBackend.degree` does not document the "directed"
>   argument.

Well, I defined the "INPUT" where it was not, but usually the outputs are pretty clear... Not to mention that those are rather meant to Sage developpers.

> * static_sparse_backend module docstring "Two classes" names the same
>   class twice.

It's a poetic license.
 
> * StaticSparseCGraph docstring: ":mod:`CGraph
>   <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs
>   <sage.graphs.base.static_dense_graph>`". I don't know what thats
>   supposed to mean.

That it uses static sparse graphs as a data structure. By the way, the link and the name did not match. I rephrased it.

> * The Python special `__copy__()` method does not allow any
>   arguments. In particular, `copy(graph)` should return a mutable copy
>   if the original `graph` is immutable.

There were arguments there before I learnt that Sage existed, and it is because this method can also be used through `G.copy(whatever)`. This being said, I don't see why one should get a mutable graph as a copy of an immutable one. Copying a tuple certainly does not make it a list, and it would produce rather unexpected behaviour `O_o`

> * Having to write `data_structure="sparse"` is a lot less intuitive
>   than the old `sparse=True`. It would be better to allow for both
>   and raise a `ValueError` if both are changed from their default
>   values.

You have no idea how many hours I wasted on that. Unfortunately, you are right. I reversed those modifications and both keywords can now be used.

Patch updated !

Nathann



---

archive/issue_comments_181110.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHello! \n\nAs promised I peeked at the code!! In general the patch looks good to me with the exception of the above comments.\n\n\n* Can we use xrange instead of range when we only iterate over something?\n\n* Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? \n\n* In the function **iterator_in_edges** why do we need the call to iter in the following line ?\n\n```\n            for x in iter(self.iterator_out_edges(vertices, labels)): \n\n```",
    "created_at": "2013-08-16T17:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181110",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:10" align="right">comment:10</div>

Hello! 

As promised I peeked at the code!! In general the patch looks good to me with the exception of the above comments.


* Can we use xrange instead of range when we only iterate over something?

* Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? 

* In the function **iterator_in_edges** why do we need the call to iter in the following line ?

```
            for x in iter(self.iterator_out_edges(vertices, labels)): 

```



---

archive/issue_comments_181111.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nCython detects \"for i in range(n)\" loops and replaces them with a C loop. So there is no point in using xrange.",
    "created_at": "2013-08-16T18:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181111",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

Cython detects "for i in range(n)" loops and replaces them with a C loop. So there is no point in using xrange.



---

archive/issue_comments_181112.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHellooooooo !!\n\n> As promised I peeked at the code!!\n\nCooooooooooool ! `:-P`\n\n> * Can we use xrange instead of range when we only iterate over something?\n\nVolker beat me to this one.\n\n> * Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? \n\n`T_T`\n\nYou are right. Fixed.\n\n> * In the function **iterator_in_edges** why do we need the call to iter in the following line ?\n\nBecause I am an idiot. It actually explains a lot of things `:-P`\n\nFiiiiiiiiixed !\n\nNathann",
    "created_at": "2013-08-16T18:33:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181112",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

Hellooooooo !!

> As promised I peeked at the code!!

Cooooooooooool ! `:-P`

> * Can we use xrange instead of range when we only iterate over something?

Volker beat me to this one.

> * Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? 

`T_T`

You are right. Fixed.

> * In the function **iterator_in_edges** why do we need the call to iter in the following line ?

Because I am an idiot. It actually explains a lot of things `:-P`

Fiiiiiiiiixed !

Nathann



---

archive/issue_comments_181113.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nGood! \n\nAs far as I am concerned the code is good to go! Do you want me to review it positively or wish for another less confused soul to review it as well?\n\n\n...as for xrange/range... I can see the reason for using range to be compatible with Python 3.x but somehow I am afraid the transition will never happen :-)",
    "created_at": "2013-08-16T18:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181113",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:13" align="right">comment:13</div>

Good! 

As far as I am concerned the code is good to go! Do you want me to review it positively or wish for another less confused soul to review it as well?


...as for xrange/range... I can see the reason for using range to be compatible with Python 3.x but somehow I am afraid the transition will never happen :-)



---

archive/issue_comments_181114.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWell... For me the code is good to go too, so if you agree with it I would be glad to see it in Sage ! Not to mention that I wrote this patch because of #14806, and that those guys will probably want to use it for their own dark ends once it will be merged `:-)`\n\nAs for Python 3, I don't know. It feels like it may take forever to move there, but then again things happened very efficiently to move to git, sooo... Well. Sage devs are surprising guys `:-)`\n\nNathann",
    "created_at": "2013-08-16T18:57:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181114",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:14" align="right">comment:14</div>

Well... For me the code is good to go too, so if you agree with it I would be glad to see it in Sage ! Not to mention that I wrote this patch because of #14806, and that those guys will probably want to use it for their own dark ends once it will be merged `:-)`

As for Python 3, I don't know. It feels like it may take forever to move there, but then again things happened very efficiently to move to git, sooo... Well. Sage devs are surprising guys `:-)`

Nathann



---

archive/issue_events_210433.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-08-16T18:59:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210433"
}
```



---

archive/issue_events_210434.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-08-16T18:59:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210434"
}
```



---

archive/issue_comments_181115.json:
```json
{
    "body": "Reviewer: **Jernej Azarija**",
    "created_at": "2013-08-16T18:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181115",
    "user": "https://github.com/sagetrac-azi"
}
```

Reviewer: **Jernej Azarija**



---

archive/issue_comments_181116.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWow. THaaaaaaaaaaaaaaaaaanks ! `:-)`\n\nNathann",
    "created_at": "2013-08-16T19:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181116",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

Wow. THaaaaaaaaaaaaaaaaaanks ! `:-)`

Nathann



---

archive/issue_events_210435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T13:28:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210435"
}
```



---

archive/issue_events_210436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T13:28:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210436"
}
```



---

archive/issue_comments_181117.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThis needs to be rebased to sage-5.12.beta2.",
    "created_at": "2013-08-20T13:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181117",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

This needs to be rebased to sage-5.12.beta2.



---

archive/issue_events_210437.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-08-20T14:58:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210437"
}
```



---

archive/issue_events_210438.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-08-20T14:58:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210438"
}
```



---

archive/issue_comments_181118.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[sparselabel.patch.gz](https://github.com/sagemath/sage/files/ticket14806/sparselabel.patch.gz)**\n\nDone !",
    "created_at": "2013-08-20T14:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181118",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[sparselabel.patch.gz](https://github.com/sagemath/sage/files/ticket14806/sparselabel.patch.gz)**

Done !



---

archive/issue_comments_181119.json:
```json
{
    "body": "Merged: **sage-5.12.beta4**",
    "created_at": "2013-08-30T07:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181119",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta4**



---

archive/issue_events_210439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-30T07:12:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210439"
}
```



---

archive/issue_events_210440.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-30T07:12:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14806#event-210440"
}
```



---

archive/issue_comments_181120.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nMerci Nathann!",
    "created_at": "2013-08-30T07:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181120",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:20" align="right">comment:20</div>

Merci Nathann!



---

archive/issue_comments_181121.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n> Merci Nathann!\n\nMaintenant pour me remercier faut l'utiliser, genre pour me convaincre que je ne l'ai pas cod\u00e9 pour rien `:-P`\n\nNathann",
    "created_at": "2013-08-30T08:51:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14806#issuecomment-181121",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

> Merci Nathann!

Maintenant pour me remercier faut l'utiliser, genre pour me convaincre que je ne l'ai pas codé pour rien `:-P`

Nathann
