# Issue 14806: Immutable graph backend

archive/issues_014602.json:
```json
{
    "body": "As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n\n```\nsage: g = graphs.CompleteGraph(400)                                 \nsage: gi = Graph(g,data_structure=\"static_sparse\")\nsage: %timeit g.edges()                                             \n1 loops, best of 3: 512 ms per loop\nsage: %timeit gi.edges()\n10 loops, best of 3: 30.3 ms per loop\n```\n\nThe patch : \n\n* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n* Updates the static_sparse_graph data structure to handle labels\n* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n\nI tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:\n* (if the backend is not static) build a copy of self using a static backend\n* Check that both are equal, and otherwise scream in panic\n\nThis being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.\n\nI don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n\nNathann\n\nAssignee: jason, ncohen, rlm\n\nCC:  @dimpase azi @lobiCode simonking @vbraun stefan @nthiery @hivert\n\nReviewer: Jernej Azarija\n\nAuthor: Nathann Cohen\n\nMerged: sage-5.12.beta4\n\nDependencies: #14805\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14806\n\n",
    "closed_at": "2013-08-30T07:12:53Z",
    "created_at": "2013-06-22T12:35:53Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Immutable graph backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14806",
    "user": "https://github.com/nathanncohen"
}
```
As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.

```
sage: g = graphs.CompleteGraph(400)                                 
sage: gi = Graph(g,data_structure="static_sparse")
sage: %timeit g.edges()                                             
1 loops, best of 3: 512 ms per loop
sage: %timeit gi.edges()
10 loops, best of 3: 30.3 ms per loop
```

The patch : 

* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
* Updates the static_sparse_graph data structure to handle labels
* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.

I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:
* (if the backend is not static) build a copy of self using a static backend
* Check that both are equal, and otherwise scream in panic

This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.

I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`

Nathann

Assignee: jason, ncohen, rlm

CC:  @dimpase azi @lobiCode simonking @vbraun stefan @nthiery @hivert

Reviewer: Jernej Azarija

Author: Nathann Cohen

Merged: sage-5.12.beta4

Dependencies: #14805

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14806





---

archive/issue_comments_197996.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Nathann\n \n-Assignee: tbd\n+(not ready for a review yet)\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-22T12:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-197996",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Nathann
 
-Assignee: tbd
+(not ready for a review yet)
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_197997.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n+\n+Nathann\n+\n+(not ready for a review yet)\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-22T13:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-197997",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
+
+Nathann
+
+(not ready for a review yet)
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_197998.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n+\n+Content of [attachment:trac_14806.patch] :\n+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n+* Updates the static_sparse_graph data structure to handle labels\n+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+\n+Content of [attachment:trac_14806-keyword.patch] :\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+\n+Nathann\n+\n+Apply:\n+* [attachment:trac_14806.patch]\n+* [attachment:trac_14806-keyword.patch]\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-22T14:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-197998",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,27 @@
+As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
+
+Content of [attachment:trac_14806.patch] :
+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
+* Updates the static_sparse_graph data structure to handle labels
+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+
+Content of [attachment:trac_14806-keyword.patch] :
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+
+Nathann
+
+Apply:
+* [attachment:trac_14806.patch]
+* [attachment:trac_14806-keyword.patch]
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_197999.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,27 @@\n+As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n+\n+Content of [attachment:trac_14806.patch] :\n+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n+* Updates the static_sparse_graph data structure to handle labels\n+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+\n+Content of [attachment:trac_14806-update_keyword.patch] :\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+\n+Nathann\n+\n+Apply:\n+* [attachment:trac_14806.patch]\n+* [attachment:trac_14806-update_keyword.patch]\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-22T14:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-197999",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,27 @@
+As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
+
+Content of [attachment:trac_14806.patch] :
+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
+* Updates the static_sparse_graph data structure to handle labels
+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+
+Content of [attachment:trac_14806-update_keyword.patch] :
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+
+Nathann
+
+Apply:
+* [attachment:trac_14806.patch]
+* [attachment:trac_14806-update_keyword.patch]
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_198000.json:
```json
{
    "body": "Changing assignee from tbd to jason, ncohen, rlm.",
    "created_at": "2013-06-24T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198000",
    "user": "https://github.com/nathanncohen"
}
```

Changing assignee from tbd to jason, ncohen, rlm.



---

archive/issue_comments_198001.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2013-06-24T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198001",
    "user": "https://github.com/nathanncohen"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_198002.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,34 @@\n+As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n+\n+The patch : \n+\n+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n+* Updates the static_sparse_graph data structure to handle labels\n+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+\n+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:\n+* (if the backend is not static) build a copy of self using a static backend\n+* Check that both are equal, and otherwise scream in panic\n+\n+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.\n+\n+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n+\n+Nathann\n+\n+Apply:\n+* [attachment:trac_14806.patch]\n+* [attachment:trac_14806-update_keyword.patch]\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-24T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198002",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,34 @@
+As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
+
+The patch : 
+
+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
+* Updates the static_sparse_graph data structure to handle labels
+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+
+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:
+* (if the backend is not static) build a copy of self using a static backend
+* Check that both are equal, and otherwise scream in panic
+
+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.
+
+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`
+
+Nathann
+
+Apply:
+* [attachment:trac_14806.patch]
+* [attachment:trac_14806-update_keyword.patch]
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_198003.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+As the title says, this patch implements a data structure atop of the current \"static sparse graphs\" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.\n \n+```\n+sage: g = graphs.CompleteGraph(400)                                 \n+sage: gi = Graph(g,data_structure=\"static_sparse\")\n+sage: %timeit g.edges()                                             \n+1 loops, best of 3: 512 ms per loop\n+sage: %timeit gi.edges()\n+10 loops, best of 3: 30.3 ms per loop\n+```\n+\n+The patch : \n+\n+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.\n+* Updates the static_sparse_graph data structure to handle labels\n+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)\n+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.\n+\n+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:\n+* (if the backend is not static) build a copy of self using a static backend\n+* Check that both are equal, and otherwise scream in panic\n+\n+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.\n+\n+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`\n+\n+Nathann\n \n Author: Nathann Cohen\n \n``````\n",
    "created_at": "2013-06-24T09:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198003",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,30 @@
+As the title says, this patch implements a data structure atop of the current "static sparse graphs" which can be used as a backend for a Sage Graph. Smaller in memory, and faster.
 
+```
+sage: g = graphs.CompleteGraph(400)                                 
+sage: gi = Graph(g,data_structure="static_sparse")
+sage: %timeit g.edges()                                             
+1 loops, best of 3: 512 ms per loop
+sage: %timeit gi.edges()
+10 loops, best of 3: 30.3 ms per loop
+```
+
+The patch : 
+
+* Creates a new sage.graphs.base.static_sparse_backend modules containing two classes, StaticSparseCGraph and StaticSparseBackend, as it is done for the current sparse/dense backends.
+* Updates the static_sparse_graph data structure to handle labels
+* Updates the constructors of Graph and DiGraph by renaming the ``sparse`` keyword to ``data_structure`` which can now be set to ``sparse,dense`` or ``static_sparse`` (and others later)
+* Deals with the consequences of renaming the keyword, i.e. changes doctests everywhere in the graph/ files, and into some other files of Sage too.
+
+I tested this patch in many many ways, and in particular by adding at the end of graph/digraph `__init__` method the following two lines:
+* (if the backend is not static) build a copy of self using a static backend
+* Check that both are equal, and otherwise scream in panic
+
+This being said, many graph methods will break when the backend is static. The most obvious ones are add/remove vertex/edges, but other methods will break which supposed that any graph can be modified. For methods which do not modify the graph itself, this happens when it creates a temporary copy of it (which will use the same backend), and feel free to change that one.
+
+I don't see an automatic way to spot them, I don't think it is very bad as this static backend is a new feature and hence will not break any existing code, and this patch is already very long (and hard to review) as it is `^^;`
+
+Nathann
 
 Author: Nathann Cohen
 
``````




---

archive/issue_comments_198004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-24T09:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198004",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_198005.json:
```json
{
    "body": "<a id='comment:8'></a>* Its either \"Thou shalt not add a vertex to an immutable graph!\"\n  (Shakespeare) or \"cannot add vertex to an immutable graph\"\n  (Python). In particular, lower case and no exclamation mark at the\n  end ;)\n\n* Methods that fail due to being immutable should raise `ValueError`,\n  not `NotImplementedError` (are you going to implement it in the\n  future?)\n\n* It would be nice if INPUT/OUTPUT were consistent and would actually\n  list all arguments, for example (though there are many more)\n  `StaticSparseBackend.degree` does not document the \"directed\"\n  argument.\n\n* static_sparse_backend module docstring \"Two classes\" names the same\n  class twice.\n\n* StaticSparseCGraph docstring: \":mod:`CGraph\n  <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs\n  <sage.graphs.base.static_dense_graph>`\". I don't know what thats\n  supposed to mean.\n\n* The Python special `__copy__()` method does not allow any\n  arguments. In particular, `copy(graph)` should return a mutable copy\n  if the original `graph` is immutable.\n\n* Having to write `data_structure=\"sparse\"` is a lot less intuitive\n  than the old `sparse=True`. It would be better to allow for both\n  and raise a `ValueError` if both are changed from their default\n  values.",
    "created_at": "2013-06-24T11:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198005",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>* Its either "Thou shalt not add a vertex to an immutable graph!"
  (Shakespeare) or "cannot add vertex to an immutable graph"
  (Python). In particular, lower case and no exclamation mark at the
  end ;)

* Methods that fail due to being immutable should raise `ValueError`,
  not `NotImplementedError` (are you going to implement it in the
  future?)

* It would be nice if INPUT/OUTPUT were consistent and would actually
  list all arguments, for example (though there are many more)
  `StaticSparseBackend.degree` does not document the "directed"
  argument.

* static_sparse_backend module docstring "Two classes" names the same
  class twice.

* StaticSparseCGraph docstring: ":mod:`CGraph
  <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs
  <sage.graphs.base.static_dense_graph>`". I don't know what thats
  supposed to mean.

* The Python special `__copy__()` method does not allow any
  arguments. In particular, `copy(graph)` should return a mutable copy
  if the original `graph` is immutable.

* Having to write `data_structure="sparse"` is a lot less intuitive
  than the old `sparse=True`. It would be better to allow for both
  and raise a `ValueError` if both are changed from their default
  values.



---

archive/issue_comments_198006.json:
```json
{
    "body": "<a id='comment:9'></a>Hello !\n\n> * Its either \"Thou shalt not add a vertex to an immutable graph!\"\n>   (Shakespeare) or \"cannot add vertex to an immutable graph\"\n>   (Python). In particular, lower case and no exclamation mark at the\n>   end ;)\n\n\nI obviously chosed the \"Thou shalt not add a vertex to an immutable graph\".\n\n> * Methods that fail due to being immutable should raise `ValueError`,\n>   not `NotImplementedError` (are you going to implement it in the\n>   future?)\n\n\nI change my mind so often that I wouldn't put it beyond reach. But just to please you I fixed it `:-P`\n\n> * It would be nice if INPUT/OUTPUT were consistent and would actually\n>   list all arguments, for example (though there are many more)\n>   `StaticSparseBackend.degree` does not document the \"directed\"\n>   argument.\n\n\nWell, I defined the \"INPUT\" where it was not, but usually the outputs are pretty clear... Not to mention that those are rather meant to Sage developpers.\n\n> * static_sparse_backend module docstring \"Two classes\" names the same\n>   class twice.\n\n\nIt's a poetic license.\n \n> * StaticSparseCGraph docstring: \":mod:`CGraph\n>   <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs\n>   <sage.graphs.base.static_dense_graph>`\". I don't know what thats\n>   supposed to mean.\n\n\nThat it uses static sparse graphs as a data structure. By the way, the link and the name did not match. I rephrased it.\n\n> * The Python special `__copy__()` method does not allow any\n>   arguments. In particular, `copy(graph)` should return a mutable copy\n>   if the original `graph` is immutable.\n\n\nThere were arguments there before I learnt that Sage existed, and it is because this method can also be used through `G.copy(whatever)`. This being said, I don't see why one should get a mutable graph as a copy of an immutable one. Copying a tuple certainly does not make it a list, and it would produce rather unexpected behaviour `O_o`\n\n> * Having to write `data_structure=\"sparse\"` is a lot less intuitive\n>   than the old `sparse=True`. It would be better to allow for both\n>   and raise a `ValueError` if both are changed from their default\n>   values.\n\n\nYou have no idea how many hours I wasted on that. Unfortunately, you are right. I reversed those modifications and both keywords can now be used.\n\nPatch updated !\n\nNathann",
    "created_at": "2013-06-24T13:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198006",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>Hello !

> * Its either "Thou shalt not add a vertex to an immutable graph!"
>   (Shakespeare) or "cannot add vertex to an immutable graph"
>   (Python). In particular, lower case and no exclamation mark at the
>   end ;)


I obviously chosed the "Thou shalt not add a vertex to an immutable graph".

> * Methods that fail due to being immutable should raise `ValueError`,
>   not `NotImplementedError` (are you going to implement it in the
>   future?)


I change my mind so often that I wouldn't put it beyond reach. But just to please you I fixed it `:-P`

> * It would be nice if INPUT/OUTPUT were consistent and would actually
>   list all arguments, for example (though there are many more)
>   `StaticSparseBackend.degree` does not document the "directed"
>   argument.


Well, I defined the "INPUT" where it was not, but usually the outputs are pretty clear... Not to mention that those are rather meant to Sage developpers.

> * static_sparse_backend module docstring "Two classes" names the same
>   class twice.


It's a poetic license.
 
> * StaticSparseCGraph docstring: ":mod:`CGraph
>   <sage.graphs.base.c_graph>` class over :mod:`static sparse graphs
>   <sage.graphs.base.static_dense_graph>`". I don't know what thats
>   supposed to mean.


That it uses static sparse graphs as a data structure. By the way, the link and the name did not match. I rephrased it.

> * The Python special `__copy__()` method does not allow any
>   arguments. In particular, `copy(graph)` should return a mutable copy
>   if the original `graph` is immutable.


There were arguments there before I learnt that Sage existed, and it is because this method can also be used through `G.copy(whatever)`. This being said, I don't see why one should get a mutable graph as a copy of an immutable one. Copying a tuple certainly does not make it a list, and it would produce rather unexpected behaviour `O_o`

> * Having to write `data_structure="sparse"` is a lot less intuitive
>   than the old `sparse=True`. It would be better to allow for both
>   and raise a `ValueError` if both are changed from their default
>   values.


You have no idea how many hours I wasted on that. Unfortunately, you are right. I reversed those modifications and both keywords can now be used.

Patch updated !

Nathann



---

archive/issue_comments_198007.json:
```json
{
    "body": "<a id='comment:10'></a>Hello! \n\nAs promised I peeked at the code!! In general the patch looks good to me with the exception of the above comments.\n\n\n* Can we use xrange instead of range when we only iterate over something?\n\n* Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? \n\n* In the function **iterator_in_edges** why do we need the call to iter in the following line ?\n\n```\n            for x in iter(self.iterator_out_edges(vertices, labels)): \n\n```",
    "created_at": "2013-08-16T17:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198007",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

<a id='comment:10'></a>Hello! 

As promised I peeked at the code!! In general the patch looks good to me with the exception of the above comments.


* Can we use xrange instead of range when we only iterate over something?

* Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? 

* In the function **iterator_in_edges** why do we need the call to iter in the following line ?

```
            for x in iter(self.iterator_out_edges(vertices, labels)): 

```



---

archive/issue_comments_198008.json:
```json
{
    "body": "<a id='comment:11'></a>Cython detects \"for i in range(n)\" loops and replaces them with a C loop. So there is no point in using xrange.",
    "created_at": "2013-08-16T18:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198008",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>Cython detects "for i in range(n)" loops and replaces them with a C loop. So there is no point in using xrange.



---

archive/issue_comments_198009.json:
```json
{
    "body": "<a id='comment:12'></a>Hellooooooo !!\n\n> As promised I peeked at the code!!\n\n\nCooooooooooool ! `:-P`\n\n> * Can we use xrange instead of range when we only iterate over something?\n\n\nVolker beat me to this one.\n\n> * Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? \n\n\n`T_T`\n\nYou are right. Fixed.\n\n> * In the function **iterator_in_edges** why do we need the call to iter in the following line ?\n\n\nBecause I am an idiot. It actually explains a lot of things `:-P`\n\nFiiiiiiiiixed !\n\nNathann",
    "created_at": "2013-08-16T18:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198009",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>Hellooooooo !!

> As promised I peeked at the code!!


Cooooooooooool ! `:-P`

> * Can we use xrange instead of range when we only iterate over something?


Volker beat me to this one.

> * Can we raise a ValeError in  *'in_neighbors* if u is not in the graph as to be consistent with how out_degree works? 


`T_T`

You are right. Fixed.

> * In the function **iterator_in_edges** why do we need the call to iter in the following line ?


Because I am an idiot. It actually explains a lot of things `:-P`

Fiiiiiiiiixed !

Nathann



---

archive/issue_comments_198010.json:
```json
{
    "body": "<a id='comment:13'></a>Good! \n\nAs far as I am concerned the code is good to go! Do you want me to review it positively or wish for another less confused soul to review it as well?\n\n\n...as for xrange/range... I can see the reason for using range to be compatible with Python 3.x but somehow I am afraid the transition will never happen :-)",
    "created_at": "2013-08-16T18:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198010",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

<a id='comment:13'></a>Good! 

As far as I am concerned the code is good to go! Do you want me to review it positively or wish for another less confused soul to review it as well?


...as for xrange/range... I can see the reason for using range to be compatible with Python 3.x but somehow I am afraid the transition will never happen :-)



---

archive/issue_comments_198011.json:
```json
{
    "body": "<a id='comment:14'></a>Well... For me the code is good to go too, so if you agree with it I would be glad to see it in Sage ! Not to mention that I wrote this patch because of #14806, and that those guys will probably want to use it for their own dark ends once it will be merged `:-)`\n\nAs for Python 3, I don't know. It feels like it may take forever to move there, but then again things happened very efficiently to move to git, sooo... Well. Sage devs are surprising guys `:-)`\n\nNathann",
    "created_at": "2013-08-16T18:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198011",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Well... For me the code is good to go too, so if you agree with it I would be glad to see it in Sage ! Not to mention that I wrote this patch because of #14806, and that those guys will probably want to use it for their own dark ends once it will be merged `:-)`

As for Python 3, I don't know. It feels like it may take forever to move there, but then again things happened very efficiently to move to git, sooo... Well. Sage devs are surprising guys `:-)`

Nathann



---

archive/issue_comments_198012.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-16T18:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198012",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_198013.json:
```json
{
    "body": "<a id='comment:16'></a>Wow. THaaaaaaaaaaaaaaaaaanks ! `:-)`\n\nNathann",
    "created_at": "2013-08-16T19:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198013",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>Wow. THaaaaaaaaaaaaaaaaaanks ! `:-)`

Nathann



---

archive/issue_comments_198014.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-20T13:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198014",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_198015.json:
```json
{
    "body": "<a id='comment:17'></a>This needs to be rebased to sage-5.12.beta2.",
    "created_at": "2013-08-20T13:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198015",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>This needs to be rebased to sage-5.12.beta2.



---

archive/issue_comments_198016.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-08-20T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198016",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_198017.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [sparselabel.patch](tarball://root/attachments/some-uuid/ticket14806/sparselabel.patch) by @nathanncohen created at 2013-08-20 14:58:39\n\nDone !",
    "created_at": "2013-08-20T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198017",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>Attachment [sparselabel.patch](tarball://root/attachments/some-uuid/ticket14806/sparselabel.patch) by @nathanncohen created at 2013-08-20 14:58:39

Done !



---

archive/issue_comments_198018.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-30T07:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198018",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_042509.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-30T07:12:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14806#event-42509"
}
```



---

archive/issue_comments_198019.json:
```json
{
    "body": "<a id='comment:20'></a>Merci Nathann!",
    "created_at": "2013-08-30T07:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198019",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:20'></a>Merci Nathann!



---

archive/issue_comments_198020.json:
```json
{
    "body": "<a id='comment:21'></a>> Merci Nathann!\n\n\nMaintenant pour me remercier faut l'utiliser, genre pour me convaincre que je ne l'ai pas cod\u00e9 pour rien `:-P`\n\nNathann",
    "created_at": "2013-08-30T08:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14806",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14806#issuecomment-198020",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'></a>> Merci Nathann!


Maintenant pour me remercier faut l'utiliser, genre pour me convaincre que je ne l'ai pas cod√© pour rien `:-P`

Nathann
