# Issue 14496: unify the three implementations of gaussian q-binomial coefficients

archive/issues_014292.json:
```json
{
    "body": "In sage 5.8, one can find the gaussian q-binomial coefficients in (at least) **three** places :\n\n- sage.combinat.sf.kfpoly.q_bin\n- sage.combinat.q_analogues.q_binomial\n- sage.rings.arith.gaussian_binomial\n\nThe syntax is not quite the same for q_bin as for the two others.\n\nSome timings:\n\n```\nsage: timeit(\"sage.combinat.sf.kfpoly.q_bin(7,5)\")\n625 loops, best of 3: 819 \u00b5s per loop\nsage: timeit(\"sage.combinat.q_analogues.q_binomial(12,5)\")\n625 loops, best of 3: 1.12 ms per loop\nsage: timeit(\"sage.rings.arith.gaussian_binomial(12,5)\")  \n625 loops, best of 3: 294 \u00b5s per loop\n```\nThe parents :\n\n```\nsage: sage.combinat.sf.kfpoly.q_bin(7,5).parent()\nFraction Field of Univariate Polynomial Ring in t over Integer Ring\nsage: sage.combinat.q_analogues.q_binomial(12,5).parent()\nUnivariate Polynomial Ring in q over Integer Ring\nsage: sage.rings.arith.gaussian_binomial(12,5).parent()\nFraction Field of Univariate Polynomial Ring in q over Integer Ring\n```\nThe behaviour with an added integer parameter\n\n```\nsage: sage.combinat.sf.kfpoly.q_bin(7,5,2)               \n114429029715\nsage: sage.combinat.q_analogues.q_binomial(12,5,2)\nDOES NOT WORK\nsage: sage.rings.arith.gaussian_binomial(12,5,2)    \n114429029715\n```\nThe behaviour with a polynomial parameter\n\n```\nsage: w=polygen(ZZ,'w')\nsage: sage.combinat.sf.kfpoly.q_bin(4,2,w)\nw^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1\nsage: sage.combinat.q_analogues.q_binomial(6,2,w)   \nw^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1\nsage: sage.rings.arith.gaussian_binomial(6,2,w) \nw^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1\nsage: sage.combinat.sf.kfpoly.q_bin(4,2,w).parent()             \nUnivariate Polynomial Ring in w over Integer Ring\nsage: sage.combinat.q_analogues.q_binomial(6,2,w).parent()      \nUnivariate Polynomial Ring in w over Integer Ring\nsage: sage.rings.arith.gaussian_binomial(6,2,w).parent()        \nFraction Field of Univariate Polynomial Ring in w over Integer Ring\n```\n\nMaybe it would be better to have a single function ?\n\n**CC:**  fwclarke @AndrewAtLarge\n\n**Keywords:** gaussian binomial\n\n**Reviewer:** Francis Clarke, Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Merged:** sage-5.10.beta2\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14496\n\n",
    "closed_at": "2013-05-08T07:44:31Z",
    "created_at": "2013-04-26T20:11:22Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "unify the three implementations of gaussian q-binomial coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14496",
    "user": "https://github.com/fchapoton"
}
```
In sage 5.8, one can find the gaussian q-binomial coefficients in (at least) **three** places :

- sage.combinat.sf.kfpoly.q_bin
- sage.combinat.q_analogues.q_binomial
- sage.rings.arith.gaussian_binomial

The syntax is not quite the same for q_bin as for the two others.

Some timings:

```
sage: timeit("sage.combinat.sf.kfpoly.q_bin(7,5)")
625 loops, best of 3: 819 µs per loop
sage: timeit("sage.combinat.q_analogues.q_binomial(12,5)")
625 loops, best of 3: 1.12 ms per loop
sage: timeit("sage.rings.arith.gaussian_binomial(12,5)")  
625 loops, best of 3: 294 µs per loop
```
The parents :

```
sage: sage.combinat.sf.kfpoly.q_bin(7,5).parent()
Fraction Field of Univariate Polynomial Ring in t over Integer Ring
sage: sage.combinat.q_analogues.q_binomial(12,5).parent()
Univariate Polynomial Ring in q over Integer Ring
sage: sage.rings.arith.gaussian_binomial(12,5).parent()
Fraction Field of Univariate Polynomial Ring in q over Integer Ring
```
The behaviour with an added integer parameter

```
sage: sage.combinat.sf.kfpoly.q_bin(7,5,2)               
114429029715
sage: sage.combinat.q_analogues.q_binomial(12,5,2)
DOES NOT WORK
sage: sage.rings.arith.gaussian_binomial(12,5,2)    
114429029715
```
The behaviour with a polynomial parameter

```
sage: w=polygen(ZZ,'w')
sage: sage.combinat.sf.kfpoly.q_bin(4,2,w)
w^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1
sage: sage.combinat.q_analogues.q_binomial(6,2,w)   
w^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1
sage: sage.rings.arith.gaussian_binomial(6,2,w) 
w^8 + w^7 + 2*w^6 + 2*w^5 + 3*w^4 + 2*w^3 + 2*w^2 + w + 1
sage: sage.combinat.sf.kfpoly.q_bin(4,2,w).parent()             
Univariate Polynomial Ring in w over Integer Ring
sage: sage.combinat.q_analogues.q_binomial(6,2,w).parent()      
Univariate Polynomial Ring in w over Integer Ring
sage: sage.rings.arith.gaussian_binomial(6,2,w).parent()        
Fraction Field of Univariate Polynomial Ring in w over Integer Ring
```

Maybe it would be better to have a single function ?

**CC:**  fwclarke @AndrewAtLarge

**Keywords:** gaussian binomial

**Reviewer:** Francis Clarke, Travis Scrimshaw

**Author:** Frédéric Chapoton

**Merged:** sage-5.10.beta2

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/14496





---

archive/issue_comments_230317.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere is already a seemingly faster function. There remains to deprecate the two others. The most annoying one is q_bin, with a different syntax and with a global variable inside.",
    "created_at": "2013-04-26T21:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230317",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
Here is already a seemingly faster function. There remains to deprecate the two others. The most annoying one is q_bin, with a different syntax and with a global variable inside.



---

archive/issue_comments_230318.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-04-26T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230318",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_230319.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis looks good.  It's certainly nice to have integer parameters giving integer results.  \n\nBut `n//d` can causes problems if `q` takes a real value, and similarly in some other cases.  Perhaps this should be a \"`try:`\", with the exception giving `n/d` or even `gaussian_binomial(n, k)(q)`.  [It is surely not necessary to introduce `var` when this occurs before.]\n\nI also don't like the way (inherited from the existing code) that `n` plays two very different r\u00f4les; the line\n\n```\n        n = prod([1 - q**i for i in range(n-k+1,n+1)])\n```\nis particularly bad style.  It would make the code more readable to call them \"`numerator`\" and \"`denominator`\" (possibly abbreviated)",
    "created_at": "2013-04-27T15:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230319",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:3'></a>
This looks good.  It's certainly nice to have integer parameters giving integer results.  

But `n//d` can causes problems if `q` takes a real value, and similarly in some other cases.  Perhaps this should be a "`try:`", with the exception giving `n/d` or even `gaussian_binomial(n, k)(q)`.  [It is surely not necessary to introduce `var` when this occurs before.]

I also don't like the way (inherited from the existing code) that `n` plays two very different rôles; the line

```
        n = prod([1 - q**i for i in range(n-k+1,n+1)])
```
is particularly bad style.  It would make the code more readable to call them "`numerator`" and "`denominator`" (possibly abbreviated)



---

archive/issue_comments_230320.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-04-27T15:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230320",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_230321.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-04-27T17:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230321",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_230322.json:
```json
{
    "body": "<a id='comment:4'></a>\nHere is a new version of the patch. I have modified the names d and n and introduced a try statement. I am not sure what kind of exceptions I need to catch.\n\n\nStill it remains to choose if one keeps the gaussian_binomial or rather the q_binomial function.",
    "created_at": "2013-04-27T17:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230322",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
Here is a new version of the patch. I have modified the names d and n and introduced a try statement. I am not sure what kind of exceptions I need to catch.


Still it remains to choose if one keeps the gaussian_binomial or rather the q_binomial function.



---

archive/issue_comments_230323.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2013-04-27T17:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230323",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_comments_230324.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-04-27T18:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230324",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_230325.json:
```json
{
    "body": "<a id='comment:6'></a>\n1. There's a doctest failure at line 341 of `sage/combinat/sf/kfpoly.py`.  I don't know what's being computed here, so I don't know what's going wrong.\n\n2.  I thought the standard spacing was as\n\n```\ndef gaussian_binomial(n, k, q=None): \n```\n\n3. I think `TypeError` is enough; I never saw anything else when I was testing your code.\n\n4. Is it intentional not to alter `sage/combinat/q_analogues.py` ?\n\nSo it's nearly ready for a positive review.",
    "created_at": "2013-04-27T18:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230325",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:6'></a>
1. There's a doctest failure at line 341 of `sage/combinat/sf/kfpoly.py`.  I don't know what's being computed here, so I don't know what's going wrong.

2.  I thought the standard spacing was as

```
def gaussian_binomial(n, k, q=None): 
```

3. I think `TypeError` is enough; I never saw anything else when I was testing your code.

4. Is it intentional not to alter `sage/combinat/q_analogues.py` ?

So it's nearly ready for a positive review.



---

archive/issue_comments_230326.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2013-04-27T19:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230326",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_230327.json:
```json
{
    "body": "<a id='comment:7'></a>\nHere is a new patch. \n\nPoint 1 is indeed a problem. I do not understand either what is computed in the weight function. The procedure q_bin was returning 1 for any negative values of n and any k. This is not a very natural behaviour.\n\nPoint 4 : I have chosen that the name to be kept would be q_binomial.\n\nThere is another problem remaining. The existing algorithm in sage.combinat.q_analogues uses cyclotomic polynomials and become faster than the naive one when the arguments are big (and of similar size ?), but is much slower in some cases (when n is small or k is small ?).\n\n```\nsage: timeit(\"sage.combinat.q_analogues.q_binomial(85,3)\")\n625 loops, best of 3: 246 \u00b5s per loop\nsage: timeit(\"sage.combinat.q_analogues.q_binomial_via_cyclotomic(85,3)\")\n125 loops, best of 3: 2.78 ms per loop\nsage: timeit(\"sage.combinat.q_analogues.q_binomial(85,43)\")               \n25 loops, best of 3: 9.21 ms per loop\nsage: timeit(\"sage.combinat.q_analogues.q_binomial_via_cyclotomic(85,43)\")\n25 loops, best of 3: 8.18 ms per loop\n```\nSo one needs to keep both and find a strategy of choice..",
    "created_at": "2013-04-27T19:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230327",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
Here is a new patch. 

Point 1 is indeed a problem. I do not understand either what is computed in the weight function. The procedure q_bin was returning 1 for any negative values of n and any k. This is not a very natural behaviour.

Point 4 : I have chosen that the name to be kept would be q_binomial.

There is another problem remaining. The existing algorithm in sage.combinat.q_analogues uses cyclotomic polynomials and become faster than the naive one when the arguments are big (and of similar size ?), but is much slower in some cases (when n is small or k is small ?).

```
sage: timeit("sage.combinat.q_analogues.q_binomial(85,3)")
625 loops, best of 3: 246 µs per loop
sage: timeit("sage.combinat.q_analogues.q_binomial_via_cyclotomic(85,3)")
125 loops, best of 3: 2.78 ms per loop
sage: timeit("sage.combinat.q_analogues.q_binomial(85,43)")               
25 loops, best of 3: 9.21 ms per loop
sage: timeit("sage.combinat.q_analogues.q_binomial_via_cyclotomic(85,43)")
25 loops, best of 3: 8.18 ms per loop
```
So one needs to keep both and find a strategy of choice..



---

archive/issue_comments_230328.json:
```json
{
    "body": "<a id='comment:8'></a>\nI'll take a look at why the weight function in SF fails; but the best way to fix it is in the weight, have a check for negative `n` or `k` and just circumvent the call to `q_binomial()` and return 1.\n\nAs for the speed of the naive vs. cyclotomic polys, I would pick a cutoff value which you think is about the breakeven point(s) for the two, and call which ever function is faster based on that.\n\nAlso, have you tried implementing it by computing the q-binomial, then substituting in a user defined `q` value to the result (in particular, have you compared the speed)? I'm thinking this might be slower than just computing it outright if `q` is in `GF(3)` for example... If you haven't, I can write it up and run the tests.\n\nThanks for noticing this and working on it,\n\nTravis",
    "created_at": "2013-04-27T20:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230328",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
I'll take a look at why the weight function in SF fails; but the best way to fix it is in the weight, have a check for negative `n` or `k` and just circumvent the call to `q_binomial()` and return 1.

As for the speed of the naive vs. cyclotomic polys, I would pick a cutoff value which you think is about the breakeven point(s) for the two, and call which ever function is faster based on that.

Also, have you tried implementing it by computing the q-binomial, then substituting in a user defined `q` value to the result (in particular, have you compared the speed)? I'm thinking this might be slower than just computing it outright if `q` is in `GF(3)` for example... If you haven't, I can write it up and run the tests.

Thanks for noticing this and working on it,

Travis



---

archive/issue_comments_230329.json:
```json
{
    "body": "<a id='comment:9'></a>\nGood idea, I have done just that in the new patch, so there is no doctest failure now.\n\nThere remains to choose a strategy..",
    "created_at": "2013-04-27T20:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230329",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
Good idea, I have done just that in the new patch, so there is no doctest failure now.

There remains to choose a strategy..



---

archive/issue_comments_230330.json:
```json
{
    "body": "<a id='comment:10'></a>\nSome timings were given in the ticket #13166\n\nAccording to my own timings, it seems that for n <= ~ 78 the naive algorithm is faster than the cyclotomic algorithm for computing the gaussian polynomial.",
    "created_at": "2013-04-27T20:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230330",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
Some timings were given in the ticket #13166

According to my own timings, it seems that for n <= ~ 78 the naive algorithm is faster than the cyclotomic algorithm for computing the gaussian polynomial.



---

archive/issue_comments_230331.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [chapoton](#comment%3A10):\n> According to my own timings, it seems that for n <= ~ 78 the naive algorithm is faster than the cyclotomic algorithm for computing the gaussian polynomial.\n\n\nI get much the same.  For `gaussian_binomial(2*k, k)` I found the naive method faster for `k < 30`, and the cyclotomic method faster for `k > 30'.\n\nOne point about the naive method:\n\n```\nsage: %timeit gaussian_binomial(50, 4)\n1000 loops, best of 3: 287 \u00b5s per loop\nsage: %timeit gaussian_binomial(50, 46)\n100 loops, best of 3: 3.41 ms per loop\n```\nSince the code contains two loops of length `k`, it's obviously better to evaluate `gaussian_binomial(n, k)` as `gaussian_binomial(n, n-k)` if `k > n/2`.",
    "created_at": "2013-04-28T11:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230331",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:11'></a>
Replying to [chapoton](#comment%3A10):
> According to my own timings, it seems that for n <= ~ 78 the naive algorithm is faster than the cyclotomic algorithm for computing the gaussian polynomial.


I get much the same.  For `gaussian_binomial(2*k, k)` I found the naive method faster for `k < 30`, and the cyclotomic method faster for `k > 30'.

One point about the naive method:

```
sage: %timeit gaussian_binomial(50, 4)
1000 loops, best of 3: 287 µs per loop
sage: %timeit gaussian_binomial(50, 46)
100 loops, best of 3: 3.41 ms per loop
```
Since the code contains two loops of length `k`, it's obviously better to evaluate `gaussian_binomial(n, k)` as `gaussian_binomial(n, n-k)` if `k > n/2`.



---

archive/issue_comments_230332.json:
```json
{
    "body": "<a id='comment:12'></a>\nHere is a new patch\n\n* using the minimum of k and n-k in the naive algo\n\n* implementing the following strategy :\n\nif n <= 70 or k <= N/4 or q is not a polynomial, use the naive algo\n\notherwise use the cyclotomic algo\n\nI have found this strategy using some timings (I only timed the polynomial case).",
    "created_at": "2013-04-28T19:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230332",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
Here is a new patch

* using the minimum of k and n-k in the naive algo

* implementing the following strategy :

if n <= 70 or k <= N/4 or q is not a polynomial, use the naive algo

otherwise use the cyclotomic algo

I have found this strategy using some timings (I only timed the polynomial case).



---

archive/issue_comments_230333.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2013-04-28T19:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230333",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_230334.json:
```json
{
    "body": "**Reviewer:** Francis Clarke, Travis Scrimshaw",
    "created_at": "2013-04-28T19:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230334",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Francis Clarke, Travis Scrimshaw



---

archive/issue_comments_230335.json:
```json
{
    "body": "<a id='comment:15'></a>\nTwo points remain, I think:\n\n1. On speed, I see that you are not using the cyclotomic method when `q` is not a polynomial.  But by using `cyclotomic_value` the faster method can be efficient for \"scalar\" values too.\n\n2. I don't see any reason why `gaussian_binomial` should be *deprecated*.  This terminology is in common use, and a mathematician who knows only this name should not be told that it is \"wrong\".  She should be able to use it without necessarily ever knowing that some people use a different name.  Doesn't deprecation mean that eventually the function will disappear from Sage?  This would only cause confusion.  Surely the two should be *synonyms*, as are, for example, the number-field methods `ring_of_integers` and `maximal_order`.",
    "created_at": "2013-04-29T09:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230335",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:15'></a>
Two points remain, I think:

1. On speed, I see that you are not using the cyclotomic method when `q` is not a polynomial.  But by using `cyclotomic_value` the faster method can be efficient for "scalar" values too.

2. I don't see any reason why `gaussian_binomial` should be *deprecated*.  This terminology is in common use, and a mathematician who knows only this name should not be told that it is "wrong".  She should be able to use it without necessarily ever knowing that some people use a different name.  Doesn't deprecation mean that eventually the function will disappear from Sage?  This would only cause confusion.  Surely the two should be *synonyms*, as are, for example, the number-field methods `ring_of_integers` and `maximal_order`.



---

archive/issue_comments_230336.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-04-29T09:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230336",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_019563.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14496_qbinomial-fc.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14496/trac_14496_qbinomial-fc.patch",
    "created_at": "2013-04-29T20:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/fchapoton"
}
```



---

archive/issue_comments_230337.json:
```json
{
    "body": "",
    "created_at": "2013-04-29T20:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230337",
    "user": "https://github.com/fchapoton"
}
```





---

archive/issue_comments_230338.json:
```json
{
    "body": "<a id='comment:16'></a>\nHere is a new patch.\n\nFor point 2, I have now defined gaussian_binomial as being an alias to q_binomial. The global namespace only contains gaussian_binomial, as before the patch.\n\nFor point 1, I have made some changes in the choice of algo, mainly about symbolic inputs. But I do not think that it is really worth spending more time on trying harder to enhance the speed for arbitrary inputs. This function is supposed to be used mainly without 3rd argument.",
    "created_at": "2013-04-29T20:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230338",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Here is a new patch.

For point 2, I have now defined gaussian_binomial as being an alias to q_binomial. The global namespace only contains gaussian_binomial, as before the patch.

For point 1, I have made some changes in the choice of algo, mainly about symbolic inputs. But I do not think that it is really worth spending more time on trying harder to enhance the speed for arbitrary inputs. This function is supposed to be used mainly without 3rd argument.



---

archive/issue_comments_230339.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-04-30T07:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230339",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_230340.json:
```json
{
    "body": "<a id='comment:18'></a>\nHey Frederic and Francis,\n\nI've uploaded a review patch which does two things I wanted, an input for the algorithm and handling objects which may not have division (by computing it using a formal variable and then substituting in `q`). If you're happy with my changes, feel free to set this to a positive review.\n\nBest,\n\nTravis",
    "created_at": "2013-04-30T19:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230340",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Hey Frederic and Francis,

I've uploaded a review patch which does two things I wanted, an input for the algorithm and handling objects which may not have division (by computing it using a formal variable and then substituting in `q`). If you're happy with my changes, feel free to set this to a positive review.

Best,

Travis



---

archive/issue_comments_230341.json:
```json
{
    "body": "<a id='comment:19'></a>\nhello,\n\nit seems to me that at the end you can write simply\n\n```\nreturn q_binomial(n, k)(q) \n```\nbecause then the polygen import will be done inside the function",
    "created_at": "2013-04-30T19:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230341",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
hello,

it seems to me that at the end you can write simply

```
return q_binomial(n, k)(q) 
```
because then the polygen import will be done inside the function



---

archive/attachments_019564.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14496-qbinomial-review-ts.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14496/trac_14496-qbinomial-review-ts.patch",
    "created_at": "2013-04-30T21:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_230342.json:
```json
{
    "body": "<a id='comment:20'></a>\nYep, that works. I've uploaded the updated patch.",
    "created_at": "2013-04-30T21:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230342",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>
Yep, that works. I've uploaded the updated patch.



---

archive/issue_comments_230343.json:
```json
{
    "body": "<a id='comment:21'></a>\nI was about to say positive review, when I noticed two things:\n\n1.  `gaussian_polynomial(5, 2, 7r)` fails.  But this caused by a feature of `cyclotomic_value`, so should probably be ignored.\n\n2.  `gaussian_binomial(4, 2, Zmod(6)(2), algorithm='naive')` fails.  This can be very simply rectified by excepting a `ZeroDivisionError` as well as a `TypeError` just before the \"last attempt\".",
    "created_at": "2013-05-01T20:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230343",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:21'></a>
I was about to say positive review, when I noticed two things:

1.  `gaussian_polynomial(5, 2, 7r)` fails.  But this caused by a feature of `cyclotomic_value`, so should probably be ignored.

2.  `gaussian_binomial(4, 2, Zmod(6)(2), algorithm='naive')` fails.  This can be very simply rectified by excepting a `ZeroDivisionError` as well as a `TypeError` just before the "last attempt".



---

archive/issue_comments_230344.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-05-01T20:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230344",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_230345.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-05-04T09:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230345",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_230346.json:
```json
{
    "body": "<a id='comment:22'></a>\nPoint 2 is done. I vote to ignore point 1 (anyway, who cares about that ?)",
    "created_at": "2013-05-04T09:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230346",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'></a>
Point 2 is done. I vote to ignore point 1 (anyway, who cares about that ?)



---

archive/issue_comments_230347.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [chapoton](#comment%3A22):\n> Point 2 is done. I vote to ignore point 1 (anyway, who cares about that ?)\n\n\nAgreed.  Positive review.",
    "created_at": "2013-05-04T10:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230347",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:23'></a>
Replying to [chapoton](#comment%3A22):
> Point 2 is done. I vote to ignore point 1 (anyway, who cares about that ?)


Agreed.  Positive review.



---

archive/issue_comments_230348.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-05-04T10:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230348",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_230349.json:
```json
{
    "body": "<a id='comment:24'></a>\n\n```\ndochtml.log:[combinat ] /mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py:docstring of sage.combinat.q_analogues.q_binomial:141: WARNING: Duplicate explicit target name: \"ch2006\".\ndochtml.log:[combinat ] /mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py:docstring of sage.combinat.q_analogues.q_binomial:141: WARNING: duplicate citation CH2006, other instance in /mazur/release/merger/sage-5.10.beta2/devel/sage/doc/en/reference/combinat/sage/combinat/q_analogues.rst\n```",
    "created_at": "2013-05-04T17:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230349",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>

```
dochtml.log:[combinat ] /mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py:docstring of sage.combinat.q_analogues.q_binomial:141: WARNING: Duplicate explicit target name: "ch2006".
dochtml.log:[combinat ] /mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py:docstring of sage.combinat.q_analogues.q_binomial:141: WARNING: duplicate citation CH2006, other instance in /mazur/release/merger/sage-5.10.beta2/devel/sage/doc/en/reference/combinat/sage/combinat/q_analogues.rst
```



---

archive/issue_comments_230350.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2013-05-04T17:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230350",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_230351.json:
```json
{
    "body": "<a id='comment:25'></a>\nah, well, sorry. \n\nThis is because I defined an alias in an incorrect way, using\n`gaussian_binomial = q_binomial`\n\nBut what is the correct way ?",
    "created_at": "2013-05-04T17:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230351",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
ah, well, sorry. 

This is because I defined an alias in an incorrect way, using
`gaussian_binomial = q_binomial`

But what is the correct way ?



---

archive/issue_comments_230352.json:
```json
{
    "body": "<a id='comment:26'></a>\nHum, it seems that I have used the correct way to create an alias. But as the doc is duplicated (instead of saying that one function is an alias for the other), it will necessarily create a conflict any time it contains a reference. I am surprised that this problem has never been met before !\n\nOne can compare the situation to the definition of charpoly and characteristic_polynomial in sage.misc.functional, which does not contain a reference, hence dos not raise this problem.",
    "created_at": "2013-05-04T18:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230352",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
Hum, it seems that I have used the correct way to create an alias. But as the doc is duplicated (instead of saying that one function is an alias for the other), it will necessarily create a conflict any time it contains a reference. I am surprised that this problem has never been met before !

One can compare the situation to the definition of charpoly and characteristic_polynomial in sage.misc.functional, which does not contain a reference, hence dos not raise this problem.



---

archive/issue_comments_230353.json:
```json
{
    "body": "<a id='comment:27'></a>\nThere are two workarounds I can see:\n\n1. Put the reference in a place that isn't duplicated such as at the module level.\n2. Write in `gaussian_binomial()` which calls `q_binomial()` and it's doc just says \"see `q_binomial()`\"\n\nOption 2 is more work and less clean IMO. Option 1 isn't perfect to me either but is the lesser of 2 evils. Up to you; either way would be okay with me.",
    "created_at": "2013-05-04T20:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230353",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
There are two workarounds I can see:

1. Put the reference in a place that isn't duplicated such as at the module level.
2. Write in `gaussian_binomial()` which calls `q_binomial()` and it's doc just says "see `q_binomial()`"

Option 2 is more work and less clean IMO. Option 1 isn't perfect to me either but is the lesser of 2 evils. Up to you; either way would be okay with me.



---

archive/issue_comments_230354.json:
```json
{
    "body": "<a id='comment:29'></a>\nok, this should be good now. Back to positive review",
    "created_at": "2013-05-05T16:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230354",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>
ok, this should be good now. Back to positive review



---

archive/issue_comments_230355.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2013-05-05T16:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230355",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_230356.json:
```json
{
    "body": "<a id='comment:30'></a>\nHey Frederic,\n\nTwo minor things on the doc for `gaussian_binomial()`:\n\n- There should be periods '.' at the end of the sentences.\n- The 'this function' is slightly ambiguous to me, I would explicitly put <code>:func:\\`q_binomial()\\`</code> to avoid this.\n\nOtherwise I'm also happy with the patch. Thanks.",
    "created_at": "2013-05-06T15:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230356",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>
Hey Frederic,

Two minor things on the doc for `gaussian_binomial()`:

- There should be periods '.' at the end of the sentences.
- The 'this function' is slightly ambiguous to me, I would explicitly put <code>:func:\`q_binomial()\`</code> to avoid this.

Otherwise I'm also happy with the patch. Thanks.



---

archive/attachments_019565.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14496-qbinomial-rev-rev-fc.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14496/trac_14496-qbinomial-rev-rev-fc.patch",
    "created_at": "2013-05-06T18:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/fchapoton"
}
```



---

archive/issue_comments_230357.json:
```json
{
    "body": "",
    "created_at": "2013-05-06T18:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230357",
    "user": "https://github.com/fchapoton"
}
```





---

archive/issue_comments_230358.json:
```json
{
    "body": "<a id='comment:31'></a>\nDone, and thanks for the review",
    "created_at": "2013-05-06T18:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230358",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
Done, and thanks for the review



---

archive/issue_comments_230359.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2013-05-08T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230359",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_047514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-08T07:44:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14496#event-47514"
}
```



---

archive/issue_comments_230360.json:
```json
{
    "body": "**Merged:** sage-5.10.beta2",
    "created_at": "2013-05-08T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14496",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14496#issuecomment-230360",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.beta2
