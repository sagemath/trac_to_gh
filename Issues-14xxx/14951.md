# Issue 14951: tokenize() function in logic/logicparser.py infinite loop

archive/issues_014714.json:
```json
{
    "body": "The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinite loop because of the '-':\n\n```python\nsage: import sage.logic.propcalc as propcalc\n\nsage: f = propcalc.formula(\"a-b\")\n```\n\nThe BooleanFormula class located in logic/boolformula.py also needs a method that returns the full syntax parse tree of a boolean formula, so that each formula has a unique parse tree.  The BooleanFormula tree() method does not serve this purpose.\n\n**Assignee:** Paul Scurek\n\n**Keywords:** logic, propcalc, logicparser\n\n**Reviewer:** William Stein\n\n**Author:** Paul Scurek\n\n**Merged:** sage-5.12.beta2\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14951\n\n",
    "closed_at": "2013-08-16T21:19:50Z",
    "created_at": "2013-07-22T18:07:46Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "tokenize() function in logic/logicparser.py infinite loop",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14951",
    "user": "https://github.com/pscurek"
}
```
The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinite loop because of the '-':

```python
sage: import sage.logic.propcalc as propcalc

sage: f = propcalc.formula("a-b")
```

The BooleanFormula class located in logic/boolformula.py also needs a method that returns the full syntax parse tree of a boolean formula, so that each formula has a unique parse tree.  The BooleanFormula tree() method does not serve this purpose.

**Assignee:** Paul Scurek

**Keywords:** logic, propcalc, logicparser

**Reviewer:** William Stein

**Author:** Paul Scurek

**Merged:** sage-5.12.beta2

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/14951





---

archive/issue_comments_239980.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinitely loop because of the '-':\n+The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinite loop because of the '-':\n \n ```python\n sage: import sage.logic.propcalc as propcalc\n``````\n",
    "created_at": "2013-07-22T19:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239980",
    "user": "https://github.com/pscurek"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinitely loop because of the '-':
+The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinite loop because of the '-':
 
 ```python
 sage: import sage.logic.propcalc as propcalc
``````




---

archive/issue_comments_239981.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt is OK that the docstrings are not formatted as in the reference manual, for *consistency* with the rest of this file.  We'll apply Mike Hansen's automatic old docstring --> new docstring conversion tool to the whole logic/ module later.\n\n[ ] Rewrite polish_notation to use \n\n```\n   ''.join(sage.misc.flatten(logicparser.polish_parse(repr(self))))\n```\n\n[ ] Move this comment (below) so it aligns correctly, and there is a space after #:\n\n```\n    tree = tree_parse(toks, polish = True)\n        #special case where the formula s is a single variable\n    if type(tree) is StringType and len([tree]) == 1:\n```\n\n[ ] This looks suspicious since it is always tautologically true -- see if you can figure out what's up with this craziness:\n\n```\n    len([tree]) == 1\n```\n\n[ ] The Python way to do this\n\n```\ntype(tree) is StringType\n```\nis to do this:\n\n```\nisinstance(tree, StringType)\n```\n\n[ ] Clean up this comment:\n\n```\n #check to see if '-', '<' or '>' are used incorretly \n```\nto\n\n```\n # check to see if '-', '<' or '>' are used incorrectly \n```\n\n[ ] Typo: `When true, caues the function to produce the full `  (missing letter in \"caues\")\n\n[ ] Mention the default values in docstrings.\n\n[ ] In python replace `if polish == False:` by the more idomatic `if not polish`",
    "created_at": "2013-07-24T19:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239981",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
It is OK that the docstrings are not formatted as in the reference manual, for *consistency* with the rest of this file.  We'll apply Mike Hansen's automatic old docstring --> new docstring conversion tool to the whole logic/ module later.

[ ] Rewrite polish_notation to use 

```
   ''.join(sage.misc.flatten(logicparser.polish_parse(repr(self))))
```

[ ] Move this comment (below) so it aligns correctly, and there is a space after #:

```
    tree = tree_parse(toks, polish = True)
        #special case where the formula s is a single variable
    if type(tree) is StringType and len([tree]) == 1:
```

[ ] This looks suspicious since it is always tautologically true -- see if you can figure out what's up with this craziness:

```
    len([tree]) == 1
```

[ ] The Python way to do this

```
type(tree) is StringType
```
is to do this:

```
isinstance(tree, StringType)
```

[ ] Clean up this comment:

```
 #check to see if '-', '<' or '>' are used incorretly 
```
to

```
 # check to see if '-', '<' or '>' are used incorrectly 
```

[ ] Typo: `When true, caues the function to produce the full `  (missing letter in "caues")

[ ] Mention the default values in docstrings.

[ ] In python replace `if polish == False:` by the more idomatic `if not polish`



---

archive/issue_comments_239982.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2013-07-24T19:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239982",
    "user": "https://github.com/williamstein"
}
```

**Reviewer:** William Stein



---

archive/issue_comments_239983.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-07-24T19:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239983",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_239984.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2013-07-24T19:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239984",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/attachments_020077.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14951_tokenize_tree_fix.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14951/trac_14951_tokenize_tree_fix.patch",
    "created_at": "2013-07-29T00:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/pscurek"
}
```



---

archive/issue_comments_239985.json:
```json
{
    "body": "fixes issues raised in ticket and issues raised by revewers",
    "created_at": "2013-07-29T00:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239985",
    "user": "https://github.com/pscurek"
}
```

fixes issues raised in ticket and issues raised by revewers



---

archive/issue_comments_239986.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe attachment trac_14951_tokenize_tree_fix.patch is large because it includes some changes to indentation, and hence I configured my .hgrc file to have Mercurial recognize whitespace.  Here are the files and functions that are relevant to the ticket:\n\nin boolformula.py -- `__init__`(), polish_notation(), full_tree()\n\nin logicparser.py -- parse(), polish_parse(), tokenize(), tree_parse(), parse_ltor()",
    "created_at": "2013-07-29T00:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239986",
    "user": "https://github.com/pscurek"
}
```

<a id='comment:5'></a>
The attachment trac_14951_tokenize_tree_fix.patch is large because it includes some changes to indentation, and hence I configured my .hgrc file to have Mercurial recognize whitespace.  Here are the files and functions that are relevant to the ticket:

in boolformula.py -- `__init__`(), polish_notation(), full_tree()

in logicparser.py -- parse(), polish_parse(), tokenize(), tree_parse(), parse_ltor()



---

archive/issue_comments_239987.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-07-29T00:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239987",
    "user": "https://github.com/pscurek"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_239988.json:
```json
{
    "body": "<a id='comment:6'></a>\nAlmost there:\n\n- typo \"a boolean formlua\".  \n\n- typo \"incorretly\" \n\nPositive review once you post another little patch to fix those two typos.\n\nAnd yes, release manager, the docstrings are all scary -- there will be another ticket that uniformly modernizes the docstring formatting.",
    "created_at": "2013-07-31T19:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239988",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
Almost there:

- typo "a boolean formlua".  

- typo "incorretly" 

Positive review once you post another little patch to fix those two typos.

And yes, release manager, the docstrings are all scary -- there will be another ticket that uniformly modernizes the docstring formatting.



---

archive/issue_comments_239989.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am currently working on a patch to update all of the docstrings in the logic module.  The typos \"a boolean formlua\" and \"incorretly\" will be addressed in that patch.",
    "created_at": "2013-08-03T22:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239989",
    "user": "https://github.com/pscurek"
}
```

<a id='comment:7'></a>
I am currently working on a patch to update all of the docstrings in the logic module.  The typos "a boolean formlua" and "incorretly" will be addressed in that patch.



---

archive/issue_events_049292.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14951#event-49292"
}
```



---

archive/issue_comments_239990.json:
```json
{
    "body": "<a id='comment:9'></a>\nPositive review since the typos are fixed as part of #15013.",
    "created_at": "2013-08-14T19:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239990",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>
Positive review since the typos are fixed as part of #15013.



---

archive/issue_comments_239991.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-08-14T19:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239991",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_239992.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2013-08-16T21:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239992",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_239993.json:
```json
{
    "body": "**Merged:** sage-5.12.beta2",
    "created_at": "2013-08-16T21:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14951#issuecomment-239993",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.12.beta2



---

archive/issue_events_049293.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-16T21:19:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14951",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14951#event-49293"
}
```
