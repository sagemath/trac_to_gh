# Issue 14826: Newton polygons

archive/issues_014622.json:
```json
{
    "body": "Assignee: @roed314\n\nKeywords: Newton polygons\n\nThis patch implements basic functions on Newton polygons.\n\nA small demo is available here: https://cethop.math.cnrs.fr:8443/home/pub/5/\n\n---\nApply only [attachment:trac_14826_newton_polygons.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/14826\n\n",
    "closed_at": "2013-08-20T12:59:08Z",
    "created_at": "2013-06-26T11:09:31Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Newton polygons",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14826",
    "user": "https://github.com/xcaruso"
}
```
Assignee: @roed314

Keywords: Newton polygons

This patch implements basic functions on Newton polygons.

A small demo is available here: https://cethop.math.cnrs.fr:8443/home/pub/5/

---
Apply only [attachment:trac_14826_newton_polygons.patch]

Issue created by migration from https://trac.sagemath.org/ticket/14826





---

archive/issue_comments_185771.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-26T11:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185771",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_185772.json:
```json
{
    "body": "That is of course not the same Newton polygon as \n\n```\nsage: R.<x,y> = QQ[]\nsage: (1+x+y).newton_polytope()\nA 2-dimensional polyhedron in ZZ^2 defined as the convex hull of 3 vertices\n```\nThere might be a better place that does not require another global name, maybe as method of local fields? At the very least the `NewtonPolygon` docstring should make an effort to disambiguate.\n\nA less scary way than `_normalize()` to compute the hull is to use some of Sage's existing polyhedral computation facilities:\n\n```\nsage: hull = Polyhedron([(0,0), (1,1), (2,-1), (3,0)], rays=[(0,1)])\nsage: hull.vertices()\n(A vertex at (0, 0), A vertex at (3, 0), A vertex at (2, -1))\n```\n\nDocstrings frequently need `INPUT` / `OUTPUT`, see the sage developer manual\n\nPEP 8 spacing, e.g. \n\n```\n    def __le__(self,other):    # no\n    def __le__(self, other):   # yes\n```\n\n\n* `ParentNewtonPolygon.__repr__` should be `_repr_`\n* `NewtonPolygon_lastslope._repr_` docstring has unused import",
    "created_at": "2013-06-26T12:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185772",
    "user": "https://github.com/vbraun"
}
```

That is of course not the same Newton polygon as 

```
sage: R.<x,y> = QQ[]
sage: (1+x+y).newton_polytope()
A 2-dimensional polyhedron in ZZ^2 defined as the convex hull of 3 vertices
```
There might be a better place that does not require another global name, maybe as method of local fields? At the very least the `NewtonPolygon` docstring should make an effort to disambiguate.

A less scary way than `_normalize()` to compute the hull is to use some of Sage's existing polyhedral computation facilities:

```
sage: hull = Polyhedron([(0,0), (1,1), (2,-1), (3,0)], rays=[(0,1)])
sage: hull.vertices()
(A vertex at (0, 0), A vertex at (3, 0), A vertex at (2, -1))
```

Docstrings frequently need `INPUT` / `OUTPUT`, see the sage developer manual

PEP 8 spacing, e.g. 

```
    def __le__(self,other):    # no
    def __le__(self, other):   # yes
```


* `ParentNewtonPolygon.__repr__` should be `_repr_`
* `NewtonPolygon_lastslope._repr_` docstring has unused import



---

archive/issue_comments_185773.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> There might be a better place that does not require another global name, maybe as method of local fields? At the very least the `NewtonPolygon` docstring should make an effort to disambiguate.\n\n\nIf there is some risk of confusion, the best is probably to remove the import of the constructor `NewtonPolygon`. Indeed, as you say, these Newton polygons are mainly used for polynomials or series over padics (see tickets #14828 and #14830) and the user is definitely supposed to write `f.newton_polygon()` if `f` is such a polynomial or a series and not to construct a Newton polygon by himself.\n\n> A less scary way than `_normalize()` to compute the hull is to use some of Sage's existing polyhedral computation facilities:\n\n\nI wonder if it makes sense to derive the class `NewtonPolygon` (provided by this patch) from `Polyhedron_QQ`.\n\nThere are obviously similarities (Newton polygons are polyhedrons in **Q**<sup>2</sup>) but also differences (the sum of two Newton polygons are their convex hull, the product of two Newton polygons are their Minkowski sum).\n\nWhat is your opinion?\n\n> Docstrings frequently need `INPUT` / `OUTPUT`, see the sage developer manual\n> \n> PEP 8 spacing, e.g. \n> \n> ```\n>     def __le__(self,other):    # no\n>     def __le__(self, other):   # yes\n> ```\n> \n> \n> * `ParentNewtonPolygon.__repr__` should be `_repr_`\n> * `NewtonPolygon_lastslope._repr_` docstring has unused import\n\n\nThanks. I will fix it.",
    "created_at": "2013-06-27T06:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185773",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:2 vbraun]:
> There might be a better place that does not require another global name, maybe as method of local fields? At the very least the `NewtonPolygon` docstring should make an effort to disambiguate.


If there is some risk of confusion, the best is probably to remove the import of the constructor `NewtonPolygon`. Indeed, as you say, these Newton polygons are mainly used for polynomials or series over padics (see tickets #14828 and #14830) and the user is definitely supposed to write `f.newton_polygon()` if `f` is such a polynomial or a series and not to construct a Newton polygon by himself.

> A less scary way than `_normalize()` to compute the hull is to use some of Sage's existing polyhedral computation facilities:


I wonder if it makes sense to derive the class `NewtonPolygon` (provided by this patch) from `Polyhedron_QQ`.

There are obviously similarities (Newton polygons are polyhedrons in **Q**<sup>2</sup>) but also differences (the sum of two Newton polygons are their convex hull, the product of two Newton polygons are their Minkowski sum).

What is your opinion?

> Docstrings frequently need `INPUT` / `OUTPUT`, see the sage developer manual
> 
> PEP 8 spacing, e.g. 
> 
> ```
>     def __le__(self,other):    # no
>     def __le__(self, other):   # yes
> ```
> 
> 
> * `ParentNewtonPolygon.__repr__` should be `_repr_`
> * `NewtonPolygon_lastslope._repr_` docstring has unused import


Thanks. I will fix it.



---

archive/issue_comments_185774.json:
```json
{
    "body": "If your aim is to construct newton polygons from polynomials over local fields anyways then I would just make it a method there. \n\nInheriting from `Polyhedron` would give you a lot of undesirable methods, so I would probably use composition over inheritance (than is, have a `self._polyhedron` attribute instead of superclass). Though at the end of the day both ways would work.",
    "created_at": "2013-06-27T11:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185774",
    "user": "https://github.com/vbraun"
}
```

If your aim is to construct newton polygons from polynomials over local fields anyways then I would just make it a method there. 

Inheriting from `Polyhedron` would give you a lot of undesirable methods, so I would probably use composition over inheritance (than is, have a `self._polyhedron` attribute instead of superclass). Though at the end of the day both ways would work.



---

archive/issue_comments_185775.json:
```json
{
    "body": "Ok. Revised version posted...",
    "created_at": "2013-06-28T20:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185775",
    "user": "https://github.com/xcaruso"
}
```

Ok. Revised version posted...



---

archive/issue_comments_185776.json:
```json
{
    "body": "I like this implementation much more than redoing everything from scratch (as is done in #6084).\n\n* Not all functions have doctests or even documentation.\n* There are doctest failures (click on the yellow blob at the top of this page to see them)",
    "created_at": "2013-07-08T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185776",
    "user": "https://github.com/roed314"
}
```

I like this implementation much more than redoing everything from scratch (as is done in #6084).

* Not all functions have doctests or even documentation.
* There are doctest failures (click on the yellow blob at the top of this page to see them)



---

archive/issue_comments_185777.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-08T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185777",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_185778.json:
```json
{
    "body": "Thanks! It's fixed.",
    "created_at": "2013-07-09T18:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185778",
    "user": "https://github.com/xcaruso"
}
```

Thanks! It's fixed.



---

archive/issue_comments_185779.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-09T18:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185779",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_185780.json:
```json
{
    "body": "The function last_slope on lines 230 - 241 doesn't have input and output blocks, or an example block.",
    "created_at": "2013-07-11T21:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185780",
    "user": "https://trac.sagemath.org/admin/accounts/users/amy"
}
```

The function last_slope on lines 230 - 241 doesn't have input and output blocks, or an example block.



---

archive/issue_comments_185781.json:
```json
{
    "body": "Fixed.",
    "created_at": "2013-07-12T11:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185781",
    "user": "https://github.com/xcaruso"
}
```

Fixed.



---

archive/issue_comments_185782.json:
```json
{
    "body": "nice and useful code! \n\nafter testing a bit myself I only found one possible issue:\n\nself._lastslope has not necessarily been set when it is used on line 602 resulting in bug in plot()\n\n```\nsage:NP=NewtonPolygon([(0,0),(1,0)],last_slope=2)\nsage:NP.plot()\n```\n\nthere are also some unimportant typos like:\n\n\n```\nline 85: explicitly mentioned\nline 90: greater than or equal to\nline 272: is infinite\nline 351: are the union of those\nline 614: image of this\n```\n\n\nI hope this is useful, I'm currently at the SAGE days in Leiden and using this as practice",
    "created_at": "2013-07-23T22:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185782",
    "user": "https://trac.sagemath.org/admin/accounts/users/jantuitman"
}
```

nice and useful code! 

after testing a bit myself I only found one possible issue:

self._lastslope has not necessarily been set when it is used on line 602 resulting in bug in plot()

```
sage:NP=NewtonPolygon([(0,0),(1,0)],last_slope=2)
sage:NP.plot()
```

there are also some unimportant typos like:


```
line 85: explicitly mentioned
line 90: greater than or equal to
line 272: is infinite
line 351: are the union of those
line 614: image of this
```


I hope this is useful, I'm currently at the SAGE days in Leiden and using this as practice



---

archive/issue_comments_185783.json:
```json
{
    "body": "minor corrections",
    "created_at": "2013-07-25T14:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185783",
    "user": "https://trac.sagemath.org/admin/accounts/users/jantuitman"
}
```

minor corrections



---

archive/issue_comments_185784.json:
```json
{
    "body": "Attachment [18484.patch](tarball://root/attachments/some-uuid/ticket14826/18484.patch) by @vbraun created at 2013-07-26 02:25:45\n\nTry the ``@`cached_method` decorator instead of caching manually.\n\nThe docstrings should start with a short (ideally one-line) description\n\n```\ndef vertices(self, copy=True): \n    \"\"\" \n    Return the vertices of the Newton polytope.\n\n    INPUT: \n    ...\n```\n\nAre you going to add a method to polynomaials or is that going to be in a future ticket?\n\nYou should run the testsuite for parents and elements somewhere in your code (see http://www.sagemath.org/doc/reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite)",
    "created_at": "2013-07-26T02:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185784",
    "user": "https://github.com/vbraun"
}
```

Attachment [18484.patch](tarball://root/attachments/some-uuid/ticket14826/18484.patch) by @vbraun created at 2013-07-26 02:25:45

Try the ``@`cached_method` decorator instead of caching manually.

The docstrings should start with a short (ideally one-line) description

```
def vertices(self, copy=True): 
    """ 
    Return the vertices of the Newton polytope.

    INPUT: 
    ...
```

Are you going to add a method to polynomaials or is that going to be in a future ticket?

You should run the testsuite for parents and elements somewhere in your code (see http://www.sagemath.org/doc/reference/misc/sage/misc/sage_unittest.html#sage.misc.sage_unittest.TestSuite)



---

archive/issue_comments_185785.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> Are you going to add a method to polynomaials or is that going to be in a future ticket?\n\n\nSee ticket #14828\n\n> You should run the testsuite for parents and elements somewhere in your code\n\n\nHmm. In order to make this testsuite work, it seems that I need to put ``ParentNewtonPolygon`` in a category and I don't know which one is appropriate. Do you have a suggestion?",
    "created_at": "2013-07-30T22:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185785",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:11 vbraun]:
> Are you going to add a method to polynomaials or is that going to be in a future ticket?


See ticket #14828

> You should run the testsuite for parents and elements somewhere in your code


Hmm. In order to make this testsuite work, it seems that I need to put ``ParentNewtonPolygon`` in a category and I don't know which one is appropriate. Do you have a suggestion?



---

archive/issue_comments_185786.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-07-30T22:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185786",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_185787.json:
```json
{
    "body": "Is `sage/categories/polyhedra.py` appropriate? If not, skip the categories test.",
    "created_at": "2013-07-30T23:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185787",
    "user": "https://github.com/vbraun"
}
```

Is `sage/categories/polyhedra.py` appropriate? If not, skip the categories test.



---

archive/issue_comments_185788.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> Is `sage/categories/polyhedra.py` appropriate?\n\n\nI tried this. But the test fails because the elements (which are instances of `NewtonPolygon_element`) are not instances of `PolyhedralSets` and I do not really want to derive from this class.\n\n> If not, skip the categories test.\n\n\nI can skip the category test, but it is also included in the elements tests. So, should I skip both?",
    "created_at": "2013-07-30T23:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185788",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:13 vbraun]:
> Is `sage/categories/polyhedra.py` appropriate?


I tried this. But the test fails because the elements (which are instances of `NewtonPolygon_element`) are not instances of `PolyhedralSets` and I do not really want to derive from this class.

> If not, skip the categories test.


I can skip the category test, but it is also included in the elements tests. So, should I skip both?



---

archive/issue_comments_185789.json:
```json
{
    "body": "Since you are deriving from RingElement your category should probably be `Rings`. Does that work?",
    "created_at": "2013-07-30T23:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185789",
    "user": "https://github.com/vbraun"
}
```

Since you are deriving from RingElement your category should probably be `Rings`. Does that work?



---

archive/issue_comments_185790.json:
```json
{
    "body": "Replying to [comment:15 vbraun]:\n> Since you are deriving from RingElement your category should probably be `Rings`. Does that work?\n\n\nIt should. Nevertheless, I just realized that the set of Newton polygons is not a ring but just a semiring (there is no additive inverse).\nThe category of semirings exists in sage (it seems that it is only used for the parent `NN`) but there is apparently no generic class for elements in semirings. So, I don't know what I am supposed to do:\n- should I implement a generic class for element in semirings (in `sage.structure.elements`)\n- can I derive my class from `RingElement` and raise an error in the `_neg_` function?\n- something else...",
    "created_at": "2013-07-31T07:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185790",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:15 vbraun]:
> Since you are deriving from RingElement your category should probably be `Rings`. Does that work?


It should. Nevertheless, I just realized that the set of Newton polygons is not a ring but just a semiring (there is no additive inverse).
The category of semirings exists in sage (it seems that it is only used for the parent `NN`) but there is apparently no generic class for elements in semirings. So, I don't know what I am supposed to do:
- should I implement a generic class for element in semirings (in `sage.structure.elements`)
- can I derive my class from `RingElement` and raise an error in the `_neg_` function?
- something else...



---

archive/issue_comments_185791.json:
```json
{
    "body": "There are two ways for your elements get an `__add__` method: Either they inherit it from `RingElement` or your category is (a refinement of) `AdditiveMagmas`. If you don't want to have a ring (no `__neg__` method) then you have to go the latter route. Just derive from `Element` and initialize your category to\n\n```\n        from sage.categories.all import Magmas, AdditiveMagmas\n        category = (Magmas(), AdditiveMagmas())\n        super(...).__init__(..., category=category)\n```\nThis is roughly how the polyhedra work, except they define a new category as the join.",
    "created_at": "2013-08-01T16:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185791",
    "user": "https://github.com/vbraun"
}
```

There are two ways for your elements get an `__add__` method: Either they inherit it from `RingElement` or your category is (a refinement of) `AdditiveMagmas`. If you don't want to have a ring (no `__neg__` method) then you have to go the latter route. Just derive from `Element` and initialize your category to

```
        from sage.categories.all import Magmas, AdditiveMagmas
        category = (Magmas(), AdditiveMagmas())
        super(...).__init__(..., category=category)
```
This is roughly how the polyhedra work, except they define a new category as the join.



---

archive/issue_comments_185792.json:
```json
{
    "body": "Thanks!\n\nI've tried to review my patch following your answer but I got a problem: it seems that the specials functions `+` and `*` are not catched correctly by the category framework (although it works for `__add__` and `__mul__`).\nAs far as I understand, the reason is that the method `Element.__getattr__` is not called in these cases (and, as a consequence, the methods in `category().element_class` are not examined).\n\nI don't know if it is supposed to be a bug; if it is, I can open a new ticket about it.\n\nIn the attached patch, I've implemented a dirty hack (cf. lines 195-198) to get around this problem and make additions and multiplications of Newton polygons work correctly.",
    "created_at": "2013-08-03T17:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185792",
    "user": "https://github.com/xcaruso"
}
```

Thanks!

I've tried to review my patch following your answer but I got a problem: it seems that the specials functions `+` and `*` are not catched correctly by the category framework (although it works for `__add__` and `__mul__`).
As far as I understand, the reason is that the method `Element.__getattr__` is not called in these cases (and, as a consequence, the methods in `category().element_class` are not examined).

I don't know if it is supposed to be a bug; if it is, I can open a new ticket about it.

In the attached patch, I've implemented a dirty hack (cf. lines 195-198) to get around this problem and make additions and multiplications of Newton polygons work correctly.



---

archive/issue_comments_185793.json:
```json
{
    "body": "Attachment [trac_14826_structure.patch](tarball://root/attachments/some-uuid/ticket14826/trac_14826_structure.patch) by @vbraun created at 2013-08-05 16:09:06\n\nInitial patch",
    "created_at": "2013-08-05T16:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185793",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_14826_structure.patch](tarball://root/attachments/some-uuid/ticket14826/trac_14826_structure.patch) by @vbraun created at 2013-08-05 16:09:06

Initial patch



---

archive/issue_comments_185794.json:
```json
{
    "body": "You must never use the bare element class (`NewtonPolygon_class` in your case). Always use `parent.element_class`\n\n```\nsage: from sage.combinat.newton_polygon import *\nsage: NewtonPolygon_element\n<class 'sage.combinat.newton_polygon.NewtonPolygon_element'>\nsage: ParentNewtonPolygon().element_class\n<class 'sage.combinat.newton_polygon.ParentNewtonPolygon_with_category.element_class'>\n```\nMy patch fixes that, and `_add_` is now called the way it is supposed to.\n\nVarious docstrings need to be formatted according to http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx\n\nAlso, you need to get to 100% coverage:\n\n```\n$ sage -coverage sage/combinat/newton_polygon.py \n------------------------------------------------------------------------\nSCORE sage/combinat/newton_polygon.py: 82.6% (19 of 23)\n\nMissing documentation:\n     * line 656: def _an_element_(self)\n\nMissing doctests:\n     * line 488: def plot(self, **kwargs)\n     * line 650: def _repr_(self)\n     * line 659: def _element_constructor_(self, arg, sort_slopes=True, last_slope=Infinity)\n------------------------------------------------------------------------\n```\n\nI would put the file in `sage/geometry` instead of `sage/combinat`.",
    "created_at": "2013-08-05T16:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185794",
    "user": "https://github.com/vbraun"
}
```

You must never use the bare element class (`NewtonPolygon_class` in your case). Always use `parent.element_class`

```
sage: from sage.combinat.newton_polygon import *
sage: NewtonPolygon_element
<class 'sage.combinat.newton_polygon.NewtonPolygon_element'>
sage: ParentNewtonPolygon().element_class
<class 'sage.combinat.newton_polygon.ParentNewtonPolygon_with_category.element_class'>
```
My patch fixes that, and `_add_` is now called the way it is supposed to.

Various docstrings need to be formatted according to http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx

Also, you need to get to 100% coverage:

```
$ sage -coverage sage/combinat/newton_polygon.py 
------------------------------------------------------------------------
SCORE sage/combinat/newton_polygon.py: 82.6% (19 of 23)

Missing documentation:
     * line 656: def _an_element_(self)

Missing doctests:
     * line 488: def plot(self, **kwargs)
     * line 650: def _repr_(self)
     * line 659: def _element_constructor_(self, arg, sort_slopes=True, last_slope=Infinity)
------------------------------------------------------------------------
```

I would put the file in `sage/geometry` instead of `sage/combinat`.



---

archive/issue_comments_185795.json:
```json
{
    "body": "Thanks a lot for your message (and your patience).\n\nI fold the two patches (yours and mine), moved the file in `sage/geometry` and completed doctests.",
    "created_at": "2013-08-06T09:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185795",
    "user": "https://github.com/xcaruso"
}
```

Thanks a lot for your message (and your patience).

I fold the two patches (yours and mine), moved the file in `sage/geometry` and completed doctests.



---

archive/issue_comments_185796.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-08-06T09:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185796",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_185797.json:
```json
{
    "body": "Can you double-check the docstrings? I see a couple that aren't typeset correctly. E.g.\n\n```        \n- polyhedron -- a polyhedron defining the Newton polygon        # no\n- ``polyhedron`` -- a polyhedron defining the Newton polygon    # yes\n\n- repetition -- a boolean (default: True)           # no\n- ``repetition`` -- a boolean (default: ``True``)   # yes\n\n\nReturns ``self`` dilated by `exp`    # no\nReturns ``self`` dilated by ``exp``  # yes  \n```\n\nYou can implement the comparison operators much easier via\n\n```\ndef __cmp__(self, other):\n    c = cmp(type(self), type(other))\n    if c != 0:\n        return c\n    return cmp(self._polyhedron, other._polyhedron)\n```\nthough doing it the hard way is also acceptable.",
    "created_at": "2013-08-07T21:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185797",
    "user": "https://github.com/vbraun"
}
```

Can you double-check the docstrings? I see a couple that aren't typeset correctly. E.g.

```        
- polyhedron -- a polyhedron defining the Newton polygon        # no
- ``polyhedron`` -- a polyhedron defining the Newton polygon    # yes

- repetition -- a boolean (default: True)           # no
- ``repetition`` -- a boolean (default: ``True``)   # yes


Returns ``self`` dilated by `exp`    # no
Returns ``self`` dilated by ``exp``  # yes  
```

You can implement the comparison operators much easier via

```
def __cmp__(self, other):
    c = cmp(type(self), type(other))
    if c != 0:
        return c
    return cmp(self._polyhedron, other._polyhedron)
```
though doing it the hard way is also acceptable.



---

archive/issue_comments_185798.json:
```json
{
    "body": "I've posted a revised patch.\n\nConcerning comparison, I'm not sure I can use the `__cmp__` construction because the natural order on Newton polygons is not total (and I've read that - I don't remember where presently - that `__cmp__` is only used to implement total order). Am I wrong?\n\n---\n\nFor the bot:\napply [attachment:trac_14826_newton_polygons.patch]",
    "created_at": "2013-08-13T08:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185798",
    "user": "https://github.com/xcaruso"
}
```

I've posted a revised patch.

Concerning comparison, I'm not sure I can use the `__cmp__` construction because the natural order on Newton polygons is not total (and I've read that - I don't remember where presently - that `__cmp__` is only used to implement total order). Am I wrong?

---

For the bot:
apply [attachment:trac_14826_newton_polygons.patch]



---

archive/issue_comments_185799.json:
```json
{
    "body": "Attachment [trac_14826_newton_polygons.patch](tarball://root/attachments/some-uuid/ticket14826/trac_14826_newton_polygons.patch) by @xcaruso created at 2013-08-13 08:58:17",
    "created_at": "2013-08-13T08:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185799",
    "user": "https://github.com/xcaruso"
}
```

Attachment [trac_14826_newton_polygons.patch](tarball://root/attachments/some-uuid/ticket14826/trac_14826_newton_polygons.patch) by @xcaruso created at 2013-08-13 08:58:17



---

archive/issue_comments_185800.json:
```json
{
    "body": "Comparison deviates slightly in Sage vs. Python, especially for equality testing. If you don't have a total order then `sort()` will have undefined behavior. But apart from that there is nothing wrong with it. The `Element` base class already implements `__cmp__`, so you can only override it but not get rid of it.\n\nDid you upload the right patch? I get doctest failures in `_test_prod`",
    "created_at": "2013-08-13T11:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185800",
    "user": "https://github.com/vbraun"
}
```

Comparison deviates slightly in Sage vs. Python, especially for equality testing. If you don't have a total order then `sort()` will have undefined behavior. But apart from that there is nothing wrong with it. The `Element` base class already implements `__cmp__`, so you can only override it but not get rid of it.

Did you upload the right patch? I get doctest failures in `_test_prod`



---

archive/issue_comments_185801.json:
```json
{
    "body": "Replying to [comment:25 vbraun]:\n> Did you upload the right patch? I get doctest failures in `_test_prod`\n\n\nThe current patch works well on my computer. Did you apply #14987 (see Dependencies)?",
    "created_at": "2013-08-14T08:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185801",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:25 vbraun]:
> Did you upload the right patch? I get doctest failures in `_test_prod`


The current patch works well on my computer. Did you apply #14987 (see Dependencies)?



---

archive/issue_comments_185802.json:
```json
{
    "body": "Thanks, forgot about that. Patch looks good to me.",
    "created_at": "2013-08-14T13:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185802",
    "user": "https://github.com/vbraun"
}
```

Thanks, forgot about that. Patch looks good to me.



---

archive/issue_comments_185803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-14T13:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185803",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_185804.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T12:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14826#issuecomment-185804",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_042567.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:59:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14826",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14826#event-42567"
}
```
