# Issue 14485: Get rid of the bogus coercion from SR to QQbar

archive/issues_014281.json:
```json
{
    "assignees": [
        "https://github.com/malb"
    ],
    "body": "Original issue: there is no problem buildind a polynomial over AA:\n\n```\nsage: R = AA[x]                       \nsage: P = R(x^6+x^5+x^4-x^3+x^2-x+2/5)\n```\n\nBut the same operation does not work on QQbar:\n\n```\nsage: S = QQbar[x]\nsage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)\nTraceback (most recent call last)\n...\nNotImplementedError: symbol\n```\n\nHovewer, this workaround works:\n\n```\nsage: Q = P.change_ring(QQbar)\n```\n\n\nMoreover the following works : \n\n```\nsage: S.<x> = PolynomialRing(QQbar,'x')\nsage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)\nsage: S == QQbar[x]\nTrue\n```\n\nWeird isn't it ?\n\n\nCC:  @burcin\n\nKeywords: **QQbar, polynomial**\n\nBranch: **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Marc Mezzarobba**\n\nComponent: **commutative algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14485_\n\n",
    "closed_at": "2016-04-08T22:40:26Z",
    "created_at": "2013-04-24T21:59:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Get rid of the bogus coercion from SR to QQbar",
    "type": "issue",
    "updated_at": "2016-04-09T06:05:35Z",
    "url": "https://github.com/sagemath/sage/issues/14485",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
Original issue: there is no problem buildind a polynomial over AA:

```
sage: R = AA[x]                       
sage: P = R(x^6+x^5+x^4-x^3+x^2-x+2/5)
```

But the same operation does not work on QQbar:

```
sage: S = QQbar[x]
sage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)
Traceback (most recent call last)
...
NotImplementedError: symbol
```

Hovewer, this workaround works:

```
sage: Q = P.change_ring(QQbar)
```


Moreover the following works : 

```
sage: S.<x> = PolynomialRing(QQbar,'x')
sage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)
sage: S == QQbar[x]
True
```

Weird isn't it ?


CC:  @burcin

Keywords: **QQbar, polynomial**

Branch: **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**

Reviewer: **Vincent Delecroix**

Author: **Marc Mezzarobba**

Component: **commutative algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/14485_





---

archive/issue_events_204900.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2013-04-24T21:59:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204900"
}
```



---

archive/issue_events_204901.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2013-04-24T21:59:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204901"
}
```



---

archive/issue_events_204902.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2013-04-24T21:59:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204902"
}
```



---

archive/issue_events_204903.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2013-04-24T21:59:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204903"
}
```



---

archive/issue_events_204904.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-04-24T21:59:52Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "subject": "https://github.com/sagetrac-tmonteil",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204904"
}
```



---

archive/issue_comments_175058.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,4 +21,15 @@\n sage: Q = P.change_ring(QQbar)\n ```\n \n+\n+Moreover the following works : \n+\n+```\n+sage: S.<x> = PolynomialRing(QQbar,'x')\n+sage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)\n+sage: S == QQbar[x]\n+True\n+```\n+\n Weird isn't it ?\n+\n``````\n",
    "created_at": "2013-04-24T22:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175058",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,4 +21,15 @@
 sage: Q = P.change_ring(QQbar)
 ```
 
+
+Moreover the following works : 
+
+```
+sage: S.<x> = PolynomialRing(QQbar,'x')
+sage: Q = S(x^6+x^5+x^4-x^3+x^2-x+2/5)
+sage: S == QQbar[x]
+True
+```
+
 Weird isn't it ?
+
``````




---

archive/issue_comments_175059.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe weirdness is really just limited to the difference in behaviour between these:\n\n```\nsage: AA['x'](var('x'))\nx\nsage: QQbar['x'](var('x'))\nNotImplementedError: symbol\n```\nThe thing that's failing in the latter case is\n\n```\nQQbar._element_constructor_(x)\n```\nand\n\n```\nAA._element_constructor_(x)\n```\nfails in exactly the same way. That suggest that in the case of `AA['x']` something is tried before resorting to the thing that fails for `QQbar['x']`.\n\nFor instance,\n\n```\nAA['y'](var('x'))\nQQbar['y'](var('x'))\n```\nboth (rightly) fail,but with significantly different tracebacks. This might give some indication of what is tried for `AA` but not for `QQbar`.",
    "created_at": "2013-04-24T22:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175059",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:2" align="right">comment:2</div>

The weirdness is really just limited to the difference in behaviour between these:

```
sage: AA['x'](var('x'))
x
sage: QQbar['x'](var('x'))
NotImplementedError: symbol
```
The thing that's failing in the latter case is

```
QQbar._element_constructor_(x)
```
and

```
AA._element_constructor_(x)
```
fails in exactly the same way. That suggest that in the case of `AA['x']` something is tried before resorting to the thing that fails for `QQbar['x']`.

For instance,

```
AA['y'](var('x'))
QQbar['y'](var('x'))
```
both (rightly) fail,but with significantly different tracebacks. This might give some indication of what is tried for `AA` but not for `QQbar`.



---

archive/issue_comments_175060.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe thing that goes wrong is the following:\n\n```\nsage: S=QQbar['x']\nsage: S.base_ring().has_coerce_map_from(SR)\nTrue\n```\nOnce this is found, it's clear how an element of `SR` should be converted into `QQbar['x']`: `SR` already coerces into `QQbar` itself, so we should just convert the element into a \"constant polynomial\".\n\nExcept, of course, that `SR` doesn't really coerce into `QQbar`: Only \"constant\" expressions might (and even then, of course `pi` doesn't), and `x` of course isn't one of those. So the proper solution is probably to NOT install a coercion from SR to QQbar, because it isn't a coercion anyway. It's only a partial map. Doing so is probably going to be painful for something else.\n\nThis problem doesn't arise for `AA` because it's pretty clear that not even algebraic elements fit in `AA`, so no coercion is installed.",
    "created_at": "2013-04-24T23:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175060",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:3" align="right">comment:3</div>

The thing that goes wrong is the following:

```
sage: S=QQbar['x']
sage: S.base_ring().has_coerce_map_from(SR)
True
```
Once this is found, it's clear how an element of `SR` should be converted into `QQbar['x']`: `SR` already coerces into `QQbar` itself, so we should just convert the element into a "constant polynomial".

Except, of course, that `SR` doesn't really coerce into `QQbar`: Only "constant" expressions might (and even then, of course `pi` doesn't), and `x` of course isn't one of those. So the proper solution is probably to NOT install a coercion from SR to QQbar, because it isn't a coercion anyway. It's only a partial map. Doing so is probably going to be painful for something else.

This problem doesn't arise for `AA` because it's pretty clear that not even algebraic elements fit in `AA`, so no coercion is installed.



---

archive/issue_comments_175061.json:
```json
{
    "body": "Attachment: **[trac_14485.patch.gz](https://github.com/sagemath/sage/files/ticket14485/trac_14485.patch.gz)**\n\nDon't pretend there is a coercion from the symbolic ring into QQbar",
    "created_at": "2013-04-24T23:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175061",
    "user": "https://github.com/nbruin"
}
```

Attachment: **[trac_14485.patch.gz](https://github.com/sagemath/sage/files/ticket14485/trac_14485.patch.gz)**

Don't pretend there is a coercion from the symbolic ring into QQbar



---

archive/issue_events_204905.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-04-24T23:37:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204905"
}
```



---

archive/issue_events_204906.json:
```json
{
    "actor": "https://github.com/nbruin",
    "created_at": "2013-04-24T23:37:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204906"
}
```



---

archive/issue_comments_175062.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOK, solving a ticket by deleting two lines is just too appealing to pass by. Of course, there is are all kinds of things that fail this way, e.g.\n\n```\nQQbar(1)+sqrt(2)\n```\ndoesn't work anymore, but `QQbar(1)+QQbar(sqrt(2))` of course still does.",
    "created_at": "2013-04-24T23:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175062",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

OK, solving a ticket by deleting two lines is just too appealing to pass by. Of course, there is are all kinds of things that fail this way, e.g.

```
QQbar(1)+sqrt(2)
```
doesn't work anymore, but `QQbar(1)+QQbar(sqrt(2))` of course still does.



---

archive/issue_events_204907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204907"
}
```



---

archive/issue_events_204908.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204908"
}
```



---

archive/issue_comments_175063.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI was going to report another problem caused by the bogus coercion from `SR`:\n\n```\nsage: CC.has_coerce_map_from(QQbar)\nTrue\nsage: QQbar.has_coerce_map_from(SR)\nTrue\nsage: CC.has_coerce_map_from(SR)\nFalse\n```\nSo I'm all in favor of removing it, even if it breaks stuff that should never have worked in the first place.\n\nWe might want to put (or actually put back?) a coercion in the other direction, since symbolic expressions can embed elements of `QQbar`. But `SR` has coerce maps from `RR`, `CC`, `RLF`, etc., which yield other coercions from `QQbar` by composition. Can we consider that all these maps are the same because they only differ in the \"precision\" of the result? Or should all coercions from inexact rings to `QQbar` be removed? (Note that the coercion from `QQ` to `SR` has exactly the same problem.)",
    "created_at": "2013-12-28T14:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175063",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:6" align="right">comment:6</div>

I was going to report another problem caused by the bogus coercion from `SR`:

```
sage: CC.has_coerce_map_from(QQbar)
True
sage: QQbar.has_coerce_map_from(SR)
True
sage: CC.has_coerce_map_from(SR)
False
```
So I'm all in favor of removing it, even if it breaks stuff that should never have worked in the first place.

We might want to put (or actually put back?) a coercion in the other direction, since symbolic expressions can embed elements of `QQbar`. But `SR` has coerce maps from `RR`, `CC`, `RLF`, etc., which yield other coercions from `QQbar` by composition. Can we consider that all these maps are the same because they only differ in the "precision" of the result? Or should all coercions from inexact rings to `QQbar` be removed? (Note that the coercion from `QQ` to `SR` has exactly the same problem.)



---

archive/issue_events_204909.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204909"
}
```



---

archive/issue_events_204910.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204910"
}
```



---

archive/issue_events_204911.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204911"
}
```



---

archive/issue_events_204912.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204912"
}
```



---

archive/issue_events_204913.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204913"
}
```



---

archive/issue_events_204914.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204914"
}
```



---

archive/issue_events_204915.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-03-25T12:13:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204915"
}
```



---

archive/issue_comments_175064.json:
```json
{
    "body": "Branch: **[u/mmezzarobba/14485-QQbartoSR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/14485-QQbartoSR)**",
    "created_at": "2016-03-25T12:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175064",
    "user": "https://github.com/mezzarobba"
}
```

Branch: **[u/mmezzarobba/14485-QQbartoSR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/14485-QQbartoSR)**



---

archive/issue_comments_175065.json:
```json
{
    "body": "Author: **Marc Mezzarobba**",
    "created_at": "2016-03-25T12:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175065",
    "user": "https://github.com/mezzarobba"
}
```

Author: **Marc Mezzarobba**



---

archive/issue_comments_175066.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAs it turns out, it is possible to remove the coercion from `SR` to `QQbar` without breaking too many things. Moreover, most of the workarounds I had to add are there to deal with the case of `I` and will no longer be necessary once #5355 (or #12715) and/or #18036 are fixed (but I suggest we *dont't* wait fix this to happen).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f85af166614455f24e255332995c7db003501db\"><code>8f85af1</code></a></td><td><code>Remove the bogus coercion from SR to QQbar</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc\"><code>8b0a847</code></a></td><td><code>#14485 regression test</code></td></tr></table>\n",
    "created_at": "2016-03-25T12:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175066",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:10" align="right">comment:10</div>

As it turns out, it is possible to remove the coercion from `SR` to `QQbar` without breaking too many things. Moreover, most of the workarounds I had to add are there to deal with the case of `I` and will no longer be necessary once #5355 (or #12715) and/or #18036 are fixed (but I suggest we *dont't* wait fix this to happen).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f85af166614455f24e255332995c7db003501db"><code>8f85af1</code></a></td><td><code>Remove the bogus coercion from SR to QQbar</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc"><code>8b0a847</code></a></td><td><code>#14485 regression test</code></td></tr></table>




---

archive/issue_comments_175067.json:
```json
{
    "body": "Commit: **[`8b0a847`](https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc)**",
    "created_at": "2016-03-25T12:13:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175067",
    "user": "https://github.com/mezzarobba"
}
```

Commit: **[`8b0a847`](https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc)**



---

archive/issue_comments_175068.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49\"><code>9f5b44b</code></a></td><td><code>#14485 a few additional tests</code></td></tr></table>\n",
    "created_at": "2016-03-25T12:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175068",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49"><code>9f5b44b</code></a></td><td><code>#14485 a few additional tests</code></td></tr></table>




---

archive/issue_comments_175069.json:
```json
{
    "body": "Changed commit from **[`8b0a847`](https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc)** to **[`9f5b44b`](https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49)**",
    "created_at": "2016-03-25T12:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175069",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8b0a847`](https://github.com/sagemath/sagetrac-mirror/commit/8b0a847cbf2aa656e6a2fd8c4e0a383df2ae68bc)** to **[`9f5b44b`](https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49)**



---

archive/issue_events_204916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-25T12:37:47Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "title_is": "Converting a symbolic polynomial to a polynomial over QQbar",
    "title_was": "Creation of a polynomial over QQbar",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204916"
}
```



---

archive/issue_events_204917.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-03-25T16:01:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "title_is": "Get rid of the bogus coercion from SR to QQbar",
    "title_was": "Converting a symbolic polynomial to a polynomial over QQbar",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204917"
}
```



---

archive/issue_comments_175070.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Here is the issue: there is no problem buildind a polynomial over AA:\n+Original issue: there is no problem buildind a polynomial over AA:\n \n ```\n sage: R = AA[x]                       \n``````\n",
    "created_at": "2016-03-25T16:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175070",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Here is the issue: there is no problem buildind a polynomial over AA:
+Original issue: there is no problem buildind a polynomial over AA:
 
 ```
 sage: R = AA[x]                       
``````




---

archive/issue_comments_175071.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nPatchbot: `sage -t --long src/sage/graphs/matchpoly.pyx  # 1 doctest failed`",
    "created_at": "2016-03-26T09:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175071",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">comment:14</div>

Patchbot: `sage -t --long src/sage/graphs/matchpoly.pyx  # 1 doctest failed`



---

archive/issue_comments_175072.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThanks for the notice. It works here, as well as with the other patchbots. I have no idea at all what is going on.\n\nJeroen, that `sage4` is one of your patchbots, isn't it? Would you mind having a quick look at the failing test?",
    "created_at": "2016-03-26T11:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175072",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:15" align="right">comment:15</div>

Thanks for the notice. It works here, as well as with the other patchbots. I have no idea at all what is going on.

Jeroen, that `sage4` is one of your patchbots, isn't it? Would you mind having a quick look at the failing test?



---

archive/issue_comments_175073.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nYou should get rid of the function `_late_import` since it is not used anymore. And it would be better to simplify the code of `_coerce_map_from_` as\n\n```\nreturn from_par == ZZ or from_par == QQ or from_par == int or \\\n       from_par == long or from_par == AA or from_par == QQbar\n```\nMoreover, I am not sure if coercion from `int/long` is necessary here since a conversion would exists through `ZZ`.",
    "created_at": "2016-04-05T17:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175073",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

You should get rid of the function `_late_import` since it is not used anymore. And it would be better to simplify the code of `_coerce_map_from_` as

```
return from_par == ZZ or from_par == QQ or from_par == int or \
       from_par == long or from_par == AA or from_par == QQbar
```
Moreover, I am not sure if coercion from `int/long` is necessary here since a conversion would exists through `ZZ`.



---

archive/issue_events_204918.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T17:24:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204918"
}
```



---

archive/issue_events_204919.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T17:24:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204919"
}
```



---

archive/issue_comments_175074.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@videlec](#comment:16):\n> You should get rid of the function `_late_import` since it is not used anymore.\n\nIndeed, I didn't notice, thanks!\n\n> And it would be better to simplify the code of `_coerce_map_from_` as\n> \n> ```\n> return from_par == ZZ or from_par == QQ or from_par == int or \\\n>        from_par == long or from_par == AA or from_par == QQbar\n> ```\n\nThe original style made sense to me so I refrained from making unnecessary changes, but if you prefer this version, fine. I also replaced the `==` with `is`.\n\n> Moreover, I am not sure if coercion from `int/long` is necessary here since a conversion would exists through `ZZ`.\n\n`AlgebraicNumber_base.__init__` also has a code path for `int` and `long` initializers, but they end up being converted to `ZZ`, so I guess it won't hurt to remove these cases. Done.",
    "created_at": "2016-04-06T06:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175074",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@videlec](#comment:16):
> You should get rid of the function `_late_import` since it is not used anymore.

Indeed, I didn't notice, thanks!

> And it would be better to simplify the code of `_coerce_map_from_` as
> 
> ```
> return from_par == ZZ or from_par == QQ or from_par == int or \
>        from_par == long or from_par == AA or from_par == QQbar
> ```

The original style made sense to me so I refrained from making unnecessary changes, but if you prefer this version, fine. I also replaced the `==` with `is`.

> Moreover, I am not sure if coercion from `int/long` is necessary here since a conversion would exists through `ZZ`.

`AlgebraicNumber_base.__init__` also has a code path for `int` and `long` initializers, but they end up being converted to `ZZ`, so I guess it won't hurt to remove these cases. Done.



---

archive/issue_comments_175075.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde\"><code>4ba7202</code></a></td><td><code>#14485 simplify code according to reviewer's comments</code></td></tr></table>\n",
    "created_at": "2016-04-06T07:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175075",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde"><code>4ba7202</code></a></td><td><code>#14485 simplify code according to reviewer's comments</code></td></tr></table>




---

archive/issue_comments_175076.json:
```json
{
    "body": "Changed commit from **[`9f5b44b`](https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49)** to **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**",
    "created_at": "2016-04-06T07:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175076",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9f5b44b`](https://github.com/sagemath/sagetrac-mirror/commit/9f5b44b3b5e431a92c77af7c52f4984c5c199a49)** to **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**



---

archive/issue_events_204920.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-04-06T08:40:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204920"
}
```



---

archive/issue_events_204921.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-04-06T08:40:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204921"
}
```



---

archive/issue_comments_175077.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWhile working on something else I saw the following comment in `symbolic/functions.pyx` line 473\n\n```\n# There is no natural coercion from QQbar to the symbolic ring\n# in order to support\n#     sage: QQbar(sqrt(2)) + sqrt(3)\n#     3.146264369941973?\n# to work around this limitation, we manually convert\n# elements of QQbar to symbolic expressions here     \n```",
    "created_at": "2016-04-06T13:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175077",
    "user": "https://github.com/videlec"
}
```

<div id="comment:20" align="right">comment:20</div>

While working on something else I saw the following comment in `symbolic/functions.pyx` line 473

```
# There is no natural coercion from QQbar to the symbolic ring
# in order to support
#     sage: QQbar(sqrt(2)) + sqrt(3)
#     3.146264369941973?
# to work around this limitation, we manually convert
# elements of QQbar to symbolic expressions here     
```



---

archive/issue_comments_175078.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@videlec](#comment:20):\n> While working on something else I saw the following comment in `symbolic/functions.pyx` line 473\n> \n> ```\n> # There is no natural coercion from QQbar to the symbolic ring\n> # in order to support\n> #     sage: QQbar(sqrt(2)) + sqrt(3)\n> #     3.146264369941973?\n> # to work around this limitation, we manually convert\n> # elements of QQbar to symbolic expressions here     \n> ```\n\nThe patches on this ticket remove this comment and the corresponding code. I think people now agree that even if it was more or less intentional, trying to support this was a bad idea.",
    "created_at": "2016-04-06T14:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175078",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@videlec](#comment:20):
> While working on something else I saw the following comment in `symbolic/functions.pyx` line 473
> 
> ```
> # There is no natural coercion from QQbar to the symbolic ring
> # in order to support
> #     sage: QQbar(sqrt(2)) + sqrt(3)
> #     3.146264369941973?
> # to work around this limitation, we manually convert
> # elements of QQbar to symbolic expressions here     
> ```

The patches on this ticket remove this comment and the corresponding code. I think people now agree that even if it was more or less intentional, trying to support this was a bad idea.



---

archive/issue_events_204922.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-06T17:08:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204922"
}
```



---

archive/issue_events_204923.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-06T17:08:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204923"
}
```



---

archive/issue_events_204924.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-06T17:08:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204924"
}
```



---

archive/issue_events_204925.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-06T17:08:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204925"
}
```



---

archive/issue_comments_175079.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2016-04-06T17:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175079",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_175080.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nlet it be!",
    "created_at": "2016-04-06T17:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175080",
    "user": "https://github.com/videlec"
}
```

<div id="comment:22" align="right">comment:22</div>

let it be!



---

archive/issue_events_204926.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-08T22:40:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204926"
}
```



---

archive/issue_events_204927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e157b245c645bf69aa952f1d9300abcb3189c6dc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-04-08T22:40:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14485#event-204927"
}
```



---

archive/issue_comments_175081.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/14485-QQbartoSR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/14485-QQbartoSR)** to **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**",
    "created_at": "2016-04-08T22:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175081",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmezzarobba/14485-QQbartoSR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/14485-QQbartoSR)** to **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)**



---

archive/issue_comments_175082.json:
```json
{
    "body": "Changed commit from **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)** to none",
    "created_at": "2016-04-09T06:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175082",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`4ba7202`](https://github.com/sagemath/sagetrac-mirror/commit/4ba720258752fc035549147219161e6568e80cde)** to none



---

archive/issue_comments_175083.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mezzarobba](#comment:21):\n> Replying to [@videlec](#comment:20):\n> > While working on something else I saw the following comment in `symbolic/functions.pyx` line 473\n> > \n> > ```\n> > # There is no natural coercion from QQbar to the symbolic ring\n> > # in order to support\n> > #     sage: QQbar(sqrt(2)) + sqrt(3)\n> > #     3.146264369941973?\n> > # to work around this limitation, we manually convert\n> > # elements of QQbar to symbolic expressions here     \n> > ```\n\n> \n> The patches on this ticket remove this comment and the corresponding code. I think people now agree that even if it was more or less intentional, trying to support this was a bad idea.\n\nSee also #17790, #18832, #20312",
    "created_at": "2016-04-09T06:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14485",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14485#issuecomment-175083",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mezzarobba](#comment:21):
> Replying to [@videlec](#comment:20):
> > While working on something else I saw the following comment in `symbolic/functions.pyx` line 473
> > 
> > ```
> > # There is no natural coercion from QQbar to the symbolic ring
> > # in order to support
> > #     sage: QQbar(sqrt(2)) + sqrt(3)
> > #     3.146264369941973?
> > # to work around this limitation, we manually convert
> > # elements of QQbar to symbolic expressions here     
> > ```

> 
> The patches on this ticket remove this comment and the corresponding code. I think people now agree that even if it was more or less intentional, trying to support this was a bad idea.

See also #17790, #18832, #20312
