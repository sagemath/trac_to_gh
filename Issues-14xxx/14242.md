# Issue 14242: missing Sage interface for SymPy's RisingFactorial

archive/issues_014242.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  @kcrisman\n\nMinimal test case:\n\n```\nsage: import sympy\nsage: SR(sympy.RisingFactorial(x,x))\nAttributeError: 'RisingFactorial' object has no attribute '_sage_'\nsage: SR(sympy.FallingFactorial(x,x))\nAttributeError: 'FallingFactorial' object has no attribute '_sage_'\n```\nOriginal ticket description:\n\nThis is related to #14437:\n\n```\nsage: from sympy import Function, Symbol\nsage: u = Function('u')\nsage: n = Symbol('n', integer=True)\nsage: from sympy import rsolve\nsage: f = u(n+2) - u(n+1) + u(n)/4\nsage: rsolve(f,u(n))\n2**(-n)*C0*RisingFactorial(C0/C1 + 1, n)/RisingFactorial(C0/C1, n)\n```\nThe result returned by `rsolve` is a SymPy object:\n\n```\nsage: s = rsolve(f,u(n))\nsage: type(s)\n<class 'sympy.core.mul.Mul'>\n```\nIdeally, it should be automatically converted to Sage.\n\nHowever, if we try to convert it manually, we get:\n\n```\nsage: s._sage_()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/users/caramel/zimmerma/svn/sagebook/tex/<ipython console> in <module>()\n\n/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2.7/site-packages/sympy/core/mul.py in _sage_(self)\n   1192         s = 1\n   1193         for x in self.args:\n-> 1194             s *= x._sage_()\n   1195         return s\n   1196 \n\n/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2.7/site-packages/sympy/core/power.py in _sage_(self)\n    846 \n    847     def _sage_(self):\n--> 848         return self.args[0]._sage_()**self.args[1]._sage_()\n    849 \n    850 from add import Add\n\nAttributeError: 'RisingFactorial' object has no attribute '_sage_'\n```\nPaul\n\nIssue created by migration from https://trac.sagemath.org/ticket/14446\n\n",
    "closed_at": "2017-12-12T08:23:33Z",
    "created_at": "2013-04-11T19:48:08Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "missing Sage interface for SymPy's RisingFactorial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14242",
    "user": "https://github.com/zimmermann6"
}
```
Assignee: @williamstein

CC:  @kcrisman

Minimal test case:

```
sage: import sympy
sage: SR(sympy.RisingFactorial(x,x))
AttributeError: 'RisingFactorial' object has no attribute '_sage_'
sage: SR(sympy.FallingFactorial(x,x))
AttributeError: 'FallingFactorial' object has no attribute '_sage_'
```
Original ticket description:

This is related to #14437:

```
sage: from sympy import Function, Symbol
sage: u = Function('u')
sage: n = Symbol('n', integer=True)
sage: from sympy import rsolve
sage: f = u(n+2) - u(n+1) + u(n)/4
sage: rsolve(f,u(n))
2**(-n)*C0*RisingFactorial(C0/C1 + 1, n)/RisingFactorial(C0/C1, n)
```
The result returned by `rsolve` is a SymPy object:

```
sage: s = rsolve(f,u(n))
sage: type(s)
<class 'sympy.core.mul.Mul'>
```
Ideally, it should be automatically converted to Sage.

However, if we try to convert it manually, we get:

```
sage: s._sage_()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/users/caramel/zimmerma/svn/sagebook/tex/<ipython console> in <module>()

/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2.7/site-packages/sympy/core/mul.py in _sage_(self)
   1192         s = 1
   1193         for x in self.args:
-> 1194             s *= x._sage_()
   1195         return s
   1196 

/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python2.7/site-packages/sympy/core/power.py in _sage_(self)
    846 
    847     def _sage_(self):
--> 848         return self.args[0]._sage_()**self.args[1]._sage_()
    849 
    850 from add import Add

AttributeError: 'RisingFactorial' object has no attribute '_sage_'
```
Paul

Issue created by migration from https://trac.sagemath.org/ticket/14446





---

archive/issue_events_041075.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41075"
}
```



---

archive/issue_events_041076.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41076"
}
```



---

archive/issue_events_041077.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41077"
}
```



---

archive/issue_events_041078.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41078"
}
```



---

archive/issue_events_041079.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41079"
}
```



---

archive/issue_comments_178950.json:
```json
{
    "body": "Just as a point of information, nowadays\n\n```\nsage: rsolve(f,u(n))\n2**(-n)*(C0 + C1*n)\n```\nso apparently there was some extra simplification that should have happened.  Doesn't mean this ticket is invalid, of course.",
    "created_at": "2014-06-17T12:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178950",
    "user": "https://github.com/kcrisman"
}
```

Just as a point of information, nowadays

```
sage: rsolve(f,u(n))
2**(-n)*(C0 + C1*n)
```
so apparently there was some extra simplification that should have happened.  Doesn't mean this ticket is invalid, of course.



---

archive/issue_events_041080.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41080"
}
```



---

archive/issue_events_041081.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41081"
}
```



---

archive/issue_comments_178951.json:
```json
{
    "body": "Changing assignee from @burcin to @williamstein.",
    "created_at": "2014-12-13T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178951",
    "user": "https://github.com/rwst"
}
```

Changing assignee from @burcin to @williamstein.



---

archive/issue_comments_178952.json:
```json
{
    "body": "Changing component from calculus to interfaces.",
    "created_at": "2014-12-13T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178952",
    "user": "https://github.com/rwst"
}
```

Changing component from calculus to interfaces.



---

archive/issue_comments_178953.json:
```json
{
    "body": "This is now fixed in the proposed sympy pull request https://github.com/sympy/sympy/pull/8592\nbut we will upload a branch with the specific sympy patch next.",
    "created_at": "2014-12-14T15:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178953",
    "user": "https://github.com/rwst"
}
```

This is now fixed in the proposed sympy pull request https://github.com/sympy/sympy/pull/8592
but we will upload a branch with the specific sympy patch next.



---

archive/issue_events_041082.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-03T06:17:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41082"
}
```



---

archive/issue_events_041083.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-10-03T06:17:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41083"
}
```



---

archive/issue_comments_178954.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-03T06:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178954",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178955.json:
```json
{
    "body": "This was resolved long ago by the latest SymPy update.",
    "created_at": "2017-10-03T06:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178955",
    "user": "https://github.com/rwst"
}
```

This was resolved long ago by the latest SymPy update.



---

archive/issue_comments_178956.json:
```json
{
    "body": "fixed indeed in Sage 8.0 (or before).",
    "created_at": "2017-10-03T07:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178956",
    "user": "https://github.com/zimmermann6"
}
```

fixed indeed in Sage 8.0 (or before).



---

archive/issue_comments_178957.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-03T07:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178957",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178958.json:
```json
{
    "body": "I've noticed a few recent closed tickets which were apparently resolved -- but no one mentioned doctesting these resolutions.  We should do that to avoid regressions.  (Unless they are already tested, of course.)",
    "created_at": "2017-10-03T10:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178958",
    "user": "https://github.com/kcrisman"
}
```

I've noticed a few recent closed tickets which were apparently resolved -- but no one mentioned doctesting these resolutions.  We should do that to avoid regressions.  (Unless they are already tested, of course.)



---

archive/issue_comments_178959.json:
```json
{
    "body": "I tried adding a doctest with those commands:\n\n```\n$ git clone git://git.sagemath.org/sage.git\n$ cd sage\n$ git branch u/zimmerma/14446\n$ git co u/zimmerma/14446\n$ patch -p1 -i /tmp/patch\n$ git commit -a\n$ git push --set-upstream origin u/zimmerma/14446\n```\nbut it failed with:\n\n```\n$ git push --set-upstream origin u/zimmerma/14446\nfatal: remote error: access denied or repository not exported: /sage.git\n```\nAm I doing something wrong?\n\nFor the record:\n\n```\n$ cat /tmp/patch\ncommit ef0235ff466d40c787681e3e483342e091247392\nAuthor: Paul Zimmermann <Paul.Zimmermann@inria.fr>\nDate:   Tue Oct 3 13:03:18 2017 +0200\n\n    added doctest for #14446\n\ndiff --git a/src/sage/calculus/test_sympy.py b/src/sage/calculus/test_sympy.py\nindex 996e417..15b1d7e 100644\n--- a/src/sage/calculus/test_sympy.py\n+++ b/src/sage/calculus/test_sympy.py\n@@ -196,4 +196,15 @@ This was fixed in Sympy, see :trac:`14437`::\n     sage: rsolve(f,u(n))\n     2**(-n)*(C0 + C1*n)\n \n+This was fixed in Sympy, see :trac:`14446`::\n+\n+    sage: import sympy\n+    sage: SR(sympy.RisingFactorial(x,x))\n+    gamma(2*x)/gamma(x)\n+    sage: SR(sympy.RisingFactorial(x,3))\n+    (x + 2)*(x + 1)*x\n+    sage: SR(sympy.FallingFactorial(x,x))\n+    gamma(x + 1)\n+    sage: SR(sympy.FallingFactorial(x,3))\n+    (x - 1)*(x - 2)*x\n \"\"\"\n```",
    "created_at": "2017-10-03T11:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178959",
    "user": "https://github.com/zimmermann6"
}
```

I tried adding a doctest with those commands:

```
$ git clone git://git.sagemath.org/sage.git
$ cd sage
$ git branch u/zimmerma/14446
$ git co u/zimmerma/14446
$ patch -p1 -i /tmp/patch
$ git commit -a
$ git push --set-upstream origin u/zimmerma/14446
```
but it failed with:

```
$ git push --set-upstream origin u/zimmerma/14446
fatal: remote error: access denied or repository not exported: /sage.git
```
Am I doing something wrong?

For the record:

```
$ cat /tmp/patch
commit ef0235ff466d40c787681e3e483342e091247392
Author: Paul Zimmermann <Paul.Zimmermann@inria.fr>
Date:   Tue Oct 3 13:03:18 2017 +0200

    added doctest for #14446

diff --git a/src/sage/calculus/test_sympy.py b/src/sage/calculus/test_sympy.py
index 996e417..15b1d7e 100644
--- a/src/sage/calculus/test_sympy.py
+++ b/src/sage/calculus/test_sympy.py
@@ -196,4 +196,15 @@ This was fixed in Sympy, see :trac:`14437`::
     sage: rsolve(f,u(n))
     2**(-n)*(C0 + C1*n)
 
+This was fixed in Sympy, see :trac:`14446`::
+
+    sage: import sympy
+    sage: SR(sympy.RisingFactorial(x,x))
+    gamma(2*x)/gamma(x)
+    sage: SR(sympy.RisingFactorial(x,3))
+    (x + 2)*(x + 1)*x
+    sage: SR(sympy.FallingFactorial(x,x))
+    gamma(x + 1)
+    sage: SR(sympy.FallingFactorial(x,3))
+    (x - 1)*(x - 2)*x
 """
```



---

archive/issue_comments_178960.json:
```json
{
    "body": "Actually this was a SymPy fix which should be tested in SymPy:\nhttps://github.com/sympy/sympy/blob/master/sympy/functions/combinatorial/factorials.py#L559\nhttps://github.com/sympy/sympy/blob/master/sympy/external/tests/test_sage.py",
    "created_at": "2017-10-03T13:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178960",
    "user": "https://github.com/rwst"
}
```

Actually this was a SymPy fix which should be tested in SymPy:
https://github.com/sympy/sympy/blob/master/sympy/functions/combinatorial/factorials.py#L559
https://github.com/sympy/sympy/blob/master/sympy/external/tests/test_sage.py



---

archive/issue_comments_178961.json:
```json
{
    "body": "That is very interesting.  Is it possible to have this sympy file doctested whenever *Sage* runs doctests?  (I don't know how many people would run the package doctests, and in any case this probably isn't automatically tested as easily within sympy itself.)  That would be very helpful.",
    "created_at": "2017-10-03T13:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178961",
    "user": "https://github.com/kcrisman"
}
```

That is very interesting.  Is it possible to have this sympy file doctested whenever *Sage* runs doctests?  (I don't know how many people would run the package doctests, and in any case this probably isn't automatically tested as easily within sympy itself.)  That would be very helpful.



---

archive/issue_comments_178962.json:
```json
{
    "body": "Replying to [comment:14 kcrisman]:\n> That is very interesting.  Is it possible to have this sympy file doctested whenever *Sage* runs doctests? \n\n\nJust copy it at SymPy installation time into `src/sage/tests`.\n\n> this probably isn't automatically tested as easily within sympy itself\n\n\nYou're right. Their Travis doesn't have a Sage installation AFAIK.\n\n> That would be very helpful.\n\n\nSo I opened #23960.",
    "created_at": "2017-10-03T14:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178962",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:14 kcrisman]:
> That is very interesting.  Is it possible to have this sympy file doctested whenever *Sage* runs doctests? 


Just copy it at SymPy installation time into `src/sage/tests`.

> this probably isn't automatically tested as easily within sympy itself


You're right. Their Travis doesn't have a Sage installation AFAIK.

> That would be very helpful.


So I opened #23960.



---

archive/issue_events_041084.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14242#event-41084"
}
```



---

archive/issue_comments_178963.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14242",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14242#issuecomment-178963",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix
