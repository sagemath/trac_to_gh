# Issue 14153: Add Unicode support to the doctesting framework

archive/issues_013949.json:
```json
{
    "assignees": [],
    "body": "Support\n1. Doctest (i.e. `sage:`) lines containing non-ASCII characters.\n2. Doctest results containing non-ASCII characters.\n3. Print statements in doctests outputting unicode.\n4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.\n\nsee also #18370\n\nAssignee: **@roed314**\n\nCC:  @nexttime @embray @jdemeyer @hivert\n\nKeywords: **python3, unicode**\n\nBranch/Commit: **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**\n\nReviewer: **Erik Bray, Volker Braun, David Roe**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14153_\n\n",
    "closed_at": "2017-08-11T18:18:15Z",
    "created_at": "2013-02-20T22:03:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add Unicode support to the doctesting framework",
    "type": "issue",
    "updated_at": "2017-08-11T18:18:15Z",
    "url": "https://github.com/sagemath/sage/issues/14153",
    "user": "https://github.com/jdemeyer"
}
```
Support
1. Doctest (i.e. `sage:`) lines containing non-ASCII characters.
2. Doctest results containing non-ASCII characters.
3. Print statements in doctests outputting unicode.
4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.

see also #18370

Assignee: **@roed314**

CC:  @nexttime @embray @jdemeyer @hivert

Keywords: **python3, unicode**

Branch/Commit: **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**

Reviewer: **Erik Bray, Volker Braun, David Roe**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/14153_





---

archive/issue_events_176313.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-20T22:03:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176313"
}
```



---

archive/issue_events_176314.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-20T22:03:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176314"
}
```



---

archive/issue_events_176315.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-20T22:03:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176315"
}
```



---

archive/issue_events_176316.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-20T22:03:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176316"
}
```



---

archive/issue_comments_171079.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n Support\n 1. Doctest (i.e. `sage:`) lines containing non-ASCII characters.\n 2. Doctest results containing non-ASCII characters.\n-3. Print statements outputting non-ASCII characters inside doctests.\n+3. Print statements in doctests outputting unicode.\n 4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.\n``````\n",
    "created_at": "2013-02-28T10:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171079",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 Support
 1. Doctest (i.e. `sage:`) lines containing non-ASCII characters.
 2. Doctest results containing non-ASCII characters.
-3. Print statements outputting non-ASCII characters inside doctests.
+3. Print statements in doctests outputting unicode.
 4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.
``````




---

archive/issue_comments_171080.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAttachment: **[doctest_unicode.patch.gz](https://github.com/sagemath/sage/files/ticket14153/doctest_unicode.patch.gz)**",
    "created_at": "2013-03-19T11:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171080",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'>Comment 2:</a>
Attachment: **[doctest_unicode.patch.gz](https://github.com/sagemath/sage/files/ticket14153/doctest_unicode.patch.gz)**



---

archive/issue_comments_171081.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI just tried this patch on the suspicion it could help with the test weirdness I reported in 5.9.beta0 on sage-release\n\n```\nsage -t --long devel/sage-main/sage/misc/interpreter.py\n**********************************************************************\nFile \"devel/sage-main/sage/misc/interpreter.py\", line 150, in \nsage.misc.interpreter.sage_prompt\nFailed example:\n    shell.run_cell('sage_prompt()')\nExpected:\n    u'sage'\nGot:\n    u'sage'\n**********************************************************************\nFile \"devel/sage-main/sage/misc/interpreter.py\", line 187, in \nsage.misc.interpreter.SageInteractiveShell.system_raw\nFailed example:\n    shell.system_raw('R --version')\nExpected:\n    R version ...\nGot:\n    WARNING: ignoring environment value of R_HOME\n    R version 2.15.2 (2012-10-26) -- \"Trick or Treat\"\n    Copyright (C) 2012 The R Foundation for Statistical Computing\n    ISBN 3-900051-07-0\n    Platform: x86_64-unknown-linux-gnu (64-bit)\n    <BLANKLINE>\n    R is free software and comes with ABSOLUTELY NO WARRANTY.\n    You are welcome to redistribute it under the terms of the\n    GNU General Public License versions 2 or 3.\n    For more information about these matters see\n    http://www.gnu.org/licenses/.\n    <BLANKLINE>\n**********************************************************************\nFile \"devel/sage-main/sage/misc/interpreter.py\", line 566, in \nsage.misc.interpreter.interface_shell_embed\nFailed example:\n    shell.run_cell('List( [1..10], IsPrime )')\nExpected:\n    [ false, true, true, false, true, false, true, false, false, false ]\nGot:\n    [ false, true, true, false, true, false, true, false, false, false ]\n**********************************************************************\n3 items had failures:\n   1 of  15 in sage.misc.interpreter.SageInteractiveShell.system_raw\n   1 of   4 in sage.misc.interpreter.interface_shell_embed\n   1 of   4 in sage.misc.interpreter.sage_prompt\n    [107 tests, 3 failures, 2.4 s]\n```\nThe R error was fixed by unsetting R_HOME before running the test. Then I applied the patch and here is the result\n\n```\nsage -t --long devel/sage-main/sage/misc/interpreter.py\n**********************************************************************\nFile \"devel/sage-main/sage/misc/interpreter.py\", line 150, in sage.misc.interpreter.sage_prompt\nFailed example:\n    shell.run_cell('sage_prompt()')\nExpected:\n    u'sage'\nGot:\n    u'sage'\n    ---------------------------------------------------------------------------\n    AttributeError                            Traceback (most recent call last)\n    <ipython-input-1-e17c2c2153ac> in <module>()\n    ----> 1 sage_prompt()\n    \n    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)\n        240             self.update_user_ns(result)\n        241             self.log_output(format_dict)\n    --> 242             self.finish_displayhook()\n        243 \n        244     def flush(self):\n    <BLANKLINE>\n    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in finish_displayhook(self)\n        224         \"\"\"Finish up all displayhook activities.\"\"\"\n        225         io.stdout.write(self.shell.separate_out2)\n    --> 226         io.stdout.flush()\n        227 \n        228     def __call__(self, result=None):\n    <BLANKLINE>\n    AttributeError: IOStream instance has no attribute 'flush'\n**********************************************************************\nFile \"devel/sage-main/sage/misc/interpreter.py\", line 566, in sage.misc.interpreter.interface_shell_embed\nFailed example:\n    shell.run_cell('List( [1..10], IsPrime )')\nExpected:\n    [ false, true, true, false, true, false, true, false, false, false ]\nGot:\n    [ false, true, true, false, true, false, true, false, false, false ]\n    ---------------------------------------------------------------------------\n    AttributeError                            Traceback (most recent call last)\n    <ipython-input-1-a772973ec1ce> in <module>()\n    ----> 1 sage.misc.all.logstr(\"\"\"[ false, true, true, false, true, false, true, false, false, false ]\"\"\")\n    \n    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)\n        240             self.update_user_ns(result)\n        241             self.log_output(format_dict)\n    --> 242             self.finish_displayhook()\n        243 \n        244     def flush(self):\n    <BLANKLINE>\n    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in finish_displayhook(self)\n        224         \"\"\"Finish up all displayhook activities.\"\"\"\n        225         io.stdout.write(self.shell.separate_out2)\n    --> 226         io.stdout.flush()\n        227 \n        228     def __call__(self, result=None):\n    <BLANKLINE>\n    AttributeError: IOStream instance has no attribute 'flush'\n**********************************************************************\n2 items had failures:\n   1 of   4 in sage.misc.interpreter.interface_shell_embed\n   1 of   4 in sage.misc.interpreter.sage_prompt\n    [107 tests, 2 failures, 3.0 s]\n```",
    "created_at": "2013-03-19T23:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171081",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'>Comment 3:</a>
I just tried this patch on the suspicion it could help with the test weirdness I reported in 5.9.beta0 on sage-release

```
sage -t --long devel/sage-main/sage/misc/interpreter.py
**********************************************************************
File "devel/sage-main/sage/misc/interpreter.py", line 150, in 
sage.misc.interpreter.sage_prompt
Failed example:
    shell.run_cell('sage_prompt()')
Expected:
    u'sage'
Got:
    u'sage'
**********************************************************************
File "devel/sage-main/sage/misc/interpreter.py", line 187, in 
sage.misc.interpreter.SageInteractiveShell.system_raw
Failed example:
    shell.system_raw('R --version')
Expected:
    R version ...
Got:
    WARNING: ignoring environment value of R_HOME
    R version 2.15.2 (2012-10-26) -- "Trick or Treat"
    Copyright (C) 2012 The R Foundation for Statistical Computing
    ISBN 3-900051-07-0
    Platform: x86_64-unknown-linux-gnu (64-bit)
    <BLANKLINE>
    R is free software and comes with ABSOLUTELY NO WARRANTY.
    You are welcome to redistribute it under the terms of the
    GNU General Public License versions 2 or 3.
    For more information about these matters see
    http://www.gnu.org/licenses/.
    <BLANKLINE>
**********************************************************************
File "devel/sage-main/sage/misc/interpreter.py", line 566, in 
sage.misc.interpreter.interface_shell_embed
Failed example:
    shell.run_cell('List( [1..10], IsPrime )')
Expected:
    [ false, true, true, false, true, false, true, false, false, false ]
Got:
    [ false, true, true, false, true, false, true, false, false, false ]
**********************************************************************
3 items had failures:
   1 of  15 in sage.misc.interpreter.SageInteractiveShell.system_raw
   1 of   4 in sage.misc.interpreter.interface_shell_embed
   1 of   4 in sage.misc.interpreter.sage_prompt
    [107 tests, 3 failures, 2.4 s]
```
The R error was fixed by unsetting R_HOME before running the test. Then I applied the patch and here is the result

```
sage -t --long devel/sage-main/sage/misc/interpreter.py
**********************************************************************
File "devel/sage-main/sage/misc/interpreter.py", line 150, in sage.misc.interpreter.sage_prompt
Failed example:
    shell.run_cell('sage_prompt()')
Expected:
    u'sage'
Got:
    u'sage'
    ---------------------------------------------------------------------------
    AttributeError                            Traceback (most recent call last)
    <ipython-input-1-e17c2c2153ac> in <module>()
    ----> 1 sage_prompt()
    
    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)
        240             self.update_user_ns(result)
        241             self.log_output(format_dict)
    --> 242             self.finish_displayhook()
        243 
        244     def flush(self):
    <BLANKLINE>
    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in finish_displayhook(self)
        224         """Finish up all displayhook activities."""
        225         io.stdout.write(self.shell.separate_out2)
    --> 226         io.stdout.flush()
        227 
        228     def __call__(self, result=None):
    <BLANKLINE>
    AttributeError: IOStream instance has no attribute 'flush'
**********************************************************************
File "devel/sage-main/sage/misc/interpreter.py", line 566, in sage.misc.interpreter.interface_shell_embed
Failed example:
    shell.run_cell('List( [1..10], IsPrime )')
Expected:
    [ false, true, true, false, true, false, true, false, false, false ]
Got:
    [ false, true, true, false, true, false, true, false, false, false ]
    ---------------------------------------------------------------------------
    AttributeError                            Traceback (most recent call last)
    <ipython-input-1-a772973ec1ce> in <module>()
    ----> 1 sage.misc.all.logstr("""[ false, true, true, false, true, false, true, false, false, false ]""")
    
    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)
        240             self.update_user_ns(result)
        241             self.log_output(format_dict)
    --> 242             self.finish_displayhook()
        243 
        244     def flush(self):
    <BLANKLINE>
    /home/work/fbissey/sandbox/sage-5.9.beta0/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in finish_displayhook(self)
        224         """Finish up all displayhook activities."""
        225         io.stdout.write(self.shell.separate_out2)
    --> 226         io.stdout.flush()
        227 
        228     def __call__(self, result=None):
    <BLANKLINE>
    AttributeError: IOStream instance has no attribute 'flush'
**********************************************************************
2 items had failures:
   1 of   4 in sage.misc.interpreter.interface_shell_embed
   1 of   4 in sage.misc.interpreter.sage_prompt
    [107 tests, 2 failures, 3.0 s]
```



---

archive/issue_comments_171082.json:
```json
{
    "body": "Changed assignee from **mvngu** to **@roed314**",
    "created_at": "2013-03-28T22:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171082",
    "user": "https://github.com/roed314"
}
```

Changed assignee from **mvngu** to **@roed314**



---

archive/issue_events_176317.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T22:44:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176317"
}
```



---

archive/issue_events_176318.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-03-28T22:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "component: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176318"
}
```



---

archive/issue_events_176319.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176319"
}
```



---

archive/issue_events_176320.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176320"
}
```



---

archive/issue_events_176321.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176321"
}
```



---

archive/issue_events_176322.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176322"
}
```



---

archive/issue_events_176323.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176323"
}
```



---

archive/issue_events_176324.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176324"
}
```



---

archive/issue_events_176325.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176325"
}
```



---

archive/issue_events_176326.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176326"
}
```



---

archive/issue_comments_171083.json:
```json
{
    "body": "Changed keywords from **** to **python3**",
    "created_at": "2016-08-12T09:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171083",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **** to **python3**



---

archive/issue_events_176327.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-12T09:18:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176327"
}
```



---

archive/issue_events_176328.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2016-08-12T09:18:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176328"
}
```



---

archive/issue_comments_171084.json:
```json
{
    "body": "Branch: **[public/14153](https://github.com/sagemath/sagetrac-mirror/tree/public/14153)**",
    "created_at": "2016-11-10T20:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171084",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/14153](https://github.com/sagemath/sagetrac-mirror/tree/public/14153)**



---

archive/issue_comments_171085.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\njust made a branch from the old patch, not tried to test it\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5\">cffdb90</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>\n",
    "created_at": "2016-11-10T20:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171085",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'>Comment 11:</a>
just made a branch from the old patch, not tried to test it

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5">cffdb90</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>




---

archive/issue_comments_171086.json:
```json
{
    "body": "Commit: **[cffdb90](https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5)**",
    "created_at": "2016-11-10T20:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171086",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[cffdb90](https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5)**



---

archive/issue_comments_171087.json:
```json
{
    "body": "Changed commit from **[cffdb90](https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5)** to **[1712c87](https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5)**",
    "created_at": "2017-01-18T10:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171087",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cffdb90](https://github.com/sagemath/sagetrac-mirror/commit/cffdb9077dc8074a0cde0d0cd21d19046b2a95d5)** to **[1712c87](https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5)**



---

archive/issue_comments_171088.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abd83e5bde43147a692f44946a6111bef9a4c965\">abd83e5</a></td><td><code>Merge branch 'public/14153' in 7.5.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5\">1712c87</a></td><td><code>trac 14153 fixing doc default call</code></td></tr></table>\n",
    "created_at": "2017-01-18T10:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171088",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abd83e5bde43147a692f44946a6111bef9a4c965">abd83e5</a></td><td><code>Merge branch 'public/14153' in 7.5.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5">1712c87</a></td><td><code>trac 14153 fixing doc default call</code></td></tr></table>




---

archive/issue_comments_171089.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI have repaired a detail, but this is not working, in several distinct ways.\n\nThis seems to be broken on lines having unicode characters in comments such as:\n\n```\nsage: 0 + 0    # c'est trop b\u00eate\n```\n\nSome doctests come from the notebook, I made a pull request.\n\nA failing doctest in src/sage/misc/rest_index_of_methods.py\nis related to the presence of \"Lov\\xc3\\xa1sz theta\"",
    "created_at": "2017-01-18T16:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171089",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>Comment 13:</a>
I have repaired a detail, but this is not working, in several distinct ways.

This seems to be broken on lines having unicode characters in comments such as:

```
sage: 0 + 0    # c'est trop bête
```

Some doctests come from the notebook, I made a pull request.

A failing doctest in src/sage/misc/rest_index_of_methods.py
is related to the presence of "Lov\xc3\xa1sz theta"



---

archive/issue_comments_171090.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nseems that something like that is hurting us (in forker):\n\n```\nsage: md=hashlib.md5()\nsage: md.update(u'\u00e9t\u00e9')\n---------------------------------------------------------------------------\nUnicodeEncodeError                        Traceback (most recent call last)\n<ipython-input-9-6a9959b36b47> in <module>()\n----> 1 md.update(u'\u00e9t\u00e9')\n\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xe9' in position 0: ordinal not in range(128)\n```\nsolution: encode ?\n\n```\nsage: md.update(u'\u00e9t\u00e9'.encode('utf8'))\n```",
    "created_at": "2017-01-18T16:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171090",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'>Comment 14:</a>
seems that something like that is hurting us (in forker):

```
sage: md=hashlib.md5()
sage: md.update(u'été')
---------------------------------------------------------------------------
UnicodeEncodeError                        Traceback (most recent call last)
<ipython-input-9-6a9959b36b47> in <module>()
----> 1 md.update(u'été')

UnicodeEncodeError: 'ascii' codec can't encode character u'\xe9' in position 0: ordinal not in range(128)
```
solution: encode ?

```
sage: md.update(u'été'.encode('utf8'))
```



---

archive/issue_comments_171091.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n* another problem in src/sage/misc/cachefunc.pyx with a mu:\n\n```\n398:    625 loops, best of 3: 1.3 \u00b5s per loop\n```\nand same in \nsrc/sage/combinat/designs/evenly_distributed_sets.pyx\nand in src/sage/structure/list_clone_timings.py\n\n* in src/sage_setup/autogen/pari/doc.py, some unicode strings with no u:\n\n```\n113:    doc = doc.replace(\"@[pm]\", \"\u00b1\")\n115:    doc = doc.replace(\"@[agrave]\", \"\u00e0\")\n116:    doc = doc.replace(\"@[aacute]\", \"\u00e1\")\n117:    doc = doc.replace(\"@[eacute]\", \"\u00e9\")\n118:    doc = doc.replace(\"@[ouml]\", \"\u00f6\")\n119:    doc = doc.replace(\"@[uuml]\", \"\u00fc\")\n120:    doc = doc.replace(\"\\\\'{a}\", \"\u00e1\")\n```",
    "created_at": "2017-01-18T17:01:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171091",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'>Comment 15:</a>
* another problem in src/sage/misc/cachefunc.pyx with a mu:

```
398:    625 loops, best of 3: 1.3 µs per loop
```
and same in 
src/sage/combinat/designs/evenly_distributed_sets.pyx
and in src/sage/structure/list_clone_timings.py

* in src/sage_setup/autogen/pari/doc.py, some unicode strings with no u:

```
113:    doc = doc.replace("@[pm]", "±")
115:    doc = doc.replace("@[agrave]", "à")
116:    doc = doc.replace("@[aacute]", "á")
117:    doc = doc.replace("@[eacute]", "é")
118:    doc = doc.replace("@[ouml]", "ö")
119:    doc = doc.replace("@[uuml]", "ü")
120:    doc = doc.replace("\\'{a}", "á")
```



---

archive/issue_comments_171092.json:
```json
{
    "body": "Changed commit from **[1712c87](https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5)** to **[8cd2681](https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a)**",
    "created_at": "2017-01-19T12:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171092",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1712c87](https://github.com/sagemath/sagetrac-mirror/commit/1712c87b8afdb2543e593b6e44165aefc52fdef5)** to **[8cd2681](https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a)**



---

archive/issue_comments_171093.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a\">8cd2681</a></td><td><code>trac 14153 adding uft8 declaration in 2 files</code></td></tr></table>\n",
    "created_at": "2017-01-19T12:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171093",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:16'>Comment 16:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a">8cd2681</a></td><td><code>trac 14153 adding uft8 declaration in 2 files</code></td></tr></table>




---

archive/issue_events_176329.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-26T12:56:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176329"
}
```



---

archive/issue_events_176330.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-26T12:56:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176330"
}
```



---

archive/issue_comments_171094.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThis should be taken care of.",
    "created_at": "2017-04-26T12:56:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171094",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>Comment 17:</a>
This should be taken care of.



---

archive/issue_comments_171095.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a\">489d13f</a></td><td><code>Merge branch 'public/14153' in 8.0.b4</code></td></tr></table>\n",
    "created_at": "2017-04-30T18:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171095",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a">489d13f</a></td><td><code>Merge branch 'public/14153' in 8.0.b4</code></td></tr></table>




---

archive/issue_comments_171096.json:
```json
{
    "body": "Changed commit from **[8cd2681](https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a)** to **[489d13f](https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a)**",
    "created_at": "2017-04-30T18:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171096",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8cd2681](https://github.com/sagemath/sagetrac-mirror/commit/8cd268138984060c14b6b43e9ab2604317a9b20a)** to **[489d13f](https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a)**



---

archive/issue_comments_171097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n 2. Doctest results containing non-ASCII characters.\n 3. Print statements in doctests outputting unicode.\n 4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.\n+\n+see also #18370\n``````\n",
    "created_at": "2017-05-01T12:07:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171097",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 2. Doctest results containing non-ASCII characters.
 3. Print statements in doctests outputting unicode.
 4. Source files with a [PEP 0263](http://www.python.org/dev/peps/pep-0263/) encoding declaration.
+
+see also #18370
``````




---

archive/issue_comments_171098.json:
```json
{
    "body": "Changed keywords from **python3** to **python3, unicode**",
    "created_at": "2017-05-01T12:08:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171098",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from **python3** to **python3, unicode**



---

archive/issue_comments_171099.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-05-02T08:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171099",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_171100.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nLooks fine to me, though I did not test it.  I'm amazed there isn't anything in the stdlib to check the PEP 263 coding line, but if there is I couldn't find it.\n\nThis will be nice to have.  It reminds me of my thought the other day to propose adding a few unicode constants (and the ability to tab-complete them easily) to Sage (e.g. for pi).  Has that been proposed before?",
    "created_at": "2017-05-02T08:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171100",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'>Comment 22:</a>
Looks fine to me, though I did not test it.  I'm amazed there isn't anything in the stdlib to check the PEP 263 coding line, but if there is I couldn't find it.

This will be nice to have.  It reminds me of my thought the other day to propose adding a few unicode constants (and the ability to tab-complete them easily) to Sage (e.g. for pi).  Has that been proposed before?



---

archive/issue_comments_171101.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI have not tested either, so far. May launch my patchbot on the branch later.",
    "created_at": "2017-05-02T10:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171101",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'>Comment 23:</a>
I have not tested either, so far. May launch my patchbot on the branch later.



---

archive/issue_comments_171102.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThe patchbot is not happy at all !\n\nOne example of failure:\n\n```\nFile \"src/doc/ja/a_tour_of_sage/index.rst\", line 39, in doc.ja.a_tour_of_sage.index\nFailed example:\n    x = var('x')   # \u8a18\u53f7\u5909\u6570\u3092\u5b9a\u7fa9\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 520, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 896, in compile_and_execute\n        self.update_digests(example)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 783, in update_digests\n        self.running_global_digest.update(s)\n    UnicodeEncodeError: 'ascii' codec can't encode characters in position 20-26: ordinal not in range(128)\n```\n\nAnother kind of example:\n\n```\nFile \"src/sage/ext/fast_callable.pyx\", line 34, in sage.ext.fast_callable\nFailed example:\n    timeit('wilk.subs(x=30)') # random, long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 520, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 883, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.ext.fast_callable[5]>\", line 1, in <module>\n        timeit('wilk.subs(x=30)') # random, long time\n      File \"sage/misc/sage_timeit_class.pyx\", line 118, in sage.misc.sage_timeit_class.SageTimeit.__call__ (build/cythonized/sage/misc/sage_timeit_class.c:1411)\n        print(self.eval(code, globals, preparse=preparse, **kwds))\n      File \"/home/chapoton/sage/local/lib/python2.7/codecs.py\", line 369, in write\n        data, consumed = self.encode(object, self.errors)\n    UnicodeDecodeError: 'ascii' codec can't decode byte 0xc2 in position 26: ordinal not in range(128)\n```",
    "created_at": "2017-05-03T08:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171102",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>Comment 24:</a>
The patchbot is not happy at all !

One example of failure:

```
File "src/doc/ja/a_tour_of_sage/index.rst", line 39, in doc.ja.a_tour_of_sage.index
Failed example:
    x = var('x')   # 記号変数を定義
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 520, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 896, in compile_and_execute
        self.update_digests(example)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 783, in update_digests
        self.running_global_digest.update(s)
    UnicodeEncodeError: 'ascii' codec can't encode characters in position 20-26: ordinal not in range(128)
```

Another kind of example:

```
File "src/sage/ext/fast_callable.pyx", line 34, in sage.ext.fast_callable
Failed example:
    timeit('wilk.subs(x=30)') # random, long time
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 520, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 883, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.ext.fast_callable[5]>", line 1, in <module>
        timeit('wilk.subs(x=30)') # random, long time
      File "sage/misc/sage_timeit_class.pyx", line 118, in sage.misc.sage_timeit_class.SageTimeit.__call__ (build/cythonized/sage/misc/sage_timeit_class.c:1411)
        print(self.eval(code, globals, preparse=preparse, **kwds))
      File "/home/chapoton/sage/local/lib/python2.7/codecs.py", line 369, in write
        data, consumed = self.encode(object, self.errors)
    UnicodeDecodeError: 'ascii' codec can't decode byte 0xc2 in position 26: ordinal not in range(128)
```



---

archive/issue_comments_171103.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nTo be clear, is that a problem with the patchbot or the doctest runner itself?  It seems more like the latter, but the question is does this happen when running the tests outside the patchbot?",
    "created_at": "2017-05-03T08:57:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171103",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'>Comment 25:</a>
To be clear, is that a problem with the patchbot or the doctest runner itself?  It seems more like the latter, but the question is does this happen when running the tests outside the patchbot?



---

archive/issue_comments_171104.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nSomewhat reminiscent of [#22756 comment:14](https://github.com/sagemath/sage/issues/22756#comment:14) although the japanese stuff is definitely unicode and should be recognized as such by python.",
    "created_at": "2017-05-03T09:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171104",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'>Comment 26:</a>
Somewhat reminiscent of [#22756 comment:14](https://github.com/sagemath/sage/issues/22756#comment:14) although the japanese stuff is definitely unicode and should be recognized as such by python.



---

archive/issue_comments_171105.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\njust fails in the same way outside of the patchbot",
    "created_at": "2017-05-03T10:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171105",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'>Comment 27:</a>
just fails in the same way outside of the patchbot



---

archive/issue_comments_171106.json:
```json
{
    "body": "Changed commit from **[489d13f](https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a)** to **[b9295dc](https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40)**",
    "created_at": "2017-05-03T12:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171106",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[489d13f](https://github.com/sagemath/sagetrac-mirror/commit/489d13f0cd3640a28c05b42077b307173f0c495a)** to **[b9295dc](https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40)**



---

archive/issue_comments_171107.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40\">b9295dc</a></td><td><code>trac 14153 encoding required</code></td></tr></table>\n",
    "created_at": "2017-05-03T12:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171107",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>Comment 28:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40">b9295dc</a></td><td><code>trac 14153 encoding required</code></td></tr></table>




---

archive/issue_comments_171108.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0\">be11f06</a></td><td><code>trac 14153 fixing some doctests</code></td></tr></table>\n",
    "created_at": "2017-05-03T12:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171108",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:29'>Comment 29:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0">be11f06</a></td><td><code>trac 14153 fixing some doctests</code></td></tr></table>




---

archive/issue_comments_171109.json:
```json
{
    "body": "Changed commit from **[b9295dc](https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40)** to **[be11f06](https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0)**",
    "created_at": "2017-05-03T12:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171109",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b9295dc](https://github.com/sagemath/sagetrac-mirror/commit/b9295dca7f1e4c7caa4f6173457a7560f500de40)** to **[be11f06](https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0)**



---

archive/issue_comments_171110.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nLess failing doctests, but still **many**. Is there an expert that could help ?",
    "created_at": "2017-05-03T15:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171110",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'>Comment 30:</a>
Less failing doctests, but still **many**. Is there an expert that could help ?



---

archive/issue_comments_171111.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nDepends on exactly what expertise is needed, but I'll have a look.",
    "created_at": "2017-05-04T14:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171111",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'>Comment 31:</a>
Depends on exactly what expertise is needed, but I'll have a look.



---

archive/issue_comments_171112.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [git](#comment%3A29):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0\">be11f06</a></td><td><code>trac 14153 fixing some doctests</code></td></tr></table>\n\nRegarding this commit, and others like it--is this not going to be a problem on Python 3, where the strings won't be repr'd as `u'...'`?\n\nIn other projects I've modified the doctest checker to ignore the `u` marker in strings by default.  If a test needs to explicitly check whether or not a string is unicode there are other ways.  But most of the time that isn't relevant.",
    "created_at": "2017-05-04T14:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171112",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [git](#comment%3A29):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0">be11f06</a></td><td><code>trac 14153 fixing some doctests</code></td></tr></table>

Regarding this commit, and others like it--is this not going to be a problem on Python 3, where the strings won't be repr'd as `u'...'`?

In other projects I've modified the doctest checker to ignore the `u` marker in strings by default.  If a test needs to explicitly check whether or not a string is unicode there are other ways.  But most of the time that isn't relevant.



---

archive/issue_comments_171113.json:
```json
{
    "body": "Changed commit from **[be11f06](https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0)** to **[0c611c5](https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef)**",
    "created_at": "2017-06-20T11:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171113",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[be11f06](https://github.com/sagemath/sagetrac-mirror/commit/be11f06e98fc93888967ae991f4ea91ce33c50e0)** to **[0c611c5](https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef)**



---

archive/issue_comments_171114.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef\">0c611c5</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>\n",
    "created_at": "2017-06-20T11:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171114",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>Comment 33:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef">0c611c5</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>




---

archive/issue_comments_171115.json:
```json
{
    "body": "Changed branch from **[public/14153](https://github.com/sagemath/sagetrac-mirror/tree/public/14153)** to **[u/chapoton/14153](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153)**",
    "created_at": "2017-07-12T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171115",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[public/14153](https://github.com/sagemath/sagetrac-mirror/tree/public/14153)** to **[u/chapoton/14153](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153)**



---

archive/issue_comments_171116.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nstill very broken..\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10bc1ab1df25314a5e0f997e08c3be77f231d6e5\">10bc1ab</a></td><td><code>trac 14153 unicode in documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2\">080916e</a></td><td><code>py3: poor man's try towards unicode doctest framework</code></td></tr></table>\n",
    "created_at": "2017-07-12T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171116",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'>Comment 34:</a>
still very broken..

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10bc1ab1df25314a5e0f997e08c3be77f231d6e5">10bc1ab</a></td><td><code>trac 14153 unicode in documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2">080916e</a></td><td><code>py3: poor man's try towards unicode doctest framework</code></td></tr></table>




---

archive/issue_comments_171117.json:
```json
{
    "body": "Changed commit from **[0c611c5](https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef)** to **[080916e](https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2)**",
    "created_at": "2017-07-12T14:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171117",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[0c611c5](https://github.com/sagemath/sagetrac-mirror/commit/0c611c5ad8aad31d5403155c40d87f2fb9e087ef)** to **[080916e](https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2)**



---

archive/issue_comments_171118.json:
```json
{
    "body": "Changed commit from **[080916e](https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2)** to **[f3d375e](https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8)**",
    "created_at": "2017-07-13T15:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171118",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[080916e](https://github.com/sagemath/sagetrac-mirror/commit/080916e00f751500b75fba8c992a7c699ca61ed2)** to **[f3d375e](https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8)**



---

archive/issue_comments_171119.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf0774317cbeb87ce5838e7b6c1ad60dfc3529af\">cf07743</a></td><td><code>some unicode changes in timeit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8\">f3d375e</a></td><td><code>Merge branch \"unicode in timeit\" into \"unicode in doctest\"</code></td></tr></table>\n",
    "created_at": "2017-07-13T15:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171119",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:35'>Comment 35:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf0774317cbeb87ce5838e7b6c1ad60dfc3529af">cf07743</a></td><td><code>some unicode changes in timeit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8">f3d375e</a></td><td><code>Merge branch "unicode in timeit" into "unicode in doctest"</code></td></tr></table>




---

archive/issue_comments_171120.json:
```json
{
    "body": "Changed commit from **[f3d375e](https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8)** to **[7906a50](https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655)**",
    "created_at": "2017-07-13T18:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171120",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f3d375e](https://github.com/sagemath/sagetrac-mirror/commit/f3d375ed3aaa3b2c72c9fa2b30b89ac78d0d85f8)** to **[7906a50](https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655)**



---

archive/issue_comments_171121.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655\">7906a50</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>\n",
    "created_at": "2017-07-13T18:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171121",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655">7906a50</a></td><td><code>trac 14153 unicode in documentation</code></td></tr></table>




---

archive/issue_comments_171122.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63\">1813a63</a></td><td><code>trac 14153 some details</code></td></tr></table>\n",
    "created_at": "2017-07-14T08:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171122",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:37'>Comment 37:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63">1813a63</a></td><td><code>trac 14153 some details</code></td></tr></table>




---

archive/issue_comments_171123.json:
```json
{
    "body": "Changed commit from **[7906a50](https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655)** to **[1813a63](https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63)**",
    "created_at": "2017-07-14T08:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171123",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7906a50](https://github.com/sagemath/sagetrac-mirror/commit/7906a504011eb32f7890c0750d3d987568576655)** to **[1813a63](https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63)**



---

archive/issue_comments_171124.json:
```json
{
    "body": "Changed branch from **[u/chapoton/14153](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153)** to **[u/chapoton/14153v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153v2)**",
    "created_at": "2017-07-14T11:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171124",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/chapoton/14153](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153)** to **[u/chapoton/14153v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153v2)**



---

archive/issue_comments_171125.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nhere is another tentative\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0\">e3497e8</a></td><td><code>steps towards unicode doctesting framework</code></td></tr></table>\n",
    "created_at": "2017-07-14T11:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171125",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:38'>Comment 38:</a>
here is another tentative

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0">e3497e8</a></td><td><code>steps towards unicode doctesting framework</code></td></tr></table>




---

archive/issue_comments_171126.json:
```json
{
    "body": "Changed commit from **[1813a63](https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63)** to **[e3497e8](https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0)**",
    "created_at": "2017-07-14T11:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171126",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[1813a63](https://github.com/sagemath/sagetrac-mirror/commit/1813a63c6e37170300f76df3a8e818b6289b6a63)** to **[e3497e8](https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0)**



---

archive/issue_comments_171127.json:
```json
{
    "body": "Changed commit from **[e3497e8](https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0)** to **[cc03d22](https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31)**",
    "created_at": "2017-07-14T13:32:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171127",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e3497e8](https://github.com/sagemath/sagetrac-mirror/commit/e3497e851f155914d54174ad18bd28123f6b37a0)** to **[cc03d22](https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31)**



---

archive/issue_comments_171128.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31\">cc03d22</a></td><td><code>motorhead detail</code></td></tr></table>\n",
    "created_at": "2017-07-14T13:32:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171128",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31">cc03d22</a></td><td><code>motorhead detail</code></td></tr></table>




---

archive/issue_comments_171129.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a\">b091e6a</a></td><td><code>trac 14153 fixing another doctest</code></td></tr></table>\n",
    "created_at": "2017-07-14T17:24:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171129",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:40'>Comment 40:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a">b091e6a</a></td><td><code>trac 14153 fixing another doctest</code></td></tr></table>




---

archive/issue_comments_171130.json:
```json
{
    "body": "Changed commit from **[cc03d22](https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31)** to **[b091e6a](https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a)**",
    "created_at": "2017-07-14T17:24:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171130",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cc03d22](https://github.com/sagemath/sagetrac-mirror/commit/cc03d22738a327999db7162c095daac7d23f9c31)** to **[b091e6a](https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a)**



---

archive/issue_comments_171131.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nThere remains only one failing doctest in the r interface.",
    "created_at": "2017-07-14T17:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171131",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'>Comment 41:</a>
There remains only one failing doctest in the r interface.



---

archive/issue_comments_171132.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c\">8394952</a></td><td><code>trac 14153 fixing another doctest</code></td></tr></table>\n",
    "created_at": "2017-07-14T18:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171132",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>Comment 42:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c">8394952</a></td><td><code>trac 14153 fixing another doctest</code></td></tr></table>




---

archive/issue_comments_171133.json:
```json
{
    "body": "Changed commit from **[b091e6a](https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a)** to **[8394952](https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c)**",
    "created_at": "2017-07-14T18:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171133",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b091e6a](https://github.com/sagemath/sagetrac-mirror/commit/b091e6a60311ab5756d2fb744e60adabae120a5a)** to **[8394952](https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c)**



---

archive/issue_comments_171134.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\n**Green Bot** ! Please review !\n\nI am not sure that this is the definitive fix, but at least good progress.\n\nThis needs to be tested also on Mac and Cygwin, and this I cannot do.",
    "created_at": "2017-07-15T09:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171134",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'>Comment 43:</a>
**Green Bot** ! Please review !

I am not sure that this is the definitive fix, but at least good progress.

This needs to be tested also on Mac and Cygwin, and this I cannot do.



---

archive/issue_comments_171135.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-07-15T13:22:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171135",
    "user": "https://github.com/fchapoton"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_events_176331.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-15T20:17:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176331"
}
```



---

archive/issue_events_176332.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-15T20:17:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176332"
}
```



---

archive/issue_events_176333.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-15T20:17:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176333"
}
```



---

archive/issue_events_176334.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-15T20:17:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176334"
}
```



---

archive/issue_events_176335.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-15T20:17:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176335"
}
```



---

archive/issue_comments_171136.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nping, anybody ?",
    "created_at": "2017-07-18T18:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171136",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:46'>Comment 46:</a>
ping, anybody ?



---

archive/issue_comments_171137.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nTesting on OS X. But it overall looks good.",
    "created_at": "2017-07-19T01:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171137",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'>Comment 47:</a>
Testing on OS X. But it overall looks good.



---

archive/issue_comments_171138.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nI don't think there's anything about this that specifically needs testing on Cygwin.  I've never encountered any issues on Cygwin particularly pertaining to unicode in Python.",
    "created_at": "2017-07-19T08:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171138",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'>Comment 48:</a>
I don't think there's anything about this that specifically needs testing on Cygwin.  I've never encountered any issues on Cygwin particularly pertaining to unicode in Python.



---

archive/issue_comments_171139.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nok, well. Then please review.",
    "created_at": "2017-07-19T08:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171139",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:49'>Comment 49:</a>
ok, well. Then please review.



---

archive/issue_comments_171140.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nThis is maybe a minor point, but here:\n\n```diff\ndiff --git a/src/sage/doctest/forker.py b/src/sage/doctest/forker.py\nindex 9a5d982..705b718 100644\n--- a/src/sage/doctest/forker.py\n+++ b/src/sage/doctest/forker.py\n@@ -514,7 +514,9 @@ class SageDocTestRunner(doctest.DocTestRunner):\n             finally:\n                 if self.debugger is not None:\n                     self.debugger.set_continue() # ==== Example Finished ====\n-            got = self._fakeout.getvalue()  # the actual output\n+            got = self._fakeout.getvalue().decode('utf-8')\n+            # the actual output\n+\n```\n\nit might be good if this were wrapped in a try/except, and fall back on latin1 if utf-8 decoding fails, like:\n\n```\ngot = self._fakeout.getvalue()\ntry:\n    got = got.decode('utf-8')\nexcept UnicodeDecodeError:\n    got = got.decode('latin1')\n```\n\nOf course this *shouldn't* happen, but in the off chance some test produces garbage output, this will at least prevent the doctest runner from crashing with a `UnicodeDecodeError`.  Instead you'll get *some* text, likely wrong, that can still be compared to the expected result.",
    "created_at": "2017-07-19T09:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171140",
    "user": "https://github.com/embray"
}
```

<a id='comment:50'>Comment 50:</a>
This is maybe a minor point, but here:

```diff
diff --git a/src/sage/doctest/forker.py b/src/sage/doctest/forker.py
index 9a5d982..705b718 100644
--- a/src/sage/doctest/forker.py
+++ b/src/sage/doctest/forker.py
@@ -514,7 +514,9 @@ class SageDocTestRunner(doctest.DocTestRunner):
             finally:
                 if self.debugger is not None:
                     self.debugger.set_continue() # ==== Example Finished ====
-            got = self._fakeout.getvalue()  # the actual output
+            got = self._fakeout.getvalue().decode('utf-8')
+            # the actual output
+
```

it might be good if this were wrapped in a try/except, and fall back on latin1 if utf-8 decoding fails, like:

```
got = self._fakeout.getvalue()
try:
    got = got.decode('utf-8')
except UnicodeDecodeError:
    got = got.decode('latin1')
```

Of course this *shouldn't* happen, but in the off chance some test produces garbage output, this will at least prevent the doctest runner from crashing with a `UnicodeDecodeError`.  Instead you'll get *some* text, likely wrong, that can still be compared to the expected result.



---

archive/issue_comments_171141.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nLikewise here:\n\n```diff\ndiff --git a/src/sage/interfaces/r.py b/src/sage/interfaces/r.py\nindex 9db603f..e9096df 100644\n--- a/src/sage/interfaces/r.py\n+++ b/src/sage/interfaces/r.py\n@@ -668,7 +668,7 @@ class R(ExtraTabCompletion, Expect):\n             ...\n             ImportError: ...\n         \"\"\"\n-        ret = self.eval('require(\"%s\")'%library_name)\n+        ret = self.eval('require(\"%s\")'%library_name).decode('utf-8')\n         # try hard to parse the message string in a locale-independent way\n         if ' library(' in ret:       # locale-independent key-word\n             raise ImportError(\"%s\"%ret)\n```\n\nIn this case I'm not really sure what the best thing is to do if there's an encoding error, but it should probably be handled.  Will have to give that more thought.  Basically any time you're decoding bytes coming from an external source it's important not to assume they'll always have the expected encoding :(",
    "created_at": "2017-07-19T09:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171141",
    "user": "https://github.com/embray"
}
```

<a id='comment:51'>Comment 51:</a>
Likewise here:

```diff
diff --git a/src/sage/interfaces/r.py b/src/sage/interfaces/r.py
index 9db603f..e9096df 100644
--- a/src/sage/interfaces/r.py
+++ b/src/sage/interfaces/r.py
@@ -668,7 +668,7 @@ class R(ExtraTabCompletion, Expect):
             ...
             ImportError: ...
         """
-        ret = self.eval('require("%s")'%library_name)
+        ret = self.eval('require("%s")'%library_name).decode('utf-8')
         # try hard to parse the message string in a locale-independent way
         if ' library(' in ret:       # locale-independent key-word
             raise ImportError("%s"%ret)
```

In this case I'm not really sure what the best thing is to do if there's an encoding error, but it should probably be handled.  Will have to give that more thought.  Basically any time you're decoding bytes coming from an external source it's important not to assume they'll always have the expected encoding :(



---

archive/issue_comments_171142.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nThe rest makes sense to me.  I haven't done a thorough investigation into all the places where Sage needs better unicode handling, and I'm sure this isn't exhaustive either, but I know you've done a lot of testing.  The next issue is just what the patchbots will say....",
    "created_at": "2017-07-19T09:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171142",
    "user": "https://github.com/embray"
}
```

<a id='comment:52'>Comment 52:</a>
The rest makes sense to me.  I haven't done a thorough investigation into all the places where Sage needs better unicode handling, and I'm sure this isn't exhaustive either, but I know you've done a lot of testing.  The next issue is just what the patchbots will say....



---

archive/issue_comments_171143.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\npatchbots said green already..\n\n**EDIT** oh, no.. I missed the last report.",
    "created_at": "2017-07-19T09:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171143",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:53'>Comment 53:</a>
patchbots said green already..

**EDIT** oh, no.. I missed the last report.



---

archive/issue_comments_171144.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cffa8e3b6e232982755cae45673aae3f60e8eb9\">0cffa8e</a></td><td><code>Merge branch 'u/chapoton/14153v2' of ssh://trac.sagemath.org:22/sage into unicode</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7\">4dc084e</a></td><td><code>trac 14153 reviewer's suggestions + gap doc interface</code></td></tr></table>\n",
    "created_at": "2017-07-19T11:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171144",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:54'>Comment 54:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cffa8e3b6e232982755cae45673aae3f60e8eb9">0cffa8e</a></td><td><code>Merge branch 'u/chapoton/14153v2' of ssh://trac.sagemath.org:22/sage into unicode</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7">4dc084e</a></td><td><code>trac 14153 reviewer's suggestions + gap doc interface</code></td></tr></table>




---

archive/issue_comments_171145.json:
```json
{
    "body": "Changed commit from **[8394952](https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c)** to **[4dc084e](https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7)**",
    "created_at": "2017-07-19T11:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171145",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8394952](https://github.com/sagemath/sagetrac-mirror/commit/8394952acfe919aba99695f84248edbc212a3c9c)** to **[4dc084e](https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7)**



---

archive/issue_comments_171146.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nDamn, some of the patchbots see some problems with the gap interface, that I do not see locally..",
    "created_at": "2017-07-20T18:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171146",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:55'>Comment 55:</a>
Damn, some of the patchbots see some problems with the gap interface, that I do not see locally..



---

archive/issue_events_176336.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-20T18:48:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176336"
}
```



---

archive/issue_events_176337.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-20T18:48:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176337"
}
```



---

archive/issue_comments_171147.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nAll clear on OS X as far as I can tell.",
    "created_at": "2017-07-21T03:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171147",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'>Comment 56:</a>
All clear on OS X as far as I can tell.



---

archive/issue_comments_171148.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nReplying to [@fchapoton](#comment%3A55):\n> Damn, some of the patchbots see some problems with the gap interface, that I do not see locally..\n\nIt probably has something to do with their locale settings.  This is why I suggested not just assuming `.decode('utf-8')` will work :)  Now the question is, how exactly does GAP determine what encoding to use...",
    "created_at": "2017-07-21T08:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171148",
    "user": "https://github.com/embray"
}
```

<a id='comment:57'>Comment 57:</a>
Replying to [@fchapoton](#comment%3A55):
> Damn, some of the patchbots see some problems with the gap interface, that I do not see locally..

It probably has something to do with their locale settings.  This is why I suggested not just assuming `.decode('utf-8')` will work :)  Now the question is, how exactly does GAP determine what encoding to use...



---

archive/issue_comments_171149.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nAh, I forgot to point that out here:\n\n```diff\ndiff --git a/src/sage/interfaces/gap.py b/src/sage/interfaces/gap.py\nindex dd7b27f..7e765a1 100644\n--- a/src/sage/interfaces/gap.py\n+++ b/src/sage/interfaces/gap.py\n@@ -188,6 +188,7 @@ from sage.interfaces.tab_completion import ExtraTabCompletion\n from sage.structure.element import ModuleElement\n import re\n import os\n+import io\n import pexpect\n import time\n import platform\n@@ -1339,7 +1340,7 @@ class Gap(Gap_generic):\n             (sline,) = match.groups()\n             if self.is_remote():\n                 self._get_tmpfile()\n-            F = open(self._local_tmpfile(),\"r\")\n+            F = io.open(self._local_tmpfile(), \"r\", encoding='utf-8')\n             help = F.read()\n             if pager:\n                 from IPython.core.page import page\n```\n\nLet's see if we can determine what encoding GAP is actually using...",
    "created_at": "2017-07-21T08:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171149",
    "user": "https://github.com/embray"
}
```

<a id='comment:58'>Comment 58:</a>
Ah, I forgot to point that out here:

```diff
diff --git a/src/sage/interfaces/gap.py b/src/sage/interfaces/gap.py
index dd7b27f..7e765a1 100644
--- a/src/sage/interfaces/gap.py
+++ b/src/sage/interfaces/gap.py
@@ -188,6 +188,7 @@ from sage.interfaces.tab_completion import ExtraTabCompletion
 from sage.structure.element import ModuleElement
 import re
 import os
+import io
 import pexpect
 import time
 import platform
@@ -1339,7 +1340,7 @@ class Gap(Gap_generic):
             (sline,) = match.groups()
             if self.is_remote():
                 self._get_tmpfile()
-            F = open(self._local_tmpfile(),"r")
+            F = io.open(self._local_tmpfile(), "r", encoding='utf-8')
             help = F.read()
             if pager:
                 from IPython.core.page import page
```

Let's see if we can determine what encoding GAP is actually using...



---

archive/issue_comments_171150.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nMaybe we should force the value of `\"GAPInfo.TermEncoding\"` ?\n\nsee https://www.gap-system.org/Manuals/pkg/GAPDoc-1.5.1/doc/chap5.html\n\nMaybe using `GAPInfo.TermEncoding := \"UTF-8\";`\n\nI know nothing of GAP, some input from a GAP expert could be useful here..",
    "created_at": "2017-07-21T08:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171150",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:59'>Comment 59:</a>
Maybe we should force the value of `"GAPInfo.TermEncoding"` ?

see https://www.gap-system.org/Manuals/pkg/GAPDoc-1.5.1/doc/chap5.html

Maybe using `GAPInfo.TermEncoding := "UTF-8";`

I know nothing of GAP, some input from a GAP expert could be useful here..



---

archive/issue_comments_171151.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nI can reproduce the failing doctests locally by adding one line\n\n```\n         self.eval('SetGAPDocTextTheme(\"none\")')\n+        self.eval('GAPInfo.TermEncoding := \"latin1\";')\n         self.eval(r'\\$SAGE.tempfile := \"%s\";'%tmp_to_use)\n```",
    "created_at": "2017-07-21T09:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171151",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:60'>Comment 60:</a>
I can reproduce the failing doctests locally by adding one line

```
         self.eval('SetGAPDocTextTheme("none")')
+        self.eval('GAPInfo.TermEncoding := "latin1";')
         self.eval(r'\$SAGE.tempfile := "%s";'%tmp_to_use)
```



---

archive/issue_comments_171152.json:
```json
{
    "body": "Changed commit from **[4dc084e](https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7)** to **[1c0dd43](https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d)**",
    "created_at": "2017-07-21T09:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171152",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4dc084e](https://github.com/sagemath/sagetrac-mirror/commit/4dc084e452d83fe8bf80b105d25b404a21092be7)** to **[1c0dd43](https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d)**



---

archive/issue_comments_171153.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d\">1c0dd43</a></td><td><code>trac 14153 trying to fix the gap doc doctests</code></td></tr></table>\n",
    "created_at": "2017-07-21T09:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171153",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:61'>Comment 61:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d">1c0dd43</a></td><td><code>trac 14153 trying to fix the gap doc doctests</code></td></tr></table>




---

archive/issue_comments_171154.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nnot sure at all that this is a good solution..",
    "created_at": "2017-07-21T09:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171154",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:62'>Comment 62:</a>
not sure at all that this is a good solution..



---

archive/issue_comments_171155.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nInteresting.  It's not clear to me where `TermEncoding` is used in the process of displaying some help docs.  But if you were able to reproduce by setting that then it must be involved somewhere, somehow...",
    "created_at": "2017-07-21T09:31:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171155",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'>Comment 63:</a>
Interesting.  It's not clear to me where `TermEncoding` is used in the process of displaying some help docs.  But if you were able to reproduce by setting that then it must be involved somewhere, somehow...



---

archive/issue_comments_171156.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nsee the section `5.3-2 GAPDoc2Text` in the link \u200bhttps://www.gap-system.org/Manuals/pkg/GAPDoc-1.5.1/doc/chap5.html\n\nI think this explain what GAP does when its doc is required as a text.",
    "created_at": "2017-07-21T09:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171156",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:64'>Comment 64:</a>
see the section `5.3-2 GAPDoc2Text` in the link ​https://www.gap-system.org/Manuals/pkg/GAPDoc-1.5.1/doc/chap5.html

I think this explain what GAP does when its doc is required as a text.



---

archive/issue_comments_171157.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nGreat, that should explain it then.\n\nHmm--maybe rather than forcing `TermEncoding` to a specific value we should read `TermEncoding` and use that to determine how to decode text from GAP.",
    "created_at": "2017-07-21T09:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171157",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'>Comment 65:</a>
Great, that should explain it then.

Hmm--maybe rather than forcing `TermEncoding` to a specific value we should read `TermEncoding` and use that to determine how to decode text from GAP.



---

archive/issue_comments_171158.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd\">0faa943</a></td><td><code>trac 14153 detect gap encoding</code></td></tr></table>\n",
    "created_at": "2017-07-21T11:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171158",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:66'>Comment 66:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd">0faa943</a></td><td><code>trac 14153 detect gap encoding</code></td></tr></table>




---

archive/issue_comments_171159.json:
```json
{
    "body": "Changed commit from **[1c0dd43](https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d)** to **[0faa943](https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd)**",
    "created_at": "2017-07-21T11:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171159",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1c0dd43](https://github.com/sagemath/sagetrac-mirror/commit/1c0dd43920d5c81b164992fbaf9ecd9f81a3154d)** to **[0faa943](https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd)**



---

archive/issue_comments_171160.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nindeed, here is a try..",
    "created_at": "2017-07-21T11:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171160",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:67'>Comment 67:</a>
indeed, here is a try..



---

archive/issue_events_176338.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-21T11:26:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176338"
}
```



---

archive/issue_events_176339.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-07-21T11:26:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176339"
}
```



---

archive/issue_comments_171161.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nbot seems to be stable-green, please review",
    "created_at": "2017-07-25T06:37:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171161",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:69'>Comment 69:</a>
bot seems to be stable-green, please review



---

archive/issue_comments_171162.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\nping ? Jeroen ? Erik ?",
    "created_at": "2017-07-31T20:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171162",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:70'>Comment 70:</a>
ping ? Jeroen ? Erik ?



---

archive/issue_comments_171163.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nCan you replace the unconditional except: with something more sensible? Probably just name = str(name) instead of the entire try/except + assertion. Rest lgtm",
    "created_at": "2017-08-05T15:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171163",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:71'>Comment 71:</a>
Can you replace the unconditional except: with something more sensible? Probably just name = str(name) instead of the entire try/except + assertion. Rest lgtm



---

archive/issue_comments_171164.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6077c0c4646081d578914885c74909f4e399426\">b6077c0</a></td><td><code>Merge branch 'u/chapoton/14153v2' in 8.1.b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04\">ed1e3b5</a></td><td><code>trac 14153 more precise except clause</code></td></tr></table>\n",
    "created_at": "2017-08-05T15:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171164",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:72'>Comment 72:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6077c0c4646081d578914885c74909f4e399426">b6077c0</a></td><td><code>Merge branch 'u/chapoton/14153v2' in 8.1.b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04">ed1e3b5</a></td><td><code>trac 14153 more precise except clause</code></td></tr></table>




---

archive/issue_comments_171165.json:
```json
{
    "body": "Changed commit from **[0faa943](https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd)** to **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**",
    "created_at": "2017-08-05T15:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171165",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0faa943](https://github.com/sagemath/sagetrac-mirror/commit/0faa9436561f00cf1ed5b9c8a65ca4667032f2dd)** to **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**



---

archive/issue_comments_171166.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nThanks Volker for having a look.\n\nI have made a more precise except. I guess one could also have removed the try-except.",
    "created_at": "2017-08-05T15:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171166",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:73'>Comment 73:</a>
Thanks Volker for having a look.

I have made a more precise except. I guess one could also have removed the try-except.



---

archive/issue_comments_171167.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nbot is morally green",
    "created_at": "2017-08-06T19:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171167",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:74'>Comment 74:</a>
bot is morally green



---

archive/issue_events_176340.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-08-06T20:00:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176340"
}
```



---

archive/issue_events_176341.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-08-06T20:00:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176341"
}
```



---

archive/issue_comments_171168.json:
```json
{
    "body": "Changed reviewer from **Erik Bray** to **Erik Bray, Volker Bruan, David Roe**",
    "created_at": "2017-08-06T20:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171168",
    "user": "https://github.com/roed314"
}
```

Changed reviewer from **Erik Bray** to **Erik Bray, Volker Bruan, David Roe**



---

archive/issue_comments_171169.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nLooks good.  Sorry that this review took so long!",
    "created_at": "2017-08-06T20:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171169",
    "user": "https://github.com/roed314"
}
```

<a id='comment:75'>Comment 75:</a>
Looks good.  Sorry that this review took so long!



---

archive/issue_comments_171170.json:
```json
{
    "body": "Changed reviewer from **Erik Bray, Volker Bruan, David Roe** to **Erik Bray, Volker Braun, David Roe**",
    "created_at": "2017-08-09T19:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171170",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Erik Bray, Volker Bruan, David Roe** to **Erik Bray, Volker Braun, David Roe**



---

archive/issue_comments_171171.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nSorry for the typo Volker!",
    "created_at": "2017-08-11T02:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171171",
    "user": "https://github.com/roed314"
}
```

<a id='comment:77'>Comment 77:</a>
Sorry for the typo Volker!



---

archive/issue_events_176342.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-11T18:18:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176342"
}
```



---

archive/issue_events_176343.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "44fba6b9dbbced88894a153996e7df96d2ad1165",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-08-11T18:18:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14153#event-176343"
}
```



---

archive/issue_comments_171172.json:
```json
{
    "body": "Changed branch from **[u/chapoton/14153v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153v2)** to **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**",
    "created_at": "2017-08-11T18:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14153#issuecomment-171172",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/14153v2](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/14153v2)** to **[ed1e3b5](https://github.com/sagemath/sagetrac-mirror/commit/ed1e3b5bf17e6cc923e28b11862496dd0e1b9b04)**
