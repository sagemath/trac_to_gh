# Issue 14669: autogenerate the list of subdirectories of doc/en/reference

archive/issues_014465.json:
```json
{
    "assignees": [],
    "body": "As the summary says. Currently, the file `doc/en/reference/conf.py` explicitly lists all of the subdirectories which contain components of the reference manual. If anyone adds a new component, they have to edit this file, and if they forget, they can get opaque error messages. So instead, the list should be generated on the fly.\n\n\nAssignee: **mvngu**\n\nCC:  @vbraun\n\nReviewer: **Volker Braun**\n\nAuthor: **John Palmieri**\n\nMerged: **sage-5.11.beta0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14669_\n\n",
    "closed_at": "2013-06-06T12:34:23Z",
    "created_at": "2013-05-30T18:44:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "autogenerate the list of subdirectories of doc/en/reference",
    "type": "issue",
    "updated_at": "2013-06-06T12:34:23Z",
    "url": "https://github.com/sagemath/sage/issues/14669",
    "user": "https://github.com/jhpalmieri"
}
```
As the summary says. Currently, the file `doc/en/reference/conf.py` explicitly lists all of the subdirectories which contain components of the reference manual. If anyone adds a new component, they have to edit this file, and if they forget, they can get opaque error messages. So instead, the list should be generated on the fly.


Assignee: **mvngu**

CC:  @vbraun

Reviewer: **Volker Braun**

Author: **John Palmieri**

Merged: **sage-5.11.beta0**

_Issue created by migration from https://trac.sagemath.org/ticket/14669_





---

archive/issue_events_184161.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-30T18:44:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184161"
}
```



---

archive/issue_events_184162.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-30T18:44:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "component: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184162"
}
```



---

archive/issue_events_184163.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-30T18:44:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184163"
}
```



---

archive/issue_events_184164.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-30T18:44:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184164"
}
```



---

archive/issue_comments_180658.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nSlightly different from the patch at #7477: I've removed 'sage', 'sagenb', 'media', and 'other' from the list of directories -- these might be present if upgrading Sage.",
    "created_at": "2013-05-30T18:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180658",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'>Comment 1:</a>
Slightly different from the patch at #7477: I've removed 'sage', 'sagenb', 'media', and 'other' from the list of directories -- these might be present if upgrading Sage.



---

archive/issue_events_184165.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-30T18:46:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184165"
}
```



---

archive/issue_events_184166.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-30T19:06:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184166"
}
```



---

archive/issue_events_184167.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-30T19:06:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184167"
}
```



---

archive/issue_comments_180659.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nLooks good to me.",
    "created_at": "2013-05-30T19:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180659",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'>Comment 2:</a>
Looks good to me.



---

archive/issue_comments_180660.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2013-05-30T19:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180660",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_180661.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nMinor thing:  The new list isn't sorted.",
    "created_at": "2013-05-30T20:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180661",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'>Comment 3:</a>
Minor thing:  The new list isn't sorted.



---

archive/issue_comments_180662.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nStylewise:  It would be better to create a *set* of the subdir names and afterwards remove the \"bad\" ones from that (with `.difference_update()`).",
    "created_at": "2013-05-30T20:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180662",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'>Comment 4:</a>
Stylewise:  It would be better to create a *set* of the subdir names and afterwards remove the "bad" ones from that (with `.difference_update()`).



---

archive/issue_comments_180663.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nTo the best of my knowledge neither the order of the entry nor the performance of this step of the doc build matter.",
    "created_at": "2013-05-30T20:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180663",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'>Comment 5:</a>
To the best of my knowledge neither the order of the entry nor the performance of this step of the doc build matter.



---

archive/issue_comments_180664.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@vbraun](#comment%3A5):\n> To the best of my knowledge neither the order of the entry nor the performance of this step of the doc build matter.\n\nTo you...\n\nIf the folders are sorted (or more precisely, get processed in alphabetical order), you at least get an idea of the progress.\n\nW.r.t. performance:  It certainly doesn't matter *here* (at least currently ;-) ), that's why I wrote *stylewise*.  People<sup>*</sup> tend to get used to such, adding overhead here and there, and at some point it *does* matter.\n\n(<sup>*</sup> which includes people *reading* such code, not necessarily their author(s))",
    "created_at": "2013-05-30T20:55:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180664",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@vbraun](#comment%3A5):
> To the best of my knowledge neither the order of the entry nor the performance of this step of the doc build matter.

To you...

If the folders are sorted (or more precisely, get processed in alphabetical order), you at least get an idea of the progress.

W.r.t. performance:  It certainly doesn't matter *here* (at least currently ;-) ), that's why I wrote *stylewise*.  People<sup>*</sup> tend to get used to such, adding overhead here and there, and at some point it *does* matter.

(<sup>*</sup> which includes people *reading* such code, not necessarily their author(s))



---

archive/issue_comments_180665.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI don't mind sorting the list, but note that once you pass the list off to parallel processing, you tend to lose control of the ordering. For example, I usually see `polynomial_rings` build first. As far as style goes, there is frequently a trade-off between readability and performance. In this case, I think that just using lists is more readable, and since performance is not an issue, we should leave it as is.",
    "created_at": "2013-05-30T21:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180665",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'>Comment 7:</a>
I don't mind sorting the list, but note that once you pass the list off to parallel processing, you tend to lose control of the ordering. For example, I usually see `polynomial_rings` build first. As far as style goes, there is frequently a trade-off between readability and performance. In this case, I think that just using lists is more readable, and since performance is not an issue, we should leave it as is.



---

archive/issue_comments_180666.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nDifference between the old and new patch:\n\n```diff\ndiff --git a/doc/en/reference/conf.py b/doc/en/reference/conf.py\n--- a/doc/en/reference/conf.py\n+++ b/doc/en/reference/conf.py\n@@ -64,13 +64,13 @@\n \n multidocs_is_master = True\n \n-# List of subdocs. Include all subdirectories of ref_src except for\n-# 'static' and 'templates', and to deal with upgrades: 'sage',\n+# Sorted list of subdocs. Include all subdirectories of ref_src except\n+# for 'static' and 'templates', and to deal with upgrades: 'sage',\n # 'sagenb', 'media', and 'other'.\n bad_directories = ['static', 'templates', 'sage', 'sagenb', 'media', 'other']\n-multidocs_subdoc_list = [x for x in os.listdir(ref_src) if\n-                         os.path.isdir(os.path.join(ref_src, x))\n-                         and x not in bad_directories]\n+multidocs_subdoc_list = [x for x in os.listdir(ref_src)\n+                         if os.path.isdir(os.path.join(ref_src, x))\n+                         and x not in bad_directories].sort()\n \n # List of directories, relative to source directory, that shouldn't be\n # searched for source files.\n```\nEDIT: the patch uses `sorted([...])` rather than `[...].sort()`, of course.",
    "created_at": "2013-05-30T21:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180666",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'>Comment 8:</a>
Difference between the old and new patch:

```diff
diff --git a/doc/en/reference/conf.py b/doc/en/reference/conf.py
--- a/doc/en/reference/conf.py
+++ b/doc/en/reference/conf.py
@@ -64,13 +64,13 @@
 
 multidocs_is_master = True
 
-# List of subdocs. Include all subdirectories of ref_src except for
-# 'static' and 'templates', and to deal with upgrades: 'sage',
+# Sorted list of subdocs. Include all subdirectories of ref_src except
+# for 'static' and 'templates', and to deal with upgrades: 'sage',
 # 'sagenb', 'media', and 'other'.
 bad_directories = ['static', 'templates', 'sage', 'sagenb', 'media', 'other']
-multidocs_subdoc_list = [x for x in os.listdir(ref_src) if
-                         os.path.isdir(os.path.join(ref_src, x))
-                         and x not in bad_directories]
+multidocs_subdoc_list = [x for x in os.listdir(ref_src)
+                         if os.path.isdir(os.path.join(ref_src, x))
+                         and x not in bad_directories].sort()
 
 # List of directories, relative to source directory, that shouldn't be
 # searched for source files.
```
EDIT: the patch uses `sorted([...])` rather than `[...].sort()`, of course.



---

archive/issue_comments_180667.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nahknst, KO.",
    "created_at": "2013-05-30T21:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180667",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'>Comment 9:</a>
ahknst, KO.



---

archive/issue_comments_180668.json:
```json
{
    "body": "Attachment: **[trac_14669.patch.gz](https://github.com/sagemath/sage/files/ticket14669/trac_14669.patch.gz)**",
    "created_at": "2013-05-30T21:26:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180668",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_14669.patch.gz](https://github.com/sagemath/sage/files/ticket14669/trac_14669.patch.gz)**



---

archive/issue_comments_180669.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nThe docbuilder will sort the bags of work by decreasing number of subdirectories (approx. computational effort), so its pointless to sort here.",
    "created_at": "2013-05-30T22:34:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180669",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>Comment 10:</a>
The docbuilder will sort the bags of work by decreasing number of subdirectories (approx. computational effort), so its pointless to sort here.



---

archive/issue_comments_180670.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI think that the value of `multidocs_subdoc_list` is part of the pickle stored for the documentation. So in the unlikely event that repeated execution of `os.listdir(...)` produces lists in different orders, we should sort it to make sure the pickle is consistent from one run to the next.",
    "created_at": "2013-05-30T23:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180670",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'>Comment 11:</a>
I think that the value of `multidocs_subdoc_list` is part of the pickle stored for the documentation. So in the unlikely event that repeated execution of `os.listdir(...)` produces lists in different orders, we should sort it to make sure the pickle is consistent from one run to the next.



---

archive/issue_comments_180671.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@vbraun](#comment%3A10):\n> The docbuilder will sort the bags of work by decreasing number of subdirectories (approx. computational effort), \n\n... which again will maximize the (expected) peak memory usage.",
    "created_at": "2013-05-31T00:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180671",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@vbraun](#comment%3A10):
> The docbuilder will sort the bags of work by decreasing number of subdirectories (approx. computational effort), 

... which again will maximize the (expected) peak memory usage.



---

archive/issue_comments_180672.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nStep out for a few hours and you miss a lot.  ;-)\n\nI just used this to build the reference manual on 5.10.beta5 by nuking `doc/output` and doing\n\n```\nsage -docbuild reference inventory\nsage -docbuild reference html\n```\n\nand it seemed to work just fine.  At least the matroid documentation rendered fine.  So I'm all for a positive review based on my testing.  I'll stay out of the sorted discussion.\n\nRob",
    "created_at": "2013-05-31T01:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180672",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:13'>Comment 13:</a>
Step out for a few hours and you miss a lot.  ;-)

I just used this to build the reference manual on 5.10.beta5 by nuking `doc/output` and doing

```
sage -docbuild reference inventory
sage -docbuild reference html
```

and it seemed to work just fine.  At least the matroid documentation rendered fine.  So I'm all for a positive review based on my testing.  I'll stay out of the sorted discussion.

Rob



---

archive/issue_comments_180673.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@nexttime](#comment%3A12):\n> ... which again will maximize the (expected) peak memory usage.\n\nExactly! You finally got the point of parallelism ;-) We are trying to use all resources of the computer at once. If you don't have enough memory or your IO is slow then you don't benefit from multiple processors.",
    "created_at": "2013-05-31T09:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180673",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@nexttime](#comment%3A12):
> ... which again will maximize the (expected) peak memory usage.

Exactly! You finally got the point of parallelism ;-) We are trying to use all resources of the computer at once. If you don't have enough memory or your IO is slow then you don't benefit from multiple processors.



---

archive/issue_comments_180674.json:
```json
{
    "body": "Merged: **sage-5.11.beta0**",
    "created_at": "2013-06-06T12:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14669#issuecomment-180674",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.11.beta0**



---

archive/issue_events_184168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:34:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184168"
}
```



---

archive/issue_events_184169.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:34:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14669",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14669#event-184169"
}
```
