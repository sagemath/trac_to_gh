# Issue 14460: GCC-4.8.0 miscompiles some sig_on() statements

archive/issues_014256.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). If the Sage library is compiled with `-Og`, the following doctest from `sage/libs/gap/element.pyx` crashes with an unhandled SIGABRT:\n\n```\nsage: F1 = libgap.FreeGroup(['a']) ## line 427 ## \nsage: F2 = libgap.FreeGroup(['a']) ## line 428 ## \nsage: F1 == F2 ## line 429 ## \n``` \n\nlibGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.\n\nCompiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **Jean-Pierre Flori**\n\nAuthor: **Jeroen Demeyer**\n\nMerged: **sage-5.9.rc0**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14460_\n\n",
    "closed_at": "2013-04-19T13:53:08Z",
    "created_at": "2013-04-16T14:37:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GCC-4.8.0 miscompiles some sig_on() statements",
    "type": "issue",
    "updated_at": "2013-05-31T12:54:52Z",
    "url": "https://github.com/sagemath/sage/issues/14460",
    "user": "https://github.com/jdemeyer"
}
```
With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). If the Sage library is compiled with `-Og`, the following doctest from `sage/libs/gap/element.pyx` crashes with an unhandled SIGABRT:

```
sage: F1 = libgap.FreeGroup(['a']) ## line 427 ## 
sage: F2 = libgap.FreeGroup(['a']) ## line 428 ## 
sage: F1 == F2 ## line 429 ## 
``` 

libGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.

Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **Jean-Pierre Flori**

Author: **Jeroen Demeyer**

Merged: **sage-5.9.rc0**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/14460_





---

archive/issue_events_204504.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T14:37:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204504"
}
```



---

archive/issue_events_204505.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T14:37:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204505"
}
```



---

archive/issue_events_204506.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T14:37:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204506"
}
```



---

archive/issue_events_204507.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T14:37:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204507"
}
```



---

archive/issue_events_204508.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2013-04-16T14:37:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204508"
}
```



---

archive/issue_comments_174301.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-With #14452 and #14453, the are crashes in libGAP due to a GCC bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n+With #14452 and #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n \n Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.\n``````\n",
    "created_at": "2013-04-16T14:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174301",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-With #14452 and #14453, the are crashes in libGAP due to a GCC bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)
+With #14452 and #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)
 
 Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.
``````




---

archive/issue_comments_174302.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2013-04-16T16:05:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174302",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_events_204509.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204509"
}
```



---

archive/issue_events_204510.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204510"
}
```



---

archive/issue_events_204511.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204511"
}
```



---

archive/issue_events_204512.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204512"
}
```



---

archive/issue_events_204513.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204513"
}
```



---

archive/issue_comments_174303.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2013-04-16T18:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174303",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_174304.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-With #14452 and #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n+\n+libGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.\n \n Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.\n``````\n",
    "created_at": "2013-04-16T18:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174304",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-With #14452 and #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)
+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)
+
+libGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.
 
 Compiling with `-fno-tree-dominator-opts` seems to fix the issue, we should add this flag to compile Cython code with GCC >= 4.8.0.
``````




---

archive/issue_comments_174305.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI guess the plan is to patch Sage again when GCC fixes the problem (hopefully in 4.8.1 and 4.9.?)?",
    "created_at": "2013-04-16T20:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174305",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:5" align="right">comment:5</div>

I guess the plan is to patch Sage again when GCC fixes the problem (hopefully in 4.8.1 and 4.9.?)?



---

archive/issue_comments_174306.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAre we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-) \n\nIn fact, the imho best way is to stick it into the compiler wrapper so that everything (and not just the sage library) gets no-tree-dominator-opts enforced if and only if the gcc version is affected. Though thats a bit of a longer project...\n\nSo, if you want to go on with this bandaid then thats good enough for now.",
    "created_at": "2013-04-16T21:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174306",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-) 

In fact, the imho best way is to stick it into the compiler wrapper so that everything (and not just the sage library) gets no-tree-dominator-opts enforced if and only if the gcc version is affected. Though thats a bit of a longer project...

So, if you want to go on with this bandaid then thats good enough for now.



---

archive/issue_comments_174307.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@vbraun](#comment:6):\n> Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)\n\nWell, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.\n\nAbout this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?",
    "created_at": "2013-04-16T21:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174307",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@vbraun](#comment:6):
> Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)

Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.

About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?



---

archive/issue_comments_174308.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment:7):\n> Replying to [@vbraun](#comment:6):\n> > Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)\n\n> Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.\n> \n> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?\n\nI agree its a saner approach to hope archeologists will limit the GCC versions for which the fix is applied.\nAt worst, it won't be applied when GCC 4.10 gets stable.\n\nGreat you mentioned both the upstream bug and this track ticket in the patch.\nMaybe a direct indication of what the bug is could help, e.g. adding \"which let sig_on() miscompile\" after \"bug\".\nEven without it I'll give it positive_review, when I can reproduce the problem and check its indeed solved with the patch.\n(I assume the space between 'null' and '\"\"\"' is there for ease of reading.)\nFrom #14460, I thought the crash appeared when doctesting sage/structure/element.pyx?\nBut after recompiling libgap, this file, and everything in sage/libs/gap, using gcc-4.8 from debian running \"./sage -t\" on this file is fine.\nYou mention that there are no failing doctests, so I may have missed something.\n\nUsing the code you posted at gcc bugtracker I get\n\n```\n[jp@jp-x220]% cd ../bla                            ~/boulot/sage/sage-5.9.beta5\n[jp@jp-x220]% gcc-4.8 -Og jmp.c                               ~/boulot/sage/bla\n[jp@jp-x220]% ./a.out                                         ~/boulot/sage/bla\nReturning 1\nx = 0, n = 1\nReturning 0\nx = 42, n = 1\nzsh: abort      ./a.out\n```\nSo I guess debian's gcc does not include a magical fix.",
    "created_at": "2013-04-16T22:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174308",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment:7):
> Replying to [@vbraun](#comment:6):
> > Are we going to remember this, or will that just linger around forever until some setup-archaeologist finds it again? I would prefer just to shitlist a particular version, so if it still crashes the next time then we'll know that its not fixed ;-)

> Well, at least it has the necessary pointers to the Sage and GCC bug report, so the setup-archaeologist should be able to determine whether or not the fix is still needed. I find undocumented work-arounds far worse than obsolete work-arounds.
> 
> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?

I agree its a saner approach to hope archeologists will limit the GCC versions for which the fix is applied.
At worst, it won't be applied when GCC 4.10 gets stable.

Great you mentioned both the upstream bug and this track ticket in the patch.
Maybe a direct indication of what the bug is could help, e.g. adding "which let sig_on() miscompile" after "bug".
Even without it I'll give it positive_review, when I can reproduce the problem and check its indeed solved with the patch.
(I assume the space between 'null' and '"""' is there for ease of reading.)
From #14460, I thought the crash appeared when doctesting sage/structure/element.pyx?
But after recompiling libgap, this file, and everything in sage/libs/gap, using gcc-4.8 from debian running "./sage -t" on this file is fine.
You mention that there are no failing doctests, so I may have missed something.

Using the code you posted at gcc bugtracker I get

```
[jp@jp-x220]% cd ../bla                            ~/boulot/sage/sage-5.9.beta5
[jp@jp-x220]% gcc-4.8 -Og jmp.c                               ~/boulot/sage/bla
[jp@jp-x220]% ./a.out                                         ~/boulot/sage/bla
Returning 1
x = 0, n = 1
Returning 0
x = 42, n = 1
zsh: abort      ./a.out
```
So I guess debian's gcc does not include a magical fix.



---

archive/issue_comments_174309.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:7):\n\n> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?\n\nWould it be easily doable to include a doctest that DOES fail in the presence of this bug?",
    "created_at": "2013-04-17T00:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174309",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:7):

> About this particular fix: it doesn't currently give doctest failures. If we only apply this fix for GCC-4.8.0 and GCC-4.8.1 comes out without the bug fix, who will remember to check for this bug?

Would it be easily doable to include a doctest that DOES fail in the presence of this bug?



---

archive/issue_comments_174310.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nbruin](#comment:9):\n> Would it be easily doable to include a doctest that DOES fail in the presence of this bug?\n\nYes, as I mentioned #14453 does that.",
    "created_at": "2013-04-17T06:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174310",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nbruin](#comment:9):
> Would it be easily doable to include a doctest that DOES fail in the presence of this bug?

Yes, as I mentioned #14453 does that.



---

archive/issue_comments_174311.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n-With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)\n+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). The doctest which crashes is\n+\n+```\n+sage: F1 = libgap.FreeGroup(['a']) ## line 427 ## \n+sage: F2 = libgap.FreeGroup(['a']) ## line 428 ## \n+sage: F1 == F2 ## line 429 ## \n+``` \n \n libGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.\n \n``````\n",
    "created_at": "2013-04-17T06:27:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174311",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
-With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982)
+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). The doctest which crashes is
+
+```
+sage: F1 = libgap.FreeGroup(['a']) ## line 427 ## 
+sage: F2 = libgap.FreeGroup(['a']) ## line 428 ## 
+sage: F1 == F2 ## line 429 ## 
+``` 
 
 libGAP is one of the few places in Sage where non-trivial use of the `sig_on()` signal handling is actually tested, so there might be many more places where the problem could occur.
 
``````




---

archive/issue_comments_174312.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jpflori](#comment:8):\n> Maybe a direct indication of what the bug is could help, e.g. adding \"which let sig_on() miscompile\" after \"bug\".\n\nDone.",
    "created_at": "2013-04-17T06:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174312",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jpflori](#comment:8):
> Maybe a direct indication of what the bug is could help, e.g. adding "which let sig_on() miscompile" after "bug".

Done.



---

archive/issue_comments_174313.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment:10):\n> Replying to [@nbruin](#comment:9):\n> > Would it be easily doable to include a doctest that DOES fail in the presence of this bug?\n\n> Yes, as I mentioned #14453 does that.\n\nI meant #14453 in my previous post.\nI'll rebuild the Sage library and retry doctesting sage/libs/gap/element.pyx",
    "created_at": "2013-04-17T07:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174313",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment:10):
> Replying to [@nbruin](#comment:9):
> > Would it be easily doable to include a doctest that DOES fail in the presence of this bug?

> Yes, as I mentioned #14453 does that.

I meant #14453 in my previous post.
I'll rebuild the Sage library and retry doctesting sage/libs/gap/element.pyx



---

archive/issue_comments_174314.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI've rebuilt Sage (5.9.beta5 + #10508) completely using Debian gcc/g++/gfortran 4.8.0 without any env variables except for MAKE, CC, GXX, FC and SAGE_ATLAS_ARCH, then applied #14453, rerun \"./sage -b\", but \"./sage -t devel/sage/sage/libs/gap/element.pyx\" still passes its doctests...\n\nI don't doubt GCC is broken as I can reproduce its buggy behavior on the piece of code you provided, but it would have been nice to confirm the fix indeed fixes potential problems in Sage.\n\nLast minute info: ok I just needed to set CFLAGS=\"-Og\" to reproduce the bug, I guess this should be more explicitely documented.\nIt's stated on the GCC ticket but nowhere on Sage's Trac.",
    "created_at": "2013-04-17T09:51:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174314",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:14" align="right">comment:14</div>

I've rebuilt Sage (5.9.beta5 + #10508) completely using Debian gcc/g++/gfortran 4.8.0 without any env variables except for MAKE, CC, GXX, FC and SAGE_ATLAS_ARCH, then applied #14453, rerun "./sage -b", but "./sage -t devel/sage/sage/libs/gap/element.pyx" still passes its doctests...

I don't doubt GCC is broken as I can reproduce its buggy behavior on the piece of code you provided, but it would have been nice to confirm the fix indeed fixes potential problems in Sage.

Last minute info: ok I just needed to set CFLAGS="-Og" to reproduce the bug, I guess this should be more explicitely documented.
It's stated on the GCC ticket but nowhere on Sage's Trac.



---

archive/issue_comments_174315.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAnd when \"-Og\" is used, then the fix indeed fixes the problem.\n\nSo let's mention \"-Og\" that in the patch as well (let's say in setup.py where the fix is triggered, not sure it will be easy to find near the problematic doctest itself, for that the archeologist will have to come to the trac ticket).",
    "created_at": "2013-04-17T09:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174315",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:15" align="right">comment:15</div>

And when "-Og" is used, then the fix indeed fixes the problem.

So let's mention "-Og" that in the patch as well (let's say in setup.py where the fix is triggered, not sure it will be easy to find near the problematic doctest itself, for that the archeologist will have to come to the trac ticket).



---

archive/issue_events_204514.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T09:55:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204514"
}
```



---

archive/issue_events_204515.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T09:55:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204515"
}
```



---

archive/issue_comments_174316.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). The doctest which crashes is\n+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). If the Sage library is compiled with `-Og`, the following doctest from `sage/libs/gap/element.pyx` crashes with an unhandled SIGABRT:\n \n ```\n sage: F1 = libgap.FreeGroup(['a']) ## line 427 ## \n``````\n",
    "created_at": "2013-04-17T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174316",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). The doctest which crashes is
+With #14453, the are crashes in libGAP due to a GCC-4.8.0 bug: [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=56982). If the Sage library is compiled with `-Og`, the following doctest from `sage/libs/gap/element.pyx` crashes with an unhandled SIGABRT:
 
 ```
 sage: F1 = libgap.FreeGroup(['a']) ## line 427 ## 
``````




---

archive/issue_events_204516.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-17T10:06:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204516"
}
```



---

archive/issue_events_204517.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-17T10:06:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204517"
}
```



---

archive/issue_comments_174317.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[14460_gcc_bug.patch.gz](https://github.com/sagemath/sage/files/ticket14460/14460_gcc_bug.patch.gz)**",
    "created_at": "2013-04-17T10:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174317",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[14460_gcc_bug.patch.gz](https://github.com/sagemath/sage/files/ticket14460/14460_gcc_bug.patch.gz)**



---

archive/issue_events_204518.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T10:09:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204518"
}
```



---

archive/issue_events_204519.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T10:09:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204519"
}
```



---

archive/issue_comments_174318.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2013-04-17T10:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174318",
    "user": "https://github.com/jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_comments_174319.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nBy the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.",
    "created_at": "2013-04-17T10:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174319",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.



---

archive/issue_comments_174320.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment:19):\n> By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.\n\nWell, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?\n\nOn the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\n\n\n\n\nIMHO the scenario is specific enough that it's not worth fixing it within Sage at all (and there's an easy \"work-around\": just add `-fno-tree-dominator-opts` to `CFLAGS` in case it also contains -- not to say \"you added\" --  `-Og` [and GCC is 4.8.0]).\n\nWe do not add a potentially missing `-fno-strict-aliasing` for compiling Cython-generated code (which is a much more common or likely case, and btw. completely independent of the compiler version), nor do we add `-fno-ipa-cp-clone` when building R (with GCC 4.7.x and `-O3`).",
    "created_at": "2013-04-17T22:40:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174320",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment:19):
> By the way, there is lots of activity on the GCC ticket. It seems some variation of this bug is reproducible back to GCC 4.1.

Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?

On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?




IMHO the scenario is specific enough that it's not worth fixing it within Sage at all (and there's an easy "work-around": just add `-fno-tree-dominator-opts` to `CFLAGS` in case it also contains -- not to say "you added" --  `-Og` [and GCC is 4.8.0]).

We do not add a potentially missing `-fno-strict-aliasing` for compiling Cython-generated code (which is a much more common or likely case, and btw. completely independent of the compiler version), nor do we add `-fno-ipa-cp-clone` when building R (with GCC 4.7.x and `-O3`).



---

archive/issue_comments_174321.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@nexttime](#comment:20):\n> On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\n\nGood point.\n\n> nor do we add -fno-ipa-cp-clone when building R (with GCC 4.7.x and -O3).\n\nMaybe we should :) especially that we ship 4.7.x in Sage.",
    "created_at": "2013-04-17T23:38:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174321",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@nexttime](#comment:20):
> On the other hand, if the bug only shows up in conjunction with `-Og` (or maybe `-Os` as well), does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?

Good point.

> nor do we add -fno-ipa-cp-clone when building R (with GCC 4.7.x and -O3).

Maybe we should :) especially that we ship 4.7.x in Sage.



---

archive/issue_comments_174322.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@nexttime](#comment:20):\n> Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?\n\nPerhaps...\n\n> the bug only shows up in conjunction with `-Og`\n\nThis is unfounded speculation.\n\n> does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?\n\nAbsolutely, since we don't know the precise conditions which trigger the bug. As I said, `sig_on()` error handling is rarely doctested, so we cannot rely on doctests to check for this bug.",
    "created_at": "2013-04-18T06:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174322",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@nexttime](#comment:20):
> Well, if that's true, are you sure same or similar can't happen within the Sage library with GCC versions != 4.![89]*?

Perhaps...

> the bug only shows up in conjunction with `-Og`

This is unfounded speculation.

> does it make sense to add `-fno-tree-dominator-opts` regardless of the setting of `CFLAGS` etc., and for every extension module?

Absolutely, since we don't know the precise conditions which trigger the bug. As I said, `sig_on()` error handling is rarely doctested, so we cannot rely on doctests to check for this bug.



---

archive/issue_comments_174323.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSo, what is your opinion on adding `-fno-dominator-opts` for all GCC versions >= 4.1?",
    "created_at": "2013-04-18T07:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174323",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

So, what is your opinion on adding `-fno-dominator-opts` for all GCC versions >= 4.1?



---

archive/issue_comments_174324.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment:22):\n> Replying to [@nexttime](#comment:20):\n> > the bug only shows up in conjunction with `-Og`\n\n> This is unfounded speculation.\n\nBesides that I wrote *\"if ...\"*, it's as \"founded\" as the conclusion that (solely) adding `-fno-tree-dominator-opts` solves the issue.",
    "created_at": "2013-04-18T11:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174324",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment:22):
> Replying to [@nexttime](#comment:20):
> > the bug only shows up in conjunction with `-Og`

> This is unfounded speculation.

Besides that I wrote *"if ..."*, it's as "founded" as the conclusion that (solely) adding `-fno-tree-dominator-opts` solves the issue.



---

archive/issue_comments_174325.json:
```json
{
    "body": "Merged: **sage-5.9.rc0**",
    "created_at": "2013-04-19T13:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174325",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.rc0**



---

archive/issue_comments_174326.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2013-04-19T13:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174326",
    "user": "https://github.com/jdemeyer"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_events_204520.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-19T13:53:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204520"
}
```



---

archive/issue_events_204521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-19T13:53:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14460#event-204521"
}
```



---

archive/issue_comments_174327.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nBug still exists in GCC-4.8.1.",
    "created_at": "2013-05-31T11:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174327",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Bug still exists in GCC-4.8.1.



---

archive/issue_comments_174328.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nToo bad.\n\nI was thinking about this and must admit Volker had a point.\nWe unconditionnally pass \"-fno-...\" whereas without further tweaking gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\nOf course according to Jeroen we don't really know (or do we now?) what options trigger the miscompile, so it is the safest choice to always pass \"-fno-...\".\n\nBut then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\n\n(By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)",
    "created_at": "2013-05-31T11:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174328",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:27" align="right">comment:27</div>

Too bad.

I was thinking about this and must admit Volker had a point.
We unconditionnally pass "-fno-..." whereas without further tweaking gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.
Of course according to Jeroen we don't really know (or do we now?) what options trigger the miscompile, so it is the safest choice to always pass "-fno-...".

But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...

(By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)



---

archive/issue_comments_174329.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jpflori](#comment:27):\n> gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\n\nSame answer as I made before: what makes you think that this is true?\n\n> But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\n\nI never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.\n\n> (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)\n\nAt least, the flags added by Sage come at the very end of the command line.",
    "created_at": "2013-05-31T12:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174329",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jpflori](#comment:27):
> gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.

Same answer as I made before: what makes you think that this is true?

> But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...

I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.

> (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)

At least, the flags added by Sage come at the very end of the command line.



---

archive/issue_comments_174330.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment:28):\n> Replying to [@jpflori](#comment:27):\n> > gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.\n\n> Same answer as I made before: what makes you think that this is true?\n\nOr that it is not true?\nFrom your report it seemed you got segfaults only when passing\n> \n> > But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...\n\n> I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.\n\nI agree, I only posted all of this here so that I don't lose it in my mind.\n> \n> > (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)\n\n> At least, the flags added by Sage come at the very end of the command line.\n\nNot really sure, I had a really painful experience lately building Python on a Raspberry Pi.\nDoing something like \"CFLAGS=\"-O -g\" ./sage -i python.spkg\" does not work.\nDoing \"OPT= CFLAG=\"-O -g\" ...\" would work.\nLook at configure.ac and Makefile.pre.in, the only thing that comes in $CFLAGS after $OPT is $EXTRA_CFLAGS (which is surely meant to be mostly user defined).\nAnyway it's not really the place to discuss this.",
    "created_at": "2013-05-31T12:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174330",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment:28):
> Replying to [@jpflori](#comment:27):
> > gcc 4.8.0 (and so 4.8.1 as well) correctly compiles sig_on statements.

> Same answer as I made before: what makes you think that this is true?

Or that it is not true?
From your report it seemed you got segfaults only when passing
> 
> > But then why not treat cases where -O3 is passed to CFLAGS and R miscompiles and so on...

> I never said we shouldn't fix that. But this is a less serious issue, since `-fipa-cp-clone` is not added by the default R flags of `-O2`. Assuming the user does not use custom `CFLAGS`, adding `-fno-ipa-cp-clone` will not make a difference.

I agree, I only posted all of this here so that I don't lose it in my mind.
> 
> > (By the way I've remarked that Python has the bad habit to override CFLAGS by adding the content of an OPT variable on the compile command line...)

> At least, the flags added by Sage come at the very end of the command line.

Not really sure, I had a really painful experience lately building Python on a Raspberry Pi.
Doing something like "CFLAGS="-O -g" ./sage -i python.spkg" does not work.
Doing "OPT= CFLAG="-O -g" ..." would work.
Look at configure.ac and Makefile.pre.in, the only thing that comes in $CFLAGS after $OPT is $EXTRA_CFLAGS (which is surely meant to be mostly user defined).
Anyway it's not really the place to discuss this.



---

archive/issue_comments_174331.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jpflori](#comment:29):\n> Or that it is not true?\n\nThe principle of being on the safe side means that, in the case of doubt, assume something can go wrong.\n\n> From your report it seemed you got segfaults only when passing\n\n...the `-Og` flag. (I guess this is what you wanted to write).\n\nAnd that's even true: the particular segfault in libGAP only occurs with `-Og`. But there could very well be other segfaults, not found by doctests, in other parts of Sage, with the default flags.",
    "created_at": "2013-05-31T12:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174331",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jpflori](#comment:29):
> Or that it is not true?

The principle of being on the safe side means that, in the case of doubt, assume something can go wrong.

> From your report it seemed you got segfaults only when passing

...the `-Og` flag. (I guess this is what you wanted to write).

And that's even true: the particular segfault in libGAP only occurs with `-Og`. But there could very well be other segfaults, not found by doctests, in other parts of Sage, with the default flags.



---

archive/issue_comments_174332.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nLet me copy this sentence from the ticket description:\n\nlibGAP is one of the few places in Sage where non-trivial use of the sig_on() signal handling is actually tested, so there might be many more places where the problem could occur.",
    "created_at": "2013-05-31T12:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174332",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Let me copy this sentence from the ticket description:

libGAP is one of the few places in Sage where non-trivial use of the sig_on() signal handling is actually tested, so there might be many more places where the problem could occur.



---

archive/issue_comments_174333.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nYeah I agree, no harm meant at all.\n\nThe best solution would be to live in a world where GCC never exposes bugs.\nAnd as I've said before, I'm ok with the solution which was merged, I even gave positive_review, I just hope the situation would be better.\nAt some point we'll have to rule out all versions of GCC :)",
    "created_at": "2013-05-31T12:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14460#issuecomment-174333",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:32" align="right">comment:32</div>

Yeah I agree, no harm meant at all.

The best solution would be to live in a world where GCC never exposes bugs.
And as I've said before, I'm ok with the solution which was merged, I even gave positive_review, I just hope the situation would be better.
At some point we'll have to rule out all versions of GCC :)
