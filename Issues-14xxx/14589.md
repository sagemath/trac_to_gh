# Issue 14589: binary matrices, dense graphs, and faster is_strongly_regular

archive/issues_014385.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  @lobiCode stefan azi @dimpase\n\nAs the title says !!\n\nWith the patch applied \n\n```\nsage: g = graphs.PaleyGraph(primes_first_n(70)[-1])\nsage: %time g.is_strongly_regular()\nCPU times: user 0.16 s, sys: 0.00 s, total: 0.16 s\nWall time: 0.16 s\nTrue\n```\n\nWithout it\n\n```\nsage: g = graphs.PaleyGraph(primes_first_n(70)[-1])\nsage: %time g.is_strongly_regular()\nCPU times: user 20.43 s, sys: 0.00 s, total: 20.43 s\nWall time: 20.44 s\nTrue\n```\n\nAhhhh.. It is so nice to implement an algorithm with the right data structure ! `:-P`\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/14589\n\n",
    "closed_at": "2014-01-20T23:52:25Z",
    "created_at": "2013-05-15T10:22:21Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "binary matrices, dense graphs, and faster is_strongly_regular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14589",
    "user": "https://github.com/nathanncohen"
}
```
Assignee: jason, ncohen, rlm

CC:  @lobiCode stefan azi @dimpase

As the title says !!

With the patch applied 

```
sage: g = graphs.PaleyGraph(primes_first_n(70)[-1])
sage: %time g.is_strongly_regular()
CPU times: user 0.16 s, sys: 0.00 s, total: 0.16 s
Wall time: 0.16 s
True
```

Without it

```
sage: g = graphs.PaleyGraph(primes_first_n(70)[-1])
sage: %time g.is_strongly_regular()
CPU times: user 20.43 s, sys: 0.00 s, total: 20.43 s
Wall time: 20.44 s
True
```

Ahhhh.. It is so nice to implement an algorithm with the right data structure ! `:-P`

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/14589





---

archive/issue_comments_181514.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-15T10:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181514",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_181515.json:
```json
{
    "body": "how about (complements of) disjoint unions of complete graphs with the same number of vertices? Are they s.r.g. for you?",
    "created_at": "2013-05-16T02:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181515",
    "user": "https://github.com/dimpase"
}
```

how about (complements of) disjoint unions of complete graphs with the same number of vertices? Are they s.r.g. for you?



---

archive/issue_comments_181516.json:
```json
{
    "body": "Well, to me even a complete graph is strongly regular. We just had a discussion on Mathematical Dogma there : #14297. What do you think ?\n\nIn this case, as there are non-adjacent vertices, I'd say that the graph is strongly regular.... Dogma `:-P`\n\nNathann",
    "created_at": "2013-05-16T09:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181516",
    "user": "https://github.com/nathanncohen"
}
```

Well, to me even a complete graph is strongly regular. We just had a discussion on Mathematical Dogma there : #14297. What do you think ?

In this case, as there are non-adjacent vertices, I'd say that the graph is strongly regular.... Dogma `:-P`

Nathann



---

archive/issue_comments_181517.json:
```json
{
    "body": "Nathann,\n\nI think it would make much sense to test the \"is_triangle_free\" thing with this data structure as well. It should be much more efficient using the same approach.",
    "created_at": "2013-05-19T07:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181517",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Nathann,

I think it would make much sense to test the "is_triangle_free" thing with this data structure as well. It should be much more efficient using the same approach.



---

archive/issue_comments_181518.json:
```json
{
    "body": "> I think it would make much sense to test the \"is_triangle_free\" thing with this data structure as well. It should be much more efficient using the same approach.\n\n\nI don't know which kind of speedup we can expect, but that's definitely something  that should be implemented, if only to run that test `:-)`\n\nCould we make this another ticket ? Then you can implement it or I will, it's up to you !\n\nNathann",
    "created_at": "2013-05-19T08:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181518",
    "user": "https://github.com/nathanncohen"
}
```

> I think it would make much sense to test the "is_triangle_free" thing with this data structure as well. It should be much more efficient using the same approach.


I don't know which kind of speedup we can expect, but that's definitely something  that should be implemented, if only to run that test `:-)`

Could we make this another ticket ? Then you can implement it or I will, it's up to you !

Nathann



---

archive/issue_comments_181519.json:
```json
{
    "body": "Sure I'll make make a ticket soon",
    "created_at": "2013-05-19T08:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181519",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Sure I'll make make a ticket soon



---

archive/issue_comments_181520.json:
```json
{
    "body": "Hmmm. I wonder how much of the speedup remains if you use a GF(2)-matrix or integer matrix instead of the bitset matrix. You're only doing get and set, and I'd say the real power of these bitset-matrices lies in row operations. You could use Sage's get_unsafe and set_unsafe to bypass range checking. It'll be slower than inline methods, but maybe not by much.",
    "created_at": "2013-05-19T12:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181520",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Hmmm. I wonder how much of the speedup remains if you use a GF(2)-matrix or integer matrix instead of the bitset matrix. You're only doing get and set, and I'd say the real power of these bitset-matrices lies in row operations. You could use Sage's get_unsafe and set_unsafe to bypass range checking. It'll be slower than inline methods, but maybe not by much.



---

archive/issue_comments_181521.json:
```json
{
    "body": "Hello,\n\nI am a bit naive but would like to understand the following\n* **pxi against C** why do you use a pxi file ? It would cause multiple compilation wherever it is included. I think a pure C file would be much more suited to that purpose (I know that this is the way it is for bitset)\n* **mutability** why don't you mimic what is done for `DenseGraph` to allow mutability (ie having a bitset of active vertices that allow to use any subset of 0, ..., n-1 as vertices). Virtually there will be the good number of vertices but in backend you treat your graph with many isolated vertices. Augmenting the number of vertices may then be done with realloc.\n* **sparse graphs** What do we do with current implementation of `SparseGraph` ?",
    "created_at": "2013-06-05T11:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181521",
    "user": "https://github.com/videlec"
}
```

Hello,

I am a bit naive but would like to understand the following
* **pxi against C** why do you use a pxi file ? It would cause multiple compilation wherever it is included. I think a pure C file would be much more suited to that purpose (I know that this is the way it is for bitset)
* **mutability** why don't you mimic what is done for `DenseGraph` to allow mutability (ie having a bitset of active vertices that allow to use any subset of 0, ..., n-1 as vertices). Virtually there will be the good number of vertices but in backend you treat your graph with many isolated vertices. Augmenting the number of vertices may then be done with realloc.
* **sparse graphs** What do we do with current implementation of `SparseGraph` ?



---

archive/issue_comments_181522.json:
```json
{
    "body": "Hellooooooo !\n\n> I am a bit naive but would like to understand the following\n> * **pxi against C** why do you use a pxi file ? \n\n\nIf you compile the file independently then the functions cannot be inlined.\n\n>  * **mutability** why don't you mimic what is done for `DenseGraph` to allow mutability (ie having a bitset of active vertices that allow to use any subset of 0, ..., n-1 as vertices). Virtually there will be the good number of vertices but in backend you treat your graph with many isolated vertices. Augmenting the number of vertices may then be done with realloc.\n\n\nBecause I want to write simple things. It is not meant to replace a real graph backend, and it will probably be used later on by the future dense backend, but I would really like to have a simple structure somewhere, that does nothing but store bits.\n\n>  * **sparse graphs** What do we do with current implementation of `SparseGraph` ?\n\n\nWell, first I will have to read your patch #14690. Then, each time we read this file it would be nice to add comments to it, to explain the parts of it that we have understood. Then we can do whatever we want with this backend : rewrite it or improve it if we can. We can't really throw it out right now, can we ? `:-P`\n\nNathann",
    "created_at": "2013-06-05T12:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181522",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo !

> I am a bit naive but would like to understand the following
> * **pxi against C** why do you use a pxi file ? 


If you compile the file independently then the functions cannot be inlined.

>  * **mutability** why don't you mimic what is done for `DenseGraph` to allow mutability (ie having a bitset of active vertices that allow to use any subset of 0, ..., n-1 as vertices). Virtually there will be the good number of vertices but in backend you treat your graph with many isolated vertices. Augmenting the number of vertices may then be done with realloc.


Because I want to write simple things. It is not meant to replace a real graph backend, and it will probably be used later on by the future dense backend, but I would really like to have a simple structure somewhere, that does nothing but store bits.

>  * **sparse graphs** What do we do with current implementation of `SparseGraph` ?


Well, first I will have to read your patch #14690. Then, each time we read this file it would be nice to add comments to it, to explain the parts of it that we have understood. Then we can do whatever we want with this backend : rewrite it or improve it if we can. We can't really throw it out right now, can we ? `:-P`

Nathann



---

archive/issue_comments_181523.json:
```json
{
    "body": "Attachment [trac_14589.patch](tarball://root/attachments/some-uuid/ticket14589/trac_14589.patch) by @nathanncohen created at 2013-07-03 16:47:15",
    "created_at": "2013-07-03T16:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181523",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_14589.patch](tarball://root/attachments/some-uuid/ticket14589/trac_14589.patch) by @nathanncohen created at 2013-07-03 16:47:15



---

archive/issue_events_041560.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14589#event-41560"
}
```



---

archive/issue_comments_181524.json:
```json
{
    "body": "Thanks for doing this.  Often the first thing I do is to convert the graph to an array of bitsets and then work with that.  I do this a lot in the minimum rank library, for example: https://github.com/jasongrout/minimum_rank/blob/master/zero_forcing_wavefront.pyx#L124\n\nNext time I write some code like this, I'll have to look at this implementation.  When I get some time to do research coding work, if this hasn't been reviewed, I'll have to review this!",
    "created_at": "2013-09-02T16:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181524",
    "user": "https://github.com/jasongrout"
}
```

Thanks for doing this.  Often the first thing I do is to convert the graph to an array of bitsets and then work with that.  I do this a lot in the minimum rank library, for example: https://github.com/jasongrout/minimum_rank/blob/master/zero_forcing_wavefront.pyx#L124

Next time I write some code like this, I'll have to look at this implementation.  When I get some time to do research coding work, if this hasn't been reviewed, I'll have to review this!



---

archive/issue_comments_181525.json:
```json
{
    "body": "Hello!\n\nAs promised I took the time to review your patch. The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?\n\nAnyways, before giving another check let me ask\n\n1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?\n\n2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?\n\n3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0\n\nAlso off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?",
    "created_at": "2014-01-08T21:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181525",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Hello!

As promised I took the time to review your patch. The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?

Anyways, before giving another check let me ask

1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?

2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?

3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0

Also off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?



---

archive/issue_comments_181526.json:
```json
{
    "body": "Yooooooo !\n\n> As promised I took the time to review your patch.\n\n\nThaaaaaaaaaaanks !! `;-)`\n\n> The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?\n\n\nThe \"someone else with do it\" syndrome. And the fact that with git the developpers as a whole probably suffered a loss of enthusiasm `:-P`\n\n> 1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?\n\n\nUnfortunately I think we can. Though I try not to rely on that. Did I do it in this patch ?\n\nThe problem is that while the vertices are indeed \"sorted\" before being returned, but that this sorting can be meaningless : the \"natural\" ordering on the vertices may be a partial ordering from time to time (i.e. when the vertices are set : `graphs.KneserGraph`) and well, that causes bugs from time to time.\n\n> 2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?\n\n\nNo, because only `m.rows[0]` is allocated on line 39. All of `m.rows[i]` point toward some part of this very long vector, but regardless of that if you deallocate `m.rows[0]` the whole segment is deallocated.\n\n> 3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0\n\n\nOh. Right `:-PPPPPPPPP`\n\n> Also off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?\n\n\n`T_T`\n\nI hate labels. And I also type `.edges(labels=False)` much more often than `.edges()`. Well. I didn't try to change this kind of stuff because I consider that it is just \"my own use of graphs\"... But well, if many of us begin to hate labels/loops/multiple edges now that's a different story `:-P`\nThe combinat/word guys may probably not agree, though... But really, I have no idea. I just never did that because I don't want to change stuff just because it makes it easier for me, without knowing how useful it can be for others.\n\nNathann",
    "created_at": "2014-01-09T08:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181526",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooo !

> As promised I took the time to review your patch.


Thaaaaaaaaaaanks !! `;-)`

> The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?


The "someone else with do it" syndrome. And the fact that with git the developpers as a whole probably suffered a loss of enthusiasm `:-P`

> 1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?


Unfortunately I think we can. Though I try not to rely on that. Did I do it in this patch ?

The problem is that while the vertices are indeed "sorted" before being returned, but that this sorting can be meaningless : the "natural" ordering on the vertices may be a partial ordering from time to time (i.e. when the vertices are set : `graphs.KneserGraph`) and well, that causes bugs from time to time.

> 2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?


No, because only `m.rows[0]` is allocated on line 39. All of `m.rows[i]` point toward some part of this very long vector, but regardless of that if you deallocate `m.rows[0]` the whole segment is deallocated.

> 3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0


Oh. Right `:-PPPPPPPPP`

> Also off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?


`T_T`

I hate labels. And I also type `.edges(labels=False)` much more often than `.edges()`. Well. I didn't try to change this kind of stuff because I consider that it is just "my own use of graphs"... But well, if many of us begin to hate labels/loops/multiple edges now that's a different story `:-P`
The combinat/word guys may probably not agree, though... But really, I have no idea. I just never did that because I don't want to change stuff just because it makes it easier for me, without knowing how useful it can be for others.

Nathann



---

archive/issue_comments_181527.json:
```json
{
    "body": "Rebased. As a git branch.\n\nNathann",
    "created_at": "2014-01-09T10:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181527",
    "user": "https://github.com/nathanncohen"
}
```

Rebased. As a git branch.

Nathann



---

archive/issue_comments_181528.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-09T10:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181528",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_181529.json:
```json
{
    "body": "Hmmmm.. bitset.pyx has been renamed since `:-P`\n\nAnd actually.. We don't need it.\n\nNathann",
    "created_at": "2014-01-09T10:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181529",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmm.. bitset.pyx has been renamed since `:-P`

And actually.. We don't need it.

Nathann



---

archive/issue_comments_181530.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-09T10:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_181531.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> Yooooooo !\n> \n> > As promised I took the time to review your patch.\n\n> \n> Thaaaaaaaaaaanks !! `;-)`\n> \n> > The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?\n\n> \n> The \"someone else with do it\" syndrome. And the fact that with git the developpers as a whole probably suffered a loss of enthusiasm `:-P`\n> \n> > 1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?\n  \n> \n> Unfortunately I think we can. Though I try not to rely on that. Did I do it in this patch ?\n\nYes didn't you?\n> \n> The problem is that while the vertices are indeed \"sorted\" before being returned, but that this sorting can be meaningless : the \"natural\" ordering on the vertices may be a partial ordering from time to time (i.e. when the vertices are set : `graphs.KneserGraph`) and well, that causes bugs from time to time.\n> \n> > 2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?\n  \n> \n> No, because only `m.rows[0]` is allocated on line 39. All of `m.rows[i]` point toward some part of this very long vector, but regardless of that if you deallocate `m.rows[0]` the whole segment is deallocated. \n\nRight! I completely misread something somewhere. \n> \n> > 3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0\n  \n> \n> Oh. Right `:-PPPPPPPPP`\n> \n> > Also off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?\n\n> \n> `T_T`\n> \n> I hate labels. And I also type `.edges(labels=False)` much more often than `.edges()`. Well. I didn't try to change this kind of stuff because I consider that it is just \"my own use of graphs\"... But well, if many of us begin to hate labels/loops/multiple edges now that's a different story `:-P`\n> The combinat/word guys may probably not agree, though... But really, I have no idea. I just never did that because I don't want to change stuff just because it makes it easier for me, without knowing how useful it can be for others.\n\n\nFor me they are veeeery annoying so I assumed they were for everyone .\n\nAnyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)\n\nBest,\n\nJernej\n> \n> Nathann",
    "created_at": "2014-01-09T18:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181531",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Replying to [comment:15 ncohen]:
> Yooooooo !
> 
> > As promised I took the time to review your patch.

> 
> Thaaaaaaaaaaanks !! `;-)`
> 
> > The entire thing is easy to read and looks good. The fact that it was not reviewed for so long makes me wonder if I am overlooking some non obvious caveat?

> 
> The "someone else with do it" syndrome. And the fact that with git the developpers as a whole probably suffered a loss of enthusiasm `:-P`
> 
> > 1. Line 67 - can we always assume that g.vertices() will return a sorted list of vertices? Also, it looks like this can be written in a better way?
  
> 
> Unfortunately I think we can. Though I try not to rely on that. Did I do it in this patch ?

Yes didn't you?
> 
> The problem is that while the vertices are indeed "sorted" before being returned, but that this sorting can be meaningless : the "natural" ordering on the vertices may be a partial ordering from time to time (i.e. when the vertices are set : `graphs.KneserGraph`) and well, that causes bugs from time to time.
> 
> > 2. Line 48 function inline binary_matrix_free. Shouldn't you free m.rows[1],...,m.rows[n_rows] as well?
  
> 
> No, because only `m.rows[0]` is allocated on line 39. All of `m.rows[i]` point toward some part of this very long vector, but regardless of that if you deallocate `m.rows[0]` the whole segment is deallocated. 

Right! I completely misread something somewhere. 
> 
> > 3. Line 69 in inline binary_matrix_set0 the comment should really say set matrix entry to 0
  
> 
> Oh. Right `:-PPPPPPPPP`
> 
> > Also off topic to this patch - am I the only one being tempted to change the function edges() and set edge_labels to false as default?

> 
> `T_T`
> 
> I hate labels. And I also type `.edges(labels=False)` much more often than `.edges()`. Well. I didn't try to change this kind of stuff because I consider that it is just "my own use of graphs"... But well, if many of us begin to hate labels/loops/multiple edges now that's a different story `:-P`
> The combinat/word guys may probably not agree, though... But really, I have no idea. I just never did that because I don't want to change stuff just because it makes it easier for me, without knowing how useful it can be for others.


For me they are veeeery annoying so I assumed they were for everyone .

Anyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)

Best,

Jernej
> 
> Nathann



---

archive/issue_comments_181532.json:
```json
{
    "body": "> Yes didn't you?\n\n\nWell if I did I do not remember where `:-P`\n\n> For me they are veeeery annoying so I assumed they were for everyone.\n\n\nHmmmm.. It is true that a graph is a collection of pairs, and that you always have to explain \"what the hell all these `None` are\" when you show the result of `g.edges()` to beginners... `:-/`\n\n> Anyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)\n\n\nWell the patchbot complains but the two errors seem unrelated.\n\nNathann",
    "created_at": "2014-01-09T21:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181532",
    "user": "https://github.com/nathanncohen"
}
```

> Yes didn't you?


Well if I did I do not remember where `:-P`

> For me they are veeeery annoying so I assumed they were for everyone.


Hmmmm.. It is true that a graph is a collection of pairs, and that you always have to explain "what the hell all these `None` are" when you show the result of `g.edges()` to beginners... `:-/`

> Anyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)


Well the patchbot complains but the two errors seem unrelated.

Nathann



---

archive/issue_comments_181533.json:
```json
{
    "body": "Replying to [comment:21 ncohen]:\n> > Yes didn't you?\n\n> \n> Well if I did I do not remember where `:-P`\n\nLine 67. g.vertices() == range(n)\n\n> \n> > For me they are veeeery annoying so I assumed they were for everyone.\n\n> \n> Hmmmm.. It is true that a graph is a collection of pairs, and that you always have to explain \"what the hell all these `None` are\" when you show the result of `g.edges()` to beginners... `:-/`\n> \n> > Anyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)\n\n> \n> Well the patchbot complains but the two errors seem unrelated.\n> \n> Nathann",
    "created_at": "2014-01-09T21:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181533",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Replying to [comment:21 ncohen]:
> > Yes didn't you?

> 
> Well if I did I do not remember where `:-P`

Line 67. g.vertices() == range(n)

> 
> > For me they are veeeery annoying so I assumed they were for everyone.

> 
> Hmmmm.. It is true that a graph is a collection of pairs, and that you always have to explain "what the hell all these `None` are" when you show the result of `g.edges()` to beginners... `:-/`
> 
> > Anyways, this is all I got to say about the patch. It looks good to me provided u changed the above things and ran the doctests (which I did not)

> 
> Well the patchbot complains but the two errors seem unrelated.
> 
> Nathann



---

archive/issue_comments_181534.json:
```json
{
    "body": "Hellooo !\n\n> Line 67. g.vertices() == range(n)\n\n\nOh, right. But in this case the vertices are integers. It indeed relies on the fact that vertices are sorted (and they are), but there is no problem if the natural order on the vertices is not total. The equality will be false in that case.\n\nNathann",
    "created_at": "2014-01-09T21:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181534",
    "user": "https://github.com/nathanncohen"
}
```

Hellooo !

> Line 67. g.vertices() == range(n)


Oh, right. But in this case the vertices are integers. It indeed relies on the fact that vertices are sorted (and they are), but there is no problem if the natural order on the vertices is not total. The equality will be false in that case.

Nathann



---

archive/issue_comments_181535.json:
```json
{
    "body": "I see. Well if you feel safe about that (the documentation afaik does not guarantee sorted order of vertices) then this thing is fine with me.",
    "created_at": "2014-01-09T21:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181535",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

I see. Well if you feel safe about that (the documentation afaik does not guarantee sorted order of vertices) then this thing is fine with me.



---

archive/issue_comments_181536.json:
```json
{
    "body": "Hmmmmmm... Well, we can re-sort it but I think it's overkill. If that ever changes we will have to look at all occurrences of `g.vertices()` anyway... And I really think that this isn't going to happen anytime soon `O_o`\n\nNathann",
    "created_at": "2014-01-09T21:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181536",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmmmm... Well, we can re-sort it but I think it's overkill. If that ever changes we will have to look at all occurrences of `g.vertices()` anyway... And I really think that this isn't going to happen anytime soon `O_o`

Nathann



---

archive/issue_comments_181537.json:
```json
{
    "body": "Indeed. Of course there is the stupid, thing of checking that the sum is n(n+1)/2 but I think that looks even more weird in this context?",
    "created_at": "2014-01-09T21:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181537",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Indeed. Of course there is the stupid, thing of checking that the sum is n(n+1)/2 but I think that looks even more weird in this context?



---

archive/issue_comments_181538.json:
```json
{
    "body": "> Indeed. Of course there is the stupid, thing of checking that the sum is n(n+1)/2 but I think that looks even more weird in this context?\n\n\n`O_o`\n\nInstead of that test, you mean ?\n\nWell, we have no way to be sure that the vertices CAN be summed. I mean, this test is meant to check whether there is any need to store a label_to_int dictionary. If the vertices are 0...n-1 there is no need and so we do without. But if the vertices are... I don't know, anything ! Strings, Sets, partitions, tuples.. immutables graphs ? Well in that case we remember labels. And we cannot be sure that those can all be summed together.\n\nNathann",
    "created_at": "2014-01-09T21:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181538",
    "user": "https://github.com/nathanncohen"
}
```

> Indeed. Of course there is the stupid, thing of checking that the sum is n(n+1)/2 but I think that looks even more weird in this context?


`O_o`

Instead of that test, you mean ?

Well, we have no way to be sure that the vertices CAN be summed. I mean, this test is meant to check whether there is any need to store a label_to_int dictionary. If the vertices are 0...n-1 there is no need and so we do without. But if the vertices are... I don't know, anything ! Strings, Sets, partitions, tuples.. immutables graphs ? Well in that case we remember labels. And we cannot be sure that those can all be summed together.

Nathann



---

archive/issue_comments_181539.json:
```json
{
    "body": "Yes sure! That's what I said its stupid cause you also have to make sure every element is actually an int. \n\nAs said this was more of a stupid comment than anything else, as far as I am concerned the patch is good to go!",
    "created_at": "2014-01-09T21:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181539",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Yes sure! That's what I said its stupid cause you also have to make sure every element is actually an int. 

As said this was more of a stupid comment than anything else, as far as I am concerned the patch is good to go!



---

archive/issue_comments_181540.json:
```json
{
    "body": "Sooooooooooooooo positive review ?... `:-P`\n\nNathann",
    "created_at": "2014-01-09T21:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181540",
    "user": "https://github.com/nathanncohen"
}
```

Sooooooooooooooo positive review ?... `:-P`

Nathann



---

archive/issue_comments_181541.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-09T21:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181541",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_181542.json:
```json
{
    "body": "Thaaaaaaaaaaanks !\n\nAt long last, I can test if a graph is strongly regular without fearing it might hang on forever `:-P`\n\nNathann",
    "created_at": "2014-01-09T21:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181542",
    "user": "https://github.com/nathanncohen"
}
```

Thaaaaaaaaaaanks !

At long last, I can test if a graph is strongly regular without fearing it might hang on forever `:-P`

Nathann



---

archive/issue_comments_181543.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-20T23:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14589#issuecomment-181543",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_041561.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-20T23:52:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14589",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14589#event-41561"
}
```
