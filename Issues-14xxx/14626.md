# Issue 14626: Docbuilder hangs if latex fails

archive/issues_014422.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nWhen building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever *after building all documentation*. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:\n\n```\n! LaTeX Error: Too deeply nested.\n\nSee the LaTeX manual or LaTeX Companion for explanation.\nType  H <return>  for immediate help.\n ...                                              \n                                                  \nl.27819 \\begin{Verbatim}[commandchars=\\\\\\{\\}]\n                                             \n? \n! Emergency stop.\n ...                                              \n                                                  \nl.27819 \\begin{Verbatim}[commandchars=\\\\\\{\\}]\n                                             \n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on categories.log.\nmake[1]: *** [categories.pdf] Error 1\nmake[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'\nException in thread Thread-6:\nTraceback (most recent call last):\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py\", line 810, in __bootstrap_inner\n    self.run()\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py\", line 763, in run\n    self.__target(*self.__args, **self.__kwargs)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 376, in _handle_results\n    task = get()\nTypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())\n```\n\nThis hang is [http://bugs.python.org/issue9400](http://bugs.python.org/issue9400)\n\nAlso: the docbuilder should use $MAKE instead of make. \n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nCC:  @jhpalmieri @nexttime\n\nComponent: **documentation**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-5.10.beta5**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14626_\n\n",
    "closed_at": "2013-05-24T20:15:29Z",
    "created_at": "2013-05-22T15:07:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Docbuilder hangs if latex fails",
    "type": "issue",
    "updated_at": "2013-05-27T11:35:11Z",
    "url": "https://github.com/sagemath/sage/issues/14626",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

When building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever *after building all documentation*. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:

```
! LaTeX Error: Too deeply nested.

See the LaTeX manual or LaTeX Companion for explanation.
Type  H <return>  for immediate help.
 ...                                              
                                                  
l.27819 \begin{Verbatim}[commandchars=\\\{\}]
                                             
? 
! Emergency stop.
 ...                                              
                                                  
l.27819 \begin{Verbatim}[commandchars=\\\{\}]
                                             
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on categories.log.
make[1]: *** [categories.pdf] Error 1
make[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'
Exception in thread Thread-6:
Traceback (most recent call last):
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py", line 810, in __bootstrap_inner
    self.run()
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py", line 763, in run
    self.__target(*self.__args, **self.__kwargs)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 376, in _handle_results
    task = get()
TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())
```

This hang is [http://bugs.python.org/issue9400](http://bugs.python.org/issue9400)

Also: the docbuilder should use $MAKE instead of make. 

Upstream: **Reported upstream. Developers acknowledge bug.**

CC:  @jhpalmieri @nexttime

Component: **documentation**

Author: **Jeroen Demeyer**

Reviewer: **John Palmieri**

Merged: **sage-5.10.beta5**

_Issue created by migration from https://trac.sagemath.org/ticket/14626_





---

archive/issue_events_205232.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T15:07:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205232"
}
```



---

archive/issue_events_205233.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T15:07:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205233"
}
```



---

archive/issue_events_205234.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T15:07:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205234"
}
```



---

archive/issue_events_205235.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T15:07:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205235"
}
```



---

archive/issue_events_205236.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2013-05-22T15:07:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205236"
}
```



---

archive/issue_comments_177413.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,5 @@\n Transcript written on categories.log.\n )make[1]: *** [categories.pdf] Error 1\n ```\n+\n+Also: the docbuilder should use `$MAKE` instead of `make`.\n``````\n",
    "created_at": "2013-05-22T15:10:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177413",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,5 @@
 Transcript written on categories.log.
 )make[1]: *** [categories.pdf] Error 1
 ```
+
+Also: the docbuilder should use `$MAKE` instead of `make`.
``````




---

archive/issue_comments_177414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-When building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:\n+When building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever *after building all documentation*. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:\n \n ```\n ! LaTeX Error: Too deeply nested.\n@@ -10,9 +10,6 @@\n l.27819 \\begin{Verbatim}[commandchars=\\\\\\{\\}]\n                                              \n ? \n-Implicit mode ON; LaTeX internals redefined\n-(/usr/share/texmf-texlive/tex/latex/ltxmisc/url.sty\n-(/usr/share/texmf-texlive/tex/latex/base/t1enc.def)\n ! Emergency stop.\n  ...                                              \n                                                   \n@@ -20,7 +17,19 @@\n                                              \n !  ==> Fatal error occurred, no output PDF file produced!\n Transcript written on categories.log.\n-)make[1]: *** [categories.pdf] Error 1\n+make[1]: *** [categories.pdf] Error 1\n+make[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'\n+Exception in thread Thread-6:\n+Traceback (most recent call last):\n+  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py\", line 810, in __bootstrap_inner\n+    self.run()\n+  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py\", line 763, in run\n+    self.__target(*self.__args, **self.__kwargs)\n+  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 376, in _handle_results\n+    task = get()\n+TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())\n ```\n \n-Also: the docbuilder should use `$MAKE` instead of `make`.\n+This looks like a bug in the Python `subprocess` module.\n+\n+Also: the docbuilder should use $MAKE instead of make. \n``````\n",
    "created_at": "2013-05-22T15:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177414",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-When building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:
+When building the PDF documentation, if there is problem while running `latex`, then the docbuilder just hangs forever *after building all documentation*. There is no obvious clue what the problem is apart from a message like the following (example from #9107) in the log file:
 
 ```
 ! LaTeX Error: Too deeply nested.
@@ -10,9 +10,6 @@
 l.27819 \begin{Verbatim}[commandchars=\\\{\}]
                                              
 ? 
-Implicit mode ON; LaTeX internals redefined
-(/usr/share/texmf-texlive/tex/latex/ltxmisc/url.sty
-(/usr/share/texmf-texlive/tex/latex/base/t1enc.def)
 ! Emergency stop.
  ...                                              
                                                   
@@ -20,7 +17,19 @@
                                              
 !  ==> Fatal error occurred, no output PDF file produced!
 Transcript written on categories.log.
-)make[1]: *** [categories.pdf] Error 1
+make[1]: *** [categories.pdf] Error 1
+make[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'
+Exception in thread Thread-6:
+Traceback (most recent call last):
+  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py", line 810, in __bootstrap_inner
+    self.run()
+  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/threading.py", line 763, in run
+    self.__target(*self.__args, **self.__kwargs)
+  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 376, in _handle_results
+    task = get()
+TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())
 ```
 
-Also: the docbuilder should use `$MAKE` instead of `make`.
+This looks like a bug in the Python `subprocess` module.
+
+Also: the docbuilder should use $MAKE instead of make. 
``````




---

archive/issue_comments_177415.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,6 @@\n TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())\n ```\n \n-This looks like a bug in the Python `subprocess` module.\n+This looks like a bug in the Python `multiprocessing` module.\n \n Also: the docbuilder should use $MAKE instead of make. \n``````\n",
    "created_at": "2013-05-22T15:40:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177415",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,6 @@
 TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())
 ```
 
-This looks like a bug in the Python `subprocess` module.
+This looks like a bug in the Python `multiprocessing` module.
 
 Also: the docbuilder should use $MAKE instead of make. 
``````




---

archive/issue_comments_177416.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI have an idea, patch possibly coming up...",
    "created_at": "2013-05-22T16:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177416",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

I have an idea, patch possibly coming up...



---

archive/issue_comments_177417.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[14626_workaround.patch.gz](https://github.com/sagemath/sage/files/ticket14626/14626_workaround.patch.gz)**",
    "created_at": "2013-05-22T19:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177417",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[14626_workaround.patch.gz](https://github.com/sagemath/sage/files/ticket14626/14626_workaround.patch.gz)**



---

archive/issue_events_205237.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T19:46:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205237"
}
```



---

archive/issue_events_205238.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T19:46:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205238"
}
```



---

archive/issue_comments_177418.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2013-05-22T19:46:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177418",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_events_205239.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-22T19:46:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205239"
}
```



---

archive/issue_comments_177419.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe patch makes a lot of sense at first glance, but I should test it to make sure. I'll try to get to it soon.",
    "created_at": "2013-05-22T20:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177419",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

The patch makes a lot of sense at first glance, but I should test it to make sure. I'll try to get to it soon.



---

archive/issue_comments_177420.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWith the patch and with bad LaTeX code, I see the hang occur earlier (soon after trying to build the bad document), but it still hangs.",
    "created_at": "2013-05-22T22:55:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177420",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

With the patch and with bad LaTeX code, I see the hang occur earlier (soon after trying to build the bad document), but it still hangs.



---

archive/issue_comments_177421.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nJohn, it seems to work for me, so could you please send me the `docpdf.log` file?",
    "created_at": "2013-05-23T06:57:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177421",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

John, it seems to work for me, so could you please send me the `docpdf.log` file?



---

archive/issue_comments_177422.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhen I apply this patch here and the patches from #9107 causing a LaTeX failure, then I get\n\n```\n! LaTeX Error: Too deeply nested.\n\nSee the LaTeX manual or LaTeX Companion for explanation.\nType  H <return>  for immediate help.\n ...\n\nl.27819 \\begin{Verbatim}[commandchars=\\\\\\{\\}]\n\n?\n! Emergency stop.\n ...\n\nl.27819 \\begin{Verbatim}[commandchars=\\\\\\{\\}]\n\n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on categories.log.\nmake[1]: *** [categories.pdf] Error 1\nmake[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'\nTraceback (most recent call last):\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 1452, in <module>\n    getattr(get_builder(name), type)()\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 273, in _wrapper\n    getattr(get_builder(document), name)(*args, **kwds)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 472, in _wrapper\n    pool.map_async(build_ref_doc, L, 1).get(99999)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 554, in get\n    raise self._value\nRuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/categories\nmake: *** [doc-pdf] Error 1\n```\nafter which I get back into the shell as expected.",
    "created_at": "2013-05-23T08:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177422",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

When I apply this patch here and the patches from #9107 causing a LaTeX failure, then I get

```
! LaTeX Error: Too deeply nested.

See the LaTeX manual or LaTeX Companion for explanation.
Type  H <return>  for immediate help.
 ...

l.27819 \begin{Verbatim}[commandchars=\\\{\}]

?
! Emergency stop.
 ...

l.27819 \begin{Verbatim}[commandchars=\\\{\}]

!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on categories.log.
make[1]: *** [categories.pdf] Error 1
make[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/categories'
Traceback (most recent call last):
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 1452, in <module>
    getattr(get_builder(name), type)()
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 273, in _wrapper
    getattr(get_builder(document), name)(*args, **kwds)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 472, in _wrapper
    pool.map_async(build_ref_doc, L, 1).get(99999)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 554, in get
    raise self._value
RuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/categories
make: *** [doc-pdf] Error 1
```
after which I get back into the shell as expected.



---

archive/issue_comments_177423.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe cause of the crash seems to be a combination of:\n1. `subprocess.CalledProcessError` instances cannot be unpickled properly.\n2. The `multiprocessing` module uses pickles to transfer exceptions from the child process to the master process and apparently doesn't gracefully handle unpickling errors.",
    "created_at": "2013-05-23T10:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177423",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

The cause of the crash seems to be a combination of:
1. `subprocess.CalledProcessError` instances cannot be unpickled properly.
2. The `multiprocessing` module uses pickles to transfer exceptions from the child process to the master process and apparently doesn't gracefully handle unpickling errors.



---

archive/issue_comments_177424.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,6 @@\n TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())\n ```\n \n-This looks like a bug in the Python `multiprocessing` module.\n+This hang is [http://bugs.python.org/issue9400](http://bugs.python.org/issue9400)\n \n Also: the docbuilder should use $MAKE instead of make. \n``````\n",
    "created_at": "2013-05-23T10:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177424",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,6 @@
 TypeError: ('__init__() takes at least 3 arguments (1 given)', <class 'subprocess.CalledProcessError'>, ())
 ```
 
-This looks like a bug in the Python `multiprocessing` module.
+This hang is [http://bugs.python.org/issue9400](http://bugs.python.org/issue9400)
 
 Also: the docbuilder should use $MAKE instead of make. 
``````




---

archive/issue_comments_177425.json:
```json
{
    "body": "Upstream: **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2013-05-23T10:09:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177425",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_177426.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI mistakenly thought that I wasn't getting an error from the patches at #9107, so I made this change and then build the documentation:\n\n```diff\ndiff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py\n--- a/sage/algebras/steenrod/steenrod_algebra.py\n+++ b/sage/algebras/steenrod/steenrod_algebra.py\n@@ -10,6 +10,8 @@\n   the Steenrod algebra using CombinatorialFreeModule; improved the\n   test suite.\n \n+Broken: `\\aaaaaa`\n+\n This module defines the mod `p` Steenrod algebra `\\mathcal{A}_p`, some\n of its properties, and ways to define elements of it.\n```\nWith the patch here, it hangs after trying to build reference/algebras. I agree that with just the patches at #9107, the hang is no longer present: once reference/categories fails, I get sent back to the shell.",
    "created_at": "2013-05-23T15:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177426",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

I mistakenly thought that I wasn't getting an error from the patches at #9107, so I made this change and then build the documentation:

```diff
diff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py
--- a/sage/algebras/steenrod/steenrod_algebra.py
+++ b/sage/algebras/steenrod/steenrod_algebra.py
@@ -10,6 +10,8 @@
   the Steenrod algebra using CombinatorialFreeModule; improved the
   test suite.
 
+Broken: `\aaaaaa`
+
 This module defines the mod `p` Steenrod algebra `\mathcal{A}_p`, some
 of its properties, and ways to define elements of it.
```
With the patch here, it hangs after trying to build reference/algebras. I agree that with just the patches at #9107, the hang is no longer present: once reference/categories fails, I get sent back to the shell.



---

archive/issue_comments_177427.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nJohn: your change still works for me:\n\n```\n! Undefined control sequence.\n<recently read> \\aaaaaa\n\nl.4077 Broken: $\\aaaaaa\n                       $\n?\n! Emergency stop.\n<recently read> \\aaaaaa\n\nl.4077 Broken: $\\aaaaaa\n                       $\n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on algebras.log.\nmake[1]: *** [algebras.pdf] Error 1\nmake[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/algebras'\nTraceback (most recent call last):\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 1452, in <module>\n    getattr(get_builder(name), type)()\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 273, in _wrapper\n    getattr(get_builder(document), name)(*args, **kwds)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 472, in _wrapper\n    pool.map_async(build_ref_doc, L, 1).get(99999)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 554, in get\n    raise self._value\nRuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras\nmake: *** [doc-pdf] Error 1\n```\nI correctly get a shell prompt after this.\n\nPlease attach your `docpdf.log` such that I can maybe find out what is happening.",
    "created_at": "2013-05-23T16:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177427",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

John: your change still works for me:

```
! Undefined control sequence.
<recently read> \aaaaaa

l.4077 Broken: $\aaaaaa
                       $
?
! Emergency stop.
<recently read> \aaaaaa

l.4077 Broken: $\aaaaaa
                       $
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on algebras.log.
make[1]: *** [algebras.pdf] Error 1
make[1]: Leaving directory `/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage-main/doc/output/latex/en/reference/algebras'
Traceback (most recent call last):
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 1452, in <module>
    getattr(get_builder(name), type)()
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 273, in _wrapper
    getattr(get_builder(document), name)(*args, **kwds)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 472, in _wrapper
    pool.map_async(build_ref_doc, L, 1).get(99999)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 554, in get
    raise self._value
RuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras
make: *** [doc-pdf] Error 1
```
I correctly get a shell prompt after this.

Please attach your `docpdf.log` such that I can maybe find out what is happening.



---

archive/issue_comments_177428.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSorry, once again I didn't communicate well enough. I've been running `./sage --docbuild reference pdf`, which still exhibits the hang. I see now that running `make doc-pdf` works as you say (so I'm not going to bother attaching docpdf.log).",
    "created_at": "2013-05-23T17:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177428",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Sorry, once again I didn't communicate well enough. I've been running `./sage --docbuild reference pdf`, which still exhibits the hang. I see now that running `make doc-pdf` works as you say (so I'm not going to bother attaching docpdf.log).



---

archive/issue_comments_177429.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2013-05-23T19:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177429",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_177430.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAlso `./sage --docbuild reference pdf` works for me...\n\n```\n! Undefined control sequence.\n<recently read> \\aaaaaa \n                        \nl.4066 Broken: $\\aaaaaa\n                       $\n? \n! Emergency stop.\n<recently read> \\aaaaaa \n                        \nl.4066 Broken: $\\aaaaaa\n                       $\n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on algebras.log.\nmake: *** [algebras.pdf] Error 1\nTraceback (most recent call last):\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 1452, in <module>\n    getattr(get_builder(name), type)()\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 472, in _wrapper\n    pool.map_async(build_ref_doc, L, 1).get(99999)\n  File \"/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 554, in get\n    raise self._value\nRuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras\n```",
    "created_at": "2013-05-23T19:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177430",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Also `./sage --docbuild reference pdf` works for me...

```
! Undefined control sequence.
<recently read> \aaaaaa 
                        
l.4066 Broken: $\aaaaaa
                       $
? 
! Emergency stop.
<recently read> \aaaaaa 
                        
l.4066 Broken: $\aaaaaa
                       $
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on algebras.log.
make: *** [algebras.pdf] Error 1
Traceback (most recent call last):
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 1452, in <module>
    getattr(get_builder(name), type)()
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 472, in _wrapper
    pool.map_async(build_ref_doc, L, 1).get(99999)
  File "/mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 554, in get
    raise self._value
RuntimeError: failed to run $MAKE all-pdf in /mazur/release/sage-5.10.beta4-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras
```



---

archive/issue_comments_177431.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI've seen this repeatably while running `./sage --docbuild reference pdf` on two different OS X machines (with two cores, with `MAKE='make -j2'`). Also, I just tried applying the patches at #9107 and the one here (without my change to steenrod_algebra.py) on sage.math (with `MAKE='make -j12'`), and it hangs after failing to compile categories.tex. (It finishes the compilations in progress, but then hangs).",
    "created_at": "2013-05-23T23:32:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177431",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

I've seen this repeatably while running `./sage --docbuild reference pdf` on two different OS X machines (with two cores, with `MAKE='make -j2'`). Also, I just tried applying the patches at #9107 and the one here (without my change to steenrod_algebra.py) on sage.math (with `MAKE='make -j12'`), and it hangs after failing to compile categories.tex. (It finishes the compilations in progress, but then hangs).



---

archive/issue_comments_177432.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nJohn, I still cannot reproduce your problems, can you say the exact steps that you did.\n\nI am doing the following on `sage.math`:\n\n1. Extract a Sage 5.9 binary:\n\n```\njdemeyer@sage:/release$ tar xzf /home/release/sage-5.9/sage-5.9-boxen-x86_64-Linux.tar.gz\njdemeyer@sage:/release$ cd sage-5.9-boxen-x86_64-Linux\n```\n\n2. Apply the patch:\n\n```\njdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ./sage --hg -R devel/sage qimport -P https://github.com/sagemath/sage/files/ticket14626/14626_workaround.patch.gz\nadding 14626_workaround.patch to series file\napplying 14626_workaround.patch\nnow at: 14626_workaround.patch\n```\n\n3. Break LaTeX:\n\n```\njdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ( cd devel/sage && patch -p1 )\ndiff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py\n\nIndex: sage/algebras/steenrod/steenrod_algebra.py\n===================================================================\n--- a/sage/algebras/steenrod/steenrod_algebra.py\n+++ b/sage/algebras/steenrod/steenrod_algebra.py\n@@ -10,5 +10,7 @@\n   the Steenrod algebra using CombinatorialFreeModule; improved the\n   test suite.\n \n+Broken: `\\aaaaaa`\n+\n This module defines the mod `p` Steenrod algebra `\\mathcal{A}_p`, some\n of its properties, and ways to define elements of it.\npatching file sage/algebras/steenrod/steenrod_algebra.py\nHunk #1 succeeded at 10 with fuzz 1.\n```\n\n4. Rebuild Sage:\n\n```\njdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ./sage -b\n```\n[...]\n\n5. Build the PDF reference manual using 12 threads:\n\n```\njdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ env MAKE=\"make -j12\" ./sage --docbuild reference pdf 2>&1 |tee docpdf.log\n```\n[...]\n\n```\n! Undefined control sequence.\n<recently read> \\aaaaaa \n                        \nl.3809 Broken: $\\aaaaaa\n                       $\n? \n! Emergency stop.\n<recently read> \\aaaaaa \n                        \nl.3809 Broken: $\\aaaaaa\n                       $\n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on algebras.log.\n]\nAdding blank page after the table of contents.\npdfTeX warning (ext4): destination with the same identifier (name{page.i}) has \nbeen already used, duplicate ignored\n<to be read again> \n                   \\relax \nl.129 \\tableofcontents\n                       [1 [28]]pdfTeX warning (ext4): destination with the same iden\ntifier (name{page.ii}) has been already used, duplicate ignored\n<to be read again> \n                   \\relax \nl.129 \\tableofcontents\n                       [2make: *** [algebras.pdf] Error 1\n```\n[...]\n\n```\nUnderfull \\hbox (badness 10000) in paragraph at lines 2769--2772\n[]\\T1/ptm/m/n/10 WalshCode - a bi-nary lin-ear $\\OT1/cmr/m/n/10 [2[]\\OML/cmm/m/\nit/10 ; m; \\OT1/cmr/m/n/10 2[]]$ \\T1/ptm/m/n/10 code re-lated to Hadamard ma-tr\ni-ces.\n[30][constants] reading sources... [100%] sage/symbolic/constants_c\n [7] [31Traceback (most recent call last):\n  File \"/release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 1452, in <module>\n]    getattr(get_builder(name), type)()\n  File \"/release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/common/builder.py\", line 472, in _wrapper\n    pool.map_async(build_ref_doc, L, 1).get(99999)\n  File \"/release/sage-5.9-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py\", line 528, in get\n    raise self._value\nRuntimeError: failed to run $MAKE all-pdf in /release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras\n```\n[...]\n\n```\nOutput written on arithgroup.pdf (85 pages, 458174 bytes).\nTranscript written on arithgroup.log.\n```\n\n6. I get back to the shell as expected.",
    "created_at": "2013-05-24T09:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177432",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

John, I still cannot reproduce your problems, can you say the exact steps that you did.

I am doing the following on `sage.math`:

1. Extract a Sage 5.9 binary:

```
jdemeyer@sage:/release$ tar xzf /home/release/sage-5.9/sage-5.9-boxen-x86_64-Linux.tar.gz
jdemeyer@sage:/release$ cd sage-5.9-boxen-x86_64-Linux
```

2. Apply the patch:

```
jdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ./sage --hg -R devel/sage qimport -P https://github.com/sagemath/sage/files/ticket14626/14626_workaround.patch.gz
adding 14626_workaround.patch to series file
applying 14626_workaround.patch
now at: 14626_workaround.patch
```

3. Break LaTeX:

```
jdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ( cd devel/sage && patch -p1 )
diff --git a/sage/algebras/steenrod/steenrod_algebra.py b/sage/algebras/steenrod/steenrod_algebra.py

Index: sage/algebras/steenrod/steenrod_algebra.py
===================================================================
--- a/sage/algebras/steenrod/steenrod_algebra.py
+++ b/sage/algebras/steenrod/steenrod_algebra.py
@@ -10,5 +10,7 @@
   the Steenrod algebra using CombinatorialFreeModule; improved the
   test suite.
 
+Broken: `\aaaaaa`
+
 This module defines the mod `p` Steenrod algebra `\mathcal{A}_p`, some
 of its properties, and ways to define elements of it.
patching file sage/algebras/steenrod/steenrod_algebra.py
Hunk #1 succeeded at 10 with fuzz 1.
```

4. Rebuild Sage:

```
jdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ ./sage -b
```
[...]

5. Build the PDF reference manual using 12 threads:

```
jdemeyer@sage:/release/sage-5.9-boxen-x86_64-Linux$ env MAKE="make -j12" ./sage --docbuild reference pdf 2>&1 |tee docpdf.log
```
[...]

```
! Undefined control sequence.
<recently read> \aaaaaa 
                        
l.3809 Broken: $\aaaaaa
                       $
? 
! Emergency stop.
<recently read> \aaaaaa 
                        
l.3809 Broken: $\aaaaaa
                       $
!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on algebras.log.
]
Adding blank page after the table of contents.
pdfTeX warning (ext4): destination with the same identifier (name{page.i}) has 
been already used, duplicate ignored
<to be read again> 
                   \relax 
l.129 \tableofcontents
                       [1 [28]]pdfTeX warning (ext4): destination with the same iden
tifier (name{page.ii}) has been already used, duplicate ignored
<to be read again> 
                   \relax 
l.129 \tableofcontents
                       [2make: *** [algebras.pdf] Error 1
```
[...]

```
Underfull \hbox (badness 10000) in paragraph at lines 2769--2772
[]\T1/ptm/m/n/10 WalshCode - a bi-nary lin-ear $\OT1/cmr/m/n/10 [2[]\OML/cmm/m/
it/10 ; m; \OT1/cmr/m/n/10 2[]]$ \T1/ptm/m/n/10 code re-lated to Hadamard ma-tr
i-ces.
[30][constants] reading sources... [100%] sage/symbolic/constants_c
 [7] [31Traceback (most recent call last):
  File "/release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 1452, in <module>
]    getattr(get_builder(name), type)()
  File "/release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/common/builder.py", line 472, in _wrapper
    pool.map_async(build_ref_doc, L, 1).get(99999)
  File "/release/sage-5.9-boxen-x86_64-Linux/local/lib/python/multiprocessing/pool.py", line 528, in get
    raise self._value
RuntimeError: failed to run $MAKE all-pdf in /release/sage-5.9-boxen-x86_64-Linux/devel/sage/doc/output/latex/en/reference/algebras
```
[...]

```
Output written on arithgroup.pdf (85 pages, 458174 bytes).
Transcript written on arithgroup.log.
```

6. I get back to the shell as expected.



---

archive/issue_comments_177433.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOkay, sorry, you're right. It looked to me as though it was hanging, but that's because the shell prompt was buried in output from the still-running processes. I stupidly didn't think to hit RET to see if I got a shell prompt.\n\nAt some point we might want to provide an error message at the very end, which won't get lost amidst the output from parallel processes, but that can go on another ticket.",
    "created_at": "2013-05-24T15:46:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177433",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Okay, sorry, you're right. It looked to me as though it was hanging, but that's because the shell prompt was buried in output from the still-running processes. I stupidly didn't think to hit RET to see if I got a shell prompt.

At some point we might want to provide an error message at the very end, which won't get lost amidst the output from parallel processes, but that can go on another ticket.



---

archive/issue_events_205240.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-24T15:46:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205240"
}
```



---

archive/issue_events_205241.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-05-24T15:46:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205241"
}
```



---

archive/issue_events_205242.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T20:15:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205242"
}
```



---

archive/issue_events_205243.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T20:15:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14626#event-205243"
}
```



---

archive/issue_comments_177434.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment%3A20):\n> Okay, sorry, you're right. It looked to me as though it was hanging, but that's because the shell prompt was buried in output from the still-running processes.\n\nDo you remember the shell command that you ran (in particular, did you use any unusual redirections or piping)? Because otherwise I don't see how it can happen what you describe.",
    "created_at": "2013-05-24T20:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177434",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment%3A20):
> Okay, sorry, you're right. It looked to me as though it was hanging, but that's because the shell prompt was buried in output from the still-running processes.

Do you remember the shell command that you ran (in particular, did you use any unusual redirections or piping)? Because otherwise I don't see how it can happen what you describe.



---

archive/issue_comments_177435.json:
```json
{
    "body": "Merged: **sage-5.10.beta5**",
    "created_at": "2013-05-24T20:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177435",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.10.beta5**



---

archive/issue_comments_177436.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI just logged into sage.math and did\n\n```\n$ cd /scratch/palmieri/sage-5.10.beta4\n$ ./sage --docbuild reference pdf\n```\nThen I see, in the middle of a lot of output,\n\n```\n[32 [20 <pairing.png, id=620, 416.9979pt x 217.5327pt>\n<use pairing.png>]] [68] <use pairing.png> [69 <./pairing.png [33] [21] [34]\nUnderfull \\hbox (badness 10000) in paragraph at lines 2826--2827\n\n\n[22][35]palmieri@boxen:sage-5.10.beta4$ \nUnderfull \\hbox (badness 10000) in paragraph at lines 2950--2951\n\n [23][36] [24]>] [70]\nChapter 11.\n```\n`palmieri@boxen:sage-5.10.beta4$` is my shell prompt. At the end of the output:\n\n```\nOutput written on homology.pdf (117 pages, 651759 bytes).\nTranscript written on homology.log.\n```\nbut no shell prompt because it was already printed earlier.  With `make doc-pdf`, I see a proper error message at the end.",
    "created_at": "2013-05-24T20:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177436",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

I just logged into sage.math and did

```
$ cd /scratch/palmieri/sage-5.10.beta4
$ ./sage --docbuild reference pdf
```
Then I see, in the middle of a lot of output,

```
[32 [20 <pairing.png, id=620, 416.9979pt x 217.5327pt>
<use pairing.png>]] [68] <use pairing.png> [69 <./pairing.png [33] [21] [34]
Underfull \hbox (badness 10000) in paragraph at lines 2826--2827


[22][35]palmieri@boxen:sage-5.10.beta4$ 
Underfull \hbox (badness 10000) in paragraph at lines 2950--2951

 [23][36] [24]>] [70]
Chapter 11.
```
`palmieri@boxen:sage-5.10.beta4$` is my shell prompt. At the end of the output:

```
Output written on homology.pdf (117 pages, 651759 bytes).
Transcript written on homology.log.
```
but no shell prompt because it was already printed earlier.  With `make doc-pdf`, I see a proper error message at the end.



---

archive/issue_comments_177437.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nJohn: probably the \"output after shell prompt\" problem is caused by parallel docbuilding: it seems that, if one thread fails, the docbuilder master process exists and the other threads simply continue working...\n\nNot really a bug, just a peculiarity of `multiprocessing.Pool` I guess.",
    "created_at": "2013-05-27T11:35:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14626#issuecomment-177437",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

John: probably the "output after shell prompt" problem is caused by parallel docbuilding: it seems that, if one thread fails, the docbuilder master process exists and the other threads simply continue working...

Not really a bug, just a peculiarity of `multiprocessing.Pool` I guess.
