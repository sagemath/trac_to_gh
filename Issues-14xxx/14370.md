# Issue 14370: Run IPython tests with --colors=NoColor

archive/issues_014166.json:
```json
{
    "body": "On some systems:\n\n```\nRunning doctests with ID 2013-03-27-15-38-22-527abcba.\nDoctesting 2 files.\nsage -t --long sage/misc/interpreter.py\n**********************************************************************\nFile \"sage/misc/interpreter.py\", line 150, in sage.misc.interpreter.sage_prompt\nFailed example:\n    shell.run_cell('sage_prompt()')\nExpected:\n    u'sage'\nGot:\n    u'sage'\n**********************************************************************\nFile \"sage/misc/interpreter.py\", line 566, in sage.misc.interpreter.interface_shell_embed\nFailed example:\n    shell.run_cell('List( [1..10], IsPrime )')\nExpected:\n    [ false, true, true, false, true, false, true, false, false, false ]\nGot:\n    [ false, true, true, false, true, false, true, false, false, false ]\n**********************************************************************\n2 items had failures:\n   1 of   4 in sage.misc.interpreter.interface_shell_embed\n   1 of   4 in sage.misc.interpreter.sage_prompt\n    [107 tests, 2 failures, 3.3 s]\nsage -t --long sage/misc/sage_extension.py\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 34, in sage.misc.sage_extension\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    2\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 39, in sage.misc.sage_extension\nFailed example:\n    shell.run_cell('%time 594.factor()')\nExpected:\n    CPU times: user ...\n    Wall time: ...\n    2 * 3^3 * 11\nGot:\n    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\n    Wall time: 0.00 s\n    2 * 3^3 * 11\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 75, in sage.misc.sage_extension.SageMagics.runfile\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    2\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 99, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    2\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 103, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('a')\nExpected:\n    3\nGot:\n    3\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 106, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('attached_files()')\nExpected:\n    []\nGot:\n    []\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    2\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('a')\nExpected:\n    3\nGot:\n    3\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('attached_files()')\nExpected:\n    []\nGot:\n    []\n**********************************************************************\nFile \"sage/misc/sage_extension.py\", line 210, in sage.misc.sage_extension.SagePlainTextFormatter\nFailed example:\n    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')\nExpected:\n    [\n    [1 0]  [1 0]\n    [0 1], [0 1]\n    ]\nGot:\n    [\n    [1 0]  [1 0]\n    [0 1], [0 1]\n    ]\n**********************************************************************\n5 items had failures:\n   2 of  12 in sage.misc.sage_extension\n   3 of  14 in sage.misc.sage_extension.SageMagics.attach\n   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n   1 of   9 in sage.misc.sage_extension.SageMagics.runfile\n   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter\n    [55 tests, 10 failures, 2.3 s]\n----------------------------------------------------------------------\nsage -t --long sage/misc/interpreter.py  # 2 doctests failed\nsage -t --long sage/misc/sage_extension.py  # 10 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 5.7 seconds\n    cpu time: 0.8 seconds\n    cumulative wall time: 5.6 seconds\n```\nAlso, on OS X 10.8:\n\n```\nsage -t --long devel/sage/sage/doctest/test.py\n**********************************************************************\nFile \"devel/sage/sage/doctest/test.py\", line 17, in sage.doctest.test\nFailed example:\n    subprocess.call([\"sage\", \"-t\", \"longtime.rst\"], cwd=tests_dir)  # long time\nExpected:\n    Running doctests...\n    Doctesting 1 file.\n    sage -t longtime.rst\n    [0 tests, ...s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    ...\n    0\nGot:\n    Running doctests with ID 2013-03-28-01-24-01-91891a00.\n    Doctesting 1 file.\n    [?1034hsage -t longtime.rst\n        [0 tests, 0.0 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.1 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    0\n**********************************************************************\n```\n\n**Apply** [attachment:14370_ipython_nocolors_v2.patch], [attachment:14370_run_doctests_fix.patch]\n\nAssignee: @williamstein\n\nReviewer: John Palmieri, David Roe\n\nAuthor: Jeroen Demeyer, Volker Braun\n\nMerged: sage-5.9.beta3\n\nDependencies: #12415, #14331, #13278\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14370\n\n",
    "closed_at": "2013-04-02T11:45:18Z",
    "created_at": "2013-03-27T22:39:01Z",
    "labels": [
        "component: interfaces",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "Run IPython tests with --colors=NoColor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14370",
    "user": "https://github.com/jdemeyer"
}
```
On some systems:

```
Running doctests with ID 2013-03-27-15-38-22-527abcba.
Doctesting 2 files.
sage -t --long sage/misc/interpreter.py
**********************************************************************
File "sage/misc/interpreter.py", line 150, in sage.misc.interpreter.sage_prompt
Failed example:
    shell.run_cell('sage_prompt()')
Expected:
    u'sage'
Got:
    u'sage'
**********************************************************************
File "sage/misc/interpreter.py", line 566, in sage.misc.interpreter.interface_shell_embed
Failed example:
    shell.run_cell('List( [1..10], IsPrime )')
Expected:
    [ false, true, true, false, true, false, true, false, false, false ]
Got:
    [ false, true, true, false, true, false, true, false, false, false ]
**********************************************************************
2 items had failures:
   1 of   4 in sage.misc.interpreter.interface_shell_embed
   1 of   4 in sage.misc.interpreter.sage_prompt
    [107 tests, 2 failures, 3.3 s]
sage -t --long sage/misc/sage_extension.py
**********************************************************************
File "sage/misc/sage_extension.py", line 34, in sage.misc.sage_extension
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    2
**********************************************************************
File "sage/misc/sage_extension.py", line 39, in sage.misc.sage_extension
Failed example:
    shell.run_cell('%time 594.factor()')
Expected:
    CPU times: user ...
    Wall time: ...
    2 * 3^3 * 11
Got:
    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
    Wall time: 0.00 s
    2 * 3^3 * 11
**********************************************************************
File "sage/misc/sage_extension.py", line 75, in sage.misc.sage_extension.SageMagics.runfile
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    2
**********************************************************************
File "sage/misc/sage_extension.py", line 99, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    2
**********************************************************************
File "sage/misc/sage_extension.py", line 103, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('a')
Expected:
    3
Got:
    3
**********************************************************************
File "sage/misc/sage_extension.py", line 106, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('attached_files()')
Expected:
    []
Got:
    []
**********************************************************************
File "sage/misc/sage_extension.py", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    2
**********************************************************************
File "sage/misc/sage_extension.py", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('a')
Expected:
    3
Got:
    3
**********************************************************************
File "sage/misc/sage_extension.py", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('attached_files()')
Expected:
    []
Got:
    []
**********************************************************************
File "sage/misc/sage_extension.py", line 210, in sage.misc.sage_extension.SagePlainTextFormatter
Failed example:
    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')
Expected:
    [
    [1 0]  [1 0]
    [0 1], [0 1]
    ]
Got:
    [
    [1 0]  [1 0]
    [0 1], [0 1]
    ]
**********************************************************************
5 items had failures:
   2 of  12 in sage.misc.sage_extension
   3 of  14 in sage.misc.sage_extension.SageMagics.attach
   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook
   1 of   9 in sage.misc.sage_extension.SageMagics.runfile
   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter
    [55 tests, 10 failures, 2.3 s]
----------------------------------------------------------------------
sage -t --long sage/misc/interpreter.py  # 2 doctests failed
sage -t --long sage/misc/sage_extension.py  # 10 doctests failed
----------------------------------------------------------------------
Total time for all tests: 5.7 seconds
    cpu time: 0.8 seconds
    cumulative wall time: 5.6 seconds
```
Also, on OS X 10.8:

```
sage -t --long devel/sage/sage/doctest/test.py
**********************************************************************
File "devel/sage/sage/doctest/test.py", line 17, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t", "longtime.rst"], cwd=tests_dir)  # long time
Expected:
    Running doctests...
    Doctesting 1 file.
    sage -t longtime.rst
    [0 tests, ...s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    ...
    0
Got:
    Running doctests with ID 2013-03-28-01-24-01-91891a00.
    Doctesting 1 file.
    [?1034hsage -t longtime.rst
        [0 tests, 0.0 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.1 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    0
**********************************************************************
```

**Apply** [attachment:14370_ipython_nocolors_v2.patch], [attachment:14370_run_doctests_fix.patch]

Assignee: @williamstein

Reviewer: John Palmieri, David Roe

Author: Jeroen Demeyer, Volker Braun

Merged: sage-5.9.beta3

Dependencies: #12415, #14331, #13278

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14370





---

archive/issue_comments_189589.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-27T23:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189589",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_189590.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-28T02:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189590",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_189591.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -132,6 +132,38 @@\n     cpu time: 0.8 seconds\n     cumulative wall time: 5.6 seconds\n ```\n+Also, on OS X 10.8:\n+\n+```\n+sage -t --long devel/sage/sage/doctest/test.py\n+**********************************************************************\n+File \"devel/sage/sage/doctest/test.py\", line 17, in sage.doctest.test\n+Failed example:\n+    subprocess.call([\"sage\", \"-t\", \"longtime.rst\"], cwd=tests_dir)  # long time\n+Expected:\n+    Running doctests...\n+    Doctesting 1 file.\n+    sage -t longtime.rst\n+    [0 tests, ...s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    ...\n+    0\n+Got:\n+    Running doctests with ID 2013-03-28-01-24-01-91891a00.\n+    Doctesting 1 file.\n+    [?1034hsage -t longtime.rst\n+        [0 tests, 0.0 s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    Total time for all tests: 0.1 seconds\n+        cpu time: 0.0 seconds\n+        cumulative wall time: 0.0 seconds\n+    0\n+**********************************************************************\n+```\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2013-03-28T02:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189591",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -132,6 +132,38 @@
     cpu time: 0.8 seconds
     cumulative wall time: 5.6 seconds
 ```
+Also, on OS X 10.8:
+
+```
+sage -t --long devel/sage/sage/doctest/test.py
+**********************************************************************
+File "devel/sage/sage/doctest/test.py", line 17, in sage.doctest.test
+Failed example:
+    subprocess.call(["sage", "-t", "longtime.rst"], cwd=tests_dir)  # long time
+Expected:
+    Running doctests...
+    Doctesting 1 file.
+    sage -t longtime.rst
+    [0 tests, ...s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    ...
+    0
+Got:
+    Running doctests with ID 2013-03-28-01-24-01-91891a00.
+    Doctesting 1 file.
+    [?1034hsage -t longtime.rst
+        [0 tests, 0.0 s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    Total time for all tests: 0.1 seconds
+        cpu time: 0.0 seconds
+        cumulative wall time: 0.0 seconds
+    0
+**********************************************************************
+```
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_189592.json:
```json
{
    "body": "<a id='comment:4'></a>The OSX issue is the same as #12263, either set `TERM=dumb` or ellipsize the smm escape sequence that may or may not be there.\n\nIt would be nice to run with #14290 to verify that the problem actually is color and not some other escape sequence.",
    "created_at": "2013-03-28T14:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189592",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>The OSX issue is the same as #12263, either set `TERM=dumb` or ellipsize the smm escape sequence that may or may not be there.

It would be nice to run with #14290 to verify that the problem actually is color and not some other escape sequence.



---

archive/issue_comments_189593.json:
```json
{
    "body": "<a id='comment:5'></a>Excellent diagnosis Volker!",
    "created_at": "2013-03-28T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189593",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Excellent diagnosis Volker!



---

archive/issue_comments_189594.json:
```json
{
    "body": "<a id='comment:6'></a>On OS X 10.8: I ran `make ptest`, and all tests passed. Immediately afterward, I ran\n\n```\n./sage -tp devel/sage/sage/misc/interpreter.py devel/sage/sage/misc/sage_extension.py\n```\nand I got the failures listed here. Does that make any sense?",
    "created_at": "2013-03-28T17:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189594",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>On OS X 10.8: I ran `make ptest`, and all tests passed. Immediately afterward, I ran

```
./sage -tp devel/sage/sage/misc/interpreter.py devel/sage/sage/misc/sage_extension.py
```
and I got the failures listed here. Does that make any sense?



---

archive/issue_comments_189595.json:
```json
{
    "body": "<a id='comment:7'></a>Maybe `make ptest` changes `TERM` somewhere on OSX? Try with #14290 to actually see the escape sequences, otherwise we can just guess.",
    "created_at": "2013-03-28T17:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189595",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Maybe `make ptest` changes `TERM` somewhere on OSX? Try with #14290 to actually see the escape sequences, otherwise we can just guess.



---

archive/issue_comments_189596.json:
```json
{
    "body": "<a id='comment:8'></a>With #14290:\n\n```\n$ ./sage -tp devel/sage/sage/misc/interpreter.py devel/sage/sage/misc/sage_extension.py\nRunning doctests with ID 2013-03-28-10-54-43-7fc9b4da.\nDoctesting 2 files using 2 threads.\nsage -t devel/sage/sage/misc/sage_extension.py\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 34, in sage.misc.sage_extension\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    <CSI-0;31m><CSI-0m>2\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 39, in sage.misc.sage_extension\nFailed example:\n    shell.run_cell('%time 594.factor()')\nExpected:\n    CPU times: user ...\n    Wall time: ...\n    2 * 3^3 * 11\nGot:\n    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\n    Wall time: 0.00 s\n    <CSI-0;31m><CSI-0m>2 * 3^3 * 11\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 75, in sage.misc.sage_extension.SageMagics.runfile\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    <CSI-0;31m><CSI-0m>2\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 99, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    <CSI-0;31m><CSI-0m>2\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 103, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('a')\nExpected:\n    3\nGot:\n    <CSI-0;31m><CSI-0m>3\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 106, in sage.misc.sage_extension.SageMagics.attach\nFailed example:\n    shell.run_cell('attached_files()')\nExpected:\n    []\nGot:\n    <CSI-0;31m><CSI-0m>[]\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('a')\nExpected:\n    2\nGot:\n    <CSI-0;31m><CSI-0m>2\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('a')\nExpected:\n    3\nGot:\n    <CSI-0;31m><CSI-0m>3\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\nFailed example:\n    shell.run_cell('attached_files()')\nExpected:\n    []\nGot:\n    <CSI-0;31m><CSI-0m>[]\n**********************************************************************\nFile \"devel/sage/sage/misc/sage_extension.py\", line 210, in sage.misc.sage_extension.SagePlainTextFormatter\nFailed example:\n    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')\nExpected:\n    [\n    [1 0]  [1 0]\n    [0 1], [0 1]\n    ]\nGot:\n    <CSI-0;31m><CSI-0m>[\n    [1 0]  [1 0]\n    [0 1], [0 1]\n    ]\n**********************************************************************\n5 items had failures:\n   2 of  12 in sage.misc.sage_extension\n   3 of  14 in sage.misc.sage_extension.SageMagics.attach\n   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n   1 of   9 in sage.misc.sage_extension.SageMagics.runfile\n   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter\n    [55 tests, 10 failures, 2.6 s]\nsage -t devel/sage/sage/misc/interpreter.py\n**********************************************************************\nFile \"devel/sage/sage/misc/interpreter.py\", line 150, in sage.misc.interpreter.sage_prompt\nFailed example:\n    shell.run_cell('sage_prompt()')\nExpected:\n    u'sage'\nGot:\n    <CSI-0;31m><CSI-0m>u'sage'\n**********************************************************************\nFile \"devel/sage/sage/misc/interpreter.py\", line 566, in sage.misc.interpreter.interface_shell_embed\nFailed example:\n    shell.run_cell('List( [1..10], IsPrime )')\nExpected:\n    [ false, true, true, false, true, false, true, false, false, false ]\nGot:\n    <CSI-0;31m><CSI-0m>[ false, true, true, false, true, false, true, false, false, false ]\n**********************************************************************\n2 items had failures:\n   1 of   4 in sage.misc.interpreter.interface_shell_embed\n   1 of   4 in sage.misc.interpreter.sage_prompt\n    [107 tests, 2 failures, 8.8 s]\n----------------------------------------------------------------------\nsage -t devel/sage/sage/misc/sage_extension.py  # 10 doctests failed\nsage -t devel/sage/sage/misc/interpreter.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 8.9 seconds\n    cpu time: 0.9 seconds\n    cumulative wall time: 11.3 seconds\n```\nThis command yields the same failures:\n\n```\n./sage -tp devel/sage/sage/misc/\n```\nThis one passes all tests:\n\n```\nspkg/pipestatus \"./sage -tp devel/sage/sage/misc 2>&1\" \"tee -a testmisc.log\"\n```",
    "created_at": "2013-03-28T18:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189596",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>With #14290:

```
$ ./sage -tp devel/sage/sage/misc/interpreter.py devel/sage/sage/misc/sage_extension.py
Running doctests with ID 2013-03-28-10-54-43-7fc9b4da.
Doctesting 2 files using 2 threads.
sage -t devel/sage/sage/misc/sage_extension.py
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 34, in sage.misc.sage_extension
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    <CSI-0;31m><CSI-0m>2
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 39, in sage.misc.sage_extension
Failed example:
    shell.run_cell('%time 594.factor()')
Expected:
    CPU times: user ...
    Wall time: ...
    2 * 3^3 * 11
Got:
    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
    Wall time: 0.00 s
    <CSI-0;31m><CSI-0m>2 * 3^3 * 11
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 75, in sage.misc.sage_extension.SageMagics.runfile
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    <CSI-0;31m><CSI-0m>2
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 99, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    <CSI-0;31m><CSI-0m>2
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 103, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('a')
Expected:
    3
Got:
    <CSI-0;31m><CSI-0m>3
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 106, in sage.misc.sage_extension.SageMagics.attach
Failed example:
    shell.run_cell('attached_files()')
Expected:
    []
Got:
    <CSI-0;31m><CSI-0m>[]
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('a')
Expected:
    2
Got:
    <CSI-0;31m><CSI-0m>2
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('a')
Expected:
    3
Got:
    <CSI-0;31m><CSI-0m>3
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
Failed example:
    shell.run_cell('attached_files()')
Expected:
    []
Got:
    <CSI-0;31m><CSI-0m>[]
**********************************************************************
File "devel/sage/sage/misc/sage_extension.py", line 210, in sage.misc.sage_extension.SagePlainTextFormatter
Failed example:
    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')
Expected:
    [
    [1 0]  [1 0]
    [0 1], [0 1]
    ]
Got:
    <CSI-0;31m><CSI-0m>[
    [1 0]  [1 0]
    [0 1], [0 1]
    ]
**********************************************************************
5 items had failures:
   2 of  12 in sage.misc.sage_extension
   3 of  14 in sage.misc.sage_extension.SageMagics.attach
   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook
   1 of   9 in sage.misc.sage_extension.SageMagics.runfile
   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter
    [55 tests, 10 failures, 2.6 s]
sage -t devel/sage/sage/misc/interpreter.py
**********************************************************************
File "devel/sage/sage/misc/interpreter.py", line 150, in sage.misc.interpreter.sage_prompt
Failed example:
    shell.run_cell('sage_prompt()')
Expected:
    u'sage'
Got:
    <CSI-0;31m><CSI-0m>u'sage'
**********************************************************************
File "devel/sage/sage/misc/interpreter.py", line 566, in sage.misc.interpreter.interface_shell_embed
Failed example:
    shell.run_cell('List( [1..10], IsPrime )')
Expected:
    [ false, true, true, false, true, false, true, false, false, false ]
Got:
    <CSI-0;31m><CSI-0m>[ false, true, true, false, true, false, true, false, false, false ]
**********************************************************************
2 items had failures:
   1 of   4 in sage.misc.interpreter.interface_shell_embed
   1 of   4 in sage.misc.interpreter.sage_prompt
    [107 tests, 2 failures, 8.8 s]
----------------------------------------------------------------------
sage -t devel/sage/sage/misc/sage_extension.py  # 10 doctests failed
sage -t devel/sage/sage/misc/interpreter.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 8.9 seconds
    cpu time: 0.9 seconds
    cumulative wall time: 11.3 seconds
```
This command yields the same failures:

```
./sage -tp devel/sage/sage/misc/
```
This one passes all tests:

```
spkg/pipestatus "./sage -tp devel/sage/sage/misc 2>&1" "tee -a testmisc.log"
```



---

archive/issue_comments_189597.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-28T18:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189597",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189598.json:
```json
{
    "body": "<a id='comment:10'></a>The patch doesn't apply cleanly to 5.9.beta1. What are the dependencies?",
    "created_at": "2013-03-28T20:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189598",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>The patch doesn't apply cleanly to 5.9.beta1. What are the dependencies?



---

archive/issue_comments_189599.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-28T21:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189599",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_189600.json:
```json
{
    "body": "<a id='comment:12'></a>The code makes sense, and this seems to fix the problem. A minor fix:\n\n```diff\ndiff --git a/sage/doctest/test.py b/sage/doctest/test.py\n--- a/sage/doctest/test.py\n+++ b/sage/doctest/test.py\n@@ -13,7 +13,7 @@\n     sage: tests_dir = os.path.join(SAGE_SRC, 'sage', 'doctest', 'tests')\n     sage: tests_env = dict(os.environ)\n \n-Unset :envvar:TERM when running doctests, see :trac:`14370`::\n+Unset :envvar:`TERM` when running doctests, see :trac:`14370`::\n \n     sage: try:\n     ....:     del tests_env['TERM']\n```\nAlong these lines, is there a ticket to add files from the `doctest` directory to the reference manual?",
    "created_at": "2013-03-28T21:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189600",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>The code makes sense, and this seems to fix the problem. A minor fix:

```diff
diff --git a/sage/doctest/test.py b/sage/doctest/test.py
--- a/sage/doctest/test.py
+++ b/sage/doctest/test.py
@@ -13,7 +13,7 @@
     sage: tests_dir = os.path.join(SAGE_SRC, 'sage', 'doctest', 'tests')
     sage: tests_env = dict(os.environ)
 
-Unset :envvar:TERM when running doctests, see :trac:`14370`::
+Unset :envvar:`TERM` when running doctests, see :trac:`14370`::
 
     sage: try:
     ....:     del tests_env['TERM']
```
Along these lines, is there a ticket to add files from the `doctest` directory to the reference manual?



---

archive/issue_comments_189601.json:
```json
{
    "body": "Attachment [14370_ipython_nocolors.patch](tarball://root/attachments/some-uuid/ticket14370/14370_ipython_nocolors.patch) by @jdemeyer created at 2013-03-28 21:43:56",
    "created_at": "2013-03-28T21:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189601",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14370_ipython_nocolors.patch](tarball://root/attachments/some-uuid/ticket14370/14370_ipython_nocolors.patch) by @jdemeyer created at 2013-03-28 21:43:56



---

archive/issue_comments_189602.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 jhpalmieri]:\n> Along these lines, is there a ticket to add files from the `doctest` directory to the reference manual?\n\nSee #14376, you can go ahead and make a patch for it.",
    "created_at": "2013-03-28T21:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189602",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:12 jhpalmieri]:
> Along these lines, is there a ticket to add files from the `doctest` directory to the reference manual?

See #14376, you can go ahead and make a patch for it.



---

archive/issue_comments_189603.json:
```json
{
    "body": "<a id='comment:14'></a>Attachment [14370_ipython_nocolors_v2.patch](tarball://root/attachments/some-uuid/ticket14370/14370_ipython_nocolors_v2.patch) by @jdemeyer created at 2013-04-01 12:39:04",
    "created_at": "2013-04-01T12:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189603",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Attachment [14370_ipython_nocolors_v2.patch](tarball://root/attachments/some-uuid/ticket14370/14370_ipython_nocolors_v2.patch) by @jdemeyer created at 2013-04-01 12:39:04



---

archive/issue_comments_189604.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-04-01T12:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189604",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_189605.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-01T12:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189605",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_189606.json:
```json
{
    "body": "<a id='comment:15'></a>I changed the patch slightly, I think this is a better solution. Note the change to `doctest/forker.py`, needs review.",
    "created_at": "2013-04-01T12:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189606",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>I changed the patch slightly, I think this is a better solution. Note the change to `doctest/forker.py`, needs review.



---

archive/issue_comments_189607.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,171 @@\n+On some systems:\n \n+```\n+Running doctests with ID 2013-03-27-15-38-22-527abcba.\n+Doctesting 2 files.\n+sage -t --long sage/misc/interpreter.py\n+**********************************************************************\n+File \"sage/misc/interpreter.py\", line 150, in sage.misc.interpreter.sage_prompt\n+Failed example:\n+    shell.run_cell('sage_prompt()')\n+Expected:\n+    u'sage'\n+Got:\n+    u'sage'\n+**********************************************************************\n+File \"sage/misc/interpreter.py\", line 566, in sage.misc.interpreter.interface_shell_embed\n+Failed example:\n+    shell.run_cell('List( [1..10], IsPrime )')\n+Expected:\n+    [ false, true, true, false, true, false, true, false, false, false ]\n+Got:\n+    [ false, true, true, false, true, false, true, false, false, false ]\n+**********************************************************************\n+2 items had failures:\n+   1 of   4 in sage.misc.interpreter.interface_shell_embed\n+   1 of   4 in sage.misc.interpreter.sage_prompt\n+    [107 tests, 2 failures, 3.3 s]\n+sage -t --long sage/misc/sage_extension.py\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 34, in sage.misc.sage_extension\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 39, in sage.misc.sage_extension\n+Failed example:\n+    shell.run_cell('%time 594.factor()')\n+Expected:\n+    CPU times: user ...\n+    Wall time: ...\n+    2 * 3^3 * 11\n+Got:\n+    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\n+    Wall time: 0.00 s\n+    2 * 3^3 * 11\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 75, in sage.misc.sage_extension.SageMagics.runfile\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 99, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 103, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    3\n+Got:\n+    3\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 106, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('attached_files()')\n+Expected:\n+    []\n+Got:\n+    []\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    3\n+Got:\n+    3\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('attached_files()')\n+Expected:\n+    []\n+Got:\n+    []\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 210, in sage.misc.sage_extension.SagePlainTextFormatter\n+Failed example:\n+    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')\n+Expected:\n+    [\n+    [1 0]  [1 0]\n+    [0 1], [0 1]\n+    ]\n+Got:\n+    [\n+    [1 0]  [1 0]\n+    [0 1], [0 1]\n+    ]\n+**********************************************************************\n+5 items had failures:\n+   2 of  12 in sage.misc.sage_extension\n+   3 of  14 in sage.misc.sage_extension.SageMagics.attach\n+   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+   1 of   9 in sage.misc.sage_extension.SageMagics.runfile\n+   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter\n+    [55 tests, 10 failures, 2.3 s]\n+----------------------------------------------------------------------\n+sage -t --long sage/misc/interpreter.py  # 2 doctests failed\n+sage -t --long sage/misc/sage_extension.py  # 10 doctests failed\n+----------------------------------------------------------------------\n+Total time for all tests: 5.7 seconds\n+    cpu time: 0.8 seconds\n+    cumulative wall time: 5.6 seconds\n+```\n+Also, on OS X 10.8:\n+\n+```\n+sage -t --long devel/sage/sage/doctest/test.py\n+**********************************************************************\n+File \"devel/sage/sage/doctest/test.py\", line 17, in sage.doctest.test\n+Failed example:\n+    subprocess.call([\"sage\", \"-t\", \"longtime.rst\"], cwd=tests_dir)  # long time\n+Expected:\n+    Running doctests...\n+    Doctesting 1 file.\n+    sage -t longtime.rst\n+    [0 tests, ...s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    ...\n+    0\n+Got:\n+    Running doctests with ID 2013-03-28-01-24-01-91891a00.\n+    Doctesting 1 file.\n+    [?1034hsage -t longtime.rst\n+        [0 tests, 0.0 s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    Total time for all tests: 0.1 seconds\n+        cpu time: 0.0 seconds\n+        cumulative wall time: 0.0 seconds\n+    0\n+**********************************************************************\n+```\n+\n+**Apply** [attachment:14370_ipython_nocolors_v2.patch]\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2013-04-01T12:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189607",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,171 @@
+On some systems:
 
+```
+Running doctests with ID 2013-03-27-15-38-22-527abcba.
+Doctesting 2 files.
+sage -t --long sage/misc/interpreter.py
+**********************************************************************
+File "sage/misc/interpreter.py", line 150, in sage.misc.interpreter.sage_prompt
+Failed example:
+    shell.run_cell('sage_prompt()')
+Expected:
+    u'sage'
+Got:
+    u'sage'
+**********************************************************************
+File "sage/misc/interpreter.py", line 566, in sage.misc.interpreter.interface_shell_embed
+Failed example:
+    shell.run_cell('List( [1..10], IsPrime )')
+Expected:
+    [ false, true, true, false, true, false, true, false, false, false ]
+Got:
+    [ false, true, true, false, true, false, true, false, false, false ]
+**********************************************************************
+2 items had failures:
+   1 of   4 in sage.misc.interpreter.interface_shell_embed
+   1 of   4 in sage.misc.interpreter.sage_prompt
+    [107 tests, 2 failures, 3.3 s]
+sage -t --long sage/misc/sage_extension.py
+**********************************************************************
+File "sage/misc/sage_extension.py", line 34, in sage.misc.sage_extension
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 39, in sage.misc.sage_extension
+Failed example:
+    shell.run_cell('%time 594.factor()')
+Expected:
+    CPU times: user ...
+    Wall time: ...
+    2 * 3^3 * 11
+Got:
+    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
+    Wall time: 0.00 s
+    2 * 3^3 * 11
+**********************************************************************
+File "sage/misc/sage_extension.py", line 75, in sage.misc.sage_extension.SageMagics.runfile
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 99, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 103, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('a')
+Expected:
+    3
+Got:
+    3
+**********************************************************************
+File "sage/misc/sage_extension.py", line 106, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('attached_files()')
+Expected:
+    []
+Got:
+    []
+**********************************************************************
+File "sage/misc/sage_extension.py", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('a')
+Expected:
+    3
+Got:
+    3
+**********************************************************************
+File "sage/misc/sage_extension.py", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('attached_files()')
+Expected:
+    []
+Got:
+    []
+**********************************************************************
+File "sage/misc/sage_extension.py", line 210, in sage.misc.sage_extension.SagePlainTextFormatter
+Failed example:
+    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')
+Expected:
+    [
+    [1 0]  [1 0]
+    [0 1], [0 1]
+    ]
+Got:
+    [
+    [1 0]  [1 0]
+    [0 1], [0 1]
+    ]
+**********************************************************************
+5 items had failures:
+   2 of  12 in sage.misc.sage_extension
+   3 of  14 in sage.misc.sage_extension.SageMagics.attach
+   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+   1 of   9 in sage.misc.sage_extension.SageMagics.runfile
+   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter
+    [55 tests, 10 failures, 2.3 s]
+----------------------------------------------------------------------
+sage -t --long sage/misc/interpreter.py  # 2 doctests failed
+sage -t --long sage/misc/sage_extension.py  # 10 doctests failed
+----------------------------------------------------------------------
+Total time for all tests: 5.7 seconds
+    cpu time: 0.8 seconds
+    cumulative wall time: 5.6 seconds
+```
+Also, on OS X 10.8:
+
+```
+sage -t --long devel/sage/sage/doctest/test.py
+**********************************************************************
+File "devel/sage/sage/doctest/test.py", line 17, in sage.doctest.test
+Failed example:
+    subprocess.call(["sage", "-t", "longtime.rst"], cwd=tests_dir)  # long time
+Expected:
+    Running doctests...
+    Doctesting 1 file.
+    sage -t longtime.rst
+    [0 tests, ...s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    ...
+    0
+Got:
+    Running doctests with ID 2013-03-28-01-24-01-91891a00.
+    Doctesting 1 file.
+    [?1034hsage -t longtime.rst
+        [0 tests, 0.0 s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    Total time for all tests: 0.1 seconds
+        cpu time: 0.0 seconds
+        cumulative wall time: 0.0 seconds
+    0
+**********************************************************************
+```
+
+**Apply** [attachment:14370_ipython_nocolors_v2.patch]
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_189608.json:
```json
{
    "body": "<a id='comment:17'></a>I prefer v2, too. But `run_doctests(sage.misc.interpreter)` then still coughs up an escape code in `shell.run_cell('List( [1..10], IsPrime )')`, because that is not going through the doctest forker. I suppose `run_doctests` need not only disable color in the test shell but also the defaults if the doctest creates yet another shell.",
    "created_at": "2013-04-01T13:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189608",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>I prefer v2, too. But `run_doctests(sage.misc.interpreter)` then still coughs up an escape code in `shell.run_cell('List( [1..10], IsPrime )')`, because that is not going through the doctest forker. I suppose `run_doctests` need not only disable color in the test shell but also the defaults if the doctest creates yet another shell.



---

archive/issue_comments_189609.json:
```json
{
    "body": "Attachment [14370_run_doctests_fix.patch](tarball://root/attachments/some-uuid/ticket14370/14370_run_doctests_fix.patch) by @vbraun created at 2013-04-01 13:20:10\n\nInitial patch",
    "created_at": "2013-04-01T13:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189609",
    "user": "https://github.com/vbraun"
}
```

Attachment [14370_run_doctests_fix.patch](tarball://root/attachments/some-uuid/ticket14370/14370_run_doctests_fix.patch) by @vbraun created at 2013-04-01 13:20:10

Initial patch



---

archive/issue_comments_189610.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,171 @@\n+On some systems:\n \n+```\n+Running doctests with ID 2013-03-27-15-38-22-527abcba.\n+Doctesting 2 files.\n+sage -t --long sage/misc/interpreter.py\n+**********************************************************************\n+File \"sage/misc/interpreter.py\", line 150, in sage.misc.interpreter.sage_prompt\n+Failed example:\n+    shell.run_cell('sage_prompt()')\n+Expected:\n+    u'sage'\n+Got:\n+    u'sage'\n+**********************************************************************\n+File \"sage/misc/interpreter.py\", line 566, in sage.misc.interpreter.interface_shell_embed\n+Failed example:\n+    shell.run_cell('List( [1..10], IsPrime )')\n+Expected:\n+    [ false, true, true, false, true, false, true, false, false, false ]\n+Got:\n+    [ false, true, true, false, true, false, true, false, false, false ]\n+**********************************************************************\n+2 items had failures:\n+   1 of   4 in sage.misc.interpreter.interface_shell_embed\n+   1 of   4 in sage.misc.interpreter.sage_prompt\n+    [107 tests, 2 failures, 3.3 s]\n+sage -t --long sage/misc/sage_extension.py\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 34, in sage.misc.sage_extension\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 39, in sage.misc.sage_extension\n+Failed example:\n+    shell.run_cell('%time 594.factor()')\n+Expected:\n+    CPU times: user ...\n+    Wall time: ...\n+    2 * 3^3 * 11\n+Got:\n+    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\n+    Wall time: 0.00 s\n+    2 * 3^3 * 11\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 75, in sage.misc.sage_extension.SageMagics.runfile\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 99, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 103, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    3\n+Got:\n+    3\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 106, in sage.misc.sage_extension.SageMagics.attach\n+Failed example:\n+    shell.run_cell('attached_files()')\n+Expected:\n+    []\n+Got:\n+    []\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    2\n+Got:\n+    2\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('a')\n+Expected:\n+    3\n+Got:\n+    3\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+Failed example:\n+    shell.run_cell('attached_files()')\n+Expected:\n+    []\n+Got:\n+    []\n+**********************************************************************\n+File \"sage/misc/sage_extension.py\", line 210, in sage.misc.sage_extension.SagePlainTextFormatter\n+Failed example:\n+    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')\n+Expected:\n+    [\n+    [1 0]  [1 0]\n+    [0 1], [0 1]\n+    ]\n+Got:\n+    [\n+    [1 0]  [1 0]\n+    [0 1], [0 1]\n+    ]\n+**********************************************************************\n+5 items had failures:\n+   2 of  12 in sage.misc.sage_extension\n+   3 of  14 in sage.misc.sage_extension.SageMagics.attach\n+   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook\n+   1 of   9 in sage.misc.sage_extension.SageMagics.runfile\n+   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter\n+    [55 tests, 10 failures, 2.3 s]\n+----------------------------------------------------------------------\n+sage -t --long sage/misc/interpreter.py  # 2 doctests failed\n+sage -t --long sage/misc/sage_extension.py  # 10 doctests failed\n+----------------------------------------------------------------------\n+Total time for all tests: 5.7 seconds\n+    cpu time: 0.8 seconds\n+    cumulative wall time: 5.6 seconds\n+```\n+Also, on OS X 10.8:\n+\n+```\n+sage -t --long devel/sage/sage/doctest/test.py\n+**********************************************************************\n+File \"devel/sage/sage/doctest/test.py\", line 17, in sage.doctest.test\n+Failed example:\n+    subprocess.call([\"sage\", \"-t\", \"longtime.rst\"], cwd=tests_dir)  # long time\n+Expected:\n+    Running doctests...\n+    Doctesting 1 file.\n+    sage -t longtime.rst\n+    [0 tests, ...s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    ...\n+    0\n+Got:\n+    Running doctests with ID 2013-03-28-01-24-01-91891a00.\n+    Doctesting 1 file.\n+    [?1034hsage -t longtime.rst\n+        [0 tests, 0.0 s]\n+    ----------------------------------------------------------------------\n+    All tests passed!\n+    ----------------------------------------------------------------------\n+    Total time for all tests: 0.1 seconds\n+        cpu time: 0.0 seconds\n+        cumulative wall time: 0.0 seconds\n+    0\n+**********************************************************************\n+```\n+\n+**Apply** [attachment:14370_ipython_nocolors_v2.patch], [attachment:14370_run_doctests_fix.patch]\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2013-04-01T13:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189610",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,171 @@
+On some systems:
 
+```
+Running doctests with ID 2013-03-27-15-38-22-527abcba.
+Doctesting 2 files.
+sage -t --long sage/misc/interpreter.py
+**********************************************************************
+File "sage/misc/interpreter.py", line 150, in sage.misc.interpreter.sage_prompt
+Failed example:
+    shell.run_cell('sage_prompt()')
+Expected:
+    u'sage'
+Got:
+    u'sage'
+**********************************************************************
+File "sage/misc/interpreter.py", line 566, in sage.misc.interpreter.interface_shell_embed
+Failed example:
+    shell.run_cell('List( [1..10], IsPrime )')
+Expected:
+    [ false, true, true, false, true, false, true, false, false, false ]
+Got:
+    [ false, true, true, false, true, false, true, false, false, false ]
+**********************************************************************
+2 items had failures:
+   1 of   4 in sage.misc.interpreter.interface_shell_embed
+   1 of   4 in sage.misc.interpreter.sage_prompt
+    [107 tests, 2 failures, 3.3 s]
+sage -t --long sage/misc/sage_extension.py
+**********************************************************************
+File "sage/misc/sage_extension.py", line 34, in sage.misc.sage_extension
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 39, in sage.misc.sage_extension
+Failed example:
+    shell.run_cell('%time 594.factor()')
+Expected:
+    CPU times: user ...
+    Wall time: ...
+    2 * 3^3 * 11
+Got:
+    CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
+    Wall time: 0.00 s
+    2 * 3^3 * 11
+**********************************************************************
+File "sage/misc/sage_extension.py", line 75, in sage.misc.sage_extension.SageMagics.runfile
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 99, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 103, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('a')
+Expected:
+    3
+Got:
+    3
+**********************************************************************
+File "sage/misc/sage_extension.py", line 106, in sage.misc.sage_extension.SageMagics.attach
+Failed example:
+    shell.run_cell('attached_files()')
+Expected:
+    []
+Got:
+    []
+**********************************************************************
+File "sage/misc/sage_extension.py", line 127, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('a')
+Expected:
+    2
+Got:
+    2
+**********************************************************************
+File "sage/misc/sage_extension.py", line 131, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('a')
+Expected:
+    3
+Got:
+    3
+**********************************************************************
+File "sage/misc/sage_extension.py", line 134, in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+Failed example:
+    shell.run_cell('attached_files()')
+Expected:
+    []
+Got:
+    []
+**********************************************************************
+File "sage/misc/sage_extension.py", line 210, in sage.misc.sage_extension.SagePlainTextFormatter
+Failed example:
+    shell.run_cell('a = identity_matrix(ZZ, 2); [a,a]')
+Expected:
+    [
+    [1 0]  [1 0]
+    [0 1], [0 1]
+    ]
+Got:
+    [
+    [1 0]  [1 0]
+    [0 1], [0 1]
+    ]
+**********************************************************************
+5 items had failures:
+   2 of  12 in sage.misc.sage_extension
+   3 of  14 in sage.misc.sage_extension.SageMagics.attach
+   3 of  14 in sage.misc.sage_extension.SageMagics.pre_run_code_hook
+   1 of   9 in sage.misc.sage_extension.SageMagics.runfile
+   1 of   5 in sage.misc.sage_extension.SagePlainTextFormatter
+    [55 tests, 10 failures, 2.3 s]
+----------------------------------------------------------------------
+sage -t --long sage/misc/interpreter.py  # 2 doctests failed
+sage -t --long sage/misc/sage_extension.py  # 10 doctests failed
+----------------------------------------------------------------------
+Total time for all tests: 5.7 seconds
+    cpu time: 0.8 seconds
+    cumulative wall time: 5.6 seconds
+```
+Also, on OS X 10.8:
+
+```
+sage -t --long devel/sage/sage/doctest/test.py
+**********************************************************************
+File "devel/sage/sage/doctest/test.py", line 17, in sage.doctest.test
+Failed example:
+    subprocess.call(["sage", "-t", "longtime.rst"], cwd=tests_dir)  # long time
+Expected:
+    Running doctests...
+    Doctesting 1 file.
+    sage -t longtime.rst
+    [0 tests, ...s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    ...
+    0
+Got:
+    Running doctests with ID 2013-03-28-01-24-01-91891a00.
+    Doctesting 1 file.
+    [?1034hsage -t longtime.rst
+        [0 tests, 0.0 s]
+    ----------------------------------------------------------------------
+    All tests passed!
+    ----------------------------------------------------------------------
+    Total time for all tests: 0.1 seconds
+        cpu time: 0.0 seconds
+        cumulative wall time: 0.0 seconds
+    0
+**********************************************************************
+```
+
+**Apply** [attachment:14370_ipython_nocolors_v2.patch], [attachment:14370_run_doctests_fix.patch]
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_189611.json:
```json
{
    "body": "<a id='comment:19'></a>I've added the patch that does that. Positive review to Jeroen's patch.",
    "created_at": "2013-04-01T13:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189611",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>I've added the patch that does that. Positive review to Jeroen's patch.



---

archive/issue_comments_189612.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-02T11:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189612",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_189613.json:
```json
{
    "body": "<a id='comment:20'></a>Looks good to me.",
    "created_at": "2013-04-02T11:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189613",
    "user": "https://github.com/roed314"
}
```

<a id='comment:20'></a>Looks good to me.



---

archive/issue_events_040783.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-02T11:45:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14370#event-40783"
}
```



---

archive/issue_comments_189614.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-02T11:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14370#issuecomment-189614",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
