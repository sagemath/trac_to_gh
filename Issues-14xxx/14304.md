# Issue 14304: New implementation of unramified p-adics using FLINT and templates

archive/issues_014100.json:
```json
{
    "body": "Assignee: @roed314\n\nCC:  @fredrik-johansson jpflori @saraedum\n\nKeywords: sd59, days71\n\nReimplement Qq using FLINT.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14304\n\n",
    "closed_at": "2016-03-23T23:55:10Z",
    "created_at": "2013-03-19T03:14:00Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "New implementation of unramified p-adics using FLINT and templates",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14304",
    "user": "https://github.com/roed314"
}
```
Assignee: @roed314

CC:  @fredrik-johansson jpflori @saraedum

Keywords: sd59, days71

Reimplement Qq using FLINT.

Issue created by migration from https://trac.sagemath.org/ticket/14304





---

archive/issue_comments_176392.json:
```json
{
    "body": "This ticket is essentially complete at https://github.com/saraedum/sage/tree/Zq.  Once #12173 is positively reviewed we'll make some patches and put this up for review.",
    "created_at": "2013-03-22T05:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176392",
    "user": "https://github.com/roed314"
}
```

This ticket is essentially complete at https://github.com/saraedum/sage/tree/Zq.  Once #12173 is positively reviewed we'll make some patches and put this up for review.



---

archive/issue_comments_176393.json:
```json
{
    "body": "Replying to [comment:3 roed]:\n> Once #12173 is positively reviewed\n\ncheck!",
    "created_at": "2013-05-09T18:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176393",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 roed]:
> Once #12173 is positively reviewed

check!



---

archive/issue_comments_176394.json:
```json
{
    "body": "The repository moved to https://github.com/saraedum/sage-renamed/tree/Zq",
    "created_at": "2013-07-25T15:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176394",
    "user": "https://github.com/saraedum"
}
```

The repository moved to https://github.com/saraedum/sage-renamed/tree/Zq



---

archive/issue_events_040487.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40487"
}
```



---

archive/issue_comments_176395.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2014-01-05T00:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176395",
    "user": "https://github.com/roed314"
}
```

Last 10 new commits:



---

archive/issue_comments_176396.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-05T20:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176396",
    "user": "https://github.com/roed314"
}
```

New commits:



---

archive/issue_comments_176397.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-05T20:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176397",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_176398.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-06T00:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176398",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_176399.json:
```json
{
    "body": "I mostly looked at the last two commits. Everything else had already been reviewed before. I did not run doctests. Is there a working patchbot which will run the doctests or do I have to run them manually?",
    "created_at": "2014-01-06T00:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176399",
    "user": "https://github.com/saraedum"
}
```

I mostly looked at the last two commits. Everything else had already been reviewed before. I did not run doctests. Is there a working patchbot which will run the doctests or do I have to run them manually?



---

archive/issue_comments_176400.json:
```json
{
    "body": "Does not work... please run \"make ptestlong\"",
    "created_at": "2014-01-07T00:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176400",
    "user": "https://github.com/vbraun"
}
```

Does not work... please run "make ptestlong"



---

archive/issue_comments_176401.json:
```json
{
    "body": "Will do.",
    "created_at": "2014-01-07T00:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176401",
    "user": "https://github.com/roed314"
}
```

Will do.



---

archive/issue_comments_176402.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-01-07T00:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176402",
    "user": "https://github.com/roed314"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_176403.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-07T08:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176404.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-07T08:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176404",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176405.json:
```json
{
    "body": "There is invalid use of `sig_on()` in many places. The following is wrong:\n\n```\nsig_on()\nif condition:\n    raise Exception\nsig_off()\n```\nYou must put a `sig_off()` before the `raise` (or use `try`/`finally`).\n\nI also recommend to doctest these exceptions. The doctesting framework catches such invalid use of `sig_on()`.\n\nI also don't like bare `except:` statements. Be explicit and use `except BaseException:` or `except Exception:` instead.",
    "created_at": "2014-01-07T12:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176405",
    "user": "https://github.com/jdemeyer"
}
```

There is invalid use of `sig_on()` in many places. The following is wrong:

```
sig_on()
if condition:
    raise Exception
sig_off()
```
You must put a `sig_off()` before the `raise` (or use `try`/`finally`).

I also recommend to doctest these exceptions. The doctesting framework catches such invalid use of `sig_on()`.

I also don't like bare `except:` statements. Be explicit and use `except BaseException:` or `except Exception:` instead.



---

archive/issue_comments_176406.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-07T12:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176406",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-08T02:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176407",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176408.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> There is invalid use of `sig_on()` in many places. The following is wrong:\n> \n> ```\n> sig_on()\n> if condition:\n>     raise Exception\n> sig_off()\n> ```\n> You must put a `sig_off()` before the `raise` (or use `try`/`finally`).\n\n\nThanks.  I fixed them.\n\n> I also recommend to doctest these exceptions. The doctesting framework catches such invalid use of `sig_on()`.\n\n\nAll of the instances I found were for problems that we never expect to arise (out of memory errors, etc).  So I don't see a reasonable way to doctest these exceptions.\n\n> I also don't like bare `except:` statements. Be explicit and use `except BaseException:` or `except Exception:` instead.\n\n\nI know.  :-)  I told Julian you didn't like them, but he claimed it was okay since we raised after catching in each case.  Anyway, I've changed them to `except BaseException:`.",
    "created_at": "2014-01-08T02:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176408",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:17 jdemeyer]:
> There is invalid use of `sig_on()` in many places. The following is wrong:
> 
> ```
> sig_on()
> if condition:
>     raise Exception
> sig_off()
> ```
> You must put a `sig_off()` before the `raise` (or use `try`/`finally`).


Thanks.  I fixed them.

> I also recommend to doctest these exceptions. The doctesting framework catches such invalid use of `sig_on()`.


All of the instances I found were for problems that we never expect to arise (out of memory errors, etc).  So I don't see a reasonable way to doctest these exceptions.

> I also don't like bare `except:` statements. Be explicit and use `except BaseException:` or `except Exception:` instead.


I know.  :-)  I told Julian you didn't like them, but he claimed it was okay since we raised after catching in each case.  Anyway, I've changed them to `except BaseException:`.



---

archive/issue_comments_176409.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-08T02:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176409",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176410.json:
```json
{
    "body": "For the record, the Python docs say\n\n    exception BaseException\n\n    The base class for all built-in exceptions. It is not meant to be directly \n    inherited by user-defined classes (for that, use Exception).\n\nNested exception blocks are generally hard to read, quadruply nested exception try/except/finally blocks even more so. Besides the usual advice of breaking long functions up into shorter ones, for the heap cleanup in the face of exceptions make sure that invalid / not yet allocated pointers are NULL. To simplify the cleanup part, `free(NULL)` is a no-op.\n\nThe `for i from 0 <= i <= n` construct is old, Cython nowadays produces the same C code for the (preferred) Python syntax `for i in range(n)`.",
    "created_at": "2014-01-08T07:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176410",
    "user": "https://github.com/vbraun"
}
```

For the record, the Python docs say

    exception BaseException

    The base class for all built-in exceptions. It is not meant to be directly 
    inherited by user-defined classes (for that, use Exception).

Nested exception blocks are generally hard to read, quadruply nested exception try/except/finally blocks even more so. Besides the usual advice of breaking long functions up into shorter ones, for the heap cleanup in the face of exceptions make sure that invalid / not yet allocated pointers are NULL. To simplify the cleanup part, `free(NULL)` is a no-op.

The `for i from 0 <= i <= n` construct is old, Cython nowadays produces the same C code for the (preferred) Python syntax `for i in range(n)`.



---

archive/issue_comments_176411.json:
```json
{
    "body": "Replying to [comment:19 roed]:\n> but he claimed it was okay since we raised after catching in each case.  Anyway, I've changed them to `except BaseException:`.\n\nIt is technically ok in this case. The reason I don't like `except:` is that in almost all cases that I have seen, it was a mistake. If you write `except BaseException:`, it shows that you probably know what you're doing and that it is not a mistake. It is also consistent with \"Explicit is better than implicit\" from the Zen of Python (`import this`).",
    "created_at": "2014-01-08T07:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176411",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 roed]:
> but he claimed it was okay since we raised after catching in each case.  Anyway, I've changed them to `except BaseException:`.

It is technically ok in this case. The reason I don't like `except:` is that in almost all cases that I have seen, it was a mistake. If you write `except BaseException:`, it shows that you probably know what you're doing and that it is not a mistake. It is also consistent with "Explicit is better than implicit" from the Zen of Python (`import this`).



---

archive/issue_comments_176412.json:
```json
{
    "body": "`sig_on()` should be outside the try/finally block (if `sig_on()` raises a `KeyboardInterrupt`, then `sig_off()` should not be called)\n\n```\nsig_on()\ntry:\n    ...\nfinally:\n    sig_off()\n```",
    "created_at": "2014-01-08T08:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176412",
    "user": "https://github.com/jdemeyer"
}
```

`sig_on()` should be outside the try/finally block (if `sig_on()` raises a `KeyboardInterrupt`, then `sig_off()` should not be called)

```
sig_on()
try:
    ...
finally:
    sig_off()
```



---

archive/issue_comments_176413.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-09T17:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176413",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-09T21:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176415.json:
```json
{
    "body": "> Nested exception blocks are generally hard to read, quadruply nested exception try/except/finally blocks even more so. Besides the usual advice of breaking long functions up into shorter ones, for the heap cleanup in the face of exceptions make sure that invalid / not yet allocated pointers are NULL. To simplify the cleanup part, `free(NULL)` is a no-op.\n\n\nWhat about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?",
    "created_at": "2014-01-09T22:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176415",
    "user": "https://github.com/roed314"
}
```

> Nested exception blocks are generally hard to read, quadruply nested exception try/except/finally blocks even more so. Besides the usual advice of breaking long functions up into shorter ones, for the heap cleanup in the face of exceptions make sure that invalid / not yet allocated pointers are NULL. To simplify the cleanup part, `free(NULL)` is a no-op.


What about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?



---

archive/issue_comments_176416.json:
```json
{
    "body": "I've addressed the concerns about `sig_on` and the Cython for loops.  I agree that the super-nested try blocks are ugly, but I don't know how to rewrite it safely without this nesting.",
    "created_at": "2014-01-09T22:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176416",
    "user": "https://github.com/roed314"
}
```

I've addressed the concerns about `sig_on` and the Cython for loops.  I agree that the super-nested try blocks are ugly, but I don't know how to rewrite it safely without this nesting.



---

archive/issue_comments_176417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-09T22:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176417",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176418.json:
```json
{
    "body": "Replying to [comment:25 roed]:\n> What about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?\n\nYes, they will and Sage will crash, or at least could.\nOn Linux you can set _MALLOC_CHECK=3 to ensure (or have a higher probability) it will crash in such cases.",
    "created_at": "2014-01-09T22:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176418",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:25 roed]:
> What about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?

Yes, they will and Sage will crash, or at least could.
On Linux you can set _MALLOC_CHECK=3 to ensure (or have a higher probability) it will crash in such cases.



---

archive/issue_comments_176419.json:
```json
{
    "body": "Replying to [comment:27 jpflori]:\n> Replying to [comment:25 roed]:\n> > What about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?\n\n> Yes, they will and Sage will crash, or at least could.\n> On Linux you can set _MALLOC_CHECK=3 to ensure (or have a higher probability) it will crash in such cases.\n\n\nSo, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.",
    "created_at": "2014-01-09T22:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176419",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:27 jpflori]:
> Replying to [comment:25 roed]:
> > What about things like `mpz_clear`, `fmpz_clear` and `fmpz_poly_clear`?  If `a` is an `fmpz_poly_t` that has not yet had `fmpz_poly_init(a)` run on it, won't `fmpz_poly_clear(a)` be a double free?

> Yes, they will and Sage will crash, or at least could.
> On Linux you can set _MALLOC_CHECK=3 to ensure (or have a higher probability) it will crash in such cases.


So, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.



---

archive/issue_comments_176420.json:
```json
{
    "body": "I'll have a look tomorrow (french time).",
    "created_at": "2014-01-09T22:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176420",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I'll have a look tomorrow (french time).



---

archive/issue_comments_176421.json:
```json
{
    "body": "Replying to [comment:28 roed]:\n> So, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.\n\n\nI had a look at the code and the current code actually is never going to work. The C-level functions like `fmpz_poly_init` and `mpz_init` never raise exceptions. So, the `try`/`except` is pointless. As far as I can tell, there are two kinds of exceptions which can happen: a `MemoryError` in MPIR or a `KeyboardInterrupt`. In both cases, the exception will be raised by `sig_on()` and none of the `except` blocks are executed.\n\nIf you want to be absolutely correct, every single allocation should be wrapped individually in `sig_on()`/`sig_off()`. Example for 2 allocations:\n\n```\nsig_on()\nalloc1()\nsig_off()\n\ntry:\n    sig_on()\n    alloc2()\n    sig_off()\nexcept BaseException:\n    free1()\n    raise\n```\n\nBut at least the very deeply nested block on this ticket is allocating extremely little memory (surely less than 1000 bytes), so why not simply\n\n```\nalloc1()\nalloc2()\n```",
    "created_at": "2014-01-10T07:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176421",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 roed]:
> So, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.


I had a look at the code and the current code actually is never going to work. The C-level functions like `fmpz_poly_init` and `mpz_init` never raise exceptions. So, the `try`/`except` is pointless. As far as I can tell, there are two kinds of exceptions which can happen: a `MemoryError` in MPIR or a `KeyboardInterrupt`. In both cases, the exception will be raised by `sig_on()` and none of the `except` blocks are executed.

If you want to be absolutely correct, every single allocation should be wrapped individually in `sig_on()`/`sig_off()`. Example for 2 allocations:

```
sig_on()
alloc1()
sig_off()

try:
    sig_on()
    alloc2()
    sig_off()
except BaseException:
    free1()
    raise
```

But at least the very deeply nested block on this ticket is allocating extremely little memory (surely less than 1000 bytes), so why not simply

```
alloc1()
alloc2()
```



---

archive/issue_comments_176422.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> Replying to [comment:28 roed]:\n> > So, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.\n\n> \n> I had a look at the code and the current code actually is never going to work. [...]\n\nYou are right. I had misunderstood how `sig_on`/`sig_off` worked.\n\n> But at least the very deeply nested block on this ticket is allocating extremely little memory (surely less than 1000 bytes), so why not simply\n> \n> ```\n> alloc1()\n> alloc2()\n> ```\n\nIs this acceptable? In the unlikely case that this allocation fails because we're out of memory, then sage is going to crash right?",
    "created_at": "2014-01-10T11:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176422",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:30 jdemeyer]:
> Replying to [comment:28 roed]:
> > So, does anyone have suggestions on how to rewrite the ugly nested try blocks in `PowComputer_flint_unram.__cinit__`?  Julian and I couldn't think of a better way to do it that would never have a memory leak or a double free.

> 
> I had a look at the code and the current code actually is never going to work. [...]

You are right. I had misunderstood how `sig_on`/`sig_off` worked.

> But at least the very deeply nested block on this ticket is allocating extremely little memory (surely less than 1000 bytes), so why not simply
> 
> ```
> alloc1()
> alloc2()
> ```

Is this acceptable? In the unlikely case that this allocation fails because we're out of memory, then sage is going to crash right?



---

archive/issue_comments_176423.json:
```json
{
    "body": "Replying to [comment:31 saraedum]:\n> Is this acceptable? In the unlikely case that this allocation fails because we're out of memory, then sage is going to crash right?\n\nWell, at least the very deeply nested allocation in this branch is allocating very little memory. If that already fails, bad things are going to happen anyway.",
    "created_at": "2014-01-10T12:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176423",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:31 saraedum]:
> Is this acceptable? In the unlikely case that this allocation fails because we're out of memory, then sage is going to crash right?

Well, at least the very deeply nested allocation in this branch is allocating very little memory. If that already fails, bad things are going to happen anyway.



---

archive/issue_comments_176424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-12T05:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176425.json:
```json
{
    "body": "Here are two commits; the first has the 11-nested try blocks with \"safe\" memory handling, and the second removes them for code readability.  I'm fine with either approach.",
    "created_at": "2014-01-12T05:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176425",
    "user": "https://github.com/roed314"
}
```

Here are two commits; the first has the 11-nested try blocks with "safe" memory handling, and the second removes them for code readability.  I'm fine with either approach.



---

archive/issue_comments_176426.json:
```json
{
    "body": "This comment is wrong:\n\n```\nWhile the following allocations have the potential to leak\nsmall amounts of memory when interrupted or when one of the\ninit methods raises a MemoryError\n```\n\nIf you don't have `sig_on()`, the code cannot be interrupted (unless it's called from within `sig_on()`, but that would not be a good idea). It also cannot raise a `MemoryError`, since there is no `sig_on()` to raise them. Instead of a `MemoryError`, Sage would simply crash hard.",
    "created_at": "2014-01-13T09:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176426",
    "user": "https://github.com/jdemeyer"
}
```

This comment is wrong:

```
While the following allocations have the potential to leak
small amounts of memory when interrupted or when one of the
init methods raises a MemoryError
```

If you don't have `sig_on()`, the code cannot be interrupted (unless it's called from within `sig_on()`, but that would not be a good idea). It also cannot raise a `MemoryError`, since there is no `sig_on()` to raise them. Instead of a `MemoryError`, Sage would simply crash hard.



---

archive/issue_comments_176427.json:
```json
{
    "body": "Replying to [comment:35 jdemeyer]:\n\n> If you don't have `sig_on()`, the code cannot be interrupted (unless it's called from within `sig_on()`, but that would not be a good idea). It also cannot raise a `MemoryError`, since there is no `sig_on()` to raise them. Instead of a `MemoryError`, Sage would simply crash hard.\n\n\nSo the whole block of allocations should be wrapped in a single `sig_on()`/`sig_off()`?",
    "created_at": "2014-01-13T10:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176427",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:35 jdemeyer]:

> If you don't have `sig_on()`, the code cannot be interrupted (unless it's called from within `sig_on()`, but that would not be a good idea). It also cannot raise a `MemoryError`, since there is no `sig_on()` to raise them. Instead of a `MemoryError`, Sage would simply crash hard.


So the whole block of allocations should be wrapped in a single `sig_on()`/`sig_off()`?



---

archive/issue_comments_176428.json:
```json
{
    "body": "Replying to [comment:36 roed]:\n> So the whole block of allocations should be wrapped in a single `sig_on()`/`sig_off()`?\n\nIn that case, memory leaks are possible and the comment would be 100% correct.",
    "created_at": "2014-01-13T10:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176428",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:36 roed]:
> So the whole block of allocations should be wrapped in a single `sig_on()`/`sig_off()`?

In that case, memory leaks are possible and the comment would be 100% correct.



---

archive/issue_comments_176429.json:
```json
{
    "body": "I see that there is some smartness added to sage_mpir_malloc/... functions in src/c_lib/memory.c, and these functions are hopefully called when mpir_init is (instead of plain malloc/...).\n\nBut as far as I now, nothing similar was done for flint, and if that's the case, a failed memory allocation would go undetected anyway (and Sage crash quite quickly with null pointer dereference or similar delicious stuff).\n\nI just looked at flint memory allocation code (flfint_malloc/...), and a failed allocation by malloc would call the flint_memory_error function which calls abort().",
    "created_at": "2014-01-13T10:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176429",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I see that there is some smartness added to sage_mpir_malloc/... functions in src/c_lib/memory.c, and these functions are hopefully called when mpir_init is (instead of plain malloc/...).

But as far as I now, nothing similar was done for flint, and if that's the case, a failed memory allocation would go undetected anyway (and Sage crash quite quickly with null pointer dereference or similar delicious stuff).

I just looked at flint memory allocation code (flfint_malloc/...), and a failed allocation by malloc would call the flint_memory_error function which calls abort().



---

archive/issue_comments_176430.json:
```json
{
    "body": "Replying to [comment:38 jpflori]:\n> I just looked at flint memory allocation code (flfint_malloc/...), and a failed allocation by malloc would call the flint_memory_error function which calls abort().\n\nThat's great because (unlike MPIR which silenty ignores memory errors) an `abort()` within `sig_on()` yields a `RuntimeError` which can safely be handled.",
    "created_at": "2014-01-13T10:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176430",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:38 jpflori]:
> I just looked at flint memory allocation code (flfint_malloc/...), and a failed allocation by malloc would call the flint_memory_error function which calls abort().

That's great because (unlike MPIR which silenty ignores memory errors) an `abort()` within `sig_on()` yields a `RuntimeError` which can safely be handled.



---

archive/issue_comments_176431.json:
```json
{
    "body": "Why not increment the `__allocated` counter after every successful allocation and use its value in `__dealloc__()` to decide which objects have to be deallocated?  E.g.\n\n```python\ndef __cinit__(self, ...):\n    sig_on()\n    self.__allocated = 0\n    fmpz_init(self.fmpz_ccmp); self.__allocated++\n    fmpz_init(self.fmpz_cval); self.__allocated++\n    ...\n    fmpz_poly_init(self.poly_cconv); self.__allocated++\n    fmpz_poly_init(self.poly_ctm); self.__allocated++\n    ...\n    sig_off()\n\ndef __dealloc__(self, ...):\n    if self.__allocated >= 1:\n        fmpz_clear(self.fmpz_ccmp)\n    if self.__allocated >= 2:\n        fmpz_clear(self.fmpz_cval)\n    ...\n```\nI hope I'm understanding the problem correctly; I'm just looking at the code and didn't follow the above discussion very closely.",
    "created_at": "2014-01-13T14:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176431",
    "user": "https://github.com/pjbruin"
}
```

Why not increment the `__allocated` counter after every successful allocation and use its value in `__dealloc__()` to decide which objects have to be deallocated?  E.g.

```python
def __cinit__(self, ...):
    sig_on()
    self.__allocated = 0
    fmpz_init(self.fmpz_ccmp); self.__allocated++
    fmpz_init(self.fmpz_cval); self.__allocated++
    ...
    fmpz_poly_init(self.poly_cconv); self.__allocated++
    fmpz_poly_init(self.poly_ctm); self.__allocated++
    ...
    sig_off()

def __dealloc__(self, ...):
    if self.__allocated >= 1:
        fmpz_clear(self.fmpz_ccmp)
    if self.__allocated >= 2:
        fmpz_clear(self.fmpz_cval)
    ...
```
I hope I'm understanding the problem correctly; I'm just looking at the code and didn't follow the above discussion very closely.



---

archive/issue_comments_176432.json:
```json
{
    "body": "For that to work properly, `self.__allocated` should have type `volatile int`.",
    "created_at": "2014-01-13T14:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176432",
    "user": "https://github.com/jdemeyer"
}
```

For that to work properly, `self.__allocated` should have type `volatile int`.



---

archive/issue_comments_176433.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> For that to work properly, `self.__allocated` should have type `volatile int`.\n\nOK, I can believe that.  Does Cython support `volatile`?",
    "created_at": "2014-01-13T14:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176433",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:41 jdemeyer]:
> For that to work properly, `self.__allocated` should have type `volatile int`.

OK, I can believe that.  Does Cython support `volatile`?



---

archive/issue_comments_176434.json:
```json
{
    "body": "Replying to [comment:42 pbruin]:\n> Replying to [comment:41 jdemeyer]:\n> > For that to work properly, `self.__allocated` should have type `volatile int`.\n\n> OK, I can believe that.  Does Cython support `volatile`?\nNot directly, as far as I know. You can do\n\n```\ncdef extern from *:\n    ctypedef int volatile_int \"volatile int\"\n```\nand then use `volatile_int`.",
    "created_at": "2014-01-13T14:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176434",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:42 pbruin]:
> Replying to [comment:41 jdemeyer]:
> > For that to work properly, `self.__allocated` should have type `volatile int`.

> OK, I can believe that.  Does Cython support `volatile`?
Not directly, as far as I know. You can do

```
cdef extern from *:
    ctypedef int volatile_int "volatile int"
```
and then use `volatile_int`.



---

archive/issue_comments_176435.json:
```json
{
    "body": "Agree with the volatile being necessary so that the optimizer doesn't combine the increments into a single += n. But afaik it would still be legal for the optimizer to reorder statements as \n\n```python\n    self.__allocated++\n    self.__allocated++\n    ...\n    self.__allocated++\n    fmpz_init(self.fmpz_ccmp)\n    fmpz_init(self.fmpz_cval)\n    ...\n    fmpz_poly_init(self.poly_ctm)\n```\nSo either mark everything that needs to be accessed in-order as volatile. Or use the usual pattern \n\n```python\ndef __cinit__(self, ...):\n    self.fmpz_ccmp = NULL\n    self.fmpz_cval = NULL\n    sig_on()\n    fmpz_init(self.fmpz_ccmp)\n    fmpz_init(self.fmpz_cval)\n    sig_off()\n\ndef __dealloc__(self, ...):\n    if self.fmpz_ccmp != NULL:\n        fmpz_clear(self.fmpz_ccmp)\n    if self.fmpz_ccval != NULL:\n        fmpz_clear(self.fmpz_ccval)\n```",
    "created_at": "2014-01-13T16:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176435",
    "user": "https://github.com/vbraun"
}
```

Agree with the volatile being necessary so that the optimizer doesn't combine the increments into a single += n. But afaik it would still be legal for the optimizer to reorder statements as 

```python
    self.__allocated++
    self.__allocated++
    ...
    self.__allocated++
    fmpz_init(self.fmpz_ccmp)
    fmpz_init(self.fmpz_cval)
    ...
    fmpz_poly_init(self.poly_ctm)
```
So either mark everything that needs to be accessed in-order as volatile. Or use the usual pattern 

```python
def __cinit__(self, ...):
    self.fmpz_ccmp = NULL
    self.fmpz_cval = NULL
    sig_on()
    fmpz_init(self.fmpz_ccmp)
    fmpz_init(self.fmpz_cval)
    sig_off()

def __dealloc__(self, ...):
    if self.fmpz_ccmp != NULL:
        fmpz_clear(self.fmpz_ccmp)
    if self.fmpz_ccval != NULL:
        fmpz_clear(self.fmpz_ccval)
```



---

archive/issue_comments_176436.json:
```json
{
    "body": "I guess that can still be broken by creative reordering of the pointer initialization, so to be 100% safe one would need to split the setting to NULL from the `fmpz_init` either by  \n1. a compiler barrier (`asm volatile(\"\" ::: \"memory\")` in gcc) \n2. move the `fmpz_init` into `__init__`\n3. RAII (separate classes for each `fmpz_poly_t`)",
    "created_at": "2014-01-13T17:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176436",
    "user": "https://github.com/vbraun"
}
```

I guess that can still be broken by creative reordering of the pointer initialization, so to be 100% safe one would need to split the setting to NULL from the `fmpz_init` either by  
1. a compiler barrier (`asm volatile("" ::: "memory")` in gcc) 
2. move the `fmpz_init` into `__init__`
3. RAII (separate classes for each `fmpz_poly_t`)



---

archive/issue_comments_176437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T07:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_040488.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40488"
}
```



---

archive/issue_events_040489.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40489"
}
```



---

archive/issue_comments_176438.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-01T16:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176438",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176439.json:
```json
{
    "body": "I merged the latest development branch (conflicts in `sage/rings/padics/factory.py` and `sage/rings/padics/pow_computer.pyx`), and then got this error while compiling:\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\n\n        fmpz_poly_content(prime_pow.fmpz_cinv, a)\n        fmpz_poly_scalar_divexact_fmpz(out, a, prime_pow.fmpz_cinv)\n\n        fmpz_poly_xgcd(prime_pow.fmpz_cinv2, out, prime_pow.poly_cinv2, out, prime_pow.poly_cinv)\n        if fmpz_is_zero(prime_pow.cinv2): raise ValueError(\"polynomials are not coprime\")\n                                ^\n------------------------------------------------------------\n\n./sage/libs/linkages/padics/fmpz_poly_unram.pxi:343:33: Cannot convert Python object to 'fmpz_t'\n```",
    "created_at": "2014-05-01T16:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176439",
    "user": "https://github.com/pjbruin"
}
```

I merged the latest development branch (conflicts in `sage/rings/padics/factory.py` and `sage/rings/padics/pow_computer.pyx`), and then got this error while compiling:

```
Error compiling Cython file:
------------------------------------------------------------
...

        fmpz_poly_content(prime_pow.fmpz_cinv, a)
        fmpz_poly_scalar_divexact_fmpz(out, a, prime_pow.fmpz_cinv)

        fmpz_poly_xgcd(prime_pow.fmpz_cinv2, out, prime_pow.poly_cinv2, out, prime_pow.poly_cinv)
        if fmpz_is_zero(prime_pow.cinv2): raise ValueError("polynomials are not coprime")
                                ^
------------------------------------------------------------

./sage/libs/linkages/padics/fmpz_poly_unram.pxi:343:33: Cannot convert Python object to 'fmpz_t'
```



---

archive/issue_events_040490.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40490"
}
```



---

archive/issue_events_040491.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40491"
}
```



---

archive/issue_comments_176440.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd59\".",
    "created_at": "2014-06-25T22:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176440",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "sd59".



---

archive/issue_comments_176441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-25T22:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176441",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176442.json:
```json
{
    "body": "I'm happy with the changes roed made since my last `positive_review`. So from my point of view this could go back to `positive_review` once somebody reviewed my few changes and if the patchbot is happy.\n\n---\nNew commits:",
    "created_at": "2014-06-25T22:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176442",
    "user": "https://github.com/saraedum"
}
```

I'm happy with the changes roed made since my last `positive_review`. So from my point of view this could go back to `positive_review` once somebody reviewed my few changes and if the patchbot is happy.

---
New commits:



---

archive/issue_comments_176443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-26T05:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176444.json:
```json
{
    "body": "I hope that this fixes all the bugs the patchbot detected.",
    "created_at": "2014-06-26T05:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176444",
    "user": "https://github.com/saraedum"
}
```

I hope that this fixes all the bugs the patchbot detected.



---

archive/issue_comments_176445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-26T06:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176446.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-26T09:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176446",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_040492.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40492"
}
```



---

archive/issue_events_040493.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40493"
}
```



---

archive/issue_comments_176447.json:
```json
{
    "body": "needs rebase",
    "created_at": "2014-08-25T09:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176447",
    "user": "https://github.com/fchapoton"
}
```

needs rebase



---

archive/issue_comments_176448.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-25T09:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176448",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-27T01:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-10-27T08:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_176451.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-31T20:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176451",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176452.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T01:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176453.json:
```json
{
    "body": "Just a few technical comments (I don't plan to formally review this):\n1. You don't need to add `include_dirs = [SAGE_INC + '/flint']` (just add `flint/` to the path to the `.h` files)\n2. You don't need to add `__richcmp__` calling `_richcmp`\n3. You don't need to add `__hash__` which just raises `TypeError`: all `Element`s are now unhashable by default.\n4. For consistency with other `.pxd` files, could you move all declarations of FLINT types to `sage/libs/flint/types.pxd`?\n5. In this block\n\n```\n            try:\n                padic_ctx_init(self.ctx, self.fprime, 0, prec_cap, PADIC_SERIES)\n            except:\n                mpz_clear(self.top_power)\n                raise\n```\ngiven that `padic_ctx_init` is a C function, how could it ever raise a Python exception? Moreover, I find it bad style to use `except:`, you should be more explicit and catch `except BaseException:` instead (the reason I say this is because most people write `except:` by mistake).",
    "created_at": "2015-11-05T07:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176453",
    "user": "https://github.com/jdemeyer"
}
```

Just a few technical comments (I don't plan to formally review this):
1. You don't need to add `include_dirs = [SAGE_INC + '/flint']` (just add `flint/` to the path to the `.h` files)
2. You don't need to add `__richcmp__` calling `_richcmp`
3. You don't need to add `__hash__` which just raises `TypeError`: all `Element`s are now unhashable by default.
4. For consistency with other `.pxd` files, could you move all declarations of FLINT types to `sage/libs/flint/types.pxd`?
5. In this block

```
            try:
                padic_ctx_init(self.ctx, self.fprime, 0, prec_cap, PADIC_SERIES)
            except:
                mpz_clear(self.top_power)
                raise
```
given that `padic_ctx_init` is a C function, how could it ever raise a Python exception? Moreover, I find it bad style to use `except:`, you should be more explicit and catch `except BaseException:` instead (the reason I say this is because most people write `except:` by mistake).



---

archive/issue_comments_176454.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T08:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176455.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-14T01:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176456.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-19T18:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176457.json:
```json
{
    "body": "Why this change?\n\n```diff\ndiff --git a/src/sage/algebras/quatalg/quaternion_algebra_element.pyx b/src/sage/algebras/quatalg/quaternion_algebra_element.pyx\nindex 03470ef..c5620e1 100644\n--- a/src/sage/algebras/quatalg/quaternion_algebra_element.pyx\n+++ b/src/sage/algebras/quatalg/quaternion_algebra_element.pyx\n@@ -18,6 +18,9 @@ quaternion algebras and quaternion algebras over number fields.\n #                  http://www.gnu.org/licenses/\n #*****************************************************************************\n \n+from sage.libs.flint.fmpz cimport *\n+from sage.libs.flint.fmpz_poly cimport *\n+from sage.libs.flint.ntl_interface cimport *\n from sage.structure.element cimport AlgebraElement, RingElement, ModuleElement, Element\n from sage.algebras.quatalg.quaternion_algebra_element cimport QuaternionAlgebraElement_abstract\n from sage.rings.rational cimport Rational\n```",
    "created_at": "2015-11-19T19:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176457",
    "user": "https://github.com/jdemeyer"
}
```

Why this change?

```diff
diff --git a/src/sage/algebras/quatalg/quaternion_algebra_element.pyx b/src/sage/algebras/quatalg/quaternion_algebra_element.pyx
index 03470ef..c5620e1 100644
--- a/src/sage/algebras/quatalg/quaternion_algebra_element.pyx
+++ b/src/sage/algebras/quatalg/quaternion_algebra_element.pyx
@@ -18,6 +18,9 @@ quaternion algebras and quaternion algebras over number fields.
 #                  http://www.gnu.org/licenses/
 #*****************************************************************************
 
+from sage.libs.flint.fmpz cimport *
+from sage.libs.flint.fmpz_poly cimport *
+from sage.libs.flint.ntl_interface cimport *
 from sage.structure.element cimport AlgebraElement, RingElement, ModuleElement, Element
 from sage.algebras.quatalg.quaternion_algebra_element cimport QuaternionAlgebraElement_abstract
 from sage.rings.rational cimport Rational
```



---

archive/issue_comments_176458.json:
```json
{
    "body": "There are also some strange added imports in `src/sage/rings/polynomial/...`",
    "created_at": "2015-11-19T19:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176458",
    "user": "https://github.com/jdemeyer"
}
```

There are also some strange added imports in `src/sage/rings/polynomial/...`



---

archive/issue_comments_176459.json:
```json
{
    "body": "Similarly:\n\n```diff\ndiff --git a/src/sage/libs/flint/ntl_interface.pxd b/src/sage/libs/flint/ntl_interface.pxd\nindex 7cea729..6b88b9b 100644\n--- a/src/sage/libs/flint/ntl_interface.pxd\n+++ b/src/sage/libs/flint/ntl_interface.pxd\n@@ -2,6 +2,8 @@ from types cimport fmpz_t, fmpz_poly_t\n \n from sage.libs.ntl.ntl_ZZ_decl cimport ZZ_c\n from sage.libs.ntl.ntl_ZZX_decl cimport ZZX_c\n+from sage.libs.flint.fmpz cimport fmpz_t\n+from sage.libs.flint.fmpz_poly cimport fmpz_poly_t\n \n cdef extern from \"flint/NTL-interface.h\":\n     void fmpz_poly_get_ZZX(ZZX_c output, fmpz_poly_t poly)\n```",
    "created_at": "2015-11-19T19:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176459",
    "user": "https://github.com/jdemeyer"
}
```

Similarly:

```diff
diff --git a/src/sage/libs/flint/ntl_interface.pxd b/src/sage/libs/flint/ntl_interface.pxd
index 7cea729..6b88b9b 100644
--- a/src/sage/libs/flint/ntl_interface.pxd
+++ b/src/sage/libs/flint/ntl_interface.pxd
@@ -2,6 +2,8 @@ from types cimport fmpz_t, fmpz_poly_t
 
 from sage.libs.ntl.ntl_ZZ_decl cimport ZZ_c
 from sage.libs.ntl.ntl_ZZX_decl cimport ZZX_c
+from sage.libs.flint.fmpz cimport fmpz_t
+from sage.libs.flint.fmpz_poly cimport fmpz_poly_t
 
 cdef extern from "flint/NTL-interface.h":
     void fmpz_poly_get_ZZX(ZZX_c output, fmpz_poly_t poly)
```



---

archive/issue_comments_176460.json:
```json
{
    "body": "These imports happened because we fixed flint build errors by importing the necessary symbols. We just imported them in different places than what got into develop did. So the merge did not catch this conflict it seems.\nThanks for pointing these out.",
    "created_at": "2015-11-21T18:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176460",
    "user": "https://github.com/saraedum"
}
```

These imports happened because we fixed flint build errors by importing the necessary symbols. We just imported them in different places than what got into develop did. So the merge did not catch this conflict it seems.
Thanks for pointing these out.



---

archive/issue_comments_176461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T18:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176462.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-21T20:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176463.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-23T18:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176464.json:
```json
{
    "body": "Conflicts with 6.10.beta6. If you fix this conflict, I can easily merge #19646.",
    "created_at": "2015-11-29T21:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176464",
    "user": "https://github.com/jdemeyer"
}
```

Conflicts with 6.10.beta6. If you fix this conflict, I can easily merge #19646.



---

archive/issue_comments_176465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-17T04:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-22T05:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176467.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-22T05:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176467",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176468.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-12-23T18:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176468",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176469.json:
```json
{
    "body": "All doctests in `rings/` now pass (have not checked with `--long`.)",
    "created_at": "2015-12-23T18:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176469",
    "user": "https://github.com/saraedum"
}
```

All doctests in `rings/` now pass (have not checked with `--long`.)



---

archive/issue_comments_176470.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-23T18:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_040494.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-23T18:21:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40494"
}
```



---

archive/issue_events_040495.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-12-23T18:21:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40495"
}
```



---

archive/issue_comments_176471.json:
```json
{
    "body": "See [comment:63]",
    "created_at": "2015-12-23T19:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176471",
    "user": "https://github.com/jdemeyer"
}
```

See [comment:63]



---

archive/issue_comments_176472.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-12-23T19:26:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176472",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176473.json:
```json
{
    "body": "Avoid `cdefs.pxi`, just `cimport` whatever you need.",
    "created_at": "2015-12-23T19:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176473",
    "user": "https://github.com/jdemeyer"
}
```

Avoid `cdefs.pxi`, just `cimport` whatever you need.



---

archive/issue_comments_176474.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-09T05:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176475.json:
```json
{
    "body": "Replying to [comment:63 jdemeyer]:\n> 1. You don't need to add `include_dirs = [SAGE_INC + '/flint']` (just add `flint/` to the path to the `.h` files)\n  \nFixed in [ab07bc41a76f58c6063c5e7a9ab8b4add7bc4f6a](http://git.sagemath.org/sage.git/commit/?id=ab07bc41a76f58c6063c5e7a9ab8b4add7bc4f6a).\n> 2. You don't need to add `__richcmp__` calling `_richcmp`\n  \nFixed in [2a1f29345297da21ffe14c47e39faa1ac76eda5a](http://git.sagemath.org/sage.git/commit/?id=2a1f29345297da21ffe14c47e39faa1ac76eda5a).\n> 3. You don't need to add `__hash__` which just raises `TypeError`: all `Element`s are now unhashable by default.\n  \nI actually do need this implementation to override the base class. Adressed in [2a1f29345297da21ffe14c47e39faa1ac76eda5a](http://git.sagemath.org/sage.git/commit/?id=2a1f29345297da21ffe14c47e39faa1ac76eda5a).\n> 4. For consistency with other `.pxd` files, could you move all declarations of FLINT types to `sage/libs/flint/types.pxd`?\n  \nI believe that this has happened by now.\n> 5. In this block\n> \n> ```\n>             try:\n>                 padic_ctx_init(self.ctx, self.fprime, 0, prec_cap, PADIC_SERIES)\n>             except:\n>                 mpz_clear(self.top_power)\n>                 raise\n> ```\n> given that `padic_ctx_init` is a C function, how could it ever raise a Python exception? Moreover, \n> I find it bad style to use `except:`, you should be more explicit and catch `except BaseException:` instead (the reason I say this is because most people write `except:` by mistake).\n\nBoth fixed in [860366d0bf36e8684c97f5bd5d3e336e79f5795d](http://git.sagemath.org/sage.git/commit/?id=860366d0bf36e8684c97f5bd5d3e336e79f5795d).\n\n---\nNew commits:",
    "created_at": "2016-01-09T05:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176475",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:63 jdemeyer]:
> 1. You don't need to add `include_dirs = [SAGE_INC + '/flint']` (just add `flint/` to the path to the `.h` files)
  
Fixed in [ab07bc41a76f58c6063c5e7a9ab8b4add7bc4f6a](http://git.sagemath.org/sage.git/commit/?id=ab07bc41a76f58c6063c5e7a9ab8b4add7bc4f6a).
> 2. You don't need to add `__richcmp__` calling `_richcmp`
  
Fixed in [2a1f29345297da21ffe14c47e39faa1ac76eda5a](http://git.sagemath.org/sage.git/commit/?id=2a1f29345297da21ffe14c47e39faa1ac76eda5a).
> 3. You don't need to add `__hash__` which just raises `TypeError`: all `Element`s are now unhashable by default.
  
I actually do need this implementation to override the base class. Adressed in [2a1f29345297da21ffe14c47e39faa1ac76eda5a](http://git.sagemath.org/sage.git/commit/?id=2a1f29345297da21ffe14c47e39faa1ac76eda5a).
> 4. For consistency with other `.pxd` files, could you move all declarations of FLINT types to `sage/libs/flint/types.pxd`?
  
I believe that this has happened by now.
> 5. In this block
> 
> ```
>             try:
>                 padic_ctx_init(self.ctx, self.fprime, 0, prec_cap, PADIC_SERIES)
>             except:
>                 mpz_clear(self.top_power)
>                 raise
> ```
> given that `padic_ctx_init` is a C function, how could it ever raise a Python exception? Moreover, 
> I find it bad style to use `except:`, you should be more explicit and catch `except BaseException:` instead (the reason I say this is because most people write `except:` by mistake).

Both fixed in [860366d0bf36e8684c97f5bd5d3e336e79f5795d](http://git.sagemath.org/sage.git/commit/?id=860366d0bf36e8684c97f5bd5d3e336e79f5795d).

---
New commits:



---

archive/issue_comments_176476.json:
```json
{
    "body": "Replying to [comment:83 jdemeyer]:\n> Avoid `cdefs.pxi`, just `cimport` whatever you need.\n\nFixed.",
    "created_at": "2016-01-09T05:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176476",
    "user": "https://github.com/saraedum"
}
```

Replying to [comment:83 jdemeyer]:
> Avoid `cdefs.pxi`, just `cimport` whatever you need.

Fixed.



---

archive/issue_comments_176477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-09T05:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176478.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-09T05:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176478",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176479.json:
```json
{
    "body": "I just corrected a raise statement. There seems to be many failing doctests.\n\n---\nNew commits:",
    "created_at": "2016-03-21T15:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176479",
    "user": "https://github.com/fchapoton"
}
```

I just corrected a raise statement. There seems to be many failing doctests.

---
New commits:



---

archive/issue_events_040496.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-21T15:30:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40496"
}
```



---

archive/issue_events_040497.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-21T15:30:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40497"
}
```



---

archive/issue_comments_176480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-21T15:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176481.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-21T16:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176481",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176482.json:
```json
{
    "body": "On line 494 in sage/local/lib/python2.7/site-packages/sage/rings/padics/factory.py, you need to break the line using parenthesis.\n\n```\n\naly@aly-laptop:~/Sage/sage$ ./sage -t src/sage\nTraceback (most recent call last):\n  File \"/home/aly/Sage/sage/src/bin/sage-runtests\", line 80, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 30, in <module>\n    from sources import FileDocTestSource, DictAsObject\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py\", line 27, in <module>\n    from parsing import SageDocTestParser\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py\", line 49, in <module>\n    from sage.all import RealIntervalField\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/all.py\", line 100, in <module>\n    from sage.rings.all      import *\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/all.py\", line 62, in <module>\n    from padics.all import *\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/padics/all.py\", line 2, in <module>\n    from factory import Zp, Zq, Zp as pAdicRing, ZpCR, ZpCA, ZpFM, ZqCR, ZqCA, ZqFM #, ZpL, ZqL\n  File \"/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/padics/factory.py\", line 494\n    if version[0] < 4 or (len(version) > 1 and version[0] == 4 and version[1] < 5) or\n                                                                                    ^\nSyntaxError: invalid syntax\n\n\n```",
    "created_at": "2016-03-21T16:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176482",
    "user": "https://github.com/adeines"
}
```

On line 494 in sage/local/lib/python2.7/site-packages/sage/rings/padics/factory.py, you need to break the line using parenthesis.

```

aly@aly-laptop:~/Sage/sage$ ./sage -t src/sage
Traceback (most recent call last):
  File "/home/aly/Sage/sage/src/bin/sage-runtests", line 80, in <module>
    from sage.doctest.control import DocTestController
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 30, in <module>
    from sources import FileDocTestSource, DictAsObject
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 27, in <module>
    from parsing import SageDocTestParser
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 49, in <module>
    from sage.all import RealIntervalField
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/all.py", line 100, in <module>
    from sage.rings.all      import *
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/all.py", line 62, in <module>
    from padics.all import *
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/padics/all.py", line 2, in <module>
    from factory import Zp, Zq, Zp as pAdicRing, ZpCR, ZpCA, ZpFM, ZqCR, ZqCA, ZqFM #, ZpL, ZqL
  File "/home/aly/Sage/sage/local/lib/python2.7/site-packages/sage/rings/padics/factory.py", line 494
    if version[0] < 4 or (len(version) > 1 and version[0] == 4 and version[1] < 5) or
                                                                                    ^
SyntaxError: invalid syntax


```



---

archive/issue_comments_176483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-21T16:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176484.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-21T16:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176484",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176485.json:
```json
{
    "body": "Fixed",
    "created_at": "2016-03-21T16:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176485",
    "user": "https://github.com/roed314"
}
```

Fixed



---

archive/issue_comments_176486.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-21T17:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176486",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_176487.json:
```json
{
    "body": "Needs to be rebased on top of #20210.",
    "created_at": "2016-03-21T17:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176487",
    "user": "https://github.com/jdemeyer"
}
```

Needs to be rebased on top of #20210.



---

archive/issue_comments_176488.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-22T00:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-22T01:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176490.json:
```json
{
    "body": "Okay, I think I rebased it, but there are a ton of doctest errors that have nothing to do with p-adics.  I'm not sure what's going on.\n\n```\nsage -t src/sage/combinat/root_system/root_lattice_realizations.py  # 1 doctest failed\nsage -t src/sage/combinat/designs/database.py  # 2 doctests failed\nsage -t src/sage/geometry/polyhedron/base.py  # 2 doctests failed\nsage -t src/sage/graphs/generic_graph.py  # 94 doctests failed\nsage -t src/sage/graphs/graph.py  # 46 doctests failed\nsage -t src/sage/doctest/forker.py  # 1 doctest failed\nsage -t src/sage/schemes/generic/algebraic_scheme.py  # 10 doctests failed\nsage -t src/sage/graphs/generators/smallgraphs.py  # 18 doctests failed\nsage -t src/sage/tests/cmdline.py  # 14 doctests failed\nsage -t src/sage/structure/sage_object.pyx  # 4 doctests failed\nsage -t src/sage/combinat/rigged_configurations/rigged_configuration_element.py  # 1 doctest failed\nsage -t src/sage/schemes/toric/points.py  # 1 doctest failed\nsage -t src/sage/combinat/posets/posets.py  # 5 doctests failed\nsage -t src/sage/interfaces/sage0.py  # 1 doctest failed\nsage -t src/sage/combinat/designs/orthogonal_arrays.py  # 8 doctests failed\nsage -t src/sage/graphs/generators/families.py  # 4 doctests failed\nsage -t src/sage/geometry/cone.py  # 3 doctests failed\nsage -t src/sage/combinat/rigged_configurations/rigged_configurations.py  # 1 doctest failed\nsage -t src/sage/combinat/designs/orthogonal_arrays_build_recursive.py  # 13 doctests failed\nsage -t src/sage/matroids/matroid.pyx  # 1 doctest failed\nsage -t src/sage/repl/interpreter.py  # 22 doctests failed\nsage -t src/sage/structure/misc.pyx  # 1 doctest failed\nsage -t src/sage/combinat/designs/incidence_structures.py  # 10 doctests failed\nsage -t src/sage/numerical/optimize.py  # 6 doctests failed\nsage -t src/sage/combinat/rigged_configurations/rc_infinity.py  # 1 doctest failed\nsage -t src/sage/graphs/comparability.pyx  # 6 doctests failed\nsage -t src/sage/graphs/generators/basic.py  # 1 doctest failed\nsage -t src/sage/repl/ipython_extension.py  # 9 doctests failed\nsage -t src/sage/repl/attach.py  # 2 doctests failed\nsage -t src/sage/graphs/digraph.py  # 4 doctests failed\nsage -t src/sage/typeset/ascii_art.py  # 2 doctests failed\nsage -t src/sage/numerical/mip.pyx  # 486 doctests failed\nsage -t src/sage/tests/french_book/nonlinear_doctest.py  # 1 doctest failed\nsage -t src/sage/interacts/debugger.py  # 1 doctest failed\nsage -t src/sage/repl/display/formatter.py  # 10 doctests failed\nsage -t src/sage/combinat/designs/bibd.py  # 19 doctests failed\nsage -t src/sage/repl/inputhook.pyx  # 2 doctests failed\nsage -t src/sage/misc/temporary_file.py  # 1 doctest failed\nsage -t src/sage/doctest/test.py  # 1 doctest failed\nsage -t src/sage/repl/interface_magic.py  # 3 doctests failed\nsage -t src/sage/dev/trac_interface.py  # 1 doctest failed\nsage -t src/doc/en/thematic_tutorials/lie/infinity_crystals.rst  # 1 doctest failed\nsage -t src/sage/combinat/posets/poset_examples.py  # 1 doctest failed\nsage -t src/sage/repl/ipython_tests.py  # 4 doctests failed\nsage -t src/sage/combinat/designs/orthogonal_arrays_find_recursive.pyx  # 2 doctests failed\nsage -t src/sage/graphs/graph_decompositions/vertex_separation.pyx  # 7 doctests failed\nsage -t src/sage/numerical/backends/glpk_backend.pyx  # 470 doctests failed\nsage -t src/sage/combinat/integer_vector.py  # 5 doctests failed\nsage -t src/sage/numerical/linear_functions.pyx  # 212 doctests failed\nsage -t src/sage/combinat/rigged_configurations/rc_crystal.py  # 1 doctest failed\nsage -t src/sage/combinat/shard_order.py  # 1 doctest failed\nsage -t src/sage/graphs/generators/degree_sequence.py  # 3 doctests failed\nsage -t src/sage/repl/rich_output/backend_ipython.py  # 3 doctests failed\nsage -t src/sage/numerical/linear_tensor_element.pyx  # 50 doctests failed\nsage -t src/doc/en/thematic_tutorials/numerical_sage/weave.rst  # 1 doctest failed\nsage -t src/sage/numerical/linear_tensor_constraints.py  # 46 doctests failed\nsage -t src/sage/numerical/backends/cvxopt_backend.pyx  # 10 doctests failed\nsage -t src/sage/numerical/linear_tensor.py  # 57 doctests failed\nsage -t src/sage/repl/ipython_kernel/install.py  # 1 doctest failed\nsage -t src/sage/graphs/generators/chessboard.py  # 1 doctest failed\nsage -t src/doc/en/reference/sat/index.rst  # 4 doctests failed\nsage -t src/sage/numerical/backends/generic_backend.pyx  # 1 doctest failed\nsage -t src/sage/graphs/graph_coloring.py  # 17 doctests failed\nsage -t src/sage/numerical/knapsack.py  # 5 doctests failed\nsage -t src/sage/graphs/hypergraph_generators.py  # 1 doctest failed\nsage -t src/sage/repl/ipython_kernel/kernel.py  # 4 doctests failed\nsage -t src/doc/en/thematic_tutorials/linear_programming.rst  # 35 doctests failed\nsage -t src/sage/sat/solvers/sat_lp.py  # 15 doctests failed\nsage -t src/sage/graphs/graph_decompositions/cutwidth.pyx  # 9 doctests failed\nsage -t src/sage/graphs/convexity_properties.pyx  # 4 doctests failed\nsage -t src/sage/sat/solvers/satsolver.pyx  # 1 doctest failed\nsage -t src/sage/numerical/backends/gurobi_backend.pyx  # 1 doctest failed\n```",
    "created_at": "2016-03-22T01:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176490",
    "user": "https://github.com/roed314"
}
```

Okay, I think I rebased it, but there are a ton of doctest errors that have nothing to do with p-adics.  I'm not sure what's going on.

```
sage -t src/sage/combinat/root_system/root_lattice_realizations.py  # 1 doctest failed
sage -t src/sage/combinat/designs/database.py  # 2 doctests failed
sage -t src/sage/geometry/polyhedron/base.py  # 2 doctests failed
sage -t src/sage/graphs/generic_graph.py  # 94 doctests failed
sage -t src/sage/graphs/graph.py  # 46 doctests failed
sage -t src/sage/doctest/forker.py  # 1 doctest failed
sage -t src/sage/schemes/generic/algebraic_scheme.py  # 10 doctests failed
sage -t src/sage/graphs/generators/smallgraphs.py  # 18 doctests failed
sage -t src/sage/tests/cmdline.py  # 14 doctests failed
sage -t src/sage/structure/sage_object.pyx  # 4 doctests failed
sage -t src/sage/combinat/rigged_configurations/rigged_configuration_element.py  # 1 doctest failed
sage -t src/sage/schemes/toric/points.py  # 1 doctest failed
sage -t src/sage/combinat/posets/posets.py  # 5 doctests failed
sage -t src/sage/interfaces/sage0.py  # 1 doctest failed
sage -t src/sage/combinat/designs/orthogonal_arrays.py  # 8 doctests failed
sage -t src/sage/graphs/generators/families.py  # 4 doctests failed
sage -t src/sage/geometry/cone.py  # 3 doctests failed
sage -t src/sage/combinat/rigged_configurations/rigged_configurations.py  # 1 doctest failed
sage -t src/sage/combinat/designs/orthogonal_arrays_build_recursive.py  # 13 doctests failed
sage -t src/sage/matroids/matroid.pyx  # 1 doctest failed
sage -t src/sage/repl/interpreter.py  # 22 doctests failed
sage -t src/sage/structure/misc.pyx  # 1 doctest failed
sage -t src/sage/combinat/designs/incidence_structures.py  # 10 doctests failed
sage -t src/sage/numerical/optimize.py  # 6 doctests failed
sage -t src/sage/combinat/rigged_configurations/rc_infinity.py  # 1 doctest failed
sage -t src/sage/graphs/comparability.pyx  # 6 doctests failed
sage -t src/sage/graphs/generators/basic.py  # 1 doctest failed
sage -t src/sage/repl/ipython_extension.py  # 9 doctests failed
sage -t src/sage/repl/attach.py  # 2 doctests failed
sage -t src/sage/graphs/digraph.py  # 4 doctests failed
sage -t src/sage/typeset/ascii_art.py  # 2 doctests failed
sage -t src/sage/numerical/mip.pyx  # 486 doctests failed
sage -t src/sage/tests/french_book/nonlinear_doctest.py  # 1 doctest failed
sage -t src/sage/interacts/debugger.py  # 1 doctest failed
sage -t src/sage/repl/display/formatter.py  # 10 doctests failed
sage -t src/sage/combinat/designs/bibd.py  # 19 doctests failed
sage -t src/sage/repl/inputhook.pyx  # 2 doctests failed
sage -t src/sage/misc/temporary_file.py  # 1 doctest failed
sage -t src/sage/doctest/test.py  # 1 doctest failed
sage -t src/sage/repl/interface_magic.py  # 3 doctests failed
sage -t src/sage/dev/trac_interface.py  # 1 doctest failed
sage -t src/doc/en/thematic_tutorials/lie/infinity_crystals.rst  # 1 doctest failed
sage -t src/sage/combinat/posets/poset_examples.py  # 1 doctest failed
sage -t src/sage/repl/ipython_tests.py  # 4 doctests failed
sage -t src/sage/combinat/designs/orthogonal_arrays_find_recursive.pyx  # 2 doctests failed
sage -t src/sage/graphs/graph_decompositions/vertex_separation.pyx  # 7 doctests failed
sage -t src/sage/numerical/backends/glpk_backend.pyx  # 470 doctests failed
sage -t src/sage/combinat/integer_vector.py  # 5 doctests failed
sage -t src/sage/numerical/linear_functions.pyx  # 212 doctests failed
sage -t src/sage/combinat/rigged_configurations/rc_crystal.py  # 1 doctest failed
sage -t src/sage/combinat/shard_order.py  # 1 doctest failed
sage -t src/sage/graphs/generators/degree_sequence.py  # 3 doctests failed
sage -t src/sage/repl/rich_output/backend_ipython.py  # 3 doctests failed
sage -t src/sage/numerical/linear_tensor_element.pyx  # 50 doctests failed
sage -t src/doc/en/thematic_tutorials/numerical_sage/weave.rst  # 1 doctest failed
sage -t src/sage/numerical/linear_tensor_constraints.py  # 46 doctests failed
sage -t src/sage/numerical/backends/cvxopt_backend.pyx  # 10 doctests failed
sage -t src/sage/numerical/linear_tensor.py  # 57 doctests failed
sage -t src/sage/repl/ipython_kernel/install.py  # 1 doctest failed
sage -t src/sage/graphs/generators/chessboard.py  # 1 doctest failed
sage -t src/doc/en/reference/sat/index.rst  # 4 doctests failed
sage -t src/sage/numerical/backends/generic_backend.pyx  # 1 doctest failed
sage -t src/sage/graphs/graph_coloring.py  # 17 doctests failed
sage -t src/sage/numerical/knapsack.py  # 5 doctests failed
sage -t src/sage/graphs/hypergraph_generators.py  # 1 doctest failed
sage -t src/sage/repl/ipython_kernel/kernel.py  # 4 doctests failed
sage -t src/doc/en/thematic_tutorials/linear_programming.rst  # 35 doctests failed
sage -t src/sage/sat/solvers/sat_lp.py  # 15 doctests failed
sage -t src/sage/graphs/graph_decompositions/cutwidth.pyx  # 9 doctests failed
sage -t src/sage/graphs/convexity_properties.pyx  # 4 doctests failed
sage -t src/sage/sat/solvers/satsolver.pyx  # 1 doctest failed
sage -t src/sage/numerical/backends/gurobi_backend.pyx  # 1 doctest failed
```



---

archive/issue_comments_176491.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-22T01:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176491",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_176492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-22T17:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_176493.json:
```json
{
    "body": "Ok, I think I fixed the problems.",
    "created_at": "2016-03-22T17:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176493",
    "user": "https://github.com/roed314"
}
```

Ok, I think I fixed the problems.



---

archive/issue_comments_176494.json:
```json
{
    "body": "I'm getting the same list of doctests failing.  They don't fail on #20210.  This is weird.  I did a clean pull and tested them.  None of them seem to have anything to do with your patch. Are they passing for you?",
    "created_at": "2016-03-22T21:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176494",
    "user": "https://github.com/adeines"
}
```

I'm getting the same list of doctests failing.  They don't fail on #20210.  This is weird.  I did a clean pull and tested them.  None of them seem to have anything to do with your patch. Are they passing for you?



---

archive/issue_comments_176495.json:
```json
{
    "body": "I think mine are passing.  See Prec_Build.term on the project....",
    "created_at": "2016-03-22T22:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176495",
    "user": "https://github.com/roed314"
}
```

I think mine are passing.  See Prec_Build.term on the project....



---

archive/issue_comments_176496.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-23T10:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176496",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_176497.json:
```json
{
    "body": "I updated my development branch and now everything is passing.  It looks good to me! :)",
    "created_at": "2016-03-23T10:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176497",
    "user": "https://github.com/adeines"
}
```

I updated my development branch and now everything is passing.  It looks good to me! :)



---

archive/issue_comments_176498.json:
```json
{
    "body": "Changing keywords from \"sd59\" to \"sd59, sd71\".",
    "created_at": "2016-03-23T15:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176498",
    "user": "https://github.com/adeines"
}
```

Changing keywords from "sd59" to "sd59, sd71".



---

archive/issue_comments_176499.json:
```json
{
    "body": "Changing keywords from \"sd59, sd71\" to \"sd59, days71\".",
    "created_at": "2016-03-23T17:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176499",
    "user": "https://github.com/adeines"
}
```

Changing keywords from "sd59, sd71" to "sd59, days71".



---

archive/issue_comments_176500.json:
```json
{
    "body": "(I was told to be consistent about my last name\u2026)",
    "created_at": "2016-03-23T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176500",
    "user": "https://github.com/saraedum"
}
```

(I was told to be consistent about my last name)



---

archive/issue_events_040498.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-23T23:55:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14304#event-40498"
}
```



---

archive/issue_comments_176501.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-23T23:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14304#issuecomment-176501",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
