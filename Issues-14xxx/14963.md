# Issue 14963: Add functionality for S-units to UnitGroup

archive/issues_014726.json:
```json
{
    "body": "In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.\n\nApply: [attachment:trac_14963-Sunits.patch], [attachment:trac_14963-reviewer.patch]\n\n\nAssignee: @JohnCremona\n\nCC:  mkosters akoutsianas\n\nKeywords: sd51, units, S-units, number fields\n\nReviewer: Peter Bruin\n\nAuthor: John Cremona\n\nMerged: sage-5.13.beta0\n\nDependencies: #14489, #14746, #14519\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14963\n\n",
    "closed_at": "2013-10-02T06:36:24Z",
    "created_at": "2013-07-24T13:44:22Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Add functionality for S-units to UnitGroup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14963",
    "user": "https://github.com/JohnCremona"
}
```
In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.

Apply: [attachment:trac_14963-Sunits.patch], [attachment:trac_14963-reviewer.patch]


Assignee: @JohnCremona

CC:  mkosters akoutsianas

Keywords: sd51, units, S-units, number fields

Reviewer: Peter Bruin

Author: John Cremona

Merged: sage-5.13.beta0

Dependencies: #14489, #14746, #14519

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14963





---

archive/issue_comments_232108.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#14489, #14746\"",
    "created_at": "2013-07-24T14:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232108",
    "user": "https://github.com/JohnCremona"
}
```

Changing dependencies from "" to "#14489, #14746"



---

archive/issue_comments_232109.json:
```json
{
    "body": "Changing keywords from \"units, S-units, number fields\" to \"sd51, units, S-units, number fields\".",
    "created_at": "2013-07-25T07:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232109",
    "user": "https://github.com/JohnCremona"
}
```

Changing keywords from "units, S-units, number fields" to "sd51, units, S-units, number fields".



---

archive/issue_comments_232110.json:
```json
{
    "body": "Set assignee to @JohnCremona.",
    "created_at": "2013-07-25T07:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232110",
    "user": "https://github.com/JohnCremona"
}
```

Set assignee to @JohnCremona.



---

archive/issue_comments_232111.json:
```json
{
    "body": "<a id='comment:4'></a>\nI started to work on this at sd51 and hope to finish it soon.",
    "created_at": "2013-07-27T13:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232111",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
I started to work on this at sd51 and hope to finish it soon.



---

archive/issue_comments_232112.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt was quite easy to extend the functionality of the UnitGroup class to include S-units, thanks to the pari function bnfsunit (which was already wrapped) and bnfissunit (which was not).  The class constructor requires that S not be a list, but it can be a tuple or something from which an element of the number field can be constructed.  Note that the pari function bnfsunit only returns the S-unit generators which are not global units, and the bnfissunit returns the exponents in the order (1) global units of infinite order, (2) torsion, (3) other S-units; so some permutation is required.  The new method for number fields is S_unit_group and is simiar to unit_group:  it caches S-unit groups using the tuple S as key, with separate caches for proof and non-proof options.\n\nThe old number field method S_units is probably now redundant; I added a note there directing users to S_unit_group for great functionality, as we do for units.",
    "created_at": "2013-07-28T16:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232112",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
It was quite easy to extend the functionality of the UnitGroup class to include S-units, thanks to the pari function bnfsunit (which was already wrapped) and bnfissunit (which was not).  The class constructor requires that S not be a list, but it can be a tuple or something from which an element of the number field can be constructed.  Note that the pari function bnfsunit only returns the S-unit generators which are not global units, and the bnfissunit returns the exponents in the order (1) global units of infinite order, (2) torsion, (3) other S-units; so some permutation is required.  The new method for number fields is S_unit_group and is simiar to unit_group:  it caches S-unit groups using the tuple S as key, with separate caches for proof and non-proof options.

The old number field method S_units is probably now redundant; I added a note there directing users to S_unit_group for great functionality, as we do for units.



---

archive/issue_comments_232113.json:
```json
{
    "body": "Changing author from \"\" to \"John Cremona\"",
    "created_at": "2013-07-28T16:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232113",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "John Cremona"



---

archive/issue_comments_232114.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-28T16:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232114",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no class for these which generalises the UnitGroup class in sage/rings/number_field/unit_group.py.   This ticket will create such a class, also adding a wrapper for the pari function bnfissunit.\n+In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket creates such functionality, also adding a wrapper for the PARI function `bnfissunit`.\n``````\n",
    "created_at": "2013-07-29T08:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232115",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no class for these which generalises the UnitGroup class in sage/rings/number_field/unit_group.py.   This ticket will create such a class, also adding a wrapper for the pari function bnfissunit.
+In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket creates such functionality, also adding a wrapper for the PARI function `bnfissunit`.
``````




---

archive/issue_comments_232116.json:
```json
{
    "body": "<a id='comment:8'></a>\nupdate summary and description",
    "created_at": "2013-07-29T08:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232116",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>
update summary and description



---

archive/issue_events_057057.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "rename": {
        "from": "Create a new class for S-units",
        "to": "Add functionality for S-units to UnitGroup"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14963#event-57057"
}
```



---

archive/issue_comments_232117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket creates such functionality, also adding a wrapper for the PARI function `bnfissunit`.\n+In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.\n``````\n",
    "created_at": "2013-07-29T08:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232117",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket creates such functionality, also adding a wrapper for the PARI function `bnfissunit`.
+In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.
``````




---

archive/issue_comments_232118.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.\n\nDid you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).\n\nApart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.",
    "created_at": "2013-08-06T21:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232118",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>
This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.

Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).

Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.



---

archive/issue_comments_232119.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2013-08-06T21:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232119",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_232120.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.\n+\n+Apply: [attachment:trac_14963-Sunits.patch], [attachment:trac_14963-reviewer.patch]\n+\n``````\n",
    "created_at": "2013-08-06T21:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232120",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 In Sage-5.11, there is a lot of functionality for computing with S-units (see #14746) but no support for this in the `UnitGroup` class in `sage/rings/number_field/unit_group.py`.   This ticket adds such support, also adding a wrapper for the PARI function `bnfissunit`.
+
+Apply: [attachment:trac_14963-Sunits.patch], [attachment:trac_14963-reviewer.patch]
+
``````




---

archive/issue_comments_232121.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-07T07:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232121",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232122.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [pbruin](#comment%3A10):\n> This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.\n> \n> Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).\n\n\nYes, I did this on my laptop at the Leiden Sage Days and that's 32-bit.  Sorry for not testing on 64-bit too, and thanks for makinf the necessary fixes.  Sorry too for the trailing whitspace in my cut-and-paste doctests, I usually remember to get rid of it.\n\nAnd thanks for the positive review!\n\n> \n> Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.",
    "created_at": "2013-08-07T10:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232122",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
Replying to [pbruin](#comment%3A10):
> This looks good to me.  I like the fact that S-units are now neatly integrated into the `UnitGroup` class and did not require a separate class.
> 
> Did you write this patch on a 32-bit system?  I am getting two doctest failures in my 64-bit Sage 5.11.rc0, which are almost certainly due to 32/64-bit differences in PARI (this also occurred in the two dependencies of this ticket).


Yes, I did this on my laptop at the Leiden Sage Days and that's 32-bit.  Sorry for not testing on 64-bit too, and thanks for makinf the necessary fixes.  Sorry too for the trailing whitspace in my cut-and-paste doctests, I usually remember to get rid of it.

And thanks for the positive review!

> 
> Apart from that, I can only suggest a few cosmetic changes (mostly trailing whitespace).  I will upload a reviewer patch and am planning to give this a positive review once doctesting has finished.



---

archive/issue_comments_232123.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis needs to be rebased to #14519.",
    "created_at": "2013-08-17T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232123",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
This needs to be rebased to #14519.



---

archive/issue_comments_232124.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-17T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232124",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232125.json:
```json
{
    "body": "Changing dependencies from \"#14489, #14746\" to \"#14489, #14746, #14519\"",
    "created_at": "2013-08-17T08:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232125",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#14489, #14746" to "#14489, #14746, #14519"



---

archive/issue_comments_232126.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A14):\n> This needs to be rebased to #14519.\n\n\nI will do that, though it is exceedingly annoying to have to do so in order to satisfy some third party whose patch touched hundreds of files and therefore causes many other people such an inconvenience.  There should be a fine for that!",
    "created_at": "2013-08-17T16:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232126",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A14):
> This needs to be rebased to #14519.


I will do that, though it is exceedingly annoying to have to do so in order to satisfy some third party whose patch touched hundreds of files and therefore causes many other people such an inconvenience.  There should be a fine for that!



---

archive/issue_comments_232127.json:
```json
{
    "body": "Attachment [trac_14963-Sunits.patch](tarball://root/attachments/some-uuid/ticket14963/trac_14963-Sunits.patch) by @JohnCremona created at 2013-08-19 13:57:09\n\napplies to 5.12.beta1 + #14519 + #14746",
    "created_at": "2013-08-19T13:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232127",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_14963-Sunits.patch](tarball://root/attachments/some-uuid/ticket14963/trac_14963-Sunits.patch) by @JohnCremona created at 2013-08-19 13:57:09

applies to 5.12.beta1 + #14519 + #14746



---

archive/issue_comments_232128.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-19T13:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232128",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232129.json:
```json
{
    "body": "<a id='comment:16'></a>\nRebasing done, first patch replaced.",
    "created_at": "2013-08-19T13:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232129",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:16'></a>
Rebasing done, first patch replaced.



---

archive/issue_comments_232130.json:
```json
{
    "body": "Attachment [trac_14963-reviewer.patch](tarball://root/attachments/some-uuid/ticket14963/trac_14963-reviewer.patch) by @pjbruin created at 2013-09-04 15:49:59",
    "created_at": "2013-09-04T15:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232130",
    "user": "https://github.com/pjbruin"
}
```

Attachment [trac_14963-reviewer.patch](tarball://root/attachments/some-uuid/ticket14963/trac_14963-reviewer.patch) by @pjbruin created at 2013-09-04 15:49:59



---

archive/issue_comments_232131.json:
```json
{
    "body": "<a id='comment:17'></a>\nReviewer patch updated to make the `bnfissunit()` wrapper use `pari_catch_sig_on()` (the new name of the PARI version of `sig_on()`, see #15124).\n\nTests pass on my 64-bit system, but there might possibly be some doctest failures on 32-bit systems due to different PARI behaviour for 32/64 bits.",
    "created_at": "2013-09-04T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232131",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>
Reviewer patch updated to make the `bnfissunit()` wrapper use `pari_catch_sig_on()` (the new name of the PARI version of `sig_on()`, see #15124).

Tests pass on my 64-bit system, but there might possibly be some doctest failures on 32-bit systems due to different PARI behaviour for 32/64 bits.



---

archive/issue_comments_232132.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-09-04T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232132",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057058.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-26T15:47:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14963#event-57058"
}
```



---

archive/issue_comments_232133.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.13.beta0\"",
    "created_at": "2013-10-02T06:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232133",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.13.beta0"



---

archive/issue_comments_232134.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-02T06:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14963#issuecomment-232134",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_057059.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-02T06:36:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14963",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14963#event-57059"
}
```
