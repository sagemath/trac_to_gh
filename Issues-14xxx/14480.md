# Issue 14480: switch sage to the new directory layout

archive/issues_014276.json:
```json
{
    "body": "To switch to a unified repository we need to include some information that are currently in the spkg tarballs, which requires modifying the sage's directory structure. Since we are switching workflows at the same time, it is an ideal time to rethink the directory structure as a whole.\n\nThe proposed significant changes\n\n```\nspkg -> build\ndevel/sage -> src\ndevel/ext -> src/ext\nsage_scripts -> src/bin\nspkg/bin -> src/bin\n\ndevel/sagenb -> /dev/null (is now considered a typical upstream python library)\n/dev/null -> build/pkgs/* (these are now the spkg repositories)\n```\n\nFull changes are described at http://wiki.sagemath.org/WorkflowSEP.\n\nThe script used to create the git repository is `consolidate-repos.sh`, which depends on `configuration.sh`, `git-filter-branch`, and the `fast-export` directory (all located at https://github.com/sagemath/sage-workflow). They require bash4, git 1.8.x, and python 2.7 to run (at the very least, possibly more).\n\n\nDepends on #13015\n\nDepends on #14781\n\n**CC:**  @jdemeyer @saraedum\n\n**Branch:** [u/ohanar/build_system](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/build_system)\n\n**Commit:** [cd237e726293c48288016aa2a9cc80aa75a3bd20](https://github.com/sagemath/sagetrac-mirror/commit/cd237e726293c48288016aa2a9cc80aa75a3bd20)\n\n**Reviewer:** Volker Braun\n\n**Author:** R. Andrew Ohana\n\nIssue created by migration from https://trac.sagemath.org/ticket/14480\n\n",
    "closed_at": "2013-12-16T12:23:29Z",
    "created_at": "2013-04-24T05:40:41Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.0",
    "title": "switch sage to the new directory layout",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/14480",
    "user": "https://github.com/ohanar"
}
```
To switch to a unified repository we need to include some information that are currently in the spkg tarballs, which requires modifying the sage's directory structure. Since we are switching workflows at the same time, it is an ideal time to rethink the directory structure as a whole.

The proposed significant changes

```
spkg -> build
devel/sage -> src
devel/ext -> src/ext
sage_scripts -> src/bin
spkg/bin -> src/bin

devel/sagenb -> /dev/null (is now considered a typical upstream python library)
/dev/null -> build/pkgs/* (these are now the spkg repositories)
```

Full changes are described at http://wiki.sagemath.org/WorkflowSEP.

The script used to create the git repository is `consolidate-repos.sh`, which depends on `configuration.sh`, `git-filter-branch`, and the `fast-export` directory (all located at https://github.com/sagemath/sage-workflow). They require bash4, git 1.8.x, and python 2.7 to run (at the very least, possibly more).


Depends on #13015

Depends on #14781

**CC:**  @jdemeyer @saraedum

**Branch:** [u/ohanar/build_system](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/build_system)

**Commit:** [cd237e726293c48288016aa2a9cc80aa75a3bd20](https://github.com/sagemath/sagetrac-mirror/commit/cd237e726293c48288016aa2a9cc80aa75a3bd20)

**Reviewer:** Volker Braun

**Author:** R. Andrew Ohana

Issue created by migration from https://trac.sagemath.org/ticket/14480





---

archive/issue_events_125858.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-04-24T05:44:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125858"
}
```



---

archive/issue_comments_176983.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis can really only be reviewed on the new trac instance. For now, the branch field on http://trac.tangentspace.org/ticket/13015 links to the list of changes (to actually see the changes click the view changes button -- since this includes some massive changes, it might take awhile to load the side-by-side diff).",
    "created_at": "2013-04-24T05:44:26Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176983",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:1'></a>
This can really only be reviewed on the new trac instance. For now, the branch field on http://trac.tangentspace.org/ticket/13015 links to the list of changes (to actually see the changes click the view changes button -- since this includes some massive changes, it might take awhile to load the side-by-side diff).



---

archive/issue_events_125859.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-04-24T05:54:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125859"
}
```



---

archive/issue_events_125860.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-04-24T05:54:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "milestone": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125860"
}
```



---

archive/issue_events_125861.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-04-24T05:58:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "rename": {
        "from": "switch sage to the new layout",
        "to": "switch sage to the new directory layout"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125861"
}
```



---

archive/issue_comments_176984.json:
```json
{
    "body": "<a id='comment:5'></a>\nWhere is the *script* that you used to automatically create the git repo from the hg repos? That should be reviewed too and kept for reference.",
    "created_at": "2013-04-25T05:25:15Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176984",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Where is the *script* that you used to automatically create the git repo from the hg repos? That should be reviewed too and kept for reference.



---

archive/issue_comments_176985.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,3 +14,6 @@\n ```\n \n Full changes are described at http://wiki.sagemath.org/WorkflowSEP.\n+\n+The script used to create the git repository is `consolidate-repos.sh`, which depends on `configuration.sh`, `git-filter-branch`, and the `fast-export` directory (all located at https://github.com/sagemath/sage-workflow). They require bash4, git 1.8.x, and python 2.7 to run (at the very least, possibly more).\n+\n``````\n",
    "created_at": "2013-04-26T20:48:06Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176985",
    "user": "https://github.com/ohanar"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,3 +14,6 @@
 ```
 
 Full changes are described at http://wiki.sagemath.org/WorkflowSEP.
+
+The script used to create the git repository is `consolidate-repos.sh`, which depends on `configuration.sh`, `git-filter-branch`, and the `fast-export` directory (all located at https://github.com/sagemath/sage-workflow). They require bash4, git 1.8.x, and python 2.7 to run (at the very least, possibly more).
+
``````




---

archive/issue_comments_176986.json:
```json
{
    "body": "**Changing dependencies** from \"#13015\" to \"#13015, #14781\".",
    "created_at": "2013-07-13T07:06:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176986",
    "user": "https://github.com/ohanar"
}
```

**Changing dependencies** from "#13015" to "#13015, #14781".



---

archive/issue_comments_176987.json:
```json
{
    "body": "**Branch:** [u/ohanar/build_system](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/build_system)",
    "created_at": "2013-07-18T03:29:30Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176987",
    "user": "https://github.com/ohanar"
}
```

**Branch:** [u/ohanar/build_system](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/build_system)



---

archive/issue_events_125862.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-07-21T10:34:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125862"
}
```



---

archive/issue_events_125863.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2013-07-21T10:34:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125863"
}
```



---

archive/issue_comments_176988.json:
```json
{
    "body": "<a id='comment:9'></a>\nA few small issues with this branch. I am not sure which of these should actually be fixed here, so I'm marking the ticket as `need_info` rather that `need_work`.\n\n* There remain references to `src/sage/misc/hg.py` (which was removed as part of 48ff645017639d70d9b4a7107ac7fd98d8a871b5) in `src/sage/doctest/control.py`.\n\n```\nsage -t --long src/sage/doctest/control.py\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 434, in sage.doctest.control.DocTestController.add_files\nFailed example:\n    DC.add_files()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.doctest.control.DocTestController.add_files[10]>\", line 1, in <module>\n        DC.add_files()\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 458, in add_files\n        from sage.misc.hg import hg_sage\n    ImportError: No module named hg\n**********************************************************************\n1 item had failures:\n   1 of  16 in sage.doctest.control.DocTestController.add_files\n    [162 tests, 1 failure, 1.97 s]\n```\n\n* I also get a few more doctest failures such as the one below due to a missing import that seems to be fixed in the current git version of sagenb.\n\n```\n**********************************************************************\nFile \"local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/misc/misc.py\", line 44, in sagenb.misc.misc.print_open_msg\nFailed example:\n    sage.server.misc.print_open_msg('localhost', 8080, True)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sagenb.misc.misc.print_open_msg[0]>\", line 1, in <module>\n        sage.server.misc.print_open_msg('localhost', Integer(8080), True)\n    AttributeError: 'module' object has no attribute 'misc'\n**********************************************************************\n```\n\n* Finally, trying to run the notebook produces the following error:\n\n```\nsage: notebook()\nThe notebook files are stored in: sage_notebook.sagenb\n**************************************************\n*                                                *\n* Open your web browser to http://localhost:8080 *\n*                                                *\n**************************************************\nExecuting twistd  --pidfile=\"sage_notebook.sagenb/sagenb.pid\" -ny \"sage_notebook.sagenb/twistedconf.tac\"\nUnhandled Error\nTraceback (most recent call last):\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py\", line 652, in run\n    runApp(config)\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/scripts/twistd.py\", line 23, in runApp\n    _SomeApplicationRunner(config).run()\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py\", line 386, in run\n    self.application = self.createOrGetApplication()\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py\", line 451, in createOrGetApplication\n    application = getApplication(self.config, passphrase)\n--- <exception caught here> ---\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py\", line 462, in getApplication\n    application = service.loadApplication(filename, style, passphrase)\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/service.py\", line 405, in loadApplication\n    application = sob.loadValueFromFile(filename, 'application', passphrase)\n  File \"/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/persisted/sob.py\", line 210, in loadValueFromFile\n    exec fileObj in d, d\n  File \"sage_notebook.sagenb/twistedconf.tac\", line 15, in <module>\n    import base as flask_base\nexceptions.ImportError: No module named base\n\nFailed to load application: No module named base\n\n---------------------------------------------------------------------------\nerror                                     Traceback (most recent call last)\n<ipython-input-1-3728cb3d7c7d> in <module>()\n----> 1 notebook()\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/notebook/notebook_object.pyc in __call__(self, *args, **kwds)\n    221     \"\"\"\n    222     def __call__(self, *args, **kwds):\n--> 223         return self.notebook(*args, **kwds)\n    224 \n    225     notebook = run_notebook.notebook_run\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/notebook/run_notebook.pyc in notebook_run(self, directory, port, interface, port_tries, secure, reset, accounts, openid, server_pool, ulimit, timeout, upload, automatic_login, start_path, fork, quiet, server, profile, subnets, require_login, open_viewer, address)\n    626     os.chdir(cwd)\n    627     if e == 256:\n--> 628         raise socket.error\n    629 \n    630 def get_admin_passwd():\n\nerror:\n```",
    "created_at": "2013-07-21T10:34:28Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176988",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>
A few small issues with this branch. I am not sure which of these should actually be fixed here, so I'm marking the ticket as `need_info` rather that `need_work`.

* There remain references to `src/sage/misc/hg.py` (which was removed as part of 48ff645017639d70d9b4a7107ac7fd98d8a871b5) in `src/sage/doctest/control.py`.

```
sage -t --long src/sage/doctest/control.py
**********************************************************************
File "src/sage/doctest/control.py", line 434, in sage.doctest.control.DocTestController.add_files
Failed example:
    DC.add_files()
Exception raised:
    Traceback (most recent call last):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.doctest.control.DocTestController.add_files[10]>", line 1, in <module>
        DC.add_files()
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 458, in add_files
        from sage.misc.hg import hg_sage
    ImportError: No module named hg
**********************************************************************
1 item had failures:
   1 of  16 in sage.doctest.control.DocTestController.add_files
    [162 tests, 1 failure, 1.97 s]
```

* I also get a few more doctest failures such as the one below due to a missing import that seems to be fixed in the current git version of sagenb.

```
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/misc/misc.py", line 44, in sagenb.misc.misc.print_open_msg
Failed example:
    sage.server.misc.print_open_msg('localhost', 8080, True)
Exception raised:
    Traceback (most recent call last):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sagenb.misc.misc.print_open_msg[0]>", line 1, in <module>
        sage.server.misc.print_open_msg('localhost', Integer(8080), True)
    AttributeError: 'module' object has no attribute 'misc'
**********************************************************************
```

* Finally, trying to run the notebook produces the following error:

```
sage: notebook()
The notebook files are stored in: sage_notebook.sagenb
**************************************************
*                                                *
* Open your web browser to http://localhost:8080 *
*                                                *
**************************************************
Executing twistd  --pidfile="sage_notebook.sagenb/sagenb.pid" -ny "sage_notebook.sagenb/twistedconf.tac"
Unhandled Error
Traceback (most recent call last):
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py", line 652, in run
    runApp(config)
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/scripts/twistd.py", line 23, in runApp
    _SomeApplicationRunner(config).run()
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py", line 386, in run
    self.application = self.createOrGetApplication()
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py", line 451, in createOrGetApplication
    application = getApplication(self.config, passphrase)
--- <exception caught here> ---
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/app.py", line 462, in getApplication
    application = service.loadApplication(filename, style, passphrase)
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/application/service.py", line 405, in loadApplication
    application = sob.loadValueFromFile(filename, 'application', passphrase)
  File "/home/marc/co/sage/local/lib/python2.7/site-packages/Twisted-12.3.0-py2.7-linux-x86_64.egg/twisted/persisted/sob.py", line 210, in loadValueFromFile
    exec fileObj in d, d
  File "sage_notebook.sagenb/twistedconf.tac", line 15, in <module>
    import base as flask_base
exceptions.ImportError: No module named base

Failed to load application: No module named base

---------------------------------------------------------------------------
error                                     Traceback (most recent call last)
<ipython-input-1-3728cb3d7c7d> in <module>()
----> 1 notebook()

/home/marc/co/sage/local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/notebook/notebook_object.pyc in __call__(self, *args, **kwds)
    221     """
    222     def __call__(self, *args, **kwds):
--> 223         return self.notebook(*args, **kwds)
    224 
    225     notebook = run_notebook.notebook_run

/home/marc/co/sage/local/lib/python2.7/site-packages/sagenb-0.10.4-py2.7.egg/sagenb/notebook/run_notebook.pyc in notebook_run(self, directory, port, interface, port_tries, secure, reset, accounts, openid, server_pool, ulimit, timeout, upload, automatic_login, start_path, fork, quiet, server, profile, subnets, require_login, open_viewer, address)
    626     os.chdir(cwd)
    627     if e == 256:
--> 628         raise socket.error
    629 
    630 def get_admin_passwd():

error:
```



---

archive/issue_events_125864.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2013-07-23T09:49:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125864"
}
```



---

archive/issue_events_125865.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2013-07-23T09:49:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125865"
}
```



---

archive/issue_comments_176989.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks for having a look.\n\nReplying to [mmezzarobba](#comment%3A9):\n> * There remain references to `src/sage/misc/hg.py` (which was removed as part of 48ff645017639d70d9b4a7107ac7fd98d8a871b5) in `src/sage/doctest/control.py`.\n \nThis is now #14954.\n\n> * I also get a few more doctest failures such as the one below due to a missing import that seems to be fixed in the current git version of sagenb.\n \nThis is fixed by #14330.\n\nI believe that these issues are not related to `consolidate-repos.sh`, so I'll put this back to needs_review. These two tickets are part of the metaticket #13015.",
    "created_at": "2013-07-23T09:49:09Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176989",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:10'></a>
Thanks for having a look.

Replying to [mmezzarobba](#comment%3A9):
> * There remain references to `src/sage/misc/hg.py` (which was removed as part of 48ff645017639d70d9b4a7107ac7fd98d8a871b5) in `src/sage/doctest/control.py`.
 
This is now #14954.

> * I also get a few more doctest failures such as the one below due to a missing import that seems to be fixed in the current git version of sagenb.
 
This is fixed by #14330.

I believe that these issues are not related to `consolidate-repos.sh`, so I'll put this back to needs_review. These two tickets are part of the metaticket #13015.



---

archive/issue_comments_176990.json:
```json
{
    "body": "<a id='comment:11'></a>\nThese are the changes that actually need review for this ticket:\n\n`git diff origin/master..origin/u/ohanar/build_system`\n\nAs a diff (this usually times out on the trac server):\n\nhttp://trac.sagemath.org/changeset?new=af353bb626561725cee86bb0ca694a39ffb7b5f4&base=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e&old=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e\n\nAs a list of commits:\n\nhttp://trac.sagemath.org/log?rev=af353bb626561725cee86bb0ca694a39ffb7b5f4&stop_rev=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e",
    "created_at": "2013-07-23T13:48:04Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176990",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:11'></a>
These are the changes that actually need review for this ticket:

`git diff origin/master..origin/u/ohanar/build_system`

As a diff (this usually times out on the trac server):

http://trac.sagemath.org/changeset?new=af353bb626561725cee86bb0ca694a39ffb7b5f4&base=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e&old=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e

As a list of commits:

http://trac.sagemath.org/log?rev=af353bb626561725cee86bb0ca694a39ffb7b5f4&stop_rev=c3e08bfa279f8b4be1d5f924aa4668ae1b675b5e



---

archive/issue_comments_176991.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe following is my review for the changes between master and \nu/ohanar/build_system. I'm assuming that there are no other changes \napart from the directory structure between the old hg repositories\nand master.\n\nOverall, I'm impressed by the amount of work this has been. \nMy review contains mostly questions that you can probably just answer\nor address with minor patches.\n\nMaybe it makes sense for at least one more person to go through this diff.\n\n``` \ndiff --git a/Makefile b/Makefile\n doc-clean:\n-\t@echo \"Deleting devel/sage/doc/output...\"\n-\trm -rf devel/sage/doc/output\n+\t@echo \"Deleting generated docs...\"\n+\trm -rf src/doc/en/reference/*/sage\n+\trm -rf src/doc/en/reference/*/sagenb\n+\trm -rf src/doc/en/reference/sage\n+\trm -rf src/doc/en/reference/sagenb\n+\trm -rf src/doc/output\n```\nwhy do we clean more directories than before?\n\n```\n+\n+bdist-clean: clean\n+\t@echo \"Deleting miscellaneous artifacts generated by build system ...\"\n \trm -rf logs\n-\trm -f spkg/parallel_make.cfg\n \trm -rf dist\n```\nWhat happened to this parallel_make.cfg file?\n\nDo I understand correctly that, and is it okay that the micro_release code now\nonly strips the binaries and does not remove build directories?\n\n```\ndiff --git a/build/deps b/build/deps\nnew file mode 100644\nindex 0000000..2d2d19c\n--- /dev/null\n+++ b/build/deps\n@@ -0,0 +1,523 @@\n+###############################################################################\n+# This file ($SAGE_ROOT/spkg/standard/deps) will be copied into\n+# $SAGE_ROOT/spkg/Makefile by $SAGE_ROOT/spkg/install\n+###############################################################################\n```\nThere's still a reference to the spkg directory here.\n\n```\ndiff --git a/build/gen_html b/build/gen_html\ndeleted file mode 100755\nindex 6dbad06..0000000\n--- a/build/gen_html\n+++ /dev/null\n```\nWhat did this script do? Why don't we need it anymore?\n\n``` \ndiff --git a/build/install b/build/install\nindex 780fe2a..bb14f76 100755\n--- a/build/install\n+++ b/build/install\n@@ -99,11 +95,6 @@ if [ -d \"$SAGE_ROOT/data\" ] && [ ! -h \"$SAGE_ROOT/data\" ]; then\n     rm -rf \"$SAGE_ROOT/data\"\n fi\n-# Symlink old SAGE_DATA to SAGE_SHARE for optional/experimental\n-# packages that haven't yet been updated.\n-rm -f \"$SAGE_ROOT/data\"\n-ln -s local/share \"$SAGE_ROOT/data\"\n-\n```\nShould we make sure that this does not break any optional/experimental packages?\nPersonally, I'm fine with any package that installs anything into this data directory,\nwhich I'm guessing has been deprecated for some time now. (how long?)\n\n```\n@@ -352,25 +343,17 @@ newest_version_base() {\n }\n \n # Usage: newest_version $pkg\n-# Print version number of latest (according to modification time)\n-# standard or optional package $pkg\n+# Print version number of latest standard package $pkg\n newest_version() {\n <SNIP>\n```\nThis reminds me: will we, at some point, test the installation of the \noptional packages into the git framework? And, since we're already distributing\nthem officially, couldn't we just as well put their metadata in the repository, too?\n(We don't need to do that right away).\n\n```\n \n+# glpk's build system uses the output of grep\n+unset GREP_OPTIONS\n+\n```\nThis change has been made in quite some places. Why wasn't GREP_OPTIONS being set\na problem before?\n\n```\ndiff --git a/sage b/sage\nindex 6597c54..46c69ba 100755\n--- a/sage\n+++ b/sage\n@@ -124,11 +124,10 @@ fi\n export SAGE_ROOT\n \n # Run the actual Sage script\n-if [ -x \"$SAGE_ROOT/spkg/bin/sage\" ]; then\n-    \"$SAGE_ROOT/spkg/bin/sage\" \"$@\"\n-elif [ -x \"$SAGE_ROOT/local/bin/sage-sage\" ]; then   # Support sage-4.x\n-    export CUR=`pwd`\n-    \"$SAGE_ROOT/local/bin/sage-sage\" \"$@\"\n+if [ -x \"$SAGE_ROOT/src/bin/sage\" ]; then\n+    \"$SAGE_ROOT/src/bin/sage\" \"$@\"\n+elif [ -x \"$SAGE_ROOT/local/bin/sage\" ]; then # if in a striped binary\n+    \"$SAGE_ROOT/local/bin/sage\" \"$@\"\n else\n     echo >&2 \"$0: no Sage installation found in \\$SAGE_ROOT=$SAGE_ROOT\"\n     exit 1\n```\nIt feels wrong to me to prefer the src/bin version of the sage script to \nthe local/bin version. Why is this?\n\n```\ndiff --git a/src/bin/sage b/src/bin/sage\nindex 5c886e3..3762d5d 100755\n--- a/src/bin/sage\n+++ b/src/bin/sage\n<SNIP>\n@@ -864,12 +825,8 @@ if [ \"$1\" = '-pkg_nc' -o \"$1\" = \"--pkg_nc\" ]; then\n fi\n \n if [ \"$1\" = '-sdist' -o \"$1\" = \"--sdist\" ]; then\n-    if [ $# -ne 2 ]; then\n-        echo >&2 \"** MISSING VERSION NUMBER! **\"\n-        exit 2\n-    fi\n-    maybe_sage_location\n-    exec sage-sdist $2 \"$SAGE_ROOT\"\n+    shift\n+    exec sage-sdist \"$@\"\n```\nWhy doesn't this need sage location anymore?\n\n@@ -904,25 +861,7 @@ fi\n \n\n```\n if [ \"$1\" = '-upgrade' -o \"$1\" = \"--upgrade\" ]; then\n     shift\n-    cd \"$SAGE_ROOT\"\n-\n-    # People often move the Sage install right before doing the upgrade, so it's\n-    # important to fix any path hardcoding issues first, or certain library\n-    # links will fail.\n-    sage-location || exit $?\n-\n-    # Run sage-upgrade twice since when installing sage-scripts and a\n-    # running script changes, it gets confused and exits with an error.\n-    # Running again (with the script replaced) then fixes the problem.\n     sage-upgrade \"$@\"\n-    if [ $? -eq 2 ]; then   # this exit code means the user elected not to do the upgrade at all.\n-        exit 2\n-    fi\n-    echo \"Double checking that all packages have been installed.\"\n-    sage-upgrade \"$@\" || exit $?\n-\n-    # Check that Sage still works\n-    sage-starts\n     exit $?\n fi\n```\nWhy don't we call sage-location anymore? and sage-starts?\n \n\n```\ndiff --git a/src/bin/sage-bdist b/src/bin/sage-bdist\nindex a776900..c765017 100755\n--- a/src/bin/sage-bdist\n+++ b/src/bin/sage-bdist\n<SNIP>\n+# Clone Sage repository\n+echo \"Cloning Sage repository...\"\n+git clone \"$SAGE_ROOT\" \"$TMP_DIR/$TARGET\"\n+( cd \"$TMP_DIR/$TARGET\" && git remote set-url origin git://github.com/sagemath/sage.git )\n```\nWe need to set this to the trac server. Also, what branch does this clone? It\nshould probably be the current one, because those are the binaries it copies.\nIs it?\n\n```\ndiff --git a/src/bin/sage-download-file b/src/bin/sage-download-file\nindex cf7dce0..a3428df 100755\n--- a/src/bin/sage-download-file\n+++ b/src/bin/sage-download-file\n@@ -33,7 +33,7 @@ if [ -z \"$URL_GRABBER\" ]; then\n     if [ -n \"$SAGE_LOCAL\" ] && [ -x \"$SAGE_LOCAL/bin/python\" ]; then\n         URL_GRABBER=\"$SAGE_LOCAL/bin/python\"\n     elif command -v curl &>/dev/null; then\n-        URL_GRABBER=\"curl\"\n+        URL_GRABBER=\"curl --fail\"\n     elif command -v wget &>/dev/null; then\n         URL_GRABBER=\"wget -nv -O-\"\n     # Pick Python last because we don't know which version it is,\n```\nThis looks fine, but why wasn't it an issue before?\n\n```\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex 6c2408a..5e5af1b 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n<SNIP>\n # Make Mercurial not use any user defaults (like enabling the pager extension)\n # This is needed in order to use mercurial in scripts.  When running hg\n-# directly through \"sage -hg\", we will disable HGPLAIN in spkg/bin/sage.\n+# directly through \"sage -hg\", we will disable HGPLAIN in src/bin/sage.\n # See Trac Ticket #12058\n HGPLAIN=\"yes\" && export HGPLAIN\n```\nThis can probably go.\n \n\n```\n+if [ -z \"$SAGE_REPO\" ]; then\n+    SAGE_REPO=\"git://github.com/sagemath/sage.git\"\n+    export SAGE_REPO\n+fi\n```\nThis should be set to the trac server.\n\n```\ndiff --git a/src/bin/sage-spkg b/src/bin/sage-spkg\nindex 20c56db..86c03c3 100755\n--- a/src/bin/sage-spkg\n+++ b/src/bin/sage-spkg\n```\nThis file has had major modifications so it needs updated author credits. Also,\nthe comment at the start still explains its old functionality.\n\n```\n \n+DOWNLOAD_ONLY=0\n+if [ \"$1\" = '-d' ]; then\n+    DOWNLOAD_ONLY=1\n+    shift\n+fi\n+\n```\nI think this is an odd way to change the functionality. Maybe download-only\nshould be in a script of itself.\n\n```\ndiff --git a/src/bin/sage-sync-build.py b/src/bin/sage-sync-build.py\nindex 8e45386..b5d476a 100755\n--- a/src/bin/sage-sync-build.py\n+++ b/src/bin/sage-sync-build.py\n<SNIP>\n```\nWhy does sage-sync-build need so many changes? Naively, it would need only a few\nchanges to some directory names.\n\n```\ndiff --git a/src/bin/sage-upgrade b/src/bin/sage-upgrade\nindex 46c1935..55432d1 100755\n--- a/src/bin/sage-upgrade\n+++ b/src/bin/sage-upgrade\n-./install\n+if [ \"$#\" -gt 0 ]; then\n+    BRANCH=\"$1\"\n+    shift\n+else\n+    BRANCH=$(git symbolic-ref HEAD) ||\n+        BRANCH=$(git describe --exact-match --tags HEAD | \\\n+                 sed -e 's;^;refs/tags/;')\n+    if [ -n \"$BRANCH\" ]; then\n+        case $BRANCH in\n+            refs/heads/master) BRANCH=master;;\n+            refs/heads/release) BRANCH=release;;\n+            refs/heads/beta) BRANCH=beta;;\n+            refs/tags/*) BRANCH=release;;\n+        esac\n+    fi\n+fi \n```\nMaybe do a `git fetch` first? Also, should we add pushing to these branches\nin the repo to a script somewhere? Maybe to sage-sdist?\n\n```\ndiff --git a/src/c_lib/SConstruct b/src/c_lib/SConstruct\nindex fd4719a..1813de8 100644\n--- a/src/c_lib/SConstruct\n+++ b/src/c_lib/SConstruct\n-#Here we only copy the files over if we are on Cygwin.  Otherwise, the\n-#library will be handled by the symlinks created in\n-#$SAGE_ROOT/devel/sage/spkg-install\n-if os.environ['UNAME'] == 'CYGWIN':\n-    env.Alias(\"install\", \"$SAGE_LOCAL/lib\")\n-else:\n-    env.Alias(\"install\", [lib])\n-\n+env.Alias(\"install\", \"$SAGE_LOCAL\")\n```\nWill this still work on Cygwin?\n\n```\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 9f0bbe3..12e8434 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -407,9 +407,9 @@ def format(s, embedded=False):\n     EXAMPLES::\n \n         sage: from sage.misc.sagedoc import format\n-        sage: identity_matrix(2).rook_vector.__doc__[115:184]\n+        sage: identity_matrix(2).rook_vector.__doc__[107:176]\n         'Let `A` be a general `m` by `n`\\n        (0,1)-matrix with `m \\\\le n`. '\n-        sage: format(identity_matrix(2).rook_vector.__doc__[115:184])\n+        sage: format(identity_matrix(2).rook_vector.__doc__[107:176])\n         'Let A be a general m by n\\n   (0,1)-matrix with m <= n.\\n'\n \n     If the first line of the string is 'nodetex', remove 'nodetex' but\n```\nwhy did this change? Is this related to the removal of whitespace? If so:\nokay.\n\n```\ndiff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py\nindex 342c3ff..7e45f0f 100644\n--- a/src/sage/tests/cmdline.py\n+++ b/src/sage/tests/cmdline.py\n@@ -208,15 +198,9 @@ def test_executable(args, input=\"\", timeout=100.0, **kwds):\n     Test ``sage --info [packages]``, unless this is a binary (bdist)\n     distribution which doesn't ship spkgs::\n \n-        sage: if os.path.isfile(os.path.join(SAGE_ROOT, 'spkg', 'standard', '.from_bdist')):\n-        ...     out = \"Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\\n= SQLAlchemy =\\n...\\nSQLAlchemy is the Python SQL toolkit...\"\n-        ...     err = ''\n-        ...     ret = 0\n-        ... else:\n-        ...     (out, err, ret) = test_executable([\"sage\", \"--info\", \"sqlalchemy\"])\n-        ...\n+        sage: out, err, ret = test_executable([\"sage\", \"--info\", \"sqlalchemy\"])\n         sage: print out\n-        Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\n+        Using local scripts to install sqlalchemy-...\n         = SQLAlchemy =\n         ...\n         SQLAlchemy is the Python SQL toolkit...\n```\nDo I understand correctly that we install sqlalchemy when running doctests? What is \nhappening here?\n\n```\ndiff --git a/src/spkg-delauto b/src/spkg-delauto\ndeleted file mode 100755\nindex 61d071d..0000000\n--- a/src/spkg-delauto\n+++ /dev/null\n```\nWhy don't we need this anymore?",
    "created_at": "2013-07-24T06:46:00Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176991",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:12'></a>
The following is my review for the changes between master and 
u/ohanar/build_system. I'm assuming that there are no other changes 
apart from the directory structure between the old hg repositories
and master.

Overall, I'm impressed by the amount of work this has been. 
My review contains mostly questions that you can probably just answer
or address with minor patches.

Maybe it makes sense for at least one more person to go through this diff.

``` 
diff --git a/Makefile b/Makefile
 doc-clean:
-	@echo "Deleting devel/sage/doc/output..."
-	rm -rf devel/sage/doc/output
+	@echo "Deleting generated docs..."
+	rm -rf src/doc/en/reference/*/sage
+	rm -rf src/doc/en/reference/*/sagenb
+	rm -rf src/doc/en/reference/sage
+	rm -rf src/doc/en/reference/sagenb
+	rm -rf src/doc/output
```
why do we clean more directories than before?

```
+
+bdist-clean: clean
+	@echo "Deleting miscellaneous artifacts generated by build system ..."
 	rm -rf logs
-	rm -f spkg/parallel_make.cfg
 	rm -rf dist
```
What happened to this parallel_make.cfg file?

Do I understand correctly that, and is it okay that the micro_release code now
only strips the binaries and does not remove build directories?

```
diff --git a/build/deps b/build/deps
new file mode 100644
index 0000000..2d2d19c
--- /dev/null
+++ b/build/deps
@@ -0,0 +1,523 @@
+###############################################################################
+# This file ($SAGE_ROOT/spkg/standard/deps) will be copied into
+# $SAGE_ROOT/spkg/Makefile by $SAGE_ROOT/spkg/install
+###############################################################################
```
There's still a reference to the spkg directory here.

```
diff --git a/build/gen_html b/build/gen_html
deleted file mode 100755
index 6dbad06..0000000
--- a/build/gen_html
+++ /dev/null
```
What did this script do? Why don't we need it anymore?

``` 
diff --git a/build/install b/build/install
index 780fe2a..bb14f76 100755
--- a/build/install
+++ b/build/install
@@ -99,11 +95,6 @@ if [ -d "$SAGE_ROOT/data" ] && [ ! -h "$SAGE_ROOT/data" ]; then
     rm -rf "$SAGE_ROOT/data"
 fi
-# Symlink old SAGE_DATA to SAGE_SHARE for optional/experimental
-# packages that haven't yet been updated.
-rm -f "$SAGE_ROOT/data"
-ln -s local/share "$SAGE_ROOT/data"
-
```
Should we make sure that this does not break any optional/experimental packages?
Personally, I'm fine with any package that installs anything into this data directory,
which I'm guessing has been deprecated for some time now. (how long?)

```
@@ -352,25 +343,17 @@ newest_version_base() {
 }
 
 # Usage: newest_version $pkg
-# Print version number of latest (according to modification time)
-# standard or optional package $pkg
+# Print version number of latest standard package $pkg
 newest_version() {
 <SNIP>
```
This reminds me: will we, at some point, test the installation of the 
optional packages into the git framework? And, since we're already distributing
them officially, couldn't we just as well put their metadata in the repository, too?
(We don't need to do that right away).

```
 
+# glpk's build system uses the output of grep
+unset GREP_OPTIONS
+
```
This change has been made in quite some places. Why wasn't GREP_OPTIONS being set
a problem before?

```
diff --git a/sage b/sage
index 6597c54..46c69ba 100755
--- a/sage
+++ b/sage
@@ -124,11 +124,10 @@ fi
 export SAGE_ROOT
 
 # Run the actual Sage script
-if [ -x "$SAGE_ROOT/spkg/bin/sage" ]; then
-    "$SAGE_ROOT/spkg/bin/sage" "$@"
-elif [ -x "$SAGE_ROOT/local/bin/sage-sage" ]; then   # Support sage-4.x
-    export CUR=`pwd`
-    "$SAGE_ROOT/local/bin/sage-sage" "$@"
+if [ -x "$SAGE_ROOT/src/bin/sage" ]; then
+    "$SAGE_ROOT/src/bin/sage" "$@"
+elif [ -x "$SAGE_ROOT/local/bin/sage" ]; then # if in a striped binary
+    "$SAGE_ROOT/local/bin/sage" "$@"
 else
     echo >&2 "$0: no Sage installation found in \$SAGE_ROOT=$SAGE_ROOT"
     exit 1
```
It feels wrong to me to prefer the src/bin version of the sage script to 
the local/bin version. Why is this?

```
diff --git a/src/bin/sage b/src/bin/sage
index 5c886e3..3762d5d 100755
--- a/src/bin/sage
+++ b/src/bin/sage
<SNIP>
@@ -864,12 +825,8 @@ if [ "$1" = '-pkg_nc' -o "$1" = "--pkg_nc" ]; then
 fi
 
 if [ "$1" = '-sdist' -o "$1" = "--sdist" ]; then
-    if [ $# -ne 2 ]; then
-        echo >&2 "** MISSING VERSION NUMBER! **"
-        exit 2
-    fi
-    maybe_sage_location
-    exec sage-sdist $2 "$SAGE_ROOT"
+    shift
+    exec sage-sdist "$@"
```
Why doesn't this need sage location anymore?

@@ -904,25 +861,7 @@ fi
 

```
 if [ "$1" = '-upgrade' -o "$1" = "--upgrade" ]; then
     shift
-    cd "$SAGE_ROOT"
-
-    # People often move the Sage install right before doing the upgrade, so it's
-    # important to fix any path hardcoding issues first, or certain library
-    # links will fail.
-    sage-location || exit $?
-
-    # Run sage-upgrade twice since when installing sage-scripts and a
-    # running script changes, it gets confused and exits with an error.
-    # Running again (with the script replaced) then fixes the problem.
     sage-upgrade "$@"
-    if [ $? -eq 2 ]; then   # this exit code means the user elected not to do the upgrade at all.
-        exit 2
-    fi
-    echo "Double checking that all packages have been installed."
-    sage-upgrade "$@" || exit $?
-
-    # Check that Sage still works
-    sage-starts
     exit $?
 fi
```
Why don't we call sage-location anymore? and sage-starts?
 

```
diff --git a/src/bin/sage-bdist b/src/bin/sage-bdist
index a776900..c765017 100755
--- a/src/bin/sage-bdist
+++ b/src/bin/sage-bdist
<SNIP>
+# Clone Sage repository
+echo "Cloning Sage repository..."
+git clone "$SAGE_ROOT" "$TMP_DIR/$TARGET"
+( cd "$TMP_DIR/$TARGET" && git remote set-url origin git://github.com/sagemath/sage.git )
```
We need to set this to the trac server. Also, what branch does this clone? It
should probably be the current one, because those are the binaries it copies.
Is it?

```
diff --git a/src/bin/sage-download-file b/src/bin/sage-download-file
index cf7dce0..a3428df 100755
--- a/src/bin/sage-download-file
+++ b/src/bin/sage-download-file
@@ -33,7 +33,7 @@ if [ -z "$URL_GRABBER" ]; then
     if [ -n "$SAGE_LOCAL" ] && [ -x "$SAGE_LOCAL/bin/python" ]; then
         URL_GRABBER="$SAGE_LOCAL/bin/python"
     elif command -v curl &>/dev/null; then
-        URL_GRABBER="curl"
+        URL_GRABBER="curl --fail"
     elif command -v wget &>/dev/null; then
         URL_GRABBER="wget -nv -O-"
     # Pick Python last because we don't know which version it is,
```
This looks fine, but why wasn't it an issue before?

```
diff --git a/src/bin/sage-env b/src/bin/sage-env
index 6c2408a..5e5af1b 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
<SNIP>
 # Make Mercurial not use any user defaults (like enabling the pager extension)
 # This is needed in order to use mercurial in scripts.  When running hg
-# directly through "sage -hg", we will disable HGPLAIN in spkg/bin/sage.
+# directly through "sage -hg", we will disable HGPLAIN in src/bin/sage.
 # See Trac Ticket #12058
 HGPLAIN="yes" && export HGPLAIN
```
This can probably go.
 

```
+if [ -z "$SAGE_REPO" ]; then
+    SAGE_REPO="git://github.com/sagemath/sage.git"
+    export SAGE_REPO
+fi
```
This should be set to the trac server.

```
diff --git a/src/bin/sage-spkg b/src/bin/sage-spkg
index 20c56db..86c03c3 100755
--- a/src/bin/sage-spkg
+++ b/src/bin/sage-spkg
```
This file has had major modifications so it needs updated author credits. Also,
the comment at the start still explains its old functionality.

```
 
+DOWNLOAD_ONLY=0
+if [ "$1" = '-d' ]; then
+    DOWNLOAD_ONLY=1
+    shift
+fi
+
```
I think this is an odd way to change the functionality. Maybe download-only
should be in a script of itself.

```
diff --git a/src/bin/sage-sync-build.py b/src/bin/sage-sync-build.py
index 8e45386..b5d476a 100755
--- a/src/bin/sage-sync-build.py
+++ b/src/bin/sage-sync-build.py
<SNIP>
```
Why does sage-sync-build need so many changes? Naively, it would need only a few
changes to some directory names.

```
diff --git a/src/bin/sage-upgrade b/src/bin/sage-upgrade
index 46c1935..55432d1 100755
--- a/src/bin/sage-upgrade
+++ b/src/bin/sage-upgrade
-./install
+if [ "$#" -gt 0 ]; then
+    BRANCH="$1"
+    shift
+else
+    BRANCH=$(git symbolic-ref HEAD) ||
+        BRANCH=$(git describe --exact-match --tags HEAD | \
+                 sed -e 's;^;refs/tags/;')
+    if [ -n "$BRANCH" ]; then
+        case $BRANCH in
+            refs/heads/master) BRANCH=master;;
+            refs/heads/release) BRANCH=release;;
+            refs/heads/beta) BRANCH=beta;;
+            refs/tags/*) BRANCH=release;;
+        esac
+    fi
+fi 
```
Maybe do a `git fetch` first? Also, should we add pushing to these branches
in the repo to a script somewhere? Maybe to sage-sdist?

```
diff --git a/src/c_lib/SConstruct b/src/c_lib/SConstruct
index fd4719a..1813de8 100644
--- a/src/c_lib/SConstruct
+++ b/src/c_lib/SConstruct
-#Here we only copy the files over if we are on Cygwin.  Otherwise, the
-#library will be handled by the symlinks created in
-#$SAGE_ROOT/devel/sage/spkg-install
-if os.environ['UNAME'] == 'CYGWIN':
-    env.Alias("install", "$SAGE_LOCAL/lib")
-else:
-    env.Alias("install", [lib])
-
+env.Alias("install", "$SAGE_LOCAL")
```
Will this still work on Cygwin?

```
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 9f0bbe3..12e8434 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -407,9 +407,9 @@ def format(s, embedded=False):
     EXAMPLES::
 
         sage: from sage.misc.sagedoc import format
-        sage: identity_matrix(2).rook_vector.__doc__[115:184]
+        sage: identity_matrix(2).rook_vector.__doc__[107:176]
         'Let `A` be a general `m` by `n`\n        (0,1)-matrix with `m \\le n`. '
-        sage: format(identity_matrix(2).rook_vector.__doc__[115:184])
+        sage: format(identity_matrix(2).rook_vector.__doc__[107:176])
         'Let A be a general m by n\n   (0,1)-matrix with m <= n.\n'
 
     If the first line of the string is 'nodetex', remove 'nodetex' but
```
why did this change? Is this related to the removal of whitespace? If so:
okay.

```
diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py
index 342c3ff..7e45f0f 100644
--- a/src/sage/tests/cmdline.py
+++ b/src/sage/tests/cmdline.py
@@ -208,15 +198,9 @@ def test_executable(args, input="", timeout=100.0, **kwds):
     Test ``sage --info [packages]``, unless this is a binary (bdist)
     distribution which doesn't ship spkgs::
 
-        sage: if os.path.isfile(os.path.join(SAGE_ROOT, 'spkg', 'standard', '.from_bdist')):
-        ...     out = "Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\n= SQLAlchemy =\n...\nSQLAlchemy is the Python SQL toolkit..."
-        ...     err = ''
-        ...     ret = 0
-        ... else:
-        ...     (out, err, ret) = test_executable(["sage", "--info", "sqlalchemy"])
-        ...
+        sage: out, err, ret = test_executable(["sage", "--info", "sqlalchemy"])
         sage: print out
-        Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg
+        Using local scripts to install sqlalchemy-...
         = SQLAlchemy =
         ...
         SQLAlchemy is the Python SQL toolkit...
```
Do I understand correctly that we install sqlalchemy when running doctests? What is 
happening here?

```
diff --git a/src/spkg-delauto b/src/spkg-delauto
deleted file mode 100755
index 61d071d..0000000
--- a/src/spkg-delauto
+++ /dev/null
```
Why don't we need this anymore?



---

archive/issue_events_125866.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2013-07-24T06:46:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125866"
}
```



---

archive/issue_events_125867.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2013-07-24T06:46:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125867"
}
```



---

archive/issue_comments_176992.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [tkluck](#comment%3A12):\n> Maybe it makes sense for at least one more person to go through this diff.\n\n\nDefinitely. And hopefully someone who is already familiar with Sage's build system.\n\n> why do we clean more directories than before?\n\n\nIn order to make sure distclean still works as expected. Previously cleaning up everything wasn't important for this since distclean would just delete the whole devel directory.\n\n> What happened to this parallel_make.cfg file?\n\n\nThere is no other reference to it in the source code.\n\n> Do I understand correctly that, and is it okay that the micro_release code now\n> only strips the binaries and does not remove build directories?\n\n\nIt seems like I didn't revert some cleanup I made to the Makefile in response to #14721.\n\n> ```\n> diff --git a/build/gen_html b/build/gen_html\n> deleted file mode 100755\n> index 6dbad06..0000000\n> --- a/build/gen_html\n> +++ /dev/null\n> ```\n> What did this script do? Why don't we need it anymore?\n\n\nit is used to generate the webpages http://sagemath.org/packages/{standard,optional,experimental}, however the actual version of the script that is used in generating these patches disagrees from the version that is included in Sage. Since I was overhauling the build system (and this was in the directory related to the build system), I thought it wise to remove it to avoid any confusion.\n\n> Should we make sure that this does not break any optional/experimental packages?\n> Personally, I'm fine with any package that installs anything into this data directory,\n> which I'm guessing has been deprecated for some time now. (how long?)\n> \n> This reminds me: will we, at some point, test the installation of the \n> optional packages into the git framework? And, since we're already distributing\n> them officially, couldn't we just as well put their metadata in the repository, too?\n> (We don't need to do that right away).\n\n\nWe should at least make sure that all optional packages work. Basically all changes that might be needed should be fixable within the mercurial distribution. Since we will have to through the packages anyway, it made perfect sense to me to cleanup the whole SAGE_DATA thing. I've opened #14962 for this task.\n\n> This change has been made in quite some places. Why wasn't GREP_OPTIONS being set\n> a problem before?\n\n\nIt was, however I didn't bother fixing it on the mercurial side because either you have to unset it in sage-env or you have to do it in a bunch of packages (although it just came to me that you could unset it in sage-spkg). Unsetting in sage-env is less than ideal because it means that commands like sage -grep don't respect GREP_OPTIONS, and changing a simple thing like this across a bunch of packages is incredibly painful in the current workflow.\n\n> It feels wrong to me to prefer the src/bin version of the sage script to \n> the local/bin version. Why is this?\n\n\nI've gone back and forth on this a few times. The reason why I ended up with this was because the latest version of the sage script will always be at src/bin, where as the version at local/bin will only be updated if you have rerun make.\n\n> ```\n> diff --git a/src/bin/sage b/src/bin/sage\n> index 5c886e3..3762d5d 100755\n> --- a/src/bin/sage\n> +++ b/src/bin/sage\n> <SNIP>\n> @@ -864,12 +825,8 @@ if [ \"$1\" = '-pkg_nc' -o \"$1\" = \"--pkg_nc\" ]; then\n>  fi\n>  \n>  if [ \"$1\" = '-sdist' -o \"$1\" = \"--sdist\" ]; then\n> -    if [ $# -ne 2 ]; then\n> -        echo >&2 \"** MISSING VERSION NUMBER! **\"\n> -        exit 2\n> -    fi\n> -    maybe_sage_location\n> -    exec sage-sdist $2 \"$SAGE_ROOT\"\n> +    shift\n> +    exec sage-sdist \"$@\"\n> ```\n> Why doesn't this need sage location anymore?\n\n\nThis was a merging error, sage-location should still be here.\n\n> Why don't we call sage-location anymore? and sage-starts?\n\n\nI moved the sage-location call to sage-real-upgrade, and I think that sage-starts should probably be moved to sage-real-upgrade as well (which I think I meant to do, but it seems like I forgot).\n\n> We need to set this to the trac server. Also, what branch does this clone? It\n> should probably be the current one, because those are the binaries it copies.\n> Is it?\n\n\nWithout an argument git clone will clone HEAD. \n\n> ```\n> diff --git a/src/bin/sage-download-file b/src/bin/sage-download-file\n> index cf7dce0..a3428df 100755\n> --- a/src/bin/sage-download-file\n> +++ b/src/bin/sage-download-file\n> @@ -33,7 +33,7 @@ if [ -z \"$URL_GRABBER\" ]; then\n>      if [ -n \"$SAGE_LOCAL\" ] && [ -x \"$SAGE_LOCAL/bin/python\" ]; then\n>          URL_GRABBER=\"$SAGE_LOCAL/bin/python\"\n>      elif command -v curl &>/dev/null; then\n> -        URL_GRABBER=\"curl\"\n> +        URL_GRABBER=\"curl --fail\"\n>      elif command -v wget &>/dev/null; then\n>          URL_GRABBER=\"wget -nv -O-\"\n>      # Pick Python last because we don't know which version it is,\n> ```\n> This looks fine, but why wasn't it an issue before?\n\n\nIt was, but it is more of an issue now because sage-spkg now tries a few urls for each package, which requires sage-download-file to bail if the server returns an error.\n \n> \n> ```\n> diff --git a/src/bin/sage-sync-build.py b/src/bin/sage-sync-build.py\n> index 8e45386..b5d476a 100755\n> --- a/src/bin/sage-sync-build.py\n> +++ b/src/bin/sage-sync-build.py\n> <SNIP>\n> ```\n> Why does sage-sync-build need so many changes? Naively, it would need only a few\n> changes to some directory names.\n\n\nCurrently we are symlinking stuff into SAGE_LOCAL from the devel directory (this is to make cloning fast), however this is no longer happening in the git repository. This caused some silly breaking with the sage-sync-build, which was in need of some heavy revision anyway. There is now another ticket out there (don't remember which one) dedicated to fixing + updating this script.\n\n> ```\n> diff --git a/src/bin/sage-upgrade b/src/bin/sage-upgrade\n> index 46c1935..55432d1 100755\n> --- a/src/bin/sage-upgrade\n> +++ b/src/bin/sage-upgrade\n> -./install\n> +if [ \"$#\" -gt 0 ]; then\n> +    BRANCH=\"$1\"\n> +    shift\n> +else\n> +    BRANCH=$(git symbolic-ref HEAD) ||\n> +        BRANCH=$(git describe --exact-match --tags HEAD | \\\n> +                 sed -e 's;^;refs/tags/;')\n> +    if [ -n \"$BRANCH\" ]; then\n> +        case $BRANCH in\n> +            refs/heads/master) BRANCH=master;;\n> +            refs/heads/release) BRANCH=release;;\n> +            refs/heads/beta) BRANCH=beta;;\n> +            refs/tags/*) BRANCH=release;;\n> +        esac\n> +    fi\n> +fi \n> ```\n> Maybe do a `git fetch` first?\n\nGood idea.\n> Also, should we add pushing to these branches\n> in the repo to a script somewhere? Maybe to sage-sdist?\n\nPushing should only be done by the release manager. I think the best place for such stuff would be as part of the development scripts, although I think adding the release manager portion to these scripts should be lower priority than the general developer portion of these scripts.\n\n> ```\n> diff --git a/src/c_lib/SConstruct b/src/c_lib/SConstruct\n> index fd4719a..1813de8 100644\n> --- a/src/c_lib/SConstruct\n> +++ b/src/c_lib/SConstruct\n> -#Here we only copy the files over if we are on Cygwin.  Otherwise, the\n> -#library will be handled by the symlinks created in\n> -#$SAGE_ROOT/devel/sage/spkg-install\n> -if os.environ['UNAME'] == 'CYGWIN':\n> -    env.Alias(\"install\", \"$SAGE_LOCAL/lib\")\n> -else:\n> -    env.Alias(\"install\", [lib])\n> -\n> +env.Alias(\"install\", \"$SAGE_LOCAL\")\n> ```\n> Will this still work on Cygwin?\n\n\nI think so, although we really should have someone on Cygwin test. As I mentioned, the symlinks that the comment refers to are no more.\n\n> ```\n> diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py\n> index 342c3ff..7e45f0f 100644\n> --- a/src/sage/tests/cmdline.py\n> +++ b/src/sage/tests/cmdline.py\n> @@ -208,15 +198,9 @@ def test_executable(args, input=\"\", timeout=100.0, **kwds):\n>      Test ``sage --info [packages]``, unless this is a binary (bdist)\n>      distribution which doesn't ship spkgs::\n>  \n> -        sage: if os.path.isfile(os.path.join(SAGE_ROOT, 'spkg', 'standard', '.from_bdist')):\n> -        ...     out = \"Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\\n= SQLAlchemy =\\n...\\nSQLAlchemy is the Python SQL toolkit...\"\n> -        ...     err = ''\n> -        ...     ret = 0\n> -        ... else:\n> -        ...     (out, err, ret) = test_executable([\"sage\", \"--info\", \"sqlalchemy\"])\n> -        ...\n> +        sage: out, err, ret = test_executable([\"sage\", \"--info\", \"sqlalchemy\"])\n>          sage: print out\n> -        Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\n> +        Using local scripts to install sqlalchemy-...\n>          = SQLAlchemy =\n>          ...\n>          SQLAlchemy is the Python SQL toolkit...\n> ```\n> Do I understand correctly that we install sqlalchemy when running doctests? What is \n> happening here?\n\n\nThis can be changed in sage-spkg. That message just prints when it realizes it has the package metadata locally.\n\n> ```\n> diff --git a/src/spkg-delauto b/src/spkg-delauto\n> deleted file mode 100755\n> index 61d071d..0000000\n> --- a/src/spkg-delauto\n> +++ /dev/null\n> ```\n> Why don't we need this anymore?\n\nno other reference in the source code (except for MANIFEST.in, which should be updated)",
    "created_at": "2013-07-24T09:31:16Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176992",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:13'></a>
Replying to [tkluck](#comment%3A12):
> Maybe it makes sense for at least one more person to go through this diff.


Definitely. And hopefully someone who is already familiar with Sage's build system.

> why do we clean more directories than before?


In order to make sure distclean still works as expected. Previously cleaning up everything wasn't important for this since distclean would just delete the whole devel directory.

> What happened to this parallel_make.cfg file?


There is no other reference to it in the source code.

> Do I understand correctly that, and is it okay that the micro_release code now
> only strips the binaries and does not remove build directories?


It seems like I didn't revert some cleanup I made to the Makefile in response to #14721.

> ```
> diff --git a/build/gen_html b/build/gen_html
> deleted file mode 100755
> index 6dbad06..0000000
> --- a/build/gen_html
> +++ /dev/null
> ```
> What did this script do? Why don't we need it anymore?


it is used to generate the webpages http://sagemath.org/packages/{standard,optional,experimental}, however the actual version of the script that is used in generating these patches disagrees from the version that is included in Sage. Since I was overhauling the build system (and this was in the directory related to the build system), I thought it wise to remove it to avoid any confusion.

> Should we make sure that this does not break any optional/experimental packages?
> Personally, I'm fine with any package that installs anything into this data directory,
> which I'm guessing has been deprecated for some time now. (how long?)
> 
> This reminds me: will we, at some point, test the installation of the 
> optional packages into the git framework? And, since we're already distributing
> them officially, couldn't we just as well put their metadata in the repository, too?
> (We don't need to do that right away).


We should at least make sure that all optional packages work. Basically all changes that might be needed should be fixable within the mercurial distribution. Since we will have to through the packages anyway, it made perfect sense to me to cleanup the whole SAGE_DATA thing. I've opened #14962 for this task.

> This change has been made in quite some places. Why wasn't GREP_OPTIONS being set
> a problem before?


It was, however I didn't bother fixing it on the mercurial side because either you have to unset it in sage-env or you have to do it in a bunch of packages (although it just came to me that you could unset it in sage-spkg). Unsetting in sage-env is less than ideal because it means that commands like sage -grep don't respect GREP_OPTIONS, and changing a simple thing like this across a bunch of packages is incredibly painful in the current workflow.

> It feels wrong to me to prefer the src/bin version of the sage script to 
> the local/bin version. Why is this?


I've gone back and forth on this a few times. The reason why I ended up with this was because the latest version of the sage script will always be at src/bin, where as the version at local/bin will only be updated if you have rerun make.

> ```
> diff --git a/src/bin/sage b/src/bin/sage
> index 5c886e3..3762d5d 100755
> --- a/src/bin/sage
> +++ b/src/bin/sage
> <SNIP>
> @@ -864,12 +825,8 @@ if [ "$1" = '-pkg_nc' -o "$1" = "--pkg_nc" ]; then
>  fi
>  
>  if [ "$1" = '-sdist' -o "$1" = "--sdist" ]; then
> -    if [ $# -ne 2 ]; then
> -        echo >&2 "** MISSING VERSION NUMBER! **"
> -        exit 2
> -    fi
> -    maybe_sage_location
> -    exec sage-sdist $2 "$SAGE_ROOT"
> +    shift
> +    exec sage-sdist "$@"
> ```
> Why doesn't this need sage location anymore?


This was a merging error, sage-location should still be here.

> Why don't we call sage-location anymore? and sage-starts?


I moved the sage-location call to sage-real-upgrade, and I think that sage-starts should probably be moved to sage-real-upgrade as well (which I think I meant to do, but it seems like I forgot).

> We need to set this to the trac server. Also, what branch does this clone? It
> should probably be the current one, because those are the binaries it copies.
> Is it?


Without an argument git clone will clone HEAD. 

> ```
> diff --git a/src/bin/sage-download-file b/src/bin/sage-download-file
> index cf7dce0..a3428df 100755
> --- a/src/bin/sage-download-file
> +++ b/src/bin/sage-download-file
> @@ -33,7 +33,7 @@ if [ -z "$URL_GRABBER" ]; then
>      if [ -n "$SAGE_LOCAL" ] && [ -x "$SAGE_LOCAL/bin/python" ]; then
>          URL_GRABBER="$SAGE_LOCAL/bin/python"
>      elif command -v curl &>/dev/null; then
> -        URL_GRABBER="curl"
> +        URL_GRABBER="curl --fail"
>      elif command -v wget &>/dev/null; then
>          URL_GRABBER="wget -nv -O-"
>      # Pick Python last because we don't know which version it is,
> ```
> This looks fine, but why wasn't it an issue before?


It was, but it is more of an issue now because sage-spkg now tries a few urls for each package, which requires sage-download-file to bail if the server returns an error.
 
> 
> ```
> diff --git a/src/bin/sage-sync-build.py b/src/bin/sage-sync-build.py
> index 8e45386..b5d476a 100755
> --- a/src/bin/sage-sync-build.py
> +++ b/src/bin/sage-sync-build.py
> <SNIP>
> ```
> Why does sage-sync-build need so many changes? Naively, it would need only a few
> changes to some directory names.


Currently we are symlinking stuff into SAGE_LOCAL from the devel directory (this is to make cloning fast), however this is no longer happening in the git repository. This caused some silly breaking with the sage-sync-build, which was in need of some heavy revision anyway. There is now another ticket out there (don't remember which one) dedicated to fixing + updating this script.

> ```
> diff --git a/src/bin/sage-upgrade b/src/bin/sage-upgrade
> index 46c1935..55432d1 100755
> --- a/src/bin/sage-upgrade
> +++ b/src/bin/sage-upgrade
> -./install
> +if [ "$#" -gt 0 ]; then
> +    BRANCH="$1"
> +    shift
> +else
> +    BRANCH=$(git symbolic-ref HEAD) ||
> +        BRANCH=$(git describe --exact-match --tags HEAD | \
> +                 sed -e 's;^;refs/tags/;')
> +    if [ -n "$BRANCH" ]; then
> +        case $BRANCH in
> +            refs/heads/master) BRANCH=master;;
> +            refs/heads/release) BRANCH=release;;
> +            refs/heads/beta) BRANCH=beta;;
> +            refs/tags/*) BRANCH=release;;
> +        esac
> +    fi
> +fi 
> ```
> Maybe do a `git fetch` first?

Good idea.
> Also, should we add pushing to these branches
> in the repo to a script somewhere? Maybe to sage-sdist?

Pushing should only be done by the release manager. I think the best place for such stuff would be as part of the development scripts, although I think adding the release manager portion to these scripts should be lower priority than the general developer portion of these scripts.

> ```
> diff --git a/src/c_lib/SConstruct b/src/c_lib/SConstruct
> index fd4719a..1813de8 100644
> --- a/src/c_lib/SConstruct
> +++ b/src/c_lib/SConstruct
> -#Here we only copy the files over if we are on Cygwin.  Otherwise, the
> -#library will be handled by the symlinks created in
> -#$SAGE_ROOT/devel/sage/spkg-install
> -if os.environ['UNAME'] == 'CYGWIN':
> -    env.Alias("install", "$SAGE_LOCAL/lib")
> -else:
> -    env.Alias("install", [lib])
> -
> +env.Alias("install", "$SAGE_LOCAL")
> ```
> Will this still work on Cygwin?


I think so, although we really should have someone on Cygwin test. As I mentioned, the symlinks that the comment refers to are no more.

> ```
> diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py
> index 342c3ff..7e45f0f 100644
> --- a/src/sage/tests/cmdline.py
> +++ b/src/sage/tests/cmdline.py
> @@ -208,15 +198,9 @@ def test_executable(args, input="", timeout=100.0, **kwds):
>      Test ``sage --info [packages]``, unless this is a binary (bdist)
>      distribution which doesn't ship spkgs::
>  
> -        sage: if os.path.isfile(os.path.join(SAGE_ROOT, 'spkg', 'standard', '.from_bdist')):
> -        ...     out = "Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg\n= SQLAlchemy =\n...\nSQLAlchemy is the Python SQL toolkit..."
> -        ...     err = ''
> -        ...     ret = 0
> -        ... else:
> -        ...     (out, err, ret) = test_executable(["sage", "--info", "sqlalchemy"])
> -        ...
> +        sage: out, err, ret = test_executable(["sage", "--info", "sqlalchemy"])
>          sage: print out
> -        Found package sqlalchemy in spkg/standard/sqlalchemy-...spkg
> +        Using local scripts to install sqlalchemy-...
>          = SQLAlchemy =
>          ...
>          SQLAlchemy is the Python SQL toolkit...
> ```
> Do I understand correctly that we install sqlalchemy when running doctests? What is 
> happening here?


This can be changed in sage-spkg. That message just prints when it realizes it has the package metadata locally.

> ```
> diff --git a/src/spkg-delauto b/src/spkg-delauto
> deleted file mode 100755
> index 61d071d..0000000
> --- a/src/spkg-delauto
> +++ /dev/null
> ```
> Why don't we need this anymore?

no other reference in the source code (except for MANIFEST.in, which should be updated)



---

archive/issue_comments_176993.json:
```json
{
    "body": "<a id='comment:14'></a>\nMind if I start making some of the (simpler) changes?\n\n>Currently we are symlinking stuff into SAGE_LOCAL from the devel directory (this is to make cloning fast), however this is no longer happening in the git repository. This caused some silly breaking with the sage-sync-build, which was in need of some heavy revision anyway. There is now another ticket out there (don't remember which one) dedicated to fixing + updating this script. \n\n\nI couldn't find the ticket. Do you mean that your edits basically fix the ticket? Or do you mean that the version of `sage-sync-build` in your `build_system` branch is still in need of some heavy revision?\n\n>> It feels wrong to me to prefer the src/bin version of the sage script to the local/bin version. Why is this?\n\n> I've gone back and forth on this a few times. The reason why I ended up with this was because the latest version of the sage script will always be at src/bin, where as the version at local/bin will only be updated if you have rerun make. \n\nI agree that this is the behavior, but I'm not sure whether that's what we want. After switching branches, you could end up in the situation where the `sage` script from one branch is using `SAGE_LOCAL` files from another branch. Imagine that a branch adds both a package `imagemagick` and a command `sage -convert` and it seems much more consistent to me to only run the new sage script after `make` has been called.\n\nBut I guess that I don't mind much; whoever is in a situation where the difference affects them, is probably doing something with the internal workings of sage anyway, and should be able to deal with it.",
    "created_at": "2013-07-24T21:18:45Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176993",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:14'></a>
Mind if I start making some of the (simpler) changes?

>Currently we are symlinking stuff into SAGE_LOCAL from the devel directory (this is to make cloning fast), however this is no longer happening in the git repository. This caused some silly breaking with the sage-sync-build, which was in need of some heavy revision anyway. There is now another ticket out there (don't remember which one) dedicated to fixing + updating this script. 


I couldn't find the ticket. Do you mean that your edits basically fix the ticket? Or do you mean that the version of `sage-sync-build` in your `build_system` branch is still in need of some heavy revision?

>> It feels wrong to me to prefer the src/bin version of the sage script to the local/bin version. Why is this?

> I've gone back and forth on this a few times. The reason why I ended up with this was because the latest version of the sage script will always be at src/bin, where as the version at local/bin will only be updated if you have rerun make. 

I agree that this is the behavior, but I'm not sure whether that's what we want. After switching branches, you could end up in the situation where the `sage` script from one branch is using `SAGE_LOCAL` files from another branch. Imagine that a branch adds both a package `imagemagick` and a command `sage -convert` and it seems much more consistent to me to only run the new sage script after `make` has been called.

But I guess that I don't mind much; whoever is in a situation where the difference affects them, is probably doing something with the internal workings of sage anyway, and should be able to deal with it.



---

archive/issue_comments_176994.json:
```json
{
    "body": "<a id='comment:15'></a>\nI think it makes sense to move `build/pkgs` to `pkgs`. My current work on top of `build_system` uses `pkgs` for the package sources and `build` is used to build packages. Would it be possible to do this move in `build_system`?",
    "created_at": "2013-08-25T08:50:56Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176994",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:15'></a>
I think it makes sense to move `build/pkgs` to `pkgs`. My current work on top of `build_system` uses `pkgs` for the package sources and `build` is used to build packages. Would it be possible to do this move in `build_system`?



---

archive/issue_comments_176995.json:
```json
{
    "body": "<a id='comment:16'></a>\nOk, I think I addressed Timo's comments, with the following exceptions:\n\nHG configuration in sage-env: I don't see a good reason for getting rid of these in the short term, we may not be using hg anymore, but it could still be helpful for the transition period while repositories there are still HG repositories for optional packages.\n\nGREP_OPTIONS: I'm not going to fix this now, instead leave it to a later date (unless I encounter merge conflicts, which so far I haven't).\n\nReplying to [felixs](#comment%3A15):\n> I think it makes sense to move `build/pkgs` to `pkgs`. My current work on top of `build_system` uses `pkgs` for the package sources and `build` is used to build packages. Would it be possible to do this move in `build_system`?\n\n\nI would rather not, I don't see a huge need for change at this moment and currently everything works. We can always change this later down the road, but for now I would like to get this ticket finished.\n\n---\n\nOne other thing is that some functionality (especially sdist and bdist) might be broken until I merge the git spkg, which I will do in this ticket. However, there is still plenty of other code that needs review so I'm going to mark this to needs review for the moment.",
    "created_at": "2013-08-31T05:48:36Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176995",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:16'></a>
Ok, I think I addressed Timo's comments, with the following exceptions:

HG configuration in sage-env: I don't see a good reason for getting rid of these in the short term, we may not be using hg anymore, but it could still be helpful for the transition period while repositories there are still HG repositories for optional packages.

GREP_OPTIONS: I'm not going to fix this now, instead leave it to a later date (unless I encounter merge conflicts, which so far I haven't).

Replying to [felixs](#comment%3A15):
> I think it makes sense to move `build/pkgs` to `pkgs`. My current work on top of `build_system` uses `pkgs` for the package sources and `build` is used to build packages. Would it be possible to do this move in `build_system`?


I would rather not, I don't see a huge need for change at this moment and currently everything works. We can always change this later down the road, but for now I would like to get this ticket finished.

---

One other thing is that some functionality (especially sdist and bdist) might be broken until I merge the git spkg, which I will do in this ticket. However, there is still plenty of other code that needs review so I'm going to mark this to needs review for the moment.



---

archive/issue_events_125868.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-08-31T05:48:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125868"
}
```



---

archive/issue_events_125869.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2013-08-31T05:48:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125869"
}
```



---

archive/issue_comments_176996.json:
```json
{
    "body": "<a id='comment:18'></a>\nok, merged in the git spkg, so all should be good to go",
    "created_at": "2013-08-31T06:16:24Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176996",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:18'></a>
ok, merged in the git spkg, so all should be good to go



---

archive/issue_comments_176997.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-09-01T08:37:02Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_176998.json:
```json
{
    "body": "**Commit:** [c7903c067f0fa949bcd09e6e60c6c306dee26ab4](https://github.com/sagemath/sagetrac-mirror/commit/c7903c067f0fa949bcd09e6e60c6c306dee26ab4)",
    "created_at": "2013-09-01T08:37:02Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [c7903c067f0fa949bcd09e6e60c6c306dee26ab4](https://github.com/sagemath/sagetrac-mirror/commit/c7903c067f0fa949bcd09e6e60c6c306dee26ab4)



---

archive/issue_comments_176999.json:
```json
{
    "body": "<a id='comment:20'></a>\nSome comments (I will probably have several, so I post them one by one):\n\nIn top-level `Makefile` in `lib-clean`, replace\n\n```\n        rm -rf src/sage/libs/pari/gen.h\n        rm -rf src/sage/modular/arithgroup/farey_symbol.h\n        rm -rf src/sage/rings/real_mpfi.h\n        rm -rf src/sage/symbolic/pynac.h\n```\nby\n\n```\n        rm -f src/sage/modular/arithgroup/farey_symbol.h\n        rm -f src/sage/rings/real_mpfi.h\n        rm -f src/sage/symbolic/pynac.h\n```\n(the removal of `gen.h` is #15124).\n\nActually, I would prefer a multi-level `Makefile` (this is the preferred way for `automake`). That is, move `lib-clean` to a file `src/Makefile` and have the top-level `Makefile` contain:\n\n```\nlib-clean:\n    cd src && $(MAKE) clean\n```",
    "created_at": "2013-09-02T12:27:25Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-176999",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Some comments (I will probably have several, so I post them one by one):

In top-level `Makefile` in `lib-clean`, replace

```
        rm -rf src/sage/libs/pari/gen.h
        rm -rf src/sage/modular/arithgroup/farey_symbol.h
        rm -rf src/sage/rings/real_mpfi.h
        rm -rf src/sage/symbolic/pynac.h
```
by

```
        rm -f src/sage/modular/arithgroup/farey_symbol.h
        rm -f src/sage/rings/real_mpfi.h
        rm -f src/sage/symbolic/pynac.h
```
(the removal of `gen.h` is #15124).

Actually, I would prefer a multi-level `Makefile` (this is the preferred way for `automake`). That is, move `lib-clean` to a file `src/Makefile` and have the top-level `Makefile` contain:

```
lib-clean:
    cd src && $(MAKE) clean
```



---

archive/issue_comments_177000.json:
```json
{
    "body": "<a id='comment:21'></a>\n`SCRIPT_SOURCES` and the likes in `build/Makefile` (generated by `build/install`): why use absolute filenames instead of environment variables like `$(SAGE_LOCAL)`? This might break relocation.",
    "created_at": "2013-09-02T12:38:17Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177000",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
`SCRIPT_SOURCES` and the likes in `build/Makefile` (generated by `build/install`): why use absolute filenames instead of environment variables like `$(SAGE_LOCAL)`? This might break relocation.



---

archive/issue_comments_177001.json:
```json
{
    "body": "<a id='comment:22'></a>\n`build/Makefile`: what does `@mkdir -p \"$(@D)\"` do? Add a comment explaining this.",
    "created_at": "2013-09-02T12:39:15Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177001",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
`build/Makefile`: what does `@mkdir -p "$(@D)"` do? Add a comment explaining this.



---

archive/issue_comments_177002.json:
```json
{
    "body": "<a id='comment:23'></a>\n`src/bin/sage-spkg`: replace\n\n```\n    RESULT=`GREP_OPTIONS= grep \"^$param\\ *=\"  $file| sed \"s/^$param\\ *=\\ *//\"`\n    echo $RESULT\n```\nby\n\n```\n    sed -n \"s/^${param} *= *//p\" $file\n```",
    "created_at": "2013-09-02T12:44:43Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177002",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
`src/bin/sage-spkg`: replace

```
    RESULT=`GREP_OPTIONS= grep "^$param\ *="  $file| sed "s/^$param\ *=\ *//"`
    echo $RESULT
```
by

```
    sed -n "s/^${param} *= *//p" $file
```



---

archive/issue_comments_177003.json:
```json
{
    "body": "<a id='comment:24'></a>\nConcerning checksums: why not add Python support? For the buildbots, I have this script to verify checksums of Sage tarballs:\n\n```\n#!/usr/bin/env python\n\nimport hashlib\nimport sys\n\nH = hashlib.sha256()\n\nwhile True:\n    d = sys.stdin.read(4096)\n    H.update(d)\n    if not len(d):\n        break\n\nprint H.hexdigest()\n```\n\nYou could have a variant of this be called `shasum.py` and then run `python shasum.py` if Python exists (`command -v python`).",
    "created_at": "2013-09-02T12:51:59Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177003",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Concerning checksums: why not add Python support? For the buildbots, I have this script to verify checksums of Sage tarballs:

```
#!/usr/bin/env python

import hashlib
import sys

H = hashlib.sha256()

while True:
    d = sys.stdin.read(4096)
    H.update(d)
    if not len(d):
        break

print H.hexdigest()
```

You could have a variant of this be called `shasum.py` and then run `python shasum.py` if Python exists (`command -v python`).



---

archive/issue_comments_177004.json:
```json
{
    "body": "<a id='comment:25'></a>\nIn shell scripts, all instances of `[ A == B ]` should be replaced by `[ A = B ]`.",
    "created_at": "2013-09-02T12:56:50Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177004",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
In shell scripts, all instances of `[ A == B ]` should be replaced by `[ A = B ]`.



---

archive/issue_comments_177005.json:
```json
{
    "body": "<a id='comment:26'></a>\nIn `src/bin/sage-spkg`, what is the purpose of `USE_LOCAL_SCRIPTS`? It is difficult for me to understand, perhaps some comment should be added.",
    "created_at": "2013-09-02T13:06:27Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177005",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
In `src/bin/sage-spkg`, what is the purpose of `USE_LOCAL_SCRIPTS`? It is difficult for me to understand, perhaps some comment should be added.



---

archive/issue_comments_177006.json:
```json
{
    "body": "<a id='comment:27'></a>\nI dislike `local/var/tmp/sage/build`. One often needs to go into this directory to debug stuff, could you not use an easier directory instead?",
    "created_at": "2013-09-02T13:13:51Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177006",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
I dislike `local/var/tmp/sage/build`. One often needs to go into this directory to debug stuff, could you not use an easier directory instead?



---

archive/issue_comments_177007.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jdemeyer](#comment%3A27):\n> I dislike `local/var/tmp/sage/build`. One often needs to go into this directory to debug stuff, could you not use an easier directory instead?\n\nSure, any suggestions (I would like to keep it under `local` somewhere, as it in the longterm consolidates the directories that would need to be cleaned).",
    "created_at": "2013-09-02T17:46:37Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177007",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:28'></a>
Replying to [jdemeyer](#comment%3A27):
> I dislike `local/var/tmp/sage/build`. One often needs to go into this directory to debug stuff, could you not use an easier directory instead?

Sure, any suggestions (I would like to keep it under `local` somewhere, as it in the longterm consolidates the directories that would need to be cleaned).



---

archive/issue_comments_177008.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-09-02T18:11:44Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177009.json:
```json
{
    "body": "**Changing commit** from \"[c7903c067f0fa949bcd09e6e60c6c306dee26ab4](https://github.com/sagemath/sagetrac-mirror/commit/c7903c067f0fa949bcd09e6e60c6c306dee26ab4)\" to \"[1a65c42fcce72b927d76fe7dfc9d6779c80c0cef](https://github.com/sagemath/sagetrac-mirror/commit/1a65c42fcce72b927d76fe7dfc9d6779c80c0cef)\".",
    "created_at": "2013-09-02T18:11:44Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c7903c067f0fa949bcd09e6e60c6c306dee26ab4](https://github.com/sagemath/sagetrac-mirror/commit/c7903c067f0fa949bcd09e6e60c6c306dee26ab4)" to "[1a65c42fcce72b927d76fe7dfc9d6779c80c0cef](https://github.com/sagemath/sagetrac-mirror/commit/1a65c42fcce72b927d76fe7dfc9d6779c80c0cef)".



---

archive/issue_comments_177010.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-09-05T19:25:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177011.json:
```json
{
    "body": "**Changing commit** from \"[1a65c42fcce72b927d76fe7dfc9d6779c80c0cef](https://github.com/sagemath/sagetrac-mirror/commit/1a65c42fcce72b927d76fe7dfc9d6779c80c0cef)\" to \"[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)\".",
    "created_at": "2013-09-05T19:25:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1a65c42fcce72b927d76fe7dfc9d6779c80c0cef](https://github.com/sagemath/sagetrac-mirror/commit/1a65c42fcce72b927d76fe7dfc9d6779c80c0cef)" to "[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)".



---

archive/issue_comments_177012.json:
```json
{
    "body": "<a id='comment:31'></a>\nWhat's the status of this ticket?  Andrew, are you going to be able to address Jeroen's concerns soon?",
    "created_at": "2013-09-06T16:06:07Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177012",
    "user": "https://github.com/roed314"
}
```

<a id='comment:31'></a>
What's the status of this ticket?  Andrew, are you going to be able to address Jeroen's concerns soon?



---

archive/issue_events_125870.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-09-06T16:06:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125870"
}
```



---

archive/issue_events_125871.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2013-09-06T16:06:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125871"
}
```



---

archive/issue_comments_177013.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-09-06T16:48:44Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177014.json:
```json
{
    "body": "**Changing commit** from \"[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)\" to \"[c29a7554ab4cfd9f0d17a8a242558db5b820b12a](https://github.com/sagemath/sagetrac-mirror/commit/c29a7554ab4cfd9f0d17a8a242558db5b820b12a)\".",
    "created_at": "2013-09-06T16:48:44Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)" to "[c29a7554ab4cfd9f0d17a8a242558db5b820b12a](https://github.com/sagemath/sagetrac-mirror/commit/c29a7554ab4cfd9f0d17a8a242558db5b820b12a)".



---

archive/issue_comments_177015.json:
```json
{
    "body": "**Changing commit** from \"[c29a7554ab4cfd9f0d17a8a242558db5b820b12a](https://github.com/sagemath/sagetrac-mirror/commit/c29a7554ab4cfd9f0d17a8a242558db5b820b12a)\" to \"[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)\".",
    "created_at": "2013-09-06T16:52:14Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177015",
    "user": "https://github.com/ohanar"
}
```

**Changing commit** from "[c29a7554ab4cfd9f0d17a8a242558db5b820b12a](https://github.com/sagemath/sagetrac-mirror/commit/c29a7554ab4cfd9f0d17a8a242558db5b820b12a)" to "[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)".



---

archive/issue_comments_177016.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jdemeyer](#comment%3A24):\n> Concerning checksums: why not add Python support? For the buildbots, I have this script to verify checksums of Sage tarballs:\n\n>\n> You could have a variant of this be called `shasum.py` and then run `python shasum.py` if Python exists (`command -v python`).\n\n\nI don't quite understand why we should duplicate this functionality in python, since we already have a working version in shell.",
    "created_at": "2013-09-06T16:52:14Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177016",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:33'></a>
Replying to [jdemeyer](#comment%3A24):
> Concerning checksums: why not add Python support? For the buildbots, I have this script to verify checksums of Sage tarballs:

>
> You could have a variant of this be called `shasum.py` and then run `python shasum.py` if Python exists (`command -v python`).


I don't quite understand why we should duplicate this functionality in python, since we already have a working version in shell.



---

archive/issue_comments_177017.json:
```json
{
    "body": "**Changing commit** from \"[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)\" to \"[86a61958f775df75bfabb035ffeeaffd69ffdec6](https://github.com/sagemath/sagetrac-mirror/commit/86a61958f775df75bfabb035ffeeaffd69ffdec6)\".",
    "created_at": "2013-09-13T23:55:55Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[50e57d75d53601bc073a855ce995d7aa92506a92](https://github.com/sagemath/sagetrac-mirror/commit/50e57d75d53601bc073a855ce995d7aa92506a92)" to "[86a61958f775df75bfabb035ffeeaffd69ffdec6](https://github.com/sagemath/sagetrac-mirror/commit/86a61958f775df75bfabb035ffeeaffd69ffdec6)".



---

archive/issue_comments_177018.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-09-13T23:55:55Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177019.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td>[changeset:bf48181]</td><td><code>Trac #14908: Two small issues with make micro_release</code></td></tr><tr><td>[changeset:0628ee3]</td><td><code>Fix two small issues with make micro_release</code></td></tr></table>\n",
    "created_at": "2013-09-16T22:54:02Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td>[changeset:bf48181]</td><td><code>Trac #14908: Two small issues with make micro_release</code></td></tr><tr><td>[changeset:0628ee3]</td><td><code>Fix two small issues with make micro_release</code></td></tr></table>




---

archive/issue_comments_177020.json:
```json
{
    "body": "**Changing commit** from \"[86a61958f775df75bfabb035ffeeaffd69ffdec6](https://github.com/sagemath/sagetrac-mirror/commit/86a61958f775df75bfabb035ffeeaffd69ffdec6)\" to \"[bf481816e69f86973d24a18e7df25852b69a2a8a](https://github.com/sagemath/sagetrac-mirror/commit/bf481816e69f86973d24a18e7df25852b69a2a8a)\".",
    "created_at": "2013-09-16T22:54:02Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[86a61958f775df75bfabb035ffeeaffd69ffdec6](https://github.com/sagemath/sagetrac-mirror/commit/86a61958f775df75bfabb035ffeeaffd69ffdec6)" to "[bf481816e69f86973d24a18e7df25852b69a2a8a](https://github.com/sagemath/sagetrac-mirror/commit/bf481816e69f86973d24a18e7df25852b69a2a8a)".



---

archive/issue_comments_177021.json:
```json
{
    "body": "<a id='comment:36'></a>\nWhy is this needs info? Because we want to know its status? Isn't that a bit self-referential?\n\nI think all of Jeroen's comments were addressed except the build dir (though I agree that keeping it under local is a good idea, and the old build dir wasn't particularly short either) and using Python to compute the hash (better solution than calling external program, but might depend on whether Python build hashlib correctly which IIRC sometimes causes trouble). In any case both can be easily changed later on, so I don't think we necessarily have to act on them now.",
    "created_at": "2013-09-22T21:10:16Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177021",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
Why is this needs info? Because we want to know its status? Isn't that a bit self-referential?

I think all of Jeroen's comments were addressed except the build dir (though I agree that keeping it under local is a good idea, and the old build dir wasn't particularly short either) and using Python to compute the hash (better solution than calling external program, but might depend on whether Python build hashlib correctly which IIRC sometimes causes trouble). In any case both can be easily changed later on, so I don't think we necessarily have to act on them now.



---

archive/issue_events_125872.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-09-22T21:10:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125872"
}
```



---

archive/issue_events_125873.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-09-22T21:10:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125873"
}
```



---

archive/issue_comments_177022.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td>[changeset:5677976]</td><td><code>Trac #15120: Fix doctest doctests in git layout.</code></td></tr><tr><td>[changeset:e11727c]</td><td><code>revert the change to .gitignore</code></td></tr><tr><td>[changeset:6912669]</td><td><code>Fix --new option for doctests.</code></td></tr><tr><td>[changeset:98d0840]</td><td><code>Fix doctest doctest due to directory restructure.</code></td></tr></table>\n",
    "created_at": "2013-09-22T23:16:29Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td>[changeset:5677976]</td><td><code>Trac #15120: Fix doctest doctests in git layout.</code></td></tr><tr><td>[changeset:e11727c]</td><td><code>revert the change to .gitignore</code></td></tr><tr><td>[changeset:6912669]</td><td><code>Fix --new option for doctests.</code></td></tr><tr><td>[changeset:98d0840]</td><td><code>Fix doctest doctest due to directory restructure.</code></td></tr></table>




---

archive/issue_comments_177023.json:
```json
{
    "body": "**Changing commit** from \"[bf481816e69f86973d24a18e7df25852b69a2a8a](https://github.com/sagemath/sagetrac-mirror/commit/bf481816e69f86973d24a18e7df25852b69a2a8a)\" to \"[5677976a6fdd6f7a1c1f5e634868accd6be0eeac](https://github.com/sagemath/sagetrac-mirror/commit/5677976a6fdd6f7a1c1f5e634868accd6be0eeac)\".",
    "created_at": "2013-09-22T23:16:29Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bf481816e69f86973d24a18e7df25852b69a2a8a](https://github.com/sagemath/sagetrac-mirror/commit/bf481816e69f86973d24a18e7df25852b69a2a8a)" to "[5677976a6fdd6f7a1c1f5e634868accd6be0eeac](https://github.com/sagemath/sagetrac-mirror/commit/5677976a6fdd6f7a1c1f5e634868accd6be0eeac)".



---

archive/issue_comments_177024.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td>[changeset:56d80d0]</td><td><code>[FIXUP] 5.12.rc0: update git specific files</code></td></tr><tr><td>[changeset:4aa23b7]</td><td><code>Merge branch 'master' into build_system</code></td></tr><tr><td>[changeset:df16d32]</td><td><code>Merge 'sage-5.12.rc0' into master</code></td></tr><tr><td>[changeset:45a79e8]</td><td><code>5.12.rc0</code></td></tr><tr><td>[changeset:0f00389]</td><td><code>5.12.rc0</code></td></tr><tr><td>[changeset:a77c210]</td><td><code>Trac #13770: Add upstream pull request 215 for multivariate factorisation</code></td></tr><tr><td>[changeset:18be736]</td><td><code>Trac #13770: bug in multivariate factorization over prime fields</code></td></tr><tr><td>[changeset:59c8447]</td><td><code>Trac #15194: added imports and doctests for MIPSolver exceptions</code></td></tr><tr><td>[changeset:49dc953]</td><td><code>Trac #14776: implements StrongTableau and StrongTableaux classes</code></td></tr><tr><td>[changeset:a854c61]</td><td><code>Trac #15204: fix gap cyclotomics to sage</code></td></tr></table>\n",
    "created_at": "2013-10-02T18:56:05Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td>[changeset:56d80d0]</td><td><code>[FIXUP] 5.12.rc0: update git specific files</code></td></tr><tr><td>[changeset:4aa23b7]</td><td><code>Merge branch 'master' into build_system</code></td></tr><tr><td>[changeset:df16d32]</td><td><code>Merge 'sage-5.12.rc0' into master</code></td></tr><tr><td>[changeset:45a79e8]</td><td><code>5.12.rc0</code></td></tr><tr><td>[changeset:0f00389]</td><td><code>5.12.rc0</code></td></tr><tr><td>[changeset:a77c210]</td><td><code>Trac #13770: Add upstream pull request 215 for multivariate factorisation</code></td></tr><tr><td>[changeset:18be736]</td><td><code>Trac #13770: bug in multivariate factorization over prime fields</code></td></tr><tr><td>[changeset:59c8447]</td><td><code>Trac #15194: added imports and doctests for MIPSolver exceptions</code></td></tr><tr><td>[changeset:49dc953]</td><td><code>Trac #14776: implements StrongTableau and StrongTableaux classes</code></td></tr><tr><td>[changeset:a854c61]</td><td><code>Trac #15204: fix gap cyclotomics to sage</code></td></tr></table>




---

archive/issue_comments_177025.json:
```json
{
    "body": "**Changing commit** from \"[5677976a6fdd6f7a1c1f5e634868accd6be0eeac](https://github.com/sagemath/sagetrac-mirror/commit/5677976a6fdd6f7a1c1f5e634868accd6be0eeac)\" to \"[56d80d07ad270272a64e8c71fd7a9bc632f37ba6](https://github.com/sagemath/sagetrac-mirror/commit/56d80d07ad270272a64e8c71fd7a9bc632f37ba6)\".",
    "created_at": "2013-10-02T18:56:05Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5677976a6fdd6f7a1c1f5e634868accd6be0eeac](https://github.com/sagemath/sagetrac-mirror/commit/5677976a6fdd6f7a1c1f5e634868accd6be0eeac)" to "[56d80d07ad270272a64e8c71fd7a9bc632f37ba6](https://github.com/sagemath/sagetrac-mirror/commit/56d80d07ad270272a64e8c71fd7a9bc632f37ba6)".



---

archive/issue_comments_177026.json:
```json
{
    "body": "**Changing commit** from \"[56d80d07ad270272a64e8c71fd7a9bc632f37ba6](https://github.com/sagemath/sagetrac-mirror/commit/56d80d07ad270272a64e8c71fd7a9bc632f37ba6)\" to \"[ca97e70c81f671ba4413ecb1530331d91560c46f](https://github.com/sagemath/sagetrac-mirror/commit/ca97e70c81f671ba4413ecb1530331d91560c46f)\".",
    "created_at": "2013-10-05T08:39:43Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[56d80d07ad270272a64e8c71fd7a9bc632f37ba6](https://github.com/sagemath/sagetrac-mirror/commit/56d80d07ad270272a64e8c71fd7a9bc632f37ba6)" to "[ca97e70c81f671ba4413ecb1530331d91560c46f](https://github.com/sagemath/sagetrac-mirror/commit/ca97e70c81f671ba4413ecb1530331d91560c46f)".



---

archive/issue_comments_177027.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td>[changeset:ca97e70]</td><td><code>[FIXUP] 5.12.rc1: update git specific files</code></td></tr><tr><td>[changeset:9cf9b36]</td><td><code>Merge branch 'master' into build_system</code></td></tr><tr><td>[changeset:e061dd3]</td><td><code>Merge 'sage-5.12.rc1' into master</code></td></tr><tr><td>[changeset:864c388]</td><td><code>5.12.rc1</code></td></tr><tr><td>[changeset:dab4c3f]</td><td><code>5.12.rc1</code></td></tr><tr><td>[changeset:9c2f74f]</td><td><code>Trac #15252: Doctest tolerance</code></td></tr><tr><td>[changeset:07f335d]</td><td><code>Trac #13948: fix various configure tests which break with Clang</code></td></tr><tr><td>[changeset:463ace3]</td><td><code>Trac #15189: fixed recursion in _equivalence method used by is_field_isomorphic</code></td></tr><tr><td>[changeset:b856810]</td><td><code>Trac #15193: add method Factorization._pari_(), using itertools.chain</code></td></tr><tr><td>[changeset:05fdb53]</td><td><code>Trac #13948: Document that Sage can now be bootstrapped with Clang</code></td></tr></table>\n",
    "created_at": "2013-10-05T08:39:43Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177027",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td>[changeset:ca97e70]</td><td><code>[FIXUP] 5.12.rc1: update git specific files</code></td></tr><tr><td>[changeset:9cf9b36]</td><td><code>Merge branch 'master' into build_system</code></td></tr><tr><td>[changeset:e061dd3]</td><td><code>Merge 'sage-5.12.rc1' into master</code></td></tr><tr><td>[changeset:864c388]</td><td><code>5.12.rc1</code></td></tr><tr><td>[changeset:dab4c3f]</td><td><code>5.12.rc1</code></td></tr><tr><td>[changeset:9c2f74f]</td><td><code>Trac #15252: Doctest tolerance</code></td></tr><tr><td>[changeset:07f335d]</td><td><code>Trac #13948: fix various configure tests which break with Clang</code></td></tr><tr><td>[changeset:463ace3]</td><td><code>Trac #15189: fixed recursion in _equivalence method used by is_field_isomorphic</code></td></tr><tr><td>[changeset:b856810]</td><td><code>Trac #15193: add method Factorization._pari_(), using itertools.chain</code></td></tr><tr><td>[changeset:05fdb53]</td><td><code>Trac #13948: Document that Sage can now be bootstrapped with Clang</code></td></tr></table>




---

archive/issue_comments_177028.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-10-10T02:21:16Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177028",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177029.json:
```json
{
    "body": "**Changing commit** from \"[ca97e70c81f671ba4413ecb1530331d91560c46f](https://github.com/sagemath/sagetrac-mirror/commit/ca97e70c81f671ba4413ecb1530331d91560c46f)\" to \"[60d5a0630a478a7778110581fc46ef4b9c6dd8ab](https://github.com/sagemath/sagetrac-mirror/commit/60d5a0630a478a7778110581fc46ef4b9c6dd8ab)\".",
    "created_at": "2013-10-10T02:21:16Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ca97e70c81f671ba4413ecb1530331d91560c46f](https://github.com/sagemath/sagetrac-mirror/commit/ca97e70c81f671ba4413ecb1530331d91560c46f)" to "[60d5a0630a478a7778110581fc46ef4b9c6dd8ab](https://github.com/sagemath/sagetrac-mirror/commit/60d5a0630a478a7778110581fc46ef4b9c6dd8ab)".



---

archive/issue_comments_177030.json:
```json
{
    "body": "<a id='comment:41'></a>\nI wonder if there should be a symbolic link from \"doc\" at the top level pointing to `src/doc/output/html/en`. Not exactly a new directory layout, but in the spirit of this ticket: beginning users might be comforted to find the documentation in an obvious place. This link should probably created at the end of the build process, after building the docs (part of the `doc` target in `Makefile`).\n\nThis could also be done on a separate ticket, of course.",
    "created_at": "2013-10-10T06:12:36Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177030",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>
I wonder if there should be a symbolic link from "doc" at the top level pointing to `src/doc/output/html/en`. Not exactly a new directory layout, but in the spirit of this ticket: beginning users might be comforted to find the documentation in an obvious place. This link should probably created at the end of the build process, after building the docs (part of the `doc` target in `Makefile`).

This could also be done on a separate ticket, of course.



---

archive/issue_comments_177031.json:
```json
{
    "body": "**Changing commit** from \"[60d5a0630a478a7778110581fc46ef4b9c6dd8ab](https://github.com/sagemath/sagetrac-mirror/commit/60d5a0630a478a7778110581fc46ef4b9c6dd8ab)\" to \"[ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba](https://github.com/sagemath/sagetrac-mirror/commit/ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba)\".",
    "created_at": "2013-10-24T18:55:59Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[60d5a0630a478a7778110581fc46ef4b9c6dd8ab](https://github.com/sagemath/sagetrac-mirror/commit/60d5a0630a478a7778110581fc46ef4b9c6dd8ab)" to "[ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba](https://github.com/sagemath/sagetrac-mirror/commit/ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba)".



---

archive/issue_comments_177032.json:
```json
{
    "body": "<a id='comment:42'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td>[changeset:ec4ed11]</td><td><code>[FIXUP] 5.13.beta1: update git specific files</code></td></tr><tr><td>[changeset:a23df3e]</td><td><code>Merge branch 'upstream' into build_system</code></td></tr><tr><td>[changeset:b7dc123]</td><td><code>Merge 'sage-5.13.beta1'</code></td></tr><tr><td>[changeset:8693e80]</td><td><code>5.13.beta1</code></td></tr><tr><td>[changeset:755697a]</td><td><code>5.13.beta1</code></td></tr><tr><td>[changeset:e3808e5]</td><td><code>Trac #13726: Semimonomial transformation group</code></td></tr><tr><td>[changeset:d182ea9]</td><td><code>Trac #15279: init of RootSystem corrected</code></td></tr><tr><td>[changeset:f5adfd5]</td><td><code>Solaris / ZFS fix</code></td></tr><tr><td>[changeset:d13cee2]</td><td><code>Trac #15270: Do not give up if the upstream shared library build fails</code></td></tr><tr><td>[changeset:d25cd84]</td><td><code>Trac #10589: Updating the message for the fixdoctests option printed by --advanced</code></td></tr></table>\n",
    "created_at": "2013-10-24T18:55:59Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td>[changeset:ec4ed11]</td><td><code>[FIXUP] 5.13.beta1: update git specific files</code></td></tr><tr><td>[changeset:a23df3e]</td><td><code>Merge branch 'upstream' into build_system</code></td></tr><tr><td>[changeset:b7dc123]</td><td><code>Merge 'sage-5.13.beta1'</code></td></tr><tr><td>[changeset:8693e80]</td><td><code>5.13.beta1</code></td></tr><tr><td>[changeset:755697a]</td><td><code>5.13.beta1</code></td></tr><tr><td>[changeset:e3808e5]</td><td><code>Trac #13726: Semimonomial transformation group</code></td></tr><tr><td>[changeset:d182ea9]</td><td><code>Trac #15279: init of RootSystem corrected</code></td></tr><tr><td>[changeset:f5adfd5]</td><td><code>Solaris / ZFS fix</code></td></tr><tr><td>[changeset:d13cee2]</td><td><code>Trac #15270: Do not give up if the upstream shared library build fails</code></td></tr><tr><td>[changeset:d25cd84]</td><td><code>Trac #10589: Updating the message for the fixdoctests option printed by --advanced</code></td></tr></table>




---

archive/issue_comments_177033.json:
```json
{
    "body": "<a id='comment:43'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-10-24T22:16:19Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177034.json:
```json
{
    "body": "**Changing commit** from \"[ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba](https://github.com/sagemath/sagetrac-mirror/commit/ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba)\" to \"[952f7e3d12a82a40e6c0365f98f0e3984b4308ca](https://github.com/sagemath/sagetrac-mirror/commit/952f7e3d12a82a40e6c0365f98f0e3984b4308ca)\".",
    "created_at": "2013-10-24T22:16:19Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba](https://github.com/sagemath/sagetrac-mirror/commit/ec4ed117d844ca2ce24f16e01e5e61e5683ef4ba)" to "[952f7e3d12a82a40e6c0365f98f0e3984b4308ca](https://github.com/sagemath/sagetrac-mirror/commit/952f7e3d12a82a40e6c0365f98f0e3984b4308ca)".



---

archive/issue_comments_177035.json:
```json
{
    "body": "<a id='comment:44'></a>\nThe docs `en/reference/misc/index.rst` still reference the deleted `sage/misc/hg`, leading to a docbuild error. I think this branch would be the right place to fix the fallout.\n\nAs for the doc symlink, we should probably disentangle the `src` dir from build output altogether. Documentation should probably go into `local/share/sage/doc`. But first we really should finalize the git transition.",
    "created_at": "2013-10-26T13:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177035",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>
The docs `en/reference/misc/index.rst` still reference the deleted `sage/misc/hg`, leading to a docbuild error. I think this branch would be the right place to fix the fallout.

As for the doc symlink, we should probably disentangle the `src` dir from build output altogether. Documentation should probably go into `local/share/sage/doc`. But first we really should finalize the git transition.



---

archive/issue_comments_177036.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-11-04T22:37:11Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177037.json:
```json
{
    "body": "**Changing commit** from \"[952f7e3d12a82a40e6c0365f98f0e3984b4308ca](https://github.com/sagemath/sagetrac-mirror/commit/952f7e3d12a82a40e6c0365f98f0e3984b4308ca)\" to \"[874ba344029a1baae5d9ab8ba6554f5a0d0126a7](https://github.com/sagemath/sagetrac-mirror/commit/874ba344029a1baae5d9ab8ba6554f5a0d0126a7)\".",
    "created_at": "2013-11-04T22:37:11Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[952f7e3d12a82a40e6c0365f98f0e3984b4308ca](https://github.com/sagemath/sagetrac-mirror/commit/952f7e3d12a82a40e6c0365f98f0e3984b4308ca)" to "[874ba344029a1baae5d9ab8ba6554f5a0d0126a7](https://github.com/sagemath/sagetrac-mirror/commit/874ba344029a1baae5d9ab8ba6554f5a0d0126a7)".



---

archive/issue_comments_177038.json:
```json
{
    "body": "**Changing commit** from \"[874ba344029a1baae5d9ab8ba6554f5a0d0126a7](https://github.com/sagemath/sagetrac-mirror/commit/874ba344029a1baae5d9ab8ba6554f5a0d0126a7)\" to \"[f5796f2d3508aa39ef578121d0796d1bf3fecfbe](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2d3508aa39ef578121d0796d1bf3fecfbe)\".",
    "created_at": "2013-11-06T20:10:51Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[874ba344029a1baae5d9ab8ba6554f5a0d0126a7](https://github.com/sagemath/sagetrac-mirror/commit/874ba344029a1baae5d9ab8ba6554f5a0d0126a7)" to "[f5796f2d3508aa39ef578121d0796d1bf3fecfbe](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2d3508aa39ef578121d0796d1bf3fecfbe)".



---

archive/issue_comments_177039.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td>[f5796f2](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2)</td><td><code>remove reference to sage/misc/hg from docbuild</code></td></tr></table>\n",
    "created_at": "2013-11-06T20:10:51Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td>[f5796f2](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2)</td><td><code>remove reference to sage/misc/hg from docbuild</code></td></tr></table>




---

archive/issue_comments_177040.json:
```json
{
    "body": "<a id='comment:47'></a>\nLooks good to me!",
    "created_at": "2013-11-06T22:50:36Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177040",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:47'></a>
Looks good to me!



---

archive/issue_events_125874.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-06T22:50:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125874"
}
```



---

archive/issue_events_125875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-06T22:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125875"
}
```



---

archive/issue_comments_177041.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2013-11-06T22:50:36Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177041",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_177042.json:
```json
{
    "body": "**Changing commit** from \"[f5796f2d3508aa39ef578121d0796d1bf3fecfbe](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2d3508aa39ef578121d0796d1bf3fecfbe)\" to \"[1b1d23620cb9e912c21afe6ec75aba322d6b2dd5](https://github.com/sagemath/sagetrac-mirror/commit/1b1d23620cb9e912c21afe6ec75aba322d6b2dd5)\".",
    "created_at": "2013-11-15T20:46:50Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f5796f2d3508aa39ef578121d0796d1bf3fecfbe](https://github.com/sagemath/sagetrac-mirror/commit/f5796f2d3508aa39ef578121d0796d1bf3fecfbe)" to "[1b1d23620cb9e912c21afe6ec75aba322d6b2dd5](https://github.com/sagemath/sagetrac-mirror/commit/1b1d23620cb9e912c21afe6ec75aba322d6b2dd5)".



---

archive/issue_events_125876.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2013-11-15T20:46:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125876"
}
```



---

archive/issue_events_125877.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2013-11-15T20:46:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125877"
}
```



---

archive/issue_comments_177043.json:
```json
{
    "body": "<a id='comment:48'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** New commits:",
    "created_at": "2013-11-15T20:46:50Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** New commits:



---

archive/issue_events_125878.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-23T02:20:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125878"
}
```



---

archive/issue_events_125879.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-11-23T02:20:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125879"
}
```



---

archive/issue_comments_177044.json:
```json
{
    "body": "<a id='comment:49'></a>\nFor the record, this ticket is positively reviewed. Even if Andrew keeps merging the sage-hg branch until sage-5.13 is finished.",
    "created_at": "2013-11-23T02:20:55Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177044",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:49'></a>
For the record, this ticket is positively reviewed. Even if Andrew keeps merging the sage-hg branch until sage-5.13 is finished.



---

archive/issue_events_125880.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2013-11-27T05:20:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125880"
}
```



---

archive/issue_events_125881.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2013-11-27T05:20:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125881"
}
```



---

archive/issue_comments_177045.json:
```json
{
    "body": "<a id='comment:50'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** New commits:",
    "created_at": "2013-11-27T05:20:49Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177045",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** New commits:



---

archive/issue_comments_177046.json:
```json
{
    "body": "**Changing commit** from \"[1b1d23620cb9e912c21afe6ec75aba322d6b2dd5](https://github.com/sagemath/sagetrac-mirror/commit/1b1d23620cb9e912c21afe6ec75aba322d6b2dd5)\" to \"[47cb70ddd7f01952996ba3d404d5d4c12a4dae7e](https://github.com/sagemath/sagetrac-mirror/commit/47cb70ddd7f01952996ba3d404d5d4c12a4dae7e)\".",
    "created_at": "2013-11-27T05:20:49Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1b1d23620cb9e912c21afe6ec75aba322d6b2dd5](https://github.com/sagemath/sagetrac-mirror/commit/1b1d23620cb9e912c21afe6ec75aba322d6b2dd5)" to "[47cb70ddd7f01952996ba3d404d5d4c12a4dae7e](https://github.com/sagemath/sagetrac-mirror/commit/47cb70ddd7f01952996ba3d404d5d4c12a4dae7e)".



---

archive/issue_comments_177047.json:
```json
{
    "body": "<a id='comment:51'></a>\nHi,\n\nThe merge of `5.13-beta4` broke `make build` for me, because http://www.sagemath.org/packages/upstream/r/r-3.0.2.tar is missing. See also ticket:14706#comment:119.",
    "created_at": "2013-11-27T10:17:41Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177047",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:51'></a>
Hi,

The merge of `5.13-beta4` broke `make build` for me, because http://www.sagemath.org/packages/upstream/r/r-3.0.2.tar is missing. See also ticket:14706#comment:119.



---

archive/issue_comments_177048.json:
```json
{
    "body": "**Changing commit** from \"[47cb70ddd7f01952996ba3d404d5d4c12a4dae7e](https://github.com/sagemath/sagetrac-mirror/commit/47cb70ddd7f01952996ba3d404d5d4c12a4dae7e)\" to \"[33dec52b43f2fcc22318129da442e5bdb8a24b28](https://github.com/sagemath/sagetrac-mirror/commit/33dec52b43f2fcc22318129da442e5bdb8a24b28)\".",
    "created_at": "2013-12-06T19:00:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177048",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[47cb70ddd7f01952996ba3d404d5d4c12a4dae7e](https://github.com/sagemath/sagetrac-mirror/commit/47cb70ddd7f01952996ba3d404d5d4c12a4dae7e)" to "[33dec52b43f2fcc22318129da442e5bdb8a24b28](https://github.com/sagemath/sagetrac-mirror/commit/33dec52b43f2fcc22318129da442e5bdb8a24b28)".



---

archive/issue_comments_177049.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-12-06T19:00:03Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177050.json:
```json
{
    "body": "<a id='comment:53'></a>\n**Branch pushed to git repo; I updated commit sha1.** New commits:",
    "created_at": "2013-12-12T05:59:42Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>
**Branch pushed to git repo; I updated commit sha1.** New commits:



---

archive/issue_comments_177051.json:
```json
{
    "body": "**Changing commit** from \"[33dec52b43f2fcc22318129da442e5bdb8a24b28](https://github.com/sagemath/sagetrac-mirror/commit/33dec52b43f2fcc22318129da442e5bdb8a24b28)\" to \"[cd237e726293c48288016aa2a9cc80aa75a3bd20](https://github.com/sagemath/sagetrac-mirror/commit/cd237e726293c48288016aa2a9cc80aa75a3bd20)\".",
    "created_at": "2013-12-12T05:59:42Z",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14480#issuecomment-177051",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[33dec52b43f2fcc22318129da442e5bdb8a24b28](https://github.com/sagemath/sagetrac-mirror/commit/33dec52b43f2fcc22318129da442e5bdb8a24b28)" to "[cd237e726293c48288016aa2a9cc80aa75a3bd20](https://github.com/sagemath/sagetrac-mirror/commit/cd237e726293c48288016aa2a9cc80aa75a3bd20)".



---

archive/issue_events_125882.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T12:20:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125882"
}
```



---

archive/issue_events_125883.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T12:20:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125883"
}
```



---

archive/issue_events_125884.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T12:23:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125884"
}
```



---

archive/issue_events_125885.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T12:23:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14480",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14480#event-125885"
}
```
