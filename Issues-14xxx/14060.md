# Issue 14060: Improve minimal_quadratic_twist()

archive/issues_013856.json:
```json
{
    "body": "We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal quadratic twist, but not necessarily the minimal twist, and it would be a good thing for the documentation to make this clear.\n\nAssignee: @JohnCremona\n\nCC:  @categorie\n\nKeywords: pari precision\n\nReviewer: Chris Wuthrich\n\nAuthor: John Cremona\n\nBranch: u/wuthrich/ticket/14060\n\nCommit: 634ab955474c1d1ed637171a96a85e3d26f3f5e0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14060\n\n",
    "closed_at": "2014-02-01T15:17:01Z",
    "created_at": "2013-02-05T11:56:34Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Improve minimal_quadratic_twist()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14060",
    "user": "https://github.com/JohnCremona"
}
```
We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal quadratic twist, but not necessarily the minimal twist, and it would be a good thing for the documentation to make this clear.

Assignee: @JohnCremona

CC:  @categorie

Keywords: pari precision

Reviewer: Chris Wuthrich

Author: John Cremona

Branch: u/wuthrich/ticket/14060

Commit: 634ab955474c1d1ed637171a96a85e3d26f3f5e0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14060





---

archive/issue_events_039562.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14060#event-39562"
}
```



---

archive/issue_comments_183783.json:
```json
{
    "body": "<a id='comment:2'></a>Precision issue is #13163.",
    "created_at": "2014-01-09T21:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183783",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Precision issue is #13163.



---

archive/issue_comments_183784.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,11 +1,4 @@\n-This fails on a 32-bit machine (Sage-5.6):\n-\n-\\`\\`\\`\n-sage: EllipticCurve([0, -1, 0, -360796668980, 83414685883377400]).minimal_quadratic_twist()\n-\\`\\`\\`\n-because it results in pari_curve() being called on some curves with no attempt to catch insufficient precision.\n-\n-Two things needs fixing:  (1) Making sure that all calls to pari_curve() deal with this precision issue properly;  (2) a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much rwork as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal twist, but not necessarily a quadratic twist, so the documentation (or function name, or something) needs correcting.\n+We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal twist, but not necessarily a quadratic twist, so the documentation (or function name, or something) needs correcting.\n \n Comment: 1\n \n```\n",
    "created_at": "2014-01-09T21:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183784",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,11 +1,4 @@
-This fails on a 32-bit machine (Sage-5.6):
-
-\`\`\`
-sage: EllipticCurve([0, -1, 0, -360796668980, 83414685883377400]).minimal_quadratic_twist()
-\`\`\`
-because it results in pari_curve() being called on some curves with no attempt to catch insufficient precision.
-
-Two things needs fixing:  (1) Making sure that all calls to pari_curve() deal with this precision issue properly;  (2) a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much rwork as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal twist, but not necessarily a quadratic twist, so the documentation (or function name, or something) needs correcting.
+We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal twist, but not necessarily a quadratic twist, so the documentation (or function name, or something) needs correcting.
 
 Comment: 1
 
```




---

archive/issue_comments_183785.json:
```json
{
    "body": "<a id='comment:3'></a>I see two possibilities here:  either rename this function `minimal_twist()` and return (as it does now) a curve which may be a sextic or quartic twist when j=0 or j=1728;   or keep this name and be more restrictive for those j-invariants so that the returned curve literally is a quadratic twist.  A third possibility is to have both named functions, doing the same thing unless j=0 or j=1728.\n\nI am CC-ing Chris W since the only place where this function is used (according to `search_src()`) is in `sha_tate.py`, line 540, and whatever we do must be compatible with what is needed there!\n\nOf course this is in addition to adding one line to return self of `self.conductor().is_squarefree()`.",
    "created_at": "2014-01-11T16:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183785",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>I see two possibilities here:  either rename this function `minimal_twist()` and return (as it does now) a curve which may be a sextic or quartic twist when j=0 or j=1728;   or keep this name and be more restrictive for those j-invariants so that the returned curve literally is a quadratic twist.  A third possibility is to have both named functions, doing the same thing unless j=0 or j=1728.

I am CC-ing Chris W since the only place where this function is used (according to `search_src()`) is in `sha_tate.py`, line 540, and whatever we do must be compatible with what is needed there!

Of course this is in addition to adding one line to return self of `self.conductor().is_squarefree()`.



---

archive/issue_comments_183786.json:
```json
{
    "body": "<a id='comment:4'></a>In sha_tate and in general for p-adic L-functions we can only twist by quadratic characters (well, I can only, maybe someone else knows more). So if changing the function one has to be careful to twist only by quadratic twists for these two cm curves. But if I remember correctly, we currently exclude cm curve (which we would not have to do in fact).",
    "created_at": "2014-01-11T16:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183786",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>In sha_tate and in general for p-adic L-functions we can only twist by quadratic characters (well, I can only, maybe someone else knows more). So if changing the function one has to be careful to twist only by quadratic twists for these two cm curves. But if I remember correctly, we currently exclude cm curve (which we would not have to do in fact).



---

archive/issue_comments_183787.json:
```json
{
    "body": "<a id='comment:5'></a>Looking more carefully at the code (I am not embarrassed that I wrote it but could not remember) I see that for j=0 and j=1728 the curve returned is always a quadratic twist.  So the \"additionally\" part of the ticket's current description is incorrect.\n\nIf you agree with me on that (and a second opinion would be welcome!) then that just leaves the first part which I can easily implement by adding one line.",
    "created_at": "2014-01-11T17:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183787",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>Looking more carefully at the code (I am not embarrassed that I wrote it but could not remember) I see that for j=0 and j=1728 the curve returned is always a quadratic twist.  So the "additionally" part of the ticket's current description is incorrect.

If you agree with me on that (and a second opinion would be welcome!) then that just leaves the first part which I can easily implement by adding one line.



---

archive/issue_comments_183788.json:
```json
{
    "body": "<a id='comment:6'></a>We could have a minimal_twist function, too, if you wish, but I need minimal_quadratic_twist for modular symbols. If you can simplify the current function that is certainly a good thing to do.\n\nI am not sure what changes you want to make, but if you do them, I should be able to look at them and review it quickly.\n\n(from Besancon)",
    "created_at": "2014-01-11T17:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183788",
    "user": "https://github.com/categorie"
}
```

<a id='comment:6'></a>We could have a minimal_twist function, too, if you wish, but I need minimal_quadratic_twist for modular symbols. If you can simplify the current function that is certainly a good thing to do.

I am not sure what changes you want to make, but if you do them, I should be able to look at them and review it quickly.

(from Besancon)



---

archive/issue_comments_183789.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal quadratic twist, but not necessarily the minimal twist, and it would be a good thing for the documentation to make this clear.\n \n Comment: 1\n \n```\n",
    "created_at": "2014-01-11T18:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183789",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+We need a better implementation of minimal_quadratic_twist(), for example if the conductor is square-free then there is no need to do so much work as is currently done.  Additionally, when j(E)=0 or 1728 the curve returned is a minimal quadratic twist, but not necessarily the minimal twist, and it would be a good thing for the documentation to make this clear.
 
 Comment: 1
 
```




---

archive/issue_comments_183790.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-11T18:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183790",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_183791.json:
```json
{
    "body": "<a id='comment:8'></a>I have implemented the small improvement (do nothing if the conductor is square-free) with a new doctest, and also expanded on the documentation in the exceptional cases j=0, 1728 to remove any confusion, with an example!\n\nI decided not to implement a new `minimal_twist()` function since \n\n```\nEllipticCurve(j=E.j_invariant())\n```\ndoes that.  But I could.\n\n---\nLast 10 new commits:",
    "created_at": "2014-01-11T18:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183791",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>I have implemented the small improvement (do nothing if the conductor is square-free) with a new doctest, and also expanded on the documentation in the exceptional cases j=0, 1728 to remove any confusion, with an example!

I decided not to implement a new `minimal_twist()` function since 

```
EllipticCurve(j=E.j_invariant())
```
does that.  But I could.

---
Last 10 new commits:



---

archive/issue_comments_183792.json:
```json
{
    "body": "<a id='comment:9'></a>There are lots of commits listed above, none of which is mine.  The relevant one, which you can see by clicking on the branch name, is dc07e494c5230bef1dd7e1a0df351194a03acb36 .",
    "created_at": "2014-01-11T18:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183792",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>There are lots of commits listed above, none of which is mine.  The relevant one, which you can see by clicking on the branch name, is dc07e494c5230bef1dd7e1a0df351194a03acb36 .



---

archive/issue_comments_183793.json:
```json
{
    "body": "<a id='comment:10'></a>the `note` field is only indented by 3 spaces, there should be 4",
    "created_at": "2014-01-12T20:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183793",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>the `note` field is only indented by 3 spaces, there should be 4



---

archive/issue_comments_183794.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-23T23:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183794",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_183795.json:
```json
{
    "body": "<a id='comment:11'></a>I rebased it to the 6.1.beta6 in the hope that the extra merge commits above do not show anymore (even if they are harmless. \n\nSince all test then pass for me, I give it a positive review.\n\n---\nNew commits:",
    "created_at": "2014-01-23T23:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183795",
    "user": "https://github.com/categorie"
}
```

<a id='comment:11'></a>I rebased it to the 6.1.beta6 in the hope that the extra merge commits above do not show anymore (even if they are harmless. 

Since all test then pass for me, I give it a positive review.

---
New commits:



---

archive/issue_comments_183796.json:
```json
{
    "body": "<a id='comment:12'></a>By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.",
    "created_at": "2014-01-23T23:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183796",
    "user": "https://github.com/categorie"
}
```

<a id='comment:12'></a>By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.



---

archive/issue_comments_183797.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 wuthrich]:\n> By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.\n\n\nI don't know, I thought that not warnings were produced when building the docs but have forgotten.\n\nThanks for the review!",
    "created_at": "2014-01-24T08:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183797",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>Replying to [comment:12 wuthrich]:
> By the way, I believe there are 4 spaces before the ..note. No ? At least the html output seems ok.


I don't know, I thought that not warnings were produced when building the docs but have forgotten.

Thanks for the review!



---

archive/issue_events_039563.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14060#event-39563"
}
```



---

archive/issue_events_039564.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14060#event-39564"
}
```



---

archive/issue_comments_183798.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-01T15:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14060#issuecomment-183798",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_039565.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-01T15:17:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14060",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14060#event-39565"
}
```
