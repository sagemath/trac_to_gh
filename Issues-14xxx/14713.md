# Issue 14713: Update to IPython 1.2.1

archive/issues_014509.json:
```json
{
    "assignees": [],
    "body": "IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n\nUpstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz\n\nDepends on #14810\n\nAssignee: **@jdemeyer**\n\nCC:  @roed314\n\nBranch: **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**\n\nReviewer: **William Stein**\n\nAuthor: **Jason Grout**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14713_\n\n",
    "closed_at": "2014-03-05T09:36:21Z",
    "created_at": "2013-06-10T10:57:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update to IPython 1.2.1",
    "type": "issue",
    "updated_at": "2014-05-17T14:47:12Z",
    "url": "https://github.com/sagemath/sage/issues/14713",
    "user": "https://github.com/jasongrout"
}
```
IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.

Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz

Depends on #14810

Assignee: **@jdemeyer**

CC:  @roed314

Branch: **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**

Reviewer: **William Stein**

Author: **Jason Grout**

_Issue created by migration from https://trac.sagemath.org/ticket/14713_





---

archive/issue_events_184945.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184945"
}
```



---

archive/issue_events_184946.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184946"
}
```



---

archive/issue_events_184947.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184947"
}
```



---

archive/issue_events_184948.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184948"
}
```



---

archive/issue_comments_181784.json:
```json
{
    "body": "Attachment: **[new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/new_transformers.patch.gz)**",
    "created_at": "2013-06-10T10:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181784",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/new_transformers.patch.gz)**



---

archive/issue_comments_181785.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-IPython 1.0 will be released soon (their plan is by mid-July 2013).\n+IPython 1.0.0 has been released.\n \n-I'll post an spkg when it gets released.  In the meantime, the patches below work with the current master (IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09).  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+\n+Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg\n``````\n",
    "created_at": "2013-08-09T14:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181785",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-IPython 1.0 will be released soon (their plan is by mid-July 2013).
+IPython 1.0.0 has been released.
 
-I'll post an spkg when it gets released.  In the meantime, the patches below work with the current master (IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09).  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+
+Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg
``````




---

archive/issue_comments_181786.json:
```json
{
    "body": "Dependencies: **#14810**",
    "created_at": "2013-08-09T14:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181786",
    "user": "https://github.com/vbraun"
}
```

Dependencies: **#14810**



---

archive/issue_comments_181787.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-08-09T15:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181787",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_181788.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nAttachment: **[trac_14713_new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/trac_14713_new_transformers.patch.gz)**\n\nEverything works except a failure in `sage/doctest/forker.py` when running the doctest through the `sage0` interface. The pexpect log contains the traceback\n\n```\nMultipleInstanceError                     Traceback (most recent call last)\n<ipython-input-12-54a61f46e9ab> in <module>()\n----> 1 DTR.run(DT, clear_globs=False)\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in run(self, test, compileflags, out, clear_globs)\n    623         self.no_failure_yet = True\n    624         try:\n--> 625             return self._run(test, compileflags, out)\n    626         finally:\n    627             self._fakeout.stop_spoofing()\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in _run(self, test, compileflags, out)\n    535             elif outcome is FAILURE:\n    536                 if not quiet:\n--> 537                     self.report_failure(out, test, example, got, test.globs)\n    538                 failures += 1\n    539             elif outcome is BOOM:\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in report_failure(self, out, test, example, got, globs)\n   1112                     prompt_config.in_template = 'debug: '\n   1113                     prompt_config.in2_template = '.....: '\n-> 1114                     embed(config=cfg, banner1='', user_ns=dict(globs))\n   1115                 except KeyboardInterrupt:a\n\n   1116                     # Assume this is a *real* interrupt. We need to\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/terminal/embed.pyc in embed(**kwargs)\n    298         config.InteractiveShellEmbed = config.TerminalInteractiveShell\n    299         kwargs['config'] = config\n--> 300     shell = InteractiveShellEmbed.instance(**kwargs)\n    301     shell(header=header, stack_depth=2, compile_flags=compile_flags)\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/config/configurable.pyc in instance(cls, *args, **kwargs)\n    358             raise MultipleInstanceError(\n    359                 'Multiple incompatible subclass instances of '\n--> 360                 '%s are being created.' % cls.__name__\n    361             )\n    362 \n\nMultipleInstanceError: Multiple incompatible subclass instances of InteractiveShellEmbed are being created.\n```",
    "created_at": "2013-08-09T15:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181788",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'>Comment 3:</a>
Attachment: **[trac_14713_new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/trac_14713_new_transformers.patch.gz)**

Everything works except a failure in `sage/doctest/forker.py` when running the doctest through the `sage0` interface. The pexpect log contains the traceback

```
MultipleInstanceError                     Traceback (most recent call last)
<ipython-input-12-54a61f46e9ab> in <module>()
----> 1 DTR.run(DT, clear_globs=False)

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in run(self, test, compileflags, out, clear_globs)
    623         self.no_failure_yet = True
    624         try:
--> 625             return self._run(test, compileflags, out)
    626         finally:
    627             self._fakeout.stop_spoofing()

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in _run(self, test, compileflags, out)
    535             elif outcome is FAILURE:
    536                 if not quiet:
--> 537                     self.report_failure(out, test, example, got, test.globs)
    538                 failures += 1
    539             elif outcome is BOOM:

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in report_failure(self, out, test, example, got, globs)
   1112                     prompt_config.in_template = 'debug: '
   1113                     prompt_config.in2_template = '.....: '
-> 1114                     embed(config=cfg, banner1='', user_ns=dict(globs))
   1115                 except KeyboardInterrupt:a

   1116                     # Assume this is a *real* interrupt. We need to

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/terminal/embed.pyc in embed(**kwargs)
    298         config.InteractiveShellEmbed = config.TerminalInteractiveShell
    299         kwargs['config'] = config
--> 300     shell = InteractiveShellEmbed.instance(**kwargs)
    301     shell(header=header, stack_depth=2, compile_flags=compile_flags)

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/config/configurable.pyc in instance(cls, *args, **kwargs)
    358             raise MultipleInstanceError(
    359                 'Multiple incompatible subclass instances of '
--> 360                 '%s are being created.' % cls.__name__
    361             )
    362 

MultipleInstanceError: Multiple incompatible subclass instances of InteractiveShellEmbed are being created.
```



---

archive/issue_comments_181789.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI've been continuing work on this in my ipython-1.0 branch on github: https://github.com/jasongrout/sage/tree/ipython-1.0\n\nI ran into some changes in IPython system_raw exit code that caused us problems.  I posted about it here: http://mail.scipy.org/pipermail/ipython-dev/2013-August/012102.html  But IPython 1.0 is released without this being resolved, so I think we ought to just update our doctests that are failing because of it.\n\nI am also doing some experimental work on \"string decorators\" on that branch, inspired by what William did in sage cloud.  However, it's still at a preview stage.  I can turn it off by default, though, and we can continue to work on it.",
    "created_at": "2013-08-09T17:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181789",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'>Comment 4:</a>
I've been continuing work on this in my ipython-1.0 branch on github: https://github.com/jasongrout/sage/tree/ipython-1.0

I ran into some changes in IPython system_raw exit code that caused us problems.  I posted about it here: http://mail.scipy.org/pipermail/ipython-dev/2013-August/012102.html  But IPython 1.0 is released without this being resolved, so I think we ought to just update our doctests that are failing because of it.

I am also doing some experimental work on "string decorators" on that branch, inspired by what William did in sage cloud.  However, it's still at a preview stage.  I can turn it off by default, though, and we can continue to work on it.



---

archive/issue_comments_181790.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThe exit code thing has already been resolved in #14810",
    "created_at": "2013-08-09T18:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181790",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'>Comment 5:</a>
The exit code thing has already been resolved in #14810



---

archive/issue_events_184949.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184949"
}
```



---

archive/issue_events_184950.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184950"
}
```



---

archive/issue_comments_181791.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\n+1 to this.  I'm using ipython 1.0 with the patches from the git repo for cloud.sagemath very soon.\nHere's how:\n\n```\ncd devel/sage/\nwget https://github.com/jasongrout/sage/commit/fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch\nwget https://github.com/jasongrout/sage/commit/c1ad5805558b15694d783bbb5c77296f2d492b2e.patch\npatch --ignore-whitespace -p2 < fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch\npatch --ignore-whitespace -p2 < c1ad5805558b15694d783bbb5c77296f2d492b2e.patch\ncd ../..\n./sage -b\nrm -rf local/lib/python/site-packages/IPython* local/lib/python/site-package/ipython*\n./sage -sh\neasy_install ipython\n```\n\nThey work.\n\n\nFor convenience, here is a single hg patch:\n\n   http://wstein.org/home/wstein/tmp/trac-14713.patch",
    "created_at": "2013-09-01T16:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181791",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:7'>Comment 7:</a>
+1 to this.  I'm using ipython 1.0 with the patches from the git repo for cloud.sagemath very soon.
Here's how:

```
cd devel/sage/
wget https://github.com/jasongrout/sage/commit/fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch
wget https://github.com/jasongrout/sage/commit/c1ad5805558b15694d783bbb5c77296f2d492b2e.patch
patch --ignore-whitespace -p2 < fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch
patch --ignore-whitespace -p2 < c1ad5805558b15694d783bbb5c77296f2d492b2e.patch
cd ../..
./sage -b
rm -rf local/lib/python/site-packages/IPython* local/lib/python/site-package/ipython*
./sage -sh
easy_install ipython
```

They work.


For convenience, here is a single hg patch:

   http://wstein.org/home/wstein/tmp/trac-14713.patch



---

archive/issue_events_184951.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184951"
}
```



---

archive/issue_events_184952.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184952"
}
```



---

archive/issue_comments_181792.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nJust for the record: some of my students often get hit by some bracktraces not being printed out properly when using %attach. This looks like https://github.com/ipython/ipython/issues/2512.\n\nNothing critical, but they will appreciate the upgrade :-)\n\nThanks!",
    "created_at": "2014-02-05T10:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181792",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'>Comment 9:</a>
Just for the record: some of my students often get hit by some bracktraces not being printed out properly when using %attach. This looks like https://github.com/ipython/ipython/issues/2512.

Nothing critical, but they will appreciate the upgrade :-)

Thanks!



---

archive/issue_comments_181793.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\n2.0 will probably be released within the month or so.  I'm tracking the changes on IPython master so it will be an easy upgrade.",
    "created_at": "2014-02-05T14:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181793",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:10'>Comment 10:</a>
2.0 will probably be released within the month or so.  I'm tracking the changes on IPython master so it will be an easy upgrade.



---

archive/issue_comments_181794.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nNice. Thanks for the update!",
    "created_at": "2014-02-05T14:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181794",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'>Comment 11:</a>
Nice. Thanks for the update!



---

archive/issue_comments_181795.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nSure, no problem.  I'm tracking the changes because I'm running (close to) IPython master for the Sage cell server.  My current patches are here: https://github.com/jasongrout/sage/commits/sagecell (up through change d662bf2655dcdc04100a8f29ccb88b790377b46a or so)",
    "created_at": "2014-02-05T18:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181795",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:12'>Comment 12:</a>
Sure, no problem.  I'm tracking the changes because I'm running (close to) IPython master for the Sage cell server.  My current patches are here: https://github.com/jasongrout/sage/commits/sagecell (up through change d662bf2655dcdc04100a8f29ccb88b790377b46a or so)



---

archive/issue_comments_181796.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-IPython 1.0.0 has been released.\n+IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n-\n-Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg\n+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)\n``````\n",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181796",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-IPython 1.0.0 has been released.
+IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
-
-Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)
``````




---

archive/issue_events_184953.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-02-15T00:27:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "title_is": "Update to IPython 1.2.0",
    "title_was": "Update to IPython 1.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184953"
}
```



---

archive/issue_comments_181797.json:
```json
{
    "body": "Commit: **[7293ef2](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)**",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181797",
    "user": "https://github.com/ohanar"
}
```

Commit: **[7293ef2](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)**



---

archive/issue_comments_181798.json:
```json
{
    "body": "Branch: **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)**",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181798",
    "user": "https://github.com/ohanar"
}
```

Branch: **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)**



---

archive/issue_comments_181799.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181799",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:13'>Comment 13:</a>
I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.



---

archive/issue_comments_181800.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8\">a86c939</a></td><td><code>really fix instance creation of InteractiveShellEmbed</code></td></tr></table>\n",
    "created_at": "2014-02-15T00:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181800",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8">a86c939</a></td><td><code>really fix instance creation of InteractiveShellEmbed</code></td></tr></table>




---

archive/issue_comments_181801.json:
```json
{
    "body": "Changed commit from **[7293ef2](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)** to **[a86c939](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)**",
    "created_at": "2014-02-15T00:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181801",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7293ef2](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)** to **[a86c939](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)**



---

archive/issue_comments_181802.json:
```json
{
    "body": "Changed commit from **[a86c939](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)** to **[2ffb13c](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)**",
    "created_at": "2014-02-17T00:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181802",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a86c939](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)** to **[2ffb13c](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)**



---

archive/issue_comments_181803.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24ea89290988305d93f85988022cde7284268aeb\">24ea892</a></td><td><code>dynamically set IPYTHONDIR based on the current version of ipython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c\">2ffb13c</a></td><td><code>backport IPython pull request #4504</code></td></tr></table>\n",
    "created_at": "2014-02-17T00:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181803",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24ea89290988305d93f85988022cde7284268aeb">24ea892</a></td><td><code>dynamically set IPYTHONDIR based on the current version of ipython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c">2ffb13c</a></td><td><code>backport IPython pull request #4504</code></td></tr></table>




---

archive/issue_comments_181804.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThere is a single doctest that fails (in `src/sage/misc/interpreter.py`), but it doesn't match the behavior of running the test from the sage command line.\n\nAlso, we need some doctests for `sage.misc.interpreter.SagePreparseTransformer.reset`. Since I don't know the preparser code (and the `reset` keyword is documented as \"a boolean\"), it would be great if someone knowledgeable about this could fill in something here.\n\n@jasongrout\nI deleted the note about the prun_magics.patch since you deleted it in https://github.com/jasongrout/sage/commit/d662bf2655dcdc04100a8f29ccb88b790377b46a. Do we still need this?",
    "created_at": "2014-02-17T00:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181804",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:16'>Comment 16:</a>
There is a single doctest that fails (in `src/sage/misc/interpreter.py`), but it doesn't match the behavior of running the test from the sage command line.

Also, we need some doctests for `sage.misc.interpreter.SagePreparseTransformer.reset`. Since I don't know the preparser code (and the `reset` keyword is documented as "a boolean"), it would be great if someone knowledgeable about this could fill in something here.

@jasongrout
I deleted the note about the prun_magics.patch since you deleted it in https://github.com/jasongrout/sage/commit/d662bf2655dcdc04100a8f29ccb88b790377b46a. Do we still need this?



---

archive/issue_comments_181805.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@ohanar](#comment%3A13):\n> I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.\n\nI strongly agree with not waiting for IPython 2.0.  They also make some controversial modal changes to the IPython notebook, and I want to see how those shake out in wider testing before switching (i.e., it might be best to wait for 2.1).",
    "created_at": "2014-03-01T18:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181805",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@ohanar](#comment%3A13):
> I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.

I strongly agree with not waiting for IPython 2.0.  They also make some controversial modal changes to the IPython notebook, and I want to see how those shake out in wider testing before switching (i.e., it might be best to wait for 2.1).



---

archive/issue_comments_181806.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nHow is this supposed to actually work?\n\n```\nAttempting to download package ipython-1.2.0\n>>> Trying to download http://www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz\n[Traceback (most recent call last):\n  File \"<stdin>\", line 35, in <module>\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 240, in retrieve\n    fp = self.open(url, data)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 208, in open\n    return getattr(self, name)(url)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 359, in open_http\n    return self.http_error(url, fp, errcode, errmsg, headers)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 376, in http_error\n    return self.http_error_default(url, fp, errcode, errmsg, headers)\n  File \"<stdin>\", line 17, in http_error_default\nIOError: [Errno 404] Not Found: '//www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz'\nError: failed to download package ipython-1.2.0\nmake[2]: *** [/usr/local/sage/sage-6.2/local/var/lib/sage/installed/ipython-1.2.0] Error 1\nmake[2]: Leaving directory `/usr/local/sage/sage-6.2/build'\nmake[1]: *** [all] Error 2\nmake[1]: Leaving directory `/usr/local/sage/sage-6.2/build'\n \nreal    24m14.305s\n```\n\nObviously, I can get around this.  However, I'm concerned about this entire approach to development...",
    "created_at": "2014-03-01T20:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181806",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:18'>Comment 18:</a>
How is this supposed to actually work?

```
Attempting to download package ipython-1.2.0
>>> Trying to download http://www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz
[Traceback (most recent call last):
  File "<stdin>", line 35, in <module>
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 240, in retrieve
    fp = self.open(url, data)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 208, in open
    return getattr(self, name)(url)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 359, in open_http
    return self.http_error(url, fp, errcode, errmsg, headers)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 376, in http_error
    return self.http_error_default(url, fp, errcode, errmsg, headers)
  File "<stdin>", line 17, in http_error_default
IOError: [Errno 404] Not Found: '//www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz'
Error: failed to download package ipython-1.2.0
make[2]: *** [/usr/local/sage/sage-6.2/local/var/lib/sage/installed/ipython-1.2.0] Error 1
make[2]: Leaving directory `/usr/local/sage/sage-6.2/build'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/usr/local/sage/sage-6.2/build'
 
real    24m14.305s
```

Obviously, I can get around this.  However, I'm concerned about this entire approach to development...



---

archive/issue_comments_181807.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nYou need to put the tarball manually in the `upstream` directory until the ticket is reviewed.",
    "created_at": "2014-03-01T20:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181807",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'>Comment 19:</a>
You need to put the tarball manually in the `upstream` directory until the ticket is reviewed.



---

archive/issue_comments_181808.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@vbraun](#comment%3A19):\n> You need to put the tarball manually in the `upstream` directory until the ticket is reviewed. \n\nThat's what I did.   It would be nice if the code that tries to grab the upstream from sagemath.org could also try other locations specified in the package, e.g., in this case https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz...\n\nI hope our longterm plan is that the process is:\n\n```\n   git <checkout a branch somehow>\n   make\n```\nand it works, rather than\n\n```\n   git <checkout a branch somehow>\n   make\n   # see download failure -- track down packages -- put in upstream directory\n   make\n   # see more download failures -- track down packages -- put in upstream directory, etc.\n```\n\n?",
    "created_at": "2014-03-01T20:34:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181808",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@vbraun](#comment%3A19):
> You need to put the tarball manually in the `upstream` directory until the ticket is reviewed. 

That's what I did.   It would be nice if the code that tries to grab the upstream from sagemath.org could also try other locations specified in the package, e.g., in this case https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz...

I hope our longterm plan is that the process is:

```
   git <checkout a branch somehow>
   make
```
and it works, rather than

```
   git <checkout a branch somehow>
   make
   # see download failure -- track down packages -- put in upstream directory
   make
   # see more download failures -- track down packages -- put in upstream directory, etc.
```

?



---

archive/issue_comments_181809.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nThe pypi url is not in the git branch. There are also some projects where you need to click through some html to get a temporary download link *cough* *sourceforge* *cough*. Really we need a common place where people can upload the tarballs.",
    "created_at": "2014-03-01T20:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181809",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'>Comment 21:</a>
The pypi url is not in the git branch. There are also some projects where you need to click through some html to get a temporary download link *cough* *sourceforge* *cough*. Really we need a common place where people can upload the tarballs.



---

archive/issue_comments_181810.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n+1 to moving to 1.2 now.  I'm not running any extra patches beyond my 1.0 patches to get IPython master working.  So if you merge this, I can stop maintaining the patches, even though I'm running master :).\n\nAnd +1 to william's suggestion of having alternate URLs, since we are verifying the checksum anyway.",
    "created_at": "2014-03-01T21:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181810",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:22'>Comment 22:</a>
+1 to moving to 1.2 now.  I'm not running any extra patches beyond my 1.0 patches to get IPython master working.  So if you merge this, I can stop maintaining the patches, even though I'm running master :).

And +1 to william's suggestion of having alternate URLs, since we are verifying the checksum anyway.



---

archive/issue_comments_181811.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nNote that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2",
    "created_at": "2014-03-01T21:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181811",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:23'>Comment 23:</a>
Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2



---

archive/issue_comments_181812.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n*IMPORTANT*  This patch introduces this code in the middle of ```src/bin/sage-env``` *before* the path, etc., is properly set up:\n\n```\nif [ -x \"$SAGE_LOCAL/bin/ipython\" ]; then\n    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`ipython --version`\nelse\n    # IPython is not yet installed\n    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`sed 's+\\.p[0-9]*$++' \"$SAGE_ROOT\"/build/pkgs/ipython/package-version.txt`\nfi\n```\n\nThe result is that in a system with multiple version of Ipython (e.g., using python2.7.3 also) you'll get a big nasty ```ImportError: cannot import name MAXREPEAT``` error/traceback whenever you try to start sage (or use ```sage -sh```).    Moving the above IPYTHONDIR stuff to the bottom of the sage-env fixes the problem. \n\nThat said, it's kind of disturbing to be starting up ipython when doing \"sage -sh\", since that's actually a lot of overhead.",
    "created_at": "2014-03-02T00:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181812",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:24'>Comment 24:</a>
*IMPORTANT*  This patch introduces this code in the middle of ```src/bin/sage-env``` *before* the path, etc., is properly set up:

```
if [ -x "$SAGE_LOCAL/bin/ipython" ]; then
    export IPYTHONDIR="$DOT_SAGE/ipython-"`ipython --version`
else
    # IPython is not yet installed
    export IPYTHONDIR="$DOT_SAGE/ipython-"`sed 's+\.p[0-9]*$++' "$SAGE_ROOT"/build/pkgs/ipython/package-version.txt`
fi
```

The result is that in a system with multiple version of Ipython (e.g., using python2.7.3 also) you'll get a big nasty ```ImportError: cannot import name MAXREPEAT``` error/traceback whenever you try to start sage (or use ```sage -sh```).    Moving the above IPYTHONDIR stuff to the bottom of the sage-env fixes the problem. 

That said, it's kind of disturbing to be starting up ipython when doing "sage -sh", since that's actually a lot of overhead.



---

archive/issue_comments_181813.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@jasongrout](#comment%3A23):\n> Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2\n\nThe upstream tarball is: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz",
    "created_at": "2014-03-02T00:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181813",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@jasongrout](#comment%3A23):
> Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2

The upstream tarball is: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz



---

archive/issue_comments_181814.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nI know patches are stupid, but in case anybody cares, here's the patch to move the ipython version environ stuff and update the version of the tarball: http://wstein.org/tmp/ipython-1.2.1.patch",
    "created_at": "2014-03-02T00:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181814",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:26'>Comment 26:</a>
I know patches are stupid, but in case anybody cares, here's the patch to move the ipython version environ stuff and update the version of the tarball: http://wstein.org/tmp/ipython-1.2.1.patch



---

archive/issue_comments_181815.json:
```json
{
    "body": "Changed commit from **[2ffb13c](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)** to **[88a253c](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)**",
    "created_at": "2014-03-04T01:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181815",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2ffb13c](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)** to **[88a253c](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)**



---

archive/issue_comments_181816.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a0b07fb237b7d4a1575db7bf677858fbb36e774\">3a0b07f</a></td><td><code>ipython: upgrade to version 1.2.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/061e7d612befde4f1e17eef0224c0d26e81f4062\">061e7d6</a></td><td><code>interpreter: preparser really is a stateless transformer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e\">88a253c</a></td><td><code>interpreter: fix doctest issue</code></td></tr></table>\n",
    "created_at": "2014-03-04T01:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181816",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a0b07fb237b7d4a1575db7bf677858fbb36e774">3a0b07f</a></td><td><code>ipython: upgrade to version 1.2.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/061e7d612befde4f1e17eef0224c0d26e81f4062">061e7d6</a></td><td><code>interpreter: preparser really is a stateless transformer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e">88a253c</a></td><td><code>interpreter: fix doctest issue</code></td></tr></table>




---

archive/issue_comments_181817.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f\">0fb988d</a></td><td><code>sage-env: don't call ipython when creating the env</code></td></tr></table>\n",
    "created_at": "2014-03-04T02:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181817",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>Comment 28:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f">0fb988d</a></td><td><code>sage-env: don't call ipython when creating the env</code></td></tr></table>




---

archive/issue_comments_181818.json:
```json
{
    "body": "Changed commit from **[88a253c](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)** to **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**",
    "created_at": "2014-03-04T02:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181818",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[88a253c](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)** to **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**



---

archive/issue_events_184954.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-03-04T02:05:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "title_is": "Update to IPython 1.2.1",
    "title_was": "Update to IPython 1.2.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184954"
}
```



---

archive/issue_events_184955.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-03-04T02:05:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184955"
}
```



---

archive/issue_comments_181819.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)\n+Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]\n``````\n",
    "created_at": "2014-03-04T02:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181819",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]
``````




---

archive/issue_comments_181820.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]\n+Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]\n``````\n",
    "created_at": "2014-03-04T02:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181820",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]
``````




---

archive/issue_comments_181821.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]\n+Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz\n``````\n",
    "created_at": "2014-03-04T02:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181821",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]
+Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz
``````




---

archive/issue_comments_181822.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nYou changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?",
    "created_at": "2014-03-04T04:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181822",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:32'>Comment 32:</a>
You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?



---

archive/issue_comments_181823.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@jasongrout](#comment%3A32):\n> You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?\n\nYes, although that seems like a hack that was only needed in old versions of ipython. Now ipython doesn't push an open ended quote state to the transformers, so the preparser doesn't actually need to keep track of this anymore.\n\nI think there is a lot that can be done to clean up the preparser in general, but I think that is better fit for another ticket.",
    "created_at": "2014-03-04T04:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181823",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@jasongrout](#comment%3A32):
> You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?

Yes, although that seems like a hack that was only needed in old versions of ipython. Now ipython doesn't push an open ended quote state to the transformers, so the preparser doesn't actually need to keep track of this anymore.

I think there is a lot that can be done to clean up the preparser in general, but I think that is better fit for another ticket.



---

archive/issue_comments_181824.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nI've read all of this code pretty carefully, used it for months (in various incarnations by Jason and Andrew), and think upgrading to IPython 1.2.1 should be a very high priority for Sage.   I'm running a clean build and round of doctests, and if they succeed, then this should get a positive review!",
    "created_at": "2014-03-04T04:51:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181824",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:34'>Comment 34:</a>
I've read all of this code pretty carefully, used it for months (in various incarnations by Jason and Andrew), and think upgrading to IPython 1.2.1 should be a very high priority for Sage.   I'm running a clean build and round of doctests, and if they succeed, then this should get a positive review!



---

archive/issue_comments_181825.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nI'll do some checking too.  My worry is not that the preparser could be cleaned up (it certainly could, but that's another issue), but that changing from a coroutine transformer to a stateless transformer is introducing bugs.  I'm not sure why that change was made.  Could you perhaps explain why it's not a coroutine transformer still?",
    "created_at": "2014-03-04T16:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181825",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:35'>Comment 35:</a>
I'll do some checking too.  My worry is not that the preparser could be cleaned up (it certainly could, but that's another issue), but that changing from a coroutine transformer to a stateless transformer is introducing bugs.  I'm not sure why that change was made.  Could you perhaps explain why it's not a coroutine transformer still?



---

archive/issue_comments_181826.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\noh, I see you did have an explanation.  I'll look into it to make sure.",
    "created_at": "2014-03-04T16:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181826",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:36'>Comment 36:</a>
oh, I see you did have an explanation.  I'll look into it to make sure.



---

archive/issue_events_184956.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-03-04T16:51:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184956"
}
```



---

archive/issue_events_184957.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-03-04T16:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184957"
}
```



---

archive/issue_comments_181827.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nBuilds fine and all tests pass. The issues I pointed out above have also been addressed.",
    "created_at": "2014-03-04T16:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181827",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:37'>Comment 37:</a>
Builds fine and all tests pass. The issues I pointed out above have also been addressed.



---

archive/issue_comments_181828.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nand I'm still building...",
    "created_at": "2014-03-04T16:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181828",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:38'>Comment 38:</a>
and I'm still building...



---

archive/issue_comments_181829.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nGiving a partial string as a command messes up the parser because the state is not reset, like `\"asdf`.  I'm figuring out how to exploit it.",
    "created_at": "2014-03-04T17:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181829",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:39'>Comment 39:</a>
Giving a partial string as a command messes up the parser because the state is not reset, like `"asdf`.  I'm figuring out how to exploit it.



---

archive/issue_comments_181830.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nAll right +1.  IPython *does* push open-ended quotes into the preparser if the line is a syntax error (like `\"a`).  However, the preparser is now always called with `reset=True` (the default), so the state doesn't carry over to the next line.\n\nHere is a more complete explanation for it being okay to have a stateless transformation---it relies on two facts that are true right now:\n* we've switched the preparser to be an IPython python_line_transform (which assembles multiline strings into single lines)\n* the preparser has a default of reset=True, which means every time it is called, the state is discarded\n\nIf either of those changes, trouble would probably show up.\n\nOther than that detail, this looks pretty much like the code I've been running on the sage cell server for nearly 6 months, so +1.",
    "created_at": "2014-03-04T18:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181830",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:40'>Comment 40:</a>
All right +1.  IPython *does* push open-ended quotes into the preparser if the line is a syntax error (like `"a`).  However, the preparser is now always called with `reset=True` (the default), so the state doesn't carry over to the next line.

Here is a more complete explanation for it being okay to have a stateless transformation---it relies on two facts that are true right now:
* we've switched the preparser to be an IPython python_line_transform (which assembles multiline strings into single lines)
* the preparser has a default of reset=True, which means every time it is called, the state is discarded

If either of those changes, trouble would probably show up.

Other than that detail, this looks pretty much like the code I've been running on the sage cell server for nearly 6 months, so +1.



---

archive/issue_comments_181831.json:
```json
{
    "body": "Reviewer: **William Stein**",
    "created_at": "2014-03-04T19:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181831",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **William Stein**



---

archive/issue_comments_181832.json:
```json
{
    "body": "Changed branch from **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)** to **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**",
    "created_at": "2014-03-05T09:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181832",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)** to **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**



---

archive/issue_events_184958.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-05T09:36:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184958"
}
```



---

archive/issue_events_184959.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b3f91aa2338e8405344196c0d656884bcd1e67b2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-03-05T09:36:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-184959"
}
```



---

archive/issue_comments_181833.json:
```json
{
    "body": "Changed commit from **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)** to none",
    "created_at": "2014-03-18T10:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181833",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[0fb988d](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)** to none



---

archive/issue_comments_181834.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nBlocker follow-up at #15972",
    "created_at": "2014-03-18T10:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181834",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'>Comment 43:</a>
Blocker follow-up at #15972



---

archive/issue_comments_181835.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nRandom test failures due to history corruption at #16372",
    "created_at": "2014-05-17T14:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-181835",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'>Comment 44:</a>
Random test failures due to history corruption at #16372
