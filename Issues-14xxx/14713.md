# Issue 14713: Update to IPython 1.2.1

archive/issues_014509.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n\nUpstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz\n\nDepends on #14810\n\nCC:  @roed314\n\nBranch: **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**\n\nReviewer: **William Stein**\n\nAuthor: **Jason Grout**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14713_\n\n",
    "closed_at": "2014-03-05T09:36:21Z",
    "created_at": "2013-06-10T10:57:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update to IPython 1.2.1",
    "type": "issue",
    "updated_at": "2014-05-17T14:47:12Z",
    "url": "https://github.com/sagemath/sage/issues/14713",
    "user": "https://github.com/jasongrout"
}
```
IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.

Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz

Depends on #14810

CC:  @roed314

Branch: **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**

Reviewer: **William Stein**

Author: **Jason Grout**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/14713_





---

archive/issue_events_208896.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208896"
}
```



---

archive/issue_events_208897.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208897"
}
```



---

archive/issue_events_208898.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208898"
}
```



---

archive/issue_events_208899.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208899"
}
```



---

archive/issue_events_208900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-10T10:57:14Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208900"
}
```



---

archive/issue_comments_179374.json:
```json
{
    "body": "Attachment: **[new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/new_transformers.patch.gz)**",
    "created_at": "2013-06-10T10:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179374",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/new_transformers.patch.gz)**



---

archive/issue_comments_179375.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n-IPython 1.0 will be released soon (their plan is by mid-July 2013).\n+IPython 1.0.0 has been released.\n \n-I'll post an spkg when it gets released.  In the meantime, the patches below work with the current master (IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09).  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+\n+Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg\n``````\n",
    "created_at": "2013-08-09T14:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179375",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
-IPython 1.0 will be released soon (their plan is by mid-July 2013).
+IPython 1.0.0 has been released.
 
-I'll post an spkg when it gets released.  In the meantime, the patches below work with the current master (IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09).  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+
+Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg
``````




---

archive/issue_comments_179376.json:
```json
{
    "body": "Dependencies: **#14810**",
    "created_at": "2013-08-09T14:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179376",
    "user": "https://github.com/vbraun"
}
```

Dependencies: **#14810**



---

archive/issue_comments_179377.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-08-09T15:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179377",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_179378.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_14713_new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/trac_14713_new_transformers.patch.gz)**\n\nEverything works except a failure in `sage/doctest/forker.py` when running the doctest through the `sage0` interface. The pexpect log contains the traceback\n\n```\nMultipleInstanceError                     Traceback (most recent call last)\n<ipython-input-12-54a61f46e9ab> in <module>()\n----> 1 DTR.run(DT, clear_globs=False)\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in run(self, test, compileflags, out, clear_globs)\n    623         self.no_failure_yet = True\n    624         try:\n--> 625             return self._run(test, compileflags, out)\n    626         finally:\n    627             self._fakeout.stop_spoofing()\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in _run(self, test, compileflags, out)\n    535             elif outcome is FAILURE:\n    536                 if not quiet:\n--> 537                     self.report_failure(out, test, example, got, test.globs)\n    538                 failures += 1\n    539             elif outcome is BOOM:\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in report_failure(self, out, test, example, got, globs)\n   1112                     prompt_config.in_template = 'debug: '\n   1113                     prompt_config.in2_template = '.....: '\n-> 1114                     embed(config=cfg, banner1='', user_ns=dict(globs))\n   1115                 except KeyboardInterrupt:a\n\n   1116                     # Assume this is a *real* interrupt. We need to\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/terminal/embed.pyc in embed(**kwargs)\n    298         config.InteractiveShellEmbed = config.TerminalInteractiveShell\n    299         kwargs['config'] = config\n--> 300     shell = InteractiveShellEmbed.instance(**kwargs)\n    301     shell(header=header, stack_depth=2, compile_flags=compile_flags)\n\n/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/config/configurable.pyc in instance(cls, *args, **kwargs)\n    358             raise MultipleInstanceError(\n    359                 'Multiple incompatible subclass instances of '\n--> 360                 '%s are being created.' % cls.__name__\n    361             )\n    362 \n\nMultipleInstanceError: Multiple incompatible subclass instances of InteractiveShellEmbed are being created.\n```",
    "created_at": "2013-08-09T15:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179378",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_14713_new_transformers.patch.gz](https://github.com/sagemath/sage/files/ticket14713/trac_14713_new_transformers.patch.gz)**

Everything works except a failure in `sage/doctest/forker.py` when running the doctest through the `sage0` interface. The pexpect log contains the traceback

```
MultipleInstanceError                     Traceback (most recent call last)
<ipython-input-12-54a61f46e9ab> in <module>()
----> 1 DTR.run(DT, clear_globs=False)

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in run(self, test, compileflags, out, clear_globs)
    623         self.no_failure_yet = True
    624         try:
--> 625             return self._run(test, compileflags, out)
    626         finally:
    627             self._fakeout.stop_spoofing()

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in _run(self, test, compileflags, out)
    535             elif outcome is FAILURE:
    536                 if not quiet:
--> 537                     self.report_failure(out, test, example, got, test.globs)
    538                 failures += 1
    539             elif outcome is BOOM:

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/sage/doctest/forker.pyc in report_failure(self, out, test, example, got, globs)
   1112                     prompt_config.in_template = 'debug: '
   1113                     prompt_config.in2_template = '.....: '
-> 1114                     embed(config=cfg, banner1='', user_ns=dict(globs))
   1115                 except KeyboardInterrupt:a

   1116                     # Assume this is a *real* interrupt. We need to

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/terminal/embed.pyc in embed(**kwargs)
    298         config.InteractiveShellEmbed = config.TerminalInteractiveShell
    299         kwargs['config'] = config
--> 300     shell = InteractiveShellEmbed.instance(**kwargs)
    301     shell(header=header, stack_depth=2, compile_flags=compile_flags)

/home/vbraun/opt/sage-5.11.rc0/local/lib/python2.7/site-packages/IPython/config/configurable.pyc in instance(cls, *args, **kwargs)
    358             raise MultipleInstanceError(
    359                 'Multiple incompatible subclass instances of '
--> 360                 '%s are being created.' % cls.__name__
    361             )
    362 

MultipleInstanceError: Multiple incompatible subclass instances of InteractiveShellEmbed are being created.
```



---

archive/issue_comments_179379.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI've been continuing work on this in my ipython-1.0 branch on github: https://github.com/jasongrout/sage/tree/ipython-1.0\n\nI ran into some changes in IPython system_raw exit code that caused us problems.  I posted about it here: http://mail.scipy.org/pipermail/ipython-dev/2013-August/012102.html  But IPython 1.0 is released without this being resolved, so I think we ought to just update our doctests that are failing because of it.\n\nI am also doing some experimental work on \"string decorators\" on that branch, inspired by what William did in sage cloud.  However, it's still at a preview stage.  I can turn it off by default, though, and we can continue to work on it.",
    "created_at": "2013-08-09T17:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179379",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

I've been continuing work on this in my ipython-1.0 branch on github: https://github.com/jasongrout/sage/tree/ipython-1.0

I ran into some changes in IPython system_raw exit code that caused us problems.  I posted about it here: http://mail.scipy.org/pipermail/ipython-dev/2013-August/012102.html  But IPython 1.0 is released without this being resolved, so I think we ought to just update our doctests that are failing because of it.

I am also doing some experimental work on "string decorators" on that branch, inspired by what William did in sage cloud.  However, it's still at a preview stage.  I can turn it off by default, though, and we can continue to work on it.



---

archive/issue_comments_179380.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe exit code thing has already been resolved in #14810",
    "created_at": "2013-08-09T18:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179380",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

The exit code thing has already been resolved in #14810



---

archive/issue_events_208901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208901"
}
```



---

archive/issue_events_208902.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208902"
}
```



---

archive/issue_comments_179381.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n+1 to this.  I'm using ipython 1.0 with the patches from the git repo for cloud.sagemath very soon.\nHere's how:\n\n```\ncd devel/sage/\nwget https://github.com/jasongrout/sage/commit/fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch\nwget https://github.com/jasongrout/sage/commit/c1ad5805558b15694d783bbb5c77296f2d492b2e.patch\npatch --ignore-whitespace -p2 < fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch\npatch --ignore-whitespace -p2 < c1ad5805558b15694d783bbb5c77296f2d492b2e.patch\ncd ../..\n./sage -b\nrm -rf local/lib/python/site-packages/IPython* local/lib/python/site-package/ipython*\n./sage -sh\neasy_install ipython\n```\n\nThey work.\n\n\nFor convenience, here is a single hg patch:\n\n   http://wstein.org/home/wstein/tmp/trac-14713.patch",
    "created_at": "2013-09-01T16:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179381",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:7" align="right">comment:7</div>

+1 to this.  I'm using ipython 1.0 with the patches from the git repo for cloud.sagemath very soon.
Here's how:

```
cd devel/sage/
wget https://github.com/jasongrout/sage/commit/fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch
wget https://github.com/jasongrout/sage/commit/c1ad5805558b15694d783bbb5c77296f2d492b2e.patch
patch --ignore-whitespace -p2 < fdbe79ef7ed0ca0fa6c712c4c580ba34de1a1166.patch
patch --ignore-whitespace -p2 < c1ad5805558b15694d783bbb5c77296f2d492b2e.patch
cd ../..
./sage -b
rm -rf local/lib/python/site-packages/IPython* local/lib/python/site-package/ipython*
./sage -sh
easy_install ipython
```

They work.


For convenience, here is a single hg patch:

   http://wstein.org/home/wstein/tmp/trac-14713.patch



---

archive/issue_events_208903.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208903"
}
```



---

archive/issue_events_208904.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208904"
}
```



---

archive/issue_comments_179382.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nJust for the record: some of my students often get hit by some bracktraces not being printed out properly when using %attach. This looks like https://github.com/ipython/ipython/issues/2512.\n\nNothing critical, but they will appreciate the upgrade :-)\n\nThanks!",
    "created_at": "2014-02-05T10:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179382",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

Just for the record: some of my students often get hit by some bracktraces not being printed out properly when using %attach. This looks like https://github.com/ipython/ipython/issues/2512.

Nothing critical, but they will appreciate the upgrade :-)

Thanks!



---

archive/issue_comments_179383.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n2.0 will probably be released within the month or so.  I'm tracking the changes on IPython master so it will be an easy upgrade.",
    "created_at": "2014-02-05T14:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179383",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">comment:10</div>

2.0 will probably be released within the month or so.  I'm tracking the changes on IPython master so it will be an easy upgrade.



---

archive/issue_comments_179384.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNice. Thanks for the update!",
    "created_at": "2014-02-05T14:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179384",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:11" align="right">comment:11</div>

Nice. Thanks for the update!



---

archive/issue_comments_179385.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSure, no problem.  I'm tracking the changes because I'm running (close to) IPython master for the Sage cell server.  My current patches are here: https://github.com/jasongrout/sage/commits/sagecell (up through change d662bf2655dcdc04100a8f29ccb88b790377b46a or so)",
    "created_at": "2014-02-05T18:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179385",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

Sure, no problem.  I'm tracking the changes because I'm running (close to) IPython master for the Sage cell server.  My current patches are here: https://github.com/jasongrout/sage/commits/sagecell (up through change d662bf2655dcdc04100a8f29ccb88b790377b46a or so)



---

archive/issue_comments_179386.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-IPython 1.0.0 has been released.\n+IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n-\n-Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg\n+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)\n``````\n",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179386",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-IPython 1.0.0 has been released.
+IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-The patches below work with IPython commit 3db168c4bfb0391c9a58fa069796550ae2a9fc09.  Changes in IPython resulted in massive cleanup of the custom Sage transformations.
-
-Updated spkg: http://boxen.math.washington.edu/home/vbraun/spkg/ipython-1.0.0.spkg
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)
``````




---

archive/issue_events_208905.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-02-15T00:27:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "title_is": "Update to IPython 1.2.0",
    "title_was": "Update to IPython 1.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208905"
}
```



---

archive/issue_comments_179387.json:
```json
{
    "body": "Commit: **[`7293ef2`](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)**",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179387",
    "user": "https://github.com/ohanar"
}
```

Commit: **[`7293ef2`](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)**



---

archive/issue_comments_179388.json:
```json
{
    "body": "Branch: **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)**",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179388",
    "user": "https://github.com/ohanar"
}
```

Branch: **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)**



---

archive/issue_comments_179389.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.",
    "created_at": "2014-02-15T00:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179389",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:13" align="right">comment:13</div>

I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.



---

archive/issue_comments_179390.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8\">a86c939</a></td><td><code>really fix instance creation of InteractiveShellEmbed</code></td></tr></table>\n",
    "created_at": "2014-02-15T00:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179390",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8">a86c939</a></td><td><code>really fix instance creation of InteractiveShellEmbed</code></td></tr></table>




---

archive/issue_comments_179391.json:
```json
{
    "body": "Changed commit from **[`7293ef2`](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)** to **[`a86c939`](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)**",
    "created_at": "2014-02-15T00:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7293ef2`](https://github.com/sagemath/sagetrac-mirror/commit/7293ef21fc691d367bf3e1dc663565097179040a)** to **[`a86c939`](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)**



---

archive/issue_comments_179392.json:
```json
{
    "body": "Changed commit from **[`a86c939`](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)** to **[`2ffb13c`](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)**",
    "created_at": "2014-02-17T00:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179392",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a86c939`](https://github.com/sagemath/sagetrac-mirror/commit/a86c939634000fc553763b11e07ef1e8acb7e9e8)** to **[`2ffb13c`](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)**



---

archive/issue_comments_179393.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24ea89290988305d93f85988022cde7284268aeb\">24ea892</a></td><td><code>dynamically set IPYTHONDIR based on the current version of ipython</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c\">2ffb13c</a></td><td><code>backport IPython pull request #4504</code></td></tr></table>\n",
    "created_at": "2014-02-17T00:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179393",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24ea89290988305d93f85988022cde7284268aeb">24ea892</a></td><td><code>dynamically set IPYTHONDIR based on the current version of ipython</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c">2ffb13c</a></td><td><code>backport IPython pull request #4504</code></td></tr></table>




---

archive/issue_comments_179394.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThere is a single doctest that fails (in `src/sage/misc/interpreter.py`), but it doesn't match the behavior of running the test from the sage command line.\n\nAlso, we need some doctests for `sage.misc.interpreter.SagePreparseTransformer.reset`. Since I don't know the preparser code (and the `reset` keyword is documented as \"a boolean\"), it would be great if someone knowledgeable about this could fill in something here.\n\n@jasongrout\nI deleted the note about the prun_magics.patch since you deleted it in https://github.com/jasongrout/sage/commit/d662bf2655dcdc04100a8f29ccb88b790377b46a. Do we still need this?",
    "created_at": "2014-02-17T00:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179394",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:16" align="right">comment:16</div>

There is a single doctest that fails (in `src/sage/misc/interpreter.py`), but it doesn't match the behavior of running the test from the sage command line.

Also, we need some doctests for `sage.misc.interpreter.SagePreparseTransformer.reset`. Since I don't know the preparser code (and the `reset` keyword is documented as "a boolean"), it would be great if someone knowledgeable about this could fill in something here.

@jasongrout
I deleted the note about the prun_magics.patch since you deleted it in https://github.com/jasongrout/sage/commit/d662bf2655dcdc04100a8f29ccb88b790377b46a. Do we still need this?



---

archive/issue_comments_179395.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@ohanar](#comment:13):\n> I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.\n\nI strongly agree with not waiting for IPython 2.0.  They also make some controversial modal changes to the IPython notebook, and I want to see how those shake out in wider testing before switching (i.e., it might be best to wait for 2.1).",
    "created_at": "2014-03-01T18:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179395",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@ohanar](#comment:13):
> I see no reason to wait for IPython 2.0. There are still some issues that stem from the issue found in #14961.

I strongly agree with not waiting for IPython 2.0.  They also make some controversial modal changes to the IPython notebook, and I want to see how those shake out in wider testing before switching (i.e., it might be best to wait for 2.1).



---

archive/issue_comments_179396.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHow is this supposed to actually work?\n\n```\nAttempting to download package ipython-1.2.0\n>>> Trying to download http://www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz\n[Traceback (most recent call last):\n  File \"<stdin>\", line 35, in <module>\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 240, in retrieve\n    fp = self.open(url, data)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 208, in open\n    return getattr(self, name)(url)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 359, in open_http\n    return self.http_error(url, fp, errcode, errmsg, headers)\n  File \"/usr/local/sage/sage-6.2/local/lib/python/urllib.py\", line 376, in http_error\n    return self.http_error_default(url, fp, errcode, errmsg, headers)\n  File \"<stdin>\", line 17, in http_error_default\nIOError: [Errno 404] Not Found: '//www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz'\nError: failed to download package ipython-1.2.0\nmake[2]: *** [/usr/local/sage/sage-6.2/local/var/lib/sage/installed/ipython-1.2.0] Error 1\nmake[2]: Leaving directory `/usr/local/sage/sage-6.2/build'\nmake[1]: *** [all] Error 2\nmake[1]: Leaving directory `/usr/local/sage/sage-6.2/build'\n \nreal    24m14.305s\n```\n\nObviously, I can get around this.  However, I'm concerned about this entire approach to development...",
    "created_at": "2014-03-01T20:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179396",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:18" align="right">comment:18</div>

How is this supposed to actually work?

```
Attempting to download package ipython-1.2.0
>>> Trying to download http://www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz
[Traceback (most recent call last):
  File "<stdin>", line 35, in <module>
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 240, in retrieve
    fp = self.open(url, data)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 208, in open
    return getattr(self, name)(url)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 359, in open_http
    return self.http_error(url, fp, errcode, errmsg, headers)
  File "/usr/local/sage/sage-6.2/local/lib/python/urllib.py", line 376, in http_error
    return self.http_error_default(url, fp, errcode, errmsg, headers)
  File "<stdin>", line 17, in http_error_default
IOError: [Errno 404] Not Found: '//www.sagemath.org/packages/upstream/ipython/ipython-1.2.0.tar.gz'
Error: failed to download package ipython-1.2.0
make[2]: *** [/usr/local/sage/sage-6.2/local/var/lib/sage/installed/ipython-1.2.0] Error 1
make[2]: Leaving directory `/usr/local/sage/sage-6.2/build'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/usr/local/sage/sage-6.2/build'
 
real    24m14.305s
```

Obviously, I can get around this.  However, I'm concerned about this entire approach to development...



---

archive/issue_comments_179397.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYou need to put the tarball manually in the `upstream` directory until the ticket is reviewed.",
    "created_at": "2014-03-01T20:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179397",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

You need to put the tarball manually in the `upstream` directory until the ticket is reviewed.



---

archive/issue_comments_179398.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@vbraun](#comment:19):\n> You need to put the tarball manually in the `upstream` directory until the ticket is reviewed. \n\nThat's what I did.   It would be nice if the code that tries to grab the upstream from sagemath.org could also try other locations specified in the package, e.g., in this case https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz...\n\nI hope our longterm plan is that the process is:\n\n```\n   git <checkout a branch somehow>\n   make\n```\nand it works, rather than\n\n```\n   git <checkout a branch somehow>\n   make\n   # see download failure -- track down packages -- put in upstream directory\n   make\n   # see more download failures -- track down packages -- put in upstream directory, etc.\n```\n\n?",
    "created_at": "2014-03-01T20:34:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179398",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@vbraun](#comment:19):
> You need to put the tarball manually in the `upstream` directory until the ticket is reviewed. 

That's what I did.   It would be nice if the code that tries to grab the upstream from sagemath.org could also try other locations specified in the package, e.g., in this case https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz...

I hope our longterm plan is that the process is:

```
   git <checkout a branch somehow>
   make
```
and it works, rather than

```
   git <checkout a branch somehow>
   make
   # see download failure -- track down packages -- put in upstream directory
   make
   # see more download failures -- track down packages -- put in upstream directory, etc.
```

?



---

archive/issue_comments_179399.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe pypi url is not in the git branch. There are also some projects where you need to click through some html to get a temporary download link *cough* *sourceforge* *cough*. Really we need a common place where people can upload the tarballs.",
    "created_at": "2014-03-01T20:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179399",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

The pypi url is not in the git branch. There are also some projects where you need to click through some html to get a temporary download link *cough* *sourceforge* *cough*. Really we need a common place where people can upload the tarballs.



---

archive/issue_comments_179400.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n+1 to moving to 1.2 now.  I'm not running any extra patches beyond my 1.0 patches to get IPython master working.  So if you merge this, I can stop maintaining the patches, even though I'm running master :).\n\nAnd +1 to william's suggestion of having alternate URLs, since we are verifying the checksum anyway.",
    "created_at": "2014-03-01T21:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179400",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:22" align="right">comment:22</div>

+1 to moving to 1.2 now.  I'm not running any extra patches beyond my 1.0 patches to get IPython master working.  So if you merge this, I can stop maintaining the patches, even though I'm running master :).

And +1 to william's suggestion of having alternate URLs, since we are verifying the checksum anyway.



---

archive/issue_comments_179401.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNote that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2",
    "created_at": "2014-03-01T21:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179401",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:23" align="right">comment:23</div>

Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2



---

archive/issue_comments_179402.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n*IMPORTANT*  This patch introduces this code in the middle of ```src/bin/sage-env``` *before* the path, etc., is properly set up:\n\n```\nif [ -x \"$SAGE_LOCAL/bin/ipython\" ]; then\n    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`ipython --version`\nelse\n    # IPython is not yet installed\n    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`sed 's+\\.p[0-9]*$++' \"$SAGE_ROOT\"/build/pkgs/ipython/package-version.txt`\nfi\n```\n\nThe result is that in a system with multiple version of Ipython (e.g., using python2.7.3 also) you'll get a big nasty ```ImportError: cannot import name MAXREPEAT``` error/traceback whenever you try to start sage (or use ```sage -sh```).    Moving the above IPYTHONDIR stuff to the bottom of the sage-env fixes the problem. \n\nThat said, it's kind of disturbing to be starting up ipython when doing \"sage -sh\", since that's actually a lot of overhead.",
    "created_at": "2014-03-02T00:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179402",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:24" align="right">comment:24</div>

*IMPORTANT*  This patch introduces this code in the middle of ```src/bin/sage-env``` *before* the path, etc., is properly set up:

```
if [ -x "$SAGE_LOCAL/bin/ipython" ]; then
    export IPYTHONDIR="$DOT_SAGE/ipython-"`ipython --version`
else
    # IPython is not yet installed
    export IPYTHONDIR="$DOT_SAGE/ipython-"`sed 's+\.p[0-9]*$++' "$SAGE_ROOT"/build/pkgs/ipython/package-version.txt`
fi
```

The result is that in a system with multiple version of Ipython (e.g., using python2.7.3 also) you'll get a big nasty ```ImportError: cannot import name MAXREPEAT``` error/traceback whenever you try to start sage (or use ```sage -sh```).    Moving the above IPYTHONDIR stuff to the bottom of the sage-env fixes the problem. 

That said, it's kind of disturbing to be starting up ipython when doing "sage -sh", since that's actually a lot of overhead.



---

archive/issue_comments_179403.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jasongrout](#comment:23):\n> Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2\n\nThe upstream tarball is: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz",
    "created_at": "2014-03-02T00:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179403",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jasongrout](#comment:23):
> Note that IPython 1.2.1 is out, which fixes a bug they noticed just after 1.2

The upstream tarball is: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz



---

archive/issue_comments_179404.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI know patches are stupid, but in case anybody cares, here's the patch to move the ipython version environ stuff and update the version of the tarball: http://wstein.org/tmp/ipython-1.2.1.patch",
    "created_at": "2014-03-02T00:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179404",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:26" align="right">comment:26</div>

I know patches are stupid, but in case anybody cares, here's the patch to move the ipython version environ stuff and update the version of the tarball: http://wstein.org/tmp/ipython-1.2.1.patch



---

archive/issue_comments_179405.json:
```json
{
    "body": "Changed commit from **[`2ffb13c`](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)** to **[`88a253c`](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)**",
    "created_at": "2014-03-04T01:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179405",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ffb13c`](https://github.com/sagemath/sagetrac-mirror/commit/2ffb13cd82cc62d86e2a657ad0f5151a56a80e8c)** to **[`88a253c`](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)**



---

archive/issue_comments_179406.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a0b07fb237b7d4a1575db7bf677858fbb36e774\">3a0b07f</a></td><td><code>ipython: upgrade to version 1.2.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/061e7d612befde4f1e17eef0224c0d26e81f4062\">061e7d6</a></td><td><code>interpreter: preparser really is a stateless transformer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e\">88a253c</a></td><td><code>interpreter: fix doctest issue</code></td></tr></table>\n",
    "created_at": "2014-03-04T01:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179406",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a0b07fb237b7d4a1575db7bf677858fbb36e774">3a0b07f</a></td><td><code>ipython: upgrade to version 1.2.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/061e7d612befde4f1e17eef0224c0d26e81f4062">061e7d6</a></td><td><code>interpreter: preparser really is a stateless transformer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e">88a253c</a></td><td><code>interpreter: fix doctest issue</code></td></tr></table>




---

archive/issue_comments_179407.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f\">0fb988d</a></td><td><code>sage-env: don't call ipython when creating the env</code></td></tr></table>\n",
    "created_at": "2014-03-04T02:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179407",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f">0fb988d</a></td><td><code>sage-env: don't call ipython when creating the env</code></td></tr></table>




---

archive/issue_comments_179408.json:
```json
{
    "body": "Changed commit from **[`88a253c`](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)** to **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**",
    "created_at": "2014-03-04T02:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179408",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`88a253c`](https://github.com/sagemath/sagetrac-mirror/commit/88a253c4a5d70855832d2de0ea258e9b0d0d9b7e)** to **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**



---

archive/issue_events_208906.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-03-04T02:05:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "title_is": "Update to IPython 1.2.1",
    "title_was": "Update to IPython 1.2.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208906"
}
```



---

archive/issue_events_208907.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-03-04T02:05:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208907"
}
```



---

archive/issue_comments_179409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n+IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)\n+Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]\n``````\n",
    "created_at": "2014-03-04T02:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179409",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-IPython 1.2.0 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
+IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz](https://pypi.python.org/packages/source/i/ipython/ipython-1.2.0.tar.gz)
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]
``````




---

archive/issue_comments_179410.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]\n+Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]\n``````\n",
    "created_at": "2014-03-04T02:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179410",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz]
+Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]
``````




---

archive/issue_comments_179411.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.\n \n-Upstream tarball: [\u200bhttps://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]\n+Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz\n``````\n",
    "created_at": "2014-03-04T02:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179411",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 IPython 1.2.1 has been released. Changes in IPython resulted in massive cleanup of the custom Sage transformations.
 
-Upstream tarball: [https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz ipython-1.2.1.tar.gz]
+Upstream tarball: https://pypi.python.org/packages/source/i/ipython/ipython-1.2.1.tar.gz
``````




---

archive/issue_comments_179412.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nYou changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?",
    "created_at": "2014-03-04T04:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179412",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:32" align="right">comment:32</div>

You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?



---

archive/issue_comments_179413.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@jasongrout](#comment:32):\n> You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?\n\nYes, although that seems like a hack that was only needed in old versions of ipython. Now ipython doesn't push an open ended quote state to the transformers, so the preparser doesn't actually need to keep track of this anymore.\n\nI think there is a lot that can be done to clean up the preparser in general, but I think that is better fit for another ticket.",
    "created_at": "2014-03-04T04:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179413",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@jasongrout](#comment:32):
> You changed the preparser to a stateless transformer, but the preparse function *does* have state---it keeps track of the quote state, right?

Yes, although that seems like a hack that was only needed in old versions of ipython. Now ipython doesn't push an open ended quote state to the transformers, so the preparser doesn't actually need to keep track of this anymore.

I think there is a lot that can be done to clean up the preparser in general, but I think that is better fit for another ticket.



---

archive/issue_comments_179414.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI've read all of this code pretty carefully, used it for months (in various incarnations by Jason and Andrew), and think upgrading to IPython 1.2.1 should be a very high priority for Sage.   I'm running a clean build and round of doctests, and if they succeed, then this should get a positive review!",
    "created_at": "2014-03-04T04:51:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179414",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:34" align="right">comment:34</div>

I've read all of this code pretty carefully, used it for months (in various incarnations by Jason and Andrew), and think upgrading to IPython 1.2.1 should be a very high priority for Sage.   I'm running a clean build and round of doctests, and if they succeed, then this should get a positive review!



---

archive/issue_comments_179415.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI'll do some checking too.  My worry is not that the preparser could be cleaned up (it certainly could, but that's another issue), but that changing from a coroutine transformer to a stateless transformer is introducing bugs.  I'm not sure why that change was made.  Could you perhaps explain why it's not a coroutine transformer still?",
    "created_at": "2014-03-04T16:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179415",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:35" align="right">comment:35</div>

I'll do some checking too.  My worry is not that the preparser could be cleaned up (it certainly could, but that's another issue), but that changing from a coroutine transformer to a stateless transformer is introducing bugs.  I'm not sure why that change was made.  Could you perhaps explain why it's not a coroutine transformer still?



---

archive/issue_comments_179416.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\noh, I see you did have an explanation.  I'll look into it to make sure.",
    "created_at": "2014-03-04T16:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179416",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:36" align="right">comment:36</div>

oh, I see you did have an explanation.  I'll look into it to make sure.



---

archive/issue_events_208908.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-03-04T16:51:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208908"
}
```



---

archive/issue_events_208909.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-03-04T16:51:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208909"
}
```



---

archive/issue_comments_179417.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nBuilds fine and all tests pass. The issues I pointed out above have also been addressed.",
    "created_at": "2014-03-04T16:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179417",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:37" align="right">comment:37</div>

Builds fine and all tests pass. The issues I pointed out above have also been addressed.



---

archive/issue_comments_179418.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nand I'm still building...",
    "created_at": "2014-03-04T16:55:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179418",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:38" align="right">comment:38</div>

and I'm still building...



---

archive/issue_comments_179419.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nGiving a partial string as a command messes up the parser because the state is not reset, like `\"asdf`.  I'm figuring out how to exploit it.",
    "created_at": "2014-03-04T17:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179419",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:39" align="right">comment:39</div>

Giving a partial string as a command messes up the parser because the state is not reset, like `"asdf`.  I'm figuring out how to exploit it.



---

archive/issue_comments_179420.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nAll right +1.  IPython *does* push open-ended quotes into the preparser if the line is a syntax error (like `\"a`).  However, the preparser is now always called with `reset=True` (the default), so the state doesn't carry over to the next line.\n\nHere is a more complete explanation for it being okay to have a stateless transformation---it relies on two facts that are true right now:\n* we've switched the preparser to be an IPython python_line_transform (which assembles multiline strings into single lines)\n* the preparser has a default of reset=True, which means every time it is called, the state is discarded\n\nIf either of those changes, trouble would probably show up.\n\nOther than that detail, this looks pretty much like the code I've been running on the sage cell server for nearly 6 months, so +1.",
    "created_at": "2014-03-04T18:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179420",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:40" align="right">comment:40</div>

All right +1.  IPython *does* push open-ended quotes into the preparser if the line is a syntax error (like `"a`).  However, the preparser is now always called with `reset=True` (the default), so the state doesn't carry over to the next line.

Here is a more complete explanation for it being okay to have a stateless transformation---it relies on two facts that are true right now:
* we've switched the preparser to be an IPython python_line_transform (which assembles multiline strings into single lines)
* the preparser has a default of reset=True, which means every time it is called, the state is discarded

If either of those changes, trouble would probably show up.

Other than that detail, this looks pretty much like the code I've been running on the sage cell server for nearly 6 months, so +1.



---

archive/issue_comments_179421.json:
```json
{
    "body": "Reviewer: **William Stein**",
    "created_at": "2014-03-04T19:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179421",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **William Stein**



---

archive/issue_comments_179422.json:
```json
{
    "body": "Changed branch from **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)** to **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**",
    "created_at": "2014-03-05T09:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179422",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/ohanar/ipython-upgrade](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ipython-upgrade)** to **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)**



---

archive/issue_events_208910.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-05T09:36:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208910"
}
```



---

archive/issue_events_208911.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b3f91aa2338e8405344196c0d656884bcd1e67b2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-03-05T09:36:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14713#event-208911"
}
```



---

archive/issue_comments_179423.json:
```json
{
    "body": "Changed commit from **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)** to none",
    "created_at": "2014-03-18T10:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179423",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`0fb988d`](https://github.com/sagemath/sagetrac-mirror/commit/0fb988d80d32913715f96bef242ff483f4c24b2f)** to none



---

archive/issue_comments_179424.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nBlocker follow-up at #15972",
    "created_at": "2014-03-18T10:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179424",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Blocker follow-up at #15972



---

archive/issue_comments_179425.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nRandom test failures due to history corruption at #16372",
    "created_at": "2014-05-17T14:47:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14713#issuecomment-179425",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:44" align="right">comment:44</div>

Random test failures due to history corruption at #16372
