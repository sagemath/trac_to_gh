# Issue 14676: testcc.sh identifies clang as GCC

archive/issues_014472.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "The problem is that `clang` defines `__GNUC__` as well (as may Intel's `icc`).\n\nSo we should use\n\n```c\n#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)\nGCC\n...\n```\nor rather something like\n\n```c\n#ifdef __GNUC__\n#  ifdef __clang__\nCLANG\n#  elif defined(__INTEL_COMPILER)\nICC\n#  else\nGCC\n#  endif\n#define KNOWN_CC\n#endif\n```\ninstead.\n\nSimilar applies to `testcxx.sh`.  (`clang++`, i.e., `clang` in C++ mode defines both `__GNUC__` and `__GNUG__` as well.)\n\n---\n\nBut another problem is that a couple of scripts (e.g. `spkg-install`s) testing for GCC might be just happy with `clang` as well (because it is to some extent \"GCC-compatible\"), so these would have to get changed accordingly (to accept both `\"GCC\"` and `\"CLANG\"`), while others may indeed not work with `clang`.\n\nOther scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).\n\n---\n\nRelated:  #12820, #12426\n\n\nCC:  @jdemeyer\n\nKeywords: **compiler detection testcxx CC CXX**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14676_\n\n",
    "closed_at": "2017-01-21T18:03:11Z",
    "created_at": "2013-06-03T08:57:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "testcc.sh identifies clang as GCC",
    "type": "issue",
    "updated_at": "2017-01-21T18:03:11Z",
    "url": "https://github.com/sagemath/sage/issues/14676",
    "user": "https://github.com/nexttime"
}
```
The problem is that `clang` defines `__GNUC__` as well (as may Intel's `icc`).

So we should use

```c
#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)
GCC
...
```
or rather something like

```c
#ifdef __GNUC__
#  ifdef __clang__
CLANG
#  elif defined(__INTEL_COMPILER)
ICC
#  else
GCC
#  endif
#define KNOWN_CC
#endif
```
instead.

Similar applies to `testcxx.sh`.  (`clang++`, i.e., `clang` in C++ mode defines both `__GNUC__` and `__GNUG__` as well.)

---

But another problem is that a couple of scripts (e.g. `spkg-install`s) testing for GCC might be just happy with `clang` as well (because it is to some extent "GCC-compatible"), so these would have to get changed accordingly (to accept both `"GCC"` and `"CLANG"`), while others may indeed not work with `clang`.

Other scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).

---

Related:  #12820, #12426


CC:  @jdemeyer

Keywords: **compiler detection testcxx CC CXX**

Reviewer: **François Bissey**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/14676_





---

archive/issue_events_208112.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-03T08:57:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208112"
}
```



---

archive/issue_events_208113.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-03T08:57:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208113"
}
```



---

archive/issue_events_208114.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-03T08:57:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208114"
}
```



---

archive/issue_events_208115.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2013-06-03T08:57:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208115"
}
```



---

archive/issue_events_208116.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2013-06-03T08:57:45Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208116"
}
```



---

archive/issue_comments_178333.json:
```json
{
    "body": "Replying to [ticket:14676 leif]:\n> The problem is that `clang` defines `__GNUC__` as well\n\nI don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.",
    "created_at": "2013-06-03T09:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178333",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:14676 leif]:
> The problem is that `clang` defines `__GNUC__` as well

I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.



---

archive/issue_comments_178334.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@jdemeyer](#comment:1):\n> Replying to [ticket:14676 leif]:\n> > The problem is that `clang` defines `__GNUC__` as well\n\n> \n> I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.\n\nAs I said, \"GCC-compatible\" *to some extent*, certainly not 100% compatible, especially (but not limited to) when it gets to C++.\n\n(If it was, Sage would just build with `clang` \"out of the box\", and #13948 is not the only problem.)",
    "created_at": "2013-06-03T10:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178334",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@jdemeyer](#comment:1):
> Replying to [ticket:14676 leif]:
> > The problem is that `clang` defines `__GNUC__` as well

> 
> I don't think this is a problem. Clang is supposed to be GCC-compatible, so it seems right that `testcc.sh` answers GCC for Clang.

As I said, "GCC-compatible" *to some extent*, certainly not 100% compatible, especially (but not limited to) when it gets to C++.

(If it was, Sage would just build with `clang` "out of the box", and #13948 is not the only problem.)



---

archive/issue_comments_178335.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nP.S.:  I mainly opened this ticket to at least *record* the issue.",
    "created_at": "2013-06-03T10:10:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178335",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

P.S.:  I mainly opened this ticket to at least *record* the issue.



---

archive/issue_comments_178336.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,3 +31,7 @@\n \n Other scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).\n \n+---\n+\n+Related:  #12820, #12426\n+\n``````\n",
    "created_at": "2013-06-03T10:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178336",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,3 +31,7 @@
 
 Other scripts may not (yet) use `test{cc,cxx}.sh` but some similar logic; those probably have to get fixed as well, be it to (currently) just bail out earlier (e.g. if `CXX=clang`; in the long run, Sage will most probably build with `clang` as well).
 
+---
+
+Related:  #12820, #12426
+
``````




---

archive/issue_events_208117.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208117"
}
```



---

archive/issue_events_208118.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208118"
}
```



---

archive/issue_events_208119.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208119"
}
```



---

archive/issue_events_208120.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208120"
}
```



---

archive/issue_events_208121.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208121"
}
```



---

archive/issue_events_208122.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208122"
}
```



---

archive/issue_events_208123.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208123"
}
```



---

archive/issue_events_208124.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208124"
}
```



---

archive/issue_events_208125.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-28T16:56:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208125"
}
```



---

archive/issue_events_208126.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-28T16:56:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208126"
}
```



---

archive/issue_events_208127.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-17T07:24:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208127"
}
```



---

archive/issue_events_208128.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-17T07:24:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208128"
}
```



---

archive/issue_events_208129.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-17T07:24:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208129"
}
```



---

archive/issue_events_208130.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-17T07:24:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208130"
}
```



---

archive/issue_comments_178337.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2016-09-17T07:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178337",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_comments_178338.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think this is obsolete.",
    "created_at": "2016-09-17T07:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178338",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

I think this is obsolete.



---

archive/issue_comments_178339.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMaybe not obsolete but at least pointless.",
    "created_at": "2016-09-17T07:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14676#issuecomment-178339",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Maybe not obsolete but at least pointless.



---

archive/issue_events_208131.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-17T07:35:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208131"
}
```



---

archive/issue_events_208132.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-09-17T07:35:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208132"
}
```



---

archive/issue_events_208133.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208133"
}
```



---

archive/issue_events_208134.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-01-21T18:03:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14676#event-208134"
}
```
