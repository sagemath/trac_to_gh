# Issue 14801: Piecewise functions done right

archive/issues_014597.json:
```json
{
    "body": "Rewrite piecewise functions as symbolic functions.\n\nFor a (late) discussion about interface issues see https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM\n\n**Assignee:** @rwst\n\n**CC:**  @eviatarbach @kcrisman @slel @mkoeppe\n\n**Branch/Commit:** [966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)\n\n**Reviewer:** Volker Braun, Ralf Stephan\n\n**Author:** Volker Braun, Ralf Stephan\n\n**Dependencies:** #14800, #14780, #13125, #14802, #16397, #17759\n\nIssue created by migration from https://trac.sagemath.org/ticket/14801\n\n",
    "closed_at": "2016-04-23T08:45:39Z",
    "created_at": "2013-06-21T21:56:38Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Piecewise functions done right",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14801",
    "user": "https://github.com/vbraun"
}
```
Rewrite piecewise functions as symbolic functions.

For a (late) discussion about interface issues see https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM

**Assignee:** @rwst

**CC:**  @eviatarbach @kcrisman @slel @mkoeppe

**Branch/Commit:** [966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)

**Reviewer:** Volker Braun, Ralf Stephan

**Author:** Volker Braun, Ralf Stephan

**Dependencies:** #14800, #14780, #13125, #14802, #16397, #17759

Issue created by migration from https://trac.sagemath.org/ticket/14801





---

archive/issue_comments_222809.json:
```json
{
    "body": "<a id='comment:1'></a>\nPatch is just a first proof of concept now",
    "created_at": "2013-06-21T22:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222809",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>
Patch is just a first proof of concept now



---

archive/issue_comments_222810.json:
```json
{
    "body": "**Dependencies:** #14800, #14780, #9556, #13125",
    "created_at": "2013-06-21T22:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222810",
    "user": "https://github.com/vbraun"
}
```

**Dependencies:** #14800, #14780, #9556, #13125



---

archive/issue_comments_222811.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-06-27T15:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222811",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/attachments_019924.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14801_piecewiese.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14801/trac_14801_piecewiese.patch",
    "created_at": "2013-07-11T05:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/eviatarbach"
}
```



---

archive/issue_comments_222812.json:
```json
{
    "body": "<a id='comment:3'></a>\n",
    "created_at": "2013-07-11T05:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222812",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:3'></a>




---

archive/issue_comments_222813.json:
```json
{
    "body": "<a id='comment:4'></a>\nPresumably this would (help) solve #11225, #1773, #8994, and #8603.  And #12123.  Or maybe this won't help if it removes support for those things...\n\nSee also [Maxima's pw.mac](http://sourceforge.net/projects/piecewisefunc/).",
    "created_at": "2013-07-11T15:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222813",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>
Presumably this would (help) solve #11225, #1773, #8994, and #8603.  And #12123.  Or maybe this won't help if it removes support for those things...

See also [Maxima's pw.mac](http://sourceforge.net/projects/piecewisefunc/).



---

archive/issue_events_049070.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49070"
}
```



---

archive/issue_comments_222814.json:
```json
{
    "body": "<a id='comment:6'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f\">6d00b38</a></td><td><code>Trac 14801: Rewrite piecewise functions as symbolic functions</code></td></tr></table>\n",
    "created_at": "2014-04-01T07:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222814",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f">6d00b38</a></td><td><code>Trac 14801: Rewrite piecewise functions as symbolic functions</code></td></tr></table>




---

archive/issue_comments_222815.json:
```json
{
    "body": "**Commit:** [6d00b38418552984fa951bf9c4090da001a1ec9f](https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f)",
    "created_at": "2014-04-01T07:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222815",
    "user": "https://github.com/rwst"
}
```

**Commit:** [6d00b38418552984fa951bf9c4090da001a1ec9f](https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f)



---

archive/issue_comments_222816.json:
```json
{
    "body": "**Branch:** [public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)",
    "created_at": "2014-04-01T07:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222816",
    "user": "https://github.com/rwst"
}
```

**Branch:** [public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)



---

archive/issue_comments_222817.json:
```json
{
    "body": "<a id='comment:7'></a>\nMany doctests fail in the new code. For example:\n\n```\nsage: f = piecewise([((0,1), x^3), ([-1,0], -x^2)]);  f\npiecewise(x|-->x^3 on (0, 1), x|-->-x^2 on [-1, 0]; x)\nsage: f(x=1/2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-6d710eda1bb0> in <module>()\n----> 1 f(x=Integer(1)/Integer(2))\n\nTypeError: new_f() got an unexpected keyword argument 'x'\n```\nI am not well versed in Python. I think there is maybe a problem in `symbolic/function_factory.pyx:eval_on_operands()` (dynamic methods for symbolic expressions, added with #9556) which is uncovered with this ticket.\n\n```\ndef eval_on_operands(f):\n    @sage_wraps(f)\n    def new_f(ex):\n        return f(*ex.operands())\n    return new_f\n```\nApparently `f` gets some `new_f` on creation and tries to call it with a named parameter but python barfs because the parameter wasn't expected in `new_f`. Moreover, even without name `f(1/2)` barfs because the number of arguments to `new_f` doesn't fit anymore. So only `f()` will call `new_f` succesfully but that's useless.",
    "created_at": "2014-04-01T08:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222817",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
Many doctests fail in the new code. For example:

```
sage: f = piecewise([((0,1), x^3), ([-1,0], -x^2)]);  f
piecewise(x|-->x^3 on (0, 1), x|-->-x^2 on [-1, 0]; x)
sage: f(x=1/2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-6d710eda1bb0> in <module>()
----> 1 f(x=Integer(1)/Integer(2))

TypeError: new_f() got an unexpected keyword argument 'x'
```
I am not well versed in Python. I think there is maybe a problem in `symbolic/function_factory.pyx:eval_on_operands()` (dynamic methods for symbolic expressions, added with #9556) which is uncovered with this ticket.

```
def eval_on_operands(f):
    @sage_wraps(f)
    def new_f(ex):
        return f(*ex.operands())
    return new_f
```
Apparently `f` gets some `new_f` on creation and tries to call it with a named parameter but python barfs because the parameter wasn't expected in `new_f`. Moreover, even without name `f(1/2)` barfs because the number of arguments to `new_f` doesn't fit anymore. So only `f()` will call `new_f` succesfully but that's useless.



---

archive/issue_comments_222818.json:
```json
{
    "body": "<a id='comment:8'></a>\nThere is new code for `symbolic/function_factory.pyx:eval_on_operands()` in #14802, but if I use that I get `TypeError: 'NoneType' object is not callable` for every call to `f()`.",
    "created_at": "2014-04-01T09:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222818",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
There is new code for `symbolic/function_factory.pyx:eval_on_operands()` in #14802, but if I use that I get `TypeError: 'NoneType' object is not callable` for every call to `f()`.



---

archive/issue_comments_222819.json:
```json
{
    "body": "<a id='comment:9'></a>\nOk, with the dependencies #13125 and #14802 there remain two failing doctests in `piecewise.py`:\n\n```\nFile \"src/sage/functions/piecewise.py\", line 493, in sage.functions.piecewise.PiecewiseFunction.EvaluationMethods.extension\nFailed example:\n    g(3)\n...\n      File \"<doctest sage.functions.piecewise.PiecewiseFunction.EvaluationMethods.extension[3]>\", line 1, in <module>\n        g(Integer(3))\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/function_factory.py\", line 387, in new_f\n        return f(ex, *new_args, **kwds)\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.py\", line 398, in __call__\n        return self.subs(substitution)\n      File \"expression.pyx\", line 4212, in sage.symbolic.expression.Expression.substitute (sage/symbolic/expression.cpp:20863)\n      File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.py\", line 209, in _subs_\n        raise ValueError('point is not in the domain')\n    ValueError: point is not in the domain\n```\nand the same in line `498`, as well as more than 200 failing doctests in `piecewise-old.py` because of the deprecation.",
    "created_at": "2014-04-03T14:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222819",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>
Ok, with the dependencies #13125 and #14802 there remain two failing doctests in `piecewise.py`:

```
File "src/sage/functions/piecewise.py", line 493, in sage.functions.piecewise.PiecewiseFunction.EvaluationMethods.extension
Failed example:
    g(3)
...
      File "<doctest sage.functions.piecewise.PiecewiseFunction.EvaluationMethods.extension[3]>", line 1, in <module>
        g(Integer(3))
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/function_factory.py", line 387, in new_f
        return f(ex, *new_args, **kwds)
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.py", line 398, in __call__
        return self.subs(substitution)
      File "expression.pyx", line 4212, in sage.symbolic.expression.Expression.substitute (sage/symbolic/expression.cpp:20863)
      File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.py", line 209, in _subs_
        raise ValueError('point is not in the domain')
    ValueError: point is not in the domain
```
and the same in line `498`, as well as more than 200 failing doctests in `piecewise-old.py` because of the deprecation.



---

archive/issue_comments_222820.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125\" to \"#14800, #14780, #9556, #13125, #14802\".",
    "created_at": "2014-04-03T14:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222820",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125" to "#14800, #14780, #9556, #13125, #14802".



---

archive/issue_comments_222821.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt appears that by checking `RealSet.are_pairwise_disjoint(*domain_list)` in `piecewise.py:145`, intervals with any boundaries from SR will not be accepted anymore.\n\n```\nage: piecewise([((-1, sqrt(2)), -x), ((sqrt(3), 2), x)], var=x)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-27-571b9720cf91> in <module>()\n----> 1 piecewise([((-Integer(1), sqrt(Integer(2))), -x), ((sqrt(Integer(3)), Integer(2)), x)], var=x)\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2696)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.pyc in __call__(self, function_pieces, **kwds)\n    143             domain_list.append(domain)\n    144         if not RealSet.are_pairwise_disjoint(*domain_list):\n--> 145             raise ValueError('domains must be pairwise disjoint')\n```\nbut, since the old class didn't bother, it accepted all input. So the doctests in the old class will fail because the old class is redirected to the new. Personally I would just remove all doctests from the old class instead of fiddling together 200 working ones for a deprecated class. Is this allowed?\n\nIn any case I consider the restriction to reals surprising. At least I would want to see a better error msg.",
    "created_at": "2014-04-03T16:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222821",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
It appears that by checking `RealSet.are_pairwise_disjoint(*domain_list)` in `piecewise.py:145`, intervals with any boundaries from SR will not be accepted anymore.

```
age: piecewise([((-1, sqrt(2)), -x), ((sqrt(3), 2), x)], var=x)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-27-571b9720cf91> in <module>()
----> 1 piecewise([((-Integer(1), sqrt(Integer(2))), -x), ((sqrt(Integer(3)), Integer(2)), x)], var=x)

/home/ralf/sage/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2696)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/piecewise.pyc in __call__(self, function_pieces, **kwds)
    143             domain_list.append(domain)
    144         if not RealSet.are_pairwise_disjoint(*domain_list):
--> 145             raise ValueError('domains must be pairwise disjoint')
```
but, since the old class didn't bother, it accepted all input. So the doctests in the old class will fail because the old class is redirected to the new. Personally I would just remove all doctests from the old class instead of fiddling together 200 working ones for a deprecated class. Is this allowed?

In any case I consider the restriction to reals surprising. At least I would want to see a better error msg.



---

archive/issue_comments_222822.json:
```json
{
    "body": "<a id='comment:11'></a>\n> and the same in line `498`, as well as more than 200 failing doctests in `piecewise-old.py` because of the deprecation.\n\nYeah, I don't know how we are going to deal with this.   I suspect we should have `Piecewise` for the old-style one for a deprecation period and `piecewise` for the new ones.  The current changes here aren't really a deprecation at all, but rather a backwards-incompatible change.",
    "created_at": "2014-04-08T01:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222822",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
> and the same in line `498`, as well as more than 200 failing doctests in `piecewise-old.py` because of the deprecation.

Yeah, I don't know how we are going to deal with this.   I suspect we should have `Piecewise` for the old-style one for a deprecation period and `piecewise` for the new ones.  The current changes here aren't really a deprecation at all, but rather a backwards-incompatible change.



---

archive/issue_comments_222823.json:
```json
{
    "body": "**Changing author** from \"Volker Braun\" to \"Volker Braun, Ralf Stephan\".",
    "created_at": "2014-04-08T16:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222823",
    "user": "https://github.com/rwst"
}
```

**Changing author** from "Volker Braun" to "Volker Braun, Ralf Stephan".



---

archive/issue_comments_222824.json:
```json
{
    "body": "<a id='comment:12'></a>\nMy solution would be to leave `piecewise.py` as is and put the new code as `piecewise_real = PiecewiseRealFunction()` into `piecewise_real.py`. I have uploaded the alternative branch `public/piecewise-alt` to trac and set the Branch: field to it. Feel free to revert to the old one named `public/piecewise`.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32e801a7674f97d4ea6e0441dcd13577914b2bd4\">32e801a</a></td><td><code>Import of trac_14802-dynamic_attribute_args.patch from</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b97156ca05ec0481f98bd754f0bdc85c1d565121\">b97156c</a></td><td><code>Implement RealSet - finite unions of open/closed/semi-closed subsets of the real line.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daf1c0c129579c7e71404432e1150b361230ef88\">daf1c0c</a></td><td><code>Further improvements to RealSet</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b20c3b1a62190daf4546f9f85c9ad4a9a571fb6\">1b20c3b</a></td><td><code>Trac #13125: reviewer's patch: fix typos, add module to set refman</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c\">81b6176</a></td><td><code>fixes</code></td></tr></table>\n",
    "created_at": "2014-04-08T16:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222824",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
My solution would be to leave `piecewise.py` as is and put the new code as `piecewise_real = PiecewiseRealFunction()` into `piecewise_real.py`. I have uploaded the alternative branch `public/piecewise-alt` to trac and set the Branch: field to it. Feel free to revert to the old one named `public/piecewise`.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32e801a7674f97d4ea6e0441dcd13577914b2bd4">32e801a</a></td><td><code>Import of trac_14802-dynamic_attribute_args.patch from</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b97156ca05ec0481f98bd754f0bdc85c1d565121">b97156c</a></td><td><code>Implement RealSet - finite unions of open/closed/semi-closed subsets of the real line.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daf1c0c129579c7e71404432e1150b361230ef88">daf1c0c</a></td><td><code>Further improvements to RealSet</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b20c3b1a62190daf4546f9f85c9ad4a9a571fb6">1b20c3b</a></td><td><code>Trac #13125: reviewer's patch: fix typos, add module to set refman</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c">81b6176</a></td><td><code>fixes</code></td></tr></table>




---

archive/issue_comments_222825.json:
```json
{
    "body": "**Changing commit** from \"[6d00b38418552984fa951bf9c4090da001a1ec9f](https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f)\" to \"[81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c](https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c)\".",
    "created_at": "2014-04-08T16:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222825",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[6d00b38418552984fa951bf9c4090da001a1ec9f](https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f)" to "[81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c](https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c)".



---

archive/issue_comments_222826.json:
```json
{
    "body": "**Changing branch** from \"[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)\" to \"[public/piecewise-alt](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-alt)\".",
    "created_at": "2014-04-08T16:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222826",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)" to "[public/piecewise-alt](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-alt)".



---

archive/issue_comments_222827.json:
```json
{
    "body": "**Changing commit** from \"[81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c](https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c)\" to \"[852ba6f43b97dc143de2a3ec183d6770dfd885bc](https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc)\".",
    "created_at": "2014-04-10T09:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c](https://github.com/sagemath/sagetrac-mirror/commit/81b6176243c4fc8dc5bf3dfd244dc34df2e5be6c)" to "[852ba6f43b97dc143de2a3ec183d6770dfd885bc](https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc)".



---

archive/issue_comments_222828.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57e825421ef2fdd12d328e4c92a193db056e6e48\">57e8254</a></td><td><code>fixes; remove crap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc\">852ba6f</a></td><td><code>fix doctest; remove crap</code></td></tr></table>\n",
    "created_at": "2014-04-10T09:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57e825421ef2fdd12d328e4c92a193db056e6e48">57e8254</a></td><td><code>fixes; remove crap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc">852ba6f</a></td><td><code>fix doctest; remove crap</code></td></tr></table>




---

archive/issue_comments_222829.json:
```json
{
    "body": "<a id='comment:14'></a>\nNow on to the remaining two errors. This code throws:\n\n```\nsage: f = piecewise_real([((-1,1), x)]);  f; g = f.extension(0);  g; g(3)\n```\nIt works however if I patch `rings/real_lazy.pyx`:\n\n```\ndiff --git a/src/sage/sets/real_set.py b/src/sage/sets/real_set.py\nindex adc41d3..1d43cc4 100644\n--- a/src/sage/sets/real_set.py\n+++ b/src/sage/sets/real_set.py\n@@ -582,8 +582,8 @@ class RealInterval(UniqueRepresentation, Parent):\n             sage: i.contains(2)\n             True\n         \"\"\"\n-        cmp_lower = cmp(self._lower, x)\n-        cmp_upper = cmp(x, self._upper)\n+        cmp_lower = cmp(self._lower._value, x)\n+        cmp_upper = cmp(x, self._upper._value)\n         if cmp_lower == cmp_upper == -1:\n             return True\n         if cmp_lower == 0:\n```\nSo, as this fixes it and passes tests, I'm committing and proposing this branch for review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57e825421ef2fdd12d328e4c92a193db056e6e48\">57e8254</a></td><td><code>fixes; remove crap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc\">852ba6f</a></td><td><code>fix doctest; remove crap</code></td></tr></table>\n",
    "created_at": "2014-04-10T09:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222829",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Now on to the remaining two errors. This code throws:

```
sage: f = piecewise_real([((-1,1), x)]);  f; g = f.extension(0);  g; g(3)
```
It works however if I patch `rings/real_lazy.pyx`:

```
diff --git a/src/sage/sets/real_set.py b/src/sage/sets/real_set.py
index adc41d3..1d43cc4 100644
--- a/src/sage/sets/real_set.py
+++ b/src/sage/sets/real_set.py
@@ -582,8 +582,8 @@ class RealInterval(UniqueRepresentation, Parent):
             sage: i.contains(2)
             True
         """
-        cmp_lower = cmp(self._lower, x)
-        cmp_upper = cmp(x, self._upper)
+        cmp_lower = cmp(self._lower._value, x)
+        cmp_upper = cmp(x, self._upper._value)
         if cmp_lower == cmp_upper == -1:
             return True
         if cmp_lower == 0:
```
So, as this fixes it and passes tests, I'm committing and proposing this branch for review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57e825421ef2fdd12d328e4c92a193db056e6e48">57e8254</a></td><td><code>fixes; remove crap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc">852ba6f</a></td><td><code>fix doctest; remove crap</code></td></tr></table>




---

archive/issue_comments_222830.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-04-10T09:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222830",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_049071.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49071"
}
```



---

archive/issue_events_049072.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49072"
}
```



---

archive/issue_comments_222831.json:
```json
{
    "body": "**Changing commit** from \"[852ba6f43b97dc143de2a3ec183d6770dfd885bc](https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc)\" to \"[e31ad6ba056270177f94d3a909fe6c527c992696](https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696)\".",
    "created_at": "2014-05-25T14:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[852ba6f43b97dc143de2a3ec183d6770dfd885bc](https://github.com/sagemath/sagetrac-mirror/commit/852ba6f43b97dc143de2a3ec183d6770dfd885bc)" to "[e31ad6ba056270177f94d3a909fe6c527c992696](https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696)".



---

archive/issue_comments_222832.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696\">e31ad6b</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-alt</code></td></tr></table>\n",
    "created_at": "2014-05-25T14:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696">e31ad6b</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-alt</code></td></tr></table>




---

archive/issue_comments_222833.json:
```json
{
    "body": "<a id='comment:17'></a>\nNow that the comparisons with infinity are fixed we should be able to get this finished. I don't like the separate `piecewise_real` thing. If there is some problem with symbolic expressions then that should be fixed. I'll have a look now.",
    "created_at": "2014-05-25T14:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222833",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
Now that the comparisons with infinity are fixed we should be able to get this finished. I don't like the separate `piecewise_real` thing. If there is some problem with symbolic expressions then that should be fixed. I'll have a look now.



---

archive/issue_comments_222834.json:
```json
{
    "body": "**Changing branch** from \"[public/piecewise-alt](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-alt)\" to \"[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)\".",
    "created_at": "2014-05-25T17:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222834",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/piecewise-alt](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-alt)" to "[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)".



---

archive/issue_comments_222835.json:
```json
{
    "body": "<a id='comment:18'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f\">6d00b38</a></td><td><code>Trac 14801: Rewrite piecewise functions as symbolic functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214\">496128f</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr></table>\n",
    "created_at": "2014-05-25T17:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222835",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d00b38418552984fa951bf9c4090da001a1ec9f">6d00b38</a></td><td><code>Trac 14801: Rewrite piecewise functions as symbolic functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214">496128f</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr></table>




---

archive/issue_comments_222836.json:
```json
{
    "body": "**Changing commit** from \"[e31ad6ba056270177f94d3a909fe6c527c992696](https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696)\" to \"[496128f8fad75a19945588139d887a5707a72214](https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214)\".",
    "created_at": "2014-05-25T17:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222836",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[e31ad6ba056270177f94d3a909fe6c527c992696](https://github.com/sagemath/sagetrac-mirror/commit/e31ad6ba056270177f94d3a909fe6c527c992696)" to "[496128f8fad75a19945588139d887a5707a72214](https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214)".



---

archive/issue_comments_222837.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802\" to \"#14800, #14780, #9556, #13125, #14802, #16397\".",
    "created_at": "2014-05-25T17:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222837",
    "user": "https://github.com/vbraun"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802" to "#14800, #14780, #9556, #13125, #14802, #16397".



---

archive/issue_comments_222838.json:
```json
{
    "body": "<a id='comment:19'></a>\nIt looks like there is still no proper deprecation for the \"old\" piecewise stuff.  Given that there seems to be a significant amount of stuff that that has (even if in an antiquated form that should be redone), perhaps a potential solution would be to do a deprecation of `Piecewise` that leads to the old version, but where `piecewise` is the new one? (Wait, I already said this in [comment:11](#comment%3A11).)  I agree with Volker that `piecewise_real` is probably too involved, but this is not so crucial a change that we shouldn't follow normal deprecation policy, especially since apparently people really do use the plotting and convolution/fourier stuff, buggy though it is.",
    "created_at": "2014-05-27T14:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222838",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
It looks like there is still no proper deprecation for the "old" piecewise stuff.  Given that there seems to be a significant amount of stuff that that has (even if in an antiquated form that should be redone), perhaps a potential solution would be to do a deprecation of `Piecewise` that leads to the old version, but where `piecewise` is the new one? (Wait, I already said this in [comment:11](#comment%3A11).)  I agree with Volker that `piecewise_real` is probably too involved, but this is not so crucial a change that we shouldn't follow normal deprecation policy, especially since apparently people really do use the plotting and convolution/fourier stuff, buggy though it is.



---

archive/issue_comments_222839.json:
```json
{
    "body": "<a id='comment:20'></a>\nWell the old branch should be still there, as I said in [comment:12](#comment%3A12)",
    "created_at": "2014-05-27T16:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222839",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>
Well the old branch should be still there, as I said in [comment:12](#comment%3A12)



---

archive/issue_events_049073.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49073"
}
```



---

archive/issue_events_049074.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49074"
}
```



---

archive/issue_comments_222840.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [kcrisman](#comment%3A19):\n> It looks like there is still no proper deprecation for the \"old\" piecewise stuff.  Given that there seems to be a significant amount of stuff that that has (even if in an antiquated form that should be redone), perhaps a potential solution would be to do a deprecation of `Piecewise` that leads to the old version, but where `piecewise` is the new one? (Wait, I already said this in [comment:11](#comment%3A11).)\n\nSeems that Volker already implemented it, just the doctests have to be adapted, and the `cmp` stuff from #16397:\n\n```\nsage: R.<x> = PolynomialRing(QQ, 'x')\nsage: f = Piecewise([[(0,1),1*x^0]])\n/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: use lower-case piecewise instead\nSee http://trac.sagemath.org/14801 for details.\n  #!/usr/bin/env python\n----------------------------------------------------------------------\nsage -t --long src/sage/functions/piecewise.py  # 3 doctests failed\nsage -t --long src/sage/functions/piecewise-old.py  # 203 doctests failed\n```\nI think I'll put some work into it to reduce doctest failures a bit.",
    "created_at": "2014-09-04T14:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222840",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Replying to [kcrisman](#comment%3A19):
> It looks like there is still no proper deprecation for the "old" piecewise stuff.  Given that there seems to be a significant amount of stuff that that has (even if in an antiquated form that should be redone), perhaps a potential solution would be to do a deprecation of `Piecewise` that leads to the old version, but where `piecewise` is the new one? (Wait, I already said this in [comment:11](#comment%3A11).)

Seems that Volker already implemented it, just the doctests have to be adapted, and the `cmp` stuff from #16397:

```
sage: R.<x> = PolynomialRing(QQ, 'x')
sage: f = Piecewise([[(0,1),1*x^0]])
/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: use lower-case piecewise instead
See http://trac.sagemath.org/14801 for details.
  #!/usr/bin/env python
----------------------------------------------------------------------
sage -t --long src/sage/functions/piecewise.py  # 3 doctests failed
sage -t --long src/sage/functions/piecewise-old.py  # 203 doctests failed
```
I think I'll put some work into it to reduce doctest failures a bit.



---

archive/issue_comments_222841.json:
```json
{
    "body": "**Changing commit** from \"[496128f8fad75a19945588139d887a5707a72214](https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214)\" to \"[262b01e0de35a35d46fedda5e99255a26b9b36fa](https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa)\".",
    "created_at": "2014-09-04T15:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[496128f8fad75a19945588139d887a5707a72214](https://github.com/sagemath/sagetrac-mirror/commit/496128f8fad75a19945588139d887a5707a72214)" to "[262b01e0de35a35d46fedda5e99255a26b9b36fa](https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa)".



---

archive/issue_comments_222842.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/068c9e06a0a5783f12d3b01408719eab629bdc16\">068c9e0</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa\">262b01e</a></td><td><code>14801: fix 51 doctests with deprecation warnings</code></td></tr></table>\n",
    "created_at": "2014-09-04T15:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/068c9e06a0a5783f12d3b01408719eab629bdc16">068c9e0</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa">262b01e</a></td><td><code>14801: fix 51 doctests with deprecation warnings</code></td></tr></table>




---

archive/issue_comments_222843.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-09-05T08:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222843",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_222844.json:
```json
{
    "body": "<a id='comment:25'></a>\nCould you please explain why we need to keep all the old stuff? What functionality/syntax worked with the old `Piecewise` but not with the new `piecewise`?",
    "created_at": "2014-09-05T08:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222844",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Could you please explain why we need to keep all the old stuff? What functionality/syntax worked with the old `Piecewise` but not with the new `piecewise`?



---

archive/issue_comments_222845.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [jdemeyer](#comment%3A25):\n> Could you please explain why we need to keep all the old stuff? What functionality/syntax worked with the old `Piecewise` but not with the new `piecewise`?\n\nNot sure if we need these, they are demonstrated in the failing `src/doc/en/constructions/calculus.rst` doctests:\n* `convolution()`\n* `critical_points()`\n* `riemann_sum_integral_approximation()`\n* `trapezoid()`\nThe rest of `piecewise-old.py` appears not to be used elsewhere, or doesn't contribute to failing doctests.",
    "created_at": "2014-09-05T08:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222845",
    "user": "https://github.com/rwst"
}
```

<a id='comment:26'></a>
Replying to [jdemeyer](#comment%3A25):
> Could you please explain why we need to keep all the old stuff? What functionality/syntax worked with the old `Piecewise` but not with the new `piecewise`?

Not sure if we need these, they are demonstrated in the failing `src/doc/en/constructions/calculus.rst` doctests:
* `convolution()`
* `critical_points()`
* `riemann_sum_integral_approximation()`
* `trapezoid()`
The rest of `piecewise-old.py` appears not to be used elsewhere, or doesn't contribute to failing doctests.



---

archive/issue_comments_222846.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis is a bug:\n\n```\nsage: var('y')\ny\nsage: f(x) = piecewise([((0,2), y^3)])\nsage: f(1)\n1\n```\n\nThe result should be `y^3` as in:\n\n```\nsage: f(x) = y^3\nsage: f(1)\ny^3\n```",
    "created_at": "2014-09-05T08:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222846",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
This is a bug:

```
sage: var('y')
y
sage: f(x) = piecewise([((0,2), y^3)])
sage: f(1)
1
```

The result should be `y^3` as in:

```
sage: f(x) = y^3
sage: f(1)
y^3
```



---

archive/issue_comments_222847.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jdemeyer](#comment%3A27):\n> This is a bug:\n> \n> ```\n> sage: var('y')\n> y\n> sage: f(x) = piecewise([((0,2), y^3)])\n> sage: f(1)\n> 1\n> ```\n> \n> The result should be `y^3` as in:\n> \n> ```\n> sage: f(x) = y^3\n> sage: f(1)\n> y^3\n> ```\n\nReally?\n\n```\nsage: f(x) = piecewise([((0,2), y^3)],var=x)\nsage: f\nx |--> piecewise(x|-->y^3 on (0, 2); x)\nsage: f(1)\ny^3\n```",
    "created_at": "2014-09-05T09:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222847",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
Replying to [jdemeyer](#comment%3A27):
> This is a bug:
> 
> ```
> sage: var('y')
> y
> sage: f(x) = piecewise([((0,2), y^3)])
> sage: f(1)
> 1
> ```
> 
> The result should be `y^3` as in:
> 
> ```
> sage: f(x) = y^3
> sage: f(1)
> y^3
> ```

Really?

```
sage: f(x) = piecewise([((0,2), y^3)],var=x)
sage: f
x |--> piecewise(x|-->y^3 on (0, 2); x)
sage: f(1)
y^3
```



---

archive/issue_comments_222848.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [rws](#comment%3A28):\n> \n> ```\n> sage: f(x) = piecewise([((0,2), y^3)],var=x)\n> ```\n\nI don't like that one need to write `var=x`. I think the following should work somehow:\n\n```\nsage: f(x) = piecewise([((0,2), y^3)])\n```\nI understand the semantics are not easy, because you are using the variable twice: once for the condition on the domain (`0 < x < 2`) and once to evaluate the function (`y^3`). In a way, you want the result of `piecewise(...)` to be like `sin` but also like `sin(x)`.",
    "created_at": "2014-09-05T09:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222848",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [rws](#comment%3A28):
> 
> ```
> sage: f(x) = piecewise([((0,2), y^3)],var=x)
> ```

I don't like that one need to write `var=x`. I think the following should work somehow:

```
sage: f(x) = piecewise([((0,2), y^3)])
```
I understand the semantics are not easy, because you are using the variable twice: once for the condition on the domain (`0 < x < 2`) and once to evaluate the function (`y^3`). In a way, you want the result of `piecewise(...)` to be like `sin` but also like `sin(x)`.



---

archive/issue_comments_222849.json:
```json
{
    "body": "<a id='comment:30'></a>\nGiven that\n\n```\nf(x) = foo\n```\nis preprocessor syntactic sugar for\n\n```\nf = foo.function(x)\n```\nthe simplest solution might be to override the `.function()` method to also change the variable name of the piecewise function.",
    "created_at": "2014-09-05T09:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222849",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Given that

```
f(x) = foo
```
is preprocessor syntactic sugar for

```
f = foo.function(x)
```
the simplest solution might be to override the `.function()` method to also change the variable name of the piecewise function.



---

archive/issue_comments_222850.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jdemeyer](#comment%3A30):\n> Given that\n> \n> ```\n> f(x) = foo\n> ```\n> is preprocessor syntactic sugar for\n> \n> ```\n> f = foo.function(x)\n> ```\n> the simplest solution might be to override the `.function()` method to also change the variable name of the piecewise function.\n\nAs far as I understand it, the only time `symbolic_expr.function(..)` recurses into the expression is when converting into the `CallableSymbolicExpressionRing` which calls `SymbolicRing._element_constructor_()`. I don't think I can easily hand `var` down to that machinery, recognize when a `piecewise` get converted, and call a member func then.\n\nIOW, the `piecewise` on the r.h.s. of `f(x) = piecewise([((0,2), y^3)])` may be buried within an expression, and I find it not the \"simplest solution\" to handle its `var` via `.function()`. But that's from a first look at parts of the code I have never worked with, so I would appreciate any hint.",
    "created_at": "2014-10-14T15:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222850",
    "user": "https://github.com/rwst"
}
```

<a id='comment:31'></a>
Replying to [jdemeyer](#comment%3A30):
> Given that
> 
> ```
> f(x) = foo
> ```
> is preprocessor syntactic sugar for
> 
> ```
> f = foo.function(x)
> ```
> the simplest solution might be to override the `.function()` method to also change the variable name of the piecewise function.

As far as I understand it, the only time `symbolic_expr.function(..)` recurses into the expression is when converting into the `CallableSymbolicExpressionRing` which calls `SymbolicRing._element_constructor_()`. I don't think I can easily hand `var` down to that machinery, recognize when a `piecewise` get converted, and call a member func then.

IOW, the `piecewise` on the r.h.s. of `f(x) = piecewise([((0,2), y^3)])` may be buried within an expression, and I find it not the "simplest solution" to handle its `var` via `.function()`. But that's from a first look at parts of the code I have never worked with, so I would appreciate any hint.



---

archive/issue_comments_222851.json:
```json
{
    "body": "<a id='comment:32'></a>\nNow that we have #17759 (for review) the tree can be walked conveniently and the variable set---or so I thought, but the `piecewise` object appears stateless: any call will reinitialize it...",
    "created_at": "2015-02-10T16:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222851",
    "user": "https://github.com/rwst"
}
```

<a id='comment:32'></a>
Now that we have #17759 (for review) the tree can be walked conveniently and the variable set---or so I thought, but the `piecewise` object appears stateless: any call will reinitialize it...



---

archive/issue_comments_222852.json:
```json
{
    "body": "**Changing commit** from \"[262b01e0de35a35d46fedda5e99255a26b9b36fa](https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa)\" to \"[80e8f85240fdb7904c1339d0438243abf1238f00](https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00)\".",
    "created_at": "2015-02-11T14:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[262b01e0de35a35d46fedda5e99255a26b9b36fa](https://github.com/sagemath/sagetrac-mirror/commit/262b01e0de35a35d46fedda5e99255a26b9b36fa)" to "[80e8f85240fdb7904c1339d0438243abf1238f00](https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00)".



---

archive/issue_comments_222853.json:
```json
{
    "body": "<a id='comment:33'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0ebe769d8e75506305a8db96f56cac89c02a311\">b0ebe76</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3781eec1432c7efe6531be4338fef51cc04eda6d\">3781eec</a></td><td><code>17759: convenience class symbolic ExpressionTreeWalker(Converter)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adb37986252f2da541dbe679255e6eec730c5840\">adb3798</a></td><td><code>Merge branch 'public/17759' of trac.sagemath.org:sage into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00\">80e8f85</a></td><td><code>14801: change piecewise var arg according to function var</code></td></tr></table>\n",
    "created_at": "2015-02-11T14:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0ebe769d8e75506305a8db96f56cac89c02a311">b0ebe76</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3781eec1432c7efe6531be4338fef51cc04eda6d">3781eec</a></td><td><code>17759: convenience class symbolic ExpressionTreeWalker(Converter)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adb37986252f2da541dbe679255e6eec730c5840">adb3798</a></td><td><code>Merge branch 'public/17759' of trac.sagemath.org:sage into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00">80e8f85</a></td><td><code>14801: change piecewise var arg according to function var</code></td></tr></table>




---

archive/issue_comments_222854.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759\".",
    "created_at": "2015-02-11T14:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222854",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759".



---

archive/issue_comments_222855.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A27):\n> The result should be `y^3` as in:\n> \n> ```\n> sage: f(x) = y^3\n> sage: f(1)\n> y^3\n> ```\n\nOK, this works now with **one** variable, dependent on #17759 (please review). I'm of the opinion this should work too:\n\n```\nsage: f(x,y) = piecewise([((0,2), y^3)])\nsage: f(1,1)\nTypeError: __call__() takes at most 5 arguments (6 given)\n```\nbut I have no idea atm what changes are needed for this. `piecewise([((0,2), y^3)], var=(x,y))` is certainly not supported now.",
    "created_at": "2015-02-11T14:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222855",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A27):
> The result should be `y^3` as in:
> 
> ```
> sage: f(x) = y^3
> sage: f(1)
> y^3
> ```

OK, this works now with **one** variable, dependent on #17759 (please review). I'm of the opinion this should work too:

```
sage: f(x,y) = piecewise([((0,2), y^3)])
sage: f(1,1)
TypeError: __call__() takes at most 5 arguments (6 given)
```
but I have no idea atm what changes are needed for this. `piecewise([((0,2), y^3)], var=(x,y))` is certainly not supported now.



---

archive/issue_comments_222856.json:
```json
{
    "body": "<a id='comment:35'></a>\nMaybe the class needs redesign to support this format: `piecewise([([(x,0,2),(y,0,2)], x*y^3)])` but I'd rather make this an enhancement.",
    "created_at": "2015-02-11T14:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222856",
    "user": "https://github.com/rwst"
}
```

<a id='comment:35'></a>
Maybe the class needs redesign to support this format: `piecewise([([(x,0,2),(y,0,2)], x*y^3)])` but I'd rather make this an enhancement.



---

archive/issue_comments_222857.json:
```json
{
    "body": "<a id='comment:36'></a>\nAnyway, if no rectangular 2D-pieces are supported in this ticket then also no 2D-strips are supported, i.e., this:\n\n```\nsage: f(x,y) = piecewise([((0,2), y^3)], var=x)\nsage: f(1,1)\nTypeError: __call__() takes at most 5 arguments (6 given)\n```\nmaybe should raise an error already in the first command. Having specified what this ticket can do there remain these fails:\n\n```\nsage -t src/sage/functions/piecewise.py  # fast_callable, .extension()\nsage -t src/doc/en/constructions/plotting.rst  # TypeError\nsage -t src/doc/en/constructions/calculus.rst  # missing .critical_points(), .convolution(), trapezoid(), riemann_sum_integral_approximation(), .integral(), laplace(), fourier_series_cosine_coefficient(), TypeError\nsage -t src/sage/calculus/wester.py  # missing .integral()\n```\nEDIT: added problem issues",
    "created_at": "2015-02-14T14:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222857",
    "user": "https://github.com/rwst"
}
```

<a id='comment:36'></a>
Anyway, if no rectangular 2D-pieces are supported in this ticket then also no 2D-strips are supported, i.e., this:

```
sage: f(x,y) = piecewise([((0,2), y^3)], var=x)
sage: f(1,1)
TypeError: __call__() takes at most 5 arguments (6 given)
```
maybe should raise an error already in the first command. Having specified what this ticket can do there remain these fails:

```
sage -t src/sage/functions/piecewise.py  # fast_callable, .extension()
sage -t src/doc/en/constructions/plotting.rst  # TypeError
sage -t src/doc/en/constructions/calculus.rst  # missing .critical_points(), .convolution(), trapezoid(), riemann_sum_integral_approximation(), .integral(), laplace(), fourier_series_cosine_coefficient(), TypeError
sage -t src/sage/calculus/wester.py  # missing .integral()
```
EDIT: added problem issues



---

archive/issue_comments_222858.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799\".",
    "created_at": "2015-02-18T08:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222858",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799".



---

archive/issue_comments_222859.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5631c87b715ca3c154bbed8363c11caf40a379ae\">5631c87</a></td><td><code>14801: critical points, convolution, end points</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e9eb43c64c93ebca6109604a86edfe2fa235412\">1e9eb43</a></td><td><code>14801: convolution</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c7876ec23b36786c428da8062b7f8c80d97350e\">3c7876e</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64547f138dae47c332849ed700e0beb4c61b2c17\">64547f1</a></td><td><code>14801: old deprecation, doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae65dc49d6b4e1b9d51b8792ae264e26113b0085\">ae65dc4</a></td><td><code>14801: piecewise-old, convolution</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f146662c0cbd1bd6626740b446c5ff04cf706ecc\">f146662</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/566688bc3e828d84cd258467442d0604c3bae3ce\">566688b</a></td><td><code>17799: refactor real_set.py:RealInterval</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0708a1aa82dee84d74234b0e21feed5ff23381ab\">0708a1a</a></td><td><code>Merge branch 't/17799/refactor_real_set_realinterval' into t/14801/public/piecewise</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6d48b7e68f6061f244c42b903ac3539f83f06e6\">a6d48b7</a></td><td><code>14801: merge 17799</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff\">3f5e8be</a></td><td><code>14801: convolution</code></td></tr></table>\n",
    "created_at": "2015-02-19T17:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5631c87b715ca3c154bbed8363c11caf40a379ae">5631c87</a></td><td><code>14801: critical points, convolution, end points</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e9eb43c64c93ebca6109604a86edfe2fa235412">1e9eb43</a></td><td><code>14801: convolution</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c7876ec23b36786c428da8062b7f8c80d97350e">3c7876e</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64547f138dae47c332849ed700e0beb4c61b2c17">64547f1</a></td><td><code>14801: old deprecation, doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae65dc49d6b4e1b9d51b8792ae264e26113b0085">ae65dc4</a></td><td><code>14801: piecewise-old, convolution</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f146662c0cbd1bd6626740b446c5ff04cf706ecc">f146662</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/566688bc3e828d84cd258467442d0604c3bae3ce">566688b</a></td><td><code>17799: refactor real_set.py:RealInterval</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0708a1aa82dee84d74234b0e21feed5ff23381ab">0708a1a</a></td><td><code>Merge branch 't/17799/refactor_real_set_realinterval' into t/14801/public/piecewise</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6d48b7e68f6061f244c42b903ac3539f83f06e6">a6d48b7</a></td><td><code>14801: merge 17799</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff">3f5e8be</a></td><td><code>14801: convolution</code></td></tr></table>




---

archive/issue_comments_222860.json:
```json
{
    "body": "**Changing commit** from \"[80e8f85240fdb7904c1339d0438243abf1238f00](https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00)\" to \"[3f5e8be61616c496aa9e9f41401a93a1cde0f9ff](https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff)\".",
    "created_at": "2015-02-19T17:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[80e8f85240fdb7904c1339d0438243abf1238f00](https://github.com/sagemath/sagetrac-mirror/commit/80e8f85240fdb7904c1339d0438243abf1238f00)" to "[3f5e8be61616c496aa9e9f41401a93a1cde0f9ff](https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff)".



---

archive/issue_comments_222861.json:
```json
{
    "body": "<a id='comment:39'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104\">254e047</a></td><td><code>14801: trapezoid; fixes</code></td></tr></table>\n",
    "created_at": "2015-02-21T14:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104">254e047</a></td><td><code>14801: trapezoid; fixes</code></td></tr></table>




---

archive/issue_comments_222862.json:
```json
{
    "body": "**Changing commit** from \"[3f5e8be61616c496aa9e9f41401a93a1cde0f9ff](https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff)\" to \"[254e047fc4056b06e2d2e4fe1296dad839549104](https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104)\".",
    "created_at": "2015-02-21T14:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3f5e8be61616c496aa9e9f41401a93a1cde0f9ff](https://github.com/sagemath/sagetrac-mirror/commit/3f5e8be61616c496aa9e9f41401a93a1cde0f9ff)" to "[254e047fc4056b06e2d2e4fe1296dad839549104](https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104)".



---

archive/issue_comments_222863.json:
```json
{
    "body": "<a id='comment:40'></a>\nThis leaves the ordering stuff, the plot warnings, and some Fourier code (in `calculus.rst`).",
    "created_at": "2015-02-21T14:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222863",
    "user": "https://github.com/rwst"
}
```

<a id='comment:40'></a>
This leaves the ordering stuff, the plot warnings, and some Fourier code (in `calculus.rst`).



---

archive/issue_comments_222864.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799, #17815\".",
    "created_at": "2015-02-21T14:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222864",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799, #17815".



---

archive/issue_events_049075.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-21T14:48:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49075"
}
```



---

archive/issue_events_049076.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-21T14:48:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49076"
}
```



---

archive/issue_comments_222865.json:
```json
{
    "body": "**Changing assignee** from @burcin to @rwst.",
    "created_at": "2015-02-21T14:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222865",
    "user": "https://github.com/rwst"
}
```

**Changing assignee** from @burcin to @rwst.



---

archive/issue_comments_222866.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799, #17815\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815, #12967\".",
    "created_at": "2015-02-22T07:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222866",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17799, #17815" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815, #12967".



---

archive/issue_comments_222867.json:
```json
{
    "body": "**Changing branch** from \"[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)\" to \"[public/piecewise-2](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-2)\".",
    "created_at": "2015-03-22T09:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222867",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[public/piecewise](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise)" to "[public/piecewise-2](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-2)".



---

archive/issue_comments_222868.json:
```json
{
    "body": "<a id='comment:44'></a>\nThe remaining fails happen because:\n* cannot use pi/2 as interval endpoint because of symbolic `cmp` bug (#16397)\n\n```\nsage: cmp(pi/2,SR(0))\n-1\nsage: cmp(pi/2,0)\n1\n```\n* unsuppressed doctest warnings (#17815)\n* missing `piecewise.laplace`\n* missing `piecewise.fourier_series_sine_coefficient`\n* missing `piecewise.fourier_series_cosine_coefficient`\n* missing `piecewise.fourier_series_partial_sum`\nThe last four are due to a single example in `doc/en/constructions/calculus.rst`.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eb6c0fb2c381a09e4a1b717a10d94bb7fa23a24\">4eb6c0f</a></td><td><code>14801: Piecewise functions done right - part 1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d733c7ee1b243e8f0c2f17a9cfcd08844a111c60\">d733c7e</a></td><td><code>14801: Piecewise functions done right - part 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93755106787a8a6b7626a9c01a7d0aba51c40447\">9375510</a></td><td><code>Merge branch 'develop' into t/17759/public/17759</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/16aa81d5f5fe7b38db0ce7372e198b6f036ee724\">16aa81d</a></td><td><code>17759: handle hold=True and hypergeometric</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc19bd08911e1e00c685fdede9292eaad30ebbc6\">cc19bd0</a></td><td><code>Merge branch 'public/17759' of trac.sagemath.org:sage into tmp5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188\">1a0a27f</a></td><td><code>14801: fix doctest</code></td></tr></table>\n",
    "created_at": "2015-03-22T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222868",
    "user": "https://github.com/rwst"
}
```

<a id='comment:44'></a>
The remaining fails happen because:
* cannot use pi/2 as interval endpoint because of symbolic `cmp` bug (#16397)

```
sage: cmp(pi/2,SR(0))
-1
sage: cmp(pi/2,0)
1
```
* unsuppressed doctest warnings (#17815)
* missing `piecewise.laplace`
* missing `piecewise.fourier_series_sine_coefficient`
* missing `piecewise.fourier_series_cosine_coefficient`
* missing `piecewise.fourier_series_partial_sum`
The last four are due to a single example in `doc/en/constructions/calculus.rst`.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eb6c0fb2c381a09e4a1b717a10d94bb7fa23a24">4eb6c0f</a></td><td><code>14801: Piecewise functions done right - part 1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d733c7ee1b243e8f0c2f17a9cfcd08844a111c60">d733c7e</a></td><td><code>14801: Piecewise functions done right - part 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93755106787a8a6b7626a9c01a7d0aba51c40447">9375510</a></td><td><code>Merge branch 'develop' into t/17759/public/17759</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/16aa81d5f5fe7b38db0ce7372e198b6f036ee724">16aa81d</a></td><td><code>17759: handle hold=True and hypergeometric</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc19bd08911e1e00c685fdede9292eaad30ebbc6">cc19bd0</a></td><td><code>Merge branch 'public/17759' of trac.sagemath.org:sage into tmp5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188">1a0a27f</a></td><td><code>14801: fix doctest</code></td></tr></table>




---

archive/issue_comments_222869.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815, #12967\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815\".",
    "created_at": "2015-03-22T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222869",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815, #12967" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815".



---

archive/issue_comments_222870.json:
```json
{
    "body": "**Changing commit** from \"[254e047fc4056b06e2d2e4fe1296dad839549104](https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104)\" to \"[1a0a27fc00100f78ee507ec2a73a6726bf063188](https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188)\".",
    "created_at": "2015-03-22T09:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222870",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[254e047fc4056b06e2d2e4fe1296dad839549104](https://github.com/sagemath/sagetrac-mirror/commit/254e047fc4056b06e2d2e4fe1296dad839549104)" to "[1a0a27fc00100f78ee507ec2a73a6726bf063188](https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188)".



---

archive/issue_comments_222871.json:
```json
{
    "body": "**Changing commit** from \"[1a0a27fc00100f78ee507ec2a73a6726bf063188](https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188)\" to \"[c84b28a8f3f4776dd9e994e767cddf1fc4641541](https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541)\".",
    "created_at": "2015-03-22T14:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1a0a27fc00100f78ee507ec2a73a6726bf063188](https://github.com/sagemath/sagetrac-mirror/commit/1a0a27fc00100f78ee507ec2a73a6726bf063188)" to "[c84b28a8f3f4776dd9e994e767cddf1fc4641541](https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541)".



---

archive/issue_comments_222872.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541\">c84b28a</a></td><td><code>14801: lower verbosity in a doctest that became noisy</code></td></tr></table>\n",
    "created_at": "2015-03-22T14:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541">c84b28a</a></td><td><code>14801: lower verbosity in a doctest that became noisy</code></td></tr></table>




---

archive/issue_comments_222873.json:
```json
{
    "body": "<a id='comment:46'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541\">c84b28a</a></td><td><code>14801: lower verbosity in a doctest that became noisy</code></td></tr></table>\n",
    "created_at": "2015-03-22T14:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222873",
    "user": "https://github.com/rwst"
}
```

<a id='comment:46'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541">c84b28a</a></td><td><code>14801: lower verbosity in a doctest that became noisy</code></td></tr></table>




---

archive/issue_comments_222874.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815\" to \"#14800, #14780, #9556, #13125, #14802, #16397, #17759\".",
    "created_at": "2015-03-22T14:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222874",
    "user": "https://github.com/rwst"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759, #17815" to "#14800, #14780, #9556, #13125, #14802, #16397, #17759".



---

archive/issue_comments_222875.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Rewrite piecewise functions as symbolic functions\n+Rewrite piecewise functions as symbolic functions.\n+\n+For a (late) discussion about interface issues see https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM\n``````\n",
    "created_at": "2016-03-05T06:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222875",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Rewrite piecewise functions as symbolic functions
+Rewrite piecewise functions as symbolic functions.
+
+For a (late) discussion about interface issues see https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM
``````




---

archive/issue_comments_222876.json:
```json
{
    "body": "<a id='comment:50'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06ea5a9957bcfd03fa1476f7651b2d9400e9e36b\">06ea5a9</a></td><td><code>fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c78d15119bf930af733b831bc83b54c40c56f800\">c78d151</a></td><td><code>add Constant.__lt__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1381a89d5e960afb76815f85e771f71f99a3d1c1\">1381a89</a></td><td><code>16397: add tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/585ceb894a09284361594af5ee3f891c43052048\">585ceb8</a></td><td><code>Merge branch 'develop' into symbcmp</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60370a98cc7b77a1c0884066dcc57d193dcf9a6c\">60370a9</a></td><td><code>16397: fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f78854cf315994d26d33b0bcc93c7e64bb0bd8a8\">f78854c</a></td><td><code>fix depecrated import of python.pxi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eab9ec2ce8ce805441543ffcbebcdf5fb527a2cb\">eab9ec2</a></td><td><code>16397: fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24450f8d49fc69400e0ef59fea307cd2001bd63d\">24450f8</a></td><td><code>Merge branch 'public/16397-1' of git://trac.sagemath.org/sage into tmp04</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07f12cdfd14f3a7af5445aab7419c0ddaea1074d\">07f12cd</a></td><td><code>16397: restore transitivity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6\">64bbe53</a></td><td><code>Merge branch 'public/piecewise-2' of git://trac.sagemath.org/sage into piecewise</code></td></tr></table>\n",
    "created_at": "2016-03-19T09:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06ea5a9957bcfd03fa1476f7651b2d9400e9e36b">06ea5a9</a></td><td><code>fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c78d15119bf930af733b831bc83b54c40c56f800">c78d151</a></td><td><code>add Constant.__lt__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1381a89d5e960afb76815f85e771f71f99a3d1c1">1381a89</a></td><td><code>16397: add tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/585ceb894a09284361594af5ee3f891c43052048">585ceb8</a></td><td><code>Merge branch 'develop' into symbcmp</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60370a98cc7b77a1c0884066dcc57d193dcf9a6c">60370a9</a></td><td><code>16397: fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f78854cf315994d26d33b0bcc93c7e64bb0bd8a8">f78854c</a></td><td><code>fix depecrated import of python.pxi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eab9ec2ce8ce805441543ffcbebcdf5fb527a2cb">eab9ec2</a></td><td><code>16397: fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24450f8d49fc69400e0ef59fea307cd2001bd63d">24450f8</a></td><td><code>Merge branch 'public/16397-1' of git://trac.sagemath.org/sage into tmp04</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07f12cdfd14f3a7af5445aab7419c0ddaea1074d">07f12cd</a></td><td><code>16397: restore transitivity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6">64bbe53</a></td><td><code>Merge branch 'public/piecewise-2' of git://trac.sagemath.org/sage into piecewise</code></td></tr></table>




---

archive/issue_comments_222877.json:
```json
{
    "body": "**Changing commit** from \"[c84b28a8f3f4776dd9e994e767cddf1fc4641541](https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541)\" to \"[64bbe5393ffc24ae3551644e5171692e7f7a2dd6](https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6)\".",
    "created_at": "2016-03-19T09:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c84b28a8f3f4776dd9e994e767cddf1fc4641541](https://github.com/sagemath/sagetrac-mirror/commit/c84b28a8f3f4776dd9e994e767cddf1fc4641541)" to "[64bbe5393ffc24ae3551644e5171692e7f7a2dd6](https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6)".



---

archive/issue_comments_222878.json:
```json
{
    "body": "<a id='comment:51'></a>\nIndeed, as the discussion in https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM foresaw, lambdas will be a problem with this, as they cannot be coerced to SR. \n\n```\nsage: f1 = lambda x: -1; f2 = lambda x: 2                   \nsage: piecewise([((0,pi/2),f1), ((pi/2,pi),f2)])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n```\nThere is one doctest in src/doc/en/constructions/calculus.rst that requires it.\n\nBut it doesn't even work with `NewSymbolicFunction`:\n\n```\nsage: function('newf2')(x)                      \nnewf2(x)\nsage: piecewise([((0,pi/2),x), ((pi/2,pi),f2)])\n```\nfor which there seems a solution in #17701.",
    "created_at": "2016-03-19T15:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222878",
    "user": "https://github.com/rwst"
}
```

<a id='comment:51'></a>
Indeed, as the discussion in https://groups.google.com/forum/?hl=en#!topic/sage-devel/dgwUMsdiHfM foresaw, lambdas will be a problem with this, as they cannot be coerced to SR. 

```
sage: f1 = lambda x: -1; f2 = lambda x: 2                   
sage: piecewise([((0,pi/2),f1), ((pi/2,pi),f2)])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
```
There is one doctest in src/doc/en/constructions/calculus.rst that requires it.

But it doesn't even work with `NewSymbolicFunction`:

```
sage: function('newf2')(x)                      
newf2(x)
sage: piecewise([((0,pi/2),x), ((pi/2,pi),f2)])
```
for which there seems a solution in #17701.



---

archive/issue_comments_222879.json:
```json
{
    "body": "<a id='comment:52'></a>\nAny ideas about how to resolve this?",
    "created_at": "2016-03-24T08:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222879",
    "user": "https://github.com/rwst"
}
```

<a id='comment:52'></a>
Any ideas about how to resolve this?



---

archive/issue_comments_222880.json:
```json
{
    "body": "<a id='comment:53'></a>\nAs #16397 is accepted let's summarize the current situation. There are two doctests failing with just a different number of graphics objects, easily fixed, which leaves five fails in `doc/en/constructions/calculus.rst` due to:\n* missing `piecewise.laplace`\n* missing `piecewise.fourier_series_sine_coefficient`\n* missing `piecewise.fourier_series_cosine_coefficient`\n* missing `piecewise.fourier_series_partial_sum`\n* lambdas not coercible into SR (line 381)\n\nAs to the last item I think the doctest could be changed to no longer use a lambda. Users depending on it could use `piecewise_old`. We could make this ticket dependent on #17701 to at least have anonymous symbolic functions working as in `function('newf2')(x)`.\n\nIf people insist on lambdas and def'ed Python functions as arguments to `piecewise` it might be an idea to create a temporary anonymous function (check for `types.FunctionType`) but this depends on #17701 if the idea can be made to work.",
    "created_at": "2016-04-16T07:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222880",
    "user": "https://github.com/rwst"
}
```

<a id='comment:53'></a>
As #16397 is accepted let's summarize the current situation. There are two doctests failing with just a different number of graphics objects, easily fixed, which leaves five fails in `doc/en/constructions/calculus.rst` due to:
* missing `piecewise.laplace`
* missing `piecewise.fourier_series_sine_coefficient`
* missing `piecewise.fourier_series_cosine_coefficient`
* missing `piecewise.fourier_series_partial_sum`
* lambdas not coercible into SR (line 381)

As to the last item I think the doctest could be changed to no longer use a lambda. Users depending on it could use `piecewise_old`. We could make this ticket dependent on #17701 to at least have anonymous symbolic functions working as in `function('newf2')(x)`.

If people insist on lambdas and def'ed Python functions as arguments to `piecewise` it might be an idea to create a temporary anonymous function (check for `types.FunctionType`) but this depends on #17701 if the idea can be made to work.



---

archive/issue_comments_222881.json:
```json
{
    "body": "<a id='comment:54'></a>\nThe Laplace transform code as well depends on function arguments being coercible/convertible to SR: `result =  sum([(SR(f)*exp(-s*x)).integral(x,a,b) for (a,b),f in self.list()])`. I don't think there is an easy solution and I'm wondering why the new `piecewise` should come up with something that wasn't resolved with other parts of Sage, like `diff`, `desolve`, `integral` etc.",
    "created_at": "2016-04-16T07:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222881",
    "user": "https://github.com/rwst"
}
```

<a id='comment:54'></a>
The Laplace transform code as well depends on function arguments being coercible/convertible to SR: `result =  sum([(SR(f)*exp(-s*x)).integral(x,a,b) for (a,b),f in self.list()])`. I don't think there is an easy solution and I'm wondering why the new `piecewise` should come up with something that wasn't resolved with other parts of Sage, like `diff`, `desolve`, `integral` etc.



---

archive/issue_comments_222882.json:
```json
{
    "body": "<a id='comment:55'></a>\nThe solution is to change the doctest to:\n\n```\n    sage: f1 = lambda x: -1\n    sage: f2 = lambda x: 2\n    sage: f = piecewise([((0,pi/2),f1(x)), ((pi/2,pi),f2(x))])\n```\nOr, if function objects are used to apply the call inside `piecewise`.",
    "created_at": "2016-04-16T07:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222882",
    "user": "https://github.com/rwst"
}
```

<a id='comment:55'></a>
The solution is to change the doctest to:

```
    sage: f1 = lambda x: -1
    sage: f2 = lambda x: 2
    sage: f = piecewise([((0,pi/2),f1(x)), ((pi/2,pi),f2(x))])
```
Or, if function objects are used to apply the call inside `piecewise`.



---

archive/issue_comments_222883.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0b44e406427dee3d0e655d4ebebebff8133f7f2\">e0b44e4</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c\">b89ee3e</a></td><td><code>14801: last part of additions and fixes</code></td></tr></table>\n",
    "created_at": "2016-04-16T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0b44e406427dee3d0e655d4ebebebff8133f7f2">e0b44e4</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c">b89ee3e</a></td><td><code>14801: last part of additions and fixes</code></td></tr></table>




---

archive/issue_comments_222884.json:
```json
{
    "body": "**Changing commit** from \"[64bbe5393ffc24ae3551644e5171692e7f7a2dd6](https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6)\" to \"[b89ee3e56ee49d98a07a99d3b8741d6a60ba405c](https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c)\".",
    "created_at": "2016-04-16T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[64bbe5393ffc24ae3551644e5171692e7f7a2dd6](https://github.com/sagemath/sagetrac-mirror/commit/64bbe5393ffc24ae3551644e5171692e7f7a2dd6)" to "[b89ee3e56ee49d98a07a99d3b8741d6a60ba405c](https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c)".



---

archive/issue_comments_222885.json:
```json
{
    "body": "<a id='comment:57'></a>\nThat should be it.",
    "created_at": "2016-04-16T14:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222885",
    "user": "https://github.com/rwst"
}
```

<a id='comment:57'></a>
That should be it.



---

archive/issue_events_049077.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-04-16T14:36:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49077"
}
```



---

archive/issue_events_049078.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-04-16T14:36:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49078"
}
```



---

archive/issue_comments_222886.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2016-04-16T14:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222886",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_222887.json:
```json
{
    "body": "**Changing commit** from \"[b89ee3e56ee49d98a07a99d3b8741d6a60ba405c](https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c)\" to \"[506248ad59a4e933f269c1f07865066a97e87a03](https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03)\".",
    "created_at": "2016-04-22T06:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b89ee3e56ee49d98a07a99d3b8741d6a60ba405c](https://github.com/sagemath/sagetrac-mirror/commit/b89ee3e56ee49d98a07a99d3b8741d6a60ba405c)" to "[506248ad59a4e933f269c1f07865066a97e87a03](https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03)".



---

archive/issue_comments_222888.json:
```json
{
    "body": "<a id='comment:58'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fab81a4e19fdaf8e7268ab05f5e74c6956079f9a\">fab81a4</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03\">506248a</a></td><td><code>doctest fixes</code></td></tr></table>\n",
    "created_at": "2016-04-22T06:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fab81a4e19fdaf8e7268ab05f5e74c6956079f9a">fab81a4</a></td><td><code>Merge branch 'develop' into t/14801/public/piecewise-2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03">506248a</a></td><td><code>doctest fixes</code></td></tr></table>




---

archive/issue_comments_222889.json:
```json
{
    "body": "<a id='comment:59'></a>\nSee also #8603 regarding the most recent additions - thanks for doing them.",
    "created_at": "2016-04-22T14:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222889",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:59'></a>
See also #8603 regarding the most recent additions - thanks for doing them.



---

archive/issue_comments_222890.json:
```json
{
    "body": "**Changing commit** from \"[506248ad59a4e933f269c1f07865066a97e87a03](https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03)\" to \"[966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)\".",
    "created_at": "2016-04-22T15:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[506248ad59a4e933f269c1f07865066a97e87a03](https://github.com/sagemath/sagetrac-mirror/commit/506248ad59a4e933f269c1f07865066a97e87a03)" to "[966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)".



---

archive/issue_comments_222891.json:
```json
{
    "body": "<a id='comment:60'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7c8bb9cc3ca09fbf165378c3c56e4eb62f6edba\">a7c8bb9</a></td><td><code>Use items instead of iteritems (py3)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67ccb8a7f4b3aa94fe8c07a6bda97450c3cab652\">67ccb8a</a></td><td><code>Complete piecewise.py coverage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1\">966859c</a></td><td><code>Fix raise statement (py3)</code></td></tr></table>\n",
    "created_at": "2016-04-22T15:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7c8bb9cc3ca09fbf165378c3c56e4eb62f6edba">a7c8bb9</a></td><td><code>Use items instead of iteritems (py3)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67ccb8a7f4b3aa94fe8c07a6bda97450c3cab652">67ccb8a</a></td><td><code>Complete piecewise.py coverage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1">966859c</a></td><td><code>Fix raise statement (py3)</code></td></tr></table>




---

archive/issue_comments_222892.json:
```json
{
    "body": "<a id='comment:61'></a>\nThanks for working on it... I'm of course happy with your changes.",
    "created_at": "2016-04-22T15:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222892",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'></a>
Thanks for working on it... I'm of course happy with your changes.



---

archive/issue_comments_222893.json:
```json
{
    "body": "**Reviewer:** Volker Braun, Ralf Stephan",
    "created_at": "2016-04-22T15:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222893",
    "user": "https://github.com/rwst"
}
```

**Reviewer:** Volker Braun, Ralf Stephan



---

archive/issue_comments_222894.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2016-04-22T15:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222894",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_222895.json:
```json
{
    "body": "<a id='comment:62'></a>\nAnd I'm so with your part of this.",
    "created_at": "2016-04-22T15:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222895",
    "user": "https://github.com/rwst"
}
```

<a id='comment:62'></a>
And I'm so with your part of this.



---

archive/issue_comments_222896.json:
```json
{
    "body": "<a id='comment:63'></a>\nRalf and Volker have done such great work on this and I really am very much looking forward to this being put into Sage. Also, I don't see any examples which used to work but don't work with the new version you've made.\n\nA comment on how I tested this (since I don't know git), I downloaded your piecewise.py file from git. Added it to a new version of [SageMath](SageMath) (since \"sage -clone\" no longer works) and ran \"sage -b\". Then I started sage and just ran then examples in the docstring. I tweeked several just to see how minor changes affected things. They all went perfectly.",
    "created_at": "2016-04-22T20:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222896",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:63'></a>
Ralf and Volker have done such great work on this and I really am very much looking forward to this being put into Sage. Also, I don't see any examples which used to work but don't work with the new version you've made.

A comment on how I tested this (since I don't know git), I downloaded your piecewise.py file from git. Added it to a new version of [SageMath](SageMath) (since "sage -clone" no longer works) and ran "sage -b". Then I started sage and just ran then examples in the docstring. I tweeked several just to see how minor changes affected things. They all went perfectly.



---

archive/issue_comments_222897.json:
```json
{
    "body": "**Changing dependencies** from \"#14800, #14780, #9556, #13125, #14802, #16397, #17759\" to \"#14800, #14780, #13125, #14802, #16397, #17759\".",
    "created_at": "2016-04-22T22:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222897",
    "user": "https://github.com/vbraun"
}
```

**Changing dependencies** from "#14800, #14780, #9556, #13125, #14802, #16397, #17759" to "#14800, #14780, #13125, #14802, #16397, #17759".



---

archive/issue_events_049079.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-23T08:45:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14801#event-49079"
}
```



---

archive/issue_comments_222898.json:
```json
{
    "body": "**Changing branch** from \"[public/piecewise-2](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-2)\" to \"[966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)\".",
    "created_at": "2016-04-23T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14801#issuecomment-222898",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/piecewise-2](https://github.com/sagemath/sagetrac-mirror/tree/public/piecewise-2)" to "[966859c030256f78b656d9a7cb514364518fecc1](https://github.com/sagemath/sagetrac-mirror/commit/966859c030256f78b656d9a7cb514364518fecc1)".
