# Issue 14981: Descent algebra

archive/issues_014744.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat @anneschilling\n\nKeywords: Solomon's descent algebra\n\nImplement Solomon's descent algebra (for type A<sub>n-1</sub>) with the bases D (descents), B (subsets), and I (idempotents) following Garsia and Reutenauer.\n\n---\n\nApply: [attachment:trac_14981-descent_algebra-ts.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/14981\n\n",
    "closed_at": "2013-08-28T06:53:24Z",
    "created_at": "2013-07-30T06:36:05Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Descent algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14981",
    "user": "https://github.com/tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat @anneschilling

Keywords: Solomon's descent algebra

Implement Solomon's descent algebra (for type A<sub>n-1</sub>) with the bases D (descents), B (subsets), and I (idempotents) following Garsia and Reutenauer.

---

Apply: [attachment:trac_14981-descent_algebra-ts.patch]

Issue created by migration from https://trac.sagemath.org/ticket/14981





---

archive/issue_comments_187640.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-30T06:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187640",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187641.json:
```json
{
    "body": "Could you please move the change to all.py and algebra.rst somewhere into a less busy location? I don't seem to have the diagram_algebras and vector_partition context.",
    "created_at": "2013-08-03T14:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187641",
    "user": "https://github.com/darijgr"
}
```

Could you please move the change to all.py and algebra.rst somewhere into a less busy location? I don't seem to have the diagram_algebras and vector_partition context.



---

archive/issue_comments_187642.json:
```json
{
    "body": "Attachment [trac_14981-descent_review_part_1-dg.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-descent_review_part_1-dg.patch) by @darijgr created at 2013-08-03 17:04:10",
    "created_at": "2013-08-03T17:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187642",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_14981-descent_review_part_1-dg.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-descent_review_part_1-dg.patch) by @darijgr created at 2013-08-03 17:04:10



---

archive/issue_comments_187643.json:
```json
{
    "body": "I've attached a partial review patch [attachment:trac_14981-descent_review_part_1-dg.patch]. Please look it over. I've removed `one_basis` from the universal methods and added it to the D and B basis, since the version you had would give wrong answers in the D case. I believe that in the I basis, the 1 is not a basis element (but I might be wrong here).\n\nI'll eventually return and finish the review, but first I'd prefer to see the following issue resolved:\n\nIt's way too tricky to call an element of the D basis. The usual trick people are doing works for subsets of size >= 2:\n\n```\nsage: D = DescentAlgebra(QQ, 4).D()\nsage: D[1,3]\nD{1, 3}\n```\nbut this is widely agreed to be syntactic sugar. One-element sets work only if a comma is added at the end (`D[4,]` works, but `D[4]` does not), and the empty set doesn't work at all. Moreover, this syntax is unchecked (`D[666,444]` works just as well) and falsely suggests that it takes compositions where it really takes subsets.\n\nNeither of `D({1,3})`, `D(set([1,3]))`, `D(Set([1,3]))` works. The only thing that reliably works for all subsets is this:\n\n```\nsage: D.basis()[(1,3)]\nD{1, 3}\nsage: D.basis()[(1,)] \nD{1}\nsage: D.basis()[()]  \nD{}\n```\n\nBut I don't think such a detour should be necessary.\n\nEventually there should be conversions into the symmetric group algebra and into and from NSym. The latter should be easy to do; the former is probably best done after dealing with the #14885 mess.",
    "created_at": "2013-08-03T17:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187643",
    "user": "https://github.com/darijgr"
}
```

I've attached a partial review patch [attachment:trac_14981-descent_review_part_1-dg.patch]. Please look it over. I've removed `one_basis` from the universal methods and added it to the D and B basis, since the version you had would give wrong answers in the D case. I believe that in the I basis, the 1 is not a basis element (but I might be wrong here).

I'll eventually return and finish the review, but first I'd prefer to see the following issue resolved:

It's way too tricky to call an element of the D basis. The usual trick people are doing works for subsets of size >= 2:

```
sage: D = DescentAlgebra(QQ, 4).D()
sage: D[1,3]
D{1, 3}
```
but this is widely agreed to be syntactic sugar. One-element sets work only if a comma is added at the end (`D[4,]` works, but `D[4]` does not), and the empty set doesn't work at all. Moreover, this syntax is unchecked (`D[666,444]` works just as well) and falsely suggests that it takes compositions where it really takes subsets.

Neither of `D({1,3})`, `D(set([1,3]))`, `D(Set([1,3]))` works. The only thing that reliably works for all subsets is this:

```
sage: D.basis()[(1,3)]
D{1, 3}
sage: D.basis()[(1,)] 
D{1}
sage: D.basis()[()]  
D{}
```

But I don't think such a detour should be necessary.

Eventually there should be conversions into the symmetric group algebra and into and from NSym. The latter should be easy to do; the former is probably best done after dealing with the #14885 mess.



---

archive/issue_comments_187644.json:
```json
{
    "body": "Hey Darij,\n\nHere's a new version of the patch with your first review patch folded in. I've fixed the above issue with some input checks and added coercions into NSym and the sym. gp. algebra (which should be okay since it's getting permutations via descents). In the I basis, it is also indexed by compositions, so I<sub>[n]</sub> is a basis element and is 1:\n\n```\nsage: I = DescentAlgebra(QQ, 5).I()\nsage: for b in I.basis():\n....:     if I.one() * b != b * I.one():\n....:         print b\n....:\nsage: I.one() * I.one() == I.one()\nTrue\n```\nThanks for also filling out the references.\n\nReady for continued review.\n\nThanks,\n\nTravis\n\nPS - Be careful with hyphens when copy/pasting since often times they aren't ascii.\n\nFor patchbot:\n\nApply: trac_14981-descent_algebra-ts.patch",
    "created_at": "2013-08-08T19:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187644",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

Here's a new version of the patch with your first review patch folded in. I've fixed the above issue with some input checks and added coercions into NSym and the sym. gp. algebra (which should be okay since it's getting permutations via descents). In the I basis, it is also indexed by compositions, so I<sub>[n]</sub> is a basis element and is 1:

```
sage: I = DescentAlgebra(QQ, 5).I()
sage: for b in I.basis():
....:     if I.one() * b != b * I.one():
....:         print b
....:
sage: I.one() * I.one() == I.one()
True
```
Thanks for also filling out the references.

Ready for continued review.

Thanks,

Travis

PS - Be careful with hyphens when copy/pasting since often times they aren't ascii.

For patchbot:

Apply: trac_14981-descent_algebra-ts.patch



---

archive/issue_comments_187645.json:
```json
{
    "body": "Hi Travis,\n\nthanks for looking into this (and spotting the hyphens).\n\nI still think the unity does not belong to the I basis, and your tests are wrong because your B-to-I and I-to-B transform methods handle the case of [n] in a special (and incorrect) way. Theorem 3.4 of the Garsia-Reutenauer paper, applied to r = [n], says that B_{[n]} is a linear combination (with nonzero coefficients) of all the I_q for q \\leq_{\\pi} [n] (and that means for all compositions q of n). In particular, B_{[n]} (which is the 1) is not a single basis element unless n \\leq 1.\n\nCare to add an empty-set check in the doctest of `__getitem__`? I think it would be better to explain this nonstandard syntax (`D[3,4]` instead of `D([3,4])`) in a more visible docstring, too.\n\nI hate to say this but your patch is still getting rejected due to the all.py and algebra.rst insertion points. IMHO this is a weakness of hg (or the way we are using it), since it shouldn't actually matter where things are inserted in these two files; but for now, in order maybe you could move your insertions into some place where there has been no conflicting patch activity lately? Sorry for this stupid issue.\n\nBest regards,\n\nDarij",
    "created_at": "2013-08-08T20:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187645",
    "user": "https://github.com/darijgr"
}
```

Hi Travis,

thanks for looking into this (and spotting the hyphens).

I still think the unity does not belong to the I basis, and your tests are wrong because your B-to-I and I-to-B transform methods handle the case of [n] in a special (and incorrect) way. Theorem 3.4 of the Garsia-Reutenauer paper, applied to r = [n], says that B_{[n]} is a linear combination (with nonzero coefficients) of all the I_q for q \leq_{\pi} [n] (and that means for all compositions q of n). In particular, B_{[n]} (which is the 1) is not a single basis element unless n \leq 1.

Care to add an empty-set check in the doctest of `__getitem__`? I think it would be better to explain this nonstandard syntax (`D[3,4]` instead of `D([3,4])`) in a more visible docstring, too.

I hate to say this but your patch is still getting rejected due to the all.py and algebra.rst insertion points. IMHO this is a weakness of hg (or the way we are using it), since it shouldn't actually matter where things are inserted in these two files; but for now, in order maybe you could move your insertions into some place where there has been no conflicting patch activity lately? Sorry for this stupid issue.

Best regards,

Darij



---

archive/issue_comments_187646.json:
```json
{
    "body": "Hey Darij,\n\nAck, you're right about the 1, that's a big bug on my part. Fixed now. I also put a docstring at the class level about the `__getitem__` (but this syntax is also used in symmetric functions) and included the emptyset test. However there's nothing I can do about the rejects because the `algebra.rst` should be in alphabetical order and #14234 is already positively reviewed, but that should definitely be a dependency. (I agree with you though on this shortcomming of Mercurial as Git is more robust from my experience, and the switch should happen [relatively] soon.)\n\nThanks,\n\nTravis",
    "created_at": "2013-08-09T16:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187646",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

Ack, you're right about the 1, that's a big bug on my part. Fixed now. I also put a docstring at the class level about the `__getitem__` (but this syntax is also used in symmetric functions) and included the emptyset test. However there's nothing I can do about the rejects because the `algebra.rst` should be in alphabetical order and #14234 is already positively reviewed, but that should definitely be a dependency. (I agree with you though on this shortcomming of Mercurial as Git is more robust from my experience, and the switch should happen [relatively] soon.)

Thanks,

Travis



---

archive/issue_comments_187647.json:
```json
{
    "body": "For patchbot:\n\nApply: trac_14981-descent_algebra-ts.patch",
    "created_at": "2013-08-09T16:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187647",
    "user": "https://github.com/tscrim"
}
```

For patchbot:

Apply: trac_14981-descent_algebra-ts.patch



---

archive/issue_comments_187648.json:
```json
{
    "body": "review patch (final)",
    "created_at": "2013-08-10T02:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187648",
    "user": "https://github.com/darijgr"
}
```

review patch (final)



---

archive/issue_comments_187649.json:
```json
{
    "body": "Attachment [trac_14981-review-dg.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-review-dg.patch) by @darijgr created at 2013-08-10 02:17:53\n\nHey Travis,\n\ngood work. My new review patch consists of nitpicks, basically. If you agree with it, mark this positive-review.\n\nBest regards,\\\\\nDarij",
    "created_at": "2013-08-10T02:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187649",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_14981-review-dg.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-review-dg.patch) by @darijgr created at 2013-08-10 02:17:53

Hey Travis,

good work. My new review patch consists of nitpicks, basically. If you agree with it, mark this positive-review.

Best regards,\\
Darij



---

archive/issue_comments_187650.json:
```json
{
    "body": "Hey Darij,\n\nHere's with a few other changes and nitpicks on your nitpicks. Most notably I removed the citations to GR1989 since the paper was being referenced so frequently. IMO, it's at the class level, so it essentially covers all methods. If you're happy with my changes, feel free to set this to positive review.\n\nThanks,\n\nTravis",
    "created_at": "2013-08-11T00:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187650",
    "user": "https://github.com/tscrim"
}
```

Hey Darij,

Here's with a few other changes and nitpicks on your nitpicks. Most notably I removed the citations to GR1989 since the paper was being referenced so frequently. IMO, it's at the class level, so it essentially covers all methods. If you're happy with my changes, feel free to set this to positive review.

Thanks,

Travis



---

archive/issue_comments_187651.json:
```json
{
    "body": "For patchbot:\n\nApply: trac_14981-descent_algebra-ts.patch",
    "created_at": "2013-08-11T00:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187651",
    "user": "https://github.com/tscrim"
}
```

For patchbot:

Apply: trac_14981-descent_algebra-ts.patch



---

archive/issue_comments_187652.json:
```json
{
    "body": "I do think the references are useful, since they say that the notations used in the doc are identical with the notations used in [GR1989]. Of course, you can write exactly this into the docstring on the class level, but that would be a promise that all **future** changes to the code will still respect [GR1989] notations; I'm not sure if I could make such a promise...\n\nAlso, some details are off. First, there is no need to require R to be a QQ-algebra universally; only the I-basis needs that, and as far as I understand it is a leaf of the coercion graph. The use of < for the refinement order needs to be changed to \\leq every time it appears, and you might want to point out which way it goes (I don't know if this is standard; this is the reason why I haven't used a symbol for it).\n\nWhy did you remove the paragraph about the nonstandard syntax for the D-basis? Things like this confuse me a lot when I try to use a basis.",
    "created_at": "2013-08-11T01:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187652",
    "user": "https://github.com/darijgr"
}
```

I do think the references are useful, since they say that the notations used in the doc are identical with the notations used in [GR1989]. Of course, you can write exactly this into the docstring on the class level, but that would be a promise that all **future** changes to the code will still respect [GR1989] notations; I'm not sure if I could make such a promise...

Also, some details are off. First, there is no need to require R to be a QQ-algebra universally; only the I-basis needs that, and as far as I understand it is a leaf of the coercion graph. The use of < for the refinement order needs to be changed to \leq every time it appears, and you might want to point out which way it goes (I don't know if this is standard; this is the reason why I haven't used a symbol for it).

Why did you remove the paragraph about the nonstandard syntax for the D-basis? Things like this confuse me a lot when I try to use a basis.



---

archive/issue_comments_187653.json:
```json
{
    "body": "Attachment [trac_14981-descent_algebra-ts.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-descent_algebra-ts.patch) by @tscrim created at 2013-08-11 01:37:31\n\nI stated explicitly that we're following [GR1989] in the class doc and changed the QQ-algebra requirement. For the refinement order, I don't think there is any ambiguity, but from the rest of the docstring, it must be that `q <= p` is `q` refines `p`. I removed the D-basis paragraph because `D([1, 3])` should be standard syntax (at least following the symmetric functions and I forgot to test it for the D basis). I fixed this so that it works now.\n\nFor patchbot:\n\nApply: trac_14981-descent_algebra-ts.patch",
    "created_at": "2013-08-11T01:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187653",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_14981-descent_algebra-ts.patch](tarball://root/attachments/some-uuid/ticket14981/trac_14981-descent_algebra-ts.patch) by @tscrim created at 2013-08-11 01:37:31

I stated explicitly that we're following [GR1989] in the class doc and changed the QQ-algebra requirement. For the refinement order, I don't think there is any ambiguity, but from the rest of the docstring, it must be that `q <= p` is `q` refines `p`. I removed the D-basis paragraph because `D([1, 3])` should be standard syntax (at least following the symmetric functions and I forgot to test it for the D basis). I fixed this so that it works now.

For patchbot:

Apply: trac_14981-descent_algebra-ts.patch



---

archive/issue_comments_187654.json:
```json
{
    "body": "Thanks for making the D(...)-syntax work! The rest is also fine now. Positive review!",
    "created_at": "2013-08-11T13:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187654",
    "user": "https://github.com/darijgr"
}
```

Thanks for making the D(...)-syntax work! The rest is also fine now. Positive review!



---

archive/issue_comments_187655.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-11T13:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187655",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187656.json:
```json
{
    "body": "Thanks for reviewing this patch Darij.",
    "created_at": "2013-08-11T18:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187656",
    "user": "https://github.com/tscrim"
}
```

Thanks for reviewing this patch Darij.



---

archive/issue_events_043009.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-28T06:53:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14981#event-43009"
}
```



---

archive/issue_comments_187657.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-28T06:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14981#issuecomment-187657",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
