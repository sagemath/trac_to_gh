# Issue 14894: Fix PARI error handling

archive/issues_014690.json:
```json
{
    "assignees": [],
    "body": "Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.\n\nMoreover, we also get access to the \"error data\" (a `t_ERROR` object) which we store in the exception.\n\nDepends on #12142\n\nDepends on #14873\n\n**Assignee:** @jdemeyer\n\n**CC:**  @jdemeyer\n\n**Keywords:** pari error signal\n\n**Branch/Commit:** [2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)\n\n**Reviewer:** Peter Bruin\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/14894\n\n",
    "closed_at": "2015-01-29T22:41:50Z",
    "created_at": "2013-07-15T14:21:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix PARI error handling",
    "type": "issue",
    "updated_at": "2015-01-29T22:41:50Z",
    "url": "https://github.com/sagemath/sage/issues/14894",
    "user": "https://github.com/vbraun"
}
```
Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.

Moreover, we also get access to the "error data" (a `t_ERROR` object) which we store in the exception.

Depends on #12142

Depends on #14873

**Assignee:** @jdemeyer

**CC:**  @jdemeyer

**Keywords:** pari error signal

**Branch/Commit:** [2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)

**Reviewer:** Peter Bruin

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/14894





---

archive/issue_comments_185041.json:
```json
{
    "body": "<a id='comment:2'></a>\nAh sorry, its dutch, not french. Too many variations of my own surname ;-)",
    "created_at": "2013-07-15T14:57:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185041",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
Ah sorry, its dutch, not french. Too many variations of my own surname ;-)



---

archive/issue_comments_185042.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@vbraun](#comment%3A2):\n> Ah sorry, its dutch, not french. Too many variations of my own surname ;-)\n\nKein Problem! 8-)",
    "created_at": "2013-07-15T15:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185042",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>
Replying to [@vbraun](#comment%3A2):
> Ah sorry, its dutch, not french. Too many variations of my own surname ;-)

Kein Problem! 8-)



---

archive/issue_comments_185043.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185043",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_comments_185044.json:
```json
{
    "body": "**Dependencies:** #12142, #14873",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185044",
    "user": "https://github.com/pjbruin"
}
```

**Dependencies:** #12142, #14873



---

archive/issue_events_130589.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-07-16T09:26:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "rename": {
        "from": "Update to Pari 2.6.0 (when its out) and fix error handling",
        "to": "Fix PARI error handling (needed for future upgrade to PARI 2.6)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130589"
}
```



---

archive/issue_comments_185045.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,39 @@\n-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage. See also https://github.com/sagemath/sage/issues/14873#comment:9 for a list of issues with the current approach.\n+Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n \n+This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n+\n+```\n+sage_pari_catch()\n+... code ...\n+sage_pari_catch_end()\n+```\n+Inside such a block one can put conditions like\n+\n+```\n+if [some condition]:\n+    sage_pari_catch_reset()\n+    [return or raise exception]\n+```\n+\n+The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n+\n+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of\n+\n+```\n+sig_on()\n+return new_gen(something returning GEN)\n+```\n+one therefore has to write\n+\n+```\n+cdef gen result\n+sage_pari_catch()\n+result = new_gen(something returning GEN)\n+sage_pari_catch_end()\n+return result\n+```\n+\n+This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.\n+\n+When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n+\n``````\n",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185045",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,39 @@
-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage. See also https://github.com/sagemath/sage/issues/14873#comment:9 for a list of issues with the current approach.
+Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
 
+This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
+
+```
+sage_pari_catch()
+... code ...
+sage_pari_catch_end()
+```
+Inside such a block one can put conditions like
+
+```
+if [some condition]:
+    sage_pari_catch_reset()
+    [return or raise exception]
+```
+
+The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
+
+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of
+
+```
+sig_on()
+return new_gen(something returning GEN)
+```
+one therefore has to write
+
+```
+cdef gen result
+sage_pari_catch()
+result = new_gen(something returning GEN)
+sage_pari_catch_end()
+return result
+```
+
+This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.
+
+When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
+
``````




---

archive/issue_comments_185046.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"pari error signal\".",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185046",
    "user": "https://github.com/pjbruin"
}
```

**Changing keywords** from "" to "pari error signal".



---

archive/issue_comments_185047.json:
```json
{
    "body": "new Cython macros for PARI error handling",
    "created_at": "2013-07-16T09:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185047",
    "user": "https://github.com/pjbruin"
}
```

new Cython macros for PARI error handling



---

archive/issue_comments_185048.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz)\n\nmake gen.pyx use new PARI error handling macros",
    "created_at": "2013-07-16T09:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185048",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz)

make gen.pyx use new PARI error handling macros



---

archive/issue_comments_185049.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch_gen.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz)\n\nmake PARI finite field elements use new error handling macros",
    "created_at": "2013-07-16T09:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185049",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch_gen.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz)

make PARI finite field elements use new error handling macros



---

archive/issue_comments_185050.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz)\n\nnew PARI error handling for miscellaneous Cython code",
    "created_at": "2013-07-16T09:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185050",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz)

new PARI error handling for miscellaneous Cython code



---

archive/issue_comments_185051.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch_misc.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz)\n\ndelete old Cython macros for PARI error handling",
    "created_at": "2013-07-16T09:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185051",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch_misc.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz)

delete old Cython macros for PARI error handling



---

archive/issue_events_130590.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-07-16T09:30:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130590"
}
```



---

archive/issue_comments_185052.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,3 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),), \n``````\n",
    "created_at": "2013-07-16T09:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185052",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,3 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),), 
``````




---

archive/issue_comments_185053.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Attachment:** [trac_14894-pari_catch_delete_old.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)",
    "created_at": "2013-07-16T09:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185053",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
**Attachment:** [trac_14894-pari_catch_delete_old.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)



---

archive/issue_comments_185054.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n \n-This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n+This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n \n ```\n sage_pari_catch()\n@@ -17,7 +17,7 @@\n \n The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n \n-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of\n+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of\n \n ```\n sig_on()\n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),), \n+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),)\n``````\n",
    "created_at": "2013-07-16T11:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185054",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
 
-This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
+This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
 
 ```
 sage_pari_catch()
@@ -17,7 +17,7 @@
 
 The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
 
-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of
+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of
 
 ```
 sig_on()
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),), 
+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),)
``````




---

archive/issue_comments_185055.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run. Maybe Jeroen has an opinion?\n\nI would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.",
    "created_at": "2013-07-16T14:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185055",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run. Maybe Jeroen has an opinion?

I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.



---

archive/issue_comments_185056.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@vbraun](#comment%3A7):\n> Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run.\n\nThe new macros do require more keystrokes -- or things like `replace-regexp` in Emacs, which I ought to list as a co-author of these patches. 8-)  On the other hand, they make the code easier to understand in the sense that one doesn't have to remember or guess where the error catching block ends.\n\n> I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.\n\nIn fact, I spent quite a bit of thought on the names, and altogether, I think that there are good reasons for the `sage_pari_` prefix:\n\nMy first idea was `pari_catch` / `pari_endcatch` / `pari_catch_reset`.  Then I decided that this set of names looks better with `catch_end` than with `endcatch`.\n\nThe variable `sage_pari_catcherr` in your patch for #14873 then gave me the idea of prefixing the names with `sage_`.  It is true that this makes them a bit long (which is why I did not change `sage_pari_catch` to `sage_pari_catch_begin`).  But it is also true that they are non-trivial wrappers around the corresponding PARI macros that involve signal trapping, conversion of PARI errors to Python exceptions, and potentially retrying the same code several times until the stack is large enough.  I thought this justified the prefix `sage_` to make it clear that they are not the vanilla PARI macros but somewhat elaborate customised versions.\n\nAbout keeping the `pari` part of the name: I think it is important because these macros *are* used outside `sage/libs/pari`, so the name should indicate that they have a more specialised purpose than the generic `sig_on()` / `sig_off()`.  Currently they are used in a few places for integers, real and complex numbers, and integer and rational matrices.  The `FiniteField_pari_ffelt` class of #12142 heavily depends on them, and there are many other data types of which fast PARI implementations could be made (e.g. polynomials, power series rings and elliptic curves over finite fields), which would undoubtedly also use these macros.",
    "created_at": "2013-07-16T16:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185056",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>
Replying to [@vbraun](#comment%3A7):
> Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run.

The new macros do require more keystrokes -- or things like `replace-regexp` in Emacs, which I ought to list as a co-author of these patches. 8-)  On the other hand, they make the code easier to understand in the sense that one doesn't have to remember or guess where the error catching block ends.

> I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.

In fact, I spent quite a bit of thought on the names, and altogether, I think that there are good reasons for the `sage_pari_` prefix:

My first idea was `pari_catch` / `pari_endcatch` / `pari_catch_reset`.  Then I decided that this set of names looks better with `catch_end` than with `endcatch`.

The variable `sage_pari_catcherr` in your patch for #14873 then gave me the idea of prefixing the names with `sage_`.  It is true that this makes them a bit long (which is why I did not change `sage_pari_catch` to `sage_pari_catch_begin`).  But it is also true that they are non-trivial wrappers around the corresponding PARI macros that involve signal trapping, conversion of PARI errors to Python exceptions, and potentially retrying the same code several times until the stack is large enough.  I thought this justified the prefix `sage_` to make it clear that they are not the vanilla PARI macros but somewhat elaborate customised versions.

About keeping the `pari` part of the name: I think it is important because these macros *are* used outside `sage/libs/pari`, so the name should indicate that they have a more specialised purpose than the generic `sig_on()` / `sig_off()`.  Currently they are used in a few places for integers, real and complex numbers, and integer and rational matrices.  The `FiniteField_pari_ffelt` class of #12142 heavily depends on them, and there are many other data types of which fast PARI implementations could be made (e.g. polynomials, power series rings and elliptic curves over finite fields), which would undoubtedly also use these macros.



---

archive/issue_comments_185057.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),)\n+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch), [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/d10ecead5927437378c99f2385b31513.patch),)\n``````\n",
    "created_at": "2013-07-22T14:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185057",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/3f199860f7aab891a845b6a24c40f65c.patch),)
+Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch), [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/d10ecead5927437378c99f2385b31513.patch),)
``````




---

archive/issue_comments_185058.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'm attaching one more patch, which I hope will be the last one for this ticket.  It makes the C macros as simple as possible and moves the handling of `pari_errno` to a single Cython function `pari_handle_error`.",
    "created_at": "2013-07-22T14:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185058",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
I'm attaching one more patch, which I hope will be the last one for this ticket.  It makes the C macros as simple as possible and moves the handling of `pari_errno` to a single Cython function `pari_handle_error`.



---

archive/issue_comments_185059.json:
```json
{
    "body": "<a id='comment:10'></a>\nOne other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.  It works nicely, but I'm not sure that it is useful for `gen.pyx`, since it will probably slow things down.  On the other hand, it might be useful later for new code that is less speed-critical.  I am thinking of creating a patch implementing this (in a new ticket) sometime in the future.",
    "created_at": "2013-07-22T14:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185059",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>
One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.  It works nicely, but I'm not sure that it is useful for `gen.pyx`, since it will probably slow things down.  On the other hand, it might be useful later for new code that is less speed-critical.  I am thinking of creating a patch implementing this (in a new ticket) sometime in the future.



---

archive/issue_comments_185060.json:
```json
{
    "body": "<a id='comment:11'></a>\nOne recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.\n\nWhat about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?",
    "created_at": "2013-07-24T07:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185060",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.

What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?



---

archive/issue_comments_185061.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@pjbruin](#comment%3A10):\n> One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.\n\nSince this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.",
    "created_at": "2013-07-24T07:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185061",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [@pjbruin](#comment%3A10):
> One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.

Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.



---

archive/issue_comments_185062.json:
```json
{
    "body": "<a id='comment:13'></a>\nAlso, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:\n\n```\n    sage_pari_catch()\n    return new_gen(something returning GEN)\n```",
    "created_at": "2013-07-24T07:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185062",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:

```
    sage_pari_catch()
    return new_gen(something returning GEN)
```



---

archive/issue_comments_185063.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@jdemeyer](#comment%3A11):\n> One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.\n\nAs I understand it, the two purposes of `sage_pari_catch()` are equally important, namely\n- catching signals\n- catching PARI errors.\nIt would be nice to have a name that mirror this.  Maybe the prefix `sage_` is somewhat redundant, as Volker Braun suggested, and we could call them `pari_catch_on()` and `pari_catch_off()`?\n\n> What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?\n\nDo these have the same two purposes as above?  In that case, I would find the names `pari_sig_on()` and `pari_sig_off()` acceptable for the sake of consistency, but in principle I dislike the fact that they don't hint at the fact that these macros catch PARI errors and not just signals.",
    "created_at": "2013-07-24T11:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185063",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'></a>
Replying to [@jdemeyer](#comment%3A11):
> One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.

As I understand it, the two purposes of `sage_pari_catch()` are equally important, namely
- catching signals
- catching PARI errors.
It would be nice to have a name that mirror this.  Maybe the prefix `sage_` is somewhat redundant, as Volker Braun suggested, and we could call them `pari_catch_on()` and `pari_catch_off()`?

> What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?

Do these have the same two purposes as above?  In that case, I would find the names `pari_sig_on()` and `pari_sig_off()` acceptable for the sake of consistency, but in principle I dislike the fact that they don't hint at the fact that these macros catch PARI errors and not just signals.



---

archive/issue_comments_185064.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@jdemeyer](#comment%3A12):\n> Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.\n\nMaybe I can convince you by giving the definition of the decorator:\n\n```\ndef pari_catch_function(f):\n    \"\"\"\n    Decorator to wrap a function in sage_pari_catch() ... sage_pari_catch_end().\n    \"\"\"\n    def g(*args):\n        cdef object _x\n        sage_pari_catch()\n        _x = f(*args)\n        sage_pari_catch_end()\n        return _x\n    return g\n```\nI put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.\n\nSomething that I do *not* see how to do easily, on the other hand, is a context guard (context manager) for use with the `with` statement, i.e.\n\n```\nwith pari_catch:\n    ...code...\n```\ngiving you catching of PARI errors and signals within the block.",
    "created_at": "2013-07-24T11:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185064",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:15'></a>
Replying to [@jdemeyer](#comment%3A12):
> Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.

Maybe I can convince you by giving the definition of the decorator:

```
def pari_catch_function(f):
    """
    Decorator to wrap a function in sage_pari_catch() ... sage_pari_catch_end().
    """
    def g(*args):
        cdef object _x
        sage_pari_catch()
        _x = f(*args)
        sage_pari_catch_end()
        return _x
    return g
```
I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.

Something that I do *not* see how to do easily, on the other hand, is a context guard (context manager) for use with the `with` statement, i.e.

```
with pari_catch:
    ...code...
```
giving you catching of PARI errors and signals within the block.



---

archive/issue_comments_185065.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [@jdemeyer](#comment%3A13):\n> Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:\n> \n> ```\n>     sage_pari_catch()\n>     return new_gen(something returning GEN)\n> ```\n\nI see that this would be desirable because it saves typing a few lines each time.  On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.  The fact that the macros contain complementary braces makes them less flexible, but make it clearer where the error-catching block ends.\n\nActually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.  This would force us at the same time to avoid complementary braces, which can be a good thing or not (we seem to disagree on this).  However, there are two real disadvantages to this approach:\n- it won't translate into simple C code and will certainly be slower;\n- we cannot use the macros that PARI provides, and instead hack something ourselves that uses `alloca()`, `malloc()` or a global variable to allocate the `jmp_buf` (stack environment for use with `sigjmp()`); otherwise it will disappear from the scope.  This is exactly the problem that this ticket tries to solve.",
    "created_at": "2013-07-24T11:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185065",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'></a>
Replying to [@jdemeyer](#comment%3A13):
> Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:
> 
> ```
>     sage_pari_catch()
>     return new_gen(something returning GEN)
> ```

I see that this would be desirable because it saves typing a few lines each time.  On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.  The fact that the macros contain complementary braces makes them less flexible, but make it clearer where the error-catching block ends.

Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.  This would force us at the same time to avoid complementary braces, which can be a good thing or not (we seem to disagree on this).  However, there are two real disadvantages to this approach:
- it won't translate into simple C code and will certainly be slower;
- we cannot use the macros that PARI provides, and instead hack something ourselves that uses `alloca()`, `malloc()` or a global variable to allocate the `jmp_buf` (stack environment for use with `sigjmp()`); otherwise it will disappear from the scope.  This is exactly the problem that this ticket tries to solve.



---

archive/issue_comments_185066.json:
```json
{
    "body": "<a id='comment:17'></a>\nOne last comment for now: when I was working on this ticket I realised that a language feature that would give a good solution for this problem would be Lisp-style macros (so one could pass a \"quoted\" piece of code to a macro that does `catch_on()`, evaluates the code, and does `catch_off()`).  Unfortunately this is something that Python doesn't have; the closest thing is the decorator described above, but it only works for entire functions.",
    "created_at": "2013-07-24T12:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185066",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>
One last comment for now: when I was working on this ticket I realised that a language feature that would give a good solution for this problem would be Lisp-style macros (so one could pass a "quoted" piece of code to a macro that does `catch_on()`, evaluates the code, and does `catch_off()`).  Unfortunately this is something that Python doesn't have; the closest thing is the decorator described above, but it only works for entire functions.



---

archive/issue_comments_185067.json:
```json
{
    "body": "<a id='comment:18'></a>\nI also don't like the unbalanced-bracket-hack. But, since Pari sets up its error catching framework that way, we should go with it, ugly or not.\n\nThen I agree with Peter that the name should be different form `sig_on`/`off` precisely because it has different semantics.\n\nI don't really see the need for getting too fancy with context managers or decorators, the pari error try/catch should essentially only be used in `sage.libs.pari` and nowhere else in the Sage tree. And that is precisely where you wouldn't want to take any performance hit for one of the more fancy solutions.",
    "created_at": "2013-07-24T23:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185067",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
I also don't like the unbalanced-bracket-hack. But, since Pari sets up its error catching framework that way, we should go with it, ugly or not.

Then I agree with Peter that the name should be different form `sig_on`/`off` precisely because it has different semantics.

I don't really see the need for getting too fancy with context managers or decorators, the pari error try/catch should essentially only be used in `sage.libs.pari` and nowhere else in the Sage tree. And that is precisely where you wouldn't want to take any performance hit for one of the more fancy solutions.



---

archive/issue_comments_185068.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@pjbruin](#comment%3A16):\n> Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.\n\nSure, but that needs some Cython patches, so it's not possible now.",
    "created_at": "2013-07-25T06:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185068",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Replying to [@pjbruin](#comment%3A16):
> Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.

Sure, but that needs some Cython patches, so it's not possible now.



---

archive/issue_comments_185069.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [@pjbruin](#comment%3A15):\n> I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.\n\nSince `_x = f(*args)` is evaluated through Python (not C), it will badly break the Python interpreter if interrupted at the wrong time.",
    "created_at": "2013-07-25T06:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185069",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [@pjbruin](#comment%3A15):
> I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.

Since `_x = f(*args)` is evaluated through Python (not C), it will badly break the Python interpreter if interrupted at the wrong time.



---

archive/issue_comments_185070.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch_simplify.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)\n\nsimplify macros, do pari_errno handling in gen.pyx:pari_handle_error",
    "created_at": "2013-07-29T21:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185070",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch_simplify.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)

simplify macros, do pari_errno handling in gen.pyx:pari_handle_error



---

archive/issue_comments_185071.json:
```json
{
    "body": "<a id='comment:21'></a>\nIn the previous version of [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch) I tried to move the `except *` from `sage_pari_catch()` to `sage_pari_catch_end()`.  This was fine for catching PARI errors, but turned out to break interrupt handling, so I reverted this change.",
    "created_at": "2013-07-29T21:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185071",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:21'></a>
In the previous version of [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch) I tried to move the `except *` from `sage_pari_catch()` to `sage_pari_catch_end()`.  This was fine for catching PARI errors, but turned out to break interrupt handling, so I reverted this change.



---

archive/issue_comments_185072.json:
```json
{
    "body": "<a id='comment:22'></a>\nAbout the names for the macros: how about `pari_catch_on()` and `pari_catch_off()`?\n\nAdvantages:\n- not too long\n- reminiscent of `sig_on()` and `sig_off()`\n- do not suggest that the sole purpose is handling signals (as opposed to PARI errors)",
    "created_at": "2013-08-05T14:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185072",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:22'></a>
About the names for the macros: how about `pari_catch_on()` and `pari_catch_off()`?

Advantages:
- not too long
- reminiscent of `sig_on()` and `sig_off()`
- do not suggest that the sole purpose is handling signals (as opposed to PARI errors)



---

archive/issue_comments_185073.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@pjbruin](#comment%3A22):\n> - reminiscent of `sig_on()` and `sig_off()`\n\nIn my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.\n\n> I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.\n\nThat might be true, but in this case I don't think it justifies the overcomplication of two-liners like\n\n```\nsig_on() \nreturn P.new_gen(gcos(x.g, pbw(precision))) \n```\nto the five-liner\n\n```\ncdef gen result_gen \nsage_pari_catch() \nresult_gen = P.new_gen(gcos(x.g, pbw(precision))) \nsage_pari_catch_end() \nreturn result_gen \n```",
    "created_at": "2013-08-13T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185073",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [@pjbruin](#comment%3A22):
> - reminiscent of `sig_on()` and `sig_off()`

In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.

> I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.

That might be true, but in this case I don't think it justifies the overcomplication of two-liners like

```
sig_on() 
return P.new_gen(gcos(x.g, pbw(precision))) 
```
to the five-liner

```
cdef gen result_gen 
sage_pari_catch() 
result_gen = P.new_gen(gcos(x.g, pbw(precision))) 
sage_pari_catch_end() 
return result_gen 
```



---

archive/issue_comments_185074.json:
```json
{
    "body": "<a id='comment:24'></a>\nFor reviewing purposes, could you please fold all patches into one? Because some later patches rewrite stuff from older patches.",
    "created_at": "2013-08-13T12:26:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185074",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
For reviewing purposes, could you please fold all patches into one? Because some later patches rewrite stuff from older patches.



---

archive/issue_comments_185075.json:
```json
{
    "body": "<a id='comment:25'></a>\nAfter looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).",
    "created_at": "2013-08-13T12:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185075",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).



---

archive/issue_events_130591.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T12:37:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130591"
}
```



---

archive/issue_events_130592.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T12:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130592"
}
```



---

archive/issue_comments_185076.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2013-08-13T12:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185076",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_185077.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@jdemeyer](#comment%3A23):\n> Replying to [@pjbruin](#comment%3A22):\n> > - reminiscent of `sig_on()` and `sig_off()`\n\n> In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.\n\nBut why?  When I started looking at `gen.pyx`, the names `sig_on()` and `sig_off()` really confused me, because they suggest that they are just signal handling macros.  It seems to me that in practice, PARI errors (e.g. zero division) occur more often than signals, so the names should not suggest otherwise.  If you ask me, this problem is not fixed by renaming them `pari_sig_on()` and `pari_sig_off()`.\n\n> > I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.\n\n> That might be true, but in this case I don't think it justifies the overcomplication of two-liners like [...] to the five-liner [...]\n\nI can't say I'm completely happy with the code increase, either, and by now I'm really inclined to try one of two opposite strategies:\n- either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` (as in [comment:15](#comment%3A15)) would be ideal, and perhaps the overhead is not so big compared to the overhead that we already have by using Cython;\n- or translate this part of `gen.pyx` from Cython to C, both for speed and to be able to use a macro for signal and error handling.  This macro, say `pari_catch_wrap()`, should call `pari_catch_on()`, execute `code` (and remember its return value), call `pari_catch_off()` and return the return value of `code`, so one could type (in C)\n\n```\nreturn pari_catch_wrap(code);\n```\n\n> After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).\n\nThere is a trade-off between execution time and developer time here.\n\nWhat you suggest seems to require a new set of macros, merging `sig_on()/sig_off()` and PARI's error handling macros, that only do one `sigsetjmp()` but then have to distinguish within the error-handling code whether a signal or a PARI error occurred.\n\nI would hope that `setjmp()` is very fast on most systems, so that it doesn't really hurt to use it twice: once to set up signal handling and once to set up PARI error handling.  I would certainly be happy to pay this price in order to cleanly separate between handling signals and handling PARI errors.",
    "created_at": "2013-08-13T13:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185077",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:27'></a>
Replying to [@jdemeyer](#comment%3A23):
> Replying to [@pjbruin](#comment%3A22):
> > - reminiscent of `sig_on()` and `sig_off()`

> In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.

But why?  When I started looking at `gen.pyx`, the names `sig_on()` and `sig_off()` really confused me, because they suggest that they are just signal handling macros.  It seems to me that in practice, PARI errors (e.g. zero division) occur more often than signals, so the names should not suggest otherwise.  If you ask me, this problem is not fixed by renaming them `pari_sig_on()` and `pari_sig_off()`.

> > I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.

> That might be true, but in this case I don't think it justifies the overcomplication of two-liners like [...] to the five-liner [...]

I can't say I'm completely happy with the code increase, either, and by now I'm really inclined to try one of two opposite strategies:
- either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` (as in [comment:15](#comment%3A15)) would be ideal, and perhaps the overhead is not so big compared to the overhead that we already have by using Cython;
- or translate this part of `gen.pyx` from Cython to C, both for speed and to be able to use a macro for signal and error handling.  This macro, say `pari_catch_wrap()`, should call `pari_catch_on()`, execute `code` (and remember its return value), call `pari_catch_off()` and return the return value of `code`, so one could type (in C)

```
return pari_catch_wrap(code);
```

> After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).

There is a trade-off between execution time and developer time here.

What you suggest seems to require a new set of macros, merging `sig_on()/sig_off()` and PARI's error handling macros, that only do one `sigsetjmp()` but then have to distinguish within the error-handling code whether a signal or a PARI error occurred.

I would hope that `setjmp()` is very fast on most systems, so that it doesn't really hurt to use it twice: once to set up signal handling and once to set up PARI error handling.  I would certainly be happy to pay this price in order to cleanly separate between handling signals and handling PARI errors.



---

archive/issue_comments_185078.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [@pjbruin](#comment%3A27):\n> - either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` would be ideal\n\nOf course this would be ideal. But as I said, this needs Cython patches. I recently looked into this for implementing `sig_on()` and it currently cannot be done in Cython.\n\n> What you suggest seems to require a new set of macros, merging sig_on()/sig_off() and PARI's error handling macros, that only do one sigsetjmp() but then have to distinguish within the error-handling code whether a signal or a PARI error occurred. \n\nExactly. I know it's far from trivial, otherwise I would have done it already in the past. But I can say that I **thought** a lot about signal/error handling.\n\n> I would hope that setjmp() is very fast on most systems\n\nIt's not. I remember it being particularly slow on BSD (and therefore OS X) systems.",
    "created_at": "2013-08-13T14:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185078",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [@pjbruin](#comment%3A27):
> - either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` would be ideal

Of course this would be ideal. But as I said, this needs Cython patches. I recently looked into this for implementing `sig_on()` and it currently cannot be done in Cython.

> What you suggest seems to require a new set of macros, merging sig_on()/sig_off() and PARI's error handling macros, that only do one sigsetjmp() but then have to distinguish within the error-handling code whether a signal or a PARI error occurred. 

Exactly. I know it's far from trivial, otherwise I would have done it already in the past. But I can say that I **thought** a lot about signal/error handling.

> I would hope that setjmp() is very fast on most systems

It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.



---

archive/issue_comments_185079.json:
```json
{
    "body": "**Attachment:** [trac_14894-pari_catch-folded.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)\n\nunified patch combining all the above patches",
    "created_at": "2013-08-13T14:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185079",
    "user": "https://github.com/pjbruin"
}
```

**Attachment:** [trac_14894-pari_catch-folded.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)

unified patch combining all the above patches



---

archive/issue_comments_185080.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@jdemeyer](#comment%3A28):\n> Replying to [@pjbruin](#comment%3A27):\n> > I would hope that setjmp() is very fast on most systems\n\n> It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.\n\nI just found a discussion about this on the pari-dev mailing list: [http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html).\n\nThe reason is that in BSD, `setjmp()` saves the signal mask (which apparently is very expensive), while in System V-like systems it does not.  BSD does have `_setjmp()` and `sigsetjmp(, 0)`, which are comparable to `setjmp()` on other systems.  According to the link above, the `setjmp()` variant that does not touch the signal mask is 2.5 to 12 times as fast as the one that does.\n\nOf course, for signal handling you are stuck with the slow version, but for other purposes one could use the fast version.  In our situation the question is whether we do one slow system call, or the slow one for signal handling plus the fast one for handling PARI errors.\n\nFinally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.  This doesn't currently seem to be implemented, though.",
    "created_at": "2013-08-13T14:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185080",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:29'></a>
Replying to [@jdemeyer](#comment%3A28):
> Replying to [@pjbruin](#comment%3A27):
> > I would hope that setjmp() is very fast on most systems

> It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.

I just found a discussion about this on the pari-dev mailing list: [http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html).

The reason is that in BSD, `setjmp()` saves the signal mask (which apparently is very expensive), while in System V-like systems it does not.  BSD does have `_setjmp()` and `sigsetjmp(, 0)`, which are comparable to `setjmp()` on other systems.  According to the link above, the `setjmp()` variant that does not touch the signal mask is 2.5 to 12 times as fast as the one that does.

Of course, for signal handling you are stuck with the slow version, but for other purposes one could use the fast version.  In our situation the question is whether we do one slow system call, or the slow one for signal handling plus the fast one for handling PARI errors.

Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.  This doesn't currently seem to be implemented, though.



---

archive/issue_comments_185081.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [@pjbruin](#comment%3A29):\n> Of course, for signal handling you are stuck with the slow version\n\nFalse :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.\n\n> Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.\n\nI think this would be very good for Sage. I personally wouldn't mind patching that in ourselves in the Sage version of PARI.",
    "created_at": "2013-08-13T15:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185081",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [@pjbruin](#comment%3A29):
> Of course, for signal handling you are stuck with the slow version

False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.

> Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.

I think this would be very good for Sage. I personally wouldn't mind patching that in ourselves in the Sage version of PARI.



---

archive/issue_comments_185082.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch), [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/d10ecead5927437378c99f2385b31513.patch),)\n+Apply: [attachment:trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch)\n``````\n",
    "created_at": "2013-08-13T15:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185082",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [[attachment:trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch), [attachment:trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch), [attachment:trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch), [attachment:trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch), [attachment:trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/70e0515a24a390e46df47af486babcc9.patch](https://github.com/sagemath/sage/files/ticket14894/d10ecead5927437378c99f2385b31513.patch),)
+Apply: [attachment:trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch)
``````




---

archive/issue_comments_185083.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [@jdemeyer](#comment%3A30):\n> Replying to [@pjbruin](#comment%3A29):\n> > Of course, for signal handling you are stuck with the slow version\n\n> False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.\n\nOK, I read the code too carelessly.  But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well, so the slowness of `setjmp()` on BSD should be irrelevant.  The try/catch macros provided by PARI do use a plain `setjmp()`, but that should be easy to change.\n\nAnyway, if a non-`setjmp()`-based approach is feasible, that would be great.  It would probably still be quite non-trivial, though.",
    "created_at": "2013-08-13T15:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185083",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:32'></a>
Replying to [@jdemeyer](#comment%3A30):
> Replying to [@pjbruin](#comment%3A29):
> > Of course, for signal handling you are stuck with the slow version

> False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.

OK, I read the code too carelessly.  But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well, so the slowness of `setjmp()` on BSD should be irrelevant.  The try/catch macros provided by PARI do use a plain `setjmp()`, but that should be easy to change.

Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.  It would probably still be quite non-trivial, though.



---

archive/issue_comments_185084.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@pjbruin](#comment%3A32):\n> But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well\n\n> Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.\n\nBoth of these require patching the PARI sources, and then I prefer the second approach for simplicity.",
    "created_at": "2013-08-13T15:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185084",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [@pjbruin](#comment%3A32):
> But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well

> Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.

Both of these require patching the PARI sources, and then I prefer the second approach for simplicity.



---

archive/issue_comments_185085.json:
```json
{
    "body": "<a id='comment:34'></a>\nActually, in `[PARI source]/language/init.c` (and in the header file `paricom.h`) there is a declaration\n\n```\nint  (*cb_pari_handle_exception)(long);\n```\nif this is non-zero, `pari_err()` calls it (with an error code as argument) when no saved environment is present to do a `longjmp()` to.  I could imagine setting this to a Cython function that converts a PARI error into an appropriate Python exception, and raising that exception.\n\nIt appears that the function to which `cb_pari_handle_exception` points should return non-zero if and only if the error was handled succesfully; if it was, `pari_err()` simply returns.  However, functions calling `pari_err()` normally expect that function not to return, so as things stand now, a suitable `setjmp()/longjmp()` would still seem to be necessary.",
    "created_at": "2013-08-13T16:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185085",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:34'></a>
Actually, in `[PARI source]/language/init.c` (and in the header file `paricom.h`) there is a declaration

```
int  (*cb_pari_handle_exception)(long);
```
if this is non-zero, `pari_err()` calls it (with an error code as argument) when no saved environment is present to do a `longjmp()` to.  I could imagine setting this to a Cython function that converts a PARI error into an appropriate Python exception, and raising that exception.

It appears that the function to which `cb_pari_handle_exception` points should return non-zero if and only if the error was handled succesfully; if it was, `pari_err()` simply returns.  However, functions calling `pari_err()` normally expect that function not to return, so as things stand now, a suitable `setjmp()/longjmp()` would still seem to be necessary.



---

archive/issue_comments_185086.json:
```json
{
    "body": "<a id='comment:35'></a>\nAnd just now I discovered that as long ago as #9640, you (Jeroen) were already saying that we should use `cb_pari_handle_exception` to catch PARI errors...",
    "created_at": "2013-08-13T16:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185086",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:35'></a>
And just now I discovered that as long ago as #9640, you (Jeroen) were already saying that we should use `cb_pari_handle_exception` to catch PARI errors...



---

archive/issue_comments_185087.json:
```json
{
    "body": "<a id='comment:36'></a>\nIn any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.",
    "created_at": "2013-08-14T08:24:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185087",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>
In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.



---

archive/issue_comments_185088.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [@jdemeyer](#comment%3A36):\n> In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.\n\nThe current implementation has its problems (see the ticket description), but I know of nothing that is broken in practice.  Whether to do it now or during the upgrade depends on which solution is chosen.\n- Option 1: use the try/catch macros provided by PARI.  This we can do now, and it will make the upgrade easier, since similar macros are provided in 2.6 (albeit with slightly different names and a different implementation).\n- Option 2: keep using undocumented PARI functions/variables.  This can only be done at the same time as the upgrade, since the internals have changed a lot in 2.6.\nOption 1 is what the current patch does, and I still prefer this option.",
    "created_at": "2013-08-14T13:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185088",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:37'></a>
Replying to [@jdemeyer](#comment%3A36):
> In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.

The current implementation has its problems (see the ticket description), but I know of nothing that is broken in practice.  Whether to do it now or during the upgrade depends on which solution is chosen.
- Option 1: use the try/catch macros provided by PARI.  This we can do now, and it will make the upgrade easier, since similar macros are provided in 2.6 (albeit with slightly different names and a different implementation).
- Option 2: keep using undocumented PARI functions/variables.  This can only be done at the same time as the upgrade, since the internals have changed a lot in 2.6.
Option 1 is what the current patch does, and I still prefer this option.



---

archive/issue_comments_185089.json:
```json
{
    "body": "<a id='comment:38'></a>\nOr option 3: patch PARI to hack the error handling functions.",
    "created_at": "2013-08-30T09:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185089",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
Or option 3: patch PARI to hack the error handling functions.



---

archive/issue_comments_185090.json:
```json
{
    "body": "<a id='comment:39'></a>\nPart of this should be done now for use in #14888: making the `pari_sig_on()` macros available, see #15124.",
    "created_at": "2013-08-30T10:01:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185090",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Part of this should be done now for use in #14888: making the `pari_sig_on()` macros available, see #15124.



---

archive/issue_comments_185091.json:
```json
{
    "body": "<a id='comment:40'></a>\nI asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).",
    "created_at": "2013-08-30T11:56:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185091",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).



---

archive/issue_comments_185092.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [@jdemeyer](#comment%3A40):\n> I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).\n\nThere is the callback function `cb_pari_handle_exception`, but I don't quite see how to use this without any `longjmp()`; see [comment:34](#comment%3A34).  Hence two questions:\n- Would a new callback function really be needed (e.g. because it has to be called at a different moment than `cb_pari_handle_exception`)?\n- Does the option 3 that you have in mind somehow avoid `longjmp()`, or do you propose to do the `longjmp()` inside a common error-handling function for signals and PARI errors?",
    "created_at": "2013-08-30T12:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185092",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:41'></a>
Replying to [@jdemeyer](#comment%3A40):
> I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).

There is the callback function `cb_pari_handle_exception`, but I don't quite see how to use this without any `longjmp()`; see [comment:34](#comment%3A34).  Hence two questions:
- Would a new callback function really be needed (e.g. because it has to be called at a different moment than `cb_pari_handle_exception`)?
- Does the option 3 that you have in mind somehow avoid `longjmp()`, or do you propose to do the `longjmp()` inside a common error-handling function for signals and PARI errors?



---

archive/issue_comments_185093.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [@pjbruin](#comment%3A41):\n> There is the callback function `cb_pari_handle_exception`\n\nThe problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.\n\nMy approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.",
    "created_at": "2013-08-30T13:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185093",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
Replying to [@pjbruin](#comment%3A41):
> There is the callback function `cb_pari_handle_exception`

The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.

My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.



---

archive/issue_comments_185094.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [@jdemeyer](#comment%3A42):\n> Replying to [@pjbruin](#comment%3A41):\n> > There is the callback function `cb_pari_handle_exception`\n\n> The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.\n\nCouldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\n> My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.\n\nGood, that is what I suspected.",
    "created_at": "2013-08-30T14:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185094",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:43'></a>
Replying to [@jdemeyer](#comment%3A42):
> Replying to [@pjbruin](#comment%3A41):
> > There is the callback function `cb_pari_handle_exception`

> The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.

Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

> My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.

Good, that is what I suspected.



---

archive/issue_comments_185095.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [@pjbruin](#comment%3A43):\n> Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\nThat was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.",
    "created_at": "2013-08-30T14:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>
Replying to [@pjbruin](#comment%3A43):
> Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.



---

archive/issue_comments_185096.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [@jdemeyer](#comment%3A44):\n> Replying to [@pjbruin](#comment%3A43):\n> > Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\n> That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.\n\nI see.  But wouldn't it be a more satisfactory solution to have PARI do those things only if the output is connected to a terminal (using `isatty`)?  This would still require a patch, of course.",
    "created_at": "2013-08-30T17:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185096",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:45'></a>
Replying to [@jdemeyer](#comment%3A44):
> Replying to [@pjbruin](#comment%3A43):
> > Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

> That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.

I see.  But wouldn't it be a more satisfactory solution to have PARI do those things only if the output is connected to a terminal (using `isatty`)?  This would still require a patch, of course.



---

archive/issue_events_130593.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130593"
}
```



---

archive/issue_events_130594.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130594"
}
```



---

archive/issue_events_130595.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "rename": {
        "from": "Fix PARI error handling (needed for future upgrade to PARI 2.6)",
        "to": "Fix PARI error handling for PARI 2.6"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130595"
}
```



---

archive/issue_events_130596.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-11-22T23:22:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130596"
}
```



---

archive/issue_events_130597.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-11-22T23:22:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130597"
}
```



---

archive/issue_comments_185097.json:
```json
{
    "body": "<a id='comment:47'></a>\nNow that we have a better error-handling mechanism (#9640), is there anything specific that needs to be done in this area when upgrading PARI?  Should this rather become a general PARI upgrade ticket, or be closed as a duplicate of #9640?\n\nAlso, do we want to upgrade to PARI 2.6.x or wait for 2.7.x (even minor version = development, odd = stable)?  In January there will be an \"Atelier PARI/GP\" where planning for PARI 2.9 is on the agenda (http://pari.math.u-bordeaux.fr/Events/PARI2014/), which suggests that a 2.7 release is in the pipeline.",
    "created_at": "2013-11-22T23:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185097",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:47'></a>
Now that we have a better error-handling mechanism (#9640), is there anything specific that needs to be done in this area when upgrading PARI?  Should this rather become a general PARI upgrade ticket, or be closed as a duplicate of #9640?

Also, do we want to upgrade to PARI 2.6.x or wait for 2.7.x (even minor version = development, odd = stable)?  In January there will be an "Atelier PARI/GP" where planning for PARI 2.9 is on the agenda (http://pari.math.u-bordeaux.fr/Events/PARI2014/), which suggests that a 2.7 release is in the pipeline.



---

archive/issue_comments_185098.json:
```json
{
    "body": "<a id='comment:48'></a>\nI would say: let this ticket quietly sit here and let's look at it again when PARI-2.7 is released.",
    "created_at": "2013-11-23T10:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185098",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>
I would say: let this ticket quietly sit here and let's look at it again when PARI-2.7 is released.



---

archive/issue_comments_185099.json:
```json
{
    "body": "**Changing author** from \"Peter Bruin\" to \"\".",
    "created_at": "2014-08-18T23:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185099",
    "user": "https://github.com/pjbruin"
}
```

**Changing author** from "Peter Bruin" to "".



---

archive/issue_comments_185100.json:
```json
{
    "body": "<a id='comment:49'></a>\nIn the light of #9640 and #15767, I think this ticket is no longer relevant and suggest to close it.",
    "created_at": "2014-08-18T23:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185100",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:49'></a>
In the light of #9640 and #15767, I think this ticket is no longer relevant and suggest to close it.



---

archive/issue_events_130598.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130598"
}
```



---

archive/issue_events_130599.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "008080",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130599"
}
```



---

archive/issue_events_130600.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130600"
}
```



---

archive/issue_events_130601.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130601"
}
```



---

archive/issue_comments_185101.json:
```json
{
    "body": "<a id='comment:50'></a>\nI think that this ticket is still relevant, since PARI-2.7.x has improved error handling mechanisms which we don't use.",
    "created_at": "2014-08-19T08:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185101",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>
I think that this ticket is still relevant, since PARI-2.7.x has improved error handling mechanisms which we don't use.



---

archive/issue_comments_185102.json:
```json
{
    "body": "<a id='comment:51'></a>\nI think we do need to reconsider the approach though. Personally I like to use Karim's proposal from [http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html), but that hasn't been implemented upstream yet.",
    "created_at": "2014-08-19T08:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185102",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>
I think we do need to reconsider the approach though. Personally I like to use Karim's proposal from [http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html), but that hasn't been implemented upstream yet.



---

archive/issue_events_130602.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "rename": {
        "from": "Fix PARI error handling for PARI 2.6",
        "to": "Fix PARI error handling for PARI 2.7"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130602"
}
```



---

archive/issue_events_130603.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130603"
}
```



---

archive/issue_events_130604.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130604"
}
```



---

archive/issue_comments_185103.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2014-08-19T08:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185103",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Peter Bruin



---

archive/issue_events_130605.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130605"
}
```



---

archive/issue_comments_185104.json:
```json
{
    "body": "<a id='comment:53'></a>\nI'm willing to look into this ticket, but not right now.",
    "created_at": "2014-08-19T08:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'></a>
I'm willing to look into this ticket, but not right now.



---

archive/issue_events_130606.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T16:06:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130606"
}
```



---

archive/issue_events_130607.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T16:06:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130607"
}
```



---

archive/issue_comments_185105.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,40 +1 @@\n-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n-\n-This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n-\n-```\n-sage_pari_catch()\n-... code ...\n-sage_pari_catch_end()\n-```\n-Inside such a block one can put conditions like\n-\n-```\n-if [some condition]:\n-    sage_pari_catch_reset()\n-    [return or raise exception]\n-```\n-\n-The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n-\n-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of\n-\n-```\n-sig_on()\n-return new_gen(something returning GEN)\n-```\n-one therefore has to write\n-\n-```\n-cdef gen result\n-sage_pari_catch()\n-result = new_gen(something returning GEN)\n-sage_pari_catch_end()\n-return result\n-```\n-\n-This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.\n-\n-When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n-\n-Apply: [attachment:trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch)\n+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.\n``````\n",
    "created_at": "2015-01-13T16:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185105",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,40 +1 @@
-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
-
-This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
-
-```
-sage_pari_catch()
-... code ...
-sage_pari_catch_end()
-```
-Inside such a block one can put conditions like
-
-```
-if [some condition]:
-    sage_pari_catch_reset()
-    [return or raise exception]
-```
-
-The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
-
-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of
-
-```
-sig_on()
-return new_gen(something returning GEN)
-```
-one therefore has to write
-
-```
-cdef gen result
-sage_pari_catch()
-result = new_gen(something returning GEN)
-sage_pari_catch_end()
-return result
-```
-
-This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.
-
-When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
-
-Apply: [attachment:trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch)
+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.
``````




---

archive/issue_comments_185106.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)",
    "created_at": "2015-01-13T17:23:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185106",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)



---

archive/issue_comments_185107.json:
```json
{
    "body": "**Commit:** [0602271c328f6d0851af946671194786c8c78556](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)",
    "created_at": "2015-01-13T19:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185107",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [0602271c328f6d0851af946671194786c8c78556](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)



---

archive/issue_comments_185108.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556\">0602271</a></td><td><code>Use cb_pari_err_handle() to handle PARI errors</code></td></tr></table>\n",
    "created_at": "2015-01-13T19:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185108",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556">0602271</a></td><td><code>Use cb_pari_err_handle() to handle PARI errors</code></td></tr></table>




---

archive/issue_events_130608.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "rename": {
        "from": "Fix PARI error handling for PARI 2.7",
        "to": "Fix PARI error handling"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130608"
}
```



---

archive/issue_comments_185109.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.\n+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.\n+\n+Moreover, we also get access to the \"error data\" (a `t_ERROR` object) which we store in the exception.\n``````\n",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185109",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.
+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.
+
+Moreover, we also get access to the "error data" (a `t_ERROR` object) which we store in the exception.
``````




---

archive/issue_events_130609.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130609"
}
```



---

archive/issue_events_130610.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130610"
}
```



---

archive/issue_comments_185110.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"\".",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185110",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "".



---

archive/issue_comments_185111.json:
```json
{
    "body": "**Changing author** from \"Peter Bruin\" to \"Peter Bruin, Jeroen Demeyer\".",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185111",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Peter Bruin" to "Peter Bruin, Jeroen Demeyer".



---

archive/issue_comments_185112.json:
```json
{
    "body": "**Reviewer:** Peter Bruin",
    "created_at": "2015-01-14T13:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185112",
    "user": "https://github.com/pjbruin"
}
```

**Reviewer:** Peter Bruin



---

archive/issue_comments_185113.json:
```json
{
    "body": "**Changing author** from \"Peter Bruin, Jeroen Demeyer\" to \"Jeroen Demeyer\".",
    "created_at": "2015-01-14T13:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185113",
    "user": "https://github.com/pjbruin"
}
```

**Changing author** from "Peter Bruin, Jeroen Demeyer" to "Jeroen Demeyer".



---

archive/issue_comments_185114.json:
```json
{
    "body": "**Changing commit** from \"[0602271c328f6d0851af946671194786c8c78556](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)\" to \"[2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)\".",
    "created_at": "2015-01-14T14:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185114",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[0602271c328f6d0851af946671194786c8c78556](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)" to "[2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)".



---

archive/issue_comments_185115.json:
```json
{
    "body": "<a id='comment:59'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d\">2d532fc</a></td><td><code>Move PariError to handle_error.pyx; add sig_block() where needed</code></td></tr></table>\n",
    "created_at": "2015-01-14T14:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185115",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d">2d532fc</a></td><td><code>Move PariError to handle_error.pyx; add sig_block() where needed</code></td></tr></table>




---

archive/issue_events_130611.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-01-14T16:34:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130611"
}
```



---

archive/issue_events_130612.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-01-14T16:34:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130612"
}
```



---

archive/issue_events_130613.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T22:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130613"
}
```



---

archive/issue_events_130614.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7576573fbdd04954a6e392f3bfc025f37462d5ed",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-01-29T22:41:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-130614"
}
```



---

archive/issue_comments_185116.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)\" to \"[2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)\".",
    "created_at": "2015-01-29T22:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-185116",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)" to "[2d532fcb86ba0d993bc946adb3088c18bb20526d](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)".
