# Issue 14894: Fix PARI error handling

archive/issues_014690.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.\n\nMoreover, we also get access to the \"error data\" (a `t_ERROR` object) which we store in the exception.\n\nDepends on #12142\nDepends on #14873\n\nCC:  @jdemeyer\n\nKeywords: **pari error signal**\n\nBranch/Commit: **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**\n\nReviewer: **Peter Bruin**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14894_\n\n",
    "closed_at": "2015-01-29T22:41:50Z",
    "created_at": "2013-07-15T14:21:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix PARI error handling",
    "type": "issue",
    "updated_at": "2015-01-29T22:41:50Z",
    "url": "https://github.com/sagemath/sage/issues/14894",
    "user": "https://github.com/vbraun"
}
```
Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.

Moreover, we also get access to the "error data" (a `t_ERROR` object) which we store in the exception.

Depends on #12142
Depends on #14873

CC:  @jdemeyer

Keywords: **pari error signal**

Branch/Commit: **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**

Reviewer: **Peter Bruin**

Author: **Jeroen Demeyer**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/14894_





---

archive/issue_events_211855.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-15T14:21:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211855"
}
```



---

archive/issue_events_211856.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-15T14:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211856"
}
```



---

archive/issue_events_211857.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-15T14:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211857"
}
```



---

archive/issue_events_211858.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-15T14:21:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211858"
}
```



---

archive/issue_events_211859.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-15T14:21:31Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211859"
}
```



---

archive/issue_comments_182662.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAh sorry, its dutch, not french. Too many variations of my own surname ;-)",
    "created_at": "2013-07-15T14:57:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182662",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

Ah sorry, its dutch, not french. Too many variations of my own surname ;-)



---

archive/issue_comments_182663.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@vbraun](#comment:2):\n> Ah sorry, its dutch, not french. Too many variations of my own surname ;-)\n\nKein Problem! 8-)",
    "created_at": "2013-07-15T15:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182663",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@vbraun](#comment:2):
> Ah sorry, its dutch, not french. Too many variations of my own surname ;-)

Kein Problem! 8-)



---

archive/issue_comments_182664.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182664",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_182665.json:
```json
{
    "body": "Dependencies: **#12142, #14873**",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182665",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#12142, #14873**



---

archive/issue_events_211860.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-07-16T09:26:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "title_is": "Fix PARI error handling (needed for future upgrade to PARI 2.6)",
    "title_was": "Update to Pari 2.6.0 (when its out) and fix error handling",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211860"
}
```



---

archive/issue_comments_182666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,39 @@\n-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage. See also https://github.com/sagemath/sage/issues/14873#comment:9 for a list of issues with the current approach.\n+Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n \n+This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n+\n+```\n+sage_pari_catch()\n+... code ...\n+sage_pari_catch_end()\n+```\n+Inside such a block one can put conditions like\n+\n+```\n+if [some condition]:\n+    sage_pari_catch_reset()\n+    [return or raise exception]\n+```\n+\n+The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n+\n+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of\n+\n+```\n+sig_on()\n+return new_gen(something returning GEN)\n+```\n+one therefore has to write\n+\n+```\n+cdef gen result\n+sage_pari_catch()\n+result = new_gen(something returning GEN)\n+sage_pari_catch_end()\n+return result\n+```\n+\n+This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.\n+\n+When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n+\n``````\n",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182666",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,39 @@
-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage. See also https://github.com/sagemath/sage/issues/14873#comment:9 for a list of issues with the current approach.
+Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
 
+This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
+
+```
+sage_pari_catch()
+... code ...
+sage_pari_catch_end()
+```
+Inside such a block one can put conditions like
+
+```
+if [some condition]:
+    sage_pari_catch_reset()
+    [return or raise exception]
+```
+
+The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
+
+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of
+
+```
+sig_on()
+return new_gen(something returning GEN)
+```
+one therefore has to write
+
+```
+cdef gen result
+sage_pari_catch()
+result = new_gen(something returning GEN)
+sage_pari_catch_end()
+return result
+```
+
+This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.
+
+When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
+
``````




---

archive/issue_comments_182667.json:
```json
{
    "body": "Changed keywords from none to **pari error signal**",
    "created_at": "2013-07-16T09:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182667",
    "user": "https://github.com/pjbruin"
}
```

Changed keywords from none to **pari error signal**



---

archive/issue_comments_182668.json:
```json
{
    "body": "new Cython macros for PARI error handling",
    "created_at": "2013-07-16T09:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182668",
    "user": "https://github.com/pjbruin"
}
```

new Cython macros for PARI error handling



---

archive/issue_comments_182669.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz)**\n\nmake gen.pyx use new PARI error handling macros",
    "created_at": "2013-07-16T09:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182669",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz)**

make gen.pyx use new PARI error handling macros



---

archive/issue_comments_182670.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch_gen.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz)**\n\nmake PARI finite field elements use new error handling macros",
    "created_at": "2013-07-16T09:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182670",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch_gen.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz)**

make PARI finite field elements use new error handling macros



---

archive/issue_comments_182671.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz)**\n\nnew PARI error handling for miscellaneous Cython code",
    "created_at": "2013-07-16T09:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182671",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz)**

new PARI error handling for miscellaneous Cython code



---

archive/issue_comments_182672.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch_misc.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz)**\n\ndelete old Cython macros for PARI error handling",
    "created_at": "2013-07-16T09:28:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182672",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch_misc.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz)**

delete old Cython macros for PARI error handling



---

archive/issue_events_211861.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-07-16T09:30:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211861"
}
```



---

archive/issue_comments_182673.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,3 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), \n``````\n",
    "created_at": "2013-07-16T09:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182673",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,3 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), 
``````




---

archive/issue_comments_182674.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_14894-pari_catch_delete_old.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)**",
    "created_at": "2013-07-16T09:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182674",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_14894-pari_catch_delete_old.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)**



---

archive/issue_comments_182675.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n \n-This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n+This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n \n ```\n sage_pari_catch()\n@@ -17,7 +17,7 @@\n \n The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n \n-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of\n+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of\n \n ```\n sig_on()\n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), \n+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)\n``````\n",
    "created_at": "2013-07-16T11:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182675",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
 
-This ticket reimplements PARI error handling inside Cython code using macros provided by 'pari/paricom.h' instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
+This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
 
 ```
 sage_pari_catch()
@@ -17,7 +17,7 @@
 
 The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
 
-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros, they `_must_` be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer automatically call `sig_off()`.  Instead of
+Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of
 
 ```
 sig_on()
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), 
+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)
``````




---

archive/issue_comments_182676.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLooks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run. Maybe Jeroen has an opinion?\n\nI would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.",
    "created_at": "2013-07-16T14:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182676",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run. Maybe Jeroen has an opinion?

I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.



---

archive/issue_comments_182677.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@vbraun](#comment:7):\n> Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run.\n\nThe new macros do require more keystrokes -- or things like `replace-regexp` in Emacs, which I ought to list as a co-author of these patches. 8-)  On the other hand, they make the code easier to understand in the sense that one doesn't have to remember or guess where the error catching block ends.\n\n> I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.\n\nIn fact, I spent quite a bit of thought on the names, and altogether, I think that there are good reasons for the `sage_pari_` prefix:\n\nMy first idea was `pari_catch` / `pari_endcatch` / `pari_catch_reset`.  Then I decided that this set of names looks better with `catch_end` than with `endcatch`.\n\nThe variable `sage_pari_catcherr` in your patch for #14873 then gave me the idea of prefixing the names with `sage_`.  It is true that this makes them a bit long (which is why I did not change `sage_pari_catch` to `sage_pari_catch_begin`).  But it is also true that they are non-trivial wrappers around the corresponding PARI macros that involve signal trapping, conversion of PARI errors to Python exceptions, and potentially retrying the same code several times until the stack is large enough.  I thought this justified the prefix `sage_` to make it clear that they are not the vanilla PARI macros but somewhat elaborate customised versions.\n\nAbout keeping the `pari` part of the name: I think it is important because these macros *are* used outside `sage/libs/pari`, so the name should indicate that they have a more specialised purpose than the generic `sig_on()` / `sig_off()`.  Currently they are used in a few places for integers, real and complex numbers, and integer and rational matrices.  The `FiniteField_pari_ffelt` class of #12142 heavily depends on them, and there are many other data types of which fast PARI implementations could be made (e.g. polynomials, power series rings and elliptic curves over finite fields), which would undoubtedly also use these macros.",
    "created_at": "2013-07-16T16:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182677",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@vbraun](#comment:7):
> Looks fine to me. We lose some syntactic sugar but get closer to the upstream coding convention, so it should make our live easier in the long run.

The new macros do require more keystrokes -- or things like `replace-regexp` in Emacs, which I ought to list as a co-author of these patches. 8-)  On the other hand, they make the code easier to understand in the sense that one doesn't have to remember or guess where the error catching block ends.

> I would have preferred some shorter names especially since they'll be used very frequently in the Pari library interface.  The file is part of the Sage library, so why prefix with `sage_`?. Maybe just `catch_begin` / `catch_end` / `catch_reset` since its usage should be pretty much only in `sage/libs/pari`.

In fact, I spent quite a bit of thought on the names, and altogether, I think that there are good reasons for the `sage_pari_` prefix:

My first idea was `pari_catch` / `pari_endcatch` / `pari_catch_reset`.  Then I decided that this set of names looks better with `catch_end` than with `endcatch`.

The variable `sage_pari_catcherr` in your patch for #14873 then gave me the idea of prefixing the names with `sage_`.  It is true that this makes them a bit long (which is why I did not change `sage_pari_catch` to `sage_pari_catch_begin`).  But it is also true that they are non-trivial wrappers around the corresponding PARI macros that involve signal trapping, conversion of PARI errors to Python exceptions, and potentially retrying the same code several times until the stack is large enough.  I thought this justified the prefix `sage_` to make it clear that they are not the vanilla PARI macros but somewhat elaborate customised versions.

About keeping the `pari` part of the name: I think it is important because these macros *are* used outside `sage/libs/pari`, so the name should indicate that they have a more specialised purpose than the generic `sig_on()` / `sig_off()`.  Currently they are used in a few places for integers, real and complex numbers, and integer and rational matrices.  The `FiniteField_pari_ffelt` class of #12142 heavily depends on them, and there are many other data types of which fast PARI implementations could be made (e.g. polynomials, power series rings and elliptic curves over finite fields), which would undoubtedly also use these macros.



---

archive/issue_comments_182678.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)\n+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)\n``````\n",
    "created_at": "2013-07-22T14:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182678",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz)
+Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)
``````




---

archive/issue_comments_182679.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI'm attaching one more patch, which I hope will be the last one for this ticket.  It makes the C macros as simple as possible and moves the handling of `pari_errno` to a single Cython function `pari_handle_error`.",
    "created_at": "2013-07-22T14:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182679",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

I'm attaching one more patch, which I hope will be the last one for this ticket.  It makes the C macros as simple as possible and moves the handling of `pari_errno` to a single Cython function `pari_handle_error`.



---

archive/issue_comments_182680.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOne other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.  It works nicely, but I'm not sure that it is useful for `gen.pyx`, since it will probably slow things down.  On the other hand, it might be useful later for new code that is less speed-critical.  I am thinking of creating a patch implementing this (in a new ticket) sometime in the future.",
    "created_at": "2013-07-22T14:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182680",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.  It works nicely, but I'm not sure that it is useful for `gen.pyx`, since it will probably slow things down.  On the other hand, it might be useful later for new code that is less speed-critical.  I am thinking of creating a patch implementing this (in a new ticket) sometime in the future.



---

archive/issue_comments_182681.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOne recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.\n\nWhat about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?",
    "created_at": "2013-07-24T07:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182681",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.

What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?



---

archive/issue_comments_182682.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@pjbruin](#comment:10):\n> One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.\n\nSince this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.",
    "created_at": "2013-07-24T07:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182682",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@pjbruin](#comment:10):
> One other thing I experimented with is a decorator `@pari_catch_function`, which wraps the function in `sage_pari_catch()...sage_pari_catch_end()`.

Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.



---

archive/issue_comments_182683.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAlso, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:\n\n```\n    sage_pari_catch()\n    return new_gen(something returning GEN)\n```",
    "created_at": "2013-07-24T07:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182683",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:

```
    sage_pari_catch()
    return new_gen(something returning GEN)
```



---

archive/issue_comments_182684.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:11):\n> One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.\n\nAs I understand it, the two purposes of `sage_pari_catch()` are equally important, namely\n- catching signals\n- catching PARI errors.\nIt would be nice to have a name that mirror this.  Maybe the prefix `sage_` is somewhat redundant, as Volker Braun suggested, and we could call them `pari_catch_on()` and `pari_catch_off()`?\n\n> What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?\n\nDo these have the same two purposes as above?  In that case, I would find the names `pari_sig_on()` and `pari_sig_off()` acceptable for the sake of consistency, but in principle I dislike the fact that they don't hint at the fact that these macros catch PARI errors and not just signals.",
    "created_at": "2013-07-24T11:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182684",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:11):
> One recomendation: could you use other names than `sage_pari_catch`, something which clearly refers to `sig_on()`, since `sage_pari_catch()` really is an extension of `sig_on()`.

As I understand it, the two purposes of `sage_pari_catch()` are equally important, namely
- catching signals
- catching PARI errors.
It would be nice to have a name that mirror this.  Maybe the prefix `sage_` is somewhat redundant, as Volker Braun suggested, and we could call them `pari_catch_on()` and `pari_catch_off()`?

> What about `pari_sig_on()` and `pari_sig_off()` which would mirror `ecl_sig_on()` and `ecl_sig_off()` which we already have?

Do these have the same two purposes as above?  In that case, I would find the names `pari_sig_on()` and `pari_sig_off()` acceptable for the sake of consistency, but in principle I dislike the fact that they don't hint at the fact that these macros catch PARI errors and not just signals.



---

archive/issue_comments_182685.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment:12):\n> Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.\n\nMaybe I can convince you by giving the definition of the decorator:\n\n```\ndef pari_catch_function(f):\n    \"\"\"\n    Decorator to wrap a function in sage_pari_catch() ... sage_pari_catch_end().\n    \"\"\"\n    def g(*args):\n        cdef object _x\n        sage_pari_catch()\n        _x = f(*args)\n        sage_pari_catch_end()\n        return _x\n    return g\n```\nI put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.\n\nSomething that I do *not* see how to do easily, on the other hand, is a context guard (context manager) for use with the `with` statement, i.e.\n\n```\nwith pari_catch:\n    ...code...\n```\ngiving you catching of PARI errors and signals within the block.",
    "created_at": "2013-07-24T11:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182685",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment:12):
> Since this is low-level C code, I cannot believe a decorator (which is on the level of Python) would work.

Maybe I can convince you by giving the definition of the decorator:

```
def pari_catch_function(f):
    """
    Decorator to wrap a function in sage_pari_catch() ... sage_pari_catch_end().
    """
    def g(*args):
        cdef object _x
        sage_pari_catch()
        _x = f(*args)
        sage_pari_catch_end()
        return _x
    return g
```
I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.

Something that I do *not* see how to do easily, on the other hand, is a context guard (context manager) for use with the `with` statement, i.e.

```
with pari_catch:
    ...code...
```
giving you catching of PARI errors and signals within the block.



---

archive/issue_comments_182686.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:\n> \n> ```\n>     sage_pari_catch()\n>     return new_gen(something returning GEN)\n> ```\n\nI see that this would be desirable because it saves typing a few lines each time.  On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.  The fact that the macros contain complementary braces makes them less flexible, but make it clearer where the error-catching block ends.\n\nActually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.  This would force us at the same time to avoid complementary braces, which can be a good thing or not (we seem to disagree on this).  However, there are two real disadvantages to this approach:\n- it won't translate into simple C code and will certainly be slower;\n- we cannot use the macros that PARI provides, and instead hack something ourselves that uses `alloca()`, `malloc()` or a global variable to allocate the `jmp_buf` (stack environment for use with `sigjmp()`); otherwise it will disappear from the scope.  This is exactly the problem that this ticket tries to solve.",
    "created_at": "2013-07-24T11:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182686",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> Also, I really don't like that `sage_pari_catch()` and `sage_pari_catch_end()` contain complementaty braces. I would strongly recommend to try to keep the following working as before:
> 
> ```
>     sage_pari_catch()
>     return new_gen(something returning GEN)
> ```

I see that this would be desirable because it saves typing a few lines each time.  On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.  The fact that the macros contain complementary braces makes them less flexible, but make it clearer where the error-catching block ends.

Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.  This would force us at the same time to avoid complementary braces, which can be a good thing or not (we seem to disagree on this).  However, there are two real disadvantages to this approach:
- it won't translate into simple C code and will certainly be slower;
- we cannot use the macros that PARI provides, and instead hack something ourselves that uses `alloca()`, `malloc()` or a global variable to allocate the `jmp_buf` (stack environment for use with `sigjmp()`); otherwise it will disappear from the scope.  This is exactly the problem that this ticket tries to solve.



---

archive/issue_comments_182687.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOne last comment for now: when I was working on this ticket I realised that a language feature that would give a good solution for this problem would be Lisp-style macros (so one could pass a \"quoted\" piece of code to a macro that does `catch_on()`, evaluates the code, and does `catch_off()`).  Unfortunately this is something that Python doesn't have; the closest thing is the decorator described above, but it only works for entire functions.",
    "created_at": "2013-07-24T12:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182687",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

One last comment for now: when I was working on this ticket I realised that a language feature that would give a good solution for this problem would be Lisp-style macros (so one could pass a "quoted" piece of code to a macro that does `catch_on()`, evaluates the code, and does `catch_off()`).  Unfortunately this is something that Python doesn't have; the closest thing is the decorator described above, but it only works for entire functions.



---

archive/issue_comments_182688.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI also don't like the unbalanced-bracket-hack. But, since Pari sets up its error catching framework that way, we should go with it, ugly or not.\n\nThen I agree with Peter that the name should be different form `sig_on`/`off` precisely because it has different semantics.\n\nI don't really see the need for getting too fancy with context managers or decorators, the pari error try/catch should essentially only be used in `sage.libs.pari` and nowhere else in the Sage tree. And that is precisely where you wouldn't want to take any performance hit for one of the more fancy solutions.",
    "created_at": "2013-07-24T23:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182688",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

I also don't like the unbalanced-bracket-hack. But, since Pari sets up its error catching framework that way, we should go with it, ugly or not.

Then I agree with Peter that the name should be different form `sig_on`/`off` precisely because it has different semantics.

I don't really see the need for getting too fancy with context managers or decorators, the pari error try/catch should essentially only be used in `sage.libs.pari` and nowhere else in the Sage tree. And that is precisely where you wouldn't want to take any performance hit for one of the more fancy solutions.



---

archive/issue_comments_182689.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@pjbruin](#comment:16):\n> Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.\n\nSure, but that needs some Cython patches, so it's not possible now.",
    "created_at": "2013-07-25T06:33:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182689",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@pjbruin](#comment:16):
> Actually, as far as I'm concerned it would be even nicer if we could have the `with` syntax as in my previous comment.

Sure, but that needs some Cython patches, so it's not possible now.



---

archive/issue_comments_182690.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@pjbruin](#comment:15):\n> I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.\n\nSince `_x = f(*args)` is evaluated through Python (not C), it will badly break the Python interpreter if interrupted at the wrong time.",
    "created_at": "2013-07-25T06:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182690",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@pjbruin](#comment:15):
> I put this in a Cython file and tested it.  It works, but probably it is not very good for efficiency.

Since `_x = f(*args)` is evaluated through Python (not C), it will badly break the Python interpreter if interrupted at the wrong time.



---

archive/issue_comments_182691.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch_simplify.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)**\n\nsimplify macros, do pari_errno handling in gen.pyx:pari_handle_error",
    "created_at": "2013-07-29T21:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182691",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch_simplify.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)**

simplify macros, do pari_errno handling in gen.pyx:pari_handle_error



---

archive/issue_comments_182692.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nIn the previous version of [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz) I tried to move the `except *` from `sage_pari_catch()` to `sage_pari_catch_end()`.  This was fine for catching PARI errors, but turned out to break interrupt handling, so I reverted this change.",
    "created_at": "2013-07-29T21:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182692",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

In the previous version of [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz) I tried to move the `except *` from `sage_pari_catch()` to `sage_pari_catch_end()`.  This was fine for catching PARI errors, but turned out to break interrupt handling, so I reverted this change.



---

archive/issue_comments_182693.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAbout the names for the macros: how about `pari_catch_on()` and `pari_catch_off()`?\n\nAdvantages:\n- not too long\n- reminiscent of `sig_on()` and `sig_off()`\n- do not suggest that the sole purpose is handling signals (as opposed to PARI errors)",
    "created_at": "2013-08-05T14:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182693",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:22" align="right">comment:22</div>

About the names for the macros: how about `pari_catch_on()` and `pari_catch_off()`?

Advantages:
- not too long
- reminiscent of `sig_on()` and `sig_off()`
- do not suggest that the sole purpose is handling signals (as opposed to PARI errors)



---

archive/issue_comments_182694.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@pjbruin](#comment:22):\n> - reminiscent of `sig_on()` and `sig_off()`\n\nIn my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.\n\n> I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.\n\nThat might be true, but in this case I don't think it justifies the overcomplication of two-liners like\n\n```\nsig_on() \nreturn P.new_gen(gcos(x.g, pbw(precision))) \n```\nto the five-liner\n\n```\ncdef gen result_gen \nsage_pari_catch() \nresult_gen = P.new_gen(gcos(x.g, pbw(precision))) \nsage_pari_catch_end() \nreturn result_gen \n```",
    "created_at": "2013-08-13T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182694",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@pjbruin](#comment:22):
> - reminiscent of `sig_on()` and `sig_off()`

In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.

> I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.

That might be true, but in this case I don't think it justifies the overcomplication of two-liners like

```
sig_on() 
return P.new_gen(gcos(x.g, pbw(precision))) 
```
to the five-liner

```
cdef gen result_gen 
sage_pari_catch() 
result_gen = P.new_gen(gcos(x.g, pbw(precision))) 
sage_pari_catch_end() 
return result_gen 
```



---

archive/issue_comments_182695.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nFor reviewing purposes, could you please fold all patches into one? Because some later patches rewrite stuff from older patches.",
    "created_at": "2013-08-13T12:26:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182695",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

For reviewing purposes, could you please fold all patches into one? Because some later patches rewrite stuff from older patches.



---

archive/issue_comments_182696.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAfter looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).",
    "created_at": "2013-08-13T12:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182696",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).



---

archive/issue_events_211862.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T12:37:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211862"
}
```



---

archive/issue_events_211863.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T12:37:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211863"
}
```



---

archive/issue_comments_182697.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2013-08-13T12:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182697",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_182698.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Replying to [@pjbruin](#comment:22):\n> > - reminiscent of `sig_on()` and `sig_off()`\n\n> In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.\n\nBut why?  When I started looking at `gen.pyx`, the names `sig_on()` and `sig_off()` really confused me, because they suggest that they are just signal handling macros.  It seems to me that in practice, PARI errors (e.g. zero division) occur more often than signals, so the names should not suggest otherwise.  If you ask me, this problem is not fixed by renaming them `pari_sig_on()` and `pari_sig_off()`.\n\n> > I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.\n\n> That might be true, but in this case I don't think it justifies the overcomplication of two-liners like [...] to the five-liner [...]\n\nI can't say I'm completely happy with the code increase, either, and by now I'm really inclined to try one of two opposite strategies:\n- either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` (as in [comment:15](#comment:15)) would be ideal, and perhaps the overhead is not so big compared to the overhead that we already have by using Cython;\n- or translate this part of `gen.pyx` from Cython to C, both for speed and to be able to use a macro for signal and error handling.  This macro, say `pari_catch_wrap()`, should call `pari_catch_on()`, execute `code` (and remember its return value), call `pari_catch_off()` and return the return value of `code`, so one could type (in C)\n\n```\nreturn pari_catch_wrap(code);\n```\n\n> After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).\n\nThere is a trade-off between execution time and developer time here.\n\nWhat you suggest seems to require a new set of macros, merging `sig_on()/sig_off()` and PARI's error handling macros, that only do one `sigsetjmp()` but then have to distinguish within the error-handling code whether a signal or a PARI error occurred.\n\nI would hope that `setjmp()` is very fast on most systems, so that it doesn't really hurt to use it twice: once to set up signal handling and once to set up PARI error handling.  I would certainly be happy to pay this price in order to cleanly separate between handling signals and handling PARI errors.",
    "created_at": "2013-08-13T13:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182698",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment:23):
> Replying to [@pjbruin](#comment:22):
> > - reminiscent of `sig_on()` and `sig_off()`

> In my opinion, not sufficiently reminiscent..., I still prefer `pari_sig_on()` and `pari_sig_off()`.

But why?  When I started looking at `gen.pyx`, the names `sig_on()` and `sig_off()` really confused me, because they suggest that they are just signal handling macros.  It seems to me that in practice, PARI errors (e.g. zero division) occur more often than signals, so the names should not suggest otherwise.  If you ask me, this problem is not fixed by renaming them `pari_sig_on()` and `pari_sig_off()`.

> > I see that this would be desirable because it saves typing a few lines each time. On the other hand, I think the above code is bad style because it explicity begins a block, but implicity ends it.

> That might be true, but in this case I don't think it justifies the overcomplication of two-liners like [...] to the five-liner [...]

I can't say I'm completely happy with the code increase, either, and by now I'm really inclined to try one of two opposite strategies:
- either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` (as in [comment:15](#comment:15)) would be ideal, and perhaps the overhead is not so big compared to the overhead that we already have by using Cython;
- or translate this part of `gen.pyx` from Cython to C, both for speed and to be able to use a macro for signal and error handling.  This macro, say `pari_catch_wrap()`, should call `pari_catch_on()`, execute `code` (and remember its return value), call `pari_catch_off()` and return the return value of `code`, so one could type (in C)

```
return pari_catch_wrap(code);
```

> After looking at the PARI 2.6 sources, I think the best solution for Sage would be to use the (admittedly undocumented) variable `iferr_env` from PARI. Because the `pari_CATCH` stuff is re-doing a `setjmp()` call which Sage's `sig_on()` already does. This is bad, for example for performance reasons (I made a lot of effort in making `sig_on()` fast).

There is a trade-off between execution time and developer time here.

What you suggest seems to require a new set of macros, merging `sig_on()/sig_off()` and PARI's error handling macros, that only do one `sigsetjmp()` but then have to distinguish within the error-handling code whether a signal or a PARI error occurred.

I would hope that `setjmp()` is very fast on most systems, so that it doesn't really hurt to use it twice: once to set up signal handling and once to set up PARI error handling.  I would certainly be happy to pay this price in order to cleanly separate between handling signals and handling PARI errors.



---

archive/issue_comments_182699.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@pjbruin](#comment:27):\n> - either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` would be ideal\n\nOf course this would be ideal. But as I said, this needs Cython patches. I recently looked into this for implementing `sig_on()` and it currently cannot be done in Cython.\n\n> What you suggest seems to require a new set of macros, merging sig_on()/sig_off() and PARI's error handling macros, that only do one sigsetjmp() but then have to distinguish within the error-handling code whether a signal or a PARI error occurred. \n\nExactly. I know it's far from trivial, otherwise I would have done it already in the past. But I can say that I **thought** a lot about signal/error handling.\n\n> I would hope that setjmp() is very fast on most systems\n\nIt's not. I remember it being particularly slow on BSD (and therefore OS X) systems.",
    "created_at": "2013-08-13T14:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182699",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@pjbruin](#comment:27):
> - either find out how (in)efficient context managers (the `with` statement) are in Cython; I still think being able to say `with pari_catch: code` would be ideal

Of course this would be ideal. But as I said, this needs Cython patches. I recently looked into this for implementing `sig_on()` and it currently cannot be done in Cython.

> What you suggest seems to require a new set of macros, merging sig_on()/sig_off() and PARI's error handling macros, that only do one sigsetjmp() but then have to distinguish within the error-handling code whether a signal or a PARI error occurred. 

Exactly. I know it's far from trivial, otherwise I would have done it already in the past. But I can say that I **thought** a lot about signal/error handling.

> I would hope that setjmp() is very fast on most systems

It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.



---

archive/issue_comments_182700.json:
```json
{
    "body": "Attachment: **[trac_14894-pari_catch-folded.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)**\n\nunified patch combining all the above patches",
    "created_at": "2013-08-13T14:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182700",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_14894-pari_catch-folded.patch.gz](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)**

unified patch combining all the above patches



---

archive/issue_comments_182701.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment:28):\n> Replying to [@pjbruin](#comment:27):\n> > I would hope that setjmp() is very fast on most systems\n\n> It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.\n\nI just found a discussion about this on the pari-dev mailing list: [http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html).\n\nThe reason is that in BSD, `setjmp()` saves the signal mask (which apparently is very expensive), while in System V-like systems it does not.  BSD does have `_setjmp()` and `sigsetjmp(, 0)`, which are comparable to `setjmp()` on other systems.  According to the link above, the `setjmp()` variant that does not touch the signal mask is 2.5 to 12 times as fast as the one that does.\n\nOf course, for signal handling you are stuck with the slow version, but for other purposes one could use the fast version.  In our situation the question is whether we do one slow system call, or the slow one for signal handling plus the fast one for handling PARI errors.\n\nFinally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.  This doesn't currently seem to be implemented, though.",
    "created_at": "2013-08-13T14:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182701",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment:28):
> Replying to [@pjbruin](#comment:27):
> > I would hope that setjmp() is very fast on most systems

> It's not. I remember it being particularly slow on BSD (and therefore OS X) systems.

I just found a discussion about this on the pari-dev mailing list: [http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-0909/msg00007.html).

The reason is that in BSD, `setjmp()` saves the signal mask (which apparently is very expensive), while in System V-like systems it does not.  BSD does have `_setjmp()` and `sigsetjmp(, 0)`, which are comparable to `setjmp()` on other systems.  According to the link above, the `setjmp()` variant that does not touch the signal mask is 2.5 to 12 times as fast as the one that does.

Of course, for signal handling you are stuck with the slow version, but for other purposes one could use the fast version.  In our situation the question is whether we do one slow system call, or the slow one for signal handling plus the fast one for handling PARI errors.

Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.  This doesn't currently seem to be implemented, though.



---

archive/issue_comments_182702.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@pjbruin](#comment:29):\n> Of course, for signal handling you are stuck with the slow version\n\nFalse :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.\n\n> Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.\n\nI think this would be very good for Sage. I personally wouldn't mind patching that in ourselves in the Sage version of PARI.",
    "created_at": "2013-08-13T15:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182702",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@pjbruin](#comment:29):
> Of course, for signal handling you are stuck with the slow version

False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.

> Finally, the discussion cited above mentions the idea of letting the user of the PARI library specify a function to call when an error occurs instead of the `setjmp()/longjmp()` construction.

I think this would be very good for Sage. I personally wouldn't mind patching that in ourselves in the Sage version of PARI.



---

archive/issue_comments_182703.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n \n When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n \n-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)\n+Apply: [attachment: trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)\n``````\n",
    "created_at": "2013-08-13T15:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182703",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 
 When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
 
-Apply: [attachment: trac_14894-pari_catch.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch.patch.gz), [attachment: trac_14894-pari_catch_gen.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_gen.patch.gz), [attachment: trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_FiniteFieldElement_pari_ffelt.patch.gz), [attachment: trac_14894-pari_catch_misc.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_misc.patch.gz), [attachment: trac_14894-pari_catch_delete_old.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_delete_old.patch.gz), [attachment: trac_14894-pari_catch_simplify.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch_simplify.patch.gz)
+Apply: [attachment: trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)
``````




---

archive/issue_comments_182704.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment:30):\n> Replying to [@pjbruin](#comment:29):\n> > Of course, for signal handling you are stuck with the slow version\n\n> False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.\n\nOK, I read the code too carelessly.  But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well, so the slowness of `setjmp()` on BSD should be irrelevant.  The try/catch macros provided by PARI do use a plain `setjmp()`, but that should be easy to change.\n\nAnyway, if a non-`setjmp()`-based approach is feasible, that would be great.  It would probably still be quite non-trivial, though.",
    "created_at": "2013-08-13T15:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182704",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment:30):
> Replying to [@pjbruin](#comment:29):
> > Of course, for signal handling you are stuck with the slow version

> False :-)  Sage's `sig_on()` uses `sigsetjmp(env,0)`. It manually resets the signal mask when actually handling an error.

OK, I read the code too carelessly.  But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well, so the slowness of `setjmp()` on BSD should be irrelevant.  The try/catch macros provided by PARI do use a plain `setjmp()`, but that should be easy to change.

Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.  It would probably still be quite non-trivial, though.



---

archive/issue_comments_182705.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@pjbruin](#comment:32):\n> But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well\n\n> Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.\n\nBoth of these require patching the PARI sources, and then I prefer the second approach for simplicity.",
    "created_at": "2013-08-13T15:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182705",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@pjbruin](#comment:32):
> But if you can simply use `sigsetjmp(env, 0)` for signal handling, then surely you can use it for handling PARI errors as well

> Anyway, if a non-`setjmp()`-based approach is feasible, that would be great.

Both of these require patching the PARI sources, and then I prefer the second approach for simplicity.



---

archive/issue_comments_182706.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nActually, in `[PARI source]/language/init.c` (and in the header file `paricom.h`) there is a declaration\n\n```\nint  (*cb_pari_handle_exception)(long);\n```\nif this is non-zero, `pari_err()` calls it (with an error code as argument) when no saved environment is present to do a `longjmp()` to.  I could imagine setting this to a Cython function that converts a PARI error into an appropriate Python exception, and raising that exception.\n\nIt appears that the function to which `cb_pari_handle_exception` points should return non-zero if and only if the error was handled succesfully; if it was, `pari_err()` simply returns.  However, functions calling `pari_err()` normally expect that function not to return, so as things stand now, a suitable `setjmp()/longjmp()` would still seem to be necessary.",
    "created_at": "2013-08-13T16:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182706",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:34" align="right">comment:34</div>

Actually, in `[PARI source]/language/init.c` (and in the header file `paricom.h`) there is a declaration

```
int  (*cb_pari_handle_exception)(long);
```
if this is non-zero, `pari_err()` calls it (with an error code as argument) when no saved environment is present to do a `longjmp()` to.  I could imagine setting this to a Cython function that converts a PARI error into an appropriate Python exception, and raising that exception.

It appears that the function to which `cb_pari_handle_exception` points should return non-zero if and only if the error was handled succesfully; if it was, `pari_err()` simply returns.  However, functions calling `pari_err()` normally expect that function not to return, so as things stand now, a suitable `setjmp()/longjmp()` would still seem to be necessary.



---

archive/issue_comments_182707.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAnd just now I discovered that as long ago as #9640, you (Jeroen) were already saying that we should use `cb_pari_handle_exception` to catch PARI errors...",
    "created_at": "2013-08-13T16:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182707",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:35" align="right">comment:35</div>

And just now I discovered that as long ago as #9640, you (Jeroen) were already saying that we should use `cb_pari_handle_exception` to catch PARI errors...



---

archive/issue_comments_182708.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nIn any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.",
    "created_at": "2013-08-14T08:24:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182708",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.



---

archive/issue_comments_182709.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment:36):\n> In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.\n\nThe current implementation has its problems (see the ticket description), but I know of nothing that is broken in practice.  Whether to do it now or during the upgrade depends on which solution is chosen.\n- Option 1: use the try/catch macros provided by PARI.  This we can do now, and it will make the upgrade easier, since similar macros are provided in 2.6 (albeit with slightly different names and a different implementation).\n- Option 2: keep using undocumented PARI functions/variables.  This can only be done at the same time as the upgrade, since the internals have changed a lot in 2.6.\nOption 1 is what the current patch does, and I still prefer this option.",
    "created_at": "2013-08-14T13:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182709",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment:36):
> In any case, is this urgent at all? I think it makes more sense to do this as part of the upgrade to PARI-2.6, because PARI-2.6 does change the error handling mechanism quite a bit.

The current implementation has its problems (see the ticket description), but I know of nothing that is broken in practice.  Whether to do it now or during the upgrade depends on which solution is chosen.
- Option 1: use the try/catch macros provided by PARI.  This we can do now, and it will make the upgrade easier, since similar macros are provided in 2.6 (albeit with slightly different names and a different implementation).
- Option 2: keep using undocumented PARI functions/variables.  This can only be done at the same time as the upgrade, since the internals have changed a lot in 2.6.
Option 1 is what the current patch does, and I still prefer this option.



---

archive/issue_comments_182710.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOr option 3: patch PARI to hack the error handling functions.",
    "created_at": "2013-08-30T09:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182710",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Or option 3: patch PARI to hack the error handling functions.



---

archive/issue_comments_182711.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nPart of this should be done now for use in #14888: making the `pari_sig_on()` macros available, see #15124.",
    "created_at": "2013-08-30T10:01:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182711",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Part of this should be done now for use in #14888: making the `pari_sig_on()` macros available, see #15124.



---

archive/issue_comments_182712.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).",
    "created_at": "2013-08-30T11:56:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182712",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).



---

archive/issue_comments_182713.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jdemeyer](#comment:40):\n> I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).\n\nThere is the callback function `cb_pari_handle_exception`, but I don't quite see how to use this without any `longjmp()`; see [comment:34](#comment:34).  Hence two questions:\n- Would a new callback function really be needed (e.g. because it has to be called at a different moment than `cb_pari_handle_exception`)?\n- Does the option 3 that you have in mind somehow avoid `longjmp()`, or do you propose to do the `longjmp()` inside a common error-handling function for signals and PARI errors?",
    "created_at": "2013-08-30T12:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182713",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jdemeyer](#comment:40):
> I asked `pari-dev` about a callback function instead of `longjmp()` for PARI error handling (i.e. option 3 above).

There is the callback function `cb_pari_handle_exception`, but I don't quite see how to use this without any `longjmp()`; see [comment:34](#comment:34).  Hence two questions:
- Would a new callback function really be needed (e.g. because it has to be called at a different moment than `cb_pari_handle_exception`)?
- Does the option 3 that you have in mind somehow avoid `longjmp()`, or do you propose to do the `longjmp()` inside a common error-handling function for signals and PARI errors?



---

archive/issue_comments_182714.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@pjbruin](#comment:41):\n> There is the callback function `cb_pari_handle_exception`\n\nThe problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.\n\nMy approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.",
    "created_at": "2013-08-30T13:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182714",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@pjbruin](#comment:41):
> There is the callback function `cb_pari_handle_exception`

The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.

My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.



---

archive/issue_comments_182715.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@jdemeyer](#comment:42):\n> Replying to [@pjbruin](#comment:41):\n> > There is the callback function `cb_pari_handle_exception`\n\n> The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.\n\nCouldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\n> My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.\n\nGood, that is what I suspected.",
    "created_at": "2013-08-30T14:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182715",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@jdemeyer](#comment:42):
> Replying to [@pjbruin](#comment:41):
> > There is the callback function `cb_pari_handle_exception`

> The problem with that callback is that it is called after printing the error message. For Sage, we don't want the error to be printed.

Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

> My approach would still use a `longjmp()` to jump to the `setjmp()` inside `sig_on()`. It would avoid an additional `setjmp()` call for PARI.

Good, that is what I suspected.



---

archive/issue_comments_182716.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@pjbruin](#comment:43):\n> Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\nThat was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.",
    "created_at": "2013-08-30T14:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182716",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@pjbruin](#comment:43):
> Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.



---

archive/issue_comments_182717.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jdemeyer](#comment:44):\n> Replying to [@pjbruin](#comment:43):\n> > Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.\n\n> That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.\n\nI see.  But wouldn't it be a more satisfactory solution to have PARI do those things only if the output is connected to a terminal (using `isatty`)?  This would still require a patch, of course.",
    "created_at": "2013-08-30T17:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182717",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jdemeyer](#comment:44):
> Replying to [@pjbruin](#comment:43):
> > Couldn't we prevent printing the error message by using a custom `pariErr` like we already do for `pariOut`?  Besides not having to patch PARI to add another callback, this has the additional advantage that the error text can be stored for possible inspection.

> That was my original idea but there are some complications, for example the printing of an extra newline in `err_init()` and the use of ANSI escape sequences for colours.

I see.  But wouldn't it be a more satisfactory solution to have PARI do those things only if the output is connected to a terminal (using `isatty`)?  This would still require a patch, of course.



---

archive/issue_events_211864.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211864"
}
```



---

archive/issue_events_211865.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211865"
}
```



---

archive/issue_events_211866.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-02T14:06:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "title_is": "Fix PARI error handling for PARI 2.6",
    "title_was": "Fix PARI error handling (needed for future upgrade to PARI 2.6)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211866"
}
```



---

archive/issue_events_211867.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-11-22T23:22:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211867"
}
```



---

archive/issue_events_211868.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-11-22T23:22:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211868"
}
```



---

archive/issue_comments_182718.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nNow that we have a better error-handling mechanism (#9640), is there anything specific that needs to be done in this area when upgrading PARI?  Should this rather become a general PARI upgrade ticket, or be closed as a duplicate of #9640?\n\nAlso, do we want to upgrade to PARI 2.6.x or wait for 2.7.x (even minor version = development, odd = stable)?  In January there will be an \"Atelier PARI/GP\" where planning for PARI 2.9 is on the agenda (http://pari.math.u-bordeaux.fr/Events/PARI2014/), which suggests that a 2.7 release is in the pipeline.",
    "created_at": "2013-11-22T23:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182718",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:47" align="right">comment:47</div>

Now that we have a better error-handling mechanism (#9640), is there anything specific that needs to be done in this area when upgrading PARI?  Should this rather become a general PARI upgrade ticket, or be closed as a duplicate of #9640?

Also, do we want to upgrade to PARI 2.6.x or wait for 2.7.x (even minor version = development, odd = stable)?  In January there will be an "Atelier PARI/GP" where planning for PARI 2.9 is on the agenda (http://pari.math.u-bordeaux.fr/Events/PARI2014/), which suggests that a 2.7 release is in the pipeline.



---

archive/issue_comments_182719.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI would say: let this ticket quietly sit here and let's look at it again when PARI-2.7 is released.",
    "created_at": "2013-11-23T10:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182719",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

I would say: let this ticket quietly sit here and let's look at it again when PARI-2.7 is released.



---

archive/issue_comments_182720.json:
```json
{
    "body": "Changed author from **Peter Bruin** to none",
    "created_at": "2014-08-18T23:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182720",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Peter Bruin** to none



---

archive/issue_comments_182721.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nIn the light of #9640 and #15767, I think this ticket is no longer relevant and suggest to close it.",
    "created_at": "2014-08-18T23:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182721",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:49" align="right">comment:49</div>

In the light of #9640 and #15767, I think this ticket is no longer relevant and suggest to close it.



---

archive/issue_events_211869.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211869"
}
```



---

archive/issue_events_211870.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211870"
}
```



---

archive/issue_events_211871.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211871"
}
```



---

archive/issue_events_211872.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211872"
}
```



---

archive/issue_events_211873.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:08:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211873"
}
```



---

archive/issue_comments_182722.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI think that this ticket is still relevant, since PARI-2.7.x has improved error handling mechanisms which we don't use.",
    "created_at": "2014-08-19T08:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182722",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

I think that this ticket is still relevant, since PARI-2.7.x has improved error handling mechanisms which we don't use.



---

archive/issue_comments_182723.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI think we do need to reconsider the approach though. Personally I like to use Karim's proposal from [http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html), but that hasn't been implemented upstream yet.",
    "created_at": "2014-08-19T08:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182723",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

I think we do need to reconsider the approach though. Personally I like to use Karim's proposal from [http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1309/msg00002.html), but that hasn't been implemented upstream yet.



---

archive/issue_events_211874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "title_is": "Fix PARI error handling for PARI 2.7",
    "title_was": "Fix PARI error handling for PARI 2.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211874"
}
```



---

archive/issue_events_211875.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211875"
}
```



---

archive/issue_events_211876.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211876"
}
```



---

archive/issue_comments_182724.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2014-08-19T08:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182724",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Peter Bruin**



---

archive/issue_events_211877.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-19T08:44:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211877"
}
```



---

archive/issue_comments_182725.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI'm willing to look into this ticket, but not right now.",
    "created_at": "2014-08-19T08:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182725",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

I'm willing to look into this ticket, but not right now.



---

archive/issue_events_211878.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T16:06:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211878"
}
```



---

archive/issue_events_211879.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T16:06:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211879"
}
```



---

archive/issue_comments_182726.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,40 +1 @@\n-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.\n-\n-This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is\n-\n-```\n-sage_pari_catch()\n-... code ...\n-sage_pari_catch_end()\n-```\n-Inside such a block one can put conditions like\n-\n-```\n-if [some condition]:\n-    sage_pari_catch_reset()\n-    [return or raise exception]\n-```\n-\n-The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.\n-\n-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of\n-\n-```\n-sig_on()\n-return new_gen(something returning GEN)\n-```\n-one therefore has to write\n-\n-```\n-cdef gen result\n-sage_pari_catch()\n-result = new_gen(something returning GEN)\n-sage_pari_catch_end()\n-return result\n-```\n-\n-This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.\n-\n-When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.\n-\n-Apply: [attachment: trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)\n+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.\n``````\n",
    "created_at": "2015-01-13T16:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182726",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,40 +1 @@
-Pari GIT has made significant changes to the error handling code, which will require us to make some changes to Sage.
-
-This ticket reimplements PARI error handling inside Cython code using macros provided by `pari/paricom.h` instead of undocumented functions that no longer exist in PARI 2.6.  The new syntax is
-
-```
-sage_pari_catch()
-... code ...
-sage_pari_catch_end()
-```
-Inside such a block one can put conditions like
-
-```
-if [some condition]:
-    sage_pari_catch_reset()
-    [return or raise exception]
-```
-
-The new functions catch PARI errors and also call `sig_on()` and `sig_off()` to enable interrupt handling.  This replaces the current hack of overriding `sig_on()` and `sig_off()`.
-
-Since `sage_pari_catch()` and `sage_pari_catch_end()` are C macros containing complementary braces, they *must* be on the same level in Cython code.  This means that several functions in `sage/libs/pari/gen.pyx`, most importantly `new_gen()`, no longer call `sig_off()` or its replacement `sage_pari_catch_end()`.  Instead of
-
-```
-sig_on()
-return new_gen(something returning GEN)
-```
-one therefore has to write
-
-```
-cdef gen result
-sage_pari_catch()
-result = new_gen(something returning GEN)
-sage_pari_catch_end()
-return result
-```
-
-This new approach fixes several (potential) problems with the existing one; see https://github.com/sagemath/sage/issues/14873#comment:9.
-
-When upgrading to PARI 2.6, the only remaining change to be made (hopefully) is to replace the macros `CATCH`, `ENDCATCH`, `RETRY` and `CATCH_RELEASE` by `pari_CATCH`, `pari_ENDCATCH`, `pari_RETRY` and `pari_CATCH_reset`.
-
-Apply: [attachment: trac_14894-pari_catch-folded.patch](https://github.com/sagemath/sage/files/ticket14894/trac_14894-pari_catch-folded.patch.gz)
+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.
``````




---

archive/issue_comments_182727.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)**",
    "created_at": "2015-01-13T17:23:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182727",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)**



---

archive/issue_comments_182728.json:
```json
{
    "body": "Commit: **[`0602271`](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)**",
    "created_at": "2015-01-13T19:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182728",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`0602271`](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)**



---

archive/issue_comments_182729.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556\">0602271</a></td><td><code>Use cb_pari_err_handle() to handle PARI errors</code></td></tr></table>\n",
    "created_at": "2015-01-13T19:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182729",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556">0602271</a></td><td><code>Use cb_pari_err_handle() to handle PARI errors</code></td></tr></table>




---

archive/issue_events_211880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "title_is": "Fix PARI error handling",
    "title_was": "Fix PARI error handling for PARI 2.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211880"
}
```



---

archive/issue_comments_182730.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.\n+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.\n+\n+Moreover, we also get access to the \"error data\" (a `t_ERROR` object) which we store in the exception.\n``````\n",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182730",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_prehandle_exception`. That way, we don't need special tricks for warnings anymore.
+Instead of catching whatever PARI writes to `pariErr`, we should use a callback function `cb_pari_err_handle`. That way, we don't need special tricks for warnings anymore.
+
+Moreover, we also get access to the "error data" (a `t_ERROR` object) which we store in the exception.
``````




---

archive/issue_events_211881.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211881"
}
```



---

archive/issue_events_211882.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-13T19:28:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211882"
}
```



---

archive/issue_comments_182731.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to none",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182731",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to none



---

archive/issue_comments_182732.json:
```json
{
    "body": "Changed author from **Peter Bruin** to **Peter Bruin, Jeroen Demeyer**",
    "created_at": "2015-01-13T19:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182732",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Peter Bruin** to **Peter Bruin, Jeroen Demeyer**



---

archive/issue_comments_182733.json:
```json
{
    "body": "Reviewer: **Peter Bruin**",
    "created_at": "2015-01-14T13:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182733",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Peter Bruin**



---

archive/issue_comments_182734.json:
```json
{
    "body": "Changed author from **Peter Bruin, Jeroen Demeyer** to **Jeroen Demeyer**",
    "created_at": "2015-01-14T13:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182734",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Peter Bruin, Jeroen Demeyer** to **Jeroen Demeyer**



---

archive/issue_comments_182735.json:
```json
{
    "body": "Changed commit from **[`0602271`](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)** to **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**",
    "created_at": "2015-01-14T14:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0602271`](https://github.com/sagemath/sagetrac-mirror/commit/0602271c328f6d0851af946671194786c8c78556)** to **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**



---

archive/issue_comments_182736.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d\">2d532fc</a></td><td><code>Move PariError to handle_error.pyx; add sig_block() where needed</code></td></tr></table>\n",
    "created_at": "2015-01-14T14:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d">2d532fc</a></td><td><code>Move PariError to handle_error.pyx; add sig_block() where needed</code></td></tr></table>




---

archive/issue_events_211883.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-01-14T16:34:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211883"
}
```



---

archive/issue_events_211884.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-01-14T16:34:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211884"
}
```



---

archive/issue_events_211885.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-29T22:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211885"
}
```



---

archive/issue_events_211886.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7576573fbdd04954a6e392f3bfc025f37462d5ed",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-01-29T22:41:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14894#event-211886"
}
```



---

archive/issue_comments_182737.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)** to **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**",
    "created_at": "2015-01-29T22:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14894",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14894#issuecomment-182737",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/14894](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/14894)** to **[`2d532fc`](https://github.com/sagemath/sagetrac-mirror/commit/2d532fcb86ba0d993bc946adb3088c18bb20526d)**
