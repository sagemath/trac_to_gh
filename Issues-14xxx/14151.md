# Issue 14151: Update GMP-ECM to 6.4.4

archive/issues_013947.json:
```json
{
    "body": "GMP-ECM 6.4.4 is available at\n[https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz](https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz).\n\nWith respect to 6.3 currently used in Sage:\n\n```\nChanges between GMP-ECM 6.4.3 and GMP-ECM 6.4.4:\n* Fixed PowerPC64 assembly code with --enable-shared (thanks Leif Leonhardy)\n* Fix to deal with change of semantics of internal GMP functions in GMP 5.1\n* Fixed small memory leak in non-NTT P-1 stage 2\n* Fixed segfaults with large non-NTT P+-1 stage 2\n* Removed defunct -t command line option\n\nChanges between GMP-ECM 6.4.2 and GMP-ECM 6.4.3:\n* Fixed bug reported by user \"lorgix\" on mersenneforum\n  (http://www.mersenneforum.org/showpost.php?p=286385&postcount=280)\n* Use 64-bit value for random seed under Windows\n\nChanges between GMP-ECM 6.4.1 and GMP-ECM 6.4.2:\n* Corrected the copyright headers\n* Reduced memory usage in stage 1 with -batch={1,2} mode.\n* Fixed bug in modular reduction (could occur only for numbers larger than\n  386 digits on 64-bit computers and 193 digits on 32-bit computers).\n* Speedup in stage 2 with the NTT default mode\n\nChanges between GMP-ECM 6.4 and GMP-ECM 6.4.1:\n* GMP-ECM is now distributed under the GPL version 3 or later for the binary,\n  and under the LGPL version 3 or later for the library\n* Fixed a speed regression with respect to GMP-ECM 6.3\n  http://lists.gforge.inria.fr/pipermail/ecm-discuss/2012-February/004103.html\n* Fixed a bug with the -treefile option which had been present for a long time\n* Several fixes for the Visual Studio 2010 build\n* New experimental option -batch=2, and speedup for -batch (i.e., -batch=1)\n* New tuning mechanism, now --enable-asm-redc is always recommended\n* New configure option --enable-mulredc-svoboda, for input numbers whose low\n  limbs is congruent to -1\n* New tuning parameters for Intel Core i5\n* New ecmbench utility\n\nChanges between GMP-ECM 6.3 and GMP-ECM 6.4:\n* Fixed configure problem with SSE2\n  (http://trac.sagemath.org/sage_trac/ticket/10252)\n* Fixed configure bug on 32-bit PowerPC (tried to use 64-bit assembly)\n  https://gforge.inria.fr/tracker/index.php?func=detail&aid=10646\n* Fixed dependencies from build directory\n  https://gforge.inria.fr/tracker/index.php?func=detail&aid=10648\n* Patch from David Cleaver to allow B1 >= 2^32 on machines where\n  \"unsigned long\" has 32 bits only\n* Patch from David Cleaver to use GWNUM 26.6 on Windows x64 with MingW64/Msys\n* Improved conversion from mpz_t to residue number system in NTT code\n* Better asm code for AMD cpus\n* Use of GMP's mpn_mullo_n and mpn_redc_2 when available\n* New option -batch with faster Stage 1 (but smaller success probability)\n* Added Visual Studio 2010 build\n```\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg) ([attachment:ecm-6.4.4.diff diff])\n\n**CC:**  @nexttime\n\n**Keywords:** spkg\n\n**Reviewer:** Fran\u00e7ois Bissey, Paul Zimmermann\n\n**Author:** Jeroen Demeyer\n\n**Merged:** sage-5.10.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/14151\n\n",
    "closed_at": "2013-04-13T13:49:30Z",
    "created_at": "2013-02-20T15:03:14Z",
    "labels": [
        "component: packages: standard",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Update GMP-ECM to 6.4.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14151",
    "user": "https://github.com/zimmermann6"
}
```
GMP-ECM 6.4.4 is available at
[https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz](https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz).

With respect to 6.3 currently used in Sage:

```
Changes between GMP-ECM 6.4.3 and GMP-ECM 6.4.4:
* Fixed PowerPC64 assembly code with --enable-shared (thanks Leif Leonhardy)
* Fix to deal with change of semantics of internal GMP functions in GMP 5.1
* Fixed small memory leak in non-NTT P-1 stage 2
* Fixed segfaults with large non-NTT P+-1 stage 2
* Removed defunct -t command line option

Changes between GMP-ECM 6.4.2 and GMP-ECM 6.4.3:
* Fixed bug reported by user "lorgix" on mersenneforum
  (http://www.mersenneforum.org/showpost.php?p=286385&postcount=280)
* Use 64-bit value for random seed under Windows

Changes between GMP-ECM 6.4.1 and GMP-ECM 6.4.2:
* Corrected the copyright headers
* Reduced memory usage in stage 1 with -batch={1,2} mode.
* Fixed bug in modular reduction (could occur only for numbers larger than
  386 digits on 64-bit computers and 193 digits on 32-bit computers).
* Speedup in stage 2 with the NTT default mode

Changes between GMP-ECM 6.4 and GMP-ECM 6.4.1:
* GMP-ECM is now distributed under the GPL version 3 or later for the binary,
  and under the LGPL version 3 or later for the library
* Fixed a speed regression with respect to GMP-ECM 6.3
  http://lists.gforge.inria.fr/pipermail/ecm-discuss/2012-February/004103.html
* Fixed a bug with the -treefile option which had been present for a long time
* Several fixes for the Visual Studio 2010 build
* New experimental option -batch=2, and speedup for -batch (i.e., -batch=1)
* New tuning mechanism, now --enable-asm-redc is always recommended
* New configure option --enable-mulredc-svoboda, for input numbers whose low
  limbs is congruent to -1
* New tuning parameters for Intel Core i5
* New ecmbench utility

Changes between GMP-ECM 6.3 and GMP-ECM 6.4:
* Fixed configure problem with SSE2
  (http://trac.sagemath.org/sage_trac/ticket/10252)
* Fixed configure bug on 32-bit PowerPC (tried to use 64-bit assembly)
  https://gforge.inria.fr/tracker/index.php?func=detail&aid=10646
* Fixed dependencies from build directory
  https://gforge.inria.fr/tracker/index.php?func=detail&aid=10648
* Patch from David Cleaver to allow B1 >= 2^32 on machines where
  "unsigned long" has 32 bits only
* Patch from David Cleaver to use GWNUM 26.6 on Windows x64 with MingW64/Msys
* Improved conversion from mpz_t to residue number system in NTT code
* Better asm code for AMD cpus
* Use of GMP's mpn_mullo_n and mpn_redc_2 when available
* New option -batch with faster Stage 1 (but smaller success probability)
* Added Visual Studio 2010 build
```

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg) ([attachment:ecm-6.4.4.diff diff])

**CC:**  @nexttime

**Keywords:** spkg

**Reviewer:** Fran√ßois Bissey, Paul Zimmermann

**Author:** Jeroen Demeyer

**Merged:** sage-5.10.beta0

Issue created by migration from https://trac.sagemath.org/ticket/14151





---

archive/issue_comments_208999.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"spkg\".",
    "created_at": "2013-02-20T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-208999",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "spkg".



---

archive/issue_events_045720.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14151#event-45720"
}
```



---

archive/issue_comments_209000.json:
```json
{
    "body": "**Remove assignee** @aghitza.",
    "created_at": "2013-02-20T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209000",
    "user": "https://github.com/nexttime"
}
```

**Remove assignee** @aghitza.



---

archive/issue_comments_209001.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi Paul,\n\nI noticed a while ago that it is still necessary to *explicitly* `--disable-sse2` (`export ECM_CONFIGURE=\"--disable-sse2\"` when building Sage) on a Pentium III (which doesn't have SSE2).  (In Sage, SSE2 also gets disabled if one uses `SAGE_FAT_BINARY=yes` for 32-bit builds IIRC, but vanilla GMP-ECM tries to use SSE2 even when configured for `pentium3-*-*`, implicitly or explicitly.)\n\nUnfortunately my Pentium III meanwhile died, and I haven't tried to revive it yet, but this was true for the latest GMP-ECM 6.4.x at that time as well.  I vaguely remember the problem in the `configure` test was that it only tries to *compile* with SSE2 instructions, but doesn't try to *run* the resulting program (if appropriate, i.e., when not cross-compiling).  Alternatively, or in addition, SSE2 should simply get disabled if the target is `pentium-*-*|pentium2-*-*|pentium3-*-*` etc.",
    "created_at": "2013-02-20T16:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209001",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'></a>
Hi Paul,

I noticed a while ago that it is still necessary to *explicitly* `--disable-sse2` (`export ECM_CONFIGURE="--disable-sse2"` when building Sage) on a Pentium III (which doesn't have SSE2).  (In Sage, SSE2 also gets disabled if one uses `SAGE_FAT_BINARY=yes` for 32-bit builds IIRC, but vanilla GMP-ECM tries to use SSE2 even when configured for `pentium3-*-*`, implicitly or explicitly.)

Unfortunately my Pentium III meanwhile died, and I haven't tried to revive it yet, but this was true for the latest GMP-ECM 6.4.x at that time as well.  I vaguely remember the problem in the `configure` test was that it only tries to *compile* with SSE2 instructions, but doesn't try to *run* the resulting program (if appropriate, i.e., when not cross-compiling).  Alternatively, or in addition, SSE2 should simply get disabled if the target is `pentium-*-*|pentium2-*-*|pentium3-*-*` etc.



---

archive/issue_comments_209002.json:
```json
{
    "body": "<a id='comment:3'></a>\nHi Leif,\n\nI wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.\n\nUnless we have a concrete example of a computer where it fails, I'm reluctant to add a patch one could not test.\n\nPaul",
    "created_at": "2013-02-20T17:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209002",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:3'></a>
Hi Leif,

I wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.

Unless we have a concrete example of a computer where it fails, I'm reluctant to add a patch one could not test.

Paul



---

archive/issue_comments_209003.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [zimmerma](#comment%3A3):\n> I wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.\n\n\nHmmm, it seems somehow `pentium3-*` gets mapped to `i686-*`, which then triggers the use of SSE2 (if \"supported\"; the test apparently doesn't try to *run* a program with SSE2 instructions, as mentioned).\n\nJust tried configuring GMP-ECM 6.4.4-rc2 on a Pentium4 (i.e., a 32-bit machine) with `--target=pentium3-linux-gnu`, which results in\n\n```\n...\nchecking build system type... i686-pc-linux-gnu\nchecking host system type... i686-pc-linux-gnu\n...\nchecking for SSE2 support... yes\n...\nconfig.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm-params.h\nconfig.status: linking ../../src/ecm-6.4.4-rc2/mul_fft-params.h.default to mul_fft-params.h\nconfig.status: executing depfiles commands\nconfig.status: executing libtool commands\nconfigure: Configuration:\nconfigure: Build for host type i686-pc-linux-gnu\nconfigure: CC=gcc-4.7.2, CFLAGS=-g -O2\nconfigure: Linking GMP with -lgmp\nconfigure: Not using asm redc code\nconfigure: Using SSE2 instructions in NTT code\nconfigure: Assertions disabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```\n\n(Similar for `--build=pentium3-linux-gnu`, and `configure ... pentium3-linux-gnu`.)\n\n\n> Unless we have a concrete example of a computer where it fails, I'm reluctant to add a patch one could not test.\n\n\nWell, it's a minor issue, and we could probably also work around that in Sage's `spkg-install`, at least for the moment...\n\n(I guess not many people will use a \"stand-alone\" GMP-ECM on such old processors. ;-) )",
    "created_at": "2013-02-20T19:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209003",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>
Replying to [zimmerma](#comment%3A3):
> I wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.


Hmmm, it seems somehow `pentium3-*` gets mapped to `i686-*`, which then triggers the use of SSE2 (if "supported"; the test apparently doesn't try to *run* a program with SSE2 instructions, as mentioned).

Just tried configuring GMP-ECM 6.4.4-rc2 on a Pentium4 (i.e., a 32-bit machine) with `--target=pentium3-linux-gnu`, which results in

```
...
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
...
checking for SSE2 support... yes
...
config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm-params.h
config.status: linking ../../src/ecm-6.4.4-rc2/mul_fft-params.h.default to mul_fft-params.h
config.status: executing depfiles commands
config.status: executing libtool commands
configure: Configuration:
configure: Build for host type i686-pc-linux-gnu
configure: CC=gcc-4.7.2, CFLAGS=-g -O2
configure: Linking GMP with -lgmp
configure: Not using asm redc code
configure: Using SSE2 instructions in NTT code
configure: Assertions disabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```

(Similar for `--build=pentium3-linux-gnu`, and `configure ... pentium3-linux-gnu`.)


> Unless we have a concrete example of a computer where it fails, I'm reluctant to add a patch one could not test.


Well, it's a minor issue, and we could probably also work around that in Sage's `spkg-install`, at least for the moment...

(I guess not many people will use a "stand-alone" GMP-ECM on such old processors. ;-) )



---

archive/issue_comments_209004.json:
```json
{
    "body": "<a id='comment:5'></a>\nLeif, `configure --target=...` is not valid, see `configure --help`, you should use either\n`--build=...` or `--host=...`\n\nNote that your run did choose Pentium4 as target and not Pentium3:\n\n```\nconfig.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...\n```\nPaul",
    "created_at": "2013-02-20T19:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209004",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
Leif, `configure --target=...` is not valid, see `configure --help`, you should use either
`--build=...` or `--host=...`

Note that your run did choose Pentium4 as target and not Pentium3:

```
config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...
```
Paul



---

archive/issue_comments_209005.json:
```json
{
    "body": "<a id='comment:6'></a>\nP.S.:\n\nThe GCC default target also matters, but doesn't really make a difference; with (Ubuntu) GCC 4.4.3 I get:\n\n```\n...\nchecking for SSE2 support... yes, with -msse2\n...\nconfig.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm-params.h\nconfig.status: linking ../../src/ecm-6.4.4-rc2/mul_fft-params.h.default to mul_fft-params.h\nconfig.status: executing depfiles commands\nconfig.status: executing libtool commands\nconfigure: Configuration:\nconfigure: Build for host type i686-pc-linux-gnu\nconfigure: CC=gcc-4.4.3, CFLAGS=-g -O2 -msse2\nconfigure: Linking GMP with -lgmp\nconfigure: Not using asm redc code\nconfigure: Using SSE2 instructions in NTT code\nconfigure: Assertions disabled\nconfigure: Shell command execution disabled\nconfigure: OpenMP disabled\nconfigure: Memory debugging disabled\n```",
    "created_at": "2013-02-20T19:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209005",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
P.S.:

The GCC default target also matters, but doesn't really make a difference; with (Ubuntu) GCC 4.4.3 I get:

```
...
checking for SSE2 support... yes, with -msse2
...
config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm-params.h
config.status: linking ../../src/ecm-6.4.4-rc2/mul_fft-params.h.default to mul_fft-params.h
config.status: executing depfiles commands
config.status: executing libtool commands
configure: Configuration:
configure: Build for host type i686-pc-linux-gnu
configure: CC=gcc-4.4.3, CFLAGS=-g -O2 -msse2
configure: Linking GMP with -lgmp
configure: Not using asm redc code
configure: Using SSE2 instructions in NTT code
configure: Assertions disabled
configure: Shell command execution disabled
configure: OpenMP disabled
configure: Memory debugging disabled
```



---

archive/issue_comments_209006.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [zimmerma](#comment%3A5):\n> Leif, `configure --target=...` is not valid, see `configure --help`, you should use either\n> `--build=...` or `--host=...`\n\n\nThat doesn't really matter, i.e., same with `--host=...` or just the (deprecated) `pentium3-pc-linux-gnu` parameter.  (It always gets mapped to \"checking host system type... i686-pc-linux-gnu\", although `configure` is also \"checking for pentium3-pc-linux-gnu-gcc... gcc-4.4.3\".)\n\n\n> Note that your run did choose Pentium4 as target and not Pentium3:\n> \n> ```\n> config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...\n> ```\n\n\nYes, noticed that, which is also wrong (but only affects tuning parameters, so pretty harmless, right?).",
    "created_at": "2013-02-20T19:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209006",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Replying to [zimmerma](#comment%3A5):
> Leif, `configure --target=...` is not valid, see `configure --help`, you should use either
> `--build=...` or `--host=...`


That doesn't really matter, i.e., same with `--host=...` or just the (deprecated) `pentium3-pc-linux-gnu` parameter.  (It always gets mapped to "checking host system type... i686-pc-linux-gnu", although `configure` is also "checking for pentium3-pc-linux-gnu-gcc... gcc-4.4.3".)


> Note that your run did choose Pentium4 as target and not Pentium3:
> 
> ```
> config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...
> ```


Yes, noticed that, which is also wrong (but only affects tuning parameters, so pretty harmless, right?).



---

archive/issue_comments_209007.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [leif](#comment%3A7):\n> > Note that your run did choose Pentium4 as target and not Pentium3:\n> > \n> > ```\n> > config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...\n> > ```\n\n> \n> Yes, noticed that, which is also wrong (but only affects tuning parameters, so pretty harmless, right?).\n\n\nFound some old logs from the native build attempts (with GMP-ECM 6.3, 6.4.2 and 6.4.3b), there it was\n\n```\n...\nchecking build system type... i686-pc-linux-gnu\nchecking host system type... i686-pc-linux-gnu\n...\nchecking for SSE2 support... yes\n...\nconfig.status: linking ../ecm-6.4.3b/ecm-params.h.default to ecm-params.h\nconfig.status: linking ../ecm-6.4.3b/mul_fft-params.h.default to mul_fft-params.h\n...\nconfigure: Build for host type i686-pc-linux-gnu\nconfigure: CC=gcc, CFLAGS=-march=native -mtune=native -O3 -fomit-frame-pointer -DHONORS_CFLAGS\nconfigure: Linking GMP with /scratch/local/coppermine//lib/libgmp.a\nconfigure: Not using asm redc code\nconfigure: Using SSE2 instructions in NTT code\n...\n```",
    "created_at": "2013-02-20T20:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209007",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Replying to [leif](#comment%3A7):
> > Note that your run did choose Pentium4 as target and not Pentium3:
> > 
> > ```
> > config.status: linking ../../src/ecm-6.4.4-rc2/ecm-params.h.pentium4 to ecm...
> > ```

> 
> Yes, noticed that, which is also wrong (but only affects tuning parameters, so pretty harmless, right?).


Found some old logs from the native build attempts (with GMP-ECM 6.3, 6.4.2 and 6.4.3b), there it was

```
...
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
...
checking for SSE2 support... yes
...
config.status: linking ../ecm-6.4.3b/ecm-params.h.default to ecm-params.h
config.status: linking ../ecm-6.4.3b/mul_fft-params.h.default to mul_fft-params.h
...
configure: Build for host type i686-pc-linux-gnu
configure: CC=gcc, CFLAGS=-march=native -mtune=native -O3 -fomit-frame-pointer -DHONORS_CFLAGS
configure: Linking GMP with /scratch/local/coppermine//lib/libgmp.a
configure: Not using asm redc code
configure: Using SSE2 instructions in NTT code
...
```



---

archive/issue_comments_209008.json:
```json
{
    "body": "<a id='comment:9'></a>\nP.S.:  There I used `--build=...` in the second attempt, which still led to SSE2 getting enabled.",
    "created_at": "2013-02-20T20:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209008",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
P.S.:  There I used `--build=...` in the second attempt, which still led to SSE2 getting enabled.



---

archive/issue_comments_209009.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is a patch to configure in the current ecm spkg, is it still needed? I am preparing a proper spkg so I can test this on power7.",
    "created_at": "2013-02-20T20:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209009",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
There is a patch to configure in the current ecm spkg, is it still needed? I am preparing a proper spkg so I can test this on power7.



---

archive/issue_comments_209010.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [fbissey](#comment%3A10):\n> There is a patch to configure in the current ecm spkg, is it still needed?\n\n\nHaven't looked at it, but that's presumably the PPC64 patch that went upstream so isn't needed anymore.\n\n> I am preparing a proper spkg so I can test this on power7.\n",
    "created_at": "2013-02-20T20:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209010",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Replying to [fbissey](#comment%3A10):
> There is a patch to configure in the current ecm spkg, is it still needed?


Haven't looked at it, but that's presumably the PPC64 patch that went upstream so isn't needed anymore.

> I am preparing a proper spkg so I can test this on power7.




---

archive/issue_comments_209011.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [leif](#comment%3A11):\n> Replying to [fbissey](#comment%3A10):\n> > There is a patch to configure in the current ecm spkg, is it still needed?\n\n> \n> Haven't looked at it, but that's presumably the PPC64 patch that went upstream so isn't needed anymore.\n\n\nNope, but the patches are all from upstream, so should no longer be necessary.",
    "created_at": "2013-02-20T20:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209011",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Replying to [leif](#comment%3A11):
> Replying to [fbissey](#comment%3A10):
> > There is a patch to configure in the current ecm spkg, is it still needed?

> 
> Haven't looked at it, but that's presumably the PPC64 patch that went upstream so isn't needed anymore.


Nope, but the patches are all from upstream, so should no longer be necessary.



---

archive/issue_comments_209012.json:
```json
{
    "body": "<a id='comment:13'></a>\nppc64 is kind of the main point of the upgrade. I have asked Paul if the patch was added in a later release upstream and he said he would prepare a release.",
    "created_at": "2013-02-20T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209012",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
ppc64 is kind of the main point of the upgrade. I have asked Paul if the patch was added in a later release upstream and he said he would prepare a release.



---

archive/issue_comments_209013.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [fbissey](#comment%3A13):\n> ppc64 is kind of the main point of the upgrade. I have asked Paul if the patch was added in a later release upstream and he said he would prepare a release.\n\n\nYes, that's 6.4.4[-rc2]; cf. the upstream changelog in the ticket's description.",
    "created_at": "2013-02-20T21:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209013",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Replying to [fbissey](#comment%3A13):
> ppc64 is kind of the main point of the upgrade. I have asked Paul if the patch was added in a later release upstream and he said he would prepare a release.


Yes, that's 6.4.4[-rc2]; cf. the upstream changelog in the ticket's description.



---

archive/issue_comments_209014.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [zimmerma](#comment%3A3):\n> I wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.\n\n\nActually, GMP-ECM's `config.sub` \"canonicalizes\" `pentium3-*` (as well as `pentium2-*` and similar) to `i686-*`, so i686 is not sufficient to assume SSE2 support.  (`pentium4-*` gets `i786-*`.)\n\n(i686 then apparently triggers the SSE2 configure test, which doesn't try to *execute* SSE2 instructions.)",
    "created_at": "2013-02-20T21:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209014",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Replying to [zimmerma](#comment%3A3):
> I wonder how sse2 can be enabled on a Pentium3, since configure.in only enables it (when not requested by the user) for `pentium4-*-* | viac7-*-* | i686-*-* | i786-*-*`.


Actually, GMP-ECM's `config.sub` "canonicalizes" `pentium3-*` (as well as `pentium2-*` and similar) to `i686-*`, so i686 is not sufficient to assume SSE2 support.  (`pentium4-*` gets `i786-*`.)

(i686 then apparently triggers the SSE2 configure test, which doesn't try to *execute* SSE2 instructions.)



---

archive/issue_comments_209015.json:
```json
{
    "body": "<a id='comment:16'></a>\nto answer all questions:\n\n1) ecm-6.4.4-rc2 should include all bug fixes reported upstream, including the one for powerpc64\n\n2) for the sse2 issue, as said above we (upstream) won't change anything that we can't test on a real machine\n\nPaul",
    "created_at": "2013-02-21T08:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209015",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:16'></a>
to answer all questions:

1) ecm-6.4.4-rc2 should include all bug fixes reported upstream, including the one for powerpc64

2) for the sse2 issue, as said above we (upstream) won't change anything that we can't test on a real machine

Paul



---

archive/issue_comments_209016.json:
```json
{
    "body": "<a id='comment:17'></a>\nI started a build with checks but never had time to go back to it because I have been litteraly buried in paperwork after starting. I will check how it did now.",
    "created_at": "2013-02-21T08:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209016",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
I started a build with checks but never had time to go back to it because I have been litteraly buried in paperwork after starting. I will check how it did now.



---

archive/issue_comments_209017.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK, ecm test suite passed on power7 as well as the sage/libs/libecm.pyx doctests. Something I have just noticed looking at the build log:\n\n```\nchecking for cblas_dgemm in -lgslcblas... yes\nchecking for gsl_blas_dgemm in -lgsl... yes\n```\nIs ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?\n\nFrancois",
    "created_at": "2013-02-21T08:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209017",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
OK, ecm test suite passed on power7 as well as the sage/libs/libecm.pyx doctests. Something I have just noticed looking at the build log:

```
checking for cblas_dgemm in -lgslcblas... yes
checking for gsl_blas_dgemm in -lgsl... yes
```
Is ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?

Francois



---

archive/issue_comments_209018.json:
```json
{
    "body": "<a id='comment:19'></a>\n> Is ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?\n\n\nthis is not a mandatory dependency. GSL is only used to compute some probability of success,\nof some macro is defined...\n\nPaul",
    "created_at": "2013-02-21T08:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209018",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:19'></a>
> Is ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?


this is not a mandatory dependency. GSL is only used to compute some probability of success,
of some macro is defined...

Paul



---

archive/issue_comments_209019.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [zimmerma](#comment%3A19):\n> > Is ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?\n\n> \n> this is not a mandatory dependency. GSL is only used to compute some probability of success,\n> of some macro is defined...\n> \n\n\n<entering packager mode>\nQuick check on configure --help..... This is automagic detection, as a Gentoo packager of ecm I object. Furthermore the test is for a generic cblas function (I know generic detection of blas into autoconf is not trivial). It would be better to provide a --with-cblas switch on which you could pass appropriate linking flags for cblas. \n\nI am done with the packaging rant.",
    "created_at": "2013-02-21T08:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209019",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
Replying to [zimmerma](#comment%3A19):
> > Is ecm depending on gsl and specifically for generic cblas functions that could be provided by atlas or openblas?

> 
> this is not a mandatory dependency. GSL is only used to compute some probability of success,
> of some macro is defined...
> 


<entering packager mode>
Quick check on configure --help..... This is automagic detection, as a Gentoo packager of ecm I object. Furthermore the test is for a generic cblas function (I know generic detection of blas into autoconf is not trivial). It would be better to provide a --with-cblas switch on which you could pass appropriate linking flags for cblas. 

I am done with the packaging rant.



---

archive/issue_comments_209020.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [zimmerma](#comment%3A16):\n> 2) for the sse2 issue, as said above we (upstream) won't change anything that we can't test on a real machine\n\n\nFWIW, GMP-ECM's `config.guess`/`config.sub` and `configure[.in]` are currently at least inconsistent (which can be seen without having access to a Pentium III ;-) ).\n\n* `config.guess` on my Pentium 4 yields `i686-...`, not `pentium4-...`.\n\n* `config.sub` canonicalizes `{pentium2,pentiumii,pentium3,pentiumiii}-*` to `i686-*` (and `pentium4-*` to `i786-*`, as mentioned).\n\n* `configure[.in]` uses `$host` (rather than `$host_alias`), which in the relevant checks is -- as is -- always the *canonicalized* name (which especially means `i686-*` on Pentium II and III machines), such that any test for (e.g.) `pentium3-*` or `pentium4-*` can never match.\n\n* The SSE2 test doesn't try to *execute* SSE2 instructions, even when not cross-compiling.",
    "created_at": "2013-02-21T09:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209020",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
Replying to [zimmerma](#comment%3A16):
> 2) for the sse2 issue, as said above we (upstream) won't change anything that we can't test on a real machine


FWIW, GMP-ECM's `config.guess`/`config.sub` and `configure[.in]` are currently at least inconsistent (which can be seen without having access to a Pentium III ;-) ).

* `config.guess` on my Pentium 4 yields `i686-...`, not `pentium4-...`.

* `config.sub` canonicalizes `{pentium2,pentiumii,pentium3,pentiumiii}-*` to `i686-*` (and `pentium4-*` to `i786-*`, as mentioned).

* `configure[.in]` uses `$host` (rather than `$host_alias`), which in the relevant checks is -- as is -- always the *canonicalized* name (which especially means `i686-*` on Pentium II and III machines), such that any test for (e.g.) `pentium3-*` or `pentium4-*` can never match.

* The SSE2 test doesn't try to *execute* SSE2 instructions, even when not cross-compiling.



---

archive/issue_comments_209021.json:
```json
{
    "body": "<a id='comment:22'></a>\nLeif, does the config.guess file shipped with GMP 5.1.1 give better results?\n\nDoes $host_alias give pentium4-... on your Pentium 4?\n\nPaul",
    "created_at": "2013-02-21T10:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209021",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:22'></a>
Leif, does the config.guess file shipped with GMP 5.1.1 give better results?

Does $host_alias give pentium4-... on your Pentium 4?

Paul



---

archive/issue_comments_209022.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [zimmerma](#comment%3A22):\n> Leif, does the config.guess file shipped with GMP 5.1.1 give better results?\n\n\n\n```sh\nleif@restless:~/src$ gmp-5.1.1/config.guess \npentium4-pc-linux-gnu\nleif@restless:~/src$ ecm-6.4.4-rc2/config.guess \ni686-pc-linux-gnu\nleif@restless:~/src$ gmp-5.1.1/config.sub pentium3-linux-gnu\npentium3-pc-linux-gnu\nleif@restless:~/src$ ecm-6.4.4-rc2/config.sub pentium3-linux-gnu\ni686-pc-linux-gnu\nleif@restless:~/src$ gmp-5.1.1/config.sub pentium4-linux-gnu\npentium4-pc-linux-gnu\nleif@restless:~/src$ ecm-6.4.4-rc2/config.sub pentium4-linux-gnu\ni786-pc-linux-gnu\n```\n\nSo yes, you could probably take both from GMP 5.1.1.\n\n\n\n\n> Does $host_alias give pentium4-... on your Pentium 4?\n\n\n`host_alias` contains the name specified on the command line, so it contains `pentium4-*` (only) if I explicitly configure with `[--host=]pentium4-linux-gnu`.  (It's otherwise empty.)",
    "created_at": "2013-02-21T10:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209022",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [zimmerma](#comment%3A22):
> Leif, does the config.guess file shipped with GMP 5.1.1 give better results?



```sh
leif@restless:~/src$ gmp-5.1.1/config.guess 
pentium4-pc-linux-gnu
leif@restless:~/src$ ecm-6.4.4-rc2/config.guess 
i686-pc-linux-gnu
leif@restless:~/src$ gmp-5.1.1/config.sub pentium3-linux-gnu
pentium3-pc-linux-gnu
leif@restless:~/src$ ecm-6.4.4-rc2/config.sub pentium3-linux-gnu
i686-pc-linux-gnu
leif@restless:~/src$ gmp-5.1.1/config.sub pentium4-linux-gnu
pentium4-pc-linux-gnu
leif@restless:~/src$ ecm-6.4.4-rc2/config.sub pentium4-linux-gnu
i786-pc-linux-gnu
```

So yes, you could probably take both from GMP 5.1.1.




> Does $host_alias give pentium4-... on your Pentium 4?


`host_alias` contains the name specified on the command line, so it contains `pentium4-*` (only) if I explicitly configure with `[--host=]pentium4-linux-gnu`.  (It's otherwise empty.)



---

archive/issue_comments_209023.json:
```json
{
    "body": "<a id='comment:24'></a>\nFrancois, I've removed the GSL/BLAS dependency in the development version.\n\nPaul",
    "created_at": "2013-02-21T12:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209023",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:24'></a>
Francois, I've removed the GSL/BLAS dependency in the development version.

Paul



---

archive/issue_comments_209024.json:
```json
{
    "body": "<a id='comment:25'></a>\nGMP-ECM 6.4.4 has been released.\n\nPaul",
    "created_at": "2013-03-05T21:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209024",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:25'></a>
GMP-ECM 6.4.4 has been released.

Paul



---

archive/issue_comments_209025.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,15 @@\n-A release candidate of GMP-ECM 6.4.4 is available at\n-http://www.loria.fr/~kruppaal/ecm-6.4.4-rc2.tar.gz. With respect to 6.3 currently\n-used in Sage:\n+GMP-ECM 6.4.4 is available at\n+[https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz](https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz).\n+\n+With respect to 6.3 currently used in Sage:\n \n ```\n Changes between GMP-ECM 6.4.3 and GMP-ECM 6.4.4:\n * Fixed PowerPC64 assembly code with --enable-shared (thanks Leif Leonhardy)\n * Fix to deal with change of semantics of internal GMP functions in GMP 5.1\n+* Fixed small memory leak in non-NTT P-1 stage 2\n+* Fixed segfaults with large non-NTT P+-1 stage 2\n+* Removed defunct -t command line option\n \n Changes between GMP-ECM 6.4.2 and GMP-ECM 6.4.3:\n * Fixed bug reported by user \"lorgix\" on mersenneforum\n@@ -49,6 +53,4 @@\n * New option -batch with faster Stage 1 (but smaller success probability)\n * Added Visual Studio 2010 build\n ```\n-We plan to release 6.4.4 on Friday 22 February 2013. Any feedback from the Sage developers is welcome until then.\n \n-Paul\n``````\n",
    "created_at": "2013-03-05T22:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209025",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,15 @@
-A release candidate of GMP-ECM 6.4.4 is available at
-http://www.loria.fr/~kruppaal/ecm-6.4.4-rc2.tar.gz. With respect to 6.3 currently
-used in Sage:
+GMP-ECM 6.4.4 is available at
+[https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz](https://gforge.inria.fr/frs/download.php/32159/ecm-6.4.4.tar.gz).
+
+With respect to 6.3 currently used in Sage:
 
 ```
 Changes between GMP-ECM 6.4.3 and GMP-ECM 6.4.4:
 * Fixed PowerPC64 assembly code with --enable-shared (thanks Leif Leonhardy)
 * Fix to deal with change of semantics of internal GMP functions in GMP 5.1
+* Fixed small memory leak in non-NTT P-1 stage 2
+* Fixed segfaults with large non-NTT P+-1 stage 2
+* Removed defunct -t command line option
 
 Changes between GMP-ECM 6.4.2 and GMP-ECM 6.4.3:
 * Fixed bug reported by user "lorgix" on mersenneforum
@@ -49,6 +53,4 @@
 * New option -batch with faster Stage 1 (but smaller success probability)
 * Added Visual Studio 2010 build
 ```
-We plan to release 6.4.4 on Friday 22 February 2013. Any feedback from the Sage developers is welcome until then.
 
-Paul
``````




---

archive/issue_comments_209026.json:
```json
{
    "body": "<a id='comment:27'></a>\nI will give it a spin when I have time.",
    "created_at": "2013-03-05T22:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209026",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
I will give it a spin when I have time.



---

archive/issue_comments_209027.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [fbissey](#comment%3A27):\n> I will give it a spin when I have time.\n\n\nI was just going to ask whether you're going to provide an spkg with the final version...",
    "created_at": "2013-03-05T22:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209027",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
Replying to [fbissey](#comment%3A27):
> I will give it a spin when I have time.


I was just going to ask whether you're going to provide an spkg with the final version...



---

archive/issue_comments_209028.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [leif](#comment%3A28):\n> Replying to [fbissey](#comment%3A27):\n> > I will give it a spin when I have time.\n\n> \n> I was just going to ask whether you're going to provide an spkg with the final version...\n\n\nI'd rather leave that to someone else. I have a number of things to do. Chase the cvxopt bug on power7 bump the sage-on-gentoo overlay so there is a 5.8.beta to test and official paid work that's supposed to come first :)",
    "created_at": "2013-03-05T22:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209028",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>
Replying to [leif](#comment%3A28):
> Replying to [fbissey](#comment%3A27):
> > I will give it a spin when I have time.

> 
> I was just going to ask whether you're going to provide an spkg with the final version...


I'd rather leave that to someone else. I have a number of things to do. Chase the cvxopt bug on power7 bump the sage-on-gentoo overlay so there is a 5.8.beta to test and official paid work that's supposed to come first :)



---

archive/issue_comments_209029.json:
```json
{
    "body": "<a id='comment:30'></a>\nJust revisited #12472 ... (disabling asm redc when compiling with `clang`).",
    "created_at": "2013-03-15T07:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209029",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Just revisited #12472 ... (disabling asm redc when compiling with `clang`).



---

archive/issue_comments_209030.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2013-04-11T15:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209030",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_209031.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -54,3 +54,4 @@\n * Added Visual Studio 2010 build\n ```\n \n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg) ([attachment:ecm-6.4.4.diff diff])\n``````\n",
    "created_at": "2013-04-11T15:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209031",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -54,3 +54,4 @@
 * Added Visual Studio 2010 build
 ```
 
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ecm-6.4.4.spkg) ([attachment:ecm-6.4.4.diff diff])
``````




---

archive/issue_comments_209032.json:
```json
{
    "body": "<a id='comment:31'></a>\nI created a spkg by essentially just putting the new upstream sources in.",
    "created_at": "2013-04-11T15:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209032",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
I created a spkg by essentially just putting the new upstream sources in.



---

archive/attachments_019098.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "ecm-6.4.4.diff",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14151/ecm-6.4.4.diff",
    "created_at": "2013-04-11T15:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.diff",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_209033.json:
```json
{
    "body": "",
    "created_at": "2013-04-11T15:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209033",
    "user": "https://github.com/jdemeyer"
}
```





---

archive/issue_comments_209034.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-04-11T15:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209034",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_209035.json:
```json
{
    "body": "<a id='comment:33'></a>\nSeems to work fine on the buildbot.",
    "created_at": "2013-04-12T07:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209035",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Seems to work fine on the buildbot.



---

archive/issue_comments_209036.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2013-04-12T10:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209036",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Fran√ßois Bissey



---

archive/issue_comments_209037.json:
```json
{
    "body": "<a id='comment:34'></a>\nCompile fine and tests pass on power7 as well. The diff for spkg looks ok to me. I am putting this to positive review.",
    "created_at": "2013-04-12T10:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209037",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
Compile fine and tests pass on power7 as well. The diff for spkg looks ok to me. I am putting this to positive review.



---

archive/issue_comments_209038.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-04-12T10:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209038",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_209039.json:
```json
{
    "body": "<a id='comment:35'></a>\nsorry Francois was quicker than myself. Here are my 2 cents.\n\nIn SPKG.txt:\n\n```\n * We currently work around a linker bug on MacOS X 10.5 PPC (with\n   GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.\n   This *might* get fixed in later upstream releases.\n```\nIs that still true, since there is no patch any more?\n\nI notice you don't run \"make check\". It is highly recommended (maybe in a\nfuture revision of the spkg), especially since spkg-install uses different\nvalues of CC/CFLAGS than the upstream package would choose.\n\nPaul",
    "created_at": "2013-04-12T10:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209039",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:35'></a>
sorry Francois was quicker than myself. Here are my 2 cents.

In SPKG.txt:

```
 * We currently work around a linker bug on MacOS X 10.5 PPC (with
   GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.
   This *might* get fixed in later upstream releases.
```
Is that still true, since there is no patch any more?

I notice you don't run "make check". It is highly recommended (maybe in a
future revision of the spkg), especially since spkg-install uses different
values of CC/CFLAGS than the upstream package would choose.

Paul



---

archive/issue_comments_209040.json:
```json
{
    "body": "**Work_Issues:** SPKG,txt clean up",
    "created_at": "2013-04-12T10:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209040",
    "user": "https://github.com/kiwifb"
}
```

**Work_Issues:** SPKG,txt clean up



---

archive/issue_comments_209041.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2013-04-12T10:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209041",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_209042.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [zimmerma](#comment%3A35):\n> sorry Francois was quicker than myself. Here are my 2 cents.\n> \n> In SPKG.txt:\n> \n> ```\n>  * We currently work around a linker bug on MacOS X 10.5 PPC (with\n>    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.\n>    This *might* get fixed in later upstream releases.\n> ```\n> Is that still true, since there is no patch any more?\n> \n\n\nI believe it is fixed as from the description of the patch:\n\n```\n* configure.patch: \n \t   - Disable \"asm-redc\" on 32-bit Darwin PPCs (upstream revision 1516 / bug \n \t     #10646). \n \t     (Note that this upstream patch is likely to slow down GMP-ECM on 64-bit \n \t     PPC CPUs running (32-bit) MacOS X, since the extended instruction set of \n \t     the CPU is no longer exploitet.  A proper fix would just pass an option \n \t     to Apple's assembler to allow the use of the extended instruction set.)   \n\t \t   - Fix compilation error on x86 CPUs supporting SSE2. (Sage trac #10252, \n \t     upstream revision 1546). \n```\nSo there is mention of two revisions in gmp-ecm taking care of the problem from that patch. But good spotting, SPKG.txt needs cleaning to remove that statement.\n\n> I notice you don't run \"make check\". It is highly recommended (maybe in a\n> future revision of the spkg), especially since spkg-install uses different\n> values of CC/CFLAGS than the upstream package would choose.\n> \n\n\nIn this case checks are run if SAGE_CHECK is set during building. There are few spkg where the test suite is systematically run. I guess there would be a call for it if the packge was troublesome on a regular basis.",
    "created_at": "2013-04-12T10:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209042",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>
Replying to [zimmerma](#comment%3A35):
> sorry Francois was quicker than myself. Here are my 2 cents.
> 
> In SPKG.txt:
> 
> ```
>  * We currently work around a linker bug on MacOS X 10.5 PPC (with
>    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.
>    This *might* get fixed in later upstream releases.
> ```
> Is that still true, since there is no patch any more?
> 


I believe it is fixed as from the description of the patch:

```
* configure.patch: 
 	   - Disable "asm-redc" on 32-bit Darwin PPCs (upstream revision 1516 / bug 
 	     #10646). 
 	     (Note that this upstream patch is likely to slow down GMP-ECM on 64-bit 
 	     PPC CPUs running (32-bit) MacOS X, since the extended instruction set of 
 	     the CPU is no longer exploitet.  A proper fix would just pass an option 
 	     to Apple's assembler to allow the use of the extended instruction set.)   
	 	   - Fix compilation error on x86 CPUs supporting SSE2. (Sage trac #10252, 
 	     upstream revision 1546). 
```
So there is mention of two revisions in gmp-ecm taking care of the problem from that patch. But good spotting, SPKG.txt needs cleaning to remove that statement.

> I notice you don't run "make check". It is highly recommended (maybe in a
> future revision of the spkg), especially since spkg-install uses different
> values of CC/CFLAGS than the upstream package would choose.
> 


In this case checks are run if SAGE_CHECK is set during building. There are few spkg where the test suite is systematically run. I guess there would be a call for it if the packge was troublesome on a regular basis.



---

archive/issue_comments_209043.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [zimmerma](#comment%3A35):\n> In SPKG.txt:\n> \n> ```\n>  * We currently work around a linker bug on MacOS X 10.5 PPC (with\n>    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.\n>    This *might* get fixed in later upstream releases.\n> ```\n> Is that still true, since there is no patch any more?\n\nOK, removed that comment.",
    "created_at": "2013-04-12T11:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209043",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [zimmerma](#comment%3A35):
> In SPKG.txt:
> 
> ```
>  * We currently work around a linker bug on MacOS X 10.5 PPC (with
>    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.
>    This *might* get fixed in later upstream releases.
> ```
> Is that still true, since there is no patch any more?

OK, removed that comment.



---

archive/issue_comments_209044.json:
```json
{
    "body": "<a id='comment:38'></a>\nit is now fine for me. Jeroen, please can you modify to \"needs review\"?\n\nPaul",
    "created_at": "2013-04-12T12:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209044",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:38'></a>
it is now fine for me. Jeroen, please can you modify to "needs review"?

Paul



---

archive/issue_comments_209045.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2013-04-12T12:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209045",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_209046.json:
```json
{
    "body": "**Changing reviewer** from \"Fran\u00e7ois Bissey\" to \"Fran\u00e7ois Bissey, Paul Zimmermann\".",
    "created_at": "2013-04-12T12:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209046",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Fran√ßois Bissey" to "Fran√ßois Bissey, Paul Zimmermann".



---

archive/issue_comments_209047.json:
```json
{
    "body": "<a id='comment:39'></a>\nI would say positive review then, given that Fran\u00e7ois already gave positive review and you (Paul) agreed with the further changes.",
    "created_at": "2013-04-12T12:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209047",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
I would say positive review then, given that Fran√ßois already gave positive review and you (Paul) agreed with the further changes.



---

archive/issue_comments_209048.json:
```json
{
    "body": "<a id='comment:40'></a>\n> I would say positive review then...\n\n\nyes please!\n\nPaul",
    "created_at": "2013-04-12T12:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209048",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:40'></a>
> I would say positive review then...


yes please!

Paul



---

archive/issue_comments_209049.json:
```json
{
    "body": "**Changing work_issues** from \"SPKG,txt clean up\" to \"\".",
    "created_at": "2013-04-12T13:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209049",
    "user": "https://github.com/jdemeyer"
}
```

**Changing work_issues** from "SPKG,txt clean up" to "".



---

archive/issue_events_045721.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-12T13:54:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14151#event-45721"
}
```



---

archive/issue_events_045722.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-13T13:49:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14151#event-45722"
}
```



---

archive/issue_comments_209050.json:
```json
{
    "body": "**Merged:** sage-5.10.beta0",
    "created_at": "2013-04-13T13:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209050",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.beta0



---

archive/issue_comments_209051.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [fbissey](#comment%3A36):\n> Replying to [zimmerma](#comment%3A35):\n> > sorry Francois was quicker than myself. Here are my 2 cents.\n> > \n> > In SPKG.txt:\n> > \n> > ```\n> >  * We currently work around a linker bug on MacOS X 10.5 PPC (with\n> >    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.\n> >    This *might* get fixed in later upstream releases.\n> > ```\n> > Is that still true, since there is no patch any more?\n\n\n*\"We work around ...\"* != *\"We patch ...*\", and the comment was in \"Special !Update/Build Instructions\", not its \"Patches\" subsection.\n\n\n\n\n> I believe it is fixed as from the description of the patch:\n> \n> ```\n> * configure.patch: \n>  \t   - Disable \"asm-redc\" on 32-bit Darwin PPCs (upstream revision 1516 / bug \n>  \t     #10646). \n>  \t     (Note that this upstream patch is likely to slow down GMP-ECM on 64-bit \n>  \t     PPC CPUs running (32-bit) MacOS X, since the extended instruction set of \n>  \t     the CPU is no longer exploitet.  A proper fix would just pass an option \n>  \t     to Apple's assembler to allow the use of the extended instruction set.)   \n> \t \t   - Fix compilation error on x86 CPUs supporting SSE2. (Sage trac #10252, \n>  \t     upstream revision 1546). \n> ```\n> So there is mention of two revisions in gmp-ecm taking care of the problem from that patch. But good spotting, SPKG.txt needs cleaning to remove that statement.\n\n\n\n\n\nThe comment referred to the following part of `spkg-install` (which is still in, and presumably still necessary -- perhaps ask Dima, so should have been kept):\n\n```sh\n    case \"`uname -srm | tr ' ' '-'`\" in\n        Darwin-9*-[Pp]ower*)\n            # Don't add debug symbols because configure otherwise\n            # fails due to a bus error in Apple's 'ld' when trying\n            # to determine if global symbols are prefixed with an\n            # underscore (cf. http://trac.sagemath.org/sage_trac/ticket/5847#comment:35 ff.):\n            echo >&2 \"Warning: Disabling debug symbols on MacOS X 10.5\" \\\n                \"PowerPC because of a linker (?) bug.\"\n            echo >&2 \"See http://trac.sagemath.org/sage_trac/ticket/5847#comment:35\" \\\n                \"ff. for details.\"\n            echo >&2\n            CFLAGS=\"-O3 $CFLAGS\"\n            ;;\n        *)\n            CFLAGS=\"-g -O3 $CFLAGS\"\n    esac\n```\n\nBy the way, the attached diff doesn't reflect the latest spkg version.",
    "created_at": "2013-04-16T19:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209051",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Replying to [fbissey](#comment%3A36):
> Replying to [zimmerma](#comment%3A35):
> > sorry Francois was quicker than myself. Here are my 2 cents.
> > 
> > In SPKG.txt:
> > 
> > ```
> >  * We currently work around a linker bug on MacOS X 10.5 PPC (with
> >    GCC 4.2.1) which breaks 'configure' if debug symbols are enabled.
> >    This *might* get fixed in later upstream releases.
> > ```
> > Is that still true, since there is no patch any more?


*"We work around ..."* != *"We patch ...*", and the comment was in "Special !Update/Build Instructions", not its "Patches" subsection.




> I believe it is fixed as from the description of the patch:
> 
> ```
> * configure.patch: 
>  	   - Disable "asm-redc" on 32-bit Darwin PPCs (upstream revision 1516 / bug 
>  	     #10646). 
>  	     (Note that this upstream patch is likely to slow down GMP-ECM on 64-bit 
>  	     PPC CPUs running (32-bit) MacOS X, since the extended instruction set of 
>  	     the CPU is no longer exploitet.  A proper fix would just pass an option 
>  	     to Apple's assembler to allow the use of the extended instruction set.)   
> 	 	   - Fix compilation error on x86 CPUs supporting SSE2. (Sage trac #10252, 
>  	     upstream revision 1546). 
> ```
> So there is mention of two revisions in gmp-ecm taking care of the problem from that patch. But good spotting, SPKG.txt needs cleaning to remove that statement.





The comment referred to the following part of `spkg-install` (which is still in, and presumably still necessary -- perhaps ask Dima, so should have been kept):

```sh
    case "`uname -srm | tr ' ' '-'`" in
        Darwin-9*-[Pp]ower*)
            # Don't add debug symbols because configure otherwise
            # fails due to a bus error in Apple's 'ld' when trying
            # to determine if global symbols are prefixed with an
            # underscore (cf. http://trac.sagemath.org/sage_trac/ticket/5847#comment:35 ff.):
            echo >&2 "Warning: Disabling debug symbols on MacOS X 10.5" \
                "PowerPC because of a linker (?) bug."
            echo >&2 "See http://trac.sagemath.org/sage_trac/ticket/5847#comment:35" \
                "ff. for details."
            echo >&2
            CFLAGS="-O3 $CFLAGS"
            ;;
        *)
            CFLAGS="-g -O3 $CFLAGS"
    esac
```

By the way, the attached diff doesn't reflect the latest spkg version.



---

archive/issue_comments_209052.json:
```json
{
    "body": "<a id='comment:44'></a>\na release candidate for GMP-ECM is available.\nSee https://lists.gforge.inria.fr/pipermail/ecm-discuss/2016-February/004328.html.\nIt would be nice if someone could try it within Sage.\n\nPaul",
    "created_at": "2016-03-08T13:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209052",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:44'></a>
a release candidate for GMP-ECM is available.
See https://lists.gforge.inria.fr/pipermail/ecm-discuss/2016-February/004328.html.
It would be nice if someone could try it within Sage.

Paul



---

archive/issue_comments_209053.json:
```json
{
    "body": "<a id='comment:45'></a>\nI am looking at it. Remarks so far:\n* parallel make works :)\n* properly link without adding extra `-lgmp` flags :) \n* still issues when assembly is enabled if you don't add `-Wl,-z,noexecstack` to `LDFLAGS` :(\n\n```\n * QA Notice: The following files contain writable and executable sections\n *  Files with such sections will not work properly (or at all!) on some\n *  architectures/operating systems.  A bug should be filed at\n *  http://bugs.gentoo.org/ to make sure the issue is fixed.\n *  For more information, see:\n * \n *    https://wiki.gentoo.org/wiki/Hardened/GNU_stack_quickstart\n * \n *  Please include the following list of files in your report:\n *  Note: Bugs should be filed for the respective maintainers\n *  of the package in question and not hardened@g.o.\n * RWX --- --- usr/lib64/libecm.so.0.0.0\n```\n* testsuite fails here (log on request) with or without asm-redc :(\n\nNow I will test drive sage with it.",
    "created_at": "2016-03-08T23:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209053",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
I am looking at it. Remarks so far:
* parallel make works :)
* properly link without adding extra `-lgmp` flags :) 
* still issues when assembly is enabled if you don't add `-Wl,-z,noexecstack` to `LDFLAGS` :(

```
 * QA Notice: The following files contain writable and executable sections
 *  Files with such sections will not work properly (or at all!) on some
 *  architectures/operating systems.  A bug should be filed at
 *  http://bugs.gentoo.org/ to make sure the issue is fixed.
 *  For more information, see:
 * 
 *    https://wiki.gentoo.org/wiki/Hardened/GNU_stack_quickstart
 * 
 *  Please include the following list of files in your report:
 *  Note: Bugs should be filed for the respective maintainers
 *  of the package in question and not hardened@g.o.
 * RWX --- --- usr/lib64/libecm.so.0.0.0
```
* testsuite fails here (log on request) with or without asm-redc :(

Now I will test drive sage with it.



---

archive/issue_comments_209054.json:
```json
{
    "body": "<a id='comment:46'></a>\nMay be we should take the conversation to a new ticket. Anyway first victim:\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx\", line 3500, in sage.rings.integer.Integer.?\nFailed example:\n    n.factor(algorithm='ecm')\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 499, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.integer.Integer.?[18]>\", line 1, in <module>\n        n.factor(algorithm='ecm')\n      File \"sage/rings/integer.pyx\", line 3584, in sage.rings.integer.Integer.factor (/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:23897)\n        res = [(p, 1) for p in ecm.factor(n, proof=proof)]\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py\", line 651, in factor\n        n_factorization = self.find_factor(n)\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py\", line 555, in find_factor\n        factors = self._find_factor(n, factor_digits, B1, **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py\", line 505, in _find_factor\n        out = self._run_ecm(cmd, n)\n      File \"/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py\", line 214, in _run_ecm\n        raise ValueError(err)\n    ValueError: Unknown option: -cofdec\n```\nwith corresponding offending code in `sage/interfaces/ecm.py`\n\n```\n    def _find_factor(self, n, factor_digits, B1, **kwds):\n        \"\"\"\n        Helper for :meth:`find_factor`.\n\n        INPUT:\n\n        See :meth:`find_factor`.\n\n        OUTPUT:\n\n        List of pairs ``(integer, bool)`` consisting of factors of the\n        ECM input and whether they are probable prime. Note that ECM\n        is not a good primality test and there is a sizeable chance\n        that a \"probable prime\" is actually composite.\n\n        EXAMPLES::\n\n            sage: f = ECM()\n            sage: n = 508021860739623467191080372196682785441177798407961\n            sage: f._find_factor(n, None, 2000)\n            [(79792266297612017, True), \n             (6366805760909027985741435139224233, True)]\n        \"\"\"\n        n = self._validate(n)\n        kwds.setdefault('c', 1000000000)\n        kwds.setdefault('I', 1)\n        if factor_digits is not None:\n            B1 = self.recommended_B1(factor_digits)\n        kwds['one'] = True\n        kwds['cofdec'] = True\n        cmd = self._make_cmd(B1, None, kwds)\n        out = self._run_ecm(cmd, n)\n        return self._parse_output(n, out)\n```\nAlso mentioned at line 143\n\n```\n        - ``cofdec`` -- boolean. Force cofactor output in decimal\n          (even if expressions are used )\n```\nthe doctest for `sage/interface/ecm.py` hangs:\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py\nTrying (line 207):    ecm._run_ecm(['cat'], 1234)\nExpecting:\n    '1234'\nok [0.01 s]\nTrying (line 209):    sig_on_count() # check sig_on/off pairings (virtual doctest)\nExpecting:\n    0\nok [0.00 s]\nTrying (line 231):    print(ecm(3))    # random output\nExpecting:\n    GMP-ECM 6.4.4 [configured with MPIR 2.6.0, --enable-asm-redc] [ECM]\n    Input number is 3 (1 digits)\n    ********** Factor found in step 1: 3\n    Found input number N\n```\nstrangely `ps ux` reports that `ecm 10` is running not `ecm 3` as you would expect.",
    "created_at": "2016-03-09T00:29:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209054",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
May be we should take the conversation to a new ticket. Anyway first victim:

```
File "/usr/lib64/python2.7/site-packages/sage/rings/integer.pyx", line 3500, in sage.rings.integer.Integer.?
Failed example:
    n.factor(algorithm='ecm')
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 499, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.?[18]>", line 1, in <module>
        n.factor(algorithm='ecm')
      File "sage/rings/integer.pyx", line 3584, in sage.rings.integer.Integer.factor (/scratch2/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/rings/integer.c:23897)
        res = [(p, 1) for p in ecm.factor(n, proof=proof)]
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py", line 651, in factor
        n_factorization = self.find_factor(n)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py", line 555, in find_factor
        factors = self._find_factor(n, factor_digits, B1, **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py", line 505, in _find_factor
        out = self._run_ecm(cmd, n)
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py", line 214, in _run_ecm
        raise ValueError(err)
    ValueError: Unknown option: -cofdec
```
with corresponding offending code in `sage/interfaces/ecm.py`

```
    def _find_factor(self, n, factor_digits, B1, **kwds):
        """
        Helper for :meth:`find_factor`.

        INPUT:

        See :meth:`find_factor`.

        OUTPUT:

        List of pairs ``(integer, bool)`` consisting of factors of the
        ECM input and whether they are probable prime. Note that ECM
        is not a good primality test and there is a sizeable chance
        that a "probable prime" is actually composite.

        EXAMPLES::

            sage: f = ECM()
            sage: n = 508021860739623467191080372196682785441177798407961
            sage: f._find_factor(n, None, 2000)
            [(79792266297612017, True), 
             (6366805760909027985741435139224233, True)]
        """
        n = self._validate(n)
        kwds.setdefault('c', 1000000000)
        kwds.setdefault('I', 1)
        if factor_digits is not None:
            B1 = self.recommended_B1(factor_digits)
        kwds['one'] = True
        kwds['cofdec'] = True
        cmd = self._make_cmd(B1, None, kwds)
        out = self._run_ecm(cmd, n)
        return self._parse_output(n, out)
```
Also mentioned at line 143

```
        - ``cofdec`` -- boolean. Force cofactor output in decimal
          (even if expressions are used )
```
the doctest for `sage/interface/ecm.py` hangs:

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/ecm.py
Trying (line 207):    ecm._run_ecm(['cat'], 1234)
Expecting:
    '1234'
ok [0.01 s]
Trying (line 209):    sig_on_count() # check sig_on/off pairings (virtual doctest)
Expecting:
    0
ok [0.00 s]
Trying (line 231):    print(ecm(3))    # random output
Expecting:
    GMP-ECM 6.4.4 [configured with MPIR 2.6.0, --enable-asm-redc] [ECM]
    Input number is 3 (1 digits)
    ********** Factor found in step 1: 3
    Found input number N
```
strangely `ps ux` reports that `ecm 10` is running not `ecm 3` as you would expect.



---

archive/issue_comments_209055.json:
```json
{
    "body": "<a id='comment:47'></a>\nOh and please increase the version number of the `.so` file. If it was the same interface as with 6.4.4 we could install `ecm-7.0` and not have to recompile `sage/libs/libecm.pyx`. Using the new library without recompile just explodes in your face when trying to load `sage/libs/libecm.so`.\n\nRecompiling `sage` against the new libecm works however so the change must not be that big.",
    "created_at": "2016-03-09T01:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209055",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>
Oh and please increase the version number of the `.so` file. If it was the same interface as with 6.4.4 we could install `ecm-7.0` and not have to recompile `sage/libs/libecm.pyx`. Using the new library without recompile just explodes in your face when trying to load `sage/libs/libecm.so`.

Recompiling `sage` against the new libecm works however so the change must not be that big.



---

archive/issue_comments_209056.json:
```json
{
    "body": "<a id='comment:48'></a>\nYou probably quoted the wrong message. I was testing 7.0-rc1 while you posted rc2 there: http://lists.gforge.inria.fr/pipermail/ecm-discuss/2016-March/004333.html",
    "created_at": "2016-03-09T02:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209056",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>
You probably quoted the wrong message. I was testing 7.0-rc1 while you posted rc2 there: http://lists.gforge.inria.fr/pipermail/ecm-discuss/2016-March/004333.html



---

archive/issue_comments_209057.json:
```json
{
    "body": "<a id='comment:49'></a>\n> May be we should take the conversation to a new ticket.\n\n\nyes feel free to create a new ticket. I used that one to have the usual suspects informed of the new release candidate.\n\nPaul",
    "created_at": "2016-03-09T10:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209057",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:49'></a>
> May be we should take the conversation to a new ticket.


yes feel free to create a new ticket. I used that one to have the usual suspects informed of the new release candidate.

Paul



---

archive/issue_comments_209058.json:
```json
{
    "body": "<a id='comment:50'></a>\n>  * still issues when assembly is enabled if you don't add `-Wl,-z,noexecstack` to `LDFLAGS` :(\n\n\nplease could you submit a patch for this?\n\n> testsuite fails here (log on request) with or without asm-redc :(\n\n\nyes please send the log on the ecm-discuss list.\n\nPaul",
    "created_at": "2016-03-09T10:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209058",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:50'></a>
>  * still issues when assembly is enabled if you don't add `-Wl,-z,noexecstack` to `LDFLAGS` :(


please could you submit a patch for this?

> testsuite fails here (log on request) with or without asm-redc :(


yes please send the log on the ecm-discuss list.

Paul



---

archive/issue_comments_209059.json:
```json
{
    "body": "<a id='comment:51'></a>\nthe -cofdec option was removed in GMP-ECM 7.0, thus it should be disabled in the Sage interface.\n\nAnd my comment [comment:44] was before the rc2 was out.\n\nI have increased the version info to 1.0.0.\n\nPaul",
    "created_at": "2016-03-09T10:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209059",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:51'></a>
the -cofdec option was removed in GMP-ECM 7.0, thus it should be disabled in the Sage interface.

And my comment [comment:44] was before the rc2 was out.

I have increased the version info to 1.0.0.

Paul



---

archive/issue_comments_209060.json:
```json
{
    "body": "<a id='comment:52'></a>\nI've created a new ticket #20385 for the update to 7.0.",
    "created_at": "2016-04-08T06:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14151",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14151#issuecomment-209060",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:52'></a>
I've created a new ticket #20385 for the update to 7.0.
