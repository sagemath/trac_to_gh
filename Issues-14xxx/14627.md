# Issue 14627: Make mod_int signed and speed up matrix_modn_dense_float

archive/issues_014423.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "As discussed on https://groups.google.com/d/msg/sage-devel/hnO8gT8VON4/YyZ5UCM5wUEJ, unsigned longs are much slower than signed longs when converted to a Python object.\n\nWithout patch about 20x slower than naive list-of-list implementation:\n\n```\n$ sage test_matrix_modn_float.py\nsetA:\n5 loops, best of 50: 179 ms per loop\nsetB:\n25 loops, best of 50: 10.3 ms per loop\n```\nWith patch no performance difference:\n\n```\n$ sage test_matrix_modn_float.py\nsetA:\n25 loops, best of 50: 11.5 ms per loop\nsetB:\n25 loops, best of 50: 12.8 ms per loop\n```\n\nAlso, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.\n\nApply \n* [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n* [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)\n* [attachment: trac_14627_more_primes.patch\u200b](https://github.com/sagemath/sage/files/ticket14627/237edace11db0f1fb7cd46aeda092206.gz)\n\nDepends on #12728\n\nCC:  @sagetrac-Stefan\n\nReviewer: **Martin Albrecht**\n\nAuthor: **Volker Braun**\n\nMerged: **sage-5.12.beta0**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14627_\n\n",
    "closed_at": "2013-08-02T14:18:48Z",
    "created_at": "2013-05-22T18:17:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make mod_int signed and speed up matrix_modn_dense_float",
    "type": "issue",
    "updated_at": "2013-09-24T06:06:30Z",
    "url": "https://github.com/sagemath/sage/issues/14627",
    "user": "https://github.com/vbraun"
}
```
As discussed on https://groups.google.com/d/msg/sage-devel/hnO8gT8VON4/YyZ5UCM5wUEJ, unsigned longs are much slower than signed longs when converted to a Python object.

Without patch about 20x slower than naive list-of-list implementation:

```
$ sage test_matrix_modn_float.py
setA:
5 loops, best of 50: 179 ms per loop
setB:
25 loops, best of 50: 10.3 ms per loop
```
With patch no performance difference:

```
$ sage test_matrix_modn_float.py
setA:
25 loops, best of 50: 11.5 ms per loop
setB:
25 loops, best of 50: 12.8 ms per loop
```

Also, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.

Apply 
* [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
* [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)
* [attachment: trac_14627_more_primes.patchâ€‹](https://github.com/sagemath/sage/files/ticket14627/237edace11db0f1fb7cd46aeda092206.gz)

Depends on #12728

CC:  @sagetrac-Stefan

Reviewer: **Martin Albrecht**

Author: **Volker Braun**

Merged: **sage-5.12.beta0**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/14627_





---

archive/issue_events_207194.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207194"
}
```



---

archive/issue_events_207195.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207195"
}
```



---

archive/issue_events_207196.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207196"
}
```



---

archive/issue_events_207197.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207197"
}
```



---

archive/issue_events_207198.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207198"
}
```



---

archive/issue_events_207199.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2013-05-22T18:17:37Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207199"
}
```



---

archive/issue_comments_177501.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,21 @@\n As discussed on https://groups.google.com/d/msg/sage-devel/hnO8gT8VON4/YyZ5UCM5wUEJ, unsigned longs are much slower than signed longs when converted to a Python object.\n+\n+Without patch about 20x slower than naive list-of-list implementation:\n+\n+```\n+$ sage test_matrix_modn_float.py\n+setA:\n+5 loops, best of 50: 179 ms per loop\n+setB:\n+25 loops, best of 50: 10.3 ms per loop\n+```\n+With patch no performance difference:\n+\n+```\n+$ sage test_matrix_modn_float.py\n+setA:\n+25 loops, best of 50: 11.5 ms per loop\n+setB:\n+25 loops, best of 50: 12.8 ms per loop\n+```\n+\n``````\n",
    "created_at": "2013-05-22T19:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177501",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,21 @@
 As discussed on https://groups.google.com/d/msg/sage-devel/hnO8gT8VON4/YyZ5UCM5wUEJ, unsigned longs are much slower than signed longs when converted to a Python object.
+
+Without patch about 20x slower than naive list-of-list implementation:
+
+```
+$ sage test_matrix_modn_float.py
+setA:
+5 loops, best of 50: 179 ms per loop
+setB:
+25 loops, best of 50: 10.3 ms per loop
+```
+With patch no performance difference:
+
+```
+$ sage test_matrix_modn_float.py
+setA:
+25 loops, best of 50: 11.5 ms per loop
+setB:
+25 loops, best of 50: 12.8 ms per loop
+```
+
``````




---

archive/issue_comments_177502.json:
```json
{
    "body": "Attachment: **[test_matrix_modn_float.py.gz](https://github.com/sagemath/sage/files/ticket14627/test_matrix_modn_float.py.gz)**\n\nPerformance test script",
    "created_at": "2013-05-22T19:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177502",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[test_matrix_modn_float.py.gz](https://github.com/sagemath/sage/files/ticket14627/test_matrix_modn_float.py.gz)**

Performance test script



---

archive/issue_comments_177503.json:
```json
{
    "body": "Dependencies: **#12728**",
    "created_at": "2013-05-22T19:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177503",
    "user": "https://github.com/vbraun"
}
```

Dependencies: **#12728**



---

archive/issue_events_207200.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-22T20:09:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207200"
}
```



---

archive/issue_comments_177504.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,6 @@\n 25 loops, best of 50: 12.8 ms per loop\n ```\n \n+Also, I collected some common extern cdef statements in pxi headers and cleaned up the `MAX_MODULUS` declarations.\n+\n+Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n``````\n",
    "created_at": "2013-05-22T20:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177504",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,6 @@
 25 loops, best of 50: 12.8 ms per loop
 ```
 
+Also, I collected some common extern cdef statements in pxi headers and cleaned up the `MAX_MODULUS` declarations.
+
+Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
``````




---

archive/issue_comments_177505.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2013-05-22T20:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177505",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_177506.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPatch looks good, a few small comments/questions:\n\n* \"The expression below assumes unsigned.\" I don't think this is true any more.\n* Those pari changes (sage.libs.pari.gen.pari  => pari) are a bit out of place? It's not bad enough though to make you take it out, just curious.\n* I thought we're supposed to use .pxd in place of .pxi, but you seem to prefer .pxi here?",
    "created_at": "2013-05-23T08:40:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177506",
    "user": "https://github.com/malb"
}
```

<div id="comment:5" align="right">comment:5</div>

Patch looks good, a few small comments/questions:

* "The expression below assumes unsigned." I don't think this is true any more.
* Those pari changes (sage.libs.pari.gen.pari  => pari) are a bit out of place? It's not bad enough though to make you take it out, just curious.
* I thought we're supposed to use .pxd in place of .pxi, but you seem to prefer .pxi here?



---

archive/issue_comments_177507.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI'm just following http://wiki.cython.org/FAQ#Whatisthedifferencebetweena.pxdand.pxifile.3FWhenshouldeitherbeused.3F, pxd for class declarations and pxi for include headers.\n\nThe `sage.libs.pari.gen.pari` gave me import errors after taking out some import statements. The module already imports it as `pari` on module-level so the short version should have been used from the start.",
    "created_at": "2013-05-23T09:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177507",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

I'm just following http://wiki.cython.org/FAQ#Whatisthedifferencebetweena.pxdand.pxifile.3FWhenshouldeitherbeused.3F, pxd for class declarations and pxi for include headers.

The `sage.libs.pari.gen.pari` gave me import errors after taking out some import statements. The module already imports it as `pari` on module-level so the short version should have been used from the start.



---

archive/issue_comments_177508.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI changed \"assumes unsigned\" -> \"assumes signed\", which is of course the whole point of the patch ;-)",
    "created_at": "2013-05-23T09:28:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177508",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

I changed "assumes unsigned" -> "assumes signed", which is of course the whole point of the patch ;-)



---

archive/issue_comments_177509.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nre: pxi vs. pxd: They are concluding with \"Now that \"cimport *\" can be used, there is no reason to use .pxi files for external declarations.\" I think it would be better to use a .pxd which seems to be best practice as recommended by the Cython devs. But I am not insisting on it.\n\nIn other news: all tests passed.",
    "created_at": "2013-05-23T13:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177509",
    "user": "https://github.com/malb"
}
```

<div id="comment:8" align="right">comment:8</div>

re: pxi vs. pxd: They are concluding with "Now that "cimport *" can be used, there is no reason to use .pxi files for external declarations." I think it would be better to use a .pxd which seems to be best practice as recommended by the Cython devs. But I am not insisting on it.

In other news: all tests passed.



---

archive/issue_comments_177510.json:
```json
{
    "body": "Attachment: **[trac_14627_signed_mod_int.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)**\n\nUpdated patch",
    "created_at": "2013-05-23T13:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177510",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_14627_signed_mod_int.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)**

Updated patch



---

archive/issue_comments_177511.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,6 +19,6 @@\n 25 loops, best of 50: 12.8 ms per loop\n ```\n \n-Also, I collected some common extern cdef statements in pxi headers and cleaned up the `MAX_MODULUS` declarations.\n+Also, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.\n \n Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n``````\n",
    "created_at": "2013-05-23T13:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177511",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,6 +19,6 @@
 25 loops, best of 50: 12.8 ms per loop
 ```
 
-Also, I collected some common extern cdef statements in pxi headers and cleaned up the `MAX_MODULUS` declarations.
+Also, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.
 
 Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
``````




---

archive/issue_comments_177512.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOk, sounds good. New patch uses `mod_int.pxd` and `stdint.pxd`.",
    "created_at": "2013-05-23T13:51:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177512",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Ok, sounds good. New patch uses `mod_int.pxd` and `stdint.pxd`.



---

archive/issue_comments_177513.json:
```json
{
    "body": "Reviewer: **Martin Albrecht**",
    "created_at": "2013-05-23T15:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177513",
    "user": "https://github.com/malb"
}
```

Reviewer: **Martin Albrecht**



---

archive/issue_comments_177514.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n* doctests pass\n  * patch looks okay\n  * I can confirm the performance improvements",
    "created_at": "2013-05-23T15:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177514",
    "user": "https://github.com/malb"
}
```

<div id="comment:10" align="right">comment:10</div>

* doctests pass
  * patch looks okay
  * I can confirm the performance improvements



---

archive/issue_events_207201.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-05-23T15:26:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207201"
}
```



---

archive/issue_events_207202.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-05-23T15:26:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207202"
}
```



---

archive/issue_comments_177515.json:
```json
{
    "body": "Changed dependencies from **#12728** to **#14634, #12728**",
    "created_at": "2013-05-23T16:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177515",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#12728** to **#14634, #12728**



---

archive/issue_events_207203.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-23T16:16:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207203"
}
```



---

archive/issue_events_207204.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-23T16:16:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207204"
}
```



---

archive/issue_events_207205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T12:33:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207205"
}
```



---

archive/issue_events_207206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T12:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207206"
}
```



---

archive/issue_comments_177516.json:
```json
{
    "body": "Changed dependencies from **#14634, #12728** to **#12728**",
    "created_at": "2013-05-24T12:33:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177516",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#14634, #12728** to **#12728**



---

archive/issue_events_207207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-27T06:24:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207207"
}
```



---

archive/issue_events_207208.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-27T06:24:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207208"
}
```



---

archive/issue_events_207209.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-05T07:34:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207209"
}
```



---

archive/issue_events_207210.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-05T07:34:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207210"
}
```



---

archive/issue_comments_177517.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThis breaks badly on 32-bit systems:\n\n```\nsage -t --long devel/sage/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"devel/sage/sage/matrix/matrix2.pyx\", line 2320, in sage.matrix.matrix2.Matrix.diagonal._right_kernel_matrix_over_field\nFailed example:\n    P = result[1]; P\nExpected:\n    [       -1        -1         1         0]\n    [-zeta14^3 -zeta14^4         0         1]\nGot:\n    [         3716055149462127149669597391230365/1741122812024444137450032682964234          3716055149462127149669597391230365/1741122812024444137450032682964234                                                                              1                                                                              0]\n    [3716055149462127149669597391230365/1741122812024444137450032682964234*zeta14^3 3716055149462127149669597391230365/1741122812024444137450032682964234*zeta14^4                                                                              0                                                                              1]\n**********************************************************************\n```\nAnd many more failures and timeouts: [http://build.sagemath.org/sage/builders/NTU%20arando%20%28Ubuntu%2012.10%20i686%29/builds/182/steps/shell_8/logs/stdio](http://build.sagemath.org/sage/builders/NTU%20arando%20%28Ubuntu%2012.10%20i686%29/builds/182/steps/shell_8/logs/stdio)",
    "created_at": "2013-06-05T07:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177517",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

This breaks badly on 32-bit systems:

```
sage -t --long devel/sage/sage/matrix/matrix2.pyx
**********************************************************************
File "devel/sage/sage/matrix/matrix2.pyx", line 2320, in sage.matrix.matrix2.Matrix.diagonal._right_kernel_matrix_over_field
Failed example:
    P = result[1]; P
Expected:
    [       -1        -1         1         0]
    [-zeta14^3 -zeta14^4         0         1]
Got:
    [         3716055149462127149669597391230365/1741122812024444137450032682964234          3716055149462127149669597391230365/1741122812024444137450032682964234                                                                              1                                                                              0]
    [3716055149462127149669597391230365/1741122812024444137450032682964234*zeta14^3 3716055149462127149669597391230365/1741122812024444137450032682964234*zeta14^4                                                                              0                                                                              1]
**********************************************************************
```
And many more failures and timeouts: [http://build.sagemath.org/sage/builders/NTU%20arando%20%28Ubuntu%2012.10%20i686%29/builds/182/steps/shell_8/logs/stdio](http://build.sagemath.org/sage/builders/NTU%20arando%20%28Ubuntu%2012.10%20i686%29/builds/182/steps/shell_8/logs/stdio)



---

archive/issue_comments_177518.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThere are warnings\n\n```\nRuntimeWarning: sig_off() without sig_on() at build/cythonized/sage/matrix/misc.c:13370\n```\nwhich aren't caused by this ticket, but might as well be fixed: the `sig_on()` in `misc.pyx` should be *outside* the `try/finally` block:\n\n```\nsig_on()\ntry:\n    stuff\nfinally:\n    sig_off()\n```",
    "created_at": "2013-06-05T07:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177518",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

There are warnings

```
RuntimeWarning: sig_off() without sig_on() at build/cythonized/sage/matrix/misc.c:13370
```
which aren't caused by this ticket, but might as well be fixed: the `sig_on()` in `misc.pyx` should be *outside* the `try/finally` block:

```
sig_on()
try:
    stuff
finally:
    sig_off()
```



---

archive/issue_comments_177519.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-07-11T16:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177519",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_177520.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_14627_32bit.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)**\n\nI've fixed the 32-bit error, added documentation, and also fixed Jeroen's `sig_on` branch issue.",
    "created_at": "2013-07-11T16:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177520",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_14627_32bit.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)**

I've fixed the 32-bit error, added documentation, and also fixed Jeroen's `sig_on` branch issue.



---

archive/issue_events_207211.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-11T16:30:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207211"
}
```



---

archive/issue_events_207212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-11T16:30:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207212"
}
```



---

archive/issue_comments_177521.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe second patch needs review only",
    "created_at": "2013-07-11T16:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177521",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

The second patch needs review only



---

archive/issue_comments_177522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,4 +21,7 @@\n \n Also, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.\n \n-Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n+Apply \n+* [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n+* [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)\n+\n``````\n",
    "created_at": "2013-07-11T16:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177522",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,4 +21,7 @@
 
 Also, I collected some common extern cdef statements in pxd headers and cleaned up the `MAX_MODULUS` declarations.
 
-Apply [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
+Apply 
+* [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
+* [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)
+
``````




---

archive/issue_comments_177523.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe changes look good. I don't have a 32-bit machine here to test, but other than that, I'd say it's good to go. Volker, you tested it on a 32-bit system, I presume?",
    "created_at": "2013-07-12T12:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177523",
    "user": "https://github.com/malb"
}
```

<div id="comment:18" align="right">comment:18</div>

The changes look good. I don't have a 32-bit machine here to test, but other than that, I'd say it's good to go. Volker, you tested it on a 32-bit system, I presume?



---

archive/issue_comments_177524.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nYes, of course I tested it on a 32-bit machine",
    "created_at": "2013-07-12T13:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177524",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

Yes, of course I tested it on a 32-bit machine



---

archive/issue_events_207213.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-07-12T14:22:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207213"
}
```



---

archive/issue_events_207214.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-07-12T14:22:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207214"
}
```



---

archive/issue_comments_177525.json:
```json
{
    "body": "Attachment: **[trac_14627_more_primes.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_more_primes.patch.gz)**\n\nInitial patch",
    "created_at": "2013-07-18T12:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177525",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_14627_more_primes.patch.gz](https://github.com/sagemath/sage/files/ticket14627/trac_14627_more_primes.patch.gz)**

Initial patch



---

archive/issue_comments_177526.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI noticed that #10281 intentionally uses 64-bit integers on all platforms for `mod_int`, since otherwise you can run out of primes. This is checked in one #long doctest that I missed. So the `trac_14627_more_primes.patch` switches to signed `int_fast64_t` for `mod_int`, this is fast on 64-bit Linux/OSX and sub-optimal (but with enough primes) on 64-bit Windows and all 32-bit platforms.",
    "created_at": "2013-07-18T12:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177526",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

I noticed that #10281 intentionally uses 64-bit integers on all platforms for `mod_int`, since otherwise you can run out of primes. This is checked in one #long doctest that I missed. So the `trac_14627_more_primes.patch` switches to signed `int_fast64_t` for `mod_int`, this is fast on 64-bit Linux/OSX and sub-optimal (but with enough primes) on 64-bit Windows and all 32-bit platforms.



---

archive/issue_comments_177527.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n Apply \n * [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)\n * [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)\n-\n+* [attachment: trac_14627_more_primes.patch\u200b](https://github.com/sagemath/sage/files/ticket14627/237edace11db0f1fb7cd46aeda092206.gz)\n``````\n",
    "created_at": "2013-07-18T12:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177527",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 Apply 
 * [attachment: trac_14627_signed_mod_int.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_signed_mod_int.patch.gz)
 * [attachment: trac_14627_32bit.patch](https://github.com/sagemath/sage/files/ticket14627/trac_14627_32bit.patch.gz)
-
+* [attachment: trac_14627_more_primes.patchâ€‹](https://github.com/sagemath/sage/files/ticket14627/237edace11db0f1fb7cd46aeda092206.gz)
``````




---

archive/issue_events_207215.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-18T12:17:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207215"
}
```



---

archive/issue_events_207216.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-18T12:17:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207216"
}
```



---

archive/issue_events_207217.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-18T12:18:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207217"
}
```



---

archive/issue_events_207218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-07-18T12:18:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207218"
}
```



---

archive/issue_comments_177528.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n`make ptestlong` passes on both 32-bit ad 64-bit now. Martin, can you review the final patch?",
    "created_at": "2013-07-18T12:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177528",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

`make ptestlong` passes on both 32-bit ad 64-bit now. Martin, can you review the final patch?



---

archive/issue_comments_177529.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nLooks good to me",
    "created_at": "2013-07-18T13:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177529",
    "user": "https://github.com/malb"
}
```

<div id="comment:24" align="right">comment:24</div>

Looks good to me



---

archive/issue_events_207219.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-07-18T13:03:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207219"
}
```



---

archive/issue_events_207220.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2013-07-18T13:03:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207220"
}
```



---

archive/issue_events_207221.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:42:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207221"
}
```



---

archive/issue_events_207222.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:42:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207222"
}
```



---

archive/issue_events_207223.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:18:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207223"
}
```



---

archive/issue_events_207224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:18:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14627#event-207224"
}
```



---

archive/issue_comments_177530.json:
```json
{
    "body": "Merged: **sage-5.12.beta0**",
    "created_at": "2013-08-02T14:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177530",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta0**



---

archive/issue_comments_177531.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nCould the changes in that ticket be the cause of #15220?",
    "created_at": "2013-09-24T06:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14627#issuecomment-177531",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:27" align="right">comment:27</div>

Could the changes in that ticket be the cause of #15220?
