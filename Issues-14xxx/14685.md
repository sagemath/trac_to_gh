# Issue 14685: error in the computing of the approximate order in LazyPowerSeries

archive/issues_014481.json:
```json
{
    "body": "Hi,\n\nI found a bug in the LazyPowerSeries class of package combinat. There is mistake in the computing of the approximate order of a serie. A demonstration of the bug :\n\n```\nsage: R = LazyPowerSeriesRing(QQ)\nsage: B = R([0,0,0,1,0])\nsage: B.aorder\n0\nsage: B.coefficients(10)\n[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]\nsage: B.aorder\n1\n```\nThe good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )\n\nThe bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.\n\nAfter the patch, we obtain :\n\n```\nsage: R = LazyPowerSeriesRing(QQ)\nsage: B = R([0,0,0,1,0])\nsage: B.aorder\n0\nsage: B.coefficients(10)\n[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]\nsage: B.aorder\n3\n```\nWhat we expected.\n\nPS : Thanks you for the commments, I tried to answer them.\nPS 2 : I modified the patch as you asked\n\n**Assignee:** sage-combinat\n\n**CC:**  @mantepse\n\n**Keywords:** LazyPowerSeries aorder approximate order\n\n**Reviewer:** Travis Scrimshaw\n\n**Status:** needs_review\n\nIssue created by migration from https://trac.sagemath.org/ticket/14685\n\n",
    "created_at": "2013-06-04T16:15:22Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "error in the computing of the approximate order in LazyPowerSeries",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14685",
    "user": "https://github.com/MatthieuDien"
}
```
Hi,

I found a bug in the LazyPowerSeries class of package combinat. There is mistake in the computing of the approximate order of a serie. A demonstration of the bug :

```
sage: R = LazyPowerSeriesRing(QQ)
sage: B = R([0,0,0,1,0])
sage: B.aorder
0
sage: B.coefficients(10)
[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]
sage: B.aorder
1
```
The good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )

The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.

After the patch, we obtain :

```
sage: R = LazyPowerSeriesRing(QQ)
sage: B = R([0,0,0,1,0])
sage: B.aorder
0
sage: B.coefficients(10)
[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]
sage: B.aorder
3
```
What we expected.

PS : Thanks you for the commments, I tried to answer them.
PS 2 : I modified the patch as you asked

**Assignee:** sage-combinat

**CC:**  @mantepse

**Keywords:** LazyPowerSeries aorder approximate order

**Reviewer:** Travis Scrimshaw

**Status:** needs_review

Issue created by migration from https://trac.sagemath.org/ticket/14685





---

archive/issue_comments_219907.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -50,3 +50,7 @@\n      \n          if hasattr(self, '_reference') and self._reference is not None:\n ```\n+\n+I commited it with the number 18037 on the mercurial server\n+\n+It's my first patch, sorry if i did a mistake.\n``````\n",
    "created_at": "2013-06-04T16:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219907",
    "user": "https://github.com/MatthieuDien"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -50,3 +50,7 @@
      
          if hasattr(self, '_reference') and self._reference is not None:
 ```
+
+I commited it with the number 18037 on the mercurial server
+
+It's my first patch, sorry if i did a mistake.
``````




---

archive/issue_comments_219908.json:
```json
{
    "body": "<a id='comment:2'></a>\nBienvenue \u00e0 bord !\n\nYour patch does not looks good: it contains three times the same thing. It is necessary to make it again in a more clean way.\n\nIt is not clear to me what the expected result should be in the example given above. Which answer is correct and which one is not ?\n\nApart from that, it would be good to add a test to check that the error is corrected. Something like\n\n```\nOne checks that :trac:`14685` is solved::\n\n    sage: R = LazyPowerSeriesRing(QQ)\n```\nand then the appropriate example.",
    "created_at": "2013-06-05T20:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219908",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
Bienvenue à bord !

Your patch does not looks good: it contains three times the same thing. It is necessary to make it again in a more clean way.

It is not clear to me what the expected result should be in the example given above. Which answer is correct and which one is not ?

Apart from that, it would be good to add a test to check that the error is corrected. Something like

```
One checks that :trac:`14685` is solved::

    sage: R = LazyPowerSeriesRing(QQ)
```
and then the appropriate example.



---

archive/issue_comments_219909.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,43 +14,70 @@\n sage: B.aorder\n 1\n ```\n+The good result should be 3 and not 1 (the order of the series B = x^3 is 3 not 1 )\n \n-Here, a patch :\n+Here, a patch which fix that:\n \n ```\n-diff --git a/sage/combinat/species/series.py b/sage/combinat/species/series.py\n---- a/sage/combinat/species/series.py\n-+++ b/sage/combinat/species/series.py\n-@@ -631,6 +631,7 @@\n-                         self.aorder += 1\n-                         ao += 1\n-                     else:\n-+                        self.order = ao\n-                         break\n+--- series_old.py\t2013-06-08 13:48:40.490566975 +0200\n++++ series.py\t2013-06-08 14:00:41.903399503 +0200\n+@@ -624,17 +624,17 @@\n+             c = self._stream\n+             n = c.number_computed()\n+ \n++            while ao < n:\n++                if self._stream[ao] == 0:\n++                    self.aorder += 1\n++                    ao += 1\n++                else:\n++                    self.order = ao\n++                    break\n+ \n+-            if ao == 0 and n > 0:\n+-                while ao < n:\n+-                    if self._stream[ao] == 0:\n+-                        self.aorder += 1\n+-                        ao += 1\n+-                    else:\n+-                        break\n  \n              #Try to recognize the zero series\n-@@ -643,8 +644,17 @@\n+-            if ao == n:\n++            if ao == n and n > 0:\n+                 #For non-constant series, we cannot do anything\n+                 if not c.is_constant():\n+                     return\n+@@ -642,11 +642,7 @@\n+                     self.aorder = inf\n                      self.order  = inf\n                      return\n-                 \n+-                \n -            if ao < n:\n -                self.order = ao\n-+            if self.order == unk:\n-+                while ao < n:\n-+                    if self._stream[ao] == 0:\n-+                        self.aorder += 1\n-+                        ao += 1\n-+                    else:\n-+                        self.order = ao\n-+                        break\n+-            \n+-    \n +\n-+            # if ao < n:\n-+            #     self.order = ao\n-             \n-     \n          if hasattr(self, '_reference') and self._reference is not None:\n+             self._reference._copy(self)\n+```\n+The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.\n+\n+After the patch, we obtain : \n+\n+```\n+sage: R = LazyPowerSeriesRing(QQ)\n+sage: B = R([0,0,0,1,0])\n+sage: B.aorder\n+0\n+sage: B.coefficients(10)\n+[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]\n+sage: B.aorder\n+3\n ```\n \n-I commited it with the number 18037 on the mercurial server\n+What we expected.\n \n-It's my first patch, sorry if i did a mistake.\n+\n+PS : Thanks you for the commment, I tried to answer.\n+\n+\n``````\n",
    "created_at": "2013-06-07T10:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219909",
    "user": "https://github.com/MatthieuDien"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,43 +14,70 @@
 sage: B.aorder
 1
 ```
+The good result should be 3 and not 1 (the order of the series B = x^3 is 3 not 1 )
 
-Here, a patch :
+Here, a patch which fix that:
 
 ```
-diff --git a/sage/combinat/species/series.py b/sage/combinat/species/series.py
---- a/sage/combinat/species/series.py
-+++ b/sage/combinat/species/series.py
-@@ -631,6 +631,7 @@
-                         self.aorder += 1
-                         ao += 1
-                     else:
-+                        self.order = ao
-                         break
+--- series_old.py	2013-06-08 13:48:40.490566975 +0200
++++ series.py	2013-06-08 14:00:41.903399503 +0200
+@@ -624,17 +624,17 @@
+             c = self._stream
+             n = c.number_computed()
+ 
++            while ao < n:
++                if self._stream[ao] == 0:
++                    self.aorder += 1
++                    ao += 1
++                else:
++                    self.order = ao
++                    break
+ 
+-            if ao == 0 and n > 0:
+-                while ao < n:
+-                    if self._stream[ao] == 0:
+-                        self.aorder += 1
+-                        ao += 1
+-                    else:
+-                        break
  
              #Try to recognize the zero series
-@@ -643,8 +644,17 @@
+-            if ao == n:
++            if ao == n and n > 0:
+                 #For non-constant series, we cannot do anything
+                 if not c.is_constant():
+                     return
+@@ -642,11 +642,7 @@
+                     self.aorder = inf
                      self.order  = inf
                      return
-                 
+-                
 -            if ao < n:
 -                self.order = ao
-+            if self.order == unk:
-+                while ao < n:
-+                    if self._stream[ao] == 0:
-+                        self.aorder += 1
-+                        ao += 1
-+                    else:
-+                        self.order = ao
-+                        break
+-            
+-    
 +
-+            # if ao < n:
-+            #     self.order = ao
-             
-     
          if hasattr(self, '_reference') and self._reference is not None:
+             self._reference._copy(self)
+```
+The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.
+
+After the patch, we obtain : 
+
+```
+sage: R = LazyPowerSeriesRing(QQ)
+sage: B = R([0,0,0,1,0])
+sage: B.aorder
+0
+sage: B.coefficients(10)
+[0, 0, 0, 1, 0, 0, 0, 0, 0, 0]
+sage: B.aorder
+3
 ```
 
-I commited it with the number 18037 on the mercurial server
+What we expected.
 
-It's my first patch, sorry if i did a mistake.
+
+PS : Thanks you for the commment, I tried to answer.
+
+
``````




---

archive/issue_comments_219910.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,6 @@\n Hi,\n \n-I found a bug in the LazyPowerSeries class of package combinat.\n-There is mistake in the computing of the approximate order of a serie.\n-A demonstration of the bug :\n+I found a bug in the LazyPowerSeries class of package combinat. There is mistake in the computing of the approximate order of a serie. A demonstration of the bug :\n \n ```\n sage: R = LazyPowerSeriesRing(QQ)\n@@ -14,7 +12,7 @@\n sage: B.aorder\n 1\n ```\n-The good result should be 3 and not 1 (the order of the series B = x^3 is 3 not 1 )\n+The good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )\n \n Here, a patch which fix that:\n \n@@ -62,7 +60,7 @@\n ```\n The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.\n \n-After the patch, we obtain : \n+After the patch, we obtain :\n \n ```\n sage: R = LazyPowerSeriesRing(QQ)\n@@ -74,10 +72,6 @@\n sage: B.aorder\n 3\n ```\n-\n What we expected.\n \n-\n PS : Thanks you for the commment, I tried to answer.\n-\n-\n``````\n",
    "created_at": "2013-06-07T10:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219910",
    "user": "https://github.com/MatthieuDien"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,6 @@
 Hi,
 
-I found a bug in the LazyPowerSeries class of package combinat.
-There is mistake in the computing of the approximate order of a serie.
-A demonstration of the bug :
+I found a bug in the LazyPowerSeries class of package combinat. There is mistake in the computing of the approximate order of a serie. A demonstration of the bug :
 
 ```
 sage: R = LazyPowerSeriesRing(QQ)
@@ -14,7 +12,7 @@
 sage: B.aorder
 1
 ```
-The good result should be 3 and not 1 (the order of the series B = x^3 is 3 not 1 )
+The good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )
 
 Here, a patch which fix that:
 
@@ -62,7 +60,7 @@
 ```
 The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.
 
-After the patch, we obtain : 
+After the patch, we obtain :
 
 ```
 sage: R = LazyPowerSeriesRing(QQ)
@@ -74,10 +72,6 @@
 sage: B.aorder
 3
 ```
-
 What we expected.
 
-
 PS : Thanks you for the commment, I tried to answer.
-
-
``````




---

archive/issue_comments_219911.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -74,4 +74,4 @@\n ```\n What we expected.\n \n-PS : Thanks you for the commment, I tried to answer.\n+PS : Thanks you for the commment, I tried to answer it.\n``````\n",
    "created_at": "2013-06-07T10:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219911",
    "user": "https://github.com/MatthieuDien"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -74,4 +74,4 @@
 ```
 What we expected.
 
-PS : Thanks you for the commment, I tried to answer.
+PS : Thanks you for the commment, I tried to answer it.
``````




---

archive/issue_comments_219912.json:
```json
{
    "body": "<a id='comment:6'></a>\nHello,\n\nthe corrected behaviour should be added **to the code**, in the documentation at the start of the function.\n\nYour patch still looks strange. How do you make it ?\n\nYou should\n\n```\n1) cd to the directory sage-5.9/devel/sage-main/\n2) create a patch with hg qnew trac_xxxxx_name_of_the_patch.patch\n3) edit the sources\n4) put the changes into the patch by hg qrefresh (then either go to step 3 or step 5)\n5) edit the header of the patch by hg qrefresh -e\n6) export the patch by hg export tip > filename (for example $HOME/trac_xxxxx_name_of_the_patch.patch)\n7) put this exported file in trac\n```",
    "created_at": "2013-06-07T11:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219912",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
Hello,

the corrected behaviour should be added **to the code**, in the documentation at the start of the function.

Your patch still looks strange. How do you make it ?

You should

```
1) cd to the directory sage-5.9/devel/sage-main/
2) create a patch with hg qnew trac_xxxxx_name_of_the_patch.patch
3) edit the sources
4) put the changes into the patch by hg qrefresh (then either go to step 3 or step 5)
5) edit the header of the patch by hg qrefresh -e
6) export the patch by hg export tip > filename (for example $HOME/trac_xxxxx_name_of_the_patch.patch)
7) put this exported file in trac
```



---

archive/issue_comments_219913.json:
```json
{
    "body": "<a id='comment:7'></a>\nHi!\n\nThanks for working on the lazy power series code; it needs some love.\n\nJust one thing to be careful with; I haven't looked in detail in your code, so maybe it takes care of this already:\n\nThe method might be passed as argument a lazy power series implemented by a function f(n) which returns always 0; or some non zero coefficient but only for n very large. In such a case we don't want to run forever: this is about computing an approximation of the order, and often, knowing that the order is at least 1 or at least 2 is sufficient for the purpose (initializing the recurrence for computing series defined recursively). \n\nOf course, there are case where we do want the exact order, even at the price of running for a long time.\n\nIts possible that the interface needs a bit of cleaning up so that the distinction between approximate order and order would be well exposed (and by the way maybe this should really be called valuation rather than order).",
    "created_at": "2013-06-07T12:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219913",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>
Hi!

Thanks for working on the lazy power series code; it needs some love.

Just one thing to be careful with; I haven't looked in detail in your code, so maybe it takes care of this already:

The method might be passed as argument a lazy power series implemented by a function f(n) which returns always 0; or some non zero coefficient but only for n very large. In such a case we don't want to run forever: this is about computing an approximation of the order, and often, knowing that the order is at least 1 or at least 2 is sufficient for the purpose (initializing the recurrence for computing series defined recursively). 

Of course, there are case where we do want the exact order, even at the price of running for a long time.

Its possible that the interface needs a bit of cleaning up so that the distinction between approximate order and order would be well exposed (and by the way maybe this should really be called valuation rather than order).



---

archive/issue_comments_219914.json:
```json
{
    "body": "<a id='comment:8'></a>\nfor chapoton :\n\nI made the patch with a **diff -Naur ** but I will fix this.\nThank you for the detailed method.\n\nfor nthiery :\n\nI am not sure to understand what you said :\ncurrently the computing of the approximate order cost is amortized on every request for a serie's term (and it's a little cost). Normally, the order should be known when the approximate order reaches him.\n\nThe patch keeps this behavior.\nThis was your question ?\n\nMoreover, the current version do not compute the right order too :\n\n ```\n sage: R = LazyPowerSeriesRing(QQ)\n sage: B = R([0,0,0,1,0])\n sage: B.order\n Unknown series order\n sage: B.coefficients(10)\n [0, 0, 0, 1, 0, 0, 0, 0, 0, 0]\n sage: B.aorder\n 0   #instead of 3\n ```",
    "created_at": "2013-06-07T13:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219914",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:8'></a>
for chapoton :

I made the patch with a **diff -Naur ** but I will fix this.
Thank you for the detailed method.

for nthiery :

I am not sure to understand what you said :
currently the computing of the approximate order cost is amortized on every request for a serie's term (and it's a little cost). Normally, the order should be known when the approximate order reaches him.

The patch keeps this behavior.
This was your question ?

Moreover, the current version do not compute the right order too :

 ```
 sage: R = LazyPowerSeriesRing(QQ)
 sage: B = R([0,0,0,1,0])
 sage: B.order
 Unknown series order
 sage: B.coefficients(10)
 [0, 0, 0, 1, 0, 0, 0, 0, 0, 0]
 sage: B.aorder
 0   #instead of 3
 ```



---

archive/issue_comments_219915.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,50 +14,6 @@\n ```\n The good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )\n \n-Here, a patch which fix that:\n-\n-```\n---- series_old.py\t2013-06-08 13:48:40.490566975 +0200\n-+++ series.py\t2013-06-08 14:00:41.903399503 +0200\n-@@ -624,17 +624,17 @@\n-             c = self._stream\n-             n = c.number_computed()\n- \n-+            while ao < n:\n-+                if self._stream[ao] == 0:\n-+                    self.aorder += 1\n-+                    ao += 1\n-+                else:\n-+                    self.order = ao\n-+                    break\n- \n--            if ao == 0 and n > 0:\n--                while ao < n:\n--                    if self._stream[ao] == 0:\n--                        self.aorder += 1\n--                        ao += 1\n--                    else:\n--                        break\n- \n-             #Try to recognize the zero series\n--            if ao == n:\n-+            if ao == n and n > 0:\n-                 #For non-constant series, we cannot do anything\n-                 if not c.is_constant():\n-                     return\n-@@ -642,11 +642,7 @@\n-                     self.aorder = inf\n-                     self.order  = inf\n-                     return\n--                \n--            if ao < n:\n--                self.order = ao\n--            \n--    \n-+\n-         if hasattr(self, '_reference') and self._reference is not None:\n-             self._reference._copy(self)\n-```\n The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.\n \n After the patch, we obtain :\n@@ -74,4 +30,5 @@\n ```\n What we expected.\n \n-PS : Thanks you for the commment, I tried to answer it.\n+PS : Thanks you for the commments, I tried to answer them.\n+PS 2 : I modified the patch as you asked\n``````\n",
    "created_at": "2013-06-08T16:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219915",
    "user": "https://github.com/MatthieuDien"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,50 +14,6 @@
 ```
 The good result should be 3 and not 1 (the order of the series B = x<sup>3</sup> is 3 not 1 )
 
-Here, a patch which fix that:
-
-```
---- series_old.py	2013-06-08 13:48:40.490566975 +0200
-+++ series.py	2013-06-08 14:00:41.903399503 +0200
-@@ -624,17 +624,17 @@
-             c = self._stream
-             n = c.number_computed()
- 
-+            while ao < n:
-+                if self._stream[ao] == 0:
-+                    self.aorder += 1
-+                    ao += 1
-+                else:
-+                    self.order = ao
-+                    break
- 
--            if ao == 0 and n > 0:
--                while ao < n:
--                    if self._stream[ao] == 0:
--                        self.aorder += 1
--                        ao += 1
--                    else:
--                        break
- 
-             #Try to recognize the zero series
--            if ao == n:
-+            if ao == n and n > 0:
-                 #For non-constant series, we cannot do anything
-                 if not c.is_constant():
-                     return
-@@ -642,11 +642,7 @@
-                     self.aorder = inf
-                     self.order  = inf
-                     return
--                
--            if ao < n:
--                self.order = ao
--            
--    
-+
-         if hasattr(self, '_reference') and self._reference is not None:
-             self._reference._copy(self)
-```
 The bug is that the aorder is computed one time and never updated. This is because the order was assigned the first time then the condition self.order != unk becomes false and the update never comes.
 
 After the patch, we obtain :
@@ -74,4 +30,5 @@
 ```
 What we expected.
 
-PS : Thanks you for the commment, I tried to answer it.
+PS : Thanks you for the commments, I tried to answer them.
+PS 2 : I modified the patch as you asked
``````




---

archive/issue_comments_219916.json:
```json
{
    "body": "**Reviewer:** Mike Hansen",
    "created_at": "2013-06-21T13:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219916",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Mike Hansen



---

archive/issue_comments_219917.json:
```json
{
    "body": "<a id='comment:10'></a>\nI posted a version of the patch which fixes the commit message.  This looks good to me, and I agree with Matthieu's assessment of the amortized costs.",
    "created_at": "2013-06-21T13:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219917",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'></a>
I posted a version of the patch which fixes the commit message.  This looks good to me, and I agree with Matthieu's assessment of the amortized costs.



---

archive/issue_comments_219918.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2013-06-21T13:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219918",
    "user": "https://github.com/mwhansen"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_219919.json:
```json
{
    "body": "**Author:** Matthieu Dien",
    "created_at": "2013-06-21T13:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219919",
    "user": "https://github.com/mwhansen"
}
```

**Author:** Matthieu Dien



---

archive/issue_comments_219920.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2013-06-21T13:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219920",
    "user": "https://github.com/mwhansen"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_219921.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mhansen](#comment%3A11):\nThank you !",
    "created_at": "2013-06-22T11:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219921",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:12'></a>
Replying to [mhansen](#comment%3A11):
Thank you !



---

archive/attachments_019771.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14685_bug_aorder_lazypowerseries.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14685/trac_14685_bug_aorder_lazypowerseries.patch",
    "created_at": "2013-07-21T19:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_219922.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe new patch should apply.",
    "created_at": "2013-07-21T19:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219922",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:13'></a>
The new patch should apply.



---

archive/issue_comments_219923.json:
```json
{
    "body": "<a id='comment:14'></a>\nApply trac_14685_bug_aorder_lazypowerseries.patch\u200b",
    "created_at": "2013-07-21T21:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219923",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:14'></a>
Apply trac_14685_bug_aorder_lazypowerseries.patch​



---

archive/issue_comments_219924.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhat's going wrong?\n\n```\ndarij@travis-virtualbox:~/sage-5.11.beta3/devel/sage-main/sage/combinat$ hg qpush\napplying trac_14685_bug_aorder_lazypowerseries.patch\npatching file sage/combinat/species/series.py\nHunk #2 FAILED at 641\nHunk #3 FAILED at 660\n2 out of 3 hunks FAILED -- saving rejects to file sage/combinat/species/series.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac_14685_bug_aorder_lazypowerseries.patch\ndarij@travis-virtualbox:~/sage-5.11.beta3/devel/sage-main/sage/combinat$ \n```\n\nSeries file:\n\n```\ntrac_14808-recoils_of_permutations-ts.patch\ntrac_14117-jordan_normal_form-dg-v3.patch\ntrac_7983-major_index_and_other_tableau_fixes-dg.patch\ntrac_14748_deprecationwarning.patch\ntrac_14136-p_partition_enumerator_folded.patch\ntrac_14507-tropical_semiring-ts.patch\ntrac_14775-symmetric_functions_extended-dg.patch\ntrac_14783-toggles_on_order_ideals-jsdg.patch\ntrac_14516-crystals_speedup-ts.2.patch\ntrac_14519-cynthonize_element_wrapper-ts.patch\ntrac_8386_really_just_moving-fc.patch\ntrac_8386_big_clean_fc.patch\ntrac_8386_assert_removal.patch\ntrac_14772-remove_cc_permutations-ts.patch\ntrac_13589-categories-c3_under_control-nt.patch\ntrac_14884-tableau_times_id-dg.patch\ntrac_14883-remove_times_id-dg.patch\ntrac_14101-remove_cc_skew-ts.patch\ntrac_14882-backtrack_longtime-dg-v2.patch\ntrac_14881-symmetric_group_algebra_rebased-dg.patch\ntrac_13214_hom_finite_field.patch\ntrac_14860-bug-binary-trees-vp.patch\ntrac_12571-shifted_shuffle_of_permutations-reviewed.patch\ntrac_14685_bug_aorder_lazypowerseries.patch\n```",
    "created_at": "2013-07-22T10:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219924",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:15'></a>
What's going wrong?

```
darij@travis-virtualbox:~/sage-5.11.beta3/devel/sage-main/sage/combinat$ hg qpush
applying trac_14685_bug_aorder_lazypowerseries.patch
patching file sage/combinat/species/series.py
Hunk #2 FAILED at 641
Hunk #3 FAILED at 660
2 out of 3 hunks FAILED -- saving rejects to file sage/combinat/species/series.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac_14685_bug_aorder_lazypowerseries.patch
darij@travis-virtualbox:~/sage-5.11.beta3/devel/sage-main/sage/combinat$ 
```

Series file:

```
trac_14808-recoils_of_permutations-ts.patch
trac_14117-jordan_normal_form-dg-v3.patch
trac_7983-major_index_and_other_tableau_fixes-dg.patch
trac_14748_deprecationwarning.patch
trac_14136-p_partition_enumerator_folded.patch
trac_14507-tropical_semiring-ts.patch
trac_14775-symmetric_functions_extended-dg.patch
trac_14783-toggles_on_order_ideals-jsdg.patch
trac_14516-crystals_speedup-ts.2.patch
trac_14519-cynthonize_element_wrapper-ts.patch
trac_8386_really_just_moving-fc.patch
trac_8386_big_clean_fc.patch
trac_8386_assert_removal.patch
trac_14772-remove_cc_permutations-ts.patch
trac_13589-categories-c3_under_control-nt.patch
trac_14884-tableau_times_id-dg.patch
trac_14883-remove_times_id-dg.patch
trac_14101-remove_cc_skew-ts.patch
trac_14882-backtrack_longtime-dg-v2.patch
trac_14881-symmetric_group_algebra_rebased-dg.patch
trac_13214_hom_finite_field.patch
trac_14860-bug-binary-trees-vp.patch
trac_12571-shifted_shuffle_of_permutations-reviewed.patch
trac_14685_bug_aorder_lazypowerseries.patch
```



---

archive/issue_comments_219925.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis doesn't apply to sage-5.11.beta3:\n\n```\napplying /release/merger/patches/trac_14685_bug_aorder_lazypowerseries.patch\npatching file sage/combinat/species/series.py\nHunk #2 FAILED at 641\nHunk #3 FAILED at 660\n2 out of 3 hunks FAILED -- saving rejects to file sage/combinat/species/series.py.rej\nabort: patch failed to apply\n```",
    "created_at": "2013-07-24T07:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219925",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
This doesn't apply to sage-5.11.beta3:

```
applying /release/merger/patches/trac_14685_bug_aorder_lazypowerseries.patch
patching file sage/combinat/species/series.py
Hunk #2 FAILED at 641
Hunk #3 FAILED at 660
2 out of 3 hunks FAILED -- saving rejects to file sage/combinat/species/series.py.rej
abort: patch failed to apply
```



---

archive/issue_events_048581.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-24T07:03:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48581"
}
```



---

archive/issue_comments_219926.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2013-07-24T07:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219926",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/attachments_019772.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14685-darijs_mod.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14685/trac_14685-darijs_mod.patch",
    "created_at": "2013-07-29T16:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/darijgr"
}
```



---

archive/issue_comments_219927.json:
```json
{
    "body": "Alternative version of the patch, which applies on my system",
    "created_at": "2013-07-29T16:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219927",
    "user": "https://github.com/darijgr"
}
```

Alternative version of the patch, which applies on my system



---

archive/issue_comments_219928.json:
```json
{
    "body": "<a id='comment:17'></a>\nI've attached a modified version of the patch that applies on my system. Since Jeroen, me and the patchbot seem to be stumbling over the same error, I assume this might be of some help. All I've changed were deleted lines, which gives me some hope I didn't break anything, so I'm going to be blunt:\n\nPatchbot:\n\napply trac_14685-darijs_mod.patch\u200b",
    "created_at": "2013-07-29T16:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219928",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:17'></a>
I've attached a modified version of the patch that applies on my system. Since Jeroen, me and the patchbot seem to be stumbling over the same error, I assume this might be of some help. All I've changed were deleted lines, which gives me some hope I didn't break anything, so I'm going to be blunt:

Patchbot:

apply trac_14685-darijs_mod.patch​



---

archive/issue_events_048582.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-07-29T16:09:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48582"
}
```



---

archive/issue_events_048583.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-07-29T16:09:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48583"
}
```



---

archive/issue_comments_219929.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2013-07-29T16:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219929",
    "user": "https://github.com/darijgr"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_048584.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48584"
}
```



---

archive/issue_events_048585.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48585"
}
```



---

archive/issue_comments_219930.json:
```json
{
    "body": "<a id='comment:22'></a>\nA fix is in #15673",
    "created_at": "2014-01-14T17:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219930",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:22'></a>
A fix is in #15673



---

archive/issue_events_048586.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48586"
}
```



---

archive/issue_events_048587.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48587"
}
```



---

archive/issue_events_048588.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48588"
}
```



---

archive/issue_events_048589.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48589"
}
```



---

archive/issue_events_048590.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48590"
}
```



---

archive/issue_events_048591.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48591"
}
```



---

archive/issue_events_048592.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-02-23T19:34:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48592"
}
```



---

archive/issue_events_048593.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-02-23T19:34:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48593"
}
```



---

archive/issue_comments_219931.json:
```json
{
    "body": "<a id='comment:26'></a>\nNeeds a working git branch",
    "created_at": "2015-02-23T19:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219931",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
Needs a working git branch



---

archive/issue_comments_219932.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2015-02-23T19:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219932",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_219933.json:
```json
{
    "body": "**Stopgaps:** wrongAnswerMarker",
    "created_at": "2016-07-09T15:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219933",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

**Stopgaps:** wrongAnswerMarker



---

archive/issue_comments_219934.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-08-12T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219934",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_048594.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-08-12T01:00:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48594"
}
```



---

archive/issue_events_048595.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-08-12T01:00:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14685#event-48595"
}
```



---

archive/issue_comments_219935.json:
```json
{
    "body": "<a id='comment:28'></a>\nI propose closing this as invalid since this is only meant to be the approximate order, not the actual order. So as long as `aorder <= order`, then it is correct. (Although it might be considered a missed optimization.)\n\nThis is also set to be replaced soon; see #31651.",
    "created_at": "2021-08-12T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219935",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
I propose closing this as invalid since this is only meant to be the approximate order, not the actual order. So as long as `aorder <= order`, then it is correct. (Although it might be considered a missed optimization.)

This is also set to be replaced soon; see #31651.



---

archive/issue_comments_219936.json:
```json
{
    "body": "**Changing author** from \"Matthieu Dien\" to \"\".",
    "created_at": "2021-08-12T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219936",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Matthieu Dien" to "".



---

archive/issue_comments_219937.json:
```json
{
    "body": "**Changing stopgaps** from \"wrongAnswerMarker\" to \"\".",
    "created_at": "2021-08-12T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219937",
    "user": "https://github.com/tscrim"
}
```

**Changing stopgaps** from "wrongAnswerMarker" to "".



---

archive/issue_comments_219938.json:
```json
{
    "body": "**Changing reviewer** from \"Mike Hansen\" to \"Travis Scrimshaw\".",
    "created_at": "2021-08-12T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14685#issuecomment-219938",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Mike Hansen" to "Travis Scrimshaw".
