# Issue 14199: Docbuilder changes sagetex.rst

archive/issues_013995.json:
```json
{
    "body": "Install sage-5.8.beta2 and build the documentation. Now\n\n```\n$ touch devel/sage/doc/en/reference/misc/sagetex.rst\n$ make doc\n```\nand you will see the following change appear:\n\n```diff\ndiff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst\n--- a/doc/en/reference/misc/sagetex.rst\n+++ b/doc/en/reference/misc/sagetex.rst\n@@ -1,11 +1,16 @@\n-Installing and using SageTeX\n-============================\n+.. nodoctest\n\n-SageTeX is a system for embedding computations and plots from Sage into\n-LaTeX documents. It is included by default with Sage, so if you have\n-installed Sage, you already have SageTeX. However, to get it to work,\n-you need to make TeX aware of SageTeX. Instructions for that are in the\n-\"Make SageTeX known to TeX\" section of the `Sage installation guide\n-<http://sagemath.org/doc/installation/index.html>`_ (`this link\n-<../../installation/index.html>`_ should take you to a local copy of the\n-installation guide).\n+.. _sagetex:\n+\n+MISSING TITLE\n+=============\n+\n+.. This file has been autogenerated.\n+\n+\n+.. automodule:: sagetex\n+   :members:\n+   :undoc-members:\n+   :show-inheritance:\n+\n+\n```\nIf this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?\n\nMaking the file `sagetex.rst` unwritable shows where the file is written:\n\n```\nTraceback (most recent call last):\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 45, in build_ref_doc\n    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 662, in _wrapper\n    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 924, in write_auto_rest_file\n    outfile = open(filename, 'w')\nIOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'\n```\n\n**Assignee:** mvngu\n\n**CC:**  @jhpalmieri\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** John Palmieri\n\n**Merged:** sage-5.8.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/14199\n\n",
    "closed_at": "2013-03-07T18:54:00Z",
    "created_at": "2013-02-27T20:22:55Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Docbuilder changes sagetex.rst",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14199",
    "user": "https://github.com/jdemeyer"
}
```
Install sage-5.8.beta2 and build the documentation. Now

```
$ touch devel/sage/doc/en/reference/misc/sagetex.rst
$ make doc
```
and you will see the following change appear:

```diff
diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst
--- a/doc/en/reference/misc/sagetex.rst
+++ b/doc/en/reference/misc/sagetex.rst
@@ -1,11 +1,16 @@
-Installing and using SageTeX
-============================
+.. nodoctest

-SageTeX is a system for embedding computations and plots from Sage into
-LaTeX documents. It is included by default with Sage, so if you have
-installed Sage, you already have SageTeX. However, to get it to work,
-you need to make TeX aware of SageTeX. Instructions for that are in the
-"Make SageTeX known to TeX" section of the `Sage installation guide
-<http://sagemath.org/doc/installation/index.html>`_ (`this link
-<../../installation/index.html>`_ should take you to a local copy of the
-installation guide).
+.. _sagetex:
+
+MISSING TITLE
+=============
+
+.. This file has been autogenerated.
+
+
+.. automodule:: sagetex
+   :members:
+   :undoc-members:
+   :show-inheritance:
+
+
```
If this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?

Making the file `sagetex.rst` unwritable shows where the file is written:

```
Traceback (most recent call last):
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 45, in build_ref_doc
    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 662, in _wrapper
    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 924, in write_auto_rest_file
    outfile = open(filename, 'w')
IOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'
```

**Assignee:** mvngu

**CC:**  @jhpalmieri

**Reviewer:** Jeroen Demeyer

**Author:** John Palmieri

**Merged:** sage-5.8.beta4

Issue created by migration from https://trac.sagemath.org/ticket/14199





---

archive/issue_comments_171776.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-I noticed that suddenly the following changes appeared in my working repository:\n+On some OS X 10.6 system, I noticed that suddenly the following changes appeared in my working repository:\n \n ```diff\n diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst\n``````\n",
    "created_at": "2013-02-27T20:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171776",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-I noticed that suddenly the following changes appeared in my working repository:
+On some OS X 10.6 system, I noticed that suddenly the following changes appeared in my working repository:
 
 ```diff
 diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst
``````




---

archive/issue_comments_171777.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -33,3 +33,18 @@\n +\n ```\n If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?\n+\n+This happened with sage-5.8.beta2 + the patches\n+\n+```\n+buildbot@bsd sage$ hg qapp\n+14079_pselecter.patch\n+14184_optional.patch\n+14184_manual.patch\n+12415_framework.patch\n+12415_doctest_fixes.patch\n+12415_doctest_review.patch\n+12415_doc.patch\n+12415_review.patch\n+12415_test.patch\n+```\n``````\n",
    "created_at": "2013-02-27T20:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171777",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -33,3 +33,18 @@
 +
 ```
 If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?
+
+This happened with sage-5.8.beta2 + the patches
+
+```
+buildbot@bsd sage$ hg qapp
+14079_pselecter.patch
+14184_optional.patch
+14184_manual.patch
+12415_framework.patch
+12415_doctest_fixes.patch
+12415_doctest_review.patch
+12415_doc.patch
+12415_review.patch
+12415_test.patch
+```
``````




---

archive/issue_comments_171778.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -34,17 +34,4 @@\n ```\n If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?\n \n-This happened with sage-5.8.beta2 + the patches\n-\n-```\n-buildbot@bsd sage$ hg qapp\n-14079_pselecter.patch\n-14184_optional.patch\n-14184_manual.patch\n-12415_framework.patch\n-12415_doctest_fixes.patch\n-12415_doctest_review.patch\n-12415_doc.patch\n-12415_review.patch\n-12415_test.patch\n-```\n+This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].\n``````\n",
    "created_at": "2013-02-27T21:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171778",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -34,17 +34,4 @@
 ```
 If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?
 
-This happened with sage-5.8.beta2 + the patches
-
-```
-buildbot@bsd sage$ hg qapp
-14079_pselecter.patch
-14184_optional.patch
-14184_manual.patch
-12415_framework.patch
-12415_doctest_fixes.patch
-12415_doctest_review.patch
-12415_doc.patch
-12415_review.patch
-12415_test.patch
-```
+This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].
``````




---

archive/issue_comments_171779.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think I may have seen something like this a long time ago, in the early stages of testing #6495, but then I thought it had to do with maybe not deleting the old doc output or something like that. Was this a build from scratch or an upgrade?\n\nI think that the only OS X 10.6 system that I have access to is bsd.math.washington.edu, and I can't reproduce this there, at least after building the docs a few times with a freshly built Sage 5.8.beta2.",
    "created_at": "2013-03-01T04:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171779",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
I think I may have seen something like this a long time ago, in the early stages of testing #6495, but then I thought it had to do with maybe not deleting the old doc output or something like that. Was this a build from scratch or an upgrade?

I think that the only OS X 10.6 system that I have access to is bsd.math.washington.edu, and I can't reproduce this there, at least after building the docs a few times with a freshly built Sage 5.8.beta2.



---

archive/issue_comments_171780.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> Was this a build from scratch or an upgrade?\n\nI don't remember, it was on a buildbot machine (`bsd.math`), but I guess it was a build from scratch. On `bsd.math` look for `/Users/buildbot/sage-5.8.beta2-14199.tar.bz2` which is a build with this problem.",
    "created_at": "2013-03-01T07:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171780",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A5):
> Was this a build from scratch or an upgrade?

I don't remember, it was on a buildbot machine (`bsd.math`), but I guess it was a build from scratch. On `bsd.math` look for `/Users/buildbot/sage-5.8.beta2-14199.tar.bz2` which is a build with this problem.



---

archive/issue_comments_171781.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -35,3 +35,16 @@\n If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?\n \n This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].\n+\n+Making the file `sagetex.rst` unwritable shows where the file is written:\n+\n+```\n+Traceback (most recent call last):\n+  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 45, in build_ref_doc\n+    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)\n+  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 662, in _wrapper\n+    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))\n+  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 924, in write_auto_rest_file\n+    outfile = open(filename, 'w')\n+IOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'\n+```\n``````\n",
    "created_at": "2013-03-06T12:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171781",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -35,3 +35,16 @@
 If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?
 
 This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].
+
+Making the file `sagetex.rst` unwritable shows where the file is written:
+
+```
+Traceback (most recent call last):
+  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 45, in build_ref_doc
+    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
+  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 662, in _wrapper
+    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))
+  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 924, in write_auto_rest_file
+    outfile = open(filename, 'w')
+IOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'
+```
``````




---

archive/issue_comments_171782.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n-On some OS X 10.6 system, I noticed that suddenly the following changes appeared in my working repository:\n+Install sage-5.8.beta2 and build the documentation. Now\n+\n+```\n+$ touch devel/sage/doc/en/reference/misc/sagetex.rst\n+$ make doc\n+```\n+and you will see the following change appear:\n \n ```diff\n diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst\n@@ -32,9 +38,7 @@\n +\n +\n ```\n-If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?\n-\n-This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].\n+If this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?\n \n Making the file `sagetex.rst` unwritable shows where the file is written:\n \n``````\n",
    "created_at": "2013-03-06T12:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171782",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
-On some OS X 10.6 system, I noticed that suddenly the following changes appeared in my working repository:
+Install sage-5.8.beta2 and build the documentation. Now
+
+```
+$ touch devel/sage/doc/en/reference/misc/sagetex.rst
+$ make doc
+```
+and you will see the following change appear:
 
 ```diff
 diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst
@@ -32,9 +38,7 @@
 +
 +
 ```
-If this an autogenerated file, it should not be tracked by Mercurial. And also, what happened to this file, why did all content get removed?
-
-This happened with sage-5.8.beta2, it is always reproducible (at least on this particular build), even when no source files have changed. The output of a `make doc-html` run can be found in [attachment:doc.log].
+If this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?
 
 Making the file `sagetex.rst` unwritable shows where the file is written:
 
``````




---

archive/issue_comments_171783.json:
```json
{
    "body": "<a id='comment:9'></a>\nOkay, I think I've figured it out: the problem is that \"sagetex.rst\" starts with \"sage\". See the attached patch.",
    "created_at": "2013-03-06T18:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171783",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Okay, I think I've figured it out: the problem is that "sagetex.rst" starts with "sage". See the attached patch.



---

archive/issue_events_122552.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2013-03-06T18:38:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14199#event-122552"
}
```



---

archive/issue_comments_171784.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2013-03-06T18:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171784",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_events_122553.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-06T20:33:34Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "rename": {
        "from": "Docbuilder and auto-generated files",
        "to": "Docbuilder changes sagetex.rst"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14199#event-122553"
}
```



---

archive/issue_comments_171785.json:
```json
{
    "body": "<a id='comment:11'></a>\nMaybe you should document better what's the purpose of the condition\n\n```\nif name.startswith('sage' + os.sep):\n```",
    "created_at": "2013-03-06T20:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171785",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Maybe you should document better what's the purpose of the condition

```
if name.startswith('sage' + os.sep):
```



---

archive/attachments_019165.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_14199.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14199/trac_14199.patch",
    "created_at": "2013-03-06T23:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_171786.json:
```json
{
    "body": "<a id='comment:12'></a>\nI added a comment to try to address your suggestion.",
    "created_at": "2013-03-06T23:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171786",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
I added a comment to try to address your suggestion.



---

archive/issue_events_122554.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T18:54:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14199#event-122554"
}
```



---

archive/issue_events_122555.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T18:54:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14199#event-122555"
}
```



---

archive/issue_comments_171787.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2013-03-07T18:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171787",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_171788.json:
```json
{
    "body": "**Merged:** sage-5.8.beta4",
    "created_at": "2013-03-07T18:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14199#issuecomment-171788",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.8.beta4
