# Issue 14961: Preparser not robust enough against typos

archive/issues_014724.json:
```json
{
    "body": "I made a typo and sage crashed:\n\n```\nR.<t> = QQ{]\n```\nNote that there is one opening squigly bracket `{` and one closing square bracket `]`.\n\nHere's the backtrace\n\n```\nTraceback (most recent call last):\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py\", line 175, in excepthook\n    return self.crash_handler(etype, evalue, tb)\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py\", line 178, in __call__\n    raw_input(\"Hit <Enter> to quit (your terminal may close):\")\n  File \"c_lib.pyx\", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)\nKeyboardInterrupt\n\nOriginal exception was:\nTraceback (most recent call last):\n  File \"/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython\", line 18, in <module>\n    app.start()\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py\", line 363, in start\n    self.shell.mainloop()\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 467, in mainloop\n    self.interact(display_banner=display_banner)\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 579, in interact\n    self.input_splitter.push(line)\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py\", line 393, in push\n    line = f(line, line_number)\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py\", line 271, in __call__\n    return preparse(line, reset=(line_number==0))\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 1112, in preparse\n    L = preparse_generators(L)\n  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 977, in preparse_generators\n    opening = constructor.rindex('[')\nValueError: substring not found\n```\n\nApply [trac_14961-hack_fix_preparser-ts.patch\u200b] and [attachment:14961_doctest.patch]\n\nAssignee: @tscrim\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: Volker Braun\n\nAuthor: Travis Scrimshaw, Jeroen Demeyer\n\nMerged: sage-5.12.beta4\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14961\n\n",
    "closed_at": "2013-08-28T06:53:36Z",
    "created_at": "2013-07-24T03:34:18Z",
    "labels": [
        "component: user interface",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Preparser not robust enough against typos",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14961",
    "user": "https://github.com/tscrim"
}
```
I made a typo and sage crashed:

```
R.<t> = QQ{]
```
Note that there is one opening squigly bracket `{` and one closing square bracket `]`.

Here's the backtrace

```
Traceback (most recent call last):
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py", line 175, in excepthook
    return self.crash_handler(etype, evalue, tb)
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py", line 178, in __call__
    raw_input("Hit <Enter> to quit (your terminal may close):")
  File "c_lib.pyx", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)
KeyboardInterrupt

Original exception was:
Traceback (most recent call last):
  File "/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython", line 18, in <module>
    app.start()
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py", line 363, in start
    self.shell.mainloop()
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 467, in mainloop
    self.interact(display_banner=display_banner)
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 579, in interact
    self.input_splitter.push(line)
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py", line 393, in push
    line = f(line, line_number)
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py", line 271, in __call__
    return preparse(line, reset=(line_number==0))
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 1112, in preparse
    L = preparse_generators(L)
  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 977, in preparse_generators
    opening = constructor.rindex('[')
ValueError: substring not found
```

Apply [trac_14961-hack_fix_preparser-ts.patch​] and [attachment:14961_doctest.patch]

Assignee: @tscrim

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Volker Braun

Author: Travis Scrimshaw, Jeroen Demeyer

Merged: sage-5.12.beta4

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14961





---

archive/issue_comments_200154.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -4,6 +4,38 @@\n R.<t> = QQ{]\n ```\n Note that there is one opening squigly bracket `{` and one closing square bracket `]`.\n+\n+Here's the backtrace\n+\n+```\n+Traceback (most recent call last):\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py\", line 175, in excepthook\n+    return self.crash_handler(etype, evalue, tb)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py\", line 178, in __call__\n+    raw_input(\"Hit <Enter> to quit (your terminal may close):\")\n+  File \"c_lib.pyx\", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)\n+KeyboardInterrupt\n+\n+Original exception was:\n+Traceback (most recent call last):\n+  File \"/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython\", line 18, in <module>\n+    app.start()\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py\", line 363, in start\n+    self.shell.mainloop()\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 467, in mainloop\n+    self.interact(display_banner=display_banner)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 579, in interact\n+    self.input_splitter.push(line)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py\", line 393, in push\n+    line = f(line, line_number)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py\", line 271, in __call__\n+    return preparse(line, reset=(line_number==0))\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 1112, in preparse\n+    L = preparse_generators(L)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 977, in preparse_generators\n+    opening = constructor.rindex('[')\n+ValueError: substring not found\n+```\n \n Comment: 1\n \n```\n",
    "created_at": "2013-07-24T03:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200154",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -4,6 +4,38 @@
 R.<t> = QQ{]
 ```
 Note that there is one opening squigly bracket `{` and one closing square bracket `]`.
+
+Here's the backtrace
+
+```
+Traceback (most recent call last):
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py", line 175, in excepthook
+    return self.crash_handler(etype, evalue, tb)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py", line 178, in __call__
+    raw_input("Hit <Enter> to quit (your terminal may close):")
+  File "c_lib.pyx", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)
+KeyboardInterrupt
+
+Original exception was:
+Traceback (most recent call last):
+  File "/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython", line 18, in <module>
+    app.start()
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py", line 363, in start
+    self.shell.mainloop()
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 467, in mainloop
+    self.interact(display_banner=display_banner)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 579, in interact
+    self.input_splitter.push(line)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py", line 393, in push
+    line = f(line, line_number)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py", line 271, in __call__
+    return preparse(line, reset=(line_number==0))
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 1112, in preparse
+    L = preparse_generators(L)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 977, in preparse_generators
+    opening = constructor.rindex('[')
+ValueError: substring not found
+```
 
 Comment: 1
 
```




---

archive/issue_comments_200155.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-24T04:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200155",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200156.json:
```json
{
    "body": "<a id='comment:2'></a>Here's a patch which is just a hack fix so that sage doesn't crash and it tells you that an error has occurred. It prints the error twice, but it works...\n\n```\nsage: R.<t> = QQ{]\nSyntaxError: Mismatched ']'\nSyntaxError: Mismatched ']'\nsage:\n```",
    "created_at": "2013-07-24T04:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200156",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Here's a patch which is just a hack fix so that sage doesn't crash and it tells you that an error has occurred. It prints the error twice, but it works...

```
sage: R.<t> = QQ{]
SyntaxError: Mismatched ']'
SyntaxError: Mismatched ']'
sage:
```



---

archive/issue_comments_200157.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-07-24T23:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200157",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_200158.json:
```json
{
    "body": "<a id='comment:3'></a>I've asked on IPython-dev at http://python.6.x6.nabble.com/InputSplitter-and-SyntaxError-td5025938.html",
    "created_at": "2013-07-24T23:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200158",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>I've asked on IPython-dev at http://python.6.x6.nabble.com/InputSplitter-and-SyntaxError-td5025938.html



---

archive/issue_comments_200159.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks Volker. I was going to do that first thing this morning (i.e. right now).",
    "created_at": "2013-07-25T04:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200159",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>Thanks Volker. I was going to do that first thing this morning (i.e. right now).



---

archive/issue_comments_200160.json:
```json
{
    "body": "Changing component from interfaces to user interface.",
    "created_at": "2013-07-29T11:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200160",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from interfaces to user interface.



---

archive/issue_events_042939.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-29T11:04:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14961#event-42939"
}
```



---

archive/issue_comments_200161.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2013-07-29T11:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200161",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_200162.json:
```json
{
    "body": "<a id='comment:6'></a>The IPython devs acknowledged that this currently does not work. It sounds like they would accept a patch but don't plan on fixing this in the near future themselves. So fixing this properly will take some time.\n\nIn the meantime, the proposed workaround looks good. However, it has an unrelated change to in `sage/algebras/lie_algebras/kac_moody.py` that needs to be removed.",
    "created_at": "2013-08-14T13:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200162",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>The IPython devs acknowledged that this currently does not work. It sounds like they would accept a patch but don't plan on fixing this in the near future themselves. So fixing this properly will take some time.

In the meantime, the proposed workaround looks good. However, it has an unrelated change to in `sage/algebras/lie_algebras/kac_moody.py` that needs to be removed.



---

archive/issue_comments_200163.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2013-08-14T13:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200163",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_200164.json:
```json
{
    "body": "<a id='comment:7'></a>Eeek, how did I let that get in there. Here's the patch without that change.",
    "created_at": "2013-08-20T15:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200164",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Eeek, how did I let that get in there. Here's the patch without that change.



---

archive/issue_comments_200165.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-20T15:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200165",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_200166.json:
```json
{
    "body": "<a id='comment:8'></a>Looks good to me.",
    "created_at": "2013-08-20T16:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200166",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Looks good to me.



---

archive/issue_comments_200167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-20T16:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200167",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200168.json:
```json
{
    "body": "Attachment [trac_14961-hack_fix_preparser-ts.patch](tarball://root/attachments/some-uuid/ticket14961/trac_14961-hack_fix_preparser-ts.patch) by @jdemeyer created at 2013-08-21 16:01:07",
    "created_at": "2013-08-21T16:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200168",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_14961-hack_fix_preparser-ts.patch](tarball://root/attachments/some-uuid/ticket14961/trac_14961-hack_fix_preparser-ts.patch) by @jdemeyer created at 2013-08-21 16:01:07



---

archive/issue_comments_200169.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [14961_doctest.patch](tarball://root/attachments/some-uuid/ticket14961/14961_doctest.patch) by @jdemeyer created at 2013-08-21 16:01:50",
    "created_at": "2013-08-21T16:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200169",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Attachment [14961_doctest.patch](tarball://root/attachments/some-uuid/ticket14961/14961_doctest.patch) by @jdemeyer created at 2013-08-21 16:01:50



---

archive/issue_comments_200170.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,43 @@\n+I made a typo and sage crashed:\n \n+```\n+R.<t> = QQ{]\n+```\n+Note that there is one opening squigly bracket `{` and one closing square bracket `]`.\n+\n+Here's the backtrace\n+\n+```\n+Traceback (most recent call last):\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py\", line 175, in excepthook\n+    return self.crash_handler(etype, evalue, tb)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py\", line 178, in __call__\n+    raw_input(\"Hit <Enter> to quit (your terminal may close):\")\n+  File \"c_lib.pyx\", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)\n+KeyboardInterrupt\n+\n+Original exception was:\n+Traceback (most recent call last):\n+  File \"/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython\", line 18, in <module>\n+    app.start()\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py\", line 363, in start\n+    self.shell.mainloop()\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 467, in mainloop\n+    self.interact(display_banner=display_banner)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py\", line 579, in interact\n+    self.input_splitter.push(line)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py\", line 393, in push\n+    line = f(line, line_number)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py\", line 271, in __call__\n+    return preparse(line, reset=(line_number==0))\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 1112, in preparse\n+    L = preparse_generators(L)\n+  File \"/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py\", line 977, in preparse_generators\n+    opening = constructor.rindex('[')\n+ValueError: substring not found\n+```\n+\n+Apply [trac_14961-hack_fix_preparser-ts.patch\u200b] and [attachment:14961_doctest.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2013-08-21T16:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200170",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,43 @@
+I made a typo and sage crashed:
 
+```
+R.<t> = QQ{]
+```
+Note that there is one opening squigly bracket `{` and one closing square bracket `]`.
+
+Here's the backtrace
+
+```
+Traceback (most recent call last):
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/application.py", line 175, in excepthook
+    return self.crash_handler(etype, evalue, tb)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/core/crashhandler.py", line 178, in __call__
+    raw_input("Hit <Enter> to quit (your terminal may close):")
+  File "c_lib.pyx", line 70, in sage.ext.c_lib.sage_python_check_interrupt (sage/ext/c_lib.c:925)
+KeyboardInterrupt
+
+Original exception was:
+Traceback (most recent call last):
+  File "/home/tscrim/sage-5.11.beta3/local/bin/sage-ipython", line 18, in <module>
+    app.start()
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/ipapp.py", line 363, in start
+    self.shell.mainloop()
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 467, in mainloop
+    self.interact(display_banner=display_banner)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/IPython/frontend/terminal/interactiveshell.py", line 579, in interact
+    self.input_splitter.push(line)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/sage_extension.py", line 393, in push
+    line = f(line, line_number)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py", line 271, in __call__
+    return preparse(line, reset=(line_number==0))
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 1112, in preparse
+    L = preparse_generators(L)
+  File "/home/tscrim/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/misc/preparser.py", line 977, in preparse_generators
+    opening = constructor.rindex('[')
+ValueError: substring not found
+```
+
+Apply [trac_14961-hack_fix_preparser-ts.patch​] and [attachment:14961_doctest.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_200171.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-08-21T16:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200171",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_200172.json:
```json
{
    "body": "<a id='comment:11'></a>[attachment:14961_doctest.patch] needs review.",
    "created_at": "2013-08-21T16:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>[attachment:14961_doctest.patch] needs review.



---

archive/issue_comments_200173.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-21T16:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200173",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_200174.json:
```json
{
    "body": "<a id='comment:12'></a>Fine with me, though I think the effort should go in pushing this upstream not doctesting the temporary workaround.",
    "created_at": "2013-08-21T17:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200174",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>Fine with me, though I think the effort should go in pushing this upstream not doctesting the temporary workaround.



---

archive/issue_comments_200175.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-21T17:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200175",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200176.json:
```json
{
    "body": "<a id='comment:13'></a>Followup at #15075 for a proper fix.",
    "created_at": "2013-08-21T21:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200176",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>Followup at #15075 for a proper fix.



---

archive/issue_comments_200177.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-28T06:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14961#issuecomment-200177",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_042940.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-28T06:53:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14961",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14961#event-42940"
}
```
