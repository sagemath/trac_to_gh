# Issue 14636: ECL spkg : dirty workarounds?

archive/issues_014432.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nMy debian/sage experiments have uncovered that sage's ecl package was compiled with a few tweaks:\n\n(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!\n\n(2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)\n\n(3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)\n\nTo fix this ticket:\n(1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;\n(2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).\n\nThis fix is against sage 5.12.beta4.\n\nCC:  @jpflori\n\nComponent: **packages: standard**\n\nWork Issues: **add doctest**\n\nReviewer: **Volker Braun, Peter Bruin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14636_\n\n",
    "closed_at": "2014-12-01T11:42:16Z",
    "created_at": "2013-05-24T11:55:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "ECL spkg : dirty workarounds?",
    "type": "issue",
    "updated_at": "2014-12-01T11:42:16Z",
    "url": "https://github.com/sagemath/sage/issues/14636",
    "user": "https://github.com/SnarkBoojum"
}
```
<div id="comment:0"></div>

My debian/sage experiments have uncovered that sage's ecl package was compiled with a few tweaks:

(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!

(2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)

(3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)

To fix this ticket:
(1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;
(2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).

This fix is against sage 5.12.beta4.

CC:  @jpflori

Component: **packages: standard**

Work Issues: **add doctest**

Reviewer: **Volker Braun, Peter Bruin**

_Issue created by migration from https://trac.sagemath.org/ticket/14636_





---

archive/issue_events_205420.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-24T11:55:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205420"
}
```



---

archive/issue_events_205421.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-24T11:55:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205421"
}
```



---

archive/issue_events_205422.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-24T11:55:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205422"
}
```



---

archive/issue_events_205423.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-24T11:55:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205423"
}
```



---

archive/issue_events_205424.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T11:55:45Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "subject": "https://github.com/SnarkBoojum",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205424"
}
```



---

archive/issue_comments_177580.json:
```json
{
    "body": "Replying to [@SnarkBoojum](https://github.com/sagemath/sage/issues/14636#comment:0):\n> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources\n\nI don't see any patch doing this, please clarify...",
    "created_at": "2013-05-24T12:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177580",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [@SnarkBoojum](https://github.com/sagemath/sage/issues/14636#comment:0):
> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources

I don't see any patch doing this, please clarify...



---

archive/issue_comments_177581.json:
```json
{
    "body": "Replying to [@SnarkBoojum](https://github.com/sagemath/sage/issues/14636#comment:0):\n> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n\nWhich **library** does read start-up files? ;-)",
    "created_at": "2013-05-24T12:20:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177581",
    "user": "https://github.com/nexttime"
}
```

Replying to [@SnarkBoojum](https://github.com/sagemath/sage/issues/14636#comment:0):
> (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?

Which **library** does read start-up files? ;-)



---

archive/issue_comments_177582.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n@jdemeyer: disable_sigchdl_handler.patch is what you're looking for.\n\n@nexttime: good catch! I had the impression that maxima was used as a library within ecl, but that ecl was used through its commandline. But indeed now that you ask, I see there is also a direct use of ecl-as-a-library. What saves the day though is that sage's ecl.pyx calls cl_boot itself, and hence it should be possible to modify the setting before that call. I should be able to do something about it.",
    "created_at": "2013-05-24T13:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177582",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:3" align="right">comment:3</div>

@jdemeyer: disable_sigchdl_handler.patch is what you're looking for.

@nexttime: good catch! I had the impression that maxima was used as a library within ecl, but that ecl was used through its commandline. But indeed now that you ask, I see there is also a direct use of ecl-as-a-library. What saves the day though is that sage's ecl.pyx calls cl_boot itself, and hence it should be possible to modify the setting before that call. I should be able to do something about it.



---

archive/issue_comments_177583.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\n(1) unicode: I suppose there are no fundamental obstacles for that. However, you'll have to essentially rewrite the ecllib wrapper. With Py3 this might become worthwhile, since that has unicode strings internally anyway (although undoubtedly stored with an encoding different from ecl's). Also, our main use, Maxima, is solidly pre-unicode, so I don't think there will be any benefits for us and probably extra problems from Maxima possibly getting unexpected data.\n\n(2) signals: ECL has very complex and ingenious infrastructure to deal with signals, and it expects to handle signals itself (which is a bit odd for a library). With threads enabled there will be a separate thread for asynchronous signals, and Boehm repurposes some exotic signals to sync threads on GC events. We cannot afford to submit to ECL's way of handling signals, so we do some pretty horrible stuff with signals when starting ECL anyway (and every time we call into ECL for longer times!) Disabling SIGCHLD is probably the least of your worries. Also, I don't think ECL does anything with SIGCHLD events anyway (other than possibly installing its own handler to provide a hook for ecl programs and which by default ignores the signal)",
    "created_at": "2013-05-24T14:22:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177583",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:4" align="right">comment:4</div>

(1) unicode: I suppose there are no fundamental obstacles for that. However, you'll have to essentially rewrite the ecllib wrapper. With Py3 this might become worthwhile, since that has unicode strings internally anyway (although undoubtedly stored with an encoding different from ecl's). Also, our main use, Maxima, is solidly pre-unicode, so I don't think there will be any benefits for us and probably extra problems from Maxima possibly getting unexpected data.

(2) signals: ECL has very complex and ingenious infrastructure to deal with signals, and it expects to handle signals itself (which is a bit odd for a library). With threads enabled there will be a separate thread for asynchronous signals, and Boehm repurposes some exotic signals to sync threads on GC events. We cannot afford to submit to ECL's way of handling signals, so we do some pretty horrible stuff with signals when starting ECL anyway (and every time we call into ECL for longer times!) Disabling SIGCHLD is probably the least of your worries. Also, I don't think ECL does anything with SIGCHLD events anyway (other than possibly installing its own handler to provide a hook for ecl programs and which by default ignores the signal)



---

archive/issue_comments_177584.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?\n \n-(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n+(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n``````\n",
    "created_at": "2013-05-24T15:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177584",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?
 
-(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?
+(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?
``````




---

archive/issue_comments_177585.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@SnarkBoojum](#comment%3A3):\n> @jdemeyer: disable_sigchdl_handler.patch is what you're looking for.\n\nSorry, I was looking at an older version of the ECL spkg (this patch is a very recent addition).",
    "created_at": "2013-05-24T15:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177585",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@SnarkBoojum](#comment%3A3):
> @jdemeyer: disable_sigchdl_handler.patch is what you're looking for.

Sorry, I was looking at an older version of the ECL spkg (this patch is a very recent addition).



---

archive/issue_comments_177586.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n@nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n\n@nbruin(2) I'll manage to deal with it : there's just an option to set in sage/libs/",
    "created_at": "2013-05-24T16:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177586",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:6" align="right">comment:6</div>

@nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.

@nbruin(2) I'll manage to deal with it : there's just an option to set in sage/libs/



---

archive/issue_comments_177587.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?",
    "created_at": "2013-05-24T16:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177587",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:7" align="right">comment:7</div>

I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?



---

archive/issue_comments_177588.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@SnarkBoojum](#comment%3A7):\n> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?\n\nI assume that's an \"extern\" definition. It just gets translated literally into the C-source which then uses the values that `external.h` provides. Just as `cdef typedef extern struct` can afford to only mention the fields that are of interest, or even only with approximate types.\n\nIt may well be that particular member wasn't in ecl when the wrapper was written. Add it if you need it.",
    "created_at": "2013-05-24T16:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177588",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@SnarkBoojum](#comment%3A7):
> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item! That means all subsequent items in the list are off-by-one... how is that code even supposed to run correctly!?

I assume that's an "extern" definition. It just gets translated literally into the C-source which then uses the values that `external.h` provides. Just as `cdef typedef extern struct` can afford to only mention the fields that are of interest, or even only with approximate types.

It may well be that particular member wasn't in ecl when the wrapper was written. Add it if you need it.



---

archive/issue_comments_177589.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@SnarkBoojum](#comment%3A6):\n> @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n\nI don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.",
    "created_at": "2013-05-24T20:25:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177589",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@SnarkBoojum](#comment%3A6):
> @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.

I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.



---

archive/issue_comments_177590.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment%3A9):\n> Replying to [@SnarkBoojum](#comment%3A6):\n> > @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n> \n> \n> I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.\n\nA ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.",
    "created_at": "2013-05-24T20:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177590",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment%3A9):
> Replying to [@SnarkBoojum](#comment%3A6):
> > @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.
> 
> 
> I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.

A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.



---

archive/issue_comments_177591.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@SnarkBoojum](#comment%3A7):\n> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item!\n\nAh, indeed! You should just add that in `ecl.pxd` and do\n\n```\n    ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)\n```\nbefore the boot call. Looked like Volker went for the quick-and-dirty solution there on #14055.\n\nNote that even with that option, ECL still does install a SIGCHLD handler. However, we're not putting that back when we call ECL. Does SIGCHLD also need special treatment in `eclsig.c`? Jeroen is the expert on that file.",
    "created_at": "2013-05-24T21:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177591",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@SnarkBoojum](#comment%3A7):
> I just found that sage/libs/ecl.pxd has a copy of ecl's src/h/external.h's ecl_option enum... lacking the ECL_OPT_TRAP_SIGCHLD item!

Ah, indeed! You should just add that in `ecl.pxd` and do

```
    ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)
```
before the boot call. Looked like Volker went for the quick-and-dirty solution there on #14055.

Note that even with that option, ECL still does install a SIGCHLD handler. However, we're not putting that back when we call ECL. Does SIGCHLD also need special treatment in `eclsig.c`? Jeroen is the expert on that file.



---

archive/issue_comments_177592.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nbruin](#comment%3A11):\n> Note that even with that option, ECL still does install a SIGCHLD handler.\n\nPreferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).\n\nMaybe it can be made to work with `eclsig.c`, but at least it requires some work.",
    "created_at": "2013-05-24T21:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177592",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nbruin](#comment%3A11):
> Note that even with that option, ECL still does install a SIGCHLD handler.

Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).

Maybe it can be made to work with `eclsig.c`, but at least it requires some work.



---

archive/issue_comments_177593.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).\n\nI wondered about that. It's not clear to me why in our situation it even makes a difference what we do to `ECL_OPT_TRAP_SIGCHLD`(but given that Volker's fix had effect apparently it does).\n\nThe Sage `SIGCHLD` should be the `default` or `ignore` handler. Right after calling `cl_boot` we reset all handlers back to the sage handlers, so it shouldn't matter what ECL installs. We only change back some select handlers in `eclsig.c` and `SIGCHLD` is not one of them. Is there something that `ecl` changes that doesn't get reverted by `sigaction`?",
    "created_at": "2013-05-25T00:19:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177593",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jdemeyer](#comment%3A12):
> Preferably, we don't have any `SIGCHLD` handler at all. Note that `SIGCHLD` is an unusual signal: it is the only signal which is *ignored* by default. Therefore, having a `SIGCHLD` handler which does nothing is still quite different from having no handler (and ignoring the signal).

I wondered about that. It's not clear to me why in our situation it even makes a difference what we do to `ECL_OPT_TRAP_SIGCHLD`(but given that Volker's fix had effect apparently it does).

The Sage `SIGCHLD` should be the `default` or `ignore` handler. Right after calling `cl_boot` we reset all handlers back to the sage handlers, so it shouldn't matter what ECL installs. We only change back some select handlers in `eclsig.c` and `SIGCHLD` is not one of them. Is there something that `ecl` changes that doesn't get reverted by `sigaction`?



---

archive/issue_comments_177594.json:
```json
{
    "body": "Attachment: **[ecl-12.12.1.p4.spkg.gz](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.spkg.gz)**\n\nECL spkg without the SIGCHLD patch to upstream",
    "created_at": "2013-05-25T06:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177594",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[ecl-12.12.1.p4.spkg.gz](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.spkg.gz)**

ECL spkg without the SIGCHLD patch to upstream



---

archive/issue_comments_177595.json:
```json
{
    "body": "Patch programmatically disabling SIGCHLD in sagelib's ECL code",
    "created_at": "2013-05-25T07:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177595",
    "user": "https://github.com/SnarkBoojum"
}
```

Patch programmatically disabling SIGCHLD in sagelib's ECL code



---

archive/issue_events_205425.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-25T07:06:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205425"
}
```



---

archive/issue_comments_177596.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,14 @@\n (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?\n \n (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n+\n+**TO REVIEW**\n+* compile ecl-12.12.1.p4.spkg\n+* apply trac_14636_sigchld.patch to the sage library\n+* recompile the sage library\n+* run the long tests\n+* confirm it's ok\n+**AFTER APPLYING**\n+* remove those two paragraphs\n+* add a nice **DONE** to the (1) point above\n+* put the ticket as new again, as there is still point (2) to clear before actually closing\n``````\n",
    "created_at": "2013-05-25T07:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177596",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,14 @@
 (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?
 
 (2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?
+
+**TO REVIEW**
+* compile ecl-12.12.1.p4.spkg
+* apply trac_14636_sigchld.patch to the sage library
+* recompile the sage library
+* run the long tests
+* confirm it's ok
+**AFTER APPLYING**
+* remove those two paragraphs
+* add a nice **DONE** to the (1) point above
+* put the ticket as new again, as there is still point (2) to clear before actually closing
``````




---

archive/issue_comments_177597.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAttachment: **[trac_14636_sigchld.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_sigchld.patch.gz)**",
    "created_at": "2013-05-25T07:06:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177597",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:14" align="right">comment:14</div>

Attachment: **[trac_14636_sigchld.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_sigchld.patch.gz)**



---

archive/issue_comments_177598.json:
```json
{
    "body": "Work Issues: **doctest**",
    "created_at": "2013-05-25T09:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177598",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **doctest**



---

archive/issue_comments_177599.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nPlease add the following doctest (`sage/tests/interrupt.pyx` is a good place for this test):\n\n```\n\"\"\"\nShow that `SIGCHLD` is completely ignored by default. If the process\n`p` finishes, there should be no `SIGCHLD` signal, so ``select()`` will\nsimply time out::\n\n    sage: from select import select\n    sage: import subprocess\n\n    sage: p = subprocess.Popen([\"sleep\", \"1\"])  # long time\n    sage: select([], [], [], 1.5)               # long time\n    ([], [], [])\n    sage: p.poll()                              # long time\n    0\n\nWe now do the same but after installing a dummy `SIGCHLD`\nhandler::\n\n    sage: import signal\n    sage: def dummy_handler(a,b):\n    ....:    pass\n    sage: signal.signal(signal.SIGCHLD, dummy_handler)  # random\n    sage: p = subprocess.Popen([\"sleep\", \"1\"])  # long time\n    sage: select([], [], [], 1.5)               # long time\n    Traceback (most recent call last):\n    ...\n    error: (4, 'Interrupted system call')\n    sage: p.poll()                              # long time\n    0\n\nReset the `SIGCHLD` handler::\n\n    sage: signal.signal(signal.SIGCHLD, signal.SIG_IGN)  # random\n\"\"\"\n```",
    "created_at": "2013-05-25T09:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177599",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Please add the following doctest (`sage/tests/interrupt.pyx` is a good place for this test):

```
"""
Show that `SIGCHLD` is completely ignored by default. If the process
`p` finishes, there should be no `SIGCHLD` signal, so ``select()`` will
simply time out::

    sage: from select import select
    sage: import subprocess

    sage: p = subprocess.Popen(["sleep", "1"])  # long time
    sage: select([], [], [], 1.5)               # long time
    ([], [], [])
    sage: p.poll()                              # long time
    0

We now do the same but after installing a dummy `SIGCHLD`
handler::

    sage: import signal
    sage: def dummy_handler(a,b):
    ....:    pass
    sage: signal.signal(signal.SIGCHLD, dummy_handler)  # random
    sage: p = subprocess.Popen(["sleep", "1"])  # long time
    sage: select([], [], [], 1.5)               # long time
    Traceback (most recent call last):
    ...
    error: (4, 'Interrupted system call')
    sage: p.poll()                              # long time
    0

Reset the `SIGCHLD` handler::

    sage: signal.signal(signal.SIGCHLD, signal.SIG_IGN)  # random
"""
```



---

archive/issue_events_205426.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-25T09:25:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205426"
}
```



---

archive/issue_events_205427.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-25T09:25:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205427"
}
```



---

archive/issue_comments_177600.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThere is another complication with the test: the doctesting framework itself messes with `SIGCHLD`, so it needs slightly more work... let me think about it.",
    "created_at": "2013-05-25T09:31:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177600",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

There is another complication with the test: the doctesting framework itself messes with `SIGCHLD`, so it needs slightly more work... let me think about it.



---

archive/issue_comments_177601.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nUnicode: See #12985. When I implemented `ecl.pyx` unicode support in ecl was not the default, so it was natural to skip it. I haven't kept up with its development, so I'm of little help for unicode-specific things. It looks like they got something close to working on #12985, though.\n\nGiven that all of calculus is designed to work with `str`, not with `unicode`, I think there is very little benefit in converting the ecl interface in being fully unicode aware (other than not having to turn off unicode support when building ecl), so the approach there (letting ecl work with unicode strings but convert them to ascii as soon as they leave ecl) is probably the quickest to get going.",
    "created_at": "2013-05-25T15:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177601",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

Unicode: See #12985. When I implemented `ecl.pyx` unicode support in ecl was not the default, so it was natural to skip it. I haven't kept up with its development, so I'm of little help for unicode-specific things. It looks like they got something close to working on #12985, though.

Given that all of calculus is designed to work with `str`, not with `unicode`, I think there is very little benefit in converting the ecl interface in being fully unicode aware (other than not having to turn off unicode support when building ecl), so the approach there (letting ecl work with unicode strings but convert them to ascii as soon as they leave ecl) is probably the quickest to get going.



---

archive/issue_comments_177602.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@SnarkBoojum](#comment%3A10):\n> Replying to [@jdemeyer](#comment%3A9):\n> > Replying to [@SnarkBoojum](#comment%3A6):\n> > > @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.\n> > \n> > \n> > I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.\n> \n> \n> A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.\n\nYou have to dig deeper (on trac and sage-devel); there have been related tickets and threads years ago, as the Python devs keep claiming *\"There will be no further 2.x release after ...\"*, and they do so since at least 2.4 IIRC.\n\n(AFAIK the tickets mainly addressed removing [future] incompatibilities to Python 3.x from the Sage library, but also mention which upstream packages don't or won't [ever :-) ] work with Python 3.x, to that time of course.)\n\n---\n\nW.r.t. \"holding back\":  There's *no need* to switch to Python 3.x ... ;-)",
    "created_at": "2013-05-25T17:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177602",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@SnarkBoojum](#comment%3A10):
> Replying to [@jdemeyer](#comment%3A9):
> > Replying to [@SnarkBoojum](#comment%3A6):
> > > @nbruin(1) where is the ticket about the python3 transition? As far as I know, a few sagenb deps (notably twisted and flask if I remember well) and some of sage's standard packages (for example pil) are a concern in that matter, but I can't find the relevant ticket.
> > 
> > 
> > I don't think there is a ticket yet, because it's obvious it's not going to happen anytime soon.
> 
> 
> A ticket isn't just about something which will happen just now ; it's a central place where ideas get gathered about an issue. In this case, a ticket listing what is holding back sage for the switch to python3 would probably be worthy.

You have to dig deeper (on trac and sage-devel); there have been related tickets and threads years ago, as the Python devs keep claiming *"There will be no further 2.x release after ..."*, and they do so since at least 2.4 IIRC.

(AFAIK the tickets mainly addressed removing [future] incompatibilities to Python 3.x from the Sage library, but also mention which upstream packages don't or won't [ever :-) ] work with Python 3.x, to that time of course.)

---

W.r.t. "holding back":  There's *no need* to switch to Python 3.x ... ;-)



---

archive/issue_comments_177603.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLet's put this ticket back to need review : the patch which needs work is a patch about the handling of SIGCHLD in sage which is the matter of #14639.\n\nWhat needs reviewing here is what is point (2) in the description : the move of the SIGCHLD code from a dirty patch within the ECL spkg to a correct ECL-library call in the sage library. The patch and the spkg I propose are a full solution to this issue ; I have already checked their correctness.",
    "created_at": "2013-05-26T09:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177603",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:19" align="right">comment:19</div>

Let's put this ticket back to need review : the patch which needs work is a patch about the handling of SIGCHLD in sage which is the matter of #14639.

What needs reviewing here is what is point (2) in the description : the move of the SIGCHLD code from a dirty patch within the ECL spkg to a correct ECL-library call in the sage library. The patch and the spkg I propose are a full solution to this issue ; I have already checked their correctness.



---

archive/issue_events_205428.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-26T09:27:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205428"
}
```



---

archive/issue_events_205429.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-26T09:27:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205429"
}
```



---

archive/issue_comments_177604.json:
```json
{
    "body": "Changed work issues from **doctest** to none",
    "created_at": "2013-05-26T09:27:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177604",
    "user": "https://github.com/SnarkBoojum"
}
```

Changed work issues from **doctest** to none



---

archive/issue_comments_177605.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAs to python 3.x Christopher started to track the status of the various package with regards to python 3:\nhttps://github.com/cschwan/sage-on-gentoo/issues/212\n\nAs to #12985 with Paulo's patch (Paulo used to package sage for Mandriva and now does sage for Fedora), if you build ecl with unicode you have to rebuild maxima and sage's ecl bits so it is all in sync. Had weird doctests issues but haven't checked lately. Look like Julien thinks it is all in order now.",
    "created_at": "2013-05-26T09:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177605",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

As to python 3.x Christopher started to track the status of the various package with regards to python 3:
https://github.com/cschwan/sage-on-gentoo/issues/212

As to #12985 with Paulo's patch (Paulo used to package sage for Mandriva and now does sage for Fedora), if you build ecl with unicode you have to rebuild maxima and sage's ecl bits so it is all in sync. Had weird doctests issues but haven't checked lately. Look like Julien thinks it is all in order now.



---

archive/issue_comments_177606.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n@kiwifb:\n1. I think Christopher forgot PIL ;\n2. At #12985, I only checked patched-sage against current-ecl -- I'm now trying patched-sage against unicode-ecl, but since I don't have any fast computer, it takes almost a full day for a complete build+doctest...\n3. let's stop discussing py3 in this ticket as it's unrelated ;-)",
    "created_at": "2013-05-26T10:08:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177606",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:21" align="right">comment:21</div>

@kiwifb:
1. I think Christopher forgot PIL ;
2. At #12985, I only checked patched-sage against current-ecl -- I'm now trying patched-sage against unicode-ecl, but since I don't have any fast computer, it takes almost a full day for a complete build+doctest...
3. let's stop discussing py3 in this ticket as it's unrelated ;-)



---

archive/issue_comments_177607.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,16 +1,19 @@\n-My debian/sage experiments have uncovered two problems with sage's ecl package:\n+My debian/sage experiments have sage's ecl package was compiled with a few tweaks:\n \n-(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?\n+(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!\n \n-(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?\n+(2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)\n \n-**TO REVIEW**\n-* compile ecl-12.12.1.p4.spkg\n-* apply trac_14636_sigchld.patch to the sage library\n-* recompile the sage library\n-* run the long tests\n-* confirm it's ok\n-**AFTER APPLYING**\n-* remove those two paragraphs\n-* add a nice **DONE** to the (1) point above\n-* put the ticket as new again, as there is still point (2) to clear before actually closing\n+(3) threading is disabled ; I tried to remove this restriction, and it only made a single doctest fail ; a zero was expected and a 139 was obtained:\n+\n+```\n+>>> import subprocess\n+>>> f=open('/dev/full', 'w')\n+>>> kwds = dict(shell=True, stdout=f, stderr=f)\n+>>> subprocess.call(\"echo syntax error | ecl\", **kwds)\n+139\n+```\n+\n+There are several solutions to this: for (1), there is #12985 ; for (2) I already provided a fixed spkg and a patch to sagelib.\n+\n+For (3), I'll make experiments first (and I need to rebase everything to 5.10.beta5 anyway).\n``````\n",
    "created_at": "2013-05-27T17:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177607",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,16 +1,19 @@
-My debian/sage experiments have uncovered two problems with sage's ecl package:
+My debian/sage experiments have sage's ecl package was compiled with a few tweaks:
 
-(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution! Wouldn't it be possible to add a conversion step somewhere to make sage work with an unicode-enabled unicode? or what about ecl's --output-encoding argument?
+(1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!
 
-(2) I'm annoyed by the fact that SIGCHLD was disabled by directly patching the sources (see `patches/disable_sigchdl_handler.patch`) -- wouldn't it be possible to change this by modifying an rc file or some such, whose path would be given to ecl at startup?
+(2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)
 
-**TO REVIEW**
-* compile ecl-12.12.1.p4.spkg
-* apply trac_14636_sigchld.patch to the sage library
-* recompile the sage library
-* run the long tests
-* confirm it's ok
-**AFTER APPLYING**
-* remove those two paragraphs
-* add a nice **DONE** to the (1) point above
-* put the ticket as new again, as there is still point (2) to clear before actually closing
+(3) threading is disabled ; I tried to remove this restriction, and it only made a single doctest fail ; a zero was expected and a 139 was obtained:
+
+```
+>>> import subprocess
+>>> f=open('/dev/full', 'w')
+>>> kwds = dict(shell=True, stdout=f, stderr=f)
+>>> subprocess.call("echo syntax error | ecl", **kwds)
+139
+```
+
+There are several solutions to this: for (1), there is #12985 ; for (2) I already provided a fixed spkg and a patch to sagelib.
+
+For (3), I'll make experiments first (and I need to rebase everything to 5.10.beta5 anyway).
``````




---

archive/issue_events_205430.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-27T17:59:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205430"
}
```



---

archive/issue_events_205431.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-27T17:59:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205431"
}
```



---

archive/issue_comments_177608.json:
```json
{
    "body": "Work Issues: **rebase complete**",
    "created_at": "2013-05-27T17:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177608",
    "user": "https://github.com/SnarkBoojum"
}
```

Work Issues: **rebase complete**



---

archive/issue_comments_177609.json:
```json
{
    "body": "Patch against ecl's p3 for p4",
    "created_at": "2013-05-29T13:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177609",
    "user": "https://github.com/SnarkBoojum"
}
```

Patch against ecl's p3 for p4



---

archive/issue_comments_177610.json:
```json
{
    "body": "Attachment: **[ecl-12.12.1.p4.patch.gz](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz)**\n\nPatch for sagelib -- about (1)",
    "created_at": "2013-05-29T13:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177610",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[ecl-12.12.1.p4.patch.gz](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz)**

Patch for sagelib -- about (1)



---

archive/issue_comments_177611.json:
```json
{
    "body": "Attachment: **[trac_14636_1.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz)**\n\nPatch for sagelib -- about (2)",
    "created_at": "2013-05-29T13:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177611",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[trac_14636_1.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz)**

Patch for sagelib -- about (2)



---

archive/issue_events_205432.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-29T13:53:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205432"
}
```



---

archive/issue_events_205433.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-05-29T13:53:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205433"
}
```



---

archive/issue_comments_177612.json:
```json
{
    "body": "Changed work issues from **rebase complete** to **rebase**",
    "created_at": "2013-05-29T13:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177612",
    "user": "https://github.com/SnarkBoojum"
}
```

Changed work issues from **rebase complete** to **rebase**



---

archive/issue_comments_177613.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,19 +1,12 @@\n-My debian/sage experiments have sage's ecl package was compiled with a few tweaks:\n+My debian/sage experiments have uncovered that sage's ecl package was compiled with a few tweaks:\n \n (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!\n \n (2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)\n \n-(3) threading is disabled ; I tried to remove this restriction, and it only made a single doctest fail ; a zero was expected and a 139 was obtained:\n+(3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)\n \n-```\n->>> import subprocess\n->>> f=open('/dev/full', 'w')\n->>> kwds = dict(shell=True, stdout=f, stderr=f)\n->>> subprocess.call(\"echo syntax error | ecl\", **kwds)\n-139\n-```\n-\n-There are several solutions to this: for (1), there is #12985 ; for (2) I already provided a fixed spkg and a patch to sagelib.\n-\n-For (3), I'll make experiments first (and I need to rebase everything to 5.10.beta5 anyway).\n+**To review** a fix for (1) and (2), which will be enough to close this ticket and #12985:\n+1. use [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) (the patch against p3 is attached too as ecl-12.12.1.p4.patch)\n+2. apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib\n+3. compile and doctest.\n``````\n",
    "created_at": "2013-05-29T13:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177613",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,19 +1,12 @@
-My debian/sage experiments have sage's ecl package was compiled with a few tweaks:
+My debian/sage experiments have uncovered that sage's ecl package was compiled with a few tweaks:
 
 (1) it is compiled with unicode disabled ; this is to avoid errors, like those which can be read about in [this gentoo report](https://github.com/cschwan/sage-on-gentoo/issues/2). But that doesn't look like a real solution!
 
 (2) SIGCHLD is disabled by directly patching the sources (`patches/disable_sigchdl_handler.patch`)
 
-(3) threading is disabled ; I tried to remove this restriction, and it only made a single doctest fail ; a zero was expected and a 139 was obtained:
+(3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)
 
-```
->>> import subprocess
->>> f=open('/dev/full', 'w')
->>> kwds = dict(shell=True, stdout=f, stderr=f)
->>> subprocess.call("echo syntax error | ecl", **kwds)
-139
-```
-
-There are several solutions to this: for (1), there is #12985 ; for (2) I already provided a fixed spkg and a patch to sagelib.
-
-For (3), I'll make experiments first (and I need to rebase everything to 5.10.beta5 anyway).
+**To review** a fix for (1) and (2), which will be enough to close this ticket and #12985:
+1. use [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) (the patch against p3 is attached too as ecl-12.12.1.p4.patch)
+2. apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib
+3. compile and doctest.
``````




---

archive/issue_comments_177614.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAttachment: **[trac_14636_2.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz)**",
    "created_at": "2013-05-29T13:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177614",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:24" align="right">comment:24</div>

Attachment: **[trac_14636_2.patch.gz](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz)**



---

archive/issue_comments_177615.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,8 @@\n \n (3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)\n \n-**To review** a fix for (1) and (2), which will be enough to close this ticket and #12985:\n-1. use [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) (the patch against p3 is attached too as ecl-12.12.1.p4.patch)\n-2. apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib\n-3. compile and doctest.\n+**spkg**: [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz))\n+\n+**apply** [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib\n+\n+Related: #12985\n``````\n",
    "created_at": "2013-05-30T11:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177615",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,8 @@
 
 (3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)
 
-**To review** a fix for (1) and (2), which will be enough to close this ticket and #12985:
-1. use [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) (the patch against p3 is attached too as ecl-12.12.1.p4.patch)
-2. apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib
-3. compile and doctest.
+**spkg**: [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz))
+
+**apply** [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib
+
+Related: #12985
``````




---

archive/issue_comments_177616.json:
```json
{
    "body": "Author: **Julien Puydt**",
    "created_at": "2013-05-30T11:36:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177616",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Julien Puydt**



---

archive/issue_comments_177617.json:
```json
{
    "body": "Changed work issues from **rebase** to **rebase, SIGCHLD doctest**",
    "created_at": "2013-05-30T11:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177617",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **rebase** to **rebase, SIGCHLD doctest**



---

archive/issue_comments_177618.json:
```json
{
    "body": "Dependencies: **#14662**",
    "created_at": "2013-05-30T11:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177618",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#14662**



---

archive/issue_events_205434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-30T11:37:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205434"
}
```



---

archive/issue_events_205435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-30T11:37:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205435"
}
```



---

archive/issue_comments_177619.json:
```json
{
    "body": "Changed dependencies from **#14662** to **#11359**",
    "created_at": "2013-05-30T13:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177619",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#14662** to **#11359**



---

archive/issue_comments_177620.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nWhat do you mean by \"SIGCHLD doctest\"? My modification doesn't change the situation -- it changes how one obtains it: the current way is by patching upstream sources, the patched way is by calling an api function.",
    "created_at": "2013-05-30T13:34:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177620",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:28" align="right">comment:28</div>

What do you mean by "SIGCHLD doctest"? My modification doesn't change the situation -- it changes how one obtains it: the current way is by patching upstream sources, the patched way is by calling an api function.



---

archive/issue_comments_177621.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@SnarkBoojum](#comment%3A28):\n> My modification doesn't change the situation\n\nI am not convinced that this is true. I'm not at all saying that you're wrong, just saying that it's not obvious that you're right. A doctest can prove that you're right.",
    "created_at": "2013-05-30T13:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177621",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@SnarkBoojum](#comment%3A28):
> My modification doesn't change the situation

I am not convinced that this is true. I'm not at all saying that you're wrong, just saying that it's not obvious that you're right. A doctest can prove that you're right.



---

archive/issue_comments_177622.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nJust look at the current situation: there is a patch to add a zero in a structure. What does my patch do? It calls a function to add a zero in a structure. No doctest will be able to say whether the zero was obtained by patching or by calling a function -- but for distribution packagers, that makes all the difference, since there's no way they'll just patch upstream just for sage.\n\nEven if I convince you, don't close or apply the changes: I'm working on a better set of modifications to also get rid of the disabled threading stuff.",
    "created_at": "2013-05-30T14:10:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177622",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:30" align="right">comment:30</div>

Just look at the current situation: there is a patch to add a zero in a structure. What does my patch do? It calls a function to add a zero in a structure. No doctest will be able to say whether the zero was obtained by patching or by calling a function -- but for distribution packagers, that makes all the difference, since there's no way they'll just patch upstream just for sage.

Even if I convince you, don't close or apply the changes: I'm working on a better set of modifications to also get rid of the disabled threading stuff.



---

archive/issue_comments_177623.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@SnarkBoojum](#comment%3A30):\n> I'm working on a better set of modifications to also get rid of the disabled threading stuff.\n\nIt's great if you can get that to work.\n\nI considered enabling threading in ECL as fundamentally incompatible with the way we use it in Sage. It will cause ECL to split off a dedicated thread to handle asynchronous events and it will cause Boehm to repurpose some exotic signals to synchronize thread on garbage collection, and those signals will confuse the sage signal handler if it happens to receive them.\n\nWe are switching signal handlers upon entry/exit of ECL. With multiple threads it is not clear anymore whether sage or ECL should be in control of asynch signals at any one time.\n\nWe won't get much benefit from the change either: our main use, Maxima, uses global data structures everywhere and wasn't built with multi-processing in mind at all. It will not be able to utilize multiple threads for a long time.",
    "created_at": "2013-06-03T12:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177623",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@SnarkBoojum](#comment%3A30):
> I'm working on a better set of modifications to also get rid of the disabled threading stuff.

It's great if you can get that to work.

I considered enabling threading in ECL as fundamentally incompatible with the way we use it in Sage. It will cause ECL to split off a dedicated thread to handle asynchronous events and it will cause Boehm to repurpose some exotic signals to synchronize thread on garbage collection, and those signals will confuse the sage signal handler if it happens to receive them.

We are switching signal handlers upon entry/exit of ECL. With multiple threads it is not clear anymore whether sage or ECL should be in control of asynch signals at any one time.

We won't get much benefit from the change either: our main use, Maxima, uses global data structures everywhere and wasn't built with multi-processing in mind at all. It will not be able to utilize multiple threads for a long time.



---

archive/issue_comments_177624.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nAh, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.\n\nThough there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!",
    "created_at": "2013-06-03T18:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177624",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:32" align="right">comment:32</div>

Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.

Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!



---

archive/issue_comments_177625.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@SnarkBoojum](#comment%3A32):\n> Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.\n\nYou might want to read a bit of source for this. It was enlightening to me at the time. If I remember correctly, Boehm decides at runtime whether to use those signals (IIRC it keeps track of a list of threads registered with it and if that list is longer than one, it issues those signals), so you may be able to avoid those quite easily as soon as you get ECL to not create threads.\n\nSee [ECL_OPT_SIGNAL_HANDLING_THREAD](http://ecls.sourceforge.net/new-manual/ch30s03.html) for ECL (and probably the source!) If this means we get no signal handling at all in ECL, we have a bit of a problem, of course. We still want `CTRL-C` and perhaps even `SIGALRM` to work. What we really need is that `ENABLE_THREADS` is a boot-time option.\n\nSee also #11752, although I think that with the latest ECL upgrade it was found that threading had become even more default than before and hence had to be explicitly disabled at boottime.\n\n> Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!\n\nI seriously think that's going to be a no-go. While ECL's and sage's way of handling signals are both sensible on their own, I think they are quite incompatible. Without any threads, we can sort of manage by switching the handlers. But I'm afraid that when ECL is compiled with thread support, it insists on handling async events on a separate thread under its own control. I was hoping you had a brilliant insight.",
    "created_at": "2013-06-03T19:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177625",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@SnarkBoojum](#comment%3A32):
> Ah, Nils, your explanations are really interesting: that would explain why I see signals (30=SIGPWR) without understanding exactly what happens.

You might want to read a bit of source for this. It was enlightening to me at the time. If I remember correctly, Boehm decides at runtime whether to use those signals (IIRC it keeps track of a list of threads registered with it and if that list is longer than one, it issues those signals), so you may be able to avoid those quite easily as soon as you get ECL to not create threads.

See [ECL_OPT_SIGNAL_HANDLING_THREAD](http://ecls.sourceforge.net/new-manual/ch30s03.html) for ECL (and probably the source!) If this means we get no signal handling at all in ECL, we have a bit of a problem, of course. We still want `CTRL-C` and perhaps even `SIGALRM` to work. What we really need is that `ENABLE_THREADS` is a boot-time option.

See also #11752, although I think that with the latest ECL upgrade it was found that threading had become even more default than before and hence had to be explicitly disabled at boottime.

> Though there is something you miss when you say that there is not much to benefit from the change: debian's ecl is built with threads, so if sage is to be properly packaged, then it has to work with threads!

I seriously think that's going to be a no-go. While ECL's and sage's way of handling signals are both sensible on their own, I think they are quite incompatible. Without any threads, we can sort of manage by switching the handlers. But I'm afraid that when ECL is compiled with thread support, it insists on handling async events on a separate thread under its own control. I was hoping you had a brilliant insight.



---

archive/issue_comments_177626.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWell, I have seen the ECL_OPT_SIGNAL_HANDLING_THREAD option, because indeed choosing whether to enable threading at runtime vs compile-time is the way to go. I just need to find the time to do proper experiments.",
    "created_at": "2013-06-03T19:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177626",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:34" align="right">comment:34</div>

Well, I have seen the ECL_OPT_SIGNAL_HANDLING_THREAD option, because indeed choosing whether to enable threading at runtime vs compile-time is the way to go. I just need to find the time to do proper experiments.



---

archive/issue_comments_177627.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right? This seems to open up a new window for race conditions. ECL should default to no SIGCHLD handler, possibly enabling it by an option.",
    "created_at": "2013-06-04T13:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177627",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:35" align="right">comment:35</div>

The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right? This seems to open up a new window for race conditions. ECL should default to no SIGCHLD handler, possibly enabling it by an option.



---

archive/issue_comments_177628.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@vbraun](#comment%3A35):\n> The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right?\n\nNope. `ecl_set_option` is called *prior* to `cl_boot`, which does all ecl initialization. The fix on #14055 patched ECL to change the *default* value of the boot option. The inclusion of an explicit `ecl_set_option` prior to `cl_boot` is the appropriate way of overriding the default value and should be preferred over patching ecl.",
    "created_at": "2013-06-04T21:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177628",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@vbraun](#comment%3A35):
> The patch to disable the ECL SIGCHLD handler is from #14055. We had a very subtle race between a SIGCHLD and ECL's handler. When you move this to ecl_set_option then you are booting up ECL with the SIGCHLD handler, right?

Nope. `ecl_set_option` is called *prior* to `cl_boot`, which does all ecl initialization. The fix on #14055 patched ECL to change the *default* value of the boot option. The inclusion of an explicit `ecl_set_option` prior to `cl_boot` is the appropriate way of overriding the default value and should be preferred over patching ecl.



---

archive/issue_comments_177629.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nFYI ECL 13.5.1 has been released:\n* https://sourceforge.net/mailarchive/message.php?msg_id=30906130",
    "created_at": "2013-06-10T08:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177629",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:37" align="right">comment:37</div>

FYI ECL 13.5.1 has been released:
* https://sourceforge.net/mailarchive/message.php?msg_id=30906130



---

archive/issue_comments_177630.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI'll give it a try. I'm still going nowhere :-/",
    "created_at": "2013-06-10T09:08:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177630",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:38" align="right">comment:38</div>

I'll give it a try. I'm still going nowhere :-/



---

archive/issue_comments_177631.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@jpflori](#comment%3A37):\n> FYI ECL 13.5.1 has been released:\n> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130\n\nand it's terrible it switched to asdf 3 and in Sage-on-gentoo we haven't been able to build a working maxima_lib with it for the last 10 days.",
    "created_at": "2013-06-10T11:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177631",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@jpflori](#comment%3A37):
> FYI ECL 13.5.1 has been released:
> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130

and it's terrible it switched to asdf 3 and in Sage-on-gentoo we haven't been able to build a working maxima_lib with it for the last 10 days.



---

archive/issue_comments_177632.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nIt says ASDF 2.32 in the changelog, doesn't it?",
    "created_at": "2013-06-10T15:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177632",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:40" align="right">comment:40</div>

It says ASDF 2.32 in the changelog, doesn't it?



---

archive/issue_comments_177633.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI can confirm the new ECL doesn't fit in-place. :'-(",
    "created_at": "2013-06-10T15:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177633",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:41" align="right">comment:41</div>

I can confirm the new ECL doesn't fit in-place. :'-(



---

archive/issue_comments_177634.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@jpflori](#comment%3A40):\n> It says ASDF 2.32 in the changelog, doesn't it?\n\nI am not sure that's correct. I'll have to check. From the git clone I have Juan hadn't committed asdf 3.0.1 yet. However I think it was not many commits away from 3.0.\n\nOne of the main point is that ecl use to have the asdf-bundle extension (n\u00e9 asdf-ecl as they say) and that extension has been merged in asdf (2.66?) and underwent some changes in the process.\n\nWe have a formula to build a maxima.fas with the new ecl but it leads to segfault when we load it (from sage or even from ecl itself).\n\nIn Gentoo the lisp team has decided to move things to asdf 3.0.1 as fast as they can, but the harm for maxima_lib has been somewhat before 3.0.1.\nSee [https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226) for our status.\n\nThis is our current formula to build maxima.fas\n\n```\n\t\tcd src\n\t\tecl \\\n\t\t\t-eval '(require `asdf)' \\\n\t\t\t-eval '(push \"./\" asdf:*central-registry*)' \\\n\t\t\t-eval \"(asdf:initialize-output-translations \\\n\t\t\t\t'(:output-translations :disable-cache :inherit-configuration))\" \\\n\t\t\t-eval '(load \"maxima-build.lisp\")' \\\n\t\t\t-eval '(asdf:make-build :maxima :type :fasl)' \\\n\t\t\t-eval '(quit)'\n\t\tECLLIB=`ecl -eval \"(princ (SI:GET-LIBRARY-PATHNAME))\" -eval \"(quit)\"`\n\t\tinsinto \"${ECLLIB#${EPREFIX}}\"\n\t\tnewins maxima.fasb maxima.fas\n```",
    "created_at": "2013-06-10T21:08:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177634",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@jpflori](#comment%3A40):
> It says ASDF 2.32 in the changelog, doesn't it?

I am not sure that's correct. I'll have to check. From the git clone I have Juan hadn't committed asdf 3.0.1 yet. However I think it was not many commits away from 3.0.

One of the main point is that ecl use to have the asdf-bundle extension (n asdf-ecl as they say) and that extension has been merged in asdf (2.66?) and underwent some changes in the process.

We have a formula to build a maxima.fas with the new ecl but it leads to segfault when we load it (from sage or even from ecl itself).

In Gentoo the lisp team has decided to move things to asdf 3.0.1 as fast as they can, but the harm for maxima_lib has been somewhat before 3.0.1.
See [https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226) for our status.

This is our current formula to build maxima.fas

```
		cd src
		ecl \
			-eval '(require `asdf)' \
			-eval '(push "./" asdf:*central-registry*)' \
			-eval "(asdf:initialize-output-translations \
				'(:output-translations :disable-cache :inherit-configuration))" \
			-eval '(load "maxima-build.lisp")' \
			-eval '(asdf:make-build :maxima :type :fasl)' \
			-eval '(quit)'
		ECLLIB=`ecl -eval "(princ (SI:GET-LIBRARY-PATHNAME))" -eval "(quit)"`
		insinto "${ECLLIB#${EPREFIX}}"
		newins maxima.fasb maxima.fas
```



---

archive/issue_comments_177635.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nTwo comments that might be useful:\n- When I figured out the original formula, I used trial and error and a bit of reading documentation. I found something that worked and didn't look like it was using any illegal hacks, I was happy. The new formula looks fine in that respect too, so if it works use it!\n- The `.fasb` files were used by ADSF to avoid overwriting files produced by ECL's native build routines. As far as I could see the format is the same as the `.fas` files. I did the rename to ensure that <code>(require \\`maxima)</code> would work without first doing <code>(require \\`asdf)</code> (which was necessary for recognising what to do with `.fasb` files). Since ASDF is getting more closely integrated into ECL, you may be able to modify or avoid this renaming step.",
    "created_at": "2013-06-12T06:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177635",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:43" align="right">comment:43</div>

Two comments that might be useful:
- When I figured out the original formula, I used trial and error and a bit of reading documentation. I found something that worked and didn't look like it was using any illegal hacks, I was happy. The new formula looks fine in that respect too, so if it works use it!
- The `.fasb` files were used by ADSF to avoid overwriting files produced by ECL's native build routines. As far as I could see the format is the same as the `.fas` files. I did the rename to ensure that <code>(require \`maxima)</code> would work without first doing <code>(require \`asdf)</code> (which was necessary for recognising what to do with `.fasb` files). Since ASDF is getting more closely integrated into ECL, you may be able to modify or avoid this renaming step.



---

archive/issue_comments_177636.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThanks for the encouragement Nils. It is not impossible that we have in fact uncovered some kind of bug.  If Martin is right we go through an initialisation twice and the second time we fall into an infinite loop.",
    "created_at": "2013-06-12T07:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177636",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:44" align="right">comment:44</div>

Thanks for the encouragement Nils. It is not impossible that we have in fact uncovered some kind of bug.  If Martin is right we go through an initialisation twice and the second time we fall into an infinite loop.



---

archive/issue_comments_177637.json:
```json
{
    "body": "Changed dependencies from **#11359** to none",
    "created_at": "2013-06-12T07:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177637",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#11359** to none



---

archive/issue_comments_177638.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nJust a head up about ecl 13.1.5 and asdf upgrade issues. We have a working maxima_lib in sage-on-gentoo. So we can upgrade ecl as we now have a procedure and patch for maxima (both 5.29.1 and 5.30.0 but issues with 5.30.0 are documented in another ticket).",
    "created_at": "2013-06-15T11:01:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177638",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:46" align="right">comment:46</div>

Just a head up about ecl 13.1.5 and asdf upgrade issues. We have a working maxima_lib in sage-on-gentoo. So we can upgrade ecl as we now have a procedure and patch for maxima (both 5.29.1 and 5.30.0 but issues with 5.30.0 are documented in another ticket).



---

archive/issue_comments_177639.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI finally found the time to have look ; the spkg-src script fails with \"mv: cannot stat `gmp': No such file or directory\"... this is with upstream's 12.12.1 tarball.\n\nWhere is the ticket with the ecl 13.1.5 discussion?",
    "created_at": "2013-07-09T16:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177639",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:47" align="right">comment:47</div>

I finally found the time to have look ; the spkg-src script fails with "mv: cannot stat `gmp': No such file or directory"... this is with upstream's 12.12.1 tarball.

Where is the ticket with the ecl 13.1.5 discussion?



---

archive/issue_comments_177640.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nWe had a long thread about it - or rather the new asdf - on github for sage-on-gentoo. No spkg at this stage. The short of it is that ecl should be fine without patches. maxima, any version, needs a patch to produce what we want. The current procedure just won't work.\n[https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226)",
    "created_at": "2013-07-09T21:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177640",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:48" align="right">comment:48</div>

We had a long thread about it - or rather the new asdf - on github for sage-on-gentoo. No spkg at this stage. The short of it is that ecl should be fine without patches. maxima, any version, needs a patch to produce what we want. The current procedure just won't work.
[https://github.com/cschwan/sage-on-gentoo/issues/226](https://github.com/cschwan/sage-on-gentoo/issues/226)



---

archive/issue_comments_177641.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nFran\u00e7ois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?",
    "created_at": "2013-07-10T10:03:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177641",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:49" align="right">comment:49</div>

Franois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?



---

archive/issue_comments_177642.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nNow that I am starting to remember stuff, removing the \"dirty workaround\" discussed in this ticket will break one doctest at least. But then I haven't tested your patches either.\n\nI have problems getting enough time to work on sage these days and it will probably become worse until September. I cannot give you expectation that I will make the two spkgs in question in a timely fashion.",
    "created_at": "2013-07-10T10:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177642",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:50" align="right">comment:50</div>

Now that I am starting to remember stuff, removing the "dirty workaround" discussed in this ticket will break one doctest at least. But then I haven't tested your patches either.

I have problems getting enough time to work on sage these days and it will probably become worse until September. I cannot give you expectation that I will make the two spkgs in question in a timely fashion.



---

archive/issue_comments_177643.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nby the way, `patches/disable_sigchdl_handler.patch` apparently breaks OSX PPC support.",
    "created_at": "2013-08-14T06:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177643",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

by the way, `patches/disable_sigchdl_handler.patch` apparently breaks OSX PPC support.



---

archive/issue_comments_177644.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nDima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?",
    "created_at": "2013-08-14T06:46:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177644",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:52" align="right">comment:52</div>

Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?



---

archive/issue_comments_177645.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nCan you be a bit more vague about what does not work on OSX PPC without the sigchld handler?",
    "created_at": "2013-08-14T10:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177645",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:53" align="right">comment:53</div>

Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?



---

archive/issue_comments_177646.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@vbraun](#comment%3A53):\n> Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?\n\nLet me try using `less`,  as `more` is not installed :\u2013)\n\nNot very informative segfault with `ecl-12.12.1.p4`:\n\n```\n...\n;*** Lisp core booted ****\nECL (Embeddable Common Lisp)\n\n;;;\n;;; Welcome to bare.lsp. Let's bring this instance up!\n;;;\n;;;\n;;; About to load lsp/load.lsp\n;;; \n;;; Loading src:lsp;export.lsp/bin/sh: line 1: 97036 Segmentation fault      ECLDIR=`pwd`/ ./ecl_min compile\nmake[4]: *** [bin/ecl] Error 139\nmake[3]: *** [all] Error 2\nError - Failed to build ECL ... exiting\n...\n```",
    "created_at": "2013-08-14T12:32:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177646",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@vbraun](#comment%3A53):
> Can you be a bit more vague about what does not work on OSX PPC without the sigchld handler?

Let me try using `less`,  as `more` is not installed :)

Not very informative segfault with `ecl-12.12.1.p4`:

```
...
;*** Lisp core booted ****
ECL (Embeddable Common Lisp)

;;;
;;; Welcome to bare.lsp. Let's bring this instance up!
;;;
;;;
;;; About to load lsp/load.lsp
;;; 
;;; Loading src:lsp;export.lsp/bin/sh: line 1: 97036 Segmentation fault      ECLDIR=`pwd`/ ./ecl_min compile
make[4]: *** [bin/ecl] Error 139
make[3]: *** [all] Error 2
Error - Failed to build ECL ... exiting
...
```



---

archive/issue_comments_177647.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@SnarkBoojum](#comment%3A52):\n> Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?\n\nit turns out that reenabling Altivec back in `p2` was the cause of trouble. If I reapply the patch from #11297\n\n```\n--- a/spkg-install\tWed Jun 05 19:56:22 2013 +0000\n+++ b/spkg-install\tWed Aug 14 23:25:31 2013 +0800\n@@ -48,6 +48,12 @@\n     CXXFLAGS=\"-g -O2 $CXXFLAGS\"\n fi\n \n+if [ \"`uname -sm`\" = \"Darwin Power Macintosh\" ] ; then \n+# Disabling altivec instructions (trac 11297) \n+    CFLAGS=\"$CFLAGS -mno-altivec -mabi=no-altivec\" \n+    export CFLAGS \n+fi \n+\n # These are all used by GNU to specify compilers.\n echo \"Using CC=$CC\"\n echo \"Using CXX=$CXX\"\n```\nthen `p4` works for me. Sorry for noise.",
    "created_at": "2013-08-14T15:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177647",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@SnarkBoojum](#comment%3A52):
> Dima, then my first patch which moves the change into sagelib should there break too. That would probably mean there's an upstream issue on OSX PPC... Can you check?

it turns out that reenabling Altivec back in `p2` was the cause of trouble. If I reapply the patch from #11297

```
--- a/spkg-install	Wed Jun 05 19:56:22 2013 +0000
+++ b/spkg-install	Wed Aug 14 23:25:31 2013 +0800
@@ -48,6 +48,12 @@
     CXXFLAGS="-g -O2 $CXXFLAGS"
 fi
 
+if [ "`uname -sm`" = "Darwin Power Macintosh" ] ; then 
+# Disabling altivec instructions (trac 11297) 
+    CFLAGS="$CFLAGS -mno-altivec -mabi=no-altivec" 
+    export CFLAGS 
+fi 
+
 # These are all used by GNU to specify compilers.
 echo "Using CC=$CC"
 echo "Using CXX=$CXX"
```
then `p4` works for me. Sorry for noise.



---

archive/issue_comments_177648.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,8 @@\n \n (3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)\n \n-**spkg**: [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz))\n+To fix this ticket:\n+(1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;\n+(2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).\n \n-**apply** [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib\n-\n-Related: #12985\n+This fix is against sage 5.12.beta3.\n``````\n",
    "created_at": "2013-08-26T07:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177648",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,8 @@
 
 (3) threading is disabled ; I'll open another ticket for that, so let's that aside for now (and for this ticket)
 
-**spkg**: [http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg](http://boxen.math.washington.edu/home/jpuydt/ecl-12.12.1.p4.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl-12.12.1.p4.patch.gz))
+To fix this ticket:
+(1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;
+(2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).
 
-**apply** [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib
-
-Related: #12985
+This fix is against sage 5.12.beta3.
``````




---

archive/issue_events_205436.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-26T07:18:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205436"
}
```



---

archive/issue_events_205437.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-26T07:18:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205437"
}
```



---

archive/issue_comments_177649.json:
```json
{
    "body": "Changed work issues from **rebase, SIGCHLD doctest** to none",
    "created_at": "2013-08-26T07:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177649",
    "user": "https://github.com/SnarkBoojum"
}
```

Changed work issues from **rebase, SIGCHLD doctest** to none



---

archive/issue_comments_177650.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\n1) I don't think the work issue \"SIGCHLD doctest\" has been addressed.\n\n2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.",
    "created_at": "2013-08-26T07:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177650",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

1) I don't think the work issue "SIGCHLD doctest" has been addressed.

2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.



---

archive/issue_comments_177651.json:
```json
{
    "body": "Work Issues: **SIGCHLD doctest, spkg-src**",
    "created_at": "2013-08-26T07:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177651",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **SIGCHLD doctest, spkg-src**



---

archive/issue_events_205438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-26T07:33:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205438"
}
```



---

archive/issue_events_205439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-26T07:33:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205439"
}
```



---

archive/issue_comments_177652.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAlso in `SPKG.txt`, there is something wrong with the sentence \"don't path to disable SIGCHLD.\"",
    "created_at": "2013-08-26T07:34:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177652",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

Also in `SPKG.txt`, there is something wrong with the sentence "don't path to disable SIGCHLD."



---

archive/issue_comments_177653.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jdemeyer](#comment%3A58):\n> 1) I don't think the work issue \"SIGCHLD doctest\" has been addressed.\n\nI don't have any failing doctest: what exactly do you want? Again, I'm just moving something from patching upstream to calling an api...\n\n> 2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.\n\nIf unicode isn't disabled, it's not unneeded anymore.",
    "created_at": "2013-08-26T09:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177653",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jdemeyer](#comment%3A58):
> 1) I don't think the work issue "SIGCHLD doctest" has been addressed.

I don't have any failing doctest: what exactly do you want? Again, I'm just moving something from patching upstream to calling an api...

> 2) Why do you stop removing unneeded stuff from the upstream sources? It adds 4.5MB for absolutely no reason.

If unicode isn't disabled, it's not unneeded anymore.



---

archive/issue_comments_177654.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI made a new p5 spkg, available at the same place, and also updated the p4 to p5 patch here.",
    "created_at": "2013-08-26T19:29:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177654",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:61" align="right">comment:61</div>

I made a new p5 spkg, available at the same place, and also updated the p4 to p5 patch here.



---

archive/issue_events_205440.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-27T08:16:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205440"
}
```



---

archive/issue_events_205441.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-27T08:16:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205441"
}
```



---

archive/issue_comments_177655.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@SnarkBoojum](#comment%3A60):\n\n> If unicode isn't disabled, it's not unneeded anymore.\n\nThat may be true for the `contrib/encodings` and `contrib/unicode` subdirectories, but do you now need `msvc`, `src/gc-unstable`, `src/libffi` and all of `src/gmp`? Your attached patch suggests you're not removing those either anymore. The attached patch also doesn't reflect the edits to spkg-make that you probably made.",
    "created_at": "2013-08-27T18:07:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177655",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@SnarkBoojum](#comment%3A60):

> If unicode isn't disabled, it's not unneeded anymore.

That may be true for the `contrib/encodings` and `contrib/unicode` subdirectories, but do you now need `msvc`, `src/gc-unstable`, `src/libffi` and all of `src/gmp`? Your attached patch suggests you're not removing those either anymore. The attached patch also doesn't reflect the edits to spkg-make that you probably made.



---

archive/issue_events_205442.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-27T18:46:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205442"
}
```



---

archive/issue_events_205443.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-27T18:46:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205443"
}
```



---

archive/issue_comments_177656.json:
```json
{
    "body": "Changed work issues from **SIGCHLD doctest, spkg-src** to **spkg-src**",
    "created_at": "2013-08-27T18:46:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177656",
    "user": "https://github.com/SnarkBoojum"
}
```

Changed work issues from **SIGCHLD doctest, spkg-src** to **spkg-src**



---

archive/issue_comments_177657.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nMy attached patch wasn't reflecting edits to spkg-src because I didn't touch it. The next version will modify it, and only not to remove the unicode-related directories.\n\nI'll push the new patch when I'll have checked it's ok. For now I just know it builds correctly.",
    "created_at": "2013-08-27T18:46:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177657",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:64" align="right">comment:64</div>

My attached patch wasn't reflecting edits to spkg-src because I didn't touch it. The next version will modify it, and only not to remove the unicode-related directories.

I'll push the new patch when I'll have checked it's ok. For now I just know it builds correctly.



---

archive/issue_comments_177658.json:
```json
{
    "body": "Attachment: **[ecl_p4_to_p5.patch.gz](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)**\n\nPatch against ecl's p4 for p5",
    "created_at": "2013-08-28T17:48:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177658",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[ecl_p4_to_p5.patch.gz](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)**

Patch against ecl's p4 for p5



---

archive/issue_comments_177659.json:
```json
{
    "body": "Changed work issues from **spkg-src** to none",
    "created_at": "2013-08-28T17:50:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177659",
    "user": "https://github.com/SnarkBoojum"
}
```

Changed work issues from **spkg-src** to none



---

archive/issue_events_205444.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-28T17:50:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205444"
}
```



---

archive/issue_events_205445.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-08-28T17:50:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205445"
}
```



---

archive/issue_comments_177660.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nNo failing doctest ; now src/ is generated by a patched spkg-src.",
    "created_at": "2013-08-28T17:50:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177660",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:65" align="right">comment:65</div>

No failing doctest ; now src/ is generated by a patched spkg-src.



---

archive/issue_comments_177661.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nIt's still ok with 5.12.beta4.",
    "created_at": "2013-09-01T19:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177661",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:66" align="right">comment:66</div>

It's still ok with 5.12.beta4.



---

archive/issue_comments_177662.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n (1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;\n (2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).\n \n-This fix is against sage 5.12.beta3.\n+This fix is against sage 5.12.beta4.\n``````\n",
    "created_at": "2013-09-01T19:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177662",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 (1) use [this ecl spkg](http://boxen.math.washington.edu/home/jpuydt/ECL_Maxima/ecl-12.12.1.p5.spkg) ([spkg diff](https://github.com/sagemath/sage/files/ticket14636/ecl_p4_to_p5.patch.gz)) ;
 (2) apply [attachment: trac_14636_1.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_1.patch.gz) and [attachment: trac_14636_2.patch](https://github.com/sagemath/sage/files/ticket14636/trac_14636_2.patch.gz) to sagelib (in that order).
 
-This fix is against sage 5.12.beta3.
+This fix is against sage 5.12.beta4.
``````




---

archive/issue_comments_177663.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@SnarkBoojum](#comment%3A60):\n> Again, I'm just moving something from patching upstream to calling an api...\n\nAgain, that's only a **claim**. A doctest can **prove** you are right.",
    "created_at": "2013-09-04T08:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177663",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@SnarkBoojum](#comment%3A60):
> Again, I'm just moving something from patching upstream to calling an api...

Again, that's only a **claim**. A doctest can **prove** you are right.



---

archive/issue_events_205446.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-09-04T10:44:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205446"
}
```



---

archive/issue_events_205447.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-09-04T10:44:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205447"
}
```



---

archive/issue_comments_177664.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@jdemeyer](#comment%3A67):\n> Replying to [@SnarkBoojum](#comment%3A60):\n> > Again, I'm just moving something from patching upstream to calling an api...\n> \n> Again, that's only a **claim**. A doctest can **prove** you are right.\n\nOOOHHH!!!! You want me to ADD a doctest!\n\nI'm not sure it makes much sense to follow a line \"a=0\" by a doctest \"a==0\", but if you want I'll add one.",
    "created_at": "2013-09-04T10:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177664",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@jdemeyer](#comment%3A67):
> Replying to [@SnarkBoojum](#comment%3A60):
> > Again, I'm just moving something from patching upstream to calling an api...
> 
> Again, that's only a **claim**. A doctest can **prove** you are right.

OOOHHH!!!! You want me to ADD a doctest!

I'm not sure it makes much sense to follow a line "a=0" by a doctest "a==0", but if you want I'll add one.



---

archive/issue_comments_177665.json:
```json
{
    "body": "Work Issues: **add doctest**",
    "created_at": "2013-09-04T10:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177665",
    "user": "https://github.com/SnarkBoojum"
}
```

Work Issues: **add doctest**



---

archive/issue_comments_177666.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nI see that trac_14636_2.patch is the same (up to a slight edit in the commit) than the patch in #12985 so incorporating this ticket would make it a duplicate.\nI think you should go ahead and add the doctest.",
    "created_at": "2013-10-03T11:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177666",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:69" align="right">comment:69</div>

I see that trac_14636_2.patch is the same (up to a slight edit in the commit) than the patch in #12985 so incorporating this ticket would make it a duplicate.
I think you should go ahead and add the doctest.



---

archive/issue_comments_177667.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nIn the spirit of having one ticket per issue I've broken off the part about using and doctesting `ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)` into a new ticket at #15441",
    "created_at": "2013-11-21T02:13:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177667",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:70" align="right">comment:70</div>

In the spirit of having one ticket per issue I've broken off the part about using and doctesting `ecl_set_option(ECL_OPT_TRAP_SIGCHLD, 0)` into a new ticket at #15441



---

archive/issue_comments_177668.json:
```json
{
    "body": "Changed author from **Julien Puydt** to **Volker Braun**",
    "created_at": "2014-04-09T00:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177668",
    "user": "https://github.com/vbraun"
}
```

Changed author from **Julien Puydt** to **Volker Braun**



---

archive/issue_events_205448.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-09T00:06:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205448"
}
```



---

archive/issue_events_205449.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-09T00:06:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205449"
}
```



---

archive/issue_comments_177669.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nDuplicate of #12985, so close one of them. This one.",
    "created_at": "2014-04-09T00:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177669",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:71" align="right">comment:71</div>

Duplicate of #12985, so close one of them. This one.



---

archive/issue_comments_177670.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nReplying to [@SnarkBoojum](#comment%3A49):\n> Fran\u00e7ois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?\n\nI've just pushed the build formula used on sage-on-gentoo into a branch associated with ticket:16178.",
    "created_at": "2014-04-17T11:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177670",
    "user": "https://github.com/gagern"
}
```

<div id="comment:72" align="right">comment:72</div>

Replying to [@SnarkBoojum](#comment%3A49):
> Franois, if you have a way to have a no-patch-ecl+lightly-patched-maxima combination to work, perhaps it would be best to push it into sage and be done with this ticket?

I've just pushed the build formula used on sage-on-gentoo into a branch associated with ticket:16178.



---

archive/issue_comments_177671.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@jpflori](#comment%3A37):\n> FYI ECL 13.5.1 has been released:\n> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130\n\nWith [ticket:16178 the new maxima build system] included in sage 6.2, do you want to aim for an ECL update for 6.3?",
    "created_at": "2014-06-16T20:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177671",
    "user": "https://github.com/gagern"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@jpflori](#comment%3A37):
> FYI ECL 13.5.1 has been released:
> * https://sourceforge.net/mailarchive/message.php?msg_id=30906130

With [ticket:16178 the new maxima build system] included in sage 6.2, do you want to aim for an ECL update for 6.3?



---

archive/issue_comments_177672.json:
```json
{
    "body": "Reviewer: **Volker Braun, Peter Bruin**",
    "created_at": "2014-12-01T11:03:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177672",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Volker Braun, Peter Bruin**



---

archive/issue_comments_177673.json:
```json
{
    "body": "Changed author from **Volker Braun** to none",
    "created_at": "2014-12-01T11:03:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177673",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Volker Braun** to none



---

archive/issue_events_205450.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-12-01T11:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205450"
}
```



---

archive/issue_events_205451.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-12-01T11:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205451"
}
```



---

archive/issue_events_205452.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-12-01T11:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205452"
}
```



---

archive/issue_comments_177674.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nSince the relevant changes were made in #12985 and #15441, we should close this as a duplicate.",
    "created_at": "2014-12-01T11:03:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14636#issuecomment-177674",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:74" align="right">comment:74</div>

Since the relevant changes were made in #12985 and #15441, we should close this as a duplicate.



---

archive/issue_events_205453.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-01T11:42:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205453"
}
```



---

archive/issue_events_205454.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-01T11:42:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205454"
}
```



---

archive/issue_events_205455.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-01T11:42:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205455"
}
```



---

archive/issue_events_205456.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-01T11:42:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14636",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "c6c6c6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14636#event-205456"
}
```
