# Issue 14577: Bug in the case S_4 in Galois representations of elliptic curves

archive/issues_014373.json:
```json
{
    "body": "John Cremona noted that\n\n```\nsage: EllipticCurve('50700u1').galois_representation().image_type(13)\n```\n\nproduces\n\n```\nAssertionError: bug in image_type.\n```\n\nApply\n* [attachment:trac_14577_bug_in_galois_reps.patch]\n* [attachment:trac_14577_bug_in_galois_reps-addon1.patch]\n\nAssignee: @JohnCremona\n\nKeywords: galois representations, elliptic curves\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Chris Wuthrich\n\nMerged: sage-5.10.rc0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/14577\n\n",
    "closed_at": "2013-05-29T06:51:35Z",
    "created_at": "2013-05-14T08:52:58Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Bug in the case S_4 in Galois representations of elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14577",
    "user": "https://github.com/categorie"
}
```
John Cremona noted that

```
sage: EllipticCurve('50700u1').galois_representation().image_type(13)
```

produces

```
AssertionError: bug in image_type.
```

Apply
* [attachment:trac_14577_bug_in_galois_reps.patch]
* [attachment:trac_14577_bug_in_galois_reps-addon1.patch]

Assignee: @JohnCremona

Keywords: galois representations, elliptic curves

Reviewer: Frédéric Chapoton

Author: Chris Wuthrich

Merged: sage-5.10.rc0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/14577





---

archive/issue_comments_227089.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to elliptic curves.",
    "created_at": "2013-05-14T08:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227089",
    "user": "https://github.com/categorie"
}
```

Changing component from PLEASE CHANGE to elliptic curves.



---

archive/issue_comments_227090.json:
```json
{
    "body": "Changing assignee from tbd to @JohnCremona.",
    "created_at": "2013-05-14T08:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227090",
    "user": "https://github.com/categorie"
}
```

Changing assignee from tbd to @JohnCremona.



---

archive/issue_comments_227091.json:
```json
{
    "body": "Attachment [trac_14577_bug_in_galois_reps.patch](tarball://root/attachments/some-uuid/ticket14577/trac_14577_bug_in_galois_reps.patch) by @categorie created at 2013-05-14 09:03:26",
    "created_at": "2013-05-14T09:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227091",
    "user": "https://github.com/categorie"
}
```

Attachment [trac_14577_bug_in_galois_reps.patch](tarball://root/attachments/some-uuid/ticket14577/trac_14577_bug_in_galois_reps.patch) by @categorie created at 2013-05-14 09:03:26



---

archive/issue_comments_227092.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-14T09:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227092",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227093.json:
```json
{
    "body": "Changing author from \"\" to \"Chris Wuthrich\"",
    "created_at": "2013-05-14T09:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227093",
    "user": "https://github.com/categorie"
}
```

Changing author from "" to "Chris Wuthrich"



---

archive/issue_comments_227094.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-17T20:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227094",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_227095.json:
```json
{
    "body": "<a id='comment:4'></a>I have uploaded an add-on patch which  \n- puts the raise statements into python3 syntax\n- adds the links to the trac tickets\n\nBut there is a problem with your patch: one doctest is failing, there is no curve called '50700u1', even after installing the extended Cremona database.",
    "created_at": "2013-05-17T20:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227095",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>I have uploaded an add-on patch which  
- puts the raise statements into python3 syntax
- adds the links to the trac tickets

But there is a problem with your patch: one doctest is failing, there is no curve called '50700u1', even after installing the extended Cremona database.



---

archive/issue_comments_227096.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 chapoton]:\n> I have uploaded an add-on patch which  \n> - puts the raise statements into python3 syntax\n> - adds the links to the trac tickets\n> \n> But there is a problem with your patch: one doctest is failing, there is no curve called '50700u1', even after installing the extended Cremona database.\n\n\n?? Yes there is!  However, in order for this test to be usable without the optional database I suggest replacing it with\n\n```\nEllipticCurve([0,1,0,-4788,109188]).galois_representation().image_type(13)\n```\n(I have inserted the a-invariants of 50700u1).",
    "created_at": "2013-05-18T10:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227096",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>Replying to [comment:4 chapoton]:
> I have uploaded an add-on patch which  
> - puts the raise statements into python3 syntax
> - adds the links to the trac tickets
> 
> But there is a problem with your patch: one doctest is failing, there is no curve called '50700u1', even after installing the extended Cremona database.


?? Yes there is!  However, in order for this test to be usable without the optional database I suggest replacing it with

```
EllipticCurve([0,1,0,-4788,109188]).galois_representation().image_type(13)
```
(I have inserted the a-invariants of 50700u1).



---

archive/issue_comments_227097.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-18T10:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227097",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_227098.json:
```json
{
    "body": "<a id='comment:6'></a>ok, I have done that.\n\nOtherwise, one would have to make the test optional.",
    "created_at": "2013-05-18T10:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227098",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>ok, I have done that.

Otherwise, one would have to make the test optional.



---

archive/issue_comments_227099.json:
```json
{
    "body": "Attachment [trac_14577_bug_in_galois_reps-addon1.patch](tarball://root/attachments/some-uuid/ticket14577/trac_14577_bug_in_galois_reps-addon1.patch) by @fchapoton created at 2013-05-18 18:39:15",
    "created_at": "2013-05-18T18:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227099",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_14577_bug_in_galois_reps-addon1.patch](tarball://root/attachments/some-uuid/ticket14577/trac_14577_bug_in_galois_reps-addon1.patch) by @fchapoton created at 2013-05-18 18:39:15



---

archive/issue_comments_227100.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks for the patch. Can you give a positive review for the combination ?",
    "created_at": "2013-05-20T13:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227100",
    "user": "https://github.com/categorie"
}
```

<a id='comment:7'></a>Thanks for the patch. Can you give a positive review for the combination ?



---

archive/issue_comments_227101.json:
```json
{
    "body": "<a id='comment:8'></a>Sorry, but I am not able to check the math. If you are sure of the math, you can put a positive review in my name.",
    "created_at": "2013-05-23T18:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227101",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Sorry, but I am not able to check the math. If you are sure of the math, you can put a positive review in my name.



---

archive/issue_comments_227102.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2013-05-23T18:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227102",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_227103.json:
```json
{
    "body": "<a id='comment:9'></a>Chris, can you give us (here) a quick note about the new el5 assignment from roots of a quadratic instead of whatever it was before?\n\nAlso, we need to put instructions in the descriptions about applying both patches in sequence.",
    "created_at": "2013-05-23T18:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227103",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>Chris, can you give us (here) a quick note about the new el5 assignment from roots of a quadratic instead of whatever it was before?

Also, we need to put instructions in the descriptions about applying both patches in sequence.



---

archive/issue_comments_227104.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,3 +9,7 @@\n ```\n AssertionError: bug in image_type.\n ```\n+\n+Apply\n+* [attachment:trac_14577_bug_in_galois_reps.patch]\n+* [attachment:trac_14577_bug_in_galois_reps-addon1.patch]\n``````\n",
    "created_at": "2013-05-23T18:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227104",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,3 +9,7 @@
 ```
 AssertionError: bug in image_type.
 ```
+
+Apply
+* [attachment:trac_14577_bug_in_galois_reps.patch]
+* [attachment:trac_14577_bug_in_galois_reps-addon1.patch]
``````




---

archive/issue_comments_227105.json:
```json
{
    "body": "<a id='comment:11'></a>Yes, I am sure this improves this function.\n\nThe function `_ex_set(p)` at the start of the file lists the elements in PGL_2(F_p) that may appear in an exceptional subgroup A_n or S_n. Or rather it lists what `trace^2/det` evaluates on them. (This is taken from Serre's paper). In particular the elements of order 5 are the roots of `(X**2 - 3*X+1)`, which we add at the end to the list.\n\nNow later this is used in the function `image_type`. Unfortunately, I took the last two elements, when in fact for some `p` there is are no such elements of order 5. As a consequence, the example that John found all possibilities for what the subgroup could be were eliminated. Hence the answer \"bug\". Now it gives the correct answer.\n\nSo the maths did not change, just a silly bug was eliminated.",
    "created_at": "2013-05-23T20:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227105",
    "user": "https://github.com/categorie"
}
```

<a id='comment:11'></a>Yes, I am sure this improves this function.

The function `_ex_set(p)` at the start of the file lists the elements in PGL_2(F_p) that may appear in an exceptional subgroup A_n or S_n. Or rather it lists what `trace^2/det` evaluates on them. (This is taken from Serre's paper). In particular the elements of order 5 are the roots of `(X**2 - 3*X+1)`, which we add at the end to the list.

Now later this is used in the function `image_type`. Unfortunately, I took the last two elements, when in fact for some `p` there is are no such elements of order 5. As a consequence, the example that John found all possibilities for what the subgroup could be were eliminated. Hence the answer "bug". Now it gives the correct answer.

So the maths did not change, just a silly bug was eliminated.



---

archive/issue_comments_227106.json:
```json
{
    "body": "<a id='comment:12'></a>ok, then positive review.",
    "created_at": "2013-05-24T07:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227106",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>ok, then positive review.



---

archive/issue_comments_227107.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-24T07:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227107",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227108.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 chapoton]:\n> ok, then positive review.\n\n\nSeconded -- thanks for the explanation.   I think it is better to have that written on this ticket, though I know I could have worked that out for myself, if it had not been the week of exam marking for me...",
    "created_at": "2013-05-24T09:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227108",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>Replying to [comment:12 chapoton]:
> ok, then positive review.


Seconded -- thanks for the explanation.   I think it is better to have that written on this ticket, though I know I could have worked that out for myself, if it had not been the week of exam marking for me...



---

archive/issue_comments_227109.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-29T06:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227109",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_227110.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.10.rc0\"",
    "created_at": "2013-05-29T06:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227110",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.10.rc0"



---

archive/issue_events_041514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-29T06:51:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14577#event-41514"
}
```



---

archive/issue_comments_227111.json:
```json
{
    "body": "<a id='comment:15'></a>Too late for this ticket, but unfortunately a typo causes this:\n\n```\nEllipticCurve([0, 0, 0, -1129345880,-86028258620304]).galois_representation().image_type(11)\n```\ngives\n\n```\nNameError: global name 'nonsplit_str' is not defined\n```\nbecause the identifier non_split_str is referred to wrongly on lines 1054 and 1108 in gal_reps.py.  I have another patch which I will put onto a new ticket: #14752.",
    "created_at": "2013-06-17T08:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14577#issuecomment-227111",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>Too late for this ticket, but unfortunately a typo causes this:

```
EllipticCurve([0, 0, 0, -1129345880,-86028258620304]).galois_representation().image_type(11)
```
gives

```
NameError: global name 'nonsplit_str' is not defined
```
because the identifier non_split_str is referred to wrongly on lines 1054 and 1108 in gal_reps.py.  I have another patch which I will put onto a new ticket: #14752.
