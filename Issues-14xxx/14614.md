# Issue 14614: Improved is_triangle_free using bitfields

archive/issues_014410.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/nathanncohen",
        "https://github.com/rlmill"
    ],
    "body": "Test (and potentially) implement a faster is_triangle_free method using the data structure from #14589\n\n\n\n\n\nCC:  @sagetrac-Slani @sagetrac-Stefan @sagetrac-azi @dimpase @nathanncohen\n\nBranch/Commit: **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **David Coudert**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14614_\n\n",
    "closed_at": "2019-10-03T17:58:40Z",
    "created_at": "2013-05-19T08:31:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improved is_triangle_free using bitfields",
    "type": "issue",
    "updated_at": "2019-10-03T17:58:40Z",
    "url": "https://github.com/sagemath/sage/issues/14614",
    "user": "https://github.com/sagetrac-azi"
}
```
Test (and potentially) implement a faster is_triangle_free method using the data structure from #14589





CC:  @sagetrac-Slani @sagetrac-Stefan @sagetrac-azi @dimpase @nathanncohen

Branch/Commit: **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**

Reviewer: **Dima Pasechnik**

Author: **David Coudert**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/14614_





---

archive/issue_events_205058.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205058"
}
```



---

archive/issue_events_205059.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205059"
}
```



---

archive/issue_events_205060.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205060"
}
```



---

archive/issue_events_205061.json:
```json
{
    "actor": "https://github.com/sagetrac-azi",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205061"
}
```



---

archive/issue_events_205062.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205062"
}
```



---

archive/issue_events_205063.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205063"
}
```



---

archive/issue_events_205064.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2013-05-19T08:31:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "subject": "https://github.com/sagetrac-azi",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205064"
}
```



---

archive/issue_comments_177232.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNathann,  you're probably in the best position to test this?",
    "created_at": "2013-05-19T08:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177232",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:1" align="right">comment:1</div>

Nathann,  you're probably in the best position to test this?



---

archive/issue_comments_177233.json:
```json
{
    "body": "Attachment: **[trac_14614.patch.gz](https://github.com/sagemath/sage/files/ticket14614/trac_14614.patch.gz)**",
    "created_at": "2013-05-19T12:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177233",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[trac_14614.patch.gz](https://github.com/sagemath/sage/files/ticket14614/trac_14614.patch.gz)**



---

archive/issue_comments_177234.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere's a patch. But it's almost like what we already have, sooooooooo...Fail `:-P`\n\nNathann",
    "created_at": "2013-05-19T12:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177234",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:2" align="right">comment:2</div>

Here's a patch. But it's almost like what we already have, sooooooooo...Fail `:-P`

Nathann



---

archive/issue_comments_177235.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n(it's not documented, but that's because I don't see a reason to include it in Sage)\n\nNathann",
    "created_at": "2013-05-19T12:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177235",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:3" align="right">comment:3</div>

(it's not documented, but that's because I don't see a reason to include it in Sage)

Nathann



---

archive/issue_comments_177236.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSo what are the timings now?",
    "created_at": "2013-05-19T12:58:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177236",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:4" align="right">comment:4</div>

So what are the timings now?



---

archive/issue_comments_177237.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nBtw why you need three nested loops? Is there no way to have a row of neighbors for each vector?",
    "created_at": "2013-05-19T12:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177237",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:5" align="right">comment:5</div>

Btw why you need three nested loops? Is there no way to have a row of neighbors for each vector?



---

archive/issue_comments_177238.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe same... Give it a try ! I don't really know what to test this on, though `:-)`\n\nThere's a small difference for those ones... But honestly... `:-P`\n\n```\nsage: g = graphs.Grid2dGraph(20,20)                    \nsage: %time g.is_triangle_free()   \nCPU times: user 0.14 s, sys: 0.00 s, total: 0.14 s\nWall time: 0.15 s\nTrue\nsage: %time g.is_triangle_free(algorithm=\"dense_graph\")\nCPU times: user 0.02 s, sys: 0.00 s, total: 0.02 s\nWall time: 0.01 s\nTrue\n```\n\nNathann",
    "created_at": "2013-05-19T13:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177238",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">comment:6</div>

The same... Give it a try ! I don't really know what to test this on, though `:-)`

There's a small difference for those ones... But honestly... `:-P`

```
sage: g = graphs.Grid2dGraph(20,20)                    
sage: %time g.is_triangle_free()   
CPU times: user 0.14 s, sys: 0.00 s, total: 0.14 s
Wall time: 0.15 s
True
sage: %time g.is_triangle_free(algorithm="dense_graph")
CPU times: user 0.02 s, sys: 0.00 s, total: 0.02 s
Wall time: 0.01 s
True
```

Nathann



---

archive/issue_comments_177239.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWell, do you see a way around ? Each row is a sequence of \"long\" fields...\n\nNathann",
    "created_at": "2013-05-19T13:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177239",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:7" align="right">comment:7</div>

Well, do you see a way around ? Each row is a sequence of "long" fields...

Nathann



---

archive/issue_comments_177240.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOh, I thought that was somehow abstractly packed to allow arbitrarily long rows..\n\nAnyways, I think the main reason this is not faster is that we first need to build the matrix and then do the checking...\n\nIt would be neat if our new backend had bitsets of neihbors (along whatever data structure we may choose to keep). I think this would then constitute a major improvement, perhaps by having a method neighbors_intersection(v_1,...,v_k) to the new list of backend functions..",
    "created_at": "2013-05-19T13:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177240",
    "user": "https://github.com/sagetrac-azi"
}
```

<div id="comment:8" align="right">comment:8</div>

Oh, I thought that was somehow abstractly packed to allow arbitrarily long rows..

Anyways, I think the main reason this is not faster is that we first need to build the matrix and then do the checking...

It would be neat if our new backend had bitsets of neihbors (along whatever data structure we may choose to keep). I think this would then constitute a major improvement, perhaps by having a method neighbors_intersection(v_1,...,v_k) to the new list of backend functions..



---

archive/issue_comments_177241.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHelloooooooooooo !!\n\n> Oh, I thought that was somehow abstractly packed to allow arbitrarily long rows..\n> \n> Anyways, I think the main reason this is not faster is that we first need to build the matrix and then do the checking...\n\nHmmm... Yeah, probably. It would be nice to have instances in which the algorithm really has `n^3` complexity.\n\n....\n\nStupid guy. Ok, I'll give it a try on a complete bipartite graph `:-P`\n\n```\nsage: g = graphs.CompleteBipartiteGraph(200,200)       \nsage: %time g.is_triangle_free()                       \nCPU times: user 0.68 s, sys: 0.00 s, total: 0.68 s\nWall time: 0.69 s\nTrue\nsage: %time g.is_triangle_free(algorithm=\"dense_graph\")\nCPU times: user 0.18 s, sys: 0.00 s, total: 0.18 s\nWall time: 0.18 s\nTrue\n```\n\nWell, ...\n\n> It would be neat if our new backend had bitsets of neihbors (along whatever data structure we may choose to keep). I think this would then constitute a major improvement, perhaps by having a method neighbors_intersection(v_1,...,v_k) to the new list of backend functions..\n\nI really like to have access to a thing as basic as an array of \"long\" fields, though. But we could definitely has something similar, at a slightly higher level. An array of Python bitsets ?...\n\nThe problem of this data structure is addition/removal of vertices.\n\nNathann",
    "created_at": "2013-05-19T13:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177241",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:9" align="right">comment:9</div>

Helloooooooooooo !!

> Oh, I thought that was somehow abstractly packed to allow arbitrarily long rows..
> 
> Anyways, I think the main reason this is not faster is that we first need to build the matrix and then do the checking...

Hmmm... Yeah, probably. It would be nice to have instances in which the algorithm really has `n^3` complexity.

....

Stupid guy. Ok, I'll give it a try on a complete bipartite graph `:-P`

```
sage: g = graphs.CompleteBipartiteGraph(200,200)       
sage: %time g.is_triangle_free()                       
CPU times: user 0.68 s, sys: 0.00 s, total: 0.68 s
Wall time: 0.69 s
True
sage: %time g.is_triangle_free(algorithm="dense_graph")
CPU times: user 0.18 s, sys: 0.00 s, total: 0.18 s
Wall time: 0.18 s
True
```

Well, ...

> It would be neat if our new backend had bitsets of neihbors (along whatever data structure we may choose to keep). I think this would then constitute a major improvement, perhaps by having a method neighbors_intersection(v_1,...,v_k) to the new list of backend functions..

I really like to have access to a thing as basic as an array of "long" fields, though. But we could definitely has something similar, at a slightly higher level. An array of Python bitsets ?...

The problem of this data structure is addition/removal of vertices.

Nathann



---

archive/issue_events_205065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205065"
}
```



---

archive/issue_events_205066.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205066"
}
```



---

archive/issue_events_205067.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-10T15:59:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "title_is": "Improved is_triangle_free using bitfields",
    "title_was": "Improved is_triangle_free using bitfileds?",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205067"
}
```



---

archive/issue_events_205068.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205068"
}
```



---

archive/issue_events_205069.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205069"
}
```



---

archive/issue_events_205070.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205070"
}
```



---

archive/issue_events_205071.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205071"
}
```



---

archive/issue_events_205072.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205072"
}
```



---

archive/issue_events_205073.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205073"
}
```



---

archive/issue_comments_177242.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAnother proposal using `static_dense_graph` that is significantly faster than other methods.\n\n```\nsage: g = graphs.Grid2dGraph(20,20)\nsage: %time g.is_triangle_free(algorithm='dense_graph')\nCPU times: user 994 \u00b5s, sys: 50 \u00b5s, total: 1.04 ms\nWall time: 1.05 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='bitset')\nCPU times: user 70 ms, sys: 1.1 ms, total: 71.1 ms\nWall time: 70.6 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='matrix')\nCPU times: user 84.1 ms, sys: 2.45 ms, total: 86.6 ms\nWall time: 85.8 ms\nTrue\n```\n\n```\nsage: g = graphs.CompleteBipartiteGraph(200,200)\nsage: %time g.is_triangle_free(algorithm='dense_graph')\nCPU times: user 16.1 ms, sys: 140 \u00b5s, total: 16.2 ms\nWall time: 16.2 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='bitset')\nCPU times: user 102 ms, sys: 1.5 ms, total: 104 ms\nWall time: 103 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='matrix')\nCPU times: user 130 ms, sys: 11.6 ms, total: 141 ms\nWall time: 141 ms\nTrue\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be\"><code>7f90360</code></a></td><td><code>trac #14614: faster is_triangle_free using static_dense_graph</code></td></tr></table>\n",
    "created_at": "2019-09-22T12:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177242",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

Another proposal using `static_dense_graph` that is significantly faster than other methods.

```
sage: g = graphs.Grid2dGraph(20,20)
sage: %time g.is_triangle_free(algorithm='dense_graph')
CPU times: user 994 µs, sys: 50 µs, total: 1.04 ms
Wall time: 1.05 ms
True
sage: %time g.is_triangle_free(algorithm='bitset')
CPU times: user 70 ms, sys: 1.1 ms, total: 71.1 ms
Wall time: 70.6 ms
True
sage: %time g.is_triangle_free(algorithm='matrix')
CPU times: user 84.1 ms, sys: 2.45 ms, total: 86.6 ms
Wall time: 85.8 ms
True
```

```
sage: g = graphs.CompleteBipartiteGraph(200,200)
sage: %time g.is_triangle_free(algorithm='dense_graph')
CPU times: user 16.1 ms, sys: 140 µs, total: 16.2 ms
Wall time: 16.2 ms
True
sage: %time g.is_triangle_free(algorithm='bitset')
CPU times: user 102 ms, sys: 1.5 ms, total: 104 ms
Wall time: 103 ms
True
sage: %time g.is_triangle_free(algorithm='matrix')
CPU times: user 130 ms, sys: 11.6 ms, total: 141 ms
Wall time: 141 ms
True
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be"><code>7f90360</code></a></td><td><code>trac #14614: faster is_triangle_free using static_dense_graph</code></td></tr></table>




---

archive/issue_comments_177243.json:
```json
{
    "body": "Commit: **[`7f90360`](https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be)**",
    "created_at": "2019-09-22T12:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177243",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`7f90360`](https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be)**



---

archive/issue_events_205074.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-09-22T12:55:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205074"
}
```



---

archive/issue_comments_177244.json:
```json
{
    "body": "Branch: **[public/graphs/14614_is_triangle_free](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/14614_is_triangle_free)**",
    "created_at": "2019-09-22T12:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177244",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/graphs/14614_is_triangle_free](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/14614_is_triangle_free)**



---

archive/issue_events_205075.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-09-22T12:55:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205075"
}
```



---

archive/issue_events_205076.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2019-09-22T12:55:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "milestone_number": null,
    "milestone_title": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205076"
}
```



---

archive/issue_comments_177245.json:
```json
{
    "body": "Author: **David Coudert**",
    "created_at": "2019-09-22T12:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177245",
    "user": "https://github.com/dcoudert"
}
```

Author: **David Coudert**



---

archive/issue_comments_177246.json:
```json
{
    "body": "Changed commit from **[`7f90360`](https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be)** to **[`27e04f7`](https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6)**",
    "created_at": "2019-09-22T16:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177246",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7f90360`](https://github.com/sagemath/sagetrac-mirror/commit/7f903608febbeaff6bd5ba92b63eb49189fe54be)** to **[`27e04f7`](https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6)**



---

archive/issue_comments_177247.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6\"><code>27e04f7</code></a></td><td><code>trac #14614: return certificate</code></td></tr></table>\n",
    "created_at": "2019-09-22T16:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177247",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6"><code>27e04f7</code></a></td><td><code>trac #14614: return certificate</code></td></tr></table>




---

archive/issue_comments_177248.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAllow to return a certificate when `algorithm` is `dense_graph` or `bitset`, and improve method `bitset` (faster but still slower than `dense_graph`).\n\n```\nsage: g = graphs.Grid2dGraph(20,20)\nsage: %time g.is_triangle_free(algorithm='dense_graph')\nCPU times: user 903 \u00b5s, sys: 48 \u00b5s, total: 951 \u00b5s\nWall time: 955 \u00b5s\nTrue\nsage: %time g.is_triangle_free(algorithm='bitset')\nCPU times: user 2.17 ms, sys: 48 \u00b5s, total: 2.22 ms\nWall time: 2.23 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='matrix')\nCPU times: user 84.7 ms, sys: 5.37 ms, total: 90 ms\nWall time: 86.4 ms\nTrue\nsage: g = graphs.CompleteBipartiteGraph(200,200)\nsage: %time g.is_triangle_free(algorithm='dense_graph')\nCPU times: user 15.6 ms, sys: 178 \u00b5s, total: 15.8 ms\nWall time: 15.8 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='bitset')\nCPU times: user 51.6 ms, sys: 1.23 ms, total: 52.8 ms\nWall time: 52.2 ms\nTrue\nsage: %time g.is_triangle_free(algorithm='matrix')\nCPU times: user 131 ms, sys: 11.4 ms, total: 143 ms\nWall time: 142 ms\nTrue\n```",
    "created_at": "2019-09-22T16:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177248",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:17" align="right">comment:17</div>

Allow to return a certificate when `algorithm` is `dense_graph` or `bitset`, and improve method `bitset` (faster but still slower than `dense_graph`).

```
sage: g = graphs.Grid2dGraph(20,20)
sage: %time g.is_triangle_free(algorithm='dense_graph')
CPU times: user 903 µs, sys: 48 µs, total: 951 µs
Wall time: 955 µs
True
sage: %time g.is_triangle_free(algorithm='bitset')
CPU times: user 2.17 ms, sys: 48 µs, total: 2.22 ms
Wall time: 2.23 ms
True
sage: %time g.is_triangle_free(algorithm='matrix')
CPU times: user 84.7 ms, sys: 5.37 ms, total: 90 ms
Wall time: 86.4 ms
True
sage: g = graphs.CompleteBipartiteGraph(200,200)
sage: %time g.is_triangle_free(algorithm='dense_graph')
CPU times: user 15.6 ms, sys: 178 µs, total: 15.8 ms
Wall time: 15.8 ms
True
sage: %time g.is_triangle_free(algorithm='bitset')
CPU times: user 51.6 ms, sys: 1.23 ms, total: 52.8 ms
Wall time: 52.2 ms
True
sage: %time g.is_triangle_free(algorithm='matrix')
CPU times: user 131 ms, sys: 11.4 ms, total: 143 ms
Wall time: 142 ms
True
```



---

archive/issue_comments_177249.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nlooks good - I'm slightly concerned by warnings emitted by C compiler.",
    "created_at": "2019-09-22T23:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177249",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

looks good - I'm slightly concerned by warnings emitted by C compiler.



---

archive/issue_comments_177250.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI see 3 warnings when I compile without this branch, but I'm not sure where these warnings come from. How can I find them ? the messages are not so clear.",
    "created_at": "2019-09-23T07:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177250",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

I see 3 warnings when I compile without this branch, but I'm not sure where these warnings come from. How can I find them ? the messages are not so clear.



---

archive/issue_comments_177251.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nif you look at the C file in src/build/... mentioned there, they contain (in comments next to the C code lines) the cython code that it was obtained from.",
    "created_at": "2019-09-23T07:38:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177251",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

if you look at the C file in src/build/... mentioned there, they contain (in comments next to the C code lines) the cython code that it was obtained from.



---

archive/issue_comments_177252.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nthe following gets rid of one of them:\n\n```diff\n--- a/src/sage/data_structures/bitset.pxi\n+++ b/src/sage/data_structures/bitset.pxi\n@@ -426,13 +426,14 @@ cdef inline long bitset_first_in_complement(bitset_t a):\n     Calculate the index of the first element not in the set. If the set\n     is full, returns -1.\n     \"\"\"\n-    cdef mp_size_t i, j\n+    cdef mp_size_t i\n+    cdef mp_bitcnt_t j\n     for i from 0 <= i < a.limbs:\n         if ~a.bits[i]:\n             j = (i << index_shift) | _bitset_first_in_limb_nonzero(~a.bits[i])\n             if j >= a.size:\n-                j = -1\n-            return j\n+                return -1\n+            return <mp_size_t>j\n     return -1\n \n cdef inline long bitset_pop(bitset_t a) except -1:\n```\n\nShould I appy this and get rid of the remaining ones too?",
    "created_at": "2019-09-23T08:35:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177252",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

the following gets rid of one of them:

```diff
--- a/src/sage/data_structures/bitset.pxi
+++ b/src/sage/data_structures/bitset.pxi
@@ -426,13 +426,14 @@ cdef inline long bitset_first_in_complement(bitset_t a):
     Calculate the index of the first element not in the set. If the set
     is full, returns -1.
     """
-    cdef mp_size_t i, j
+    cdef mp_size_t i
+    cdef mp_bitcnt_t j
     for i from 0 <= i < a.limbs:
         if ~a.bits[i]:
             j = (i << index_shift) | _bitset_first_in_limb_nonzero(~a.bits[i])
             if j >= a.size:
-                j = -1
-            return j
+                return -1
+            return <mp_size_t>j
     return -1
 
 cdef inline long bitset_pop(bitset_t a) except -1:
```

Should I appy this and get rid of the remaining ones too?



---

archive/issue_comments_177253.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSure. Thank you.",
    "created_at": "2019-09-23T09:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177253",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

Sure. Thank you.



---

archive/issue_comments_177254.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c\"><code>302036c</code></a></td><td><code>correct signed/unsigned types in bitset.pxi</code></td></tr></table>\n",
    "created_at": "2019-09-23T09:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177254",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c"><code>302036c</code></a></td><td><code>correct signed/unsigned types in bitset.pxi</code></td></tr></table>




---

archive/issue_comments_177255.json:
```json
{
    "body": "Changed commit from **[`27e04f7`](https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6)** to **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**",
    "created_at": "2019-09-23T09:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177255",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`27e04f7`](https://github.com/sagemath/sagetrac-mirror/commit/27e04f7cd32a49395b8855aa00d31af711ec33b6)** to **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**



---

archive/issue_comments_177256.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOK, done. Does this supress these warnings on MacOS too?",
    "created_at": "2019-09-23T09:12:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177256",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

OK, done. Does this supress these warnings on MacOS too?



---

archive/issue_comments_177257.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYes, I don't see warnings anymore for `static_dense_graph`. However, among the 40 files that are compiled, I have warnings in 19 of them (many in graphs...). May be we should make a specific ticket ?",
    "created_at": "2019-09-23T09:27:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177257",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

Yes, I don't see warnings anymore for `static_dense_graph`. However, among the 40 files that are compiled, I have warnings in 19 of them (many in graphs...). May be we should make a specific ticket ?



---

archive/issue_comments_177258.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, let's do the rest elsewhere.",
    "created_at": "2019-09-23T10:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177258",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, let's do the rest elsewhere.



---

archive/issue_comments_177259.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-09-23T10:24:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177259",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_205077.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-09-23T10:24:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205077"
}
```



---

archive/issue_events_205078.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-09-23T10:24:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205078"
}
```



---

archive/issue_comments_177260.json:
```json
{
    "body": "Changed branch from **[public/graphs/14614_is_triangle_free](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/14614_is_triangle_free)** to **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**",
    "created_at": "2019-10-03T17:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14614#issuecomment-177260",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/14614_is_triangle_free](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/14614_is_triangle_free)** to **[`302036c`](https://github.com/sagemath/sagetrac-mirror/commit/302036c771bb0dd05ca797ad7933bd38fb22717c)**



---

archive/issue_events_205079.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-03T17:58:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205079"
}
```



---

archive/issue_events_205080.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5a2f2c87a2884c85c6d463422ae0b061add70de4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-10-03T17:58:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14614",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14614#event-205080"
}
```
