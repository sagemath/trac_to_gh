# Issue 14392: Domain error with tgammal when using FreeBSD

archive/issues_014188.json:
```json
{
    "assignees": [
        "https://github.com/peterjeremy"
    ],
    "body": "I tested sage-5.9.beta2 and got errors like this:\n\n```\n\"sage -t devel/sage/sage/plot/plot.py\"\n\n**********************************************************************\nFile \"devel/sage/sage/plot/plot.py\", line 942, in sage.plot.plot.plot\nFailed example:\n    plot(gamma, (-3, 4), detect_poles = True).show(ymin = -5, ymax = 5)\nExpected nothing\nGot:\n    <BLANKLINE>\n    tgammal domain error\n**********************************************************************\nFile \"devel/sage/sage/plot/plot.py\", line 946, in sage.plot.plot.plot\nFailed example:\n    plot(gamma, (-3, 4), detect_poles = 'show').show(ymin = -5, ymax = 5)\nExpected nothing\nGot:\n    <BLANKLINE>\n    tgammal domain error\n```\n\nThis is because FreeBSD uses the cephes math libraries.  These output error messages to stdout when they shouldn't.\n\nThe following patch removes all the print statements from files called mtherror.c in cephes.\n\n```\n--- cephes-2.8.p1/spkg-install-orig     2013-03-30 20:48:35.000000000 +0000\n+++ cephes-2.8.p1/spkg-install  2013-03-30 20:48:57.000000000 +0000\n@@ -24,6 +24,8 @@\n     fi\n done\n\n+sed -i .orig 's|.*printf|//&1|' */mtherr.c\n+\n echo \"Building Cephes...\"\n $MAKE\n if [ $? -ne 0 ]; then\n```\n\nCC:  @jpflori\n\nKeywords: **cephes, FreeBSD**\n\nComponent: **porting: BSD**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/14392_\n\n",
    "created_at": "2013-03-31T03:03:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20bsd",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Domain error with tgammal when using FreeBSD",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/14392",
    "user": "https://github.com/sagetrac-stephen"
}
```
I tested sage-5.9.beta2 and got errors like this:

```
"sage -t devel/sage/sage/plot/plot.py"

**********************************************************************
File "devel/sage/sage/plot/plot.py", line 942, in sage.plot.plot.plot
Failed example:
    plot(gamma, (-3, 4), detect_poles = True).show(ymin = -5, ymax = 5)
Expected nothing
Got:
    <BLANKLINE>
    tgammal domain error
**********************************************************************
File "devel/sage/sage/plot/plot.py", line 946, in sage.plot.plot.plot
Failed example:
    plot(gamma, (-3, 4), detect_poles = 'show').show(ymin = -5, ymax = 5)
Expected nothing
Got:
    <BLANKLINE>
    tgammal domain error
```

This is because FreeBSD uses the cephes math libraries.  These output error messages to stdout when they shouldn't.

The following patch removes all the print statements from files called mtherror.c in cephes.

```
--- cephes-2.8.p1/spkg-install-orig     2013-03-30 20:48:35.000000000 +0000
+++ cephes-2.8.p1/spkg-install  2013-03-30 20:48:57.000000000 +0000
@@ -24,6 +24,8 @@
     fi
 done

+sed -i .orig 's|.*printf|//&1|' */mtherr.c
+
 echo "Building Cephes..."
 $MAKE
 if [ $? -ne 0 ]; then
```

CC:  @jpflori

Keywords: **cephes, FreeBSD**

Component: **porting: BSD**

_Issue created by migration from https://trac.sagemath.org/ticket/14392_





---

archive/issue_events_204232.json:
```json
{
    "actor": "https://github.com/sagetrac-stephen",
    "created_at": "2013-03-31T03:03:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204232"
}
```



---

archive/issue_events_204233.json:
```json
{
    "actor": "https://github.com/sagetrac-stephen",
    "created_at": "2013-03-31T03:03:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20bsd",
    "label_color": "000080",
    "label_name": "c: porting: bsd",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204233"
}
```



---

archive/issue_events_204234.json:
```json
{
    "actor": "https://github.com/sagetrac-stephen",
    "created_at": "2013-03-31T03:03:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204234"
}
```



---

archive/issue_events_204235.json:
```json
{
    "actor": "https://github.com/sagetrac-stephen",
    "created_at": "2013-03-31T03:03:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204235"
}
```



---

archive/issue_events_204236.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2013-03-31T03:03:20Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "subject": "https://github.com/sagetrac-stephen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204236"
}
```



---

archive/issue_comments_173120.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI like this idea, but I'm not sure whether this is what we should do.   It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.",
    "created_at": "2013-04-02T01:53:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14392#issuecomment-173120",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

I like this idea, but I'm not sure whether this is what we should do.   It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.



---

archive/issue_comments_173121.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI don't mind using an explicit patch.  I was just trying to indicate where the error took place.\n\nIn some sense it is a bandaid fix.  But then the whole cephes library is a bandaid fix.",
    "created_at": "2013-04-02T02:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14392#issuecomment-173121",
    "user": "https://github.com/sagetrac-stephen"
}
```

<div id="comment:2" align="right">comment:2</div>

I don't mind using an explicit patch.  I was just trying to indicate where the error took place.

In some sense it is a bandaid fix.  But then the whole cephes library is a bandaid fix.



---

archive/issue_comments_173122.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nGreat, perhaps I will get around to making this patch sometime.  You are right about cephes, I suppose, but numerical issues are somewhat beyond my ken.",
    "created_at": "2013-04-02T02:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14392#issuecomment-173122",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Great, perhaps I will get around to making this patch sometime.  You are right about cephes, I suppose, but numerical issues are somewhat beyond my ken.



---

archive/issue_comments_173123.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@kcrisman](#comment:1):\n> It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.\n\nI agree. Document the `sed` script in `SPKG.txt`, but apply a patch in `spkg-install`.",
    "created_at": "2013-04-03T14:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14392#issuecomment-173123",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@kcrisman](#comment:1):
> It might be better to use a sed script as above to make the changes, then to create a patch we can apply based on that.

I agree. Document the `sed` script in `SPKG.txt`, but apply a patch in `spkg-install`.



---

archive/issue_events_204237.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204237"
}
```



---

archive/issue_events_204238.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204238"
}
```



---

archive/issue_events_204239.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204239"
}
```



---

archive/issue_events_204240.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204240"
}
```



---

archive/issue_events_204241.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204241"
}
```



---

archive/issue_events_204242.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204242"
}
```



---

archive/issue_events_204243.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204243"
}
```



---

archive/issue_events_204244.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204244"
}
```



---

archive/issue_events_204245.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14392",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14392#event-204245"
}
```
