# Issue 14694: Update SymPy to 0.7.3

archive/issues_014490.json:
```json
{
    "assignees": [],
    "body": "SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n\n**spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg\n\n**apply**: [attachment:trac14694_5.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/efdcb3d18bebd72e35cc35042539fd55.patch\u200b)\n\n**Assignee:** @jdemeyer\n\n**CC:**  @kiwifb\n\n**Reviewer:** Fran\u00e7ois Bissey, Jeroen Demeyer\n\n**Author:** Eviatar Bach\n\n**Merged:** sage-5.12.beta5\n\nIssue created by migration from https://trac.sagemath.org/ticket/14694\n\n",
    "closed_at": "2013-09-04T08:09:56Z",
    "created_at": "2013-06-06T01:04:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update SymPy to 0.7.3",
    "type": "issue",
    "updated_at": "2013-09-04T08:09:56Z",
    "url": "https://github.com/sagemath/sage/issues/14694",
    "user": "https://github.com/eviatarbach"
}
```
SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.

**spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg

**apply**: [attachment:trac14694_5.patch​](https://github.com/sagemath/sage/files/ticket14694/efdcb3d18bebd72e35cc35042539fd55.patch​)

**Assignee:** @jdemeyer

**CC:**  @kiwifb

**Reviewer:** François Bissey, Jeroen Demeyer

**Author:** Eviatar Bach

**Merged:** sage-5.12.beta5

Issue created by migration from https://trac.sagemath.org/ticket/14694





---

archive/issue_events_128340.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-07-14T21:11:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "rename": {
        "from": "Update SymPy to 0.7.2",
        "to": "Update SymPy to 0.7.3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128340"
}
```



---

archive/issue_comments_180956.json:
```json
{
    "body": "<a id='comment:2'></a>\nSymPy is now on version 0.7.3, so that's what the Sage version should be updated to.",
    "created_at": "2013-07-14T21:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180956",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:2'></a>
SymPy is now on version 0.7.3, so that's what the Sage version should be updated to.



---

archive/issue_comments_180957.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-SymPy 0.7.2 was released on October 16, 2012. The release notes are at https://github.com/sympy/sympy/wiki/Release-Notes-for-0.7.2.\n+SymPy 0.7.2 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n``````\n",
    "created_at": "2013-07-14T21:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180957",
    "user": "https://github.com/eviatarbach"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-SymPy 0.7.2 was released on October 16, 2012. The release notes are at https://github.com/sympy/sympy/wiki/Release-Notes-for-0.7.2.
+SymPy 0.7.2 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
``````




---

archive/issue_events_128341.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128341"
}
```



---

archive/issue_events_128342.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128342"
}
```



---

archive/issue_comments_180958.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-SymPy 0.7.2 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n+SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n``````\n",
    "created_at": "2013-08-17T00:45:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180958",
    "user": "https://github.com/eviatarbach"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-SymPy 0.7.2 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
+SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
``````




---

archive/issue_comments_180959.json:
```json
{
    "body": "<a id='comment:5'></a>\nI created the new SPKG, it's up at http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg.\n\nThe patch fixes the only doctest failure I could find.",
    "created_at": "2013-08-17T21:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180959",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:5'></a>
I created the new SPKG, it's up at http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg.

The patch fixes the only doctest failure I could find.



---

archive/issue_events_128343.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-08-17T21:16:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128343"
}
```



---

archive/issue_comments_180960.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes the pretty printing test. There was another one that was broken with 0.7.2 in sage-on-gentoo I will have to chase it to check it is gone away.",
    "created_at": "2013-08-17T21:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180960",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Yes the pretty printing test. There was another one that was broken with 0.7.2 in sage-on-gentoo I will have to chase it to check it is gone away.



---

archive/issue_comments_180961.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, I check on a vanilla 5.12.beta1 and there is one more doctest failure as with 0.7.2 on sage-on-gentoo:\n\n```\nsage -t --long devel/sage/sage/symbolic/constants.py\n**********************************************************************\nFile \"devel/sage/sage/symbolic/constants.py\", line 715, in sage.symbolic.constants.NotANumber._sympy_\nFailed example:\n    sympy.nan == NaN # indirect doctest\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.symbolic.constants.NotANumber._sympy_\n```\nThe other patch works fine. We may want to get upstream involved with that one.",
    "created_at": "2013-08-20T21:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180961",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
OK, I check on a vanilla 5.12.beta1 and there is one more doctest failure as with 0.7.2 on sage-on-gentoo:

```
sage -t --long devel/sage/sage/symbolic/constants.py
**********************************************************************
File "devel/sage/sage/symbolic/constants.py", line 715, in sage.symbolic.constants.NotANumber._sympy_
Failed example:
    sympy.nan == NaN # indirect doctest
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of   3 in sage.symbolic.constants.NotANumber._sympy_
```
The other patch works fine. We may want to get upstream involved with that one.



---

archive/issue_comments_180962.json:
```json
{
    "body": "<a id='comment:9'></a>\nOkay. Do you think we could still merge it though? I don't think users should be comparing SymPy and Sage objects too often anyway.",
    "created_at": "2013-08-21T00:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180962",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:9'></a>
Okay. Do you think we could still merge it though? I don't think users should be comparing SymPy and Sage objects too often anyway.



---

archive/issue_comments_180963.json:
```json
{
    "body": "<a id='comment:10'></a>\nSure but the doctest has to be fixed one way or another before we merge. I am not giving a positive review while there is a known doctest breakage.",
    "created_at": "2013-08-21T00:07:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180963",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Sure but the doctest has to be fixed one way or another before we merge. I am not giving a positive review while there is a known doctest breakage.



---

archive/issue_comments_180964.json:
```json
{
    "body": "<a id='comment:11'></a>\nYeah that's what I meant. Patch coming up.",
    "created_at": "2013-08-21T00:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180964",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:11'></a>
Yeah that's what I meant. Patch coming up.



---

archive/issue_comments_180965.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Attachment:** [trac14694_2.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_2.patch.gz)\n\nNew patch.",
    "created_at": "2013-08-21T00:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180965",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:12'></a>
**Attachment:** [trac14694_2.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_2.patch.gz)

New patch.



---

archive/issue_comments_180966.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2013-08-21T00:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180966",
    "user": "https://github.com/eviatarbach"
}
```

**Reviewer:** François Bissey



---

archive/issue_comments_180967.json:
```json
{
    "body": "**Author:** Eviatar Bach",
    "created_at": "2013-08-21T00:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180967",
    "user": "https://github.com/eviatarbach"
}
```

**Author:** Eviatar Bach



---

archive/issue_events_128344.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-08-22T21:32:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128344"
}
```



---

archive/issue_events_128345.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2013-08-22T21:32:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128345"
}
```



---

archive/issue_comments_180968.json:
```json
{
    "body": "<a id='comment:13'></a>\nNot sure what to do with the old doctest but it all passes now. LEt's try to make it for beta4.",
    "created_at": "2013-08-22T21:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180968",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Not sure what to do with the old doctest but it all passes now. LEt's try to make it for beta4.



---

archive/issue_comments_180969.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n+\n+**spkg**: [\u200bhttp://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg]\n``````\n",
    "created_at": "2013-08-23T06:16:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180969",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
+
+**spkg**: [​http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg]
``````




---

archive/issue_comments_180970.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n \n-**spkg**: [\u200bhttp://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg]\n+**spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg\n``````\n",
    "created_at": "2013-08-23T06:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180970",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
 
-**spkg**: [​http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg]
+**spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg
``````




---

archive/issue_comments_180971.json:
```json
{
    "body": "<a id='comment:16'></a>\nSorry forgot to also include the patch in the description. Only the last patch should be applied.",
    "created_at": "2013-08-23T06:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180971",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Sorry forgot to also include the patch in the description. Only the last patch should be applied.



---

archive/issue_comments_180972.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.\n \n **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg\n+\n+**apply**: [attachment:trac14694_2.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/b8750b0a0b5594276495773724babdb3.patch\u200b)\n``````\n",
    "created_at": "2013-08-23T06:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180972",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 SymPy 0.7.3 was released on July 13, 2013. The release notes are at https://github.com/sympy/sympy/wiki/release-notes-for-0.7.3.
 
 **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg
+
+**apply**: [attachment:trac14694_2.patch​](https://github.com/sagemath/sage/files/ticket14694/b8750b0a0b5594276495773724babdb3.patch​)
``````




---

archive/issue_comments_180973.json:
```json
{
    "body": "<a id='comment:18'></a>\n\n```\nsage -t devel/sage/sage/misc/displayhook.py\n**********************************************************************\nFile \"devel/sage/sage/misc/displayhook.py\", line 25, in sage.misc.displayhook\nFailed example:\n    shell.run_cell('integral(x^2/pi^x, x)')\nExpected:\n     / 2    2                      \\  -x*log(pi)\n    -\\x *log (pi) + 2*x*log(pi) + 2/*e\n    --------------------------------------------\n                         3\n                      log (pi)\nGot:\n     / 2    2                      \\  -x*log(pi) \n    -\\x *log (pi) + 2*x*log(pi) + 2/*e           \n    ---------------------------------------------\n                          3                      \n                       log (pi)                  \n**********************************************************************\n```\n\n```\nsage -t devel/sage/sage/misc/ascii_art.py\n**********************************************************************\nFile \"devel/sage/sage/misc/ascii_art.py\", line 807, in sage.misc.ascii_art.ascii_art\nFailed example:\n    ascii_art(sum(binomial(2*n,n+1)*x^n, n, 0, oo))\nExpected:\n     /        __________    \\\n    -\\2*x + \\/ -4*x + 1  - 1/\n    -------------------------\n               __________\n         2*x*\\/ -4*x + 1\nGot:\n     /        __________    \\ \n    -\\2*x + \\/ -4*x + 1  - 1/ \n    --------------------------\n               __________     \n         2*x*\\/ -4*x + 1      \n**********************************************************************\n```\n(note the number of hypens)\n\n```\nsage -t devel/sage/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"devel/sage/sage/symbolic/integration/integral.py\", line 474, in sage.symbolic.integration.integral.integrate\nFailed example:\n    (x^y-z).integrate(y,algorithm=\"sympy\")\nException raised:\n    Traceback (most recent call last):\n      File \"/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.symbolic.integration.integral.integrate[41]>\", line 1, in <module>\n        (x**y-z).integrate(y,algorithm=\"sympy\")\n      File \"expression.pyx\", line 9759, in sage.symbolic.expression.Expression.integral (sage/symbolic/expression.cpp:40828)\n      File \"/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py\", line 683, in integrate\n        return integrator(expression, v, a, b)\n      File \"/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py\", line 39, in sympy_integrator\n        return result._sage_()\n      File \"/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sympy/core/add.py\", line 721, in _sage_\n        s += x._sage_()\n    AttributeError: 'Piecewise' object has no attribute '_sage_'\n**********************************************************************\n```",
    "created_at": "2013-08-23T09:00:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180973",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>

```
sage -t devel/sage/sage/misc/displayhook.py
**********************************************************************
File "devel/sage/sage/misc/displayhook.py", line 25, in sage.misc.displayhook
Failed example:
    shell.run_cell('integral(x^2/pi^x, x)')
Expected:
     / 2    2                      \  -x*log(pi)
    -\x *log (pi) + 2*x*log(pi) + 2/*e
    --------------------------------------------
                         3
                      log (pi)
Got:
     / 2    2                      \  -x*log(pi) 
    -\x *log (pi) + 2*x*log(pi) + 2/*e           
    ---------------------------------------------
                          3                      
                       log (pi)                  
**********************************************************************
```

```
sage -t devel/sage/sage/misc/ascii_art.py
**********************************************************************
File "devel/sage/sage/misc/ascii_art.py", line 807, in sage.misc.ascii_art.ascii_art
Failed example:
    ascii_art(sum(binomial(2*n,n+1)*x^n, n, 0, oo))
Expected:
     /        __________    \
    -\2*x + \/ -4*x + 1  - 1/
    -------------------------
               __________
         2*x*\/ -4*x + 1
Got:
     /        __________    \ 
    -\2*x + \/ -4*x + 1  - 1/ 
    --------------------------
               __________     
         2*x*\/ -4*x + 1      
**********************************************************************
```
(note the number of hypens)

```
sage -t devel/sage/sage/symbolic/integration/integral.py
**********************************************************************
File "devel/sage/sage/symbolic/integration/integral.py", line 474, in sage.symbolic.integration.integral.integrate
Failed example:
    (x^y-z).integrate(y,algorithm="sympy")
Exception raised:
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.symbolic.integration.integral.integrate[41]>", line 1, in <module>
        (x**y-z).integrate(y,algorithm="sympy")
      File "expression.pyx", line 9759, in sage.symbolic.expression.Expression.integral (sage/symbolic/expression.cpp:40828)
      File "/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py", line 683, in integrate
        return integrator(expression, v, a, b)
      File "/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py", line 39, in sympy_integrator
        return result._sage_()
      File "/mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sympy/core/add.py", line 721, in _sage_
        s += x._sage_()
    AttributeError: 'Piecewise' object has no attribute '_sage_'
**********************************************************************
```



---

archive/issue_events_128346.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-23T09:00:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128346"
}
```



---

archive/issue_events_128347.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-23T09:00:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128347"
}
```



---

archive/issue_comments_180974.json:
```json
{
    "body": "<a id='comment:19'></a>\nHum. I assumed the new patch was correct for the first one on the basis that it was correct in the first version. Not sure how the second one escaped unless eviatarbach used 5.10, it is also specifc to 0.7.3, 0.7.2 just works. The last one is also showing a difference between 0.7.2 and 0.7.3.",
    "created_at": "2013-08-23T10:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180974",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Hum. I assumed the new patch was correct for the first one on the basis that it was correct in the first version. Not sure how the second one escaped unless eviatarbach used 5.10, it is also specifc to 0.7.3, 0.7.2 just works. The last one is also showing a difference between 0.7.2 and 0.7.3.



---

archive/issue_comments_180975.json:
```json
{
    "body": "<a id='comment:20'></a>\nSorry, I should have run `testall`. New patch fixes all the tests that were failing.",
    "created_at": "2013-08-24T15:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180975",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:20'></a>
Sorry, I should have run `testall`. New patch fixes all the tests that were failing.



---

archive/issue_events_128348.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-08-24T15:31:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128348"
}
```



---

archive/issue_events_128349.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-08-24T15:31:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128349"
}
```



---

archive/issue_comments_180976.json:
```json
{
    "body": "**Attachment:** [trac14694_3.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_3.patch.gz)",
    "created_at": "2013-08-24T15:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180976",
    "user": "https://github.com/eviatarbach"
}
```

**Attachment:** [trac14694_3.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_3.patch.gz)



---

archive/issue_comments_180977.json:
```json
{
    "body": "**Attachment:** [trac14694_3.2.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_3.2.patch.gz)",
    "created_at": "2013-08-24T15:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180977",
    "user": "https://github.com/eviatarbach"
}
```

**Attachment:** [trac14694_3.2.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_3.2.patch.gz)



---

archive/issue_comments_180978.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg\n \n-**apply**: [attachment:trac14694_2.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/b8750b0a0b5594276495773724babdb3.patch\u200b)\n+**apply**: [attachment:trac14694_3.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/665f53a4b53064fd2b4aa9e522f5cc7b.patch\u200b)\n``````\n",
    "created_at": "2013-08-24T15:33:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180978",
    "user": "https://github.com/eviatarbach"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg
 
-**apply**: [attachment:trac14694_2.patch​](https://github.com/sagemath/sage/files/ticket14694/b8750b0a0b5594276495773724babdb3.patch​)
+**apply**: [attachment:trac14694_3.patch​](https://github.com/sagemath/sage/files/ticket14694/665f53a4b53064fd2b4aa9e522f5cc7b.patch​)
``````




---

archive/issue_events_128350.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-26T06:37:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128350"
}
```



---

archive/issue_events_128351.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-26T06:37:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128351"
}
```



---

archive/issue_comments_180979.json:
```json
{
    "body": "<a id='comment:22'></a>\nWhy did you change\n\n```\n(x^y-z).integrate(y,algorithm=\"sympy\")\n```\nto\n\n```\n(x*y-z).integrate(y,algorithm=\"sympy\")\n```\nOne needs a good reason to remove doctests.",
    "created_at": "2013-08-26T06:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180979",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Why did you change

```
(x^y-z).integrate(y,algorithm="sympy")
```
to

```
(x*y-z).integrate(y,algorithm="sympy")
```
One needs a good reason to remove doctests.



---

archive/issue_comments_180980.json:
```json
{
    "body": "<a id='comment:23'></a>\nBecause now SymPy returns a `Piecewise` object for that integral, which can't be converted back to Sage. Making the conversion work would actually require a change in SymPy, since currently we look for the `_sage_` method in SymPy objects, which isn't defined for `Piecewise`.\n\nI couldn't think of anything else to do except modifying the doctest, at least until the conversions are fixed upstream. What do you suggest?",
    "created_at": "2013-08-26T16:00:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180980",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:23'></a>
Because now SymPy returns a `Piecewise` object for that integral, which can't be converted back to Sage. Making the conversion work would actually require a change in SymPy, since currently we look for the `_sage_` method in SymPy objects, which isn't defined for `Piecewise`.

I couldn't think of anything else to do except modifying the doctest, at least until the conversions are fixed upstream. What do you suggest?



---

archive/issue_comments_180981.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@eviatarbach](#comment%3A23):\n> I couldn't think of anything else to do except modifying the doctest, at least until the conversions are fixed upstream. What do you suggest?\n\nAt least, mark the existing doctest `# known bug`.",
    "created_at": "2013-08-26T17:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180981",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [@eviatarbach](#comment%3A23):
> I couldn't think of anything else to do except modifying the doctest, at least until the conversions are fixed upstream. What do you suggest?

At least, mark the existing doctest `# known bug`.



---

archive/issue_comments_180982.json:
```json
{
    "body": "<a id='comment:25'></a>\nI would catch instead of changing it so we can know when it is fixed. In any case I will contact sympy upstream shortly about it.",
    "created_at": "2013-08-26T19:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180982",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
I would catch instead of changing it so we can know when it is fixed. In any case I will contact sympy upstream shortly about it.



---

archive/issue_comments_180983.json:
```json
{
    "body": "<a id='comment:26'></a>\nSee Aaron interesting answer at [https://groups.google.com/forum/#!topic/sympy/VRNKUeJATNs](https://groups.google.com/forum/#!topic/sympy/VRNKUeJATNs)",
    "created_at": "2013-08-26T23:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180983",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>
See Aaron interesting answer at [https://groups.google.com/forum/#!topic/sympy/VRNKUeJATNs](https://groups.google.com/forum/#!topic/sympy/VRNKUeJATNs)



---

archive/issue_comments_180984.json:
```json
{
    "body": "<a id='comment:27'></a>\nI might repeat my request here for people to help out adding `_sage_` methods to unsupported objects in SymPy. The number of SymPy users who know the corresponding Sage methods is rather low, unfortunately. But SymPy currently has a lot of special functions and special objects like Piecewise which won't convert directly (even for the special functions, a direct name conversion might not work because of convention differences).",
    "created_at": "2013-08-27T00:54:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180984",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<a id='comment:27'></a>
I might repeat my request here for people to help out adding `_sage_` methods to unsupported objects in SymPy. The number of SymPy users who know the corresponding Sage methods is rather low, unfortunately. But SymPy currently has a lot of special functions and special objects like Piecewise which won't convert directly (even for the special functions, a direct name conversion might not work because of convention differences).



---

archive/issue_comments_180985.json:
```json
{
    "body": "<a id='comment:28'></a>\nAlso, feel free to CC me on any SymPy related issue in this issue tracker.",
    "created_at": "2013-08-27T01:00:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180985",
    "user": "https://github.com/sagetrac-asmeurer"
}
```

<a id='comment:28'></a>
Also, feel free to CC me on any SymPy related issue in this issue tracker.



---

archive/issue_comments_180986.json:
```json
{
    "body": "**Attachment:** [trac14694_4.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_4.patch.gz)",
    "created_at": "2013-08-27T15:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180986",
    "user": "https://github.com/eviatarbach"
}
```

**Attachment:** [trac14694_4.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_4.patch.gz)



---

archive/issue_comments_180987.json:
```json
{
    "body": "<a id='comment:29'></a>\nThank you Aaron, I will see if I can submit a pull request adding `_sage_` methods. It would be good for SymPy and Sage to interface better to each other.\n\nNew patch added. How does this one look?",
    "created_at": "2013-08-27T15:51:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180987",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:29'></a>
Thank you Aaron, I will see if I can submit a pull request adding `_sage_` methods. It would be good for SymPy and Sage to interface better to each other.

New patch added. How does this one look?



---

archive/issue_events_128352.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-08-27T15:51:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128352"
}
```



---

archive/issue_events_128353.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-08-27T15:51:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128353"
}
```



---

archive/issue_comments_180988.json:
```json
{
    "body": "<a id='comment:30'></a>\nWhen marking a test `# known bug`, you should add the doctest result what you **want** to get, not what you actually get. In other words, just add `# known bug` without changing the result of the test.",
    "created_at": "2013-08-28T07:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180988",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
When marking a test `# known bug`, you should add the doctest result what you **want** to get, not what you actually get. In other words, just add `# known bug` without changing the result of the test.



---

archive/issue_comments_180989.json:
```json
{
    "body": "<a id='comment:31'></a>\nOkay. I removed the `# known bug` then, since now SymPy returns a piecewise function and `-y*z + x^y/log(x)` is no longer the \"expected\" output. How SymPy's Piecewise is converted to Sage's piecewise is left to be implemented, so it's not clear exactly what the expected output will be.",
    "created_at": "2013-08-28T17:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180989",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:31'></a>
Okay. I removed the `# known bug` then, since now SymPy returns a piecewise function and `-y*z + x^y/log(x)` is no longer the "expected" output. How SymPy's Piecewise is converted to Sage's piecewise is left to be implemented, so it's not clear exactly what the expected output will be.



---

archive/issue_comments_180990.json:
```json
{
    "body": "**Attachment:** [trac14694_5.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_5.patch.gz)",
    "created_at": "2013-08-28T17:04:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180990",
    "user": "https://github.com/eviatarbach"
}
```

**Attachment:** [trac14694_5.patch.gz](https://github.com/sagemath/sage/files/ticket14694/trac14694_5.patch.gz)



---

archive/issue_comments_180991.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg\n \n-**apply**: [attachment:trac14694_3.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/665f53a4b53064fd2b4aa9e522f5cc7b.patch\u200b)\n+**apply**: [attachment:trac14694_5.patch\u200b](https://github.com/sagemath/sage/files/ticket14694/efdcb3d18bebd72e35cc35042539fd55.patch\u200b)\n``````\n",
    "created_at": "2013-08-28T17:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180991",
    "user": "https://github.com/eviatarbach"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 **spkg**: http://www.phas.ubc.ca/~eviatarb/sympy-0.7.3.spkg
 
-**apply**: [attachment:trac14694_3.patch​](https://github.com/sagemath/sage/files/ticket14694/665f53a4b53064fd2b4aa9e522f5cc7b.patch​)
+**apply**: [attachment:trac14694_5.patch​](https://github.com/sagemath/sage/files/ticket14694/efdcb3d18bebd72e35cc35042539fd55.patch​)
``````




---

archive/issue_events_128354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-04T08:09:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128354"
}
```



---

archive/issue_events_128355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-04T08:09:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14694#event-128355"
}
```



---

archive/issue_comments_180992.json:
```json
{
    "body": "**Changing reviewer** from \"Fran\u00e7ois Bissey\" to \"Fran\u00e7ois Bissey, Jeroen Demeyer\".",
    "created_at": "2013-09-04T08:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180992",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "François Bissey" to "François Bissey, Jeroen Demeyer".



---

archive/issue_comments_180993.json:
```json
{
    "body": "**Merged:** sage-5.12.beta5",
    "created_at": "2013-09-04T08:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14694#issuecomment-180993",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.12.beta5
