# Issue 14453: libGAP error handling bug

archive/issues_014249.json:
```json
{
    "body": "The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).\n\n**Assignee:** @williamstein\n\n**CC:**  @vbraun\n\n**Reviewer:** Volker Braun\n\n**Author:** Jeroen Demeyer\n\n**Merged:** sage-5.10.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/14453\n\n",
    "closed_at": "2013-04-23T09:44:17Z",
    "created_at": "2013-04-15T13:54:04Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "libGAP error handling bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14453",
    "user": "https://github.com/jdemeyer"
}
```
The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).

**Assignee:** @williamstein

**CC:**  @vbraun

**Reviewer:** Volker Braun

**Author:** Jeroen Demeyer

**Merged:** sage-5.10.beta0

Issue created by migration from https://trac.sagemath.org/ticket/14453





---

archive/attachments_019503.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sage_crash_ihsJs4.log",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14453/sage_crash_ihsJs4.log",
    "created_at": "2013-04-15T14:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.log",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_176521.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2013-04-15T14:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176521",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>




---

archive/issue_comments_176522.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.\n+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block: [attachment:sage_crash_ihsJs4.log].\n``````\n",
    "created_at": "2013-04-15T14:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176522",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.
+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block: [attachment:sage_crash_ihsJs4.log].
``````




---

archive/issue_comments_176523.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,10 @@\n-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block: [attachment:sage_crash_ihsJs4.log].\n+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.\n+\n+Running the doctest\n+\n+```\n+sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##\n+sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##\n+sage: F1 == F2 ## line 429 ##\n+```\n+yields [attachment:sage_crash_ihsJs4.log].\n``````\n",
    "created_at": "2013-04-15T14:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176523",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,10 @@
-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block: [attachment:sage_crash_ihsJs4.log].
+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.
+
+Running the doctest
+
+```
+sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##
+sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##
+sage: F1 == F2 ## line 429 ##
+```
+yields [attachment:sage_crash_ihsJs4.log].
``````




---

archive/issue_comments_176524.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks like a GCC compiler bug (GCC-4.8.0).",
    "created_at": "2013-04-15T22:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176524",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Looks like a GCC compiler bug (GCC-4.8.0).



---

archive/issue_comments_176525.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.\n+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.\n \n-Running the doctest\n+Unfortunately, doing this replacement shows that in the following doctest, `error_handler()` is called outside a `sig_on()` block.\n \n ```\n sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##\n sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##\n sage: F1 == F2 ## line 429 ##\n ```\n-yields [attachment:sage_crash_ihsJs4.log].\n+This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC.\n``````\n",
    "created_at": "2013-04-16T06:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176525",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Doing this replacement shows that currently, a bug is masked where `error_handler()` is called outside a `sig_on()` block.
+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.
 
-Running the doctest
+Unfortunately, doing this replacement shows that in the following doctest, `error_handler()` is called outside a `sig_on()` block.
 
 ```
 sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##
 sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##
 sage: F1 == F2 ## line 429 ##
 ```
-yields [attachment:sage_crash_ihsJs4.log].
+This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC.
``````




---

archive/issue_comments_176526.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##\n sage: F1 == F2 ## line 429 ##\n ```\n-This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC.\n+This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC 4.8.0.\n``````\n",
    "created_at": "2013-04-16T06:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176526",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##
 sage: F1 == F2 ## line 429 ##
 ```
-This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC.
+This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC 4.8.0.
``````




---

archive/issue_comments_176527.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,3 @@\n The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.\n \n-Unfortunately, doing this replacement shows that in the following doctest, `error_handler()` is called outside a `sig_on()` block.\n-\n-```\n-sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##\n-sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##\n-sage: F1 == F2 ## line 429 ##\n-```\n-This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC 4.8.0.\n+Unfortunately, this exposes a bug in GCC-4.8.0: #14460.\n``````\n",
    "created_at": "2013-04-16T14:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176527",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,3 @@
 The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.
 
-Unfortunately, doing this replacement shows that in the following doctest, `error_handler()` is called outside a `sig_on()` block.
-
-```
-sage: F1 = libgap.FreeGroup(['a']) ## line 427 ##
-sage: F2 = libgap.FreeGroup(['a']) ## line 428 ##
-sage: F1 == F2 ## line 429 ##
-```
-This yields [attachment:sage_crash_ihsJs4.log] but it might actually be a bug in GCC 4.8.0.
+Unfortunately, this exposes a bug in GCC-4.8.0: #14460.
``````




---

archive/issue_comments_176528.json:
```json
{
    "body": "<a id='comment:7'></a>\nThanks for debugging this! Should we still treat this as critical or maybe just wait until gcc-4.8.1 is out?",
    "created_at": "2013-04-16T15:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176528",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
Thanks for debugging this! Should we still treat this as critical or maybe just wait until gcc-4.8.1 is out?



---

archive/issue_comments_176529.json:
```json
{
    "body": "<a id='comment:8'></a>\nIndependently of the GCC issue, there still is a segmentation fault with Cython-0.19b2. Perhaps we should also fix that here.",
    "created_at": "2013-04-16T16:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176529",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Independently of the GCC issue, there still is a segmentation fault with Cython-0.19b2. Perhaps we should also fix that here.



---

archive/issue_comments_176530.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.\n+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).\n \n-Unfortunately, this exposes a bug in GCC-4.8.0: #14460.\n+With Cython-0.19b2, there are segmentation faults in libGAP.\n``````\n",
    "created_at": "2013-04-16T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176530",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`.
+The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).
 
-Unfortunately, this exposes a bug in GCC-4.8.0: #14460.
+With Cython-0.19b2, there are segmentation faults in libGAP.
``````




---

archive/issue_comments_176531.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe Cython segfault also looks like an upstream (Cython-0.19b2) problem.  So libGAP does a good job of testing various upstream projects :-)",
    "created_at": "2013-04-16T17:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
The Cython segfault also looks like an upstream (Cython-0.19b2) problem.  So libGAP does a good job of testing various upstream projects :-)



---

archive/issue_comments_176532.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).\n-\n-With Cython-0.19b2, there are segmentation faults in libGAP.\n``````\n",
    "created_at": "2013-04-16T18:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176532",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1 @@
 The libGAP error handler (`error_handler()`) in `sage/libs/gap/util.pyx` should use `set_sage_signal_handler_message()` instead of `sig_str()`. Unfortunately, this exposes a bug in GCC-4.8.0: #14460 (work-around: compile with `-fno-tree-dominator-opts`).
-
-With Cython-0.19b2, there are segmentation faults in libGAP.
``````




---

archive/issue_events_125613.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125613"
}
```



---

archive/issue_comments_176533.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2013-04-16T18:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176533",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_176534.json:
```json
{
    "body": "<a id='comment:11'></a>\nModulo upstream issues, this patch should be fine and can be applied.",
    "created_at": "2013-04-16T18:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176534",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Modulo upstream issues, this patch should be fine and can be applied.



---

archive/attachments_019504.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "14453_libgap.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket14453/14453_libgap.patch",
    "created_at": "2013-04-16T18:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_176535.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe critical bug is #14460.",
    "created_at": "2013-04-16T18:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176535",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
The critical bug is #14460.



---

archive/issue_events_125614.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125614"
}
```



---

archive/issue_events_125615.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-16T18:34:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125615"
}
```



---

archive/issue_comments_176536.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2013-04-16T21:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176536",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_176537.json:
```json
{
    "body": "<a id='comment:13'></a>\nLooks good to me.",
    "created_at": "2013-04-16T21:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176537",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
Looks good to me.



---

archive/issue_events_125616.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-04-16T21:53:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125616"
}
```



---

archive/issue_events_125617.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-04-16T21:53:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125617"
}
```



---

archive/issue_events_125618.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T09:44:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125618"
}
```



---

archive/issue_events_125619.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-23T09:44:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14453#event-125619"
}
```



---

archive/issue_comments_176538.json:
```json
{
    "body": "**Merged:** sage-5.10.beta0",
    "created_at": "2013-04-23T09:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14453#issuecomment-176538",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.10.beta0
