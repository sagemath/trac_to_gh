# Issue 14149: Creation of temporary files with %attach

archive/issues_013945.json:
```json
{
    "body": "Using sage-5.7.beta4 and sage-5.7.rc0, when attaching a .sage file, sage creates spurious files in the current directory. For example\n\n```\nsage: %attach blah.sage\n```\ncreates blah.sageYPVh in the current directory.\n\n**Assignee:** @williamstein\n\n**CC:**  @ppurka tmonteil @hughrthomas okazymyrov\n\n**Reviewer:** Volker Braun\n\n**Dependencies:** #14523\n\nIssue created by migration from https://trac.sagemath.org/ticket/14149\n\n",
    "closed_at": "2013-08-13T08:31:22Z",
    "created_at": "2013-02-20T00:40:43Z",
    "labels": [
        "component: user interface",
        "critical",
        "bug",
        "duplicate"
    ],
    "title": "Creation of temporary files with %attach",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14149",
    "user": "https://github.com/anneschilling"
}
```
Using sage-5.7.beta4 and sage-5.7.rc0, when attaching a .sage file, sage creates spurious files in the current directory. For example

```
sage: %attach blah.sage
```
creates blah.sageYPVh in the current directory.

**Assignee:** @williamstein

**CC:**  @ppurka tmonteil @hughrthomas okazymyrov

**Reviewer:** Volker Braun

**Dependencies:** #14523

Issue created by migration from https://trac.sagemath.org/ticket/14149





---

archive/issue_comments_172531.json:
```json
{
    "body": "<a id='comment:1'></a>\nSee also #14169.",
    "created_at": "2013-02-24T02:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172531",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
See also #14169.



---

archive/issue_events_124655.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-24T02:11:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "component: user interface",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124655"
}
```



---

archive/issue_comments_172532.json:
```json
{
    "body": "**Assignee:** @williamstein",
    "created_at": "2013-02-24T02:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172532",
    "user": "https://github.com/kcrisman"
}
```

**Assignee:** @williamstein



---

archive/issue_events_124656.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-24T02:11:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124656"
}
```



---

archive/issue_events_124657.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-24T02:11:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124657"
}
```



---

archive/issue_comments_172533.json:
```json
{
    "body": "<a id='comment:3'></a>\nBump.\n\nIt seems like it should be possible to create these temporary files in ~/.sage or something similar.  Where is the code for %attach kept?  I could possibly start poking around.",
    "created_at": "2013-03-22T09:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172533",
    "user": "https://github.com/sdenton4"
}
```

<a id='comment:3'></a>
Bump.

It seems like it should be possible to create these temporary files in ~/.sage or something similar.  Where is the code for %attach kept?  I could possibly start poking around.



---

archive/issue_events_124658.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T18:18:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124658"
}
```



---

archive/issue_comments_172534.json:
```json
{
    "body": "<a id='comment:8'></a>\nFixed in #14523",
    "created_at": "2013-05-12T18:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172534",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Fixed in #14523



---

archive/issue_comments_172535.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2013-05-12T18:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172535",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_events_124659.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T18:18:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124659"
}
```



---

archive/issue_events_124660.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T18:18:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124660"
}
```



---

archive/issue_comments_172536.json:
```json
{
    "body": "<a id='comment:9'></a>\n`@`Volker: Could you explain where the code was that was producing these funny file names?  I'm happy that it's fixed in #14523 (thank you!) but I don't see where it gets fixed.  Sorry if the question seems like a waste of time -- I spent a fair while trying to figure out where this was happening, and I couldn't find it.  Thanks!",
    "created_at": "2013-05-12T19:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172536",
    "user": "https://github.com/hughrthomas"
}
```

<a id='comment:9'></a>
`@`Volker: Could you explain where the code was that was producing these funny file names?  I'm happy that it's fixed in #14523 (thank you!) but I don't see where it gets fixed.  Sorry if the question seems like a waste of time -- I spent a fair while trying to figure out where this was happening, and I couldn't find it.  Thanks!



---

archive/issue_comments_172537.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe attach debug mode is off by default now (see `load_attach_mode?`).",
    "created_at": "2013-05-12T20:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172537",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
The attach debug mode is off by default now (see `load_attach_mode?`).



---

archive/issue_comments_172538.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [vbraun](#comment%3A10):\n> The attach debug mode is off by default now (see `load_attach_mode?`).\n\n\nI completely disagree with this fix. See [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4) and #11812.",
    "created_at": "2013-05-13T05:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172538",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:11'></a>
Replying to [vbraun](#comment%3A10):
> The attach debug mode is off by default now (see `load_attach_mode?`).


I completely disagree with this fix. See [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4) and #11812.



---

archive/issue_events_124661.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124661"
}
```



---

archive/issue_events_124662.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124662"
}
```



---

archive/issue_comments_172539.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mstreng](#comment%3A11):\n> I completely disagree with this fix.\n\n\nIn fact, I would just switch \"debug mode\" back on in my startup file, but I would still want to get rid of the temporary files, so I would not call this a fix at all.\n\nHow about doing all of the following?\n* put temporary files in one subfolder (to keep the main folder as clean as possible)\n* remove or overwrite old temporary files when reloading attached files (to keep the folder with temporary files as clean as possible)\n* remove temporary files when exiting sage (obviously)\n\nThat only leaves one temporary file for each .sage file. It is there only during the Sage session. It remains afterwards only when Sage exits incorrectly, and it is in a subdirectory, so can be removed easily.",
    "created_at": "2013-05-13T07:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172539",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:12'></a>
Replying to [mstreng](#comment%3A11):
> I completely disagree with this fix.


In fact, I would just switch "debug mode" back on in my startup file, but I would still want to get rid of the temporary files, so I would not call this a fix at all.

How about doing all of the following?
* put temporary files in one subfolder (to keep the main folder as clean as possible)
* remove or overwrite old temporary files when reloading attached files (to keep the folder with temporary files as clean as possible)
* remove temporary files when exiting sage (obviously)

That only leaves one temporary file for each .sage file. It is there only during the Sage session. It remains afterwards only when Sage exits incorrectly, and it is in a subdirectory, so can be removed easily.



---

archive/issue_events_124663.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124663"
}
```



---

archive/issue_events_124664.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124664"
}
```



---

archive/issue_comments_172540.json:
```json
{
    "body": "<a id='comment:13'></a>\nIf that is the desired outcome then it would have been nice to doctest it.\n\nLittering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.\n\nStill, the correct fix is to make execution of in-memory code produce correct tracebacks.",
    "created_at": "2013-05-13T09:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172540",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>
If that is the desired outcome then it would have been nice to doctest it.

Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.

Still, the correct fix is to make execution of in-memory code produce correct tracebacks.



---

archive/issue_comments_172541.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [vbraun](#comment%3A13):\n> If that is the desired outcome then it would have been nice to doctest it.\n\n\n\nI tried to doctest tracebacks, but could not find a way (see #11812).\n\n\n> Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.\n\n\n\nOriginally (before #7514 and again at #11812), temp directories *were* used for the preparsed .py files. The location changed later. I don't know when or why; maybe at #13579 because of security problems?\n\n\n> Still, the correct fix is to make execution of in-memory code produce correct tracebacks. \n\n\n\nYes, that would be best. Much better than my solution above, and much better than what was done at #11812. But how? I would like to see the name of the .sage file, and multi-line code snippets including line numbers.",
    "created_at": "2013-05-13T10:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172541",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:14'></a>
Replying to [vbraun](#comment%3A13):
> If that is the desired outcome then it would have been nice to doctest it.



I tried to doctest tracebacks, but could not find a way (see #11812).


> Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.



Originally (before #7514 and again at #11812), temp directories *were* used for the preparsed .py files. The location changed later. I don't know when or why; maybe at #13579 because of security problems?


> Still, the correct fix is to make execution of in-memory code produce correct tracebacks. 



Yes, that would be best. Much better than my solution above, and much better than what was done at #11812. But how? I would like to see the name of the .sage file, and multi-line code snippets including line numbers.



---

archive/issue_comments_172542.json:
```json
{
    "body": "<a id='comment:15'></a>\nI've added a doctest for the desired behavior in #14523 (traceback showing source)",
    "created_at": "2013-05-13T19:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172542",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
I've added a doctest for the desired behavior in #14523 (traceback showing source)



---

archive/issue_events_124665.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-13T19:35:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124665"
}
```



---

archive/issue_events_124666.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-13T19:35:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124666"
}
```



---

archive/issue_comments_172543.json:
```json
{
    "body": "<a id='comment:16'></a>\nAnybody who doesn't like temporary files littering the fs feel like reviewing this ticket?",
    "created_at": "2013-06-08T18:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172543",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
Anybody who doesn't like temporary files littering the fs feel like reviewing this ticket?



---

archive/issue_comments_172544.json:
```json
{
    "body": "<a id='comment:17'></a>\nThere are no attachments. What exactly are we supposed to review?",
    "created_at": "2013-06-08T20:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172544",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
There are no attachments. What exactly are we supposed to review?



---

archive/issue_events_124667.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-08T21:07:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124667"
}
```



---

archive/issue_events_124668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-08T21:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124668"
}
```



---

archive/issue_comments_172545.json:
```json
{
    "body": "<a id='comment:18'></a>\nOops, posted this in the wrong ticket. I meant #14523. This ticket should be closed as duplicate, I think.",
    "created_at": "2013-06-08T21:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172545",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
Oops, posted this in the wrong ticket. I meant #14523. This ticket should be closed as duplicate, I think.



---

archive/issue_comments_172546.json:
```json
{
    "body": "<a id='comment:19'></a>\n#14523 does fix creating the temp files.",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172546",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
#14523 does fix creating the temp files.



---

archive/issue_comments_172547.json:
```json
{
    "body": "**Changing author** from \"Volker Braun\" to \"\".",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172547",
    "user": "https://github.com/tscrim"
}
```

**Changing author** from "Volker Braun" to "".



---

archive/issue_comments_172548.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172548",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_172549.json:
```json
{
    "body": "**Dependencies:** #14523",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14149#issuecomment-172549",
    "user": "https://github.com/tscrim"
}
```

**Dependencies:** #14523



---

archive/issue_events_124669.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-12T15:45:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124669"
}
```



---

archive/issue_events_124670.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-06-12T15:45:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124670"
}
```



---

archive/issue_events_124671.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T08:31:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "duplicate",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124671"
}
```



---

archive/issue_events_124672.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T08:31:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124672"
}
```



---

archive/issue_events_124673.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T08:31:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14149",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14149#event-124673"
}
```
