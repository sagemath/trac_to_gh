# Issue 14371: Race condition in singular doctest

archive/issues_014167.json:
```json
{
    "assignees": [],
    "body": "On hawk (OpenSolaris), after applying [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch) to get a useful traceback:\n\n```\nsage -t devel/sage/sage/interfaces/expect.py\n**********************************************************************\nFile \"devel/sage/sage/interfaces/expect.py\", line 1089, in sage.interfaces.expect.Expect._crash_msg\nFailed example:\n    singular('2+3')\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n        exec compiled in globs\n      File \"<doctest sage.interfaces.expect.Expect._crash_msg[4]>\", line 1, in <module>\n        singular('2+3')\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 724, in __call__\n        return SingularElement(self, type, x, False)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1184, in __init__\n        self._name = parent._create( value, type)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 685, in _create\n        self.set(type, name, value)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 626, in set\n        out = self.eval(cmd)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 580, in eval\n        s = Expect.eval(self, x, **kwds)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1197, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 818, in _eval_line\n        E.sendline(line)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py\", line 677, in sendline\n        n = n + self.send (os.linesep)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py\", line 669, in send\n        c = os.write(self.child_fd, str)\n    TypeError: [Errno 22] Invalid argument\n    Error evaluating def sage51=2+3; in Singular\n**********************************************************************\n```\n\n**Apply** [and [attachment:14371_sleep_isalive_alt.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d15ac86bd149de0f4c0850be6fc89dc8.patch))\n\n**Assignee:** mvngu\n\n**CC:**  jpflori\n\n**Reviewer:** Volker Braun, Jeroen Demeyer\n\n**Author:** Jeroen Demeyer, Volker Braun\n\n**Merged:** sage-5.9.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/14371\n\n",
    "closed_at": "2013-04-25T12:56:43Z",
    "created_at": "2013-03-27T22:40:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
        "https://github.com/sagemath/sage/labels/blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Race condition in singular doctest",
    "type": "issue",
    "updated_at": "2013-04-25T12:56:43Z",
    "url": "https://github.com/sagemath/sage/issues/14371",
    "user": "https://github.com/jdemeyer"
}
```
On hawk (OpenSolaris), after applying [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch) to get a useful traceback:

```
sage -t devel/sage/sage/interfaces/expect.py
**********************************************************************
File "devel/sage/sage/interfaces/expect.py", line 1089, in sage.interfaces.expect.Expect._crash_msg
Failed example:
    singular('2+3')
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
        self.execute(example, compiled, test.globs)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
        exec compiled in globs
      File "<doctest sage.interfaces.expect.Expect._crash_msg[4]>", line 1, in <module>
        singular('2+3')
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 724, in __call__
        return SingularElement(self, type, x, False)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1184, in __init__
        self._name = parent._create( value, type)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 685, in _create
        self.set(type, name, value)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 626, in set
        out = self.eval(cmd)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 580, in eval
        s = Expect.eval(self, x, **kwds)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1197, in eval
        for L in code.split('\n') if L != ''])
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line
        E.sendline(line)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py", line 677, in sendline
        n = n + self.send (os.linesep)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py", line 669, in send
        c = os.write(self.child_fd, str)
    TypeError: [Errno 22] Invalid argument
    Error evaluating def sage51=2+3; in Singular
**********************************************************************
```

**Apply** [and [attachment:14371_sleep_isalive_alt.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d15ac86bd149de0f4c0850be6fc89dc8.patch))

**Assignee:** mvngu

**CC:**  jpflori

**Reviewer:** Volker Braun, Jeroen Demeyer

**Author:** Jeroen Demeyer, Volker Braun

**Merged:** sage-5.9.rc0

Issue created by migration from https://trac.sagemath.org/ticket/14371





---

archive/issue_events_124727.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-29T01:20:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124727"
}
```



---

archive/issue_comments_175134.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt's not the best solution possible, but after spending more than 1 hour trying stuff and reading the pexpect source code, there is nothing better I could come up with.",
    "created_at": "2013-03-29T01:20:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175134",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
It's not the best solution possible, but after spending more than 1 hour trying stuff and reading the pexpect source code, there is nothing better I could come up with.



---

archive/issue_comments_175135.json:
```json
{
    "body": "<a id='comment:2'></a>\nWhich syscall is failing with invalid argument? Can we get the full backtrace? Why do we catch the RuntimeError at all in `set()`?",
    "created_at": "2013-04-05T12:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175135",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
Which syscall is failing with invalid argument? Can we get the full backtrace? Why do we catch the RuntimeError at all in `set()`?



---

archive/issue_comments_175136.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [@vbraun](#comment%3A2):\n> Which syscall is failing with invalid argument?\n\n`os.write()` to the terminal, from the `send()` function in `site-packages/pexpect.py`",
    "created_at": "2013-04-05T13:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175136",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Replying to [@vbraun](#comment%3A2):
> Which syscall is failing with invalid argument?

`os.write()` to the terminal, from the `send()` function in `site-packages/pexpect.py`



---

archive/issue_comments_175137.json:
```json
{
    "body": "<a id='comment:4'></a>\nDoes that only happen in parallel testing but not in serial tests? The only thing I can think of is that we are running out of file descriptors. Solaris defaults to a really low `ulimit -n`, I think.",
    "created_at": "2013-04-07T11:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175137",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Does that only happen in parallel testing but not in serial tests? The only thing I can think of is that we are running out of file descriptors. Solaris defaults to a really low `ulimit -n`, I think.



---

archive/issue_comments_175138.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@vbraun](#comment%3A4):\n> The only thing I can think of is that we are running out of file descriptors.\n\nI don't that has anything to do with it. I think it has to do with the fact that the Singular process dies and that therefore, writing to the pty fails. But unfortunately, it is more complicated than that.",
    "created_at": "2013-04-07T12:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175138",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [@vbraun](#comment%3A4):
> The only thing I can think of is that we are running out of file descriptors.

I don't that has anything to do with it. I think it has to do with the fact that the Singular process dies and that therefore, writing to the pty fails. But unfortunately, it is more complicated than that.



---

archive/issue_comments_175139.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis doesn't make sense, if something is wrong with the file descriptor then write would cause EBADF not EINVAL. Are you sure that the error comes from writing to the old, dead subprocess and not to the newly-forked one? And why are we even catching RuntimeError in sage.interface.singular.set?\n\nI would guess that the issue is the absence of `forkpty()` on Solaris? I.e. no `os.forkpty` in Python, so `pty.fork` falls back to an alternate implementation which presumably triggers a race in Solaris. Contact upstream ;-)\n\nIt seems ridiculous to change the doctest here instead of adding a workaround to `sage.interface`. If this doesn't work then your platform just can't run Sage.",
    "created_at": "2013-04-07T13:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175139",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
This doesn't make sense, if something is wrong with the file descriptor then write would cause EBADF not EINVAL. Are you sure that the error comes from writing to the old, dead subprocess and not to the newly-forked one? And why are we even catching RuntimeError in sage.interface.singular.set?

I would guess that the issue is the absence of `forkpty()` on Solaris? I.e. no `os.forkpty` in Python, so `pty.fork` falls back to an alternate implementation which presumably triggers a race in Solaris. Contact upstream ;-)

It seems ridiculous to change the doctest here instead of adding a workaround to `sage.interface`. If this doesn't work then your platform just can't run Sage.



---

archive/issue_comments_175140.json:
```json
{
    "body": "**Attachment:** [trac_14371_dont_catch_runtimeerror.patch.gz](https://github.com/sagemath/sage/files/ticket14371/trac_14371_dont_catch_runtimeerror.patch.gz)\n\nInitial patch",
    "created_at": "2013-04-07T16:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175140",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_14371_dont_catch_runtimeerror.patch.gz](https://github.com/sagemath/sage/files/ticket14371/trac_14371_dont_catch_runtimeerror.patch.gz)

Initial patch



---

archive/issue_comments_175141.json:
```json
{
    "body": "<a id='comment:7'></a>\nI've added a patch that weans off the singular interface from RuntimeError abuse. Maybe you can try with that patch, then we ought to get a actually useful backtrace. All tests pass with the patch on my machine...",
    "created_at": "2013-04-07T16:10:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175141",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
I've added a patch that weans off the singular interface from RuntimeError abuse. Maybe you can try with that patch, then we ought to get a actually useful backtrace. All tests pass with the patch on my machine...



---

archive/issue_comments_175142.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@vbraun](#comment%3A6):\n> It seems ridiculous to change the doctest here instead of adding a workaround to `sage.interface`.\n\nI agree, but my workaround (adding the `sleep()`) worked and everything else which I tried didn't work. But I'll certainly try your patch.",
    "created_at": "2013-04-07T19:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175142",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [@vbraun](#comment%3A6):
> It seems ridiculous to change the doctest here instead of adding a workaround to `sage.interface`.

I agree, but my workaround (adding the `sleep()`) worked and everything else which I tried didn't work. But I'll certainly try your patch.



---

archive/issue_comments_175143.json:
```json
{
    "body": "**Changing author** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Volker Braun\".",
    "created_at": "2013-04-08T06:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175143",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Jeroen Demeyer" to "Jeroen Demeyer, Volker Braun".



---

archive/issue_comments_175144.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Attachment:** [14371_traceback.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch.gz)",
    "created_at": "2013-04-08T06:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175144",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
**Attachment:** [14371_traceback.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch.gz)



---

archive/issue_comments_175145.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,27 +1,38 @@\n-On hawk (OpenSolaris):\n+On hawk (OpenSolaris), after applying [attachment:14371:traceback.patch](https://github.com/sagemath/sage/files/ticket14371/a75b891daa8591e39dbd511137ddc6a1.patch) to get a useful traceback:\n \n ```\n-sage -t --long devel/sage/sage/interfaces/expect.py\n+sage -t devel/sage/sage/interfaces/expect.py\n **********************************************************************\n File \"devel/sage/sage/interfaces/expect.py\", line 1089, in sage.interfaces.expect.Expect._crash_msg\n Failed example:\n     singular('2+3')\n Exception raised:\n     Traceback (most recent call last):\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 460, in _run\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 466, in _run\n         self.execute(example, compiled, test.globs)\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 819, in execute\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 825, in execute\n         exec compiled in globs\n       File \"<doctest sage.interfaces.expect.Expect._crash_msg[4]>\", line 1, in <module>\n         singular('2+3')\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 724, in __call__\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 724, in __call__\n         return SingularElement(self, type, x, False)\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1184, in __init__\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1184, in __init_\n+_\n         self._name = parent._create( value, type)\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 685, in _create\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 685, in _create\n         self.set(type, name, value)\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 628, in set\n-        raise TypeError, msg\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 626, in set\n+        out = self.eval(cmd)\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 580, in eval\n+        s = Expect.eval(self, x, **kwds)\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1197, in eval\n+        for L in code.split('\\n') if L != ''])\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 818, in _eval_line\n+        E.sendline(line)\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py\", line 677, in sendline\n+        n = n + self.send (os.linesep)\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py\", line 669, in send\n+        c = os.write(self.child_fd, str)\n     TypeError: [Errno 22] Invalid argument\n     Error evaluating def sage51=2+3; in Singular\n **********************************************************************\n``````\n",
    "created_at": "2013-04-08T06:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175145",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,27 +1,38 @@
-On hawk (OpenSolaris):
+On hawk (OpenSolaris), after applying [attachment:14371:traceback.patch](https://github.com/sagemath/sage/files/ticket14371/a75b891daa8591e39dbd511137ddc6a1.patch) to get a useful traceback:
 
 ```
-sage -t --long devel/sage/sage/interfaces/expect.py
+sage -t devel/sage/sage/interfaces/expect.py
 **********************************************************************
 File "devel/sage/sage/interfaces/expect.py", line 1089, in sage.interfaces.expect.Expect._crash_msg
 Failed example:
     singular('2+3')
 Exception raised:
     Traceback (most recent call last):
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 460, in _run
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 466, in _run
         self.execute(example, compiled, test.globs)
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 819, in execute
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 825, in execute
         exec compiled in globs
       File "<doctest sage.interfaces.expect.Expect._crash_msg[4]>", line 1, in <module>
         singular('2+3')
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 724, in __call__
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 724, in __call__
         return SingularElement(self, type, x, False)
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1184, in __init__
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1184, in __init_
+_
         self._name = parent._create( value, type)
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 685, in _create
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 685, in _create
         self.set(type, name, value)
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_suncc/build/sage-5.9.beta2/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 628, in set
-        raise TypeError, msg
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 626, in set
+        out = self.eval(cmd)
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 580, in eval
+        s = Expect.eval(self, x, **kwds)
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1197, in eval
+        for L in code.split('\n') if L != ''])
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 818, in _eval_line
+        E.sendline(line)
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py", line 677, in sendline
+        n = n + self.send (os.linesep)
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/pexpect.py", line 669, in send
+        c = os.write(self.child_fd, str)
     TypeError: [Errno 22] Invalid argument
     Error evaluating def sage51=2+3; in Singular
 **********************************************************************
``````




---

archive/issue_comments_175146.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On hawk (OpenSolaris), after applying [attachment:14371:traceback.patch](https://github.com/sagemath/sage/files/ticket14371/a75b891daa8591e39dbd511137ddc6a1.patch) to get a useful traceback:\n+On hawk (OpenSolaris), after applying [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch) to get a useful traceback:\n \n ```\n sage -t devel/sage/sage/interfaces/expect.py\n``````\n",
    "created_at": "2013-04-08T06:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175146",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On hawk (OpenSolaris), after applying [attachment:14371:traceback.patch](https://github.com/sagemath/sage/files/ticket14371/a75b891daa8591e39dbd511137ddc6a1.patch) to get a useful traceback:
+On hawk (OpenSolaris), after applying [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch) to get a useful traceback:
 
 ```
 sage -t devel/sage/sage/interfaces/expect.py
``````




---

archive/issue_comments_175147.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,8 +16,7 @@\n         singular('2+3')\n       File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 724, in __call__\n         return SingularElement(self, type, x, False)\n-      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1184, in __init_\n-_\n+      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1184, in __init__\n         self._name = parent._create( value, type)\n       File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 685, in _create\n         self.set(type, name, value)\n``````\n",
    "created_at": "2013-04-08T06:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175147",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,8 +16,7 @@
         singular('2+3')
       File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 724, in __call__
         return SingularElement(self, type, x, False)
-      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1184, in __init_
-_
+      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1184, in __init__
         self._name = parent._create( value, type)
       File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.9.beta4/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 685, in _create
         self.set(type, name, value)
``````




---

archive/issue_comments_175148.json:
```json
{
    "body": "<a id='comment:12'></a>\n[= [attachment:trac_14371_dont_catch_runtimeerror.patch](https://github.com/sagemath/sage/files/ticket14371/trac_14371_dont_catch_runtimeerror.patch) + [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/5f19d0f7e9e09a8a292bfa5ec54842bd.patch)) with 1 change: inherit `SingularError` from `RuntimeError` for backwards compatibility.",
    "created_at": "2013-04-08T06:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175148",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
[= [attachment:trac_14371_dont_catch_runtimeerror.patch](https://github.com/sagemath/sage/files/ticket14371/trac_14371_dont_catch_runtimeerror.patch) + [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/5f19d0f7e9e09a8a292bfa5ec54842bd.patch)) with 1 change: inherit `SingularError` from `RuntimeError` for backwards compatibility.



---

archive/issue_comments_175149.json:
```json
{
    "body": "<a id='comment:13'></a>\nOK, useful traceback now, any ideas?",
    "created_at": "2013-04-08T06:36:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175149",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
OK, useful traceback now, any ideas?



---

archive/issue_comments_175150.json:
```json
{
    "body": "**Attachment:** [14371_singular_race.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_singular_race.patch.gz)",
    "created_at": "2013-04-08T06:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175150",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [14371_singular_race.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_singular_race.patch.gz)



---

archive/issue_comments_175151.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -36,3 +36,5 @@\n     Error evaluating def sage51=2+3; in Singular\n **********************************************************************\n ```\n+\n+**Apply** [and [attachment:14371_singular_race.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/a369472fe6891f28abcb8e8bfdd40451.patch))\n``````\n",
    "created_at": "2013-04-08T06:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175151",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -36,3 +36,5 @@
     Error evaluating def sage51=2+3; in Singular
 **********************************************************************
 ```
+
+**Apply** [and [attachment:14371_singular_race.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/a369472fe6891f28abcb8e8bfdd40451.patch))
``````




---

archive/issue_comments_175152.json:
```json
{
    "body": "<a id='comment:15'></a>\n`os.write` can never raise a TypeError, only OSError. It is the point where the exception originates, but the exception type and message come from the `except OSError:` branch in `_eval_line`.",
    "created_at": "2013-04-08T09:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175152",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
`os.write` can never raise a TypeError, only OSError. It is the point where the exception originates, but the exception type and message come from the `except OSError:` branch in `_eval_line`.



---

archive/issue_comments_175153.json:
```json
{
    "body": "<a id='comment:16'></a>\nMaybe run the doctest under dtrace to figure out where the EINVAL comes from? Somebody who is actually using OpenSolaris should make an effort.",
    "created_at": "2013-04-08T09:47:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175153",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
Maybe run the doctest under dtrace to figure out where the EINVAL comes from? Somebody who is actually using OpenSolaris should make an effort.



---

archive/issue_comments_175154.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@vbraun](#comment%3A15):\n> `os.write` can never raise a TypeError, only OSError. It is the point where the exception originates, but the exception type and message come from the `except OSError:` branch in `_eval_line`.\n\nThese are all true statements, but what's the point you're trying to make?\n\nPerhaps you are confused by the use of `sys.exc_info()[2]`, which allows to raise a new exception with the old traceback. So it really is the `os.write()` which is failing.",
    "created_at": "2013-04-08T12:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175154",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [@vbraun](#comment%3A15):
> `os.write` can never raise a TypeError, only OSError. It is the point where the exception originates, but the exception type and message come from the `except OSError:` branch in `_eval_line`.

These are all true statements, but what's the point you're trying to make?

Perhaps you are confused by the use of `sys.exc_info()[2]`, which allows to raise a new exception with the old traceback. So it really is the `os.write()` which is failing.



---

archive/issue_comments_175155.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@vbraun](#comment%3A16):\n> Somebody who is actually using OpenSolaris should make an effort.\n\nI did, but I really couldn't figure out what is going wrong.",
    "created_at": "2013-04-08T12:21:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175155",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [@vbraun](#comment%3A16):
> Somebody who is actually using OpenSolaris should make an effort.

I did, but I really couldn't figure out what is going wrong.



---

archive/issue_comments_175156.json:
```json
{
    "body": "<a id='comment:19'></a>\nThat `os.write` fails is ok, we catch the `OSError` and restart the process. But your hack prints the traceback starting from `os.write`, which is not the relevant one. The except: branch fails somewhere and that is the issue.",
    "created_at": "2013-04-08T12:34:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175156",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
That `os.write` fails is ok, we catch the `OSError` and restart the process. But your hack prints the traceback starting from `os.write`, which is not the relevant one. The except: branch fails somewhere and that is the issue.



---

archive/issue_comments_175157.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Attachment:** [14371_traceback_dont_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch.gz)",
    "created_at": "2013-04-08T14:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175157",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
**Attachment:** [14371_traceback_dont_catch.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch.gz)



---

archive/issue_comments_175158.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On hawk (OpenSolaris), after applying [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch) to get a useful traceback:\n+On hawk (OpenSolaris), after applying [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch) to get a useful traceback:\n \n ```\n sage -t devel/sage/sage/interfaces/expect.py\n``````\n",
    "created_at": "2013-04-08T14:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175158",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On hawk (OpenSolaris), after applying [attachment:14371_traceback.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback.patch) to get a useful traceback:
+On hawk (OpenSolaris), after applying [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch) to get a useful traceback:
 
 ```
 sage -t devel/sage/sage/interfaces/expect.py
``````




---

archive/issue_comments_175159.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@vbraun](#comment%3A19):\n> That `os.write` fails is ok, we catch the `OSError` and restart the process.\n\nNo, we don't because pexpect hasn't realized that the process is dead (`E.isalive()` is still true).",
    "created_at": "2013-04-08T14:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175159",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [@vbraun](#comment%3A19):
> That `os.write` fails is ok, we catch the `OSError` and restart the process.

No, we don't because pexpect hasn't realized that the process is dead (`E.isalive()` is still true).



---

archive/issue_comments_175160.json:
```json
{
    "body": "<a id='comment:22'></a>\nKnown bug? This is from `pexpect.py`:\n\n```\n    def isalive(self):\n        \"\"\"This tests if the child process is running or not.\n        This is non-blocking. If the child was terminated then this\n        will read the exitstatus or signalstatus of the child.\n        This returns 1 if the child process appears to be running or 0 if not.\n        It can take literally SECONDS for Solaris to return the right status.\n        \"\"\"\n```\nHow about we wait for 5 seconds after an `os.write` error on Slowaris?",
    "created_at": "2013-04-09T10:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175160",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
Known bug? This is from `pexpect.py`:

```
    def isalive(self):
        """This tests if the child process is running or not.
        This is non-blocking. If the child was terminated then this
        will read the exitstatus or signalstatus of the child.
        This returns 1 if the child process appears to be running or 0 if not.
        It can take literally SECONDS for Solaris to return the right status.
        """
```
How about we wait for 5 seconds after an `os.write` error on Slowaris?



---

archive/issue_comments_175161.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n **********************************************************************\n ```\n \n-**Apply** [and [attachment:14371_singular_race.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/a369472fe6891f28abcb8e8bfdd40451.patch))\n+**Apply** [and [attachment:14371_sleep_isalive.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d82edbf0414f4036566fee0a8e3ce3f5.patch))\n``````\n",
    "created_at": "2013-04-09T11:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175161",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 **********************************************************************
 ```
 
-**Apply** [and [attachment:14371_singular_race.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/a369472fe6891f28abcb8e8bfdd40451.patch))
+**Apply** [and [attachment:14371_sleep_isalive.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d82edbf0414f4036566fee0a8e3ce3f5.patch))
``````




---

archive/issue_comments_175162.json:
```json
{
    "body": "<a id='comment:23'></a>\nSomething like this (needs review)?",
    "created_at": "2013-04-09T11:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175162",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Something like this (needs review)?



---

archive/issue_comments_175163.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Attachment:** [14371_sleep_isalive.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_sleep_isalive.patch.gz)\n\nI was more thingking about that:\n\n```\n    except OSError, msg: \n        if sys.platform.startswith('sunos'):\n            # OpenSolaris bug workaround\n            time.sleep(5)\n        if not E.isalive():\n```\nThere is no point in waiting if your OS works correctly. But more importantly, does it fix the issue?",
    "created_at": "2013-04-09T11:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175163",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>
**Attachment:** [14371_sleep_isalive.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_sleep_isalive.patch.gz)

I was more thingking about that:

```
    except OSError, msg: 
        if sys.platform.startswith('sunos'):
            # OpenSolaris bug workaround
            time.sleep(5)
        if not E.isalive():
```
There is no point in waiting if your OS works correctly. But more importantly, does it fix the issue?



---

archive/issue_comments_175164.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [@vbraun](#comment%3A24):\n> There is no point in waiting if your OS works correctly.\n\nTrue, but I don't like special-casing operating systems. How can we be certain that it only affects (Open)Solaris? Since this failure (`OSError` when the process is truly alive) essentially never happens, I don't think it is a problem. On sane systems, this doesn't affect the doctest since those `time.sleep()` calls will not be done as `E.isalive()` is false.\n\n> But more importantly, does it fix the issue?\n\nI haven't checked it yet, but it should.",
    "created_at": "2013-04-09T12:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175164",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [@vbraun](#comment%3A24):
> There is no point in waiting if your OS works correctly.

True, but I don't like special-casing operating systems. How can we be certain that it only affects (Open)Solaris? Since this failure (`OSError` when the process is truly alive) essentially never happens, I don't think it is a problem. On sane systems, this doesn't affect the doctest since those `time.sleep()` calls will not be done as `E.isalive()` is false.

> But more importantly, does it fix the issue?

I haven't checked it yet, but it should.



---

archive/issue_comments_175165.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@jdemeyer](#comment%3A25):\n> How can we be certain that it only affects (Open)Solaris?\n\nWe can't, thats why I would like to special case only Solaris so we get doctest failures if other (better) OS'es have a bug that causes `os.write` to fail while `isalive()`.",
    "created_at": "2013-04-09T12:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175165",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
Replying to [@jdemeyer](#comment%3A25):
> How can we be certain that it only affects (Open)Solaris?

We can't, thats why I would like to special case only Solaris so we get doctest failures if other (better) OS'es have a bug that causes `os.write` to fail while `isalive()`.



---

archive/issue_comments_175166.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [@vbraun](#comment%3A26):\n> Replying to [@jdemeyer](#comment%3A25):\n> > How can we be certain that it only affects (Open)Solaris?\n\n> \n> We can't, thats why I would like to special case only Solaris so we get doctest failures\n\nAnd then what? Add a fix for that other operating system? Better just fix all hypothetical errors in one go.",
    "created_at": "2013-04-09T12:14:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175166",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Replying to [@vbraun](#comment%3A26):
> Replying to [@jdemeyer](#comment%3A25):
> > How can we be certain that it only affects (Open)Solaris?

> 
> We can't, thats why I would like to special case only Solaris so we get doctest failures

And then what? Add a fix for that other operating system? Better just fix all hypothetical errors in one go.



---

archive/issue_comments_175167.json:
```json
{
    "body": "<a id='comment:28'></a>\nAnyway, the OpenSolaris issue seems to be fixed by this patch.",
    "created_at": "2013-04-09T12:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175167",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Anyway, the OpenSolaris issue seems to be fixed by this patch.



---

archive/issue_comments_175168.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [@jdemeyer](#comment%3A27):\n> And then what?\n\nAnd then hopefully not make an OS with such a glaring kernel bug a first-class supported platform.",
    "created_at": "2013-04-09T12:18:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175168",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
Replying to [@jdemeyer](#comment%3A27):
> And then what?

And then hopefully not make an OS with such a glaring kernel bug a first-class supported platform.



---

archive/issue_comments_175169.json:
```json
{
    "body": "<a id='comment:31'></a>\nFYI, this is also happening on Solaris 10, so not only OpenSolaris (which is dead isn't it? we should maybe rather try OpenIndiana?).",
    "created_at": "2013-04-10T09:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175169",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:31'></a>
FYI, this is also happening on Solaris 10, so not only OpenSolaris (which is dead isn't it? we should maybe rather try OpenIndiana?).



---

archive/issue_comments_175170.json:
```json
{
    "body": "<a id='comment:32'></a>\n(Although OpenIndiana does not support SPARC yet...)",
    "created_at": "2013-04-10T09:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175170",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:32'></a>
(Although OpenIndiana does not support SPARC yet...)



---

archive/issue_events_124728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-24T12:18:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124728"
}
```



---

archive/issue_events_124729.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-24T12:18:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124729"
}
```



---

archive/issue_comments_175171.json:
```json
{
    "body": "<a id='comment:34'></a>\nFwiw, here is an alternative patch.",
    "created_at": "2013-04-24T15:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175171",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
Fwiw, here is an alternative patch.



---

archive/issue_comments_175172.json:
```json
{
    "body": "<a id='comment:35'></a>\nVolker, for the record: do you give positive review to [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch)?",
    "created_at": "2013-04-24T15:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Volker, for the record: do you give positive review to [attachment:14371_traceback_dont_catch.patch](https://github.com/sagemath/sage/files/ticket14371/14371_traceback_dont_catch.patch)?



---

archive/issue_comments_175173.json:
```json
{
    "body": "<a id='comment:36'></a>\nYes, to the extend that I can give positive review to a patch that I wrote for the most part ;-)",
    "created_at": "2013-04-24T15:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175173",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
Yes, to the extend that I can give positive review to a patch that I wrote for the most part ;-)



---

archive/issue_comments_175174.json:
```json
{
    "body": "<a id='comment:37'></a>\nVolker, as release manager I need this bug to be fixed, so I'm going to apply your version, even though I still prefer to fix the potential problem on all systems.\n\nUnfortunately, David Kirkby's OpenSolaris machine is down for the moment, so I cannot test your patch (although it should work).",
    "created_at": "2013-04-25T11:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175174",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Volker, as release manager I need this bug to be fixed, so I'm going to apply your version, even though I still prefer to fix the potential problem on all systems.

Unfortunately, David Kirkby's OpenSolaris machine is down for the moment, so I cannot test your patch (although it should work).



---

archive/issue_comments_175175.json:
```json
{
    "body": "<a id='comment:38'></a>\nSorry for being a PITA sometimes ;-)",
    "created_at": "2013-04-25T11:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175175",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
Sorry for being a PITA sometimes ;-)



---

archive/issue_comments_175176.json:
```json
{
    "body": "**Attachment:** [14371_sleep_isalive_alt.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_sleep_isalive_alt.patch.gz)\n\nAlternative patch",
    "created_at": "2013-04-25T12:02:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175176",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [14371_sleep_isalive_alt.patch.gz](https://github.com/sagemath/sage/files/ticket14371/14371_sleep_isalive_alt.patch.gz)

Alternative patch



---

archive/issue_comments_175177.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -37,4 +37,4 @@\n **********************************************************************\n ```\n \n-**Apply** [and [attachment:14371_sleep_isalive.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d82edbf0414f4036566fee0a8e3ce3f5.patch))\n+**Apply** [and [attachment:14371_sleep_isalive_alt.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d15ac86bd149de0f4c0850be6fc89dc8.patch))\n``````\n",
    "created_at": "2013-04-25T12:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175177",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -37,4 +37,4 @@
 **********************************************************************
 ```
 
-**Apply** [and [attachment:14371_sleep_isalive.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d82edbf0414f4036566fee0a8e3ce3f5.patch))
+**Apply** [and [attachment:14371_sleep_isalive_alt.patch](https://github.com/sagemath/sage/files/ticket14371/19d8df053e821e7a42c194fb8d906f9a.patch](https://github.com/sagemath/sage/files/ticket14371/d15ac86bd149de0f4c0850be6fc89dc8.patch))
``````




---

archive/issue_comments_175178.json:
```json
{
    "body": "<a id='comment:39'></a>\nComment-only change to your patch. Volker, if you agree, then this one is good to go.",
    "created_at": "2013-04-25T12:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175178",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Comment-only change to your patch. Volker, if you agree, then this one is good to go.



---

archive/issue_comments_175179.json:
```json
{
    "body": "**Reviewer:** Volker Braun, Jeroen Demeyer",
    "created_at": "2013-04-25T12:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175179",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Volker Braun, Jeroen Demeyer



---

archive/issue_comments_175180.json:
```json
{
    "body": "<a id='comment:40'></a>\nSounds good to me.",
    "created_at": "2013-04-25T12:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175180",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:40'></a>
Sounds good to me.



---

archive/issue_events_124730.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-04-25T12:06:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124730"
}
```



---

archive/issue_events_124731.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-04-25T12:06:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124731"
}
```



---

archive/issue_comments_175181.json:
```json
{
    "body": "**Merged:** sage-5.9.rc0",
    "created_at": "2013-04-25T12:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/14371#issuecomment-175181",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.9.rc0



---

archive/issue_events_124732.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-25T12:56:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124732"
}
```



---

archive/issue_events_124733.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-25T12:56:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/14371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/14371#event-124733"
}
```
