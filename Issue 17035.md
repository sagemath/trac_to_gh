# Issue 17035: Use pivoting for Gaussian elimination on matrices over p-adics

Issue created by migration from Trac.

Original creator: roed

Original creation time: 2014-11-01 21:46:51


```
sage: R = ZpCA(5,5,print_mode='val-unit')
sage: A = matrix(R,3,3,[250,2369,1147,106,927,362,90,398,2483])
sage: A
[5^3 * 2 + O(5^5)    2369 + O(5^5)    1147 + O(5^5)]
[    106 + O(5^5)     927 + O(5^5)     362 + O(5^5)]
[ 5 * 18 + O(5^5)     398 + O(5^5)    2483 + O(5^5)]
sage: A.det()
2634 + O(5^5)
sage: ~A
Traceback (most recent call last):
...
ZeroDivisionError: input matrix must be nonsingular
```

The problem is that Sage doesn't pivot when doing Gaussian elimination:

```
sage: K = R.fraction_field()
sage: A.change_ring(K).augment(identity_matrix(K,3))._echelon_classical()
[       1 + O(5^2)           O(5^-1)           O(5^-1)           O(5^-1)            O(5^2)   5^-1 * 7 + O(5)]
[           O(5^2)        1 + O(5^2)       13 + O(5^2)        4 + O(5^2)            O(5^5) 5^2 * 19 + O(5^4)]
[           O(5^3)            O(5^0)            O(5^0)            O(5^0)        1 + O(5^2)   5^-1 * 8 + O(5)]
```



---

Comment by assaferan created at 2018-04-04 08:22:44

Changing status from new to needs_review.


---

Comment by assaferan created at 2018-04-04 08:22:44

Hi,
I have added partial pivoting and scaled partial pivoting to the code,
including some examples for doctesting.
For now, I set scaled partial pivoting to be the default algorithm only for discrete valuation fields. This is until we will have a better framework for general valuation rings.

Also, I have not implemented complete pivoting, as it is only rarely needed and very inefficient.
----
New commits:


---

Comment by git created at 2018-04-04 12:30:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-05 23:41:03

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-05-05 23:41:03

Not all methods have a doctest. Also, do you want to `c(p)def` some of the methods? Since they are currently python methods, I don't see the point of the `sig_check()`. Also, there seems to be some code redundancy, is there a way you could mitigate that?


---

Comment by git created at 2018-05-17 07:32:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by assaferan created at 2018-05-21 06:35:28

Changing status from needs_work to needs_review.


---

Comment by assaferan created at 2018-05-21 06:35:28

Hi,
I cpdef'd the functions, and mitigated the code redundancy. Also added doctests where they were none.


---

Comment by tscrim created at 2018-05-22 08:59:04

I did a little bit of cleanup. In particular, I factored out the classical algorithm to simplify the code to help keep it fast. If my changes are good, then you can set a positive review.
----
New commits:


---

Comment by assaferan created at 2018-05-23 13:49:10

The changes seem to be in order, hence I'm setting to a positive review.


---

Comment by assaferan created at 2018-05-23 13:49:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-27 17:01:50

Resolution: fixed
