# Issue 33736: Deprecate handling of $...$ in docstrings

Issue created by migration from https://trac.sagemath.org/ticket/33973

Original creator: mkoeppe

Original creation time: 2022-06-10 21:51:15

CC:  jhpalmieri klee

We change the function `sage.misc.sagedoc.process_dollars` so it issues a deprecation warning when dollar signs are used for math markup. 

This is to provide a gentle transition for user packages that use  the Sage docbuilding machinery.



---

Comment by jhpalmieri created at 2022-06-10 22:14:25

A reminder: we need to change the developer's guide, coding_basics.rst:

```
In Sage's documentation LaTeX code is allowed and is marked with **backticks or
dollar signs**:

    ```x^2 + y^2 = 1``` and ``$x^2 + y^2 = 1$`` both yield `x^2 + y^2 = 1`.

```

and an example a few lines later.


---

Comment by klee created at 2022-06-10 22:43:56

To provide the rationale for this change: maths enclosed by backticks are easier to read in source files than maths enclosed by dollar signs.


---

Comment by git created at 2022-06-11 01:54:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-06-11 09:04:05

Changing status from new to needs_review.


---

Comment by klee created at 2022-06-11 09:04:36

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-06-11 09:04:36

Works well.


---

Comment by mkoeppe created at 2022-06-11 17:41:05

Thank you!


---

Comment by jhpalmieri created at 2022-06-11 19:39:31

Changing status from positive_review to needs_work.


---

Comment by jhpalmieri created at 2022-06-11 19:39:31

I get two doctest failures:

```
sage -t --long --random-seed=213087245150099909637050900746775932269 src/sage/misc/sagedoc.py  # 1 doctest failed
sage -t --long --random-seed=213087245150099909637050900746775932269 src/sage/interfaces/tachyon.py  # 1 doctest failed
```



---

Comment by git created at 2022-06-11 21:25:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 21:31:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 21:32:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-06-11 21:35:44

I also see some deprecation warnings in `sagemath_doc_html-none.log`.


---

Comment by git created at 2022-06-11 21:36:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-06-11 21:39:24

I'll try building the docs again after merging #33968.


---

Comment by mkoeppe created at 2022-06-11 21:40:28

In #33968 I did skip a few files that are being touched in other open tickets


---

Comment by git created at 2022-06-11 21:56:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-06-11 21:58:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 22:00:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 22:05:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 22:08:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-06-11 22:19:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-11 22:20:10

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2022-06-11 22:42:00

What should I do with more fixes? Add them here or defer them to another ticket?


---

Comment by klee created at 2022-06-11 22:56:01

Sorry for having rushed. 

Lesson: never ever presume all doctests pass before you see it!


---

Comment by mkoeppe created at 2022-06-12 01:25:22

OK to push more changes to the ticket


---

Comment by jhpalmieri created at 2022-06-12 21:25:49

With these changes, html and PDF docs build without these new deprecation warnings, and doctests pass. I have not checked the documentation to make sure it looks good.
----
New commits:


---

Comment by git created at 2022-06-12 21:52:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2022-06-13 07:51:52

Replying to [comment:27 jhpalmieri]:
> With these changes, html and PDF docs build without these new deprecation warnings, and doctests pass. I have not checked the documentation to make sure it looks good.

I did (hew..). There is no new typo, but among the existing ones, I suggest to correct these two obvious:

```diff
--- a/src/sage/groups/abelian_gps/dual_abelian_group_element.py
+++ b/src/sage/groups/abelian_gps/dual_abelian_group_element.py
@@ -200,7 +200,7 @@ class DualAbelianGroupElement(AbelianGroupElementBase):
             [[b^2*c^2*d^3*e^5, 245]]
 
         The command e.word_problem([u,v,w,x,y],display=True) returns
-        the same list but also prints `e = (b^2*c^2*d^3*e^5)^245`.
+        the same list but also prints `e = (b^2*c^2*d^3*e^5)^{245}`.
         """
         ## First convert the problem to one using AbelianGroups
         import copy
--- a/src/sage/media/wav.py
+++ b/src/sage/media/wav.py
@@ -70,8 +70,8 @@ class Wave(SageObject):
 
     Indexing:
 
-        Getting the `n^{th}` item in a Wave object will give you the value
-        of the `n^{th}` frame.
+        Getting the `n`-th item in a Wave object will give you the value
+        of the `n`-th frame.
     """
     def __init__(self, data=None, **kwds):
         if data is not None:
```



---

Comment by git created at 2022-06-13 15:04:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-06-13 15:07:34

Thank you very much for checking. I agree with your second suggestion. I changed the first instead to ```e = ...```: it's referring to something being printed, so it should be rendered as code, not as math.

Regarding the second, there are instances of both ``n`-th` and ``n^{th}`` in the Sage library. I would prefer `$n$th`, but Sphinx doesn't seem to handle ``n`th` correctly. In any case, I followed your suggestion.


---

Comment by klee created at 2022-06-14 00:30:00

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-06-14 00:30:00

Many thanks to all.


---

Comment by mkoeppe created at 2022-06-14 01:37:50

Thanks!


---

Comment by vbraun created at 2022-06-19 15:24:19

Resolution: fixed


---

Comment by dimpase created at 2022-06-24 11:49:13

I get a lot of `Unexpected section title.` in tachyon docs:

```
[sagemath_doc_html-none] [interface] /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/interfaces/tachyon.py:docstring of sage.interfaces.tachyon.TachyonRT:56: CRITICAL: Unexpected section title.
[sagemath_doc_html-none] [interface] Basic Scene Requirements
[sagemath_doc_html-none] [interface] ------------------------
[sagemath_doc_html-none] [interface] /home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/sage/interfaces/tachyon.py:docstring of sage.interfaces.tachyon.TachyonRT:94: CRITICAL: Unexpected section title.
[sagemath_doc_html-none] [interface] Camera and viewing parameters
[sagemath_doc_html-none] [interface] -----------------------------
...
```



---

Comment by jhpalmieri created at 2022-06-24 18:27:20

Let's fix this in #34066.
