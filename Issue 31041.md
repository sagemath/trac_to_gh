# Issue 31041: ipywidgets should not depend on widgetsnbextension

Issue created by migration from https://trac.sagemath.org/ticket/31278

Original creator: mkoeppe

Original creation time: 2021-01-22 03:24:33

CC:  fbissey isuruf arojas @jcamp0x2a @tobiasdiez @kliem

This is actually an upstream issue in `ipywidgets` marked in the source code as a "TODO":
https://github.com/jupyter-widgets/ipywidgets/blob/master/setup.py#L115

This dependency pulls in a full installation of the Jupyter notebook. 

```
notebook>=4.4.1->widgetsnbextension~=3.5.0->ipywidgets==7.5.1
```

This is an obstacle to avoiding to build a copy of the jupyter notebook (connecting to a system jupyter notebook).


---

Comment by mkoeppe created at 2021-02-02 19:34:40

In a first step we could patch out this dependency - then the wheel that we build at least won't pull the notebook into a user venv.


---

Comment by mkoeppe created at 2021-02-02 21:29:00

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-02-02 21:29:15

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-02-04 22:40:05

Upstream indicates in response to https://github.com/jupyter-widgets/ipywidgets/pull/3080 that they instead plan to remove the dependency of `widgetsnbextension` on `notebook` in 8.0.
----
New commits:


---

Comment by mkoeppe created at 2021-02-04 22:42:05

In fact, this change is already in https://github.com/jupyter-widgets/ipywidgets/commit/7ea681eb07e76796534ac1885d8e60ea9eb92b97#diff-e56eea957358c7c07362fde8ec3a3a8a8fbbeaa825b998cf4ea9191c55b1a0fd


---

Comment by mkoeppe created at 2021-02-04 22:42:53

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-02-04 22:43:27

We can patch our `widgetsnbextension` with a backport of this.


---

Comment by git created at 2021-02-05 04:00:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-02-05 04:02:29

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-03-07 11:12:29

this installs OK. More testing...


---

Comment by dimpase created at 2021-03-08 09:23:00

lgtm


---

Comment by dimpase created at 2021-03-08 09:23:00

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-03-08 13:06:15

Thanks!


---

Comment by vbraun created at 2021-03-14 15:03:17

Resolution: fixed


---

Comment by mkoeppe created at 2021-03-19 19:52:41

Follow up: #31523
