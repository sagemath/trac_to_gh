# Issue 24216: narrow_class_group: bug report

Issue created by migration from Trac.

Original creator: kimball

Original creation time: 2017-12-31 04:51:38

Keywords: narrow class group, quadratic field

The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.


```
sage: version()
'SageMath version 8.1, Release Date: 2017-12-07'
sage: F.<a> = QuadraticField(2)
sage: F.narrow_class_group()
Trivial Abelian group
sage: F.<a> = QuadraticField(3)
sage: F.narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

sage: NumberField(x^2-3,'a').narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

```


If it matters, I was using a pre-built Mac binary.


---

Comment by chapoton created at 2018-01-01 08:35:05

Indeed, there is maybe something strange..

```
sage: F.<a> = QuadraticField(3)
sage: F.pari_bnf().bnfnarrow()
[2, [2], [[0, -1]~]]
sage: F.<a> = QuadraticField(2)
sage: F.pari_bnf().bnfnarrow()
[1, [], []]
sage: F.<a> = NumberField(x**3-7)
sage: F.pari_bnf().bnfnarrow()
[3, [3], [This is the Trac macro *2, 1, 1; 0, 1, 0; 0, 0, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#2, 1, 1; 0, 1, 0; 0, 0, 1-macro)]
```



---

Comment by chapoton created at 2018-01-01 12:53:05

New commits:


---

Comment by chapoton created at 2018-01-01 12:53:05

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-01-01 13:22:33

Why did you make it a cached method?


---

Comment by chapoton created at 2018-01-01 17:40:21

oh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..


---

Comment by vdelecroix created at 2018-01-01 18:22:50

Oh! I missed the old cache.


---

Comment by vdelecroix created at 2018-01-01 18:22:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-04 07:59:40

Resolution: fixed
