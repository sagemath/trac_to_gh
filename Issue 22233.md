# Issue 22233: Replace _pari_ -> __pari__

Issue created by migration from https://trac.sagemath.org/ticket/22470

Original creator: jdemeyer

Original creation time: 2017-02-28 11:03:34

CC:  defeo vdelecroix

Special methods in Python usually have double leading and trailing underscores. For this reason, it makes sense to use `__pari__` for conversion to CyPari2.


---

Comment by vdelecroix created at 2017-02-28 12:13:02

One reason for double underscore is that they correspond to actual implementation of special Python syntax
- `a.__len__()` is `len(a)`
- `a.__add__(b)` is `a + b`
- etc

Do you have an actual reference for why we have to switch fron one to two underscores?


---

Comment by mmezzarobba created at 2017-02-28 12:13:17

Aren't those double-underscore identifiers reserved for use by Python itself?


---

Comment by jdemeyer created at 2017-02-28 12:56:06

Replying to [comment:2 mmezzarobba]:
> Aren't those double-underscore identifiers reserved for use by Python itself?

Do you have a reference for that? There is something about underscores in [PEP 8](https://www.python.org/dev/peps/pep-0008/#id36) but, after reading it, I still don't know which underscore style to use. And the Sage `_foo_` style doesn't even exist for PEP 8.

There is some more in https://docs.python.org/3/reference/lexical_analysis.html#reserved-classes-of-identifiers but again it's not really clear.


---

Comment by jdemeyer created at 2017-02-28 13:02:08

In order to defend `__pari__`: that's also the style used by NumPy, which defines special methods like `__array__`.


---

Comment by mmezzarobba created at 2017-02-28 13:07:21

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 mmezzarobba]:
> > Aren't those double-underscore identifiers reserved for use by Python itself?
> 
> Do you have a reference for that?

https://docs.python.org/2/reference/lexical_analysis.html#reserved-classes-of-identifiers
says:

> `__*__`
>     System-defined names. These names are defined by the interpreter and its implementation (including the standard library). Current system names are discussed in the Special method names section and elsewhere. More will likely be defined in future versions of Python. Any use of __*__ names, in any context, that does not follow explicitly documented use, is subject to breakage without warning.


---

Comment by jdemeyer created at 2017-02-28 13:13:04

Replying to [comment:1 vdelecroix]:
> One reason for double underscore is that they correspond to actual implementation of special Python syntax
> - `a.__len__()` is `len(a)`
> - `a.__add__(b)` is `a + b`
> - etc

One could argue that `x.__pari__()` is `pari(x)` that's not really relevant.

Special methods in Python use the `__foo__` underscore style. I consider `__pari__` to be very similar in spirit to Python's `__int__` or NumPy's `__array__`. Since no PEP or Python documentation documents how to name custom special methods, I think that `__pari__` makes the most sense.


---

Comment by jdemeyer created at 2017-02-28 13:23:49

Let's look at our options:

1. `_pari_()`: not documented/used anywhere except for Sage.

2. `_pari()`: meant for _private_ methods, which is not correct here. We want this method to be part of the CyPari2 public API.

3. `__pari()`: even more private, so even less applicable.

4. `__pari__()`: consistent with Python and NumPy. The only issue is that creating such names possibly goes against the Python documentation.

5. `pari()`: very simple but it doesn't make it clear that it has a special meaning. Higher chance of false positives with people using a `pari()` method for something else.


---

Comment by vdelecroix created at 2017-02-28 15:46:10

for me it the match is between 2 and 4. But it concerns more than just pari (e.g. magma, maxima, gap and such). What about having the discussion on sage-devel?


---

Comment by jdemeyer created at 2017-02-28 15:59:30

Replying to [comment:8 vdelecroix]:
> for me it the match is between 2 and 4.

My first choice is 4, my second choice would be 5.

> But it concerns more than just pari (e.g. magma, maxima, gap and such).

Right, but we do not have to change everything at the same time. We can do this for each interface separately. I just wanted to do this for `_pari_` now because of CyPari2.

> What about having the discussion on sage-devel?

I could try...


---

Comment by jdemeyer created at 2017-02-28 16:28:03

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-02-28 16:28:03

E-mail to `sage-devel` sent...
----
Last 10 new commits:


---

Comment by git created at 2017-03-01 08:39:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-03-01 18:58:23

On my sage-devel post, I don't see much objections to `__pari__`. But people are stressing backwards-compatibility, so I will take care of that.


---

Comment by git created at 2017-03-01 19:32:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by defeo created at 2017-03-03 15:53:40

Replying to [comment:13 jdemeyer]:
> On my sage-devel post, I don't see much objections to `__pari__`.

There is some though. I always find it hard to make a decision in these circumstances. I'm in favor of the change, but what should be considered as sufficient consensus?


---

Comment by jdemeyer created at 2017-03-03 21:09:21

Replying to [comment:15 defeo]:
> what should be considered as sufficient consensus?

I don't feel like I should answer this question, since I am too much biased in favour of `__pari__`.

At least the objections about backwards compatibility are taken care of with the last commit.


---

Comment by git created at 2017-03-14 23:09:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by defeo created at 2017-03-17 13:58:08

After a lenghty discussion in https://groups.google.com/forum/#!topic/sage-devel/G1TuFbh0d-A, this ticket wins!


---

Comment by defeo created at 2017-03-17 13:58:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-27 20:42:16

Resolution: fixed
