# Issue 27160: upgrade to twisted 18.9.0

archive/issues_027160.json:
```json
{
    "body": "CC:  embray jdemeyer fbissey\n\nKeywords: upgrade\n\nThis could help to tun sagenb with python3\n\nIssue created by migration from https://trac.sagemath.org/ticket/27397\n\n",
    "created_at": "2019-03-02T11:40:03Z",
    "labels": [
        "packages: standard",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "upgrade to twisted 18.9.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27160",
    "user": "chapoton"
}
```
CC:  embray jdemeyer fbissey

Keywords: upgrade

This could help to tun sagenb with python3

Issue created by migration from https://trac.sagemath.org/ticket/27397





---

archive/issue_comments_382601.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-02T11:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382601",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_382602.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-02T11:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382602",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_382603.json:
```json
{
    "body": "Strangely, this does not seem to install all files (on a python3-built sage)\n\nFor example, twisted.mail.relaymanager is not installed...\n\nHelp! What is happening?",
    "created_at": "2019-03-02T12:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382603",
    "user": "chapoton"
}
```

Strangely, this does not seem to install all files (on a python3-built sage)

For example, twisted.mail.relaymanager is not installed...

Help! What is happening?



---

archive/issue_comments_382604.json:
```json
{
    "body": "Actually the gentoo ebuild seems to have a similar behavior, python2.7 has way more file installed than python3.6. It appears to be the default, not sure if that's bad yet.",
    "created_at": "2019-03-02T22:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382604",
    "user": "fbissey"
}
```

Actually the gentoo ebuild seems to have a similar behavior, python2.7 has way more file installed than python3.6. It appears to be the default, not sure if that's bad yet.



---

archive/issue_comments_382605.json:
```json
{
    "body": "Could this be related to different levels of compatibility of twisted with respect to different versions of py3 (3.3, 3.4, 3.5, 3.6, etc)\n\nBecause it seems that `twisted.mail.smtp` gets installed with the branch here, whereas it was not with our current version of twisted.",
    "created_at": "2019-03-03T08:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382605",
    "user": "chapoton"
}
```

Could this be related to different levels of compatibility of twisted with respect to different versions of py3 (3.3, 3.4, 3.5, 3.6, etc)

Because it seems that `twisted.mail.smtp` gets installed with the branch here, whereas it was not with our current version of twisted.



---

archive/issue_comments_382606.json:
```json
{
    "body": "Note: the same lack of installed files happens when twisted is installed on top of the system (ubuntu 18.10) python3.",
    "created_at": "2019-03-03T15:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382606",
    "user": "chapoton"
}
```

Note: the same lack of installed files happens when twisted is installed on top of the system (ubuntu 18.10) python3.



---

archive/issue_comments_382607.json:
```json
{
    "body": "The [Twisted home page](https://twistedmatrix.com/trac/) makes very moderate claims to Python 3 support:\n\n> Twisted runs on Python 2 and an ever growing subset also works with Python 3.",
    "created_at": "2019-03-04T23:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382607",
    "user": "slelievre"
}
```

The [Twisted home page](https://twistedmatrix.com/trac/) makes very moderate claims to Python 3 support:

> Twisted runs on Python 2 and an ever growing subset also works with Python 3.



---

archive/issue_comments_382608.json:
```json
{
    "body": "Changing keywords from \"upgrade\" to \"upgrade, twisted\".",
    "created_at": "2019-03-04T23:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382608",
    "user": "slelievre"
}
```

Changing keywords from "upgrade" to "upgrade, twisted".



---

archive/issue_comments_382609.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-03-04T23:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382609",
    "user": "slelievre"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_382610.json:
```json
{
    "body": "That said, the [news item for Twisted 18.9.0](https://github.com/twisted/twisted/blob/trunk/NEWS.rst) mentions\n\n> Python 3.7 is now supported",
    "created_at": "2019-03-04T23:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382610",
    "user": "slelievre"
}
```

That said, the [news item for Twisted 18.9.0](https://github.com/twisted/twisted/blob/trunk/NEWS.rst) mentions

> Python 3.7 is now supported



---

archive/issue_comments_382611.json:
```json
{
    "body": "The [pull request about Python 3.7 support](https://github.com/twisted/twisted/pull/1071/files) still says:\n\n> Python 2.7 (full functionality) or 3.4/3.5/3.6/3.7 (subset of functionality)",
    "created_at": "2019-03-05T04:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382611",
    "user": "slelievre"
}
```

The [pull request about Python 3.7 support](https://github.com/twisted/twisted/pull/1071/files) still says:

> Python 2.7 (full functionality) or 3.4/3.5/3.6/3.7 (subset of functionality)



---

archive/issue_comments_382612.json:
```json
{
    "body": "There is a list of \"non ported modules\" here:\n\nhttps://github.com/twisted/twisted/blob/trunk/src/twisted/python/_setup.py\n\nand this controls what is installed on python3.\n\nWe need relaymanager and all its depencies...",
    "created_at": "2019-03-05T07:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382612",
    "user": "chapoton"
}
```

There is a list of "non ported modules" here:

https://github.com/twisted/twisted/blob/trunk/src/twisted/python/_setup.py

and this controls what is installed on python3.

We need relaymanager and all its depencies...



---

archive/issue_comments_382613.json:
```json
{
    "body": "Is this just for sagenb?  I'd suggest not supporting it on Python 3 at all (I know you've done a lot of work towards getting that working anyways but I'm not sure it's worth all the trouble since it's being deprecated anyways).\n\nAt the very least, maybe it can be missing some functionality (with appropriate warnings given).",
    "created_at": "2019-03-05T15:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382613",
    "user": "embray"
}
```

Is this just for sagenb?  I'd suggest not supporting it on Python 3 at all (I know you've done a lot of work towards getting that working anyways but I'm not sure it's worth all the trouble since it's being deprecated anyways).

At the very least, maybe it can be missing some functionality (with appropriate warnings given).



---

archive/issue_comments_382614.json:
```json
{
    "body": "yes, this is just for sagenb. It currently fails to start because of these 2 missing modules of twisted.mail.  I remember that a brute force removal of these imports allow the notebook to start, but it looked ugly for some reason.\n\nI will not push hard for this ticket, but maybe we were almost there.. Sigh..",
    "created_at": "2019-03-05T15:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382614",
    "user": "chapoton"
}
```

yes, this is just for sagenb. It currently fails to start because of these 2 missing modules of twisted.mail.  I remember that a brute force removal of these imports allow the notebook to start, but it looked ugly for some reason.

I will not push hard for this ticket, but maybe we were almost there.. Sigh..



---

archive/issue_comments_382615.json:
```json
{
    "body": "I guess you could do something like\n\n\n```\ntry:\n    import twisted.mail\n    HAVE_TWISTED_MAIL = True\nexcept ImportError:\n    HAVE_TWISTED_MAIL = False\n    if <twisted version <= whatever>:\n        # This is an actual error since an older Twisted version should have this\n        raise\n```\n\n\nand later\n\n\n```\nif HAVE_TWISTED_MAIL:\n    <do the thing>\nelse:\n    warnings.warn(\"<this functionality is no longer supported, sagenb is deprecated, blah blah blah>\")\n```\n\n\nI haven't looked at the relevant code though so I don't know how straightforward that would be in practice.",
    "created_at": "2019-03-05T15:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382615",
    "user": "embray"
}
```

I guess you could do something like


```
try:
    import twisted.mail
    HAVE_TWISTED_MAIL = True
except ImportError:
    HAVE_TWISTED_MAIL = False
    if <twisted version <= whatever>:
        # This is an actual error since an older Twisted version should have this
        raise
```


and later


```
if HAVE_TWISTED_MAIL:
    <do the thing>
else:
    warnings.warn("<this functionality is no longer supported, sagenb is deprecated, blah blah blah>")
```


I haven't looked at the relevant code though so I don't know how straightforward that would be in practice.



---

archive/issue_comments_382616.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382616",
    "user": "embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_382617.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-28T08:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382617",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_382618.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382618",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_382619.json:
```json
{
    "body": "Is there any volunteer to try this and sagenb with sage running python 3 ?",
    "created_at": "2019-11-02T17:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382619",
    "user": "chapoton"
}
```

Is there any volunteer to try this and sagenb with sage running python 3 ?



---

archive/issue_comments_382620.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2019-11-02T17:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382620",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_382621.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-11-02T17:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382621",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_382622.json:
```json
{
    "body": "I had to do\n\n```\nsage -pip install --upgrade incremental\n```\n\n----\nNew commits:",
    "created_at": "2019-11-02T17:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382622",
    "user": "chapoton"
}
```

I had to do

```
sage -pip install --upgrade incremental
```

----
New commits:



---

archive/issue_comments_382623.json:
```json
{
    "body": "and then\n\n```\nsage -pip install constantly\n```\n\nBut sagenb still fails as before. So no real hope to make it work under py3.",
    "created_at": "2019-11-02T17:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382623",
    "user": "chapoton"
}
```

and then

```
sage -pip install constantly
```

But sagenb still fails as before. So no real hope to make it work under py3.



---

archive/issue_comments_382624.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382624",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_382625.json:
```json
{
    "body": "given #29320, I propose to close this one as invalid",
    "created_at": "2020-03-18T07:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382625",
    "user": "chapoton"
}
```

given #29320, I propose to close this one as invalid



---

archive/issue_comments_382626.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-03-18T07:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382626",
    "user": "chapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_382627.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-18T08:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382627",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_382628.json:
```json
{
    "body": "With pleasure.",
    "created_at": "2020-03-18T08:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382628",
    "user": "fbissey"
}
```

With pleasure.



---

archive/issue_comments_382629.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-03-18T08:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27160#issuecomment-382629",
    "user": "chapoton"
}
```

Resolution: invalid
