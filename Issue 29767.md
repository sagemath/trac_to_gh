# Issue 29767: Added new constructions for BIBDs

archive/issues_029767.json:
```json
{
    "body": "CC:  dimpase\n\nKeywords: bibd combinatorial-designs\n\nConstructed the biplanes with parameters `(79,13,2)` and `(56,11,2)`.\nThe constructions are added to the `BIBD_constructions` dictionary in `sage.combinat.designs.database`.\n\nAfter #29959, they will be available via `designs.balanced_incomplete_block_design`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30004\n\n",
    "created_at": "2020-06-27T20:30:30Z",
    "labels": [
        "combinatorial designs",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Added new constructions for BIBDs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29767",
    "user": "@Ivo-Maffei"
}
```
CC:  dimpase

Keywords: bibd combinatorial-designs

Constructed the biplanes with parameters `(79,13,2)` and `(56,11,2)`.
The constructions are added to the `BIBD_constructions` dictionary in `sage.combinat.designs.database`.

After #29959, they will be available via `designs.balanced_incomplete_block_design`.

Issue created by migration from https://trac.sagemath.org/ticket/30004





---

archive/issue_comments_422796.json:
```json
{
    "body": "Why do you use `biplane` rather than `BIBD` in the new function names?\n(docstrings certainly should mention it).\n\nOne can also create a function `designs.biplane(k)`, with `k` being the biplane order,\nwhich would return an example for each `k` a construction is known to exist.\n\nAs to references, look up how it is done elsewhere in this file. You'd add\n\n```\n    REFERENCES:\n\n    .. [Aschbacher71] \\M. Aschbacher,\n      On collineation groups of symmetric block designs.\n      J. Combinatorial Theory Ser. A 11 (1971), pp. 272\u2013281.\n\n    .. [Hall71] \\M. Hall, Jr.,\n      Combinatorial designs and groups.\n      Actes du Congr\u00e8s International des Math\u00e9maticiens (Nice, 1970),\n      v.3, pp. 217\u2013222. Gauthier-Villars, Paris, 1971.\n```\n\n\nThis part must only appear once.\nAlso, add\n\n```\n# -*- coding: utf-8 -*-\n```\n\nas the 1st line of the file, as the 2nd reference uses utf-8.\n\n\nThen you can use tags\n`[Aschbacher71]_` and `[Hall71]_` to describe the history in the docstrings.\n(that the latter in particular fixed a typo in the former, etc)",
    "created_at": "2020-06-27T21:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422796",
    "user": "dimpase"
}
```

Why do you use `biplane` rather than `BIBD` in the new function names?
(docstrings certainly should mention it).

One can also create a function `designs.biplane(k)`, with `k` being the biplane order,
which would return an example for each `k` a construction is known to exist.

As to references, look up how it is done elsewhere in this file. You'd add

```
    REFERENCES:

    .. [Aschbacher71] \M. Aschbacher,
      On collineation groups of symmetric block designs.
      J. Combinatorial Theory Ser. A 11 (1971), pp. 272–281.

    .. [Hall71] \M. Hall, Jr.,
      Combinatorial designs and groups.
      Actes du Congrès International des Mathématiciens (Nice, 1970),
      v.3, pp. 217–222. Gauthier-Villars, Paris, 1971.
```


This part must only appear once.
Also, add

```
# -*- coding: utf-8 -*-
```

as the 1st line of the file, as the 2nd reference uses utf-8.


Then you can use tags
`[Aschbacher71]_` and `[Hall71]_` to describe the history in the docstrings.
(that the latter in particular fixed a typo in the former, etc)



---

archive/issue_comments_422797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T09:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422798.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T09:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422798",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422799.json:
```json
{
    "body": "I like the idea of a `biplane` function, I need a new ticket though. For testing that function I'll need the changes of #29959.\nCan I branch off that ticket or do I need to always branch from develop?",
    "created_at": "2020-06-29T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422799",
    "user": "@Ivo-Maffei"
}
```

I like the idea of a `biplane` function, I need a new ticket though. For testing that function I'll need the changes of #29959.
Can I branch off that ticket or do I need to always branch from develop?



---

archive/issue_comments_422800.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-29T09:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422800",
    "user": "@Ivo-Maffei"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422801.json:
```json
{
    "body": "Replying to [comment:6 gh-Ivo-Maffei]:\n> I like the idea of a `biplane` function, I need a new ticket though. For testing that function I'll need the changes of #29959.\n> Can I branch off that ticket or do I need to always branch from develop?\nit's perfectly fine, and actually safer, as the right merge is already done this way, to branch off that ticket (in this case it should be mentioned in `Dependencies:` field in the ticket description)",
    "created_at": "2020-06-29T10:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422801",
    "user": "dimpase"
}
```

Replying to [comment:6 gh-Ivo-Maffei]:
> I like the idea of a `biplane` function, I need a new ticket though. For testing that function I'll need the changes of #29959.
> Can I branch off that ticket or do I need to always branch from develop?
it's perfectly fine, and actually safer, as the right merge is already done this way, to branch off that ticket (in this case it should be mentioned in `Dependencies:` field in the ticket description)



---

archive/issue_comments_422802.json:
```json
{
    "body": "The code implementing the nonabelian group from scratch looks too complicated. It seems it's much easier to deal with this group as a subgroup of upper-triangular 2x2 matrices mod 11.\nIndeed, please check that the following matrices satisy the required relations \n\n```\nx=matrix(GF(11),[[1,1],[0,1]])\ny=matrix(GF(11),[[5,0],[0,9]])\nz=matrix(GF(11),[[-1,0],[0,1]])\n```\n",
    "created_at": "2020-06-29T12:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422802",
    "user": "dimpase"
}
```

The code implementing the nonabelian group from scratch looks too complicated. It seems it's much easier to deal with this group as a subgroup of upper-triangular 2x2 matrices mod 11.
Indeed, please check that the following matrices satisy the required relations 

```
x=matrix(GF(11),[[1,1],[0,1]])
y=matrix(GF(11),[[5,0],[0,9]])
z=matrix(GF(11),[[-1,0],[0,1]])
```




---

archive/issue_comments_422803.json:
```json
{
    "body": "Those matrices generate a group isomorphic to the one given.\nHowever, I'm still looking for some concrete representation of the `P_i`'s that would take advantage of the new group.\nI tried representing the `P_i`'s as vectors, projective points and matrices but with little luck.\nNow I'm looking at polynomials.\n\nIf I can't find anything, then to compute the action of a matrix on `P_i` I would need to decompose the matrix into `x,y,z` and end up doing most of the ugly operations I already do.",
    "created_at": "2020-06-29T14:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422803",
    "user": "@Ivo-Maffei"
}
```

Those matrices generate a group isomorphic to the one given.
However, I'm still looking for some concrete representation of the `P_i`'s that would take advantage of the new group.
I tried representing the `P_i`'s as vectors, projective points and matrices but with little luck.
Now I'm looking at polynomials.

If I can't find anything, then to compute the action of a matrix on `P_i` I would need to decompose the matrix into `x,y,z` and end up doing most of the ugly operations I already do.



---

archive/issue_comments_422804.json:
```json
{
    "body": "you can use subgroup cosets, just as in Aschbacher's paper.",
    "created_at": "2020-06-29T14:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422804",
    "user": "dimpase"
}
```

you can use subgroup cosets, just as in Aschbacher's paper.



---

archive/issue_comments_422805.json:
```json
{
    "body": "Thanks!\n\nIf I understand the paper correctly, the `P_i`'s are left abstract and the orbit of `P_i` is `G/H_i`, yet `P_i != I H_i` as otherwise `P_2 = P_3`.\nI was hoping for something more concrete, but I ended up reducing the action of `M` on `P_i` to basically be `P_i N` for a unique representative `N` of `M H_i`. Hence, I represent `P_i M` by the pair `(i, M)`.\n\nMy current implementation is extremely slow and it seems that the `quotient` method of `MatrixGroup` yields a `NotImplementedError`.\n\nI'm now moving everything to GAP. Soon I'll push the new method.",
    "created_at": "2020-06-29T15:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422805",
    "user": "@Ivo-Maffei"
}
```

Thanks!

If I understand the paper correctly, the `P_i`'s are left abstract and the orbit of `P_i` is `G/H_i`, yet `P_i != I H_i` as otherwise `P_2 = P_3`.
I was hoping for something more concrete, but I ended up reducing the action of `M` on `P_i` to basically be `P_i N` for a unique representative `N` of `M H_i`. Hence, I represent `P_i M` by the pair `(i, M)`.

My current implementation is extremely slow and it seems that the `quotient` method of `MatrixGroup` yields a `NotImplementedError`.

I'm now moving everything to GAP. Soon I'll push the new method.



---

archive/issue_comments_422806.json:
```json
{
    "body": "in GAP you need FactorCosetAction function, which can take any group G and its subgroup H of finite index, and construct the action on the cosets of H in G.",
    "created_at": "2020-06-29T16:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422806",
    "user": "dimpase"
}
```

in GAP you need FactorCosetAction function, which can take any group G and its subgroup H of finite index, and construct the action on the cosets of H in G.



---

archive/issue_comments_422807.json:
```json
{
    "body": "here is what you can do, with x,y,z as in comment:8:\n\n```\nsage: G=libgap(MatrixGroup([x,y,z]))\nsage: H=G.Subgroup([libgap(z)])\nsage: G.FactorCosetAction(H).Image()\n<permutation group of size 110 with 3 generators>\nsage: G.FactorCosetAction(H).Image().OrbitLength(1)\n55\n```\n",
    "created_at": "2020-06-29T17:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422807",
    "user": "dimpase"
}
```

here is what you can do, with x,y,z as in comment:8:

```
sage: G=libgap(MatrixGroup([x,y,z]))
sage: H=G.Subgroup([libgap(z)])
sage: G.FactorCosetAction(H).Image()
<permutation group of size 110 with 3 generators>
sage: G.FactorCosetAction(H).Image().OrbitLength(1)
55
```




---

archive/issue_comments_422808.json:
```json
{
    "body": "I've done something a bit different by preserving the homomorphism given by `FactorCosetAction` since I'll need a different action for each `P_i`. I've not pushed the changes yet because the tests are still running.",
    "created_at": "2020-06-29T18:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422808",
    "user": "@Ivo-Maffei"
}
```

I've done something a bit different by preserving the homomorphism given by `FactorCosetAction` since I'll need a different action for each `P_i`. I've not pushed the changes yet because the tests are still running.



---

archive/issue_comments_422809.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T18:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422809",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422810.json:
```json
{
    "body": "Can you use libgap.function_factory instead of libgap.eval, where appropriate?\n\nalso, libgap.set_global looks dodgy, do you really need it?",
    "created_at": "2020-06-29T19:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422810",
    "user": "dimpase"
}
```

Can you use libgap.function_factory instead of libgap.eval, where appropriate?

also, libgap.set_global looks dodgy, do you really need it?



---

archive/issue_comments_422811.json:
```json
{
    "body": "the way you describe intial blocks looks ugly, as they are unions of orbits of certain subgroups. There is no need to do explicit enumeration of elements of these subgroups.",
    "created_at": "2020-06-29T19:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422811",
    "user": "dimpase"
}
```

the way you describe intial blocks looks ugly, as they are unions of orbits of certain subgroups. There is no need to do explicit enumeration of elements of these subgroups.



---

archive/issue_comments_422812.json:
```json
{
    "body": "I changed the `eval`'s. I don't know how to get rid of the `set_global`'s as I need to give the actions a name to use inside the `function_factory`'s.\n\nAs far as the blocks are concerned, I can change `B1, B2, B3` to the below\n\n```\nB1 = list(libgap.Orbit(H4, p1, action)) + list(libgap.Orbit(G, p2, action))\nB2 = list(libgap.Orbit(H4, p1, action)) + list(libgap.Orbit(G, p3, action))\nB3 = list(libgap([p1, p2, p3])) + list(libgap.Orbit(libgap.Group(Y), action(p4, X), action)) + list(libgap.Orbit(libgap.Group(Y), action(p4, X**4), action))\nB1 = libgap.Set(B1)\nB2 = libgap.Set(B2)\nB3 = libgap.Set(B3)\n```\n\n\nI don't know how to write `B4` as unions of orbits.",
    "created_at": "2020-06-29T20:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422812",
    "user": "@Ivo-Maffei"
}
```

I changed the `eval`'s. I don't know how to get rid of the `set_global`'s as I need to give the actions a name to use inside the `function_factory`'s.

As far as the blocks are concerned, I can change `B1, B2, B3` to the below

```
B1 = list(libgap.Orbit(H4, p1, action)) + list(libgap.Orbit(G, p2, action))
B2 = list(libgap.Orbit(H4, p1, action)) + list(libgap.Orbit(G, p3, action))
B3 = list(libgap([p1, p2, p3])) + list(libgap.Orbit(libgap.Group(Y), action(p4, X), action)) + list(libgap.Orbit(libgap.Group(Y), action(p4, X**4), action))
B1 = libgap.Set(B1)
B2 = libgap.Set(B2)
B3 = libgap.Set(B3)
```


I don't know how to write `B4` as unions of orbits.



---

archive/issue_comments_422813.json:
```json
{
    "body": "`B4` is invariant under an element of order 2 (well, it's not a big saving, of course)",
    "created_at": "2020-06-29T21:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422813",
    "user": "dimpase"
}
```

`B4` is invariant under an element of order 2 (well, it's not a big saving, of course)



---

archive/issue_comments_422814.json:
```json
{
    "body": "Replying to [comment:18 gh-Ivo-Maffei]:\n> I changed the `eval`'s. I don't know how to get rid of the `set_global`'s as I need to give the actions a name to use inside the `function_factory`'s.\n\nUpdate the branch please, then I can comment on your latest code.",
    "created_at": "2020-06-29T22:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422814",
    "user": "dimpase"
}
```

Replying to [comment:18 gh-Ivo-Maffei]:
> I changed the `eval`'s. I don't know how to get rid of the `set_global`'s as I need to give the actions a name to use inside the `function_factory`'s.

Update the branch please, then I can comment on your latest code.



---

archive/issue_comments_422815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T08:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422815",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422816.json:
```json
{
    "body": "here is a bit of refactoring and simplification, but I believe it's better to combine all the actions into just one permutation action, and get rid of the points as pairs.\n\n```diff\ndiff --git a/src/sage/combinat/designs/database.py b/src/sage/combinat/designs/database.py\nindex 0fb34910a5..779e7873eb 100644\n--- a/src/sage/combinat/designs/database.py\n+++ b/src/sage/combinat/designs/database.py\n@@ -4618,22 +4618,12 @@ def BIBD_79_13_2():\n     libgap.set_global(\"p23Act\", P23Action)\n     libgap.set_global(\"p4Act\", P4Action)\n \n-    get_action = libgap.function_factory(\"\"\"ChooseMyAction := function(i)\n-        if i = 1 then\n-            return p1Act;\n-        elif i = 4 then\n-            return p4Act;\n-        else\n-            return p23Act;\n-        fi;\n-    end;\"\"\")\n-\n     action = libgap.function_factory(\"\"\"MyAction := function(pair, g)\n-        local i, C, hom;\n+        local i, C, homs;\n+        homs := [p1Act, p23Act, p23Act, p4Act];\n         i := pair[1];\n         C := pair[2];\n-        hom := ChooseMyAction(i);\n-        return [i, C^(ImageElm(hom,g))];\n+        return [i, C^(ImageElm(homs[i],g))];\n     end;\"\"\")\n \n     p1 = (1,1)\n@@ -4652,7 +4642,7 @@ def BIBD_79_13_2():\n           action(p4, X * Y**2), action(p4, X**-1 * Y**2), action(p4, X*Y), action(p4, X**-1 * Y),\n           action(p4, X**5 * Y), action(p4, X**-5 * Y), action(p4, X**5 * Y**4), action(p4, X**-5 * Y**4)])\n \n-    actionOnSet = libgap.function_factory(\"\"\"MyActionOnSets := function(block, g)\n+    actionOnSet = libgap.function_factory(\"\"\"function(block, g)\n         local set, p, q;\n         set := Set([]);\n         for p in block do\n@@ -4670,9 +4660,7 @@ def BIBD_79_13_2():\n     libgap.unset_global(\"p1Act\")\n     libgap.unset_global(\"p23Act\")\n     libgap.unset_global(\"p4Act\")\n-    libgap.unset_global(\"ChooseMyAction\")\n     libgap.unset_global(\"MyAction\")\n-    libgap.unset_global(\"MyActionOnSets\")\n     return blocks\n \n def BIBD_56_11_2():\n```\n",
    "created_at": "2020-06-30T11:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422816",
    "user": "dimpase"
}
```

here is a bit of refactoring and simplification, but I believe it's better to combine all the actions into just one permutation action, and get rid of the points as pairs.

```diff
diff --git a/src/sage/combinat/designs/database.py b/src/sage/combinat/designs/database.py
index 0fb34910a5..779e7873eb 100644
--- a/src/sage/combinat/designs/database.py
+++ b/src/sage/combinat/designs/database.py
@@ -4618,22 +4618,12 @@ def BIBD_79_13_2():
     libgap.set_global("p23Act", P23Action)
     libgap.set_global("p4Act", P4Action)
 
-    get_action = libgap.function_factory("""ChooseMyAction := function(i)
-        if i = 1 then
-            return p1Act;
-        elif i = 4 then
-            return p4Act;
-        else
-            return p23Act;
-        fi;
-    end;""")
-
     action = libgap.function_factory("""MyAction := function(pair, g)
-        local i, C, hom;
+        local i, C, homs;
+        homs := [p1Act, p23Act, p23Act, p4Act];
         i := pair[1];
         C := pair[2];
-        hom := ChooseMyAction(i);
-        return [i, C^(ImageElm(hom,g))];
+        return [i, C^(ImageElm(homs[i],g))];
     end;""")
 
     p1 = (1,1)
@@ -4652,7 +4642,7 @@ def BIBD_79_13_2():
           action(p4, X * Y**2), action(p4, X**-1 * Y**2), action(p4, X*Y), action(p4, X**-1 * Y),
           action(p4, X**5 * Y), action(p4, X**-5 * Y), action(p4, X**5 * Y**4), action(p4, X**-5 * Y**4)])
 
-    actionOnSet = libgap.function_factory("""MyActionOnSets := function(block, g)
+    actionOnSet = libgap.function_factory("""function(block, g)
         local set, p, q;
         set := Set([]);
         for p in block do
@@ -4670,9 +4660,7 @@ def BIBD_79_13_2():
     libgap.unset_global("p1Act")
     libgap.unset_global("p23Act")
     libgap.unset_global("p4Act")
-    libgap.unset_global("ChooseMyAction")
     libgap.unset_global("MyAction")
-    libgap.unset_global("MyActionOnSets")
     return blocks
 
 def BIBD_56_11_2():
```




---

archive/issue_comments_422817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T12:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422817",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422818.json:
```json
{
    "body": "I combined the action into 1 permutation action. I hope that is what you meant.\nI haven't run all tests on the above, but only checked that file. I'll do all the doctests when we reach a nice version of that function.",
    "created_at": "2020-06-30T12:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422818",
    "user": "@Ivo-Maffei"
}
```

I combined the action into 1 permutation action. I hope that is what you meant.
I haven't run all tests on the above, but only checked that file. I'll do all the doctests when we reach a nice version of that function.



---

archive/issue_comments_422819.json:
```json
{
    "body": "I think you better convert the block data into Sage's ZZ - at the moment they are still GAP integers (and also re-index from 0), as something goes wrong:\n\n```\nsage: designs.balanced_incomplete_block_design(79,13,2)\n---------------------------------------------------------------------------\nGAPError                                  Traceback (most recent call last)\n...\nAttributeError: 'sort' is not defined in GAP\n```\n",
    "created_at": "2020-06-30T13:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422819",
    "user": "dimpase"
}
```

I think you better convert the block data into Sage's ZZ - at the moment they are still GAP integers (and also re-index from 0), as something goes wrong:

```
sage: designs.balanced_incomplete_block_design(79,13,2)
---------------------------------------------------------------------------
GAPError                                  Traceback (most recent call last)
...
AttributeError: 'sort' is not defined in GAP
```




---

archive/issue_comments_422820.json:
```json
{
    "body": "this is a fix:\n\n```\ndiff --git a/src/sage/combinat/designs/database.py b/src/sage/combinat/designs/database.py\nindex ecc17faa54..2437c0362e 100644\n--- a/src/sage/combinat/designs/database.py\n+++ b/src/sage/combinat/designs/database.py\n@@ -4646,7 +4646,7 @@ def BIBD_79_13_2():\n     libgap.unset_global(\"p1Act\")\n     libgap.unset_global(\"p23Act\")\n     libgap.unset_global(\"p4Act\")\n-    return blocks\n+    return [[int(t)-1 for t in y] for y in blocks]\n \n def BIBD_56_11_2():\n     r\"\"\"\n```\n",
    "created_at": "2020-06-30T13:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422820",
    "user": "dimpase"
}
```

this is a fix:

```
diff --git a/src/sage/combinat/designs/database.py b/src/sage/combinat/designs/database.py
index ecc17faa54..2437c0362e 100644
--- a/src/sage/combinat/designs/database.py
+++ b/src/sage/combinat/designs/database.py
@@ -4646,7 +4646,7 @@ def BIBD_79_13_2():
     libgap.unset_global("p1Act")
     libgap.unset_global("p23Act")
     libgap.unset_global("p4Act")
-    return blocks
+    return [[int(t)-1 for t in y] for y in blocks]
 
 def BIBD_56_11_2():
     r"""
```




---

archive/issue_comments_422821.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-30T16:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422821",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422822.json:
```json
{
    "body": "subject to tests passing, this looks good.\nThere is one more bug (or perhaps something not implemented at all), for a follow-up ticket:\nremoving a block from a symmetric BIBD(v,k,l) should give BIBD(v-k,k-l,l),\nas by symmetry any 2 blocks intersect in l points, \nbut this does not work e.g. for BIBD_79_13_2, as\n\n```\nsage: designs.balanced_incomplete_block_design(66,11,2)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-23-f4a04be51fbf> in <module>()\n----> 1 designs.balanced_incomplete_block_design(Integer(66),Integer(11),Integer(2))\n\n/home/dimpase/sage/local/lib/python3.7/site-packages/sage/combinat/designs/bibd.py in balanced_incomplete_block_design(v, k, lambd, existence, use_LJCR)\n    270         return Unknown\n    271     else:\n--> 272         raise NotImplementedError(\"I don't know how to build a ({},{},{})-BIBD!\".format(v, k, lambd))\n    273 \n    274 def steiner_triple_system(n):\n\nNotImplementedError: I don't know how to build a (66,11,2)-BIBD!\n```\n",
    "created_at": "2020-06-30T23:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422822",
    "user": "dimpase"
}
```

subject to tests passing, this looks good.
There is one more bug (or perhaps something not implemented at all), for a follow-up ticket:
removing a block from a symmetric BIBD(v,k,l) should give BIBD(v-k,k-l,l),
as by symmetry any 2 blocks intersect in l points, 
but this does not work e.g. for BIBD_79_13_2, as

```
sage: designs.balanced_incomplete_block_design(66,11,2)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-23-f4a04be51fbf> in <module>()
----> 1 designs.balanced_incomplete_block_design(Integer(66),Integer(11),Integer(2))

/home/dimpase/sage/local/lib/python3.7/site-packages/sage/combinat/designs/bibd.py in balanced_incomplete_block_design(v, k, lambd, existence, use_LJCR)
    270         return Unknown
    271     else:
--> 272         raise NotImplementedError("I don't know how to build a ({},{},{})-BIBD!".format(v, k, lambd))
    273 
    274 def steiner_triple_system(n):

NotImplementedError: I don't know how to build a (66,11,2)-BIBD!
```




---

archive/issue_comments_422823.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-30T23:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422823",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422824.json:
```json
{
    "body": "I'm now running all tests.\nHowever, I'm a bit confused by your code examples, as on this branch the function `balanced_incomplete_block_design` only works for `lambda = 1`. Have you merged this with #29959 to run the tests? (that's actually a great idea, so I'll run the tests on this merged version)\n\nAnyway, the `balanced_incomplete_block_design` code doesn't seem to include the recursive construction you mentioned.\nI'll make a small ticket for it.",
    "created_at": "2020-07-01T09:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422824",
    "user": "@Ivo-Maffei"
}
```

I'm now running all tests.
However, I'm a bit confused by your code examples, as on this branch the function `balanced_incomplete_block_design` only works for `lambda = 1`. Have you merged this with #29959 to run the tests? (that's actually a great idea, so I'll run the tests on this merged version)

Anyway, the `balanced_incomplete_block_design` code doesn't seem to include the recursive construction you mentioned.
I'll make a small ticket for it.



---

archive/issue_comments_422825.json:
```json
{
    "body": "Replying to [comment:29 gh-Ivo-Maffei]:\n> I'm now running all tests.\n> However, I'm a bit confused by your code examples, as on this branch the function `balanced_incomplete_block_design` only works for `lambda = 1`. Have you merged this with #29959 to run the tests? (that's actually a great idea, so I'll run the tests on this merged version)\n\nyes, sure. I've made #29959 a dependency of this ticket.",
    "created_at": "2020-07-01T10:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422825",
    "user": "dimpase"
}
```

Replying to [comment:29 gh-Ivo-Maffei]:
> I'm now running all tests.
> However, I'm a bit confused by your code examples, as on this branch the function `balanced_incomplete_block_design` only works for `lambda = 1`. Have you merged this with #29959 to run the tests? (that's actually a great idea, so I'll run the tests on this merged version)

yes, sure. I've made #29959 a dependency of this ticket.



---

archive/issue_comments_422826.json:
```json
{
    "body": "So I finally finished testing this branch merged with #29959 and all tests pass.",
    "created_at": "2020-07-01T12:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422826",
    "user": "@Ivo-Maffei"
}
```

So I finally finished testing this branch merged with #29959 and all tests pass.



---

archive/issue_comments_422827.json:
```json
{
    "body": "OK, all clear.",
    "created_at": "2020-07-01T14:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422827",
    "user": "dimpase"
}
```

OK, all clear.



---

archive/issue_comments_422828.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29767",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29767#issuecomment-422828",
    "user": "vbraun"
}
```

Resolution: fixed
