# Issue 21952: Document SSL dependency, recommend OpenSSL

Issue created by migration from https://trac.sagemath.org/ticket/22189

Original creator: charpent

Original creation time: 2017-01-15 08:24:23

The motivation has been [discussed](https://groups.google.com/d/msg/sage-devel/jdLfIKQ1M18/LJq-rc2rCgAJ) [numerous](https://groups.google.com/d/msg/sage-devel/92OdoUbBDbE/Uwq78LmxAgAJ) [times](https://groups.google.com/d/msg/sage-devel/JPpJvUpP1TQ/qaZZsdiiCgAJ), and has become a somewhat urgent matter now that R [stopped](https://groups.google.com/d/msg/sage-devel/QaBdHSNJuKg/O_Cl6aMSAwAJ) providing its own implementation.

This ticket aims at documenting this [long known](https://groups.google.com/d/msg/sage-devel/31Snpxt66mU/SZFRClSCrqgJ) dependency, recommend using OpenSSL system-wide and document the possibility of compiling against other libraries with reduced functionality.

it depends on #22058, to allow for successful build against OpenSSL>1.1 (see [this report](https://groups.google.com/d/msg/sage-release/tre-0olasxI/HfYY4anXCAAJ)) : we cannot decently recommend a library if its newer version breaks Sage building...

This ticket does not aim to modify any code, only the documentation (`README.md` and the Sage Installation Guide).


---

Comment by charpent created at 2017-01-15 12:00:10

Initial proposition.

I noted a few inconsistencies/inecxactitudes while revising the text. I did **not** try to fix them : they require more information and belong to other tickets :

* I'm surprised to see Python as a prequisite in `$SAGE_ROOT/src/doc/en/installation/source.rst`...

* Are the instruction about moving the Sage tree still valid ? Somehow, I doubt it !

* Is a system git a prerequisite (as `$SAGE_ROOT/src/doc/en/installation/source.rst` seem to imply)  or not ? If so, having a `git` package is pointless...


---

Comment by charpent created at 2017-01-15 14:16:04

Changing status from new to needs_review.


---

Comment by charpent created at 2017-01-15 14:16:04

Forgot to add :

1. The resulting Sage passes ptestlong with two failures :

```
----------------------------------------------------------------------
sage -t --long --warn-long 119.0 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 119.0 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
```


The first one is transient (test passes fine when run standalone), the second one is an already-known problem.

2. Forgot to set `needs_review`


---

Comment by saraedum created at 2017-01-24 21:45:14

At the end it should now probably say "Sage 7.6". Feel free to set to positive review once this is fixed.


---

Comment by git created at 2017-01-24 22:45:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-01-24 22:51:33

Replying to [comment:4 saraedum]:
> At the end it should now probably say "Sage 7.6".

Done.

> Feel free to set to positive review once this is fixed.

I'd rather follow the basic requirement of no self-review : it's a basic safeguard against hubris, and, as all basic rules, it can have any value if and only if rigidly followed...


---

Comment by saraedum created at 2017-01-24 22:55:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-25 23:55:12

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-01-25 23:55:12

Author is missing...


---

Comment by charpent created at 2017-01-26 14:32:54

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2017-01-26 14:32:54

Replying to [comment:8 vbraun]:
> Author is missing...

Wups !

Done...


---

Comment by tscrim created at 2017-01-26 14:54:06

Looks like you picked up a merge conflict with the next beta. (For future reference, missing author/review name can immediately be set back to positive review.)


---

Comment by charpent created at 2017-01-26 22:24:41

Replying to [comment:10 tscrim]:
> Looks like you picked up a merge conflict with the next beta.

What do you mean ?

> (For future reference, missing author/review name can immediately be set back to positive review.)

Done. Thanks.


---

Comment by charpent created at 2017-01-26 22:24:41

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-01-26 22:27:35

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-01-26 22:27:35

Replying to [comment:11 charpent]:
> Replying to [comment:10 tscrim]:
> > Looks like you picked up a merge conflict with the next beta.
> 
> What do you mean ?

The branch is red, so there is (almost certainly) a non-trivial with the latest beta (`7.6.beta1`).


---

Comment by git created at 2017-01-31 14:24:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by charpent created at 2017-01-31 14:27:42

I squashed the two commits and forced a push. This should fix the merge problem.


---

Comment by charpent created at 2017-01-31 14:30:41

Replying to [comment:15 charpent]:
> I squashed the two commits and forced a push. This should fix the merge problem.

No, it doesn't : there is still a merge conflict, requiring to manually pick the "right" versin of the last line of `src/doc/en/installation/source.rst` (i. e. what was fixed by [the second commit](https://git.sagemath.org/sage.git/commit/?id=a37c08e12c28568985e1269ce25cfabbb3b26871)). I do not understand why, and I'm stuck.


---

Comment by tscrim created at 2017-01-31 14:51:01

I fixed the (trivial) merge conflict with 7.6.beta1.
----
New commits:


---

Comment by tscrim created at 2017-01-31 14:51:01

Changing status from needs_work to positive_review.


---

Comment by aapitzsch created at 2017-01-31 18:50:02

There is a typo in

```
Sage's ``-pip`` facility (used to install some Sage packages) is
disabled when Sage is compiled agaonst those libraries.
```


_agaonst_ -> _against_


---

Comment by aapitzsch created at 2017-01-31 18:50:02

Changing status from positive_review to needs_work.


---

Comment by charpent created at 2017-01-31 23:07:43

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2017-01-31 23:07:43

Replying to [comment:18 aapitzsch]:
> There is a typo in
> {{{
> Sage's ``-pip`` facility (used to install some Sage packages) is
> disabled when Sage is compiled agaonst those libraries.
> }}}
> 
> _agaonst_ -> _against_

Done. Fixed a couple of other typos.

Passes ptestlong. `needs_review`.
----
New commits:


---

Comment by tscrim created at 2017-02-01 00:06:06

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-02-01 00:06:06

Latest changes LGTM.


---

Comment by vbraun created at 2017-02-02 22:09:26

Resolution: fixed


---

Comment by jhpalmieri created at 2017-03-14 18:13:20

What part of the Sage build will break without `ssl`? Shouldn't we check for the presence of `ssl` in the top-level `configure` script and bail out right away if it's missing, rather than let Sage build for an hour or two before failing?


---

Comment by charpent created at 2017-03-14 18:41:49

Replying to [comment:23 jhpalmieri]:
> What part of the Sage build will break without `ssl`?

* R will fail to build without an https-capable SSL
* Python won't fail overtly, but the resulting pip won't be able to install or list packages in https-accessed  repositories : nowadays, that means all pip directories.
* ISTR thython license mention this and warns about "reduced functionalities".

The python license recommends openssl ; my tests showed that GnuTLS is able to create a functional R (but not a functional pip). Hence the dependency on "an SSL implementation) and the recommendation of OpenSSL. I didn't test the nss library...

> Shouldn't we check for the presence of `ssl` in the top-level `configure` script and bail out right away if it's missing, rather than let Sage build for an hour or two before failing?

Indeed. But I don't know how (yet) how to do it cleanly (it is easy to test for OpenSSL, not so much for either OpenSSL or GnuTLS...). If I can find or devise a relevant minimal  test program, I'll propose to add this test in the master configure file. If you have ideas...

Hope this helps,


---

Comment by jhpalmieri created at 2017-03-14 18:49:28

I would suggest using `python -c 'import ssl'` (using the system's Python), but this succeeds on my OS X box on which I just uninstalled Sage's version of `openssl`, in order to test #22252. I don't know why it succeeds, but in any case, it's not a good test.


---

Comment by charpent created at 2017-03-14 22:59:10

Replying to [comment:25 jhpalmieri]:
> I would suggest using `python -c 'import ssl'` (using the system's Python), but this succeeds on my OS X box on which I just uninstalled Sage's version of `openssl`, in order to test #22252. I don't know why it succeeds,

Don't you have some SSL library installed systemwide ? OpenSSL is pretty ubiquitous nowadays (even on Debian base (not desktop !) systems, to the dismay of Jeroen Demeyer....)

> but in any case, it's not a good test.

Indeed. What I need is a program testing a library common to (at least) OpenSSL and GnuTLS, and able to test the "https-worthiness" of a library. Not exactly a trivial request...


---

Comment by jhpalmieri created at 2017-03-14 23:28:32

Replying to [comment:26 charpent]:
> Replying to [comment:25 jhpalmieri]:
> > I would suggest using `python -c 'import ssl'` (using the system's Python), but this succeeds on my OS X box on which I just uninstalled Sage's version of `openssl`, in order to test #22252. I don't know why it succeeds,
> 
> Don't you have some SSL library installed systemwide ? OpenSSL is pretty ubiquitous nowadays (even on Debian base (not desktop !) systems, to the dismay of Jeroen Demeyer....)

I apparently do, since the system Python picks up something. I can't actually find it myself, nor does Sage's Python when it builds, since `import ssl` fails for it.


---

Comment by jdemeyer created at 2017-03-16 14:07:26

I don't understand why this ticket got positive review. Sage does not depend on OpenSSL, so why document that it does? It might be recommended, but certainly not required. See #22620 for a follow-up.


---

Comment by dimpase created at 2017-03-16 15:19:26

interestingly, curl sources include [vtls](https://github.com/curl/curl/tree/master/lib/vtls), (almost) an API to do (the client side of) TLS/SSL with different backends, e.g. DarwinSSL, OpenSSL (and a dozen others).


---

Comment by charpent created at 2017-03-16 15:22:34

Replying to [comment:29 dimpase]:
> interestingly, curl sources include [vtls](https://github.com/curl/curl/tree/master/lib/vtls), (almost) an API to do (the client side of) TLS/SSL with different backends, e.g. DarwinSSL, OpenSSL (and a dozen others).

Do you think that this might ofar a solution to Jeroen's conudrum ? And our Mac OS/X woes ?


---

Comment by charpent created at 2017-03-16 15:33:56

Replying to [comment:28 jdemeyer]:
> I don't understand why this ticket got positive review. Sage does not depend on OpenSSL, so why document that it does?

Because [Python does](https://docs.python.org/3/license.html#openssl). Because [R needs curl](https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Essential-programs-and-libraries), which does need (some) SSL to reach https repositories.

> It might be recommended, but certainly not required.

Indeed. The current documentation requires some SSL library and recommends OpenSSL : not quite the same thing. 

I also proved conclusively that :
* GnuTLS allowed for the successfil compilation of a https-capable R an
* that this GnuTLL library is insufficient for a functional pip.

> See #22620 for a follow-up.

See #22620 for my judgemement on this edit war...


---

Comment by dimpase created at 2017-03-16 16:08:42

Replying to [comment:30 charpent]:
> Replying to [comment:29 dimpase]:
> > interestingly, curl sources include [vtls](https://github.com/curl/curl/tree/master/lib/vtls), (almost) an API to do (the client side of) TLS/SSL with different backends, e.g. DarwinSSL, OpenSSL (and a dozen others).
> 
> Do you think that this might ofar a solution to Jeroen's conudrum ? And our Mac OS/X woes ?

It is sure a fun project to allow python's `_ssl` to use it, but it is a lot of work...
