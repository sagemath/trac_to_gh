# Issue 34176: implement derivatives of lazy series

Issue created by migration from https://trac.sagemath.org/ticket/34413

Original creator: mantepse

Original creation time: 2022-08-23 10:31:32

CC:  tscrim




---

Comment by git created at 2022-08-23 15:34:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-23 20:20:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-08-23 20:23:30

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by mantepse created at 2022-08-23 20:23:30

Changing keywords from "" to "LazyPowerSeries".


---

Comment by mantepse created at 2022-08-23 20:23:30

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2022-08-23 21:25:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-08-24 21:22:42

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-08-25 00:19:59

I don't think there is anything we need to worry about with regards to analytic stuff (since there is an assumption the derivatives commute), but I want to confirm you also think so too.

Also you have empty `INPUT:` blocks. Either remove, add the inputs, or provide a link to something that explains how to parse the inputs.


---

Comment by mantepse created at 2022-08-30 11:11:42

Replying to [comment:9 tscrim]:
> I don't think there is anything we need to worry about with regards to analytic stuff (since there is an assumption the derivatives commute), but I want to confirm you also think so too.

That's correct.

> Also you have empty `INPUT:` blocks. Either remove, add the inputs, or provide a link to something that explains how to parse the inputs.

Done.

Besides, I now know of a way to make sense of

```
sage: L.<x,y> = LazySymmetricFunction(SymmetricFunctions(QQ).s())
sage: f = 1/(1-x*y)
```


The natural thing is to set `x = tensor([s[1], s[0]])` and `y = tensor([s[0], s[1]])`.  Doing so, also

```
sage: f.derivative(x, 2, y)
```

makes sense.  In fact, this is what we do all the time in the doctests anyway.


---

Comment by git created at 2022-08-30 11:31:15

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-08-30 14:53:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-30 14:57:05

Replying to [comment:10 mantepse]:
> Replying to [comment:9 tscrim]:
> Besides, I now know of a way to make sense of
> {{{
> sage: L.<x,y> = LazySymmetricFunction(SymmetricFunctions(QQ).s())
> sage: f = 1/(1-x*y)
> }}}
> 
> The natural thing is to set `x = tensor([s[1], s[0]])` and `y = tensor([s[0], s[1]])`.  Doing so, also
> {{{
> sage: f.derivative(x, 2, y)
> }}}
> makes sense.  In fact, this is what we do all the time in the doctests anyway.

I agree that it makes a little bit of sense to think of the variable as a the unique degree one element (up to scalar). However, this would be a hack IMO because the degree one elements do not generate the ring of symmetric functions (as it is a freely generated by e<sub>i</sub>). So the result of `gens()` would be wrong if it was the degree one elements. Now a way to explain yourself out of this is that the `R.<x,y>` type syntax returns the first (in some ordering) `n` generators.

I still do not think this extra little agreement with a completely different class (where I expect no such compatibility) and implementation is worth all of this extra complexity and effort. Although I won’t oppose it because you are not going to create some extra class for the variables (at least, judging by what you’re saying). However, to me it adds to maintenance costs without a clear benefit.

Actually, isn’t what is happening just a renaming of “skew_by“? Will that be implemented here too?


---

Comment by mantepse created at 2022-08-30 15:17:12

you never sleep, do you?

Yes, this is `skey_by(p[1])`.

Indeed, it is a bit unclear to me whether it makes sense to implement all the methods on `SymmetricFunctions` also on `LazySymmetricFunctions`.  It would be nicer to have an automatism for those which are graded maps.

However, that's almost certainly for a different project.


---

Comment by tscrim created at 2022-08-31 01:50:55

Replying to [comment:14 mantepse]:
> you never sleep, do you?

I wanted to convey my thoughts while you were still awake in case you wanted to respond.

> Yes, this is `skey_by(p[1])`.

It seems like that is your mathematical model is disguise. It just happens to have all of the other usual derivative properties when doing `p[1]`.

> Indeed, it is a bit unclear to me whether it makes sense to implement all the methods on `SymmetricFunctions` also on `LazySymmetricFunctions`.  It would be nicer to have an automatism for those which are graded maps.
> 
> However, that's almost certainly for a different project.

I think we can port them over as we find them to be useful.

Anyways, for follow-up tickets.

Can you add the following tests:

(For exact series with nonzero constant)

```
sage: L.<z> = LazyLaurentSeriesRing(ZZ)
sage: f = L([1,2], valuation=-2, constant=1)
sage: f
z^-2 + 2*z^-1 + 1 + z + z^2 + O(z^3)
sage: f.derivative()
-2*z^-3 - 2*z^-2 + 1 + 2*z + 3*z^2 + 4*z^3 + O(z^4)
```


Calculus rules (up to an implicit sign choice):

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: log(1-z).derivative()
-1 - z - z^2 - z^3 - z^4 - z^5 - z^6 + O(z^7)
```

Side note: This doesn't work over `ZZ` because we are too greedy about converting things to the ring. Indeed, the failure for `ZZ` stems from

```
sage: L.<z> = LazyLaurentSeriesRing(ZZ)
sage: log(1-z)
<repr(<sage.rings.lazy_series_ring.LazyLaurentSeriesRing_with_category.element_class at 0x7f2c90572c80>) failed: TypeError: no conversion of this rational to integer>
```

This is the only stream that is forcing the output to be in a particular ring and an explicit example about why we shouldn't do that in `Stream`s. We should change this on a separate ticket (or here if you want).


---

Comment by git created at 2022-08-31 19:08:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-31 20:31:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-09-01 12:30:58

Thank you.


---

Comment by tscrim created at 2022-09-01 12:30:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-09-21 22:45:39

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-09-21 22:45:39


```
sage -t --long --warn-long 46.9 --random-seed=123 src/sage/combinat/sf/sfa.py
**********************************************************************
File "src/sage/combinat/sf/sfa.py", line 3139, in sage.combinat.sf.sfa.SymmetricFunctionAlgebra_generic_Element.plethysm
Failed example:
    s(2*T.one())
Expected:
    (2*B[word:]#B[word:])*s[]
Got:
    (2*B[]#B[])*s[]
^CKilling test src/sage/combinat/sf/sfa.py
----------------------------------------------------------------------
Doctests interrupted: 0/1 files tested
----------------------------------------------------------------------
```



---

Comment by tscrim created at 2022-09-22 03:44:22

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2022-09-22 03:44:22

The doctest fails due to changes in #34494. Trivial doctest update.


---

Comment by git created at 2022-09-22 03:44:39

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by git created at 2022-09-22 03:44:39

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2022-09-22 03:44:57

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-09-22 03:44:57

Slightly too fast with updating the ticket.


---

Comment by git created at 2022-09-22 22:41:46

Changing status from positive_review to needs_review.


---

Comment by git created at 2022-09-22 22:41:46

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by git created at 2022-09-22 22:47:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2022-09-22 22:49:23

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-09-22 22:49:23

Trivial update of #34383, which should have had the #34494 change instead.


---

Comment by vbraun created at 2022-09-27 22:31:33

Resolution: fixed
