# Issue 20528: load not working via https

Issue created by migration from Trac.

Original creator: mderickx

Original creation time: 2016-06-02 23:01:01

CC:  mstreng

In the file `src/sage/structure/sage_object` there is the following doctest

```
sage: u = 'http://sage.math.washington.edu/home/was/db/test.sobj'
sage: s = load(u)
```

The doctest passes without problems, but executing the doctest manually fails, probably because of circular imports


```
lll:sage4 maarten$ ./sage -t --warn-long 34.5 src/sage/structure/sage_object.pyx
Running doctests with ID 2016-06-03-00-49-24-4048fd29.
Git branch: master
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t --warn-long 34.5 src/sage/structure/sage_object.pyx
    [204 tests, 8.22 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 8.8 seconds
    cpu time: 5.3 seconds
    cumulative wall time: 8.2 seconds
lll:sage4 maarten$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.2, Release Date: 2016-05-15                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: u = 'http://sage.math.washington.edu/home/was/db/test.sobj'
sage: s = load(u)
Attempting to load remote file: http://sage.math.washington.edu/home/was/db/test.sobj
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-2-3316b4211d6a> in <module>()
----> 1 s = load(u)

/Applications/sage4/src/sage/structure/sage_object.pyx in sage.structure.sage_object.load (/Applications/sage4/src/build/cythonized/sage/structure/sage_object.c:11530)()
   1023     if lower.startswith("http://") or lower.startswith("https://"):
   1024         from sage.misc.remote_file import get_remote_file
-> 1025         filename = get_remote_file(filename, verbose=verbose)
   1026         tmpfile_flag = True
   1027     else:

/Applications/sage4/local/lib/python2.7/site-packages/sage/misc/remote_file.pyc in get_remote_file(filename, verbose)
     34 
     35     # import compatible with py2 and py3
---> 36     from six.moves.urllib.request import urlretrieve
     37 
     38     global cur

ImportError: No module named moves.urllib.request
```



---

Comment by mderickx created at 2016-08-04 21:13:30

Actually the problem is already in `get_remote_file` which is called by `load`


```
sage: get_remote_file("http://sagemath.org/ack.html", verbose=False)
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-2-ea188b81d472> in <module>()
----> 1 get_remote_file("http://sagemath.org/ack.html", verbose=False)

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/remote_file.pyc in get_remote_file(filename, verbose)
     34 
     35     # import compatible with py2 and py3
---> 36     from six.moves.urllib.request import urlretrieve
     37 
     38     global cur

ImportError: No module named moves.urllib.request
```



---

Comment by mderickx created at 2016-12-16 21:03:36

It seems like the culprit is that someone added a six.py file in misc so that the import is now importing from the local six.py file instead of the actual six file!


---

Comment by mderickx created at 2016-12-16 21:08:42

I found the solution. There is a [stackoverflow question](http://stackoverflow.com/questions/6031584/importing-from-builtin-library-when-module-with-same-name-exists) which answers how to get the system module. This is done by adding: `from __future__ import absolute_import` at the top of `remote_file.py`. I tested this and this indeed solves the problem. The thing I don't get though is how the doctest passes even before fixing this bug.


---

Comment by mderickx created at 2016-12-17 16:13:42

Seems like it is already fixed in #20797 so this ticket can be closed.


---

Comment by mderickx created at 2016-12-17 16:13:42

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-12-17 17:22:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 18:03:11

Resolution: invalid
