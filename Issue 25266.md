# Issue 25266: Allow the use of system's R installation

Issue created by migration from https://trac.sagemath.org/ticket/25503

Original creator: tmonteil

Original creation time: 2018-06-04 10:07:59

CC:  charpent embray fbissey kcrisman slelievre @timokau mjo

The aim of this ticket is to allow Sage to use the system's `R`, instead of building its own.

It should work for:
- `sage -R` command
- Sage's `r` interface
- Sage's `rpy2` Python package
- Sage's jupyter `IRkernel`

As for atlas, it is done by setting the ``SAGE_R_LIB`` environment variable.


---

Comment by tmonteil created at 2018-06-04 12:52:38

New commits:


---

Comment by tmonteil created at 2018-06-04 12:52:38

Changing status from new to needs_review.


---

Comment by tmonteil created at 2018-06-04 15:11:43

We should probably also update `sage-env` script, which explicitly unset `R`-related variables that the user could set in relation with system-wide install.


---

Comment by slelievre created at 2018-06-04 18:03:52

Changing keywords from "" to "R".


---

Comment by novoselt created at 2018-06-04 18:40:04

So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up? With its own R Sage makes sure that nothing is used.


---

Comment by tmonteil created at 2018-06-04 18:48:55

Replying to [comment:6 novoselt]:
> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?

I would say yes (see my last comment about `sage-env`), though i might be wrong. I guess that if a user explicitly ask Sage to use system-wide `R`, it means that she want to keep all control (e.g. on where to install things, etc).


---

Comment by tmonteil created at 2018-07-17 16:04:55

Replying to [comment:6 novoselt]:
> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?

Yes.

> With its own R Sage makes sure that nothing is used.

It is up to the user to decide whether she wants to use the system's R or Sage's R, the default remains to build and use Sage's R.


---

Comment by saraedum created at 2018-10-14 19:22:50

I would be curious to hear embray's opinion on this. I know that he has been working on allowing to use system packages more generally.

Btw, there are merge conflicts.


---

Comment by saraedum created at 2018-10-14 19:22:50

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2018-10-14 21:10:57

Why should this work for the `sage -R` command? That command is explicitly documented (as in `sage --help` and in [the reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) to "run Sage's R with given arguments", so why should it run a non-Sage R? Maybe I'm misunderstanding.

I think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.

But if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.


---

Comment by fbissey created at 2018-10-14 21:18:40

I never changed those help messages in sage-on-gentoo. There is an ambiguity I am exploiting. You think it only means R from sage the distribution, I take it to mean R that sage has been configured to use. You could argue that the capitalisation means we are talking about the distribution.

Should we have a semantic war :)

In any case, while there is no real benefit, compared to running R directly, I don't see why the behavior shouldn't be preserved. Existing scripts shouldn't break because you changed some underlying bits.


---

Comment by fbissey created at 2018-10-14 22:02:56

Seriously, if changing the documentation is your only problem with this, I'd be glad to just do that. Do you have a preferred wording?


---

Comment by jhpalmieri created at 2018-10-15 04:34:35

I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.


---

Comment by fbissey created at 2018-10-15 04:38:53

Replying to [comment:14 jhpalmieri]:
> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.

So you don't think we should support people with old script that may call `sage -R`? You want those people to update?


---

Comment by jhpalmieri created at 2018-10-15 05:35:00

If Sage is not going to install a copy of `R`, then you could rewrite the main `sage` script so that `sage -R` prints a deprecation warning before executing the system's R`.

I don't really buy your ambiguity argument, and I think that you are misleading people if `sage -R` runs a version of R which was not installed by Sage. (There is also the slim chance that it won't work and people will report errors from running `sage -R` to Sage developers, or (even worse) silently blame us for the problem, when it has nothing to do with us.)

How many people really use commands like `sage -R`? Maybe they should all be deprecated, and people should be encouraged to put `SAGE_ROOT/local/bin` in their path or instead to use `sage --sh -c blah`, where `blah` can be `R` or `python` or `ecl` or ...

If you really want to proceed, note that `sage -h` contains

```
  -cython [...]       -- run Cython with given arguments
  -ecl [...]          -- run Common Lisp
  -gap [...]          -- run Sage's Gap with given arguments
```

so maybe they should all omit "Sage's". I won't be happy with that change, so you'll need another reviewer, and I also think you should ask for more opinions.


---

Comment by @timokau created at 2018-10-16 08:26:08

For what its worth I agree with `@`fbissey's interpretation. Even a distro can have multiple versions of a dependency installed. Sometimes it can be useful to "start the R sage uses", for example for debugging.


---

Comment by slelievre created at 2018-10-16 09:13:51

I would also agree with interpreting "Sage's R" as "the R that Sage has been configured to use",
and similarly for GAP, PARI/GP, Singular, etc.


---

Comment by fbissey created at 2018-10-16 09:22:36

I think John feels very strongly about his interpretation. The heart of his argument being if it says it is sage's own, the sage devs owns the bugs.  As distros guys we all know where to stand about that. 

Sometimes it is your own bugs (build system, distro specificities) and sometimes it belong to upstream. In any case you may carry patches and sage-the-distro has a long history about "owning" its own patches regardless of upstream as you well know.

In any case piping on the matter on sage-devel doesn't cost us much since it is now, in effect, a sage-8.5 ticket.


---

Comment by @timokau created at 2018-10-16 16:01:45

I don't feel very strongly about it either way, maybe printing a clear information (either "this is a sage package" or "this is a system package") first is a good compromise.


---

Comment by embray created at 2018-10-28 16:03:32

Replying to [comment:11 jhpalmieri]:
> I think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.
> 
> But if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.

I disagree.  I think these commands should really just mean "run the same Python/R/etc. that Sage is using, with all the sage-related environment variables set".


---

Comment by embray created at 2018-10-28 16:06:41

Replying to [comment:14 jhpalmieri]:
> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.

That's not true that there is no reason for it.  For example, what if you want to run R in the Sage environment so that you can run sage commands in R with RPy?  Or interface with other software that is included in the Sage distribution?  From the user's perspective, `sage -R` means "launch the R that sage is using".  It's transparent/irrelevant whether or not the R command happened to be included in the Sage distribution or not.  For downstream distributions (e.g. on Debian, Gentoo) they are all using the system's copies of programs as much as possible, so you'll just have confused users who find that `sage -R` works on some system but not others.


---

Comment by tmonteil created at 2019-08-27 19:45:19

Changing keywords from "R" to "R, sdl".


---

Comment by dimpase created at 2019-12-15 00:52:01

I've opened #28884 with a working (on Debian at least) branch allowing use of system's R.

Feel free to review.


---

Comment by mjo created at 2020-03-18 23:26:29

Is there still anything to do here? I don't really use R inside or outside of sage... has #28884 caused any problems?


---

Comment by dimpase created at 2020-03-19 03:44:04

not sure about Jupyter kernel for R, but this is a different story. A new ticket, if you must.


---

Comment by dimpase created at 2020-03-19 03:44:04

Changing status from needs_work to positive_review.


---

Comment by chapoton created at 2020-03-27 15:07:21

Resolution: duplicate
