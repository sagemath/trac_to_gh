# Issue 25266: Allow the use of system's R installation

archive/issues_025266.json:
```json
{
    "body": "CC:  charpent embray fbissey kcrisman slelievre @timokau mjo\n\nThe aim of this ticket is to allow Sage to use the system's `R`, instead of building its own.\n\nIt should work for:\n- `sage -R` command\n- Sage's `r` interface\n- Sage's `rpy2` Python package\n- Sage's jupyter `IRkernel`\n\nAs for atlas, it is done by setting the ``SAGE_R_LIB`` environment variable.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25503\n\n",
    "created_at": "2018-06-04T10:07:59Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "Allow the use of system's R installation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25266",
    "user": "tmonteil"
}
```
CC:  charpent embray fbissey kcrisman slelievre @timokau mjo

The aim of this ticket is to allow Sage to use the system's `R`, instead of building its own.

It should work for:
- `sage -R` command
- Sage's `r` interface
- Sage's `rpy2` Python package
- Sage's jupyter `IRkernel`

As for atlas, it is done by setting the ``SAGE_R_LIB`` environment variable.

Issue created by migration from https://trac.sagemath.org/ticket/25503





---

archive/issue_comments_356131.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-04T12:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356131",
    "user": "tmonteil"
}
```

New commits:



---

archive/issue_comments_356132.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-04T12:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356132",
    "user": "tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356133.json:
```json
{
    "body": "We should probably also update `sage-env` script, which explicitly unset `R`-related variables that the user could set in relation with system-wide install.",
    "created_at": "2018-06-04T15:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356133",
    "user": "tmonteil"
}
```

We should probably also update `sage-env` script, which explicitly unset `R`-related variables that the user could set in relation with system-wide install.



---

archive/issue_comments_356134.json:
```json
{
    "body": "Changing keywords from \"\" to \"R\".",
    "created_at": "2018-06-04T18:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356134",
    "user": "slelievre"
}
```

Changing keywords from "" to "R".



---

archive/issue_comments_356135.json:
```json
{
    "body": "So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up? With its own R Sage makes sure that nothing is used.",
    "created_at": "2018-06-04T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356135",
    "user": "novoselt"
}
```

So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up? With its own R Sage makes sure that nothing is used.



---

archive/issue_comments_356136.json:
```json
{
    "body": "Replying to [comment:6 novoselt]:\n> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?\n\nI would say yes (see my last comment about `sage-env`), though i might be wrong. I guess that if a user explicitly ask Sage to use system-wide `R`, it means that she want to keep all control (e.g. on where to install things, etc).",
    "created_at": "2018-06-04T18:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356136",
    "user": "tmonteil"
}
```

Replying to [comment:6 novoselt]:
> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?

I would say yes (see my last comment about `sage-env`), though i might be wrong. I guess that if a user explicitly ask Sage to use system-wide `R`, it means that she want to keep all control (e.g. on where to install things, etc).



---

archive/issue_comments_356137.json:
```json
{
    "body": "Replying to [comment:6 novoselt]:\n> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?\n\nYes.\n\n> With its own R Sage makes sure that nothing is used.\n\nIt is up to the user to decide whether she wants to use the system's R or Sage's R, the default remains to build and use Sage's R.",
    "created_at": "2018-07-17T16:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356137",
    "user": "tmonteil"
}
```

Replying to [comment:6 novoselt]:
> So - if a system-wide install is used, does it mean that the standard R configuration files will be picked up?

Yes.

> With its own R Sage makes sure that nothing is used.

It is up to the user to decide whether she wants to use the system's R or Sage's R, the default remains to build and use Sage's R.



---

archive/issue_comments_356138.json:
```json
{
    "body": "I would be curious to hear embray's opinion on this. I know that he has been working on allowing to use system packages more generally.\n\nBtw, there are merge conflicts.",
    "created_at": "2018-10-14T19:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356138",
    "user": "saraedum"
}
```

I would be curious to hear embray's opinion on this. I know that he has been working on allowing to use system packages more generally.

Btw, there are merge conflicts.



---

archive/issue_comments_356139.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-14T19:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356139",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_356140.json:
```json
{
    "body": "Why should this work for the `sage -R` command? That command is explicitly documented (as in `sage --help` and in [the reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) to \"run Sage's R with given arguments\", so why should it run a non-Sage R? Maybe I'm misunderstanding.\n\nI think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.\n\nBut if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.",
    "created_at": "2018-10-14T21:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356140",
    "user": "jhpalmieri"
}
```

Why should this work for the `sage -R` command? That command is explicitly documented (as in `sage --help` and in [the reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) to "run Sage's R with given arguments", so why should it run a non-Sage R? Maybe I'm misunderstanding.

I think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.

But if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.



---

archive/issue_comments_356141.json:
```json
{
    "body": "I never changed those help messages in sage-on-gentoo. There is an ambiguity I am exploiting. You think it only means R from sage the distribution, I take it to mean R that sage has been configured to use. You could argue that the capitalisation means we are talking about the distribution.\n\nShould we have a semantic war :)\n\nIn any case, while there is no real benefit, compared to running R directly, I don't see why the behavior shouldn't be preserved. Existing scripts shouldn't break because you changed some underlying bits.",
    "created_at": "2018-10-14T21:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356141",
    "user": "fbissey"
}
```

I never changed those help messages in sage-on-gentoo. There is an ambiguity I am exploiting. You think it only means R from sage the distribution, I take it to mean R that sage has been configured to use. You could argue that the capitalisation means we are talking about the distribution.

Should we have a semantic war :)

In any case, while there is no real benefit, compared to running R directly, I don't see why the behavior shouldn't be preserved. Existing scripts shouldn't break because you changed some underlying bits.



---

archive/issue_comments_356142.json:
```json
{
    "body": "Seriously, if changing the documentation is your only problem with this, I'd be glad to just do that. Do you have a preferred wording?",
    "created_at": "2018-10-14T22:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356142",
    "user": "fbissey"
}
```

Seriously, if changing the documentation is your only problem with this, I'd be glad to just do that. Do you have a preferred wording?



---

archive/issue_comments_356143.json:
```json
{
    "body": "I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` \u2013\u00a0it adds the 6 extra characters `sage -` for no reason \u2013 and it should be disabled.",
    "created_at": "2018-10-15T04:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356143",
    "user": "jhpalmieri"
}
```

I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.



---

archive/issue_comments_356144.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` \u2013\u00a0it adds the 6 extra characters `sage -` for no reason \u2013 and it should be disabled.\n\nSo you don't think we should support people with old script that may call `sage -R`? You want those people to update?",
    "created_at": "2018-10-15T04:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356144",
    "user": "fbissey"
}
```

Replying to [comment:14 jhpalmieri]:
> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.

So you don't think we should support people with old script that may call `sage -R`? You want those people to update?



---

archive/issue_comments_356145.json:
```json
{
    "body": "If Sage is not going to install a copy of `R`, then you could rewrite the main `sage` script so that `sage -R` prints a deprecation warning before executing the system's R`.\n\nI don't really buy your ambiguity argument, and I think that you are misleading people if `sage -R` runs a version of R which was not installed by Sage. (There is also the slim chance that it won't work and people will report errors from running `sage -R` to Sage developers, or (even worse) silently blame us for the problem, when it has nothing to do with us.)\n\nHow many people really use commands like `sage -R`? Maybe they should all be deprecated, and people should be encouraged to put `SAGE_ROOT/local/bin` in their path or instead to use `sage --sh -c blah`, where `blah` can be `R` or `python` or `ecl` or ...\n\nIf you really want to proceed, note that `sage -h` contains\n\n```\n  -cython [...]       -- run Cython with given arguments\n  -ecl [...]          -- run Common Lisp\n  -gap [...]          -- run Sage's Gap with given arguments\n```\n\nso maybe they should all omit \"Sage's\". I won't be happy with that change, so you'll need another reviewer, and I also think you should ask for more opinions.",
    "created_at": "2018-10-15T05:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356145",
    "user": "jhpalmieri"
}
```

If Sage is not going to install a copy of `R`, then you could rewrite the main `sage` script so that `sage -R` prints a deprecation warning before executing the system's R`.

I don't really buy your ambiguity argument, and I think that you are misleading people if `sage -R` runs a version of R which was not installed by Sage. (There is also the slim chance that it won't work and people will report errors from running `sage -R` to Sage developers, or (even worse) silently blame us for the problem, when it has nothing to do with us.)

How many people really use commands like `sage -R`? Maybe they should all be deprecated, and people should be encouraged to put `SAGE_ROOT/local/bin` in their path or instead to use `sage --sh -c blah`, where `blah` can be `R` or `python` or `ecl` or ...

If you really want to proceed, note that `sage -h` contains

```
  -cython [...]       -- run Cython with given arguments
  -ecl [...]          -- run Common Lisp
  -gap [...]          -- run Sage's Gap with given arguments
```

so maybe they should all omit "Sage's". I won't be happy with that change, so you'll need another reviewer, and I also think you should ask for more opinions.



---

archive/issue_comments_356146.json:
```json
{
    "body": "For what its worth I agree with `@`fbissey's interpretation. Even a distro can have multiple versions of a dependency installed. Sometimes it can be useful to \"start the R sage uses\", for example for debugging.",
    "created_at": "2018-10-16T08:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356146",
    "user": "@timokau"
}
```

For what its worth I agree with `@`fbissey's interpretation. Even a distro can have multiple versions of a dependency installed. Sometimes it can be useful to "start the R sage uses", for example for debugging.



---

archive/issue_comments_356147.json:
```json
{
    "body": "I would also agree with interpreting \"Sage's R\" as \"the R that Sage has been configured to use\",\nand similarly for GAP, PARI/GP, Singular, etc.",
    "created_at": "2018-10-16T09:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356147",
    "user": "slelievre"
}
```

I would also agree with interpreting "Sage's R" as "the R that Sage has been configured to use",
and similarly for GAP, PARI/GP, Singular, etc.



---

archive/issue_comments_356148.json:
```json
{
    "body": "I think John feels very strongly about his interpretation. The heart of his argument being if it says it is sage's own, the sage devs owns the bugs.  As distros guys we all know where to stand about that. \n\nSometimes it is your own bugs (build system, distro specificities) and sometimes it belong to upstream. In any case you may carry patches and sage-the-distro has a long history about \"owning\" its own patches regardless of upstream as you well know.\n\nIn any case piping on the matter on sage-devel doesn't cost us much since it is now, in effect, a sage-8.5 ticket.",
    "created_at": "2018-10-16T09:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356148",
    "user": "fbissey"
}
```

I think John feels very strongly about his interpretation. The heart of his argument being if it says it is sage's own, the sage devs owns the bugs.  As distros guys we all know where to stand about that. 

Sometimes it is your own bugs (build system, distro specificities) and sometimes it belong to upstream. In any case you may carry patches and sage-the-distro has a long history about "owning" its own patches regardless of upstream as you well know.

In any case piping on the matter on sage-devel doesn't cost us much since it is now, in effect, a sage-8.5 ticket.



---

archive/issue_comments_356149.json:
```json
{
    "body": "I don't feel very strongly about it either way, maybe printing a clear information (either \"this is a sage package\" or \"this is a system package\") first is a good compromise.",
    "created_at": "2018-10-16T16:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356149",
    "user": "@timokau"
}
```

I don't feel very strongly about it either way, maybe printing a clear information (either "this is a sage package" or "this is a system package") first is a good compromise.



---

archive/issue_comments_356150.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> I think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.\n> \n> But if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.\n\nI disagree.  I think these commands should really just mean \"run the same Python/R/etc. that Sage is using, with all the sage-related environment variables set\".",
    "created_at": "2018-10-28T16:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356150",
    "user": "embray"
}
```

Replying to [comment:11 jhpalmieri]:
> I think that any installation of Sage which does not install its own R, Python, Singular, etc., should not have functioning `sage --python`, `sage -R`, `sage --singular`, etc., commands. Maybe instead, those commands should provide good error messages if Sage is configured to use a system version of the appropriate software.
> 
> But if you really want `sage -R` to work with a non-Sage version of `R`, please change the documentation.

I disagree.  I think these commands should really just mean "run the same Python/R/etc. that Sage is using, with all the sage-related environment variables set".



---

archive/issue_comments_356151.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` \u2013\u00a0it adds the 6 extra characters `sage -` for no reason \u2013 and it should be disabled.\n\nThat's not true that there is no reason for it.  For example, what if you want to run R in the Sage environment so that you can run sage commands in R with RPy?  Or interface with other software that is included in the Sage distribution?  From the user's perspective, `sage -R` means \"launch the R that sage is using\".  It's transparent/irrelevant whether or not the R command happened to be included in the Sage distribution or not.  For downstream distributions (e.g. on Debian, Gentoo) they are all using the system's copies of programs as much as possible, so you'll just have confused users who find that `sage -R` works on some system but not others.",
    "created_at": "2018-10-28T16:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356151",
    "user": "embray"
}
```

Replying to [comment:14 jhpalmieri]:
> I think that if the system has `R` installed, people should run it by running `R`, not `sage -R`. So I think if Sage is going to use the system's `R`, there is no need for command `sage -R` – it adds the 6 extra characters `sage -` for no reason – and it should be disabled.

That's not true that there is no reason for it.  For example, what if you want to run R in the Sage environment so that you can run sage commands in R with RPy?  Or interface with other software that is included in the Sage distribution?  From the user's perspective, `sage -R` means "launch the R that sage is using".  It's transparent/irrelevant whether or not the R command happened to be included in the Sage distribution or not.  For downstream distributions (e.g. on Debian, Gentoo) they are all using the system's copies of programs as much as possible, so you'll just have confused users who find that `sage -R` works on some system but not others.



---

archive/issue_comments_356152.json:
```json
{
    "body": "Changing keywords from \"R\" to \"R, sdl\".",
    "created_at": "2019-08-27T19:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356152",
    "user": "tmonteil"
}
```

Changing keywords from "R" to "R, sdl".



---

archive/issue_comments_356153.json:
```json
{
    "body": "I've opened #28884 with a working (on Debian at least) branch allowing use of system's R.\n\nFeel free to review.",
    "created_at": "2019-12-15T00:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356153",
    "user": "dimpase"
}
```

I've opened #28884 with a working (on Debian at least) branch allowing use of system's R.

Feel free to review.



---

archive/issue_comments_356154.json:
```json
{
    "body": "Is there still anything to do here? I don't really use R inside or outside of sage... has #28884 caused any problems?",
    "created_at": "2020-03-18T23:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356154",
    "user": "mjo"
}
```

Is there still anything to do here? I don't really use R inside or outside of sage... has #28884 caused any problems?



---

archive/issue_comments_356155.json:
```json
{
    "body": "not sure about Jupyter kernel for R, but this is a different story. A new ticket, if you must.",
    "created_at": "2020-03-19T03:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356155",
    "user": "dimpase"
}
```

not sure about Jupyter kernel for R, but this is a different story. A new ticket, if you must.



---

archive/issue_comments_356156.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-03-19T03:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356156",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_356157.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-03-27T15:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25266#issuecomment-356157",
    "user": "chapoton"
}
```

Resolution: duplicate
