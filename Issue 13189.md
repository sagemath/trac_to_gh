# Issue 13189: Report startuptime exclusive children

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-08-12 17:34:03

Assignee: tbd

Right now `sage -startuptime` reports startup time including children. This isn't particularly useful since that just means that the first module (which loads most of sage as dependencies) is the slowest. The more meaningful number is exclusive children, which can tell us if the module does computations during initialization.


---

Comment by vbraun created at 2012-08-12 17:35:57

Initial patch


---

Attachment


---

Comment by vbraun created at 2012-08-12 17:36:34

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-08-13 00:44:00

Initial patch


---

Attachment

Now with disabled garbage collector (it did skew timings) and with optional argument a module that you want to know more about:

```
[vbraun`@`laptop sage]$ sage -startuptime sage.geometry.fan

========================================================================
## Slowest modules importing sage.geometry.fan
exclude/ms include/ms   #parents  module name
     0.115     51.405          3  sage.geometry.all
     0.224      0.246          1  sage.schemes.toric.library
     0.332      0.398          1  sage.geometry.triangulation.fan_refinement
     0.383      0.471          2  sage.geometry.fan_morphism
     0.560      0.782          3  sage.schemes.toric.variety

## Slowest modules imported by sage.geometry.fan
exclude/ms include/ms   #parents  module name
     0.533      2.509         19  collections
     0.607     67.336          5  sage.combinat.posets.posets
     0.631    140.774         51  sage.misc.all
     0.734     49.422          5  sage.geometry.cone
     0.772      2.777          4  sage.geometry.lattice_polytope
     1.121      1.124        175  sage.misc.abstract_method
     1.247      1.247        180  sage.misc.lazy_attribute
     1.304     65.086        230  sage.rings.all
     1.332      1.332         63  copy
     3.837      5.491        218  sage.misc.sageinspect

## module sage.geometry.fan
Time to import:  0.751ms
Cumulative time: 0.823ms
Names: fan, sage.geometry.fan
```



---

Attachment

Improved patch


---

Comment by vbraun created at 2012-08-13 16:43:18

New patch has better handling of ambiguous command line argument and prints module file.


---

Attachment

Initial patch


---

Comment by jhpalmieri created at 2012-09-19 17:41:32

Two questions:

- would it be useful to be able to sort by times including children (keeping the default as is) by specifying a command-line argument? (I don't know the answer to this one.)

- should the usage `sage --startuptime [modulename]` be documented in `sage --advanced` and in `devel/sage/doc/en/reference/options.rst`? (I think the answer to this one is "yes". See the attached referee patches.)


---

Comment by jhpalmieri created at 2012-09-19 17:42:09

root repo: documentation


---

Attachment

I don't think there is much point in the inclusive startup time, that just tells you which library was imported first (and then pulled in a lot of sage modules for the first time). Thats why the old startuptime always showed a ridiculously long time for `sage.algebras.iwahori_hecke_algebra` despite this being a very lightweight module.

Thanks for the referee patches, they look great!


---

Comment by jhpalmieri created at 2012-09-19 18:53:20

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-09-19 23:49:37

Oops, we missed one thing: the test in tests/startup.py has to be rewritten to take into account the changed output of `sage --startuptime`. (This will only make a difference when testing on sage.math.)


---

Comment by jhpalmieri created at 2012-09-19 23:49:37

Changing status from positive_review to needs_work.


---

Comment by jhpalmieri created at 2012-09-20 18:18:24

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-09-20 18:18:24

I've added to my referee's patch to fix the doctest in tests/startup.py. Also, now if the test fails, it prints how long `sage --startuptime` took, instead of just returning `False`.


---

Attachment

Sage library: documentation and doctest fix


---

Comment by vbraun created at 2012-09-20 18:30:00

Hmm a hostname-dependent doctest ;-)

Thanks for the patch, looks good!


---

Comment by vbraun created at 2012-09-20 18:30:00

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-09-23 16:22:10

Resolution: fixed
