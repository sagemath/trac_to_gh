# Issue 11341: add _is_numerically_zero() method to symbolic expressions

archive/issues_011341.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman\n\nA fast way to check if an expression is zero is important in many places, see for example comment:15:ticket:11143. We should put the numerical check mentioned there in a method (`_is_numerically_zero()`) of symbolic expressions (`sage.symbolic.expression.Expression`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/11513\n\n",
    "created_at": "2011-06-16T22:37:32Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "title": "add _is_numerically_zero() method to symbolic expressions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11341",
    "user": "burcin"
}
```
Assignee: burcin

CC:  kcrisman

A fast way to check if an expression is zero is important in many places, see for example comment:15:ticket:11143. We should put the numerical check mentioned there in a method (`_is_numerically_zero()`) of symbolic expressions (`sage.symbolic.expression.Expression`).

Issue created by migration from https://trac.sagemath.org/ticket/11513





---

archive/issue_comments_125339.json:
```json
{
    "body": "Attachment [trac_11513-is_numerically_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_numerically_zero.patch) by burcin created at 2011-06-17 00:06:36\n\ntemporary patch",
    "created_at": "2011-06-17T00:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125339",
    "user": "burcin"
}
```

Attachment [trac_11513-is_numerically_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_numerically_zero.patch) by burcin created at 2011-06-17 00:06:36

temporary patch



---

archive/issue_comments_125340.json:
```json
{
    "body": "I attached a patch providing a function which doesn't do much. It should eventually check (reasonably quickly I hope) if expressions like `(pi-1)*pi - (pi-2)*pi - pi)` or `e<sup>I</sup>pi +1` are zero. This function can be used to provide a template for implementing #11143 while someone tries to improve it.",
    "created_at": "2011-06-17T00:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125340",
    "user": "burcin"
}
```

I attached a patch providing a function which doesn't do much. It should eventually check (reasonably quickly I hope) if expressions like `(pi-1)*pi - (pi-2)*pi - pi)` or `e<sup>I</sup>pi +1` are zero. This function can be used to provide a template for implementing #11143 while someone tries to improve it.



---

archive/issue_comments_125341.json:
```json
{
    "body": "I thought this was a computationally unsolvable problem in general?  Maybe I'm missing something here.",
    "created_at": "2011-06-17T00:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125341",
    "user": "kcrisman"
}
```

I thought this was a computationally unsolvable problem in general?  Maybe I'm missing something here.



---

archive/issue_comments_125342.json:
```json
{
    "body": "That's why the function name says *numerically*. It might have said *trivially* as well. This is just supposed to be a quick check. Maybe the examples in comment:2 were too ambitious.",
    "created_at": "2011-06-17T00:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125342",
    "user": "burcin"
}
```

That's why the function name says *numerically*. It might have said *trivially* as well. This is just supposed to be a quick check. Maybe the examples in comment:2 were too ambitious.



---

archive/issue_comments_125343.json:
```json
{
    "body": "So what does this exactly check?  Just if something is a numeric Ginac object that Ginac knows is zero?    So we won't get any false positives?  That is my main concern, for instance with #1173 or #11143 - we wouldn't want mathematical incorrectness to get a speedup.",
    "created_at": "2011-08-18T14:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125343",
    "user": "kcrisman"
}
```

So what does this exactly check?  Just if something is a numeric Ginac object that Ginac knows is zero?    So we won't get any false positives?  That is my main concern, for instance with #1173 or #11143 - we wouldn't want mathematical incorrectness to get a speedup.



---

archive/issue_comments_125344.json:
```json
{
    "body": "Also, what happened to the use of CIF mentioned at #11143?  I assume it's commented out because it's slower, or less reliable, or something?",
    "created_at": "2011-08-18T14:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125344",
    "user": "kcrisman"
}
```

Also, what happened to the use of CIF mentioned at #11143?  I assume it's commented out because it's slower, or less reliable, or something?



---

archive/issue_comments_125345.json:
```json
{
    "body": "I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,\nfor general expressions the problem is undecidable, thus if you want to check expressions that\n*reduce* to zero, the name of the method should reflect the fact that there could be false\nnegatives.\n\nPaul",
    "created_at": "2012-01-09T09:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125345",
    "user": "zimmerma"
}
```

I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,
for general expressions the problem is undecidable, thus if you want to check expressions that
*reduce* to zero, the name of the method should reflect the fact that there could be false
negatives.

Paul



---

archive/issue_comments_125346.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd35.5\".",
    "created_at": "2012-01-09T09:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125346",
    "user": "zimmerma"
}
```

Changing keywords from "" to "sd35.5".



---

archive/issue_comments_125347.json:
```json
{
    "body": "Replying to [comment:7 zimmerma]:\n> I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,\n> for general expressions the problem is undecidable, thus if you want to check expressions that\n> *reduce* to zero, the name of the method should reflect the fact that there could be false\n> negatives.\n\nHi Paul, I wanted to ask you about this in Warwick. I got caught up in the linear algebra stuff and this slipped my mind.\n\n`is_zero()` usually ends up calling maxima, which is very slow especially in the context of automatic evaluation of symbolic functions.\n\nAt the moment, many symbolic functions (see `sage/functions/generalized.py` for example) use code similar to the following to test if an argument is zero within a reasonable time: (BTW, this code should not initialize `CIF` on every call.)\n\n\n```\n        try:\n            approx_x = ComplexIntervalField()(x)\n            if bool(approx_x.imag() == 0):      # x is real\n                if bool(approx_x.real() == 0):  # x is zero\n                    return None\n                else:\n                    return 0\n        except:                     # x is symbolic\n            pass    \n```\n\n\nThe reason for this ticket was to move this to a separate function to avoid code duplication. If this function can detect `pi + (pi - 1)*pi - pi^2 == 0` or `(pi - 1)*x - pi*x + x == 0` it would be even better. In this context, false negatives are not a problem. We should just avoid false positives. It's also OK if this test is not purely numeric. Any suggestions for a better name for this function is also welcome of course.",
    "created_at": "2012-01-09T18:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125347",
    "user": "burcin"
}
```

Replying to [comment:7 zimmerma]:
> I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,
> for general expressions the problem is undecidable, thus if you want to check expressions that
> *reduce* to zero, the name of the method should reflect the fact that there could be false
> negatives.

Hi Paul, I wanted to ask you about this in Warwick. I got caught up in the linear algebra stuff and this slipped my mind.

`is_zero()` usually ends up calling maxima, which is very slow especially in the context of automatic evaluation of symbolic functions.

At the moment, many symbolic functions (see `sage/functions/generalized.py` for example) use code similar to the following to test if an argument is zero within a reasonable time: (BTW, this code should not initialize `CIF` on every call.)


```
        try:
            approx_x = ComplexIntervalField()(x)
            if bool(approx_x.imag() == 0):      # x is real
                if bool(approx_x.real() == 0):  # x is zero
                    return None
                else:
                    return 0
        except:                     # x is symbolic
            pass    
```


The reason for this ticket was to move this to a separate function to avoid code duplication. If this function can detect `pi + (pi - 1)*pi - pi^2 == 0` or `(pi - 1)*x - pi*x + x == 0` it would be even better. In this context, false negatives are not a problem. We should just avoid false positives. It's also OK if this test is not purely numeric. Any suggestions for a better name for this function is also welcome of course.



---

archive/issue_comments_125348.json:
```json
{
    "body": "Dear Burcin,\n\n> The reason for this ticket was to move this to a separate function to avoid code duplication.\n\nok I understand. But I don't like the proposed solution, since:\n\n(1) it might say a number is zero whereas it is not (if the number is tiny, but due to rounding\n    errors it gets numerically evaluated to zero, because the precision used is fixed)\n\n(2) it might say a zero number is not (again due to rounding errors)\n\nIt should be the responsibility of the user only to make such approximations.\n\nWhat happens if your function `_is_numerically_zero()` only checks for *exact* integer or\nreal or complex zero? Do many doctests fail?\n\nPaul",
    "created_at": "2012-01-09T20:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125348",
    "user": "zimmerma"
}
```

Dear Burcin,

> The reason for this ticket was to move this to a separate function to avoid code duplication.

ok I understand. But I don't like the proposed solution, since:

(1) it might say a number is zero whereas it is not (if the number is tiny, but due to rounding
    errors it gets numerically evaluated to zero, because the precision used is fixed)

(2) it might say a zero number is not (again due to rounding errors)

It should be the responsibility of the user only to make such approximations.

What happens if your function `_is_numerically_zero()` only checks for *exact* integer or
real or complex zero? Do many doctests fail?

Paul



---

archive/issue_comments_125349.json:
```json
{
    "body": "The `_is_numerically_zero()` has only been used in a few new symbolic functions, we haven't tested replacing the heavily duplicated test code that Burcin is talking about with this new method to see if many doctests fail. My impression is that it is useful to have such a method for automatic simplifications like e.g.  `erf(0)` should return `0` not `erf(0)`, for instance to address #8983.",
    "created_at": "2012-01-09T21:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125349",
    "user": "benjaminfjones"
}
```

The `_is_numerically_zero()` has only been used in a few new symbolic functions, we haven't tested replacing the heavily duplicated test code that Burcin is talking about with this new method to see if many doctests fail. My impression is that it is useful to have such a method for automatic simplifications like e.g.  `erf(0)` should return `0` not `erf(0)`, for instance to address #8983.



---

archive/issue_comments_125350.json:
```json
{
    "body": "Attachment [trac_11513-is_trivally_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_trivally_zero.patch) by burcin created at 2012-01-09 22:28:48",
    "created_at": "2012-01-09T22:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125350",
    "user": "burcin"
}
```

Attachment [trac_11513-is_trivally_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_trivally_zero.patch) by burcin created at 2012-01-09 22:28:48



---

archive/issue_comments_125351.json:
```json
{
    "body": "After playing around with `ComplexIntervalField`, different precisions and symbolic expressions, I finally realized that they cannot perform magic and detect zero. :)\n\nattachment:trac_11513-is_trivally_zero.patch implements a method `is_trivially_zero()` instead. This is just a wrapper around pynac's `is_zero()` method, which amounts to the exact integer or real/complex zero check Paul suggested.\n\nCan we review this quickly and turn to another ticket that requires magic: #9953?",
    "created_at": "2012-01-09T22:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125351",
    "user": "burcin"
}
```

After playing around with `ComplexIntervalField`, different precisions and symbolic expressions, I finally realized that they cannot perform magic and detect zero. :)

attachment:trac_11513-is_trivally_zero.patch implements a method `is_trivially_zero()` instead. This is just a wrapper around pynac's `is_zero()` method, which amounts to the exact integer or real/complex zero check Paul suggested.

Can we review this quickly and turn to another ticket that requires magic: #9953?



---

archive/issue_comments_125352.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-09T22:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125352",
    "user": "burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_125353.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-10T00:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125353",
    "user": "benjaminfjones"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_125354.json:
```json
{
    "body": "I think this is certainly sufficient for our needs with fast evaluation and automatic simplification of symbolic functions. \n\nPositive Review.\n\nThe patch looks good, applies cleanly to Sage-4.8.alpha6, and all doctests in the file pass. I'm going to work now on updating various tickets that depended on the name `_is_numerically_zero`.",
    "created_at": "2012-01-10T00:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125354",
    "user": "benjaminfjones"
}
```

I think this is certainly sufficient for our needs with fast evaluation and automatic simplification of symbolic functions. 

Positive Review.

The patch looks good, applies cleanly to Sage-4.8.alpha6, and all doctests in the file pass. I'm going to work now on updating various tickets that depended on the name `_is_numerically_zero`.



---

archive/issue_comments_125355.json:
```json
{
    "body": "Sorry, I didn't mean to change the status so quick. I'll defer to others that are interested, but it gets a positive review from me anyhow.",
    "created_at": "2012-01-10T00:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125355",
    "user": "benjaminfjones"
}
```

Sorry, I didn't mean to change the status so quick. I'll defer to others that are interested, but it gets a positive review from me anyhow.



---

archive/issue_comments_125356.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-01-10T00:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125356",
    "user": "benjaminfjones"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125357.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-10T00:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125357",
    "user": "benjaminfjones"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_125358.json:
```json
{
    "body": "Should this be an underscore method like the previous one?",
    "created_at": "2012-01-10T04:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125358",
    "user": "kcrisman"
}
```

Should this be an underscore method like the previous one?



---

archive/issue_comments_125359.json:
```json
{
    "body": "> Can we review this quickly and turn to another ticket that requires magic: #9953?\nSo is that a dup of #9627 or not?  I'm not sure, myself.",
    "created_at": "2012-01-10T04:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125359",
    "user": "kcrisman"
}
```

> Can we review this quickly and turn to another ticket that requires magic: #9953?
So is that a dup of #9627 or not?  I'm not sure, myself.



---

archive/issue_comments_125360.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> Should this be an underscore method like the previous one?\n\nI don't see any reason to hide this from the user. We also removed the leading underscore from `is_symbol()`, `is_numeric()`, etc. recently.",
    "created_at": "2012-01-10T06:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125360",
    "user": "burcin"
}
```

Replying to [comment:16 kcrisman]:
> Should this be an underscore method like the previous one?

I don't see any reason to hide this from the user. We also removed the leading underscore from `is_symbol()`, `is_numeric()`, etc. recently.



---

archive/issue_comments_125361.json:
```json
{
    "body": "the patch looks good to me. Since this a new function, and it is not used anywhere yet, the\ndoctests should still run, but I will try to be sure. Just a minor point: I'd prefer as name\n`is_trivial_zero` which is simpler.\n\nPaul",
    "created_at": "2012-01-10T08:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125361",
    "user": "zimmerma"
}
```

the patch looks good to me. Since this a new function, and it is not used anywhere yet, the
doctests should still run, but I will try to be sure. Just a minor point: I'd prefer as name
`is_trivial_zero` which is simpler.

Paul



---

archive/issue_comments_125362.json:
```json
{
    "body": "I change the summary to better reflect the new function name.\n\nPaul",
    "created_at": "2012-01-10T08:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125362",
    "user": "zimmerma"
}
```

I change the summary to better reflect the new function name.

Paul



---

archive/issue_comments_125363.json:
```json
{
    "body": "Attachment [trac_11513-is_trival_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_trival_zero.patch) by burcin created at 2012-01-10 08:14:14\n\nReplying to [comment:19 zimmerma]:\n> Just a minor point: I'd prefer as name `is_trivial_zero` which is simpler.\n\nDone, see attachment:trac_11513-is_trival_zero.patch.",
    "created_at": "2012-01-10T08:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125363",
    "user": "burcin"
}
```

Attachment [trac_11513-is_trival_zero.patch](tarball://root/attachments/some-uuid/ticket11513/trac_11513-is_trival_zero.patch) by burcin created at 2012-01-10 08:14:14

Replying to [comment:19 zimmerma]:
> Just a minor point: I'd prefer as name `is_trivial_zero` which is simpler.

Done, see attachment:trac_11513-is_trival_zero.patch.



---

archive/issue_comments_125364.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-10T10:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125364",
    "user": "zimmerma"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_125365.json:
```json
{
    "body": "all doctests pass (with the previous patch). However, since the change is trivial, I give a\npositive review.\n\nPaul",
    "created_at": "2012-01-10T10:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125365",
    "user": "zimmerma"
}
```

all doctests pass (with the previous patch). However, since the change is trivial, I give a
positive review.

Paul



---

archive/issue_comments_125366.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-15T21:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11341#issuecomment-125366",
    "user": "jdemeyer"
}
```

Resolution: fixed
