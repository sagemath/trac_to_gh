# Issue 11341: add _is_numerically_zero() method to symbolic expressions

Issue created by migration from https://trac.sagemath.org/ticket/11513

Original creator: burcin

Original creation time: 2011-06-16 22:37:32

Assignee: burcin

CC:  kcrisman

A fast way to check if an expression is zero is important in many places, see for example comment:15:ticket:11143. We should put the numerical check mentioned there in a method (`_is_numerically_zero()`) of symbolic expressions (`sage.symbolic.expression.Expression`).


---

Attachment

temporary patch


---

Comment by burcin created at 2011-06-17 00:18:58

I attached a patch providing a function which doesn't do much. It should eventually check (reasonably quickly I hope) if expressions like `(pi-1)*pi - (pi-2)*pi - pi)` or `e<sup>I</sup>pi +1` are zero. This function can be used to provide a template for implementing #11143 while someone tries to improve it.


---

Comment by kcrisman created at 2011-06-17 00:22:22

I thought this was a computationally unsolvable problem in general?  Maybe I'm missing something here.


---

Comment by burcin created at 2011-06-17 00:24:42

That's why the function name says _numerically_. It might have said _trivially_ as well. This is just supposed to be a quick check. Maybe the examples in comment:2 were too ambitious.


---

Comment by kcrisman created at 2011-08-18 14:53:52

So what does this exactly check?  Just if something is a numeric Ginac object that Ginac knows is zero?    So we won't get any false positives?  That is my main concern, for instance with #1173 or #11143 - we wouldn't want mathematical incorrectness to get a speedup.


---

Comment by kcrisman created at 2011-08-18 14:54:31

Also, what happened to the use of CIF mentioned at #11143?  I assume it's commented out because it's slower, or less reliable, or something?


---

Comment by zimmerma created at 2012-01-09 09:05:50

I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,
for general expressions the problem is undecidable, thus if you want to check expressions that
*reduce* to zero, the name of the method should reflect the fact that there could be false
negatives.

Paul


---

Comment by zimmerma created at 2012-01-09 09:05:50

Changing keywords from "" to "sd35.5".


---

Comment by burcin created at 2012-01-09 18:40:51

Replying to [comment:7 zimmerma]:
> I'm puzzled about this ticket. Why doesn't the `is_zero` method suffice? As said by Karl-Dieter,
> for general expressions the problem is undecidable, thus if you want to check expressions that
> *reduce* to zero, the name of the method should reflect the fact that there could be false
> negatives.

Hi Paul, I wanted to ask you about this in Warwick. I got caught up in the linear algebra stuff and this slipped my mind.

`is_zero()` usually ends up calling maxima, which is very slow especially in the context of automatic evaluation of symbolic functions.

At the moment, many symbolic functions (see `sage/functions/generalized.py` for example) use code similar to the following to test if an argument is zero within a reasonable time: (BTW, this code should not initialize `CIF` on every call.)


```
        try:
            approx_x = ComplexIntervalField()(x)
            if bool(approx_x.imag() == 0):      # x is real
                if bool(approx_x.real() == 0):  # x is zero
                    return None
                else:
                    return 0
        except:                     # x is symbolic
            pass    
```


The reason for this ticket was to move this to a separate function to avoid code duplication. If this function can detect `pi + (pi - 1)*pi - pi^2 == 0` or `(pi - 1)*x - pi*x + x == 0` it would be even better. In this context, false negatives are not a problem. We should just avoid false positives. It's also OK if this test is not purely numeric. Any suggestions for a better name for this function is also welcome of course.


---

Comment by zimmerma created at 2012-01-09 20:53:12

Dear Burcin,

> The reason for this ticket was to move this to a separate function to avoid code duplication.

ok I understand. But I don't like the proposed solution, since:

(1) it might say a number is zero whereas it is not (if the number is tiny, but due to rounding
    errors it gets numerically evaluated to zero, because the precision used is fixed)

(2) it might say a zero number is not (again due to rounding errors)

It should be the responsibility of the user only to make such approximations.

What happens if your function `_is_numerically_zero()` only checks for *exact* integer or
real or complex zero? Do many doctests fail?

Paul


---

Comment by benjaminfjones created at 2012-01-09 21:15:50

The `_is_numerically_zero()` has only been used in a few new symbolic functions, we haven't tested replacing the heavily duplicated test code that Burcin is talking about with this new method to see if many doctests fail. My impression is that it is useful to have such a method for automatic simplifications like e.g.  `erf(0)` should return `0` not `erf(0)`, for instance to address #8983.


---

Attachment


---

Comment by burcin created at 2012-01-09 22:43:26

After playing around with `ComplexIntervalField`, different precisions and symbolic expressions, I finally realized that they cannot perform magic and detect zero. :)

attachment:trac_11513-is_trivally_zero.patch implements a method `is_trivially_zero()` instead. This is just a wrapper around pynac's `is_zero()` method, which amounts to the exact integer or real/complex zero check Paul suggested.

Can we review this quickly and turn to another ticket that requires magic: #9953?


---

Comment by burcin created at 2012-01-09 22:43:26

Changing status from new to needs_review.


---

Comment by benjaminfjones created at 2012-01-10 00:34:57

Changing status from needs_review to positive_review.


---

Comment by benjaminfjones created at 2012-01-10 00:34:57

I think this is certainly sufficient for our needs with fast evaluation and automatic simplification of symbolic functions. 

Positive Review.

The patch looks good, applies cleanly to Sage-4.8.alpha6, and all doctests in the file pass. I'm going to work now on updating various tickets that depended on the name `_is_numerically_zero`.


---

Comment by benjaminfjones created at 2012-01-10 00:39:55

Sorry, I didn't mean to change the status so quick. I'll defer to others that are interested, but it gets a positive review from me anyhow.


---

Comment by benjaminfjones created at 2012-01-10 00:40:29

Changing status from positive_review to needs_work.


---

Comment by benjaminfjones created at 2012-01-10 00:40:40

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-01-10 04:21:11

Should this be an underscore method like the previous one?


---

Comment by kcrisman created at 2012-01-10 04:22:37

> Can we review this quickly and turn to another ticket that requires magic: #9953?
So is that a dup of #9627 or not?  I'm not sure, myself.


---

Comment by burcin created at 2012-01-10 06:31:37

Replying to [comment:16 kcrisman]:
> Should this be an underscore method like the previous one?

I don't see any reason to hide this from the user. We also removed the leading underscore from `is_symbol()`, `is_numeric()`, etc. recently.


---

Comment by zimmerma created at 2012-01-10 08:03:58

the patch looks good to me. Since this a new function, and it is not used anywhere yet, the
doctests should still run, but I will try to be sure. Just a minor point: I'd prefer as name
`is_trivial_zero` which is simpler.

Paul


---

Comment by zimmerma created at 2012-01-10 08:10:51

I change the summary to better reflect the new function name.

Paul


---

Attachment

Replying to [comment:19 zimmerma]:
> Just a minor point: I'd prefer as name `is_trivial_zero` which is simpler.

Done, see attachment:trac_11513-is_trival_zero.patch.


---

Comment by zimmerma created at 2012-01-10 10:10:26

Changing status from needs_review to positive_review.


---

Comment by zimmerma created at 2012-01-10 10:10:26

all doctests pass (with the previous patch). However, since the change is trivial, I give a
positive review.

Paul


---

Comment by jdemeyer created at 2012-01-15 21:56:51

Resolution: fixed
