# Issue 13501: segfault in analytic_rank(algorithm='rubinstein')

Issue created by migration from https://trac.sagemath.org/ticket/13705

Original creator: dimpase

Original creation time: 2012-11-13 07:32:30

Assignee: cremona

CC:  cremona

Keywords: lcalc

apparently, PARI ungracefully runs out of memory on the following:

```
sage: e= elliptic_curves.rank(8)[0]
sage: e.analytic_rank(algorithm='rubinstein')
  ***   Warning: not enough memory, new stack 18446744073268923520.
...[lots of similar lines removed]
  ***   Warning: not enough memory, new stack 17179869183.
  ***   Warning:   ***   bug in PARI/GP (Segmentation Fault), please report
  ***   bug in PARI/GP (Segmentation Fault), please report
...[lots of similar lines removed]
```

certainly, this is a difficult elliptic curve to deal with, but still, segfault is a segfault. See the related
[sage-devel discussion](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/62488).


---

Comment by cremona created at 2012-11-13 09:28:56

As I said on sage-devel, this computation will require a very large number of L-series coefficients, so this does not surprise me.  I think that the only sensible way out is for the analytic rank function to quit gracefully for curve like this.


---

Comment by jdemeyer created at 2014-01-06 14:10:38

I now get

```
  ***   Warning: not enough memory, new stack 3854339200.
terminate called after throwing an instance of 'std::bad_alloc'
  what():  std::bad_alloc
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-d7407b95d583> in <module>()
----> 1 elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')

/usr/local/src/sage-2217/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in analytic_rank(self, algorithm, leading_coefficient)
   1353                 return lcalc.analytic_rank(L=self)
   1354             except TypeError,msg:
-> 1355                 raise RuntimeError, "unable to compute analytic rank using rubinstein algorithm ('%s')"%msg
   1356         elif algorithm == 'sympow':
   1357             if leading_coefficient:

RuntimeError: unable to compute analytic rank using rubinstein algorithm ('unable to convert x (=) to an integer')
```

which is about the best one can hope...

I think this should be closed as "wontfix".


---

Comment by jdemeyer created at 2014-01-06 14:10:38

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-01-06 14:10:45

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2014-01-06 14:13:25

Note also that the ticket reports a segmentation fault in `lcalc`, not Sage itself.


---

Comment by cremona created at 2014-01-06 20:55:56

I ran the code on 6.0 and it did not crash.

```
sage: elliptic_curves.rank(Integer(8))[Integer(0)].analytic_rank(algorithm='rubinstein')
  ***   Warning: not enough memory, new stack 18446744073268923520.
  ***   Warning: not enough memory, new stack 9223372036634461760.
 (similar lines)
         ***   Warning: not enough memory, new stack 274877906880.
  ***   Warning: new stack size = 137438953408 (131072.000 Mbytes).
0
```

which is not the correct analytic rank, but there is no segfault.


---

Comment by vbraun created at 2014-01-06 23:20:32

Resolution: fixed
