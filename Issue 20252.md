# Issue 20252: A and B bases for Iwahori-Hecke algebras

archive/issues_020252.json:
```json
{
    "body": "CC:  @tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20489\n\n",
    "created_at": "2016-04-23T04:56:37Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "A and B bases for Iwahori-Hecke algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20252",
    "user": "@AndrewAtLarge"
}
```
CC:  @tscrim



Issue created by migration from https://trac.sagemath.org/ticket/20489





---

archive/issue_comments_279062.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2016-04-23T12:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279062",
    "user": "@tscrim"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_279063.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-04-23T12:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279063",
    "user": "@tscrim"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_279064.json:
```json
{
    "body": "Changing keywords from \"\" to \"Iwahori-Hecke algebfra\".",
    "created_at": "2016-05-02T05:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279064",
    "user": "@AndrewAtLarge"
}
```

Changing keywords from "" to "Iwahori-Hecke algebfra".



---

archive/issue_comments_279065.json:
```json
{
    "body": "Changing keywords from \"Iwahori-Hecke algebfra\" to \"Iwahori-Hecke algebra\".",
    "created_at": "2016-05-02T05:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279065",
    "user": "@AndrewAtLarge"
}
```

Changing keywords from "Iwahori-Hecke algebfra" to "Iwahori-Hecke algebra".



---

archive/issue_comments_279066.json:
```json
{
    "body": "This is almost ready for review. The only issue that remains is that these bases are well-defined only when 2 is invertible in the base ring. In principle, this is catered for because the `__init__` methods in both bases contain lines like\n\n```\n    if 1/2 not in IHAlgebra.base_ring():\n        raise ValueError('The A-basis is defined only when 2 is invertible ')\n```\n\nIn practice, this does not seem to get caught when the bases are initialised:\n\n```\nsage: R.<v> = LaurentPolynomialRing(GF(2))\nsage: H = IwahoriHeckeAlgebra('A3', q1=v)\nsage: A=H.A(); B=H.B(); T=H.T()\nsage: T(A[2])\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\nBOOM!\n```\n\n}}}",
    "created_at": "2016-05-02T05:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279066",
    "user": "@AndrewAtLarge"
}
```

This is almost ready for review. The only issue that remains is that these bases are well-defined only when 2 is invertible in the base ring. In principle, this is catered for because the `__init__` methods in both bases contain lines like

```
    if 1/2 not in IHAlgebra.base_ring():
        raise ValueError('The A-basis is defined only when 2 is invertible ')
```

In practice, this does not seem to get caught when the bases are initialised:

```
sage: R.<v> = LaurentPolynomialRing(GF(2))
sage: H = IwahoriHeckeAlgebra('A3', q1=v)
sage: A=H.A(); B=H.B(); T=H.T()
sage: T(A[2])
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
BOOM!
```

}}}



---

archive/issue_comments_279067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-02T05:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279067",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279068.json:
```json
{
    "body": "Hmm... I'm not sure why offhand, but the test you are doing will yield false positives:\n\n```\nsage: 1/2 not in GF(3)\nTrue\nsage: 1/2 not in GF(2)\nTrue\n```\n\nIMO a better test would be\n\n```python\nR = self.base_ring()\ntry:\n    R.one() / R(2)\nexcept ZeroDivisionError:\n    raise ValueError(\"2 must be invertible\")\n```\n",
    "created_at": "2016-05-02T14:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279068",
    "user": "@tscrim"
}
```

Hmm... I'm not sure why offhand, but the test you are doing will yield false positives:

```
sage: 1/2 not in GF(3)
True
sage: 1/2 not in GF(2)
True
```

IMO a better test would be

```python
R = self.base_ring()
try:
    R.one() / R(2)
except ZeroDivisionError:
    raise ValueError("2 must be invertible")
```




---

archive/issue_comments_279069.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-02T22:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279069",
    "user": "@AndrewAtLarge"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_279070.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n>\n> IMO a better test would be\n> {{{#!python\n> R = self.base_ring()\n> try:\n>     R.one() / R(2)\n> except ZeroDivisionError:\n>     raise ValueError(\"2 must be invertible\")\n> }}}\n\nThanks Travis. I realised that this doesn't catch 2 not being invertible in ZZ, for example, but a slight variation catches both cases:\n\n```python\ntry:\n    R(R.one()/2)\nexcept (TypeError, ZeroDivisionError):\n    raise TypeError('The A-basis is defined only when 2 is invertible ')\n```\n",
    "created_at": "2016-05-02T22:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279070",
    "user": "@AndrewAtLarge"
}
```

Replying to [comment:8 tscrim]:
>
> IMO a better test would be
> {{{#!python
> R = self.base_ring()
> try:
>     R.one() / R(2)
> except ZeroDivisionError:
>     raise ValueError("2 must be invertible")
> }}}

Thanks Travis. I realised that this doesn't catch 2 not being invertible in ZZ, for example, but a slight variation catches both cases:

```python
try:
    R(R.one()/2)
except (TypeError, ZeroDivisionError):
    raise TypeError('The A-basis is defined only when 2 is invertible ')
```




---

archive/issue_comments_279071.json:
```json
{
    "body": "Ah, yes, that will work much better.\n\nAlso, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?",
    "created_at": "2016-05-03T01:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279071",
    "user": "@tscrim"
}
```

Ah, yes, that will work much better.

Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?



---

archive/issue_comments_279072.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?\n\nI know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).",
    "created_at": "2016-05-03T05:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279072",
    "user": "@AndrewAtLarge"
}
```

Replying to [comment:11 tscrim]:
> Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?

I know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).



---

archive/issue_comments_279073.json:
```json
{
    "body": "Replying to [comment:12 andrew.mathas]:\n> Replying to [comment:11 tscrim]:\n> > Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?\n> \n> I know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).\n\nIt would probably be good to amend that comment. I should be able to do a full review of this tomorrow.",
    "created_at": "2016-05-03T05:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279073",
    "user": "@tscrim"
}
```

Replying to [comment:12 andrew.mathas]:
> Replying to [comment:11 tscrim]:
> > Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?
> 
> I know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).

It would probably be good to amend that comment. I should be able to do a full review of this tomorrow.



---

archive/issue_comments_279074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T13:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279074",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T14:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279075",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279076.json:
```json
{
    "body": "I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. If you agree with my changes, then you can set a positive review.\n----\nNew commits:",
    "created_at": "2016-05-03T15:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279076",
    "user": "@tscrim"
}
```

I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. If you agree with my changes, then you can set a positive review.
----
New commits:



---

archive/issue_comments_279077.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T15:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279077",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279078.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. \n\nYes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.\n\n> If you agree with my changes, then you can set a positive review.\n\nYes, thank, you, I am happy with your changes.",
    "created_at": "2016-05-03T23:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279078",
    "user": "@AndrewAtLarge"
}
```

Replying to [comment:16 tscrim]:
> I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. 

Yes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.

> If you agree with my changes, then you can set a positive review.

Yes, thank, you, I am happy with your changes.



---

archive/issue_comments_279079.json:
```json
{
    "body": "Replying to [comment:18 andrew.mathas]:\n> Replying to [comment:16 tscrim]:\n> > I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. \n> \n> Yes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.\n\nAlas, the latter part is not possible because the doc orders things alphabetically.\n\n> > If you agree with my changes, then you can set a positive review.\n> \n> Yes, thank, you, I am happy with your changes.\n\nThen I'm setting this to a positive review. Thank you for the addition.",
    "created_at": "2016-05-03T23:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279079",
    "user": "@tscrim"
}
```

Replying to [comment:18 andrew.mathas]:
> Replying to [comment:16 tscrim]:
> > I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. 
> 
> Yes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.

Alas, the latter part is not possible because the doc orders things alphabetically.

> > If you agree with my changes, then you can set a positive review.
> 
> Yes, thank, you, I am happy with your changes.

Then I'm setting this to a positive review. Thank you for the addition.



---

archive/issue_comments_279080.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-03T23:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279080",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_279081.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-05T09:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20252#issuecomment-279081",
    "user": "@vbraun"
}
```

Resolution: fixed
