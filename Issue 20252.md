# Issue 20252: A and B bases for Iwahori-Hecke algebras

Issue created by migration from Trac.

Original creator: andrew.mathas

Original creation time: 2016-04-23 04:56:37

CC:  tscrim




---

Comment by tscrim created at 2016-04-23 12:00:24

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by tscrim created at 2016-04-23 12:00:24

Changing type from PLEASE CHANGE to enhancement.


---

Comment by andrew.mathas created at 2016-05-02 05:28:02

Changing keywords from "" to "Iwahori-Hecke algebfra".


---

Comment by andrew.mathas created at 2016-05-02 05:29:42

Changing keywords from "Iwahori-Hecke algebfra" to "Iwahori-Hecke algebra".


---

Comment by andrew.mathas created at 2016-05-02 05:35:27

This is almost ready for review. The only issue that remains is that these bases are well-defined only when 2 is invertible in the base ring. In principle, this is catered for because the `__init__` methods in both bases contain lines like

```
    if 1/2 not in IHAlgebra.base_ring():
        raise ValueError('The A-basis is defined only when 2 is invertible ')
```

In practice, this does not seem to get caught when the bases are initialised:

```
sage: R.<v> = LaurentPolynomialRing(GF(2))
sage: H = IwahoriHeckeAlgebra('A3', q1=v)
sage: A=H.A(); B=H.B(); T=H.T()
sage: T(A[2])
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
BOOM!
```

}}}


---

Comment by git created at 2016-05-02 05:41:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-05-02 14:20:27

Hmm... I'm not sure why offhand, but the test you are doing will yield false positives:

```
sage: 1/2 not in GF(3)
True
sage: 1/2 not in GF(2)
True
```

IMO a better test would be

```python
R = self.base_ring()
try:
    R.one() / R(2)
except ZeroDivisionError:
    raise ValueError("2 must be invertible")
```



---

Comment by andrew.mathas created at 2016-05-02 22:01:24

Changing status from new to needs_review.


---

Comment by andrew.mathas created at 2016-05-02 22:05:07

Replying to [comment:8 tscrim]:
>
> IMO a better test would be
> {{{#!python
> R = self.base_ring()
> try:
>     R.one() / R(2)
> except ZeroDivisionError:
>     raise ValueError("2 must be invertible")
> }}}

Thanks Travis. I realised that this doesn't catch 2 not being invertible in ZZ, for example, but a slight variation catches both cases:

```python
try:
    R(R.one()/2)
except (TypeError, ZeroDivisionError):
    raise TypeError('The A-basis is defined only when 2 is invertible ')
```



---

Comment by tscrim created at 2016-05-03 01:30:51

Ah, yes, that will work much better.

Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?


---

Comment by andrew.mathas created at 2016-05-03 05:08:03

Replying to [comment:11 tscrim]:
> Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?

I know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).


---

Comment by tscrim created at 2016-05-03 05:19:40

Replying to [comment:12 andrew.mathas]:
> Replying to [comment:11 tscrim]:
> > Also, do we need corresponding bases in `IwahoriHeckeAlgebra_nonstandard`?
> 
> I know that the code actually says on lines 2266-67 that this is necessary but as far as I can see it isn't. To check this I wrote some doc-tests that involve coercions between the KL-bases and the A/B-basis and they work. The way we wrote it `IwahoriHeckeAlgebra_nonstandard` inherits from `IwahoriHeckeAlgebra` so it automatically has the `A` and `B` basis classes. If you agree then I could delete the comment on lines 2266-67 (probably the comment should saythat if you want to change any of the basis classes then their names etc have to match those in `IwahoriHeckeAlgebra`).

It would probably be good to amend that comment. I should be able to do a full review of this tomorrow.


---

Comment by git created at 2016-05-03 13:56:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-03 14:26:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-05-03 15:02:26

I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. If you agree with my changes, then you can set a positive review.
----
New commits:


---

Comment by git created at 2016-05-03 15:04:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2016-05-03 23:47:22

Replying to [comment:16 tscrim]:
> I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. 

Yes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.

> If you agree with my changes, then you can set a positive review.

Yes, thank, you, I am happy with your changes.


---

Comment by tscrim created at 2016-05-03 23:55:08

Replying to [comment:18 andrew.mathas]:
> Replying to [comment:16 tscrim]:
> > I've gone through and made some fixes for the documentation and a few other tweaks. There is one very minor issue with `goldman_involution` being defined in the category is that its documentation is hidden. However, this is more of a technical issue as at some point we should move the category from being a (hidden) nested class to a separate class so it is included in the documentation. Yet that can be for a separate ticket. 
> 
> Yes, I agree that these methods should be visible. It would also be good if we could have the T-basis and the Kazhdan-Lusztig bases appearing in the manual before the A and B bases but it is not clear to me if this is possible. Having the least important bases first is certainly not ideal.

Alas, the latter part is not possible because the doc orders things alphabetically.

> > If you agree with my changes, then you can set a positive review.
> 
> Yes, thank, you, I am happy with your changes.

Then I'm setting this to a positive review. Thank you for the addition.


---

Comment by tscrim created at 2016-05-03 23:55:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-05-05 09:27:13

Resolution: fixed
