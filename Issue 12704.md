# Issue 12704: Fix element and parent classes of Hom categories to be abstract, and simplify the Hom logic.

archive/issues_012704.json:
```json
{
    "body": "Assignee: nthiery\n\nCC:  sage-combinat simonking\n\nKeywords: categories, Hom\n\nThis patch fixes the parent and element classes for Hom categories to\nbe purely abstract, and simplifies the Hom logic:\n\n- Unified the logic for selecting the class when building a Homset\n  (e.g. Homset, RingHomset, HeckeModuleHomspace, ...). This is now\n  systematically done through the _Hom_ hook. The logic still has a\n  fundamental flaw, but that's for the later #10668.\n- The cache for Hom is handled at a single point in Hom\n  In particular, homsets created via the _Hom_ hook are now unique.\n- If category is None, Hom simply calls itself with the meet of the\n  categories of the parent, which removes a cache handling duplication.\n- Parent.Hom calls  Hom directly (removes duplicate _Hom_ logic).\n- ParentWithBase.Hom was redundant and is gone.\n- Reduce the footprint of the current trick to delegate\n  Hom(F,F)(on_basis=...) to module_morphism.\n- Update a doctest in sage.modules.vector_space_homspace to take into\n  account that homsets created via _Hom_ are now unique.\n- Scheme is (apparently) an abstract base class; so it should not be\n  instantiated. I changed some doctests in\n  sage.schemes.generic.SchemeMorphism to use instead the concrete\n  Spec(ZZ). Those doctests were breaking because Scheme does not\n  implement equality, which is required for Hom caching.\n\nAs a byproduct, the HeckeModules category does not import any more\nHeckeModulesHomspace, which was a recurrent source of import loops.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12876\n\n",
    "created_at": "2012-04-24T21:55:40Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "title": "Fix element and parent classes of Hom categories to be abstract, and simplify the Hom logic.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12704",
    "user": "nthiery"
}
```
Assignee: nthiery

CC:  sage-combinat simonking

Keywords: categories, Hom

This patch fixes the parent and element classes for Hom categories to
be purely abstract, and simplifies the Hom logic:

- Unified the logic for selecting the class when building a Homset
  (e.g. Homset, RingHomset, HeckeModuleHomspace, ...). This is now
  systematically done through the _Hom_ hook. The logic still has a
  fundamental flaw, but that's for the later #10668.
- The cache for Hom is handled at a single point in Hom
  In particular, homsets created via the _Hom_ hook are now unique.
- If category is None, Hom simply calls itself with the meet of the
  categories of the parent, which removes a cache handling duplication.
- Parent.Hom calls  Hom directly (removes duplicate _Hom_ logic).
- ParentWithBase.Hom was redundant and is gone.
- Reduce the footprint of the current trick to delegate
  Hom(F,F)(on_basis=...) to module_morphism.
- Update a doctest in sage.modules.vector_space_homspace to take into
  account that homsets created via _Hom_ are now unique.
- Scheme is (apparently) an abstract base class; so it should not be
  instantiated. I changed some doctests in
  sage.schemes.generic.SchemeMorphism to use instead the concrete
  Spec(ZZ). Those doctests were breaking because Scheme does not
  implement equality, which is required for Hom caching.

As a byproduct, the HeckeModules category does not import any more
HeckeModulesHomspace, which was a recurrent source of import loops.

Issue created by migration from https://trac.sagemath.org/ticket/12876





---

archive/issue_comments_151834.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-24T21:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151834",
    "user": "nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_151835.json:
```json
{
    "body": "Note: this might depend on #12875",
    "created_at": "2012-04-24T21:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151835",
    "user": "nthiery"
}
```

Note: this might depend on #12875



---

archive/issue_comments_151836.json:
```json
{
    "body": "Note: there are two doctests failures that I don't know how to handle, related to the refcounting of Singular rings::\n\n```\n\nsage -t  devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n**********************************************************************\nFile \"/opt/sage-5.0.beta11/devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 418:\n    sage: len(ring_refcount_dict) == n\nExpected:\n    True\nGot:\n    False\nsage -t  devel/sage-combinat/sage/libs/singular/ring.pyx\n**********************************************************************\nFile \"/opt/sage-5.0.beta11/devel/sage-combinat/sage/libs/singular/ring.pyx\", line 469:\n    sage: ring_ptr in ring_refcount_dict\nExpected:\n    False\nGot:\n    True\n```\n\n\nHelp fixing those welcome!",
    "created_at": "2012-04-24T22:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151836",
    "user": "nthiery"
}
```

Note: there are two doctests failures that I don't know how to handle, related to the refcounting of Singular rings::

```

sage -t  devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx
**********************************************************************
File "/opt/sage-5.0.beta11/devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 418:
    sage: len(ring_refcount_dict) == n
Expected:
    True
Got:
    False
sage -t  devel/sage-combinat/sage/libs/singular/ring.pyx
**********************************************************************
File "/opt/sage-5.0.beta11/devel/sage-combinat/sage/libs/singular/ring.pyx", line 469:
    sage: ring_ptr in ring_refcount_dict
Expected:
    False
Got:
    True
```


Help fixing those welcome!



---

archive/issue_comments_151837.json:
```json
{
    "body": "The updated patch includes two small related improvements I had in later patches. I moved them here to resolve the conflict.",
    "created_at": "2012-04-25T00:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151837",
    "user": "nthiery"
}
```

The updated patch includes two small related improvements I had in later patches. I moved them here to resolve the conflict.



---

archive/issue_comments_151838.json:
```json
{
    "body": "Oops. The updated patch includes two further hunks I had forgotten.",
    "created_at": "2012-04-25T00:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151838",
    "user": "nthiery"
}
```

Oops. The updated patch includes two further hunks I had forgotten.



---

archive/issue_comments_151839.json:
```json
{
    "body": "Arr, yet another missing hunk ... Time to go to bed!",
    "created_at": "2012-04-25T00:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151839",
    "user": "nthiery"
}
```

Arr, yet another missing hunk ... Time to go to bed!



---

archive/issue_comments_151840.json:
```json
{
    "body": "For the record, all test passed on 5.0.beta13, with #12875 and #12877 applied (and a couple unrelated ones). I expect no dependency upon #12875, but can't swear at this point.",
    "created_at": "2012-04-25T13:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151840",
    "user": "nthiery"
}
```

For the record, all test passed on 5.0.beta13, with #12875 and #12877 applied (and a couple unrelated ones). I expect no dependency upon #12875, but can't swear at this point.



---

archive/issue_comments_151841.json:
```json
{
    "body": "Replying to [comment:8 nthiery]:\n> I expect no dependency upon #12875, but can't swear at this point.\n\nActually it does depend on #12875.",
    "created_at": "2012-04-25T14:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151841",
    "user": "nthiery"
}
```

Replying to [comment:8 nthiery]:
> I expect no dependency upon #12875, but can't swear at this point.

Actually it does depend on #12875.



---

archive/issue_comments_151842.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-26T16:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151842",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_151843.json:
```json
{
    "body": "With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:\n\n```\n\tsage -t  -force_lib \"devel/sage/sage/libs/singular/ring.pyx\"\n\tsage -t  -force_lib \"devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\"\n```\n\nNamely:\n\n```\nsage -t -force_lib \"devel/sage/sage/libs/singular/ring.pyx\" \n**********************************************************************\nFile \"/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/libs/singular/ring.pyx\", line 469:\n    sage: ring_ptr in ring_refcount_dict\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n```\n\nand\n\n```\nsage -t -force_lib \"devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 418:\n    sage: len(ring_refcount_dict) == n\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\n\nSo, apparently it is only a single problem.",
    "created_at": "2012-04-26T16:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151843",
    "user": "SimonKing"
}
```

With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:

```
	sage -t  -force_lib "devel/sage/sage/libs/singular/ring.pyx"
	sage -t  -force_lib "devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx"
```

Namely:

```
sage -t -force_lib "devel/sage/sage/libs/singular/ring.pyx" 
**********************************************************************
File "/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/libs/singular/ring.pyx", line 469:
    sage: ring_ptr in ring_refcount_dict
Expected:
    False
Got:
    True
**********************************************************************
```

and

```
sage -t -force_lib "devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 418:
    sage: len(ring_refcount_dict) == n
Expected:
    True
Got:
    False
**********************************************************************
```


So, apparently it is only a single problem.



---

archive/issue_comments_151844.json:
```json
{
    "body": "PS: I just verified that the problem also occurs without #12808.",
    "created_at": "2012-04-26T16:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151844",
    "user": "SimonKing"
}
```

PS: I just verified that the problem also occurs without #12808.



---

archive/issue_comments_151845.json:
```json
{
    "body": "Replying to [comment:11 SimonKing]:\n> With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:\n\nYeah, I know (see comment 3 above). I feel quite stuck with those\nfailures, and would really appreciate if you could investigate them\nsince you know much better than me the caching for Singular rings.\n\nThanks!\n\nCheers,\n                            Nicolas",
    "created_at": "2012-04-26T17:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151845",
    "user": "nthiery"
}
```

Replying to [comment:11 SimonKing]:
> With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:

Yeah, I know (see comment 3 above). I feel quite stuck with those
failures, and would really appreciate if you could investigate them
since you know much better than me the caching for Singular rings.

Thanks!

Cheers,
                            Nicolas



---

archive/issue_comments_151846.json:
```json
{
    "body": "In one of my \"weak caching\" patches (see #11521), I also had to fix a ring_refcount_dict test. Thus, I tried to see whether applying #11521 in addition to your patch helps. Unfortunately there is an incompatibility, so, it is not resolved yet.",
    "created_at": "2012-04-27T05:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151846",
    "user": "SimonKing"
}
```

In one of my "weak caching" patches (see #11521), I also had to fix a ring_refcount_dict test. Thus, I tried to see whether applying #11521 in addition to your patch helps. Unfortunately there is an incompatibility, so, it is not resolved yet.



---

archive/issue_comments_151847.json:
```json
{
    "body": "Since there is a positive review for #11521 and #715 (which belong together and have otherwise no pending dependency), could you consider to rebase your patch relative to #11521?",
    "created_at": "2012-04-27T07:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151847",
    "user": "SimonKing"
}
```

Since there is a positive review for #11521 and #715 (which belong together and have otherwise no pending dependency), could you consider to rebase your patch relative to #11521?



---

archive/issue_comments_151848.json:
```json
{
    "body": "PS: I am just attempting a rebase, to see whether #11521 fixes the ring_refcount_dict problem.",
    "created_at": "2012-04-27T07:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151848",
    "user": "SimonKing"
}
```

PS: I am just attempting a rebase, to see whether #11521 fixes the ring_refcount_dict problem.



---

archive/issue_comments_151849.json:
```json
{
    "body": "Here is the rejection:\n\n```diff\n--- homset.py\n+++ homset.py\n@@ -165,43 +203,27 @@ def Hom(X, Y, category=None):\n             if H.domain() is X and H.codomain() is Y:\n                 return H\n \n-    try:\n-        return X._Hom_(Y, category)\n-    except (AttributeError, TypeError):\n-        pass\n-\n     cat_X = X.category()\n     cat_Y = Y.category()\n     if category is None:\n-        category = cat_X._meet_(cat_Y)\n-    elif isinstance(category, Category):\n-        if not cat_X.is_subcategory(category):\n-            raise TypeError, \"%s is not in %s\"%(X, category)\n-        if not cat_Y.is_subcategory(category):\n-            raise TypeError, \"%s is not in %s\"%(Y, category)\n-    else:\n+        return Hom(X,Y,category=cat_X._meet_(cat_Y))\n+    if not isinstance(category, Category):\n         raise TypeError, \"Argument category (= %s) must be a category.\"%category\n-    # Now, as the category may have changed, we try to find the hom set in the cache, again:\n-    key = (X,Y,category)\n-    if _cache.has_key(key):\n-        H = _cache[key]()\n-        if H:\n-            # Are domain or codomain breaking the unique parent condition?\n-            if H.domain() is X and H.codomain() is Y:\n-                return H\n-\n-    # coercing would be incredibly annoying, since the domain and codomain\n-    # are totally different objects\n-    #X = category(X); Y = category(Y)\n+    if not cat_X.is_subcategory(category):\n+        raise TypeError, \"%s is not in %s\"%(X, category)\n+    if not cat_Y.is_subcategory(category):\n+        raise TypeError, \"%s is not in %s\"%(Y, category)\n \n     # construct H\n     # Design question: should the Homset classes get the category or the homset category?\n     # For the moment, this is the category, for compatibility with the current implementations\n     # of Homset in rings, schemes, ...\n-    H = category.hom_category().parent_class(X, Y, category = category)\n-            \n-    ##_cache[key] = weakref.ref(H)\n-    _cache[(X, Y, category)] = weakref.ref(H)\n+    from sets_cat import Sets\n+    try:\n+        H = X._Hom_(Y, category)\n+    except (AttributeError, TypeError):\n+        H = Homset(X, Y, category = category)\n+    _cache[key] = weakref.ref(H)\n     return H\n \n def hom(X, Y, f):\n```\n\n\nWhy do you import Sets (new line 221)?\n\nDo I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?",
    "created_at": "2012-04-27T07:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151849",
    "user": "SimonKing"
}
```

Here is the rejection:

```diff
--- homset.py
+++ homset.py
@@ -165,43 +203,27 @@ def Hom(X, Y, category=None):
             if H.domain() is X and H.codomain() is Y:
                 return H
 
-    try:
-        return X._Hom_(Y, category)
-    except (AttributeError, TypeError):
-        pass
-
     cat_X = X.category()
     cat_Y = Y.category()
     if category is None:
-        category = cat_X._meet_(cat_Y)
-    elif isinstance(category, Category):
-        if not cat_X.is_subcategory(category):
-            raise TypeError, "%s is not in %s"%(X, category)
-        if not cat_Y.is_subcategory(category):
-            raise TypeError, "%s is not in %s"%(Y, category)
-    else:
+        return Hom(X,Y,category=cat_X._meet_(cat_Y))
+    if not isinstance(category, Category):
         raise TypeError, "Argument category (= %s) must be a category."%category
-    # Now, as the category may have changed, we try to find the hom set in the cache, again:
-    key = (X,Y,category)
-    if _cache.has_key(key):
-        H = _cache[key]()
-        if H:
-            # Are domain or codomain breaking the unique parent condition?
-            if H.domain() is X and H.codomain() is Y:
-                return H
-
-    # coercing would be incredibly annoying, since the domain and codomain
-    # are totally different objects
-    #X = category(X); Y = category(Y)
+    if not cat_X.is_subcategory(category):
+        raise TypeError, "%s is not in %s"%(X, category)
+    if not cat_Y.is_subcategory(category):
+        raise TypeError, "%s is not in %s"%(Y, category)
 
     # construct H
     # Design question: should the Homset classes get the category or the homset category?
     # For the moment, this is the category, for compatibility with the current implementations
     # of Homset in rings, schemes, ...
-    H = category.hom_category().parent_class(X, Y, category = category)
-            
-    ##_cache[key] = weakref.ref(H)
-    _cache[(X, Y, category)] = weakref.ref(H)
+    from sets_cat import Sets
+    try:
+        H = X._Hom_(Y, category)
+    except (AttributeError, TypeError):
+        H = Homset(X, Y, category = category)
+    _cache[key] = weakref.ref(H)
     return H
 
 def hom(X, Y, f):
```


Why do you import Sets (new line 221)?

Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?



---

archive/issue_comments_151850.json:
```json
{
    "body": "Another point: I had inserted a comment in #11521, namely \"Apparently _Hom_ is supposed to be cached.\" This is why I did not insert stuff in the (weak) cache.\n\nDo you lift that assumption? Then, we should see what _Hom_ methods actually do caching. They should at most do *weak* caching.",
    "created_at": "2012-04-27T07:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151850",
    "user": "SimonKing"
}
```

Another point: I had inserted a comment in #11521, namely "Apparently _Hom_ is supposed to be cached." This is why I did not insert stuff in the (weak) cache.

Do you lift that assumption? Then, we should see what _Hom_ methods actually do caching. They should at most do *weak* caching.



---

archive/issue_comments_151851.json:
```json
{
    "body": "Attachment\n\nNicolas' patch rebased rel #11521",
    "created_at": "2012-04-27T07:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151851",
    "user": "SimonKing"
}
```

Attachment

Nicolas' patch rebased rel #11521



---

archive/issue_comments_151852.json:
```json
{
    "body": "I have rebased your patch relative to #11521 (as I said: This already has positive review).\n\nPlease have a look whether you are happy with my changes: I only changed sage/categories/homset.py, by using the :trac: directive in two places, fixing one hunk that has only applied with fuzz and removing the import of Sets. Apart from that, I adopted your logic of constructing the homset.\n\nSo far, I have tested sage/categories/homset.py and have verified that the previously failing tests are indeed fixed by #11521 (in fact, I also had some other pathes applied, but I am convinced that ##11521 suffices). I am now running the full tests suite, with *only* #11521 (and its dependency #715) and the new patch (and its dependencies #12875 and #12877).\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch",
    "created_at": "2012-04-27T08:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151852",
    "user": "SimonKing"
}
```

I have rebased your patch relative to #11521 (as I said: This already has positive review).

Please have a look whether you are happy with my changes: I only changed sage/categories/homset.py, by using the :trac: directive in two places, fixing one hunk that has only applied with fuzz and removing the import of Sets. Apart from that, I adopted your logic of constructing the homset.

So far, I have tested sage/categories/homset.py and have verified that the previously failing tests are indeed fixed by #11521 (in fact, I also had some other pathes applied, but I am convinced that ##11521 suffices). I am now running the full tests suite, with *only* #11521 (and its dependency #715) and the new patch (and its dependencies #12875 and #12877).

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch



---

archive/issue_comments_151853.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-27T08:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151853",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151854.json:
```json
{
    "body": "Hm. With sage-5.0.beta13 plus #715, #11521, #12875, #12877 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], I get one error, namely a segfault in\n\n```\nsage -t -force_lib \"devel/sage/sage/rings/number_field/number_field_rel.py\"\n```\n\n\nBut strange enough: When I ran it with --verbose, all tests passed, and the segfault came from leaving sage. That reminds me another problem: The deallocation of the (unique) pari instance is not done as it is supposed to be. This is fixed by the second patch of #12215. Hence, I am trying again, with #12215 added.",
    "created_at": "2012-04-27T11:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151854",
    "user": "SimonKing"
}
```

Hm. With sage-5.0.beta13 plus #715, #11521, #12875, #12877 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], I get one error, namely a segfault in

```
sage -t -force_lib "devel/sage/sage/rings/number_field/number_field_rel.py"
```


But strange enough: When I ran it with --verbose, all tests passed, and the segfault came from leaving sage. That reminds me another problem: The deallocation of the (unique) pari instance is not done as it is supposed to be. This is fixed by the second patch of #12215. Hence, I am trying again, with #12215 added.



---

archive/issue_comments_151855.json:
```json
{
    "body": "Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?",
    "created_at": "2012-04-27T11:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151855",
    "user": "SimonKing"
}
```

Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?



---

archive/issue_comments_151856.json:
```json
{
    "body": "With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], all doc tests pass.\n\nI made some additional cosmetic changes in a reviewer patch.\n\nFurther questions:\n\nIn sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.\n\nI see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?\nBut then, shouldn't `__getnewargs__` be removed as well?\n\nPlease tell whether you want to address these questions in an additional patch. And  I hope you agree with adding #715, #11521 and #12215 to the dependencies? Only #12215 needs review (hint...).\n\nIf you do agree, then put this to *positive review*, please.\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch",
    "created_at": "2012-04-27T13:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151856",
    "user": "SimonKing"
}
```

With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], all doc tests pass.

I made some additional cosmetic changes in a reviewer patch.

Further questions:

In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.

I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?
But then, shouldn't `__getnewargs__` be removed as well?

Please tell whether you want to address these questions in an additional patch. And  I hope you agree with adding #715, #11521 and #12215 to the dependencies? Only #12215 needs review (hint...).

If you do agree, then put this to *positive review*, please.

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch



---

archive/issue_comments_151857.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-04-27T14:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151857",
    "user": "SimonKing"
}
```

Attachment



---

archive/issue_comments_151858.json:
```json
{
    "body": "Sorry, I made a last-minute change in the reviewer patch (namely, by mistake, I changed \"ticket ???\" into \"ticket 12876\", but I think ??? really refers to a ticket that has not been created, yet. Anyway, feel free to change ??? into something real! And disregard trac_12876-reviewer.2.patch, which was created by mistake.\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch",
    "created_at": "2012-04-27T14:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151858",
    "user": "SimonKing"
}
```

Sorry, I made a last-minute change in the reviewer patch (namely, by mistake, I changed "ticket ???" into "ticket 12876", but I think ??? really refers to a ticket that has not been created, yet. Anyway, feel free to change ??? into something real! And disregard trac_12876-reviewer.2.patch, which was created by mistake.

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch



---

archive/issue_comments_151859.json:
```json
{
    "body": "I tried whether one can remove the `__new__` and `__getnewargs__` methods. However, when doing so, one gets a reproducible timeout in the tests for sage/rings/polynomial/multi_polynomial_sequence.py - that's the only error.\n\nSo, better keep it as it is.\n\nRecall: I would give it a positive review, if you agree with the additional dependencies.",
    "created_at": "2012-04-27T16:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151859",
    "user": "SimonKing"
}
```

I tried whether one can remove the `__new__` and `__getnewargs__` methods. However, when doing so, one gets a reproducible timeout in the tests for sage/rings/polynomial/multi_polynomial_sequence.py - that's the only error.

So, better keep it as it is.

Recall: I would give it a positive review, if you agree with the additional dependencies.



---

archive/issue_comments_151860.json:
```json
{
    "body": "Replying to [comment:17 SimonKing]:\n> Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?\n\nI did not test it. But it simplifies quite much the logic and the calling overhead occurs only for the first call, so I assumed it was negligible.",
    "created_at": "2012-04-27T17:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151860",
    "user": "nthiery"
}
```

Replying to [comment:17 SimonKing]:
> Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?

I did not test it. But it simplifies quite much the logic and the calling overhead occurs only for the first call, so I assumed it was negligible.



---

archive/issue_comments_151861.json:
```json
{
    "body": "Replying to [comment:21 SimonKing]:\n> Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?\n\nThat's ok for me. Thanks for tracking all of those down! I'll try to review #12215, but that probably won't be before Monday.",
    "created_at": "2012-04-27T17:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151861",
    "user": "nthiery"
}
```

Replying to [comment:21 SimonKing]:
> Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?

That's ok for me. Thanks for tracking all of those down! I'll try to review #12215, but that probably won't be before Monday.



---

archive/issue_comments_151862.json:
```json
{
    "body": "Hi Simon!\n\nReplying to [comment:22 SimonKing]:\n> With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], all doc tests pass.\n\nCool!\n> In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.\n\nOops. Those are #12879 and #12880 respectively.\n> \n> I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?\n> But then, shouldn't `__getnewargs__` be removed as well?\n\nYes, that was my intention indeed: in principle they should not be needed, and I forgot to remove them. I'll investigate the failure you report on Monday, unless you beat me to it.\n\n\n> Please tell whether you want to address these questions in an additional patch.\n\nUnless removing __getnewargs__ turns out to be hard, I'd rather fix all of the above right now.\nFeel free to experiment: I won't download the patches before Monday.\n\nThanks a lot for all your quick work on this :-)",
    "created_at": "2012-04-27T17:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151862",
    "user": "nthiery"
}
```

Hi Simon!

Replying to [comment:22 SimonKing]:
> With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment:trac_12876_category-fix_abstract_class-nt-rel11521.patch], all doc tests pass.

Cool!
> In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.

Oops. Those are #12879 and #12880 respectively.
> 
> I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?
> But then, shouldn't `__getnewargs__` be removed as well?

Yes, that was my intention indeed: in principle they should not be needed, and I forgot to remove them. I'll investigate the failure you report on Monday, unless you beat me to it.


> Please tell whether you want to address these questions in an additional patch.

Unless removing __getnewargs__ turns out to be hard, I'd rather fix all of the above right now.
Feel free to experiment: I won't download the patches before Monday.

Thanks a lot for all your quick work on this :-)



---

archive/issue_comments_151863.json:
```json
{
    "body": "Replying to [comment:18 SimonKing]:\n> Another point: I had inserted a comment in #11521, namely \"Apparently _Hom_ is supposed to be cached.\" This is why I did not insert stuff in the (weak) cache.\n> \n> Do you lift that assumption? Then, we should see what _Hom_ methods actually do caching. They should at most do *weak* caching.\n\nYes: I consider that all the caching logic should be in Hom; in particular the _Hom_ methods should not do caching (and if I recall correctly, they currently don't). We should probably add a note about this in the documentation of Hom.",
    "created_at": "2012-04-27T17:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151863",
    "user": "nthiery"
}
```

Replying to [comment:18 SimonKing]:
> Another point: I had inserted a comment in #11521, namely "Apparently _Hom_ is supposed to be cached." This is why I did not insert stuff in the (weak) cache.
> 
> Do you lift that assumption? Then, we should see what _Hom_ methods actually do caching. They should at most do *weak* caching.

Yes: I consider that all the caching logic should be in Hom; in particular the _Hom_ methods should not do caching (and if I recall correctly, they currently don't). We should probably add a note about this in the documentation of Hom.



---

archive/issue_comments_151864.json:
```json
{
    "body": "I have uploaded a reviewer's patch which fixes the trac ticket numbers, and removes completely Rings.HomCategory. I could not reproduce the timeout:\n\n```\nsage -t  \"devel/sage-combinat/sage/rings/polynomial/multi_polynomial_sequence.py\"\n\t [8.6 s]\n```\n\n\nCan you check again?\n\nIf you are happy with the change, please fold everything, and set a positive review.",
    "created_at": "2012-04-30T08:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151864",
    "user": "nthiery"
}
```

I have uploaded a reviewer's patch which fixes the trac ticket numbers, and removes completely Rings.HomCategory. I could not reproduce the timeout:

```
sage -t  "devel/sage-combinat/sage/rings/polynomial/multi_polynomial_sequence.py"
	 [8.6 s]
```


Can you check again?

If you are happy with the change, please fold everything, and set a positive review.



---

archive/issue_comments_151865.json:
```json
{
    "body": "I just verified: I don't see a timeout anymore. Strange.\n\nAnyway, I am now running make testlong, and if everything works, I'll give it a positive review and provide a combined patch.",
    "created_at": "2012-04-30T10:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151865",
    "user": "SimonKing"
}
```

I just verified: I don't see a timeout anymore. Strange.

Anyway, I am now running make testlong, and if everything works, I'll give it a positive review and provide a combined patch.



---

archive/issue_comments_151866.json:
```json
{
    "body": "Too bad. \"make testlong\" resulted in\n\n```\nsage -t  --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n    sage: phi.category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n    sage: f.category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\n```\n\nand\n\n```\nsage -t  --long -force_lib \"devel/sage/sage/categories/homset.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 228:\n    sage: Hom(PA,PJ).category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 339:\n    sage: End(QQ).category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n```\n\n\nI have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.",
    "created_at": "2012-04-30T13:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151866",
    "user": "SimonKing"
}
```

Too bad. "make testlong" resulted in

```
sage -t  --long -force_lib "devel/sage/sage/categories/map.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
    sage: phi.category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
    sage: f.category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
```

and

```
sage -t  --long -force_lib "devel/sage/sage/categories/homset.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 228:
    sage: Hom(PA,PJ).category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 339:
    sage: End(QQ).category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
```


I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.



---

archive/issue_comments_151867.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-30T13:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151867",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_151868.json:
```json
{
    "body": "Replying to [comment:31 SimonKing]:\n> I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.\n\nTo be precise (in case I forgot to apply one patch):\n\n```\n\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876-reviewer.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```\n",
    "created_at": "2012-04-30T13:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151868",
    "user": "SimonKing"
}
```

Replying to [comment:31 SimonKing]:
> I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.

To be precise (in case I forgot to apply one patch):

```

king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876-reviewer.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```




---

archive/issue_comments_151869.json:
```json
{
    "body": "Ok, this is totally benign. Now, to minimize change, the easiest is probably to keep the HomCategory even if we delete its containt. The updated reviewer's patch does just that.\n\nCheers,\n                        Nicolas",
    "created_at": "2012-04-30T13:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151869",
    "user": "nthiery"
}
```

Ok, this is totally benign. Now, to minimize change, the easiest is probably to keep the HomCategory even if we delete its containt. The updated reviewer's patch does just that.

Cheers,
                        Nicolas



---

archive/issue_comments_151870.json:
```json
{
    "body": "Attachment\n\n[attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] doesn't work, because you confused ` with '.\n\nPlease change the following hunk:\n\n```diff\n--- hecke_modules.py\n+++ hecke_modules.py\n@@ -116,7 +116,7 @@ class HeckeModules(Category_module):\n             Fixing :meth:`_test_zero` (``__call__`` should accept a\n             function as input) and :meth:`_test_elements` (modular\n             form morphisms elements should inherit from categories) is\n-            :trac:`???`.\n+            :trac:`12879`.\n \n             TESTS::\n```\n\nsince the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.",
    "created_at": "2012-05-02T10:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151870",
    "user": "SimonKing"
}
```

Attachment

[attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] doesn't work, because you confused ` with '.

Please change the following hunk:

```diff
--- hecke_modules.py
+++ hecke_modules.py
@@ -116,7 +116,7 @@ class HeckeModules(Category_module):
             Fixing :meth:`_test_zero` (``__call__`` should accept a
             function as input) and :meth:`_test_elements` (modular
             form morphisms elements should inherit from categories) is
-            :trac:`???`.
+            :trac:`12879`.
 
             TESTS::
```

since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.



---

archive/issue_comments_151871.json:
```json
{
    "body": "I get four errors with `make ptestlong`:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t  --long -force_lib devel/sage/sage/categories/homset.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/categories/map.pyx # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nnamely\n\n```\nsage -t --long -force_lib \"devel/sage/sage/categories/homset.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 228:\n    sage: Hom(PA,PJ).category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 337:\n    sage: End(QQ).category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\n```\n\nand\n\n```\nsage -t --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n    sage: phi.category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n    sage: f.category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\n```\n\n\nFor reference, I have\n\n```\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qapplied \ntrac_12808-classcall_speedup-fh.patch\ntrac_12808_nested_class_cython.patch\ntrac_12808-classcall_cdef.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```\n\nHow is that different from your setting?",
    "created_at": "2012-05-02T13:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151871",
    "user": "SimonKing"
}
```

I get four errors with `make ptestlong`:

```
----------------------------------------------------------------------

The following tests failed:

	sage -t  --long -force_lib devel/sage/sage/categories/homset.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/categories/map.pyx # 2 doctests failed
----------------------------------------------------------------------
```

namely

```
sage -t --long -force_lib "devel/sage/sage/categories/homset.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 228:
    sage: Hom(PA,PJ).category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 337:
    sage: End(QQ).category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
```

and

```
sage -t --long -force_lib "devel/sage/sage/categories/map.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
    sage: phi.category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
    sage: f.category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
```


For reference, I have

```
king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qapplied 
trac_12808-classcall_speedup-fh.patch
trac_12808_nested_class_cython.patch
trac_12808-classcall_cdef.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```

How is that different from your setting?



---

archive/issue_comments_151872.json:
```json
{
    "body": "Replying to [comment:34 SimonKing]:\n> [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] doesn't work, because you confused ` with '.\n> \n> Please change the following hunk:\n> {{{\n> #!diff\n> --- hecke_modules.py\n> +++ hecke_modules.py\n> `@``@` -116,7 +116,7 `@``@` class HeckeModules(Category_module):\n>              Fixing :meth:`_test_zero` (``__call__`` should accept a\n>              function as input) and :meth:`_test_elements` (modular\n>              form morphisms elements should inherit from categories) is\n> -            :trac:`???`.\n> +            :trac:`12879`.\n>  \n>              TESTS::\n> }}}\n> since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.\n\nDid you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?",
    "created_at": "2012-05-02T13:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151872",
    "user": "nthiery"
}
```

Replying to [comment:34 SimonKing]:
> [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] doesn't work, because you confused ` with '.
> 
> Please change the following hunk:
> {{{
> #!diff
> --- hecke_modules.py
> +++ hecke_modules.py
> `@``@` -116,7 +116,7 `@``@` class HeckeModules(Category_module):
>              Fixing :meth:`_test_zero` (``__call__`` should accept a
>              function as input) and :meth:`_test_elements` (modular
>              form morphisms elements should inherit from categories) is
> -            :trac:`???`.
> +            :trac:`12879`.
>  
>              TESTS::
> }}}
> since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.

Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?



---

archive/issue_comments_151873.json:
```json
{
    "body": "Replying to [comment:35 SimonKing]:\n> I get four errors with `make ptestlong`:\n> ...\n> {{{\n> sage -t --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n> **********************************************************************\n> File \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n>     sage: phi.category()\n> Expected:\n>     Category of hom sets in Category of rings\n> Got:\n>     Category of hom sets in Category of sets\n> **********************************************************************\n> File \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n>     sage: f.category()\n> Expected:\n>     Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\n> Got:\n>     Category of hom sets in Category of modules over Rational Field\n> **********************************************************************\n> }}}\n\nThis looks like the errors I was getting when I had removed completely\nRings.HomCategory. Can you double check that you have the latest\nversion of the reviewer patch from trac and that categories/rings.py\nindeed has an (empty) class Rings.Homcategory?",
    "created_at": "2012-05-02T13:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151873",
    "user": "nthiery"
}
```

Replying to [comment:35 SimonKing]:
> I get four errors with `make ptestlong`:
> ...
> {{{
> sage -t --long -force_lib "devel/sage/sage/categories/map.pyx"
> **********************************************************************
> File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
>     sage: phi.category()
> Expected:
>     Category of hom sets in Category of rings
> Got:
>     Category of hom sets in Category of sets
> **********************************************************************
> File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
>     sage: f.category()
> Expected:
>     Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
> Got:
>     Category of hom sets in Category of modules over Rational Field
> **********************************************************************
> }}}

This looks like the errors I was getting when I had removed completely
Rings.HomCategory. Can you double check that you have the latest
version of the reviewer patch from trac and that categories/rings.py
indeed has an (empty) class Rings.Homcategory?



---

archive/issue_comments_151874.json:
```json
{
    "body": "Replying to [comment:36 nthiery]:\n> Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?\n\nNope! I thought that your review patch replaces mine.",
    "created_at": "2012-05-02T14:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151874",
    "user": "SimonKing"
}
```

Replying to [comment:36 nthiery]:
> Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?

Nope! I thought that your review patch replaces mine.



---

archive/issue_comments_151875.json:
```json
{
    "body": "Replying to [comment:37 nthiery]:\n> This looks like the errors I was getting when I had removed completely\n> Rings.HomCategory. Can you double check that you have the latest\n> version of the reviewer patch from trac and that categories/rings.py\n> indeed has an (empty) class Rings.Homcategory?\n\nNo, categories/rings.py has no Homcategory. So, am I using the wrong patch?",
    "created_at": "2012-05-02T14:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151875",
    "user": "SimonKing"
}
```

Replying to [comment:37 nthiery]:
> This looks like the errors I was getting when I had removed completely
> Rings.HomCategory. Can you double check that you have the latest
> version of the reviewer patch from trac and that categories/rings.py
> indeed has an (empty) class Rings.Homcategory?

No, categories/rings.py has no Homcategory. So, am I using the wrong patch?



---

archive/issue_comments_151876.json:
```json
{
    "body": "Application works when *both* reviewer patches are applied. I am changing the ticket description accordingly.",
    "created_at": "2012-05-02T14:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151876",
    "user": "SimonKing"
}
```

Application works when *both* reviewer patches are applied. I am changing the ticket description accordingly.



---

archive/issue_comments_151877.json:
```json
{
    "body": "PS: With \n\n```\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\ntrac_12808-classcall_speedup-fh.patch\ntrac_12808_nested_class_cython.patch\ntrac_12808-classcall_cdef.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876-reviewer.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```\n\n`sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.",
    "created_at": "2012-05-02T14:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151877",
    "user": "SimonKing"
}
```

PS: With 

```
king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
trac_12808-classcall_speedup-fh.patch
trac_12808_nested_class_cython.patch
trac_12808-classcall_cdef.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876-reviewer.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```

`sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.



---

archive/issue_comments_151878.json:
```json
{
    "body": "PS: We really should do something about source code inspection! See what happens if you do\n\n```\nsage: sage.categories.rings.Rings.HomCategory??\n```\n\nor\n\n```\nsage: edit(sage.categories.rings.Rings.HomCategory,'vim')\n```\n\nI thought I had fixed that in some ticket!!",
    "created_at": "2012-05-02T14:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151878",
    "user": "SimonKing"
}
```

PS: We really should do something about source code inspection! See what happens if you do

```
sage: sage.categories.rings.Rings.HomCategory??
```

or

```
sage: edit(sage.categories.rings.Rings.HomCategory,'vim')
```

I thought I had fixed that in some ticket!!



---

archive/issue_comments_151879.json:
```json
{
    "body": "Replying to [comment:42 SimonKing]:\n> I thought I had fixed that in some ticket!!\n\nI did: #11768, needing review (hint-hint).",
    "created_at": "2012-05-02T14:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151879",
    "user": "SimonKing"
}
```

Replying to [comment:42 SimonKing]:
> I thought I had fixed that in some ticket!!

I did: #11768, needing review (hint-hint).



---

archive/issue_comments_151880.json:
```json
{
    "body": "Replying to [comment:41 SimonKing]:\n> PS: With \n> {{{\n> king`@`mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\n> trac_12808-classcall_speedup-fh.patch\n> trac_12808_nested_class_cython.patch\n> trac_12808-classcall_cdef.patch\n> trac12215_weak_cached_function.patch\n> trac12215_segfault_fixes.patch\n> trac_715_combined.patch\n> trac_11521_homset_weakcache_combined.patch\n> trac_12875-category-fix_abvar_homspace-nt.patch\n> trac_12877-category-for_more_rings_and_schemes-nt.patch\n> trac_12876_category-fix_abstract_class-nt-rel11521.patch\n> trac_12876-reviewer.patch\n> trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n> }}}\n> `sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.\n\nCool. I guess you are running the tests now, right?",
    "created_at": "2012-05-02T14:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151880",
    "user": "nthiery"
}
```

Replying to [comment:41 SimonKing]:
> PS: With 
> {{{
> king`@`mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
> trac_12808-classcall_speedup-fh.patch
> trac_12808_nested_class_cython.patch
> trac_12808-classcall_cdef.patch
> trac12215_weak_cached_function.patch
> trac12215_segfault_fixes.patch
> trac_715_combined.patch
> trac_11521_homset_weakcache_combined.patch
> trac_12875-category-fix_abvar_homspace-nt.patch
> trac_12877-category-for_more_rings_and_schemes-nt.patch
> trac_12876_category-fix_abstract_class-nt-rel11521.patch
> trac_12876-reviewer.patch
> trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
> }}}
> `sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.

Cool. I guess you are running the tests now, right?



---

archive/issue_comments_151881.json:
```json
{
    "body": "Replying to [comment:44 nthiery]:\n> Cool. I guess you are running the tests now, right?\n\nI have already verified that the two problematic tests pass. If it works, it will be a positive review.\n\nAdmittedly, I am running the test suite with #9107 and #11768 applied as well...",
    "created_at": "2012-05-02T17:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151881",
    "user": "SimonKing"
}
```

Replying to [comment:44 nthiery]:
> Cool. I guess you are running the tests now, right?

I have already verified that the two problematic tests pass. If it works, it will be a positive review.

Admittedly, I am running the test suite with #9107 and #11768 applied as well...



---

archive/issue_comments_151882.json:
```json
{
    "body": "I'm afraid it still needs a tiny bit of work. `make ptestlong` resulted in (only) one error, namely\n\n```\nsage -t --long -force_lib \"devel/sage/sage/misc/sageinspect.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/misc/sageinspect.py\", line 1495:\n    sage: sage_getsourcelines(HC)\nExpected:\n    (['    class HomCategory(HomCategory):\\n',\n     '        def extra_super_categories(self):\\n',\n     ...\n     '                return (self.domain(), self.codomain(), self.category())\\n'], ...)\nGot:\n    (['    class HomCategory(HomCategory):\\n', '        pass\\n'], 564)\n**********************************************************************\n1 items had failures:\n   1 of  24 in __main__.example_27\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /mnt/local/king/.sage/tmp/sageinspect_13253.py\n         [14.0 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t --long -force_lib \"devel/sage/sage/misc/sageinspect.py\"\nTotal time for all tests: 14.0 seconds\n```\n\n\nApparently this is caused by emptying the HomCategory of Rings().",
    "created_at": "2012-05-02T18:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151882",
    "user": "SimonKing"
}
```

I'm afraid it still needs a tiny bit of work. `make ptestlong` resulted in (only) one error, namely

```
sage -t --long -force_lib "devel/sage/sage/misc/sageinspect.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/misc/sageinspect.py", line 1495:
    sage: sage_getsourcelines(HC)
Expected:
    (['    class HomCategory(HomCategory):\n',
     '        def extra_super_categories(self):\n',
     ...
     '                return (self.domain(), self.codomain(), self.category())\n'], ...)
Got:
    (['    class HomCategory(HomCategory):\n', '        pass\n'], 564)
**********************************************************************
1 items had failures:
   1 of  24 in __main__.example_27
***Test Failed*** 1 failures.
For whitespace errors, see the file /mnt/local/king/.sage/tmp/sageinspect_13253.py
         [14.0 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t --long -force_lib "devel/sage/sage/misc/sageinspect.py"
Total time for all tests: 14.0 seconds
```


Apparently this is caused by emptying the HomCategory of Rings().



---

archive/issue_comments_151883.json:
```json
{
    "body": "PS: The obvious fix is to change the expected result in the test...",
    "created_at": "2012-05-02T18:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151883",
    "user": "SimonKing"
}
```

PS: The obvious fix is to change the expected result in the test...



---

archive/issue_comments_151884.json:
```json
{
    "body": "Me stupid! The failing test is only introduced in #11768. So, I had better not apply more than the necessary patches...\n\nRunning the failing tests without the additional patch works.\n\nHence, repeating the test suite now... Sorry!",
    "created_at": "2012-05-02T18:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151884",
    "user": "SimonKing"
}
```

Me stupid! The failing test is only introduced in #11768. So, I had better not apply more than the necessary patches...

Running the failing tests without the additional patch works.

Hence, repeating the test suite now... Sorry!



---

archive/issue_comments_151885.json:
```json
{
    "body": "Now it works. It is thus a positive review.",
    "created_at": "2012-05-02T21:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151885",
    "user": "SimonKing"
}
```

Now it works. It is thus a positive review.



---

archive/issue_comments_151886.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-05-02T21:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151886",
    "user": "SimonKing"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_151887.json:
```json
{
    "body": "Replying to [comment:49 SimonKing]:\n> Now it works. It is thus a positive review.\n\nThanks! I can't wait for 5.1 :-)",
    "created_at": "2012-05-02T21:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151887",
    "user": "nthiery"
}
```

Replying to [comment:49 SimonKing]:
> Now it works. It is thus a positive review.

Thanks! I can't wait for 5.1 :-)



---

archive/issue_comments_151888.json:
```json
{
    "body": "I forgot to remove the \"work issues\".",
    "created_at": "2012-05-03T12:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151888",
    "user": "SimonKing"
}
```

I forgot to remove the "work issues".



---

archive/issue_comments_151889.json:
```json
{
    "body": "The third patch needs a proper commit message.",
    "created_at": "2012-05-07T12:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151889",
    "user": "jdemeyer"
}
```

The third patch needs a proper commit message.



---

archive/issue_comments_151890.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-08-27T11:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151890",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_151891.json:
```json
{
    "body": "This needs to be rebased to sage-5.3.rc0 + #715 + #11521 + #12215 + #12313.",
    "created_at": "2012-08-27T11:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151891",
    "user": "jdemeyer"
}
```

This needs to be rebased to sage-5.3.rc0 + #715 + #11521 + #12215 + #12313.



---

archive/issue_comments_151892.json:
```json
{
    "body": "Attachment\n\nReplacement of [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] wrt to the new patch versions at #715, #12313 etc.",
    "created_at": "2012-08-28T10:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151892",
    "user": "SimonKing"
}
```

Attachment

Replacement of [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] wrt to the new patch versions at #715, #12313 etc.



---

archive/issue_comments_151893.json:
```json
{
    "body": "I have replaced Nicolas' first patch, under a new name. The changes became necessary by changes in the patches at #715 and #12313. Now I am running doctests.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch     trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch",
    "created_at": "2012-08-28T10:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151893",
    "user": "SimonKing"
}
```

I have replaced Nicolas' first patch, under a new name. The changes became necessary by changes in the patches at #715 and #12313. Now I am running doctests.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch     trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch



---

archive/issue_comments_151894.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-28T10:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151894",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151895.json:
```json
{
    "body": "With sage-5.3.b2 plus #715, #11521, #12215, #12313, #13370, #13378 and the patches from here, I get\n\n```\nmake ptest\n...\nThe following tests failed:\n\n        sage -t  -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed\n        sage -t  -force_lib devel/sage/sage/rings/polynomial/infinite_polynomial_ring.py # 0 doctests failed\n        sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py # 1 doctests failed\n```\n\n\nThe error in hecke_modules.py is due to\n\n```\nNotImplementedError: please implement _an_element_ for Set of Morphisms from Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field to Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field in Category of Hecke modules over Rational Field\n```\n\n\nThe error in expect/r.py looks strange to me:\n\n```\nsage -t  -force_lib devel/sage/sage/interfaces/r.py\n**********************************************************************\nFile \"/mnt/local/king/SAGE/prereleases/sage-5.3.beta2/devel/sage-main/sage/interfaces/r.py\", line 1169:\n    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_43\n```\n\nThe error is not reproducible, at least not if I run the test individually.\n\nIn infinite_polynomial_ring.py one gets a segfault. One does *not* get a segfault when running the tests with `--verbose`. But gdb yields the following backtrace:\n\n```\n#0  PyObject_Malloc (nbytes=123) at Objects/obmalloc.c:788\n#1  0x00007ffff7a9bd5b in string_concat (a=0x7ffff7ed6730, bb=0x54c6180) at Objects/stringobject.c:1056\n#2  0x00007ffff7a9dda5 in PyString_Concat (pv=0x7fffffffac58, w=<value optimized out>) at Objects/stringobject.c:3862\n#3  0x00007ffff7a46025 in string_concatenate (v=0x7ffff7ed6730, w=0x54c6180, f=<value optimized out>, next_instr=<value optimized out>) at Python/ceval.c:4856\n#4  0x00007ffff7af56c7 in PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:1548\n#5  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5b70, kwcount=0,\n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#6  0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#7  call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#8  PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#9  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5930, kwcount=0,\n    defs=0x7ffff7f70968, defcount=1, closure=0x0) at Python/ceval.c:3253\n#10 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#11 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#12 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#13 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x50ed188, kwcount=0,\n    defs=0x7ffff7f708e8, defcount=1, closure=0x0) at Python/ceval.c:3253\n#14 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#15 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#16 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#17 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecf90, kwcount=0,\n    defs=0x4918628, defcount=1, closure=0x0) at Python/ceval.c:3253\n#18 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#19 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#20 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#21 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecd88, kwcount=0,\n    defs=0x7ffff7f708a8, defcount=1, closure=0x0) at Python/ceval.c:3253\n#22 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#23 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#24 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#25 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ec980, kwcount=0, \n    defs=0x7ffff7f5aa40, defcount=2, closure=0x0) at Python/ceval.c:3253\n#26 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#27 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#28 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#29 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50eac40, kwcount=1, \n    defs=0x7ffff7ee9218, defcount=2, closure=0x0) at Python/ceval.c:3253\n#30 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#31 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#32 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#33 0x00007ffff7af627b in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4107\n#34 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#35 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#36 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#37 0x00007ffff7a7a02c in function_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/funcobject.c:526\n#38 0x00007ffff7a522c3 in PyObject_Call (func=0x491cb18, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#39 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/classobject.c:2578\n#40 0x00007ffff7a522c3 in PyObject_Call (func=0x42995f0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#41 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239\n#42 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044\n#43 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#44 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x4d12cf0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#45 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#46 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#47 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#48 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x488e5b0, kwcount=3, \n    defs=0x491d388, defcount=3, closure=0x0) at Python/ceval.c:3253\n#49 0x00007ffff7a7a123 in function_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/funcobject.c:526\n#50 0x00007ffff7a522c3 in PyObject_Call (func=0x491cc80, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#51 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/classobject.c:2578\n#52 0x00007ffff7a522c3 in PyObject_Call (func=0x4856be0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#53 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239\n#54 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044\n#55 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#56 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x4068fd0, kwcount=0, \n    defs=0x48c48d8, defcount=3, closure=0x0) at Python/ceval.c:3253\n#57 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#58 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#59 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#60 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x49af830, kwcount=10, \n    defs=0x49104a8, defcount=10, closure=0x0) at Python/ceval.c:3253\n#61 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#62 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#63 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#64 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=1, kws=0x6d8fb8, kwcount=3, \n    defs=0x4910310, defcount=10, closure=0x0) at Python/ceval.c:3253\n#65 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#66 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#67 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#68 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#69 0x00007ffff7af7262 in PyEval_EvalCode (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>) at Python/ceval.c:667\n#70 0x00007ffff7b19760 in run_mod (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380)\n    at Python/pythonrun.c:1353\n#71 PyRun_FileExFlags (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380) at Python/pythonrun.c:1339\n#72 0x00007ffff7b1a1ff in PyRun_SimpleFileExFlags (fp=0x6c66c0, filename=0x7fffffffd8ff \"/mnt/local/king/.sage/tmp/infinite_polynomial_ring_15153.py\", closeit=1, flags=0x7fffffffd380)\n    at Python/pythonrun.c:943\n#73 0x00007ffff7b2d4b5 in Py_Main (argc=<value optimized out>, argv=<value optimized out>) at Modules/main.c:639\n#74 0x00007ffff6e1ec8d in __libc_start_main (main=<value optimized out>, argc=<value optimized out>, ubp_av=<value optimized out>, init=<value optimized out>, fini=<value optimized out>, \n    rtld_fini=<value optimized out>, stack_end=0x7fffffffd498) at libc-start.c:228\n#75 0x0000000000400619 in _start ()\n```\n\n\nCould very well be that this is (once again) due to the new weak caches. But I will also rerun without #13370 and #13378.",
    "created_at": "2012-08-28T11:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151895",
    "user": "SimonKing"
}
```

With sage-5.3.b2 plus #715, #11521, #12215, #12313, #13370, #13378 and the patches from here, I get

```
make ptest
...
The following tests failed:

        sage -t  -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed
        sage -t  -force_lib devel/sage/sage/rings/polynomial/infinite_polynomial_ring.py # 0 doctests failed
        sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py # 1 doctests failed
```


The error in hecke_modules.py is due to

```
NotImplementedError: please implement _an_element_ for Set of Morphisms from Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field to Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field in Category of Hecke modules over Rational Field
```


The error in expect/r.py looks strange to me:

```
sage -t  -force_lib devel/sage/sage/interfaces/r.py
**********************************************************************
File "/mnt/local/king/SAGE/prereleases/sage-5.3.beta2/devel/sage-main/sage/interfaces/r.py", line 1169:
    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_43
```

The error is not reproducible, at least not if I run the test individually.

In infinite_polynomial_ring.py one gets a segfault. One does *not* get a segfault when running the tests with `--verbose`. But gdb yields the following backtrace:

```
#0  PyObject_Malloc (nbytes=123) at Objects/obmalloc.c:788
#1  0x00007ffff7a9bd5b in string_concat (a=0x7ffff7ed6730, bb=0x54c6180) at Objects/stringobject.c:1056
#2  0x00007ffff7a9dda5 in PyString_Concat (pv=0x7fffffffac58, w=<value optimized out>) at Objects/stringobject.c:3862
#3  0x00007ffff7a46025 in string_concatenate (v=0x7ffff7ed6730, w=0x54c6180, f=<value optimized out>, next_instr=<value optimized out>) at Python/ceval.c:4856
#4  0x00007ffff7af56c7 in PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:1548
#5  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5b70, kwcount=0,
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#6  0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#7  call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#8  PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#9  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5930, kwcount=0,
    defs=0x7ffff7f70968, defcount=1, closure=0x0) at Python/ceval.c:3253
#10 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#11 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#12 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#13 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x50ed188, kwcount=0,
    defs=0x7ffff7f708e8, defcount=1, closure=0x0) at Python/ceval.c:3253
#14 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#15 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#16 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#17 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecf90, kwcount=0,
    defs=0x4918628, defcount=1, closure=0x0) at Python/ceval.c:3253
#18 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#19 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#20 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#21 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecd88, kwcount=0,
    defs=0x7ffff7f708a8, defcount=1, closure=0x0) at Python/ceval.c:3253
#22 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#23 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#24 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#25 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ec980, kwcount=0, 
    defs=0x7ffff7f5aa40, defcount=2, closure=0x0) at Python/ceval.c:3253
#26 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#27 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#28 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#29 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50eac40, kwcount=1, 
    defs=0x7ffff7ee9218, defcount=2, closure=0x0) at Python/ceval.c:3253
#30 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#31 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#32 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#33 0x00007ffff7af627b in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4107
#34 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#35 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#36 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#37 0x00007ffff7a7a02c in function_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/funcobject.c:526
#38 0x00007ffff7a522c3 in PyObject_Call (func=0x491cb18, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#39 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/classobject.c:2578
#40 0x00007ffff7a522c3 in PyObject_Call (func=0x42995f0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#41 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239
#42 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044
#43 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#44 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x4d12cf0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#45 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#46 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#47 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#48 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x488e5b0, kwcount=3, 
    defs=0x491d388, defcount=3, closure=0x0) at Python/ceval.c:3253
#49 0x00007ffff7a7a123 in function_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/funcobject.c:526
#50 0x00007ffff7a522c3 in PyObject_Call (func=0x491cc80, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#51 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/classobject.c:2578
#52 0x00007ffff7a522c3 in PyObject_Call (func=0x4856be0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#53 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239
#54 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044
#55 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#56 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x4068fd0, kwcount=0, 
    defs=0x48c48d8, defcount=3, closure=0x0) at Python/ceval.c:3253
#57 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#58 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#59 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#60 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x49af830, kwcount=10, 
    defs=0x49104a8, defcount=10, closure=0x0) at Python/ceval.c:3253
#61 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#62 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#63 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#64 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=1, kws=0x6d8fb8, kwcount=3, 
    defs=0x4910310, defcount=10, closure=0x0) at Python/ceval.c:3253
#65 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#66 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#67 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#68 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#69 0x00007ffff7af7262 in PyEval_EvalCode (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>) at Python/ceval.c:667
#70 0x00007ffff7b19760 in run_mod (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380)
    at Python/pythonrun.c:1353
#71 PyRun_FileExFlags (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380) at Python/pythonrun.c:1339
#72 0x00007ffff7b1a1ff in PyRun_SimpleFileExFlags (fp=0x6c66c0, filename=0x7fffffffd8ff "/mnt/local/king/.sage/tmp/infinite_polynomial_ring_15153.py", closeit=1, flags=0x7fffffffd380)
    at Python/pythonrun.c:943
#73 0x00007ffff7b2d4b5 in Py_Main (argc=<value optimized out>, argv=<value optimized out>) at Modules/main.c:639
#74 0x00007ffff6e1ec8d in __libc_start_main (main=<value optimized out>, argc=<value optimized out>, ubp_av=<value optimized out>, init=<value optimized out>, fini=<value optimized out>, 
    rtld_fini=<value optimized out>, stack_end=0x7fffffffd498) at libc-start.c:228
#75 0x0000000000400619 in _start ()
```


Could very well be that this is (once again) due to the new weak caches. But I will also rerun without #13370 and #13378.



---

archive/issue_comments_151896.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-28T11:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151896",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_151897.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-28T14:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151897",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151898.json:
```json
{
    "body": "Got it!\n\nInfinite polynomial rings were using `WeakKeyDict` in `_has_coerce_map_from_`for caching whether there is a coercion. That has probably been a bad idea, because the methods that are really used (`has_coerce_map`) have a cache anyway.\n\nRemoving the additional cache fixes the segfault.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-28T14:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151898",
    "user": "SimonKing"
}
```

Got it!

Infinite polynomial rings were using `WeakKeyDict` in `_has_coerce_map_from_`for caching whether there is a coercion. That has probably been a bad idea, because the methods that are really used (`has_coerce_map`) have a cache anyway.

Removing the additional cache fixes the segfault.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_151899.json:
```json
{
    "body": "One has to remove the dependency #715, because #715 and #11521 are mutually dependent, but #715 needs to be applied first.\n\nAnyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a _an_element_ method. The error with r seems to have been noise.",
    "created_at": "2012-08-28T15:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151899",
    "user": "SimonKing"
}
```

One has to remove the dependency #715, because #715 and #11521 are mutually dependent, but #715 needs to be applied first.

Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a _an_element_ method. The error with r seems to have been noise.



---

archive/issue_comments_151900.json:
```json
{
    "body": "Replying to [comment:60 SimonKing]:\n> Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a _an_element_ method.\n\n... or: One could replace that test - after all, the test is new (introduced in the first patch).",
    "created_at": "2012-08-28T15:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151900",
    "user": "SimonKing"
}
```

Replying to [comment:60 SimonKing]:
> Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a _an_element_ method.

... or: One could replace that test - after all, the test is new (introduced in the first patch).



---

archive/issue_comments_151901.json:
```json
{
    "body": "I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.\n\nI am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:\n\n```\nsage: M = ModularForms(Gamma0(7), 4)\nsage: H = Hom(M,M)\nsage: H is loads(dumps(H))\nFalse\n```\n\nso that by consequence several tests from the test suite fail.",
    "created_at": "2012-08-28T17:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151901",
    "user": "SimonKing"
}
```

I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.

I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:

```
sage: M = ModularForms(Gamma0(7), 4)
sage: H = Hom(M,M)
sage: H is loads(dumps(H))
False
```

so that by consequence several tests from the test suite fail.



---

archive/issue_comments_151902.json:
```json
{
    "body": "Replying to [comment:62 SimonKing]:\n> {{{\n> sage: M = ModularForms(Gamma0(7), 4)\n> sage: H = Hom(M,M)\n> sage: H is loads(dumps(H))\n> False\n> }}}\n\n... which has two reasons: `H` has no `__reduce__` method, and `M` has no reduce method.",
    "created_at": "2012-08-28T17:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151902",
    "user": "SimonKing"
}
```

Replying to [comment:62 SimonKing]:
> {{{
> sage: M = ModularForms(Gamma0(7), 4)
> sage: H = Hom(M,M)
> sage: H is loads(dumps(H))
> False
> }}}

... which has two reasons: `H` has no `__reduce__` method, and `M` has no reduce method.



---

archive/issue_comments_151903.json:
```json
{
    "body": "Hi Simon!\n\nReplying to [comment:62 SimonKing]:\n> I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.\n> \n> I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:\n> {{{\n> sage: M = ModularForms(Gamma0(7), 4)\n> sage: H = Hom(M,M)\n> sage: H is loads(dumps(H))\n> False\n> }}}\n> so that by consequence several tests from the test suite fail.\n\nFeel free to just skip the failing tests and mention them, say on #12879.\n\nAnd thanks a lot for all the work you put in rebasing/finalizing this patch! I'll try to look at it tomorrow.\n\nCheers,\n                         Nicolas",
    "created_at": "2012-08-28T20:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151903",
    "user": "nthiery"
}
```

Hi Simon!

Replying to [comment:62 SimonKing]:
> I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.
> 
> I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:
> {{{
> sage: M = ModularForms(Gamma0(7), 4)
> sage: H = Hom(M,M)
> sage: H is loads(dumps(H))
> False
> }}}
> so that by consequence several tests from the test suite fail.

Feel free to just skip the failing tests and mention them, say on #12879.

And thanks a lot for all the work you put in rebasing/finalizing this patch! I'll try to look at it tomorrow.

Cheers,
                         Nicolas



---

archive/issue_comments_151904.json:
```json
{
    "body": "Replying to [comment:64 nthiery]:\n> Feel free to just skip the failing tests and mention them, say on #12879.\n\n... and to remove the erroneous documentation (or perhaps: Marking it as \"TODO\").\n\nI was confident that I have produced a patch (not posted, though) that does the right thing with the categories of Hecke homsets. In fact, the full `TestSuite` of these homsets passes. However, a surprising amount of tests fail, all over sage. So, I guess you are right: One should work around for now, and fix it for real in #12879.\n\nCheers,\nSimon",
    "created_at": "2012-08-28T21:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151904",
    "user": "SimonKing"
}
```

Replying to [comment:64 nthiery]:
> Feel free to just skip the failing tests and mention them, say on #12879.

... and to remove the erroneous documentation (or perhaps: Marking it as "TODO").

I was confident that I have produced a patch (not posted, though) that does the right thing with the categories of Hecke homsets. In fact, the full `TestSuite` of these homsets passes. However, a surprising amount of tests fail, all over sage. So, I guess you are right: One should work around for now, and fix it for real in #12879.

Cheers,
Simon



---

archive/issue_comments_151905.json:
```json
{
    "body": "I have updated the last patch, so that more tests from the failing `TestSuite` are skipped. Let's see if the patchbot is happy.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-29T09:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151905",
    "user": "SimonKing"
}
```

I have updated the last patch, so that more tests from the failing `TestSuite` are skipped. Let's see if the patchbot is happy.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_151906.json:
```json
{
    "body": "Attachment\n\nDo not weak-cache things in infinite_polynomial_ring that are cached anyway. Skip more tests in Hecke homset's `TestSuite`",
    "created_at": "2012-08-29T13:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151906",
    "user": "SimonKing"
}
```

Attachment

Do not weak-cache things in infinite_polynomial_ring that are cached anyway. Skip more tests in Hecke homset's `TestSuite`



---

archive/issue_comments_151907.json:
```json
{
    "body": "Oops, I thought that I had an outdated version of my last patch, but apparently it has been the correct one. Anyway, I'll restart the patchbot and will run the tests on my own machine as well, and will of course have a look at Nicolas' patches\n\nFrom Nicolas' comment on #12879, I understood that he accepts to make the `TestSuite` temporarily silent and leave a proper fix to the number theorists. I guess that's a healthy attitude...\n\nI hope that Nicolas also likes the fix for infinite polynomial rings.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-29T13:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151907",
    "user": "SimonKing"
}
```

Oops, I thought that I had an outdated version of my last patch, but apparently it has been the correct one. Anyway, I'll restart the patchbot and will run the tests on my own machine as well, and will of course have a look at Nicolas' patches

From Nicolas' comment on #12879, I understood that he accepts to make the `TestSuite` temporarily silent and leave a proper fix to the number theorists. I guess that's a healthy attitude...

I hope that Nicolas also likes the fix for infinite polynomial rings.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_151908.json:
```json
{
    "body": "Some questions, Nicolas:\n\nThe first patch contains\n\n```\nsage: category = FiniteDimensionalModulesWithBasis(QQ) \nsage: X = CombinatorialFreeModule(QQ, [1,2,3], category = category);   X.rename(\"X\") \nsage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], category = category); Y.rename(\"Y\") \nsage: H = Hom(X, Y) \nsage: H.zero().category_for() \nCategory of finite dimensional modules with basis over Rational Field\n```\n\nWhy are X and Y renamed? There is yet another location where things are renamed, namely\n\n```\nDiagonal functions can be constructed using the ``diagonal`` option:: \n\n    sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename(\"X\") \n    sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key=\"Y\"); Y.rename(\"Y\") \n    sage: H = Hom(X, Y)\n```\n\nHere, I also wonder about the \"key\" argument.\n\nIn sage.rings.ring.pyx, you state:\n\n```\n    \"\"\"\n    This temporary alias is here for those instances of :class:`Ring`\n    that are not yet properly in the :class:`Rings`() category.\n\n    TESTS::\n\n        sage: A = Ring(ZZ)\n        sage: A._Hom_.__module__\n        'sage.categories.rings'\n        sage: Hom(A,A).__class__\n        <class 'sage.rings.homset.RingHomset_generic_with_category'>\n    \"\"\"\n    _Hom_ = Rings.ParentMethods.__dict__['_Hom_']\n```\n\nAre there any rings that do not initialise the category, after #9138? Hence, what would happen without that alias? Perhaps I'll test it, after finishing the tests for the original patches.",
    "created_at": "2012-08-29T13:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151908",
    "user": "SimonKing"
}
```

Some questions, Nicolas:

The first patch contains

```
sage: category = FiniteDimensionalModulesWithBasis(QQ) 
sage: X = CombinatorialFreeModule(QQ, [1,2,3], category = category);   X.rename("X") 
sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], category = category); Y.rename("Y") 
sage: H = Hom(X, Y) 
sage: H.zero().category_for() 
Category of finite dimensional modules with basis over Rational Field
```

Why are X and Y renamed? There is yet another location where things are renamed, namely

```
Diagonal functions can be constructed using the ``diagonal`` option:: 

    sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename("X") 
    sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key="Y"); Y.rename("Y") 
    sage: H = Hom(X, Y)
```

Here, I also wonder about the "key" argument.

In sage.rings.ring.pyx, you state:

```
    """
    This temporary alias is here for those instances of :class:`Ring`
    that are not yet properly in the :class:`Rings`() category.

    TESTS::

        sage: A = Ring(ZZ)
        sage: A._Hom_.__module__
        'sage.categories.rings'
        sage: Hom(A,A).__class__
        <class 'sage.rings.homset.RingHomset_generic_with_category'>
    """
    _Hom_ = Rings.ParentMethods.__dict__['_Hom_']
```

Are there any rings that do not initialise the category, after #9138? Hence, what would happen without that alias? Perhaps I'll test it, after finishing the tests for the original patches.



---

archive/issue_comments_151909.json:
```json
{
    "body": "All tests passed, and the patches look good to me, modulo the questions that I asked above. I will now rerun the tests without the alias for _Hom_.",
    "created_at": "2012-08-29T16:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151909",
    "user": "SimonKing"
}
```

All tests passed, and the patches look good to me, modulo the questions that I asked above. I will now rerun the tests without the alias for _Hom_.



---

archive/issue_comments_151910.json:
```json
{
    "body": "When removing the _Hom_ alias, I get\n\n```\n        sage -t  -force_lib devel/sage/sage/rings/multi_power_series_ring_element.py # 5 doctests failed\n```\n\nSo, apparently it *is* needed.",
    "created_at": "2012-08-29T17:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151910",
    "user": "SimonKing"
}
```

When removing the _Hom_ alias, I get

```
        sage -t  -force_lib devel/sage/sage/rings/multi_power_series_ring_element.py # 5 doctests failed
```

So, apparently it *is* needed.



---

archive/issue_comments_151911.json:
```json
{
    "body": "Another reviewer patch",
    "created_at": "2012-08-29T21:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151911",
    "user": "SimonKing"
}
```

Another reviewer patch



---

archive/issue_comments_151912.json:
```json
{
    "body": "Attachment\n\nI give it a positive review, modulo commit message of [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] and modulo the small reviewer patch that I have attached. I think it should be `.. todo::` and not `..TODO::` (note the blank space).\n\nSo, when you added a commit message to your patch, then please change it into a positive review!\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch  trac_12876_another_reviewer.patch",
    "created_at": "2012-08-29T21:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151912",
    "user": "SimonKing"
}
```

Attachment

I give it a positive review, modulo commit message of [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch] and modulo the small reviewer patch that I have attached. I think it should be `.. todo::` and not `..TODO::` (note the blank space).

So, when you added a commit message to your patch, then please change it into a positive review!

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch  trac_12876_another_reviewer.patch



---

archive/issue_comments_151913.json:
```json
{
    "body": "Here is the problem with removing the nasty alias:\n\n```\nsage: A.<a,b> = PowerSeriesRing(QQ)\nsage: A._is_category_initialized()\nFalse\nsage: isinstance(A,Ring)\nTrue\n```\n\n\nHence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.",
    "created_at": "2012-08-30T08:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151913",
    "user": "SimonKing"
}
```

Here is the problem with removing the nasty alias:

```
sage: A.<a,b> = PowerSeriesRing(QQ)
sage: A._is_category_initialized()
False
sage: isinstance(A,Ring)
True
```


Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.



---

archive/issue_comments_151914.json:
```json
{
    "body": "Replying to [comment:72 SimonKing]:\n> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.\n\nSee #13412",
    "created_at": "2012-08-30T08:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151914",
    "user": "SimonKing"
}
```

Replying to [comment:72 SimonKing]:
> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.

See #13412



---

archive/issue_comments_151915.json:
```json
{
    "body": "Hi Simon,\n\nSorry, I am slow answering; I was immersed all afternoon in tracking\ndown a nasty bug where UniqueRepresentation was violated. It turned\nout that the UniqueRepresentation dict had to equal entries in its\nkeys (gasp), and that was due to a tricky mro order for a non trivial\ninheritance involving Category_singleton and FastHash which got the\nhash to change over time ... Anyway ...\n\nReplying to [comment:68 SimonKing]:\n> {{{\n> Diagonal functions can be constructed using the ``diagonal`` option:: \n> \n>     sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename(\"X\") \n>     sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key=\"Y\"); Y.rename(\"Y\") \n>     sage: H = Hom(X, Y)\n> }}}\n> Why are X and Y renamed? There is yet another location where things are renamed, namely\n> Here, I also wonder about the \"key\" argument.\n\nI do this fairly systematically in the tests in modules_with_basis. It\nmakes it immediate to check that the domain and codomain are set\nproperly when looking at the repr of a morphism or homset. They key is\nto force the domain and codomain to be distinct (otherwise, and this\nhappened to me, if the code accidently interchanges the two it will\nget unnoticed).\n\nWell, and for good or bad, once you rename a given parent in a\ndoctest, you have to rename consistently this parent in all other\ndoctests in the same file. Or to call X.rename() at the end of the\ndoctest.",
    "created_at": "2012-08-30T08:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151915",
    "user": "nthiery"
}
```

Hi Simon,

Sorry, I am slow answering; I was immersed all afternoon in tracking
down a nasty bug where UniqueRepresentation was violated. It turned
out that the UniqueRepresentation dict had to equal entries in its
keys (gasp), and that was due to a tricky mro order for a non trivial
inheritance involving Category_singleton and FastHash which got the
hash to change over time ... Anyway ...

Replying to [comment:68 SimonKing]:
> {{{
> Diagonal functions can be constructed using the ``diagonal`` option:: 
> 
>     sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename("X") 
>     sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key="Y"); Y.rename("Y") 
>     sage: H = Hom(X, Y)
> }}}
> Why are X and Y renamed? There is yet another location where things are renamed, namely
> Here, I also wonder about the "key" argument.

I do this fairly systematically in the tests in modules_with_basis. It
makes it immediate to check that the domain and codomain are set
properly when looking at the repr of a morphism or homset. They key is
to force the domain and codomain to be distinct (otherwise, and this
happened to me, if the code accidently interchanges the two it will
get unnoticed).

Well, and for good or bad, once you rename a given parent in a
doctest, you have to rename consistently this parent in all other
doctests in the same file. Or to call X.rename() at the end of the
doctest.



---

archive/issue_comments_151916.json:
```json
{
    "body": "Replying to [comment:72 SimonKing]:\n> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.\n\n+1\n\nCan you just add a mini comment on #13412 stating that once it's done the alias can be removed?\n\nThanks!",
    "created_at": "2012-08-30T08:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151916",
    "user": "nthiery"
}
```

Replying to [comment:72 SimonKing]:
> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.

+1

Can you just add a mini comment on #13412 stating that once it's done the alias can be removed?

Thanks!



---

archive/issue_comments_151917.json:
```json
{
    "body": "Replying to [comment:71 SimonKing]:\n> I give it a positive review, modulo commit message of\n> [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch]\n> and modulo the small reviewer patch that I have attached. I think it\n> should be `.. todo::` and not `..TODO::` (note the blank space).\n\nThanks for fixing the space. Apparently, there is some sort of\nconsensus for using .. TODO:: rather than .. todo:: (same thing\nfor seealso, ...).\n\nI have checked the change on infinite polynomial rings, and am ok with\nit.\n\nDo you mind folding all patches together? Now that we have checked the\nlittle steps, that will leave a better overview for the future. And\nthat will take care of the commit messages :-)\n\n(or I can do it, but I need to get the latest beta version first).\n\nAnd then, it's ready for positive review! Yippee!\n\nCheers,\n                   Nicolas",
    "created_at": "2012-08-30T09:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151917",
    "user": "nthiery"
}
```

Replying to [comment:71 SimonKing]:
> I give it a positive review, modulo commit message of
> [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch]
> and modulo the small reviewer patch that I have attached. I think it
> should be `.. todo::` and not `..TODO::` (note the blank space).

Thanks for fixing the space. Apparently, there is some sort of
consensus for using .. TODO:: rather than .. todo:: (same thing
for seealso, ...).

I have checked the change on infinite polynomial rings, and am ok with
it.

Do you mind folding all patches together? Now that we have checked the
little steps, that will leave a better overview for the future. And
that will take care of the commit messages :-)

(or I can do it, but I need to get the latest beta version first).

And then, it's ready for positive review! Yippee!

Cheers,
                   Nicolas



---

archive/issue_comments_151918.json:
```json
{
    "body": "Replying to [comment:76 nthiery]:\n> Replying to [comment:71 SimonKing]:\n> > I give it a positive review, modulo commit message of\n> > [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch]\n> > and modulo the small reviewer patch that I have attached. I think it\n> > should be `.. todo::` and not `..TODO::` (note the blank space).\n> \n> Thanks for fixing the space. Apparently, there is some sort of\n> consensus for using .. TODO:: rather than .. todo:: (same thing\n> for seealso, ...).\n\nI wouldn't mind to have it upper case.\n\n> (or I can do it, but I need to get the latest beta version first).\n\nI don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.",
    "created_at": "2012-08-30T10:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151918",
    "user": "SimonKing"
}
```

Replying to [comment:76 nthiery]:
> Replying to [comment:71 SimonKing]:
> > I give it a positive review, modulo commit message of
> > [attachment:trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch]
> > and modulo the small reviewer patch that I have attached. I think it
> > should be `.. todo::` and not `..TODO::` (note the blank space).
> 
> Thanks for fixing the space. Apparently, there is some sort of
> consensus for using .. TODO:: rather than .. todo:: (same thing
> for seealso, ...).

I wouldn't mind to have it upper case.

> (or I can do it, but I need to get the latest beta version first).

I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.



---

archive/issue_comments_151919.json:
```json
{
    "body": "Replying to [comment:77 SimonKing]:\n> I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.\n\nI meant for folding the patches together!",
    "created_at": "2012-08-30T10:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151919",
    "user": "nthiery"
}
```

Replying to [comment:77 SimonKing]:
> I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.

I meant for folding the patches together!



---

archive/issue_comments_151920.json:
```json
{
    "body": "Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?",
    "created_at": "2012-08-30T11:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151920",
    "user": "SimonKing"
}
```

Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?



---

archive/issue_comments_151921.json:
```json
{
    "body": "Replying to [comment:79 SimonKing]:\n> Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?\n\nIt's not so much about the release manager than for whoever will come\nback to this ticket in the future, and will want to have a synthetic\nview of what the patch(es) does.\n\nSeparate patches are temporarily good for incremental review. They can\nbe interesting too in the long run when they do independent\nchanges. But when they pile on top of each other (typically for\ntrivial typo fixes) it goes in the way of the reader. Typically (s)he\nwill read the main patch, see a typo, wonder if it has been fixed,\nwill have to dig through the followup patches, think about the order\nin which they are to be applied, etc.",
    "created_at": "2012-08-30T12:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151921",
    "user": "nthiery"
}
```

Replying to [comment:79 SimonKing]:
> Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?

It's not so much about the release manager than for whoever will come
back to this ticket in the future, and will want to have a synthetic
view of what the patch(es) does.

Separate patches are temporarily good for incremental review. They can
be interesting too in the long run when they do independent
changes. But when they pile on top of each other (typically for
trivial typo fixes) it goes in the way of the reader. Typically (s)he
will read the main patch, see a typo, wonder if it has been fixed,
will have to dig through the followup patches, think about the order
in which they are to be applied, etc.



---

archive/issue_comments_151922.json:
```json
{
    "body": "I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it \"needs review\" for now, but will change it into positive review provided the tests pass.\n\nApply  trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2012-08-30T13:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151922",
    "user": "SimonKing"
}
```

I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it "needs review" for now, but will change it into positive review provided the tests pass.

Apply  trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_151923.json:
```json
{
    "body": "Replying to [comment:81 SimonKing]:\n> I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it \"needs review\" for now, but will change it into positive review provided the tests pass.\n> \n> Apply  trac_12876_category_abstract_classes_for_hom.patch\n\nExcellent, thanks!\n\nIs there any of the old patches that you would like to keep for posterity, or should I just wipe them up?\n\nCheers,",
    "created_at": "2012-08-30T13:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151923",
    "user": "nthiery"
}
```

Replying to [comment:81 SimonKing]:
> I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it "needs review" for now, but will change it into positive review provided the tests pass.
> 
> Apply  trac_12876_category_abstract_classes_for_hom.patch

Excellent, thanks!

Is there any of the old patches that you would like to keep for posterity, or should I just wipe them up?

Cheers,



---

archive/issue_comments_151924.json:
```json
{
    "body": "I wouldn't remove the old patches from trac - and actually I wouldn't be able to remove them -, unless there are problems with disc space etc. And IF there will eventually be problems with disc space, I guess a better solution would be to start deleting the attachments of tickets that are merged since, say, at least one year.",
    "created_at": "2012-08-30T13:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151924",
    "user": "SimonKing"
}
```

I wouldn't remove the old patches from trac - and actually I wouldn't be able to remove them -, unless there are problems with disc space etc. And IF there will eventually be problems with disc space, I guess a better solution would be to start deleting the attachments of tickets that are merged since, say, at least one year.



---

archive/issue_comments_151925.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-30T14:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151925",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_151926.json:
```json
{
    "body": "That's bad. Pathbot reports\n\n```\n\tsage -t  -force_lib devel/sage-12876/sage/rings/polynomial/infinite_polynomial_ring.py # Killed/crashed\n\tsage -t  -force_lib devel/sage-12876/sage/interfaces/r.py # 1 doctests failed\n```\n\n\nThe crash in infinite_polynomial_ring.py was supposed to be fixed with one of the folded patches, namely removing the additional weak cache. The second one has occurred on my computer as well - but was not reproducible, so I thought it was just some noise.\n\nBad.",
    "created_at": "2012-08-30T14:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151926",
    "user": "SimonKing"
}
```

That's bad. Pathbot reports

```
	sage -t  -force_lib devel/sage-12876/sage/rings/polynomial/infinite_polynomial_ring.py # Killed/crashed
	sage -t  -force_lib devel/sage-12876/sage/interfaces/r.py # 1 doctests failed
```


The crash in infinite_polynomial_ring.py was supposed to be fixed with one of the folded patches, namely removing the additional weak cache. The second one has occurred on my computer as well - but was not reproducible, so I thought it was just some noise.

Bad.



---

archive/issue_comments_151927.json:
```json
{
    "body": "I tried to stress-test my machine, running 16 copies of the infinite_polynomial_ring tests in parallel on only 4 kernels, but I was not able to reproduce the segfault.\n\nConcerning the other error, perhaps one can add the following patch:\n\n```patch\ndiff --git a/sage/interfaces/r.py b/sage/interfaces/r.py\n--- a/sage/interfaces/r.py\n+++ b/sage/interfaces/r.py\n@@ -1166,7 +1166,7 @@\n \n         ::\n \n-            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())\n+            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))\n             True\n         \"\"\"\n         self.execute('setwd(%r)' % dir)\n```\n",
    "created_at": "2012-08-30T15:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151927",
    "user": "SimonKing"
}
```

I tried to stress-test my machine, running 16 copies of the infinite_polynomial_ring tests in parallel on only 4 kernels, but I was not able to reproduce the segfault.

Concerning the other error, perhaps one can add the following patch:

```patch
diff --git a/sage/interfaces/r.py b/sage/interfaces/r.py
--- a/sage/interfaces/r.py
+++ b/sage/interfaces/r.py
@@ -1166,7 +1166,7 @@
 
         ::
 
-            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())
+            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))
             True
         """
         self.execute('setwd(%r)' % dir)
```




---

archive/issue_comments_151928.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-30T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151928",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151929.json:
```json
{
    "body": "Let's try, even though I have no idea about the segfault:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch",
    "created_at": "2012-08-30T15:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151929",
    "user": "SimonKing"
}
```

Let's try, even though I have no idea about the segfault:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch



---

archive/issue_comments_151930.json:
```json
{
    "body": "OK, the r-test works now. But the segfault remains. I wish I could reproduce it, preferably in verbose mode.",
    "created_at": "2012-08-30T15:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151930",
    "user": "SimonKing"
}
```

OK, the r-test works now. But the segfault remains. I wish I could reproduce it, preferably in verbose mode.



---

archive/issue_comments_151931.json:
```json
{
    "body": "I tried to valgrind the failing segfault (Nils Bruin recommended valgrind and posted a sage.supp at #11918), in the hope that it'll find something fishy even if it doesn't result in a segfault.\n\nWhen I run the tests of sage/rings/polynomial/infinite_polynomial_ring.py, I do not get a SIGILL. But I do get a considerable amount of lost memory:\n\n```\n==13541== 13,936 bytes in 1 blocks are definitely lost in loss record 8,673 of 8,997\n==13541==    at 0x4C244E8: malloc (vg_replace_malloc.c:236)\n==13541==    by 0x21E8984F: omAllocFromSystem (omAllocSystem.c:184)\n==13541==    by 0x21E89A21: omAllocLarge (omAllocSystem.c:39)\n==13541==    by 0x21BB3A00: iiAllStart(procinfo*, char*, feBufferTypes, int) (omalloc.h:2432)\n==13541==    by 0x21BB3B95: iiPStart(idrec*, sleftv*) (iplib.cc:360)\n==13541==    by 0x21BB4148: iiMake_proc(idrec*, sip_package*, sleftv*) (iplib.cc:482)\n==13541==    by 0x2239B64D: __pyx_f_4sage_4libs_8singular_8function_call_function(__pyx_obj_4sage_4libs_8singular_8function_SingularFunction*, _object*, _object*, __pyx_opt_args_4sage_4libs_8singular_8f\nunction_call_function*) (function.cpp:13241)\n==13541==    by 0x2239CBA8: __pyx_pw_4sage_4libs_8singular_8function_16SingularFunction_5__call__(_object*, _object*, _object*) (function.cpp:11924)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F160FC: PyEval_EvalFrameEx (ceval.c:4239)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0xB29B841: __pyx_pw_4sage_4misc_9cachefunc_12CachedMethod_3_instance_call (cachefunc.c:9733)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0xB29C7D4: __pyx_pw_4sage_4misc_9cachefunc_18CachedMethodCaller_7__call__ (cachefunc.c:7254)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n```\n\nIs there a way to find out what singular_function or what cached method are involved?",
    "created_at": "2012-08-30T21:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151931",
    "user": "SimonKing"
}
```

I tried to valgrind the failing segfault (Nils Bruin recommended valgrind and posted a sage.supp at #11918), in the hope that it'll find something fishy even if it doesn't result in a segfault.

When I run the tests of sage/rings/polynomial/infinite_polynomial_ring.py, I do not get a SIGILL. But I do get a considerable amount of lost memory:

```
==13541== 13,936 bytes in 1 blocks are definitely lost in loss record 8,673 of 8,997
==13541==    at 0x4C244E8: malloc (vg_replace_malloc.c:236)
==13541==    by 0x21E8984F: omAllocFromSystem (omAllocSystem.c:184)
==13541==    by 0x21E89A21: omAllocLarge (omAllocSystem.c:39)
==13541==    by 0x21BB3A00: iiAllStart(procinfo*, char*, feBufferTypes, int) (omalloc.h:2432)
==13541==    by 0x21BB3B95: iiPStart(idrec*, sleftv*) (iplib.cc:360)
==13541==    by 0x21BB4148: iiMake_proc(idrec*, sip_package*, sleftv*) (iplib.cc:482)
==13541==    by 0x2239B64D: __pyx_f_4sage_4libs_8singular_8function_call_function(__pyx_obj_4sage_4libs_8singular_8function_SingularFunction*, _object*, _object*, __pyx_opt_args_4sage_4libs_8singular_8f
unction_call_function*) (function.cpp:13241)
==13541==    by 0x2239CBA8: __pyx_pw_4sage_4libs_8singular_8function_16SingularFunction_5__call__(_object*, _object*, _object*) (function.cpp:11924)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F160FC: PyEval_EvalFrameEx (ceval.c:4239)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0xB29B841: __pyx_pw_4sage_4misc_9cachefunc_12CachedMethod_3_instance_call (cachefunc.c:9733)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0xB29C7D4: __pyx_pw_4sage_4misc_9cachefunc_18CachedMethodCaller_7__call__ (cachefunc.c:7254)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
```

Is there a way to find out what singular_function or what cached method are involved?



---

archive/issue_comments_151932.json:
```json
{
    "body": "It seems that #13145 fixes the segfault that was sometimes observed at #13370. Perhaps it helps here as well? Let's try!",
    "created_at": "2012-09-01T23:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151932",
    "user": "SimonKing"
}
```

It seems that #13145 fixes the segfault that was sometimes observed at #13370. Perhaps it helps here as well? Let's try!



---

archive/issue_comments_151933.json:
```json
{
    "body": "Too bad, #13145 didn't help.\n\nI'd really need some help to trace the problem down. Could someone run the test in verbose mode on one of the machines exposing the segfault, so that one can see whether the problem is during the tests or while shutting down Sage? Can someone produce (and post) a backtrace?",
    "created_at": "2012-09-02T07:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151933",
    "user": "SimonKing"
}
```

Too bad, #13145 didn't help.

I'd really need some help to trace the problem down. Could someone run the test in verbose mode on one of the machines exposing the segfault, so that one can see whether the problem is during the tests or while shutting down Sage? Can someone produce (and post) a backtrace?



---

archive/issue_comments_151934.json:
```json
{
    "body": "There is a potential name conflict between an attribute S of Action and `RingHomomorphism`. The former has been turned into a weak reference at #715. I am now trying to rename the attribute of Action, and updated the main patch at #715 accordingly.\n\nHence, kicking the patchbot now. Hope it works!",
    "created_at": "2012-09-03T09:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151934",
    "user": "SimonKing"
}
```

There is a potential name conflict between an attribute S of Action and `RingHomomorphism`. The former has been turned into a weak reference at #715. I am now trying to rename the attribute of Action, and updated the main patch at #715 accordingly.

Hence, kicking the patchbot now. Hope it works!



---

archive/issue_comments_151935.json:
```json
{
    "body": "It doesn't work. Hence, again I'd like to finally see a backtrace of the segfault. So far, I tried to reproduce the segfault on my linux laptop, but to no avail. Next, I'll try bsd.math.",
    "created_at": "2012-09-03T12:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151935",
    "user": "SimonKing"
}
```

It doesn't work. Hence, again I'd like to finally see a backtrace of the segfault. So far, I tried to reproduce the segfault on my linux laptop, but to no avail. Next, I'll try bsd.math.



---

archive/issue_comments_151936.json:
```json
{
    "body": "Now I am totally puzzled. On bsd.math, admittedly with the new GAP 4.5.5 spkg, I get\n\n```\nThe following tests failed:\n\n        sage -t  -force_lib devel/sage/sage/combinat/combinatorial_algebra.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/partition.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/classical.py # 11 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/dual.py # 89 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/elementary.py # 9 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/hall_littlewood.py # 61 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/homogeneous.py # 9 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/jack.py # 68 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/kschur.py # 15 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/llt.py # 50 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/monomial.py # 16 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/ns_macdonald.py # 2 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/macdonald.py # 106 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/orthotriang.py # 25 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/powersum.py # 17 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/schur.py # 13 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/sfa.py # 291 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/composition_species.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/functorial_composition_species.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/generating_series.py # 38 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/library.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/species.py # 4 doctests failed\n```\n\nbut no segfault. Does one need #5457?",
    "created_at": "2012-09-03T14:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151936",
    "user": "SimonKing"
}
```

Now I am totally puzzled. On bsd.math, admittedly with the new GAP 4.5.5 spkg, I get

```
The following tests failed:

        sage -t  -force_lib devel/sage/sage/combinat/combinatorial_algebra.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/partition.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/classical.py # 11 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/dual.py # 89 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/elementary.py # 9 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/hall_littlewood.py # 61 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/homogeneous.py # 9 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/jack.py # 68 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/kschur.py # 15 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/llt.py # 50 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/monomial.py # 16 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/ns_macdonald.py # 2 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/macdonald.py # 106 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/orthotriang.py # 25 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/powersum.py # 17 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/schur.py # 13 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/sfa.py # 291 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/composition_species.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/functorial_composition_species.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/generating_series.py # 38 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/library.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/species.py # 4 doctests failed
```

but no segfault. Does one need #5457?



---

archive/issue_comments_151937.json:
```json
{
    "body": "Did you forget a `./sage -b` by chance?",
    "created_at": "2012-09-03T14:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151937",
    "user": "jdemeyer"
}
```

Did you forget a `./sage -b` by chance?



---

archive/issue_comments_151938.json:
```json
{
    "body": "Replying to [comment:94 jdemeyer]:\n> Did you forget a `./sage -b` by chance?\n\nDoesn't `make ptest` start with `./sage -b`?",
    "created_at": "2012-09-03T14:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151938",
    "user": "SimonKing"
}
```

Replying to [comment:94 jdemeyer]:
> Did you forget a `./sage -b` by chance?

Doesn't `make ptest` start with `./sage -b`?



---

archive/issue_comments_151939.json:
```json
{
    "body": "It is really really REALLY frustrating. Volker's patchbot keeps reporting a segfault, but I can not reproduce it on bsd.math, With #5457 and the new GAP spkg, make ptest just reports a single error:\n\n```\nsage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"      \n**********************************************************************\nFile \"/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py\", line 809:\n    sage: gap(2)\nExpected:\n    2\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 items had failures:\n   1 of   4 in __main__.example_21\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py\n         [29.6 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"\nTotal time for all tests: 29.7 seconds\n```\n\nThat's rather strange, but I guess that's the problem of the GAP spkg.\n\nIn any case, I don't see a segfault. Not on my laptop, not on the machine in my office, not on bsd.math.",
    "created_at": "2012-09-03T19:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151939",
    "user": "SimonKing"
}
```

It is really really REALLY frustrating. Volker's patchbot keeps reporting a segfault, but I can not reproduce it on bsd.math, With #5457 and the new GAP spkg, make ptest just reports a single error:

```
sage -t -force_lib "devel/sage/sage/interfaces/gap.py"      
**********************************************************************
File "/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py", line 809:
    sage: gap(2)
Expected:
    2
Got:
    <BLANKLINE>
**********************************************************************
1 items had failures:
   1 of   4 in __main__.example_21
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py
         [29.6 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -force_lib "devel/sage/sage/interfaces/gap.py"
Total time for all tests: 29.7 seconds
```

That's rather strange, but I guess that's the problem of the GAP spkg.

In any case, I don't see a segfault. Not on my laptop, not on the machine in my office, not on bsd.math.



---

archive/issue_comments_151940.json:
```json
{
    "body": "Meanwhile #11521 has a new dependency, namely #13447, that is supposed to fix the segfaults (which apparently came from a wrong refcount in libsingular).\n\nI am now running `make ptest` on bsd.math.washington.edu, with\n\n```\n$ hg qa\ntrac_715_combined.patch\ntrac_715_local_refcache.patch\ntrac_715_safer.patch\ntrac_715_specification.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_11521_callback.patch\n13145.patch\ntrac_13447-sanitise_ring_refcount.patch\ntrac12215_weak_cached_function-sk.patch\ntrac12215_segfault_fixes.patch\ntrac_12313-mono_dict-combined-random-sk.patch\ntrac_12313_quit_sage.patch\ntrac13370_deprecate_is_field.patch\ntrac_13378-convert_map_shortcut.patch\ntrac_13412_category_for_power_series_rings.patch\ntrac_12876_category_abstract_classes_for_hom.patch\ntrac_12876_r_test.patch\n```\n\napplied on top of sage-5.4.beta0.",
    "created_at": "2012-09-18T09:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151940",
    "user": "SimonKing"
}
```

Meanwhile #11521 has a new dependency, namely #13447, that is supposed to fix the segfaults (which apparently came from a wrong refcount in libsingular).

I am now running `make ptest` on bsd.math.washington.edu, with

```
$ hg qa
trac_715_combined.patch
trac_715_local_refcache.patch
trac_715_safer.patch
trac_715_specification.patch
trac_11521_homset_weakcache_combined.patch
trac_11521_callback.patch
13145.patch
trac_13447-sanitise_ring_refcount.patch
trac12215_weak_cached_function-sk.patch
trac12215_segfault_fixes.patch
trac_12313-mono_dict-combined-random-sk.patch
trac_12313_quit_sage.patch
trac13370_deprecate_is_field.patch
trac_13378-convert_map_shortcut.patch
trac_13412_category_for_power_series_rings.patch
trac_12876_category_abstract_classes_for_hom.patch
trac_12876_r_test.patch
```

applied on top of sage-5.4.beta0.



---

archive/issue_comments_151941.json:
```json
{
    "body": "Hooray, all tests pass :)",
    "created_at": "2012-09-18T10:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151941",
    "user": "SimonKing"
}
```

Hooray, all tests pass :)



---

archive/issue_comments_151942.json:
```json
{
    "body": "Nice!\n\nAnything left to be done to complete the review?",
    "created_at": "2012-09-18T10:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151942",
    "user": "nthiery"
}
```

Nice!

Anything left to be done to complete the review?



---

archive/issue_comments_151943.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-09-18T11:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151943",
    "user": "SimonKing"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_151944.json:
```json
{
    "body": "The work issue was \"understand the crash of r\". I think it *is* now understood, because it could be solved by using `os.realpath` in some test, where apparently a relative path was stored.\n\nAll segfaults that I have seen are gone because of #13447. But it would be nice if Volker's patchbot could try it again, because it seems to have a tendency to break in a different way than my machines.\n\nI have read the patch carefully in the past, and all tests pass, with the patches stated in comment:97.\n\nHence: Positive review, I'd say.",
    "created_at": "2012-09-18T11:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151944",
    "user": "SimonKing"
}
```

The work issue was "understand the crash of r". I think it *is* now understood, because it could be solved by using `os.realpath` in some test, where apparently a relative path was stored.

All segfaults that I have seen are gone because of #13447. But it would be nice if Volker's patchbot could try it again, because it seems to have a tendency to break in a different way than my machines.

I have read the patch carefully in the past, and all tests pass, with the patches stated in comment:97.

Hence: Positive review, I'd say.



---

archive/issue_comments_151945.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-05-11T03:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151945",
    "user": "nthiery"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_151946.json:
```json
{
    "body": "As per the discussion on #13347, I have removed this dependency.\n\nThe patch needs to be rebased upon #14159 and #13184 that have been merged in 5.10beta0. I am working on it.",
    "created_at": "2013-05-11T03:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151946",
    "user": "nthiery"
}
```

As per the discussion on #13347, I have removed this dependency.

The patch needs to be rebased upon #14159 and #13184 that have been merged in 5.10beta0. I am working on it.



---

archive/issue_comments_151947.json:
```json
{
    "body": "I just uploaded a rebased patch. This patch sounds almost good to go.\n\nStill, there are a couple failing tests which all boil to the following little design issue:\n\nTake as typical situation A to be Rings().parent_class, and B to be some NumberField parent class. Assume that P is an instance of A resp. B and that:\n\n- A implements _Hom_ so that P._Hom_(codomain) is a RingHomset if codomain is a ring\n- B implements _Hom_ so that P._Hom_(codomain) is a NumberFieldHomset if codomain is a NumberField\n\nLet P be an instance of B and codomain a ring. With the current logic Hom(P, codomain) will\ntry the later, which will fail, but won't proceed to try the former. So the result will be a plain Homset, and not a RingHomset as desired.\n\nFor some reasons this situation did not appear a year ago. Presumably some tests were added in the mean time. Or we did not run the tests with --long ...\n\nWhat's the best way out?\n\n- Option 1: Walk the mro of the class of P, and call cls._Hom_(P, codomain) in turn until something does not fail\n\n- Option 2: change the protocol so that the _Hom_ method should call super instead of failing if they cannot handle the situation\n\n- Option 3: ???\n\nCheers,\n                                          Nicolas",
    "created_at": "2013-05-11T04:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151947",
    "user": "nthiery"
}
```

I just uploaded a rebased patch. This patch sounds almost good to go.

Still, there are a couple failing tests which all boil to the following little design issue:

Take as typical situation A to be Rings().parent_class, and B to be some NumberField parent class. Assume that P is an instance of A resp. B and that:

- A implements _Hom_ so that P._Hom_(codomain) is a RingHomset if codomain is a ring
- B implements _Hom_ so that P._Hom_(codomain) is a NumberFieldHomset if codomain is a NumberField

Let P be an instance of B and codomain a ring. With the current logic Hom(P, codomain) will
try the later, which will fail, but won't proceed to try the former. So the result will be a plain Homset, and not a RingHomset as desired.

For some reasons this situation did not appear a year ago. Presumably some tests were added in the mean time. Or we did not run the tests with --long ...

What's the best way out?

- Option 1: Walk the mro of the class of P, and call cls._Hom_(P, codomain) in turn until something does not fail

- Option 2: change the protocol so that the _Hom_ method should call super instead of failing if they cannot handle the situation

- Option 3: ???

Cheers,
                                          Nicolas



---

archive/issue_comments_151948.json:
```json
{
    "body": "Two failures were actually trivial:\n\n- A trivial doctest in\n  devel/sage/doc/en/thematic_tutorials/coercion_and_categories.rst\n- More skips were needed in the new TestSuite(H) in line 114 of sage.categories.hecke_modules\n  (some new test methods that require the currently missing an_element were added since last year)\n\nI implemented a simplistic protocol for the above issue. If P._Hom_ fails, then try category.parent_class._Hom_. This is sufficient for the other failing test in Parent.\n\nOther than this, the attached patch is a straightforward rebase of the previous one. So to finalize the review it would suffice to:\n\n- glance at the above change\n- recheck sage.categories.homset.Hom\n\nI am currently running the long tests, but I expect everything to pass.\n\nAlmost done!",
    "created_at": "2013-05-11T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151948",
    "user": "nthiery"
}
```

Two failures were actually trivial:

- A trivial doctest in
  devel/sage/doc/en/thematic_tutorials/coercion_and_categories.rst
- More skips were needed in the new TestSuite(H) in line 114 of sage.categories.hecke_modules
  (some new test methods that require the currently missing an_element were added since last year)

I implemented a simplistic protocol for the above issue. If P._Hom_ fails, then try category.parent_class._Hom_. This is sufficient for the other failing test in Parent.

Other than this, the attached patch is a straightforward rebase of the previous one. So to finalize the review it would suffice to:

- glance at the above change
- recheck sage.categories.homset.Hom

I am currently running the long tests, but I expect everything to pass.

Almost done!



---

archive/issue_comments_151949.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-11T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151949",
    "user": "nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151950.json:
```json
{
    "body": "make ptestlong passed smoothly on my machine!",
    "created_at": "2013-05-11T14:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151950",
    "user": "nthiery"
}
```

make ptestlong passed smoothly on my machine!



---

archive/issue_comments_151951.json:
```json
{
    "body": "Are there dependencies missing? With sage-5.9.rc0, which should contain all the dependencies listed, I get\n\n```\n> hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12876/trac_12876_category_abstract_classes_for_hom.patch\nF\u00fcge trac_12876_category_abstract_classes_for_hom.patch zur Seriendatei hinzu\nWende trac_12876_category_abstract_classes_for_hom.patch an\nWende Patch auf Datei doc/en/thematic_tutorials/coercion_and_categories.rst an\nFEHLSCHLAG von Teilst\u00fcck #1 in Zeile 407\n1 von 1 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei doc/en/thematic_tutorials/coercion_and_categories.rst.rej\nWende Patch auf Datei sage/categories/homset.py an\nTeilst\u00fcck #1 wurde erfolgreich in Zeile 69 mit Unsch\u00e4rfe 2 angewandt (0 Zeilen verschoben).\nFEHLSCHLAG von Teilst\u00fcck #4 in Zeile 181\nFEHLSCHLAG von Teilst\u00fcck #7 in Zeile 273\n2 von 12 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/categories/homset.py.rej\nWende Patch auf Datei sage/modules/vector_space_homspace.py an\nFEHLSCHLAG von Teilst\u00fcck #1 in Zeile 327\n1 von 1 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/modules/vector_space_homspace.py.rej\nPatch schlug fehl und Fortsetzung unm\u00f6glich (versuche -v)\nPatch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis\nFehler beim Anwenden. Bitte beheben und trac_12876_category_abstract_classes_for_hom.patch aktualisieren\n```\n\n\nHence, several failures in applying the first patch.\n\nIt seems that the patchbot applies the patches in the wrong order anyway (and also gets a failure).\n\nTo let the patchbot get it right:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch",
    "created_at": "2013-05-23T17:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151951",
    "user": "SimonKing"
}
```

Are there dependencies missing? With sage-5.9.rc0, which should contain all the dependencies listed, I get

```
> hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12876/trac_12876_category_abstract_classes_for_hom.patch
Füge trac_12876_category_abstract_classes_for_hom.patch zur Seriendatei hinzu
Wende trac_12876_category_abstract_classes_for_hom.patch an
Wende Patch auf Datei doc/en/thematic_tutorials/coercion_and_categories.rst an
FEHLSCHLAG von Teilstück #1 in Zeile 407
1 von 1 Teilstücken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei doc/en/thematic_tutorials/coercion_and_categories.rst.rej
Wende Patch auf Datei sage/categories/homset.py an
Teilstück #1 wurde erfolgreich in Zeile 69 mit Unschärfe 2 angewandt (0 Zeilen verschoben).
FEHLSCHLAG von Teilstück #4 in Zeile 181
FEHLSCHLAG von Teilstück #7 in Zeile 273
2 von 12 Teilstücken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/categories/homset.py.rej
Wende Patch auf Datei sage/modules/vector_space_homspace.py an
FEHLSCHLAG von Teilstück #1 in Zeile 327
1 von 1 Teilstücken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/modules/vector_space_homspace.py.rej
Patch schlug fehl und Fortsetzung unmöglich (versuche -v)
Patch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis
Fehler beim Anwenden. Bitte beheben und trac_12876_category_abstract_classes_for_hom.patch aktualisieren
```


Hence, several failures in applying the first patch.

It seems that the patchbot applies the patches in the wrong order anyway (and also gets a failure).

To let the patchbot get it right:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch



---

archive/issue_comments_151952.json:
```json
{
    "body": "Yes; I rebased the patch upon #14159 and #13184 which have been merged in 5.10 beta0. I just added them to the dependency list for the record.",
    "created_at": "2013-05-23T18:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151952",
    "user": "nthiery"
}
```

Yes; I rebased the patch upon #14159 and #13184 which have been merged in 5.10 beta0. I just added them to the dependency list for the record.



---

archive/issue_comments_151953.json:
```json
{
    "body": "#14287 is also needed. With this, the patch applies.",
    "created_at": "2013-05-23T19:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151953",
    "user": "SimonKing"
}
```

#14287 is also needed. With this, the patch applies.



---

archive/issue_comments_151954.json:
```json
{
    "body": "However, there seems to be yet another dependency for the second patch.",
    "created_at": "2013-05-23T19:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151954",
    "user": "SimonKing"
}
```

However, there seems to be yet another dependency for the second patch.



---

archive/issue_comments_151955.json:
```json
{
    "body": "It fails to apply, because in r.py it reads\n\n```\n           sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)\n```\n\nbut the second patch from here assumes that there is no pointer to #9970.",
    "created_at": "2013-05-23T20:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151955",
    "user": "SimonKing"
}
```

It fails to apply, because in r.py it reads

```
           sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)
```

but the second patch from here assumes that there is no pointer to #9970.



---

archive/issue_comments_151956.json:
```json
{
    "body": "The pointer got introduced in #12415, as it seems.",
    "created_at": "2013-05-23T20:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151956",
    "user": "SimonKing"
}
```

The pointer got introduced in #12415, as it seems.



---

archive/issue_comments_151957.json:
```json
{
    "body": "After applying the failing hunk manually, I am now running make ptestlong.",
    "created_at": "2013-05-23T20:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151957",
    "user": "SimonKing"
}
```

After applying the failing hunk manually, I am now running make ptestlong.



---

archive/issue_comments_151958.json:
```json
{
    "body": "I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](http://trac.sagemath.org/sage_trac/ticket/9970#comment:20) by Simon for background.",
    "created_at": "2013-05-23T20:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151958",
    "user": "kcrisman"
}
```

I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](http://trac.sagemath.org/sage_trac/ticket/9970#comment:20) by Simon for background.



---

archive/issue_comments_151959.json:
```json
{
    "body": "Replying to [comment:116 kcrisman]:\n> I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](http://trac.sagemath.org/sage_trac/ticket/9970#comment:20) by Simon for background.\n\nIn any case, the second patch needs to be rebased against #12415, right?",
    "created_at": "2013-05-23T20:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151959",
    "user": "SimonKing"
}
```

Replying to [comment:116 kcrisman]:
> I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](http://trac.sagemath.org/sage_trac/ticket/9970#comment:20) by Simon for background.

In any case, the second patch needs to be rebased against #12415, right?



---

archive/issue_comments_151960.json:
```json
{
    "body": "Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!",
    "created_at": "2013-05-23T21:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151960",
    "user": "nthiery"
}
```

Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!



---

archive/issue_comments_151961.json:
```json
{
    "body": "Replying to [comment:118 nthiery]:\n> Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!\n\nReally?\n\nOK, then let's try:\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-23T21:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151961",
    "user": "SimonKing"
}
```

Replying to [comment:118 nthiery]:
> Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!

Really?

OK, then let's try:

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_151962.json:
```json
{
    "body": "> It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!\nThis is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.",
    "created_at": "2013-05-24T01:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151962",
    "user": "kcrisman"
}
```

> It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!
This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.



---

archive/issue_comments_151963.json:
```json
{
    "body": "Replying to [comment:120 kcrisman]:\n> This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.\n\nI am fine with that. I just still need to understand at some point how this is related to this ticket :-)",
    "created_at": "2013-05-24T02:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151963",
    "user": "nthiery"
}
```

Replying to [comment:120 kcrisman]:
> This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.

I am fine with that. I just still need to understand at some point how this is related to this ticket :-)



---

archive/issue_comments_151964.json:
```json
{
    "body": "Attachment\n\nWith the attached extra patch, all test still pass and there is no more crappy __new__ in Schemes.HomCategory.ParentMethods.",
    "created_at": "2013-05-24T02:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151964",
    "user": "nthiery"
}
```

Attachment

With the attached extra patch, all test still pass and there is no more crappy __new__ in Schemes.HomCategory.ParentMethods.



---

archive/issue_comments_151965.json:
```json
{
    "body": "Patchbot times out at sage/interfaces/ecm.py. However, with the first two patches, make ptestlong passes.\n\nMy plan is to modify the second patch, so that reference to #9970 is preserved, and to repeat make ptestlong with the third patch.",
    "created_at": "2013-05-24T04:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151965",
    "user": "SimonKing"
}
```

Patchbot times out at sage/interfaces/ecm.py. However, with the first two patches, make ptestlong passes.

My plan is to modify the second patch, so that reference to #9970 is preserved, and to repeat make ptestlong with the third patch.



---

archive/issue_comments_151966.json:
```json
{
    "body": "What other dependency is there for the third patch?",
    "created_at": "2013-05-24T05:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151966",
    "user": "SimonKing"
}
```

What other dependency is there for the third patch?



---

archive/issue_comments_151967.json:
```json
{
    "body": "I have\n\n```\n> hg qa\ntrac_14159_weak_value_triple_dict.patch\ntrac_14159_use_cdef_get.patch\ntrac_13184_sage_5.9.beta.patch\ntrac_14287-rebased.patch\ntrac_12876_category_abstract_classes_for_hom.patch\ntrac_12876_r_test.patch\n```\n\non top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are\n\n```\n            \"\"\"\n            return []\n\n        class ParentMethods:\n\n            def __new__(cls, R, S, category):\n                \"\"\"\n                TESTS::\n\n                    sage: E = EllipticCurve('37a1')\n                    sage: Hom(E, E).__class__\n                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>\n\n                If both schemes R and S are actually specs, we want\n                the parent for Hom(R, S) to be in a different class::\n\n                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__\n                    <class 'sage.schemes.generic.homset.SchemeHomset_points_spec_with_category'>\n\n                Currently, and to minimize the changes, this is done\n                by delegating the job to SchemeHomset. This is not\n                very robust: for example, only one category can do\n                this hack.\n\n                FIXME: this might be better handled by an extra Spec category\n                \"\"\"\n                from sage.schemes.generic.homset import SchemeHomset\n                return SchemeHomset(R, S, category=category)\n\n\n#############################################################\n```\n\n\nHowever, the patch expects\n\n```\n             \"\"\"\n             return []\n \n-        class ParentMethods:\n-\n-            def __new__(cls, R, S, category):\n-                \"\"\"\n-                TESTS::\n-\n-                    sage: E = EllipticCurve('37a1')\n-                    sage: Hom(E, E).__class__\n-                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>\n-\n-                If both schemes R and S are actually specs, we want\n-                the parent for Hom(R, S) to be in a different class::\n-\n-                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__\n-                    <class 'sage.schemes.affine.affine_homset.SchemeHomset_points_spec_with_category'>\n-\n-                Currently, and to minimize the changes, this is done\n-                by delegating the job to SchemeHomset. This is not\n-                very robust: for example, only one category can do\n-                this hack.\n-\n-                FIXME: this might be better handled by an extra Spec category\n-                \"\"\"\n-                from sage.schemes.generic.homset import SchemeHomset\n-                return SchemeHomset(R, S, category=category)\n \n \n #############################################################\n```\n\n\nSo, what tickect changed `sage.schemes.generic.homset.SchemeHomset_points_spec` into `sage.schemes.affine.affine_homset.SchemeHomset_points_spec`?",
    "created_at": "2013-05-24T05:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151967",
    "user": "SimonKing"
}
```

I have

```
> hg qa
trac_14159_weak_value_triple_dict.patch
trac_14159_use_cdef_get.patch
trac_13184_sage_5.9.beta.patch
trac_14287-rebased.patch
trac_12876_category_abstract_classes_for_hom.patch
trac_12876_r_test.patch
```

on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are

```
            """
            return []

        class ParentMethods:

            def __new__(cls, R, S, category):
                """
                TESTS::

                    sage: E = EllipticCurve('37a1')
                    sage: Hom(E, E).__class__
                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>

                If both schemes R and S are actually specs, we want
                the parent for Hom(R, S) to be in a different class::

                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__
                    <class 'sage.schemes.generic.homset.SchemeHomset_points_spec_with_category'>

                Currently, and to minimize the changes, this is done
                by delegating the job to SchemeHomset. This is not
                very robust: for example, only one category can do
                this hack.

                FIXME: this might be better handled by an extra Spec category
                """
                from sage.schemes.generic.homset import SchemeHomset
                return SchemeHomset(R, S, category=category)


#############################################################
```


However, the patch expects

```
             """
             return []
 
-        class ParentMethods:
-
-            def __new__(cls, R, S, category):
-                """
-                TESTS::
-
-                    sage: E = EllipticCurve('37a1')
-                    sage: Hom(E, E).__class__
-                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>
-
-                If both schemes R and S are actually specs, we want
-                the parent for Hom(R, S) to be in a different class::
-
-                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__
-                    <class 'sage.schemes.affine.affine_homset.SchemeHomset_points_spec_with_category'>
-
-                Currently, and to minimize the changes, this is done
-                by delegating the job to SchemeHomset. This is not
-                very robust: for example, only one category can do
-                this hack.
-
-                FIXME: this might be better handled by an extra Spec category
-                """
-                from sage.schemes.generic.homset import SchemeHomset
-                return SchemeHomset(R, S, category=category)
 
 
 #############################################################
```


So, what tickect changed `sage.schemes.generic.homset.SchemeHomset_points_spec` into `sage.schemes.affine.affine_homset.SchemeHomset_points_spec`?



---

archive/issue_comments_151968.json:
```json
{
    "body": "It is #14217.",
    "created_at": "2013-05-24T05:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151968",
    "user": "SimonKing"
}
```

It is #14217.



---

archive/issue_comments_151969.json:
```json
{
    "body": "Attachment\n\nTry to make one test in interfaces/r.py more stable wrt symbolic links",
    "created_at": "2013-05-24T05:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151969",
    "user": "SimonKing"
}
```

Attachment

Try to make one test in interfaces/r.py more stable wrt symbolic links



---

archive/issue_comments_151970.json:
```json
{
    "body": "Patchbot:\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.py trac_12876-schemes_homcategory.patch",
    "created_at": "2013-05-24T05:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151970",
    "user": "SimonKing"
}
```

Patchbot:
Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.py trac_12876-schemes_homcategory.patch



---

archive/issue_comments_151971.json:
```json
{
    "body": "I really don't like [attachment:trac_12876_r_test.patch]. Are we sure the test actually works now (you removed `# known bug`)?",
    "created_at": "2013-05-24T06:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151971",
    "user": "jdemeyer"
}
```

I really don't like [attachment:trac_12876_r_test.patch]. Are we sure the test actually works now (you removed `# known bug`)?



---

archive/issue_comments_151972.json:
```json
{
    "body": "Given that the other patches don't change **anything** in the R interface, it is almost impossible that this ticket could have any influence on the R test. Or at least, it requires a good explanation if something did change.\n\nProposal: do not apply [attachment:trac_12876_r_test.patch]",
    "created_at": "2013-05-24T06:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151972",
    "user": "jdemeyer"
}
```

Given that the other patches don't change **anything** in the R interface, it is almost impossible that this ticket could have any influence on the R test. Or at least, it requires a good explanation if something did change.

Proposal: do not apply [attachment:trac_12876_r_test.patch]



---

archive/issue_comments_151973.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-05-24T06:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151973",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_151974.json:
```json
{
    "body": "I'm fine with not applying the r-test patch. An info that I need: Does that tag `# known bug` mean that the patchbot will not complain about it?",
    "created_at": "2013-05-24T06:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151974",
    "user": "SimonKing"
}
```

I'm fine with not applying the r-test patch. An info that I need: Does that tag `# known bug` mean that the patchbot will not complain about it?



---

archive/issue_comments_151975.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-24T06:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151975",
    "user": "SimonKing"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_151976.json:
```json
{
    "body": "Patchbot:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876-schemes_homcategory.patch",
    "created_at": "2013-05-24T06:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151976",
    "user": "SimonKing"
}
```

Patchbot:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876-schemes_homcategory.patch



---

archive/issue_comments_151977.json:
```json
{
    "body": "Replying to [comment:133 SimonKing]:\n> Does that tag `# known bug` mean that the patchbot will not complain about it?\nYes, see [http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples](http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples)",
    "created_at": "2013-05-24T06:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151977",
    "user": "jdemeyer"
}
```

Replying to [comment:133 SimonKing]:
> Does that tag `# known bug` mean that the patchbot will not complain about it?
Yes, see [http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples](http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples)



---

archive/issue_comments_151978.json:
```json
{
    "body": "Hi Simon!\n\n> on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are\n\nTime for an upgrade maybe? :-)",
    "created_at": "2013-05-24T10:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151978",
    "user": "nthiery"
}
```

Hi Simon!

> on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are

Time for an upgrade maybe? :-)



---

archive/issue_comments_151979.json:
```json
{
    "body": "Patchbot is green :-)",
    "created_at": "2013-05-24T10:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151979",
    "user": "nthiery"
}
```

Patchbot is green :-)



---

archive/issue_comments_151980.json:
```json
{
    "body": "Replying to [comment:138 nthiery]:\n> Patchbot is green :-)\n\nYes, I know. I need some more time to finish yet another job application.",
    "created_at": "2013-05-24T10:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151980",
    "user": "SimonKing"
}
```

Replying to [comment:138 nthiery]:
> Patchbot is green :-)

Yes, I know. I need some more time to finish yet another job application.



---

archive/issue_comments_151981.json:
```json
{
    "body": "Replying to [comment:139 SimonKing]:\n> Yes, I know. I need some more time to finish yet another job application.\n\nI did not mean to pressure; I was just happy :-)\n\nOf course job applications have priority! Good luck!",
    "created_at": "2013-05-24T11:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151981",
    "user": "nthiery"
}
```

Replying to [comment:139 SimonKing]:
> Yes, I know. I need some more time to finish yet another job application.

I did not mean to pressure; I was just happy :-)

Of course job applications have priority! Good luck!



---

archive/issue_comments_151982.json:
```json
{
    "body": "From the commit message:\n- If category is None, Hom simply calls itself with the meet of the\n  categories of the parent, which removes a cache handling duplication.\n\nI don't know if that's a good idea. Duplicating the cache costs virtually nothing (because all objects, categories and homsets involved are there anyway), but it speeds up the most commonly used case, namely category=None. Computing the meet of the underlying categories is expensive, even though it is cached.",
    "created_at": "2013-05-24T11:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151982",
    "user": "SimonKing"
}
```

From the commit message:
- If category is None, Hom simply calls itself with the meet of the
  categories of the parent, which removes a cache handling duplication.

I don't know if that's a good idea. Duplicating the cache costs virtually nothing (because all objects, categories and homsets involved are there anyway), but it speeds up the most commonly used case, namely category=None. Computing the meet of the underlying categories is expensive, even though it is cached.



---

archive/issue_comments_151983.json:
```json
{
    "body": "Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just\n\n```\n    class HomCategory(HomCategory):\n        pass\n```\n\n?\n\nSince all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?\n\nThis could be for a different ticket, though. I just wonder.",
    "created_at": "2013-05-24T12:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151983",
    "user": "SimonKing"
}
```

Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just

```
    class HomCategory(HomCategory):
        pass
```

?

Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?

This could be for a different ticket, though. I just wonder.



---

archive/issue_comments_151984.json:
```json
{
    "body": "BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.",
    "created_at": "2013-05-24T12:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151984",
    "user": "SimonKing"
}
```

BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.



---

archive/issue_comments_151985.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-05-24T12:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151985",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_151986.json:
```json
{
    "body": "Tests passed. I went through both patches, and they look mostly good, except for the minor criticism in comment:141 and comment:142. It is almost a positive review, but perhaps you have a comment on these two points.",
    "created_at": "2013-05-24T12:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151986",
    "user": "SimonKing"
}
```

Tests passed. I went through both patches, and they look mostly good, except for the minor criticism in comment:141 and comment:142. It is almost a positive review, but perhaps you have a comment on these two points.



---

archive/issue_comments_151987.json:
```json
{
    "body": "Replying to [comment:141 SimonKing]:\n> From the commit message:\n> - If category is None, Hom simply calls itself with the meet of the\n>   categories of the parent, which removes a cache handling duplication.\n> \n> I don't know if that's a good idea. Duplicating the cache costs\n> virtually nothing (because all objects, categories and homsets\n> involved are there anyway), but it speeds up the most commonly used\n> case, namely category=None. Computing the meet of the underlying\n> categories is expensive, even though it is cached.\n\nOh you are right. I meant to avoid a duplication in the source code, not in the caching itself. I agree with you, the current code is wrong. I am going to fix this right now.\n\nThanks for catching this!",
    "created_at": "2013-05-24T13:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151987",
    "user": "nthiery"
}
```

Replying to [comment:141 SimonKing]:
> From the commit message:
> - If category is None, Hom simply calls itself with the meet of the
>   categories of the parent, which removes a cache handling duplication.
> 
> I don't know if that's a good idea. Duplicating the cache costs
> virtually nothing (because all objects, categories and homsets
> involved are there anyway), but it speeds up the most commonly used
> case, namely category=None. Computing the meet of the underlying
> categories is expensive, even though it is cached.

Oh you are right. I meant to avoid a duplication in the source code, not in the caching itself. I agree with you, the current code is wrong. I am going to fix this right now.

Thanks for catching this!



---

archive/issue_comments_151988.json:
```json
{
    "body": "Attachment\n\nThe new uploaded patch is the previous one with\n\n* [attachment:trac_12876-schemes_homcategory.patch]\n* [attachment:trac_12876-fix-homset-cache-nt.patch]\n\nfolded in. The latter should fix the caching of Hom(X,Y).\n\nI am currently running all long tests!",
    "created_at": "2013-05-24T13:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151988",
    "user": "nthiery"
}
```

Attachment

The new uploaded patch is the previous one with

* [attachment:trac_12876-schemes_homcategory.patch]
* [attachment:trac_12876-fix-homset-cache-nt.patch]

folded in. The latter should fix the caching of Hom(X,Y).

I am currently running all long tests!



---

archive/issue_comments_151989.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-24T13:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151989",
    "user": "nthiery"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_151990.json:
```json
{
    "body": "Replying to [comment:142 SimonKing]:\n> Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just\n> {{{\n>     class HomCategory(HomCategory):\n>         pass\n> }}}\n> ?\n> \n> Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?\n\nWell, most categories actually don't define a HomCategory. I did not\nstrip the now trivial HomCategory in Schemes just as to avoid having\nto fix some trivial doctest failures elsewhere (without it, a\nHom(scheme,scheme) was downgraded to the category of homsets of sets).\n\n> This could be for a different ticket, though. I just wonder.\n\nYup. At this point we have very little use cases of HomCategories, and\nI don't have a good view on how often this gadget will be used, and\nthus what the sane default should be. So I would indeed leave things\nuntouched for now until we have more experience.",
    "created_at": "2013-05-24T14:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151990",
    "user": "nthiery"
}
```

Replying to [comment:142 SimonKing]:
> Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just
> {{{
>     class HomCategory(HomCategory):
>         pass
> }}}
> ?
> 
> Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?

Well, most categories actually don't define a HomCategory. I did not
strip the now trivial HomCategory in Schemes just as to avoid having
to fix some trivial doctest failures elsewhere (without it, a
Hom(scheme,scheme) was downgraded to the category of homsets of sets).

> This could be for a different ticket, though. I just wonder.

Yup. At this point we have very little use cases of HomCategories, and
I don't have a good view on how often this gadget will be used, and
thus what the sane default should be. So I would indeed leave things
untouched for now until we have more experience.



---

archive/issue_comments_151991.json:
```json
{
    "body": "You should also tell the patchbot what to do.\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-24T14:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151991",
    "user": "SimonKing"
}
```

You should also tell the patchbot what to do.

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_151992.json:
```json
{
    "body": "Replying to [comment:143 SimonKing]:\n> BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.\n\nWell, actually you wrote this piece; see [comment:59]!\n\nI am fine with this change. And since you had forgotten that you had\nwritten it in the first place, I consider your self-review of this\npiece as sufficient :-)",
    "created_at": "2013-05-24T14:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151992",
    "user": "nthiery"
}
```

Replying to [comment:143 SimonKing]:
> BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.

Well, actually you wrote this piece; see [comment:59]!

I am fine with this change. And since you had forgotten that you had
written it in the first place, I consider your self-review of this
piece as sufficient :-)



---

archive/issue_comments_151993.json:
```json
{
    "body": "Replying to [comment:148 SimonKing]:\n> You should also tell the patchbot what to do.\n> \n> Apply trac_12876_category_abstract_classes_for_hom.patch\n\nAh shoot; I had done this in the description but not here. Thanks. I really don't like that the patch bot is extracting this info from the comments rather than the description. Oh well.",
    "created_at": "2013-05-24T14:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151993",
    "user": "nthiery"
}
```

Replying to [comment:148 SimonKing]:
> You should also tell the patchbot what to do.
> 
> Apply trac_12876_category_abstract_classes_for_hom.patch

Ah shoot; I had done this in the description but not here. Thanks. I really don't like that the patch bot is extracting this info from the comments rather than the description. Oh well.



---

archive/issue_comments_151994.json:
```json
{
    "body": "All test passed:\n\nhttp://sage.math.washington.edu/home/nthiery/trac_12876_category_abstract_classes_for_hom.patch-testlog\n\nWell, almost. I got the following error:\n\n```\nsage -t --long devel/sage/sage/graphs/genus.pyx\n**********************************************************************\nFile \"devel/sage/sage/graphs/genus.pyx\", line 136, in sage.graphs.genus.simple_connected_genus_backtracker.__dealloc__\nFailed example:\n    get_memory_usage(t) <= 0.0\nExpected:\n    True\nGot:\n    False\n```\n\nbut can't reproduce it; so this sounds more like an unrelated random sporadic unfluke.\n\nLet's see what the patchbot says!",
    "created_at": "2013-05-24T14:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151994",
    "user": "nthiery"
}
```

All test passed:

http://sage.math.washington.edu/home/nthiery/trac_12876_category_abstract_classes_for_hom.patch-testlog

Well, almost. I got the following error:

```
sage -t --long devel/sage/sage/graphs/genus.pyx
**********************************************************************
File "devel/sage/sage/graphs/genus.pyx", line 136, in sage.graphs.genus.simple_connected_genus_backtracker.__dealloc__
Failed example:
    get_memory_usage(t) <= 0.0
Expected:
    True
Got:
    False
```

but can't reproduce it; so this sounds more like an unrelated random sporadic unfluke.

Let's see what the patchbot says!



---

archive/issue_comments_151995.json:
```json
{
    "body": "It seems to be happy :-)",
    "created_at": "2013-05-24T14:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151995",
    "user": "nthiery"
}
```

It seems to be happy :-)



---

archive/issue_comments_151996.json:
```json
{
    "body": "OK, I am just waiting for my own tests to finish, and will then provide a reviewer patch, adding a test that shows that providing `Category.meet([X.category(),Y.category()])` is equivalent to providing `None`.",
    "created_at": "2013-05-24T14:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151996",
    "user": "SimonKing"
}
```

OK, I am just waiting for my own tests to finish, and will then provide a reviewer patch, adding a test that shows that providing `Category.meet([X.category(),Y.category()])` is equivalent to providing `None`.



---

archive/issue_comments_151997.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-05-24T14:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151997",
    "user": "SimonKing"
}
```

Attachment



---

archive/issue_comments_151998.json:
```json
{
    "body": "Or better: Add the patch now and let the bot start over.\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876-review.patch",
    "created_at": "2013-05-24T14:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151998",
    "user": "SimonKing"
}
```

Or better: Add the patch now and let the bot start over.

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876-review.patch



---

archive/issue_comments_151999.json:
```json
{
    "body": "for the review patch: \"identic\" -> \"identical\"",
    "created_at": "2013-05-24T15:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-151999",
    "user": "nbruin"
}
```

for the review patch: "identic" -> "identical"



---

archive/issue_comments_152000.json:
```json
{
    "body": "Replying to [comment:155 nbruin]:\n> for the review patch: \"identic\" -> \"identical\"\nYup. I am on it.",
    "created_at": "2013-05-24T15:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152000",
    "user": "nthiery"
}
```

Replying to [comment:155 nbruin]:
> for the review patch: "identic" -> "identical"
Yup. I am on it.



---

archive/issue_comments_152001.json:
```json
{
    "body": "Attachment\n\nCombined patch",
    "created_at": "2013-05-24T15:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152001",
    "user": "nthiery"
}
```

Attachment

Combined patch



---

archive/issue_comments_152002.json:
```json
{
    "body": "I folded in you review patch, and fixed identic to identical (also in a paragraph just after).\n\nApply:\n\n* [attachment:trac_12876_category_abstract_classes_for_hom.patch]",
    "created_at": "2013-05-24T15:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152002",
    "user": "nthiery"
}
```

I folded in you review patch, and fixed identic to identical (also in a paragraph just after).

Apply:

* [attachment:trac_12876_category_abstract_classes_for_hom.patch]



---

archive/issue_comments_152003.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-24T15:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152003",
    "user": "SimonKing"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152004.json:
```json
{
    "body": "OK, for me, the tests pass. So, I make it a positive review.",
    "created_at": "2013-05-24T15:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152004",
    "user": "SimonKing"
}
```

OK, for me, the tests pass. So, I make it a positive review.



---

archive/issue_comments_152005.json:
```json
{
    "body": "PS, I did briefly check the combined patch...\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-24T15:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152005",
    "user": "SimonKing"
}
```

PS, I did briefly check the combined patch...

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_152006.json:
```json
{
    "body": "Youpi!\n\nThanks Simon!",
    "created_at": "2013-05-24T15:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152006",
    "user": "nthiery"
}
```

Youpi!

Thanks Simon!



---

archive/issue_comments_152007.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-06-06T12:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12704",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12704#issuecomment-152007",
    "user": "jdemeyer"
}
```

Resolution: fixed
