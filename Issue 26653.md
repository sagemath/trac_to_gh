# Issue 26653: ElementWrapperCheckWrappedClass does not implement comparison properly

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-12-13 18:21:11




---

Comment by jdemeyer created at 2018-12-13 21:59:37

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-12-13 21:59:37

New commits:


---

Comment by tscrim created at 2018-12-13 23:11:16

You are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.

For a more concrete example, consider `(1,0)` as a *Z*-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.

My recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.


---

Comment by jdemeyer created at 2018-12-14 06:22:31

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-12-14 08:36:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-12-14 08:38:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-12-14 08:40:52

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-12-16 00:48:25

There is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:

```diff
     Note that for untwisted affine type the dual form of the classical Weyl group
     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::
 
         sage: W0v = E.dual_classical_weyl(); W0v
         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)
         sage: v = W0v.from_reduced_word([1,2])
         sage: x = PvW0(v); x
         s1*s2
         sage: y = PW0(v); y
         s1*s2
-        sage: x == y
-        False
         sage: x.parent() == y.parent()
         False
+
+    However, because there is a coercion from ``PvW0`` to ``PW0``,
+    the elements ``x`` and ``y`` compare as equal::
+
+        sage: x == y
+        True
+
```

Once changed, you can set a positive review on my behalf.


---

Comment by git created at 2018-12-17 09:14:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-12-17 09:14:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-12-23 23:39:52

Resolution: fixed


---

Comment by embray created at 2018-12-28 14:06:38

This tickets were closed as fixed after the Sage 8.5 release.
