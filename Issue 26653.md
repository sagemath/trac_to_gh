# Issue 26653: ElementWrapperCheckWrappedClass does not implement comparison properly

archive/issues_026653.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/26890\n\n",
    "created_at": "2018-12-13T18:21:11Z",
    "labels": [
        "categories",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "ElementWrapperCheckWrappedClass does not implement comparison properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26653",
    "user": "jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/26890





---

archive/issue_comments_374696.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374696",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374697.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374697",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_374698.json:
```json
{
    "body": "You are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.\n\nFor a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.\n\nMy recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.",
    "created_at": "2018-12-13T23:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374698",
    "user": "tscrim"
}
```

You are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.

For a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.

My recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.



---

archive/issue_comments_374699.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-14T06:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374699",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374700.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-14T08:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374700",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-14T08:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374701",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374702.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-14T08:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374702",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_374703.json:
```json
{
    "body": "There is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:\n\n```diff\n     Note that for untwisted affine type the dual form of the classical Weyl group\n     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::\n \n         sage: W0v = E.dual_classical_weyl(); W0v\n         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)\n         sage: v = W0v.from_reduced_word([1,2])\n         sage: x = PvW0(v); x\n         s1*s2\n         sage: y = PW0(v); y\n         s1*s2\n-        sage: x == y\n-        False\n         sage: x.parent() == y.parent()\n         False\n+\n+    However, because there is a coercion from ``PvW0`` to ``PW0``,\n+    the elements ``x`` and ``y`` compare as equal::\n+\n+        sage: x == y\n+        True\n+\n```\n\nOnce changed, you can set a positive review on my behalf.",
    "created_at": "2018-12-16T00:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374703",
    "user": "tscrim"
}
```

There is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:

```diff
     Note that for untwisted affine type the dual form of the classical Weyl group
     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::
 
         sage: W0v = E.dual_classical_weyl(); W0v
         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)
         sage: v = W0v.from_reduced_word([1,2])
         sage: x = PvW0(v); x
         s1*s2
         sage: y = PW0(v); y
         s1*s2
-        sage: x == y
-        False
         sage: x.parent() == y.parent()
         False
+
+    However, because there is a coercion from ``PvW0`` to ``PW0``,
+    the elements ``x`` and ``y`` compare as equal::
+
+        sage: x == y
+        True
+
```

Once changed, you can set a positive review on my behalf.



---

archive/issue_comments_374704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-17T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374704",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374705.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-17T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374705",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_374706.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374706",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_374707.json:
```json
{
    "body": "This tickets were closed as fixed after the Sage 8.5 release.",
    "created_at": "2018-12-28T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26653#issuecomment-374707",
    "user": "embray"
}
```

This tickets were closed as fixed after the Sage 8.5 release.
