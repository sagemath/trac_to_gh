# Issue 29262: ./configure --with-system-SPKG=whatever

archive/issues_029262.json:
```json
{
    "body": "CC:  mjo @kliem dimpase vdelecroix\n\nRight now we support `./configure --with-system-SPKG={no,yes,force}`, where `force` means: terminate with an error if no suitable system package exists.\n\nThere should be another possible value, `whatever`, so that experienced/daring users can force to use the system package even if our `spkg-configure` has a concern about the system package. See #29494 (Reject old system pari with bug in hyperellcharpoly).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29499\n\n",
    "created_at": "2020-04-11T17:26:01Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "./configure --with-system-SPKG=whatever",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29262",
    "user": "mkoeppe"
}
```
CC:  mjo @kliem dimpase vdelecroix

Right now we support `./configure --with-system-SPKG={no,yes,force}`, where `force` means: terminate with an error if no suitable system package exists.

There should be another possible value, `whatever`, so that experienced/daring users can force to use the system package even if our `spkg-configure` has a concern about the system package. See #29494 (Reject old system pari with bug in hyperellcharpoly).

Issue created by migration from https://trac.sagemath.org/ticket/29499





---

archive/issue_comments_414760.json:
```json
{
    "body": "As a time-saving mechanism, this doesn't really solve the problem, because it doesn't distinguish between important checks (API and dependent-package compatibility) in spkg-configure.m4 and the ones that I consider unimportant (bug checks to enforce bleeding-edge patched versions).\n\nWhile I'm working on the sage build system every day, I know that the latest pari-2.11.2 in Gentoo is absolutely fine, but if I take a month off and try to pass `--with-system-pari=yeptrustme`, it could compile stuff for three hours before crashing because another package needs a symbol in libpari that wasn't there in 2.11.2. Then I've wasted not just the time needed to build pari, but everything before it.",
    "created_at": "2020-04-11T19:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414760",
    "user": "mjo"
}
```

As a time-saving mechanism, this doesn't really solve the problem, because it doesn't distinguish between important checks (API and dependent-package compatibility) in spkg-configure.m4 and the ones that I consider unimportant (bug checks to enforce bleeding-edge patched versions).

While I'm working on the sage build system every day, I know that the latest pari-2.11.2 in Gentoo is absolutely fine, but if I take a month off and try to pass `--with-system-pari=yeptrustme`, it could compile stuff for three hours before crashing because another package needs a symbol in libpari that wasn't there in 2.11.2. Then I've wasted not just the time needed to build pari, but everything before it.



---

archive/issue_comments_414761.json:
```json
{
    "body": "Of course this is a valid point. I see it more as a development tool - easier to pass that option to check if things work than to edit out some checks in the spkg-configure to achieve the same",
    "created_at": "2020-04-11T20:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414761",
    "user": "mkoeppe"
}
```

Of course this is a valid point. I see it more as a development tool - easier to pass that option to check if things work than to edit out some checks in the spkg-configure to achieve the same



---

archive/issue_comments_414762.json:
```json
{
    "body": "You can't skip the check entirely because e.g. `PKG_CHECK_MODULES` puts things into global variables that we need later on.\n\nAnd after some further thought, it wouldn't do me much good to skip the checks anyway. Ultimately, for using sage to do computations, I would prefer to use the system copy. But that only works until I want to review a ticket; then I have to build a git checkout and run the test suite.\n\nThe spkg-configure work is useful for me because it cuts down that compile time from 20+ hours, to (now) about 5. But that's only helpful if the resulting test suite still passes. If we modify the spkg-configures to only accept specific versions, then the test suite will evolve to support only those specific versions. Skipping the version checks at that point is only going to build something that's useless for running a ptestlong.",
    "created_at": "2020-04-11T21:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414762",
    "user": "mjo"
}
```

You can't skip the check entirely because e.g. `PKG_CHECK_MODULES` puts things into global variables that we need later on.

And after some further thought, it wouldn't do me much good to skip the checks anyway. Ultimately, for using sage to do computations, I would prefer to use the system copy. But that only works until I want to review a ticket; then I have to build a git checkout and run the test suite.

The spkg-configure work is useful for me because it cuts down that compile time from 20+ hours, to (now) about 5. But that's only helpful if the resulting test suite still passes. If we modify the spkg-configures to only accept specific versions, then the test suite will evolve to support only those specific versions. Skipping the version checks at that point is only going to build something that's useless for running a ptestlong.



---

archive/issue_comments_414763.json:
```json
{
    "body": "we can have a special macro that makes some tests conditional, or a special section of \nSAGE_SPKG_CONFIGURE, which contains tests skipped if `whatever` is set.\n\nE.g. the Pari #29494 problem won't affect anyone who does not work with hyperelliptic curves...",
    "created_at": "2020-04-12T04:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414763",
    "user": "dimpase"
}
```

we can have a special macro that makes some tests conditional, or a special section of 
SAGE_SPKG_CONFIGURE, which contains tests skipped if `whatever` is set.

E.g. the Pari #29494 problem won't affect anyone who does not work with hyperelliptic curves...



---

archive/issue_comments_414764.json:
```json
{
    "body": "(In an ideal world) When I install sage I want all doctests to pass by default. This would also be great for automated testing, because then we don't have to keep a huge lists of things that fail here and there.\n\nIn #29493 I suggested a similar flag that skips some tests, when we don't use the package installed by sage. Of course this shouldn't be serious errors, but maybe the representation slightly differs.\n\nIn the case of #29494 it would be nice if I am informed at configuration time that pari is rejected because of a bug in hyperelliptic curves. Then, if I decide I don't care about hyperelliptic curves, I can insist on using pari anyway. In a perfect world it would even tell me at doctesting that there is 1 expected failure (because of my configuration).\n\nMaybe we could have a flag as `# expected failure trac:12345`, such that at configuration time it detects that those doctests aren't expected to work.\n\nThis might be hard to maintain but I believe it gives great flexibility to installation (and at installation time you know pretty good which parts of sage you are breaking). And it only exposes information that we know by automated testing anyway.",
    "created_at": "2020-04-12T13:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414764",
    "user": "@kliem"
}
```

(In an ideal world) When I install sage I want all doctests to pass by default. This would also be great for automated testing, because then we don't have to keep a huge lists of things that fail here and there.

In #29493 I suggested a similar flag that skips some tests, when we don't use the package installed by sage. Of course this shouldn't be serious errors, but maybe the representation slightly differs.

In the case of #29494 it would be nice if I am informed at configuration time that pari is rejected because of a bug in hyperelliptic curves. Then, if I decide I don't care about hyperelliptic curves, I can insist on using pari anyway. In a perfect world it would even tell me at doctesting that there is 1 expected failure (because of my configuration).

Maybe we could have a flag as `# expected failure trac:12345`, such that at configuration time it detects that those doctests aren't expected to work.

This might be hard to maintain but I believe it gives great flexibility to installation (and at installation time you know pretty good which parts of sage you are breaking). And it only exposes information that we know by automated testing anyway.



---

archive/issue_comments_414765.json:
```json
{
    "body": "Anyway, I don't have strong opinions on which road to take. I just think we should find a rather consistent way of how to deal with those things.",
    "created_at": "2020-04-12T19:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414765",
    "user": "@kliem"
}
```

Anyway, I don't have strong opinions on which road to take. I just think we should find a rather consistent way of how to deal with those things.



---

archive/issue_comments_414766.json:
```json
{
    "body": "I think `force` is a better name for the new `whatever` option. (When I do `rm -f file` it does not return an error if `file` does not exist, and that's the point, no?)\n\nWhat is the difference between `yes` and the current `force`?",
    "created_at": "2020-05-30T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414766",
    "user": "slabbe"
}
```

I think `force` is a better name for the new `whatever` option. (When I do `rm -f file` it does not return an error if `file` does not exist, and that's the point, no?)

What is the difference between `yes` and the current `force`?



---

archive/issue_comments_414767.json:
```json
{
    "body": "* yes: it will try the system lib, and fallback to Sage one if it does not pass the tests.\n\n* force: it will try the system lib and  fail with an error if it does not pass the tests.",
    "created_at": "2020-05-30T16:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414767",
    "user": "dimpase"
}
```

* yes: it will try the system lib, and fallback to Sage one if it does not pass the tests.

* force: it will try the system lib and  fail with an error if it does not pass the tests.



---

archive/issue_comments_414768.json:
```json
{
    "body": "I agree that this new `whatever` option really sounds like `force`.\n\nHow about a message that requires user confirmation? Similar to the message when you want to install `polymake` (or any experimental message). But this might be awful for automated testing.\n\nMaybe we instead find a reasonable new name for the `force` option. How about `require`.\n\nI think it might even be reasonable to move the current `force` option to `yes`. If I tell configure to use my system package, but it can't, IMO it should terminate and not just go ahead and not use the system package.",
    "created_at": "2020-05-30T18:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414768",
    "user": "@kliem"
}
```

I agree that this new `whatever` option really sounds like `force`.

How about a message that requires user confirmation? Similar to the message when you want to install `polymake` (or any experimental message). But this might be awful for automated testing.

Maybe we instead find a reasonable new name for the `force` option. How about `require`.

I think it might even be reasonable to move the current `force` option to `yes`. If I tell configure to use my system package, but it can't, IMO it should terminate and not just go ahead and not use the system package.



---

archive/issue_comments_414769.json:
```json
{
    "body": "Changing no/yes/force/whatever to no/yes/require/force is fine with me, \nbut I think I might prefer no/check/yes/force (new default: check)",
    "created_at": "2020-06-07T03:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414769",
    "user": "mkoeppe"
}
```

Changing no/yes/force/whatever to no/yes/require/force is fine with me, 
but I think I might prefer no/check/yes/force (new default: check)



---

archive/issue_comments_414770.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> but I think I might prefer no/check/yes/force (new default: check)\n> \n\nSounds good to me.",
    "created_at": "2020-06-08T06:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414770",
    "user": "@kliem"
}
```

Replying to [comment:12 mkoeppe]:
> but I think I might prefer no/check/yes/force (new default: check)
> 

Sounds good to me.



---

archive/issue_comments_414771.json:
```json
{
    "body": "I agree too.",
    "created_at": "2020-06-13T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414771",
    "user": "slabbe"
}
```

I agree too.



---

archive/issue_comments_414772.json:
```json
{
    "body": "Updated the ticket description accordingly.",
    "created_at": "2020-06-13T10:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414772",
    "user": "mkoeppe"
}
```

Updated the ticket description accordingly.



---

archive/issue_comments_414773.json:
```json
{
    "body": "hmm, what is this branch doing here?!\n----\nLast 10 new commits:",
    "created_at": "2020-07-31T18:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414773",
    "user": "dimpase"
}
```

hmm, what is this branch doing here?!
----
Last 10 new commits:



---

archive/issue_comments_414774.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> hmm, what is this branch doing here?!\n\nYikes! I'm so sorry, I meant to push to 29949. How do you want to handle this? I can try and fix it.\n\n- edit: did this ticket have a branch?",
    "created_at": "2020-07-31T18:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414774",
    "user": "@EnderWannabe"
}
```

Replying to [comment:18 dimpase]:
> hmm, what is this branch doing here?!

Yikes! I'm so sorry, I meant to push to 29949. How do you want to handle this? I can try and fix it.

- edit: did this ticket have a branch?



---

archive/issue_comments_414775.json:
```json
{
    "body": "there was no branch. Just manually enter `u/gh-EnderWannabe/berkovich_dynamical` into the Branch: field of #29949",
    "created_at": "2020-07-31T20:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414775",
    "user": "dimpase"
}
```

there was no branch. Just manually enter `u/gh-EnderWannabe/berkovich_dynamical` into the Branch: field of #29949



---

archive/issue_comments_414776.json:
```json
{
    "body": "Actually #29949 already has it set, so no need to do anything (I've cleared the Branch: field here).",
    "created_at": "2020-07-31T20:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414776",
    "user": "dimpase"
}
```

Actually #29949 already has it set, so no need to do anything (I've cleared the Branch: field here).



---

archive/issue_comments_414777.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29262#issuecomment-414777",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
