# Issue 25863: Always try to load maxima.fas from the standard ecl module dir

Issue created by migration from Trac.

Original creator: arojas

Original creation time: 2018-08-20 16:24:48

CC:  saraedum @timokau fbissey jdemeyer




---

Comment by arojas created at 2018-08-20 16:33:27

New commits:


---

Comment by arojas created at 2018-08-20 16:33:27

Changing component from PLEASE CHANGE to distribution.


---

Comment by arojas created at 2018-08-20 16:33:27

Changing type from PLEASE CHANGE to enhancement.


---

Comment by arojas created at 2018-08-20 16:42:25

Changing status from new to needs_review.


---

Comment by @timokau created at 2018-08-20 17:04:07

This solution is essentially what I meant in #25309. I just don't like that it silently fails if I explicitly provides `MAXIMA_FAS`. I'd prefer it if ECLDIR would just default to `None` in `env.py` and the default is only used when it is `None` (not explicitly overwritten).


---

Comment by arojas created at 2018-08-20 17:14:50

Setting ECLDIR and MAXIMA_FAS to None by default in env.py and replacing the 'try:' with an 'if "MAXIMA_FAS" in os.environ:' would also work for me. Let's see if someone else has an opinion on this.


---

Comment by @timokau created at 2018-08-20 17:19:03

MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?


---

Comment by git created at 2018-08-24 12:21:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2018-08-24 12:23:58

Replying to [comment:7 gh-timokau]:
> MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?

That's the default behavior, yes. Since ECLDIR is used nowhere else, there should be no need to set it, right? You can simply define MAXIMA_FAS directly.


---

Comment by @timokau created at 2018-08-24 14:06:10

Yes in that case we could just get rid of ECLDIR.


---

Comment by @timokau created at 2018-08-24 14:06:40

... which I see you already did.


---

Comment by @timokau created at 2018-08-24 14:10:13

Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.


---

Comment by nbruin created at 2018-08-24 15:35:19

Replying to [comment:13 gh-timokau]:
> Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.

In fact, `... is not None` is the appropriate test if `None` is used as a sentinel value. The empty string `""` would also be "False", and I imagine you might want to treat it differently from the value not being present. There are some wilder scenarios where it matters, e.g. if someone makes a string type that always tests `False`, but that is pretty exotic.


---

Comment by @timokau created at 2018-08-24 15:54:44

For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.


---

Comment by arojas created at 2018-08-24 17:01:35

Replying to [comment:15 gh-timokau]:
> For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.

From ecl's configure script:

AC_ARG_VAR([ecldir], [the directory where *.fas files are installed])
test -z "${ecldir}" && ecldir="${libdir}/ecl-${PACKAGE_VERSION}"

Sage works fine without a system ecl and without setting ECLDIR (even after removing it from sage-env). From #7186 setting it was added to fix issues after moving the sage tree - I wonder if that still makes sense now that moving the tree is no longer supported


---

Comment by git created at 2018-08-24 17:04:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @timokau created at 2018-08-24 17:59:01

Changing status from needs_review to positive_review.


---

Comment by @timokau created at 2018-08-24 17:59:01

Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?


---

Comment by arojas created at 2018-08-24 18:05:38

Replying to [comment:18 gh-timokau]:
> Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?

sdh_configure does that

https://github.com/sagemath/sage/blob/master/src/bin/sage-dist-helpers#L150


---

Comment by @timokau created at 2018-08-24 18:20:07

Hm weird, we set the correct `--prefix` for ecl and the lib dir is under `<prefix>/lib` as usual, so I wonder why ecl doesn't figure it out by itself in our case. Something to investigate in the future. Thanks :)


---

Comment by vbraun created at 2018-08-25 23:55:11

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-08-25 23:55:11

Author name is missing...


---

Comment by arojas created at 2018-08-26 07:01:09

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-08-29 22:31:29

Resolution: fixed
