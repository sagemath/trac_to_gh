# Issue 13428: Fix latex display of arguments of symbolic functions

archive/issues_013428.json:
```json
{
    "body": "Assignee: burcin\n\nIn sage 5.3, if the arguments of a symbolic function have no _latex_ attribute, an exception is raised if one tries to latex it:\n\n```\nsage: P=function('P',x)\nsage: latex(P(x=int(0)))\nTraceback (click to the left of this block for traceback)\n...\nAttributeError: 'int' object has no attribute '_latex_'\n```\n\n\nThis is fixed in the attached patch.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13632\n\n",
    "created_at": "2012-10-20T14:34:05Z",
    "labels": [
        "symbolics",
        "minor",
        "bug"
    ],
    "title": "Fix latex display of arguments of symbolic functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13428",
    "user": "gouezel"
}
```
Assignee: burcin

In sage 5.3, if the arguments of a symbolic function have no _latex_ attribute, an exception is raised if one tries to latex it:

```
sage: P=function('P',x)
sage: latex(P(x=int(0)))
Traceback (click to the left of this block for traceback)
...
AttributeError: 'int' object has no attribute '_latex_'
```


This is fixed in the attached patch.



Issue created by migration from https://trac.sagemath.org/ticket/13632





---

archive/issue_comments_165550.json:
```json
{
    "body": "Attachment [trac_13632_symbolic_function_arguments.patch](tarball://root/attachments/some-uuid/ticket13632/trac_13632_symbolic_function_arguments.patch) by gouezel created at 2012-10-20 14:38:34",
    "created_at": "2012-10-20T14:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165550",
    "user": "gouezel"
}
```

Attachment [trac_13632_symbolic_function_arguments.patch](tarball://root/attachments/some-uuid/ticket13632/trac_13632_symbolic_function_arguments.patch) by gouezel created at 2012-10-20 14:38:34



---

archive/issue_comments_165551.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-20T15:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165551",
    "user": "gouezel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165552.json:
```json
{
    "body": "Wow, that's a pretty simple fix, but it looks right.  I am a little concerned about the following:\n\n```\nsage: type(latex(x))\n<class 'sage.misc.latex.LatexExpr'>\nsage: type(x._latex_())\n<type 'str'>\n```\n\nWill that cause any problem/slow things down, or is this actually an improvement?\n\n```\nsage: L = [4,x,3.4]\nsage: timeit(\"' '.join([z._latex_() for z in L])\")\n625 loops, best of 3: 10.1 \u00b5s per loop\nsage: timeit(\"' '.join([latex(z) for z in L])\")\n625 loops, best of 3: 17 \u00b5s per loop\n```\n\nNaturally fixing the bug is good, just wondering if there is any slick way to avoid turning things into LatexExpr and back to strings - or maybe a try/except thing catching the attribute error?\n\nOtherwise this looks like a good idea and nice fix.",
    "created_at": "2012-10-21T01:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165552",
    "user": "kcrisman"
}
```

Wow, that's a pretty simple fix, but it looks right.  I am a little concerned about the following:

```
sage: type(latex(x))
<class 'sage.misc.latex.LatexExpr'>
sage: type(x._latex_())
<type 'str'>
```

Will that cause any problem/slow things down, or is this actually an improvement?

```
sage: L = [4,x,3.4]
sage: timeit("' '.join([z._latex_() for z in L])")
625 loops, best of 3: 10.1 µs per loop
sage: timeit("' '.join([latex(z) for z in L])")
625 loops, best of 3: 17 µs per loop
```

Naturally fixing the bug is good, just wondering if there is any slick way to avoid turning things into LatexExpr and back to strings - or maybe a try/except thing catching the attribute error?

Otherwise this looks like a good idea and nice fix.



---

archive/issue_comments_165553.json:
```json
{
    "body": "It is certainly possible to avoid the conversion from string to LatexExpr and then back to string. However, simply trying x._latex_() and catching an exception will not suffice, since _latex_() is broken in some cases where it exists (see has_latex_attr in latex.py). So, one would need to duplicate part of the code of latex() (more precisely, the first few lines of Latex.__call__).\n\nSince latex output should never be speed-critical (it is supposed to be read by humans, right?), I would rather stay with the current version of the patch to avoid code duplication and keep it as simple as possible.",
    "created_at": "2012-10-21T12:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165553",
    "user": "gouezel"
}
```

It is certainly possible to avoid the conversion from string to LatexExpr and then back to string. However, simply trying x._latex_() and catching an exception will not suffice, since _latex_() is broken in some cases where it exists (see has_latex_attr in latex.py). So, one would need to duplicate part of the code of latex() (more precisely, the first few lines of Latex.__call__).

Since latex output should never be speed-critical (it is supposed to be read by humans, right?), I would rather stay with the current version of the patch to avoid code duplication and keep it as simple as possible.



---

archive/issue_comments_165554.json:
```json
{
    "body": "I agree that the overhead of typesetting an equation is not really important for the usual user. If you're doing this a lot when typesetting a book it might be an issue, but I'm willing to risk it. I'm switching to positive review.\n\nThanks a lot for the quick patch!",
    "created_at": "2012-10-22T00:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165554",
    "user": "burcin"
}
```

I agree that the overhead of typesetting an equation is not really important for the usual user. If you're doing this a lot when typesetting a book it might be an issue, but I'm willing to risk it. I'm switching to positive review.

Thanks a lot for the quick patch!



---

archive/issue_comments_165555.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-22T00:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165555",
    "user": "burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165556.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-10-30T16:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13428#issuecomment-165556",
    "user": "jdemeyer"
}
```

Resolution: fixed
