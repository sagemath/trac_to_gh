# Issue 14006: clean up Matrix_mpolynomial_dense

archive/issues_014006.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  bouillaguet simonking\n\n`Matrix_mpolynomial_dense` while short is a mess. It's docstrings are not doctested due to formatting errors and it used hardcoded calls to libSingular where the more modern libSingular function factory should be used.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14210\n\n",
    "created_at": "2013-03-01T14:24:07Z",
    "labels": [
        "linear algebra",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "clean up Matrix_mpolynomial_dense",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14006",
    "user": "malb"
}
```
Assignee: jason, was

CC:  bouillaguet simonking

`Matrix_mpolynomial_dense` while short is a mess. It's docstrings are not doctested due to formatting errors and it used hardcoded calls to libSingular where the more modern libSingular function factory should be used.

Issue created by migration from https://trac.sagemath.org/ticket/14210





---

archive/issue_comments_174875.json:
```json
{
    "body": "Attachment [trac_14210_matrix_mpolynomial_dense.patch](tarball://root/attachments/some-uuid/ticket14210/trac_14210_matrix_mpolynomial_dense.patch) by malb created at 2013-03-01 14:24:42",
    "created_at": "2013-03-01T14:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174875",
    "user": "malb"
}
```

Attachment [trac_14210_matrix_mpolynomial_dense.patch](tarball://root/attachments/some-uuid/ticket14210/trac_14210_matrix_mpolynomial_dense.patch) by malb created at 2013-03-01 14:24:42



---

archive/issue_comments_174876.json:
```json
{
    "body": "The attached patch\n\n* removes hardcoded calls from `matrix_mpolynomial_dense.pyx` and replaces them by calls through the libSingular function interface.\n* speeds up calls to det() for small matrices (n<= 3)\n* fixes formatting errors which meant that the file was not doctested\n* makes conversions from\u00a0SingularElement\u00a0to\u00a0BooleanPolynomials\u00a0faster (used to test code in\u00a0`matrix_mpolynomial_dense.pyx`)",
    "created_at": "2013-03-01T14:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174876",
    "user": "malb"
}
```

The attached patch

* removes hardcoded calls from `matrix_mpolynomial_dense.pyx` and replaces them by calls through the libSingular function interface.
* speeds up calls to det() for small matrices (n<= 3)
* fixes formatting errors which meant that the file was not doctested
* makes conversions from SingularElement to BooleanPolynomials faster (used to test code in `matrix_mpolynomial_dense.pyx`)



---

archive/issue_comments_174877.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-01T14:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174877",
    "user": "malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174878.json:
```json
{
    "body": "Looks good. You touch `det` but don't fix the following bug:\n\n``` \nsage: R.<x,y> = QQ[]\nsage: m = matrix([[y,y,y,y]] * 4)\nsage: m.charpoly()\nx^4 - 4*y*x^3\nsage: m.det()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-13-398222b460ca> in <module>()\n----> 1 m.det()\n\n/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.det (sage/matrix/matrix2.c:9875)()\n\n/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so in sage.matrix.matrix_mpolynomial_dense.Matrix_mpolynomial_dense.determinant (sage/matrix/matrix_mpolynomial_dense.cpp:5736)()\n\n/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)()\n\n/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1696)()\n\nAttributeError: 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense' object has no attribute 'keys'\n```\n",
    "created_at": "2013-07-03T18:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174878",
    "user": "vbraun"
}
```

Looks good. You touch `det` but don't fix the following bug:

``` 
sage: R.<x,y> = QQ[]
sage: m = matrix([[y,y,y,y]] * 4)
sage: m.charpoly()
x^4 - 4*y*x^3
sage: m.det()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-13-398222b460ca> in <module>()
----> 1 m.det()

/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.det (sage/matrix/matrix2.c:9875)()

/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/matrix/matrix_mpolynomial_dense.so in sage.matrix.matrix_mpolynomial_dense.Matrix_mpolynomial_dense.determinant (sage/matrix/matrix_mpolynomial_dense.cpp:5736)()

/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)()

/home/vbraun/opt/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1696)()

AttributeError: 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense' object has no attribute 'keys'
```




---

archive/issue_comments_174879.json:
```json
{
    "body": "Updated patch",
    "created_at": "2013-07-03T19:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174879",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_174880.json:
```json
{
    "body": "Attachment [trac_14210_reviewer.patch](tarball://root/attachments/some-uuid/ticket14210/trac_14210_reviewer.patch) by vbraun created at 2013-07-03 19:27:50\n\nI've added a reviewer patch that cleans up the docstrings some more, achieves 100% coverage, and actually adds it to the reference manual. And fixes the det() bug.\n\nPositive review to the original patch...",
    "created_at": "2013-07-03T19:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174880",
    "user": "vbraun"
}
```

Attachment [trac_14210_reviewer.patch](tarball://root/attachments/some-uuid/ticket14210/trac_14210_reviewer.patch) by vbraun created at 2013-07-03 19:27:50

I've added a reviewer patch that cleans up the docstrings some more, achieves 100% coverage, and actually adds it to the reference manual. And fixes the det() bug.

Positive review to the original patch...



---

archive/issue_comments_174881.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2013-07-03T19:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174881",
    "user": "vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_174882.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-04T09:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174882",
    "user": "malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174883.json:
```json
{
    "body": "Reviewer patch looks okay to me.",
    "created_at": "2013-07-04T09:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174883",
    "user": "malb"
}
```

Reviewer patch looks okay to me.



---

archive/issue_comments_174884.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-16T21:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14006",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14006#issuecomment-174884",
    "user": "jdemeyer"
}
```

Resolution: fixed
