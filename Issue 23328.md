# Issue 23328: update arb to version 2.11.1

Issue created by migration from https://trac.sagemath.org/ticket/23565

Original creator: dimpase

Original creation time: 2017-08-01 15:46:38

CC:  fbissey fredrik.johansson rws

we are few versions behind already. ALso, it fixes the building problem on FreeBSD.

The tarball is here: https://github.com/fredrik-johansson/arb/archive/2.11.1.tar.gz


---

Comment by git created at 2017-08-01 19:46:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-08-01 19:48:30

Changing status from new to needs_info.


---

Comment by dimpase created at 2017-08-01 19:48:30

is arb used anywhere in files that don't have `arb` in their names?


---

Comment by fbissey created at 2017-08-01 21:23:43

Indirectly, almost certainly. I'll do some runs to check.


---

Comment by fbissey created at 2017-08-01 21:33:06

sage-on-gentoo after upgrading (I had an ebuild ready for some time)

```
!!! existing preserved libs:
>>> package: sci-mathematics/arb-2.11.1-r1
 *  - /usr/lib64/libarb.so.1
 *  - /usr/lib64/libarb.so.1.1.1
 *      used by /usr/lib64/python2.7/site-packages/sage/libs/arb/arith.so (sci-mathematics/sage-9999)
 *      used by /usr/lib64/python2.7/site-packages/sage/matrix/matrix_complex_ball_dense.so (sci-mathematics/sage-9999)
 *      used by /usr/lib64/python2.7/site-packages/sage/rings/complex_arb.so (sci-mathematics/sage-9999)
 *      used by 7 other files
```

So those are a bit different from your list already. I am guessing you checked stuff in `libs/arb/` and I am not quite sure what the other 7 files are apart from probably from the one you already patch not on that list. A full doctest run is needed to make sure. Is there any optional packages depending on arb?


---

Comment by jhpalmieri created at 2017-08-01 22:59:45

On OS X, arb passes its self-tests and I got a few doctest failures:

```
sage -t --long --warn-long 66.3 src/sage/functions/other.py
**********************************************************************
File "src/sage/functions/other.py", line 1502, in sage.functions.other.Function_factorial.__init__
Failed example:
    factorial(RBF(4.2))
Expected:
    [32.5780960503313 +/- 6.71e-14]
Got:
    [32.5780960503313 +/- 6.72e-14]
**********************************************************************
```


```
sage -t --long --warn-long 66.3 src/sage/functions/log.py
**********************************************************************
File "src/sage/functions/log.py", line 444, in sage.functions.log.Function_polylog.__init__
Failed example:
    polylog(2, 1.0)
Expected:
    NaN
Got:
    1.64493406684823
**********************************************************************
File "src/sage/functions/log.py", line 446, in sage.functions.log.Function_polylog.__init__
Failed example:
    polylog(2.0, 1.0)
Expected:
    NaN
Got:
    1.64493406684823
```



```
sage -t --long --warn-long 66.3 src/sage/libs/pynac/pynac.pyx
**********************************************************************
File "src/sage/libs/pynac/pynac.pyx", line 1817, in sage.libs.pynac.pynac.py_atan2
Failed example:
    atan2(CBF(I), CBF(I+1))
Expected:
    [0.55357435889705 +/- 5.75e-15] + [0.40235947810852 +/- 6.01e-15]*I
Got:
    [0.55357435889705 +/- 5.58e-15] + [0.402359478108525 +/- 7.11e-16]*I
```

I don't know anything about polylogs, but the others look like numerical noise.


---

Comment by jhpalmieri created at 2017-08-01 23:01:26

See also #18386 for the polylog doctests.


---

Comment by fbissey created at 2017-08-01 23:04:23

I was just preparing exactly the same report from my linux box.


---

Comment by jhpalmieri created at 2017-08-01 23:06:16

Or maybe #21034? The file says "Check if :trac:`18386` is fixed::" followed by these doctests, but I don't know enough to say whether the new behavior fixes the doctests or not. #18386 has not yet been merged.


---

Comment by fbissey created at 2017-08-01 23:27:30

Replying to [comment:8 jhpalmieri]:
> Or maybe #21034? The file says "Check if :trac:`18386` is fixed::" followed by these doctests, but I don't know enough to say whether the new behavior fixes the doctests or not. #18386 has not yet been merged.

Yes. Not merged, but the doctests we are worrying about haven't been touched. You can just see them at the top of the commit. The ticket is relevant though. Maxima agrees with the new value (`pi^2 / 6`). And actually other test in the same file give that answer:

```
class Function_polylog(GinacFunction):
    def __init__(self):
        r"""
        The polylog function
        `\text{Li}_s(z) = \sum_{k=1}^{\infty} z^k / k^s`.

        This definition is valid for arbitrary complex order `s` and for
        all complex arguments `z` with `|z| < 1`; it can be extended to
        `|z| \ge 1` by the process of analytic continuation. So the
        function may have a discontinuity at `z=1` which can cause a
        `NaN` value returned for floating point arguments.

        EXAMPLES::

            sage: polylog(2.7, 0)
            0
            sage: polylog(2, 1)
            1/6*pi^2
```

And where we are now is:

```
        Check if :trac:`18386` is fixed::

            sage: polylog(2.0, 1)
            1.64493406684823
            sage: polylog(2, 1.0)
            NaN
            sage: polylog(2.0, 1.0)
            NaN
```


I am tempted to say this upgrade is now fixing it. Although why upgrading arb fix a pynac behavior is a bit of mystery to me since pynac doesn't link to arb.


---

Comment by fbissey created at 2017-08-01 23:34:03

There is one more thing about this ticket and all package upgrade tickets (actually I am holding off a number of upgrades I want to go through this cycle) #23179 has now been merged and closed. It will be in the next beta but this ticket and any package upgrade ticket really should be done of top of it to save yourselves from some trouble later on.


---

Comment by git created at 2017-08-02 05:57:06

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dimpase created at 2017-08-02 05:58:43

Changing status from needs_info to needs_work.


---

Comment by git created at 2017-08-02 07:47:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-02 13:58:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-08-02 14:01:35

OK, all done, also added tests from #18386, and added Ralf to the authors here.


---

Comment by dimpase created at 2017-08-02 14:01:35

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2017-08-02 22:43:35

Is this making #18386 a duplicate? Otherwise I think we have everything for a positive review.


---

Comment by dimpase created at 2017-08-03 05:29:53

Replying to [comment:16 fbissey]:
> Is this making #18386 a duplicate? Otherwise I think we have everything for a positive review.

Yes it does. Note that
I have merged the branch of #18386 here (see â€‹f854f36) and adjusted wrong (for arb 2.11.1) test outputs in 51aeae3.

As arb update alleviates some of the issues on #18386 I thought it's more logical this way.


---

Comment by rws created at 2017-08-03 05:39:18

The usual process is to make #18386 a dependency (not vice versa). Then it can be merged independently EDIT: by the maintainer.


---

Comment by dimpase created at 2017-08-03 07:07:39

Replying to [comment:18 rws]:
> The usual process is to make #18386 a dependency (not vice versa). Then it can be merged independently EDIT: by the maintainer.


Except that in this case it would be more work for everyone (including my poor laptop that would have had to run more rounds of `make ptestlong` :-)) involved.


---

Comment by fbissey created at 2017-08-07 23:52:54

I am personally not fussy about making one of the ticket duplicate or meta-ticket. But **someone** marked the other ticket with positive review without making it a duplicate or anything like that. It implies then that this ticket should depend on it.

I think enough people did testing around here to put a reworked branch to positive review without putting your laptop through the stress again :)


---

Comment by fbissey created at 2017-08-23 02:08:10

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-08-23 02:08:10

OK, all rebased and merged on top of #18386. It should all go in now.
----
New commits:


---

Comment by dimpase created at 2017-10-03 11:17:40

rebased over #23776. 
----
New commits:


---

Comment by tscrim created at 2017-10-03 15:08:58

Just FYI - #18386 is marked as a duplicate/invalid/wontfix.


---

Comment by dimpase created at 2017-10-03 15:43:26

Replying to [comment:24 tscrim]:
> Just FYI - #18386 is marked as a duplicate/invalid/wontfix.

Oops. We did have some slight disagreement on how to properly proceed, I don't recall details any more. It seems Ralf wanted it merged, but forgot to unmark it as duplicate. As everything merges fine, let's merge #18386.


---

Comment by vbraun created at 2017-10-03 23:34:15

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-10-03 23:34:15


```
sage -t --long --warn-long 69.8 src/sage/libs/pynac/pynac.pyx
**********************************************************************
File "src/sage/libs/pynac/pynac.pyx", line 1817, in sage.libs.pynac.pynac.py_atan2
Failed example:
    atan2(CBF(I), CBF(I+1))
Expected:
    [0.55357435889705 +/- 5.75e-15] + [0.40235947810852 +/- 6.01e-15]*I
Got:
    [0.55357435889705 +/- 5.58e-15] + [0.402359478108525 +/- 7.11e-16]*I
**********************************************************************
1 item had failures:
   1 of  14 in sage.libs.pynac.pynac.py_atan2
    [334 tests, 1 failure, 2.85 s]
```



---

Comment by git created at 2017-10-04 08:06:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-10-04 08:45:55

oops, sorry, fixed.


---

Comment by dimpase created at 2017-10-04 08:45:55

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-10-05 06:54:04

Resolution: fixed
