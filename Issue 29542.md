# Issue 29542: pkg-config installed from SPKG pkgconf should not depend on environment variable SAGE_LOCAL

archive/issues_029542.json:
```json
{
    "body": "CC:  @orlitzky @dimpase @vbraun\n\n(from #29411)\n\nIssue created by migration from https://trac.sagemath.org/ticket/29779\n\n",
    "created_at": "2020-06-02T03:05:34Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "pkg-config installed from SPKG pkgconf should not depend on environment variable SAGE_LOCAL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29542",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @orlitzky @dimpase @vbraun

(from #29411)

Issue created by migration from https://trac.sagemath.org/ticket/29779





---

archive/issue_comments_419113.json:
```json
{
    "body": "It looks like we can specify the `*.pc` file location at build time using `--with-pkg-config-dir`:\n\nhttps://github.com/pkgconf/pkgconf/blob/master/configure.ac\n\nAfterwards, we can probably just symlink pkgconf to \"pkg-config\", and then rely on PATH to choose the right one.",
    "created_at": "2020-07-14T01:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419113",
    "user": "https://github.com/orlitzky"
}
```

It looks like we can specify the `*.pc` file location at build time using `--with-pkg-config-dir`:

https://github.com/pkgconf/pkgconf/blob/master/configure.ac

Afterwards, we can probably just symlink pkgconf to "pkg-config", and then rely on PATH to choose the right one.



---

archive/issue_comments_419114.json:
```json
{
    "body": "src/bin/sage-env already prepends the sage-specific `*.pc` file path to `PKG_CONFIG_PATH` in case the system pkg-config is used. From pkgconf's spkg-configure.m4:\n\n\n```\nAS_IF([test -z \"$ac_cv_path_PKGCONF\"], [\n   sage_spkg_install_pkgconf=yes\n   AC_SUBST(SAGE_PKG_CONFIG_PATH, [''])\n   AC_MSG_RESULT([installing pkgconf spkg])], [\ndnl the following as needed as long as Sage creates .pc files during build and/or configure\n   AC_SUBST(SAGE_PKG_CONFIG_PATH, ['$SAGE_LOCAL/lib/pkgconfig'])\n   AC_MSG_RESULT([using pkg-config from the system])\n])\n```\n\n\nThen in sage-env,\n\n\n```\nif [ -n \"$SAGE_PKG_CONFIG_PATH\" ]; then\n    # set up external pkg-config to look into SAGE_LOCAL/lib/pkgconfig/\n    # (Sage's pkgconf spkg takes care of this, if installed)\n    export PKG_CONFIG_PATH=\"$SAGE_PKG_CONFIG_PATH${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH}\"\nfi\n```\n\n\nSo we \"shouldn't\" be hurt by ditching the pkgconf wrapper script and hard-coding the full list of paths into pkgconf at build time.",
    "created_at": "2020-07-14T01:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419114",
    "user": "https://github.com/orlitzky"
}
```

src/bin/sage-env already prepends the sage-specific `*.pc` file path to `PKG_CONFIG_PATH` in case the system pkg-config is used. From pkgconf's spkg-configure.m4:


```
AS_IF([test -z "$ac_cv_path_PKGCONF"], [
   sage_spkg_install_pkgconf=yes
   AC_SUBST(SAGE_PKG_CONFIG_PATH, [''])
   AC_MSG_RESULT([installing pkgconf spkg])], [
dnl the following as needed as long as Sage creates .pc files during build and/or configure
   AC_SUBST(SAGE_PKG_CONFIG_PATH, ['$SAGE_LOCAL/lib/pkgconfig'])
   AC_MSG_RESULT([using pkg-config from the system])
])
```


Then in sage-env,


```
if [ -n "$SAGE_PKG_CONFIG_PATH" ]; then
    # set up external pkg-config to look into SAGE_LOCAL/lib/pkgconfig/
    # (Sage's pkgconf spkg takes care of this, if installed)
    export PKG_CONFIG_PATH="$SAGE_PKG_CONFIG_PATH${PKG_CONFIG_PATH:+:$PKG_CONFIG_PATH}"
fi
```


So we "shouldn't" be hurt by ditching the pkgconf wrapper script and hard-coding the full list of paths into pkgconf at build time.



---

archive/issue_comments_419115.json:
```json
{
    "body": "Sounds right to me",
    "created_at": "2020-07-14T01:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419115",
    "user": "https://github.com/mkoeppe"
}
```

Sounds right to me



---

archive/issue_comments_419116.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419116",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_419117.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419117",
    "user": "https://github.com/mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_419118.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419118",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_419119.json:
```json
{
    "body": "Any progress here?",
    "created_at": "2021-05-27T18:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419119",
    "user": "https://github.com/mkoeppe"
}
```

Any progress here?



---

archive/issue_comments_419120.json:
```json
{
    "body": "`@`mjo, it sounds like you have some free time. Care to work on this ticket?",
    "created_at": "2022-04-27T02:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419120",
    "user": "https://github.com/mkoeppe"
}
```

`@`mjo, it sounds like you have some free time. Care to work on this ticket?



---

archive/issue_comments_419121.json:
```json
{
    "body": "I never wanted to work on it in the first place. pkg-config is a standard, stable, system utility that's available everywhere. We should delete the SPKG and require that the user have it installed. Treadmill tickets like these are a complete waste of time, but not mine.",
    "created_at": "2022-04-27T11:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419121",
    "user": "https://github.com/orlitzky"
}
```

I never wanted to work on it in the first place. pkg-config is a standard, stable, system utility that's available everywhere. We should delete the SPKG and require that the user have it installed. Treadmill tickets like these are a complete waste of time, but not mine.



---

archive/issue_comments_419122.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-09T23:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419122",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_419123.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-09T23:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419123",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_419124.json:
```json
{
    "body": "there are changes of `$SAGE_LOCAL` to unprefixed by `$`. What does it do - if it was to be substituted I'd expect ``@`SAGE_LOCAL`@``?",
    "created_at": "2022-05-11T08:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419124",
    "user": "https://github.com/dimpase"
}
```

there are changes of `$SAGE_LOCAL` to unprefixed by `$`. What does it do - if it was to be substituted I'd expect ``@`SAGE_LOCAL`@``?



---

archive/issue_comments_419125.json:
```json
{
    "body": "These are resolved as m4 macros - see the m4 invocation in spkg-postinst.in",
    "created_at": "2022-05-11T16:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419125",
    "user": "https://github.com/mkoeppe"
}
```

These are resolved as m4 macros - see the m4 invocation in spkg-postinst.in



---

archive/issue_comments_419126.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T16:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419127.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2022-06-26T18:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419127",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_419128.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-28T12:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419128",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419129.json:
```json
{
    "body": "lgtm",
    "created_at": "2022-06-28T12:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419129",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_419130.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-06-28T17:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419130",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_419131.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-03T22:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29542",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29542#issuecomment-419131",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
