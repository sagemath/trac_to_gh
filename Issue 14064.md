# Issue 14064: Remove C99 flags in module_list.py

Issue created by migration from https://trac.sagemath.org/ticket/14268

Original creator: jdemeyer

Original creation time: 2013-03-14 13:44:47

Assignee: GeorgSWeber

CC:  jpflori

With #14265, Python is always compiled in C99 mode, which means that we can remove all `-std=c99` flags from `module_list.py`.

In FLINT, we should replace

```
#define ulong unsigned long
```

by

```
typedef unsigned long ulong
```


The latter is compatible with GLIBC's `<sys/types.h>` in `-std=gnu99` mode.


---

Comment by leif created at 2013-03-14 14:41:49

IIRC we had trouble with `typedef`ed `ulong` on Solaris.

For removing `-std=c99` from `module_list.py`, see [comment:ticket:14265:19 this comment].


---

Attachment

Replying to [comment:3 leif]:
> IIRC we had trouble with `typedef`ed `ulong` on Solaris.
It works correctly on `mark` at least.


---

Comment by leif created at 2013-03-14 15:12:44

Replying to [comment:4 jdemeyer]:
> Replying to [comment:3 leif]:
> > IIRC we had trouble with `typedef`ed `ulong` on Solaris.
> It works correctly on `mark` at least.

But causes trouble if you include both `flint.h` and `sys/types.h`.


---

Attachment

Replying to [comment:5 leif]:
> But causes trouble if you include both `flint.h` and `sys/types.h`.
Still works correctly on `mark`. Do you have a concrete example of a file which fails to compile due to this "issue"?


---

Comment by jdemeyer created at 2013-03-14 15:38:26

Replying to [comment:ticket:14265:19]:
> Do `env CFLAGS="-DFOO" ./sage -ba` and the `-std=gnu99` vanishes
It does indeed. I'd say this is a bug.

> so we must not remove `-std=c99` from the `extra_compile_flags` (or what it's called).
I disagree with this conclusion, since over-riding `CFLAGS` also removes other mandatory flags, like `-fno-strict-aliasing`. So you're basically saying that my patch breaks something which is already broken.


---

Comment by leif created at 2013-03-14 15:58:11

Replying to [comment:7 jdemeyer]:
> Replying to [comment:ticket:14265:19]:
> > Do `env CFLAGS="-DFOO" ./sage -ba` and the `-std=gnu99` vanishes
> It does indeed. I'd say this is a bug.

Well, depends.  Probably a bug in Sage, but it always used to be that way.  (And I suggested adding `-fno-strict-aliasing` in `setup.py` loooooong time ago, but nobody bothered.  Only Cython-generated code requires this.) 

> > so we must not remove `-std=c99` from the `extra_compile_flags` (or what it's called).
> I disagree with this conclusion, since over-riding `CFLAGS` also removes other mandatory flags, like `-fno-strict-aliasing`. So you're basically saying that my patch breaks something which is already broken.

Nope.  It _further_ breaks building extension modules, IMHO without any gain.

(Btw., exporting `CFLAGS=""` is sufficient.)


---

Attachment


---

Comment by leif created at 2013-03-15 09:54:29

Slightly related: #7987 (three years bit-rottening)


---

Comment by jdemeyer created at 2013-03-15 21:48:34

Replying to [comment:8 leif]:
> It _further_ breaks building extension modules
Not really, there's nothing broken which wasn't broken before.

> IMHO without any gain.
IMHO, simplification is a gain.


---

Comment by leif created at 2013-03-27 14:41:28

Just for the record:  #14265 no longer compiles Python as C99, but instead `#define`s `__C99FEATURES__` (on Solaris).


---

Comment by leif created at 2013-03-27 14:41:28

Changing status from new to needs_info.


---

Comment by jdemeyer created at 2013-03-27 15:58:31

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2013-03-27 15:58:39

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2013-03-27 16:55:52

Could you try the FLINT 2.3 spkg from #12173 and confirm that vanilla FLINT 2.3 still gives trouble with respect to zn_poly and C99?
Then we'll know whether we have to include changes similar to the one you included here there or not (and I'll report upstream accordingly)


---

Comment by aapitzsch created at 2016-02-28 07:21:53

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2016-02-28 07:21:53

Is this still an issue with flint 2.5?


---

Comment by jdemeyer created at 2016-02-28 23:48:59

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-02-28 23:48:59

Even if it's no longer an issue, we should remove the work-around from `zn_poly`.


---

Comment by jdemeyer created at 2016-02-29 10:47:02

Changing component from build to packages: standard.


---

Comment by jdemeyer created at 2016-02-29 15:24:48

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-02-29 15:24:48

New commits:


---

Comment by tscrim created at 2016-03-09 11:41:46

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-03-09 11:41:46

LGTM.


---

Comment by vbraun created at 2016-03-09 22:52:49

Resolution: fixed
