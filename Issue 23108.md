# Issue 23108: conversion for fractions

Issue created by migration from https://trac.sagemath.org/ticket/23345

Original creator: vdelecroix

Original creation time: 2017-06-30 14:25:09

CC:  mforets

We fix `py_scalar_parent`,  `py_scalar_to_element` and `Rational` to accept `Fractions` (from the module `fractions`).


---

Comment by vdelecroix created at 2017-06-30 14:26:38

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-06-30 14:26:38

New commits:


---

Comment by jdemeyer created at 2017-06-30 14:51:28

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-06-30 14:51:28

This is way too slow. Those functions are called _a lot_ in the coercion framework, so they should be as fast as possible. In Cython, checking `isinstance(x, Fraction)` is about a factor 30 slower than `isinstance(x, float)`!

I could live with an exact type check like

```
from fractions import Fraction
cdef type FractionType = <type>Fraction

...
   if type(x) is FractionType:
...
```

Of course, this won't work with subclasses. I don't know how important that is.


---

Comment by git created at 2017-06-30 19:38:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-06-30 19:38:50

Changing status from needs_work to needs_review.


---

Comment by mforets created at 2017-07-03 21:31:29

Changing status from needs_review to positive_review.


---

Comment by mforets created at 2017-07-03 21:31:29

code and tests are OK, patchbot is half-green.. it doesn't appear to be an error, just that there is a new module added.. Then let me set to positive -- please change if you, Jeroen, plan to make further remarks.


---

Comment by jdemeyer created at 2017-07-04 08:04:02

In `rational.pyx`, I would prefer to move the check for `Fraction` further down in order not to slow down the conversion `RR -> QQ` for example.


---

Comment by jdemeyer created at 2017-07-04 08:04:02

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2017-07-04 08:17:52

In the doctest, I would prefer to see `int(2^100)` instead of `(2r)**(100r)`


---

Comment by mforets created at 2017-07-08 10:42:48

Changing status from needs_work to needs_review.


---

Comment by mforets created at 2017-07-08 10:42:48

New commits:


---

Comment by jdemeyer created at 2017-07-10 10:09:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-07-26 22:12:55

Resolution: fixed
