# Issue 17027: Polyhedron function broken in sage-6.3 (worked in sage-6.2)

archive/issues_017027.json:
```json
{
    "body": "If you try to make the convex hull of a set of points given by float coordinates using `Polyhedron`, this worked fine in Sage-6.2, but is broken in Sage-6.3.\n\n\n```\nsage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])\nAttributeError: type object 'float' has no attribute 'fraction_field'\nsage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])\nA 0-dimensional polyhedron in (Real Field with 54 bits of precision)^3 defined as the convex hull of 1 vertex\n```\n\n\nI noticed when making this interact:\n\n  https://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2014-10-30-105145-convex-hull-interact.sagews\n\nThis is also still broken in sage-6.4.rc0:\n\n```\n/scratch/wstein/sage-6.4.rc0$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.4.rc0, Release Date: 2014-10-30                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-69a05f87fbc6> in <module>()\n----> 1 Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])\n \n/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/laz\ny_import.c:3230)()\n \n/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)\n    703                     kwds[new_name] = kwds[old_name]\n    704                     del kwds[old_name]\n--> 705             return func(*args, **kwds)\n    706\n    707         return wrapper\n \n/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc in Polyhedron(vertices, rays, lines, ieqs, eqns, ambient_dim\n, base_ring, minimize, verbose, backend)\n    444     # Specific backends can override the base_ring\n    445     from sage.geometry.polyhedron.parent import Polyhedra\n--> 446     parent = Polyhedra(base_ring, ambient_dim, backend=backend)\n    447     base_ring = parent.base_ring()\n    448\n \n/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/geometry/polyhedron/parent.pyc in Polyhedra(base_ring, ambient_dim, backend)\n     84         return Polyhedra_RDF_cdd(RDF, ambient_dim)\n     85     elif backend == 'field':\n---> 86         return Polyhedra_field(base_ring.fraction_field(), ambient_dim)\n     87     else:\n     88         raise ValueError('No such backend (='+str(backend)+\n \nAttributeError: type object 'float' has no attribute 'fraction_field'\nsage:  \n }}}\n\nIssue created by migration from https://trac.sagemath.org/ticket/17264\n\n",
    "created_at": "2014-10-30T17:58:04Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Polyhedron function broken in sage-6.3 (worked in sage-6.2)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17027",
    "user": "https://github.com/williamstein"
}
```
If you try to make the convex hull of a set of points given by float coordinates using `Polyhedron`, this worked fine in Sage-6.2, but is broken in Sage-6.3.


```
sage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])
AttributeError: type object 'float' has no attribute 'fraction_field'
sage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])
A 0-dimensional polyhedron in (Real Field with 54 bits of precision)^3 defined as the convex hull of 1 vertex
```


I noticed when making this interact:

  https://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2014-10-30-105145-convex-hull-interact.sagews

This is also still broken in sage-6.4.rc0:

```
/scratch/wstein/sage-6.4.rc0$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.4.rc0, Release Date: 2014-10-30                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-69a05f87fbc6> in <module>()
----> 1 Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])
 
/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/misc/lazy_import.so in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/laz
y_import.c:3230)()
 
/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)
    703                     kwds[new_name] = kwds[old_name]
    704                     del kwds[old_name]
--> 705             return func(*args, **kwds)
    706
    707         return wrapper
 
/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/geometry/polyhedron/constructor.pyc in Polyhedron(vertices, rays, lines, ieqs, eqns, ambient_dim
, base_ring, minimize, verbose, backend)
    444     # Specific backends can override the base_ring
    445     from sage.geometry.polyhedron.parent import Polyhedra
--> 446     parent = Polyhedra(base_ring, ambient_dim, backend=backend)
    447     base_ring = parent.base_ring()
    448
 
/scratch/wstein/sage-6.4.rc0/local/lib/python2.7/site-packages/sage/geometry/polyhedron/parent.pyc in Polyhedra(base_ring, ambient_dim, backend)
     84         return Polyhedra_RDF_cdd(RDF, ambient_dim)
     85     elif backend == 'field':
---> 86         return Polyhedra_field(base_ring.fraction_field(), ambient_dim)
     87     else:
     88         raise ValueError('No such backend (='+str(backend)+
 
AttributeError: type object 'float' has no attribute 'fraction_field'
sage:  
 }}}

Issue created by migration from https://trac.sagemath.org/ticket/17264





---

archive/issue_comments_226121.json:
```json
{
    "body": "Is this only true for floats, though?",
    "created_at": "2014-11-03T13:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226121",
    "user": "https://github.com/kcrisman"
}
```

Is this only true for floats, though?



---

archive/issue_comments_226122.json:
```json
{
    "body": "Probably. `is_field(float)` does not work as well, by the way.\n\nThe fix is to either allow `float` though as the base field or replace it with RDF. I suspect the second option is less error-prone.",
    "created_at": "2014-11-05T21:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226122",
    "user": "https://github.com/novoselt"
}
```

Probably. `is_field(float)` does not work as well, by the way.

The fix is to either allow `float` though as the base field or replace it with RDF. I suspect the second option is less error-prone.



---

archive/issue_comments_226123.json:
```json
{
    "body": "Still breaks in 7.6.beta6...",
    "created_at": "2017-03-09T03:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226123",
    "user": "https://github.com/novoselt"
}
```

Still breaks in 7.6.beta6...



---

archive/issue_comments_226124.json:
```json
{
    "body": "This should be looked at after #18220 gets merged.",
    "created_at": "2017-03-10T11:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226124",
    "user": "https://github.com/jplab"
}
```

This should be looked at after #18220 gets merged.



---

archive/issue_comments_226125.json:
```json
{
    "body": "In 7.6.rc0 it now gives:\n\n\n```\n\nsage: Polyhedron(vertices = [(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])\nTraceback (most recent call last):\n...\n     89         elif base_ring is RDF:\n     90             backend = 'cdd'\n---> 91         elif base_ring.is_exact():\n     92             backend = 'field'\n     93         else:\n\nAttributeError: type object 'float' has no attribute 'is_exact'\n\n```\n\n\nand\n\n\n```\n\nsage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])\nTraceback (most recent call last):\n...\nValueError: no appropriate backend for computations with Real Field with 54 bits of precision\n\n```\n\n\nThe last one is caused by #18220.\n\nI guess that the first one should also return a `ValueError` saying that no backend deals with polyhedron over floats.\n\nMaybe even a pointer to say that it should be done in `RDF`?",
    "created_at": "2017-03-15T09:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226125",
    "user": "https://github.com/jplab"
}
```

In 7.6.rc0 it now gives:


```

sage: Polyhedron(vertices = [(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])
Traceback (most recent call last):
...
     89         elif base_ring is RDF:
     90             backend = 'cdd'
---> 91         elif base_ring.is_exact():
     92             backend = 'field'
     93         else:

AttributeError: type object 'float' has no attribute 'is_exact'

```


and


```

sage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])
Traceback (most recent call last):
...
ValueError: no appropriate backend for computations with Real Field with 54 bits of precision

```


The last one is caused by #18220.

I guess that the first one should also return a `ValueError` saying that no backend deals with polyhedron over floats.

Maybe even a pointer to say that it should be done in `RDF`?



---

archive/issue_comments_226126.json:
```json
{
    "body": "The ticket #22605 aims to make the error messages for base ring more informative and suggested to redirect floats to the base ring `RDF`.",
    "created_at": "2017-03-17T13:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226126",
    "user": "https://github.com/jplab"
}
```

The ticket #22605 aims to make the error messages for base ring more informative and suggested to redirect floats to the base ring `RDF`.



---

archive/issue_comments_226127.json:
```json
{
    "body": "Fixed (or at least coherent) in 8.1.beta2\n\n```\nsage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])\nA 0-dimensional polyhedron in RDF^3 defined as the convex hull of 1 vertex\nsage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])\nTraceback (most recent call last):\n...\nValueError: no appropriate backend for computations with Real Field with 54 bits of precision\n```\n\n(see #22605)",
    "created_at": "2017-08-19T15:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226127",
    "user": "https://github.com/videlec"
}
```

Fixed (or at least coherent) in 8.1.beta2

```
sage: Polyhedron([(0.8370682893845995r, 0.2027977776670088r, 0.2547890063224252r)])
A 0-dimensional polyhedron in RDF^3 defined as the convex hull of 1 vertex
sage: Polyhedron([(0.8370682893845995, 0.2027977776670088, 0.2547890063224252)])
Traceback (most recent call last):
...
ValueError: no appropriate backend for computations with Real Field with 54 bits of precision
```

(see #22605)



---

archive/issue_comments_226128.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-19T15:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226128",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226129.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-21T19:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226129",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226130.json:
```json
{
    "body": "Indeed, #22605 seems to deal with that issue properly.",
    "created_at": "2017-08-21T19:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226130",
    "user": "https://github.com/jplab"
}
```

Indeed, #22605 seems to deal with that issue properly.



---

archive/issue_comments_226131.json:
```json
{
    "body": "Changing keywords from \"\" to \"days88\".",
    "created_at": "2017-08-21T19:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226131",
    "user": "https://github.com/jplab"
}
```

Changing keywords from "" to "days88".



---

archive/issue_comments_226132.json:
```json
{
    "body": "Needs Author and Reviewer.",
    "created_at": "2017-08-21T21:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226132",
    "user": "https://github.com/kevindilks"
}
```

Needs Author and Reviewer.



---

archive/issue_comments_226133.json:
```json
{
    "body": "Nothing was written so we won't put authors...",
    "created_at": "2017-08-21T22:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226133",
    "user": "https://github.com/jplab"
}
```

Nothing was written so we won't put authors...



---

archive/issue_comments_226134.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17027#issuecomment-226134",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix



---

archive/issue_events_016459.json:
```json
{
    "actor": "@embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17027#event-16459"
}
```
