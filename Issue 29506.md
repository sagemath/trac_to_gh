# Issue 29506: is_unit() fails for power-series-ring element: O(t^0)

archive/issues_029506.json:
```json
{
    "body": "Keywords: power series, is_unit\n\nUsing version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. \n\nThe bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. \n\nExample is attached.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29743\n\n",
    "created_at": "2020-05-27T12:43:00Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "is_unit() fails for power-series-ring element: O(t^0)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29506",
    "user": "@n-vi"
}
```
Keywords: power series, is_unit

Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. 

The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. 

Example is attached.

Issue created by migration from https://trac.sagemath.org/ticket/29743





---

archive/issue_comments_418889.json:
```json
{
    "body": "Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24",
    "created_at": "2020-05-27T12:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418889",
    "user": "@n-vi"
}
```

Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24



---

archive/issue_comments_418890.json:
```json
{
    "body": "needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n----\nNew commits:",
    "created_at": "2020-06-04T11:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418890",
    "user": "chapoton"
}
```

needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
----
New commits:



---

archive/issue_comments_418891.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-04T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418891",
    "user": "@n-vi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418892.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n> ----\n> New commits:\n> ||[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)||`fix is_unit for power-series element: O(t^0)`||\n\nThanks, I updated the ticket and changed status to 'needs review'.",
    "created_at": "2020-06-04T13:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418892",
    "user": "@n-vi"
}
```

Replying to [comment:2 chapoton]:
> needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
> ----
> New commits:
> ||[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)||`fix is_unit for power-series element: O(t^0)`||

Thanks, I updated the ticket and changed status to 'needs review'.



---

archive/issue_comments_418893.json:
```json
{
    "body": "Maybe you should rather check that the **precision** is not zero.\n\nAnd you need to add a doctest for the modified behaviour.",
    "created_at": "2020-06-04T18:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418893",
    "user": "chapoton"
}
```

Maybe you should rather check that the **precision** is not zero.

And you need to add a doctest for the modified behaviour.



---

archive/issue_comments_418894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-04T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418894",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418895.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418895",
    "user": "@mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_418896.json:
```json
{
    "body": "Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.\n\nA similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.\n\n```\nsage: R.<x,y> = QQ[[]]\nsage: y.O(0)\n0 + O(x, y)^0\nsage: _.is_unit()\n...\nIndexError: coefficient not known\n```\n",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418896",
    "user": "@mwageringel"
}
```

Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.

A similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.

```
sage: R.<x,y> = QQ[[]]
sage: y.O(0)
0 + O(x, y)^0
sage: _.is_unit()
...
IndexError: coefficient not known
```




---

archive/issue_comments_418897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-08T21:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418897",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418898.json:
```json
{
    "body": "Thank you for the review.\nI applied a similar fix to multivariate power series as you suggested.",
    "created_at": "2020-09-08T21:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418898",
    "user": "@n-vi"
}
```

Thank you for the review.
I applied a similar fix to multivariate power series as you suggested.



---

archive/issue_comments_418899.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-08T21:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418899",
    "user": "@n-vi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418900.json:
```json
{
    "body": "This looks good. Thank you.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418900",
    "user": "@mwageringel"
}
```

This looks good. Thank you.



---

archive/issue_comments_418901.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418901",
    "user": "@mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418902.json:
```json
{
    "body": "Great, thanks!",
    "created_at": "2020-09-10T00:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418902",
    "user": "@n-vi"
}
```

Great, thanks!



---

archive/issue_comments_418903.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T22:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418903",
    "user": "vbraun"
}
```

Resolution: fixed
