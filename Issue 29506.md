# Issue 29506: is_unit() fails for power-series-ring element: O(t^0)

archive/issues_029506.json:
```json
{
    "body": "Keywords: power series, is_unit\n\nUsing version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. \n\nThe bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. \n\nExample is attached.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29743\n\n",
    "created_at": "2020-05-27T12:43:00Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "is_unit() fails for power-series-ring element: O(t^0)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29506",
    "user": "https://github.com/n-vi"
}
```
Keywords: power series, is_unit

Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. 

The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. 

Example is attached.

Issue created by migration from https://trac.sagemath.org/ticket/29743





---

archive/issue_comments_418419.json:
```json
{
    "body": "Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24",
    "created_at": "2020-05-27T12:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418419",
    "user": "https://github.com/n-vi"
}
```

Attachment [is_unit_power_series_output.txt](tarball://root/attachments/some-uuid/ticket29743/is_unit_power_series_output.txt) by @n-vi created at 2020-05-27 12:43:24



---

archive/issue_comments_418420.json:
```json
{
    "body": "needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n\n---\nNew commits:",
    "created_at": "2020-06-04T11:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418420",
    "user": "https://github.com/fchapoton"
}
```

needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name

---
New commits:



---

archive/issue_comments_418421.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-04T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418421",
    "user": "https://github.com/n-vi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418422.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> needs review ? if yes, set the status to \"needs review\" and fill the Authors field with your real full name\n> \n> ---\n> New commits:\n> |                                                                                                                                          |                                              |\n> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n> |[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)|`fix is_unit for power-series element: O(t^0)`|\n\n\nThanks, I updated the ticket and changed status to 'needs review'.",
    "created_at": "2020-06-04T13:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418422",
    "user": "https://github.com/n-vi"
}
```

Replying to [comment:2 chapoton]:
> needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
> 
> ---
> New commits:
> |                                                                                                                                          |                                              |
> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
> |[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)|`fix is_unit for power-series element: O(t^0)`|


Thanks, I updated the ticket and changed status to 'needs review'.



---

archive/issue_comments_418423.json:
```json
{
    "body": "Maybe you should rather check that the **precision** is not zero.\n\nAnd you need to add a doctest for the modified behaviour.",
    "created_at": "2020-06-04T18:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418423",
    "user": "https://github.com/fchapoton"
}
```

Maybe you should rather check that the **precision** is not zero.

And you need to add a doctest for the modified behaviour.



---

archive/issue_comments_418424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-04T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418425.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418425",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_418426.json:
```json
{
    "body": "Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.\n\nA similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.\n\n```\nsage: R.<x,y> = QQ[[]]\nsage: y.O(0)\n0 + O(x, y)^0\nsage: _.is_unit()\n...\nIndexError: coefficient not known\n```",
    "created_at": "2020-08-15T17:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418426",
    "user": "https://github.com/mwageringel"
}
```

Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.

A similar fix should be applied to multivariate power series as well, so I am setting this back to *needs work*.

```
sage: R.<x,y> = QQ[[]]
sage: y.O(0)
0 + O(x, y)^0
sage: _.is_unit()
...
IndexError: coefficient not known
```



---

archive/issue_comments_418427.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-08T21:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418428.json:
```json
{
    "body": "Thank you for the review.\nI applied a similar fix to multivariate power series as you suggested.",
    "created_at": "2020-09-08T21:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418428",
    "user": "https://github.com/n-vi"
}
```

Thank you for the review.
I applied a similar fix to multivariate power series as you suggested.



---

archive/issue_comments_418429.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-08T21:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418429",
    "user": "https://github.com/n-vi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418430.json:
```json
{
    "body": "This looks good. Thank you.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418430",
    "user": "https://github.com/mwageringel"
}
```

This looks good. Thank you.



---

archive/issue_comments_418431.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-09T17:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418431",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418432.json:
```json
{
    "body": "Great, thanks!",
    "created_at": "2020-09-10T00:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418432",
    "user": "https://github.com/n-vi"
}
```

Great, thanks!



---

archive/issue_comments_418433.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T22:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29506#issuecomment-418433",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_076103.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T22:00:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29506",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29506#event-76103"
}
```
