# Issue 29506: is_unit() fails for power-series-ring element: O(t^0)

Issue created by migration from https://trac.sagemath.org/ticket/29743

Original creator: @n-vi

Original creation time: 2020-05-27 12:43:00

Keywords: power series, is_unit

Using version 9.1 of sage, is_unit() fails for the element O(t<sup>0</sup>) of a power-series ring. 

The bug does not depend on the base of the power-series. It occurs since is_unit() attempts to access the 0'th coefficient of the series, which does not exist in the special case of O(t<sup>0</sup>), resulting in an Index Error. 

Example is attached.


---

Attachment


---

Comment by chapoton created at 2020-06-04 11:49:21

needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
----
New commits:


---

Comment by @n-vi created at 2020-06-04 13:27:54

Changing status from new to needs_review.


---

Comment by @n-vi created at 2020-06-04 13:29:18

Replying to [comment:2 chapoton]:
> needs review ? if yes, set the status to "needs review" and fill the Authors field with your real full name
> ----
> New commits:
> ||[74b9be6](https://git.sagemath.org/sage.git/commit?id=74b9be671d8db2bd2d087e733d59a3a5ff033fcf)||`fix is_unit for power-series element: O(t^0)`||

Thanks, I updated the ticket and changed status to 'needs review'.


---

Comment by chapoton created at 2020-06-04 18:18:25

Maybe you should rather check that the **precision** is not zero.

And you need to add a doctest for the modified behaviour.


---

Comment by git created at 2020-06-04 21:29:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2020-08-15 17:02:37

Changing status from needs_review to needs_work.


---

Comment by @mwageringel created at 2020-08-15 17:02:37

Thank you for the fix. This approach looks correct to me. Since O(t<sup>0</sup>) does not have a multiplicative inverse, `is_unit` should be `False`.

A similar fix should be applied to multivariate power series as well, so I am setting this back to _needs work_.

```
sage: R.<x,y> = QQ[[]]
sage: y.O(0)
0 + O(x, y)^0
sage: _.is_unit()
...
IndexError: coefficient not known
```



---

Comment by git created at 2020-09-08 21:30:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @n-vi created at 2020-09-08 21:33:01

Thank you for the review.
I applied a similar fix to multivariate power series as you suggested.


---

Comment by @n-vi created at 2020-09-08 21:34:06

Changing status from needs_work to needs_review.


---

Comment by @mwageringel created at 2020-09-09 17:30:10

This looks good. Thank you.


---

Comment by @mwageringel created at 2020-09-09 17:30:10

Changing status from needs_review to positive_review.


---

Comment by @n-vi created at 2020-09-10 00:07:50

Great, thanks!


---

Comment by vbraun created at 2020-09-15 22:00:47

Resolution: fixed
