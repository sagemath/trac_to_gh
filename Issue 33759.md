# Issue 33759: ascii_art fail in jupyter notebook

Issue created by migration from https://trac.sagemath.org/ticket/33996

Original creator: klee

Original creation time: 2022-06-15 00:29:24

When running sage in Jupyter notebook, 

```
sage: ascii_art(list(Partitions(5)))
<repr(<sage.typeset.ascii_art.AsciiArt at 0x7f8f358aa250>) failed: OSError: [Errno 25] Inappropriate ioctl for device>
```


This is because the `_terminal_width()` method does not work with Jupiter. 


---

Comment by klee created at 2022-06-15 00:30:55

New commits:


---

Comment by klee created at 2022-06-15 00:31:22

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-06-15 06:35:43

This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?


---

Comment by klee created at 2022-06-15 06:51:58

Replying to [comment:4 dimpase]:
> This removed `try/except` block. It's not clear why it was there in the 1st place, but would it be easier to keep it?

It is explained in the comment. Not necessary anymore.


---

Comment by dimpase created at 2022-06-15 07:06:11

There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...


---

Comment by klee created at 2022-06-15 07:57:02

Replying to [comment:6 dimpase]:
> There could still be cases we don't know about, e.g. emacs mode, the modes used by one of these VSCode plugins, etc...

According to the comment, the author of the code, Volker, only considered terminal and IPython. So the `try/except` code is only for those two cases.

There is no reason to suspect that this change will make the situation with other user interfaces worse or better... In any case, it could be dealt with in other tickets if reported by users of those interfaces.


---

Comment by klee created at 2022-06-15 08:03:04

Replying to [comment:7 klee]:
> In any case, it could be dealt with in other tickets if reported by users of those interfaces.

Or in this ticket. We can wait.


---

Comment by klee created at 2022-06-15 08:14:29

Replying to [comment:7 klee]:
> There is no reason to suspect that this change will make the situation with other user interfaces worse or better... 

If any other user interface is affected, then it would be rather because of replacing `os.isatty(sys.stdout.fileno())` with `sys.stdout.isatty()`.


---

Comment by klee created at 2022-06-15 08:22:27

I put a post in sage-devel: https://groups.google.com/g/sage-devel/c/EHCPeH5BXh4


---

Comment by dimpase created at 2022-06-15 08:47:43

Changing status from needs_review to needs_info.


---

Comment by dimpase created at 2022-06-15 08:47:43

to copy my sage-dev message:

----

I think this fix is an API change. We have no control over what fake
ttys Sage users are using.
What earlier returned False might now lead to an error.
So if you want to remove that try/except, you must deprecate it first.

IMHO I'd better have try/except retained (your fix applied in the body of try)


---

Comment by dimpase created at 2022-06-15 09:50:15

By the way, I checked that emacs-mode works with this change. Another tricky case might be sage cell.


---

Comment by git created at 2022-06-15 10:13:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-06-15 10:15:00

Replying to [comment:11 dimpase]:
> IMHO I'd better have try/except retained (your fix applied in the body of try)

Okay. Being cautious doesn't hurt. Thanks.


---

Comment by dimpase created at 2022-06-15 14:41:25

OK, good.


---

Comment by dimpase created at 2022-06-15 14:41:25

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2022-06-28 22:12:18

Resolution: fixed
