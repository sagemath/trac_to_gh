# Issue 17445: help

archive/issues_017445.json:
```json
{
    "body": "CC:  jpflori\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17682\n\n",
    "created_at": "2015-01-27T21:02:11Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "help",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17445",
    "user": "gouezel"
}
```
CC:  jpflori



Issue created by migration from https://trac.sagemath.org/ticket/17682





---

archive/issue_comments_233018.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to porting: Cygwin.",
    "created_at": "2015-01-27T21:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233018",
    "user": "gouezel"
}
```

Changing component from PLEASE CHANGE to porting: Cygwin.



---

archive/issue_comments_233019.json:
```json
{
    "body": "I put the definition of the generic filename extension in sage.misc.sageinspect, since its use is relevant for introspection. Tell me if there is a better place!\n----\nNew commits:",
    "created_at": "2015-01-27T21:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233019",
    "user": "gouezel"
}
```

I put the definition of the generic filename extension in sage.misc.sageinspect, since its use is relevant for introspection. Tell me if there is a better place!
----
New commits:



---

archive/issue_comments_233020.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-27T21:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233020",
    "user": "gouezel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233021.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-01-27T21:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233021",
    "user": "gouezel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_233022.json:
```json
{
    "body": "(and myself)",
    "created_at": "2015-01-30T23:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233022",
    "user": "tscrim"
}
```

(and myself)



---

archive/issue_comments_233023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-31T11:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233024.json:
```json
{
    "body": "Ahem, I do not completely understand what the patch does (i'm new to sage/python);\nQuestion: what are the consequences, e.g. for `init_libsingular()`\nin `src/sage/libs/singular/singular.pyx`?\n\n*snip*:\n\n```\n...\n    for extension in [\"so\", \"dylib\", \"dll\"]:\n        lib = os.environ['SAGE_LOCAL']+\"/lib/libsingular.\"+extension\n        if os.path.exists(lib):\n            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)\n            break\n...\n```\n",
    "created_at": "2015-02-08T23:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233024",
    "user": "jakobkroeker"
}
```

Ahem, I do not completely understand what the patch does (i'm new to sage/python);
Question: what are the consequences, e.g. for `init_libsingular()`
in `src/sage/libs/singular/singular.pyx`?

*snip*:

```
...
    for extension in ["so", "dylib", "dll"]:
        lib = os.environ['SAGE_LOCAL']+"/lib/libsingular."+extension
        if os.path.exists(lib):
            handle = dlopen(lib, RTLD_GLOBAL|RTLD_LAZY)
            break
...
```




---

archive/issue_comments_233025.json:
```json
{
    "body": "Replying to [comment:8 jakobkroeker]:\n\nShort answer: the code you show is fine, no need to change anything.\n\nLong answer: shared libraries usually have the extension `.so` on unix-likes. So, some parts of sage's code assume that this is a universal extension, and use it for loading or doctesting purposes. This leads to problems on cygwin, where the extension is `.dll`. The patch fixes this code, replacing the universal `.so` with an extension depending on the platform (`.dll` on windows, `.so`anywhere else). Code that already considered the possibility of different extensions is fine.\n\nThere is yet another difference on MacOS, where the extension for shared libraries can be `.so` or `.dylib` -- this means that, in this case, there is no universal possible choice, so I picked `.so` since it is the most common in sage. In the case of libsingular, I don't know if it is built using `.so` or `.dylib` (and I don't have a Mac to test). If it is `.so`, one might consider using the patch to predict the correct extension, but in any case the current code works fine.",
    "created_at": "2015-02-09T08:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233025",
    "user": "gouezel"
}
```

Replying to [comment:8 jakobkroeker]:

Short answer: the code you show is fine, no need to change anything.

Long answer: shared libraries usually have the extension `.so` on unix-likes. So, some parts of sage's code assume that this is a universal extension, and use it for loading or doctesting purposes. This leads to problems on cygwin, where the extension is `.dll`. The patch fixes this code, replacing the universal `.so` with an extension depending on the platform (`.dll` on windows, `.so`anywhere else). Code that already considered the possibility of different extensions is fine.

There is yet another difference on MacOS, where the extension for shared libraries can be `.so` or `.dylib` -- this means that, in this case, there is no universal possible choice, so I picked `.so` since it is the most common in sage. In the case of libsingular, I don't know if it is built using `.so` or `.dylib` (and I don't have a Mac to test). If it is `.so`, one might consider using the patch to predict the correct extension, but in any case the current code works fine.



---

archive/issue_comments_233026.json:
```json
{
    "body": "Replying to [comment:9 gouezel]:\n> There is yet another difference on MacOS, where the extension for shared libraries can be `.so` or `.dylib` -- this means that, in this case, there is no universal possible choice\n\nIt's more subtle than that. On OS X, both `.so` and `.dylib` exist but with a different purpose: `.so` is meant for \"loadable modules\" to be opened at runtime by some `dlopen()` mechanism, which `.dylib` is for dynamic linking of libraries (linking done when a program a started). For example, Cython extensions would use `.so` but the libraries in `$SAGE_LOCAL/lib` would use `.dylib`.\n\nOn Linux, this difference simply doesn't exist.",
    "created_at": "2015-02-09T13:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233026",
    "user": "jdemeyer"
}
```

Replying to [comment:9 gouezel]:
> There is yet another difference on MacOS, where the extension for shared libraries can be `.so` or `.dylib` -- this means that, in this case, there is no universal possible choice

It's more subtle than that. On OS X, both `.so` and `.dylib` exist but with a different purpose: `.so` is meant for "loadable modules" to be opened at runtime by some `dlopen()` mechanism, which `.dylib` is for dynamic linking of libraries (linking done when a program a started). For example, Cython extensions would use `.so` but the libraries in `$SAGE_LOCAL/lib` would use `.dylib`.

On Linux, this difference simply doesn't exist.



---

archive/issue_comments_233027.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-04-22T19:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233027",
    "user": "gouezel"
}
```

New commits:



---

archive/issue_comments_233028.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-22T19:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233028",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233029.json:
```json
{
    "body": "I dislike the complete lack of documentation. Given that constants are hard to document, it's probably better to make it a function `def ..._extension()` (fill in the `...` to what this thing represents, `generic_so` doesn't mean much to me, see also [comment:10]).",
    "created_at": "2015-04-22T19:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233029",
    "user": "jdemeyer"
}
```

I dislike the complete lack of documentation. Given that constants are hard to document, it's probably better to make it a function `def ..._extension()` (fill in the `...` to what this thing represents, `generic_so` doesn't mean much to me, see also [comment:10]).



---

archive/issue_comments_233030.json:
```json
{
    "body": "Also: can you replace `F[-len(generic_so_extension):] == generic_so_extension` by `F.endswith(extension)`.",
    "created_at": "2015-04-22T20:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233030",
    "user": "jdemeyer"
}
```

Also: can you replace `F[-len(generic_so_extension):] == generic_so_extension` by `F.endswith(extension)`.



---

archive/issue_comments_233031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-23T19:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233031",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233032.json:
```json
{
    "body": "Converted `generic_so_extension` to a documented function `shared_lib_extension()`. It is a little bit silly to recompute it every time, but given its triviality and the fact that it should never be time-critical, I don't think caching it is useful.",
    "created_at": "2015-04-23T20:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233032",
    "user": "gouezel"
}
```

Converted `generic_so_extension` to a documented function `shared_lib_extension()`. It is a little bit silly to recompute it every time, but given its triviality and the fact that it should never be time-critical, I don't think caching it is useful.



---

archive/issue_comments_233033.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-23T20:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233033",
    "user": "gouezel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233034.json:
```json
{
    "body": "I think all this\n\n```\nsage: from site import getsitepackages\nsage: site_packages = getsitepackages()[0]\nsage: from sage_setup.find import installed_files_by_module\nsage: files_by_module = installed_files_by_module(site_packages)\nsage: from sage.misc.sageinspect import shared_lib_extension\nsage: files_by_module['sage.structure.sage_object'].pop().endswith(shared_lib_extension())\n```\n\ncan be replaced by\n\n```\nsage: sage.structure.sage_object.__file__.endswith(shared_lib_extension())\n```\n",
    "created_at": "2015-04-24T08:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233034",
    "user": "jdemeyer"
}
```

I think all this

```
sage: from site import getsitepackages
sage: site_packages = getsitepackages()[0]
sage: from sage_setup.find import installed_files_by_module
sage: files_by_module = installed_files_by_module(site_packages)
sage: from sage.misc.sageinspect import shared_lib_extension
sage: files_by_module['sage.structure.sage_object'].pop().endswith(shared_lib_extension())
```

can be replaced by

```
sage: sage.structure.sage_object.__file__.endswith(shared_lib_extension())
```




---

archive/issue_comments_233035.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-24T08:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233035",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233036.json:
```json
{
    "body": "Can you replace the terminology `shared_lib` by `loadable_module`. As I said, these are different on OS X and Cython modules are \"loadable modules\" and not \"shared libraries\" (the latter would have a `.dylib` extension on OS X).",
    "created_at": "2015-04-24T08:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233036",
    "user": "jdemeyer"
}
```

Can you replace the terminology `shared_lib` by `loadable_module`. As I said, these are different on OS X and Cython modules are "loadable modules" and not "shared libraries" (the latter would have a `.dylib` extension on OS X).



---

archive/issue_comments_233037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-24T08:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233037",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233038.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-24T08:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233038",
    "user": "gouezel"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233039.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-27T19:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233039",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233040.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-28T04:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17445#issuecomment-233040",
    "user": "vbraun"
}
```

Resolution: fixed
