# Issue 16689: Merge the features of SymmetricGroupAlgebra and SymmetricGroup.algebra

archive/issues_016689.json:
```json
{
    "body": "CC:  sage-combinat tscrim darij virmaux\n\nWe have different implementations of the algebra of the symmetric group, and more may come in the future:\n- `SymmetricGroupAlgebra(K, n)`\n- `SymmetricGroup(n).algebra(K)`\n- `WeylGroup(['A',3]).algebra(K)`\n- ...\n\nThey mostly differ in how the elements of the symmetric group are represented, and each representation can have its advantage depending on the application in mind. So it's fine to keep them all. On the other hand, currently only the first one makes use of the special features of the symmetric group. Here is a plan to share those features across all implementations:\n\nCreate a category `SymmetricGroups`. Put the relevant groups in this category.\n\nGeneralize the features (Yucis-Murphy elements, ...) from `SymmetricGroupAlgebra` to the category `SymmetricGroups.Algebras`.\n\nPut `SymmetricGroupAlgebra` in this category, and strip away all the code that is not needed anymore.\n\nVolunteers?\n\nIssue created by migration from https://trac.sagemath.org/ticket/16926\n\n",
    "created_at": "2014-09-03T11:39:57Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Merge the features of SymmetricGroupAlgebra and SymmetricGroup.algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16689",
    "user": "nthiery"
}
```
CC:  sage-combinat tscrim darij virmaux

We have different implementations of the algebra of the symmetric group, and more may come in the future:
- `SymmetricGroupAlgebra(K, n)`
- `SymmetricGroup(n).algebra(K)`
- `WeylGroup(['A',3]).algebra(K)`
- ...

They mostly differ in how the elements of the symmetric group are represented, and each representation can have its advantage depending on the application in mind. So it's fine to keep them all. On the other hand, currently only the first one makes use of the special features of the symmetric group. Here is a plan to share those features across all implementations:

Create a category `SymmetricGroups`. Put the relevant groups in this category.

Generalize the features (Yucis-Murphy elements, ...) from `SymmetricGroupAlgebra` to the category `SymmetricGroups.Algebras`.

Put `SymmetricGroupAlgebra` in this category, and strip away all the code that is not needed anymore.

Volunteers?

Issue created by migration from https://trac.sagemath.org/ticket/16926





---

archive/issue_comments_220383.json:
```json
{
    "body": "I don't even know how this is going to happen. AlgebraWithBases? Coercions back and forth?",
    "created_at": "2014-09-03T11:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220383",
    "user": "darij"
}
```

I don't even know how this is going to happen. AlgebraWithBases? Coercions back and forth?



---

archive/issue_comments_220384.json:
```json
{
    "body": "Replying to [comment:2 darij]:\n> I don't even know how this is going to happen. AlgebraWithBases? Coercions back and forth?\n\nLater on, it could make sense to connect by coercions and an `AlgebraWithBases`, but we don't need this for now. Each implementation would be standalone, just sharing common features through a common abstract class (in the category SymmetricGroups().Algebras(...)).",
    "created_at": "2014-09-03T11:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220384",
    "user": "nthiery"
}
```

Replying to [comment:2 darij]:
> I don't even know how this is going to happen. AlgebraWithBases? Coercions back and forth?

Later on, it could make sense to connect by coercions and an `AlgebraWithBases`, but we don't need this for now. Each implementation would be standalone, just sharing common features through a common abstract class (in the category SymmetricGroups().Algebras(...)).



---

archive/issue_comments_220385.json:
```json
{
    "body": "Isn't that harder? There'd be quite a lot of functionality to triplicate...",
    "created_at": "2014-09-03T11:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220385",
    "user": "darij"
}
```

Isn't that harder? There'd be quite a lot of functionality to triplicate...



---

archive/issue_comments_220386.json:
```json
{
    "body": "Replying to [comment:4 darij]:\n> Isn't that harder? There'd be quite a lot of functionality to triplicate...\n\nYou mean, harder with just the `SymmetricGroups.Algebra` approach?\n\nThere is nothing to triplicate in this approach. Everything common is implemented exactly once, in SymmetricGroups.Algebra.",
    "created_at": "2014-09-03T12:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220386",
    "user": "nthiery"
}
```

Replying to [comment:4 darij]:
> Isn't that harder? There'd be quite a lot of functionality to triplicate...

You mean, harder with just the `SymmetricGroups.Algebra` approach?

There is nothing to triplicate in this approach. Everything common is implemented exactly once, in SymmetricGroups.Algebra.



---

archive/issue_comments_220387.json:
```json
{
    "body": "Oh, you want to move things like the Young-Jucys-Murphy elements and the seminormal basis to an abstract base class?\n\nGood idea actually, as long as we can ensure this doesn't slow them down on the standard SymmetricGroupAlgebra.",
    "created_at": "2014-09-03T12:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220387",
    "user": "darij"
}
```

Oh, you want to move things like the Young-Jucys-Murphy elements and the seminormal basis to an abstract base class?

Good idea actually, as long as we can ensure this doesn't slow them down on the standard SymmetricGroupAlgebra.



---

archive/issue_comments_220388.json:
```json
{
    "body": "Replying to [comment:6 darij]:\n> Oh, you want to move things like the Young-Jucys-Murphy elements and the seminormal basis to an abstract base class?\n\nPrecisely.\n\n> Good idea actually, as long as we can ensure this doesn't slow them down on the standard SymmetricGroupAlgebra.\n\nThat's something to be checked, but a priori given the kind of algorithms, I doubt it would.",
    "created_at": "2014-09-03T12:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220388",
    "user": "nthiery"
}
```

Replying to [comment:6 darij]:
> Oh, you want to move things like the Young-Jucys-Murphy elements and the seminormal basis to an abstract base class?

Precisely.

> Good idea actually, as long as we can ensure this doesn't slow them down on the standard SymmetricGroupAlgebra.

That's something to be checked, but a priori given the kind of algorithms, I doubt it would.



---

archive/issue_comments_220389.json:
```json
{
    "body": "I second using an ABC rather than a category. Also as mentioned in my comment on #16925, I think `SymmetricGroupAlgebra` should actually use the group an an indexing set for the basis, thus keeping that as `SymmetricGroup(n).algebra(K)` (alternatively merging in the general `GroupAlgebra` implementation).",
    "created_at": "2014-09-03T19:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220389",
    "user": "tscrim"
}
```

I second using an ABC rather than a category. Also as mentioned in my comment on #16925, I think `SymmetricGroupAlgebra` should actually use the group an an indexing set for the basis, thus keeping that as `SymmetricGroup(n).algebra(K)` (alternatively merging in the general `GroupAlgebra` implementation).



---

archive/issue_comments_220390.json:
```json
{
    "body": "But we absolutely need to keep the `SGA(p)` syntax working for `SGA` a symmetric group algebra and `p` a permutation. And we'd do well to not slow it down by any significant amount.",
    "created_at": "2014-09-03T19:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220390",
    "user": "darij"
}
```

But we absolutely need to keep the `SGA(p)` syntax working for `SGA` a symmetric group algebra and `p` a permutation. And we'd do well to not slow it down by any significant amount.



---

archive/issue_comments_220391.json:
```json
{
    "body": "Replying to [comment:9 darij]:\n> But we absolutely need to keep the `SGA(p)` syntax working for `SGA` a symmetric group algebra and `p` a permutation. And we'd do well to not slow it down by any significant amount.\n\nI agree (and this is easy enough to do with `_element_constructor_`). In fact, using the gap group, we'll significantly speed up the multiplication. Perhaps being clever by using a hybrid approach, we can speed up computing the basis too (IDK yet, haven't tried).",
    "created_at": "2014-09-03T19:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220391",
    "user": "tscrim"
}
```

Replying to [comment:9 darij]:
> But we absolutely need to keep the `SGA(p)` syntax working for `SGA` a symmetric group algebra and `p` a permutation. And we'd do well to not slow it down by any significant amount.

I agree (and this is easy enough to do with `_element_constructor_`). In fact, using the gap group, we'll significantly speed up the multiplication. Perhaps being clever by using a hybrid approach, we can speed up computing the basis too (IDK yet, haven't tried).



---

archive/issue_comments_220392.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> I second using an ABC rather than a category.\n\nThe category is doing just that: providing an ABC. Granted, it might look a bit overkill since we might not need an ABC for the elements or other functorial constructions. But in exchange  (S_n).algebra() is automatically made to inherit from the ABC in a way that is uniform with all the other stuff about XXX algebras: no need to insert manually that ABC in `SymmetricGroup.algebra`.",
    "created_at": "2014-09-03T20:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220392",
    "user": "nthiery"
}
```

Replying to [comment:8 tscrim]:
> I second using an ABC rather than a category.

The category is doing just that: providing an ABC. Granted, it might look a bit overkill since we might not need an ABC for the elements or other functorial constructions. But in exchange  (S_n).algebra() is automatically made to inherit from the ABC in a way that is uniform with all the other stuff about XXX algebras: no need to insert manually that ABC in `SymmetricGroup.algebra`.



---

archive/issue_comments_220393.json:
```json
{
    "body": "I don't really like the idea of putting into a category as opposed to having a proper ABC. Doing with an ABC means we can have automatic coercion by just doing:\n\n```python\ndef _coerce_map_from_(self, X):\n    if isinstance(X, SGA_abstract):\n        return True\n    return super(SGA_abstract, self)._coerce_map_from_(X)\n```\n\n(We can't do this with categories, nor do I think we should for that matter.)\nAlso as you mentioned, it's overkill to me. Also if we were to have this in the category, we'd still have to override the `algebra` method (or worse, a check on the group in the generic group algebra). Although I'm still of the opinion that we should merge the generic group algebra of S<sub>n</sub> into `SymmetricGroupAlgebra` and get that to work. I'm not sure what we'll need/want to do w.r.t. the Weyl group one, I haven't thought about how this will figure in yet.\n\nAlso since this is the same object in the \"same\" realization, IMO the `WithRealizations` framework shouldn't be used here either. It also possible to convince to go this route, but I don't really think it'll be the best way.",
    "created_at": "2014-09-04T05:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220393",
    "user": "tscrim"
}
```

I don't really like the idea of putting into a category as opposed to having a proper ABC. Doing with an ABC means we can have automatic coercion by just doing:

```python
def _coerce_map_from_(self, X):
    if isinstance(X, SGA_abstract):
        return True
    return super(SGA_abstract, self)._coerce_map_from_(X)
```

(We can't do this with categories, nor do I think we should for that matter.)
Also as you mentioned, it's overkill to me. Also if we were to have this in the category, we'd still have to override the `algebra` method (or worse, a check on the group in the generic group algebra). Although I'm still of the opinion that we should merge the generic group algebra of S<sub>n</sub> into `SymmetricGroupAlgebra` and get that to work. I'm not sure what we'll need/want to do w.r.t. the Weyl group one, I haven't thought about how this will figure in yet.

Also since this is the same object in the "same" realization, IMO the `WithRealizations` framework shouldn't be used here either. It also possible to convince to go this route, but I don't really think it'll be the best way.



---

archive/issue_comments_220394.json:
```json
{
    "body": "Silly question, no doubt, but what is an **ABC**?",
    "created_at": "2014-11-06T23:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220394",
    "user": "andrew.mathas"
}
```

Silly question, no doubt, but what is an **ABC**?



---

archive/issue_comments_220395.json:
```json
{
    "body": "An **A**bstract **B**ase **C**lass.",
    "created_at": "2014-11-07T02:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220395",
    "user": "tscrim"
}
```

An **A**bstract **B**ase **C**lass.



---

archive/issue_comments_220396.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-07T23:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220396",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_220397.json:
```json
{
    "body": "Okay, done. So some notes for the reviewer:\n\n- Currently `descents` behavior differs from that given by the category, so as to avoid backwards incompatible change, we leave warning messages and leave the behavior alone.\n\n- `reduced_word()` does not respect the order of multiplication and needs to be fixed so that `TestSuite` passes.\n\n- I've added as much common functionality between `SymmetricGroup` and `Permutations` since the former is a gap version of the latter. I'm leaving `WeylGroup` alone because it is a matrix group, but if someone wants to add better support for conjugacy classes, then go ahead.\n\n- I made a bunch of other optimizations for iterating over elements and micro-optimizations.\n\n- I abstracted `StandardPermutations_n` to better reflect the mathematics.\n\n- Better and more careful handling of parents during multiplication.\n\n- The `from_*` now can take a parent as input to better control their output (this was needed).\n\nSome todo's for later:\n\n1. Improve the speed of multiplying Sage permutations:\n\n```\nsage: S = SymmetricGroup(5)\nsage: R = S.simple_reflections()\nsage: %timeit prod(R)\n10000 loops, best of 3: 36.6 \u00b5s per loop\nsage: P = Permutations(5)\nsage: R = P.simple_reflections()\nsage: %timeit prod(R)\n1000 loops, best of 3: 413 \u00b5s per loop\n```\n\n\n2. Refactor the `Permutation` class to better be an element class, especially parsing of input (hard and tedious).\n\n3. Fix the issues noted above (also hard).\n\nHowever, IMO the current version should be reviewed and included into Sage (as it is needed for #11111).\n\nThis is the other option, which I am keeping here for the official record:\n\n* Create a category `SymmetricGroups`. Put the relevant groups in this category.\n* Generalize the features (Yucis-Murphy elements, ...) from `SymmetricGroupAlgebra` to the category `SymmetricGroups.Algebras`.\n* Put `SymmetricGroupAlgebra` in this category, and strip away all the code that is not needed anymore.\n* Cross ref the different implementations in the documentation.\n----\nNew commits:",
    "created_at": "2015-02-07T23:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220397",
    "user": "tscrim"
}
```

Okay, done. So some notes for the reviewer:

- Currently `descents` behavior differs from that given by the category, so as to avoid backwards incompatible change, we leave warning messages and leave the behavior alone.

- `reduced_word()` does not respect the order of multiplication and needs to be fixed so that `TestSuite` passes.

- I've added as much common functionality between `SymmetricGroup` and `Permutations` since the former is a gap version of the latter. I'm leaving `WeylGroup` alone because it is a matrix group, but if someone wants to add better support for conjugacy classes, then go ahead.

- I made a bunch of other optimizations for iterating over elements and micro-optimizations.

- I abstracted `StandardPermutations_n` to better reflect the mathematics.

- Better and more careful handling of parents during multiplication.

- The `from_*` now can take a parent as input to better control their output (this was needed).

Some todo's for later:

1. Improve the speed of multiplying Sage permutations:

```
sage: S = SymmetricGroup(5)
sage: R = S.simple_reflections()
sage: %timeit prod(R)
10000 loops, best of 3: 36.6 µs per loop
sage: P = Permutations(5)
sage: R = P.simple_reflections()
sage: %timeit prod(R)
1000 loops, best of 3: 413 µs per loop
```


2. Refactor the `Permutation` class to better be an element class, especially parsing of input (hard and tedious).

3. Fix the issues noted above (also hard).

However, IMO the current version should be reviewed and included into Sage (as it is needed for #11111).

This is the other option, which I am keeping here for the official record:

* Create a category `SymmetricGroups`. Put the relevant groups in this category.
* Generalize the features (Yucis-Murphy elements, ...) from `SymmetricGroupAlgebra` to the category `SymmetricGroups.Algebras`.
* Put `SymmetricGroupAlgebra` in this category, and strip away all the code that is not needed anymore.
* Cross ref the different implementations in the documentation.
----
New commits:



---

archive/issue_comments_220398.json:
```json
{
    "body": "Not sure if I'm going to be reviewing this (time is short as usual and I'm still not good at OOP -- case in point, I don't know what mixins are for), but a few remarks.\n\nFirst, a trivial group needs no generators. So this\n\n```\n+ if self.n <= 1:\n+ return (self.one(),)\n```\n\ncan be replaced by\n\n```\n+ if self.n <= 1:\n+ return ()\n```\n\n\nSecond, you are testing for the order-of-multiplication global in `has_left_descent` and in `has_right_descent`. I understand the reasoning behind it, but I don't like it, as it spreads a bad design choice further. Can we agree that the \"left\" in \"left descent\" stands for \"left action\" rather than \"multiplying with s_i from the left\", or is this too revisionistic?",
    "created_at": "2015-02-08T03:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220398",
    "user": "darij"
}
```

Not sure if I'm going to be reviewing this (time is short as usual and I'm still not good at OOP -- case in point, I don't know what mixins are for), but a few remarks.

First, a trivial group needs no generators. So this

```
+ if self.n <= 1:
+ return (self.one(),)
```

can be replaced by

```
+ if self.n <= 1:
+ return ()
```


Second, you are testing for the order-of-multiplication global in `has_left_descent` and in `has_right_descent`. I understand the reasoning behind it, but I don't like it, as it spreads a bad design choice further. Can we agree that the "left" in "left descent" stands for "left action" rather than "multiplying with s_i from the left", or is this too revisionistic?



---

archive/issue_comments_220399.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-16T19:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220399",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220400.json:
```json
{
    "body": "Replying to [comment:16 darij]:\n> Not sure if I'm going to be reviewing this (time is short as usual and I'm still not good at OOP -- case in point, I don't know what mixins are for), but a few remarks.\n\nI appreciate any time you can devote, plus I'd think it would be best that Nicolas takes a good look at this patch (and possibly have Aladin merge it into his current version of #11111 and test it there too).\n\n(Mixins are as they sound to be, they are classes you \"mix in\" the class heirarchy which typically contain general or independent features. [This SO thread](http://stackoverflow.com/questions/533631/what-is-a-mixin-and-why-are-they-useful) I think gives a good overview of them.)\n\n> First, a trivial group needs no generators. ...\n\nGood point; fixed.\n\n> Second, you are testing for the order-of-multiplication global in `has_left_descent` and in `has_right_descent`. I understand the reasoning behind it, but I don't like it, as it spreads a bad design choice further. Can we agree that the \"left\" in \"left descent\" stands for \"left action\" rather than \"multiplying with s_i from the left\", or is this too revisionistic?\n\nIt breaks the generic implementation of the `long_element` method, which relies on the multiplication on the left corresponding to `has_left_descent`. I feel these changes further shows `permutation.py` can be a minefield...but I'm trying to make do with what I have.",
    "created_at": "2015-02-16T19:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220400",
    "user": "tscrim"
}
```

Replying to [comment:16 darij]:
> Not sure if I'm going to be reviewing this (time is short as usual and I'm still not good at OOP -- case in point, I don't know what mixins are for), but a few remarks.

I appreciate any time you can devote, plus I'd think it would be best that Nicolas takes a good look at this patch (and possibly have Aladin merge it into his current version of #11111 and test it there too).

(Mixins are as they sound to be, they are classes you "mix in" the class heirarchy which typically contain general or independent features. [This SO thread](http://stackoverflow.com/questions/533631/what-is-a-mixin-and-why-are-they-useful) I think gives a good overview of them.)

> First, a trivial group needs no generators. ...

Good point; fixed.

> Second, you are testing for the order-of-multiplication global in `has_left_descent` and in `has_right_descent`. I understand the reasoning behind it, but I don't like it, as it spreads a bad design choice further. Can we agree that the "left" in "left descent" stands for "left action" rather than "multiplying with s_i from the left", or is this too revisionistic?

It breaks the generic implementation of the `long_element` method, which relies on the multiplication on the left corresponding to `has_left_descent`. I feel these changes further shows `permutation.py` can be a minefield...but I'm trying to make do with what I have.



---

archive/issue_comments_220401.json:
```json
{
    "body": "Hello,\n\nI would love to try to merge into #11111 but this last one cause too many merge conflicts. And some requiere more knowledge than I actually have in order to be solved (in particular those in set.py and integer_ring.py).",
    "created_at": "2015-02-17T13:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220401",
    "user": "virmaux"
}
```

Hello,

I would love to try to merge into #11111 but this last one cause too many merge conflicts. And some requiere more knowledge than I actually have in order to be solved (in particular those in set.py and integer_ring.py).



---

archive/issue_comments_220402.json:
```json
{
    "body": "Shouldn't the `__contains__` and `__iter__` methods on `StandardPermutations_n_abstract` be in `StandardPermutations_n` instead? (Not sure about the other methods.) I find it strange to see an ABC whose most methods are anything but abstract.",
    "created_at": "2015-02-17T21:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220402",
    "user": "darij"
}
```

Shouldn't the `__contains__` and `__iter__` methods on `StandardPermutations_n_abstract` be in `StandardPermutations_n` instead? (Not sure about the other methods.) I find it strange to see an ABC whose most methods are anything but abstract.



---

archive/issue_comments_220403.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-17T21:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220403",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220404.json:
```json
{
    "body": "`__contains__` is a definite no because the subclasses want that to use that check. However, I moved `__iter__` and a bunch of other methods to `StandardPermutations_n` since they were (potentially) giving wrong results. I also used `itertools` for the iteration because it was ~20x faster:\n\n```\nsage: %timeit len(list(itertools.permutations(range(1,6), 5)))\n10000 loops, best of 3: 36.5 \u00b5s per loop\nsage: %timeit len(list(Permutations_set._fast_iter(range(1,6))))\n1000 loops, best of 3: 658 \u00b5s per loop\n```\n",
    "created_at": "2015-02-17T21:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220404",
    "user": "tscrim"
}
```

`__contains__` is a definite no because the subclasses want that to use that check. However, I moved `__iter__` and a bunch of other methods to `StandardPermutations_n` since they were (potentially) giving wrong results. I also used `itertools` for the iteration because it was ~20x faster:

```
sage: %timeit len(list(itertools.permutations(range(1,6), 5)))
10000 loops, best of 3: 36.5 µs per loop
sage: %timeit len(list(Permutations_set._fast_iter(range(1,6))))
1000 loops, best of 3: 658 µs per loop
```




---

archive/issue_comments_220405.json:
```json
{
    "body": "That's a nice find you made in the itertools. Good to see that \"fast\" iterator gone!\n\nI'll shortly push my \"fix\" to the l2r/r2l issue. But meanwhile, I disagree about `__contains__`. This method tests containment in Permutations(n), not in whatever subclass we have inherit from `StandardPermutations_n_abstract`. If it stays in the ABC, then every subclass that does not override it will have a wrong `__contains__` test. If you just want to be able to use it out of subclasses, why not `@`classmethod or `@`staticmethod?",
    "created_at": "2015-02-18T04:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220405",
    "user": "darij"
}
```

That's a nice find you made in the itertools. Good to see that "fast" iterator gone!

I'll shortly push my "fix" to the l2r/r2l issue. But meanwhile, I disagree about `__contains__`. This method tests containment in Permutations(n), not in whatever subclass we have inherit from `StandardPermutations_n_abstract`. If it stays in the ABC, then every subclass that does not override it will have a wrong `__contains__` test. If you just want to be able to use it out of subclasses, why not `@`classmethod or `@`staticmethod?



---

archive/issue_comments_220406.json:
```json
{
    "body": "Replying to [comment:23 darij]:\n> But meanwhile, I disagree about `__contains__`. This method tests containment in Permutations(n), not in whatever subclass we have inherit from `StandardPermutations_n_abstract`. If it stays in the ABC, then every subclass that does not override it will have a wrong `__contains__` test. If you just want to be able to use it out of subclasses, why not `@`classmethod or `@`staticmethod?\n\nIt would potentially give false positives, but it's better than the generic one from `Parent` (which is part of the test):\n\n```\nsage: P = Permutations(5, avoiding=[1,4,2,3])\nsage: P([1,4,2,3,5]) in P\nTrue\n```\n\nThe idea is to override it for extra information and to include a super call so as to avoid duplicating code (i.e., this is good OOP).",
    "created_at": "2015-02-18T04:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220406",
    "user": "tscrim"
}
```

Replying to [comment:23 darij]:
> But meanwhile, I disagree about `__contains__`. This method tests containment in Permutations(n), not in whatever subclass we have inherit from `StandardPermutations_n_abstract`. If it stays in the ABC, then every subclass that does not override it will have a wrong `__contains__` test. If you just want to be able to use it out of subclasses, why not `@`classmethod or `@`staticmethod?

It would potentially give false positives, but it's better than the generic one from `Parent` (which is part of the test):

```
sage: P = Permutations(5, avoiding=[1,4,2,3])
sage: P([1,4,2,3,5]) in P
True
```

The idea is to override it for extra information and to include a super call so as to avoid duplicating code (i.e., this is good OOP).



---

archive/issue_comments_220407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-18T04:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220407",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220408.json:
```json
{
    "body": "Ah, if it was already semi-broken this way, then it's fine. I've added a warning in the doc, however.\n\nNot a review yet, but just a patch for the 'mult' issue. Are you OK with it?",
    "created_at": "2015-02-18T04:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220408",
    "user": "darij"
}
```

Ah, if it was already semi-broken this way, then it's fine. I've added a warning in the doc, however.

Not a review yet, but just a patch for the 'mult' issue. Are you OK with it?



---

archive/issue_comments_220409.json:
```json
{
    "body": "Yes, it works for me.",
    "created_at": "2015-02-18T04:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220409",
    "user": "tscrim"
}
```

Yes, it works for me.



---

archive/issue_comments_220410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-18T06:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220410",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220411.json:
```json
{
    "body": "Part of the review done (sorry, I'm slow). I fear I need explanations on this:\n\n```\n+        def __mul__(self, other):\n+            r\"\"\"\n+            Multiply ``self`` and ``other``.\n+\n+            EXAMPLES::\n+\n+                sage: P = Permutations(4)\n+                sage: P.simple_reflection(1) * Permutation([6,5,4,3,2,1])\n+                [5, 6, 4, 3, 2, 1]\n+            \"\"\"\n+            if (not isinstance(other, StandardPermutations_n.Element)\n+                or self.parent() != other.parent()):\n+                return Permutation.__mul__(self, other)\n+            return self._mul_(other)\n+\n+        def _mul_(self, other):\n+            r\"\"\"\n+            Multiply ``self`` and ``other``.\n+\n+            EXAMPLES::\n+\n+                sage: P = Permutations(4)\n+                sage: P.prod(P.gens()).parent() is P\n+                True\n+            \"\"\"\n+            p = list(Permutation.__mul__(self, other))\n+            return self.__class__(self.parent(), p)\n```\n\nor someone else will have to vow for its correctness.",
    "created_at": "2015-02-18T06:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220411",
    "user": "darij"
}
```

Part of the review done (sorry, I'm slow). I fear I need explanations on this:

```
+        def __mul__(self, other):
+            r"""
+            Multiply ``self`` and ``other``.
+
+            EXAMPLES::
+
+                sage: P = Permutations(4)
+                sage: P.simple_reflection(1) * Permutation([6,5,4,3,2,1])
+                [5, 6, 4, 3, 2, 1]
+            """
+            if (not isinstance(other, StandardPermutations_n.Element)
+                or self.parent() != other.parent()):
+                return Permutation.__mul__(self, other)
+            return self._mul_(other)
+
+        def _mul_(self, other):
+            r"""
+            Multiply ``self`` and ``other``.
+
+            EXAMPLES::
+
+                sage: P = Permutations(4)
+                sage: P.prod(P.gens()).parent() is P
+                True
+            """
+            p = list(Permutation.__mul__(self, other))
+            return self.__class__(self.parent(), p)
```

or someone else will have to vow for its correctness.



---

archive/issue_comments_220412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-18T16:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220412",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220413.json:
```json
{
    "body": "Not done yet (symgp_conjugacy_class.py remains), but there are some things I don't get about this that I'd prefer to have answered before I go on.\n\n- The _mul_ issue, as above.\n\n- The meaning of the index_set parameter: is it just there to allow building the symmetric group algebra with different basis keys?\n\n- _coerce_map_from_ claims that there exists a coercion from `SymmetricGroup(3).algebra(QQ)` to `SymmetricGroupAlgebra(QQ, 3)`, but applying this coercion to elements fails. This is because `StandardPermutations_n_abstract.__call__` does not take a permutation group element as a parameter. I am not sure what to do about it, since I wouldn't be happy with duck-typing in that constructor.\n\n- Various methods don't work for `SymmetricGroup(3).algebra(QQ)`, and the fix is not as simple as adding `index_set=self.basis().keys()`.",
    "created_at": "2015-02-18T16:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220413",
    "user": "darij"
}
```

Not done yet (symgp_conjugacy_class.py remains), but there are some things I don't get about this that I'd prefer to have answered before I go on.

- The _mul_ issue, as above.

- The meaning of the index_set parameter: is it just there to allow building the symmetric group algebra with different basis keys?

- _coerce_map_from_ claims that there exists a coercion from `SymmetricGroup(3).algebra(QQ)` to `SymmetricGroupAlgebra(QQ, 3)`, but applying this coercion to elements fails. This is because `StandardPermutations_n_abstract.__call__` does not take a permutation group element as a parameter. I am not sure what to do about it, since I wouldn't be happy with duck-typing in that constructor.

- Various methods don't work for `SymmetricGroup(3).algebra(QQ)`, and the fix is not as simple as adding `index_set=self.basis().keys()`.



---

archive/issue_comments_220414.json:
```json
{
    "body": "I am implementing a coercion map from `SymmetricGroup` to `Permutations(n)`, and I need #17981 since I am having `_coerce_map_from_` return a lambda function representing the coercion map. Changes coming shortly.",
    "created_at": "2015-03-17T21:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220414",
    "user": "tscrim"
}
```

I am implementing a coercion map from `SymmetricGroup` to `Permutations(n)`, and I need #17981 since I am having `_coerce_map_from_` return a lambda function representing the coercion map. Changes coming shortly.



---

archive/issue_comments_220415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-17T22:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220415",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-18T05:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220416",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220417.json:
```json
{
    "body": "So the coercion now worked with my changes to having a coercion from the indexing sets, but a bunch of methods were broken using `SymmetricGroup(n)`. I've fixed this by casting the elements into a `Permutations(n)` element (essentially a `Permutation` instance), which may not be the fastest for elements of `SymmetricGroup(n)`, but it works and generalized (when there is a conversion) and is still very fast for elements of `Permutations(n)`. However, IMO other indexing sets (such as with a `WeylGroup`) can wait for later since they just use the general `GroupAlgebra` class.",
    "created_at": "2015-03-18T05:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220417",
    "user": "tscrim"
}
```

So the coercion now worked with my changes to having a coercion from the indexing sets, but a bunch of methods were broken using `SymmetricGroup(n)`. I've fixed this by casting the elements into a `Permutations(n)` element (essentially a `Permutation` instance), which may not be the fastest for elements of `SymmetricGroup(n)`, but it works and generalized (when there is a conversion) and is still very fast for elements of `Permutations(n)`. However, IMO other indexing sets (such as with a `WeylGroup`) can wait for later since they just use the general `GroupAlgebra` class.



---

archive/issue_comments_220418.json:
```json
{
    "body": "Should not algebra_generators return a Family instead of a list ?",
    "created_at": "2015-03-18T17:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220418",
    "user": "virmaux"
}
```

Should not algebra_generators return a Family instead of a list ?



---

archive/issue_comments_220419.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-18T18:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220419",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220420.json:
```json
{
    "body": "Replying to [comment:36 virmaux]:\n> Should not algebra_generators return a Family instead of a list ?\n\nAlthough this was the current implementation, I think this is a good as time as any to make this change. Ducktyping and how `Family` works means this shouldn't break anyone's code.",
    "created_at": "2015-03-18T18:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220420",
    "user": "tscrim"
}
```

Replying to [comment:36 virmaux]:
> Should not algebra_generators return a Family instead of a list ?

Although this was the current implementation, I think this is a good as time as any to make this change. Ducktyping and how `Family` works means this shouldn't break anyone's code.



---

archive/issue_comments_220421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T05:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220421",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220422.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T06:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220422",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T06:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220423",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T06:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220424",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220425.json:
```json
{
    "body": "I'm done reviewing the functionality of this patch -- it is a good step forward, although I wish it would address the problem in a more systematic way (e.g., using `AlgebraWithRealizations` to put the different bases and indexing sets for the symmetric group algebra on equal footing, and also to get rid of the accursed `mult` global variable). It doesn't introduce any new technical debt, though, that's for sure, and it cleans up some of the existing.\n\nOn the other hand, I cannot promise that this branch causes no speed regressions. Someone who is better at this might want to check this. To me it seems that it slows down the product of two `Permutations(n)` elements by 50% (refining its parent, though), slows down `retract_okounkov_vershik` on symmetric group algebra elements by a bit, and speeds up `left_action_product` on a symmetric group algebra noticeably.",
    "created_at": "2015-03-19T07:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220425",
    "user": "darij"
}
```

I'm done reviewing the functionality of this patch -- it is a good step forward, although I wish it would address the problem in a more systematic way (e.g., using `AlgebraWithRealizations` to put the different bases and indexing sets for the symmetric group algebra on equal footing, and also to get rid of the accursed `mult` global variable). It doesn't introduce any new technical debt, though, that's for sure, and it cleans up some of the existing.

On the other hand, I cannot promise that this branch causes no speed regressions. Someone who is better at this might want to check this. To me it seems that it slows down the product of two `Permutations(n)` elements by 50% (refining its parent, though), slows down `retract_okounkov_vershik` on symmetric group algebra elements by a bit, and speeds up `left_action_product` on a symmetric group algebra noticeably.



---

archive/issue_comments_220426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T19:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220427.json:
```json
{
    "body": "I've made some tweaks to the permutations multiplication, which significantly drops the number of function calls according to `%prun`, as well as cythonizing it. Here's my timings:\n\n```\nsage: P = Permutations(5)\nsage: x = P.random_element()\nsage: y = P.random_element()\nsage: %timeit x*y\n10000 loops, best of 3: 61.2 \u00b5s per loop\nsage: P = Permutations(100)\nsage: x = P.random_element()\nsage: y = P.random_element()\nsage: %timeit x*y\n1000 loops, best of 3: 167 \u00b5s per loop\n```\n\nBefore:\n\n```\nsage: %timeit x*y\n10000 loops, best of 3: 87.3 \u00b5s per loop\nsage: %timeit x*y\n1000 loops, best of 3: 210 \u00b5s per loop\n```\n\nI don't care so much on `retract_okounkov_vershik`, but since you say its a very minor regression, I'm not going to consider it (in fact, it might be faster now with faster multiplication). Here's some timings of `left_action_product`:\n\n```\nsage: P = Permutations(5)\nsage: x = P.random_element()\nsage: Q = Permutations(100)\nsage: y = Q.random_element()\nsage: %timeit x*y\n1000 loops, best of 3: 300 \u00b5s per loop\nsage: %timeit x.left_action_product(y)\n10000 loops, best of 3: 167 \u00b5s per loop\n```\n\nBefore:\n\n```\nsage: %timeit x*y\n1000 loops, best of 3: 225 \u00b5s per loop\nsage: %timeit x.left_action_product(y)\n1000 loops, best of 3: 212 \u00b5s per loop\n```\n\nSo there's ~20% slowdown when multiplying different parents, which surprises me somewhat. Let me see if I can fix that for a few minutes...",
    "created_at": "2015-03-19T19:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220427",
    "user": "tscrim"
}
```

I've made some tweaks to the permutations multiplication, which significantly drops the number of function calls according to `%prun`, as well as cythonizing it. Here's my timings:

```
sage: P = Permutations(5)
sage: x = P.random_element()
sage: y = P.random_element()
sage: %timeit x*y
10000 loops, best of 3: 61.2 µs per loop
sage: P = Permutations(100)
sage: x = P.random_element()
sage: y = P.random_element()
sage: %timeit x*y
1000 loops, best of 3: 167 µs per loop
```

Before:

```
sage: %timeit x*y
10000 loops, best of 3: 87.3 µs per loop
sage: %timeit x*y
1000 loops, best of 3: 210 µs per loop
```

I don't care so much on `retract_okounkov_vershik`, but since you say its a very minor regression, I'm not going to consider it (in fact, it might be faster now with faster multiplication). Here's some timings of `left_action_product`:

```
sage: P = Permutations(5)
sage: x = P.random_element()
sage: Q = Permutations(100)
sage: y = Q.random_element()
sage: %timeit x*y
1000 loops, best of 3: 300 µs per loop
sage: %timeit x.left_action_product(y)
10000 loops, best of 3: 167 µs per loop
```

Before:

```
sage: %timeit x*y
1000 loops, best of 3: 225 µs per loop
sage: %timeit x.left_action_product(y)
1000 loops, best of 3: 212 µs per loop
```

So there's ~20% slowdown when multiplying different parents, which surprises me somewhat. Let me see if I can fix that for a few minutes...



---

archive/issue_comments_220428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T19:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220429.json:
```json
{
    "body": "Boom:\n\n```\nsage: P = Permutations(5)\nsage: x = P.random_element()\nsage: Q = Permutations(100)\nsage: y = Q.random_element()\nsage: %timeit x*y\n1000 loops, best of 3: 195 \u00b5s per loop\n```\n\nSo that should take care of speed regressions (at least any that I care about). So if you're happy with my changes, then let's get this in.",
    "created_at": "2015-03-19T19:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220429",
    "user": "tscrim"
}
```

Boom:

```
sage: P = Permutations(5)
sage: x = P.random_element()
sage: Q = Permutations(100)
sage: y = Q.random_element()
sage: %timeit x*y
1000 loops, best of 3: 195 µs per loop
```

So that should take care of speed regressions (at least any that I care about). So if you're happy with my changes, then let's get this in.



---

archive/issue_comments_220430.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T21:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220430",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T22:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220431",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T23:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220432",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220433.json:
```json
{
    "body": "Hi,\n\nI have been through the code, and discussed it with Darij and Travis. Please check the above commits; if you are happy with them, this can be positive review, assuming the patchbot goes green.\n\nThanks Travis and Darij for all the work!",
    "created_at": "2015-03-19T23:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220433",
    "user": "nthiery"
}
```

Hi,

I have been through the code, and discussed it with Darij and Travis. Please check the above commits; if you are happy with them, this can be positive review, assuming the patchbot goes green.

Thanks Travis and Darij for all the work!



---

archive/issue_comments_220434.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-19T23:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220434",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T03:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220435",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T04:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220436",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-20T05:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220437",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220438.json:
```json
{
    "body": "We looked over my latest commits with Travis, and he is fine with them (up to little things we fixed). This is good to go, assuming the patchbot goes green.\n----\nNew commits:",
    "created_at": "2015-03-20T05:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220438",
    "user": "nthiery"
}
```

We looked over my latest commits with Travis, and he is fine with them (up to little things we fixed). This is good to go, assuming the patchbot goes green.
----
New commits:



---

archive/issue_comments_220439.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-03-20T05:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220439",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_220440.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-03-20T05:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220440",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_220441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T05:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220441",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220442.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-20T05:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220442",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220443.json:
```json
{
    "body": "I proofread Darij's changes, and implemented the suggestion from his warning; Travis proofread my proofreading. Back to positive review.",
    "created_at": "2015-03-20T05:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220443",
    "user": "nthiery"
}
```

I proofread Darij's changes, and implemented the suggestion from his warning; Travis proofread my proofreading. Back to positive review.



---

archive/issue_comments_220444.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-03-20T05:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220444",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_220445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-03-20T05:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220445",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_220446.json:
```json
{
    "body": "LGTM. Darij, are you going to do the (quick) review of #17981?",
    "created_at": "2015-03-20T05:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220446",
    "user": "tscrim"
}
```

LGTM. Darij, are you going to do the (quick) review of #17981?



---

archive/issue_comments_220447.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-20T05:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220447",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220448.json:
```json
{
    "body": "Changing keywords from \"\" to \"days64\".",
    "created_at": "2015-03-20T05:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220448",
    "user": "tscrim"
}
```

Changing keywords from "" to "days64".



---

archive/issue_comments_220449.json:
```json
{
    "body": "Thanks, Travis!",
    "created_at": "2015-03-20T05:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220449",
    "user": "darij"
}
```

Thanks, Travis!



---

archive/issue_comments_220450.json:
```json
{
    "body": "Doctest failures",
    "created_at": "2015-03-20T19:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220450",
    "user": "vbraun"
}
```

Doctest failures



---

archive/issue_comments_220451.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-03-20T19:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220451",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_220452.json:
```json
{
    "body": "Could you tell us where you got the failures? (There might also be an issue with us testing this on beta5.)",
    "created_at": "2015-03-20T20:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220452",
    "user": "tscrim"
}
```

Could you tell us where you got the failures? (There might also be an issue with us testing this on beta5.)



---

archive/issue_comments_220453.json:
```json
{
    "body": "The doctests haven't finished yet, but I already get these:\n\n\n```\nFile \"src/sage/combinat/backtrack.py\", line 867, in sage.combinat.backtrack.TransitiveIdeal\nFailed example:\n    [p for p in TransitiveIdeal(attrcall(\"permutohedron_succ\"), [Permutation([1,2,3])])]\nExpected:\n    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 2, 1], [3, 1, 2]]\nGot:\n    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 1, 2], [3, 2, 1]]\n**********************************************************************\nFile \"src/sage/combinat/backtrack.py\", line 873, in sage.combinat.backtrack.TransitiveIdeal\nFailed example:\n    [p for p in TransitiveIdeal(attrcall(\"permutohedron_succ\"), [Permutation([3,1,2,4]), Permutation([2,1,3,4])])]\nExpected:\n    [[2, 1, 3, 4], [2, 1, 4, 3], [2, 4, 1, 3], [4, 2, 1, 3], [4, 2, 3, 1], [4, 3, 2, 1], [3, 1, 2, 4], [2, 4, 3, 1], [3, 2, 1, 4], [2, 3, 1, 4], [2, 3, 4, 1], [3, 2, 4, 1], [3, 1, 4, 2], [3, 4, 2, 1], [3, 4, 1, 2], [4, 3, 1, 2]]\nGot:\n    [[2, 1, 3, 4],\n     [3, 1, 2, 4],\n     [2, 1, 4, 3],\n     [3, 1, 4, 2],\n     [2, 3, 1, 4],\n     [3, 4, 1, 2],\n     [3, 4, 2, 1],\n     [2, 3, 4, 1],\n     [2, 4, 1, 3],\n     [3, 2, 1, 4],\n     [4, 3, 1, 2],\n     [4, 3, 2, 1],\n     [3, 2, 4, 1],\n     [4, 2, 1, 3],\n     [2, 4, 3, 1],\n     [4, 2, 3, 1]]\n**********************************************************************\nFile \"src/sage/combinat/backtrack.py\", line 989, in sage.combinat.backtrack.TransitiveIdealGraded\nFailed example:\n    [p for p in TransitiveIdealGraded(attrcall(\"permutohedron_succ\"), [Permutation([3,1,2,4]), Permutation([2,1,3,4])])]\nExpected:\n    [[3, 1, 2, 4], [2, 1, 3, 4], [2, 1, 4, 3], [3, 2, 1, 4], [2, 3, 1, 4], [3, 1, 4, 2], [2, 3, 4, 1], [3, 4, 1, 2], [3, 2, 4, 1], [2, 4, 1, 3], [2, 4, 3, 1], [4, 3, 1, 2], [4, 2, 1, 3], [3, 4, 2, 1], [4, 2, 3, 1], [4, 3, 2, 1]]\nGot:\n    [[3, 1, 2, 4],\n     [2, 1, 3, 4],\n     [2, 3, 1, 4],\n     [2, 1, 4, 3],\n     [3, 2, 1, 4],\n     [3, 1, 4, 2],\n     [3, 2, 4, 1],\n     [2, 4, 1, 3],\n     [3, 4, 1, 2],\n     [2, 3, 4, 1],\n     [4, 3, 1, 2],\n     [3, 4, 2, 1],\n     [4, 2, 1, 3],\n     [2, 4, 3, 1],\n     [4, 3, 2, 1],\n     [4, 2, 3, 1]]\n**********************************************************************\n2 items had failures:\n   2 of  16 in sage.combinat.backtrack.TransitiveIdeal\n   1 of   8 in sage.combinat.backtrack.TransitiveIdealGraded\n    [176 tests, 3 failures, 102.22 s]\n```\n",
    "created_at": "2015-03-20T20:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220453",
    "user": "jkeitel"
}
```

The doctests haven't finished yet, but I already get these:


```
File "src/sage/combinat/backtrack.py", line 867, in sage.combinat.backtrack.TransitiveIdeal
Failed example:
    [p for p in TransitiveIdeal(attrcall("permutohedron_succ"), [Permutation([1,2,3])])]
Expected:
    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 2, 1], [3, 1, 2]]
Got:
    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 1, 2], [3, 2, 1]]
**********************************************************************
File "src/sage/combinat/backtrack.py", line 873, in sage.combinat.backtrack.TransitiveIdeal
Failed example:
    [p for p in TransitiveIdeal(attrcall("permutohedron_succ"), [Permutation([3,1,2,4]), Permutation([2,1,3,4])])]
Expected:
    [[2, 1, 3, 4], [2, 1, 4, 3], [2, 4, 1, 3], [4, 2, 1, 3], [4, 2, 3, 1], [4, 3, 2, 1], [3, 1, 2, 4], [2, 4, 3, 1], [3, 2, 1, 4], [2, 3, 1, 4], [2, 3, 4, 1], [3, 2, 4, 1], [3, 1, 4, 2], [3, 4, 2, 1], [3, 4, 1, 2], [4, 3, 1, 2]]
Got:
    [[2, 1, 3, 4],
     [3, 1, 2, 4],
     [2, 1, 4, 3],
     [3, 1, 4, 2],
     [2, 3, 1, 4],
     [3, 4, 1, 2],
     [3, 4, 2, 1],
     [2, 3, 4, 1],
     [2, 4, 1, 3],
     [3, 2, 1, 4],
     [4, 3, 1, 2],
     [4, 3, 2, 1],
     [3, 2, 4, 1],
     [4, 2, 1, 3],
     [2, 4, 3, 1],
     [4, 2, 3, 1]]
**********************************************************************
File "src/sage/combinat/backtrack.py", line 989, in sage.combinat.backtrack.TransitiveIdealGraded
Failed example:
    [p for p in TransitiveIdealGraded(attrcall("permutohedron_succ"), [Permutation([3,1,2,4]), Permutation([2,1,3,4])])]
Expected:
    [[3, 1, 2, 4], [2, 1, 3, 4], [2, 1, 4, 3], [3, 2, 1, 4], [2, 3, 1, 4], [3, 1, 4, 2], [2, 3, 4, 1], [3, 4, 1, 2], [3, 2, 4, 1], [2, 4, 1, 3], [2, 4, 3, 1], [4, 3, 1, 2], [4, 2, 1, 3], [3, 4, 2, 1], [4, 2, 3, 1], [4, 3, 2, 1]]
Got:
    [[3, 1, 2, 4],
     [2, 1, 3, 4],
     [2, 3, 1, 4],
     [2, 1, 4, 3],
     [3, 2, 1, 4],
     [3, 1, 4, 2],
     [3, 2, 4, 1],
     [2, 4, 1, 3],
     [3, 4, 1, 2],
     [2, 3, 4, 1],
     [4, 3, 1, 2],
     [3, 4, 2, 1],
     [4, 2, 1, 3],
     [2, 4, 3, 1],
     [4, 3, 2, 1],
     [4, 2, 3, 1]]
**********************************************************************
2 items had failures:
   2 of  16 in sage.combinat.backtrack.TransitiveIdeal
   1 of   8 in sage.combinat.backtrack.TransitiveIdealGraded
    [176 tests, 3 failures, 102.22 s]
```




---

archive/issue_comments_220454.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T21:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220454",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220455.json:
```json
{
    "body": "Fixed; those which came from the ordering of `Permutations` iterator changed because I am now using `itertools.permutations`. Also there were some failures in the `Groups()` category from an old warning message that I removed. Nicolas and/or Darij, do you agree with my changes?",
    "created_at": "2015-03-20T21:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220455",
    "user": "tscrim"
}
```

Fixed; those which came from the ordering of `Permutations` iterator changed because I am now using `itertools.permutations`. Also there were some failures in the `Groups()` category from an old warning message that I removed. Nicolas and/or Darij, do you agree with my changes?



---

archive/issue_comments_220456.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-20T21:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220456",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220457.json:
```json
{
    "body": "I agree. Thank you!",
    "created_at": "2015-03-20T21:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220457",
    "user": "darij"
}
```

I agree. Thank you!



---

archive/issue_comments_220458.json:
```json
{
    "body": "I'm taking that as a back to `positive_review`.",
    "created_at": "2015-03-20T21:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220458",
    "user": "tscrim"
}
```

I'm taking that as a back to `positive_review`.



---

archive/issue_comments_220459.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-20T21:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220459",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220460.json:
```json
{
    "body": "Similarly:\n\n```\nsage -t --long --warn-long 46.4 src/sage/sets/recursively_enumerated_set.pyx\n**********************************************************************\nFile \"src/sage/sets/recursively_enumerated_set.pyx\", line 116, in sage.sets.recursively_enumerated_set\nFailed example:\n    list(R.elements_of_depth_iterator(9))\nExpected:\n    [[5, 4, 2, 3, 1], [4, 5, 3, 2, 1], [5, 3, 4, 2, 1], [5, 4, 3, 1, 2]]\nGot:\n    [[5, 3, 4, 2, 1], [4, 5, 3, 2, 1], [5, 4, 2, 3, 1], [5, 4, 3, 1, 2]]\n**********************************************************************\nFile \"src/sage/sets/recursively_enumerated_set.pyx\", line 802, in sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_generic.naive_search_iterator\nFailed example:\n    list(R.naive_search_iterator())\nExpected:\n    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 2, 1], [3, 1, 2]]\nGot:\n    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 1, 2], [3, 2, 1]]\n**********************************************************************\n2 items had failures:\n   1 of  41 in sage.sets.recursively_enumerated_set\n   1 of   5 in sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_generic.naive_search_iterator\n    [193 tests, 2 failures, 0.76 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 46.4 src/sage/sets/recursively_enumerated_set.pyx  # 2 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2015-03-20T21:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220460",
    "user": "jhpalmieri"
}
```

Similarly:

```
sage -t --long --warn-long 46.4 src/sage/sets/recursively_enumerated_set.pyx
**********************************************************************
File "src/sage/sets/recursively_enumerated_set.pyx", line 116, in sage.sets.recursively_enumerated_set
Failed example:
    list(R.elements_of_depth_iterator(9))
Expected:
    [[5, 4, 2, 3, 1], [4, 5, 3, 2, 1], [5, 3, 4, 2, 1], [5, 4, 3, 1, 2]]
Got:
    [[5, 3, 4, 2, 1], [4, 5, 3, 2, 1], [5, 4, 2, 3, 1], [5, 4, 3, 1, 2]]
**********************************************************************
File "src/sage/sets/recursively_enumerated_set.pyx", line 802, in sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_generic.naive_search_iterator
Failed example:
    list(R.naive_search_iterator())
Expected:
    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 2, 1], [3, 1, 2]]
Got:
    [[1, 2, 3], [2, 1, 3], [1, 3, 2], [2, 3, 1], [3, 1, 2], [3, 2, 1]]
**********************************************************************
2 items had failures:
   1 of  41 in sage.sets.recursively_enumerated_set
   1 of   5 in sage.sets.recursively_enumerated_set.RecursivelyEnumeratedSet_generic.naive_search_iterator
    [193 tests, 2 failures, 0.76 s]
----------------------------------------------------------------------
sage -t --long --warn-long 46.4 src/sage/sets/recursively_enumerated_set.pyx  # 2 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_220461.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-03-20T21:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220461",
    "user": "jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_220462.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-20T22:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220462",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220463.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-03-20T22:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220463",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_220464.json:
```json
{
    "body": "Hopefully that's all of them...",
    "created_at": "2015-03-20T22:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220464",
    "user": "tscrim"
}
```

Hopefully that's all of them...



---

archive/issue_comments_220465.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2015-03-20T23:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220465",
    "user": "nthiery"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_220466.json:
```json
{
    "body": "Hey,\n\nSorry, before this goes in I'd like to double check with you for which object we changed the enumeration order. I am in the hangout room on the 3rd floor.\n\nThanks!\n                                  Cheers,",
    "created_at": "2015-03-20T23:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220466",
    "user": "nthiery"
}
```

Hey,

Sorry, before this goes in I'd like to double check with you for which object we changed the enumeration order. I am in the hangout room on the 3rd floor.

Thanks!
                                  Cheers,



---

archive/issue_comments_220467.json:
```json
{
    "body": "The change in ordering in these tests was due to the hash changing for the permutations of `n`. The hash changed because the parent changed in the sense that it has a much longer MRO due to the change in its category. However the actual iteration of `Permutations(n)` has not changed (by lex ordering), so we (Darij, Nicolas, and I) are okay with this.",
    "created_at": "2015-03-20T23:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220467",
    "user": "tscrim"
}
```

The change in ordering in these tests was due to the hash changing for the permutations of `n`. The hash changed because the parent changed in the sense that it has a much longer MRO due to the change in its category. However the actual iteration of `Permutations(n)` has not changed (by lex ordering), so we (Darij, Nicolas, and I) are okay with this.



---

archive/issue_comments_220468.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2015-03-20T23:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220468",
    "user": "tscrim"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_220469.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-21T12:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16689#issuecomment-220469",
    "user": "vbraun"
}
```

Resolution: fixed
