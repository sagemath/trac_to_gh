# Issue 17713: make modular_decomposition an optional spkg

archive/issues_017713.json:
```json
{
    "body": "CC:  @dcoudert @jdemeyer\n\nThe code on which Sage relies to compute modular decompositions has been displaying a stopgap for a while. It seems that the problem has been fixed with an update, but it seems to be architecture-dependent (see #13744).\n\nThis branch puts some distance between Sage and this code: its source code had been copy/pasted into Sage's source code (I did that), and this is far from being clean. Thus, we turn this into an optional spkg.\n\nAn interesting consequence of this move is that we will (at least) be able to use the updated version of the code on platforms for which it work. It will also make it easier to install and test on other architectures. It also means that we stop shipping in our own source code a program which has proved to be unreliable at times.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/17950\n\n",
    "created_at": "2015-03-13T19:54:44Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "make modular_decomposition an optional spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17713",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @dcoudert @jdemeyer

The code on which Sage relies to compute modular decompositions has been displaying a stopgap for a while. It seems that the problem has been fixed with an update, but it seems to be architecture-dependent (see #13744).

This branch puts some distance between Sage and this code: its source code had been copy/pasted into Sage's source code (I did that), and this is far from being clean. Thus, we turn this into an optional spkg.

An interesting consequence of this move is that we will (at least) be able to use the updated version of the code on platforms for which it work. It will also make it easier to install and test on other architectures. It also means that we stop shipping in our own source code a program which has proved to be unreliable at times.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/17950





---

archive/issue_comments_236532.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-13T19:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236532",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_236533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-13T19:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236534.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-13T20:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_236535.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-03-14T14:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236535",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_236536.json:
```json
{
    "body": "What should I do to compile it?\n\n```\nconfetti:sage dcoudert$ git trac checkout 17950\nLoading ticket #17950...\nChecking out Trac #17950 remote branch public/17950 -> local branch t/17950/public/17950...\n\nconfetti:sage dcoudert$ ./sage -b\nscons: `install' is up to date.\nUpdating Cython code....\nEnabling Cython debugging support\nCompiling sage/graphs/modular_decomposition.pyx because it changed.\nCythonizing sage/graphs/modular_decomposition.pyx\nFinished Cythonizing, time: 4.56 seconds.\nDiscovering Python source code....\nDiscovered Python source, time: 0.03 seconds.\nCleaning up stale installed files....\n- cleaning /Users/dcoudert/sage/local/lib/python2.7/site-packages\nCleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/__init__.pyc\nCleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/__init__.py\nCleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/modular_decomposition.so\n- cleaning /Users/dcoudert/sage/local/lib/site-python\n- cleaning /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7\nCleaning up stale file: /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7/sage/graphs/modular_decomposition/__init__.py\nCleaning up stale file: /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7/sage/graphs/modular_decomposition/modular_decomposition.so\nFinished cleaning, time: 0.11 seconds.\nrunning install\nrunning build\nrunning build_py\ncopying sage/graphs/all.py -> build/lib.macosx-10.9-x86_64-2.7/sage/graphs\ncopying sage/graphs/graph.py -> build/lib.macosx-10.9-x86_64-2.7/sage/graphs\nrunning build_ext\nbuilding 'sage.graphs.modular_decomposition' extension\nExecuting 1 command (using 1 thread)\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/dcoudert/sage/local/include -I/Users/dcoudert/sage/src -I/Users/dcoudert/sage/src/c_lib/include -I/Users/dcoudert/sage/src/sage/ext -I/Users/dcoudert/sage/local/include/python2.7 -c build/cythonized/sage/graphs/modular_decomposition.c -o build/temp.macosx-10.9-x86_64-2.7/build/cythonized/sage/graphs/modular_decomposition.o -fno-strict-aliasing -w\nbuild/cythonized/sage/graphs/modular_decomposition.c:289:35: fatal error: modular_decomposition.h: No such file or directory\n #include \"modular_decomposition.h\"\n                                   ^\ncompilation terminated.\nerror: command 'gcc' failed with exit status 1\n```",
    "created_at": "2015-03-14T14:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236536",
    "user": "https://github.com/dcoudert"
}
```

What should I do to compile it?

```
confetti:sage dcoudert$ git trac checkout 17950
Loading ticket #17950...
Checking out Trac #17950 remote branch public/17950 -> local branch t/17950/public/17950...

confetti:sage dcoudert$ ./sage -b
scons: `install' is up to date.
Updating Cython code....
Enabling Cython debugging support
Compiling sage/graphs/modular_decomposition.pyx because it changed.
Cythonizing sage/graphs/modular_decomposition.pyx
Finished Cythonizing, time: 4.56 seconds.
Discovering Python source code....
Discovered Python source, time: 0.03 seconds.
Cleaning up stale installed files....
- cleaning /Users/dcoudert/sage/local/lib/python2.7/site-packages
Cleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/__init__.pyc
Cleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/__init__.py
Cleaning up stale file: /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/modular_decomposition/modular_decomposition.so
- cleaning /Users/dcoudert/sage/local/lib/site-python
- cleaning /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7
Cleaning up stale file: /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7/sage/graphs/modular_decomposition/__init__.py
Cleaning up stale file: /Users/dcoudert/sage/src/build/lib.macosx-10.9-x86_64-2.7/sage/graphs/modular_decomposition/modular_decomposition.so
Finished cleaning, time: 0.11 seconds.
running install
running build
running build_py
copying sage/graphs/all.py -> build/lib.macosx-10.9-x86_64-2.7/sage/graphs
copying sage/graphs/graph.py -> build/lib.macosx-10.9-x86_64-2.7/sage/graphs
running build_ext
building 'sage.graphs.modular_decomposition' extension
Executing 1 command (using 1 thread)
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/dcoudert/sage/local/include -I/Users/dcoudert/sage/src -I/Users/dcoudert/sage/src/c_lib/include -I/Users/dcoudert/sage/src/sage/ext -I/Users/dcoudert/sage/local/include/python2.7 -c build/cythonized/sage/graphs/modular_decomposition.c -o build/temp.macosx-10.9-x86_64-2.7/build/cythonized/sage/graphs/modular_decomposition.o -fno-strict-aliasing -w
build/cythonized/sage/graphs/modular_decomposition.c:289:35: fatal error: modular_decomposition.h: No such file or directory
 #include "modular_decomposition.h"
                                   ^
compilation terminated.
error: command 'gcc' failed with exit status 1
```



---

archive/issue_comments_236537.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-03-14T16:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236537",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_236538.json:
```json
{
    "body": "> What should I do to compile it?\n\n\nMy mistake. There is something I forgot to do, and unless I do it one cannot compile Sage without installing the new package. I just added a commit.\n\nWith this commit, should compile correctly. You will *not* be able to call `.modular_decomposition` as it should ask you to install a package first.\n\nIn order to install the package, copy the .tar.bz2 file (whose link appears in this ticket's description) into your upstream/ folder. Then, you will be able to run `sage -i modular_decomposition` and everything should be alright.\n\nNathann",
    "created_at": "2015-03-14T16:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236538",
    "user": "https://github.com/nathanncohen"
}
```

> What should I do to compile it?


My mistake. There is something I forgot to do, and unless I do it one cannot compile Sage without installing the new package. I just added a commit.

With this commit, should compile correctly. You will *not* be able to call `.modular_decomposition` as it should ask you to install a package first.

In order to install the package, copy the .tar.bz2 file (whose link appears in this ticket's description) into your upstream/ folder. Then, you will be able to run `sage -i modular_decomposition` and everything should be alright.

Nathann



---

archive/issue_comments_236539.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-14T16:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236540.json:
```json
{
    "body": "That's apparently not enough.\n\n```\nOops, Sage crashed. We do our best to make it stable, but...\n```\n\nand at the end of the `Sage_crash_report.txt` we have:\n\n```\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/all.py in <module>()\n      5 lazy_import(\"sage.graphs.hypergraph_generators\", \"hypergraphs\")\n      6 from graph_database import GraphDatabase, GenericGraphQuery, GraphQuery\n      7 from graph import Graph\n      8 from digraph import DiGraph\n      9 from bipartite_graph import BipartiteGraph\n     10 from graph_bundle import GraphBundle\n     11 import weakly_chordal\n     12 import graph_list as graphs_list\n     13 import sage.graphs.generic_graph_pyx\n     14 import sage.graphs.generic_graph\n     15 import sage.graphs.graph_decompositions\n     16 import sage.graphs.graph\n     17 import sage.graphs.digraph\n     18 lazy_import(\"sage.graphs\", \"graph_coloring\")\n     19 import sage.graphs.graph_decompositions\n---> 20 import sage.graphs.modular_decomposition\n        global sage.graphs.modular_decomposition = undefined\n     21 import sage.graphs.comparability\n     22 from sage.graphs.cliquer import *\n     23 from graph_database import graph_db_info\n     24 lazy_import(\"sage.graphs.graph_editor\", \"graph_editor\")\n     25 \n     26 import sage.graphs.isgci\n     27 from sage.graphs.isgci import graph_classes\n     28 import sage.graphs.distances_all_pairs\n     29 import sage.graphs.trees\n     30 import sage.graphs.graph_latex\n\nImportError: No module named modular_decomposition\n\n***************************************************************************\n\nHistory of session input:\n*** Last line of input (may not be in above history):\n```",
    "created_at": "2015-03-14T17:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236540",
    "user": "https://github.com/dcoudert"
}
```

That's apparently not enough.

```
Oops, Sage crashed. We do our best to make it stable, but...
```

and at the end of the `Sage_crash_report.txt` we have:

```
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/all.py in <module>()
      5 lazy_import("sage.graphs.hypergraph_generators", "hypergraphs")
      6 from graph_database import GraphDatabase, GenericGraphQuery, GraphQuery
      7 from graph import Graph
      8 from digraph import DiGraph
      9 from bipartite_graph import BipartiteGraph
     10 from graph_bundle import GraphBundle
     11 import weakly_chordal
     12 import graph_list as graphs_list
     13 import sage.graphs.generic_graph_pyx
     14 import sage.graphs.generic_graph
     15 import sage.graphs.graph_decompositions
     16 import sage.graphs.graph
     17 import sage.graphs.digraph
     18 lazy_import("sage.graphs", "graph_coloring")
     19 import sage.graphs.graph_decompositions
---> 20 import sage.graphs.modular_decomposition
        global sage.graphs.modular_decomposition = undefined
     21 import sage.graphs.comparability
     22 from sage.graphs.cliquer import *
     23 from graph_database import graph_db_info
     24 lazy_import("sage.graphs.graph_editor", "graph_editor")
     25 
     26 import sage.graphs.isgci
     27 from sage.graphs.isgci import graph_classes
     28 import sage.graphs.distances_all_pairs
     29 import sage.graphs.trees
     30 import sage.graphs.graph_latex

ImportError: No module named modular_decomposition

***************************************************************************

History of session input:
*** Last line of input (may not be in above history):
```



---

archive/issue_comments_236541.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-14T17:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236542.json:
```json
{
    "body": "True. This bug does not happen on my computer as `modular_decomposition` is installed. I just fixed it.\n\nNathann",
    "created_at": "2015-03-14T17:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236542",
    "user": "https://github.com/nathanncohen"
}
```

True. This bug does not happen on my computer as `modular_decomposition` is installed. I just fixed it.

Nathann



---

archive/issue_comments_236543.json:
```json
{
    "body": "I can now start sage. We are making progress ;)\n\nBut, before trying to install the package, I did:\n\n```\n./sage -t src/sage/graphs/graph.py\n**********************************************************************\nFile \"src/sage/graphs/graph.py\", line 6505, in sage.graphs.graph.Graph.is_prime\nFailed example:\n    graphs.PetersenGraph().is_prime()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph.Graph.is_prime[0]>\", line 1, in <module>\n        graphs.PetersenGraph().is_prime()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6516, in is_prime\n        D = self.modular_decomposition()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6480, in modular_decomposition\n        raise RuntimeError(\"In order to use this method you must \"\n    RuntimeError: In order to use this method you must install the modular_decomposition package\n**********************************************************************\nFile \"src/sage/graphs/graph.py\", line 6507, in sage.graphs.graph.Graph.is_prime\nFailed example:\n    graphs.BullGraph().is_prime()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph.Graph.is_prime[1]>\", line 1, in <module>\n        graphs.BullGraph().is_prime()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6516, in is_prime\n        D = self.modular_decomposition()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6480, in modular_decomposition\n        raise RuntimeError(\"In order to use this method you must \"\n    RuntimeError: In order to use this method you must install the modular_decomposition package\n**********************************************************************\nFile \"src/sage/graphs/graph.py\", line 6512, in sage.graphs.graph.Graph.is_prime\nFailed example:\n    (graphs.PetersenGraph() + graphs.BullGraph()).is_prime()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 492, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 854, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph.Graph.is_prime[2]>\", line 1, in <module>\n        (graphs.PetersenGraph() + graphs.BullGraph()).is_prime()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6516, in is_prime\n        D = self.modular_decomposition()\n      File \"/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py\", line 6480, in modular_decomposition\n        raise RuntimeError(\"In order to use this method you must \"\n    RuntimeError: In order to use this method you must install the modular_decomposition package\n**********************************************************************\n1 item had failures:\n   3 of   4 in sage.graphs.graph.Graph.is_prime\n    [657 tests, 3 failures, 13.19 s]\n----------------------------------------------------------------------\nsage -t src/sage/graphs/graph.py  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 13.5 seconds\n    cpu time: 9.7 seconds\n    cumulative wall time: 13.2 seconds\n```",
    "created_at": "2015-03-14T17:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236543",
    "user": "https://github.com/dcoudert"
}
```

I can now start sage. We are making progress ;)

But, before trying to install the package, I did:

```
./sage -t src/sage/graphs/graph.py
**********************************************************************
File "src/sage/graphs/graph.py", line 6505, in sage.graphs.graph.Graph.is_prime
Failed example:
    graphs.PetersenGraph().is_prime()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph.Graph.is_prime[0]>", line 1, in <module>
        graphs.PetersenGraph().is_prime()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6516, in is_prime
        D = self.modular_decomposition()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6480, in modular_decomposition
        raise RuntimeError("In order to use this method you must "
    RuntimeError: In order to use this method you must install the modular_decomposition package
**********************************************************************
File "src/sage/graphs/graph.py", line 6507, in sage.graphs.graph.Graph.is_prime
Failed example:
    graphs.BullGraph().is_prime()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph.Graph.is_prime[1]>", line 1, in <module>
        graphs.BullGraph().is_prime()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6516, in is_prime
        D = self.modular_decomposition()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6480, in modular_decomposition
        raise RuntimeError("In order to use this method you must "
    RuntimeError: In order to use this method you must install the modular_decomposition package
**********************************************************************
File "src/sage/graphs/graph.py", line 6512, in sage.graphs.graph.Graph.is_prime
Failed example:
    (graphs.PetersenGraph() + graphs.BullGraph()).is_prime()
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 492, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 854, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph.Graph.is_prime[2]>", line 1, in <module>
        (graphs.PetersenGraph() + graphs.BullGraph()).is_prime()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6516, in is_prime
        D = self.modular_decomposition()
      File "/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6480, in modular_decomposition
        raise RuntimeError("In order to use this method you must "
    RuntimeError: In order to use this method you must install the modular_decomposition package
**********************************************************************
1 item had failures:
   3 of   4 in sage.graphs.graph.Graph.is_prime
    [657 tests, 3 failures, 13.19 s]
----------------------------------------------------------------------
sage -t src/sage/graphs/graph.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 13.5 seconds
    cpu time: 9.7 seconds
    cumulative wall time: 13.2 seconds
```



---

archive/issue_comments_236544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-14T17:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236545.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-14T17:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_236546.json:
```json
{
    "body": "As I told you, we are making progress! I can now compile, start sage, pass all tests, etc. without installing the spkg.\n\nIn the online doc of the `modular_decomposition` method. After `Note: In order to use this method you must install the \"modular_decomposition\" optional package.`  you could add a `see blah blah blah`.\n\nI'm now trying to install the spkg. I'm able to compile but:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: G.modular_decomposition()\n/Users/dcoudert/sage/src/bin/sage-ipython:1:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\n('Prime', [2, 6, 3, 9, 7, 8, 0, 1, 5, 4])\nsage: G.is_prime()\nTrue\nsage: G.modular_decomposition()\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n./sage: line 134: 17334 Segmentation fault: 11  \"$SAGE_ROOT/src/bin/sage\" \"$@\"\n```",
    "created_at": "2015-03-14T17:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236546",
    "user": "https://github.com/dcoudert"
}
```

As I told you, we are making progress! I can now compile, start sage, pass all tests, etc. without installing the spkg.

In the online doc of the `modular_decomposition` method. After `Note: In order to use this method you must install the "modular_decomposition" optional package.`  you could add a `see blah blah blah`.

I'm now trying to install the spkg. I'm able to compile but:

```
sage: G = graphs.PetersenGraph()
sage: G.modular_decomposition()
/Users/dcoudert/sage/src/bin/sage-ipython:1:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
('Prime', [2, 6, 3, 9, 7, 8, 0, 1, 5, 4])
sage: G.is_prime()
True
sage: G.modular_decomposition()
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
./sage: line 134: 17334 Segmentation fault: 11  "$SAGE_ROOT/src/bin/sage" "$@"
```



---

archive/issue_comments_236547.json:
```json
{
    "body": "Hello,\n\n> In the online doc of the `modular_decomposition` method. After `Note: In order to use this method you must install the \"modular_decomposition\" optional package.`  you could add a `see blah blah blah`.\n\n\nDone.\n\n> I'm now trying to install the spkg. I'm able to compile but:\n\n\nI cannot reproduce this bug with your commands. Is it deterministic on your computer ?\n\nThis may be related to the reports from #13744. The original code itself seems to have problems, and my repeated reports changed nothing. This is part of the reason why I am trying to move this code away from Sage. Are you using a Mac computer ?\n\nNathann",
    "created_at": "2015-03-14T18:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236547",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> In the online doc of the `modular_decomposition` method. After `Note: In order to use this method you must install the "modular_decomposition" optional package.`  you could add a `see blah blah blah`.


Done.

> I'm now trying to install the spkg. I'm able to compile but:


I cannot reproduce this bug with your commands. Is it deterministic on your computer ?

This may be related to the reports from #13744. The original code itself seems to have problems, and my repeated reports changed nothing. This is part of the reason why I am trying to move this code away from Sage. Are you using a Mac computer ?

Nathann



---

archive/issue_comments_236548.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-14T18:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236549.json:
```json
{
    "body": "Yes I'm using a mac.\n\nI can reproduce the bug, but it's kind of random. Sometimes its working, sometimes not.\n\n```\nconfetti:sage dcoudert$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.6.beta5, Release Date: 2015-03-13                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: G = graphs.PetersenGraph()\nsage: G.modular_decomposition()\n/Users/dcoudert/sage/src/bin/sage-ipython:1:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n./sage: line 134: 17513 Segmentation fault: 11  \"$SAGE_ROOT/src/bin/sage\" \"$@\"\nconfetti:sage dcoudert$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.6.beta5, Release Date: 2015-03-13                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: G = graphs.PetersenGraph()\nsage: G.is_prime()\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\nTrue\nsage: G.modular_decomposition()\n('Prime', [('Prime', [2, 6, 3, 9]), 7, 8, 0, 1, 5, 4])\nsage: G = graphs.PetersenGraph()\nsage: G.modular_decomposition()\n('Prime', [2, 6, 3, 9, 7, 8, 0, 1, 5, 4])\nsage: G.is_prime()\nFalse\nsage: G.modular_decomposition()\n('Prime', [('Parallel', [2, 6]), 3, 9, 7, 8, 0, 1, 5, 4])\nsage: \nExiting Sage (CPU time 0m0.08s, Wall time 0m23.56s).\nconfetti:sage dcoudert$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.6.beta5, Release Date: 2015-03-13                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: G = graphs.PetersenGraph()\nsage: G.modular_decomposition()\n/Users/dcoudert/sage/src/bin/sage-ipython:1:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n./sage: line 134: 17606 Segmentation fault: 11  \"$SAGE_ROOT/src/bin/sage\" \"$@\"\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.6.beta5, Release Date: 2015-03-13                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: G = graphs.PetersenGraph()\nsage: G.is_prime()\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\nTrue\nsage: for i in range(1000):\n....:     G = graphs.RandomBarabasiAlbert(1000,2)\n....:     _ = G.modular_decomposition()\n....:     \n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n./sage: line 134: 17655 Segmentation fault: 11  \"$SAGE_ROOT/src/bin/sage\" \"$@\"\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.6.beta5, Release Date: 2015-03-13                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: G = graphs.PetersenGraph()\nsage: G.is_prime()\n/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:\n********************************************************************************\nGraph.modular_decomposition is known to return wrong results\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.\n********************************************************************************\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n./sage: line 134: 17703 Segmentation fault: 11  \"$SAGE_ROOT/src/bin/sage\" \"$@\"\n```",
    "created_at": "2015-03-14T18:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236549",
    "user": "https://github.com/dcoudert"
}
```

Yes I'm using a mac.

I can reproduce the bug, but it's kind of random. Sometimes its working, sometimes not.

```
confetti:sage dcoudert$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.6.beta5, Release Date: 2015-03-13                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: G = graphs.PetersenGraph()
sage: G.modular_decomposition()
/Users/dcoudert/sage/src/bin/sage-ipython:1:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
./sage: line 134: 17513 Segmentation fault: 11  "$SAGE_ROOT/src/bin/sage" "$@"
confetti:sage dcoudert$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.6.beta5, Release Date: 2015-03-13                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: G = graphs.PetersenGraph()
sage: G.is_prime()
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
True
sage: G.modular_decomposition()
('Prime', [('Prime', [2, 6, 3, 9]), 7, 8, 0, 1, 5, 4])
sage: G = graphs.PetersenGraph()
sage: G.modular_decomposition()
('Prime', [2, 6, 3, 9, 7, 8, 0, 1, 5, 4])
sage: G.is_prime()
False
sage: G.modular_decomposition()
('Prime', [('Parallel', [2, 6]), 3, 9, 7, 8, 0, 1, 5, 4])
sage: 
Exiting Sage (CPU time 0m0.08s, Wall time 0m23.56s).
confetti:sage dcoudert$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.6.beta5, Release Date: 2015-03-13                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: G = graphs.PetersenGraph()
sage: G.modular_decomposition()
/Users/dcoudert/sage/src/bin/sage-ipython:1:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
./sage: line 134: 17606 Segmentation fault: 11  "$SAGE_ROOT/src/bin/sage" "$@"
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.6.beta5, Release Date: 2015-03-13                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: G = graphs.PetersenGraph()
sage: G.is_prime()
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
True
sage: for i in range(1000):
....:     G = graphs.RandomBarabasiAlbert(1000,2)
....:     _ = G.modular_decomposition()
....:     
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
./sage: line 134: 17655 Segmentation fault: 11  "$SAGE_ROOT/src/bin/sage" "$@"
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.6.beta5, Release Date: 2015-03-13                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: G = graphs.PetersenGraph()
sage: G.is_prime()
/Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py:6524:
********************************************************************************
Graph.modular_decomposition is known to return wrong results
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/13744.
********************************************************************************
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
./sage: line 134: 17703 Segmentation fault: 11  "$SAGE_ROOT/src/bin/sage" "$@"
```



---

archive/issue_comments_236550.json:
```json
{
    "body": "Well.. On my computer your loop with 1000 random graphs ends without any problem.",
    "created_at": "2015-03-14T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236550",
    "user": "https://github.com/nathanncohen"
}
```

Well.. On my computer your loop with 1000 random graphs ends without any problem.



---

archive/issue_comments_236551.json:
```json
{
    "body": "With the loop, some times it crashes after 3 graphs, 600, or never. This is really random segfault.",
    "created_at": "2015-03-14T18:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236551",
    "user": "https://github.com/dcoudert"
}
```

With the loop, some times it crashes after 3 graphs, 600, or never. This is really random segfault.



---

archive/issue_comments_236552.json:
```json
{
    "body": "Also, have you seen that I don't always have the same answer on the Petersen?",
    "created_at": "2015-03-14T18:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236552",
    "user": "https://github.com/dcoudert"
}
```

Also, have you seen that I don't always have the same answer on the Petersen?



---

archive/issue_comments_236553.json:
```json
{
    "body": "It is very likely that this segfault comes from the code itself. Do you think that this should stop us from turning it into a module ?\n\nWhat we currently ship in Sage returns wrong results, and this new version of the code fixes it. Though we have segfaults. Could you try to run this code with the old version of Sage, see if it works ?\n\nI could build a package with the old version of the code, if it does not segfault. It would still return wrong results, though.\n\n> Also, have you seen that I don't always have the same answer on the Petersen?\n\n\nYesyes. I cannot reproduce that on my computer either, but it was apparently reported in #13744.\n\nNathann",
    "created_at": "2015-03-14T19:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236553",
    "user": "https://github.com/nathanncohen"
}
```

It is very likely that this segfault comes from the code itself. Do you think that this should stop us from turning it into a module ?

What we currently ship in Sage returns wrong results, and this new version of the code fixes it. Though we have segfaults. Could you try to run this code with the old version of Sage, see if it works ?

I could build a package with the old version of the code, if it does not segfault. It would still return wrong results, though.

> Also, have you seen that I don't always have the same answer on the Petersen?


Yesyes. I cannot reproduce that on my computer either, but it was apparently reported in #13744.

Nathann



---

archive/issue_comments_236554.json:
```json
{
    "body": "I don't have problems with the previous version (branch develop): no segfault with the long loop.\nI don't know what is the best to do.\nD.",
    "created_at": "2015-03-14T21:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236554",
    "user": "https://github.com/dcoudert"
}
```

I don't have problems with the previous version (branch develop): no segfault with the long loop.
I don't know what is the best to do.
D.



---

archive/issue_comments_236555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-15T16:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236556.json:
```json
{
    "body": "I changed the branch and the package's name (please remove the previous one from your copy of Sage). It ships the .c files that are currently contained in Sage (and return wrong results too). You should not experience anything that does not already happen, however.\n\nNathann",
    "created_at": "2015-03-15T16:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236556",
    "user": "https://github.com/nathanncohen"
}
```

I changed the branch and the package's name (please remove the previous one from your copy of Sage). It ships the .c files that are currently contained in Sage (and return wrong results too). You should not experience anything that does not already happen, however.

Nathann



---

archive/issue_comments_236557.json:
```json
{
    "body": "Well, now I have directly a segfault :(\n\nWhat's the difference between the two versions ?",
    "created_at": "2015-03-15T16:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236557",
    "user": "https://github.com/dcoudert"
}
```

Well, now I have directly a segfault :(

What's the difference between the two versions ?



---

archive/issue_comments_236558.json:
```json
{
    "body": "> What's the difference between the two versions ?\n\n\nI had one at some point. Now that you have installed the package I just built, could you 'touch' `modular_decomposition.pyx` and run `sage -b` ?\n\nNathann",
    "created_at": "2015-03-15T16:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236558",
    "user": "https://github.com/nathanncohen"
}
```

> What's the difference between the two versions ?


I had one at some point. Now that you have installed the package I just built, could you 'touch' `modular_decomposition.pyx` and run `sage -b` ?

Nathann



---

archive/issue_comments_236559.json:
```json
{
    "body": "It's apparently working: no segfault with the big for loop.\n\nShould we consider it is better like that?\n\nDavid.",
    "created_at": "2015-03-15T16:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236559",
    "user": "https://github.com/dcoudert"
}
```

It's apparently working: no segfault with the big for loop.

Should we consider it is better like that?

David.



---

archive/issue_comments_236560.json:
```json
{
    "body": "Well technically it is better, as the code is a bit further from Sage's source code, as it should have been from the beginning. Plus it is optional. Plus those .c files have never been reviewed anyway, and they are in french `:-P`\n\nAnd it will make it easier to test for bugs later, as we will only have to install the new files. And I hope that this will get solved someday `T_T`\n\nNathann",
    "created_at": "2015-03-15T17:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236560",
    "user": "https://github.com/nathanncohen"
}
```

Well technically it is better, as the code is a bit further from Sage's source code, as it should have been from the beginning. Plus it is optional. Plus those .c files have never been reviewed anyway, and they are in french `:-P`

And it will make it easier to test for bugs later, as we will only have to install the new files. And I hope that this will get solved someday `T_T`

Nathann



---

archive/issue_comments_236561.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-15T17:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236561",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_236562.json:
```json
{
    "body": "Since the patch is working and improves upon previous situation, I set it to positive review.\n\nAbout the c code, Guillaume Ducoffe has a c++/boost implementation. It could be an interesting alternative to the current c code which is apparently no longer maintained by its author. But I don't know if we can use boost (portability).\n\nDavid.",
    "created_at": "2015-03-15T17:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236562",
    "user": "https://github.com/dcoudert"
}
```

Since the patch is working and improves upon previous situation, I set it to positive review.

About the c code, Guillaume Ducoffe has a c++/boost implementation. It could be an interesting alternative to the current c code which is apparently no longer maintained by its author. But I don't know if we can use boost (portability).

David.



---

archive/issue_comments_236563.json:
```json
{
    "body": "Yo !\n\n> About the c code, Guillaume Ducoffe has a c++/boost implementation. \n\n\nDoes it compute modular decompositions of graphs?\n\nNathann",
    "created_at": "2015-03-15T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236563",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> About the c code, Guillaume Ducoffe has a c++/boost implementation. 


Does it compute modular decompositions of graphs?

Nathann



---

archive/issue_events_051070.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-17T08:33:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17713#event-51070"
}
```



---

archive/issue_comments_236564.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-17T08:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236564",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_236565.json:
```json
{
    "body": "This ticket modified the unrelated `build/pkgs/latte_int/checksums.ini`, see #18139. Now i know why `git commit -a` is a bad workflow :P",
    "created_at": "2015-04-07T21:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236565",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

This ticket modified the unrelated `build/pkgs/latte_int/checksums.ini`, see #18139. Now i know why `git commit -a` is a bad workflow :P



---

archive/issue_comments_236566.json:
```json
{
    "body": "`O_o`\n\nSorryyyy.. I have no idea how that happened, however `O_o`\n\nNathann",
    "created_at": "2015-04-08T07:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236566",
    "user": "https://github.com/nathanncohen"
}
```

`O_o`

Sorryyyy.. I have no idea how that happened, however `O_o`

Nathann



---

archive/issue_comments_236567.json:
```json
{
    "body": "should this be reimplemented from scratch, in cython? Unless there is correct external code somewhere that we can use?",
    "created_at": "2016-12-12T19:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236567",
    "user": "https://github.com/dimpase"
}
```

should this be reimplemented from scratch, in cython? Unless there is correct external code somewhere that we can use?



---

archive/issue_comments_236568.json:
```json
{
    "body": "The original code that we use is no longer maintained. Guillaume Ducoffe has not finalized his code in c++/boost yet. So I'm not aware of external code in c that can be used. \nWe can find implementations in java\nhttp://www.cs.utoronto.ca/~mtedder/ or in perl https://metacpan.org/release/Graph-ModularDecomposition.\nSo it is certainly better to reimplement it with sufficient comments to maintain it.",
    "created_at": "2016-12-13T07:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236568",
    "user": "https://github.com/dcoudert"
}
```

The original code that we use is no longer maintained. Guillaume Ducoffe has not finalized his code in c++/boost yet. So I'm not aware of external code in c that can be used. 
We can find implementations in java
http://www.cs.utoronto.ca/~mtedder/ or in perl https://metacpan.org/release/Graph-ModularDecomposition.
So it is certainly better to reimplement it with sufficient comments to maintain it.



---

archive/issue_comments_236569.json:
```json
{
    "body": "Replying to [comment:34 dcoudert]:\n> The original code that we use is no longer maintained. Guillaume Ducoffe has not finalized his code in c++/boost yet. So I'm not aware of external code in c that can be used. \n> We can find implementations in java\n> http://www.cs.utoronto.ca/~mtedder/ or in perl https://metacpan.org/release/Graph-ModularDecomposition.\n> So it is certainly better to reimplement it with sufficient comments to maintain it.\n\n\nThe perl implementation is for digraphs, so that's a different story all together.\n(we probably can interface perl with Sage, although it's probably a bit too much trouble).",
    "created_at": "2016-12-13T08:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236569",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:34 dcoudert]:
> The original code that we use is no longer maintained. Guillaume Ducoffe has not finalized his code in c++/boost yet. So I'm not aware of external code in c that can be used. 
> We can find implementations in java
> http://www.cs.utoronto.ca/~mtedder/ or in perl https://metacpan.org/release/Graph-ModularDecomposition.
> So it is certainly better to reimplement it with sufficient comments to maintain it.


The perl implementation is for digraphs, so that's a different story all together.
(we probably can interface perl with Sage, although it's probably a bit too much trouble).



---

archive/issue_comments_236570.json:
```json
{
    "body": "If we are to reimplement the modular decomposition in cython, we should certainly finish first the implementation of `LexBFS` #11736",
    "created_at": "2016-12-13T10:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17713",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17713#issuecomment-236570",
    "user": "https://github.com/dcoudert"
}
```

If we are to reimplement the modular decomposition in cython, we should certainly finish first the implementation of `LexBFS` #11736
