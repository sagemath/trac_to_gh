# Issue 11715: cython.py: don't create .html and .c files when running compile_and_load

Issue created by migration from https://trac.sagemath.org/ticket/11887

Original creator: jhpalmieri

Original creation time: 2011-10-01 19:43:35

Assignee: jason

CC:  leif

This ticket should fix for the problem discussed at [at #11680](http://trac.sagemath.org/sage_trac/ticket/11680#comment:23): the patch there causes some .c and .html files to be created when doctesting.



---

Attachment

I was just about to open such a ticket... (with priority "trivial" though) :)

If my patch is sufficient for you, you could review it... :P


---

Comment by jhpalmieri created at 2011-10-01 19:46:57

Leif: I've listed both of us as authors for the patch.  I took your patch from #11680 and added a little bit.  There is a lot more to be done here (see for example the "TODO" in the patch), but I don't want to work on it right now.


---

Comment by jhpalmieri created at 2011-10-01 19:47:27

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2011-10-01 19:47:27

I'm happy with your part of the patch, by the way.


---

Comment by leif created at 2011-10-01 20:01:17


```
    See the function :func:`sage.misc.cython.cython` for documentation 
    for the other inputs.
```


which leads to `TODO`... :)

I'm almost ok with your changes, will test them shortly, so we should have a positive review then.

I think `compile_and_load()` should also take keyword arguments, but that's for another ticket. Perhaps just add another `TODO`.


---

Comment by jhpalmieri created at 2011-10-01 22:22:45

I would consider the phrasing

```
    The other inputs should be described in the documentation for the
    function :func:`sage.misc.cython.cython`.
```

I couldn't think of any way to say it which wouldn't require changing if (when) the `cython` function actually gets documented.


---

Comment by leif created at 2011-10-02 00:10:45

Replying to [comment:5 jhpalmieri]:
> I would consider the phrasing

```
    The other inputs should be described in the documentation for the
    function :func:`sage.misc.cython.cython`.
```

> I couldn't think of any way to say it which wouldn't require changing if (when) the `cython` function actually gets documented.

That's pretty ok XD


---

Comment by dimpase created at 2011-10-02 17:05:53

After applying this patch `make ptestlong` ends with

```
...
----------------------------------------------------------------------
The temporary doctesting directory
   /home/dima/.sage/tmp/spms_banana-30578
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.

----------------------------------------------------------------------

The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/interfaces/sage0.py # 11 doctests failed
----------------------------------------------------------------------
Total time for all tests: 2884.8 seconds
make: *** [ptestlong] Error 128
```


The test in question gives the following:

```

sage -t -long -force_lib "devel/sage/sage/interfaces/sage0.py"
**********************************************************************
File "/usr/local/src/sage/sage-4.7.2.alpha3/devel/sage/sage/interfaces/sage0.py", line 448:
    sage: F == sage0(F)._sage_()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage/sage-4.7.2.alpha3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-4.7.2.alpha3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage/sage-4.7.2.alpha3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[4]>", line 1, in <module>
        F == sage0(F)._sage_()###line 448:
    sage: F == sage0(F)._sage_()
      File "/usr/local/src/sage/sage-4.7.2.alpha3/local/lib/python/site-packages/sage/interfaces/sage0.py", line 458, in _sage_
        return load(P._local_tmpfile())
      File "sage_object.pyx", line 775, in sage.structure.sage_object.load (sage/structure/sage_object.c:7811)
    IOError: [Errno 2] No such file or directory: '/home/dima/.sage//temp/spms_banana/6133//interface//tmp6170.sobj'
**********************************************************************
File "/usr/local/src/sage/sage-4.7.2.alpha3/devel/sage/sage/interfaces/sage0.py", line 466:
    sage: four_gcd(6)
Expected:
    2
Got:
    <BLANKLINE>
**********************************************************************
(truncated)
```

any clue?

Dima


---

Comment by dimpase created at 2011-10-02 17:05:53

Changing status from needs_review to needs_info.


---

Comment by jhpalmieri created at 2011-10-02 19:58:32

I'm unable to duplicate this failure.  On the other hand, I think I've seen failures for the file sage0.py randomly and nonrepeatably, having nothing to do with this ticket.  Is this failure repeatable, and if so, can you confirm that it happens because of the patch here?


---

Comment by dimpase created at 2011-10-03 06:50:23

Replying to [comment:8 jhpalmieri]:
> I'm unable to duplicate this failure.  On the other hand, I think I've seen failures for the file sage0.py randomly and nonrepeatably, having nothing to do with this ticket.  Is this failure repeatable, and if so, can you confirm that it happens because of the patch here?

Yesterday I had duplicated it like 5 or 6 times, and today it doesn't want to be duplicated.
Scary...


---

Comment by dimpase created at 2011-10-03 06:50:23

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2011-10-14 16:24:07

This ticket is listed as the only remaining blocker for sage-4.7.2.  Could somebody please review this ticket or somehow decide it's not worth merging in sage-4.7.2.


---

Comment by jhpalmieri created at 2011-10-14 18:07:21

I can give line 633 of the patch a positive review: that was contributed by Leif.  The rest of it should be reviewed by someone other than me.


---

Comment by jdemeyer created at 2011-10-17 11:55:57

Resolution: fixed


---

Comment by jhpalmieri created at 2011-10-25 22:50:15

See #11954 for a follow-up.
