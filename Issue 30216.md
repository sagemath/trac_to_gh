# Issue 30216: Document "sage -tox"

Issue created by migration from https://trac.sagemath.org/ticket/30453

Original creator: mkoeppe

Original creation time: 2020-08-27 21:04:35

CC:  dimpase @tobiasdiez chapoton jhpalmieri slelievre yzh

(from #30410)


---

Comment by mkoeppe created at 2020-08-29 00:24:36

Perhaps we also need `sage -btox` and `sage -btoxp` (in analogy to `sage -bt`, `sage -btp`)


---

Comment by mkoeppe created at 2021-04-07 19:29:15

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.


---

Comment by dimpase created at 2021-11-12 23:29:10

I don't think we should stop advertising "make ...test...". Intefaces to tox, pytest, etc are insane, one needs to look in the manuals all the time.


---

Comment by mkoeppe created at 2021-11-13 00:06:32

`make` is sage-the-distribution-specific. 

`sage -t` and `sage --tox` work in all settings.

That's why we should change it.


---

Comment by dimpase created at 2021-11-13 00:11:07

why break something that works, and is superior in usability?


---

Comment by mkoeppe created at 2021-11-13 00:31:15

Everyone already has to learn about `sage -t` for testing, because that's the only way that you can test something specific. 

So advertising both `sage -t` and `make test` is one too many.


---

Comment by dimpase created at 2021-11-13 01:15:33

my brain is small, and while I know that `./sage -tp --log --all >logs/ptest.log` is more or less the same (I would still need to look up the correct way to pipe stderr) as `make ptest` - I wish I knew something more useful instead.

this is really akin to "who needs makefiles, you can just type the compiler calls by hand" nonsense.


---

Comment by jhpalmieri created at 2021-11-13 21:56:18

Something like `make test` or `make check` is common with various packages, and I don't see a reason to stop advertising it. Three options doesn't seem like too many, since they do different things (`./sage -t ...` tests specific files, `make ...test...` tests all files and logs the output, `./sage --tox ...` tests in a different way). Maybe part of my resistance is that I don't understand how to use `./sage --tox ...` effectively; with `make ptestlong`, I can open up the log file while it's going and see the progress, but I haven't figured out how to do that with `tox`. When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?


---

Comment by mkoeppe created at 2021-11-13 22:31:42

Note that I was suggesting to replace `make test` in the manuals by `sage -t`, not by `sage --tox`.

Note that all `make *test*` targets have equivalents in `sage -t --all` with additional options, so I wouldn't say that the difference is that `./sage -t ...` tests specific files and `make ...test...` tests all files.

But you have a good point about logging.  That is indeed something (sage-the-distribution-specific) that `make test` offers over `sage -t`.


---

Comment by git created at 2021-11-27 03:07:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-11-27 03:13:03

Replying to [comment:21 jhpalmieri]:
> When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?

I've added a bit of documentation for codespell


---

Comment by mkoeppe created at 2021-11-27 03:13:20

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-11-27 14:13:10

Many shell code blocks are indented by 2 spaces,
aren't 4 required by rst / Sphinx?

Typo (a -> an):


```diff
-packages, that prefix needs to be a implicit namespace package, i.e., there
+packages, that prefix needs to be an implicit namespace package, i.e., there
```


Perhaps split some long lines:


```diff
-packages via the file `pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_
+packages via the file
+`pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_
```



```diff
-such optional dependencies as `extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_ in ``setup.cfg``
+such optional dependencies as
+`extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_
+in ``setup.cfg``
```



```diff
-- VS Code: Activate by adding the setting ``"python.linting.pycodestyleEnabled": true``, see `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__ for details.
+- VS Code: Activate by adding the setting
+  ``"python.linting.pycodestyleEnabled": true``, see
+  `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__
+  for details.
```



```diff
-*Note*: Currently, only the package :mod:`sage.manifolds` is checked. Further packages can be added in the ``pyrightconfig.json`` file.
+*Note*: Currently, only the package :mod:`sage.manifolds` is checked.
+Further packages can be added in the ``pyrightconfig.json`` file.
```



---

Comment by mkoeppe created at 2021-11-27 17:33:44

Feel free to push changes of this kind to the ticket


---

Comment by @tobiasdiez created at 2021-11-28 16:58:47

What I'm missing (as it confused me quite a bit) is a remark about the python (and other packages) used by tox and how/if a new virtual environment is created, especially for `src/tox.ini`. "Normally", you have environments like

```
envlist = py{27,34,36}-django{15,16}-{sqlite,mysql}, docs
```


That is, you run your test command in different configurations and new virtual environments; with additional special commands like documentation or linting. Sage's usage of tox is rather non-standard in this regard, so I think its good to point this out.

Concerning the documentation of pycodestyle, I'm not sure if the output of the various tox commands adds much. Instead, maybe stress that `-minimal` needs to pass for a ticket to be merged, while the other configuration is what sage is striving for in the future, so progress in that direction is welcome.


---

Comment by git created at 2021-11-28 20:13:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-11-28 20:13:42

Thanks for the comments! I have made some changes


---

Comment by mkoeppe created at 2021-11-28 21:14:10

Replying to [comment:30 mkoeppe]:
> Feel free to push changes of this kind to the ticket
... or post the unedited output of `git diff` so I can apply these changes


---

Comment by git created at 2021-12-01 04:45:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-12-01 17:15:31

Replying to [comment:33 mkoeppe]:
> Thanks for the comments! I have made some changes 

These changes look good to me, thanks!


---

Comment by mkoeppe created at 2021-12-04 21:04:44

If there are no more comments, let's get this in please


---

Comment by dimpase created at 2021-12-04 21:24:32

OK


---

Comment by dimpase created at 2021-12-04 21:24:32

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-12-04 23:07:58

Thanks!


---

Comment by mkoeppe created at 2021-12-12 17:46:03

Changing priority from major to critical.


---

Comment by vbraun created at 2021-12-23 20:26:31

Resolution: fixed
