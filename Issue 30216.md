# Issue 30216: Document "sage -tox"

archive/issues_030216.json:
```json
{
    "body": "CC:  dimpase @tobiasdiez chapoton jhpalmieri slelievre yzh\n\n(from #30410)\n\nIssue created by migration from https://trac.sagemath.org/ticket/30453\n\n",
    "created_at": "2020-08-27T21:04:35Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Document \"sage -tox\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30216",
    "user": "mkoeppe"
}
```
CC:  dimpase @tobiasdiez chapoton jhpalmieri slelievre yzh

(from #30410)

Issue created by migration from https://trac.sagemath.org/ticket/30453





---

archive/issue_comments_430681.json:
```json
{
    "body": "Perhaps we also need `sage -btox` and `sage -btoxp` (in analogy to `sage -bt`, `sage -btp`)",
    "created_at": "2020-08-29T00:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430681",
    "user": "mkoeppe"
}
```

Perhaps we also need `sage -btox` and `sage -btoxp` (in analogy to `sage -bt`, `sage -btp`)



---

archive/issue_comments_430682.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430682",
    "user": "mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_430683.json:
```json
{
    "body": "I don't think we should stop advertising \"make ...test...\". Intefaces to tox, pytest, etc are insane, one needs to look in the manuals all the time.",
    "created_at": "2021-11-12T23:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430683",
    "user": "dimpase"
}
```

I don't think we should stop advertising "make ...test...". Intefaces to tox, pytest, etc are insane, one needs to look in the manuals all the time.



---

archive/issue_comments_430684.json:
```json
{
    "body": "`make` is sage-the-distribution-specific. \n\n`sage -t` and `sage --tox` work in all settings.\n\nThat's why we should change it.",
    "created_at": "2021-11-13T00:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430684",
    "user": "mkoeppe"
}
```

`make` is sage-the-distribution-specific. 

`sage -t` and `sage --tox` work in all settings.

That's why we should change it.



---

archive/issue_comments_430685.json:
```json
{
    "body": "why break something that works, and is superior in usability?",
    "created_at": "2021-11-13T00:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430685",
    "user": "dimpase"
}
```

why break something that works, and is superior in usability?



---

archive/issue_comments_430686.json:
```json
{
    "body": "Everyone already has to learn about `sage -t` for testing, because that's the only way that you can test something specific. \n\nSo advertising both `sage -t` and `make test` is one too many.",
    "created_at": "2021-11-13T00:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430686",
    "user": "mkoeppe"
}
```

Everyone already has to learn about `sage -t` for testing, because that's the only way that you can test something specific. 

So advertising both `sage -t` and `make test` is one too many.



---

archive/issue_comments_430687.json:
```json
{
    "body": "my brain is small, and while I know that `./sage -tp --log --all >logs/ptest.log` is more or less the same (I would still need to look up the correct way to pipe stderr) as `make ptest` - I wish I knew something more useful instead.\n\nthis is really akin to \"who needs makefiles, you can just type the compiler calls by hand\" nonsense.",
    "created_at": "2021-11-13T01:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430687",
    "user": "dimpase"
}
```

my brain is small, and while I know that `./sage -tp --log --all >logs/ptest.log` is more or less the same (I would still need to look up the correct way to pipe stderr) as `make ptest` - I wish I knew something more useful instead.

this is really akin to "who needs makefiles, you can just type the compiler calls by hand" nonsense.



---

archive/issue_comments_430688.json:
```json
{
    "body": "Something like `make test` or `make check` is common with various packages, and I don't see a reason to stop advertising it. Three options doesn't seem like too many, since they do different things (`./sage -t ...` tests specific files, `make ...test...` tests all files and logs the output, `./sage --tox ...` tests in a different way). Maybe part of my resistance is that I don't understand how to use `./sage --tox ...` effectively; with `make ptestlong`, I can open up the log file while it's going and see the progress, but I haven't figured out how to do that with `tox`. When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?",
    "created_at": "2021-11-13T21:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430688",
    "user": "jhpalmieri"
}
```

Something like `make test` or `make check` is common with various packages, and I don't see a reason to stop advertising it. Three options doesn't seem like too many, since they do different things (`./sage -t ...` tests specific files, `make ...test...` tests all files and logs the output, `./sage --tox ...` tests in a different way). Maybe part of my resistance is that I don't understand how to use `./sage --tox ...` effectively; with `make ptestlong`, I can open up the log file while it's going and see the progress, but I haven't figured out how to do that with `tox`. When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?



---

archive/issue_comments_430689.json:
```json
{
    "body": "Note that I was suggesting to replace `make test` in the manuals by `sage -t`, not by `sage --tox`.\n\nNote that all `make *test*` targets have equivalents in `sage -t --all` with additional options, so I wouldn't say that the difference is that `./sage -t ...` tests specific files and `make ...test...` tests all files.\n\nBut you have a good point about logging.  That is indeed something (sage-the-distribution-specific) that `make test` offers over `sage -t`.",
    "created_at": "2021-11-13T22:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430689",
    "user": "mkoeppe"
}
```

Note that I was suggesting to replace `make test` in the manuals by `sage -t`, not by `sage --tox`.

Note that all `make *test*` targets have equivalents in `sage -t --all` with additional options, so I wouldn't say that the difference is that `./sage -t ...` tests specific files and `make ...test...` tests all files.

But you have a good point about logging.  That is indeed something (sage-the-distribution-specific) that `make test` offers over `sage -t`.



---

archive/issue_comments_430690.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-27T03:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430690",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430691.json:
```json
{
    "body": "Replying to [comment:21 jhpalmieri]:\n> When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?\n\nI've added a bit of documentation for codespell",
    "created_at": "2021-11-27T03:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430691",
    "user": "mkoeppe"
}
```

Replying to [comment:21 jhpalmieri]:
> When I just ran `sage --tox src/sage/homology`, it ended in an error, but I'm not sure why. Because the code uses a variable `mone` which `codespell` thinks is misspelled?

I've added a bit of documentation for codespell



---

archive/issue_comments_430692.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-27T03:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430692",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430693.json:
```json
{
    "body": "Many shell code blocks are indented by 2 spaces,\naren't 4 required by rst / Sphinx?\n\nTypo (a -> an):\n\n\n```diff\n-packages, that prefix needs to be a implicit namespace package, i.e., there\n+packages, that prefix needs to be an implicit namespace package, i.e., there\n```\n\n\nPerhaps split some long lines:\n\n\n```diff\n-packages via the file `pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_\n+packages via the file\n+`pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_\n```\n\n\n\n```diff\n-such optional dependencies as `extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_ in ``setup.cfg``\n+such optional dependencies as\n+`extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_\n+in ``setup.cfg``\n```\n\n\n\n```diff\n-- VS Code: Activate by adding the setting ``\"python.linting.pycodestyleEnabled\": true``, see `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__ for details.\n+- VS Code: Activate by adding the setting\n+  ``\"python.linting.pycodestyleEnabled\": true``, see\n+  `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__\n+  for details.\n```\n\n\n\n```diff\n-*Note*: Currently, only the package :mod:`sage.manifolds` is checked. Further packages can be added in the ``pyrightconfig.json`` file.\n+*Note*: Currently, only the package :mod:`sage.manifolds` is checked.\n+Further packages can be added in the ``pyrightconfig.json`` file.\n```\n",
    "created_at": "2021-11-27T14:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430693",
    "user": "slelievre"
}
```

Many shell code blocks are indented by 2 spaces,
aren't 4 required by rst / Sphinx?

Typo (a -> an):


```diff
-packages, that prefix needs to be a implicit namespace package, i.e., there
+packages, that prefix needs to be an implicit namespace package, i.e., there
```


Perhaps split some long lines:


```diff
-packages via the file `pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_
+packages via the file
+`pyproject.toml <https://pip.pypa.io/en/stable/reference/build-system/pyproject-toml/>`_
```



```diff
-such optional dependencies as `extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_ in ``setup.cfg``
+such optional dependencies as
+`extras_require <https://setuptools.pypa.io/en/latest/userguide/dependency_management.html#optional-dependencies>`_
+in ``setup.cfg``
```



```diff
-- VS Code: Activate by adding the setting ``"python.linting.pycodestyleEnabled": true``, see `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__ for details.
+- VS Code: Activate by adding the setting
+  ``"python.linting.pycodestyleEnabled": true``, see
+  `official VS Code documentation <https://code.visualstudio.com/docs/python/linting>`__
+  for details.
```



```diff
-*Note*: Currently, only the package :mod:`sage.manifolds` is checked. Further packages can be added in the ``pyrightconfig.json`` file.
+*Note*: Currently, only the package :mod:`sage.manifolds` is checked.
+Further packages can be added in the ``pyrightconfig.json`` file.
```




---

archive/issue_comments_430694.json:
```json
{
    "body": "Feel free to push changes of this kind to the ticket",
    "created_at": "2021-11-27T17:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430694",
    "user": "mkoeppe"
}
```

Feel free to push changes of this kind to the ticket



---

archive/issue_comments_430695.json:
```json
{
    "body": "What I'm missing (as it confused me quite a bit) is a remark about the python (and other packages) used by tox and how/if a new virtual environment is created, especially for `src/tox.ini`. \"Normally\", you have environments like\n\n```\nenvlist = py{27,34,36}-django{15,16}-{sqlite,mysql}, docs\n```\n\n\nThat is, you run your test command in different configurations and new virtual environments; with additional special commands like documentation or linting. Sage's usage of tox is rather non-standard in this regard, so I think its good to point this out.\n\nConcerning the documentation of pycodestyle, I'm not sure if the output of the various tox commands adds much. Instead, maybe stress that `-minimal` needs to pass for a ticket to be merged, while the other configuration is what sage is striving for in the future, so progress in that direction is welcome.",
    "created_at": "2021-11-28T16:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430695",
    "user": "@tobiasdiez"
}
```

What I'm missing (as it confused me quite a bit) is a remark about the python (and other packages) used by tox and how/if a new virtual environment is created, especially for `src/tox.ini`. "Normally", you have environments like

```
envlist = py{27,34,36}-django{15,16}-{sqlite,mysql}, docs
```


That is, you run your test command in different configurations and new virtual environments; with additional special commands like documentation or linting. Sage's usage of tox is rather non-standard in this regard, so I think its good to point this out.

Concerning the documentation of pycodestyle, I'm not sure if the output of the various tox commands adds much. Instead, maybe stress that `-minimal` needs to pass for a ticket to be merged, while the other configuration is what sage is striving for in the future, so progress in that direction is welcome.



---

archive/issue_comments_430696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-28T20:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430696",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430697.json:
```json
{
    "body": "Thanks for the comments! I have made some changes",
    "created_at": "2021-11-28T20:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430697",
    "user": "mkoeppe"
}
```

Thanks for the comments! I have made some changes



---

archive/issue_comments_430698.json:
```json
{
    "body": "Replying to [comment:30 mkoeppe]:\n> Feel free to push changes of this kind to the ticket\n... or post the unedited output of `git diff` so I can apply these changes",
    "created_at": "2021-11-28T21:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430698",
    "user": "mkoeppe"
}
```

Replying to [comment:30 mkoeppe]:
> Feel free to push changes of this kind to the ticket
... or post the unedited output of `git diff` so I can apply these changes



---

archive/issue_comments_430699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-01T04:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430699",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430700.json:
```json
{
    "body": "Replying to [comment:33 mkoeppe]:\n> Thanks for the comments! I have made some changes \n\nThese changes look good to me, thanks!",
    "created_at": "2021-12-01T17:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430700",
    "user": "@tobiasdiez"
}
```

Replying to [comment:33 mkoeppe]:
> Thanks for the comments! I have made some changes 

These changes look good to me, thanks!



---

archive/issue_comments_430701.json:
```json
{
    "body": "If there are no more comments, let's get this in please",
    "created_at": "2021-12-04T21:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430701",
    "user": "mkoeppe"
}
```

If there are no more comments, let's get this in please



---

archive/issue_comments_430702.json:
```json
{
    "body": "OK",
    "created_at": "2021-12-04T21:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430702",
    "user": "dimpase"
}
```

OK



---

archive/issue_comments_430703.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-04T21:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430703",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430704.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-12-04T23:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430704",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_430705.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-12-12T17:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430705",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_430706.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-23T20:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-430706",
    "user": "vbraun"
}
```

Resolution: fixed
