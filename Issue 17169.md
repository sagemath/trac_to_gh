# Issue 17169: sage.crypto.gen_lattice: quotient parameter should accept polynomials

archive/issues_017169.json:
```json
{
    "body": "CC:  @vbraun\n\nThis works:\n\n```\nsage: var('x')\nx\nsage: sage.crypto.gen_lattice(type='ideal', seed=42, quotient=x^4-1)\n[11  0  0  0  0  0  0  0]\n[ 0 11  0  0  0  0  0  0]\n[ 0  0 11  0  0  0  0  0]\n[ 0  0  0 11  0  0  0  0]\n[ 4 -2 -3 -3  1  0  0  0]\n[-3  4 -2 -3  0  1  0  0]\n[-3 -3  4 -2  0  0  1  0]\n[-2 -3 -3  4  0  0  0  1]\n```\n\n\nBut this should also work:\n\n```\nsage: R.<x> = ZZ[]\nsage: sage.crypto.gen_lattice(type='ideal', seed=42, quotient=x^4-1)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-11-387441ec01a8> in <module>()\n----> 1 sage.crypto.gen_lattice(type='ideal', seed=Integer(42), quotient=x**Integer(4)-Integer(1))\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/crypto/lattice.pyc in gen_lattice(type, n, m, q, seed, quotient, dual, ntl, lattice)\n    215         if quotient is None: raise \\\n    216             ValueError('ideal bases require a quotient polynomial')\n--> 217         x = quotient.default_variable()\n    218         if n != quotient.degree(x): raise \\\n    219             ValueError('ideal bases require n  = quotient.degree()')\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4074)()\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()\n\nAttributeError: 'sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint' object has no attribute 'default_variable'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17406\n\n",
    "created_at": "2014-11-27T10:08:11Z",
    "labels": [
        "cryptography",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "sage.crypto.gen_lattice: quotient parameter should accept polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17169",
    "user": "@jdemeyer"
}
```
CC:  @vbraun

This works:

```
sage: var('x')
x
sage: sage.crypto.gen_lattice(type='ideal', seed=42, quotient=x^4-1)
[11  0  0  0  0  0  0  0]
[ 0 11  0  0  0  0  0  0]
[ 0  0 11  0  0  0  0  0]
[ 0  0  0 11  0  0  0  0]
[ 4 -2 -3 -3  1  0  0  0]
[-3  4 -2 -3  0  1  0  0]
[-3 -3  4 -2  0  0  1  0]
[-2 -3 -3  4  0  0  0  1]
```


But this should also work:

```
sage: R.<x> = ZZ[]
sage: sage.crypto.gen_lattice(type='ideal', seed=42, quotient=x^4-1)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-11-387441ec01a8> in <module>()
----> 1 sage.crypto.gen_lattice(type='ideal', seed=Integer(42), quotient=x**Integer(4)-Integer(1))

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/crypto/lattice.pyc in gen_lattice(type, n, m, q, seed, quotient, dual, ntl, lattice)
    215         if quotient is None: raise \
    216             ValueError('ideal bases require a quotient polynomial')
--> 217         x = quotient.default_variable()
    218         if n != quotient.degree(x): raise \
    219             ValueError('ideal bases require n  = quotient.degree()')

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4074)()

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1631)()

AttributeError: 'sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint' object has no attribute 'default_variable'
```


Issue created by migration from https://trac.sagemath.org/ticket/17406





---

archive/issue_comments_228239.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-11-27T11:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228239",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_228240.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-27T11:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228240",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_228241.json:
```json
{
    "body": "correct failing doctest\n----\nNew commits:",
    "created_at": "2015-04-17T18:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228241",
    "user": "@fchapoton"
}
```

correct failing doctest
----
New commits:



---

archive/issue_comments_228242.json:
```json
{
    "body": "In the patch you add\n\n\n```python\nassert P.base_ring() is ZZ_q\n```\n\n\nI was under the impression we are encouraged to avoid `assert` unless it's really a bug in the program we are checking for.",
    "created_at": "2015-05-19T10:45:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228242",
    "user": "@malb"
}
```

In the patch you add


```python
assert P.base_ring() is ZZ_q
```


I was under the impression we are encouraged to avoid `assert` unless it's really a bug in the program we are checking for.



---

archive/issue_comments_228243.json:
```json
{
    "body": "Replying to [comment:4 malb]:\n> I was under the impression we are encouraged to avoid `assert` unless it's really a bug in the program we are checking for.\n\nAbsolutely! You must only use `assert` to check for bugs, not for bad user input.",
    "created_at": "2015-05-19T12:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228243",
    "user": "@jdemeyer"
}
```

Replying to [comment:4 malb]:
> I was under the impression we are encouraged to avoid `assert` unless it's really a bug in the program we are checking for.

Absolutely! You must only use `assert` to check for bugs, not for bad user input.



---

archive/issue_comments_228244.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-28T13:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228244",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_228245.json:
```json
{
    "body": "Does not merge on 6.10.beta6",
    "created_at": "2015-11-28T13:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228245",
    "user": "@videlec"
}
```

Does not merge on 6.10.beta6



---

archive/issue_comments_228246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-29T10:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228246",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228247.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-11-29T10:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228247",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_228248.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-11-29T10:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228248",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_228249.json:
```json
{
    "body": "Accidentally set to \"positive review\", let's hope Volker didn't merge it in this 11-second window :-)",
    "created_at": "2015-11-29T10:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228249",
    "user": "@jdemeyer"
}
```

Accidentally set to "positive review", let's hope Volker didn't merge it in this 11-second window :-)



---

archive/issue_comments_228250.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-01T19:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228250",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_228251.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-03T23:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17169#issuecomment-228251",
    "user": "@vbraun"
}
```

Resolution: fixed
