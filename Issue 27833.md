# Issue 27833: is_conjugate bug fix and enhancements

Issue created by migration from https://trac.sagemath.org/ticket/28070

Original creator: @ckelln

Original creation time: 2019-06-27 13:47:11

Keywords: SI2019

The function is_conjugate failed for degree 1 maps. Implemented a fix that reduced the problem to testing conjugacy via similar matrices (over PGL2).

Adjusted the documentation to make it clear over which field conjugacy is being tested. 

Added a parameter to enable choice of field over which conjugacy is being tested. 

Added early exit based on sigma invariants for dimension 1 if testing conjugacy over a number field or a finite field.


---

Comment by @ckelln created at 2019-06-27 15:17:40

Changing status from new to needs_review.


---

Comment by git created at 2019-06-27 15:47:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-27 15:57:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by atowsley created at 2019-06-27 16:04:39

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2019-07-09 14:19:10

``R'' needs to be added to the INPUT section of the docs

Also you should use the keyword as a keyword, i.e. 

```
f.is_conjugate(g, R=QQbar)
```


Finally, the new TEST seems like a good one as an EXAMPLE and it helps the user see the difference. It also needs to be marked

```
# long time
```

as it takes more than 1s.


---

Comment by bhutz created at 2019-07-09 14:19:10

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-07-10 01:31:09

Resolution: fixed


---

Comment by vbraun created at 2019-07-10 01:32:42

Changing status from closed to new.


---

Comment by vbraun created at 2019-07-10 01:32:42

Resolution changed from fixed to 


---

Comment by git created at 2019-07-30 15:08:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-07-30 20:03:25

Changing status from new to needs_review.


---

Comment by bhutz created at 2019-07-30 20:03:25

These changes can also be implemented in conjugating_set, so I did that along with a few other minor tweaks.


---

Comment by bhutz created at 2019-07-30 20:04:07

New commits:


---

Comment by atowsley created at 2019-07-31 14:34:15

Two small typos in conjugating_set documentation:
"Determine to see if" (remove "to see")
"by by" (second "by" hard to spot as it's on a new line)

Bigger issue, the following fails:


```python
P.<x,y> = ProjectiveSpace(GF(5), 1)
f = DynamicalSystem_projective([7*x + 12*y, 8*x])
g = DynamicalSystem_projective([5*x - 8*y, 3*x - 8*y])
m = f.conjugating_set(g)[0]
f.conjugate(m) == g
```


returns false but


```python
f.conjugate(matrix(GF(5),2,2,[1,0,1,1]).inverse())==g
```


returns true. 

The problem seems to be in the field of definition of m is the algebraic closure of GF(5) which then changes the of f.conjugate(m) to also be the algebraic closure.


---

Comment by atowsley created at 2019-07-31 14:34:15

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-07-31 19:35:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-31 19:39:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-07-31 19:41:36

Changing status from needs_work to needs_review.


---

Comment by atowsley created at 2019-08-01 15:02:27

The following example fails:

```python
K.<i> = QuadraticField(-1)
P.<x,y> = ProjectiveSpace(QQ,1)
f = DynamicalSystem_projective([x^2 - 2*y^2, y^2])
m = matrix(QQ, 2, 2, [-1, 3, 2, 1])
g = f.conjugate(m)
print f.conjugating_set(g)
f = f.change_ring(K)
g = g.change_ring(K)
print f.conjugating_set(g)

[[-1  3]
[ 2  1]]
[]
```

(The output should be the same). There is a caching problem with "Arrangements" and "Subsets".


---

Comment by atowsley created at 2019-08-01 15:02:27

Changing status from needs_review to needs_work.


---

Comment by atowsley created at 2019-08-01 15:21:42

Also the following example is broken:

```python
K=GF(7)
P.<x,y,z> = ProjectiveSpace(K,2)
f = DynamicalSystem_projective([2*x + 12*y, 11*y+2*z, x+z])
m1 = matrix(K, 3, 3, [1,4,1,0,2,1,1,1,1])
g = f.conjugate(m1)
print f.conjugating_set(g)
print f.is_conjugate(g)

[[1 0 0]
[1 5 0]
[5 4 3]]
False
```

Since the conjugating set is nonempty, it should return true. 
It works properly when K is replaced by an infinite field.


---

Comment by git created at 2019-08-01 18:01:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-08-01 18:02:58

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2019-08-01 18:02:58

Arrangements and SubSets seemed to be cachng by value ignoring the field of definition, so we cannot use them on the points themselves.

Simple mistake on the dim 2 stuff, so I added an example to catch that.


---

Comment by atowsley created at 2019-08-01 21:09:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-04 07:25:12

Resolution: fixed
