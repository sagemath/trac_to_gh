# Issue 27833: is_conjugate bug fix and enhancements

archive/issues_027833.json:
```json
{
    "body": "Keywords: SI2019\n\nThe function is_conjugate failed for degree 1 maps. Implemented a fix that reduced the problem to testing conjugacy via similar matrices (over PGL2).\n\nAdjusted the documentation to make it clear over which field conjugacy is being tested. \n\nAdded a parameter to enable choice of field over which conjugacy is being tested. \n\nAdded early exit based on sigma invariants for dimension 1 if testing conjugacy over a number field or a finite field.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28070\n\n",
    "created_at": "2019-06-27T13:47:11Z",
    "labels": [
        "dynamics",
        "minor",
        "enhancement"
    ],
    "title": "is_conjugate bug fix and enhancements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27833",
    "user": "@ckelln"
}
```
Keywords: SI2019

The function is_conjugate failed for degree 1 maps. Implemented a fix that reduced the problem to testing conjugacy via similar matrices (over PGL2).

Adjusted the documentation to make it clear over which field conjugacy is being tested. 

Added a parameter to enable choice of field over which conjugacy is being tested. 

Added early exit based on sigma invariants for dimension 1 if testing conjugacy over a number field or a finite field.

Issue created by migration from https://trac.sagemath.org/ticket/28070





---

archive/issue_comments_393070.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-27T15:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393070",
    "user": "@ckelln"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393071.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-27T15:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393071",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-27T15:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393072",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393073.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-27T16:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393073",
    "user": "atowsley"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393074.json:
```json
{
    "body": "``R'' needs to be added to the INPUT section of the docs\n\nAlso you should use the keyword as a keyword, i.e. \n\n```\nf.is_conjugate(g, R=QQbar)\n```\n\n\nFinally, the new TEST seems like a good one as an EXAMPLE and it helps the user see the difference. It also needs to be marked\n\n```\n# long time\n```\n\nas it takes more than 1s.",
    "created_at": "2019-07-09T14:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393074",
    "user": "bhutz"
}
```

``R'' needs to be added to the INPUT section of the docs

Also you should use the keyword as a keyword, i.e. 

```
f.is_conjugate(g, R=QQbar)
```


Finally, the new TEST seems like a good one as an EXAMPLE and it helps the user see the difference. It also needs to be marked

```
# long time
```

as it takes more than 1s.



---

archive/issue_comments_393075.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-07-09T14:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393075",
    "user": "bhutz"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_393076.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-10T01:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393076",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_393077.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2019-07-10T01:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393077",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_393078.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2019-07-10T01:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393078",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_393079.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-30T15:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393079",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393080.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-30T20:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393080",
    "user": "bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393081.json:
```json
{
    "body": "These changes can also be implemented in conjugating_set, so I did that along with a few other minor tweaks.",
    "created_at": "2019-07-30T20:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393081",
    "user": "bhutz"
}
```

These changes can also be implemented in conjugating_set, so I did that along with a few other minor tweaks.



---

archive/issue_comments_393082.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-30T20:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393082",
    "user": "bhutz"
}
```

New commits:



---

archive/issue_comments_393083.json:
```json
{
    "body": "Two small typos in conjugating_set documentation:\n\"Determine to see if\" (remove \"to see\")\n\"by by\" (second \"by\" hard to spot as it's on a new line)\n\nBigger issue, the following fails:\n\n\n```python\nP.<x,y> = ProjectiveSpace(GF(5), 1)\nf = DynamicalSystem_projective([7*x + 12*y, 8*x])\ng = DynamicalSystem_projective([5*x - 8*y, 3*x - 8*y])\nm = f.conjugating_set(g)[0]\nf.conjugate(m) == g\n```\n\n\nreturns false but\n\n\n```python\nf.conjugate(matrix(GF(5),2,2,[1,0,1,1]).inverse())==g\n```\n\n\nreturns true. \n\nThe problem seems to be in the field of definition of m is the algebraic closure of GF(5) which then changes the of f.conjugate(m) to also be the algebraic closure.",
    "created_at": "2019-07-31T14:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393083",
    "user": "atowsley"
}
```

Two small typos in conjugating_set documentation:
"Determine to see if" (remove "to see")
"by by" (second "by" hard to spot as it's on a new line)

Bigger issue, the following fails:


```python
P.<x,y> = ProjectiveSpace(GF(5), 1)
f = DynamicalSystem_projective([7*x + 12*y, 8*x])
g = DynamicalSystem_projective([5*x - 8*y, 3*x - 8*y])
m = f.conjugating_set(g)[0]
f.conjugate(m) == g
```


returns false but


```python
f.conjugate(matrix(GF(5),2,2,[1,0,1,1]).inverse())==g
```


returns true. 

The problem seems to be in the field of definition of m is the algebraic closure of GF(5) which then changes the of f.conjugate(m) to also be the algebraic closure.



---

archive/issue_comments_393084.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-07-31T14:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393084",
    "user": "atowsley"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_393085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-31T19:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393085",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393086.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-31T19:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393086",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393087.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-31T19:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393087",
    "user": "bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_393088.json:
```json
{
    "body": "The following example fails:\n\n```python\nK.<i> = QuadraticField(-1)\nP.<x,y> = ProjectiveSpace(QQ,1)\nf = DynamicalSystem_projective([x^2 - 2*y^2, y^2])\nm = matrix(QQ, 2, 2, [-1, 3, 2, 1])\ng = f.conjugate(m)\nprint f.conjugating_set(g)\nf = f.change_ring(K)\ng = g.change_ring(K)\nprint f.conjugating_set(g)\n\n[[-1  3]\n[ 2  1]]\n[]\n```\n\n(The output should be the same). There is a caching problem with \"Arrangements\" and \"Subsets\".",
    "created_at": "2019-08-01T15:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393088",
    "user": "atowsley"
}
```

The following example fails:

```python
K.<i> = QuadraticField(-1)
P.<x,y> = ProjectiveSpace(QQ,1)
f = DynamicalSystem_projective([x^2 - 2*y^2, y^2])
m = matrix(QQ, 2, 2, [-1, 3, 2, 1])
g = f.conjugate(m)
print f.conjugating_set(g)
f = f.change_ring(K)
g = g.change_ring(K)
print f.conjugating_set(g)

[[-1  3]
[ 2  1]]
[]
```

(The output should be the same). There is a caching problem with "Arrangements" and "Subsets".



---

archive/issue_comments_393089.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-01T15:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393089",
    "user": "atowsley"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_393090.json:
```json
{
    "body": "Also the following example is broken:\n\n```python\nK=GF(7)\nP.<x,y,z> = ProjectiveSpace(K,2)\nf = DynamicalSystem_projective([2*x + 12*y, 11*y+2*z, x+z])\nm1 = matrix(K, 3, 3, [1,4,1,0,2,1,1,1,1])\ng = f.conjugate(m1)\nprint f.conjugating_set(g)\nprint f.is_conjugate(g)\n\n[[1 0 0]\n[1 5 0]\n[5 4 3]]\nFalse\n```\n\nSince the conjugating set is nonempty, it should return true. \nIt works properly when K is replaced by an infinite field.",
    "created_at": "2019-08-01T15:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393090",
    "user": "atowsley"
}
```

Also the following example is broken:

```python
K=GF(7)
P.<x,y,z> = ProjectiveSpace(K,2)
f = DynamicalSystem_projective([2*x + 12*y, 11*y+2*z, x+z])
m1 = matrix(K, 3, 3, [1,4,1,0,2,1,1,1,1])
g = f.conjugate(m1)
print f.conjugating_set(g)
print f.is_conjugate(g)

[[1 0 0]
[1 5 0]
[5 4 3]]
False
```

Since the conjugating set is nonempty, it should return true. 
It works properly when K is replaced by an infinite field.



---

archive/issue_comments_393091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-01T18:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393092.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-01T18:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393092",
    "user": "bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_393093.json:
```json
{
    "body": "Arrangements and SubSets seemed to be cachng by value ignoring the field of definition, so we cannot use them on the points themselves.\n\nSimple mistake on the dim 2 stuff, so I added an example to catch that.",
    "created_at": "2019-08-01T18:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393093",
    "user": "bhutz"
}
```

Arrangements and SubSets seemed to be cachng by value ignoring the field of definition, so we cannot use them on the points themselves.

Simple mistake on the dim 2 stuff, so I added an example to catch that.



---

archive/issue_comments_393094.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-01T21:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393094",
    "user": "atowsley"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393095.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-04T07:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27833#issuecomment-393095",
    "user": "vbraun"
}
```

Resolution: fixed
