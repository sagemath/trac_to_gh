# Issue 15713: Consider using a faster malloc()

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2014-03-16 09:41:37

CC:  zimmerma

Some unscientific experiments suggesting that sage may benefit from using a custom malloc(), at lest on Linux/glibc:


```
$ sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta4, Release Date: 2014-03-11                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P.<a,b,c> = PolynomialRing(QQ)
sage: %timeit d=(a+b+c+1)^100
1 loops, best of 3: 5.42 s per loop
sage: m = random_matrix(QQ, 1000)
sage: %timeit m**2
1 loops, best of 3: 957 ms per loop
```



```
$ LD_PRELOAD="libjemalloc.so.1" sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta4, Release Date: 2014-03-11                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P.<a,b,c> = PolynomialRing(QQ)
sage: %timeit d=(a+b+c+1)^100
1 loops, best of 3: 3.98 s per loop
sage: m = random_matrix(QQ, 1000)
sage: %timeit m**2
1 loops, best of 3: 1.07 s per loop
```



```
$ LD_PRELOAD="/usr/lib/libtcmalloc.so.4" sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta4, Release Date: 2014-03-11                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P.<a,b,c> = PolynomialRing(QQ)
sage: %timeit d=(a+b+c+1)^100
1 loops, best of 3: 3.85 s per loop
sage: m = random_matrix(QQ, 1000)
sage: %timeit m**2
1 loops, best of 3: 840 ms per loop
```

