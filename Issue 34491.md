# Issue 34491: change sorting for WeierstrassIsomorphism

archive/issues_034491.json:
```json
{
    "body": "CC:  @JohnCremona\n\nCurrently, `EllipticCurve_generic.automorphisms()` returns the automorphisms in a more or less arbitrary (albeit deterministic) order.\n\nIt is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)\n\nIn this patch, we change `._richcmp_()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.\n\nDiff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c\n\nIssue created by migration from https://trac.sagemath.org/ticket/34728\n\n",
    "created_at": "2022-11-07T06:37:10Z",
    "labels": [
        "component: elliptic curves",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "change sorting for WeierstrassIsomorphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34491",
    "user": "https://github.com/yyyyx4"
}
```
CC:  @JohnCremona

Currently, `EllipticCurve_generic.automorphisms()` returns the automorphisms in a more or less arbitrary (albeit deterministic) order.

It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)

In this patch, we change `._richcmp_()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.

Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c

Issue created by migration from https://trac.sagemath.org/ticket/34728





---

archive/issue_comments_487783.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-07T07:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487783",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_487784.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-11-07T11:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487784",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_487785.json:
```json
{
    "body": "All looks good, and I agree with the sorting strategy.  Two questions: (1) when p=2 in the random test is it still the case that the second auto in the list is multiplcation by -1? (2) In the test for the length of the autos, for the last two cases you don't really need to put both 0 and 1728 in the list since they are equal :) But I will not insist.\n\nAs long as the answer to (1) is yes, you can take a positive review from me.",
    "created_at": "2022-11-07T11:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487785",
    "user": "https://github.com/JohnCremona"
}
```

All looks good, and I agree with the sorting strategy.  Two questions: (1) when p=2 in the random test is it still the case that the second auto in the list is multiplcation by -1? (2) In the test for the length of the autos, for the last two cases you don't really need to put both 0 and 1728 in the list since they are equal :) But I will not insist.

As long as the answer to (1) is yes, you can take a positive review from me.



---

archive/issue_comments_487786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-08T05:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_487787.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-11-08T05:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487787",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_487788.json:
```json
{
    "body": "Thank you for the feedback!\n\n(2) Done.\n\n(1) The answer used to be no (I had incorrectly assumed that `u` uniquely identifies the isomorphism, which is manifestly untrue in characteristics 2 and 3), but it should be handled correctly now. This did require moving the comparison up from `baseWI` to `WeierstrassIsomorphism`, as the former knows nothing about the domain curve.\n\nSince the new changes are not totally trivial, I'll let you have another look rather than setting it to positive review right away.\n\nAnother question: Did you check all modifications in this branch or just the ones in \"diff without the dependencies\"?",
    "created_at": "2022-11-08T05:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487788",
    "user": "https://github.com/yyyyx4"
}
```

Thank you for the feedback!

(2) Done.

(1) The answer used to be no (I had incorrectly assumed that `u` uniquely identifies the isomorphism, which is manifestly untrue in characteristics 2 and 3), but it should be handled correctly now. This did require moving the comparison up from `baseWI` to `WeierstrassIsomorphism`, as the former knows nothing about the domain curve.

Since the new changes are not totally trivial, I'll let you have another look rather than setting it to positive review right away.

Another question: Did you check all modifications in this branch or just the ones in "diff without the dependencies"?



---

archive/issue_comments_487789.json:
```json
{
    "body": "I checked all. Can't check again right now as travelling.",
    "created_at": "2022-11-08T16:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487789",
    "user": "https://github.com/JohnCremona"
}
```

I checked all. Can't check again right now as travelling.



---

archive/issue_comments_487790.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-10T08:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487790",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_487791.json:
```json
{
    "body": "Thanks for the two extra changes. I like that the new sorting key code ends up several lines shorter!",
    "created_at": "2022-11-10T08:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487791",
    "user": "https://github.com/JohnCremona"
}
```

Thanks for the two extra changes. I like that the new sorting key code ends up several lines shorter!



---

archive/issue_comments_487792.json:
```json
{
    "body": "Thank you!\u2002I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch\u2009\u2014\u2009which you've reviewed.",
    "created_at": "2022-11-10T08:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487792",
    "user": "https://github.com/yyyyx4"
}
```

Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.



---

archive/issue_comments_487793.json:
```json
{
    "body": "Replying to [comment:7 Lorenz Panny]:\n> Thank you!\u2002I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch\u2009\u2014\u2009which you've reviewed.\n\nOK fine",
    "created_at": "2022-11-10T10:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487793",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:7 Lorenz Panny]:
> Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.

OK fine



---

archive/issue_events_030943.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-03T00:44:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34491#event-30943"
}
```



---

archive/issue_comments_487794.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-03T00:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34491#issuecomment-487794",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
