# Issue 34491: change sorting for WeierstrassIsomorphism

Issue created by migration from https://trac.sagemath.org/ticket/34728

Original creator: lorenz

Original creation time: 2022-11-07 06:37:10

CC:  cremona

Currently, `EllipticCurve_generic.automorphisms()` returns the automorphisms in a more or less arbitrary (albeit deterministic) order.

It is much more natural to users to receive a list with the identity and negation first, since they exist for any curve, then any other automorphisms that may exist. (I have personally seen code making this incorrect assumption.)

In this patch, we change `._richcmp_()` for `WeierstrassIsomorphism` in such a way that `[1]` and `[-1]` will appear first in a sorted list of automorphisms.

Diff without the dependencies: https://git.sagemath.org/sage.git/diff?id2=d92c9f4e4f671409ff695f4f294240492dbe7c86&id=6eaaf7e51cccaf7ea03890a2874f7f00eb7ab92c


---

Comment by lorenz created at 2022-11-07 07:19:19

Changing status from new to needs_review.


---

Comment by cremona created at 2022-11-07 11:13:11

Changing status from needs_review to needs_info.


---

Comment by cremona created at 2022-11-07 11:13:11

All looks good, and I agree with the sorting strategy.  Two questions: (1) when p=2 in the random test is it still the case that the second auto in the list is multiplcation by -1? (2) In the test for the length of the autos, for the last two cases you don't really need to put both 0 and 1728 in the list since they are equal :) But I will not insist.

As long as the answer to (1) is yes, you can take a positive review from me.


---

Comment by git created at 2022-11-08 05:12:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-11-08 05:23:36

Changing status from needs_info to needs_review.


---

Comment by lorenz created at 2022-11-08 05:23:36

Thank you for the feedback!

(2) Done.

(1) The answer used to be no (I had incorrectly assumed that `u` uniquely identifies the isomorphism, which is manifestly untrue in characteristics 2 and 3), but it should be handled correctly now. This did require moving the comparison up from `baseWI` to `WeierstrassIsomorphism`, as the former knows nothing about the domain curve.

Since the new changes are not totally trivial, I'll let you have another look rather than setting it to positive review right away.

Another question: Did you check all modifications in this branch or just the ones in "diff without the dependencies"?


---

Comment by cremona created at 2022-11-08 16:47:21

I checked all. Can't check again right now as travelling.


---

Comment by cremona created at 2022-11-10 08:39:58

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2022-11-10 08:39:58

Thanks for the two extra changes. I like that the new sorting key code ends up several lines shorter!


---

Comment by lorenz created at 2022-11-10 08:51:23

Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.


---

Comment by cremona created at 2022-11-10 10:06:18

Replying to [comment:7 Lorenz Panny]:
> Thank you! I'll also boldly go ahead and set #34722 to positive review, since the changes there are contained in this branch — which you've reviewed.

OK fine


---

Comment by vbraun created at 2022-12-03 00:44:49

Resolution: fixed
