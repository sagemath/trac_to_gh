# Issue 18381: sandpile revisions

Issue created by migration from https://trac.sagemath.org/ticket/18618

Original creator: dperkinson

Original creation time: 2015-06-05 15:28:40




---

Comment by dperkinson created at 2015-06-05 15:49:37

Changing component from PLEASE CHANGE to graph theory.


---

Comment by dperkinson created at 2015-06-05 15:49:37

Changing type from PLEASE CHANGE to enhancement.


---

Comment by dperkinson created at 2015-06-05 15:49:37

Changing keywords from "" to "sandpile".


---

Comment by dperkinson created at 2015-06-05 15:50:15

Revisions to sandpiles to be posted soon.


---

Attachment

Summary of revisions


---

Comment by dperkinson created at 2015-06-11 14:29:25

New commits:


---

Comment by dperkinson created at 2015-06-11 14:29:25

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-06-11 15:46:28

Doctest formatting is incorrect:

```
Sandpiles can be created from Graphs and DiGraphs.

sage: g = DiGraph({0:{1:2,2:4}, 1:{1:3,2:1}, 2:{1:7}}, weighted=True)
```

should be

```
Sandpiles can be created from Graphs and DiGraphs::

    sage: g = DiGraph({0:{1:2,2:4}, 1:{1:3,2:1}, 2:{1:7}}, weighted=True)
```

(and there are a few more formatting errors like this)


---

Comment by jdemeyer created at 2015-06-11 15:46:28

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-06-11 16:55:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dperkinson created at 2015-06-11 16:56:43

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-06-11 17:29:45

Hello,

From the patchbot

```
Building reference manual, first pass.

Warning: Missing title for sage.misc.six
Error building the documentation.
Traceback (most recent call last):
  File "/home/vincent/sage_patchbot/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/home/vincent/sage_patchbot/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/home/vincent/sage_patchbot/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/home/vincent/sage_patchbot/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [dynamics ] /home/vincent/sage_patchbot/local/lib/python2.7/site-packages/sage/sandpiles/sandpile.py:docstring of sage.sandpiles.sandpile:8: ERROR: Unexpected indentation.

make: *** [doc-html] Error 1
('Apply', '--', 6, 'seconds')
Traceback (most recent call last):
  File "/home/vincent/sage_patchbot/local/bin/patchbot/patchbot.py", line 871, in test_a_ticket
    do_or_die("$MAKE")
  File "/home/vincent/sage_patchbot/local/bin/patchbot/util.py", line 143, in do_or_die
    raise exn_class("{} {}".format(res, cmd))
Exception: 512 $MAKE
2015-06-11 19:01:41 +0200
(25, 'seconds')
```

If you see something red or yellow on the patchbot little ball (on the right top of the ticket description) then something is bad. You can then click on it to see what it is.


---

Comment by vdelecroix created at 2015-06-11 17:29:45

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2015-06-11 18:27:06

Some quick comments:

- You don't need `INPUT:` and `OUTPUT:` blocks if there is no input or output.
- You should format the `INPUT:` blocks like this:

```
INPUT:

- ``foo`` -- the bar
- ``param`` -- (default: 5) an integer we do something with that is typically
  the value 5, mainly I'm blabbing on to make this a longer line
- ``opt`` -- (optional) some optional argument
```

- Make classes "new-style" `class Foo(object):`.
- You should find a way to automize the `help()` method. It can be very painful to manage this by hand.
- For notes, you can use

```
.. NOTE::

    This is a note. Everything should be one level further indented than before.
```

- Similar for `.. WARNING::`
- You can't duplicate references. Instead reference them by `[NameOfReference]_`.
- The patchbot's error is saying the documentation doesn't build; in particular there is an indentation either needed or missing from somewhere.


---

Comment by dperkinson created at 2015-06-12 14:04:45

How does one run patchbot and view the errors?  (The only testing tool I have been using is sage -t, which showed that all tests passed.)


---

Comment by tscrim created at 2015-06-12 15:12:06

As Vincent said:
> If you see something red or yellow on the patchbot little ball (on the right top of the ticket description) then something is bad. You can then click on it to see what it is.

It's located next to the opened/last modifed data. Once you click the red circle, you should look at the (short) log for the patchbot data. Once the documentation builds (you should check this, the easiest way to do so is run `make docbuild` from the `$SAGE_ROOT` directory or `sage -docbuild all html` from anywhere) and push those changes, a patchbot will (eventually) come around and test the branch on this ticket again.


---

Comment by git created at 2015-06-14 15:20:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dperkinson created at 2015-06-14 15:37:56

I have just pushed changes in response to the (very helpful) comments above. The INPUT sections of the docstrings are all standardized now, as are the NOTE, WARNING, etc., sections.  ``SandpileExamples`` has the "new-class" style.  The help functions are now automated rather than hard-wired, as advised.

Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".

At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.


---

Comment by tscrim created at 2015-06-14 16:02:27

Replying to [comment:18 dperkinson]:
> I have just pushed changes in response to the (very helpful) comments above. The INPUT sections of the docstrings are all standardized now, as are the NOTE, WARNING, etc., sections.  ``SandpileExamples`` has the "new-class" style.  The help functions are now automated rather than hard-wired, as advised.

Looks good. This could potentially be used as a model for other parts of Sage.

> Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".

*tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.

> At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.

However there is currently a merge conflict with the latest beta. So you'll need to rebase it.


---

Comment by dperkinson created at 2015-06-14 17:31:55

Replying to [comment:19 tscrim]:
> Replying to [comment:18 dperkinson]:
> > I have just pushed changes in response to the (very helpful) comments above. The INPUT sections of the docstrings are all standardized now, as are the NOTE, WARNING, etc., sections.  ``SandpileExamples`` has the "new-class" style.  The help functions are now automated rather than hard-wired, as advised.
> 
> Looks good. This could potentially be used as a model for other parts of Sage.
> 
> > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> 
> *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> 

Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?
  
> > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> 
> However there is currently a merge conflict with the latest beta. So you'll need to rebase it.

I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.

What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?

Thanks very much for your time and advice!


---

Comment by tscrim created at 2015-06-14 17:42:28

Replying to [comment:20 dperkinson]:
> Replying to [comment:19 tscrim]:
> > Replying to [comment:18 dperkinson]:
> > > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> > 
> > *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> > 
> 
> Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?

Yes, that is correct. 

> > > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> > 
> > However there is currently a merge conflict with the latest beta. So you'll need to rebase it.
> 
> I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.
> 
> What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?
> 
> Thanks very much for your time and advice!

What you'll need to do is the following:

```
$ git fetch <remote_name> develop:develop
$ git checkout t/18618/sandpile_revisions     # If you aren't already in that branch
$ git merge develop

    Do the rebasing

$ git commit
$ make           # In the $SAGE_ROOT directory. This will take a *long* time
$ git trac push
```

where `<remote_name>` is likely `origin` (possibly `trac`).

For rebuilding Sage with the `make`, you might want to do these beforehand to help speed it up:

```
$ make doc-clean
$ export SAGE_NUM_THREADS=n
$ export MAKE='make -jn'
$ export SAGE_PARALLEL_SPKG_BUILD
```

where `n` is the number of processors on your computer. If it happens to fail during the doc-building part at the end, don't worry about it.


---

Comment by dperkinson created at 2015-06-14 18:06:47

Replying to [comment:21 tscrim]:
> Replying to [comment:20 dperkinson]:
> > Replying to [comment:19 tscrim]:
> > > Replying to [comment:18 dperkinson]:
> > > > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> > > 
> > > *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> > > 
> > 
> > Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?
> 
> Yes, that is correct. 
> 
> > > > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> > > 
> > > However there is currently a merge conflict with the latest beta. So you'll need to rebase it.
> > 
> > I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.
> > 
> > What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?
> > 
> > Thanks very much for your time and advice!
> 
> What you'll need to do is the following:
> {{{
> $ git fetch <remote_name> develop:develop
> $ git checkout t/18618/sandpile_revisions     # If you aren't already in that branch
> $ git merge develop
> 
>     Do the rebasing
> 
> $ git commit
> $ make           # In the $SAGE_ROOT directory. This will take a *long* time
> $ git trac push
> }}}
> where `<remote_name>` is likely `origin` (possibly `trac`).
>

Running "git merge develop" leads to the error:

Automatic merge failed; fix conflicts and then commit the result.
 
> For rebuilding Sage with the `make`, you might want to do these beforehand to help speed it up:
> {{{
> $ make doc-clean
> $ export SAGE_NUM_THREADS=n
> $ export MAKE='make -jn'
> $ export SAGE_PARALLEL_SPKG_BUILD
> }}}
> where `n` is the number of processors on your computer. If it happens to fail during the doc-building part at the end, don't worry about it.


---

Comment by tscrim created at 2015-06-14 18:09:16

That was what I expected. You need to handle the rebase. You will have to go and edit the file and look for `<<<<<<` and then `=====` and then `>>>>>>` (or something like that), these are the merge conflicts. You'll then make the files how you want them to be. You can also try `git mergetool`, but IMO the default mergetool isn't that good.


---

Comment by dperkinson created at 2015-06-14 18:41:22

Replying to [comment:22 dperkinson]:
> Replying to [comment:21 tscrim]:
> > Replying to [comment:20 dperkinson]:
> > > Replying to [comment:19 tscrim]:
> > > > Replying to [comment:18 dperkinson]:
> > > > > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> > > > 
> > > > *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> > > > 
> > > 
> > > Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?
> > 
> > Yes, that is correct. 
> > 
> > > > > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> > > > 
> > > > However there is currently a merge conflict with the latest beta. So you'll need to rebase it.
> > > 
> > > I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.
> > > 
> > > What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?
> > > 
> > > Thanks very much for your time and advice!
> > 
> > What you'll need to do is the following:
> > {{{
> > $ git fetch <remote_name> develop:develop
> > $ git checkout t/18618/sandpile_revisions     # If you aren't already in that branch
> > $ git merge develop
> > 
> >     Do the rebasing
> > 
> > $ git commit
> > $ make           # In the $SAGE_ROOT directory. This will take a *long* time
> > $ git trac push
> > }}}
> > where `<remote_name>` is likely `origin` (possibly `trac`).
> >
> 
> Running "git merge develop" leads to the error:
> 
> Automatic merge failed; fix conflicts and then commit the result.
>  
> > For rebuilding Sage with the `make`, you might want to do these beforehand to help speed it up:
> > {{{
> > $ make doc-clean
> > $ export SAGE_NUM_THREADS=n
> > $ export MAKE='make -jn'
> > $ export SAGE_PARALLEL_SPKG_BUILD
> > }}}
> > where `n` is the number of processors on your computer. If it happens to fail during the doc-building part at the end, don't worry about it.

Oops.  Entered "make doc clean" by accident.  Advice?


---

Comment by dperkinson created at 2015-06-14 18:56:51

Replying to [comment:24 dperkinson]:
> Replying to [comment:22 dperkinson]:
> > Replying to [comment:21 tscrim]:
> > > Replying to [comment:20 dperkinson]:
> > > > Replying to [comment:19 tscrim]:
> > > > > Replying to [comment:18 dperkinson]:
> > > > > > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> > > > > 
> > > > > *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> > > > > 
> > > > 
> > > > Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?
> > > 
> > > Yes, that is correct. 
> > > 
> > > > > > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> > > > > 
> > > > > However there is currently a merge conflict with the latest beta. So you'll need to rebase it.
> > > > 
> > > > I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.
> > > > 
> > > > What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?
> > > > 
> > > > Thanks very much for your time and advice!
> > > 
> > > What you'll need to do is the following:
> > > {{{
> > > $ git fetch <remote_name> develop:develop
> > > $ git checkout t/18618/sandpile_revisions     # If you aren't already in that branch
> > > $ git merge develop
> > > 
> > >     Do the rebasing
> > > 
> > > $ git commit
> > > $ make           # In the $SAGE_ROOT directory. This will take a *long* time
> > > $ git trac push
> > > }}}
> > > where `<remote_name>` is likely `origin` (possibly `trac`).
> > >
> > 
> > Running "git merge develop" leads to the error:
> > 
> > Automatic merge failed; fix conflicts and then commit the result.
> >  
> > > For rebuilding Sage with the `make`, you might want to do these beforehand to help speed it up:
> > > {{{
> > > $ make doc-clean
> > > $ export SAGE_NUM_THREADS=n
> > > $ export MAKE='make -jn'
> > > $ export SAGE_PARALLEL_SPKG_BUILD
> > > }}}
> > > where `n` is the number of processors on your computer. If it happens to fail during the doc-building part at the end, don't worry about it.
> 
> Oops.  Entered "make doc clean" by accident.  Advice?

I just hit ctrl-C, then entered "make distclean" and proceeded as suggested above.  Hope that works.  Thanks again for your help.


---

Comment by git created at 2015-06-14 23:18:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dperkinson created at 2015-06-14 23:30:24

Replying to [comment:25 dperkinson]:
> Replying to [comment:24 dperkinson]:
> > Replying to [comment:22 dperkinson]:
> > > Replying to [comment:21 tscrim]:
> > > > Replying to [comment:20 dperkinson]:
> > > > > Replying to [comment:19 tscrim]:
> > > > > > Replying to [comment:18 dperkinson]:
> > > > > > > Should I remove every instance of INPUT for which there is no input (None) and, separately, every instance of OUTPUT for which there is no output (None)?  The documentation for developers at sagemath.org states that every function must have an INPUT and OUTPUT statement, and further that this "is not optional".
> > > > > > 
> > > > > > *tries to put politics aside* These add clutter to the docstring and are a _very_ good exception to the rule. So yes, please remove them.
> > > > > > 
> > > > > 
> > > > > Just to be completely clear: suppose, for example, that I have a docstring with None listed under INPUT and integer listed under OUTPUT.  Then I should remove the INPUT section, leaving the OUTPUT section, right?
> > > > 
> > > > Yes, that is correct. 
> > > > 
> > > > > > > At any rate, for this new version, with my local version of Sage, all tests passed for "sage -t", and the html and pdf documentation built without problems.
> > > > > > 
> > > > > > However there is currently a merge conflict with the latest beta. So you'll need to rebase it.
> > > > > 
> > > > > I am new to git, so I could use some guidance here.  I have been working in a directory called git-trac-command.  The output from "git branch" shows two branches: ``master`` and ``t/18618/sandpile_revisions``, with an asterisk next to the latter.  After my initial git push command, I have modified files in another, separate, copy of sage.  When I done making and testing the revisions, I copy the relevant modified files (sandpile.py, examples.py, etc.) to git-trac-command/src/sage/sandpiles.  I then run ``./sage -br``, ``git add NEW FILES``, ``git commit``, and ``git trac push``.
> > > > > 
> > > > > What is the sequence of commands I should enter to resolve the current conflict?  Also, what should I have done originally to have avoided the conflict?
> > > > > 
> > > > > Thanks very much for your time and advice!
> > > > 
> > > > What you'll need to do is the following:
> > > > {{{
> > > > $ git fetch <remote_name> develop:develop
> > > > $ git checkout t/18618/sandpile_revisions     # If you aren't already in that branch
> > > > $ git merge develop
> > > > 
> > > >     Do the rebasing
> > > > 
> > > > $ git commit
> > > > $ make           # In the $SAGE_ROOT directory. This will take a *long* time
> > > > $ git trac push
> > > > }}}
> > > > where `<remote_name>` is likely `origin` (possibly `trac`).
> > > >
> > > 
> > > Running "git merge develop" leads to the error:
> > > 
> > > Automatic merge failed; fix conflicts and then commit the result.
> > >  
> > > > For rebuilding Sage with the `make`, you might want to do these beforehand to help speed it up:
> > > > {{{
> > > > $ make doc-clean
> > > > $ export SAGE_NUM_THREADS=n
> > > > $ export MAKE='make -jn'
> > > > $ export SAGE_PARALLEL_SPKG_BUILD
> > > > }}}
> > > > where `n` is the number of processors on your computer. If it happens to fail during the doc-building part at the end, don't worry about it.
> > 
> > Oops.  Entered "make doc clean" by accident.  Advice?
> 
> I just hit ctrl-C, then entered "make distclean" and proceeded as suggested above.  Hope that works.  Thanks again for your help.

Done.  Hope that worked.


---

Comment by tscrim created at 2015-06-15 05:19:51

Yes, that worked. Next is to fix the doctests as noted by the patchbot.


---

Comment by git created at 2015-06-15 21:49:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dperkinson created at 2015-06-15 21:52:44

The function ``random_DAG`` is used elsewhere in sage (``sage/graphs/graph_decompositions/vertex_separation.pyx``).  So I will hold off deprecating it.  It might be a good idea to add ``random_DAG`` to the graph examples, e.g., ``graphs.random_DAG``.


---

Comment by git created at 2015-06-18 18:15:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-19 17:09:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-22 00:44:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-22 15:56:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dperkinson created at 2015-06-30 17:41:41

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-07-12 08:19:36

Please set up a git branch on trac to review, so that one can get changes in out git fetch/git merge.


---

Comment by dimpase created at 2015-07-12 08:19:36

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2015-07-12 08:24:00

oops, sorry, it's OK, in fact.


---

Comment by dimpase created at 2015-07-12 08:24:00

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2015-07-12 08:36:23

for some reason I have the following conflict when I try to merge the changes into Sage 6.8.beta8:

```
<<<<<<< HEAD
            processed_g = {}
            for k in g.keys():
                temp = {}
                for vertex in g[k]:
                    temp[vertex] = 1
                processed_g[k] = temp
            g = processed_g
        elif isinstance(g, Graph):
            processed_g = {}
            for v in g.vertices():
                edges = {}
                for n in g.neighbors(v):
                    if (isinstance(g.edge_label(v,n), int)
                            and g.edge_label(v,n) >= 0):
                        edges[n] = g.edge_label(v,n)
                    else:
                        edges[n] = 1
                processed_g[v] = edges
            g = processed_g
        elif isinstance(g, DiGraph):
            processed_g = {}
            for v in g.vertices():
                edges = {}
                for n in g.neighbors_out(v):
                    if (isinstance(g.edge_label(v,n), int)
                            and g.edge_label(v,n) >= 0):
                        edges[n] = g.edge_label(v,n)
                    else:
                        edges[n] = 1
                processed_g[v] = edges
=======
            processed_g = {i:dict(Counter(g[i])) for i in g}
>>>>>>> trac/u/dperkinson/sandpile_revisions
```


in `src/sage/sandpiles/sandpile.py`; i.e. you want to replace everything between `<<<<< HEAD` and `========`
with the stuff after `======`. Is this correct? 

(It would be great if you do the rebase yourself, but if you don't know how, please say so).


---

Comment by dimpase created at 2015-07-12 08:43:00

Changing status from needs_review to needs_work.


---

Comment by dperkinson created at 2015-07-12 16:27:05

Yes, I could use some help with rebasing.  First, could you please explain why rebasing has become necessary (so that I can understand better what is going on)?  Next, I actually did manage to rebase once earlier.  At that time, I was told to issue the following commands:

 $ git fetch trac develop:develop
 $ git checkout t/18618/sandpile_revisions     # If you aren't already in
 that branch
 $ git merge develop
 $ git commit
 $ make
 $ git trac push

I remember running into complications but foolishly did not record how things were resolved.  My first questions:

1. Just to be sure, I should issue these commands from my git-trac-command directory (from where I have been pushing all of my changes).  Is that right?

2. After issuing the 'git merge develop' command, I get the following error message:
----------------
error: Your local changes to the following files would be overwritten by merge:
	src/sage/sandpiles/sandpile.py
Please, commit your changes or stash them before you can merge.
Aborting
----------------
Does this mean I should add my sandpile changes and commit before entering 'git merge develop'?

Thanks very much for any help!




Replying to [comment:40 dimpase]:
> for some reason I have the following conflict when I try to merge the changes into Sage 6.8.beta8:
> {{{
> <<<<<<< HEAD
>             processed_g = {}
>             for k in g.keys():
>                 temp = {}
>                 for vertex in g[k]:
>                     temp[vertex] = 1
>                 processed_g[k] = temp
>             g = processed_g
>         elif isinstance(g, Graph):
>             processed_g = {}
>             for v in g.vertices():
>                 edges = {}
>                 for n in g.neighbors(v):
>                     if (isinstance(g.edge_label(v,n), int)
>                             and g.edge_label(v,n) >= 0):
>                         edges[n] = g.edge_label(v,n)
>                     else:
>                         edges[n] = 1
>                 processed_g[v] = edges
>             g = processed_g
>         elif isinstance(g, DiGraph):
>             processed_g = {}
>             for v in g.vertices():
>                 edges = {}
>                 for n in g.neighbors_out(v):
>                     if (isinstance(g.edge_label(v,n), int)
>                             and g.edge_label(v,n) >= 0):
>                         edges[n] = g.edge_label(v,n)
>                     else:
>                         edges[n] = 1
>                 processed_g[v] = edges
> =======
>             processed_g = {i:dict(Counter(g[i])) for i in g}
> >>>>>>> trac/u/dperkinson/sandpile_revisions
> }}}
> 
> in `src/sage/sandpiles/sandpile.py`; i.e. you want to replace everything between `<<<<< HEAD` and `========`
> with the stuff after `======`. Is this correct? 
> 
> (It would be great if you do the rebase yourself, but if you don't know how, please say so).


---

Comment by dimpase created at 2015-07-12 21:48:11

Replying to [comment:42 dperkinson]:
> Yes, I could use some help with rebasing.  First, could you please explain why rebasing has become necessary (so that I can understand better what is going on)?  Next, I actually did manage to rebase once earlier.  At that time, I was told to issue the following commands:
> 
>  $ git fetch trac develop:develop
>  $ git checkout t/18618/sandpile_revisions     # If you aren't already in
>  that branch
>  $ git merge develop
>  $ git commit
>  $ make
>  $ git trac push
> 
> I remember running into complications but foolishly did not record how things were resolved.  My first questions:
> 
> 1. Just to be sure, I should issue these commands from my git-trac-command directory (from where I have been pushing all of my changes).  Is that right?

No, git-trac-command has nothing to do with this, expect that the last command, `git trac push`, uses functionality enabled
by `git trac` extension to `git`. But this is totally orthogonal to doing development in git-trac-command directory, which should just host a reasonably updated version of `git trac`, but nothing else (and you might need to add it to your PATH, as described in `git trac` docs, but again this has nothing to do with issuing commands from there...).
You certainly should not do your sandpiles development in this directory.
In fact, your development should just overwrite Sage (beta) release number whatever...

> 
> 2. After issuing the 'git merge develop' command, I get the following error message:
> ----------------
> error: Your local changes to the following files would be overwritten by merge:
> 	src/sage/sandpiles/sandpile.py
> Please, commit your changes or stash them before you can merge.
> Aborting

yes, this might be a symptom of keeping updated files in a wrong place. 



> ----------------
> Does this mean I should add my sandpile changes and commit before entering 'git merge develop'?

Well, certainly you need to commit your local changes before you can do any git processing on them, 
but now I can only guess what exactly is happening with your directories.
Do you even have a Sage source tree in the directory you issue your git commands from?!

Did you start your revision work from some Sage version under (git) revision control, or from your own private version, without any
git repo?


---

Comment by dperkinson created at 2015-07-12 21:52:22

I exactly followed the instructions on this page:

http://doc.sagemath.org/html/en/developer/index.html#the-git-trac-command

Replying to [comment:43 dimpase]:
> Replying to [comment:42 dperkinson]:
> > Yes, I could use some help with rebasing.  First, could you please explain why rebasing has become necessary (so that I can understand better what is going on)?  Next, I actually did manage to rebase once earlier.  At that time, I was told to issue the following commands:
> > 
> >  $ git fetch trac develop:develop
> >  $ git checkout t/18618/sandpile_revisions     # If you aren't already in
> >  that branch
> >  $ git merge develop
> >  $ git commit
> >  $ make
> >  $ git trac push
> > 
> > I remember running into complications but foolishly did not record how things were resolved.  My first questions:
> > 
> > 1. Just to be sure, I should issue these commands from my git-trac-command directory (from where I have been pushing all of my changes).  Is that right?
> 
> No, git-trac-command has nothing to do with this, expect that the last command, `git trac push`, uses functionality enabled
> by `git trac` extension to `git`. But this is totally orthogonal to doing development in git-trac-command directory, which should just host a reasonably updated version of `git trac`, but nothing else (and you might need to add it to your PATH, as described in `git trac` docs, but again this has nothing to do with issuing commands from there...).
> You certainly should not do your sandpiles development in this directory.
> In fact, your development should just overwrite Sage (beta) release number whatever...
> 
> > 
> > 2. After issuing the 'git merge develop' command, I get the following error message:
> > ----------------
> > error: Your local changes to the following files would be overwritten by merge:
> > 	src/sage/sandpiles/sandpile.py
> > Please, commit your changes or stash them before you can merge.
> > Aborting
> 
> yes, this might be a symptom of keeping updated files in a wrong place. 
> 
> 
> 
> > ----------------
> > Does this mean I should add my sandpile changes and commit before entering 'git merge develop'?
> 
> Well, certainly you need to commit your local changes before you can do any git processing on them, 
> but now I can only guess what exactly is happening with your directories.
> Do you even have a Sage source tree in the directory you issue your git commands from?!
> 
> Did you start your revision work from some Sage version under (git) revision control, or from your own private version, without any
> git repo?
>


---

Comment by dperkinson created at 2015-07-12 21:55:45

Here is a listing of the directory in which I have been doing my work (and it has worked fine up until this point, even rebasing once earlier):

xyzzy> pwd
/home/davidp/sage-devel/git-trac-command
xyzzy> ls
bootstrap*  config.log`@`     configure.ac  local/  Makefile    src/
build/      config.status*  COPYING.txt   logs/   README.txt  upstream/
config/     configure*      git_trac/     m4/     sage*       VERSION.txt


---

Comment by dimpase created at 2015-07-12 22:03:50

Replying to [comment:44 dperkinson]:
> I exactly followed the instructions on this page:
> 
> http://doc.sagemath.org/html/en/developer/index.html#the-git-trac-command


Ah, I see you took 

```
[user@localhost]$ echo $PATH
/home/user/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin
[user@localhost]$ cd git-trac-command
[user@localhost git-trac-command]$ ln -s `pwd`/git-trac ~/bin/
```

as an instruction to do everything in this directory... But it is only meant to tell you how to set up your `git trac` workflow; once you are done with the latter, you have to go somewhere you want your Sage files to do `git clone`.

But surely you should not keep your Sage code there. My brain aches when I try to think what happens if you clone one git repo in the same place as your another repo...

OK, I'll add a line in the manual explaining this.

From what I see from git logs, you started off from Sage 6.8.beta3, and then rebased over beta4 for some reason I don't get - nobody changed any files you touched...

OK, It's getting late here in Oxford, I'll resume tomorrow.


---

Comment by dperkinson created at 2015-07-12 22:08:47

I was specifically requested to rebase.  If I remember correctly, the problem might not have been in one of the files I touched but in an example used for conway_polynomials.

Thanks for your help.


---

Comment by dimpase created at 2015-07-13 14:59:10

As it is longer to explain how to proceed than to do it myself, I record steps I undertake;
please feel free to ask for explanation.
Start by cloning a clean Sage 6.8.beta8 (described in the manual). Go to its root, and do


```
$ git fetch trac u/dperkinson/sandpile_revisions
From trac.sagemath.org:sage
 * branch            u/dperkinson/sandpile_revisions -> FETCH_HEAD
clpc171[/home/scratch/dimpase/sage/tmp]$ git merge FETCH_HEAD
Auto-merging src/sage/sandpiles/sandpile.py
CONFLICT (content): Merge conflict in src/sage/sandpiles/sandpile.py
Automatic merge failed; fix conflicts and then commit the result.
clpc171[/home/scratch/dimpase/sage/tmp]$ git status
On branch newsp
You have unmerged paths.
  (fix conflicts and run "git commit")

Changes to be committed:

	modified:   src/doc/en/thematic_tutorials/sandpile.rst
	modified:   src/sage/sandpiles/all.py
	new file:   src/sage/sandpiles/examples.py

Unmerged paths:
  (use "git add <file>..." to mark resolution)

	both modified:   src/sage/sandpiles/sandpile.py
```


ok, so we need to sort out the conflict (cf. e.g. https://help.github.com/articles/resolving-a-merge-conflict-from-the-command-line/)

serach for `HEAD` in the output of the following:


```
$ git blame  src/sage/sandpiles/sandpile.py
...
00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  598) <<<<<<< HEAD
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  599)             processed_g = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  600)             for k in g.keys():
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  601)                 temp = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  602)                 for vertex in g[k]:
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  603)                     temp[vertex] = 1
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  604)                 processed_g[k] = temp
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  605)             g = processed_g
617b158e (Wilfried Luebbe       2014-03-28 16:56:44 +0100  606)         elif isinstance(g, Graph):
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  607)             processed_g = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  608)             for v in g.vertices():
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  609)                 edges = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  610)                 for n in g.neighbors(v):
e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  611)                     if (isinstance(g.edge_label(v,n), int)
e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  612)                             and g.edge_label(v,n) >= 0):
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  613)                         edges[n] = g.edge_label(v,n)
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  614)                     else:
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  615)                         edges[n] = 1
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  616)                 processed_g[v] = edges
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  617)             g = processed_g
617b158e (Wilfried Luebbe       2014-03-28 16:56:44 +0100  618)         elif isinstance(g, DiGraph):
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  619)             processed_g = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  620)             for v in g.vertices():
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  621)                 edges = {}
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  622)                 for n in g.neighbors_out(v):
e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  623)                     if (isinstance(g.edge_label(v,n), int)
e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  624)                             and g.edge_label(v,n) >= 0):
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  625)                         edges[n] = g.edge_label(v,n)
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  626)                     else:
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  627)                         edges[n] = 1
07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  628)                 processed_g[v] = edges
00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  629) =======
9e022d84 (David Perkinson       2015-06-11 07:10:23 -0700  630)             processed_g = {i:dict(Counter(g[i])) for i in g}
00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  631) >>>>>>> FETCH_HEAD
...
```


here (look at its date!) is the commit that prevents a clean merge:

```
commit e82c8f99d6493f48d3a02c598fc723e693f5616f
Author: Jeroen Demeyer <jdemeyer@cage.ugent.be>
Date:   Mon Jun 29 11:01:23 2015 +0200

    Fix suspicious isinstance() changes
```

as it changes stuff in a place that has to be removed, we can basically ignore it.
(that is, when rebasing, the corresponding chunk can just be removed).


Now open `src/sage/sandpiles/sandpile.py` in an editor and remove the lines between `<<<..< HEAD` and `====`, 
as well as the lines with `<<<..< HEAD`, `====`, and `>>>>>>> FETCH_HEAD`. Now we can commit our changes.

```
$ git add src/sage/sandpiles/sandpile.py
$ git commit -m "rebased over that e82c8f99d6493f48d3a02c598fc723e693f5616f"
```

Now locally everything is OK, run tests, etc...
Finally, I push it to trac (not using `git trac`, but rather "git the hard way" :-))

```
$ git push trac --set-upstream HEAD:public/sandpile_updates
```

and in the browser replace your (broken, shown in red) Branch: `u/dperkinson/sandpile_revisions` with `public/sandpile_updates`. And click Submit. (your branch is still there on the server, by the way, and your commits are in the new branch (click on `commits` to see this)).
----
New commits:


---

Comment by dimpase created at 2015-07-13 15:05:04

Changing status from needs_work to positive_review.


---

Comment by dimpase created at 2015-07-13 15:05:04

IMHO the code would be much cleaner if you split it into a number of files; e.g. one file for
`Sandpile` class, one for `SandpileConfig`, one for `SandpileDivisor`, and one for global functions (starting from `def sandlib()`). Would you mind doing such a split? (Maybe on another ticket...)


---

Comment by dimpase created at 2015-07-13 15:09:03

Changing status from positive_review to needs_info.


---

Comment by dimpase created at 2015-07-13 15:09:03

you still have

```
       except IOError:
            print """
                 **********************************
                 *** This method requires 4ti2. ***
                 **********************************
            """
```

did you forget to remove this?


---

Comment by dperkinson created at 2015-07-13 16:19:41

That's a good idea.  The file has grown over time. I'd be happy to do this in another ticket.  I would prefer to wait until the current revisions are incorporated into Sage, though.
Replying to [comment:49 dimpase]:
> IMHO the code would be much cleaner if you split it into a number of files; e.g. one file for
> `Sandpile` class, one for `SandpileConfig`, one for `SandpileDivisor`, and one for global functions (starting from `def sandlib()`). Would you mind doing such a split? (Maybe on another ticket...)


---

Comment by dperkinson created at 2015-07-13 16:25:47

This is not a mistake.  The `except` statement appears in `set_linear_system`.  I have deprecated some methods that use `_set_linear_system`.  If someone still wants to use those methods and hasn't installed 4ti2, I guess they should be told what the problem is.  In a year, when the deprecated methods are removed, I will also remove `_set_linear_system`.
 
Replying to [comment:50 dimpase]:
> you still have
> {{{
>        except IOError:
>             print """
>                  **********************************
>                  *** This method requires 4ti2. ***
>                  **********************************
>             """
> }}}
> did you forget to remove this?


---

Comment by dimpase created at 2015-07-13 16:26:46

Changing status from needs_info to positive_review.


---

Comment by dperkinson created at 2015-07-13 16:36:39

Wow.  That's pretty complicated.  Thanks for your help.

Just to make sure: if I am understanding correctly, you have just done everything that needs to be done for the moment.  In other words, the rebasing is done, right?

In case further revisions are necessary, would it make sense for me now to start from a clean slate on my local machine, following the directions on the git-trac page (making sure to clone into a separate clean directory)?  

Thanks again.
 
Replying to [comment:48 dimpase]:
> As it is longer to explain how to proceed than to do it myself, I record steps I undertake;
> please feel free to ask for explanation.
> Start by cloning a clean Sage 6.8.beta8 (described in the manual). Go to its root, and do
> 
> {{{
> $ git fetch trac u/dperkinson/sandpile_revisions
> From trac.sagemath.org:sage
>  * branch            u/dperkinson/sandpile_revisions -> FETCH_HEAD
> clpc171[/home/scratch/dimpase/sage/tmp]$ git merge FETCH_HEAD
> Auto-merging src/sage/sandpiles/sandpile.py
> CONFLICT (content): Merge conflict in src/sage/sandpiles/sandpile.py
> Automatic merge failed; fix conflicts and then commit the result.
> clpc171[/home/scratch/dimpase/sage/tmp]$ git status
> On branch newsp
> You have unmerged paths.
>   (fix conflicts and run "git commit")
> 
> Changes to be committed:
> 
> 	modified:   src/doc/en/thematic_tutorials/sandpile.rst
> 	modified:   src/sage/sandpiles/all.py
> 	new file:   src/sage/sandpiles/examples.py
> 
> Unmerged paths:
>   (use "git add <file>..." to mark resolution)
> 
> 	both modified:   src/sage/sandpiles/sandpile.py
> }}}
> 
> ok, so we need to sort out the conflict (cf. e.g. https://help.github.com/articles/resolving-a-merge-conflict-from-the-command-line/)
> 
> serach for `HEAD` in the output of the following:
> 
> {{{
> $ git blame  src/sage/sandpiles/sandpile.py
> ...
> 00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  598) <<<<<<< HEAD
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  599)             processed_g = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  600)             for k in g.keys():
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  601)                 temp = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  602)                 for vertex in g[k]:
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  603)                     temp[vertex] = 1
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  604)                 processed_g[k] = temp
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  605)             g = processed_g
> 617b158e (Wilfried Luebbe       2014-03-28 16:56:44 +0100  606)         elif isinstance(g, Graph):
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  607)             processed_g = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  608)             for v in g.vertices():
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  609)                 edges = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  610)                 for n in g.neighbors(v):
> e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  611)                     if (isinstance(g.edge_label(v,n), int)
> e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  612)                             and g.edge_label(v,n) >= 0):
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  613)                         edges[n] = g.edge_label(v,n)
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  614)                     else:
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  615)                         edges[n] = 1
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  616)                 processed_g[v] = edges
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  617)             g = processed_g
> 617b158e (Wilfried Luebbe       2014-03-28 16:56:44 +0100  618)         elif isinstance(g, DiGraph):
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  619)             processed_g = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  620)             for v in g.vertices():
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  621)                 edges = {}
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  622)                 for n in g.neighbors_out(v):
> e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  623)                     if (isinstance(g.edge_label(v,n), int)
> e82c8f99 (Jeroen Demeyer        2015-06-29 11:01:23 +0200  624)                             and g.edge_label(v,n) >= 0):
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  625)                         edges[n] = g.edge_label(v,n)
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  626)                     else:
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  627)                         edges[n] = 1
> 07981740 (Marshall Hampton      2011-01-12 00:17:35 -0600  628)                 processed_g[v] = edges
> 00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  629) =======
> 9e022d84 (David Perkinson       2015-06-11 07:10:23 -0700  630)             processed_g = {i:dict(Counter(g[i])) for i in g}
> 00000000 (Not Committed Yet     2015-07-13 15:28:41 +0100  631) >>>>>>> FETCH_HEAD
> ...
> }}}
> 
> here (look at its date!) is the commit that prevents a clean merge:
> {{{
> commit e82c8f99d6493f48d3a02c598fc723e693f5616f
> Author: Jeroen Demeyer <jdemeyer`@`cage.ugent.be>
> Date:   Mon Jun 29 11:01:23 2015 +0200
> 
>     Fix suspicious isinstance() changes
> }}}
> as it changes stuff in a place that has to be removed, we can basically ignore it.
> (that is, when rebasing, the corresponding chunk can just be removed).
> 
> 
> Now open `src/sage/sandpiles/sandpile.py` in an editor and remove the lines between `<<<..< HEAD` and `====`, 
> as well as the lines with `<<<..< HEAD`, `====`, and `>>>>>>> FETCH_HEAD`. Now we can commit our changes.
> {{{
> $ git add src/sage/sandpiles/sandpile.py
> $ git commit -m "rebased over that e82c8f99d6493f48d3a02c598fc723e693f5616f"
> }}}
> Now locally everything is OK, run tests, etc...
> Finally, I push it to trac (not using `git trac`, but rather "git the hard way" :-))
> {{{
> $ git push trac --set-upstream HEAD:public/sandpile_updates
> }}}
> and in the browser replace your (broken, shown in red) Branch: `u/dperkinson/sandpile_revisions` with `public/sandpile_updates`. And click Submit. (your branch is still there on the server, by the way, and your commits are in the new branch (click on `commits` to see this)).
> ----
> New commits:
> ||[249b647](http://git.sagemath.org/sage.git/commit/?id=249b64720653fdd434e76336b442c1bbd5b6fe2c)||`rebased over that e82c8f99d6493f48d3a02c598fc723e693f5616f`||


---

Comment by dimpase created at 2015-07-13 19:37:09

Replying to [comment:54 dperkinson]:
> Wow.  That's pretty complicated.  Thanks for your help.
> 
no, not really. Git is just an interface to a directed acyclic graph on changes to files :-)

Also, `git blame` part is entirely optional. Them there isn't much beyond the standard merge conflict
resolution, as explained in https://help.github.com/articles/resolving-a-merge-conflict-from-the-command-line/


> Just to make sure: if I am understanding correctly, you have just done everything that needs to be done for the moment.  In other words, the rebasing is done, right?
> 
right. 

> In case further revisions are necessary, would it make sense for me now to start from a clean slate on my local machine, following the directions on the git-trac page (making sure to clone into a separate clean directory)?  

You could try just fetching the new branch `public/sandpile_updates` from trac and merging it over your current working setup (beforehand you have to commit or stash all your changes, as always).
More precisely, first create a new branch (to have a way to refer to the new branch of your code DAG to be grown), 
by `git checkout -b Foo`
Then do `git fetch trac public/sandpile_updates` followed by `git merge FETCH_HEAD`.

If this works then you are all set to do extra changes, which you would commit (into Foo branch) and then do
`git push trac --set-upstream HEAD:public/sandpile_updates` to update the remote branch.

PS. I seldom use `git-trac` extension nowadays, it's too inflexible for me.


---

Comment by vbraun created at 2015-07-14 20:42:55

Resolution: fixed


---

Comment by ncohen created at 2015-07-14 20:56:17

> The function ``random_DAG`` is used elsewhere in sage (``sage/graphs/graph_decompositions/vertex_separation.pyx``).  So I will hold off deprecating it.

It is used in one doctest only, and it can be replaced easily by `digraphs.TransitiveTournament(20)` if needed.

Nathann
