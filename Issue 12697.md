# Issue 12697: The warn-links option shouldn't allways triggers full doc compilation.

archive/issues_012697.json:
```json
{
    "body": "Assignee: @hivert\n\nKeywords: Broken links, warnings\n\nTitle says all. See [This tread](http://groups.google.com/group/sage-devel/browse_thread/thread/73971d04ede1bca3/e2327f6c7ab1bcf9?lnk=gst&q=Advertising#e2327f6c7ab1bcf9).\n\nFlorent\n\nIssue created by migration from https://trac.sagemath.org/ticket/12869\n\n",
    "created_at": "2012-04-23T10:50:35Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "The warn-links option shouldn't allways triggers full doc compilation.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12697",
    "user": "https://github.com/hivert"
}
```
Assignee: @hivert

Keywords: Broken links, warnings

Title says all. See [This tread](http://groups.google.com/group/sage-devel/browse_thread/thread/73971d04ede1bca3/e2327f6c7ab1bcf9?lnk=gst&q=Advertising#e2327f6c7ab1bcf9).

Florent

Issue created by migration from https://trac.sagemath.org/ticket/12869





---

archive/issue_comments_151482.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-23T10:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151482",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_151483.json:
```json
{
    "body": "Does not apply on Sage-5.0.beta13...",
    "created_at": "2012-04-23T22:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151483",
    "user": "https://github.com/novoselt"
}
```

Does not apply on Sage-5.0.beta13...



---

archive/issue_comments_151484.json:
```json
{
    "body": "Replying to [comment:2 novoselt]:\n> Does not apply on Sage-5.0.beta13...\n\nSorry ! I forgot to tell it depend on #12849",
    "created_at": "2012-04-23T22:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151484",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:2 novoselt]:
> Does not apply on Sage-5.0.beta13...

Sorry ! I forgot to tell it depend on #12849



---

archive/issue_comments_151485.json:
```json
{
    "body": "Hmmm, where is \"--warn-links\" option described (except for #9128)? I don't see it in the command line help.",
    "created_at": "2012-04-23T22:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151485",
    "user": "https://github.com/novoselt"
}
```

Hmmm, where is "--warn-links" option described (except for #9128)? I don't see it in the command line help.



---

archive/issue_comments_151486.json:
```json
{
    "body": "Look carefully ;-)\n\n```\n$ sage -docbuild help\nUsage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)\n\nBuild or return information about Sage documentation.\n    DOCUMENT    name of the document to build\n    FORMAT      document output format\n    COMMAND     document-specific command\nA DOCUMENT and either a FORMAT or a COMMAND are required,\nunless a list of one or more of these is requested.\n\nOPTIONS:\n  Standard:\n    [...]\n    --warn-links        issue a warning whenever a link is not properly\n                        resolved; equivalent to '--sphinx-opts -n' (sphinx\n                        option: nitpicky)\n    [...]\n```\n\n\nFlorent",
    "created_at": "2012-04-23T22:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151486",
    "user": "https://github.com/hivert"
}
```

Look carefully ;-)

```
$ sage -docbuild help
Usage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)

Build or return information about Sage documentation.
    DOCUMENT    name of the document to build
    FORMAT      document output format
    COMMAND     document-specific command
A DOCUMENT and either a FORMAT or a COMMAND are required,
unless a list of one or more of these is requested.

OPTIONS:
  Standard:
    [...]
    --warn-links        issue a warning whenever a link is not properly
                        resolved; equivalent to '--sphinx-opts -n' (sphinx
                        option: nitpicky)
    [...]
```


Florent



---

archive/issue_comments_151487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-24T00:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151487",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_151488.json:
```json
{
    "body": "Aha, then my complain is: how should I know that \"sage -docbuild help\" works? It does not seem that it is visible in \"sage -advanced\" and it is not something common to other options.\n\nRegarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.",
    "created_at": "2012-04-24T00:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151488",
    "user": "https://github.com/novoselt"
}
```

Aha, then my complain is: how should I know that "sage -docbuild help" works? It does not seem that it is visible in "sage -advanced" and it is not something common to other options.

Regarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.



---

archive/issue_comments_151489.json:
```json
{
    "body": "Replying to [comment:6 novoselt]:\n> Regarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.\n\nHere are some details:\n\nIn the file `sphinx/environment.py`, the class `BuildEnvironment` is\nresponsible for handling the environment. It has a method called update which\ndecide which files should be rebuild. Here is the relevant code:\n\n```python\nclass BuildEnvironment:\n    [...]\n    def update(self, config, srcdir, doctreedir, app=None):\n        \"\"\"(Re-)read all files new or changed since last update.\n\n        Returns a summary, the total count of documents to reread and an\n        iterator that yields docnames as it processes them.  Store all\n        environment docnames in the canonical format (ie using SEP as a\n        separator in place of os.path.sep).\n        \"\"\"\n        config_changed = False\n        if self.config is None:\n            msg = '[new config] '\n            config_changed = True\n        else:\n            # check if a config value was changed that affects how\n            # doctrees are read\n            for key, descr in config.values.iteritems():\n                if descr[1] != 'env':\n                    continue\n                if self.config[key] != config[key]:\n                    msg = '[config changed] '\n                    config_changed = True\n                    break\n            [...]\n```\n\nSo I change `config.values['nitpick'][1]` from `'env'` to `'sage'`\nto make sure that config changed is not set.\n\nFlorent",
    "created_at": "2012-04-24T07:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151489",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:6 novoselt]:
> Regarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.

Here are some details:

In the file `sphinx/environment.py`, the class `BuildEnvironment` is
responsible for handling the environment. It has a method called update which
decide which files should be rebuild. Here is the relevant code:

```python
class BuildEnvironment:
    [...]
    def update(self, config, srcdir, doctreedir, app=None):
        """(Re-)read all files new or changed since last update.

        Returns a summary, the total count of documents to reread and an
        iterator that yields docnames as it processes them.  Store all
        environment docnames in the canonical format (ie using SEP as a
        separator in place of os.path.sep).
        """
        config_changed = False
        if self.config is None:
            msg = '[new config] '
            config_changed = True
        else:
            # check if a config value was changed that affects how
            # doctrees are read
            for key, descr in config.values.iteritems():
                if descr[1] != 'env':
                    continue
                if self.config[key] != config[key]:
                    msg = '[config changed] '
                    config_changed = True
                    break
            [...]
```

So I change `config.values['nitpick'][1]` from `'env'` to `'sage'`
to make sure that config changed is not set.

Florent



---

archive/issue_comments_151490.json:
```json
{
    "body": "I just spotted a miss-print in my patch\n\n```\n    ('py:class',' twisted.web2.resource.PostableResource'))\n```\n\nshould be\n\n```\n    ('py:class', 'twisted.web2.resource.PostableResource')) \n```\n\nMind the quote before twisted. I'm re-uploading the patch an sete back to needs-review.\n\nSorry,\n\nFlorent",
    "created_at": "2012-04-24T08:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151490",
    "user": "https://github.com/hivert"
}
```

I just spotted a miss-print in my patch

```
    ('py:class',' twisted.web2.resource.PostableResource'))
```

should be

```
    ('py:class', 'twisted.web2.resource.PostableResource')) 
```

Mind the quote before twisted. I'm re-uploading the patch an sete back to needs-review.

Sorry,

Florent



---

archive/issue_comments_151491.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-04-24T08:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151491",
    "user": "https://github.com/hivert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_151492.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-24T08:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151492",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_151493.json:
```json
{
    "body": "How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.",
    "created_at": "2012-04-24T14:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151493",
    "user": "https://github.com/novoselt"
}
```

How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.



---

archive/issue_comments_151494.json:
```json
{
    "body": "Replying to [comment:11 novoselt]:\n> How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.\n\nDid you really check that the broken links warning to `twisted.*` stuff where correctly silenced ?\n\nFlorent",
    "created_at": "2012-04-24T14:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151494",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:11 novoselt]:
> How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.

Did you really check that the broken links warning to `twisted.*` stuff where correctly silenced ?

Florent



---

archive/issue_comments_151495.json:
```json
{
    "body": "I checked that documentation recompilation was not triggered by adding/removing \"--warn-links\" after this patch applied. I thought that if a module has mismatched quotes, it will not load correctly and since the patch touches a single file - obviously it got processed since it changed the rebuilding behaviour.",
    "created_at": "2012-04-24T14:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151495",
    "user": "https://github.com/novoselt"
}
```

I checked that documentation recompilation was not triggered by adding/removing "--warn-links" after this patch applied. I thought that if a module has mismatched quotes, it will not load correctly and since the patch touches a single file - obviously it got processed since it changed the rebuilding behaviour.



---

archive/issue_comments_151496.json:
```json
{
    "body": "(It looks like there was a matching quote; there was just an extra leading space before \"twisted\".)",
    "created_at": "2012-04-24T15:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151496",
    "user": "https://github.com/jhpalmieri"
}
```

(It looks like there was a matching quote; there was just an extra leading space before "twisted".)



---

archive/issue_comments_151497.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-24T18:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151497",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_151498.json:
```json
{
    "body": "Yeap, I was too concentrated on that leading space...",
    "created_at": "2012-04-24T18:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151498",
    "user": "https://github.com/novoselt"
}
```

Yeap, I was too concentrated on that leading space...



---

archive/issue_comments_151499.json:
```json
{
    "body": "Replying to [comment:15 novoselt]:\n> Yeap, I was too concentrated on that leading space...\n\nThanks for the review... Next steps: \n- parallelisation of the doc build\n- table of contents for methods in a class.",
    "created_at": "2012-04-24T23:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151499",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:15 novoselt]:
> Yeap, I was too concentrated on that leading space...

Thanks for the review... Next steps: 
- parallelisation of the doc build
- table of contents for methods in a class.



---

archive/issue_comments_151500.json:
```json
{
    "body": "Just noticed a typo in the patch: \"environement\" should be \"environment\" (twice).  I understand the mistake though... :-)",
    "created_at": "2012-04-26T20:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151500",
    "user": "https://github.com/jdemeyer"
}
```

Just noticed a typo in the patch: "environement" should be "environment" (twice).  I understand the mistake though... :-)



---

archive/issue_comments_151501.json:
```json
{
    "body": "Attachment [trac_12869-nitpick_improve-fh.2.patch](tarball://root/attachments/some-uuid/ticket12869/trac_12869-nitpick_improve-fh.2.patch) by @novoselt created at 2012-04-26 20:21:40\n\nTypo fixes",
    "created_at": "2012-04-26T20:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151501",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_12869-nitpick_improve-fh.2.patch](tarball://root/attachments/some-uuid/ticket12869/trac_12869-nitpick_improve-fh.2.patch) by @novoselt created at 2012-04-26 20:21:40

Typo fixes



---

archive/issue_comments_151502.json:
```json
{
    "body": "Fixed.",
    "created_at": "2012-04-26T20:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151502",
    "user": "https://github.com/novoselt"
}
```

Fixed.



---

archive/issue_comments_151503.json:
```json
{
    "body": "Replying to [comment:18 novoselt]:\n> Fixed.\n\nOups ! Pardon my French ;-) \n\nFlorent",
    "created_at": "2012-04-26T20:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151503",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:18 novoselt]:
> Fixed.

Oups ! Pardon my French ;-) 

Florent



---

archive/issue_comments_151504.json:
```json
{
    "body": "Hi Jeroen,\n\nCould it be possible to have this one in 5.0 rather than 5.1, without it cleaning up the doc is really painful. \n\nFlorent",
    "created_at": "2012-04-30T16:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151504",
    "user": "https://github.com/hivert"
}
```

Hi Jeroen,

Could it be possible to have this one in 5.0 rather than 5.1, without it cleaning up the doc is really painful. 

Florent



---

archive/issue_comments_151505.json:
```json
{
    "body": "Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?",
    "created_at": "2012-04-30T21:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151505",
    "user": "https://github.com/jdemeyer"
}
```

Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?



---

archive/issue_comments_151506.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?\n\nIt depends on the time between the rc0 and the next beta0 release ;-) You are the boss on that. By the way, thanks a lot for your great job. We should say thanks more often !\n\nFlorent",
    "created_at": "2012-04-30T22:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151506",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:22 jdemeyer]:
> Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?

It depends on the time between the rc0 and the next beta0 release ;-) You are the boss on that. By the way, thanks a lot for your great job. We should say thanks more often !

Florent



---

archive/issue_events_012672.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-05-06T12:19:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12697#event-12672"
}
```



---

archive/issue_comments_151507.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-06T12:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12697#issuecomment-151507",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
