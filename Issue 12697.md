# Issue 12697: The warn-links option shouldn't allways triggers full doc compilation.

Issue created by migration from https://trac.sagemath.org/ticket/12869

Original creator: hivert

Original creation time: 2012-04-23 10:50:35

Assignee: hivert

Keywords: Broken links, warnings

Title says all. See [This tread](http://groups.google.com/group/sage-devel/browse_thread/thread/73971d04ede1bca3/e2327f6c7ab1bcf9?lnk=gst&q=Advertising#e2327f6c7ab1bcf9).

Florent


---

Comment by hivert created at 2012-04-23 10:56:21

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-04-23 22:07:42

Does not apply on Sage-5.0.beta13...


---

Comment by hivert created at 2012-04-23 22:30:24

Replying to [comment:2 novoselt]:
> Does not apply on Sage-5.0.beta13...

Sorry ! I forgot to tell it depend on #12849


---

Comment by novoselt created at 2012-04-23 22:38:27

Hmmm, where is "--warn-links" option described (except for #9128)? I don't see it in the command line help.


---

Comment by hivert created at 2012-04-23 22:52:18

Look carefully ;-)

```
$ sage -docbuild help
Usage: sage -docbuild [OPTIONS] DOCUMENT (FORMAT | COMMAND)

Build or return information about Sage documentation.
    DOCUMENT    name of the document to build
    FORMAT      document output format
    COMMAND     document-specific command
A DOCUMENT and either a FORMAT or a COMMAND are required,
unless a list of one or more of these is requested.

OPTIONS:
  Standard:
    [...]
    --warn-links        issue a warning whenever a link is not properly
                        resolved; equivalent to '--sphinx-opts -n' (sphinx
                        option: nitpicky)
    [...]
```


Florent


---

Comment by novoselt created at 2012-04-24 00:36:31

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2012-04-24 00:36:31

Aha, then my complain is: how should I know that "sage -docbuild help" works? It does not seem that it is visible in "sage -advanced" and it is not something common to other options.

Regarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.


---

Comment by hivert created at 2012-04-24 07:44:39

Replying to [comment:6 novoselt]:
> Regarding the ticket itself - it work fine for me. I don't quite understand the details of the code, but from comments it is clear what it is supposed to do, tests pass. So positive review.

Here are some details:

In the file `sphinx/environment.py`, the class `BuildEnvironment` is
responsible for handling the environment. It has a method called update which
decide which files should be rebuild. Here is the relevant code:

```python
class BuildEnvironment:
    [...]
    def update(self, config, srcdir, doctreedir, app=None):
        """(Re-)read all files new or changed since last update.

        Returns a summary, the total count of documents to reread and an
        iterator that yields docnames as it processes them.  Store all
        environment docnames in the canonical format (ie using SEP as a
        separator in place of os.path.sep).
        """
        config_changed = False
        if self.config is None:
            msg = '[new config] '
            config_changed = True
        else:
            # check if a config value was changed that affects how
            # doctrees are read
            for key, descr in config.values.iteritems():
                if descr[1] != 'env':
                    continue
                if self.config[key] != config[key]:
                    msg = '[config changed] '
                    config_changed = True
                    break
            [...]
```

So I change `config.values['nitpick'][1]` from `'env'` to `'sage'`
to make sure that config changed is not set.

Florent


---

Comment by hivert created at 2012-04-24 08:13:10

I just spotted a miss-print in my patch

```
    ('py:class',' twisted.web2.resource.PostableResource'))
```

should be

```
    ('py:class', 'twisted.web2.resource.PostableResource')) 
```

Mind the quote before twisted. I'm re-uploading the patch an sete back to needs-review.

Sorry,

Florent


---

Comment by hivert created at 2012-04-24 08:13:56

Changing status from positive_review to needs_work.


---

Comment by hivert created at 2012-04-24 08:14:05

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2012-04-24 14:21:05

How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.


---

Comment by hivert created at 2012-04-24 14:35:41

Replying to [comment:11 novoselt]:
> How could it possibly work without the matching quote? (And I did check that it worked!) Will test the new patch in a few hours.

Did you really check that the broken links warning to `twisted.*` stuff where correctly silenced ?

Florent


---

Comment by novoselt created at 2012-04-24 14:39:22

I checked that documentation recompilation was not triggered by adding/removing "--warn-links" after this patch applied. I thought that if a module has mismatched quotes, it will not load correctly and since the patch touches a single file - obviously it got processed since it changed the rebuilding behaviour.


---

Comment by jhpalmieri created at 2012-04-24 15:08:17

(It looks like there was a matching quote; there was just an extra leading space before "twisted".)


---

Comment by novoselt created at 2012-04-24 18:27:46

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2012-04-24 18:27:46

Yeap, I was too concentrated on that leading space...


---

Comment by hivert created at 2012-04-24 23:09:12

Replying to [comment:15 novoselt]:
> Yeap, I was too concentrated on that leading space...

Thanks for the review... Next steps: 
- parallelisation of the doc build
- table of contents for methods in a class.


---

Comment by jdemeyer created at 2012-04-26 20:15:57

Just noticed a typo in the patch: "environement" should be "environment" (twice).  I understand the mistake though... :-)


---

Attachment

Typo fixes


---

Comment by novoselt created at 2012-04-26 20:22:13

Fixed.


---

Comment by hivert created at 2012-04-26 20:42:46

Replying to [comment:18 novoselt]:
> Fixed.

Oups ! Pardon my French ;-) 

Florent


---

Comment by hivert created at 2012-04-30 16:12:40

Hi Jeroen,

Could it be possible to have this one in 5.0 rather than 5.1, without it cleaning up the doc is really painful. 

Florent


---

Comment by jdemeyer created at 2012-04-30 21:02:40

Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?


---

Comment by hivert created at 2012-04-30 22:34:19

Replying to [comment:22 jdemeyer]:
> Since this patch really only benefits developers, what's the difference if it gets merged in sage-5.0.rc0 or sage-5.1.beta0?

It depends on the time between the rc0 and the next beta0 release ;-) You are the boss on that. By the way, thanks a lot for your great job. We should say thanks more often !

Florent


---

Comment by jdemeyer created at 2012-05-06 12:19:55

Resolution: fixed
