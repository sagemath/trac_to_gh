# Issue 23645: really return fast iterator for subwords

archive/issues_023645.json:
```json
{
    "body": "CC:  @videlec\n\nnew:\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit [x for x in S.__iter__()]\n10 loops, best of 3: 85.1 ms per loop\n```\nold:\n\n```\nsage: %timeit [x for x in S.__iter__()]\n1 loop, best of 3: 320 ms per loop\n\nsage: A = [x for x in S.__iter_new__()]\nsage: B = [x for x in S.__iter__()]\nsage: A == B\nTrue\n```\nThe reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23882\n\n",
    "closed_at": "2017-09-20T22:26:02Z",
    "created_at": "2017-09-18T13:09:39Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "really return fast iterator for subwords",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23645",
    "user": "https://github.com/mantepse"
}
```
CC:  @videlec

new:

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit [x for x in S.__iter__()]
10 loops, best of 3: 85.1 ms per loop
```
old:

```
sage: %timeit [x for x in S.__iter__()]
1 loop, best of 3: 320 ms per loop

sage: A = [x for x in S.__iter_new__()]
sage: B = [x for x in S.__iter__()]
sage: A == B
True
```
The reason is that `S.__iter__` checked `self._element_constructor is tuple`, but this attribute was renamed to `_build`.

Issue created by migration from https://trac.sagemath.org/ticket/23882





---

archive/issue_comments_330884.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330884",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330885.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330885",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_330886.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2017-09-18T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330886",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_330887.json:
```json
{
    "body": "doctest? You can check the output of `S.__iter__()` which should be different.",
    "created_at": "2017-09-18T13:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330887",
    "user": "https://github.com/videlec"
}
```

doctest? You can check the output of `S.__iter__()` which should be different.



---

archive/issue_comments_330888.json:
```json
{
    "body": "The ticket description is misleading: You are not introducing a new method `__iter_new__`, but you change the existing `__iter__` method to make it faster, and test the old versus the new version.\n\nIn particular, Vincent, there should be no new doctest, as the result of iteration should remain the same (as will be tested in all existing doctests that do `for x in S`).",
    "created_at": "2017-09-18T13:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330888",
    "user": "https://github.com/simon-king-jena"
}
```

The ticket description is misleading: You are not introducing a new method `__iter_new__`, but you change the existing `__iter__` method to make it faster, and test the old versus the new version.

In particular, Vincent, there should be no new doctest, as the result of iteration should remain the same (as will be tested in all existing doctests that do `for x in S`).



---

archive/issue_comments_330889.json:
```json
{
    "body": "Do we really want to doctest an implementation detail?  I guess the right thing to do would be to have a test that takes forever with the old implementation and is fast with the new one...",
    "created_at": "2017-09-18T13:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330889",
    "user": "https://github.com/mantepse"
}
```

Do we really want to doctest an implementation detail?  I guess the right thing to do would be to have a test that takes forever with the old implementation and is fast with the new one...



---

archive/issue_comments_330890.json:
```json
{
    "body": "One shouldn't use private/magic double underscore methods directly in the tests. Examples shouldn't too much depend on implementation details, but tests may depend on implementation. Anyway, I think one doesn't need to change the existing tests here.\n\nTo make the speed comparison clearer: Old version is (on my laptop)\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit L = list(S)\n10 loops, best of 3: 33.8 ms per loop\n```\nNew version is\n\n```\nsage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)\nsage: %timeit L = list(S)\n100 loops, best of 3: 9.42 ms per loop\n```\n\nThe change looks good to me, provided that the doctests all pass.",
    "created_at": "2017-09-18T13:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330890",
    "user": "https://github.com/simon-king-jena"
}
```

One shouldn't use private/magic double underscore methods directly in the tests. Examples shouldn't too much depend on implementation details, but tests may depend on implementation. Anyway, I think one doesn't need to change the existing tests here.

To make the speed comparison clearer: Old version is (on my laptop)

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
10 loops, best of 3: 33.8 ms per loop
```
New version is

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
100 loops, best of 3: 9.42 ms per loop
```

The change looks good to me, provided that the doctests all pass.



---

archive/issue_comments_330891.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-19T09:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330891",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_060830.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-20T22:26:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23645#event-60830"
}
```



---

archive/issue_comments_330892.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23645#issuecomment-330892",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
