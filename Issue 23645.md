# Issue 23645: really return fast iterator for subwords

Issue created by migration from https://trac.sagemath.org/ticket/23882

Original creator: mantepse

Original creation time: 2017-09-18 13:09:39

CC:  vdelecroix




---

Comment by mantepse created at 2017-09-18 13:18:30

Changing status from new to needs_review.


---

Comment by mantepse created at 2017-09-18 13:18:30

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mantepse created at 2017-09-18 13:18:30

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by vdelecroix created at 2017-09-18 13:20:05

doctest? You can check the output of `S.__iter__()` which should be different.


---

Comment by SimonKing created at 2017-09-18 13:25:31

The ticket description is misleading: You are not introducing a new method `__iter_new__`, but you change the existing `__iter__` method to make it faster, and test the old versus the new version.

In particular, Vincent, there should be no new doctest, as the result of iteration should remain the same (as will be tested in all existing doctests that do `for x in S`).


---

Comment by mantepse created at 2017-09-18 13:26:18

Do we really want to doctest an implementation detail?  I guess the right thing to do would be to have a test that takes forever with the old implementation and is fast with the new one...


---

Comment by SimonKing created at 2017-09-18 13:39:01

One shouldn't use private/magic double underscore methods directly in the tests. Examples shouldn't too much depend on implementation details, but tests may depend on implementation. Anyway, I think one doesn't need to change the existing tests here.

To make the speed comparison clearer: Old version is (on my laptop)

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
10 loops, best of 3: 33.8 ms per loop
```

New version is

```
sage: S = Subwords([randint(1,10) for i in range(100)], 3, element_constructor=tuple)
sage: %timeit L = list(S)
100 loops, best of 3: 9.42 ms per loop
```


The change looks good to me, provided that the doctests all pass.


---

Comment by jdemeyer created at 2017-09-19 09:23:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-20 22:26:02

Resolution: fixed
