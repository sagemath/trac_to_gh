# Issue 24062: asinh(CIF(1)) returns an element of CC instead of CIF

Issue created by migration from https://trac.sagemath.org/ticket/24299

Original creator: zimmerma

Original creation time: 2017-11-29 16:53:00

CC:  jdemeyer


```
sage: sinh(CIF(1))
[1.1752011936438013 .. 1.1752011936438017]
sage: asinh(CIF(1))
0.881373587019543
```

The second command should return a (complex) interval.


---

Comment by rws created at 2017-11-30 08:28:05

That's a symbolic function evaluation issue, not the fault of CIF.


---

Comment by rws created at 2017-11-30 08:28:05

Changing component from basic arithmetic to symbolics.


---

Comment by rws created at 2017-12-01 07:53:52

As an explanation, the handling of inexact function arguments has several layers. The fallback layer (if the arg has no suitable member function and exact evaluation has no tricks) is to call the helper functions in `libs/pynac/pynac.pyx` which use member functions of RR and CC. There is in most cases no automatic back-conversion to the argument type so, as fallback, you at least get `Real/ComplexField` elements.

There is work ongoing in Pynac to use arb instead of `RR` and `CC` because of speed and ease of conversion to e.g. interval field elements. It's just that inverse hyperbolic functions are still waiting for it. Of course one could state it's the responsibility of CIF to implement inverse hyperbolic functions (and inverse trig functions, for that matter) but I'm not holding my breath. CIF is a math programming exercise, Pynac tries to solve real calculus problems, so we'll implement it in Pynac-0.7.14.


---

Comment by rws created at 2017-12-26 14:12:23

New commits:


---

Comment by rws created at 2017-12-26 14:12:23

Changing status from new to needs_review.


---

Comment by zimmerma created at 2017-12-29 10:05:36

I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?


---

Comment by rws created at 2017-12-30 06:59:29

Replying to [comment:9 zimmerma]:
> I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?

Functions can be either coded in Python (`BuiltinFunction`) or C++ (`GinacFunction` in Pynac). FP evaluation first looks if CIF has a member for `asinh` and, as there isn't, the function's `evalf` member is called. As trig and hyperbolic functions are `GinacFunction`s the changes needed to be done in Pynac, and they became effect with #24329 which was introduced in beta0 I think. So, in order to see the doctests fail you need to go back to 8.1.


---

Comment by zimmerma created at 2017-12-30 18:04:25

Changing status from needs_review to needs_work.


---

Comment by zimmerma created at 2017-12-30 18:04:25

I'm not sure about this:

```
sage: acoth(CIF(0.6))
0.693147180559945?
```

since we get with CC:

```
sage: acoth(CC(0.6))
0.693147180559945 - 1.57079632679490*I
```



---

Comment by rws created at 2017-12-31 07:57:57

Agreed, still buggy.


---

Comment by rws created at 2018-01-28 09:11:45

I did a systematic search and found these additional issues:

```
sage: log_gamma(complex(1.7))
-0.09580769740706588
sage: psi(complex(1.7))
0.2085478748734939
```

Also `dickman_rho` can't handle anything other than float.

The code I used will go into `tests/symbolic-functions.py`.


---

Comment by rws created at 2018-01-29 08:46:21

New commits:


---

Comment by rws created at 2018-02-01 09:26:46

Replying to [comment:11 zimmerma]:
> I'm not sure about this:
> {{{
> sage: acoth(CIF(0.6))
> 0.693147180559945?
> }}}

This one is now fixed in Pynac-0.7.16.


---

Comment by rws created at 2018-02-19 07:40:30

Now with Pynac-0.7.16 still failing.


---

Comment by rws created at 2018-07-01 07:44:12

Update: the correct `arccoth(RR(0.7))-->CC`, `elliptic_eu(7,CC(1.7))`, `jacobi_am(7,CC(1.7))` are flagged wrong. Still failing: `dickman_rho(all types)`.
