# Issue 24062: Systematic doctest for function return type

archive/issues_024062.json:
```json
{
    "body": "CC:  @jdemeyer\n\n```\nsage: sinh(CIF(1))\n[1.1752011936438013 .. 1.1752011936438017]\nsage: asinh(CIF(1))\n0.881373587019543\n```\nThe second command should return a (complex) interval.\n\nAlso:\n\n```\nsage: asin(CIF(0.6))\n...\nTypeError: unable to convert '0.59999999999999998?' to a real number\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24299\n\n",
    "created_at": "2017-11-29T16:53:00Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Systematic doctest for function return type",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24062",
    "user": "https://github.com/zimmermann6"
}
```
CC:  @jdemeyer

```
sage: sinh(CIF(1))
[1.1752011936438013 .. 1.1752011936438017]
sage: asinh(CIF(1))
0.881373587019543
```
The second command should return a (complex) interval.

Also:

```
sage: asin(CIF(0.6))
...
TypeError: unable to convert '0.59999999999999998?' to a real number
```


Issue created by migration from https://trac.sagemath.org/ticket/24299





---

archive/issue_comments_336845.json:
```json
{
    "body": "That's a symbolic function evaluation issue, not the fault of CIF.",
    "created_at": "2017-11-30T08:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336845",
    "user": "https://github.com/rwst"
}
```

That's a symbolic function evaluation issue, not the fault of CIF.



---

archive/issue_comments_336846.json:
```json
{
    "body": "Changing component from basic arithmetic to symbolics.",
    "created_at": "2017-11-30T08:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336846",
    "user": "https://github.com/rwst"
}
```

Changing component from basic arithmetic to symbolics.



---

archive/issue_comments_336847.json:
```json
{
    "body": "As an explanation, the handling of inexact function arguments has several layers. The fallback layer (if the arg has no suitable member function and exact evaluation has no tricks) is to call the helper functions in `libs/pynac/pynac.pyx` which use member functions of RR and CC. There is in most cases no automatic back-conversion to the argument type so, as fallback, you at least get `Real/ComplexField` elements.\n\nThere is work ongoing in Pynac to use arb instead of `RR` and `CC` because of speed and ease of conversion to e.g. interval field elements. It's just that inverse hyperbolic functions are still waiting for it. Of course one could state it's the responsibility of CIF to implement inverse hyperbolic functions (and inverse trig functions, for that matter) but I'm not holding my breath. CIF is a math programming exercise, Pynac tries to solve real calculus problems, so we'll implement it in Pynac-0.7.14.",
    "created_at": "2017-12-01T07:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336847",
    "user": "https://github.com/rwst"
}
```

As an explanation, the handling of inexact function arguments has several layers. The fallback layer (if the arg has no suitable member function and exact evaluation has no tricks) is to call the helper functions in `libs/pynac/pynac.pyx` which use member functions of RR and CC. There is in most cases no automatic back-conversion to the argument type so, as fallback, you at least get `Real/ComplexField` elements.

There is work ongoing in Pynac to use arb instead of `RR` and `CC` because of speed and ease of conversion to e.g. interval field elements. It's just that inverse hyperbolic functions are still waiting for it. Of course one could state it's the responsibility of CIF to implement inverse hyperbolic functions (and inverse trig functions, for that matter) but I'm not holding my breath. CIF is a math programming exercise, Pynac tries to solve real calculus problems, so we'll implement it in Pynac-0.7.14.



---

archive/issue_events_061506.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-02T08:36:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24062#event-61506"
}
```



---

archive/issue_comments_336848.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336848",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_336849.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336849",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_336850.json:
```json
{
    "body": "I'd like to review this, but I see only non-regression tests in commit \u200b0dad6ad, and no changes in the source code. How could the results change?",
    "created_at": "2017-12-29T10:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336850",
    "user": "https://github.com/zimmermann6"
}
```

I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?



---

archive/issue_comments_336851.json:
```json
{
    "body": "Replying to [comment:9 zimmerma]:\n> I'd like to review this, but I see only non-regression tests in commit \u200b0dad6ad, and no changes in the source code. How could the results change?\n\n\nFunctions can be either coded in Python (`BuiltinFunction`) or C++ (`GinacFunction` in Pynac). FP evaluation first looks if CIF has a member for `asinh` and, as there isn't, the function's `evalf` member is called. As trig and hyperbolic functions are `GinacFunction`s the changes needed to be done in Pynac, and they became effect with #24329 which was introduced in beta0 I think. So, in order to see the doctests fail you need to go back to 8.1.",
    "created_at": "2017-12-30T06:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336851",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:9 zimmerma]:
> I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?


Functions can be either coded in Python (`BuiltinFunction`) or C++ (`GinacFunction` in Pynac). FP evaluation first looks if CIF has a member for `asinh` and, as there isn't, the function's `evalf` member is called. As trig and hyperbolic functions are `GinacFunction`s the changes needed to be done in Pynac, and they became effect with #24329 which was introduced in beta0 I think. So, in order to see the doctests fail you need to go back to 8.1.



---

archive/issue_comments_336852.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T18:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336852",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_336853.json:
```json
{
    "body": "I'm not sure about this:\n\n```\nsage: acoth(CIF(0.6))\n0.693147180559945?\n```\nsince we get with CC:\n\n```\nsage: acoth(CC(0.6))\n0.693147180559945 - 1.57079632679490*I\n```",
    "created_at": "2017-12-30T18:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336853",
    "user": "https://github.com/zimmermann6"
}
```

I'm not sure about this:

```
sage: acoth(CIF(0.6))
0.693147180559945?
```
since we get with CC:

```
sage: acoth(CC(0.6))
0.693147180559945 - 1.57079632679490*I
```



---

archive/issue_comments_336854.json:
```json
{
    "body": "Agreed, still buggy.",
    "created_at": "2017-12-31T07:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336854",
    "user": "https://github.com/rwst"
}
```

Agreed, still buggy.



---

archive/issue_comments_336855.json:
```json
{
    "body": "I did a systematic search and found these additional issues:\n\n```\nsage: log_gamma(complex(1.7))\n-0.09580769740706588\nsage: psi(complex(1.7))\n0.2085478748734939\n```\nAlso `dickman_rho` can't handle anything other than float.\n\nThe code I used will go into `tests/symbolic-functions.py`.",
    "created_at": "2018-01-28T09:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336855",
    "user": "https://github.com/rwst"
}
```

I did a systematic search and found these additional issues:

```
sage: log_gamma(complex(1.7))
-0.09580769740706588
sage: psi(complex(1.7))
0.2085478748734939
```
Also `dickman_rho` can't handle anything other than float.

The code I used will go into `tests/symbolic-functions.py`.



---

archive/issue_comments_336856.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-01-29T08:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336856",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_336857.json:
```json
{
    "body": "Replying to [comment:11 zimmerma]:\n> I'm not sure about this:\n> \n> ```\n> sage: acoth(CIF(0.6))\n> 0.693147180559945?\n> ```\n\n\nThis one is now fixed in Pynac-0.7.16.",
    "created_at": "2018-02-01T09:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336857",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:11 zimmerma]:
> I'm not sure about this:
> 
> ```
> sage: acoth(CIF(0.6))
> 0.693147180559945?
> ```


This one is now fixed in Pynac-0.7.16.



---

archive/issue_comments_336858.json:
```json
{
    "body": "Now with Pynac-0.7.16 still failing.",
    "created_at": "2018-02-19T07:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336858",
    "user": "https://github.com/rwst"
}
```

Now with Pynac-0.7.16 still failing.



---

archive/issue_comments_336859.json:
```json
{
    "body": "Update: the correct `arccoth(RR(0.7))-->CC`, `elliptic_eu(7,CC(1.7))`, `jacobi_am(7,CC(1.7))` are flagged wrong. Still failing: `dickman_rho(all types)`.",
    "created_at": "2018-07-01T07:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24062#issuecomment-336859",
    "user": "https://github.com/rwst"
}
```

Update: the correct `arccoth(RR(0.7))-->CC`, `elliptic_eu(7,CC(1.7))`, `jacobi_am(7,CC(1.7))` are flagged wrong. Still failing: `dickman_rho(all types)`.
