# Issue 17210: Clarify and complete documentation of function()

archive/issues_017210.json:
```json
{
    "body": "CC:  nbruin kcrisman tmonteil zimmerma\n\nThe documentation of function() is incomplete and confusing.\nFor example, none of the methods described in http://www.sagemath.org/doc/reference/calculus/sage/symbolic/function_factory.html show up when I type:\n\n```\nfunction?\n```\n\nThe distinction between \n\n```\nf = function('f')\n```\n\nand\n\n```\nf = function('f', x)\n```\n\nis also not documented. See also http://trac.sagemath.org/ticket/17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?\nSee the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. \n\n```\nsage: f = function('f', x); print type(f)\n<type 'sage.symbolic.expression.Expression'>\nsage: fx = function('f',x); print type(f)\n<class 'sage.symbolic.function_factory.NewSymbolicFunction'>\nsage: f.variables()\n()\nsage: fx.variables()\n(x,)\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17447\n\n",
    "created_at": "2014-12-05T10:43:49Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Clarify and complete documentation of function()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17210",
    "user": "schymans"
}
```
CC:  nbruin kcrisman tmonteil zimmerma

The documentation of function() is incomplete and confusing.
For example, none of the methods described in http://www.sagemath.org/doc/reference/calculus/sage/symbolic/function_factory.html show up when I type:

```
function?
```

The distinction between 

```
f = function('f')
```

and

```
f = function('f', x)
```

is also not documented. See also http://trac.sagemath.org/ticket/17445 for sources of confusion. Need to explain what happens in the second case above (`f = function('f',x)`). A symbolic function `f` is first created and then overwritten by the expression `f`?
See the following example, where f is first an expression, then becomes redefined to a function in the background, but does not contain any information about its variables. 

```
sage: f = function('f', x); print type(f)
<type 'sage.symbolic.expression.Expression'>
sage: fx = function('f',x); print type(f)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>
sage: f.variables()
()
sage: fx.variables()
(x,)

```


Issue created by migration from https://trac.sagemath.org/ticket/17447





---

archive/issue_comments_228932.json:
```json
{
    "body": "For the question about creation and overwriting:\n\nThe toplevel `function` has the sideeffect of inserting a binding in the global scope, just as the toplevel `var` does.\n\n```\nsage: var('U')\nU\nsage: U\nU\nsage: function('f')\nf\nsage: f\nf\n```\n\nThe library versions of these routines don't do that:\n\n```\nsage: SR.var('V')\nV\nsage: V\nNameError: name 'V' is not defined\nsage: sage.symbolic.function_factory.function('g')\ng\nsage: g\nNameError: name 'g' is not defined\n```\n\nThe intended use of the toplevel `function` is *not* to be assigned but to be called as a statement, just as `var`. There is plenty of documentation in sage that was written by people unaware of this fact (or possibly they think they're being helpful by providing code that doesn't return an error when used with the library versions of these functions)\n\nAs a result `x=var('x')` and `fx=function('f',x)` are quite ubiquitous in the docs. The former is fairly inocuous but the second, as you experience, has a rather nasty side effect. We're violating python's convention here: routines with side effects should return None.\n\nI think this is the point where people usually give up fixing this mess (I have). Hopefully you will now follow through.\n\nNote that we can probably not do more than document the issues, which is not going to fix much, because people won't read the doc, but then at least you can point them somewhere when they complain.\n\nI suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\n(this is the kind of issue that earns sage the reputation of \"implement now, design later\")",
    "created_at": "2014-12-05T19:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228932",
    "user": "nbruin"
}
```

For the question about creation and overwriting:

The toplevel `function` has the sideeffect of inserting a binding in the global scope, just as the toplevel `var` does.

```
sage: var('U')
U
sage: U
U
sage: function('f')
f
sage: f
f
```

The library versions of these routines don't do that:

```
sage: SR.var('V')
V
sage: V
NameError: name 'V' is not defined
sage: sage.symbolic.function_factory.function('g')
g
sage: g
NameError: name 'g' is not defined
```

The intended use of the toplevel `function` is *not* to be assigned but to be called as a statement, just as `var`. There is plenty of documentation in sage that was written by people unaware of this fact (or possibly they think they're being helpful by providing code that doesn't return an error when used with the library versions of these functions)

As a result `x=var('x')` and `fx=function('f',x)` are quite ubiquitous in the docs. The former is fairly inocuous but the second, as you experience, has a rather nasty side effect. We're violating python's convention here: routines with side effects should return None.

I think this is the point where people usually give up fixing this mess (I have). Hopefully you will now follow through.

Note that we can probably not do more than document the issues, which is not going to fix much, because people won't read the doc, but then at least you can point them somewhere when they complain.

I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

(this is the kind of issue that earns sage the reputation of "implement now, design later")



---

archive/issue_comments_228933.json:
```json
{
    "body": "Changing component from symbolics to documentation.",
    "created_at": "2014-12-25T09:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228933",
    "user": "rws"
}
```

Changing component from symbolics to documentation.



---

archive/issue_comments_228934.json:
```json
{
    "body": "Awesome, thank you, Nils. These things always confused me, so I'm relieved to hear that they should be avoided! Even the documentation of var is full of such examples:\n\n```\nsage: x = var('x', domain=RR); x; x.conjugate()\nx\nx\nsage: y = var('y', domain='real'); y.conjugate()\ny\nsage: y = var('y', domain='positive'); y.abs()\ny\n\nCustom latex expression can be assigned to variable:\n\nsage: x = var('sui', latex_name=\"s_{u,i}\"); x._latex_()\n's_{u,i}'\n\n```\n\n\nShould we change these examples, too?",
    "created_at": "2015-01-06T22:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228934",
    "user": "schymans"
}
```

Awesome, thank you, Nils. These things always confused me, so I'm relieved to hear that they should be avoided! Even the documentation of var is full of such examples:

```
sage: x = var('x', domain=RR); x; x.conjugate()
x
x
sage: y = var('y', domain='real'); y.conjugate()
y
sage: y = var('y', domain='positive'); y.abs()
y

Custom latex expression can be assigned to variable:

sage: x = var('sui', latex_name="s_{u,i}"); x._latex_()
's_{u,i}'

```


Should we change these examples, too?



---

archive/issue_comments_228935.json:
```json
{
    "body": "Don't base any other work on this branch just yet, since it's likely to be rebased. I have deprecated the use of `function('f',x)` in favour of using `function('f')(x)`. It's hardly longer to type and much less ambiguous. Otherwise, it seems that the documentation here is actually pretty accurate, apart from being terse. As soon as the objects returned by `function('f')` are consistent, I think users will be forced to learn the (now clear) semantics pretty quickly.\n\nThe object returned by `function(f)` doesn't allow symbolic operations on it, so people will quickly find they need to evaluate it in order to get a symbolic expression.\n\nI haven't changed all doctests to take into account the deprecation, but I've done some files to show the impact of the change (seems relatively minor).",
    "created_at": "2015-01-08T22:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228935",
    "user": "nbruin"
}
```

Don't base any other work on this branch just yet, since it's likely to be rebased. I have deprecated the use of `function('f',x)` in favour of using `function('f')(x)`. It's hardly longer to type and much less ambiguous. Otherwise, it seems that the documentation here is actually pretty accurate, apart from being terse. As soon as the objects returned by `function('f')` are consistent, I think users will be forced to learn the (now clear) semantics pretty quickly.

The object returned by `function(f)` doesn't allow symbolic operations on it, so people will quickly find they need to evaluate it in order to get a symbolic expression.

I haven't changed all doctests to take into account the deprecation, but I've done some files to show the impact of the change (seems relatively minor).



---

archive/issue_comments_228936.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-08T23:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228936",
    "user": "nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_228937.json:
```json
{
    "body": "Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.\n----\nNew commits:\n----\nnote that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`",
    "created_at": "2015-01-08T23:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228937",
    "user": "nbruin"
}
```

Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.
----
New commits:
----
note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`



---

archive/issue_comments_228938.json:
```json
{
    "body": "Replying to [comment:7 nbruin]:\n> Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.\n> ----\n> New commits:\n> ||[b41248b](http://git.sagemath.org/sage.git/commit/?id=b41248b13e18744ab9902adde9b7740832bb1724)||`trac 17447: Deprecation of function('f',x) in favour of function('f')(x)`||\n> ||[fa3ebd6](http://git.sagemath.org/sage.git/commit/?id=fa3ebd6645eb2cae45c2218628eaa1d984f16506)||`trac 17447: Doctest changes to reflect deprecation of function('f',x)`||\n> ----\n> note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`\n\nThis makes it a lot clearer to me now. Just a minor thing:\nIn one of the examples, I would replace \n\n```\nsage: cr = function('cr')\nsage: f = cr(a)\n```\n\n\nby\n\n\n```\nsage: function('cr')\nsage: f = cr(a)\n```\n\n\nwhich in my understanding does the same but is shorter and makes clear that `function('cr')` does already create a symbolic function called `cr`. Otherwise, one may be surprised to create two functions by typing e.g. `cr1 = function('cr')`.",
    "created_at": "2015-01-11T22:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228938",
    "user": "schymans"
}
```

Replying to [comment:7 nbruin]:
> Not really ready for *review* but is ready for input. And is mainly ready for someone else to rewrite documentation properly. People CC'd on this ticket look like good candidates to do so.
> ----
> New commits:
> ||[b41248b](http://git.sagemath.org/sage.git/commit/?id=b41248b13e18744ab9902adde9b7740832bb1724)||`trac 17447: Deprecation of function('f',x) in favour of function('f')(x)`||
> ||[fa3ebd6](http://git.sagemath.org/sage.git/commit/?id=fa3ebd6645eb2cae45c2218628eaa1d984f16506)||`trac 17447: Doctest changes to reflect deprecation of function('f',x)`||
> ----
> note that the doctest that apparently got removed in b41248b in reality gets moved to var.pyx because it tests the toplevel `function`, not the library `function`

This makes it a lot clearer to me now. Just a minor thing:
In one of the examples, I would replace 

```
sage: cr = function('cr')
sage: f = cr(a)
```


by


```
sage: function('cr')
sage: f = cr(a)
```


which in my understanding does the same but is shorter and makes clear that `function('cr')` does already create a symbolic function called `cr`. Otherwise, one may be surprised to create two functions by typing e.g. `cr1 = function('cr')`.



---

archive/issue_comments_228939.json:
```json
{
    "body": "Replying to [comment:8 schymans]:\n> This makes it a lot clearer to me now. Just a minor thing:\n> In one of the examples, I would replace \n> {{{\n> sage: cr = function('cr')\n> sage: f = cr(a)\n> }}}\nAt least one occurrence of that is in the doctest of `sage.symbolic.function_factory.function`, which (now) goes out of its way to import *that* function, which does *not* have the side-effect of mutating the global scope, as documented. So the assignment is actually necessary.\n\nAnother independent point: the top-level `function` does refer to `sage.symbolic.function_factory.function`, but perhaps should do so more explicitly, if possible with a hyperlink. The examples on the latter are a little more elaborate, so someone who wants to read up on `function` (and would probably find the top-level documentation first via `sage: function?`). I don't know how to make hyperlinks to other documentation in sage's docstrings.",
    "created_at": "2015-01-12T00:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228939",
    "user": "nbruin"
}
```

Replying to [comment:8 schymans]:
> This makes it a lot clearer to me now. Just a minor thing:
> In one of the examples, I would replace 
> {{{
> sage: cr = function('cr')
> sage: f = cr(a)
> }}}
At least one occurrence of that is in the doctest of `sage.symbolic.function_factory.function`, which (now) goes out of its way to import *that* function, which does *not* have the side-effect of mutating the global scope, as documented. So the assignment is actually necessary.

Another independent point: the top-level `function` does refer to `sage.symbolic.function_factory.function`, but perhaps should do so more explicitly, if possible with a hyperlink. The examples on the latter are a little more elaborate, so someone who wants to read up on `function` (and would probably find the top-level documentation first via `sage: function?`). I don't know how to make hyperlinks to other documentation in sage's docstrings.



---

archive/issue_comments_228940.json:
```json
{
    "body": "There are broken doctests in the 'doc' folder\n\n```\nsage -t --long prep/Quickstarts/Differential-Equations.rst  # 1 doctest failed\nsage -t --long tutorial/tour_algebra.rst  # 1 doctest failed\nsage -t --long constructions/calculus.rst  # 1 doctest failed\n```\n\n\nNathann",
    "created_at": "2015-01-13T08:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228940",
    "user": "ncohen"
}
```

There are broken doctests in the 'doc' folder

```
sage -t --long prep/Quickstarts/Differential-Equations.rst  # 1 doctest failed
sage -t --long tutorial/tour_algebra.rst  # 1 doctest failed
sage -t --long constructions/calculus.rst  # 1 doctest failed
```


Nathann



---

archive/issue_comments_228941.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-13T08:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228941",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_228942.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> There are broken doctests in the 'doc' folder\nYes, and that is not the only place. First we need to see if there is any good reason why `function('f',x)` is preferable over `function('f')(x)`, of if we can get away with deprecating this confusing construction. And then someone should take a look at the doc to see if it needs further improvement. You're on a doc revamping binge, so this might just be the task for you!",
    "created_at": "2015-01-13T16:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228942",
    "user": "nbruin"
}
```

Replying to [comment:10 ncohen]:
> There are broken doctests in the 'doc' folder
Yes, and that is not the only place. First we need to see if there is any good reason why `function('f',x)` is preferable over `function('f')(x)`, of if we can get away with deprecating this confusing construction. And then someone should take a look at the doc to see if it needs further improvement. You're on a doc revamping binge, so this might just be the task for you!



---

archive/issue_comments_228943.json:
```json
{
    "body": "> You're on a doc revamping binge, so this might just be the task for you!\n\nI am afraid that you will have to find somebody else. I never used Sage's symbolics.\n\nNathann",
    "created_at": "2015-01-13T16:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228943",
    "user": "ncohen"
}
```

> You're on a doc revamping binge, so this might just be the task for you!

I am afraid that you will have to find somebody else. I never used Sage's symbolics.

Nathann



---

archive/issue_comments_228944.json:
```json
{
    "body": "That fixes the three above marked doctests.\n----\nNew commits:",
    "created_at": "2015-02-01T16:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228944",
    "user": "rws"
}
```

That fixes the three above marked doctests.
----
New commits:



---

archive/issue_comments_228945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-02T08:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228946.json:
```json
{
    "body": "These are the remaining doctest fixes coming from `make ptestlong`. I have reviewed and found fine the commits up to mine, so following reviewers can skip that.\n> And then someone should take a look at the doc to see if it needs further improvement.",
    "created_at": "2015-02-02T08:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228946",
    "user": "rws"
}
```

These are the remaining doctest fixes coming from `make ptestlong`. I have reviewed and found fine the commits up to mine, so following reviewers can skip that.
> And then someone should take a look at the doc to see if it needs further improvement.



---

archive/issue_comments_228947.json:
```json
{
    "body": "> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\nCc:ing him for that reason.  Though we have already had a few other discussions on Trac about the need to update our tests while not maintaining exact compatibility.  Since they don't (yet) raise errors, but apparently only the deprecation warning, should we maybe update the tests (in that part only) to have the deprecation warning returned?  Note that I don't believe the deprecation warning is even doctested, which is a no-no :)\n\nAlso, does the current branch actually \"clarify and complete documentation of function\"?  It looks like it mostly fixes doctests.\n\nAnother change not doctested is\n\n```\n     if is_SymbolicVariable(dvar):\n-        raise ValueError(\"You have to declare dependent variable as a function, eg. y=function('y',x)\")\n+        raise ValueError(\"You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)\")\n```\n\nwhich I think happens twice.\n\nI'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was \"right\" in the sense that one wanted that returned, and have we shown how to get that object?  What about the ask.sagemath question?\n\nAll that to say that nonetheless it will be great to have a unified interface on this, if that is really the right thing to do, which from the comments it apparently is.",
    "created_at": "2015-02-03T01:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228947",
    "user": "kcrisman"
}
```

> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

Cc:ing him for that reason.  Though we have already had a few other discussions on Trac about the need to update our tests while not maintaining exact compatibility.  Since they don't (yet) raise errors, but apparently only the deprecation warning, should we maybe update the tests (in that part only) to have the deprecation warning returned?  Note that I don't believe the deprecation warning is even doctested, which is a no-no :)

Also, does the current branch actually "clarify and complete documentation of function"?  It looks like it mostly fixes doctests.

Another change not doctested is

```
     if is_SymbolicVariable(dvar):
-        raise ValueError("You have to declare dependent variable as a function, eg. y=function('y',x)")
+        raise ValueError("You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)")
```

which I think happens twice.

I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was "right" in the sense that one wanted that returned, and have we shown how to get that object?  What about the ask.sagemath question?

All that to say that nonetheless it will be great to have a unified interface on this, if that is really the right thing to do, which from the comments it apparently is.



---

archive/issue_comments_228948.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> Also, does the current branch actually \"clarify and complete documentation of function\"?  It looks like it mostly fixes doctests.\n\nI think there are two things that are/were confusing:\n- `function('f',x)` returns something that is not, according to our definition, a function (e.g., it cannot be evaluated (\"called\") in a non-ambiguous way and hence triggers a deprecation warning)).\n- The top-level `function` makes a binding in the global namespace and returns a value. The two were different.\n\nWith the proposed patch, `function('f',x)` is deprecated, so number 1 gets eliminated and number 2 is less confusing because, while it still injects something in the namespace, the value it returns is always the same as what it injects.\n\nWhen I read the documentation of `sage.symbolic.function_factory.function`, I actually thought it described what happens fairly correctly, and it has good examples. Hence I did not feel the need to add to it. The top-level `function` documentation is rather sparse, so that could use expansion. However, we do not want to repeat ourselves, so perhaps it should just contain a clear pointer (hyperlink?) to the documentation of `sage.symbolic.function_factory.function`. I don't know how to do that, so please go ahead and improve that bit. You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.\n\n> Another change not doctested is\n> {{{\n>      if is_SymbolicVariable(dvar):\n> -        raise ValueError(\"You have to declare dependent variable as a function, eg. y=function('y',x)\")\n> +        raise ValueError(\"You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)\")\n> }}}\n> which I think happens twice.\nThese messages weren't doctested before either. If you feel the projects benefits from such administrations, go ahead.\n\n> I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was \"right\" in the sense that one wanted that returned, and have we shown how to get that object?\n\nIn my opinion: no. In all cases, `function('f')(x)` is much clearer and not much longer than `function('f',x)`. There are *many* tickets and questions about people getting tripped up by the fact that a function called function doesn't return a function.\n\n> What about the ask.sagemath question?\nIn my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.",
    "created_at": "2015-02-03T02:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228948",
    "user": "nbruin"
}
```

Replying to [comment:18 kcrisman]:
> Also, does the current branch actually "clarify and complete documentation of function"?  It looks like it mostly fixes doctests.

I think there are two things that are/were confusing:
- `function('f',x)` returns something that is not, according to our definition, a function (e.g., it cannot be evaluated ("called") in a non-ambiguous way and hence triggers a deprecation warning)).
- The top-level `function` makes a binding in the global namespace and returns a value. The two were different.

With the proposed patch, `function('f',x)` is deprecated, so number 1 gets eliminated and number 2 is less confusing because, while it still injects something in the namespace, the value it returns is always the same as what it injects.

When I read the documentation of `sage.symbolic.function_factory.function`, I actually thought it described what happens fairly correctly, and it has good examples. Hence I did not feel the need to add to it. The top-level `function` documentation is rather sparse, so that could use expansion. However, we do not want to repeat ourselves, so perhaps it should just contain a clear pointer (hyperlink?) to the documentation of `sage.symbolic.function_factory.function`. I don't know how to do that, so please go ahead and improve that bit. You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.

> Another change not doctested is
> {{{
>      if is_SymbolicVariable(dvar):
> -        raise ValueError("You have to declare dependent variable as a function, eg. y=function('y',x)")
> +        raise ValueError("You have to declare dependent variable as a function evaluated at the independent variable, eg. y=function('y')(x)")
> }}}
> which I think happens twice.
These messages weren't doctested before either. If you feel the projects benefits from such administrations, go ahead.

> I'm *still* not sure I even understand some of the subtle differences.  Are there occasions where the old behavior was "right" in the sense that one wanted that returned, and have we shown how to get that object?

In my opinion: no. In all cases, `function('f')(x)` is much clearer and not much longer than `function('f',x)`. There are *many* tickets and questions about people getting tripped up by the fact that a function called function doesn't return a function.

> What about the ask.sagemath question?
In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.



---

archive/issue_comments_228949.json:
```json
{
    "body": "> The top-level function documentation is rather sparse, so that could use expansion.\n\nYes, this is what I meant.  Hyperlink is tricky - not per se, but in command line and even sagenb it's not as useful.  So I figure at least a little more in the top-level and then the hyperlink (assuming that file is in fact already in the documentation!).\n\n> You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.\n\nThat is very kind, I will see; this one is lower on my priority list but definitely important.\n\n> If you feel the projects benefits from such administrations, go ahead.\n\nWell, I've found it does.  I guess I will ask you to review it if I do that :-)\n\n> In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.\n\nYes.",
    "created_at": "2015-02-03T02:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228949",
    "user": "kcrisman"
}
```

> The top-level function documentation is rather sparse, so that could use expansion.

Yes, this is what I meant.  Hyperlink is tricky - not per se, but in command line and even sagenb it's not as useful.  So I figure at least a little more in the top-level and then the hyperlink (assuming that file is in fact already in the documentation!).

> You are excellently qualified to produce extensive and understandable documentation for the target audience of these functions.

That is very kind, I will see; this one is lower on my priority list but definitely important.

> If you feel the projects benefits from such administrations, go ahead.

Well, I've found it does.  I guess I will ask you to review it if I do that :-)

> In my opinion, that's another thing to document. However, the confusion about function not returning a function definitely contributed to the confusion about how to use substitute_function.

Yes.



---

archive/issue_comments_228950.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> > I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n> \n> Cc:ing him for that reason.\n\nthanks, however I gave up trying to maintain compatibility with the book, since there\nare already many examples from the book that we put as doctests in Sage, and which were changed afterwards...",
    "created_at": "2015-02-03T07:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228950",
    "user": "zimmerma"
}
```

Replying to [comment:18 kcrisman]:
> > I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.
> 
> Cc:ing him for that reason.

thanks, however I gave up trying to maintain compatibility with the book, since there
are already many examples from the book that we put as doctests in Sage, and which were changed afterwards...



---

archive/issue_comments_228951.json:
```json
{
    "body": "Here is another example of something confusing.\n\nhttp://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/",
    "created_at": "2015-03-09T23:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228951",
    "user": "kcrisman"
}
```

Here is another example of something confusing.

http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/



---

archive/issue_comments_228952.json:
```json
{
    "body": "Replying to [comment:22 kcrisman]:\n> Here is another example of something confusing.\n> \n> http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/\n\nI think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).\n\nInitially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.",
    "created_at": "2015-03-10T01:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228952",
    "user": "nbruin"
}
```

Replying to [comment:22 kcrisman]:
> Here is another example of something confusing.
> 
> http://ask.sagemath.org/question/26114/why-is-basic-arithmetic-disallowed-on-symbolic-functions/

I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).

Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.



---

archive/issue_comments_228953.json:
```json
{
    "body": "Replying to [comment:23 nbruin]:\n> Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.\n\nThat would be awesome! Much more consistent AND flexible. +1 from me.",
    "created_at": "2015-03-11T07:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228953",
    "user": "schymans"
}
```

Replying to [comment:23 nbruin]:
> Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.

That would be awesome! Much more consistent AND flexible. +1 from me.



---

archive/issue_comments_228954.json:
```json
{
    "body": "Replying to [comment:23 nbruin]:\n> I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).\n> \n> Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.\nSee #17958 for `declare_var` and no, this is still a good idea.",
    "created_at": "2015-03-14T15:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228954",
    "user": "rws"
}
```

Replying to [comment:23 nbruin]:
> I think that's another issue. The problem there is that global namespace `var` and `function` return a value *as well as* insert something into the namespace. That's counter to python custom (routines that mutate state normally return `None`. Compare `L.sort()` and `sorted(L)`. There are exceptions: `L.pop()`).
> 
> Initially it seems pedantic to enforce such rules in a computer algebra system as well, but the many problems it causes suggests it's not. Can we have `declare_var('x,y')` and `declare_function('f')` for the mutating stuff and just have `var('x')` and `function('f')` for the normal stuff? That ship has probably sailed already.
See #17958 for `declare_var` and no, this is still a good idea.



---

archive/issue_comments_228955.json:
```json
{
    "body": "Replying to [comment:3 nbruin]:\n> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.\n\nI'm not sure about `function()` and have little time to check now, but regarding `var()`, I think we tried to always use `x = SR.var('x')`.\n\nAnd IMO, the version of `var` that injects a variable in the global namespace should simply be deprecated, or possibly moved to `sage.ext.inteactive_constructors_c` if someone really care about it.",
    "created_at": "2015-03-15T10:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228955",
    "user": "mmezzarobba"
}
```

Replying to [comment:3 nbruin]:
> I suspect that Zimmerman's calculus book uses this stuff quite extensively, so deprecating/changing the current behaviour will likely lead to pushback from him, and probably rightly so.

I'm not sure about `function()` and have little time to check now, but regarding `var()`, I think we tried to always use `x = SR.var('x')`.

And IMO, the version of `var` that injects a variable in the global namespace should simply be deprecated, or possibly moved to `sage.ext.inteactive_constructors_c` if someone really care about it.



---

archive/issue_comments_228956.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-12T15:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228956",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_228957.json:
```json
{
    "body": "So, comment:17 gave part of a review. Can someone please complete it?",
    "created_at": "2015-04-12T15:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228957",
    "user": "rws"
}
```

So, comment:17 gave part of a review. Can someone please complete it?



---

archive/issue_comments_228958.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t --long src/sage/tests/french_book/calculus_doctest.py  # 1 doctest failed\nsage -t --long src/doc/pt/tutorial/tour_algebra.rst  # 1 doctest failed\nsage -t --long src/sage/combinat/integer_vector.py  # 1 doctest failed\n```\n",
    "created_at": "2015-06-11T07:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228958",
    "user": "rws"
}
```


```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/tests/french_book/calculus_doctest.py  # 1 doctest failed
sage -t --long src/doc/pt/tutorial/tour_algebra.rst  # 1 doctest failed
sage -t --long src/sage/combinat/integer_vector.py  # 1 doctest failed
```




---

archive/issue_comments_228959.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-11T07:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228959",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_228960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T23:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-11-10T01:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_228962.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-10T01:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228962",
    "user": "nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_228963.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-10T18:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228963",
    "user": "nbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_228964.json:
```json
{
    "body": "OK, comments #17 and #27 provide a positive review of the first bit. I give a largely positive review to Ralf's doctest adjustments. There was one overcorrection in `french_book/calculus_doctest.py` that I corrected. The other changes were just parallel corrections to different translations of one document that have been introduced since the last time this ticket was updated.\n\npatchbot is happy and I think all code is positively reviewed now. Ready for merge!",
    "created_at": "2015-11-10T18:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228964",
    "user": "nbruin"
}
```

OK, comments #17 and #27 provide a positive review of the first bit. I give a largely positive review to Ralf's doctest adjustments. There was one overcorrection in `french_book/calculus_doctest.py` that I corrected. The other changes were just parallel corrections to different translations of one document that have been introduced since the last time this ticket was updated.

patchbot is happy and I think all code is positively reviewed now. Ready for merge!



---

archive/issue_comments_228965.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-11T19:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17210",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17210#issuecomment-228965",
    "user": "vbraun"
}
```

Resolution: fixed
