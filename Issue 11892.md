# Issue 11892: Update residue fields to use dynamic classes

archive/issues_011892.json:
```json
{
    "body": "Assignee: @loefflerd\n\nKeywords: residue fields, dynamic classes\n\nChanges sage.rings.residue_fields to use sage.structure.dynamic_class to make it easier to implement p-adic residue fields.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12064\n\n",
    "created_at": "2011-11-20T16:01:56Z",
    "labels": [
        "number fields",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Update residue fields to use dynamic classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11892",
    "user": "@roed314"
}
```
Assignee: @loefflerd

Keywords: residue fields, dynamic classes

Changes sage.rings.residue_fields to use sage.structure.dynamic_class to make it easier to implement p-adic residue fields.

Issue created by migration from https://trac.sagemath.org/ticket/12064





---

archive/issue_comments_136238.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-20T16:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136238",
    "user": "@roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136239.json:
```json
{
    "body": "Is there another dependency? Patch fails to apply cleanly on a fresh copy of 4.8 on top of 12062:\n\n```\nmlungu@sage:~/sage-4.8/devel/sage$ hg qpush\napplying 12062.patch\nnow at: 12062.patch\nmlungu@sage:~/sage-4.8/devel/sage$ hg qpush\napplying 12064.patch\npatching file sage/rings/residue_field.pyx\nHunk #9 succeeded at 553 with fuzz 2 (offset -28 lines).\nHunk #12 FAILED at 743\n1 out of 14 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh 12064.patch\n```\n",
    "created_at": "2012-02-22T00:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136239",
    "user": "@haikona"
}
```

Is there another dependency? Patch fails to apply cleanly on a fresh copy of 4.8 on top of 12062:

```
mlungu@sage:~/sage-4.8/devel/sage$ hg qpush
applying 12062.patch
now at: 12062.patch
mlungu@sage:~/sage-4.8/devel/sage$ hg qpush
applying 12064.patch
patching file sage/rings/residue_field.pyx
Hunk #9 succeeded at 553 with fuzz 2 (offset -28 lines).
Hunk #12 FAILED at 743
1 out of 14 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 12064.patch
```




---

archive/issue_comments_136240.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-22T00:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136240",
    "user": "@haikona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136241.json:
```json
{
    "body": "Updated against 5.0.beta1",
    "created_at": "2012-02-22T23:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136241",
    "user": "@roed314"
}
```

Updated against 5.0.beta1



---

archive/issue_comments_136242.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-22T23:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136242",
    "user": "@roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136243.json:
```json
{
    "body": "Looks like there's new trouble when trying to apply 12064 on top of 12062. 12062 has already been applied and Sage built in the output below:\n\n\n```\nsage@sagebox:~/sage/devel/sage$ hg qpush\napplying 12064.patch\npatching file sage/rings/finite_rings/finite_field_base.pyx\nHunk #1 succeeded at 90 with fuzz 2 (offset -2 lines).\npatching file sage/rings/residue_field.pyx\nHunk #3 succeeded at 139 with fuzz 2 (offset 0 lines).\nHunk #8 succeeded at 435 with fuzz 2 (offset 0 lines).\nnow at: 12064.patch\nsage@sagebox:~/sage/devel/sage$ sage -b\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nBuilding modified file sage/rings/residue_field.pyx.\nBuilding modified file sage/rings/finite_rings/finite_field_base.pyx.\nExecuting 2 commands (using 1 thread)\npython `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/residue_field.c sage/rings/residue_field.pyx\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            K = pring.fraction_field()\n            intp = pring.base_ring().order()\n            f = p.gen()\n            deg = f.degree()\n            q = intp**deg\n            if k == 1 and intp.is_prime() and (impl is None or impl == 'modn'):\n                ^\n------------------------------------------------------------\n\nsage/rings/residue_field.pyx:313:17: local variable 'k' referenced before assignment\npython `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/finite_rings/finite_field_base.c sage/rings/finite_rings/finite_field_base.pyx\nError running command, failed with status 256.\nsage: There was an error installing modified sage library code.\n```\n",
    "created_at": "2012-02-23T00:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136243",
    "user": "@haikona"
}
```

Looks like there's new trouble when trying to apply 12064 on top of 12062. 12062 has already been applied and Sage built in the output below:


```
sage@sagebox:~/sage/devel/sage$ hg qpush
applying 12064.patch
patching file sage/rings/finite_rings/finite_field_base.pyx
Hunk #1 succeeded at 90 with fuzz 2 (offset -2 lines).
patching file sage/rings/residue_field.pyx
Hunk #3 succeeded at 139 with fuzz 2 (offset 0 lines).
Hunk #8 succeeded at 435 with fuzz 2 (offset 0 lines).
now at: 12064.patch
sage@sagebox:~/sage/devel/sage$ sage -b

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Building modified file sage/rings/residue_field.pyx.
Building modified file sage/rings/finite_rings/finite_field_base.pyx.
Executing 2 commands (using 1 thread)
python `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/residue_field.c sage/rings/residue_field.pyx

Error compiling Cython file:
------------------------------------------------------------
...
            K = pring.fraction_field()
            intp = pring.base_ring().order()
            f = p.gen()
            deg = f.degree()
            q = intp**deg
            if k == 1 and intp.is_prime() and (impl is None or impl == 'modn'):
                ^
------------------------------------------------------------

sage/rings/residue_field.pyx:313:17: local variable 'k' referenced before assignment
python `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/finite_rings/finite_field_base.c sage/rings/finite_rings/finite_field_base.pyx
Error running command, failed with status 256.
sage: There was an error installing modified sage library code.
```




---

archive/issue_comments_136244.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-23T00:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136244",
    "user": "@haikona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136245.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-18T19:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136245",
    "user": "@roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136246.json:
```json
{
    "body": "Fixed.  Sorry for the long delay.",
    "created_at": "2013-03-18T19:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136246",
    "user": "@roed314"
}
```

Fixed.  Sorry for the long delay.



---

archive/issue_comments_136247.json:
```json
{
    "body": "Attachment [trac_12064_review.patch](tarball://root/attachments/some-uuid/ticket12064/trac_12064_review.patch) by @saraedum created at 2013-03-18 21:18:05",
    "created_at": "2013-03-18T21:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136247",
    "user": "@saraedum"
}
```

Attachment [trac_12064_review.patch](tarball://root/attachments/some-uuid/ticket12064/trac_12064_review.patch) by @saraedum created at 2013-03-18 21:18:05



---

archive/issue_comments_136248.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-16T12:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136248",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_136249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T22:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136249",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136250.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T22:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136250",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T23:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136251",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-13T23:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136252",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_136253.json:
```json
{
    "body": "The `residue_field.pyx` file is now down to three doctests.\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2016-12-13T23:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136253",
    "user": "@saraedum"
}
```

The `residue_field.pyx` file is now down to three doctests.
----
New commits:
----
New commits:



---

archive/issue_comments_136254.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-31T04:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11892",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11892#issuecomment-136254",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:
