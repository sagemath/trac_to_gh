# Issue 11892: Update residue fields to use dynamic classes

Issue created by migration from https://trac.sagemath.org/ticket/12064

Original creator: roed

Original creation time: 2011-11-20 16:01:56

Assignee: davidloeffler

Keywords: residue fields, dynamic classes

Changes sage.rings.residue_fields to use sage.structure.dynamic_class to make it easier to implement p-adic residue fields.


---

Comment by roed created at 2011-11-20 16:27:42

Changing status from new to needs_review.


---

Comment by spice created at 2012-02-22 00:04:10

Is there another dependency? Patch fails to apply cleanly on a fresh copy of 4.8 on top of 12062:

```
mlungu@sage:~/sage-4.8/devel/sage$ hg qpush
applying 12062.patch
now at: 12062.patch
mlungu@sage:~/sage-4.8/devel/sage$ hg qpush
applying 12064.patch
patching file sage/rings/residue_field.pyx
Hunk #9 succeeded at 553 with fuzz 2 (offset -28 lines).
Hunk #12 FAILED at 743
1 out of 14 hunks FAILED -- saving rejects to file sage/rings/residue_field.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 12064.patch
```



---

Comment by spice created at 2012-02-22 00:04:10

Changing status from needs_review to needs_work.


---

Comment by roed created at 2012-02-22 23:02:46

Updated against 5.0.beta1


---

Comment by roed created at 2012-02-22 23:02:46

Changing status from needs_work to needs_review.


---

Comment by spice created at 2012-02-23 00:18:05

Looks like there's new trouble when trying to apply 12064 on top of 12062. 12062 has already been applied and Sage built in the output below:


```
sage@sagebox:~/sage/devel/sage$ hg qpush
applying 12064.patch
patching file sage/rings/finite_rings/finite_field_base.pyx
Hunk #1 succeeded at 90 with fuzz 2 (offset -2 lines).
patching file sage/rings/residue_field.pyx
Hunk #3 succeeded at 139 with fuzz 2 (offset 0 lines).
Hunk #8 succeeded at 435 with fuzz 2 (offset 0 lines).
now at: 12064.patch
sage@sagebox:~/sage/devel/sage$ sage -b

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Building modified file sage/rings/residue_field.pyx.
Building modified file sage/rings/finite_rings/finite_field_base.pyx.
Executing 2 commands (using 1 thread)
python `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/residue_field.c sage/rings/residue_field.pyx

Error compiling Cython file:
------------------------------------------------------------
...
            K = pring.fraction_field()
            intp = pring.base_ring().order()
            f = p.gen()
            deg = f.degree()
            q = intp**deg
            if k == 1 and intp.is_prime() and (impl is None or impl == 'modn'):
                ^
------------------------------------------------------------

sage/rings/residue_field.pyx:313:17: local variable 'k' referenced before assignment
python `which cython`  --old-style-globals --disable-function-redefinition --embed-positions --directive cdivision=True,autotestdict=False,fast_getattr=True -I/Users/sage/sage-4.8/devel/sage-dev1 -o sage/rings/finite_rings/finite_field_base.c sage/rings/finite_rings/finite_field_base.pyx
Error running command, failed with status 256.
sage: There was an error installing modified sage library code.
```



---

Comment by spice created at 2012-02-23 00:18:05

Changing status from needs_review to needs_work.


---

Comment by roed created at 2013-03-18 19:21:15

Changing status from needs_work to needs_review.


---

Comment by roed created at 2013-03-18 19:21:15

Fixed.  Sorry for the long delay.


---

Attachment


---

Comment by jdemeyer created at 2014-10-16 12:26:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-12-13 22:16:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-13 22:25:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-13 23:03:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-13 23:18:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-12-13 23:18:35

The `residue_field.pyx` file is now down to three doctests.
----
New commits:
----
New commits:


---

Comment by git created at 2022-01-31 04:04:54

Branch pushed to git repo; I updated commit sha1. New commits:
