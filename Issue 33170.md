# Issue 33170: sage -t --all-installed

archive/issues_033170.json:
```json
{
    "body": "CC:  @kiwifb @antonio-rojas @tobiasdiez\n\nThis new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33407\n\n",
    "created_at": "2022-02-23T18:52:04Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "sage -t --all-installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33170",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kiwifb @antonio-rojas @tobiasdiez

This new option would test all Sage modules installed (in `SAGE_LIB`) instead of `SAGE_SRC`. This would be useful for testing modularized distributions.

Issue created by migration from https://trac.sagemath.org/ticket/33407





---

archive/issue_comments_471923.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-24T05:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471923",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471924.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-02-24T22:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471924",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_471925.json:
```json
{
    "body": "I think the move makes some sense especially in the context of the elimination of `SAGE_LIB` and potentially more variables as sage matures more in the future.\n\nThe only thing I am not sure is introducing a new option. Why not make it the default instead? What workflow would that prevent?",
    "created_at": "2022-02-24T22:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471925",
    "user": "https://github.com/kiwifb"
}
```

I think the move makes some sense especially in the context of the elimination of `SAGE_LIB` and potentially more variables as sage matures more in the future.

The only thing I am not sure is introducing a new option. Why not make it the default instead? What workflow would that prevent?



---

archive/issue_comments_471926.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> Why not make it the default instead? What workflow would that prevent?\n\n\nI think the default is valuable because doctests can be written / updated and immediately tested without having to build the Sage library.",
    "created_at": "2022-02-24T22:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471926",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:5 fbissey]:
> Why not make it the default instead? What workflow would that prevent?


I think the default is valuable because doctests can be written / updated and immediately tested without having to build the Sage library.



---

archive/issue_comments_471927.json:
```json
{
    "body": "Valid for pure python files but not `.pyx`, you need to build those before testing them. But on the numbers they probably are the minority.",
    "created_at": "2022-02-24T22:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471927",
    "user": "https://github.com/kiwifb"
}
```

Valid for pure python files but not `.pyx`, you need to build those before testing them. But on the numbers they probably are the minority.



---

archive/issue_comments_471928.json:
```json
{
    "body": "Replying to [comment:7 fbissey]:\n> Valid for pure python files but not `.pyx`, you need to build those before testing them. \n\n\nWhen you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.",
    "created_at": "2022-02-24T23:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471928",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:7 fbissey]:
> Valid for pure python files but not `.pyx`, you need to build those before testing them. 


When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.



---

archive/issue_comments_471929.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Replying to [comment:7 fbissey]:\n> > Valid for pure python files but not `.pyx`, you need to build those before testing them. \n\n> \n> When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.\n\n\nMore to the point, it is a pain in the workflow to recompile in that case. But you should explicitly test a file or directory in that case. But let's go with a developer focused for now.\n\nWe may want to suggest not to use `--installed` and `--all` at the same time for distros as it will try to add a non-existent path once we remove the default `SAGE_SRC` -> `SAGE_LIB`. Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?",
    "created_at": "2022-02-24T23:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471929",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:8 mkoeppe]:
> Replying to [comment:7 fbissey]:
> > Valid for pure python files but not `.pyx`, you need to build those before testing them. 

> 
> When you are done changing code, you can still edit doctests and in this phase you don't need to recompile in order to tests the doctests.


More to the point, it is a pain in the workflow to recompile in that case. But you should explicitly test a file or directory in that case. But let's go with a developer focused for now.

We may want to suggest not to use `--installed` and `--all` at the same time for distros as it will try to add a non-existent path once we remove the default `SAGE_SRC` -> `SAGE_LIB`. Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?



---

archive/issue_comments_471930.json:
```json
{
    "body": "Replying to [comment:9 fbissey]:\n> We may want to suggest not to use `--installed` and `--all` at the same time\n\n\nYes, they are mutually exclusive options",
    "created_at": "2022-02-24T23:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471930",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:9 fbissey]:
> We may want to suggest not to use `--installed` and `--all` at the same time


Yes, they are mutually exclusive options



---

archive/issue_comments_471931.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> Replying to [comment:9 fbissey]:\n> > We may want to suggest not to use `--installed` and `--all` at the same time\n\n> \n> Yes, they are mutually exclusive options\n\n\nI didn't pay enough attention to that part of the code. I see it now.",
    "created_at": "2022-02-24T23:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471931",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 fbissey]:
> > We may want to suggest not to use `--installed` and `--all` at the same time

> 
> Yes, they are mutually exclusive options


I didn't pay enough attention to that part of the code. I see it now.



---

archive/issue_comments_471932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T23:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471932",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471933.json:
```json
{
    "body": "Replying to [comment:9 fbissey]:\n> Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?\n\n\nI have added `sage_setup`, `sage_docbuild` but I'm not sure about `SAGE_DOC_SRC` because Sage does not install it; do you install it in the Gentoo package?",
    "created_at": "2022-02-24T23:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471933",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:9 fbissey]:
> Also the current `--all` will catch `sage_setup`, `sage_docbuild` and `SAGE_DOC_SRC` (which in distros will point to `SAGE_DOC`). But `--installed` doesn't do any of that. Should it?


I have added `sage_setup`, `sage_docbuild` but I'm not sure about `SAGE_DOC_SRC` because Sage does not install it; do you install it in the Gentoo package?



---

archive/issue_comments_471934.json:
```json
{
    "body": "No, I don't install SAGE_DOC_SRC. But as I said it points to the installed `SAGE_DOC` which effectively tests nothing. Because the point would be to test the `.rst` files, but all those are installed as `.rst.txt` for some reason. It would make sense to me to add `SAGE_DOC` for `--installed` if we could test those.",
    "created_at": "2022-02-24T23:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471934",
    "user": "https://github.com/kiwifb"
}
```

No, I don't install SAGE_DOC_SRC. But as I said it points to the installed `SAGE_DOC` which effectively tests nothing. Because the point would be to test the `.rst` files, but all those are installed as `.rst.txt` for some reason. It would make sense to me to add `SAGE_DOC` for `--installed` if we could test those.



---

archive/issue_comments_471935.json:
```json
{
    "body": "Ah, I see, in the `_sources` subdirectories",
    "created_at": "2022-02-25T00:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471935",
    "user": "https://github.com/mkoeppe"
}
```

Ah, I see, in the `_sources` subdirectories



---

archive/issue_comments_471936.json:
```json
{
    "body": "I looked at these files but they do not seem useful",
    "created_at": "2022-02-25T00:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471936",
    "user": "https://github.com/mkoeppe"
}
```

I looked at these files but they do not seem useful



---

archive/issue_comments_471937.json:
```json
{
    "body": "What else do you test in `SAGE_DOC_SRC`? `conf.py` files? Those do not have doctests either. If there is no value in testing a `.rst.txt` in `SAGE_DOC`, I am not sure there is value in testing the corresponding `.rst` in `SAGE_DOC_SRC`.",
    "created_at": "2022-02-25T00:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471937",
    "user": "https://github.com/kiwifb"
}
```

What else do you test in `SAGE_DOC_SRC`? `conf.py` files? Those do not have doctests either. If there is no value in testing a `.rst.txt` in `SAGE_DOC`, I am not sure there is value in testing the corresponding `.rst` in `SAGE_DOC_SRC`.



---

archive/issue_comments_471938.json:
```json
{
    "body": "None of these files have `TESTS` blocks but a few have stuff that does get tested\n\n```\n$ sage -t --long src/doc/en/thematic_tutorials/sandpile.rst\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2022-02-25-13-31-30-ea5e5e11.\nUsing --optional=pip,sage\nFeatures to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,pdftocairo,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib\nDoctesting 1 file.\nsage -t --long --random-seed=249406959745805344364707629509298952414 src/doc/en/thematic_tutorials/sandpile.rst\n    [705 tests, 12.50 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```",
    "created_at": "2022-02-25T00:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471938",
    "user": "https://github.com/kiwifb"
}
```

None of these files have `TESTS` blocks but a few have stuff that does get tested

```
$ sage -t --long src/doc/en/thematic_tutorials/sandpile.rst
too many failed tests, not using stored timings
Running doctests with ID 2022-02-25-13-31-30-ea5e5e11.
Using --optional=pip,sage
Features to be detected: 4ti2,benzene,bliss,buckygen,conway_polynomials,csdp,database_cremona_ellcurve,database_cremona_mini_ellcurve,database_jones_numfield,database_knotinfo,dvipng,graphviz,imagemagick,jupymake,kenzo,latte_int,lrslib,mcqd,meataxe,pandoc,pdf2svg,pdftocairo,plantri,pynormaliz,python_igraph,rubiks,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.groups,sage.plot,sage.rings.number_field,sage.rings.padics,sage.rings.real_double,sage.symbolic,sage_numerical_backends_coin,sagemath_doc_html,sphinx,tdlib
Doctesting 1 file.
sage -t --long --random-seed=249406959745805344364707629509298952414 src/doc/en/thematic_tutorials/sandpile.rst
    [705 tests, 12.50 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

archive/issue_comments_471939.json:
```json
{
    "body": "Yes, my mistake",
    "created_at": "2022-02-25T00:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471939",
    "user": "https://github.com/mkoeppe"
}
```

Yes, my mistake



---

archive/issue_comments_471940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-25T00:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-25T00:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-25T00:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471943.json:
```json
{
    "body": "Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?",
    "created_at": "2022-02-25T01:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471943",
    "user": "https://github.com/mkoeppe"
}
```

Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?



---

archive/issue_comments_471944.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?\n\n\nLet's leave it for another clean up ticket. I am already quite happy that we fixed the `.rst.txt` thing in this one. I'll want a clean slate in my brain to think properly of all the consequences when we get to it.\n\nIt was good work on this one, thank you for all the commits :)\n\nIf you have nothing to add, it is a positive review from me.",
    "created_at": "2022-02-25T01:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471944",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:25 mkoeppe]:
> Should I remove the fallback `SAGE_DOC_SRC` -> `SAGE_DOC`?


Let's leave it for another clean up ticket. I am already quite happy that we fixed the `.rst.txt` thing in this one. I'll want a clean slate in my brain to think properly of all the consequences when we get to it.

It was good work on this one, thank you for all the commits :)

If you have nothing to add, it is a positive review from me.



---

archive/issue_comments_471945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-25T01:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471946.json:
```json
{
    "body": "Here's another change, just stopping short of actually removing the fallbacks",
    "created_at": "2022-02-25T01:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471946",
    "user": "https://github.com/mkoeppe"
}
```

Here's another change, just stopping short of actually removing the fallbacks



---

archive/issue_comments_471947.json:
```json
{
    "body": "But we can leave this for another ticket if you prefer.",
    "created_at": "2022-02-25T01:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471947",
    "user": "https://github.com/mkoeppe"
}
```

But we can leave this for another ticket if you prefer.



---

archive/issue_comments_471948.json:
```json
{
    "body": "Well, I'll be going for the school run in 20-25 minutes, I'll try to wrap my head around what this commit is about before going.",
    "created_at": "2022-02-25T01:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471948",
    "user": "https://github.com/kiwifb"
}
```

Well, I'll be going for the school run in 20-25 minutes, I'll try to wrap my head around what this commit is about before going.



---

archive/issue_comments_471949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-25T01:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471950.json:
```json
{
    "body": "Good spotting that last commit. The previous commit is neat, it almost negates the need for having the `--installed` option. I can continue doing `--all` on distro and it will behave as `--installed`. It is only distinctive on vanilla sage where it does something different.\n\nIt feels like I won my first point about making it the default without you really conceding anything. Really well done. The code reorganisation around it is also quite good. It is all more clear about what each part does.",
    "created_at": "2022-02-25T01:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471950",
    "user": "https://github.com/kiwifb"
}
```

Good spotting that last commit. The previous commit is neat, it almost negates the need for having the `--installed` option. I can continue doing `--all` on distro and it will behave as `--installed`. It is only distinctive on vanilla sage where it does something different.

It feels like I won my first point about making it the default without you really conceding anything. Really well done. The code reorganisation around it is also quite good. It is all more clear about what each part does.



---

archive/issue_comments_471951.json:
```json
{
    "body": "Replying to [comment:32 fbissey]:\n> The previous commit is neat, it almost negates the need for having the `--installed` option. \n\n\nYes, for the Sage-on-distro use case, but not for my use case (doctesting a modularized subset distribution like **sagemath-polyhedra**).",
    "created_at": "2022-02-25T04:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471951",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:32 fbissey]:
> The previous commit is neat, it almost negates the need for having the `--installed` option. 


Yes, for the Sage-on-distro use case, but not for my use case (doctesting a modularized subset distribution like **sagemath-polyhedra**).



---

archive/issue_comments_471952.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-27T21:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471952",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471953.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-02-28T02:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471953",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_471954.json:
```json
{
    "body": "Test fail",
    "created_at": "2022-02-28T22:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471954",
    "user": "https://github.com/vbraun"
}
```

Test fail



---

archive/issue_comments_471955.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-02-28T22:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471955",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_471956.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-28T22:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471957.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-28T22:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471957",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_471958.json:
```json
{
    "body": "Apologies, that was very sloppy of me.",
    "created_at": "2022-02-28T23:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471958",
    "user": "https://github.com/kiwifb"
}
```

Apologies, that was very sloppy of me.



---

archive/issue_comments_471959.json:
```json
{
    "body": "Patchbots have been on strike, hard to see failures.",
    "created_at": "2022-03-01T01:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471959",
    "user": "https://github.com/mkoeppe"
}
```

Patchbots have been on strike, hard to see failures.



---

archive/issue_comments_471960.json:
```json
{
    "body": "I have now run a full doctest on sage-on-gentoo with `--installed`. Because we have not acted yet on `SAGE_SRC`/`SAGE_LIB`/`SAGE_DOC_SRC` checking with `--all` was just business as usual. But nothing else came up (apart from the current lot of failures in #33141 and new giac issues that I have to inspect more closely).",
    "created_at": "2022-03-01T01:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471960",
    "user": "https://github.com/kiwifb"
}
```

I have now run a full doctest on sage-on-gentoo with `--installed`. Because we have not acted yet on `SAGE_SRC`/`SAGE_LIB`/`SAGE_DOC_SRC` checking with `--all` was just business as usual. But nothing else came up (apart from the current lot of failures in #33141 and new giac issues that I have to inspect more closely).



---

archive/issue_comments_471961.json:
```json
{
    "body": "While it is unrelated to eliminating `SAGE_*` variables, there is something related to testing an installed sage that we need to address in a follow up. pytest doesn't work if you cannot write in the \"rootdir\" of what is tested.\n\nThere are two issues with that. First it may leave unwanted files all over the place. Second it fails miserably if you try to test something that is read-only.\n\n```\n============================= test session starts ==============================\nplatform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0\nrootdir: /usr\nplugins: hypothesis-6.38.0\ncollected 0 items\n\n=============================== warnings summary ===============================\n../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433\n  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids\n    config.cache.set(\"cache/nodeids\", sorted(self.cached_nodeids))\n\n../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52\n  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise\n    session.config.cache.set(STEPWISE_CACHE_DIR, [])\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n```\n\n\nThere seem to be some option to change where the cache is created (`-o cache_dir=$somelocation`) but I have so far failed to integrate it successfully in `sage-runtest` when `pytest` is called.",
    "created_at": "2022-03-17T09:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471961",
    "user": "https://github.com/kiwifb"
}
```

While it is unrelated to eliminating `SAGE_*` variables, there is something related to testing an installed sage that we need to address in a follow up. pytest doesn't work if you cannot write in the "rootdir" of what is tested.

There are two issues with that. First it may leave unwanted files all over the place. Second it fails miserably if you try to test something that is read-only.

```
============================= test session starts ==============================
platform linux -- Python 3.10.2, pytest-7.0.1, pluggy-1.0.0
rootdir: /usr
plugins: hypothesis-6.38.0
collected 0 items

=============================== warnings summary ===============================
../../usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433
  /usr/lib/python3.10/site-packages/_pytest/cacheprovider.py:433: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/nodeids
    config.cache.set("cache/nodeids", sorted(self.cached_nodeids))

../../usr/lib/python3.10/site-packages/_pytest/stepwise.py:52
  /usr/lib/python3.10/site-packages/_pytest/stepwise.py:52: PytestCacheWarning: could not create cache path /usr/.pytest_cache/v/cache/stepwise
    session.config.cache.set(STEPWISE_CACHE_DIR, [])

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
```


There seem to be some option to change where the cache is created (`-o cache_dir=$somelocation`) but I have so far failed to integrate it successfully in `sage-runtest` when `pytest` is called.



---

archive/issue_comments_471962.json:
```json
{
    "body": "Follow up for `pytest` at #33521.",
    "created_at": "2022-03-17T19:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471962",
    "user": "https://github.com/kiwifb"
}
```

Follow up for `pytest` at #33521.



---

archive/issue_comments_471963.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-17T22:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471963",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471964.json:
```json
{
    "body": "Working fine here.",
    "created_at": "2022-03-17T22:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471964",
    "user": "https://github.com/antonio-rojas"
}
```

Working fine here.



---

archive/issue_comments_471965.json:
```json
{
    "body": "Thanks all for the review!",
    "created_at": "2022-03-17T22:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471965",
    "user": "https://github.com/mkoeppe"
}
```

Thanks all for the review!



---

archive/issue_comments_471966.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-21T23:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33170#issuecomment-471966",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088099.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-21T23:34:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33170",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33170#event-88099"
}
```
