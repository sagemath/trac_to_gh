# Issue 27647: Bug in quadratic twist of elliptic curves

archive/issues_027647.json:
```json
{
    "body": "CC:  @defeo\n\nKeywords: quadratic twist\n\nIf E is an elliptic curve defined over a field K and L/K is a quadratic extension then there is an elliptic curve E'/K isomorphic to E over L but not over K, called the quadratic twist of E by L/K.  In case L=K(sqrt(d)) for some non-square d in K, this is also called the quadratic twist of E by d; this is always the case except in characteristic 2.  When the characteristic is not 2 or 3 and E has short Weierstrass equation Y<sup>2=X</sup>3+aX+b then *usually* the twist by d is obtained by replacing (a,b) by (a*d<sup>2,b*d</sup>3), **but** there is one case for which this is incorrect, namely when d=-1 and b=0.  In this case, the twist takes (a,0) to (-4*a,0).  We do not implement this properly:\n\n```\nsage: E = EllipticCurve([0,0,0,1,0]); E\nElliptic Curve defined by y^2 = x^3 + x over Rational Field\nsage: E.quadratic_twist(-1)\nElliptic Curve defined by y^2 = x^3 + x over Rational Field\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27884\n\n",
    "created_at": "2019-05-28T11:54:09Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Bug in quadratic twist of elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27647",
    "user": "https://github.com/JohnCremona"
}
```
CC:  @defeo

Keywords: quadratic twist

If E is an elliptic curve defined over a field K and L/K is a quadratic extension then there is an elliptic curve E'/K isomorphic to E over L but not over K, called the quadratic twist of E by L/K.  In case L=K(sqrt(d)) for some non-square d in K, this is also called the quadratic twist of E by d; this is always the case except in characteristic 2.  When the characteristic is not 2 or 3 and E has short Weierstrass equation Y<sup>2=X</sup>3+aX+b then *usually* the twist by d is obtained by replacing (a,b) by (a*d<sup>2,b*d</sup>3), **but** there is one case for which this is incorrect, namely when d=-1 and b=0.  In this case, the twist takes (a,0) to (-4*a,0).  We do not implement this properly:

```
sage: E = EllipticCurve([0,0,0,1,0]); E
Elliptic Curve defined by y^2 = x^3 + x over Rational Field
sage: E.quadratic_twist(-1)
Elliptic Curve defined by y^2 = x^3 + x over Rational Field
```


Issue created by migration from https://trac.sagemath.org/ticket/27884





---

archive/issue_comments_389966.json:
```json
{
    "body": "For the record, Magma gives the same result as Sage in the preceding example, which (in my opinion) means that both have a bug.  I will seek more opinions.  Meanwhile, continuing the example:\n\n```\nsage: E = EllipticCurve([0,0,0,1,0]); E\nElliptic Curve defined by y^2 = x^3 + x over Rational Field\nsage: K.<i> = QuadraticField(-1)\nsage: E.change_ring(K).descend_to(QQ)\n[Elliptic Curve defined by y^2 = x^3 + x over Rational Field,\n Elliptic Curve defined by y^2 = x^3 - 4*x over Rational Field]\n```\n\nThis means that the last two curves (being the original and one other) are non-isomorphic over Q but isomorphic over K=Q(i), which according tm me means that the second curve listed is *the* quadratic twist of E by -1.  But then I wrote the descend_to method.",
    "created_at": "2019-05-28T14:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389966",
    "user": "https://github.com/JohnCremona"
}
```

For the record, Magma gives the same result as Sage in the preceding example, which (in my opinion) means that both have a bug.  I will seek more opinions.  Meanwhile, continuing the example:

```
sage: E = EllipticCurve([0,0,0,1,0]); E
Elliptic Curve defined by y^2 = x^3 + x over Rational Field
sage: K.<i> = QuadraticField(-1)
sage: E.change_ring(K).descend_to(QQ)
[Elliptic Curve defined by y^2 = x^3 + x over Rational Field,
 Elliptic Curve defined by y^2 = x^3 - 4*x over Rational Field]
```

This means that the last two curves (being the original and one other) are non-isomorphic over Q but isomorphic over K=Q(i), which according tm me means that the second curve listed is *the* quadratic twist of E by -1.  But then I wrote the descend_to method.



---

archive/issue_comments_389967.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389967",
    "user": "https://github.com/embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_389968.json:
```json
{
    "body": "I was wrong.  The definition of quadratic twist is not that the curves become isomorphic (only) over a quadratic extension, but is that the twisting cocycle has values in {+1,-1}.  The quadratic twist by d of a curve with j=1728 is trivial for d=-1, and more generally is the same for +d and -d.  So while normally the quadratic twists over a field K (of characteristic not 2, anyway) are parametrized by K<sup>*/(K</sup>*)^2, in the case j(E)=1728 they are parametrized by K<sup>*/(-1,(K</sup>*)^2).  This is because the inflation map H^1(G_K,\\mu_2) -> H^1(G_K,\\mu_4)  has kernel 2: after applying the Kummer isomorphism this becomes the squaring map K<sup>*/(K</sup>*)2 -> K<sup>*/(K</sup>*)^4 whose kernel contains -1.  Alternatively, since -4=(1+sqrt(-1))^4, the quartic twist by -4 becomes trivial over K(sqrt(-1)).\n\nI have discussed this with several experts, who agree.  So nothing needs changing.\n\nThis should be set to invalid/don't-fix.",
    "created_at": "2019-08-20T10:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389968",
    "user": "https://github.com/JohnCremona"
}
```

I was wrong.  The definition of quadratic twist is not that the curves become isomorphic (only) over a quadratic extension, but is that the twisting cocycle has values in {+1,-1}.  The quadratic twist by d of a curve with j=1728 is trivial for d=-1, and more generally is the same for +d and -d.  So while normally the quadratic twists over a field K (of characteristic not 2, anyway) are parametrized by K<sup>*/(K</sup>*)^2, in the case j(E)=1728 they are parametrized by K<sup>*/(-1,(K</sup>*)^2).  This is because the inflation map H^1(G_K,\mu_2) -> H^1(G_K,\mu_4)  has kernel 2: after applying the Kummer isomorphism this becomes the squaring map K<sup>*/(K</sup>*)2 -> K<sup>*/(K</sup>*)^4 whose kernel contains -1.  Alternatively, since -4=(1+sqrt(-1))^4, the quartic twist by -4 becomes trivial over K(sqrt(-1)).

I have discussed this with several experts, who agree.  So nothing needs changing.

This should be set to invalid/don't-fix.



---

archive/issue_comments_389969.json:
```json
{
    "body": "Set assignee to @JohnCremona.",
    "created_at": "2019-08-20T10:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389969",
    "user": "https://github.com/JohnCremona"
}
```

Set assignee to @JohnCremona.



---

archive/issue_comments_389970.json:
```json
{
    "body": "Changing priority from major to trivial.",
    "created_at": "2019-08-20T10:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389970",
    "user": "https://github.com/JohnCremona"
}
```

Changing priority from major to trivial.



---

archive/issue_events_069134.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2019-08-20T10:16:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27647#event-69134"
}
```



---

archive/issue_comments_389971.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2019-08-22T07:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27647#issuecomment-389971",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid



---

archive/issue_events_069135.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-22T07:10:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27647",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27647#event-69135"
}
```
