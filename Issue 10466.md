# Issue 10466: analytic combinatorics: new code for computing asymptotics for multivariate generating functions

Issue created by migration from https://trac.sagemath.org/ticket/10519

Original creator: araichev

Original creation time: 2010-12-22 22:27:17

Assignee: sage-combinat

CC:  cyril.banderier zaf tmonteil dkrenn behackl

Keywords: analytic combinatorics, multivariate generating functions, asymptotics

This code is a collection of functions designed
to compute asymptotics of Maclaurin coefficients of certain classes of 
multivariate generating functions. 

The main function asymptotics() returns the first `N` terms of 
the asymptotic expansion of the Maclaurin coefficients `F_{n\alpha}` 
of the multivariate meromorphic function `F=G/H` as `n\to\infty`.
It assumes that `F` is holomorphic in a neighborhood of the origin, 
that `H` is a polynomial, and that asymptotics in the direction of
`\alpha` (a tuple of positive integers) are controlled by smooth
or multiple points.


---

Attachment


---

Comment by rbeezer created at 2010-12-27 07:39:46

Hi Alex,

I can't address the mathematics on this one, but can give some hints about getting this reviewed.


1.  You'll want to submit this as a patch - then folks can run the doctests, check the documentation formatting.  There is a lot of checking that can't happen easily with a *.sage file.  (See below.)  Read the "Walk Through" section of the developer guide for help.


2.  Your examples need slightly different formatting, like


```
    EXAMPLES::

        sage: input 1
        output-1

    Something nice to say. ::

        sage: input-2
        output-2
```


Double-colons start verbatim blocks and sometimes print as colons.

Sage code samples needs indentation.


3.  Sage is mostly object-oriented.  "Internal" method names should begin with an underscore, then they won't show in tab-completion etc (Python convention).

All your functions won't be available in teh global namespace (where they could conflict with other).  You should find an *object* (like maybe some kind of polynomial, especially if it is already int eh combinatorial library?) and make your functions be methods on that object.


Thanks for your contribution - I hope the above is helpful for you.

Rob


---

Comment by araichev created at 2011-01-05 00:57:57

Changing status from new to needs_work.


---

Comment by araichev created at 2011-01-05 00:57:57

Question for you experienced Sage developers: how can i better package my code?  

I think it makes sense to move the major functions such as 'asymptotics' to methods in the class /Applications/sage/devel/sage/sage/rings/polynomial/multi_polynomial.pyx, but what about the subsidiary functions that don't concern polynomials in particular such as 'diff_prod' which calculates derivatives of products and solves equations?


---

Comment by slabbe created at 2011-01-19 15:26:42

> Question for you experienced Sage developers: how can i better package my code? 

Hi, I am currently at Sage Days 28. Right now, there is a discussion about
Analytic combinatorics in Sage and your code was mentionned in the discussion.
I am not an expert of the domain, but I am coding oriented object Python since
some time now. So below are just some of my thoughts to, I hope, help you turn
your set of functions into an oriented object structure.

How to structure a bunch of functions into classes?  How to find which objects
(python classes) you need? Here is the trick I personaly use. Consider each of
your functions as a question you ask. Then, ask yourself to who are you asking
each of your questions? Answers often gives you a good hint about the objects
you need to implement. EXAMPLE. Suppose I code the function ``determinant``.
Question : ``To who do I ask the determinant?``. Answer: ``To a matrix``.
Hence, ``matrix`` might be a good object (a python class) to implement. 

You are the best person to answer to these questions. You might have 30
functions in you file, but only two or three different answers to the above
question. Regroup the similar functions together: they will become the methods
of a same class.

The sage file you uploaded starts with :


```
> This code relates to analytic combinatorics.
> More specifically, it is a collection of functions designed
> to compute asymptotics of Maclaurin coefficients of certain classes of
> multivariate generating functions.

> The main function asymptotics() returns the first `N` terms of
> the asymptotic expansion of the Maclaurin coefficients `F_{n\alpha}`
> of the multivariate meromorphic function `F=G/H` as `n\to\infty`.
> It assumes that `F` is holomorphic in a neighborhood of the origin,
> that `H` is a polynomial, and that asymptotics in the direction of
> `\alpha` (a tuple of positive integers) are controlled by smooth
> or multiple points.
```


Reading only these lines, I imagine the following structure:


```python

class HolomorphicMultivariateMeromorphicFunction(object):

    # Constructor of the object
    def __init__(self, F, G):
        #stores important information on the object as attributes of self
        self._F = F
        self._G = G

    def maclaurin_coefficients(self, n, alpha):
        r"""
        Return the maclaurin coefficients of self.

        INPUT:

        - ``alpha`` - tuple of positive integers

        OUTPUT:

        a python list of the first terms 
        
        OR 
        
        maybe an object of a class you implement if there exists pertinent
        questions to ask to it.
        """
        #Do some computations based (I guess) on self._F and self._G
        intermediate_result1 = self.some_intermediate_computations_1()
        #Do more computations
        return something

    def asymptotics(self, N, alpha):
        r"""
        Returns the asymptotics of Maclaurin coefficients.
        """
        #Do some computations based (I guess) on self._F and self._G
        intermediate_result2 = self.some_intermediate_computations_2()
        intermediate_result3 = self.some_intermediate_computations_3()
        return something

    #put here all the others functions needed to compute the asymptotics
    def some_intermediate_computations_1(self):
        pass
    def some_intermediate_computations_2(self):
        pass
    def some_intermediate_computations_3(self):
        pass

    ...
```


It also looks like you need some robustness somehow. But I need to know more
information about what means 

> that asymptotics in the direction of `\alpha` (a tuple of positive integers)
> are controlled by smooth or multiple points.

to decide whether this is checked at the creation of the object or before
returning the asymptotics. But these hypothesis should be checked somewhere.

Hope this helps.

Cheers,

Sébastien Labbé, Montréal, (but currently at Sage Days 28, Orsay, France)


---

Comment by araichev created at 2011-01-20 00:07:05

Hi Sebastien:

Thanks very much for your helpful comments.  I've been working on rewriting my code in an object-oriented way and will incorporate your suggestions.  Some functions in mgf.sage, such as deciding whether a list of polynomials is algebraically dependent, are general purpose, and so i'm trying to put them into existing Sage classes.  The others are more specific to asymptotics and deserve their own class similar to the one you outlined above.  Robustness is also something i need to improve upon.

I'll post my modifications here after i write and test them more.

Thanks again.  

Alex


---

Attachment

New object oriented version


---

Attachment

Fixed a bug in cohomologous_integrand()


---

Comment by araichev created at 2011-05-06 00:30:51

Hi Sebastien et al:

I rewrote my code in object-oriented style.  Please have a look if you have the time.  Do i need to make the file into a patch, or is it useable as is?

Thanks for your help.
Alex


---

Comment by araichev created at 2011-05-06 00:31:18

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2011-06-01 20:56:47

Cool. I now see that a lot of the functions are now inside a class, which looks better. So, as I said earlier, this is not really my field of study, so I don't know how far I can go on that review. But, I can suggest at least two things:

1. It would be better if you post a Mercurial patch instead of a Sage file so that people can apply it and test it. Are you able to do this? Take a look at the [Sage Developper's Guide](http://sagemath.org/doc/developer/), where it should be explain how to create a patch.


To add your file to the documentation, you might want to look [here](http://sagemath.org/doc/developer/sage_manuals.html#adding-a-new-file).

This winter, I gave a [presentation](http://www.liafa.jussieu.fr/~labbe/Sage/how-to-contribute/) on How to Contribute to Sage. This may helps you to start with Mercurial for instance.

Also, right now, I am working on #11379 where I am adding a new file to Sage. You might find it helpfull to see how I proceed.


2. Some the [Python convention](http://sagemath.org/doc/developer/conventions.html#python-coding-conventions) are not always followed. See also [pep-0008](http://www.python.org/dev/peps/pep-0008/). Especially for spaces :


```
      Yes:

          i = i + 1

      No:

          i= i+1
```



---

Comment by slabbe created at 2011-06-01 20:56:47

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2011-06-01 21:01:51

To add a file to a patch, you must do:


```
sage -hg add your_file.py
```


I was not able to find this information anywhere which is strange...

Tell me if you have questions.

Sébastien


---

Comment by araichev created at 2011-06-11 04:01:13

Thanks for your help, Se'bastien. I'm trying to put my Sage file into a patch by following your presentation slides, but am running into difficulties. I cloned Sage and copied my Sage file as 'amgf.sage' into 

/Applications/sage/devel/sage-araichev/sage/combinat/

I rebuilt Sage etc. and made it to step 10 "Test the changes" of your slides. But when i run Sage and test a few commands, Sage doesn't seem to see the QuasiRationalExpression class i created in /Applications/sage/devel/sage-araichev/sage/combinat/amgf.sage. 

I thought this might be because amgf.sage is a Sage file and not a Python file. So i renamed it amgf.py instead and got syntax errors. What's up with that? Do i have to rewrite all my code in Python instead of Sage? 

Thanks for your attention.
Alex


---

Comment by hivert created at 2011-06-11 07:19:33

Hi Alex,

> I thought this might be because amgf.sage is a Sage file and not a Python
> file. So i renamed it amgf.py instead and got syntax errors. What's up with
> that? Do i have to rewrite all my code in Python instead of Sage?

The basic answer is yes, but Rewriting is a big word for what is really
needed. There is little work to do since Sage mostly follows Python syntax.
The two main difference are handling of integer (see
http://www.sagemath.org/doc/tutorial/afterword.html), and the necessity to
import what you need.

## Handling of integer

 - Notation for exponentiation: In Python `**` means exponentiation and
   `^` means “xor”. 

 - If you need to return an integer for the user, write it return
   `Integer(1)` instead of return 1. In Python 1 is a machine integer
   `int` (32 or 64 bits depending on your machine) and `Integer(1)` is
   a Sage/Gmp arbitrary precision integer. Also `Integer` are much more
   powerful than `int`, for example they know about prime and
   factorization.

## Importing stuff

The second big change is the necessity to import all what you need. More
precisely, each time you use some Sage function, you need to import it at the
beginning of the file. for example if you want to you `PolynomialRing`,
you need to write

```
from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing
```

You can ask Sage where to find PolynomialRing using:

```
sage: PolynomialRing.__module__
'sage.rings.polynomial.polynomial_ring_constructor'
```

This also correspond to the path starting after `site-packages`
given when you are asking Sage for
`PolynomialRing` help:

```
sage: PolynomialRing?
Type:           function
[...]
File:           /home/florent/src/Sage/sage/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring_constructor.py
[...]
```


I hope this helps,

Florent


---

Comment by slabbe created at 2011-06-11 12:51:30

Just answering as a complement to Florent's answer.

> But when i run Sage and test a few commands, Sage doesn't seem to see the QuasiRationalExpression class i created in /Applications/sage/devel/sage-araichev/sage/combinat/amgf.sage. 

To test your code in a Sage session, you will first need to import the good class (or function). For instance :


```
sage: from sage.combinat.amgf import QuasiRationalExpression
```


If you would like `QuasiRationalExpression` to be already imported once Sage is started, you must add the line `from sage.combinat.amgf import QuasiRationalExpression` to the file `sage/combinat/all.py`. Note that it is not "à la mode" to add new stuff to all.py files because Sage is very slow to start because of all the things that are imported. If you think a lot of people will use the code, then it might be defendable.

Sébastien


---

Comment by araichev created at 2011-06-12 23:07:51

Thanks for the tips, Florent and Se'bastien. I'll get to work on converting amgf.sage to amgf.py.

Alex


---

Comment by araichev created at 2011-06-12 23:17:27

Hang on, can i somehow use the Sage pre-parser to automatically convert amgf.sage to amgf.py?

Alex


---

Comment by araichev created at 2011-06-13 00:02:41

Aha!  The command 'sage amgf.sage' pre-parses amgf.sage and saves it as amgf.py.  Thank you ask.sagemath.org!

Alex


---

Comment by araichev created at 2011-06-13 21:44:34

Pythonified amgf.sage


---

Attachment


---

Comment by araichev created at 2011-06-13 21:55:28

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2011-06-15 10:13:31

The patch is empty. I hope you did not lose anything?

Sébastien


---

Attachment

Hmm, i couldn't figure out how to add the code to the patch. I tried 'sage -hg add amgf.py' as you suggested, Se'bastien, but that didn't work. So i finally copied and pasted it in. I hope that works. Let me know the proper way, yo.

Sorry for the delay.

Alex


---

Attachment

Patch against 5.0


---

Comment by davidloeffler created at 2012-03-10 17:09:46

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2012-03-10 17:09:46

Apply trac_10519-fixed.patch

(for the patchbot).

Alex's last "patch" wasn't a patch at all, just a Mercurial header with some Python code arbitrarily pasted into it. I've just uploaded a non-broken version of the patch. I also added the necessary import statements -- a file that's supposed to be part of the Sage library can't import the Sage library (with `from all_cmdline import *`), since that would lead to an infinite loop, so the necessary imports have to be done one-by-one.

The patch now passes doctests on my machine, but there are some worrying errors that came up when I ran a syntax checker on the new file:

```
amgf.py:908: local variable 'R' is assigned to but never used
amgf.py:909: local variable 'd' is assigned to but never used
amgf.py:1070: local variable 'Ht' is assigned to but never used
amgf.py:1251: local variable 'Ht' is assigned to but never used
amgf.py:1591: undefined name 'n'
amgf.py:2199: local variable 'H' is assigned to but never used
amgf.py:2242: undefined name 'verdict'
```

The "undefined name" errors tend to suggest that some cases have bugs in them, *and* those cases are not checked in any doctest, which is a double whammy. Hence "needs work".


---

Comment by davidloeffler created at 2012-03-10 17:10:34

Sorry, that list got mangled. It should be

```
amgf.py:908: local variable 'R' is assigned to but never used
amgf.py:909: local variable 'd' is assigned to but never used
amgf.py:1070: local variable 'Ht' is assigned to but never used
amgf.py:1251: local variable 'Ht' is assigned to but never used
amgf.py:1591: undefined name 'n'
amgf.py:2199: local variable 'H' is assigned to but never used
amgf.py:2242: undefined name 'verdict'
```



---

Comment by araichev created at 2012-03-10 20:53:21

Thanks for your review, David. This patch was my first on Sage Trac and i've since learned a lot, thanks to the constructive feedback of fellow Sagers such as yourself.

Since amgf.py was somewhat of a code bomb, i decided to split it up into simpler pieces, submit those pieces, and, once they get accepted, recombine them. If you or anyone else would like to help me in this endeavor, check out the latest amgf piece at http://trac.sagemath.org/sage_trac/ticket/12417.

Thanks!    

I'll keep you all updated on the progress of amgf with these comments.


---

Attachment

Major rewrite.


---

Comment by araichev created at 2012-08-09 00:17:50

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2012-09-03 18:37:55

Apply only trac_10519.2.patch


---

Comment by chapoton created at 2012-09-03 18:41:56

* Please ensure that every function is doctested

* Please remove all trailing whitespaces


---

Comment by chapoton created at 2012-09-03 18:41:56

Changing status from needs_review to needs_work.


---

Attachment

I have removed all whitespaces in the new patch. All test pass. 

*BUT* there remains 6 procedures with no doctest. Remember that it is neccesary to have 100% doctesting.

Also the name *amgf* is not good. It should be changed to something more descriptive.


---

Comment by araichev created at 2012-09-24 21:33:17

Thanks, folks.  I'll document those outstanding 6 procedures within a week.


---

Comment by araichev created at 2012-10-01 22:41:33

Hmm, i might take longer, because now that i've upgraded to Sage 5.3, i can't create a Sage clone :-(  See http://ask.sagemath.org/question/1821/cant-create-sage-clone-again.


---

Comment by araichev created at 2012-10-02 23:07:59

Still can't create a Sage clone.  In the meantime, here's my patch as a Python file (which i tested on Sage 5.3 with sage -t --long) for anyone who wants to review it: https://www.dropbox.com/s/fcxsbuw119qclxt/trac_10519v4.py.


---

Comment by araichev created at 2012-10-07 22:52:48

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by chapoton created at 2012-10-26 13:32:04

apply only trac_10519v4.patch


---

Comment by chapoton created at 2012-10-26 13:59:57

please remove all trailing whitespaces

please correct the failing doctests


---

Comment by chapoton created at 2012-10-26 13:59:57

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2012-10-30 20:03:12

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2012-10-30 20:03:12

apply trac_10519-v5.patch


---

Attachment

apply trac_10519-v5.patch


---

Attachment

Hmm, i don't understand why i didn't get any test errors when i submitted v4.  Anyway, fixed the errors.


---

Comment by chapoton created at 2012-11-03 08:15:41

Apply trac_10519-v6.patch


---

Comment by chapoton created at 2012-11-03 13:11:51

well, now version V5 works and version V6 does not pass the tests. 

I had already made all the necessary corrections in version V5.

Can we just forget version V6 ?


---

Comment by araichev created at 2012-11-04 20:38:24

OK, let's forget V6.  I bet the problem is one or two docstring lines that output a dictionary.  The random order of the keys is causing a test failure when it doesn't match up with the docstring key order.  We can fix that by sorting the keys before printing them.


---

Comment by chapoton created at 2012-11-05 10:33:36

apply trac_10519-v5.patch


---

Comment by araichev created at 2013-02-11 20:59:54

Hi folks, is this patch ready to be added to Sage?  If not, what's the next step?


---

Comment by chapoton created at 2013-02-13 11:15:39

The next step would be that somebody interested does a real review of this patch. This means looking seriously at the code, using the functions, trying to find bugs, and so on. I am not candidate, sorry.


---

Comment by chapoton created at 2013-03-01 09:29:55

Here is the report of pyflakes : some things that need to be corrected

```
sage/combinat/asymptotics_multivariate_generating_functions.py:147: 'UniqueFactorizationDomains' imported but unused
sage/combinat/asymptotics_multivariate_generating_functions.py:156: 'CartesianProduct' imported but unused
sage/combinat/asymptotics_multivariate_generating_functions.py:171: 'ZZ' imported but unused
sage/combinat/asymptotics_multivariate_generating_functions.py:172: redefinition of unused 'PolynomialRing' from line 148
sage/combinat/asymptotics_multivariate_generating_functions.py:175: 'SageObject' imported but unused
sage/combinat/asymptotics_multivariate_generating_functions.py:1719: local variable 'Ht' is assigned to but never used
sage/combinat/asymptotics_multivariate_generating_functions.py:2097: local variable 'Ht' is assigned to but never used
sage/combinat/asymptotics_multivariate_generating_functions.py:2992: local variable 'X' is assigned to but never used
sage/combinat/asymptotics_multivariate_generating_functions.py:3083: undefined name 'Subsets'
```



---

Comment by chapoton created at 2013-03-01 10:36:05

Changing status from needs_review to needs_work.


---

Attachment

Thanks. Fixed.


---

Comment by araichev created at 2013-03-18 04:20:29

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2013-03-18 09:04:00

for the bot

Apply trac_10519-v7.patch


---

Comment by dimpase created at 2013-11-21 11:19:21

It does not seems to be properly integrated into sage:

```
sage: from sage.combinat.asymptotics_multivariate_generating_functions import *
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-3a279f9ff0e0> in <module>()
----> 1 from sage.combinat.asymptotics_multivariate_generating_functions import *

ImportError: No module named asymptotics_multivariate_generating_functions
sage: 
```


and indeed, you can see that the patch should be for 'sage/combinat' directory, not for './'.
Unless this is meant to go to the "combinat queue" - and I have no clue how such reviews are meant to happen and
how the corresponding code "admin" should look like.

Question: how much of this is dependent upon the "combinat queue"?


---

Comment by araichev created at 2013-11-21 20:14:15

Replying to [comment:53 dimpase]:

Yes, the patch should be for `sage/combinat`.  Feel free to change that, if you'd like to review the patch now.  Otherwise, i'll change it when i get some time in the next week.


> It does not seems to be properly integrated into sage:
> {{{
> sage: from sage.combinat.asymptotics_multivariate_generating_functions import *
> ---------------------------------------------------------------------------
> ImportError                               Traceback (most recent call last)
> <ipython-input-1-3a279f9ff0e0> in <module>()
> ----> 1 from sage.combinat.asymptotics_multivariate_generating_functions import *
> 
> ImportError: No module named asymptotics_multivariate_generating_functions
> sage: 
> }}}
> 
> and indeed, you can see that the patch should be for 'sage/combinat' directory, not for './'.
> Unless this is meant to go to the "combinat queue" - and I have no clue how such reviews are meant to happen and
> how the corresponding code "admin" should look like.
> 
> Question: how much of this is dependent upon the "combinat queue"?


---

Comment by dimpase created at 2013-11-21 20:20:29

Replying to [comment:54 araichev]:
> Replying to [comment:53 dimpase]:
> 
> Yes, the patch should be for `sage/combinat`.  Feel free to change that, if you'd like to review the patch now.  Otherwise, i'll change it when i get some time in the next week.


One should use `lazy_import` in `sage/combinat/all.py` to import the stuff in this patch, rather than 
forcing the user to do the explicit import
 
> > Question: how much of this is dependent upon the "combinat queue"?

So, how much, if anything at all?


---

Comment by tscrim created at 2014-02-15 05:14:06

Here's a git branch version along with some extensive review changes to the documentation. I made some internal methods private to cleanup the namespace (i.e. what you get with tab completion). I also made stuff python 3 compatible. Unfortunately I also cannot really give a good review to the mathematics behind this.

`@`Dima, I think you've misunderstood what the combinat queue is. However it's moot because we are no longer using hg.
----
New commits:


---

Comment by araichev created at 2014-02-15 22:06:17

Hooray!  Thanks heaps, `@`tscrim.

Replying to [comment:57 tscrim]:
> Here's a git branch version along with some extensive review changes to the documentation. I made some internal methods private to cleanup the namespace (i.e. what you get with tab completion). I also made stuff python 3 compatible. Unfortunately I also cannot really give a good review to the mathematics behind this.
> 
> `@`Dima, I think you've misunderstood what the combinat queue is. However it's moot because we are no longer using hg.
> ----
> New commits:
> ||[b01625d](http://git.sagemath.org/sage.git/commit/?id=b01625d4f74ad7b187707254c9e404c97ae7be6d)||`10519: Removed unused modules and variables`||
> ||[443ab74](http://git.sagemath.org/sage.git/commit/?id=443ab74ab4c0b87eaeae1d790b2abc850fc92377)||`Work on cleaning up documentation.`||
> ||[7f9b89e](http://git.sagemath.org/sage.git/commit/?id=7f9b89ed07cb5053bce29a48748382da525f6d5c)||`Merge branch 'develop' into public/combinat/analytic-10519`||
> ||[40dacc9](http://git.sagemath.org/sage.git/commit/?id=40dacc93e20e043d864470693957977fc03f2b25)||`Review changes and added new file to documentation.`||
> ||[60b9337](http://git.sagemath.org/sage.git/commit/?id=60b93376cbb072a1aab99646806555830799468f)||`Tweaked print statements and list().`||


---

Comment by dimpase created at 2014-02-15 22:53:44

Why does one need these FFPD and FFPDSum classes? Are Sage's  multivariate rational functions not good enough?
One should have an interface between these FFPD and FFPDSum and "normal" Sage's rational functions, anyway.

Also, I think that the part that computes decomposition(s) of rational functions must be factored out (and put on another ticket, and they should not be in combinat/, as this has noting to do with combinatorics). It has independent uses, which need not have anything to do with the stated purpose of this ticket.


---

Comment by dimpase created at 2014-02-15 23:05:06

Replying to [comment:57 tscrim]:

> `@`Dima, I think you've misunderstood what the combinat queue is. However it's moot because we are no longer using hg.
Travis, I think already in 2010 I knew what the combinat queue is  ;-) 

Somehow, when reading the code, something made me wonder if this code depends on some features from (what was formerly known as?) combinat queue. I'm happy to know that it's not the case.


---

Comment by tscrim created at 2014-02-16 03:10:15

Replying to [comment:60 dimpase]:
> Replying to [comment:57 tscrim]:
> 
> > `@`Dima, I think you've misunderstood what the combinat queue is. However it's moot because we are no longer using hg.
> Travis, I think already in 2010 I knew what the combinat queue is  ;-) 
> 
> Somehow, when reading the code, something made me wonder if this code depends on some features from (what was formerly known as?) combinat queue. I'm happy to know that it's not the case.

Ah sorry, it seemed to me from comment:53 like there was a misunderstanding. I'm also happy there's no dependence on any patches that are in the (now unused) queue that we might have to untangle.


---

Comment by rws created at 2014-05-09 15:39:47

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-06-19 20:03:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-06-19 20:05:57

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-06-19 20:50:44

Hi,

Just read the code and glance some remarks. The code looks very interesting but I have some advices/questions.

- as a matter of uniformization class name are better expanded (`FractionWithFactoredPolynomialDenominator` instead of `FFPD`)
- `cartesian_product_iterator` will be very soonly deprecated, so use `product` from the Python `itertools` module instead.
- it is generally bad practice to have such a big import list at the begining of the file (because of potential circular import). Moreover some of them can be completely avoided: `L = FractionField(PolynomialRing(K, indets))` can be `PolynomialRing(K, indets).fraction_field()`.


More seriously:
- I do not understand the specifications. It is said that the numerator must be an element p of a 0 or 1 variate factorial polynomial ring R but you have examples involving `cos(x)`. What is the underlying polynomial ring in that case?
- repeating comment:59, Why there is a need for the class `FFDP`? Why isn't it directly implemented as the level of fractions of polynomials? It would makes sense to cache the factorization of the denominator if it is required in several places, but I do not see the point of the `FFDP` class.
- Some of the method needs definition: `critical_cone`, `is_convenient_multiple_point`, ...
- Some of the method would better be hidden: `combine_like_terms`, ... 

Best
Vincent


---

Comment by araichev created at 2014-06-21 22:44:55

Hi folks, because of my new work and responsibilities outside the realm of analytic combinatorics and Sage, i've needed to put this project on hold indefinitely.  Please feel free to change the code as you like.  I hope i've documented it well enough with comments and references so that others can carry it to fruition.


---

Comment by vdelecroix created at 2014-06-21 23:38:09

Replying to [comment:67 araichev]:
> Hi folks, because of my new work and responsibilities outside the realm of analytic combinatorics and Sage, i've needed to put this project on hold indefinitely.  Please feel free to change the code as you like.  I hope i've documented it well enough with comments and references so that others can carry it to fruition.

Hey Alexei,

Good luck with your new work. I will read it carefully and see what I can do. It is definitely a good piece of work.

Vincent


---

Comment by tscrim created at 2014-06-22 04:25:05

Replying to [comment:68 vdelecroix]:
> Replying to [comment:67 araichev]:
> > Hi folks, because of my new work and responsibilities outside the realm of analytic combinatorics and Sage, i've needed to put this project on hold indefinitely.  Please feel free to change the code as you like.  I hope i've documented it well enough with comments and references so that others can carry it to fruition.
> 
> Hey Alexei,
> 
> Good luck with your new work. 

Yes, good luck with your new work.

> I will read it carefully and see what I can do. It is definitely a good piece of work.

Vincent (or Dima), will you be able to check the math for this ticket? If not, I think I could go through it math-wise.

On the code front:

* Since there are only two classes, I agree with you that we should spell it out.
* Similar for changing to the built-in python tools.
* However I think the big import statement is okay since this is going to be a leaf (or at least on a short branch) of the import tree/poset/digraph.
* What methods do you think should be private? 
* What can I do code-wise to help get this in?


---

Comment by dimpase created at 2014-06-23 07:15:30

Replying to [comment:69 tscrim]:
> Replying to [comment:68 vdelecroix]:
> > Replying to [comment:67 araichev]:
> > > Hi folks, because of my new work and responsibilities outside the realm of analytic combinatorics and Sage, i've needed to put this project on hold indefinitely.  Please feel free to change the code as you like.  I hope i've documented it well enough with comments and references so that others can carry it to fruition.
> > 
> > Hey Alexei,
> > 
> > Good luck with your new work. 
> 
> Yes, good luck with your new work.
> 
> > I will read it carefully and see what I can do. It is definitely a good piece of work.
> 
> Vincent (or Dima), will you be able to check the math for this ticket? If not, I think I could go through it math-wise.

please see my #comment:59

IMHO  refactoring and interfacing with Sage's facilities for rational functions is due, before this can be merged.


---

Comment by dkrenn created at 2014-08-18 19:46:49

rebased to 6.3
----
New commits:


---

Comment by dkrenn created at 2014-08-18 19:47:58

There is a doctest (and the doctest using the result below) failing:

```
sage -t src/sage/combinat/asymptotics_multivariate_generating_functions.py
**********************************************************************
File "src/sage/combinat/asymptotics_multivariate_generating_functions.py", line 90, in sage.combinat.asymptotics_multivariate_generating_functions
Failed example:
    s
Expected:
    [{x: 1, y: 1}]
Got:
    []
```

This is now #16848.


---

Comment by dkrenn created at 2014-08-18 19:50:51

Replying to [comment:70 dimpase]:
> Replying to [comment:69 tscrim]:
> > Vincent (or Dima), will you be able to check the math for this ticket? If not, I think I could go through it math-wise.

At least, I started checking the math.

> IMHO  refactoring and interfacing with Sage's facilities for rational functions is due, before this can be merged.

Yes, this should be definitely done.


---

Comment by git created at 2014-08-19 13:14:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2014-08-19 13:15:37

Replying to [comment:74 dkrenn]:
> There is a doctest (and the doctest using the result below) failing:
> {{{
> sage -t src/sage/combinat/asymptotics_multivariate_generating_functions.py
> **********************************************************************
> File "src/sage/combinat/asymptotics_multivariate_generating_functions.py", line 90, in sage.combinat.asymptotics_multivariate_generating_functions
> Failed example:
>     s
> Expected:
>     [{x: 1, y: 1}]
> Got:
>     []
> }}}
> This is now #16848.

This works now (by a workaround).


---

Comment by dkrenn created at 2014-08-19 13:27:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-12-27 08:41:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2014-12-27 15:24:06

I'm currently porting the code to Sage's parent/element framework.


---

Comment by chapoton created at 2014-12-27 16:13:30

My pep8 compliant branch is now available at "u/chapoton/10519".

I am not sure it will be easy to merge it with your other changes. Maybe it is not worth the trouble.


---

Comment by dkrenn created at 2014-12-29 09:13:58

Last 10 new commits:


---

Comment by dkrenn created at 2014-12-29 09:25:23

I've uploaded what I have up to now. There is one major change, namely transitioning to Sage's parent/element framework. There are a couple of minor issues to fix left and some doctests are still failing (this is due to using a wrong base ring...)

Replying to [comment:83 chapoton]:
> My pep8 compliant branch is now available at "u/chapoton/10519".
> I am not sure it will be easy to merge it with your other changes. Maybe it is not worth the trouble.

I've merged your changes/branch (most of them manually; I think I've got all but please check if in doubt).

In "u/chapoton/10519" Sage 6.5.beta4 was merged, which made some doctests failing. I've created a commit fixing most of them, but there is one annoying issue: The doctest in line 3672

```
DD = FFDR._diff_op(A, B, AB_derivs, T, M, 1, 2)
```

takes now forever (over 45 seconds compared to 1.78 seconds before). Does someone has an idea what between 6.3 and 6.5.beta4 could trigger this?


---

Comment by git created at 2014-12-29 12:32:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2014-12-29 12:36:37

Replying to [comment:86 dkrenn]:
> Replying to [comment:83 chapoton]:
> > My pep8 compliant branch is now available at "u/chapoton/10519".
> In "u/chapoton/10519" [...] The doctest in line 3672
> {{{
> DD = FFDR._diff_op(A, B, AB_derivs, T, M, 1, 2)
> }}}
> takes now forever (over 45 seconds compared to 1.78 seconds before). Does someone has an idea what between 6.3 and 6.5.beta4 could trigger this?

Finally found the problem; wasn't the Sage upgrade, but commit c37addd "trac #10519 pep8 fully compliant", which simplified 

```
if something != Integer(0):
```

to

```
if something:
```

which made this test slow (don't know why...). Anyhow, pushed a commit which fixes this.


---

Comment by chapoton created at 2014-12-29 13:17:39

Oops, sorry for this. I thought it was simpler. I do not understand why is is much slower.  Anyway, sorry again for the trouble.


---

Comment by git created at 2014-12-29 19:36:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-01-01 18:39:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-01-04 14:17:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-01-04 14:29:49

During review I've worked over the code and ported it to Sage's parent/element framework.

Here are comments to the comments above:

Replying to [comment:66 vdelecroix]:
> - as a matter of uniformization class name are better expanded (`FractionWithFactoredPolynomialDenominator` instead of `FFPD`)

Renaming done.

> - `cartesian_product_iterator` will be very soonly deprecated, so use `product` from the Python `itertools` module instead.

`itertools` are now used here.

> - it is generally bad practice to have such a big import list at the begining of the file (because of potential circular import). Moreover some of them can be completely avoided: `L = FractionField(PolynomialRing(K, indets))` can be `PolynomialRing(K, indets).fraction_field()`.

Moved imports to functions. Only a very few global (in the module) imports are left.

> More seriously:
> - I do not understand the specifications. It is said that the numerator must be an element p of a 0 or 1 variate factorial polynomial ring R but you have examples involving `cos(x)`. What is the underlying polynomial ring in that case?
> - repeating comment:59, Why there is a need for the class `FFDP`? Why isn't it directly implemented as the level of fractions of polynomials? It would makes sense to cache the factorization of the denominator if it is required in several places, but I do not see the point of the `FFDP` class.

The numerator can be any element from a ring into which the denominator coerces in. E.g. the denominator is a polynomial ring, but numerator is allowed to be out of the symbolic ring.

> - Some of the method needs definition: `critical_cone`, `is_convenient_multiple_point`, ...

Tried a bit of rephrasing, but they are defined in the cited works.

> - Some of the method would better be hidden: `combine_like_terms`, ... 

Done. (also some other functions/methods were made private).


Concerning the review:
- I've did a basic check on the mathematics: seems to be ok.
- I've read the docstrings and modified some of them either to make them clearer or to fit the guidelines in the developer guide (e.g. INPUT/OUTPUT blocks and so on). This is fine for me here (but documentation can, of course, always be improved ;) ).
- Documentation builds.
- All doctests pass.
- I'm towards a positive review, but, of course, someone has to cross review my transition of the code to parent/element framework.

*Therefore: needs cross-review !*


---

Comment by dkrenn created at 2015-01-04 14:30:13

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2015-01-23 14:12:46

Just two minor comments:
* If `FractionWithFactoredDenominatorRing` is intended to actually be a ring, shouldn't the numerators also be  restricted to some given parent? (i.e., shouldn't there be a `numerator_ring` and a `denominator_ring`, or something like that, instead of just a `ring`?)
* Isn't at least some of the code general-purpose enough that it could live in `rings/` or `symbolic/` rather than `combinat/`? If not, perhaps it would be worth at least linking to it from the documentation of related objects.


---

Comment by dimpase created at 2015-01-23 14:15:30

Replying to [comment:95 mmezzarobba]:

> * Isn't at least some of the code general-purpose enough that it could live in `rings/` or `symbolic/` rather than `combinat/`? If not, perhaps it would be worth at least linking to it from the documentation of related objects.

I have mentioned that in an old comment; IMHO the code must be refactored: the code to decompose a rational function into a sum must not live in combinat/.


---

Comment by mmezzarobba created at 2015-01-23 14:27:05

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-01-23 16:17:00

Moreover, I could reproduce the results from the four doctests of `univariate_decomposition` using the existing `QuotientFields.element_class.partial_fraction_decomposition` and `Expression.partial_fraction` functionality. So, why not use these?


---

Comment by git created at 2015-07-28 18:28:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-07-28 18:29:22

Merged in current stable `SageMath 6.8`


---

Comment by git created at 2016-01-31 08:09:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-31 08:10:48

Merged in current stable [SageMath](SageMath) 7.0


---

Comment by dkrenn created at 2016-01-31 08:12:57

Replying to [comment:95 mmezzarobba]:
> * Isn't at least some of the code general-purpose enough that it could live in `rings/` or `symbolic/` rather than `combinat/`? If not, perhaps it would be worth at least linking to it from the documentation of related objects.

Moved to `sage.rings.asymptotic` (which was created last summer for asymptotic expansions #17601) as this seems very suitable.


---

Comment by git created at 2016-01-31 08:17:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-31 12:50:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-31 12:53:18

Replying to [comment:96 dimpase]:
> Replying to [comment:95 mmezzarobba]:
> > * Isn't at least some of the code general-purpose enough that it could live in `rings/` or `symbolic/` rather than `combinat/`? If not, perhaps it would be worth at least linking to it from the documentation of related objects.
> 
> I have mentioned that in an old comment; IMHO the code must be refactored: the code to decompose a rational function into a sum must not live in combinat/.

Changed; now `sage.rings.asymptotic`, see [comment:103 comment:103].


---

Comment by dkrenn created at 2016-01-31 12:54:18

Replying to [comment:95 mmezzarobba]:
> Just two minor comments:
> * If `FractionWithFactoredDenominatorRing` is intended to actually be a ring, shouldn't the numerators also be  restricted to some given parent? (i.e., shouldn't there be a `numerator_ring` and a `denominator_ring`, or something like that, instead of just a `ring`?)

I agree; now there is.


---

Comment by dkrenn created at 2016-01-31 12:59:09

Replying to [comment:98 rws]:
> Moreover, I could reproduce the results from the four doctests of `univariate_decomposition` using the existing `QuotientFields.element_class.partial_fraction_decomposition` and `Expression.partial_fraction` functionality. So, why not use these?

In `univariate_decomposition` the already-known factorization of the denominator is used. This gives a speed-up for not too small instances. Below the timings,

- No speedup for the first (small) example in the doctest:

```
sage: sage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing
sage: sage: R.<x> = PolynomialRing(QQ)
sage: sage: FFPD = FractionWithFactoredDenominatorRing(R)
/local/dakrenn/sage/7.0/local/lib/python2.7/site-packages/sage/structure/unique_representation.py:1021: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
See http://trac.sagemath.org/10519 for details.
  instance = typecall(cls, *args, **options)
sage: sage: f = 5*x^3 + 1/x + 1/(x-1) + 1/(3*x^2 + 1)
sage: sage: ff = FFPD(f)
sage: sage: %timeit -n 1 -r 1 ff.univariate_decomposition()
1 loops, best of 1: 2.24 ms per loop
sage: sage: %timeit -n 1 -r 1 f.partial_fraction_decomposition()
1 loops, best of 1: 1.02 ms per loop
```

- But adding some more terms, we have a speedup:

```
sage: sage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing
sage: sage: R.<x> = PolynomialRing(QQ)
sage: sage: FFPD = FractionWithFactoredDenominatorRing(R)
/local/dakrenn/sage/7.0/local/lib/python2.7/site-packages/sage/structure/unique_representation.py:1021: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
See http://trac.sagemath.org/10519 for details.
  instance = typecall(cls, *args, **options)
sage: sage: f = 5*x^3 + 1/x + 1/(x-1) + 1/(3*x^2 + 1) + 1/(x-2) + 1/(x-3) + 1/(x-4) + 1/(x-5) + 1/(x-6) + 1/(x-7)  # + 1/(x-8) + 1/(x-9) + 1/(x-10) + 1/(x-11) + 1/(x-12) + 1/(x-13)
sage: sage: ff = FFPD(f)
sage: sage: %timeit -n 1 -r 1 ff.univariate_decomposition()
1 loops, best of 1: 1.53 ms per loop
sage: sage: %timeit -n 1 -r 1 f.partial_fraction_decomposition()
1 loops, best of 1: 3.3 ms per loop
```

- The second example of the doctest is already faster with `univariate_decomposition` as it is:

```
sage: sage: from sage.rings.asymptotic.asymptotics_multivariate_generating_functions import FractionWithFactoredDenominatorRing
sage: sage: R.<x> = PolynomialRing(QQ)
sage: sage: FFPD = FractionWithFactoredDenominatorRing(R, SR)
/local/dakrenn/sage/7.0/local/lib/python2.7/site-packages/sage/structure/unique_representation.py:1021: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
See http://trac.sagemath.org/10519 for details.
  instance = typecall(cls, *args, **options)
sage: sage: f = 5*x^3 + 1/x + 1/(x-1) + exp(x)/(3*x^2 + 1)
sage: sage: ff = FFPD(f)
sage: sage: %timeit -n 1 -r 1 ff.univariate_decomposition()
1 loops, best of 1: 6.07 ms per loop
sage: sage: %timeit -n 1 -r 1 f.partial_fraction()
1 loops, best of 1: 9.7 ms per loop
```


I've added a not in the docstring of the method, where this is pointed out.


---

Comment by git created at 2016-01-31 14:29:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-31 14:30:48

Replying to [comment:109 git]:
> ||[ae42ad6](http://git.sagemath.org/sage.git/commit/?id=ae42ad6539aaf99a7986a2bb1c2f018262296d5b)||`Trac #10519: partial revert of commit 137f3c and follow-up ticket`||

See #19989 for this issue.


---

Comment by dkrenn created at 2016-01-31 14:38:43

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2016-01-31 14:38:43

Ticket is again at `needs_review`. I've incorporated the comments above; please cross-review these changes.

A short summary (since the ticket is open for over 5 years now): The original code was posted by Alex Raichev. I've reviewed this code about two years ago. Mathematically it is fine, but it had to be included into [SageMath](SageMath) better (see comments above). This is now done and from my part a positive review. However, since I made quite a lot of changes, these changes need a cross-review. Note that I've now marked the code as [experimental](http://doc.sagemath.org/html/en/developer/coding_in_python.html#experimental-unstable-code).


---

Comment by tscrim created at 2016-01-31 14:47:41

A few very quick thoughts from a very quick glance:

- Remove input/output blocks that have nothing. IMO this adds clutter to the docstrings.
- How experimental/unstable do you think this code really is?


---

Comment by git created at 2016-01-31 14:54:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-31 15:00:06

Replying to [comment:112 tscrim]:
> - Remove input/output blocks that have nothing. IMO this adds clutter to the docstrings.

Done.

> - How experimental/unstable do you think this code really is?

I think the code is quite stable; AFAIK, Mark Wilson (one of the authors of the corresponding theory behind this) uses basically this code (not from the ticket, but a fork) for his research now for some years.
I've marked it "experimental" since it is a new module and the interplay of the code with the whole SageMath-infrastructure was changed on this ticket. This is the part, where there is not that much experience, but this will change once it is in [SageMath](SageMath). If you feel that "experimental" should be remove...I'm fine with any choice.


---

Comment by tscrim created at 2016-01-31 15:46:02

Replying to [comment:114 dkrenn]:
> Replying to [comment:112 tscrim]:
> > - How experimental/unstable do you think this code really is?
> 
> I think the code is quite stable; AFAIK, Mark Wilson (one of the authors of the corresponding theory behind this) uses basically this code (not from the ticket, but a fork) for his research now for some years.
> I've marked it "experimental" since it is a new module and the interplay of the code with the whole SageMath-infrastructure was changed on this ticket. This is the part, where there is not that much experience, but this will change once it is in [SageMath](SageMath). If you feel that "experimental" should be remove...I'm fine with any choice.

I would be surprised if the (public) API changed much, the current version of the code fits in with the category framework, and it has been/will be (well) reviewed. So I feel that it should not be considered experimental.

We should also update the references (I can do this on my review changes).


---

Comment by git created at 2016-01-31 15:54:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-31 15:57:31

Replying to [comment:115 tscrim]:
> Replying to [comment:114 dkrenn]:
> > Replying to [comment:112 tscrim]:
> > > - How experimental/unstable do you think this code really is?
> > [...]
> I would be surprised if the (public) API changed much, the current version of the code fits in with the category framework, and it has been/will be (well) reviewed. So I feel that it should not be considered experimental.

Good; I did `git revert` on the corresponding commit.


---

Comment by dkrenn created at 2016-01-31 15:57:57

Replying to [comment:115 tscrim]:
> We should also update the references (I can do this on my review changes).

Yes, we should. Thanks for doing.


---

Comment by git created at 2016-02-15 04:19:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-02-15 04:32:29

So I made my pass through the code (finally). I think it looks good with my changes:

- I added a `__classcall_private__` to parse the input for `UniqueRepresentation`.
- I moved the (other) static methods to separate functions within the module since (IMO) they were not strongly associated with the `FractionWithFactoredDenominatorRing` class. It also allows their doc to be included by default (since they do not have to be _hidden) and allows them to potentially be used outside of the class.
- I moved around some of the documentation within methods as I feel the descriptive information should come before the `INPUT`/`OUTPUT` blocks. The input signature of the method is the first set of information given by `?` and the documentation.
- I moved more common imports to the start. There is no danger of circular imports when the file in question is not imported into the global namespace (it is also faster, easier to maintain in the long term, and I'm not as paranoid about these thing).
- Replaced some Sage implementations with there standard python equivalents.
- Other misc changes.

If you're happy with my changes, then you can set a positive review.

Perhaps for a followup, we should figure out what the best way is to expose this functionality into the global namespace. Should we just do a lazy import of `FractionWithFactoredDenominatorRing`?


---

Comment by git created at 2016-02-15 12:47:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-15 12:57:36

Replying to [comment:121 tscrim]:
> So I made my pass through the code (finally).

Thank you very much.

> - I added a `__classcall_private__` to parse the input for `UniqueRepresentation`.

Good; checked.

> - I moved the (other) static methods to separate functions within the module since (IMO) they were not strongly associated with the `FractionWithFactoredDenominatorRing` class. It also allows their doc to be included by default (since they do not have to be _hidden) and allows them to potentially be used outside of the class.

I agree that this is a good idea.

> - I moved around some of the documentation within methods as I feel the descriptive information should come before the `INPUT`/`OUTPUT` blocks. The input signature of the method is the first set of information given by `?` and the documentation.

Ok, looks good.

> - I moved more common imports to the start. There is no danger of circular imports when the file in question is not imported into the global namespace (it is also faster, easier to maintain in the long term, and I'm not as paranoid about these thing).

I'm fine with it. Just out of curiosity, why is this faster?

> - Replaced some Sage implementations with there standard python equivalents.

Ok.

> - Other misc changes.

I've checked the diffs (all 200 hunks); LGTM

> If you're happy with my changes, then you can set a positive review.

I've added one doctest to make sage-coverage happier and removed one full-stop.

> Perhaps for a followup, we should figure out what the best way is to expose this functionality into the global namespace. Should we just do a lazy import of `FractionWithFactoredDenominatorRing`?

Maybe. (A lazy import is indeed suitable.)

I set this to positive; all tests pass, doc builds and looks good.


---

Comment by dkrenn created at 2016-02-15 12:57:36

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-02-15 15:51:16

Replying to [comment:123 dkrenn]:
> Replying to [comment:121 tscrim]:
> > - I moved more common imports to the start. There is no danger of circular imports when the file in question is not imported into the global namespace (it is also faster, easier to maintain in the long term, and I'm not as paranoid about these thing).
> 
> I'm fine with it. Just out of curiosity, why is this faster?

Every time the function gets called, Python needs to check to see if it has imported the object. While this is more on the level of micro-optimization, it can matter in those methods used in a tight loop.

> I've added one doctest to make sage-coverage happier and removed one full-stop.

Whoops. Good catch.

> > Perhaps for a followup, we should figure out what the best way is to expose this functionality into the global namespace. Should we just do a lazy import of `FractionWithFactoredDenominatorRing`?
> 
> Maybe. (A lazy import is indeed suitable.)
> 
> I set this to positive; all tests pass, doc builds and looks good.

We also should remove the deprecation warnings in `_element_constructor_` on said followup as I forgot to remove them here.


---

Comment by dkrenn created at 2016-02-15 16:10:05

Replying to [comment:124 tscrim]:
> Replying to [comment:123 dkrenn]:
> > Replying to [comment:121 tscrim]:
> > > - I moved more common imports to the start. There is no danger of circular imports when the file in question is not imported into the global namespace (it is also faster, easier to maintain in the long term, and I'm not as paranoid about these thing).
> > 
> > I'm fine with it. Just out of curiosity, why is this faster?
> 
> Every time the function gets called, Python needs to check to see if it has imported the object. While this is more on the level of micro-optimization, it can matter in those methods used in a tight loop.

Ok, thank you for your explanation.

> We also should remove the deprecation warnings in `_element_constructor_` on said followup as I forgot to remove them here.

Not a strong preference, but actually, I am for keeping the deprecation for some time. The code of this ticket has been around for about 5 years outside of SageMath (more or less as https://github.com/araichev/amgf), and there the deprecated parameters were used. People who are using this package will transition to the one soon to be included in SageMath, but I think some hints on what to change could be very helpful.


---

Comment by tscrim created at 2016-02-15 16:17:38

Replying to [comment:125 dkrenn]:
> Replying to [comment:124 tscrim]:
> > We also should remove the deprecation warnings in `_element_constructor_` on said followup as I forgot to remove them here.
> 
> Not a strong preference, but actually, I am for keeping the deprecation for some time. The code of this ticket has been around for about 5 years outside of SageMath (more or less as https://github.com/araichev/amgf), and there the deprecated parameters were used. People who are using this package will transition to the one soon to be included in SageMath, but I think some hints on what to change could be very helpful.

Fair enough. Although I think because it had not been reviewed and included in Sage, it is fair game to change the API. However, I don't have a stake in this, but it is something we will eventually want to remove.


---

Comment by vbraun created at 2016-02-15 21:16:31

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-02-15 21:16:31

There are some tests that depend on ordering of symbolic variables:

```
sage -t --long src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 98, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
Failed example:
    s
Expected:
    [{y: 1, x: 1}]
Got:
    [{x: 1, y: 1}]
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 2828, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.smooth_critical_ideal
Failed example:
    F.smooth_critical_ideal(alpha)
Expected:
    Ideal (y^2 + 2*a1/a2*y - 1, x + ((-a2)/a1)*y + (-a1 + a2)/a1) of
     Multivariate Polynomial Ring in x, y over Fraction Field of
     Multivariate Polynomial Ring in a1, a2 over Rational Field
Got:
    Ideal (y^2 + 2*a1/a2*y - 1, x + ((-a2)/a1)*y + (a2 - a1)/a1) of Multivariate Polynomial Ring in x, y over Fraction Field of Multivariate Polynomial Ring in a2, a1 over Rational Field
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4373, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.coerce_point
Failed example:
    p
Expected:
    {y: 7/8, x: 1}
Got:
    {x: 1, y: 7/8}
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4375, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.coerce_point
Failed example:
    for k in sorted(p.keys()):
        print k, k.parent()
Expected:
    y Symbolic Ring
    x Symbolic Ring
Got:
    x Symbolic Ring
    y Symbolic Ring
**********************************************************************
3 items had failures:
   1 of  77 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
   1 of  16 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.FractionWithFactoredDenominator.smooth_critical_ideal
   2 of  11 in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.coerce_point
    [809 tests, 4 failures, 74.86 s]
```



---

Comment by dkrenn created at 2016-02-16 07:48:51

Replying to [comment:127 vbraun]:
> {{{
> sage -t --long src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
> **********************************************************************
> File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 98, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions
> Failed example:
>     s
> Expected:
>     [{y: 1, x: 1}]
> Got:
>     [{x: 1, y: 1}]
> }}}

Hmmm...I thought there is something like a display-hook, which catches such things (orderings in dicts and sets).

> {{{
> **********************************************************************
> File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4373, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.coerce_point
> Failed example:
>     p
> Expected:
>     {y: 7/8, x: 1}
> Got:
>     {x: 1, y: 7/8}
> }}}

The same here...

For the other issues: I am confident to fix.


---

Comment by git created at 2016-02-16 08:05:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-16 08:24:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-02-16 08:25:30

The displayhook sorts but x, y have no particular order
----
New commits:


---

Comment by dkrenn created at 2016-02-16 08:27:40

I've now fixed all (at least I hope I got all) platform-dependent. Can someone please check with other platform than Linux, x86_64 on Intel i5-4690?


---

Comment by dkrenn created at 2016-02-16 08:28:27

Replying to [comment:131 vbraun]:
> The displayhook sorts but x, y have no particular order

Oh, I see (I thought, that display hooks sort by `str` in such a case). Thanks.


---

Comment by tscrim created at 2016-02-16 15:42:55

Replying to [comment:132 dkrenn]:
> I've now fixed all (at least I hope I got all) platform-dependent. Can someone please check with other platform than Linux, x86_64 on Intel i5-4690?

I didn't see a difference from the original doctests on my laptop, so I can't give an explicit check. However, from looking over the doctestvs and Volker's failures, this seems to do the trick. Although I don't like the changes on ​85c1f37. Instead, I think you should just explicitly check that the dictionary of solutions is the correct one:

```
sage: s == [{SR(x): 1, SR(y): 1}]
True
```



---

Comment by git created at 2016-02-16 15:59:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-16 16:01:52

Replying to [comment:134 tscrim]:
Although I don't like the changes on ​85c1f37. Instead, I think you should just explicitly check that the dictionary of solutions is the correct one:
> {{{
> sage: s == [{SR(x): 1, SR(y): 1}]
> True
> }}}

Reverted and changed; indeed much nicer.


---

Comment by dkrenn created at 2016-02-16 16:02:03

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-02-16 16:02:25

Thanks!


---

Comment by tscrim created at 2016-02-16 16:02:25

Changing status from needs_review to positive_review.


---

Comment by git created at 2016-02-16 16:22:36

Changing status from positive_review to needs_review.


---

Comment by git created at 2016-02-16 16:22:36

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by tscrim created at 2016-02-16 16:24:34

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-02-17 21:12:36

Resolution: fixed
