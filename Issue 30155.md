# Issue 30155: Cygwin: can't build Numpy 1.9.1

Issue created by migration from https://trac.sagemath.org/ticket/30392

Original creator: embray

Original creation time: 2020-08-19 14:24:47

Keywords: cygwin numpy

Since #29766 I cannot build Numpy 1.9.1 on Cygwin, specifically with AVX enabled, due to this issue in Numpy (actually caused by a bug in GCC): https://github.com/numpy/numpy/issues/16290


I've been meaning to work on this issue anyways, so I'll see if I can find a clean workaround.  If not, it also works to pass some CFLAGS to the Numpy build as noted on the upstream issues.


---

Comment by mkoeppe created at 2020-08-19 17:28:19

Yes, this is important to fix. Unfortunately the CI infrastructure does not catch this because we cannot control the processor variant that will run the job. For example, ~~https://github.com/sagemath/sage/runs/969113336?check_suite_focus=true~~ https://github.com/sagemath/sage/runs/1002630008 has built numpy successfully.

With which compiler are you observing this failure?


---

Comment by mkoeppe created at 2020-08-31 13:50:54

The discussion at https://github.com/numpy/numpy/issues/14787 seems to suggest that nothing needs to be fixed with current compilers. Do you still experience the build problem?


---

Comment by embray created at 2020-08-31 14:37:15

It is a problem with GCC<8.4.

I started on a patch to Numpy the week before last but hit a snag before I was able to finish it.  Then I went on vacation :P

An ugly but acceptable workaround is also to set


```
CFLAGS=-ffixed-xmm16 -ffixed-xmm17 -ffixed-xmm18 -ffixed-xmm19 -ffixed-xmm20 -ffixed-xmm21 -ffixed-xmm22 -ffixed-xmm23 -ffixed-xmm24 -ffixed-xmm25 -ffixed-xmm26 -ffixed-xmm27 -ffixed-xmm28 -ffixed-xmm29 -ffixed-xmm30 -ffixed-xmm31
```


when compiling Numpy.


---

Comment by mkoeppe created at 2020-08-31 15:03:08

Current cygwin has gcc 10.2. 

I would suggest to limit support of a from-source build of Sage on Cygwin to the latest Cygwin version and encourage users to update Cygwin.

(Does cygwin even have a supported way to install an older version of the distribution?)


---

Comment by mkoeppe created at 2020-08-31 16:31:35

Changing priority from blocker to major.


---

Comment by mkoeppe created at 2021-03-26 16:21:37

We can close this one as outdated


---

Comment by mkoeppe created at 2021-03-26 16:21:37

Changing status from new to needs_review.


---

Comment by embray created at 2021-03-29 07:52:05

I believe so, yes.  Most Cygwin installs are not on GCC<8.4 by default, and I have also fixed the issue in Numpy.


---

Comment by embray created at 2021-03-29 07:52:05

Resolution: worksforme
