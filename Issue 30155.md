# Issue 30155: Cygwin: can't build Numpy 1.9.1

archive/issues_030155.json:
```json
{
    "body": "Keywords: cygwin numpy\n\nSince #29766 I cannot build Numpy 1.9.1 on Cygwin, specifically with AVX enabled, due to this issue in Numpy (actually caused by a bug in GCC): https://github.com/numpy/numpy/issues/16290\n\n\nI've been meaning to work on this issue anyways, so I'll see if I can find a clean workaround.  If not, it also works to pass some CFLAGS to the Numpy build as noted on the upstream issues.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30392\n\n",
    "created_at": "2020-08-19T14:24:47Z",
    "labels": [
        "porting: Cygwin",
        "blocker",
        "bug"
    ],
    "title": "Cygwin: can't build Numpy 1.9.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30155",
    "user": "embray"
}
```
Keywords: cygwin numpy

Since #29766 I cannot build Numpy 1.9.1 on Cygwin, specifically with AVX enabled, due to this issue in Numpy (actually caused by a bug in GCC): https://github.com/numpy/numpy/issues/16290


I've been meaning to work on this issue anyways, so I'll see if I can find a clean workaround.  If not, it also works to pass some CFLAGS to the Numpy build as noted on the upstream issues.

Issue created by migration from https://trac.sagemath.org/ticket/30392





---

archive/issue_comments_429630.json:
```json
{
    "body": "Yes, this is important to fix. Unfortunately the CI infrastructure does not catch this because we cannot control the processor variant that will run the job. For example, ~~https://github.com/sagemath/sage/runs/969113336?check_suite_focus=true~~ https://github.com/sagemath/sage/runs/1002630008 has built numpy successfully.\n\nWith which compiler are you observing this failure?",
    "created_at": "2020-08-19T17:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429630",
    "user": "mkoeppe"
}
```

Yes, this is important to fix. Unfortunately the CI infrastructure does not catch this because we cannot control the processor variant that will run the job. For example, ~~https://github.com/sagemath/sage/runs/969113336?check_suite_focus=true~~ https://github.com/sagemath/sage/runs/1002630008 has built numpy successfully.

With which compiler are you observing this failure?



---

archive/issue_comments_429631.json:
```json
{
    "body": "The discussion at https://github.com/numpy/numpy/issues/14787 seems to suggest that nothing needs to be fixed with current compilers. Do you still experience the build problem?",
    "created_at": "2020-08-31T13:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429631",
    "user": "mkoeppe"
}
```

The discussion at https://github.com/numpy/numpy/issues/14787 seems to suggest that nothing needs to be fixed with current compilers. Do you still experience the build problem?



---

archive/issue_comments_429632.json:
```json
{
    "body": "It is a problem with GCC<8.4.\n\nI started on a patch to Numpy the week before last but hit a snag before I was able to finish it.  Then I went on vacation :P\n\nAn ugly but acceptable workaround is also to set\n\n\n```\nCFLAGS=-ffixed-xmm16 -ffixed-xmm17 -ffixed-xmm18 -ffixed-xmm19 -ffixed-xmm20 -ffixed-xmm21 -ffixed-xmm22 -ffixed-xmm23 -ffixed-xmm24 -ffixed-xmm25 -ffixed-xmm26 -ffixed-xmm27 -ffixed-xmm28 -ffixed-xmm29 -ffixed-xmm30 -ffixed-xmm31\n```\n\n\nwhen compiling Numpy.",
    "created_at": "2020-08-31T14:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429632",
    "user": "embray"
}
```

It is a problem with GCC<8.4.

I started on a patch to Numpy the week before last but hit a snag before I was able to finish it.  Then I went on vacation :P

An ugly but acceptable workaround is also to set


```
CFLAGS=-ffixed-xmm16 -ffixed-xmm17 -ffixed-xmm18 -ffixed-xmm19 -ffixed-xmm20 -ffixed-xmm21 -ffixed-xmm22 -ffixed-xmm23 -ffixed-xmm24 -ffixed-xmm25 -ffixed-xmm26 -ffixed-xmm27 -ffixed-xmm28 -ffixed-xmm29 -ffixed-xmm30 -ffixed-xmm31
```


when compiling Numpy.



---

archive/issue_comments_429633.json:
```json
{
    "body": "Current cygwin has gcc 10.2. \n\nI would suggest to limit support of a from-source build of Sage on Cygwin to the latest Cygwin version and encourage users to update Cygwin.\n\n(Does cygwin even have a supported way to install an older version of the distribution?)",
    "created_at": "2020-08-31T15:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429633",
    "user": "mkoeppe"
}
```

Current cygwin has gcc 10.2. 

I would suggest to limit support of a from-source build of Sage on Cygwin to the latest Cygwin version and encourage users to update Cygwin.

(Does cygwin even have a supported way to install an older version of the distribution?)



---

archive/issue_comments_429634.json:
```json
{
    "body": "Changing priority from blocker to major.",
    "created_at": "2020-08-31T16:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429634",
    "user": "mkoeppe"
}
```

Changing priority from blocker to major.



---

archive/issue_comments_429635.json:
```json
{
    "body": "We can close this one as outdated",
    "created_at": "2021-03-26T16:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429635",
    "user": "mkoeppe"
}
```

We can close this one as outdated



---

archive/issue_comments_429636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-26T16:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429636",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_429637.json:
```json
{
    "body": "I believe so, yes.  Most Cygwin installs are not on GCC<8.4 by default, and I have also fixed the issue in Numpy.",
    "created_at": "2021-03-29T07:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429637",
    "user": "embray"
}
```

I believe so, yes.  Most Cygwin installs are not on GCC<8.4 by default, and I have also fixed the issue in Numpy.



---

archive/issue_comments_429638.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2021-03-29T07:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30155#issuecomment-429638",
    "user": "embray"
}
```

Resolution: worksforme
