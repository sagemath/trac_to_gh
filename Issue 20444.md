# Issue 20444: Cythonize arithmetic special methods in the categories

archive/issues_020444.json:
```json
{
    "body": "Keywords: performance\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20681\n\n",
    "created_at": "2016-05-25T21:59:29Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Cythonize arithmetic special methods in the categories",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20444",
    "user": "https://github.com/nthiery"
}
```
Keywords: performance



Issue created by migration from https://trac.sagemath.org/ticket/20681





---

archive/issue_comments_281445.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-25T22:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281445",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_281446.json:
```json
{
    "body": "There is a doctest failure in `src/sage/categories/primer.py` due to the new location of `__mul__` for magmas, and I am not sure how you would want to change the primer to reflect that. Also if you could remove the two added blanklines in `finite_dimensional_modules_with_basis.py`. Thank you.\n\n---\nNew commits:",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281446",
    "user": "https://github.com/tscrim"
}
```

There is a doctest failure in `src/sage/categories/primer.py` due to the new location of `__mul__` for magmas, and I am not sure how you would want to change the primer to reflect that. Also if you could remove the two added blanklines in `finite_dimensional_modules_with_basis.py`. Thank you.

---
New commits:



---

archive/issue_comments_281447.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-26T06:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281447",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_281448.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T07:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281448",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T08:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T08:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281451.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-26T09:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281451",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281452.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-26T09:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281452",
    "user": "https://github.com/tscrim"
}
```

New commits:



---

archive/issue_comments_281453.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T10:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281453",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281454.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T10:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281455.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-26T10:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281455",
    "user": "https://github.com/nthiery"
}
```

New commits:



---

archive/issue_comments_281456.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-26T10:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281456",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_281457.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2016-05-26T11:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281457",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_281458.json:
```json
{
    "body": "I understand the point of this patch, but I think it's not the right thing to do. The methods you define now in `coercion_methods.pyx` are just copies of methods available in various subclasses of `Element` anyway (e.g. `ModuleElement`, `RingElement`).\n\nI think the right thing to do is just to get rid of the category framework for these arithmetic methods and just define them in `Element`. That will be even faster than the current patch.",
    "created_at": "2016-05-26T11:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281458",
    "user": "https://github.com/jdemeyer"
}
```

I understand the point of this patch, but I think it's not the right thing to do. The methods you define now in `coercion_methods.pyx` are just copies of methods available in various subclasses of `Element` anyway (e.g. `ModuleElement`, `RingElement`).

I think the right thing to do is just to get rid of the category framework for these arithmetic methods and just define them in `Element`. That will be even faster than the current patch.



---

archive/issue_comments_281459.json:
```json
{
    "body": "In other words: you write\n\n```\n# This could eventually be moved to SageObject\n```\nI think you should just do that instead (but for `Element` instead of `SageObject`).",
    "created_at": "2016-05-26T11:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281459",
    "user": "https://github.com/jdemeyer"
}
```

In other words: you write

```
# This could eventually be moved to SageObject
```
I think you should just do that instead (but for `Element` instead of `SageObject`).



---

archive/issue_comments_281460.json:
```json
{
    "body": "Note that I don't really have anything against this ticket (if it improves things, why not). So, feel free to set the ticket back to positive_review if you disagree with me.",
    "created_at": "2016-05-26T11:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281460",
    "user": "https://github.com/jdemeyer"
}
```

Note that I don't really have anything against this ticket (if it improves things, why not). So, feel free to set the ticket back to positive_review if you disagree with me.



---

archive/issue_comments_281461.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> In other words: you write\n> \n> ```\n> # This could eventually be moved to SageObject\n> ```\n> I think you should just do that instead (but for `Element` instead of `SageObject`).\n\n\n(for the record: I just moved that comment which was already there).\n\nYes, I pondered about that, since we had this parallel discussion\nabout moving all the coercion methods up to Element. If we do the\nmove, we should do it for all coercion methods at once. However, given\nthat this moving is a non trivial API change and still under\ndiscussion, I prefer to postpone it to a later ticket.",
    "created_at": "2016-05-26T12:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281461",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:16 jdemeyer]:
> In other words: you write
> 
> ```
> # This could eventually be moved to SageObject
> ```
> I think you should just do that instead (but for `Element` instead of `SageObject`).


(for the record: I just moved that comment which was already there).

Yes, I pondered about that, since we had this parallel discussion
about moving all the coercion methods up to Element. If we do the
move, we should do it for all coercion methods at once. However, given
that this moving is a non trivial API change and still under
discussion, I prefer to postpone it to a later ticket.



---

archive/issue_comments_281462.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-05-26T12:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281462",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_281463.json:
```json
{
    "body": "Thanks though for raising this!",
    "created_at": "2016-05-26T12:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281463",
    "user": "https://github.com/nthiery"
}
```

Thanks though for raising this!



---

archive/issue_comments_281464.json:
```json
{
    "body": "see patchbot report",
    "created_at": "2016-05-27T23:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281464",
    "user": "https://github.com/vbraun"
}
```

see patchbot report



---

archive/issue_comments_281465.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-05-27T23:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281465",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_281466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-28T07:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281467.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-28T07:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281467",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281468.json:
```json
{
    "body": "Nicolas, can you double check. Also are the referenced methods correct in the `__*mul__` doc?",
    "created_at": "2016-05-28T07:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281468",
    "user": "https://github.com/tscrim"
}
```

Nicolas, can you double check. Also are the referenced methods correct in the `__*mul__` doc?



---

archive/issue_comments_281469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-28T08:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281469",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281470.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-28T08:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281470",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_281471.json:
```json
{
    "body": "Thanks for all the rest fixes! I had actually just about to start working on them :-)",
    "created_at": "2016-05-28T08:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281471",
    "user": "https://github.com/nthiery"
}
```

Thanks for all the rest fixes! I had actually just about to start working on them :-)



---

archive/issue_comments_281472.json:
```json
{
    "body": "PDF docs still don't build",
    "created_at": "2016-05-28T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281472",
    "user": "https://github.com/vbraun"
}
```

PDF docs still don't build



---

archive/issue_comments_281473.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-05-28T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281473",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_281474.json:
```json
{
    "body": "My guess is that it doesn't like that `coercion_methods.pyx` does not have any public methods. We probably should `autodoc` those all in anyways...",
    "created_at": "2016-05-29T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281474",
    "user": "https://github.com/tscrim"
}
```

My guess is that it doesn't like that `coercion_methods.pyx` does not have any public methods. We probably should `autodoc` those all in anyways...



---

archive/issue_comments_281475.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-30T06:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281476.json:
```json
{
    "body": "Do we want to include these functions into the html/pdf doc or keep them hidden?",
    "created_at": "2016-05-30T08:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281476",
    "user": "https://github.com/tscrim"
}
```

Do we want to include these functions into the html/pdf doc or keep them hidden?



---

archive/issue_comments_281477.json:
```json
{
    "body": "We definitely would want to have them appear in the doc of the original classes. But this will only happen when we finally configure Sphinx to include the special methods (which are not private methods!).\n\nFor the \"coercion_methods\" module, it does not really matter.\n\nThe pdf doc compiles on my machine after my latest rest fix.",
    "created_at": "2016-05-30T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281477",
    "user": "https://github.com/nthiery"
}
```

We definitely would want to have them appear in the doc of the original classes. But this will only happen when we finally configure Sphinx to include the special methods (which are not private methods!).

For the "coercion_methods" module, it does not really matter.

The pdf doc compiles on my machine after my latest rest fix.



---

archive/issue_comments_281478.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-30T21:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281478",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281479.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-30T21:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281479",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_281480.json:
```json
{
    "body": "Okay. Let's get this into Sage.",
    "created_at": "2016-05-30T21:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281480",
    "user": "https://github.com/tscrim"
}
```

Okay. Let's get this into Sage.



---

archive/issue_comments_281481.json:
```json
{
    "body": "Part of this ticket was already merged in 7.3.beta2. Please take whatever else was on this ticket and move it to a new ticket.",
    "created_at": "2016-05-31T07:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281481",
    "user": "https://github.com/vbraun"
}
```

Part of this ticket was already merged in 7.3.beta2. Please take whatever else was on this ticket and move it to a new ticket.



---

archive/issue_events_055657.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-31T07:36:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20444#event-55657"
}
```



---

archive/issue_comments_281482.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-31T07:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281482",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_281483.json:
```json
{
    "body": "See #20733",
    "created_at": "2016-05-31T13:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281483",
    "user": "https://github.com/vbraun"
}
```

See #20733



---

archive/issue_comments_281484.json:
```json
{
    "body": "Follow-up: most of this new file will be removed in #20767. Only `_mul_parent` will remain.",
    "created_at": "2016-08-01T15:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20444",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20444#issuecomment-281484",
    "user": "https://github.com/jdemeyer"
}
```

Follow-up: most of this new file will be removed in #20767. Only `_mul_parent` will remain.
