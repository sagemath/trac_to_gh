# Issue 20444: Cythonize arithmetic special methods in the categories

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2016-05-25 21:59:29

Keywords: performance




---

Comment by nthiery created at 2016-05-25 22:57:59

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-05-26 06:02:34

There is a doctest failure in `src/sage/categories/primer.py` due to the new location of `__mul__` for magmas, and I am not sure how you would want to change the primer to reflect that. Also if you could remove the two added blanklines in `finite_dimensional_modules_with_basis.py`. Thank you.
----
New commits:


---

Comment by tscrim created at 2016-05-26 06:02:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-05-26 07:38:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-26 08:56:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-26 08:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-05-26 09:00:50

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-05-26 09:11:44

New commits:


---

Comment by git created at 2016-05-26 10:12:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-26 10:15:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-05-26 10:16:06

New commits:


---

Comment by tscrim created at 2016-05-26 10:16:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-05-26 11:32:44

Changing status from positive_review to needs_info.


---

Comment by jdemeyer created at 2016-05-26 11:32:44

I understand the point of this patch, but I think it's not the right thing to do. The methods you define now in `coercion_methods.pyx` are just copies of methods available in various subclasses of `Element` anyway (e.g. `ModuleElement`, `RingElement`).

I think the right thing to do is just to get rid of the category framework for these arithmetic methods and just define them in `Element`. That will be even faster than the current patch.


---

Comment by jdemeyer created at 2016-05-26 11:35:36

In other words: you write

```
# This could eventually be moved to SageObject
```

I think you should just do that instead (but for `Element` instead of `SageObject`).


---

Comment by jdemeyer created at 2016-05-26 11:41:03

Note that I don't really have anything against this ticket (if it improves things, why not). So, feel free to set the ticket back to positive_review if you disagree with me.


---

Comment by nthiery created at 2016-05-26 12:57:24

Replying to [comment:16 jdemeyer]:
> In other words: you write
> {{{
> # This could eventually be moved to SageObject
> }}}
> I think you should just do that instead (but for `Element` instead of `SageObject`).

(for the record: I just moved that comment which was already there).

Yes, I pondered about that, since we had this parallel discussion
about moving all the coercion methods up to Element. If we do the
move, we should do it for all coercion methods at once. However, given
that this moving is a non trivial API change and still under
discussion, I prefer to postpone it to a later ticket.


---

Comment by nthiery created at 2016-05-26 12:58:30

Changing status from needs_info to positive_review.


---

Comment by nthiery created at 2016-05-26 12:58:30

Thanks though for raising this!


---

Comment by vbraun created at 2016-05-27 23:02:26

see patchbot report


---

Comment by vbraun created at 2016-05-27 23:02:26

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-05-28 07:42:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-05-28 07:43:04

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-05-28 07:43:04

Nicolas, can you double check. Also are the referenced methods correct in the `__*mul__` doc?


---

Comment by git created at 2016-05-28 08:34:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-05-28 08:36:41

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2016-05-28 08:36:41

Thanks for all the rest fixes! I had actually just about to start working on them :-)


---

Comment by vbraun created at 2016-05-28 14:19:15

PDF docs still don't build


---

Comment by vbraun created at 2016-05-28 14:19:15

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2016-05-29 13:47:50

My guess is that it doesn't like that `coercion_methods.pyx` does not have any public methods. We probably should `autodoc` those all in anyways...


---

Comment by git created at 2016-05-30 06:57:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-05-30 08:21:48

Do we want to include these functions into the html/pdf doc or keep them hidden?


---

Comment by nthiery created at 2016-05-30 21:50:35

We definitely would want to have them appear in the doc of the original classes. But this will only happen when we finally configure Sphinx to include the special methods (which are not private methods!).

For the "coercion_methods" module, it does not really matter.

The pdf doc compiles on my machine after my latest rest fix.


---

Comment by nthiery created at 2016-05-30 21:50:49

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-05-30 21:52:20

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-05-30 21:52:20

Okay. Let's get this into Sage.


---

Comment by vbraun created at 2016-05-31 07:36:59

Part of this ticket was already merged in 7.3.beta2. Please take whatever else was on this ticket and move it to a new ticket.


---

Comment by vbraun created at 2016-05-31 07:36:59

Resolution: fixed


---

Comment by vbraun created at 2016-05-31 13:51:44

See #20733


---

Comment by jdemeyer created at 2016-08-01 15:16:27

Follow-up: most of this new file will be removed in #20767. Only `_mul_parent` will remain.
