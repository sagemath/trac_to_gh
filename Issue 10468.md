# Issue 10468: notebook upload of zipped worksheets can't deal with multiple worksheets with the same name

Issue created by migration from Trac.

Original creator: jason

Original creation time: 2010-12-24 03:33:41

Assignee: jason, mpatel, was

CC:  mvngu chapoton

When uploading a zip file of worksheets to the notebook, if multiple  worksheets have the same name, only one of the worksheets is extracted (multiple times).  This is because the zip extraction code iterates through the file *names* instead of zipinfo file *objects* in the zip file.  The attached patch takes care of this, and fixes uploads of zip files containing multiple worksheets having the same name.

This bit me several times today.


---

Comment by jason created at 2010-12-24 03:43:29

apply to sagenb repository


---

Comment by jason created at 2010-12-24 06:13:52

Changing status from new to needs_review.


---

Attachment


---

Comment by ddrake created at 2011-04-06 00:29:50

This might conflict with #10652, which affects the same notebook code.


---

Comment by jason created at 2011-04-06 00:42:27

You're right; almost certainly there will be a conflict.


---

Attachment

apply to sagenb repo


---

Comment by ltw created at 2011-06-17 21:42:25

I have re-based the patch on `sagenb-0.8.14` (which is the version that ships with `sage-4.7`).


---

Comment by slabbe created at 2011-06-22 21:19:26

Can somebody upload a zip file somewhere so that we can more easily understand the problem and review this ticket.

For example, this is what I did while working on [this issue](http://code.google.com/p/sagenb/issues/detail?id=33) of the new Sage flask Notebook.

Note that the file `twist.py` is deprecated in the the Flask Notebook. Hence, this patch will have to be re-based again. I am ready to do it since I worked in the exact same line while fixing the above issue. But a zip file would be appreciated. For example, I don't understand how two files can have the same name if they are in the same directory (I believe it is True, but I need an example to understand).

Sébastien


---

Comment by slabbe created at 2011-06-22 21:19:26

Changing status from needs_review to needs_info.


---

Comment by ltw created at 2011-06-22 22:02:18

I don't know anything about the new notebook, but here are the steps to reproduce the problem on the (unpatched) "old" notebook:

  1. Create two worksheets with different contents but give them the same name.
  1. Download all active worksheets via the link.
  1. (optional) Delete the worksheets from the server -- just to prevent confusion.
  1. Upload the zip file created in step 2.
  1. Examine the two worksheets created: they are duplicates of only one worksheet from the zip file. The other worksheet was never extracted.


---

Comment by ddrake created at 2011-06-22 22:48:54

test zip file with two worksheets with the same name


---

Attachment

test zip file with two worksheets with the same name


---

Comment by ddrake created at 2011-06-22 23:00:47

attachment:download_worksheets.2.zip is a zip file of the kind that ltw described. I created two worksheets with the same name but with different contents (either "This is the first worksheet" or "This is the second worksheet").

I made a mistake with attachment:download_worksheets.zip that is perhaps instructive: I opened the zipfile produced by the notebook (version 4.7) in Ubuntu's Archive Manager, and when I use "Save As" to save it to a file, I get the zip file you see in attachment:download_worksheets.zip.

So my guess is that either (1) the zip file spec doesn't really support having two files with the same name in the same directory, or (2) the zip tools being used don't properly handle these files. Since we can't control what zip tools users use, I propose that when the notebook creates the zip file, it fixes up the .sws filenames so that they are all unique. (That is, we fix this on the "creation end", and not on the "consumption end")

Sebastien, what did you do in the Flask notebook?


---

Comment by slabbe created at 2011-06-23 03:42:33

> Sebastien, what did you do in the Flask notebook?

This :

http://code.google.com/r/slabqc-flask/source/detail?r=b8734085045a37e865fcdd9b28d954a02d0d5e76

(I just pushed it on the google code.)

to fix this issue :

http://code.google.com/p/sagenb/issues/detail?id=33

Sébastien


---

Comment by jason created at 2011-07-02 19:09:09

We need to fix this on the consumption end as well as the creation end, because as you say, we can't control what zip tools the users use.  We don't know what kinds of zip files we'll be getting, and we don't know if those zip files have this problem (for example, an old zip file of worksheets produced by us).


---

Comment by mkoeppe created at 2020-08-18 00:36:52

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2020-08-18 00:36:52

Proposing to close all sagenb tickets as outdated, so that all remaining open tickets in the notebook component are about the Jupyter notebook.


---

Comment by slabbe created at 2020-08-18 12:38:36

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-08-22 11:40:56

Resolution: invalid
