# Issue 20694: Brial segfaults with gcc6

Issue created by migration from https://trac.sagemath.org/ticket/20931

Original creator: vbraun

Original creation time: 2016-07-03 15:38:05

CC:  fbissey leif

Keywords: gcc6 c++11

This is with #20741:

```
sage -t src/sage/rings/polynomial/pbori.pyx
**********************************************************************
File "src/sage/rings/polynomial/pbori.pyx", line 125, in sage.rings.polynomial.pbori
Failed example:
    for f in I2.groebner_basis():
        f
Exception raised:
    Traceback (most recent call last):
      File "/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.pbori[10]>", line 1, in <module>
        for f in I2.groebner_basis():
      File "sage/rings/polynomial/pbori.pyx", line 5081, in sage.rings.polynomial.pbori.BooleanPolynomialIdeal.groebner_basis (build/cythonized/sage/rings/polynomial/pbori.cpp:39983)
        sig_on()
      File "src/cysignals/signals.pyx", line 108, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1448)
    SignalError: Segmentation fault
```



---

Comment by vbraun created at 2016-07-03 17:09:00

Nice testcase:

```
sage: sage: B.<a,b,c,d,e,f> = BooleanPolynomialRing()
sage: sage: I = ideal(a*b + a + b*e + c*e + 1, a + b + c*d + c + 1, a*c + c + d*f + d + 1, a*c + c*f + c + d*f + 1, c*f + c + d + e + 1, a + b*c + b*d + e*f + 1)
sage: sage: I.groebner_basis()
python: ../../groebner/include/polybori/groebner/linear_algebra_step.h:400: void polybori::groebner::linalg_step_modified(std::vector<polybori::BoolePolynomial>&, polybori::groebner::MonomialSet, polybori::groebner::MonomialSet, bool, bool, const char*): Assertion `pivot_row==rows' failed.
```



---

Comment by fbissey created at 2016-07-05 21:17:44

I think I may be at fault by not doing something before releasing `brial`. Can you point to build logs, I want to see if one of my ideas is correct.


---

Comment by thansen created at 2016-12-21 01:10:55

We also see this on Debian, on the i386 architecture but not on amd64. Here is a build log, including the output of sage's testsuite:

https://buildd.debian.org/status/fetch.php?pkg=sagemath&arch=i386&ver=7.4-1&stamp=1482274051


---

Comment by thansen created at 2016-12-21 01:13:41

The brial buildlog is here:

https://buildd.debian.org/status/fetch.php?pkg=brial&arch=i386&ver=0.8.5-3&stamp=1478525676


---

Comment by infinity0 created at 2016-12-21 09:50:15

Same sort of failures on arm v7 hf:

https://buildd.debian.org/status/fetch.php?pkg=sagemath&arch=armhf&ver=7.4-1&stamp=1482301653

(plus some extra Timed out, but I think that is just because the machine is slow.)

These logs are huge, best to download with wget. Unfortunately they are full of &amp;-etc html entities, I'll see if I can find the raw ones somewhere...


---

Comment by infinity0 created at 2016-12-21 12:12:28

Looks like there's an undocumented feature of the buildd web interface - just add `&raw=1` to avoid the HTML.

* https://buildd.debian.org/status/fetch.php?pkg=sagemath&arch=i386&ver=7.4-1&stamp=1482274051&raw=1
* https://buildd.debian.org/status/fetch.php?pkg=brial&arch=i386&ver=0.8.5-3&stamp=1478525676&raw=1

* https://buildd.debian.org/status/fetch.php?pkg=sagemath&arch=armhf&ver=7.4-1&stamp=1482301653&raw=1


---

Comment by thansen created at 2017-01-01 19:30:46

fbissey, do you remember what was the idea that you had about this?


---

Comment by fbissey created at 2017-01-01 19:40:06

Ha. It turned out to be quite wrong. I thought an option was set in building `brial` that shouldn't have. But reviewing the mechanics of the `configure` script I was wrong. There is also https://github.com/BRiAl/BRiAl/issues/11 which I am not sure you are experiencing but feels different from your backtrace which is showing double free problems.


---

Comment by fbissey created at 2017-01-01 20:56:35

Thobias, can you easily test a git snapshot in debian? If so I pushed some changes to BRiAl that should at least be related to Volker's initial troubles as part of https://github.com/BRiAl/BRiAl/issues/11 - in fact I also found a typo that prevented some configure options to work...


---

Comment by thansen created at 2017-01-01 21:09:02

Sure, I will test a package with the new commit 63f747626822f5e0fa2bf975f7801fcc988eb530 applied as a patch. Can I drop the flag -std=c++98 that we have as a workaround for issue 11?


---

Comment by fbissey created at 2017-01-01 21:11:44

I am not sure, c++ is really not my forte. My gut feeling is that yes it can be dropped. If there are compilation problems then they should be filled as new issues I guess.


---

Comment by jdemeyer created at 2017-10-13 08:30:36

Replying to [comment:11 thansen]:
> Sure, I will test a package with the new commit 63f747626822f5e0fa2bf975f7801fcc988eb530 applied as a patch. Can I drop the flag -std=c++98 that we have as a workaround for issue 11?

Any news here?


---

Comment by fbissey created at 2017-10-13 08:44:54

Well, I have been using the new brial in sage-on-gentoo with gcc 6.4.0 for a little while now (sans your latest patch) and it is fine. I fixed a few things that were troublesome. The only issue seem to be in the test suite with gcc 6 and boost 1.65+ right now. Otherwise there are no issues.


---

Comment by jdemeyer created at 2017-10-13 08:52:38

So we can close this?


---

Comment by fbissey created at 2017-10-13 08:56:49

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2018-06-01 12:49:12

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-02-26 13:58:00

Resolution: invalid


---

Comment by embray created at 2019-02-26 13:58:00

Presuming these are all correctly reviewed as either duplicate, invalid, or wontfix.
