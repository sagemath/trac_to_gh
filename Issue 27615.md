# Issue 27615: Refactor structure of RSK

Issue created by migration from https://trac.sagemath.org/ticket/27852

Original creator: @ChamanAgrawal

Original creation time: 2019-05-20 01:45:35

CC:  tscrim darij aschilling

Keywords: gsocRSK

To change the structure of rsk() function to follow a Rule-based framework.


---

Comment by @ChamanAgrawal created at 2019-05-20 01:47:37

Changing type from PLEASE CHANGE to task.


---

Comment by @ChamanAgrawal created at 2019-05-20 02:11:34

New commits:


---

Comment by @ChamanAgrawal created at 2019-05-20 02:17:35

`@`tscrim.
WIP
The current code is not working (Doc tests and all).


---

Comment by git created at 2019-05-20 17:38:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ChamanAgrawal created at 2019-05-20 17:39:06

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by git created at 2019-05-21 18:14:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-24 18:19:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-25 11:02:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-27 20:18:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-28 18:26:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-30 21:04:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-31 21:24:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-05 17:39:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-06 17:41:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-07 18:37:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-11 17:29:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-13 18:05:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-15 02:51:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-16 08:09:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-17 13:54:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-17 18:14:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-19 18:46:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-19 20:20:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-20 16:44:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-06-22 06:50:25

Here are my comments on the current version:

The `insertion` and `rev(erse)_insertion` should be doing the insertion on a specific row, and going row-by-row should be done in the `forward_rule` and `backwards_rule`. Look at the amount of common code between the RSK and EG rules.

I prefer the original here:

```diff
-We can perform RSK and the inverse on a variety of objects::
+We can perform RSK and the RSK_inverse on a variety of objects::
```


`type-`A`` -> `type `A``

I think we should move all of the information about the different types of insertions to their respective rule class docs. It is better locality and the RSK module-level doc will only be looked at by the compiled documentation, so links will be sufficient.

`Returns` -> `Return` for 1-line docs (e.g., in `to_pair`). Similarly `Inserts` -> `Insert`.

`to_pair` does not need to return a `list` from what I see.

For `INPUT:` items, they do not start with a capital letter by convention, e.g.

```diff
-        - ``check_standard`` -- (Default: ``False``) Check if either of the
+        - ``check_standard`` -- (default: ``False``) check if either of the
```


Comments should be followed by at least one space.

I would move the `import` from `_forward_formatOutput` to the module-level. (Or does this cause an import cycle?) Same for the import of `from bisect import bisect_left`.

`_*_formatOuput` -> `_*_format_output`.

You should have the doc lines at most 80 chars/line (unless there is a really good reason to do so).

`rev_insertion` -> `reverse_insertion`

`Examples::` -> `EXAMPLES::`

I would just call `p_copy` `p` in `rev(erse)_insertion`.


```diff
-For precise information about I/O constrains, see the particular Rule class.
+For precise information about constraints on the input and
+output, see the particular :class:`~sage.combinat.rsk.Rule` class.
```



---

Comment by git created at 2019-06-22 20:17:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-22 22:37:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-06-23 21:57:30

This is looking much better. A few more comments:

Change:

```diff
-                r = [j]; p.append(r)
-                qr = [i]; q.append(qr)
+                p.append([j])
+                q.append([i])
```


```diff
-d = dict((qij,i) for i, Li in enumerate(q) for qij in Li)
+d = {qij: i for i, Li in enumerate(q) for qij in Li}
```


I don't think the `insertion` needs to take the `qr` as you can have it have a `True/False` return value which then is handled by the `forward_rule` function (you always add to the end of the row).

I might have a few more additional comments, but this is all I have time right now to look at. However, you should now set this to needs review and put your real name as the author.


---

Comment by @ChamanAgrawal created at 2019-06-24 02:06:08

Changing status from new to needs_review.


---

Comment by git created at 2019-06-24 02:44:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-26 19:33:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-06-29 06:08:08

A few last little small details:

- For the `INPUT:` blocks, do not start bullet points with a capital letter.
- Remove the blank line before the closing `"""` in the docstrings (personal idiosyncrasy, but I think it looks better without it).
- Space after the `#` for comments (this is a PEP8 thing).
- In `the current insertion tableaux`, it should be the singular `tableau`.
- Remove all trailing whitespace.
- In `RuleEG`, the `TEST::` should be `TESTS:` and the text is overindented.
- For `insertion`, you can just return `None` if the letter was added at the end (so you can drop the `insertion_completed` variable).
- In `forward_rule` after the `else:`, indent the comments one step (i.e., 4 spaces).

Darij, I put you in cc in case you had any comments.


---

Comment by git created at 2019-06-29 15:07:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-29 17:03:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-29 17:53:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-02 06:12:18

A few more trivial comments (from Darij):

```diff
The Robinson-Schensted-Knuth (RSK) correspondence is most naturally
-stated as a bijection between generalized permutation (also known
+stated as a bijection between generalized permutations (also known
as two-line arrays, biwords, ...) and pairs of semi-standard Young
```


```diff
-implemented for the RSK correspondence which can be specify in
+implemented for the RSK correspondence which can be specified in
```



---

Comment by git created at 2019-07-02 18:12:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 07:46:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-08 08:41:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 08:54:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 08:56:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 08:57:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-08 09:20:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 09:42:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 09:48:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:15:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:31:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:33:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:34:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-08 13:35:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @darijgr created at 2019-07-08 13:38:00

Construction zone -- some functionality (reverse EG output as permutation) removed for now since I don't understand it and the tests are broken. We will perhaps want to reintroduce it after reviewing the rest.


---

Comment by git created at 2019-07-08 13:44:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 13:46:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-08 14:10:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 15:38:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 18:15:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-07-08 20:14:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-08 21:29:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @darijgr created at 2019-07-08 21:30:11

This looks good, with one exception: The permutation output for reverse EG is neither doced nor (explicitly) doctested; it's almost an easter egg...


---

Comment by tscrim created at 2019-07-08 21:37:32

There is an explicit test in `RuleEG` for the permutation output (it is the last test in that docstring) and the permutation output doc is inherited from `Rule.backward_rule()`. So they are there.

Also, I forgot to make this change on my push:

```diff
-for RSK() and RSK_inverse() respectively (as methods
+for :func:`RSK()` and :func:`RSK_inverse()` respectively (as methods
```



---

Comment by git created at 2019-07-09 11:16:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-09 12:03:02

Changing type from task to enhancement.


---

Comment by tscrim created at 2019-07-09 12:03:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-07-09 12:03:02

Thank you for the help with the review Darij.


---

Comment by tscrim created at 2019-07-09 12:03:36

Changing keywords from "gsocRSK" to "gsocRSK, fpsac2019".


---

Comment by vbraun created at 2019-07-10 01:31:25

Resolution: fixed
