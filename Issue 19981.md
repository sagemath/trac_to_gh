# Issue 19981: Use pip to install Python depedencies

archive/issues_019981.json:
```json
{
    "body": "CC:  @jdemeyer @vbraun\n\nWork has already been done--for example in #19187--on using `pip` for `sage -i` where appropriate.  However, a normal build of sage does not use `pip` for installing any Python spkgs; rather, they run `python setup.py install` which until recently has always been *the* way to install Python packages.\n\nI can suggest several reasons why `pip` should be used instead of this method.  To be clear--as many people think of `pip` as a tool for installing packages from the internet--this is not strictly the case.  `pip` can be used to install an already downloaded tarball, or even straight from a source tree unpacked from a tarball or checked out from VCS.  The typical way to do this is to change directories to the directory containing the `setup.py` script and running `pip install .`.  This still ultimately calls `setup.py install`, among other `setup.py` commands, but with the right incantations to perform a pip-style flat install.  Now, why is this preferable?\n\n1. Future-compatibility.  One of the goals that the Python packaging community has been working toward over the past several years has been to decouple Python package installation from build system.  Traditionally `setup.py` provided both a build program and an installation program.  At best it will still stick around as a build program, but its use for installation is being discouraged.  There is now finally a PEP (http://legacy.python.org/dev/peps/pep-0516/), still very much in draft state, specifically concerning this decoupling.  Under this new regime `pip` will not likely be the *only* software for installing Python packages, but the assumption can no longer be that there is a `setup.py` script at all.\n\n2. `pip` avoids using `easy_install`.  `easy_install` is an older installation program for Python packages that was bundled with setuptools--when a Python project uses setuptools in its `setup.py`, the `setup.py install` command invokes `easy_install` *by default*.  The behavior of `easy_install` is to install the package as an egg archive/directory.  `easy_install` has several disadvantages, of which this is just one, but there are a couple reasons that this alone is a problem:\n\n\n   a. Every .egg requires a `sys.path` entry, hence difficult to debug paths that look like this:\n\n```python\n>>> pprint(sys.path)\n['',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/setuptools-18.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/MarkupSafe-0.23-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Jinja2-2.7.3-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/six-1.10.0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Pygments-2.0.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/zope.interface-4.1.3-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Twisted-15.5.0-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pytz-2013b0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Babel-2.1.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Werkzeug-0.11.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/speaklater-1.3-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/python_openid-2.2.5-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/itsdangerous-0.24-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask-0.10.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_Silk-0.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_AutoIndex-0.5-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_Babel-0.9-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_OpenID-1.2.5-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_OldSessions-0.10-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/webassets-0.11.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/sagenb-0.11.6.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/backports.ssl_match_hostname-3.4.0.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/certifi-14.5.14-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/tornado-4.1-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/setuptools_scm-1.7.0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/path.py-7.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pickleshare-0.5-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/simplegeneric-0.8.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/decorator-4.0.6-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/networkx-1.10-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/python_dateutil-2.2-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/cycler-0.9.0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/matplotlib-1.5.0-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/jsonschema-2.4.0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/mistune-0.5.1-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pkgconfig-1.1.0-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/singledispatch-3.4.0.3-py2.7.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/rpy2-2.7.5-py2.7-linux-x86_64.egg',\n '/home/iguananaut/src/sagemath/sage/local/lib/python',\n '/home/iguananaut/src/sagemath/sage/local/lib/python/site_packages',\n '/home/iguananaut/src/sagemath/sage/local/lib/python27.zip',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/plat-linux2',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-tk',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-old',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-dynload',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages']\n```\n\n     With the flat install style used by `pip`, and now more generally favored, the `sys.path`, with no eggs, would be simply:\n\n```python\n>>> pprint(sys.path)\n['',\n '/home/iguananaut/src/sagemath/sage/local/lib/python',\n '/home/iguananaut/src/sagemath/sage/local/lib/python27.zip',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/plat-linux2',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-tk',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-old',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-dynload',\n '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages']\n```\n\n     which is certainly easier to read and reason about.\n\n\nb. The egg import mechanism requires writing to a common file during egg installation--easy-install.pth.  This causes problems in parallel installations, requiring patches to setuptools.  The flat install style used by pip has no such problems--there is a no single common file written to by pip during installation of packages (other than maybe the log file, which is only for debugging purposes).\n\nAs I explained in [this comment](http://trac.sagemath.org/timeline?from=2016-02-25T10%3A23%3A37-08%3A00&precision=second), when a Python package is installed with `pip`, `pip` actually slips setuptools into the installation process, whether the package uses it explicitly or not.  There are reasons for this not worth going into now.  This is no problem for the vast majority of cases.  The only exception I know of is that setuptools doesn't handle the `data_files` option well when `--prefix` is changed.  As far as I can tell this is only a problem for sage itself and possibly for sagetex, but these don't even use `setuptools` in the first place, so until we have a workaround for that it does no harm if we keep using `setup.py install` for those packages, if nothing else works.\n\nMost of the rest of the Python packages included by default in a Sage build (I haven't checked all of -optional yet) already use setuptools.  I checked the setup.py of all the rest that don't explicitly use setuptools--these include `docutils`, `mpmath`, `pexpect`, `ptyprocess`, `Pycrypto`, `pyparsing`, `pyzmq`, `scipy`, and all packages from the Jupyter team (`ip*`, `jupyter*`, `np*`, `notebook`, `traitlets`).\n\nMost of these packages are known by me (from personal experience) to work fine with pip.  Looking at the setup.py scripts of the rest of them, most of them are fairly trivial and should work fine.\n\nTL;DR, with the exceptions of sage and sagetex (pending work like #20108), as well as pip itself the `spkg-install` scripts for Python packages should change `setup.py install` commands to `pip install .`.  Their dependencies would also have to be updated to require pip to be installed first.\n\nAt the same time the \"uninstall\" commands in those scripts can be changed to use `pip uninstall`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20218\n\n",
    "created_at": "2016-03-16T10:29:34Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Use pip to install Python depedencies",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19981",
    "user": "https://github.com/embray"
}
```
CC:  @jdemeyer @vbraun

Work has already been done--for example in #19187--on using `pip` for `sage -i` where appropriate.  However, a normal build of sage does not use `pip` for installing any Python spkgs; rather, they run `python setup.py install` which until recently has always been *the* way to install Python packages.

I can suggest several reasons why `pip` should be used instead of this method.  To be clear--as many people think of `pip` as a tool for installing packages from the internet--this is not strictly the case.  `pip` can be used to install an already downloaded tarball, or even straight from a source tree unpacked from a tarball or checked out from VCS.  The typical way to do this is to change directories to the directory containing the `setup.py` script and running `pip install .`.  This still ultimately calls `setup.py install`, among other `setup.py` commands, but with the right incantations to perform a pip-style flat install.  Now, why is this preferable?

1. Future-compatibility.  One of the goals that the Python packaging community has been working toward over the past several years has been to decouple Python package installation from build system.  Traditionally `setup.py` provided both a build program and an installation program.  At best it will still stick around as a build program, but its use for installation is being discouraged.  There is now finally a PEP (http://legacy.python.org/dev/peps/pep-0516/), still very much in draft state, specifically concerning this decoupling.  Under this new regime `pip` will not likely be the *only* software for installing Python packages, but the assumption can no longer be that there is a `setup.py` script at all.

2. `pip` avoids using `easy_install`.  `easy_install` is an older installation program for Python packages that was bundled with setuptools--when a Python project uses setuptools in its `setup.py`, the `setup.py install` command invokes `easy_install` *by default*.  The behavior of `easy_install` is to install the package as an egg archive/directory.  `easy_install` has several disadvantages, of which this is just one, but there are a couple reasons that this alone is a problem:


   a. Every .egg requires a `sys.path` entry, hence difficult to debug paths that look like this:

```python
>>> pprint(sys.path)
['',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/setuptools-18.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Cython-0.23.3-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/MarkupSafe-0.23-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Jinja2-2.7.3-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/six-1.10.0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Pygments-2.0.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/zope.interface-4.1.3-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Twisted-15.5.0-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pytz-2013b0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Babel-2.1.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Werkzeug-0.11.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/speaklater-1.3-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/python_openid-2.2.5-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/itsdangerous-0.24-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask-0.10.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_Silk-0.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_AutoIndex-0.5-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_Babel-0.9-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_OpenID-1.2.5-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/Flask_OldSessions-0.10-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/webassets-0.11.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/sagenb-0.11.6.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/backports.ssl_match_hostname-3.4.0.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/certifi-14.5.14-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/tornado-4.1-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/setuptools_scm-1.7.0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/path.py-7.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pickleshare-0.5-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/simplegeneric-0.8.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/decorator-4.0.6-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/networkx-1.10-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/python_dateutil-2.2-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/cycler-0.9.0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/matplotlib-1.5.0-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/jsonschema-2.4.0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/mistune-0.5.1-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pip-6.1.1-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/pkgconfig-1.1.0-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/singledispatch-3.4.0.3-py2.7.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages/rpy2-2.7.5-py2.7-linux-x86_64.egg',
 '/home/iguananaut/src/sagemath/sage/local/lib/python',
 '/home/iguananaut/src/sagemath/sage/local/lib/python/site_packages',
 '/home/iguananaut/src/sagemath/sage/local/lib/python27.zip',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/plat-linux2',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-tk',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-old',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-dynload',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages']
```

     With the flat install style used by `pip`, and now more generally favored, the `sys.path`, with no eggs, would be simply:

```python
>>> pprint(sys.path)
['',
 '/home/iguananaut/src/sagemath/sage/local/lib/python',
 '/home/iguananaut/src/sagemath/sage/local/lib/python27.zip',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/plat-linux2',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-tk',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-old',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/lib-dynload',
 '/home/iguananaut/src/sagemath/sage/local/lib/python2.7/site-packages']
```

     which is certainly easier to read and reason about.


b. The egg import mechanism requires writing to a common file during egg installation--easy-install.pth.  This causes problems in parallel installations, requiring patches to setuptools.  The flat install style used by pip has no such problems--there is a no single common file written to by pip during installation of packages (other than maybe the log file, which is only for debugging purposes).

As I explained in [this comment](http://trac.sagemath.org/timeline?from=2016-02-25T10%3A23%3A37-08%3A00&precision=second), when a Python package is installed with `pip`, `pip` actually slips setuptools into the installation process, whether the package uses it explicitly or not.  There are reasons for this not worth going into now.  This is no problem for the vast majority of cases.  The only exception I know of is that setuptools doesn't handle the `data_files` option well when `--prefix` is changed.  As far as I can tell this is only a problem for sage itself and possibly for sagetex, but these don't even use `setuptools` in the first place, so until we have a workaround for that it does no harm if we keep using `setup.py install` for those packages, if nothing else works.

Most of the rest of the Python packages included by default in a Sage build (I haven't checked all of -optional yet) already use setuptools.  I checked the setup.py of all the rest that don't explicitly use setuptools--these include `docutils`, `mpmath`, `pexpect`, `ptyprocess`, `Pycrypto`, `pyparsing`, `pyzmq`, `scipy`, and all packages from the Jupyter team (`ip*`, `jupyter*`, `np*`, `notebook`, `traitlets`).

Most of these packages are known by me (from personal experience) to work fine with pip.  Looking at the setup.py scripts of the rest of them, most of them are fairly trivial and should work fine.

TL;DR, with the exceptions of sage and sagetex (pending work like #20108), as well as pip itself the `spkg-install` scripts for Python packages should change `setup.py install` commands to `pip install .`.  Their dependencies would also have to be updated to require pip to be installed first.

At the same time the "uninstall" commands in those scripts can be changed to use `pip uninstall`.

Issue created by migration from https://trac.sagemath.org/ticket/20218





---

archive/issue_comments_274711.json:
```json
{
    "body": "To be clear, I'm working on a patch for this.",
    "created_at": "2016-03-16T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274711",
    "user": "https://github.com/embray"
}
```

To be clear, I'm working on a patch for this.



---

archive/issue_comments_274712.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2016-03-16T14:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274712",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_274713.json:
```json
{
    "body": "IIRC, there was an issue with using pip when python was not compiled with openssl, even for building wihthout downloading. I am not sure that it is still the case, but this particular case should be taken into account since openssl (libssl-dev) is not necessarily available on the system (and cannot be made standard Sage package because of some licensing issues).",
    "created_at": "2016-03-23T13:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274713",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

IIRC, there was an issue with using pip when python was not compiled with openssl, even for building wihthout downloading. I am not sure that it is still the case, but this particular case should be taken into account since openssl (libssl-dev) is not necessarily available on the system (and cannot be made standard Sage package because of some licensing issues).



---

archive/issue_comments_274714.json:
```json
{
    "body": "Its exactly as Thierry says. Hopefully it won't be long until the announced switch of OpenSSL to a GPL-compatible license happens.",
    "created_at": "2016-04-15T21:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274714",
    "user": "https://github.com/vbraun"
}
```

Its exactly as Thierry says. Hopefully it won't be long until the announced switch of OpenSSL to a GPL-compatible license happens.



---

archive/issue_comments_274715.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-20T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274715",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274716.json:
```json
{
    "body": "I've attached a branch containing the beginnings of this work. I've already put it through several rounds of testing locally including installing, reinstalling packages, uninstalling and reinstalling, etc.\n\nBut I'm interested to find out what happens in the patchbot.\n\nI haven't addressed the SSL issue yet but I will.  I wanted to start getting some test / review feedback on the main work in the meantime.\n----\nNew commits:",
    "created_at": "2016-04-20T11:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274716",
    "user": "https://github.com/embray"
}
```

I've attached a branch containing the beginnings of this work. I've already put it through several rounds of testing locally including installing, reinstalling packages, uninstalling and reinstalling, etc.

But I'm interested to find out what happens in the patchbot.

I haven't addressed the SSL issue yet but I will.  I wanted to start getting some test / review feedback on the main work in the meantime.
----
New commits:



---

archive/issue_comments_274717.json:
```json
{
    "body": "Looks like I need to rebase--that's what I get for starting a patch and then not getting around to finishing it until weeks later :)",
    "created_at": "2016-04-20T11:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274717",
    "user": "https://github.com/embray"
}
```

Looks like I need to rebase--that's what I get for starting a patch and then not getting around to finishing it until weeks later :)



---

archive/issue_comments_274718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-20T11:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274719.json:
```json
{
    "body": "This isn't correct:\n\n```\nSage's Python unconditionally removes . from sys.path\nwhich can break several packages' installation\n```\n\n\nSage's Python only removes `.` from `sys.path` if having `.` in `sys.path` might be insecure. If packages break because of this, those packages should be fixed instead of working around the security check.",
    "created_at": "2016-04-20T12:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274719",
    "user": "https://github.com/jdemeyer"
}
```

This isn't correct:

```
Sage's Python unconditionally removes . from sys.path
which can break several packages' installation
```


Sage's Python only removes `.` from `sys.path` if having `.` in `sys.path` might be insecure. If packages break because of this, those packages should be fixed instead of working around the security check.



---

archive/issue_comments_274720.json:
```json
{
    "body": "In case you think that this whole security-thing is exaggerated: I can take over the Unix account of anybody who runs the Python test-suite on a computer where I have an account. When I reported this bug to Python, they didn't really care. When I reported this to IPython (which had a similar bug), they fixed their test-suite.",
    "created_at": "2016-04-20T12:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274720",
    "user": "https://github.com/jdemeyer"
}
```

In case you think that this whole security-thing is exaggerated: I can take over the Unix account of anybody who runs the Python test-suite on a computer where I have an account. When I reported this bug to Python, they didn't really care. When I reported this to IPython (which had a similar bug), they fixed their test-suite.



---

archive/issue_comments_274721.json:
```json
{
    "body": "As someone who has actually surreptitiously taken over Unix accounts, I'm not too impressed by that particular issue. But that's beside the point--I'm not arguing with that right now.\n\nI'll have to more closely look at what that patch does, but I'll change that comment to not supply inaccurate information.  No packages are broken here though.  The reason this is needed is that pip copies files packages to a tmp dir to build them.  I'm actually surprised this hasn't come up for `sage -pip`, though it's only an issue for packages that import themselves in their `setup.py` so maybe it just coincidentally hasn't come up.",
    "created_at": "2016-04-20T13:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274721",
    "user": "https://github.com/embray"
}
```

As someone who has actually surreptitiously taken over Unix accounts, I'm not too impressed by that particular issue. But that's beside the point--I'm not arguing with that right now.

I'll have to more closely look at what that patch does, but I'll change that comment to not supply inaccurate information.  No packages are broken here though.  The reason this is needed is that pip copies files packages to a tmp dir to build them.  I'm actually surprised this hasn't come up for `sage -pip`, though it's only an issue for packages that import themselves in their `setup.py` so maybe it just coincidentally hasn't come up.



---

archive/issue_comments_274722.json:
```json
{
    "body": "Replying to [comment:12 embray]:\n> The reason this is needed is that pip copies files packages to a tmp dir to build them.\n\nIt doesn't hurt if it's in a private directory inside `/tmp`, say `/tmp/my-pip-directory` where `/tmp/my-pip-directory` has reasonable permissions. So I don't fully understand the problem.",
    "created_at": "2016-04-20T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274722",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 embray]:
> The reason this is needed is that pip copies files packages to a tmp dir to build them.

It doesn't hurt if it's in a private directory inside `/tmp`, say `/tmp/my-pip-directory` where `/tmp/my-pip-directory` has reasonable permissions. So I don't fully understand the problem.



---

archive/issue_comments_274723.json:
```json
{
    "body": "Indeed it should be doing that.  It's not like it's putting the package directly under `/tmp`.  It belongs to me and my user-specific group.  So I'm not sure why there would be a problem and yet I am getting the warning about '.' being removed from `sys.path` and the import subsequently fails.",
    "created_at": "2016-04-21T10:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274723",
    "user": "https://github.com/embray"
}
```

Indeed it should be doing that.  It's not like it's putting the package directly under `/tmp`.  It belongs to me and my user-specific group.  So I'm not sure why there would be a problem and yet I am getting the warning about '.' being removed from `sys.path` and the import subsequently fails.



---

archive/issue_comments_274724.json:
```json
{
    "body": "Replying to [comment:14 embray]:\n> Indeed it should be doing that.  It's not like it's putting the package directly under `/tmp`.  It belongs to me and my user-specific group.  So I'm not sure why there would be a problem and yet I am getting the warning about '.' being removed from `sys.path` and the import subsequently fails.\n\nWhat is the *exact* warning message?",
    "created_at": "2016-04-21T11:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274724",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 embray]:
> Indeed it should be doing that.  It's not like it's putting the package directly under `/tmp`.  It belongs to me and my user-specific group.  So I'm not sure why there would be a problem and yet I am getting the warning about '.' being removed from `sys.path` and the import subsequently fails.

What is the *exact* warning message?



---

archive/issue_comments_274725.json:
```json
{
    "body": "Nevermind--I traced this to a bug in pip, combined with a possible minor defect in `sage-uncompress-spkg` (or Python's `tarfile` module depending on your perspective), along with strange packaging for pyparsing, which is the package where this came up originally.\n\n1) It's true that pip creates a temp dir (under `/tmp`, typically) in which to build a package.  This directory is created with `mkdtemp` and normally has safe permissions on it.  However, when installing a package from a source directory (a la `pip install .`), pip then deletes that temp directory, and copies the source directory using `shutil.copytree` to the same path as the just-deleted temp dir.  There are a couple problems with this:\n a) Deleting and recreating the temp dir of the same name involves a possible race condition.\n b) More importantly, while `mkdtemp` will create a directory with safe permissions, `shutil.copytree` copies the original permissions of the source files, which may be arbitrary.  Instead, pip should be copying the *contents* of the source directory *into* the directory created with `mkdtemp`.\n\n2) `sage-uncompress-spkg` just calls `TarFile.extractall()` which preserves the original permissions of all files/directories in the tar file, and doesn't provide a clear way to enable or disable this.  This is different from the GNU `tar` command which by default (for normal users) applies the user's umask to all extracted files, which is generally safer depending on the user's umask.  It would probably be best if `sage-uncompress-spkg` did this as well.\n\n3) The top-level directory in pyparsing's source package has permissions set to 777.  Of all the upstream source tarballs I have pyparsing is the *only* one like this.  All the rest have 775 or 755.  \n\nResult: pyparsing's source is extracted with permissions 777 and is then copied into a directory in `/tmp` with unrestricted access, from which pip installs it.  My previous comments aside these are all bad and all three should be addressed.",
    "created_at": "2016-04-21T13:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274725",
    "user": "https://github.com/embray"
}
```

Nevermind--I traced this to a bug in pip, combined with a possible minor defect in `sage-uncompress-spkg` (or Python's `tarfile` module depending on your perspective), along with strange packaging for pyparsing, which is the package where this came up originally.

1) It's true that pip creates a temp dir (under `/tmp`, typically) in which to build a package.  This directory is created with `mkdtemp` and normally has safe permissions on it.  However, when installing a package from a source directory (a la `pip install .`), pip then deletes that temp directory, and copies the source directory using `shutil.copytree` to the same path as the just-deleted temp dir.  There are a couple problems with this:
 a) Deleting and recreating the temp dir of the same name involves a possible race condition.
 b) More importantly, while `mkdtemp` will create a directory with safe permissions, `shutil.copytree` copies the original permissions of the source files, which may be arbitrary.  Instead, pip should be copying the *contents* of the source directory *into* the directory created with `mkdtemp`.

2) `sage-uncompress-spkg` just calls `TarFile.extractall()` which preserves the original permissions of all files/directories in the tar file, and doesn't provide a clear way to enable or disable this.  This is different from the GNU `tar` command which by default (for normal users) applies the user's umask to all extracted files, which is generally safer depending on the user's umask.  It would probably be best if `sage-uncompress-spkg` did this as well.

3) The top-level directory in pyparsing's source package has permissions set to 777.  Of all the upstream source tarballs I have pyparsing is the *only* one like this.  All the rest have 775 or 755.  

Result: pyparsing's source is extracted with permissions 777 and is then copied into a directory in `/tmp` with unrestricted access, from which pip installs it.  My previous comments aside these are all bad and all three should be addressed.



---

archive/issue_comments_274726.json:
```json
{
    "body": "4) `python setup.py sdist` doesn't actually try to *create* a tarball with sane permissions in the first place.",
    "created_at": "2016-04-21T14:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274726",
    "user": "https://github.com/jdemeyer"
}
```

4) `python setup.py sdist` doesn't actually try to *create* a tarball with sane permissions in the first place.



---

archive/issue_comments_274727.json:
```json
{
    "body": "> python setup.py sdist doesn't actually try to create a tarball with sane permissions in the first place.\n\nAgreed.... is what I was about to write. But I tested it and `./setup.py sdist` does actually use sane permissions.  So either the maintainer of pyparsing is not using `./setup.py sdist` or is using a buggy version of Python or something.",
    "created_at": "2016-04-21T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274727",
    "user": "https://github.com/embray"
}
```

> python setup.py sdist doesn't actually try to create a tarball with sane permissions in the first place.

Agreed.... is what I was about to write. But I tested it and `./setup.py sdist` does actually use sane permissions.  So either the maintainer of pyparsing is not using `./setup.py sdist` or is using a buggy version of Python or something.



---

archive/issue_comments_274728.json:
```json
{
    "body": "See #20481 for an attempt to address point 2 above, as it was the lowest-hanging fruit I think.  The issue in pip will be easy to fix too but will have to get it accepted upstream, etc, etc.",
    "created_at": "2016-04-21T15:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274728",
    "user": "https://github.com/embray"
}
```

See #20481 for an attempt to address point 2 above, as it was the lowest-hanging fruit I think.  The issue in pip will be easy to fix too but will have to get it accepted upstream, etc, etc.



---

archive/issue_comments_274729.json:
```json
{
    "body": "Replying to [comment:18 embray]:\n> > python setup.py sdist doesn't actually try to create a tarball with sane permissions in the first place.\n> \n> Agreed.... is what I was about to write. But I tested it and `./setup.py sdist` does actually use sane permissions.\n\nI also tested it and `./setup.py sdist` did **not** use sane permissions.",
    "created_at": "2016-04-21T15:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274729",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 embray]:
> > python setup.py sdist doesn't actually try to create a tarball with sane permissions in the first place.
> 
> Agreed.... is what I was about to write. But I tested it and `./setup.py sdist` does actually use sane permissions.

I also tested it and `./setup.py sdist` did **not** use sane permissions.



---

archive/issue_comments_274730.json:
```json
{
    "body": "Huh. How did you test it?  I just ran `chmod 777` on the parent directory and all subdirectories, then ran `./setup.py sdist`.  The permissions in the resulting tarball at least had my umask applied:\n\n```\n$ umask -S\nu=rwx,g=rwx,o=rx\n```\n\nIt's the 'w' I'm mostly concerned about.  How are you defining \"sane\"?",
    "created_at": "2016-04-21T15:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274730",
    "user": "https://github.com/embray"
}
```

Huh. How did you test it?  I just ran `chmod 777` on the parent directory and all subdirectories, then ran `./setup.py sdist`.  The permissions in the resulting tarball at least had my umask applied:

```
$ umask -S
u=rwx,g=rwx,o=rx
```

It's the 'w' I'm mostly concerned about.  How are you defining "sane"?



---

archive/issue_comments_274731.json:
```json
{
    "body": "I made a project with the following files:\n\n`zzz.py`:\n\n```\nprint(\"zzz\")\n```\n\n\n`setup.py`:\n\n```\nfrom setuptools import setup   # setuptools or distutils does not matter\n\nsetup(\n    name=\"zzz\",\n    py_modules=[\"zzz\"],\n)\n```\n\n\nI changed the permissions of both these files to `0666` and then ran `python setup.py sdist`. The result:\n\n```\ndrwxr-xr-x jdemeyer/jdemeyer 0 2016-04-21 17:38 zzz-0.0.0/\ndrwxr-xr-x jdemeyer/jdemeyer 0 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/\n-rw-r--r-- jdemeyer/jdemeyer 1 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/dependency_links.txt\n-rw-r--r-- jdemeyer/jdemeyer 177 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/PKG-INFO\n-rw-r--r-- jdemeyer/jdemeyer 123 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/SOURCES.txt\n-rw-r--r-- jdemeyer/jdemeyer   4 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/top_level.txt\n-rw-r--r-- jdemeyer/jdemeyer 177 2016-04-21 17:38 zzz-0.0.0/PKG-INFO\n-rw-rw-rw- jdemeyer/jdemeyer 113 2016-04-21 17:36 zzz-0.0.0/setup.py\n-rw-r--r-- jdemeyer/jdemeyer  59 2016-04-21 17:38 zzz-0.0.0/setup.cfg\n-rw-rw-rw- jdemeyer/jdemeyer  13 2016-04-21 17:28 zzz-0.0.0/zzz.py\n```\n",
    "created_at": "2016-04-21T15:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274731",
    "user": "https://github.com/jdemeyer"
}
```

I made a project with the following files:

`zzz.py`:

```
print("zzz")
```


`setup.py`:

```
from setuptools import setup   # setuptools or distutils does not matter

setup(
    name="zzz",
    py_modules=["zzz"],
)
```


I changed the permissions of both these files to `0666` and then ran `python setup.py sdist`. The result:

```
drwxr-xr-x jdemeyer/jdemeyer 0 2016-04-21 17:38 zzz-0.0.0/
drwxr-xr-x jdemeyer/jdemeyer 0 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/
-rw-r--r-- jdemeyer/jdemeyer 1 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/dependency_links.txt
-rw-r--r-- jdemeyer/jdemeyer 177 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/PKG-INFO
-rw-r--r-- jdemeyer/jdemeyer 123 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/SOURCES.txt
-rw-r--r-- jdemeyer/jdemeyer   4 2016-04-21 17:38 zzz-0.0.0/zzz.egg-info/top_level.txt
-rw-r--r-- jdemeyer/jdemeyer 177 2016-04-21 17:38 zzz-0.0.0/PKG-INFO
-rw-rw-rw- jdemeyer/jdemeyer 113 2016-04-21 17:36 zzz-0.0.0/setup.py
-rw-r--r-- jdemeyer/jdemeyer  59 2016-04-21 17:38 zzz-0.0.0/setup.cfg
-rw-rw-rw- jdemeyer/jdemeyer  13 2016-04-21 17:28 zzz-0.0.0/zzz.py
```




---

archive/issue_comments_274732.json:
```json
{
    "body": "Merge conflict.",
    "created_at": "2016-04-21T15:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274732",
    "user": "https://github.com/jdemeyer"
}
```

Merge conflict.



---

archive/issue_comments_274733.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-21T15:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274733",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274734.json:
```json
{
    "body": "But what about directories? I'm more concerned with what permissions it sets for directories than for files.",
    "created_at": "2016-04-22T13:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274734",
    "user": "https://github.com/embray"
}
```

But what about directories? I'm more concerned with what permissions it sets for directories than for files.



---

archive/issue_comments_274735.json:
```json
{
    "body": "Replying to [comment:24 embray]:\n> But what about directories? I'm more concerned with what permissions it sets for directories than for files.\n\nI propose to use the `umask` for everything which is in the tarfile: files, directories, ...",
    "created_at": "2016-04-22T13:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274735",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:24 embray]:
> But what about directories? I'm more concerned with what permissions it sets for directories than for files.

I propose to use the `umask` for everything which is in the tarfile: files, directories, ...



---

archive/issue_comments_274736.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-22T13:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274737.json:
```json
{
    "body": "Also note that #14840 added lots of new Python packages, which might be installed using `pip`.",
    "created_at": "2016-04-22T13:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274737",
    "user": "https://github.com/jdemeyer"
}
```

Also note that #14840 added lots of new Python packages, which might be installed using `pip`.



---

archive/issue_comments_274738.json:
```json
{
    "body": "Typo: `insalled`",
    "created_at": "2016-04-22T13:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274738",
    "user": "https://github.com/jdemeyer"
}
```

Typo: `insalled`



---

archive/issue_comments_274739.json:
```json
{
    "body": "Ah, that explains why I had to rebase, and why pytz started showing up.  Thanks, I'll update those as well.",
    "created_at": "2016-04-22T13:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274739",
    "user": "https://github.com/embray"
}
```

Ah, that explains why I had to rebase, and why pytz started showing up.  Thanks, I'll update those as well.



---

archive/issue_comments_274740.json:
```json
{
    "body": "Something else to potentially worry about: how is the upgrade path from non-pip-installed packages to pip-installed packages? What if a package was installed before using either distutils or setuptools and it's now re-installed using pip?",
    "created_at": "2016-04-22T13:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274740",
    "user": "https://github.com/jdemeyer"
}
```

Something else to potentially worry about: how is the upgrade path from non-pip-installed packages to pip-installed packages? What if a package was installed before using either distutils or setuptools and it's now re-installed using pip?



---

archive/issue_comments_274741.json:
```json
{
    "body": "pip will uninstall them, *mostly*.  If a package was installed without pip, it can't uninstall and scripts or data files that were not installed directly under site-packages/package_name(.egg-info)? because there's no install log like there is with pip.\n\nThat's no worse, and slightly better than the current situation where some packages were uninstalled first, but most weren't, and of those that were only did `rm -rf site-packages/packagename`.  Some were clever enough to do `rm -rf site-packages/packagename*` but that could actually have unintended consequences.  The former case is no good either because it leaves `.egg-info` directories, making it appear to tools that know how to process those like the package is \"installed\".",
    "created_at": "2016-04-22T14:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274741",
    "user": "https://github.com/embray"
}
```

pip will uninstall them, *mostly*.  If a package was installed without pip, it can't uninstall and scripts or data files that were not installed directly under site-packages/package_name(.egg-info)? because there's no install log like there is with pip.

That's no worse, and slightly better than the current situation where some packages were uninstalled first, but most weren't, and of those that were only did `rm -rf site-packages/packagename`.  Some were clever enough to do `rm -rf site-packages/packagename*` but that could actually have unintended consequences.  The former case is no good either because it leaves `.egg-info` directories, making it appear to tools that know how to process those like the package is "installed".



---

archive/issue_comments_274742.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-27T14:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274743.json:
```json
{
    "body": "Rebased to include latest from `develop`, and to include #20481.  This allowed me to remove the `env PYTHONPATH=.` from all `pip` calls.  The only package that currently was affected by this issue was pyparsing, and #20481 effectively works around it.  There is a larger problem with pip that should be addressed, but it is no longer an immediate blocker for this issue.",
    "created_at": "2016-04-27T14:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274743",
    "user": "https://github.com/embray"
}
```

Rebased to include latest from `develop`, and to include #20481.  This allowed me to remove the `env PYTHONPATH=.` from all `pip` calls.  The only package that currently was affected by this issue was pyparsing, and #20481 effectively works around it.  There is a larger problem with pip that should be addressed, but it is no longer an immediate blocker for this issue.



---

archive/issue_comments_274744.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-27T14:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274744",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274745.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-05-27T11:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274746.json:
```json
{
    "body": "I rebased this on top of my branch for #20692 (which itself is based on a recent version of develop) so that I could use it in applying a new patch to pip.  Other than that the dependency is loose, and can be extracted if #20692 is rejected for some reason or requires significant more work.\n\nI have also applied the necessary patch to `pip` so that it no longer requires SSL to work (at least for installing local packages).",
    "created_at": "2016-05-27T12:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274746",
    "user": "https://github.com/embray"
}
```

I rebased this on top of my branch for #20692 (which itself is based on a recent version of develop) so that I could use it in applying a new patch to pip.  Other than that the dependency is loose, and can be extracted if #20692 is rejected for some reason or requires significant more work.

I have also applied the necessary patch to `pip` so that it no longer requires SSL to work (at least for installing local packages).



---

archive/issue_comments_274747.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-27T12:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274747",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274748.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-27T12:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274749.json:
```json
{
    "body": "The SSL issue was already known upstream before I made this ticket.  However, there is a different issue with pip that I described [here](http://trac.sagemath.org/ticket/20218#comment:16) and that should still be reported upstream.  I haven't gotten around to it yet, but I will.",
    "created_at": "2016-05-27T14:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274749",
    "user": "https://github.com/embray"
}
```

The SSL issue was already known upstream before I made this ticket.  However, there is a different issue with pip that I described [here](http://trac.sagemath.org/ticket/20218#comment:16) and that should still be reported upstream.  I haven't gotten around to it yet, but I will.



---

archive/issue_comments_274750.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-27T15:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274750",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274751.json:
```json
{
    "body": "You need to increase the patchlevel of `pip`, otherwise the patch will not be applied.",
    "created_at": "2016-05-27T15:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274751",
    "user": "https://github.com/jdemeyer"
}
```

You need to increase the patchlevel of `pip`, otherwise the patch will not be applied.



---

archive/issue_comments_274752.json:
```json
{
    "body": "This branch does a lot of stuff. It's not a disaster, but I would have preferred to see this as 3 tickets:\n1. Add the SSL patch to `pip`.\n2. Use `pip install` to install Python packages.\n3. Add `dependencies` to optional packages without dependency files.",
    "created_at": "2016-05-27T15:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274752",
    "user": "https://github.com/jdemeyer"
}
```

This branch does a lot of stuff. It's not a disaster, but I would have preferred to see this as 3 tickets:
1. Add the SSL patch to `pip`.
2. Use `pip install` to install Python packages.
3. Add `dependencies` to optional packages without dependency files.



---

archive/issue_comments_274753.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> This branch does a lot of stuff. It's not a disaster, but I would have preferred to see this as 3 tickets:\n> 1. Add the SSL patch to `pip`.\n> 2. Use `pip install` to install Python packages.\n> 3. Add `dependencies` to optional packages without dependency files.\n\nOkay, that's fair.  I can break this up.\n\nNot exactly clear how to break up 2 and 3 though.  If optional packages are going to be installed with pip, they *have* to have dependency files listing at least pip first.  But if I do that *before* making them installed with pip then they would have an unnecessary dependency on pip.\n\nUnless I made a separate ticket that only adds the dependency files with no pip, and then later adds the pip dependency as part of 2).  But that would be a little more annoying.",
    "created_at": "2016-05-27T16:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274753",
    "user": "https://github.com/embray"
}
```

Replying to [comment:41 jdemeyer]:
> This branch does a lot of stuff. It's not a disaster, but I would have preferred to see this as 3 tickets:
> 1. Add the SSL patch to `pip`.
> 2. Use `pip install` to install Python packages.
> 3. Add `dependencies` to optional packages without dependency files.

Okay, that's fair.  I can break this up.

Not exactly clear how to break up 2 and 3 though.  If optional packages are going to be installed with pip, they *have* to have dependency files listing at least pip first.  But if I do that *before* making them installed with pip then they would have an unnecessary dependency on pip.

Unless I made a separate ticket that only adds the dependency files with no pip, and then later adds the pip dependency as part of 2).  But that would be a little more annoying.



---

archive/issue_comments_274754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-27T16:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274755.json:
```json
{
    "body": "Over at #20739, people are suggesting to use `--no-binary :all:`. I don't understand why, but maybe you do...",
    "created_at": "2016-06-01T20:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274755",
    "user": "https://github.com/jdemeyer"
}
```

Over at #20739, people are suggesting to use `--no-binary :all:`. I don't understand why, but maybe you do...



---

archive/issue_comments_274756.json:
```json
{
    "body": "That shouldn't be relevant here since this has nothing to do with installing packages from PyPI (or any other PyPI-like Python package index).  That's an instruction for controlling what type of package to download if there are multiple options.",
    "created_at": "2016-06-02T09:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274756",
    "user": "https://github.com/embray"
}
```

That shouldn't be relevant here since this has nothing to do with installing packages from PyPI (or any other PyPI-like Python package index).  That's an instruction for controlling what type of package to download if there are multiple options.



---

archive/issue_comments_274757.json:
```json
{
    "body": "Right, makes sense.",
    "created_at": "2016-06-02T09:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274757",
    "user": "https://github.com/jdemeyer"
}
```

Right, makes sense.



---

archive/issue_comments_274758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-06-30T16:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274759.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-06-30T16:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274759",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274760.json:
```json
{
    "body": "Rebased, and simplified to no longer depend on #20692, and also removed the patch to pip for SSL, which has been broken out to #20913.\n\nThis doesn't have a strict dependence on #20913, but #20913 should still be merged first since otherwise this patch will break the sage build on platforms with no OpenSSL support.",
    "created_at": "2016-06-30T16:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274760",
    "user": "https://github.com/embray"
}
```

Rebased, and simplified to no longer depend on #20692, and also removed the patch to pip for SSL, which has been broken out to #20913.

This doesn't have a strict dependence on #20913, but #20913 should still be merged first since otherwise this patch will break the sage build on platforms with no OpenSSL support.



---

archive/issue_comments_274761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-07-12T08:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274762.json:
```json
{
    "body": "Rebased on recent develop branch.\n\nIt would be great to get this moving--I just a build fail on trying to install `flask_babel` (though it could have been any number of packages) because they all use setuptools, and hence running `./setup.py install` makes them use `easy_install` by default and check online for the package's dependencies even though it shouldn't have to.\n\nThis patch ensures that Python packages are installed without dependency on PyPI.",
    "created_at": "2016-07-12T08:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274762",
    "user": "https://github.com/embray"
}
```

Rebased on recent develop branch.

It would be great to get this moving--I just a build fail on trying to install `flask_babel` (though it could have been any number of packages) because they all use setuptools, and hence running `./setup.py install` makes them use `easy_install` by default and check online for the package's dependencies even though it shouldn't have to.

This patch ensures that Python packages are installed without dependency on PyPI.



---

archive/issue_comments_274763.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-15T09:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274763",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274764.json:
```json
{
    "body": "Merge conflict.",
    "created_at": "2016-07-15T09:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274764",
    "user": "https://github.com/jdemeyer"
}
```

Merge conflict.



---

archive/issue_comments_274765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-07-15T09:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274766.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-15T09:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274766",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274767.json:
```json
{
    "body": "Rebased again.\n----\nNew commits:",
    "created_at": "2016-07-15T09:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274767",
    "user": "https://github.com/embray"
}
```

Rebased again.
----
New commits:



---

archive/issue_comments_274768.json:
```json
{
    "body": "Volker, it would be good if you could test on the buildbot that this ticket works when building from scratch.",
    "created_at": "2016-07-15T16:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274768",
    "user": "https://github.com/jdemeyer"
}
```

Volker, it would be good if you could test on the buildbot that this ticket works when building from scratch.



---

archive/issue_comments_274769.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-15T16:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274769",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274770.json:
```json
{
    "body": "Sorry for the trouble again, but this conflicts with #19295. I guess you should rebase it to that ticket. Alternatively, wait for the new Sage beta release.\n\nApart from that, I see no obvious issue with this ticket. It mostly needs testing. I will try to do that in the following days.",
    "created_at": "2016-07-15T16:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274770",
    "user": "https://github.com/jdemeyer"
}
```

Sorry for the trouble again, but this conflicts with #19295. I guess you should rebase it to that ticket. Alternatively, wait for the new Sage beta release.

Apart from that, I see no obvious issue with this ticket. It mostly needs testing. I will try to do that in the following days.



---

archive/issue_comments_274771.json:
```json
{
    "body": "I mean, so long as #19295 is merged I can rebase this again on develop right?",
    "created_at": "2016-07-18T09:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274771",
    "user": "https://github.com/embray"
}
```

I mean, so long as #19295 is merged I can rebase this again on develop right?



---

archive/issue_comments_274772.json:
```json
{
    "body": "Replying to [comment:57 embray]:\n> I mean, so long as #19295 is merged I can rebase this again on develop right?\n\n...when the next beta/rc release comes out which includes #19295, yes.\n\nOr you just rebase right now on the branch of #19295.",
    "created_at": "2016-07-18T15:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274772",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:57 embray]:
> I mean, so long as #19295 is merged I can rebase this again on develop right?

...when the next beta/rc release comes out which includes #19295, yes.

Or you just rebase right now on the branch of #19295.



---

archive/issue_comments_274773.json:
```json
{
    "body": "As far as I can tell, this ticket works fine. So the only obstruction is #19295.",
    "created_at": "2016-07-19T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274773",
    "user": "https://github.com/jdemeyer"
}
```

As far as I can tell, this ticket works fine. So the only obstruction is #19295.



---

archive/issue_comments_274774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-07-26T11:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274775.json:
```json
{
    "body": "Rebased",
    "created_at": "2016-07-26T11:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274775",
    "user": "https://github.com/embray"
}
```

Rebased



---

archive/issue_comments_274776.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-26T11:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274776",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274777.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-04T18:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274777",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274778.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-05T08:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274778",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_274779.json:
```json
{
    "body": "I actually need to modify this slightly.  The `$PIP_INSTALL` variable that's set in `build/make/install` is now needed for running the `spkg-install` for all the Python packages that use it.  This means `spkg-install` can't be run directly and *must* go through the `build/make/install` script.\n\nInstead, `$PIP_INSTALL` should probably be set in `sage-env`.",
    "created_at": "2016-08-05T08:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274779",
    "user": "https://github.com/embray"
}
```

I actually need to modify this slightly.  The `$PIP_INSTALL` variable that's set in `build/make/install` is now needed for running the `spkg-install` for all the Python packages that use it.  This means `spkg-install` can't be run directly and *must* go through the `build/make/install` script.

Instead, `$PIP_INSTALL` should probably be set in `sage-env`.



---

archive/issue_comments_274780.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T09:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274781.json:
```json
{
    "body": "Done. Seems to work fine.\n----\nNew commits:",
    "created_at": "2016-08-05T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274781",
    "user": "https://github.com/embray"
}
```

Done. Seems to work fine.
----
New commits:



---

archive/issue_comments_274782.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-05T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274782",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274783.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-05T21:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274783",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274784.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-06T09:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274784",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_274785.json:
```json
{
    "body": "Fails for me when building after \"make distclean\" with\n\n```\nsagenb-export 2.0 is already the active version in easy-install.pth\nInstalling sagenb-export script to /mnt/disk/home/release/Sage/local/bin\n\nInstalled /mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sagenb_export-2.0-py2.7.egg\nProcessing dependencies for sagenb-export==2.0\nSearching for entrypoints\nReading https://pypi.python.org/simple/entrypoints/\n```\n\nThe buildbot is not allowed to download packages. \n\nThe nbconvert package lists entrypoints in `local/lib/python2.7/site-packages/nbconvert-4.2.0-py2.7.egg-info/requires.txt`, but only with this ticket. Without this ticket, the depenency is not picked up.\n\nPerhaps the easiest solution would be to package entrypoints...",
    "created_at": "2016-08-06T09:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274785",
    "user": "https://github.com/vbraun"
}
```

Fails for me when building after "make distclean" with

```
sagenb-export 2.0 is already the active version in easy-install.pth
Installing sagenb-export script to /mnt/disk/home/release/Sage/local/bin

Installed /mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sagenb_export-2.0-py2.7.egg
Processing dependencies for sagenb-export==2.0
Searching for entrypoints
Reading https://pypi.python.org/simple/entrypoints/
```

The buildbot is not allowed to download packages. 

The nbconvert package lists entrypoints in `local/lib/python2.7/site-packages/nbconvert-4.2.0-py2.7.egg-info/requires.txt`, but only with this ticket. Without this ticket, the depenency is not picked up.

Perhaps the easiest solution would be to package entrypoints...



---

archive/issue_comments_274786.json:
```json
{
    "body": "`sagenb_export` isn't even a sage package in this branch.  It must have been added since I last rebased.  I mean, until the commit I just pushed it wasn't even being installed with pip so I don't know what the relation would be.\n\nExcept that whoever added `sagenb_export` as an spkg did not also add all its dependencies which unfortunately you have to do.",
    "created_at": "2016-08-08T08:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274786",
    "user": "https://github.com/embray"
}
```

`sagenb_export` isn't even a sage package in this branch.  It must have been added since I last rebased.  I mean, until the commit I just pushed it wasn't even being installed with pip so I don't know what the relation would be.

Except that whoever added `sagenb_export` as an spkg did not also add all its dependencies which unfortunately you have to do.



---

archive/issue_comments_274787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-08T08:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274788.json:
```json
{
    "body": "This is proving to be difficult to do all at once. Maybe this should be split up to \"provide the base functionality\" like the `PIP_INSTALL` stuff and then we can fix individual packages or batches of packages in follow-up tickets.\n\nThen a comment about the implementation: making `PIP_INSTALL` an environment variable looks strange. Maybe a small script `build/bin/pip-install` would make more sense?",
    "created_at": "2016-08-16T09:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274788",
    "user": "https://github.com/jdemeyer"
}
```

This is proving to be difficult to do all at once. Maybe this should be split up to "provide the base functionality" like the `PIP_INSTALL` stuff and then we can fix individual packages or batches of packages in follow-up tickets.

Then a comment about the implementation: making `PIP_INSTALL` an environment variable looks strange. Maybe a small script `build/bin/pip-install` would make more sense?



---

archive/issue_comments_274789.json:
```json
{
    "body": "I don't think making `PIP_INSTALL` an environment variable \"looks strange\" any more than `CC` does.\n\nHow is it proving to be too difficult?  It works for me.",
    "created_at": "2016-08-16T09:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274789",
    "user": "https://github.com/embray"
}
```

I don't think making `PIP_INSTALL` an environment variable "looks strange" any more than `CC` does.

How is it proving to be too difficult?  It works for me.



---

archive/issue_comments_274790.json:
```json
{
    "body": "Ah, looks like it needs to be rebased again.  No problem.",
    "created_at": "2016-08-16T09:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274790",
    "user": "https://github.com/embray"
}
```

Ah, looks like it needs to be rebased again.  No problem.



---

archive/issue_comments_274791.json:
```json
{
    "body": "Replying to [comment:72 embray]:\n> How is it proving to be too difficult?\n\nDifficult to merge in the sense that it constantly conflicts with other tickets.",
    "created_at": "2016-08-16T09:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274791",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:72 embray]:
> How is it proving to be too difficult?

Difficult to merge in the sense that it constantly conflicts with other tickets.



---

archive/issue_comments_274792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-16T09:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274793.json:
```json
{
    "body": "Another question that comes to mind: Where would be the best place in the documentation to document how an spkg for a Python package should be installed?  That should be updated ASAP to demonstrate using pip to install the package instead of the old-fashioned `python setup.py install`?\n\nAnyways the sooner we get this merged, and update the documentation, the less \"difficult\" this will be.\n----\nNew commits:",
    "created_at": "2016-08-16T09:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274793",
    "user": "https://github.com/embray"
}
```

Another question that comes to mind: Where would be the best place in the documentation to document how an spkg for a Python package should be installed?  That should be updated ASAP to demonstrate using pip to install the package instead of the old-fashioned `python setup.py install`?

Anyways the sooner we get this merged, and update the documentation, the less "difficult" this will be.
----
New commits:



---

archive/issue_comments_274794.json:
```json
{
    "body": "Just a comment: I need this to fix the installation of `widgetsnbextension`, see #21256.",
    "created_at": "2016-08-16T10:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274794",
    "user": "https://github.com/jdemeyer"
}
```

Just a comment: I need this to fix the installation of `widgetsnbextension`, see #21256.



---

archive/issue_comments_274795.json:
```json
{
    "body": "Is this ready for review?",
    "created_at": "2016-08-16T10:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274795",
    "user": "https://github.com/jdemeyer"
}
```

Is this ready for review?



---

archive/issue_comments_274796.json:
```json
{
    "body": "Replying to [comment:77 jdemeyer]:\n> Just a comment: I need this to fix the installation of `widgetsnbextension`, see #21256.\n\nAnd it needs the `--ignored-installed` option that you are adding here, otherwise the broken installation remains broken.",
    "created_at": "2016-08-16T10:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274796",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:77 jdemeyer]:
> Just a comment: I need this to fix the installation of `widgetsnbextension`, see #21256.

And it needs the `--ignored-installed` option that you are adding here, otherwise the broken installation remains broken.



---

archive/issue_comments_274797.json:
```json
{
    "body": "I do not like the `--no-deps` flag: it used to be an error if dependencies were not installed, now you will silently have a broken installation.",
    "created_at": "2016-08-16T10:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274797",
    "user": "https://github.com/jdemeyer"
}
```

I do not like the `--no-deps` flag: it used to be an error if dependencies were not installed, now you will silently have a broken installation.



---

archive/issue_comments_274798.json:
```json
{
    "body": "I also like `--verbose`: it actually shows the output from `setup.py` instead of\n\n```\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: still running...\n    Running setup.py install for scipy: finished with status 'done'\n```\n",
    "created_at": "2016-08-16T11:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274798",
    "user": "https://github.com/jdemeyer"
}
```

I also like `--verbose`: it actually shows the output from `setup.py` instead of

```
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: still running...
    Running setup.py install for scipy: finished with status 'done'
```




---

archive/issue_comments_274799.json:
```json
{
    "body": "Replying to [comment:80 jdemeyer]:\n> I do not like the `--no-deps` flag: it used to be an error if dependencies were not installed, now you will silently have a broken installation.\n\nThat's a problem that Sage's package distributions should be handling.  In other words, you're asking pip and PyPI to handle dependency resolution for you.  But if Sage wants to maintain its own package distribution system it's its responsibility to handle dependency resolution correctly.",
    "created_at": "2016-08-16T11:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274799",
    "user": "https://github.com/embray"
}
```

Replying to [comment:80 jdemeyer]:
> I do not like the `--no-deps` flag: it used to be an error if dependencies were not installed, now you will silently have a broken installation.

That's a problem that Sage's package distributions should be handling.  In other words, you're asking pip and PyPI to handle dependency resolution for you.  But if Sage wants to maintain its own package distribution system it's its responsibility to handle dependency resolution correctly.



---

archive/issue_comments_274800.json:
```json
{
    "body": "I'm fine with adding the `--verbose` flag but -1 on removing `--no-deps`.\n----\nNew commits:",
    "created_at": "2016-08-16T11:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274800",
    "user": "https://github.com/embray"
}
```

I'm fine with adding the `--verbose` flag but -1 on removing `--no-deps`.
----
New commits:



---

archive/issue_comments_274801.json:
```json
{
    "body": "Replying to [comment:82 embray]:\n> That's a problem that Sage's package distributions should be handling.  In other words, you're asking pip and PyPI to handle dependency resolution for you.\n\nNot really. I want dependency *checking*, not dependency *resolution*.\n\nIt is completely normal for a package to check its dependencies upon installation: GNU `configure` scripts usually do this.\n\nThe flag `--no-index` does exactly that: it will not install dependencies but it will still check for dependencies.",
    "created_at": "2016-08-16T11:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274801",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:82 embray]:
> That's a problem that Sage's package distributions should be handling.  In other words, you're asking pip and PyPI to handle dependency resolution for you.

Not really. I want dependency *checking*, not dependency *resolution*.

It is completely normal for a package to check its dependencies upon installation: GNU `configure` scripts usually do this.

The flag `--no-index` does exactly that: it will not install dependencies but it will still check for dependencies.



---

archive/issue_comments_274802.json:
```json
{
    "body": "Okay, as long as it isn't recursive--that is, as long as it doesn't also check the dependencies for the dependencies--you're right that `--no-index` seems to ensure that.",
    "created_at": "2016-08-16T11:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274802",
    "user": "https://github.com/embray"
}
```

Okay, as long as it isn't recursive--that is, as long as it doesn't also check the dependencies for the dependencies--you're right that `--no-index` seems to ensure that.



---

archive/issue_comments_274803.json:
```json
{
    "body": "Hmm, removing `--no-deps` breaks a lot of Jupyter stuff since they have `setup.py` containing stuff like\n\n```\nsetuptools_args = {}\ninstall_requires = setuptools_args['install_requires'] = [\n    'ipython>=4.0.0',\n    'traitlets',\n    'jupyter_client',\n    'tornado>=4.0',\n]\n\nif 'setuptools' in sys.modules:\n    setup_args.update(setuptools_args)\n```\n\n\nThese dependencies are not seen when installing using `python setup.py install`.",
    "created_at": "2016-08-16T11:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274803",
    "user": "https://github.com/jdemeyer"
}
```

Hmm, removing `--no-deps` breaks a lot of Jupyter stuff since they have `setup.py` containing stuff like

```
setuptools_args = {}
install_requires = setuptools_args['install_requires'] = [
    'ipython>=4.0.0',
    'traitlets',
    'jupyter_client',
    'tornado>=4.0',
]

if 'setuptools' in sys.modules:
    setup_args.update(setuptools_args)
```


These dependencies are not seen when installing using `python setup.py install`.



---

archive/issue_comments_274804.json:
```json
{
    "body": "I will try to fix those dependencies.",
    "created_at": "2016-08-16T12:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274804",
    "user": "https://github.com/jdemeyer"
}
```

I will try to fix those dependencies.



---

archive/issue_comments_274805.json:
```json
{
    "body": "Hmm, `traitlets` thinks that `ipython_genutils` is not installed but in reality it is installed (and it is properly listed as dependency in Sage):\n\n```\n[traitlets-4.2.2] Processing /usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src\n[traitlets-4.2.2]   Running setup.py (path:/tmp/pip-TnBahx-build/setup.py) egg_info for package from file:///usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src\n[traitlets-4.2.2]     Running command python setup.py egg_info\n[traitlets-4.2.2]     running egg_info\n[traitlets-4.2.2]     creating pip-egg-info/traitlets.egg-info\n[traitlets-4.2.2]     writing requirements to pip-egg-info/traitlets.egg-info/requires.txt\n[traitlets-4.2.2]     writing pip-egg-info/traitlets.egg-info/PKG-INFO\n[traitlets-4.2.2]     writing top-level names to pip-egg-info/traitlets.egg-info/top_level.txt\n[traitlets-4.2.2]     writing dependency_links to pip-egg-info/traitlets.egg-info/dependency_links.txt\n[traitlets-4.2.2]     writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n[traitlets-4.2.2]     warning: manifest_maker: standard file '-c' not found\n[traitlets-4.2.2] \n[traitlets-4.2.2]     reading manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n[traitlets-4.2.2]     writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n[traitlets-4.2.2]   Source in /tmp/pip-TnBahx-build has version 4.2.2, which satisfies requirement traitlets==4.2.2 from file:///usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src\n[traitlets-4.2.2] Collecting ipython_genutils (from traitlets==4.2.2)\n[traitlets-4.2.2]   0 location(s) to search for versions of ipython-genutils:\n[traitlets-4.2.2]   Could not find a version that satisfies the requirement ipython_genutils (from traitlets==4.2.2) (from versions: )\n[traitlets-4.2.2] Cleaning up...\n[traitlets-4.2.2]   Removing source in /tmp/pip-TnBahx-build\n[traitlets-4.2.2] No matching distribution found for ipython_genutils (from traitlets==4.2.2)\n[traitlets-4.2.2] Exception information:\n[traitlets-4.2.2] Traceback (most recent call last):\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/basecommand.py\", line 215, in main\n[traitlets-4.2.2]     status = self.run(options, args)\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/commands/install.py\", line 299, in run\n[traitlets-4.2.2]     requirement_set.prepare_files(finder)\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py\", line 370, in prepare_files\n[traitlets-4.2.2]     ignore_dependencies=self.ignore_dependencies))\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py\", line 522, in _prepare_file\n[traitlets-4.2.2]     finder, self.upgrade, require_hashes)\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_install.py\", line 268, in populate_link\n[traitlets-4.2.2]     self.link = finder.find_requirement(self, upgrade)\n[traitlets-4.2.2]   File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/index.py\", line 491, in find_requirement\n[traitlets-4.2.2]     'No matching distribution found for %s' % req\n[traitlets-4.2.2] DistributionNotFound: No matching distribution found for ipython_genutils (from traitlets==4.2.2)\n```\n",
    "created_at": "2016-08-16T12:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274805",
    "user": "https://github.com/jdemeyer"
}
```

Hmm, `traitlets` thinks that `ipython_genutils` is not installed but in reality it is installed (and it is properly listed as dependency in Sage):

```
[traitlets-4.2.2] Processing /usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src
[traitlets-4.2.2]   Running setup.py (path:/tmp/pip-TnBahx-build/setup.py) egg_info for package from file:///usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src
[traitlets-4.2.2]     Running command python setup.py egg_info
[traitlets-4.2.2]     running egg_info
[traitlets-4.2.2]     creating pip-egg-info/traitlets.egg-info
[traitlets-4.2.2]     writing requirements to pip-egg-info/traitlets.egg-info/requires.txt
[traitlets-4.2.2]     writing pip-egg-info/traitlets.egg-info/PKG-INFO
[traitlets-4.2.2]     writing top-level names to pip-egg-info/traitlets.egg-info/top_level.txt
[traitlets-4.2.2]     writing dependency_links to pip-egg-info/traitlets.egg-info/dependency_links.txt
[traitlets-4.2.2]     writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
[traitlets-4.2.2]     warning: manifest_maker: standard file '-c' not found
[traitlets-4.2.2] 
[traitlets-4.2.2]     reading manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
[traitlets-4.2.2]     writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
[traitlets-4.2.2]   Source in /tmp/pip-TnBahx-build has version 4.2.2, which satisfies requirement traitlets==4.2.2 from file:///usr/local/src/sage-git/local/var/tmp/sage/build/traitlets-4.2.2/src
[traitlets-4.2.2] Collecting ipython_genutils (from traitlets==4.2.2)
[traitlets-4.2.2]   0 location(s) to search for versions of ipython-genutils:
[traitlets-4.2.2]   Could not find a version that satisfies the requirement ipython_genutils (from traitlets==4.2.2) (from versions: )
[traitlets-4.2.2] Cleaning up...
[traitlets-4.2.2]   Removing source in /tmp/pip-TnBahx-build
[traitlets-4.2.2] No matching distribution found for ipython_genutils (from traitlets==4.2.2)
[traitlets-4.2.2] Exception information:
[traitlets-4.2.2] Traceback (most recent call last):
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/basecommand.py", line 215, in main
[traitlets-4.2.2]     status = self.run(options, args)
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/commands/install.py", line 299, in run
[traitlets-4.2.2]     requirement_set.prepare_files(finder)
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py", line 370, in prepare_files
[traitlets-4.2.2]     ignore_dependencies=self.ignore_dependencies))
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py", line 522, in _prepare_file
[traitlets-4.2.2]     finder, self.upgrade, require_hashes)
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_install.py", line 268, in populate_link
[traitlets-4.2.2]     self.link = finder.find_requirement(self, upgrade)
[traitlets-4.2.2]   File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/index.py", line 491, in find_requirement
[traitlets-4.2.2]     'No matching distribution found for %s' % req
[traitlets-4.2.2] DistributionNotFound: No matching distribution found for ipython_genutils (from traitlets==4.2.2)
```




---

archive/issue_comments_274806.json:
```json
{
    "body": "Hmm, could it be that the `--ignore-installed` option also ignores installed dependencies?",
    "created_at": "2016-08-16T12:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274806",
    "user": "https://github.com/jdemeyer"
}
```

Hmm, could it be that the `--ignore-installed` option also ignores installed dependencies?



---

archive/issue_comments_274807.json:
```json
{
    "body": "I'll look into it.",
    "created_at": "2016-08-16T12:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274807",
    "user": "https://github.com/embray"
}
```

I'll look into it.



---

archive/issue_comments_274808.json:
```json
{
    "body": "I tried `--upgrade --force-reinstall` instead of `--ignore-installed` but that gives the same problem:\n\n```\n$ pip install --verbose --no-index --upgrade --force-reinstall .\nIgnoring indexes: https://pypi.python.org/simple\nProcessing /usr/local/src/sage-git/tmp/traitlets-4.2.2\n  Running setup.py (path:/tmp/pip-Eh8Et4-build/setup.py) egg_info for package from file:///usr/local/src/sage-git/tmp/traitlets-4.2.2\n    Running command python setup.py egg_info\n    running egg_info\n    creating pip-egg-info/traitlets.egg-info\n    writing requirements to pip-egg-info/traitlets.egg-info/requires.txt\n    writing pip-egg-info/traitlets.egg-info/PKG-INFO\n    writing top-level names to pip-egg-info/traitlets.egg-info/top_level.txt\n    writing dependency_links to pip-egg-info/traitlets.egg-info/dependency_links.txt\n    writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n    warning: manifest_maker: standard file '-c' not found\n\n    reading manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n    writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'\n  Source in /tmp/pip-Eh8Et4-build has version 4.2.2, which satisfies requirement traitlets==4.2.2 from file:///usr/local/src/sage-git/tmp/traitlets-4.2.2\nCollecting ipython_genutils (from traitlets==4.2.2)\n  0 location(s) to search for versions of ipython-genutils:\n  Could not find a version that satisfies the requirement ipython_genutils (from traitlets==4.2.2) (from versions: )\nCleaning up...\n  Removing source in /tmp/pip-Eh8Et4-build\nNo matching distribution found for ipython_genutils (from traitlets==4.2.2)\nException information:\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/basecommand.py\", line 215, in main\n    status = self.run(options, args)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/commands/install.py\", line 299, in run\n    requirement_set.prepare_files(finder)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py\", line 370, in prepare_files\n    ignore_dependencies=self.ignore_dependencies))\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py\", line 522, in _prepare_file\n    finder, self.upgrade, require_hashes)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_install.py\", line 268, in populate_link\n    self.link = finder.find_requirement(self, upgrade)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/index.py\", line 491, in find_requirement\n    'No matching distribution found for %s' % req\nDistributionNotFound: No matching distribution found for ipython_genutils (from traitlets==4.2.2)\n```\n",
    "created_at": "2016-08-16T12:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274808",
    "user": "https://github.com/jdemeyer"
}
```

I tried `--upgrade --force-reinstall` instead of `--ignore-installed` but that gives the same problem:

```
$ pip install --verbose --no-index --upgrade --force-reinstall .
Ignoring indexes: https://pypi.python.org/simple
Processing /usr/local/src/sage-git/tmp/traitlets-4.2.2
  Running setup.py (path:/tmp/pip-Eh8Et4-build/setup.py) egg_info for package from file:///usr/local/src/sage-git/tmp/traitlets-4.2.2
    Running command python setup.py egg_info
    running egg_info
    creating pip-egg-info/traitlets.egg-info
    writing requirements to pip-egg-info/traitlets.egg-info/requires.txt
    writing pip-egg-info/traitlets.egg-info/PKG-INFO
    writing top-level names to pip-egg-info/traitlets.egg-info/top_level.txt
    writing dependency_links to pip-egg-info/traitlets.egg-info/dependency_links.txt
    writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
    warning: manifest_maker: standard file '-c' not found

    reading manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
    writing manifest file 'pip-egg-info/traitlets.egg-info/SOURCES.txt'
  Source in /tmp/pip-Eh8Et4-build has version 4.2.2, which satisfies requirement traitlets==4.2.2 from file:///usr/local/src/sage-git/tmp/traitlets-4.2.2
Collecting ipython_genutils (from traitlets==4.2.2)
  0 location(s) to search for versions of ipython-genutils:
  Could not find a version that satisfies the requirement ipython_genutils (from traitlets==4.2.2) (from versions: )
Cleaning up...
  Removing source in /tmp/pip-Eh8Et4-build
No matching distribution found for ipython_genutils (from traitlets==4.2.2)
Exception information:
Traceback (most recent call last):
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/basecommand.py", line 215, in main
    status = self.run(options, args)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/commands/install.py", line 299, in run
    requirement_set.prepare_files(finder)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py", line 370, in prepare_files
    ignore_dependencies=self.ignore_dependencies))
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_set.py", line 522, in _prepare_file
    finder, self.upgrade, require_hashes)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/req/req_install.py", line 268, in populate_link
    self.link = finder.find_requirement(self, upgrade)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pip-8.1.2-py2.7.egg/pip/index.py", line 491, in find_requirement
    'No matching distribution found for %s' % req
DistributionNotFound: No matching distribution found for ipython_genutils (from traitlets==4.2.2)
```




---

archive/issue_comments_274809.json:
```json
{
    "body": "Yes, you're right.  It seems that `--ignore-installed` also ignores installed dependencies.  The fact that I also had `--no-deps` hid that.  That's disconcerting.  It looks like you can't do dependency checking the way you wanted after all, though I'll admit that's unfortunate.  You'd think it should work.  I might treat that as a defect in pip.\n\nBut I don't think it's a showstopper.  I still think it should be the responsibility of the sage packager to work this out and not blindly add new packages without making sure all its dependencies are correct too.",
    "created_at": "2016-08-16T12:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274809",
    "user": "https://github.com/embray"
}
```

Yes, you're right.  It seems that `--ignore-installed` also ignores installed dependencies.  The fact that I also had `--no-deps` hid that.  That's disconcerting.  It looks like you can't do dependency checking the way you wanted after all, though I'll admit that's unfortunate.  You'd think it should work.  I might treat that as a defect in pip.

But I don't think it's a showstopper.  I still think it should be the responsibility of the sage packager to work this out and not blindly add new packages without making sure all its dependencies are correct too.



---

archive/issue_comments_274810.json:
```json
{
    "body": "Replying to [comment:93 embray]:\n> I still think it should be the responsibility of the sage packager to work this out and not blindly add new packages without making sure all its dependencies are correct too.\n\nI would love this to become official Sage policy. The main culprit is mass-update tickets like #20625.",
    "created_at": "2016-08-16T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274810",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:93 embray]:
> I still think it should be the responsibility of the sage packager to work this out and not blindly add new packages without making sure all its dependencies are correct too.

I would love this to become official Sage policy. The main culprit is mass-update tickets like #20625.



---

archive/issue_comments_274811.json:
```json
{
    "body": "A relevant ticket in pip: https://github.com/pypa/pip/issues/3261\n\nIt's mentioned there that there's also a new `pip check` command that will do a sanity-check on the system, so running that could also be policy (without necessarily requiring the check on every package install).",
    "created_at": "2016-08-16T12:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274811",
    "user": "https://github.com/embray"
}
```

A relevant ticket in pip: https://github.com/pypa/pip/issues/3261

It's mentioned there that there's also a new `pip check` command that will do a sanity-check on the system, so running that could also be policy (without necessarily requiring the check on every package install).



---

archive/issue_comments_274812.json:
```json
{
    "body": "It seems that `pip` is missing an option to force-reinstall a single package without recursion.",
    "created_at": "2016-08-16T12:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274812",
    "user": "https://github.com/jdemeyer"
}
```

It seems that `pip` is missing an option to force-reinstall a single package without recursion.



---

archive/issue_comments_274813.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-16T12:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274814.json:
```json
{
    "body": "OK, undid the removal of `--no-deps`.\n\nI would be fine with merging this now, but still thinking about future improvements.",
    "created_at": "2016-08-16T12:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274814",
    "user": "https://github.com/jdemeyer"
}
```

OK, undid the removal of `--no-deps`.

I would be fine with merging this now, but still thinking about future improvements.



---

archive/issue_comments_274815.json:
```json
{
    "body": "Replying to [comment:96 jdemeyer]:\n> It seems that `pip` is missing an option to force-reinstall a single package without recursion.\n\n`pip install --upgrade --force --no-deps` does it.  I've used that in the past.",
    "created_at": "2016-08-16T12:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274815",
    "user": "https://github.com/embray"
}
```

Replying to [comment:96 jdemeyer]:
> It seems that `pip` is missing an option to force-reinstall a single package without recursion.

`pip install --upgrade --force --no-deps` does it.  I've used that in the past.



---

archive/issue_comments_274816.json:
```json
{
    "body": "Replying to [comment:99 embray]:\n> Replying to [comment:96 jdemeyer]:\n> > It seems that `pip` is missing an option to force-reinstall a single package without recursion.\n> \n> `pip install --upgrade --force --no-deps` does it.\n\n`--upgrade` does recursion:\n\n```\n  -U, --upgrade               Upgrade all specified packages to the newest available version. This process is recursive regardless of whether a dependency is already\n                              satisfied.\n```\n\n\nEdit: I see you added `--no-deps` but I don't want that since I do want dependency checking.",
    "created_at": "2016-08-16T12:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274816",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:99 embray]:
> Replying to [comment:96 jdemeyer]:
> > It seems that `pip` is missing an option to force-reinstall a single package without recursion.
> 
> `pip install --upgrade --force --no-deps` does it.

`--upgrade` does recursion:

```
  -U, --upgrade               Upgrade all specified packages to the newest available version. This process is recursive regardless of whether a dependency is already
                              satisfied.
```


Edit: I see you added `--no-deps` but I don't want that since I do want dependency checking.



---

archive/issue_comments_274817.json:
```json
{
    "body": "Well, yes, but now we know that dependency checking in the sense that you want doesn't work anyways.",
    "created_at": "2016-08-16T13:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274817",
    "user": "https://github.com/embray"
}
```

Well, yes, but now we know that dependency checking in the sense that you want doesn't work anyways.



---

archive/issue_comments_274818.json:
```json
{
    "body": "Replying to [comment:101 embray]:\n> Well, yes, but now we know that dependency checking in the sense that you want doesn't work anyways.\n\nIt works by itself, but not in combination with the other options.",
    "created_at": "2016-08-16T13:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274818",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:101 embray]:
> Well, yes, but now we know that dependency checking in the sense that you want doesn't work anyways.

It works by itself, but not in combination with the other options.



---

archive/issue_comments_274819.json:
```json
{
    "body": "Something like\n\n```\npip uninstall PACKAGE\npip install --no-index .\n```\n\nwould work and correctly check dependencies. There is just not a single command which does that.",
    "created_at": "2016-08-16T13:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274819",
    "user": "https://github.com/jdemeyer"
}
```

Something like

```
pip uninstall PACKAGE
pip install --no-index .
```

would work and correctly check dependencies. There is just not a single command which does that.



---

archive/issue_comments_274820.json:
```json
{
    "body": "For reasons that I do not understand, this breaks running Jupyter from the command line:\n\n```\n$ jupyter notebook\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-git/local/bin/jupyter-notebook\", line 5, in <module>\n    from pkg_resources import load_entry_point\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2927, in <module>\n    @_call_aside\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2913, in _call_aside\n    f(*args, **kwargs)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2940, in _initialize_master_working_set\n    working_set = WorkingSet._build_master()\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 635, in _build_master\n    ws.require(__requires__)\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 943, in require\n    needed = self.resolve(parse_requirements(requirements))\n  File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 829, in resolve\n    raise DistributionNotFound(req, requirers)\npkg_resources.DistributionNotFound: The 'terminado>=0.3.3' distribution was not found and is required by notebook\n```\n",
    "created_at": "2016-08-16T13:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274820",
    "user": "https://github.com/jdemeyer"
}
```

For reasons that I do not understand, this breaks running Jupyter from the command line:

```
$ jupyter notebook
Traceback (most recent call last):
  File "/usr/local/src/sage-git/local/bin/jupyter-notebook", line 5, in <module>
    from pkg_resources import load_entry_point
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2927, in <module>
    @_call_aside
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2913, in _call_aside
    f(*args, **kwargs)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2940, in _initialize_master_working_set
    working_set = WorkingSet._build_master()
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 635, in _build_master
    ws.require(__requires__)
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 943, in require
    needed = self.resolve(parse_requirements(requirements))
  File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 829, in resolve
    raise DistributionNotFound(req, requirers)
pkg_resources.DistributionNotFound: The 'terminado>=0.3.3' distribution was not found and is required by notebook
```




---

archive/issue_comments_274821.json:
```json
{
    "body": "The obvious solution is to add a `terminado` package to Sage and have `notebook` depend on it.",
    "created_at": "2016-08-16T13:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274821",
    "user": "https://github.com/jdemeyer"
}
```

The obvious solution is to add a `terminado` package to Sage and have `notebook` depend on it.



---

archive/issue_comments_274822.json:
```json
{
    "body": "Alternative and simpler solution: keep using `distutils` instead of `pip` to install `notebook`.",
    "created_at": "2016-08-16T13:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274822",
    "user": "https://github.com/jdemeyer"
}
```

Alternative and simpler solution: keep using `distutils` instead of `pip` to install `notebook`.



---

archive/issue_comments_274823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-16T13:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274824.json:
```json
{
    "body": "This is exactly the kind of problem which can happen because of `--no-deps`: `notebook` has an unsatisfied dependency (`terminado`). This breaks stuff but might pass automated tested since actually running `jupyter` is not tested.",
    "created_at": "2016-08-16T14:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274824",
    "user": "https://github.com/jdemeyer"
}
```

This is exactly the kind of problem which can happen because of `--no-deps`: `notebook` has an unsatisfied dependency (`terminado`). This breaks stuff but might pass automated tested since actually running `jupyter` is not tested.



---

archive/issue_comments_274825.json:
```json
{
    "body": "I'm not sure I'm following you.  Obviously jupyter notebook has a dependency that isn't satisfied because Sage doesn't include it.  Just forcing it to install without that dependency and leaving it broken is *not* a solution.",
    "created_at": "2016-08-16T14:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274825",
    "user": "https://github.com/embray"
}
```

I'm not sure I'm following you.  Obviously jupyter notebook has a dependency that isn't satisfied because Sage doesn't include it.  Just forcing it to install without that dependency and leaving it broken is *not* a solution.



---

archive/issue_comments_274826.json:
```json
{
    "body": "Replying to [comment:109 embray]:\n> Obviously jupyter notebook has a dependency that isn't satisfied because Sage doesn't include it.  Just forcing it to install without that dependency and leaving it broken is *not* a solution.\n\nI would argue that the bug is in Jupyter's requirements list: it lists a dependency which in practice is not a dependency at all, but more like an optional add-on.\n\nI just want to get on with this and this is a simple solution which is known to work.",
    "created_at": "2016-08-16T14:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274826",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:109 embray]:
> Obviously jupyter notebook has a dependency that isn't satisfied because Sage doesn't include it.  Just forcing it to install without that dependency and leaving it broken is *not* a solution.

I would argue that the bug is in Jupyter's requirements list: it lists a dependency which in practice is not a dependency at all, but more like an optional add-on.

I just want to get on with this and this is a simple solution which is known to work.



---

archive/issue_comments_274827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-16T14:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274828.json:
```json
{
    "body": "This last commit adds a few missing dependencies, exposed by #21256.",
    "created_at": "2016-08-16T14:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274828",
    "user": "https://github.com/jdemeyer"
}
```

This last commit adds a few missing dependencies, exposed by #21256.



---

archive/issue_comments_274829.json:
```json
{
    "body": "To be fair, terminado supplies the terminal interface in the Notebook, so even if as you're claiming it's optional, it is certainly nice to have.  In any case you can say it's a bug or not but if they're including it in their requirements list then I say it's a requirement unless specified otherwise.  This is definitely no solution.",
    "created_at": "2016-08-16T14:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274829",
    "user": "https://github.com/embray"
}
```

To be fair, terminado supplies the terminal interface in the Notebook, so even if as you're claiming it's optional, it is certainly nice to have.  In any case you can say it's a bug or not but if they're including it in their requirements list then I say it's a requirement unless specified otherwise.  This is definitely no solution.



---

archive/issue_comments_274830.json:
```json
{
    "body": "So what we should then? I see two options:\n\n1. Patch `notebook/setup.py` to remove `terminado` from the dependencies.\n\n2. Add a `terminado` package to Sage as dependency of this ticket.",
    "created_at": "2016-08-16T14:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274830",
    "user": "https://github.com/jdemeyer"
}
```

So what we should then? I see two options:

1. Patch `notebook/setup.py` to remove `terminado` from the dependencies.

2. Add a `terminado` package to Sage as dependency of this ticket.



---

archive/issue_comments_274831.json:
```json
{
    "body": "I suggest option 2.  As it is, for the Docker image for Sage I'm also installing terminado separately.  I don't see why it shouldn't be included.\n\nIf it helps, looking at the setup.py for notebook, it seems terminado *is* being considered a requirement on any non-Windows platform.  Probably because even though they've been careful to make it so that the notebook can work without it, not having it means missing functionality==a defect.  I don't think we should say that \"Sage includes the Jupyter notebook\" and then ship a defective product.\n\nThe reason you get this\n\n\n```\npkg_resources.DistributionNotFound: The 'terminado>=0.3.3' distribution was not found and is required by notebook\n```\n\n\nis that installing with setuptools also installs the autogenerated console script wrappers which do dependency checking when you run them, so it's right to say that it won't run without some dependency installed.",
    "created_at": "2016-08-16T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274831",
    "user": "https://github.com/embray"
}
```

I suggest option 2.  As it is, for the Docker image for Sage I'm also installing terminado separately.  I don't see why it shouldn't be included.

If it helps, looking at the setup.py for notebook, it seems terminado *is* being considered a requirement on any non-Windows platform.  Probably because even though they've been careful to make it so that the notebook can work without it, not having it means missing functionality==a defect.  I don't think we should say that "Sage includes the Jupyter notebook" and then ship a defective product.

The reason you get this


```
pkg_resources.DistributionNotFound: The 'terminado>=0.3.3' distribution was not found and is required by notebook
```


is that installing with setuptools also installs the autogenerated console script wrappers which do dependency checking when you run them, so it's right to say that it won't run without some dependency installed.



---

archive/issue_comments_274832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-17T08:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-17T08:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-17T09:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-17T09:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_274836.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-17T09:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274836",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-17T20:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274837",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274838.json:
```json
{
    "body": "This is minor, but a few packages (configparser, terminado, entrypoints) still have an explicit `pip install` in their `spgk-install` instead of the `$PIP_INSTALL`.  The effect is the same, but if it's not fixed now but the idea was to have a standard way of invoking pip for all packages, and it could have surprising effects if some packages aren't getting the same arguments for pip.",
    "created_at": "2016-08-19T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274838",
    "user": "https://github.com/embray"
}
```

This is minor, but a few packages (configparser, terminado, entrypoints) still have an explicit `pip install` in their `spgk-install` instead of the `$PIP_INSTALL`.  The effect is the same, but if it's not fixed now but the idea was to have a standard way of invoking pip for all packages, and it could have surprising effects if some packages aren't getting the same arguments for pip.



---

archive/issue_comments_274839.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-19T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274839",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_274840.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-08-19T11:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274840",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_274841.json:
```json
{
    "body": "That can be fixed in a follow-up ticket. There is no reason to hold up this ticket for that.",
    "created_at": "2016-08-19T11:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274841",
    "user": "https://github.com/jdemeyer"
}
```

That can be fixed in a follow-up ticket. There is no reason to hold up this ticket for that.



---

archive/issue_comments_274842.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-19T22:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274842",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_274843.json:
```json
{
    "body": "Breaks OSX when compiling from scratch in numpy\n\n```\n[numpy-1.11.1] gcc version 4.9.3 (GCC) \n[numpy-1.11.1] ****************************************************\n[numpy-1.11.1] patching file numpy/core/function_base.py\n[numpy-1.11.1] patching file numpy/distutils/system_info.py\n[numpy-1.11.1] Hunk #1 succeeded at 1685 (offset -5 lines).\n[numpy-1.11.1] Hunk #2 succeeded at 1718 (offset -4 lines).\n[numpy-1.11.1] \n[numpy-1.11.1] Usage:   \n[numpy-1.11.1]   pip install [options] <requirement specifier> [package-index-options] ...\n[numpy-1.11.1]   pip install [options] -r <requirements file> [package-index-options] ...\n[numpy-1.11.1]   pip install [options] [-e] <vcs project url> ...\n[numpy-1.11.1]   pip install [options] [-e] <local project path> ...\n[numpy-1.11.1]   pip install [options] <archive url/path> ...\n[numpy-1.11.1] \n[numpy-1.11.1] no such option: ---global-option\n[numpy-1.11.1] \n[numpy-1.11.1] real\t0m0.519s\n[numpy-1.11.1] user\t0m0.269s\n[numpy-1.11.1] sys\t0m0.142s\n[numpy-1.11.1] ************************************************************************\n[numpy-1.11.1] Error installing package numpy-1.11.1\n```\n\nNote on OSX:\n\n```\nosx:build buildslave-sage$ NUMPY_FCONFIG=\"config_fc --noopt --noarch\"\nosx:build buildslave-sage$ echo $NUMPY_FCONFIG | sed -e 's/\\(\\S*\\)/--global-option \\1/g'\n--global-option c--global-option o--global-option n--global-option f--global-option i--global-option g--global-option _--global-option f--global-option c--global-option  --global-option ---global-option ---global-option n--global-option o--global-option o--global-option p--global-option t--global-option  --global-option ---global-option ---global-option n--global-option o--global-option a--global-option r--global-option c--global-option h--global-option \n```\n",
    "created_at": "2016-08-20T22:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274843",
    "user": "https://github.com/vbraun"
}
```

Breaks OSX when compiling from scratch in numpy

```
[numpy-1.11.1] gcc version 4.9.3 (GCC) 
[numpy-1.11.1] ****************************************************
[numpy-1.11.1] patching file numpy/core/function_base.py
[numpy-1.11.1] patching file numpy/distutils/system_info.py
[numpy-1.11.1] Hunk #1 succeeded at 1685 (offset -5 lines).
[numpy-1.11.1] Hunk #2 succeeded at 1718 (offset -4 lines).
[numpy-1.11.1] 
[numpy-1.11.1] Usage:   
[numpy-1.11.1]   pip install [options] <requirement specifier> [package-index-options] ...
[numpy-1.11.1]   pip install [options] -r <requirements file> [package-index-options] ...
[numpy-1.11.1]   pip install [options] [-e] <vcs project url> ...
[numpy-1.11.1]   pip install [options] [-e] <local project path> ...
[numpy-1.11.1]   pip install [options] <archive url/path> ...
[numpy-1.11.1] 
[numpy-1.11.1] no such option: ---global-option
[numpy-1.11.1] 
[numpy-1.11.1] real	0m0.519s
[numpy-1.11.1] user	0m0.269s
[numpy-1.11.1] sys	0m0.142s
[numpy-1.11.1] ************************************************************************
[numpy-1.11.1] Error installing package numpy-1.11.1
```

Note on OSX:

```
osx:build buildslave-sage$ NUMPY_FCONFIG="config_fc --noopt --noarch"
osx:build buildslave-sage$ echo $NUMPY_FCONFIG | sed -e 's/\(\S*\)/--global-option \1/g'
--global-option c--global-option o--global-option n--global-option f--global-option i--global-option g--global-option _--global-option f--global-option c--global-option  --global-option ---global-option ---global-option n--global-option o--global-option o--global-option p--global-option t--global-option  --global-option ---global-option ---global-option n--global-option o--global-option a--global-option r--global-option c--global-option h--global-option 
```




---

archive/issue_comments_274844.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2016-08-20T22:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274844",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_274845.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2016-08-20T22:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274845",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_274846.json:
```json
{
    "body": "Apparently on OSX that should be `sed -E` not `sed -e` :(",
    "created_at": "2016-08-22T09:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274846",
    "user": "https://github.com/embray"
}
```

Apparently on OSX that should be `sed -E` not `sed -e` :(



---

archive/issue_comments_274847.json:
```json
{
    "body": "Replying to [comment:128 embray]:\n> Apparently on OSX that should be `sed -E` not `sed -e` :(\n\nIn fact the `-e` doesn't really even need to be there. I'm not sure why I put it.  But on OSX it seems the `-E` is needed to interpret the command as a \"modern\" perl-style regexp.",
    "created_at": "2016-08-22T09:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274847",
    "user": "https://github.com/embray"
}
```

Replying to [comment:128 embray]:
> Apparently on OSX that should be `sed -E` not `sed -e` :(

In fact the `-e` doesn't really even need to be there. I'm not sure why I put it.  But on OSX it seems the `-E` is needed to interpret the command as a "modern" perl-style regexp.



---

archive/issue_comments_274848.json:
```json
{
    "body": "Or for a more portable way without invoking `sed` at all:\n\n\n```\n$(for opt in $NUMPY_FCONFIG; do printf ' %s %s' --global-option $opt; done)\n```\n",
    "created_at": "2016-08-22T09:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274848",
    "user": "https://github.com/embray"
}
```

Or for a more portable way without invoking `sed` at all:


```
$(for opt in $NUMPY_FCONFIG; do printf ' %s %s' --global-option $opt; done)
```




---

archive/issue_comments_274849.json:
```json
{
    "body": "I don't really care which variant long as it works ;-)\n----\nLast 10 new commits:",
    "created_at": "2016-08-22T17:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274849",
    "user": "https://github.com/vbraun"
}
```

I don't really care which variant long as it works ;-)
----
Last 10 new commits:



---

archive/issue_comments_274850.json:
```json
{
    "body": "Is this ready for review?",
    "created_at": "2016-08-26T08:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274850",
    "user": "https://github.com/jdemeyer"
}
```

Is this ready for review?



---

archive/issue_comments_274851.json:
```json
{
    "body": "I guess not, since no changes have been made :-)",
    "created_at": "2016-08-26T08:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274851",
    "user": "https://github.com/jdemeyer"
}
```

I guess not, since no changes have been made :-)



---

archive/issue_comments_274852.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T08:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T09:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274854.json:
```json
{
    "body": "Replying to [comment:134 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[99e1494](https://git.sagemath.org/sage.git/commit/?id=99e1494840eac3dbb10d57b4721c4ff281c47c4e)||`Revert changes to numpy`||\n\nI mean that's fine--what this is doing is in effect the same.  But you could have taken one of my suggestions above.  I think the for loop is most effective.  I mean I would just do it but you sort of took over this ticket",
    "created_at": "2016-08-26T09:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274854",
    "user": "https://github.com/embray"
}
```

Replying to [comment:134 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[99e1494](https://git.sagemath.org/sage.git/commit/?id=99e1494840eac3dbb10d57b4721c4ff281c47c4e)||`Revert changes to numpy`||

I mean that's fine--what this is doing is in effect the same.  But you could have taken one of my suggestions above.  I think the for loop is most effective.  I mean I would just do it but you sort of took over this ticket



---

archive/issue_comments_274855.json:
```json
{
    "body": "I just want this ticket to get merged. We can deal with the difficult cases (like `numpy`) later.",
    "created_at": "2016-08-26T09:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274855",
    "user": "https://github.com/jdemeyer"
}
```

I just want this ticket to get merged. We can deal with the difficult cases (like `numpy`) later.



---

archive/issue_comments_274856.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-26T09:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274856",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274857.json:
```json
{
    "body": "Replying to [comment:136 embray]:\n> I mean that's fine\n\nMay I take that as positive review?",
    "created_at": "2016-08-26T09:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274857",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:136 embray]:
> I mean that's fine

May I take that as positive review?



---

archive/issue_comments_274858.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-26T09:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274858",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274859.json:
```json
{
    "body": "Yeah, yeah :)  *fingers crossed*",
    "created_at": "2016-08-26T10:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274859",
    "user": "https://github.com/embray"
}
```

Yeah, yeah :)  *fingers crossed*



---

archive/issue_comments_274860.json:
```json
{
    "body": "IPython on OSX appears to require a platform-specific package:\n\n```\nsage -t --long src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 476, in sage.tests.cmdline.test_executable\nFailed example:\n    out.find(\"5559060566555523\") >= 0\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 478, in sage.tests.cmdline.test_executable\nFailed example:\n    err\nExpected:\n    ''\nGot:\n    'Traceback (most recent call last):\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/bin/ipython\", line 5, in <module>\\n    from pkg_resources import load_entry_point\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2927, in <module>\\n    @_call_aside\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2913, in _call_aside\\n    f(*args, **kwargs)\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2940, in _initialize_master_working_set\\n    working_set = WorkingSet._build_master()\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 635, in _build_master\\n    ws.require(__requires__)\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 943, in require\\n    needed = self.resolve(parse_requirements(requirements))\\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 829, in resolve\\n    raise DistributionNotFound(req, requirers)\\npkg_resources.DistributionNotFound: The \\'appnope\\' distribution was not found and is required by ipython\\n'\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 480, in sage.tests.cmdline.test_executable\nFailed example:\n    ret\nExpected:\n    0\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   3 of 239 in sage.tests.cmdline.test_executable\n    [238 tests, 3 failures, 71.27 s]\n```\n",
    "created_at": "2016-08-27T08:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274860",
    "user": "https://github.com/vbraun"
}
```

IPython on OSX appears to require a platform-specific package:

```
sage -t --long src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 476, in sage.tests.cmdline.test_executable
Failed example:
    out.find("5559060566555523") >= 0
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/tests/cmdline.py", line 478, in sage.tests.cmdline.test_executable
Failed example:
    err
Expected:
    ''
Got:
    'Traceback (most recent call last):\n  File "/Users/buildslave-sage/slave/sage_git/build/local/bin/ipython", line 5, in <module>\n    from pkg_resources import load_entry_point\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2927, in <module>\n    @_call_aside\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2913, in _call_aside\n    f(*args, **kwargs)\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2940, in _initialize_master_working_set\n    working_set = WorkingSet._build_master()\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 635, in _build_master\n    ws.require(__requires__)\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 943, in require\n    needed = self.resolve(parse_requirements(requirements))\n  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 829, in resolve\n    raise DistributionNotFound(req, requirers)\npkg_resources.DistributionNotFound: The \'appnope\' distribution was not found and is required by ipython\n'
**********************************************************************
File "src/sage/tests/cmdline.py", line 480, in sage.tests.cmdline.test_executable
Failed example:
    ret
Expected:
    0
Got:
    1
**********************************************************************
1 item had failures:
   3 of 239 in sage.tests.cmdline.test_executable
    [238 tests, 3 failures, 71.27 s]
```




---

archive/issue_comments_274861.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-27T08:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274861",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_274862.json:
```json
{
    "body": "https://pypi.python.org/pypi/appnope/",
    "created_at": "2016-08-27T08:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274862",
    "user": "https://github.com/vbraun"
}
```

https://pypi.python.org/pypi/appnope/



---

archive/issue_comments_274863.json:
```json
{
    "body": "\n```\nosx:build buildslave-sage$ ./sage --ipython\nTraceback (most recent call last):\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/bin/ipython\", line 5, in <module>\n    from pkg_resources import load_entry_point\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2927, in <module>\n    @_call_aside\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2913, in _call_aside\n    f(*args, **kwargs)\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2940, in _initialize_master_working_set\n    working_set = WorkingSet._build_master()\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 635, in _build_master\n    ws.require(__requires__)\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 943, in require\n    needed = self.resolve(parse_requirements(requirements))\n  File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 829, in resolve\n    raise DistributionNotFound(req, requirers)\npkg_resources.DistributionNotFound: The 'appnope' distribution was not found and is required by ipython\nosx:build buildslave-sage$ ./sage -pip install appnope\nCollecting appnope\n  Downloading appnope-0.1.0-py2.py3-none-any.whl\nInstalling collected packages: appnope\nSuccessfully installed appnope-0.1.0\nosx:build buildslave-sage$ ./sage --ipython\nPython 2.7.10 (default, Aug 27 2016, 01:49:52) \nType \"copyright\", \"credits\" or \"license\" for more information.\n\nIPython 5.0.0 -- An enhanced Interactive Python.\n?         -> Introduction and overview of IPython's features.\n%quickref -> Quick reference.\nhelp      -> Python's own help system.\nobject?   -> Details about 'object', use 'object??' for extra details.\n\nIn [1]: \n```\n",
    "created_at": "2016-08-27T08:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274863",
    "user": "https://github.com/vbraun"
}
```


```
osx:build buildslave-sage$ ./sage --ipython
Traceback (most recent call last):
  File "/Users/buildslave-sage/slave/sage_git/build/local/bin/ipython", line 5, in <module>
    from pkg_resources import load_entry_point
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2927, in <module>
    @_call_aside
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2913, in _call_aside
    f(*args, **kwargs)
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2940, in _initialize_master_working_set
    working_set = WorkingSet._build_master()
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 635, in _build_master
    ws.require(__requires__)
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 943, in require
    needed = self.resolve(parse_requirements(requirements))
  File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 829, in resolve
    raise DistributionNotFound(req, requirers)
pkg_resources.DistributionNotFound: The 'appnope' distribution was not found and is required by ipython
osx:build buildslave-sage$ ./sage -pip install appnope
Collecting appnope
  Downloading appnope-0.1.0-py2.py3-none-any.whl
Installing collected packages: appnope
Successfully installed appnope-0.1.0
osx:build buildslave-sage$ ./sage --ipython
Python 2.7.10 (default, Aug 27 2016, 01:49:52) 
Type "copyright", "credits" or "license" for more information.

IPython 5.0.0 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object', use 'object??' for extra details.

In [1]: 
```




---

archive/issue_comments_274864.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-27T12:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274865.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-27T12:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274865",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274866.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-27T14:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274866",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274867.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/misc/package.py\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 24, in sage.misc.package\nFailed example:\n    sorted(pkgs.keys())\nExpected:\n    ['4ti2',\n     'alabaster',\n     'arb',\n     ...\n     'zlib',\n     'zn_poly',\n     'zope_interface']\nGot:\n    ['4ti2',\n     'alabaster',\n     'appnope',\n     'arb',\n```\n",
    "created_at": "2016-08-27T22:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274867",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 24, in sage.misc.package
Failed example:
    sorted(pkgs.keys())
Expected:
    ['4ti2',
     'alabaster',
     'arb',
     ...
     'zlib',
     'zn_poly',
     'zope_interface']
Got:
    ['4ti2',
     'alabaster',
     'appnope',
     'arb',
```




---

archive/issue_comments_274868.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-27T22:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274868",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_274869.json:
```json
{
    "body": "Heh. What an insidious test :)",
    "created_at": "2016-08-29T10:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274869",
    "user": "https://github.com/embray"
}
```

Heh. What an insidious test :)



---

archive/issue_comments_274870.json:
```json
{
    "body": "That test doesn't exist in this branch... all tests pass on my machine. It must have been added recently.",
    "created_at": "2016-08-30T08:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274870",
    "user": "https://github.com/jdemeyer"
}
```

That test doesn't exist in this branch... all tests pass on my machine. It must have been added recently.



---

archive/issue_comments_274871.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-30T08:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-30T09:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274873.json:
```json
{
    "body": "That test is only used for documentation purposes, it makes no sense to hardcode the list of packages in a test. Therefore, I mark the test `# random`.",
    "created_at": "2016-08-30T09:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274873",
    "user": "https://github.com/jdemeyer"
}
```

That test is only used for documentation purposes, it makes no sense to hardcode the list of packages in a test. Therefore, I mark the test `# random`.



---

archive/issue_comments_274874.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-30T09:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274874",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274875.json:
```json
{
    "body": "Please review this trivial fix...",
    "created_at": "2016-08-31T11:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274875",
    "user": "https://github.com/jdemeyer"
}
```

Please review this trivial fix...



---

archive/issue_comments_274876.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-31T12:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274876",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274877.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-01T06:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274877",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_274878.json:
```json
{
    "body": "Replying to [comment:31 embray]:\n> pip will uninstall them, *mostly*.\n\nThis doesn't happen, leading to breakage like #21441.",
    "created_at": "2016-09-06T20:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274878",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:31 embray]:
> pip will uninstall them, *mostly*.

This doesn't happen, leading to breakage like #21441.



---

archive/issue_comments_274879.json:
```json
{
    "body": "It does happen, normally.  I don't know why it didn't for you.  You might have already had 2 Cythons installed and maybe it only uninstalled one.",
    "created_at": "2016-09-07T08:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19981#issuecomment-274879",
    "user": "https://github.com/embray"
}
```

It does happen, normally.  I don't know why it didn't for you.  You might have already had 2 Cythons installed and maybe it only uninstalled one.
