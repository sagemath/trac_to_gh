# Issue 24555: More functionalities for bases of free modules and vector frames

Issue created by migration from https://trac.sagemath.org/ticket/24792

Original creator: egourgoulhon

Original creation time: 2018-02-20 15:14:25

CC:  tscrim

Keywords: basis, vector frame, manifold, free moduie

This ticket provides more flexibility in the choice of symbols and indices for [bases of free modules of finite rank](http://doc.sagemath.org/html/en/reference/tensor_free_modules/sage/tensor/modules/free_module_basis.html) and, consequently, for [vector frames on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorframe.html). 
In particular, the labels of the basis elements are no longer necessary integers and can be customized, for instance:

```
sage: M = Manifold(3, 'M')
sage: e = M.vector_frame('e', indices=('x', 'y', 'z')); e
Vector frame (M, (e_x,e_y,e_z))
```

The symbol of each element of the basis can also be freely chosen, by providing a tuple of symbols instead of a single string; it is then mandatory to specify as well some symbols for the dual coframe:

```
sage: e = M.vector_frame(('a', 'b', 'c'), symbol_dual=('A', 'B', 'C')); e
Vector frame (M, (a,b,c))
sage: e[0]
Vector field a on the 3-dimensional differentiable manifold M
sage: e.coframe()
Coframe (M, (A,B,C))
sage: e.coframe()[0]
1-form A on the 3-dimensional differentiable manifold M
```

Besides, the slice operator is introduced for bases; it is now possible to write 

```
sage: e[:]
(Vector field a on the 3-dimensional differentiable manifold M,
 Vector field b on the 3-dimensional differentiable manifold M,
 Vector field c on the 3-dimensional differentiable manifold M)
```


Internally, some refactoring of code has been performed. In particular, by renaming the `FreeModuleCoBasis`'s attribute `_form` (the tuple containing the cobasis elements) to `_vec`, so that it matches the name of the `FreeModuleBasis`'s attribute storing the basis elements, it has been possible to factor the method ` __getitem__` to the ABC `Basis_abstract`. Another improvement is getting rid of all methods `_init_dual_basis` in classes `FreeModuleBasis`, `VectorFrame` and `CoordFrame` thanks to the introduction of the class attribute `_cobasis_class`.

The functionalities introduced here provide a better user interface for #24623.

This work is part of the [SageManifolds project](http://sagemanifolds.obspm.fr/), see #18528 for an overview.


---

Comment by egourgoulhon created at 2018-02-20 15:22:40

New commits:


---

Comment by egourgoulhon created at 2018-02-20 15:24:31

Changing status from new to needs_review.


---

Comment by git created at 2018-02-26 14:10:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-26 14:16:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-02-26 14:20:37

The above two commits add the method `set_name` to `VectorFrame` and `CoFrame` for even more flexibility (previously `set_name` was inherited from `Basis_abstract` and could not handle the domain name). This is required for #24623.


---

Comment by tscrim created at 2018-02-28 09:49:13

Looks good overall. However, I do have one comment:

`VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):

```diff
         """
         from sage.manifolds.differentiable.vectorframe import VectorFrame
+        # Only tuples are valid entries for the unique representation of
+        # VectorFrame:
+        if isinstance(symbol, list):
+            symbol = tuple(symbol)
+        if isinstance(latex_symbol, list):
+            latex_symbol = tuple(latex_symbol)
+        if isinstance(indices, list):
+            indices = tuple(indices)
+        if isinstance(latex_indices, list):
+            latex_indices = tuple(latex_indices)
+        if isinstance(symbol_dual, list):
+            symbol_dual = tuple(symbol_dual)
+        if isinstance(latex_symbol_dual, list):
+            latex_symbol_dual = tuple(latex_symbol_dual)
         return VectorFrame(self.vector_field_module(dest_map=dest_map,
                                                     force_free=True),
                            symbol=symbol, latex_symbol=latex_symbol,
-                           from_frame=from_frame)
+                           from_frame=from_frame, indices=indices,
+                           latex_indices=latex_indices, symbol_dual=symbol_dual,
+                           latex_symbol_dual=latex_symbol_dual)
 
     def _set_covering_frame(self, frame):
         r"""
```

This probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. Note that `__classcall__` is inherited, so you could define it in a base class.


---

Comment by git created at 2018-02-28 14:28:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-02-28 14:33:27

Replying to [comment:7 tscrim]:

Thank you very much for looking into this and for your comments.

> 
> `VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):
> This probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. 

Thanks for the suggestion; this is done via `__classcall_private__` in the above commit.


---

Comment by git created at 2018-02-28 17:30:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-02-28 17:38:23

While working on #24623, I've noticed some issues regarding the naming of tangent space bases induced by vector frames. The above commit fixes this. It also removes unnecessary pieces of code in `FreeModuleBasis.__init__` and `FreeModuleBasis._new_instance`.


---

Comment by tscrim created at 2018-02-28 21:53:29

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-02-28 21:53:29

LGTM. Thank you.


---

Comment by egourgoulhon created at 2018-02-28 22:29:41

Thank you for the review!


---

Comment by vbraun created at 2018-03-05 17:53:04

Resolution: fixed
