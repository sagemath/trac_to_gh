# Issue 24555: More functionalities for bases of free modules and vector frames

archive/issues_024555.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: basis, vector frame, manifold, free moduie\n\nThis ticket provides more flexibility in the choice of symbols and indices for [bases of free modules of finite rank](http://doc.sagemath.org/html/en/reference/tensor_free_modules/sage/tensor/modules/free_module_basis.html) and, consequently, for [vector frames on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorframe.html). \nIn particular, the labels of the basis elements are no longer necessary integers and can be customized, for instance:\n\n```\nsage: M = Manifold(3, 'M')\nsage: e = M.vector_frame('e', indices=('x', 'y', 'z')); e\nVector frame (M, (e_x,e_y,e_z))\n```\nThe symbol of each element of the basis can also be freely chosen, by providing a tuple of symbols instead of a single string; it is then mandatory to specify as well some symbols for the dual coframe:\n\n```\nsage: e = M.vector_frame(('a', 'b', 'c'), symbol_dual=('A', 'B', 'C')); e\nVector frame (M, (a,b,c))\nsage: e[0]\nVector field a on the 3-dimensional differentiable manifold M\nsage: e.coframe()\nCoframe (M, (A,B,C))\nsage: e.coframe()[0]\n1-form A on the 3-dimensional differentiable manifold M\n```\nBesides, the slice operator is introduced for bases; it is now possible to write \n\n```\nsage: e[:]\n(Vector field a on the 3-dimensional differentiable manifold M,\n Vector field b on the 3-dimensional differentiable manifold M,\n Vector field c on the 3-dimensional differentiable manifold M)\n```\n\nInternally, some refactoring of code has been performed. In particular, by renaming the `FreeModuleCoBasis`'s attribute `_form` (the tuple containing the cobasis elements) to `_vec`, so that it matches the name of the `FreeModuleBasis`'s attribute storing the basis elements, it has been possible to factor the method ` __getitem__` to the ABC `Basis_abstract`. Another improvement is getting rid of all methods `_init_dual_basis` in classes `FreeModuleBasis`, `VectorFrame` and `CoordFrame` thanks to the introduction of the class attribute `_cobasis_class`.\n\nThe functionalities introduced here provide a better user interface for #24623.\n\nThis work is part of the [SageManifolds project](http://sagemanifolds.obspm.fr/), see #18528 for an overview.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24792\n\n",
    "created_at": "2018-02-20T15:14:25Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "More functionalities for bases of free modules and vector frames",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24555",
    "user": "https://github.com/egourgoulhon"
}
```
CC:  @tscrim

Keywords: basis, vector frame, manifold, free moduie

This ticket provides more flexibility in the choice of symbols and indices for [bases of free modules of finite rank](http://doc.sagemath.org/html/en/reference/tensor_free_modules/sage/tensor/modules/free_module_basis.html) and, consequently, for [vector frames on manifolds](http://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/vectorframe.html). 
In particular, the labels of the basis elements are no longer necessary integers and can be customized, for instance:

```
sage: M = Manifold(3, 'M')
sage: e = M.vector_frame('e', indices=('x', 'y', 'z')); e
Vector frame (M, (e_x,e_y,e_z))
```
The symbol of each element of the basis can also be freely chosen, by providing a tuple of symbols instead of a single string; it is then mandatory to specify as well some symbols for the dual coframe:

```
sage: e = M.vector_frame(('a', 'b', 'c'), symbol_dual=('A', 'B', 'C')); e
Vector frame (M, (a,b,c))
sage: e[0]
Vector field a on the 3-dimensional differentiable manifold M
sage: e.coframe()
Coframe (M, (A,B,C))
sage: e.coframe()[0]
1-form A on the 3-dimensional differentiable manifold M
```
Besides, the slice operator is introduced for bases; it is now possible to write 

```
sage: e[:]
(Vector field a on the 3-dimensional differentiable manifold M,
 Vector field b on the 3-dimensional differentiable manifold M,
 Vector field c on the 3-dimensional differentiable manifold M)
```

Internally, some refactoring of code has been performed. In particular, by renaming the `FreeModuleCoBasis`'s attribute `_form` (the tuple containing the cobasis elements) to `_vec`, so that it matches the name of the `FreeModuleBasis`'s attribute storing the basis elements, it has been possible to factor the method ` __getitem__` to the ABC `Basis_abstract`. Another improvement is getting rid of all methods `_init_dual_basis` in classes `FreeModuleBasis`, `VectorFrame` and `CoordFrame` thanks to the introduction of the class attribute `_cobasis_class`.

The functionalities introduced here provide a better user interface for #24623.

This work is part of the [SageManifolds project](http://sagemanifolds.obspm.fr/), see #18528 for an overview.

Issue created by migration from https://trac.sagemath.org/ticket/24792





---

archive/issue_comments_344174.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-20T15:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344174",
    "user": "https://github.com/egourgoulhon"
}
```

New commits:



---

archive/issue_comments_344175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-20T15:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344175",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T14:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344177.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T14:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344178.json:
```json
{
    "body": "The above two commits add the method `set_name` to `VectorFrame` and `CoFrame` for even more flexibility (previously `set_name` was inherited from `Basis_abstract` and could not handle the domain name). This is required for #24623.",
    "created_at": "2018-02-26T14:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344178",
    "user": "https://github.com/egourgoulhon"
}
```

The above two commits add the method `set_name` to `VectorFrame` and `CoFrame` for even more flexibility (previously `set_name` was inherited from `Basis_abstract` and could not handle the domain name). This is required for #24623.



---

archive/issue_comments_344179.json:
```json
{
    "body": "Looks good overall. However, I do have one comment:\n\n`VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):\n\n```diff\n         \"\"\"\n         from sage.manifolds.differentiable.vectorframe import VectorFrame\n+        # Only tuples are valid entries for the unique representation of\n+        # VectorFrame:\n+        if isinstance(symbol, list):\n+            symbol = tuple(symbol)\n+        if isinstance(latex_symbol, list):\n+            latex_symbol = tuple(latex_symbol)\n+        if isinstance(indices, list):\n+            indices = tuple(indices)\n+        if isinstance(latex_indices, list):\n+            latex_indices = tuple(latex_indices)\n+        if isinstance(symbol_dual, list):\n+            symbol_dual = tuple(symbol_dual)\n+        if isinstance(latex_symbol_dual, list):\n+            latex_symbol_dual = tuple(latex_symbol_dual)\n         return VectorFrame(self.vector_field_module(dest_map=dest_map,\n                                                     force_free=True),\n                            symbol=symbol, latex_symbol=latex_symbol,\n-                           from_frame=from_frame)\n+                           from_frame=from_frame, indices=indices,\n+                           latex_indices=latex_indices, symbol_dual=symbol_dual,\n+                           latex_symbol_dual=latex_symbol_dual)\n \n     def _set_covering_frame(self, frame):\n         r\"\"\"\n```\nThis probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. Note that `__classcall__` is inherited, so you could define it in a base class.",
    "created_at": "2018-02-28T09:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344179",
    "user": "https://github.com/tscrim"
}
```

Looks good overall. However, I do have one comment:

`VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):

```diff
         """
         from sage.manifolds.differentiable.vectorframe import VectorFrame
+        # Only tuples are valid entries for the unique representation of
+        # VectorFrame:
+        if isinstance(symbol, list):
+            symbol = tuple(symbol)
+        if isinstance(latex_symbol, list):
+            latex_symbol = tuple(latex_symbol)
+        if isinstance(indices, list):
+            indices = tuple(indices)
+        if isinstance(latex_indices, list):
+            latex_indices = tuple(latex_indices)
+        if isinstance(symbol_dual, list):
+            symbol_dual = tuple(symbol_dual)
+        if isinstance(latex_symbol_dual, list):
+            latex_symbol_dual = tuple(latex_symbol_dual)
         return VectorFrame(self.vector_field_module(dest_map=dest_map,
                                                     force_free=True),
                            symbol=symbol, latex_symbol=latex_symbol,
-                           from_frame=from_frame)
+                           from_frame=from_frame, indices=indices,
+                           latex_indices=latex_indices, symbol_dual=symbol_dual,
+                           latex_symbol_dual=latex_symbol_dual)
 
     def _set_covering_frame(self, frame):
         r"""
```
This probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. Note that `__classcall__` is inherited, so you could define it in a base class.



---

archive/issue_comments_344180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T14:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344181.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n\nThank you very much for looking into this and for your comments.\n\n> \n> `VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):\n> This probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. \n\n\nThanks for the suggestion; this is done via `__classcall_private__` in the above commit.",
    "created_at": "2018-02-28T14:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344181",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:7 tscrim]:

Thank you very much for looking into this and for your comments.

> 
> `VectorFrame` should process its arguments to ensure its unique representation, so this addition should not be needed (except the last bit of course):
> This probably means you need to implement a `__classcall_private__`/`__classcall__` for that class. 


Thanks for the suggestion; this is done via `__classcall_private__` in the above commit.



---

archive/issue_comments_344182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T17:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344183.json:
```json
{
    "body": "While working on #24623, I've noticed some issues regarding the naming of tangent space bases induced by vector frames. The above commit fixes this. It also removes unnecessary pieces of code in `FreeModuleBasis.__init__` and `FreeModuleBasis._new_instance`.",
    "created_at": "2018-02-28T17:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344183",
    "user": "https://github.com/egourgoulhon"
}
```

While working on #24623, I've noticed some issues regarding the naming of tangent space bases induced by vector frames. The above commit fixes this. It also removes unnecessary pieces of code in `FreeModuleBasis.__init__` and `FreeModuleBasis._new_instance`.



---

archive/issue_comments_344184.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-28T21:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344184",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344185.json:
```json
{
    "body": "LGTM. Thank you.",
    "created_at": "2018-02-28T21:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344185",
    "user": "https://github.com/tscrim"
}
```

LGTM. Thank you.



---

archive/issue_comments_344186.json:
```json
{
    "body": "Thank you for the review!",
    "created_at": "2018-02-28T22:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344186",
    "user": "https://github.com/egourgoulhon"
}
```

Thank you for the review!



---

archive/issue_events_062320.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-05T17:53:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24555#event-62320"
}
```



---

archive/issue_comments_344187.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-05T17:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24555",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24555#issuecomment-344187",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
