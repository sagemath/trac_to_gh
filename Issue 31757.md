# Issue 31757: Sigma invariants for P^N, N > 1

Issue created by migration from https://trac.sagemath.org/ticket/31994

Original creator: @EnderWannabe

Original creation time: 2021-06-16 20:58:56

CC:  bhutz

Keywords: gsoc2021

Currently, the sigma invariants method for dynamical systems on projective space is not implemented when the projective space has dimension greater than 1. Using the algorithm described in [https://arxiv.org/pdf/1908.03184.pdf](https://arxiv.org/pdf/1908.03184.pdf), this ticket implements that functionality.


---

Comment by git created at 2021-06-18 21:18:23

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-06-21 20:43:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-30 18:56:58

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @EnderWannabe created at 2021-06-30 18:57:13

Changing status from new to needs_review.


---

Comment by bhutz created at 2021-07-06 17:21:05

I pushed a branch with a few comments in the main algorithm. Feel free to add some more.


Here are the issues I've found:

- I don't think putting the degrees as the first two coordinates is appropriate since unless you understand the full form of the sigma invariant polynomials it's not that helpful. If you do know the full form, then then information is not needed.

- need examples for
 - formal=True
 - finite fields
 - polynomial rings

- cycle is ignored for dimension > 1, but seems like a not implemented error should be thrown instead of simply ignoring the parameter. Also, should mention in the INPUT documentation that it is only for dim=1.

- You need to fix the signs as you pull off the coefficients in

```
sigmas.append(sigma_dictionary.pop(w**i*t**j, 0))
```


- Formal doesn't seem to work as these both give the same result

```
P.<x,y,z>=ProjectiveSpace(QQ,2)
f=DynamicalSystem([x^2-z^2,y^2,z^2])
f.sigma_invariants(2,return_polynomial=True,formal = False)
f.sigma_invariants(2,return_polynomial=True,formal = True)
```


- random error


```
P.<x,y,z>=ProjectiveSpace(QQbar,2)
f=DynamicalSystem([x^2-z^2,y^2,z^2])
f.sigma_invariants(2,return_polynomial=True,formal = False)
```


- shouldn't these work?

```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(R,1)
f=DynamicalSystem([x^2+c*y^2,y^2])
f.sigma_invariants(1,return_polynomial=True)

R.<c,d>=QQ[]
P.<x,y,z>=ProjectiveSpace(R,2)
f=DynamicalSystem([x^2+c*z^2,y^2+d*z^2,z^2])
f.sigma_invariants(1,return_polynomial=True)

R.<c,d>=QQ[]
P.<x,y,z>=ProjectiveSpace(FractionField(R),2)
f=DynamicalSystem([x^2+c*z^2,y^2+d*z^2,z^2])
f.sigma_invariants(1,return_polynomial=True)
```


- This is wrong

```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([x^2+3*y^2,x*y])
f.sigma_invariants(1,return_polynomial=True, chow=True)
```



---

Comment by bhutz created at 2021-07-06 17:21:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-07-06 22:43:34

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @EnderWannabe created at 2021-07-06 22:51:14

Pushed a change fixing the random QQbar issue, and fixing the signs.

I also added flattening and unflattening for the families with a parameter - those should work now.

There does seem to be a big bug in the code. This one is correct:

```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(R,1)
f=DynamicalSystem([x^2+c*y^2,y^2])
f.sigma_invariants(1,return_polynomial=True,chow=True)
w^3 + (-3)*w^2*t + 2*w^2 + 3*w*t^2 + (-4)*w*t + 4*c*w - t^3 + 2*t^2 + (-4*c)*t
```


But this fails:

```
R.<c>=QQ[]
P.<x,y>=ProjectiveSpace(FractionField(R),1)
f=DynamicalSystem([x^2+c*y^2,y^2])
f.sigma_invariants(1,return_polynomial=True, chow=True)
w - t
```

Not sure what is going on there.

As for putting the degrees in the first two coordinates, I did that so that the full form of the polynomial could be specified. I think the two degrees plus the list of coefficients with 0's is enough to fully specify the polynomial, so that doing a check of

```
f.sigma_invariants(1) == g.sigma_invariants(1)
```

actually tells us if f and g are not conjugate.


---

Comment by git created at 2021-07-07 16:34:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-07-07 16:37:30

Latest push should address all the comments except for the last.

I've been looking for the bug in

```
P.<x,y>=ProjectiveSpace(QQ,1)
f=DynamicalSystem([x^2+3*y^2,x*y])
f.sigma_invariants(1,return_polynomial=True, chow=True)
```


This map has a fixed point at infinity with multiplicity 3, which we try to account for in the second affine chart. However, it only shows up with multiplicity 1 in that affine chart. Not sure how to fix that.


---

Comment by bhutz created at 2021-07-08 15:00:28

I think this needs to be deformed as was done in the formal periodic points.

I see four cases

- all periodic points and multipliers are distinct (typical case): runs as normal
- all periodic points distinct, but multipliers not all distinct: chow method works
- periodic points not all distinct, all other multipliers distinct: deform and use normal method
- periodic points not all distinct and multipliers not all distinct: deform + chow method


---

Comment by git created at 2021-07-09 20:41:25

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @EnderWannabe created at 2021-07-09 20:41:42

Replying to [comment:14 bhutz]:
> I think this needs to be deformed as was done in the formal periodic points.

Deformation added, that example works now.


---

Comment by bhutz created at 2021-07-12 19:06:10

I know this is not marked as ready for review yet, but a quick comment.

The valueerror for degree counting only seems to occur for Formal=False.

Also the error should probably read '...and/or deform=True.'


---

Comment by git created at 2021-07-13 18:15:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-13 18:16:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-07-13 18:16:35

Replying to [comment:17 bhutz]:
> The valueerror for degree counting only seems to occur for Formal=False.

Added


---

Comment by @EnderWannabe created at 2021-07-15 15:02:42

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2021-07-15 15:43:17

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2021-07-15 15:43:17

The functionality is working correctly, but the documentation needs to be updated. The description is still the dimension 1 description.


---

Comment by git created at 2021-07-15 15:58:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-07-15 15:59:29

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2021-07-20 14:10:12

Please look over my doc changes. Otherwise I think we ready to mark this positive.
----
New commits:


---

Comment by @EnderWannabe created at 2021-07-20 16:39:05

Docs look good to me


---

Comment by @EnderWannabe created at 2021-07-20 16:39:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-25 18:51:47

Resolution: fixed


---

Comment by vbraun created at 2021-07-26 21:10:43

Random failure:

```
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 4021, in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points
Failed example:
    f.preperiodic_points(2, 1, R=K)
Expected:
    [(v : 1), (-v : 1)]
Got:
    [(-v : 1), (v : 1)]
**********************************************************************
1 item had failures:
   1 of  68 in sage.dynamics.arithmetic_dynamics.projective_ds.?.preperiodic_points
    [1406 tests, 1 failure, 49.93 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2021-07-26 21:10:43

Resolution changed from fixed to 


---

Comment by vbraun created at 2021-07-26 21:10:43

Changing status from closed to new.


---

Comment by @EnderWannabe created at 2021-07-27 14:27:05

Changing status from new to needs_review.


---

Comment by @EnderWannabe created at 2021-07-27 14:27:05

Added 2 lines to sort the list before returning to avoid such issues.
----
New commits:


---

Comment by bhutz created at 2021-07-27 15:16:57

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2021-08-03 18:23:02

need to merge in fix for doctest failure in #32322


---

Comment by bhutz created at 2021-08-03 18:23:02

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-08-09 20:10:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2021-08-09 20:10:43

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2021-08-13 15:48:18

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2021-08-13 15:48:18

I removed the duplicated import that pyflakes caught. Otherwise looks fine. Patchbot hasn't picked it up since the #32322 merge, but that ticket is now closed, so no issues there.
----
New commits:


---

Comment by vbraun created at 2021-10-19 20:31:00

Resolution: fixed
