# Issue 12196: Make "ratpoints" check whether -fnested-functions is supported by the compiler

Issue created by migration from https://trac.sagemath.org/ticket/12368

Original creator: jdemeyer

Original creation time: 2012-01-27 12:52:39

Assignee: tbd

On Darwin, ratpoints adds `-fnested-functions` (an Apple extension) to `$CFLAGS` causing failures when using gcc to compile.


---

Comment by jdemeyer created at 2012-01-27 13:01:02

Changing status from new to needs_review.


---

Comment by ohanar created at 2012-02-10 16:44:48

shouldn't you append `testflags.sh -fnested-functions` to CCFLAGS?


---

Comment by was created at 2012-02-13 15:22:12

Replying to [comment:2 ohanar]:
> shouldn't you append `testflags.sh -fnested-functions` to CCFLAGS?

I'm not sure.  However, if he did then he would be changing how the spkg-install scripts works from before.   It did not used to append to CCFLAGS -- it always wrote it from scratch.    So I think appending or not is orthogonal to refereeing this patch; it could be another ticket. 

My question is: what the heck is testcflags.sh?   It doesn't exist on my OS X 10.7 install, or in Sage-5.0x as far as I can tell, or in this spkg...  So I can't referee this package.


---

Comment by jdemeyer created at 2012-02-13 15:54:24

Replying to [comment:3 was]:
> My question is: what the heck is testcflags.sh?
See #12367 (a dependency of this ticket).

> It doesn't exist on my OS X 10.7 install
Did you look in `$SAGE_ROOT/spkg/bin`?


---

Comment by jdemeyer created at 2012-02-13 16:01:31

Diff for the ratpoints spkg, for review only


---

Attachment

Replying to [comment:3 was]:
> I'm not sure.  However, if he did then he would be changing how the spkg-install scripts works from before.   It did not used to append to CCFLAGS -- it always wrote it from scratch.
I agree with R. Andrew, so I'm copying `$CFLAGS` to `$CCFLAGS` in `spkg-install`.  Needs review.


---

Comment by ohanar created at 2012-02-13 16:36:29

Changing status from needs_review to positive_review.


---

Comment by ohanar created at 2012-02-13 16:36:29

Replying to [comment:3 was]:
> So I think appending or not is orthogonal to refereeing this patch; it could be another ticket.
Note that I did not mark it as needs work, I definitely agree that it is not necessary for refereeing this ticket.  I would have given it a positive review regardless (since it did what it was supposed to do), but since it is a trivial change that improves the build process, and since he was already touching the CCFLAGS variable, I figured it couldn't hurt to actually have the global CFLAGS respected.


---

Comment by was created at 2012-02-13 16:40:18

Replying to [comment:4 jdemeyer]:
> Replying to [comment:3 was]:
> > My question is: what the heck is testcflags.sh?
> See #12367 (a dependency of this ticket).
> 
> > It doesn't exist on my OS X 10.7 install
> Did you look in `$SAGE_ROOT/spkg/bin`?

Yes, but I guess sage-5.0.beta2 is too old.  I'll let somebody else referee this:

```
deep:~ wstein$ cd s/spkg/bin/
deep:bin wstein$ ls
json_bundle.py	sage-env	testcc.sh	text-collapse
sage		sage-spkg	testcxx.sh	text-expand
deep:bin wstein$ sage -version
Sage Version 5.0.beta2, Release Date: 2012-02-03
```



---

Comment by jdemeyer created at 2012-02-22 10:45:55

Resolution: fixed
