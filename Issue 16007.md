# Issue 16007: Simplify TestSuite's some_elements role and logic (no random sampling)

Issue created by migration from https://trac.sagemath.org/ticket/16244

Original creator: nthiery

Original creation time: 2014-04-26 18:45:34

CC:  mmezzarobba sage-combinat roed saraedum

Currently `TestSuite` (more precisely `InstanceTester.some_elements`) tries to be fancy by choosing "some elements" using a random sample. The random sample is built using Python's `random.sample`, which requires its input to be a Sequence (the i-th element can be fetched with o[i]), or some dict-like object. This can get brittle with other kinds of inputs where `__getitem__` is used for other purposes, or where unranking is just computationally expensive. The `some_elements` method also assumes `__len__` to be implemented and cheap enough.

Example:

```
FF = IntegerModRing(29)
tester = FF._tester()
list(tester.some_elements(CartesianProduct(FF, FF, FF)))
*bang*
```


In fact the following is close to fail, and just works because the error raised during the sample is caught.

```
tester.some_elements(FF)
```


This ticket reduces the role of `InstanceTester.some_elements` to just do some argument parsing and ensure that at most "max_run" elements are returned. It only requires the input to be iterable.

If we want to have fancy random samples, we should define a specific protocol (typically P.sample()) for it, or just let parents decide on the appropriate strategy by defining some_elements appropriately.

This was originaly analyzed in #15919.


---

Comment by nthiery created at 2014-04-26 21:32:41

Changing status from new to needs_review.


---

Comment by nthiery created at 2014-04-26 21:32:41

New commits:


---

Comment by tscrim created at 2014-04-28 14:55:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-04-28 14:55:02

LGTM (also with #15919).


---

Comment by vbraun created at 2014-05-12 19:32:52

Resolution: fixed


---

Comment by roed created at 2017-08-26 04:13:21

See #23724 for adding this back in (but optionally)
