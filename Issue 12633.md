# Issue 12633: Do not create SAGE_TESTDIR/tmp

Issue created by migration from https://trac.sagemath.org/ticket/12805

Original creator: jhpalmieri

Original creation time: 2012-04-03 21:03:30

Assignee: mvngu

CC:  leif

Keywords: sage-test SAGE_TESTDIR tmp

The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.


---

Attachment

scripts repo


---

Comment by jhpalmieri created at 2012-04-03 21:04:38

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-04-03 21:18:14

A few ways to test this:

 1. Remove the directory `DOT_SAGE/tmp`, and then doctest a single file: `./sage -t devel/sage/sage/tests/arxiv_0812_2725.py`. If you haven't applied the patch, then after testing has completed, you should see `DOT_SAGE/tmp` (which is `SAGE_TESTDIR`) but also `DOT_SAGE/tmp/tmp` (which is useless). After applying the patch, this last directory should not be present.
 2. Run `./sage -tp devel/sage/sage/tests/cmdline.py`. If you haven't applied the patch, you should see a message like

```
sage -t --long devel/sage/sage/tests/cmdline.py
	 [24.3 s]
 
----------------------------------------------------------------------
The temporary doctesting directory
   /Users/palmieri/.sage/tmp/jpalmieri538.math.washington.edu-92341
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.

----------------------------------------------------------------------
All tests passed!
Total time for all tests: 24.3 seconds
```

 If you have applied the patch, then you won't see the part about the directory not being empty.


---

Comment by leif created at 2012-04-03 22:05:32

Changing status from needs_review to positive_review.


---

Comment by leif created at 2012-04-03 22:05:32

Thanks, works as expected.


---

Comment by jdemeyer created at 2012-04-07 15:09:53

Resolution: fixed
