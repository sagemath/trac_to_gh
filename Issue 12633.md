# Issue 12633: Do not create SAGE_TESTDIR/tmp

archive/issues_012633.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @nexttime\n\nKeywords: sage-test SAGE_TESTDIR tmp\n\nThe script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12805\n\n",
    "created_at": "2012-04-03T21:03:30Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Do not create SAGE_TESTDIR/tmp",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12633",
    "user": "https://github.com/jhpalmieri"
}
```
Assignee: mvngu

CC:  @nexttime

Keywords: sage-test SAGE_TESTDIR tmp

The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.

Issue created by migration from https://trac.sagemath.org/ticket/12805





---

archive/issue_comments_150171.json:
```json
{
    "body": "Attachment [trac_12805-no-tmp.patch](tarball://root/attachments/some-uuid/ticket12805/trac_12805-no-tmp.patch) by @jhpalmieri created at 2012-04-03 21:03:58\n\nscripts repo",
    "created_at": "2012-04-03T21:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150171",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12805-no-tmp.patch](tarball://root/attachments/some-uuid/ticket12805/trac_12805-no-tmp.patch) by @jhpalmieri created at 2012-04-03 21:03:58

scripts repo



---

archive/issue_comments_150172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-03T21:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150172",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_150173.json:
```json
{
    "body": "A few ways to test this:\n\n1. Remove the directory `DOT_SAGE/tmp`, and then doctest a single file: `./sage -t devel/sage/sage/tests/arxiv_0812_2725.py`. If you haven't applied the patch, then after testing has completed, you should see `DOT_SAGE/tmp` (which is `SAGE_TESTDIR`) but also `DOT_SAGE/tmp/tmp` (which is useless). After applying the patch, this last directory should not be present.\n2. Run `./sage -tp devel/sage/sage/tests/cmdline.py`. If you haven't applied the patch, you should see a message like\n\n```\nsage -t --long devel/sage/sage/tests/cmdline.py\n\t [24.3 s]\n \n----------------------------------------------------------------------\nThe temporary doctesting directory\n   /Users/palmieri/.sage/tmp/jpalmieri538.math.washington.edu-92341\nwas not removed: it is not empty, presumably because doctests\nfailed or doctesting was interrupted.\n\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 24.3 seconds\n```\n\n If you have applied the patch, then you won't see the part about the directory not being empty.",
    "created_at": "2012-04-03T21:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150173",
    "user": "https://github.com/jhpalmieri"
}
```

A few ways to test this:

1. Remove the directory `DOT_SAGE/tmp`, and then doctest a single file: `./sage -t devel/sage/sage/tests/arxiv_0812_2725.py`. If you haven't applied the patch, then after testing has completed, you should see `DOT_SAGE/tmp` (which is `SAGE_TESTDIR`) but also `DOT_SAGE/tmp/tmp` (which is useless). After applying the patch, this last directory should not be present.
2. Run `./sage -tp devel/sage/sage/tests/cmdline.py`. If you haven't applied the patch, you should see a message like

```
sage -t --long devel/sage/sage/tests/cmdline.py
	 [24.3 s]
 
----------------------------------------------------------------------
The temporary doctesting directory
   /Users/palmieri/.sage/tmp/jpalmieri538.math.washington.edu-92341
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.

----------------------------------------------------------------------
All tests passed!
Total time for all tests: 24.3 seconds
```

 If you have applied the patch, then you won't see the part about the directory not being empty.



---

archive/issue_comments_150174.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150174",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_150175.json:
```json
{
    "body": "Thanks, works as expected.",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150175",
    "user": "https://github.com/nexttime"
}
```

Thanks, works as expected.



---

archive/issue_events_012611.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-04-07T15:09:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12633#event-12611"
}
```



---

archive/issue_comments_150176.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-07T15:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12633",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12633#issuecomment-150176",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
