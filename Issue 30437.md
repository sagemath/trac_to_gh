# Issue 30437: Patch tornado so it can be imported in Python without an ssl module

Issue created by migration from https://trac.sagemath.org/ticket/30674

Original creator: mkoeppe

Original creation time: 2020-09-27 21:45:16

CC:  @mwageringel slelievre

(from #30556)


---

Comment by mkoeppe created at 2020-09-27 21:48:58

New commits:


---

Comment by mkoeppe created at 2020-09-27 21:48:58

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-09-28 06:51:41

Changing status from needs_review to needs_work.


---

Comment by @mwageringel created at 2020-09-28 06:51:41

The patch does not apply. Apparently the upstream sources have CRLF line endings.

```
[tornado-6.0.4.p0] Applying ../patches/0001-tornado-httpserver.py-import-ssl-only-when-TYPE_CHEC.patch
[tornado-6.0.4.p0] patching file tornado/httpserver.py
[tornado-6.0.4.p0] Hunk #1 FAILED at 26 (different line endings).
[tornado-6.0.4.p0] Hunk #2 FAILED at 41 (different line endings).
[tornado-6.0.4.p0] Hunk #3 FAILED at 157 (different line endings).
```

There is also at least one more use of ssl in [tornado/httputil.py](https://github.com/mkoeppe/tornado/blob/b362dae6f8e5123e30c6600f08dc6d061f57aecf/tornado/httputil.py#L469).


---

Comment by git created at 2020-09-28 15:50:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-28 16:28:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-09-28 16:29:06

Try this version please


---

Comment by @mwageringel created at 2020-09-28 19:02:19

This version applies, but Jupyter does not start yet, as there are more uses of ssl. I have tried to patch `tornado/httputil.py` and `tornado/iostream.py`, but now the various uses of ssl in `tornado/netutil.py` need workarounds. I am not sure if this is a direction we want to dive into.

```
Traceback (most recent call last):
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/sage/repl/ipython_kernel/install.py", line 307, in have_prerequisites
    from notebook.notebookapp import NotebookApp
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/notebook/notebookapp.py", line 66, in <module>
    from tornado import httpserver
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/tornado/httpserver.py", line 31, in <module>
    from tornado.http1connection import HTTP1ServerConnection, HTTP1ConnectionParameters
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/tornado/http1connection.py", line 34, in <module>
    from tornado import iostream
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/tornado/iostream.py", line 39, in <module>
    from tornado.netutil import ssl_wrap_socket, _client_ssl_defaults, _server_ssl_defaults
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/site-packages/tornado/netutil.py", line 23, in <module>
    import ssl
  File "/amd/compute/mwagerin/git/sage_compute/local/lib/python3.8/ssl.py", line 98, in <module>
    import _ssl             # if we can't import it, let the error propagate
ModuleNotFoundError: No module named '_ssl'
```

----
New commits:


---

Comment by @mwageringel created at 2020-10-03 22:10:27

Changing status from needs_work to needs_info.


---

Comment by mkoeppe created at 2021-03-09 00:22:23

Changing priority from critical to major.


---

Comment by mkoeppe created at 2021-08-13 04:04:05

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2021-08-13 04:04:05

Outdated; with #29291 we just require ssl.


---

Comment by slelievre created at 2021-08-21 15:02:49

Markus, if you agree, remove branch, add yourself
as reviewer and set to positive review.


---

Comment by mkoeppe created at 2021-08-21 18:12:33

I don't think branches should or need to be removed when closing a ticket


---

Comment by slelievre created at 2021-08-22 00:55:31

Good point. I agree.


---

Comment by @mwageringel created at 2021-09-05 08:36:40

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-10 04:50:10

Resolution: invalid
