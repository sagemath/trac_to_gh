# Issue 12475: Add support for a "sagerc" script

archive/issues_012475.json:
```json
{
    "body": "Assignee: @nexttime\n\nThis deals with adding support for a file\n\n```\n$DOT_SAGE/sagerc\n```\nwhich will be sourced after `sage-env`, so it can be used to override the environment variables used in Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12647\n\n",
    "created_at": "2012-03-09T20:50:44Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Add support for a \"sagerc\" script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12475",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: @nexttime

This deals with adding support for a file

```
$DOT_SAGE/sagerc
```
which will be sourced after `sage-env`, so it can be used to override the environment variables used in Sage.

Issue created by migration from https://trac.sagemath.org/ticket/12647





---

archive/issue_comments_147436.json:
```json
{
    "body": "This still needs a documentation patch.",
    "created_at": "2012-03-09T21:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147436",
    "user": "https://github.com/jdemeyer"
}
```

This still needs a documentation patch.



---

archive/issue_comments_147437.json:
```json
{
    "body": "Where do you suggest adding documentation? The reference manual ([here](http://sagemath.org/doc/reference/options.html) or [here](http://sagemath.org/doc/reference/environ.html), perhaps)? The top-level README.txt?",
    "created_at": "2012-03-12T20:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147437",
    "user": "https://github.com/jhpalmieri"
}
```

Where do you suggest adding documentation? The reference manual ([here](http://sagemath.org/doc/reference/options.html) or [here](http://sagemath.org/doc/reference/environ.html), perhaps)? The top-level README.txt?



---

archive/issue_comments_147438.json:
```json
{
    "body": "Attachment [12647_sagerc_doc.patch](tarball://root/attachments/some-uuid/ticket12647/12647_sagerc_doc.patch) by @jdemeyer created at 2012-03-13 16:54:51",
    "created_at": "2012-03-13T16:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147438",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12647_sagerc_doc.patch](tarball://root/attachments/some-uuid/ticket12647/12647_sagerc_doc.patch) by @jdemeyer created at 2012-03-13 16:54:51



---

archive/issue_comments_147439.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-13T17:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147439",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_147440.json:
```json
{
    "body": "Replying to [comment:2 jhpalmieri]:\n> Where do you suggest adding documentation? The reference manual ([here](http://sagemath.org/doc/reference/options.html) or [here](http://sagemath.org/doc/reference/environ.html), perhaps)? The top-level README.txt?\n\n\nI created a new file in the reference manual mentioning `sagerc` and `init.sage`.",
    "created_at": "2012-03-13T17:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147440",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 jhpalmieri]:
> Where do you suggest adding documentation? The reference manual ([here](http://sagemath.org/doc/reference/options.html) or [here](http://sagemath.org/doc/reference/environ.html), perhaps)? The top-level README.txt?


I created a new file in the reference manual mentioning `sagerc` and `init.sage`.



---

archive/issue_comments_147441.json:
```json
{
    "body": "In a line like\n\n```sh\nif [ \"$SAGE_RC_FILE\" = \"\" ]; then\n```\nis there any advantage to replacing the test with `[ -z \"$SAGE_RC_FILE\" ]`? (I guess you did it the way you did for consistency with other parts of the script?)\n\nSee the review patch for two minor changes to the documentation.\n\nOtherwise, positive review.",
    "created_at": "2012-03-14T18:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147441",
    "user": "https://github.com/jhpalmieri"
}
```

In a line like

```sh
if [ "$SAGE_RC_FILE" = "" ]; then
```
is there any advantage to replacing the test with `[ -z "$SAGE_RC_FILE" ]`? (I guess you did it the way you did for consistency with other parts of the script?)

See the review patch for two minor changes to the documentation.

Otherwise, positive review.



---

archive/issue_comments_147442.json:
```json
{
    "body": "Attachment [trac_12647-review.patch](tarball://root/attachments/some-uuid/ticket12647/trac_12647-review.patch) by @jhpalmieri created at 2012-03-14 18:57:25",
    "created_at": "2012-03-14T18:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147442",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12647-review.patch](tarball://root/attachments/some-uuid/ticket12647/trac_12647-review.patch) by @jhpalmieri created at 2012-03-14 18:57:25



---

archive/issue_comments_147443.json:
```json
{
    "body": "(The \"review patch\" needs review.)",
    "created_at": "2012-03-14T18:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147443",
    "user": "https://github.com/jhpalmieri"
}
```

(The "review patch" needs review.)



---

archive/issue_comments_147444.json:
```json
{
    "body": "Replying to [comment:5 jhpalmieri]:\n> In a line like\n> \n> ```\n> #!sh\n> if [ \"$SAGE_RC_FILE\" = \"\" ]; then\n> ```\n> is there any advantage to replacing the test with `[ -z \"$SAGE_RC_FILE\" ]`?\n\nAs far as I know, these two tests are identical.  But I changed it to use `-z`.\n\nReview patch is obviously fine.",
    "created_at": "2012-03-14T19:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147444",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 jhpalmieri]:
> In a line like
> 
> ```
> #!sh
> if [ "$SAGE_RC_FILE" = "" ]; then
> ```
> is there any advantage to replacing the test with `[ -z "$SAGE_RC_FILE" ]`?

As far as I know, these two tests are identical.  But I changed it to use `-z`.

Review patch is obviously fine.



---

archive/issue_comments_147445.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-14T19:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147445",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_147446.json:
```json
{
    "body": "How about adding a commented template rc file, with examples for `CC`, `CFLAGS`, `MAKE` (e.g. conditionally, depending on the hostname), `SAGE_BROWSER`, `SAGE_ATLAS_LIB` etc.?\n\nMaybe on a follow-up ticket?\n\n\n(Unfortunately I meanwhile forgot most of what I had in mind... :-/ )",
    "created_at": "2012-03-16T11:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147446",
    "user": "https://github.com/nexttime"
}
```

How about adding a commented template rc file, with examples for `CC`, `CFLAGS`, `MAKE` (e.g. conditionally, depending on the hostname), `SAGE_BROWSER`, `SAGE_ATLAS_LIB` etc.?

Maybe on a follow-up ticket?


(Unfortunately I meanwhile forgot most of what I had in mind... :-/ )



---

archive/issue_comments_147447.json:
```json
{
    "body": "Minor flaw:\n\n```sh\n        echo >&2 \"Error sourcing $DOT_SAGE/sagerc\"\n```\nshould read\n\n```sh\n        echo >&2 \"Error sourcing $SAGE_RC_FILE\"\n```\n\nAFAIK `.` is more portable than `source`; does Bash 2.04 support the latter?",
    "created_at": "2012-03-16T12:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147447",
    "user": "https://github.com/nexttime"
}
```

Minor flaw:

```sh
        echo >&2 "Error sourcing $DOT_SAGE/sagerc"
```
should read

```sh
        echo >&2 "Error sourcing $SAGE_RC_FILE"
```

AFAIK `.` is more portable than `source`; does Bash 2.04 support the latter?



---

archive/issue_comments_147448.json:
```json
{
    "body": "Replying to [comment:9 leif]:\n> AFAIK `.` is more portable than `source`; does Bash 2.04 support the latter?\n\n\n```\nGNU bash, version 2.05b.0(1)-release (powerpc-apple-darwin8.0)\nCopyright (C) 2002 Free Software Foundation, Inc.\n```\ndoes support `.` and `source`.",
    "created_at": "2012-03-16T12:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147448",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:9 leif]:
> AFAIK `.` is more portable than `source`; does Bash 2.04 support the latter?


```
GNU bash, version 2.05b.0(1)-release (powerpc-apple-darwin8.0)
Copyright (C) 2002 Free Software Foundation, Inc.
```
does support `.` and `source`.



---

archive/issue_comments_147449.json:
```json
{
    "body": "Setting `MAKE` in `sagerc` is a bad idea by the way: currently, `sage-env` is **not** sourced by `spkg/install` which runs the top-level `$MAKE`.  So, setting `MAKE=make -j4` in `sagerc` would only build individual packages in parallel, it would not build multiple packages concurrently.\n\nFixed the minor flaw, thanks for that.",
    "created_at": "2012-03-16T12:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147449",
    "user": "https://github.com/jdemeyer"
}
```

Setting `MAKE` in `sagerc` is a bad idea by the way: currently, `sage-env` is **not** sourced by `spkg/install` which runs the top-level `$MAKE`.  So, setting `MAKE=make -j4` in `sagerc` would only build individual packages in parallel, it would not build multiple packages concurrently.

Fixed the minor flaw, thanks for that.



---

archive/issue_comments_147450.json:
```json
{
    "body": "Attachment [12647_sagerc.patch](tarball://root/attachments/some-uuid/ticket12647/12647_sagerc.patch) by @ppurka created at 2012-03-16 17:17:25\n\nIn some other ticket there were some concerns raised about the non-portability of `x\\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\\{1,\\}`.",
    "created_at": "2012-03-16T17:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147450",
    "user": "https://github.com/ppurka"
}
```

Attachment [12647_sagerc.patch](tarball://root/attachments/some-uuid/ticket12647/12647_sagerc.patch) by @ppurka created at 2012-03-16 17:17:25

In some other ticket there were some concerns raised about the non-portability of `x\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\{1,\}`.



---

archive/issue_comments_147451.json:
```json
{
    "body": "Replying to [comment:12 ppurka]:\n> In some other ticket there were some concerns raised about the non-portability of `x\\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\\{1,\\}`.\n\nPresumably, the `sed` on Cygwin (which is all that matters for this) does support `\\+`.  I know the OS X 10.4 `sed` does not support `\\+`.",
    "created_at": "2012-03-17T12:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147451",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 ppurka]:
> In some other ticket there were some concerns raised about the non-portability of `x\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\{1,\}`.

Presumably, the `sed` on Cygwin (which is all that matters for this) does support `\+`.  I know the OS X 10.4 `sed` does not support `\+`.



---

archive/issue_comments_147452.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:12 ppurka]:\n> > In some other ticket there were some concerns raised about the non-portability of `x\\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\\{1,\\}`.\n\n> Presumably, the `sed` on Cygwin (which is all that matters for this) does support `\\+`.  I know the OS X 10.4 `sed` does not support `\\+`.\n\nSun's \"default\" `sed` (not the one in `/usr/xpg*/bin/`) doesn't either IIRC.\n\nProbably even the XPG one doesn't; I don't recall.  It at least used to be a GNU extension.",
    "created_at": "2012-03-17T15:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147452",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:12 ppurka]:
> > In some other ticket there were some concerns raised about the non-portability of `x\+` in sed. Can't remember which ticket it was. The portable solutions were either `xx*` or `x\{1,\}`.

> Presumably, the `sed` on Cygwin (which is all that matters for this) does support `\+`.  I know the OS X 10.4 `sed` does not support `\+`.

Sun's "default" `sed` (not the one in `/usr/xpg*/bin/`) doesn't either IIRC.

Probably even the XPG one doesn't; I don't recall.  It at least used to be a GNU extension.



---

archive/issue_comments_147453.json:
```json
{
    "body": "Regarding the use of sed here, this script is used every time Sage is run, and it hasn't caused any problems on any platform, presumably because (as Jeroen points out) this part only matters on Cygwin.  So I don't see any need to change anything.",
    "created_at": "2012-03-17T15:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147453",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding the use of sed here, this script is used every time Sage is run, and it hasn't caused any problems on any platform, presumably because (as Jeroen points out) this part only matters on Cygwin.  So I don't see any need to change anything.



---

archive/issue_comments_147454.json:
```json
{
    "body": "Replying to [comment:15 jhpalmieri]:\n> Regarding the use of sed here, this script is used every time Sage is run, and it hasn't caused any problems on any platform, presumably because (as Jeroen points out) this part only matters on Cygwin.  So I don't see any need to change anything.\n\n\nOh, I thought this discussion was unrelated to the ticket anyway... 8)\n\nBut now I see it is on topic...\nIn this case, `s/WIN.*/WIN/` would work as well by the way, and there shouldn't be two invocations of `uname`.  (And using the shell-builtin pattern matching, `case ... in ...`, would be faster and safer / more portable anyway.)\n\nBut never mind...",
    "created_at": "2012-03-17T16:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147454",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 jhpalmieri]:
> Regarding the use of sed here, this script is used every time Sage is run, and it hasn't caused any problems on any platform, presumably because (as Jeroen points out) this part only matters on Cygwin.  So I don't see any need to change anything.


Oh, I thought this discussion was unrelated to the ticket anyway... 8)

But now I see it is on topic...
In this case, `s/WIN.*/WIN/` would work as well by the way, and there shouldn't be two invocations of `uname`.  (And using the shell-builtin pattern matching, `case ... in ...`, would be faster and safer / more portable anyway.)

But never mind...



---

archive/issue_comments_147455.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> Setting `MAKE` in `sagerc` is a bad idea by the way: currently, `sage-env` is **not** sourced by `spkg/install` which runs the top-level `$MAKE`.  So, setting `MAKE=make -j4` in `sagerc` would only build individual packages in parallel, it would not build multiple packages concurrently.\n\n\nI see.  I was pretty sure we'd source `sage-env` (at least) in the `build` rule (of course on the same line we call `spkg/install`) of the top-level Makefile (`$SAGE_ROOT/Makefile`).\n\nWe could of course implement `./sage --make ...` :-)\n\n(But perhaps the easiest way is to make `make` an alias to a script that behaves differently in case the current directory is the root of a Sage installation, and just calls `make` otherwise.)",
    "created_at": "2012-03-17T23:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147455",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:11 jdemeyer]:
> Setting `MAKE` in `sagerc` is a bad idea by the way: currently, `sage-env` is **not** sourced by `spkg/install` which runs the top-level `$MAKE`.  So, setting `MAKE=make -j4` in `sagerc` would only build individual packages in parallel, it would not build multiple packages concurrently.


I see.  I was pretty sure we'd source `sage-env` (at least) in the `build` rule (of course on the same line we call `spkg/install`) of the top-level Makefile (`$SAGE_ROOT/Makefile`).

We could of course implement `./sage --make ...` :-)

(But perhaps the easiest way is to make `make` an alias to a script that behaves differently in case the current directory is the root of a Sage installation, and just calls `make` otherwise.)



---

archive/issue_comments_147456.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147456",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_034259.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:08:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12475#event-34259"
}
```



---

archive/issue_comments_147457.json:
```json
{
    "body": "The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).",
    "created_at": "2012-04-14T01:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147457",
    "user": "https://github.com/nexttime"
}
```

The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).



---

archive/issue_comments_147458.json:
```json
{
    "body": "Replying to [comment:19 leif]:\n> The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).\n\n\nCan you explain that? I thought that first sage-env was run, then spkg-install was run (via sage-spkg). So how can exporting (an empty) `CFLAGS` in sage-env help if that variable is later modified in spkg-install?",
    "created_at": "2012-04-14T01:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147458",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:19 leif]:
> The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).


Can you explain that? I thought that first sage-env was run, then spkg-install was run (via sage-spkg). So how can exporting (an empty) `CFLAGS` in sage-env help if that variable is later modified in spkg-install?



---

archive/issue_comments_147459.json:
```json
{
    "body": "Replying to [comment:19 leif]:\n> The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).\n\n\n... or probably not (it's late).\n\nActually any `spkg-install` modifying `CFLAGS` should export them (at least if they've been empty / unset) ...",
    "created_at": "2012-04-14T02:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147459",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:19 leif]:
> The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).


... or probably not (it's late).

Actually any `spkg-install` modifying `CFLAGS` should export them (at least if they've been empty / unset) ...



---

archive/issue_comments_147460.json:
```json
{
    "body": "Replying to [comment:20 jhpalmieri]:\n> Replying to [comment:19 leif]:\n> > The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).\n\n> \n> Can you explain that? I thought that first sage-env was run, then spkg-install was run (via sage-spkg). So how can exporting (an empty) `CFLAGS` in sage-env help if that variable is later modified in spkg-install?\n\n\nIt would have helped only if `CFLAGS` were (e.g.) set to `\"\"` as well (if they had been empty or unset before), which on the other hand would currently break building the Sage library, which needs `-fno-strict-aliasing`, which [also] comes from Python's `CFLAGS`, but only if `CFLAGS` are **not** set to `\"\"`, i.e., not set / exported at all.",
    "created_at": "2012-04-14T02:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147460",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 jhpalmieri]:
> Replying to [comment:19 leif]:
> > The patch to `sage-env` causes a beta9 regression since `CFLAGS` are now no longer exported, which at least some spkgs relied on (i.e., their `spkg-install` sets or modifies them, but doesn't export them by itself since this used to be redundant).

> 
> Can you explain that? I thought that first sage-env was run, then spkg-install was run (via sage-spkg). So how can exporting (an empty) `CFLAGS` in sage-env help if that variable is later modified in spkg-install?


It would have helped only if `CFLAGS` were (e.g.) set to `""` as well (if they had been empty or unset before), which on the other hand would currently break building the Sage library, which needs `-fno-strict-aliasing`, which [also] comes from Python's `CFLAGS`, but only if `CFLAGS` are **not** set to `""`, i.e., not set / exported at all.



---

archive/issue_comments_147461.json:
```json
{
    "body": "Exporting a variable which you don't set has no effect.  Since `CFLAGS` wasn't (and still isn't) set in `sage-env`, the `export` did nothing.\n\nExample (GNU bash version 4.0.35(1)-release if it matters):\n\n```\njdemeyer@arcanis:~$ ( export FOO; env ) | grep FOO\njdemeyer@arcanis:~$ ( export FOO; FOO=; env ) | grep FOO\nFOO=\n```",
    "created_at": "2012-04-14T08:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147461",
    "user": "https://github.com/jdemeyer"
}
```

Exporting a variable which you don't set has no effect.  Since `CFLAGS` wasn't (and still isn't) set in `sage-env`, the `export` did nothing.

Example (GNU bash version 4.0.35(1)-release if it matters):

```
jdemeyer@arcanis:~$ ( export FOO; env ) | grep FOO
jdemeyer@arcanis:~$ ( export FOO; FOO=; env ) | grep FOO
FOO=
```



---

archive/issue_comments_147462.json:
```json
{
    "body": "Replying to [comment:23 jdemeyer]:\n> Exporting a variable which you don't set has no effect.  Since `CFLAGS` wasn't (and still isn't) set in `sage-env`, the `export` did nothing.\n> \n> Example (GNU bash version 4.0.35(1)-release if it matters):\n> \n> ```\n> jdemeyer@arcanis:~$ ( export FOO; env ) | grep FOO\n> jdemeyer@arcanis:~$ ( export FOO; FOO=; env ) | grep FOO\n> FOO=\n> ```\n\n\nOf course.  But we [still] have things like\n\n```sh\nif [ \"$LDFLAGS\" = \"\" ]; then\n    LDFLAGS=\"\"          && export LDFLAGS\nfi\n\n\nif [ \"$CXXFLAGS\" = \"\" ]; then\n    export CXXFLAGS=\"$CFLAGS\"\nfi\n```\nin `sage-env`, which will **always** cause `LDFLAGS` and `CXXFLAGS` to be exported, no matter whether they've previously been unset, or exported empty.  So currently (re)exporting these in e.g. `spkg-install` scripts is indeed redundant.\n\nI think we should either do that there for all such variables, or none of them.  Especially setting `CXXFLAGS` to `$CFLAGS` even if a user did `export CXXFLAGS=\"\"` may have somewhat surprising effects, or is (I think) at least unexpected behaviour.",
    "created_at": "2012-04-14T11:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12475#issuecomment-147462",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:23 jdemeyer]:
> Exporting a variable which you don't set has no effect.  Since `CFLAGS` wasn't (and still isn't) set in `sage-env`, the `export` did nothing.
> 
> Example (GNU bash version 4.0.35(1)-release if it matters):
> 
> ```
> jdemeyer@arcanis:~$ ( export FOO; env ) | grep FOO
> jdemeyer@arcanis:~$ ( export FOO; FOO=; env ) | grep FOO
> FOO=
> ```


Of course.  But we [still] have things like

```sh
if [ "$LDFLAGS" = "" ]; then
    LDFLAGS=""          && export LDFLAGS
fi


if [ "$CXXFLAGS" = "" ]; then
    export CXXFLAGS="$CFLAGS"
fi
```
in `sage-env`, which will **always** cause `LDFLAGS` and `CXXFLAGS` to be exported, no matter whether they've previously been unset, or exported empty.  So currently (re)exporting these in e.g. `spkg-install` scripts is indeed redundant.

I think we should either do that there for all such variables, or none of them.  Especially setting `CXXFLAGS` to `$CFLAGS` even if a user did `export CXXFLAGS=""` may have somewhat surprising effects, or is (I think) at least unexpected behaviour.
