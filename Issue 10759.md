# Issue 10759: Make gap support SAGE_SPKG_INSTALL_DOCS

archive/issues_010759.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  wdjoyner@gmail.com sal@dcs.st-and.ac.uk\n\nThis ticket implements #10823 for gap. New spkg at \u00a0http://sage.math.washington.edu/home/jason/gap-4.4.12.p5.spkg\n\nIssue created by migration from https://trac.sagemath.org/ticket/10825\n\n",
    "created_at": "2011-02-23T01:54:19Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Make gap support SAGE_SPKG_INSTALL_DOCS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10759",
    "user": "jason"
}
```
Assignee: tbd

CC:  wdjoyner@gmail.com sal@dcs.st-and.ac.uk

This ticket implements #10823 for gap. New spkg at Â http://sage.math.washington.edu/home/jason/gap-4.4.12.p5.spkg

Issue created by migration from https://trac.sagemath.org/ticket/10825





---

archive/issue_comments_113735.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-23T01:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113735",
    "user": "jason"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113736.json:
```json
{
    "body": "See comments on #10828",
    "created_at": "2011-03-01T15:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113736",
    "user": "drkirkby"
}
```

See comments on #10828



---

archive/issue_comments_113737.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-01T15:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113737",
    "user": "drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113738.json:
```json
{
    "body": "New spkg up which should take care of David's points.",
    "created_at": "2011-03-01T18:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113738",
    "user": "jason"
}
```

New spkg up which should take care of David's points.



---

archive/issue_comments_113739.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-01T18:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113739",
    "user": "jason"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113740.json:
```json
{
    "body": "Attachment [10825.patch](tarball://root/attachments/some-uuid/ticket10825/10825.patch) by jason created at 2011-03-01 18:20:16\n\nFYI Only---already applied to spkg.",
    "created_at": "2011-03-01T18:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113740",
    "user": "jason"
}
```

Attachment [10825.patch](tarball://root/attachments/some-uuid/ticket10825/10825.patch) by jason created at 2011-03-01 18:20:16

FYI Only---already applied to spkg.



---

archive/issue_comments_113741.json:
```json
{
    "body": "I'm not in a position to check this now, but it would help if you could add the patch to the ticket, as not only does it making reviewing it much easier, but it is useful for others to quickly look at what changes were made. \n\nDave",
    "created_at": "2011-03-01T18:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113741",
    "user": "drkirkby"
}
```

I'm not in a position to check this now, but it would help if you could add the patch to the ticket, as not only does it making reviewing it much easier, but it is useful for others to quickly look at what changes were made. 

Dave



---

archive/issue_comments_113742.json:
```json
{
    "body": "Yep, there's a patch attached to the ticket now (for this and the other spkg tickets, as I finish them).",
    "created_at": "2011-03-01T18:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113742",
    "user": "jason"
}
```

Yep, there's a patch attached to the ticket now (for this and the other spkg tickets, as I finish them).



---

archive/issue_comments_113743.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-02T09:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113743",
    "user": "drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113744.json:
```json
{
    "body": "The GAP change is implemented fine, so positive review. \n\nHowever, the syntax of the HTML in GAP's documentation is incorrect. I just looked in index.htm and this immediately struck me:\n\n\n```\n<OL>\n  <LI><A HREF=\"tut/chapters.htm\">Tutorial</A>\n  <LI><A HREF=\"ref/chapters.htm\">Reference Manual</A>\n  <LI><A HREF=\"prg/chapters.htm\">Programming Tutorial</A>\n  <LI><A HREF=\"ext/chapters.htm\">Programming Reference Manual</A>\n  <LI><A HREF=\"new/chapters.htm\">New Features for Developers</A>\n</OL>\n```\n\n\nThere should be a `</LI>` on the end of list items, so the first would be:\n\n\n```\n  <LI><A HREF=\"tut/chapters.htm\">Tutorial</A></LI>\n```\n\n\nbut all 5 are missing, but that's obviously an upstream problem, so I have cc'ed the two people listed as the upstream contacts for GAP",
    "created_at": "2011-03-02T09:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113744",
    "user": "drkirkby"
}
```

The GAP change is implemented fine, so positive review. 

However, the syntax of the HTML in GAP's documentation is incorrect. I just looked in index.htm and this immediately struck me:


```
<OL>
  <LI><A HREF="tut/chapters.htm">Tutorial</A>
  <LI><A HREF="ref/chapters.htm">Reference Manual</A>
  <LI><A HREF="prg/chapters.htm">Programming Tutorial</A>
  <LI><A HREF="ext/chapters.htm">Programming Reference Manual</A>
  <LI><A HREF="new/chapters.htm">New Features for Developers</A>
</OL>
```


There should be a `</LI>` on the end of list items, so the first would be:


```
  <LI><A HREF="tut/chapters.htm">Tutorial</A></LI>
```


but all 5 are missing, but that's obviously an upstream problem, so I have cc'ed the two people listed as the upstream contacts for GAP



---

archive/issue_comments_113745.json:
```json
{
    "body": "I agree with you on all accounts.",
    "created_at": "2011-03-02T14:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113745",
    "user": "jason"
}
```

I agree with you on all accounts.



---

archive/issue_comments_113746.json:
```json
{
    "body": "From Steve Linton: \"Thanks for the info. The documentation mechanisms are changing completely in the next release, and we\nwill make sure they produce valid HTML.\n\n       Steve\"",
    "created_at": "2011-03-02T22:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113746",
    "user": "was"
}
```

From Steve Linton: "Thanks for the info. The documentation mechanisms are changing completely in the next release, and we
will make sure they produce valid HTML.

       Steve"



---

archive/issue_comments_113747.json:
```json
{
    "body": "Replying to [comment:8 was]:\n> From Steve Linton: \"Thanks for the info. The documentation mechanisms are changing completely in the next release, and we\n> will make sure they produce valid HTML.\n> \n>        Steve\"\n\nThank you Steve for the prompt reply, and for William for forwarding it to trac. \n\nDave",
    "created_at": "2011-03-02T22:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113747",
    "user": "drkirkby"
}
```

Replying to [comment:8 was]:
> From Steve Linton: "Thanks for the info. The documentation mechanisms are changing completely in the next release, and we
> will make sure they produce valid HTML.
> 
>        Steve"

Thank you Steve for the prompt reply, and for William for forwarding it to trac. 

Dave



---

archive/issue_comments_113748.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-08T21:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113748",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_113749.json:
```json
{
    "body": "Replying to [comment:6 drkirkby]:\n> The GAP change is implemented fine, so positive review. \n> \n> However, the syntax of the HTML in GAP's documentation is incorrect. I just looked in index.htm and this immediately struck me:\n> \n> {{{\n> <OL>\n>   <LI><A HREF=\"tut/chapters.htm\">Tutorial</A>\n>   <LI><A HREF=\"ref/chapters.htm\">Reference Manual</A>\n>   <LI><A HREF=\"prg/chapters.htm\">Programming Tutorial</A>\n>   <LI><A HREF=\"ext/chapters.htm\">Programming Reference Manual</A>\n>   <LI><A HREF=\"new/chapters.htm\">New Features for Developers</A>\n> </OL>\n> }}}\n\nThis is actually **correct** HTML, the `</LI>` end tags are optional.  So it's not a bug, even if the developers acknowledge it.",
    "created_at": "2011-03-08T21:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113749",
    "user": "jdemeyer"
}
```

Replying to [comment:6 drkirkby]:
> The GAP change is implemented fine, so positive review. 
> 
> However, the syntax of the HTML in GAP's documentation is incorrect. I just looked in index.htm and this immediately struck me:
> 
> {{{
> <OL>
>   <LI><A HREF="tut/chapters.htm">Tutorial</A>
>   <LI><A HREF="ref/chapters.htm">Reference Manual</A>
>   <LI><A HREF="prg/chapters.htm">Programming Tutorial</A>
>   <LI><A HREF="ext/chapters.htm">Programming Reference Manual</A>
>   <LI><A HREF="new/chapters.htm">New Features for Developers</A>
> </OL>
> }}}

This is actually **correct** HTML, the `</LI>` end tags are optional.  So it's not a bug, even if the developers acknowledge it.



---

archive/issue_comments_113750.json:
```json
{
    "body": "See also [the W3C validator](http://validator.w3.org/check?uri=http%3A%2F%2Fwww.gap-system.org%2FManuals%2Fdoc%2Fhtm%2Findex.htm&charset=%28detect+automatically%29&doctype=Inline&group=0).  There is an error for a misplaced `</P>` but it doesn't complain about the missing `</LI>`s.",
    "created_at": "2011-03-08T21:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113750",
    "user": "jdemeyer"
}
```

See also [the W3C validator](http://validator.w3.org/check?uri=http%3A%2F%2Fwww.gap-system.org%2FManuals%2Fdoc%2Fhtm%2Findex.htm&charset=%28detect+automatically%29&doctype=Inline&group=0).  There is an error for a misplaced `</P>` but it doesn't complain about the missing `</LI>`s.



---

archive/issue_comments_113751.json:
```json
{
    "body": "huh.  Thanks for the info.  One more reason to like xhtml more than html, I guess!",
    "created_at": "2011-03-08T22:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113751",
    "user": "jason"
}
```

huh.  Thanks for the info.  One more reason to like xhtml more than html, I guess!



---

archive/issue_comments_113752.json:
```json
{
    "body": "I'm not sure what the following is supposed to do (or mean):\n\n```sh\n    # Build and install docs if requested\n    if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n        if [ $? -ne 0 ]; then\n            echo \"Error building gap docs.\"\n            exit 1\n        fi\n        mkdir -p $SAGE_ROOT/local/share/doc/gap\n        cp -r src/doc/htm $SAGE_ROOT/local/share/doc/gap/html\n    fi\n```\n\nEither there's a command missing to **build** the documentation, or we don't have to build it, in which case testing `$?` there is useless, since previous errors are catched above that block.  (On the other hand, whether the creation of the directory and the copy command succeeded isn't checked at all, so maybe the `if`-block was supposed to be *below* the `cp`.)\n\nI've currently changed this to\n\n```sh\n    # Build and install docs if requested:\n    if [[ \"$SAGE_SPKG_INSTALL_DOCS\" = yes ]]; then\n        # ?????\n        if [[ $? -ne 0 ]]; then\n            echo \"Error building GAP docs.\"\n            exit 1\n        fi\n        mkdir -p \"$SAGE_LOCAL\"/share/doc/gap &&\n        cp -r src/doc/htm \"$SAGE_LOCAL\"/share/doc/gap/html\n        if [[ $? -ne 0 ]]; then\n            echo >&2 \"Error copying GAP's HTML documentation.\"\n            exit 1\n        fi\n    fi\n```\n\n\nBtw., the description in `SPKG.txt` (still) says the docs (as well as tests, which seem to be there again, too) have been removed from the spkg.  The `src/doc/` directory in contrast contains (subdirectories with) lots of LaTeX, HTML and probably other files.\n\n\n\n\nI'm currently working on a GAP 4.4.12.p7 spkg for #7041, so perhaps leave comments (also) there.",
    "created_at": "2012-03-22T17:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113752",
    "user": "leif"
}
```

I'm not sure what the following is supposed to do (or mean):

```sh
    # Build and install docs if requested
    if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
        if [ $? -ne 0 ]; then
            echo "Error building gap docs."
            exit 1
        fi
        mkdir -p $SAGE_ROOT/local/share/doc/gap
        cp -r src/doc/htm $SAGE_ROOT/local/share/doc/gap/html
    fi
```

Either there's a command missing to **build** the documentation, or we don't have to build it, in which case testing `$?` there is useless, since previous errors are catched above that block.  (On the other hand, whether the creation of the directory and the copy command succeeded isn't checked at all, so maybe the `if`-block was supposed to be *below* the `cp`.)

I've currently changed this to

```sh
    # Build and install docs if requested:
    if [[ "$SAGE_SPKG_INSTALL_DOCS" = yes ]]; then
        # ?????
        if [[ $? -ne 0 ]]; then
            echo "Error building GAP docs."
            exit 1
        fi
        mkdir -p "$SAGE_LOCAL"/share/doc/gap &&
        cp -r src/doc/htm "$SAGE_LOCAL"/share/doc/gap/html
        if [[ $? -ne 0 ]]; then
            echo >&2 "Error copying GAP's HTML documentation."
            exit 1
        fi
    fi
```


Btw., the description in `SPKG.txt` (still) says the docs (as well as tests, which seem to be there again, too) have been removed from the spkg.  The `src/doc/` directory in contrast contains (subdirectories with) lots of LaTeX, HTML and probably other files.




I'm currently working on a GAP 4.4.12.p7 spkg for #7041, so perhaps leave comments (also) there.



---

archive/issue_comments_113753.json:
```json
{
    "body": "We've talked a lot about a different way to go about building and installing the spkg docs (see #11197, for example) by having a separate spkg-install-docs script, sort of like how we have a separate spkg-check script.  \n\nI agree that the current test of $? doesn't make much sense; something is clearly missing.",
    "created_at": "2012-03-22T17:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113753",
    "user": "jason"
}
```

We've talked a lot about a different way to go about building and installing the spkg docs (see #11197, for example) by having a separate spkg-install-docs script, sort of like how we have a separate spkg-check script.  

I agree that the current test of $? doesn't make much sense; something is clearly missing.



---

archive/issue_comments_113754.json:
```json
{
    "body": "Replying to [comment:15 jason]:\n> We've talked a lot about a different way to go about building and installing the spkg docs (see #11197, for example)\n\nJust wanted to cc me on that ticket, then realizing that I've already commented on it... m)\n\n(To my excuse, this was 7 month ago.)\n\n\n\n\n> I agree that the current test of $? doesn't make much sense; something is clearly missing.\n\nWell, currently the (apparently pre-built) HTML docs to get installed are there; I'm just not sure whether these are from upstream, or some Sage developer prepared them.  I'll just add a note on that to `SPKG.txt`; I think we can then remove the other files (LaTeX sources etc.) from the spkg, at least for the moment.  (Dima was recently talking about upgrading to the almost-released GAP 4.5 anyway.)",
    "created_at": "2012-03-22T18:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113754",
    "user": "leif"
}
```

Replying to [comment:15 jason]:
> We've talked a lot about a different way to go about building and installing the spkg docs (see #11197, for example)

Just wanted to cc me on that ticket, then realizing that I've already commented on it... m)

(To my excuse, this was 7 month ago.)




> I agree that the current test of $? doesn't make much sense; something is clearly missing.

Well, currently the (apparently pre-built) HTML docs to get installed are there; I'm just not sure whether these are from upstream, or some Sage developer prepared them.  I'll just add a note on that to `SPKG.txt`; I think we can then remove the other files (LaTeX sources etc.) from the spkg, at least for the moment.  (Dima was recently talking about upgrading to the almost-released GAP 4.5 anyway.)



---

archive/issue_comments_113755.json:
```json
{
    "body": "Replying to [comment:15 jason]:\n> having a separate spkg-install-docs script, sort of like how we have a separate spkg-check script.\nActually, I like that!",
    "created_at": "2012-03-23T14:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10759#issuecomment-113755",
    "user": "jdemeyer"
}
```

Replying to [comment:15 jason]:
> having a separate spkg-install-docs script, sort of like how we have a separate spkg-check script.
Actually, I like that!
