# Issue 24431: Upgrade to pynac-0.7.16

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2018-02-06 08:50:28

CC:  fbissey

In pynac-0.7.16:
 * Python interface / Py3 fixes and improvements (thx Erik Bray, #24561)
 * `atan2` fixes (#24604)
 * `beta` fixes
 * fix `atanh/acoth(real)` and `polylog` (#24299)
 * immediate atanh/acoth --> log simplifications (#24658)
 * `legendre_P` (#24553)
 * `chebyshev_T/U` (#16812)
 * speedup in special polynomial creation
 * remove clang-check error 
 * remove many clang-tidy warnings
 * remove unused code 
 * added CONTRIBUTING.md

https://github.com/pynac/pynac/releases/download/pynac-0.7.16/pynac-0.7.16.tar.bz2


---

Comment by rws created at 2018-02-06 09:19:05

New commits:


---

Comment by rws created at 2018-02-06 09:19:05

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-02-06 23:45:44

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-02-06 23:45:44

LGTM. Next step: to the buildbots.


---

Comment by rws created at 2018-02-07 06:50:11

I'll rebase #24649 on this because of merge conflict.


---

Comment by vbraun created at 2018-02-10 22:23:04

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-02-10 22:23:04

Some numerical noise:

```
File "src/sage/symbolic/expression.pyx", line 8331, in sage.symbolic.expression.Expression.arctan2
Failed example:
    SR(1).arctan2(CDF(0,1))
Expected:
    0.7853981633974484 - 19.012501686914433*I
Got:
    0.7853981633974483 - 19.012518200244195*I
**********************************************************************
1 item had failures:
   1 of  35 in sage.symbolic.expression.Expression.arctan2
    [2807 tests, 1 failure, 32.96 s]
```



---

Comment by jdemeyer created at 2018-02-11 08:59:29

The imaginary part changed a lot. More than just the usual numerical noise.


---

Comment by rws created at 2018-02-12 16:21:16

The reason for the relative big error is in the formula that is applied in `libs/pynac/pynac.pyx`: `return -I*py_log((x + I*y)/py_sqrt(x**2 + y**2))` with `x=CDF(I), y=1`. The denominator `sqrt(x**2 + y**2)` would be 0, but `CDF(I)^2` is `-1.0 + 1.2246467991473532e-16*I` and so the sqrt denominator becomes `7.82510958117314e-09 + 7.825109581173138e-09*I`.

For any other complex type of `I` as second argument I get an exception so I'm tempted to mark it as known bug.


---

Comment by git created at 2018-02-12 16:24:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-02-12 16:24:46

Changing status from needs_work to positive_review.


---

Comment by rws created at 2018-02-12 16:35:50

Actually that numeric result was changed in this ticket. Before, the result was not evaluated. However this pynac version tries to evaluate atan2 even with complex values that have nonzero imag part.


---

Comment by vbraun created at 2018-02-13 08:10:50

Resolution: fixed
