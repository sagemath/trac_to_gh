# Issue 24431: Upgrade to pynac-0.7.16

archive/issues_024431.json:
```json
{
    "body": "CC:  @kiwifb\n\nIn pynac-0.7.16:\n* Python interface / Py3 fixes and improvements (thx Erik Bray, #24561)\n* `atan2` fixes (#24604)\n* `beta` fixes\n* fix `atanh/acoth(real)` and `polylog` (#24299)\n* immediate atanh/acoth --> log simplifications (#24658)\n* `legendre_P` (#24553)\n* `chebyshev_T/U` (#16812)\n* speedup in special polynomial creation\n* remove clang-check error \n* remove many clang-tidy warnings\n* remove unused code \n* added CONTRIBUTING.md\n\nhttps://github.com/pynac/pynac/releases/download/pynac-0.7.16/pynac-0.7.16.tar.bz2\n\nIssue created by migration from https://trac.sagemath.org/ticket/24668\n\n",
    "created_at": "2018-02-06T08:50:28Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Upgrade to pynac-0.7.16",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24431",
    "user": "@rwst"
}
```
CC:  @kiwifb

In pynac-0.7.16:
* Python interface / Py3 fixes and improvements (thx Erik Bray, #24561)
* `atan2` fixes (#24604)
* `beta` fixes
* fix `atanh/acoth(real)` and `polylog` (#24299)
* immediate atanh/acoth --> log simplifications (#24658)
* `legendre_P` (#24553)
* `chebyshev_T/U` (#16812)
* speedup in special polynomial creation
* remove clang-check error 
* remove many clang-tidy warnings
* remove unused code 
* added CONTRIBUTING.md

https://github.com/pynac/pynac/releases/download/pynac-0.7.16/pynac-0.7.16.tar.bz2

Issue created by migration from https://trac.sagemath.org/ticket/24668





---

archive/issue_comments_342658.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-06T09:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342658",
    "user": "@rwst"
}
```

New commits:



---

archive/issue_comments_342659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-06T09:19:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342659",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342660.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-06T23:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342660",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342661.json:
```json
{
    "body": "LGTM. Next step: to the buildbots.",
    "created_at": "2018-02-06T23:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342661",
    "user": "@tscrim"
}
```

LGTM. Next step: to the buildbots.



---

archive/issue_comments_342662.json:
```json
{
    "body": "I'll rebase #24649 on this because of merge conflict.",
    "created_at": "2018-02-07T06:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342662",
    "user": "@rwst"
}
```

I'll rebase #24649 on this because of merge conflict.



---

archive/issue_comments_342663.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-02-10T22:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342663",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_342664.json:
```json
{
    "body": "Some numerical noise:\n\n```\nFile \"src/sage/symbolic/expression.pyx\", line 8331, in sage.symbolic.expression.Expression.arctan2\nFailed example:\n    SR(1).arctan2(CDF(0,1))\nExpected:\n    0.7853981633974484 - 19.012501686914433*I\nGot:\n    0.7853981633974483 - 19.012518200244195*I\n**********************************************************************\n1 item had failures:\n   1 of  35 in sage.symbolic.expression.Expression.arctan2\n    [2807 tests, 1 failure, 32.96 s]\n```\n",
    "created_at": "2018-02-10T22:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342664",
    "user": "@vbraun"
}
```

Some numerical noise:

```
File "src/sage/symbolic/expression.pyx", line 8331, in sage.symbolic.expression.Expression.arctan2
Failed example:
    SR(1).arctan2(CDF(0,1))
Expected:
    0.7853981633974484 - 19.012501686914433*I
Got:
    0.7853981633974483 - 19.012518200244195*I
**********************************************************************
1 item had failures:
   1 of  35 in sage.symbolic.expression.Expression.arctan2
    [2807 tests, 1 failure, 32.96 s]
```




---

archive/issue_comments_342665.json:
```json
{
    "body": "The imaginary part changed a lot. More than just the usual numerical noise.",
    "created_at": "2018-02-11T08:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342665",
    "user": "@jdemeyer"
}
```

The imaginary part changed a lot. More than just the usual numerical noise.



---

archive/issue_comments_342666.json:
```json
{
    "body": "The reason for the relative big error is in the formula that is applied in `libs/pynac/pynac.pyx`: `return -I*py_log((x + I*y)/py_sqrt(x**2 + y**2))` with `x=CDF(I), y=1`. The denominator `sqrt(x**2 + y**2)` would be 0, but `CDF(I)^2` is `-1.0 + 1.2246467991473532e-16*I` and so the sqrt denominator becomes `7.82510958117314e-09 + 7.825109581173138e-09*I`.\n\nFor any other complex type of `I` as second argument I get an exception so I'm tempted to mark it as known bug.",
    "created_at": "2018-02-12T16:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342666",
    "user": "@rwst"
}
```

The reason for the relative big error is in the formula that is applied in `libs/pynac/pynac.pyx`: `return -I*py_log((x + I*y)/py_sqrt(x**2 + y**2))` with `x=CDF(I), y=1`. The denominator `sqrt(x**2 + y**2)` would be 0, but `CDF(I)^2` is `-1.0 + 1.2246467991473532e-16*I` and so the sqrt denominator becomes `7.82510958117314e-09 + 7.825109581173138e-09*I`.

For any other complex type of `I` as second argument I get an exception so I'm tempted to mark it as known bug.



---

archive/issue_comments_342667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-12T16:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342668.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-02-12T16:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342668",
    "user": "@rwst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_342669.json:
```json
{
    "body": "Actually that numeric result was changed in this ticket. Before, the result was not evaluated. However this pynac version tries to evaluate atan2 even with complex values that have nonzero imag part.",
    "created_at": "2018-02-12T16:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342669",
    "user": "@rwst"
}
```

Actually that numeric result was changed in this ticket. Before, the result was not evaluated. However this pynac version tries to evaluate atan2 even with complex values that have nonzero imag part.



---

archive/issue_comments_342670.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-13T08:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24431#issuecomment-342670",
    "user": "@vbraun"
}
```

Resolution: fixed
