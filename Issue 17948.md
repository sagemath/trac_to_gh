# Issue 17948: Clean the Graph/DiGraph constructors

Issue created by migration from https://trac.sagemath.org/ticket/18185

Original creator: ncohen

Original creation time: 2015-04-14 10:46:33

CC:  ncohen sage-combinat tmonteil vdelecroix dcoudert darij

The Graph and DiGraph constructor are rather long, and rather messy, as they are meant to accept a LOT of different inputs.

The point of this branch is to simplify its logic, in order to be able to split it into subfunctions later.

Here is the current logic:
1) Detect and set the 'format' if it was not specified
2) For every possible format, define whether the graph should allow loops/multiedges
3) Pick a data structure (i.e. backend) and create it
4) For every possible format, add vertices and edges

Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '3' and '4' are merged so that we only enumerate all possible formats once.

I tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.


---

Comment by ncohen created at 2015-04-14 10:47:10

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-04-14 10:47:10

Last 10 new commits:


---

Comment by git created at 2015-04-15 10:46:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-04-15 10:46:50

(rebased on latest beta)


---

Comment by chapoton created at 2015-04-17 06:21:29

syntax error (missing : see patchbot report )

 elif format == 'NX'


---

Comment by chapoton created at 2015-04-17 06:21:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-04-17 06:24:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-04-17 06:24:43

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-04-17 08:22:31

*many* doctests are failing, see patchbot report..


---

Comment by chapoton created at 2015-04-17 08:22:31

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-04-17 08:27:53

Funny. No problem in graphs/ and 1000 combinat modules break. Let's see...


---

Comment by git created at 2015-04-17 08:45:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-04-17 08:46:17

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-04-17 11:50:32

remains 4 doctests failure, see patchbot report


---

Comment by git created at 2015-04-17 12:07:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-04-27 16:14:11

Heyyyyyyy guys. It would be cool if you could help me with this ticket, because there is not much one could do with the Graph class while this is waiting for a review (and so subject to changes).

Thanks,

Nathann


---

Comment by dcoudert created at 2015-04-28 07:51:14

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-04-28 07:51:14

Hello,

Although the graph and digraph constructor remains hard to read (very long), the modifications you did are very helpful.

The doc build properly, and I have no doctest error.
Good to go.

David.


---

Comment by ncohen created at 2015-04-28 07:52:15

Wouhouuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu !!

Thanks for that review !!!!!

Nathann


---

Comment by darij created at 2015-04-28 14:37:44

Thank you, both of you!


---

Comment by vbraun created at 2015-04-29 03:13:43

Resolution: fixed
