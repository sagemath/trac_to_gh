# Issue 17948: Clean the Graph/DiGraph constructors

archive/issues_017948.json:
```json
{
    "body": "CC:  @nathanncohen sage-combinat tmonteil @videlec @dcoudert @darijgr\n\nThe Graph and DiGraph constructor are rather long, and rather messy, as they are meant to accept a LOT of different inputs.\n\nThe point of this branch is to simplify its logic, in order to be able to split it into subfunctions later.\n\nHere is the current logic:\n1) Detect and set the 'format' if it was not specified\n2) For every possible format, define whether the graph should allow loops/multiedges\n3) Pick a data structure (i.e. backend) and create it\n4) For every possible format, add vertices and edges\n\nBesides local fixes and modifications, this branch moves '3' right after '1'. Then, '3' and '4' are merged so that we only enumerate all possible formats once.\n\nI tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18185\n\n",
    "created_at": "2015-04-14T10:46:33Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Clean the Graph/DiGraph constructors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17948",
    "user": "@nathanncohen"
}
```
CC:  @nathanncohen sage-combinat tmonteil @videlec @dcoudert @darijgr

The Graph and DiGraph constructor are rather long, and rather messy, as they are meant to accept a LOT of different inputs.

The point of this branch is to simplify its logic, in order to be able to split it into subfunctions later.

Here is the current logic:
1) Detect and set the 'format' if it was not specified
2) For every possible format, define whether the graph should allow loops/multiedges
3) Pick a data structure (i.e. backend) and create it
4) For every possible format, add vertices and edges

Besides local fixes and modifications, this branch moves '3' right after '1'. Then, '3' and '4' are merged so that we only enumerate all possible formats once.

I tried to split commits to make it easier to review. I know that it will not be very easy to read. It was not exactly easy to write either.

Issue created by migration from https://trac.sagemath.org/ticket/18185





---

archive/issue_comments_241137.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241137",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_241138.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-04-14T10:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241138",
    "user": "@nathanncohen"
}
```

Last 10 new commits:



---

archive/issue_comments_241139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-15T10:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241139",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_241140.json:
```json
{
    "body": "(rebased on latest beta)",
    "created_at": "2015-04-15T10:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241140",
    "user": "@nathanncohen"
}
```

(rebased on latest beta)



---

archive/issue_comments_241141.json:
```json
{
    "body": "syntax error (missing : see patchbot report )\n\n elif format == 'NX'",
    "created_at": "2015-04-17T06:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241141",
    "user": "@fchapoton"
}
```

syntax error (missing : see patchbot report )

 elif format == 'NX'



---

archive/issue_comments_241142.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-17T06:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241142",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_241143.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T06:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241143",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241144.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-17T06:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241144",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_241145.json:
```json
{
    "body": "**many** doctests are failing, see patchbot report..",
    "created_at": "2015-04-17T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241145",
    "user": "@fchapoton"
}
```

**many** doctests are failing, see patchbot report..



---

archive/issue_comments_241146.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-17T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241146",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_241147.json:
```json
{
    "body": "Funny. No problem in graphs/ and 1000 combinat modules break. Let's see...",
    "created_at": "2015-04-17T08:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241147",
    "user": "@nathanncohen"
}
```

Funny. No problem in graphs/ and 1000 combinat modules break. Let's see...



---

archive/issue_comments_241148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T08:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241148",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-17T08:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241149",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_241150.json:
```json
{
    "body": "remains 4 doctests failure, see patchbot report",
    "created_at": "2015-04-17T11:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241150",
    "user": "@fchapoton"
}
```

remains 4 doctests failure, see patchbot report



---

archive/issue_comments_241151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-17T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241151",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_241152.json:
```json
{
    "body": "Heyyyyyyy guys. It would be cool if you could help me with this ticket, because there is not much one could do with the Graph class while this is waiting for a review (and so subject to changes).\n\nThanks,\n\nNathann",
    "created_at": "2015-04-27T16:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241152",
    "user": "@nathanncohen"
}
```

Heyyyyyyy guys. It would be cool if you could help me with this ticket, because there is not much one could do with the Graph class while this is waiting for a review (and so subject to changes).

Thanks,

Nathann



---

archive/issue_comments_241153.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241153",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_241154.json:
```json
{
    "body": "Hello,\n\nAlthough the graph and digraph constructor remains hard to read (very long), the modifications you did are very helpful.\n\nThe doc build properly, and I have no doctest error.\nGood to go.\n\nDavid.",
    "created_at": "2015-04-28T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241154",
    "user": "@dcoudert"
}
```

Hello,

Although the graph and digraph constructor remains hard to read (very long), the modifications you did are very helpful.

The doc build properly, and I have no doctest error.
Good to go.

David.



---

archive/issue_comments_241155.json:
```json
{
    "body": "Wouhouuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu !!\n\nThanks for that review !!!!!\n\nNathann",
    "created_at": "2015-04-28T07:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241155",
    "user": "@nathanncohen"
}
```

Wouhouuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu !!

Thanks for that review !!!!!

Nathann



---

archive/issue_comments_241156.json:
```json
{
    "body": "Thank you, both of you!",
    "created_at": "2015-04-28T14:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241156",
    "user": "@darijgr"
}
```

Thank you, both of you!



---

archive/issue_comments_241157.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-29T03:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17948#issuecomment-241157",
    "user": "@vbraun"
}
```

Resolution: fixed
