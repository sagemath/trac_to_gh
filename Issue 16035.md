# Issue 16035: redesign transversal designs

Issue created by migration from https://trac.sagemath.org/ticket/16272

Original creator: vdelecroix

Original creation time: 2014-04-30 14:09:07

Assignee: Vincent Delecroix

CC:  ncohen brett

Keywords: designs, orthogona arrays

The tickets #15310 and #16227 introduce a nice `availability` keywords that answer to the question "Does Sage knows how to build a TD(k,n)"? Using `Unknown` from `sage.misc.unknown` we can turn the question into "Do we now mathematically how to build a TD(k,n)?" whose answer would be:
 - `True` if Sage knows how to do it
 - `Unknwon` if neither Sage nor mathematics can help
 - `False` if we know mathematically that such construction does not exist

As the semantic changes, we will also turn the keyword `availability` into `existence` (or maybe have both).


---

Comment by brett created at 2014-05-01 09:45:26

In case "Unkown" did you mean that Sage does not know how to do it (as currently implemented) but possibly Mathematics knows the answer?  "Unknown" should ideally mean that mathematics does not know the answer but Sage development is likely to lag behind mathematics and I don't want users to think that if Sage does not know the answer that this implies that mathematics does not know the answer.  I think this is all what you meant but the word "nor" confused me.

The Bruck-Ryser-Chowla Theorem (from Theorem 2.13 in Stinson's Book) shows that if $n \equiv 1,2 \bmod 4$
and there exists a prime $p \equiv 3 \bmod 4$ such that the largest power of $p$ that divides $n$ is odd.  Then a TD$(n+1,n)$ does not exist.

A reference for the non existence of TD$(11,10)$ is 


```
@article {MR1018454,
    AUTHOR = {Lam, C. W. H. and Thiel, L. and Swiercz, S.},
     TITLE = {The nonexistence of finite projective planes of order {$10$}},
   JOURNAL = {Canad. J. Math.},
  FJOURNAL = {Canadian Journal of Mathematics. Journal Canadien de Math\'ematiques},
    VOLUME = {41},
      YEAR = {1989},
    NUMBER = {6},
     PAGES = {1117--1123},
      ISSN = {0008-414X},
     CODEN = {CJMAAB},
   MRCLASS = {51E15 (51-04)},
  MRNUMBER = {1018454 (90j:51008)},
MRREVIEWER = {J. C. Fisher},
       DOI = {10.4153/CJM-1989-049-4},
}
```



For the results I mentioned about sufficiently high $k$ implying TD$(n+1,n)$ exists, I will have to dig up the papers by Metz and review them to remember exactly how this works.


---

Comment by brett created at 2014-05-01 09:45:57

Why did that BibTeX reference format so badly?


---

Comment by ncohen created at 2014-05-01 09:54:10

Yo !

> In case "Unkown" did you mean that Sage does not know how to do it (as currently implemented) but possibly Mathematics knows the answer? 

The parameter will be called "existence". When you type `designs.transversal_design(k,n,existence=True)`

it will answer
1) `True` meaning "Sage can build it"
2) `Unknown` meaning "Sage can't build it, but it may exist"
3) `False` meaning "it does not exist"

Thus there is nothing there to mean "Mathematics knows it exists but Sage does not know how to build it". THouuuuuuugh if you know of something like that, the only responsible way to solve the problem is to implement the  mathematical result `:-P`

> "Unknown" should ideally mean that mathematics does not know the answer but Sage development is likely to lag behind mathematics and I don't want users to think that if Sage does not know the answer that this implies that mathematics does not know the answer.  I think this is all what you meant but the word "nor" confused me.

Well, the word "unknown" means "Sage has no idea" `^^;`

> For the results I mentioned about sufficiently high $k$ implying TD$(n+1,n)$ exists, I will have to dig up the papers by Metz and review them to remember exactly how this works.

Okayyyyyyyyy !

> Why did that BibTeX reference format so badly?

Because some characters that you used are interpreted as typographic instructions. Wrap what you want to say with ``` and ``` to avoid that. I  edited your comment above, so it looks fine now `;-)`

Nathann


---

Comment by brett created at 2014-05-01 10:21:17

Replying to [comment:6 ncohen]:
> Yo !
> 
> > In case "Unkown" did you mean that Sage does not know how to do it (as currently implemented) but possibly Mathematics knows the answer? 
> 
> The parameter will be called "existence". When you type `designs.transversal_design(k,n,existence=True)`
> 
> it will answer
> 1) `True` meaning "Sage can build it"
> 2) `Unknown` meaning "Sage can't build it, but it may exist"
> 3) `False` meaning "it does not exist"
> 

Perfect, this is what I thought, but "nor" threw me off

> 
> > Why did that BibTeX reference format so badly?
> 
> Because some characters that you used are interpreted as typographic instructions. Wrap what you want to say with ``` and ``` to avoid that. I  edited your comment above, so it looks fine now `;-)`


thanks

You put it in some kind of box, a "code block"?


---

Comment by ncohen created at 2014-05-01 10:22:41

> You put it in some kind of box, a "code block"?

Yep !


---

Comment by ncohen created at 2014-05-02 13:32:30

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-05-02 13:32:30

Here it is ! I implemented the same thing so many times that even I am trying to see that unifying it all may help... `:-P`

Nathann


---

Comment by ncohen created at 2014-05-02 13:32:39

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-05-02 13:39:40

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by vdelecroix created at 2014-05-02 13:54:31

Hi,

I would like to have a `verbose` or `message` option:

```
sage: designs.transversal_design(7,6,existence=True)
False
sage: designs.transversal_design(7,6,existence=True,message=True)
(False, "By the Bruck-Ryser-Chowla theorem, no projective plane of order 6 exists")
```

But it looks like we are implementing ourself the propagation of errors... What do you think?

Vincent


---

Comment by ncohen created at 2014-05-02 13:58:25

Yo !

> But it looks like we are implementing ourself the propagation of errors... What do you think?

HMmm... Well, to me this is similar to the "construction path" feature. You know, the feature to tell you how to prove formally that a design exists with theorems ? There you want a "formal proof" that it cannot be done.

The thing is that right now we have no recursive proof of non-existence... But I still believe that it is too early to implement stuff like that.

Nathann


---

Comment by ncohen created at 2014-05-02 21:04:12

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by vdelecroix created at 2014-05-02 22:54:33

Hello,

Here it comes!

Ok. I mainly did two things
 - implement my own `projective_space_as_OA` inside `orthogonal_arrays.py`. This might sound weird but the current implementation of `ProjectiveSpaceDesign` is slow and scarry me (I plan to clean it soon in a ticket).
 - implement a beautiful `TD_existence` (I do not like the name, so I aks for suggestions here):
   {{{
   sage: from sage.combinat.designs.orthogonal_arrays import TD_existence
   sage: TD_existence(6)
   TD(k,6)
    exist            for k in [ 2, 3]
    unknown to exist for k in [ 4, 6]
    not exist        for k in [ 7,+infini]
   }}}

I also correct some of the errors raised to get mainly `EmptySetError` and `NotImplementedError`.

Vincent


---

Comment by git created at 2014-05-02 22:54:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-02 22:55:57

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-05-02 22:55:57

As I do not have the reference for the third point mentioned in the ticket, I did not do it...

Vincent


---

Comment by ncohen created at 2014-05-03 06:46:19

Yo !

>  - implement my own `projective_space_as_OA` inside `orthogonal_arrays.py`. This might sound weird but the current implementation of `ProjectiveSpaceDesign` is slow and scarry me (I plan to clean it soon in a ticket).

THis thing has *NOTHING* to do here. Use the current `ProjectivePlaneDesigns`, and write another ticket to change the code if you don't like it. I agree that it is slow, but implementing the function TWICE (one that is slow, one that is hidden in an unrelated module) is not a way to solve it.

>  - implement a beautiful `TD_existence` (I do not like the name, so I aks for suggestions here):

Beautiful ? Is that a joke ? A function that PRINTS text ?

Get this thing out of here until a proper interface design is found. A function like that should RETURN values, not print stuff. Plus we have almost no negative result to advertise for the moment. Plus how the hell is an user going to find that ? We write Sage code here, not our own scripts !!!

If such a function is to ever be implemented, it will return a pair "lower bound, upper bound". The only interesting data in your three lines are TWO NUMBERS, and wrapping them in intervals for nothing, adding a 2 there and an infinity there looks fancy, but once more we work on a library here, not on your own code.

> I also correct some of the errors raised to get mainly `EmptySetError` and `NotImplementedError`.


I will look at that when the problems above are solved....

Nathann


---

Comment by ncohen created at 2014-05-03 07:23:15

By the way... When we will have merged all constructions, there is a doctest that I would like to include in the doc, and it may partly do what you built this "TD_existence" thing for.

This is the table that I am trying to copy :
http://books.google.fr/books?id=S9FA9rq1BgoC&lpg=PA175&ots=Do3xYTkMox&dq=%22mols%22%20of%20side%20%3C%2010000&pg=PA176#v=onepage&q=%22mols%22%20of%20side%20%3C%2010000&f=false

It is somehow "the reference". It gives you the maximum number of MOLS that are known to exist for a given order.

aaaaaaaand I have had  the following code for a while to see where I was going:


```
print "      ",
for i in range(20):
    print str(i)+" "*(4-len(str(i))),
print ""
print " "*4+"_"*20*5+"__"

for i in range(20*10):
    if i%20==0:
        print ""
        print str(i)+" "*(4-len(str(i)))+"| ",
    if i < 2:
        k = 1
    else:
        for k in range(i+1):
            if not designs.mutually_orthogonal_latin_squares(i,k,availability=True):
                break
    k = str(k-1)
    print k+" "*(4-len(k)),
```


This function is not meant to be called by users of course, I thought I would just make it a private function and call it just once, in a "# long" doctest. Here is what it produces, with #16241 (and all its dependencies) applied.


```
       0    1    2    3    4    5    6    7    8    9    10   11   12   13   14   15   16   17   18   19   
    ______________________________________________________________________________________________________

0   |  0    0    1    2    3    4    1    6    7    8    2    10   4    12   4    4    15   16   3    18   
20  |  4    5    3    22   7    24   4    26   5    28   4    30   31   5    4    5    8    36   4    5    
40  |  7    40   5    42   5    6    4    46   8    48   6    5    5    52   5    6    7    3    2    58   
60  |  5    60   5    6    63   4    2    66   4    4    6    70   7    72   3    7    3    6    3    78   
80  |  9    80   8    82   6    6    6    3    7    88   3    6    3    4    3    6    7    96   6    8    
100 |  8    100  6    102  7    4    4    106  4    108  4    6    7    112  3    7    4    8    3    6  
```


It will be a nice way to advertise what Sage can do for TD/OA/MOLS `:-P`

Nathann


---

Comment by git created at 2014-05-03 07:53:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 07:59:04

Hi Nathann,

You are right. I moved `TD_existence` as a doctest in `transversal_design` and now `projective_plane_as_OA` belongs to the module `block_design`.

The function `projective_plane_as_OA` is not similar to `ProjectivePlaneDesign` as it returns an  OA (moreover, possibly not a complete OA(n+1,n,2)). To write it, I just pick the code from what was in OA and put it in an independent function. To my mind, we should keep the `ProjectivePlaneDesign` function as it was before.

Is it better like that?

Vincent


---

Comment by ncohen created at 2014-05-03 08:29:54

Yo !

> You are right. I moved `TD_existence` as a doctest in `transversal_design` and now `projective_plane_as_OA` belongs to the module `block_design`.

Okay, I really think that you are wrongly assuming that it is "always cool" to add tests, but I always check the long tests when I work on a file and adding "a minute there, a minute there" really is painful.

Let's talk about the code : you screamed when I removed the feature "give me the largest k possible" from the MOLS. It is now time to add it. To add the feature in all 3 constructors, because it costs absolutely nothing


```
def OA(...):
   if k is None:
       all(OA(k+1,n,existence=True) for k in range(2,n+4))
       return k
```

And for all others

```
def TD(...):
    if k is None:
        k = OA(None, n,existence = True)
```


Then your doctest will be lighter and we will have the feature back. I can do it if you don't want to.

Also : would you mind not constructing the design for values of k which are smaller than the best possible ? Really, please don't make doctests too long. It takes times when you work on code, and you really over-check stuff. Remember that all results are checked before being returned anyway, so really this is a waste of (developer) time.

> The function `projective_plane_as_OA` is not similar to `ProjectivePlaneDesign` as it returns an  OA (moreover, possibly not a complete OA(n+1,n,2)). To write it, I just pick the code from what was in OA and put it in an independent function. To my mind, we should keep the `ProjectivePlaneDesign` function as it was before.

If you need to rewrite a different version of ProjectivePlaneDesign becaause it is to slow, is it safe to assume that ProjectivePlaneDesign should be changed ?

It does not make any sense to implement the same thing twice, Vincent, really. Of course if you have to call the ProjectivePlaneDesign you may have some conversion to do, but is that really a problem ? We must not implement this thing twice, really ....

Nathann


---

Comment by vdelecroix created at 2014-05-03 08:42:24

Replying to [comment:23 ncohen]:
> Yo !
> 
> > You are right. I moved `TD_existence` as a doctest in `transversal_design` and now `projective_plane_as_OA` belongs to the module `block_design`.
> 
> Okay, I really think that you are wrongly assuming that it is "always cool" to add tests, but I always check the long tests when I work on a file and adding "a minute there, a minute there" really is painful.
> 
> Let's talk about the code : you screamed when I removed the feature "give me the largest k possible" from the MOLS. It is now time to add it. To add the feature in all 3 constructors, because it costs absolutely nothing
> 
> {{{
> def OA(...):
>    if k is None:
>        all(OA(k+1,n,existence=True) for k in range(2,n+4))
>        return k
> }}}
> And for all others
> {{{
> def TD(...):
>     if k is None:
>         k = OA(None, n,existence = True)
> }}}
> 
> Then your doctest will be lighter and we will have the feature back. I can do it if you don't want to.
> 
> Also : would you mind not constructing the design for values of k which are smaller than the best possible ? Really, please don't make doctests too long. It takes times when you work on code, and you really over-check stuff. Remember that all results are checked before being returned anyway, so really this is a waste of (developer) time.

Sounds good to me. I will do it and simplify the doctests accordingly.

> > The function `projective_plane_as_OA` is not similar to `ProjectivePlaneDesign` as it returns an  OA (moreover, possibly not a complete OA(n+1,n,2)). To write it, I just pick the code from what was in OA and put it in an independent function. To my mind, we should keep the `ProjectivePlaneDesign` function as it was before.
> 
> If you need to rewrite a different version of ProjectivePlaneDesign because it is too slow, is it safe to assume that ProjectivePlaneDesign should be changed ?

It is not only about conversion. ProjectivePlaneDesign is buggy: there is crazy argument "type" which makes specification a bit more complicated:
 - if type is None: do what you know is the best and return *a* projective plane
 - if type is something: do whatever the construction tells you and return *the* corresponding projective plane

Now if you incorporate the `who_asked` feature. It becomes crazy! I feel like `type` and `who_asked` are rather incompatible. To my mind, we should simply remove `ProjectivePlaneDesign` and have different functions (which raise only `ValueError` on bad entries) for each kind of projective planes we know about.

> It does not make any sense to implement the same thing twice, Vincent, really. Of course if you have to call the ProjectivePlaneDesign you may have some conversion to do, but is that really a problem ? We must not implement this thing twice, really ....

What? I only moved *your* code from `orthogonal_array` to `projective_plane_as_OA`? Just kidding :-P


---

Comment by vdelecroix created at 2014-05-03 08:46:04

Replying to [comment:24 vdelecroix]:
> Replying to [comment:23 ncohen]:
> > Yo !
> > 
> > > You are right. I moved `TD_existence` as a doctest in `transversal_design` and now `projective_plane_as_OA` belongs to the module `block_design`.
> > 
> > Okay, I really think that you are wrongly assuming that it is "always cool" to add tests, but I always check the long tests when I work on a file and adding "a minute there, a minute there" really is painful.
> > 
> > Let's talk about the code : you screamed when I removed the feature "give me the largest k possible" from the MOLS. It is now time to add it. To add the feature in all 3 constructors, because it costs absolutely nothing
> > 
> > {{{
> > def OA(...):
> >    if k is None:
> >        all(OA(k+1,n,existence=True) for k in range(2,n+4))
> >        return k
> > }}}
> > And for all others
> > {{{
> > def TD(...):
> >     if k is None:
> >         k = OA(None, n,existence = True)
> > }}}
> > 
> > Then your doctest will be lighter and we will have the feature back. I can do it if you don't want to.
> > 
> > Also : would you mind not constructing the design for values of k which are smaller than the best possible ? Really, please don't make doctests too long. It takes times when you work on code, and you really over-check stuff. Remember that all results are checked before being returned anyway, so really this is a waste of (developer) time.
> 
> Sounds good to me. I will do it and simplify the doctests accordingly.
> 

Arrrrrrggggghhhhhhh. The `k` comes before the `n`. So there is no way to make `k` optional without making `n` optional... do you feel like having something like

```
def transversal_design(k,n=None):
    if n is None:
        n = k
        k = best_possible(n)
    ...
```



---

Comment by git created at 2014-05-03 09:08:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 09:10:48

Now long doctest takes 25 secs on orthogonal_arrays.py, must be good enough.


---

Comment by ncohen created at 2014-05-03 09:12:38

> It is not only about conversion. ProjectivePlaneDesign is buggy: there is crazy argument "type" which makes specification a bit more complicated:
>  - if type is None: do what you know is the best and return *a* projective plane
>  - if type is something: do whatever the construction tells you and return *the* corresponding projective plane

This ticket is no place to fix that.

> Now if you incorporate the `who_asked` feature. It becomes crazy! I feel like `type` and `who_asked` are rather incompatible. To my mind, we should simply remove `ProjectivePlaneDesign` and have different functions (which raise only `ValueError` on bad entries) for each kind of projective planes we know about.

Vincent, the "type" keyword is not even USED. Remove it if it makes it easier for you.

Nathann


---

Comment by vdelecroix created at 2014-05-03 09:31:08

I can not use the current ProjectivePlaneDesign... here are the timings:

```
sage: %timeit designs.ProjectivePlaneDesign(9)
1 loops, best of 3: 2.63 s per loop
sage: %timeit designs.ProjectivePlaneDesign(16)  # WTF?
1 loops, best of 3: 42.3 s per loop
```

2 secs are reasonable but 42 secs are not and I do not want to go further. Now with the straigthforward one I used it takes less than 1 sec:

```
sage: from sage.combinat.designs.block_design import projective_plane_as_OA
sage: %timeit projective_plane_as_OA(9)
100 loops, best of 3: 5.95 ms per loop
sage: %timeit projective_plane_as_OA(16)
10 loops, best of 3: 39.5 ms per loop
```


I do not want either to rewrite the whole ProjectivePlaneDesign as it is not the purpose of that ticket. So please find a reasonable solution.


---

Comment by vdelecroix created at 2014-05-03 09:46:29

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2014-05-03 09:46:29

I agreed with Nathann that the best solution is to rewrite the projective planes... so here it is: #16281


---

Comment by git created at 2014-05-03 18:47:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 18:49:37

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-05-03 18:49:37

Hi Nathann,

Projective planes from #16281 is merged and now the code is shorter/cleaner.

There is no real check that a projective plane is valid as the ouptut of the function `projective_plane`... but that is not a real problem.

Vincent


---

Comment by ncohen created at 2014-05-03 18:51:11

Well, not only we don't care if some step of the total computation is not checked, but none of them should be checked except the last one. We should never call design constructors from inside of the library without deacivating the checks othewise we really waste time.

Okay... Now I am going to play with git to see what exactly is being implemented in this ticket `T_T`

Nathann


---

Comment by ncohen created at 2014-05-03 18:58:29

Please Vincent. In the future, do not do ANYTHING in a merge commit except fix the conflicts.

It is HELL to know what else you changed.

Nathann


---

Comment by ncohen created at 2014-05-03 19:04:26

Okay, it is hell to know what exactly you did here. Can you tell me ?

For instance, what is the point of this who_asked in projective plane ?

Nathann


---

Comment by ncohen created at 2014-05-03 19:05:57

Okay Vincent. Unless you know a way for me to see exactly what you implemented which is not already in the other tickets, could you :

1) GO back to the history before the merge

2) Do the merge and only the merge

3) Implement stuff

Otherwise I just can't see what you did.

Nathann


---

Comment by vdelecroix created at 2014-05-03 19:15:59

Hi,

Before the merge, there *was* a `who_asked` argument in `projective_plane_as_OA`. Now it is an argument of `projective_plane`. In the second part of the merge I only fix some typo and doctests.

Perhaps I should go much before in history and then do the merge... let me try.

Vincent


---

Comment by ncohen created at 2014-05-03 19:17:30

Oh. I found a way. Cool `O_O;;`

Vincent, I think there is absolutely no point to the implementation of the `who_asked` argument in projective plane, nor in projective plane calling OA back. No projective plane is known to exist for orders which are not prime powers, so this is going too far. We will adapt the code if this ever happens

Nathann


---

Comment by ncohen created at 2014-05-03 19:20:18

It seems I still cannot see all changes. I saw that though :


```
+    #TODO: here there is no need to test everything as the function
+    # projective_plane answers it for you
```


If you want this to be removed, you need an existence flag on `projective_plane`.

Nathann


---

Comment by ncohen created at 2014-05-03 19:21:17

> If you want this to be removed, you need an existence flag on `projective_plane`.

Oh, we have it already. Cool. Well, you can replace it if you want, then.

Nathann


---

Comment by vdelecroix created at 2014-05-03 19:27:11

Time to eat... will have a look later tonight.

Vincent


---

Comment by vdelecroix created at 2014-05-03 19:50:19

It will be much cleaner if I start the merge from d678326 (your last commit)... let's go!

Vincent


---

Comment by ncohen created at 2014-05-03 20:06:22

> It will be much cleaner if I start the merge from d678326 (your last commit)... let's go!
+1

Nathann


---

Comment by git created at 2014-05-03 20:19:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2014-05-03 20:21:21

Hi Nathann,

This is a non fast forward push from your last commit. I integrated your remarks and the long doctest I created to check the output of `transversal_design`.

Vincent


---

Comment by ncohen created at 2014-05-03 20:22:13

Thanks ! It will be easier to follow this way `:-)`

Nathann


---

Comment by vdelecroix created at 2014-05-03 20:25:29

Note that the doc fails to build

```
[combinat ] /opt/sage/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py:docstring of sage.combinat.designs.orthogonal_arrays.find_wilson_decomposition:14: ERROR: Unexpected indentation.
[combinat ] :0: WARNING: Block quote ends without a blank line; unexpected unindent.
Error building the documentation.
Traceback (most recent call last):
  File "/opt/sage/src/doc/common/builder.py", line 1477, in <module>
    getattr(get_builder(name), type)()
  File "/opt/sage/src/doc/common/builder.py", line 276, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/opt/sage/src/doc/common/builder.py", line 487, in _wrapper
    x.get(99999)
  File "/opt/sage/local/lib/python/multiprocessing/pool.py", line 554, in get
    raise self._value
OSError: [combinat ] /opt/sage/local/lib/python2.7/site-packages/sage/combinat/designs/orthogonal_arrays.py:docstring of sage.combinat.designs.orthogonal_arrays.find_wilson_decomposition:14: ERROR: Unexpected indentation.
```



---

Comment by ncohen created at 2014-05-03 20:39:13

Yooooooooooo !!

I understand that you do not want to call the same function twice, but would you mind behaving as if boolean results were already cached ? It really makes the code's flow easier to follow `:-/`

Otherwise everything looks right... If I may ask, I think it would also be better to not have this `TD = designs.transversal_design` in the doctest. Keeping the full writing also helps explaining to the users that all the TD can be built from `designs.transversal_design`. 

Nathann


---

Comment by ncohen created at 2014-05-03 21:26:35

Besides it's good to go.

Nathann


---

Comment by git created at 2014-05-03 23:02:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-03 23:07:58

Replying to [comment:48 ncohen]:
> Yooooooooooo !!
> 
> I understand that you do not want to call the same function twice, but would you mind behaving as if boolean results were already cached ? It really makes the code's flow easier to follow `:-/`

I do not care too much about calling twice the function. My main trouble was that in `OA` with parameters `n,k=n+1,t=2` we have equivalence with projective planes. So we need to let the projective plane do what it has to do (even if the answer is Unknown). Whereas for general `n,k,t=2` we might have something better but it still worth it to ask about a projective plane... If you have an idea to make it neat I let it to you.

> Otherwise everything looks right... If I may ask, I think it would also be better to not have this `TD = designs.transversal_design` in the doctest. Keeping the full writing also helps explaining to the users that all the TD can be built from `designs.transversal_design`. 

Cool (Note that the doc problem is fixed).

We leave the idea of having an optional `k=None`? Might be an independent ticket anyway.

Vincent


---

Comment by ncohen created at 2014-05-04 06:40:36

> I do not care too much about calling twice the function.

Cool. Then I changed the code  to have a nice "if/elif" structure. In some very specific cases the projective plane function is called three times, but

1) This is only when the answer has been found, so it does not happens often per call

2) A tricky replacement is possible too, as 

```
    elif (t == 2 and
          (projective_plane(n, existence=True) or
           (k == n+1 and projective_plane(n, existence=True) is False))):
```


is equivalent to:


```
    elif (t == 2 and
          (projective_plane(n, existence=True) in (True,k<n+1))):
```


This being said the code of these things compared to the cost of building the actual array ...

> We leave the idea of having an optional `k=None`? Might be an independent ticket anyway.

Yep, let's close this one and get #16277 in. I will merge it in a second.

Nathann


---

Comment by git created at 2014-05-04 06:41:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-05-04 09:03:53

Hi,

This is what I did not want to do... if `k=n+1` and `projective_plane` answers `Unknown` you are going to try other constructions. In comment:38 you said that it was useless... But anyway, it does not cost too much and if by chance we got one we would be happy!

Who is the author? who is the reviewer? who sets to positive review?

Vincent


---

Comment by ncohen created at 2014-05-04 09:06:39

Yo !

> This is what I did not want to do... if `k=n+1` and `projective_plane` answers `Unknown` you are going to try other constructions. In comment:38 you said that it was useless...

Oh right. But that was to avoid having a `who_asks` parameter in `projective_plane`. But anyway, it does not cost too much and if by chance we got one we would be happy! Ahahaha. Yeah. Perhaps somebody overlooked a very simple case of recursive decomposition `;-)`

> Who is the author? who is the reviewer? who sets to positive review?

Well, let's do half/half. Positive review with both reviewers and both authors. By the way I just finished the patch for `k=None` and I added the MOLS table from my dreams. The last dependency of the constructions will also be reviewed in a second `;-)`

Nathann


---

Comment by ncohen created at 2014-05-04 09:07:01

Changing status from needs_review to positive_review.


---

Comment by git created at 2014-05-04 16:13:34

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-05-04 16:13:34

Changing status from positive_review to needs_review.


---

Comment by ncohen created at 2014-05-04 16:13:49

Still merging ...

Nathann


---

Comment by ncohen created at 2014-05-04 16:13:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-05-08 08:04:17

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-05-08 08:04:17

Merge conflict


---

Comment by git created at 2014-05-08 08:22:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-05-08 08:23:04

Changing status from needs_work to positive_review.


---

Comment by git created at 2014-05-10 21:28:29

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-05-10 21:28:29

Changing status from positive_review to needs_review.


---

Comment by ncohen created at 2014-05-10 21:28:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-05-12 11:34:39

Resolution: fixed
