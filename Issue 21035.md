# Issue 21035: hash for Laurent polynomials is broken

Issue created by migration from https://trac.sagemath.org/ticket/21272

Original creator: vdelecroix

Original creation time: 2016-08-17 21:52:41


```
sage: R.<t> = LaurentPolynomialRing(ZZ)
sage: hash(R.zero())
0
sage: hash(t - t)
1
```


Original report:

    https://groups.google.com/forum/#!topic/sage-support/HqP8dXYNDTU


---

Comment by nbruin created at 2016-08-18 04:54:38

Fixing `__normalize` should be pretty easy: laurent polynomials are represented as u*x<sup>n</sup>, where u is a unit or 0. Normalize should simply force `n` to be a particular value (probably `n=0`) if `u=0`.


---

Comment by vdelecroix created at 2016-08-18 13:12:26

Sure but there are other things I want to do:
- the hash should coincide with polynomials when valuation is >= 0
- the hash should be non-trivial enough to avoid simple collisions


---

Comment by vdelecroix created at 2016-08-18 14:07:55

New commits:


---

Comment by vdelecroix created at 2016-08-18 14:07:55

Changing status from new to needs_review.


---

Comment by bruno created at 2016-08-22 12:17:20

* How did you choose the value `700005`? 
* You should replace `TESTS:` by `TESTS::` in `__hash__`.


---

Comment by saraedum created at 2016-12-16 04:45:33

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2016-12-16 04:46:20

vdelecroix: Can you somehow push this branch again? For me, all it shows in trac is that the laurent_polynomial.pyx file has been deleted.


---

Comment by git created at 2016-12-16 13:01:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-12-16 13:01:47

Rebased on 7.5.beta6!


---

Comment by git created at 2016-12-17 12:05:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-12-17 12:05:47

Replying to [comment:6 bruno]:
> * How did you choose the value `700005`? 

A fairly random number.

> * You should replace `TESTS:` by `TESTS::` in `__hash__`.

Done. Thanks.


---

Comment by vdelecroix created at 2016-12-17 12:05:47

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2016-12-17 16:25:03

If you agree with my change, feel free to set this to positive review.


---

Comment by saraedum created at 2016-12-17 16:25:30

New commits:


---

Comment by saraedum created at 2016-12-17 16:28:23

Have you considered turning `__u` into a sparse polynomial, shifting it, and computing the hash from there? I guess that would be my only proposal here to remove a duplication of code. But it is probably not worth it. Your tests should catch any changes in the implementation of the hash function of polynomials…


---

Comment by vdelecroix created at 2016-12-19 07:51:40

Replying to [comment:17 saraedum]:
> Have you considered turning `__u` into a sparse polynomial, shifting it, and computing the hash from there? I guess that would be my only proposal here to remove a duplication of code. But it is probably not worth it. Your tests should catch any changes in the implementation of the hash function of polynomials…

Converting the data structure at the time of the hash is not a good idea (time costly). Is this what you were proposing? On the other hand, modifying the internal data structure of laurent polynomials is beyond the scope of this ticket.


---

Comment by vdelecroix created at 2016-12-23 23:04:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-18 20:39:45

Resolution: fixed
