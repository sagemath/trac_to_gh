# Issue 15516: Add BasisExchangeMatroid.isomorphism()

Issue created by migration from Trac.

Original creator: Rudi

Original creation time: 2014-01-28 19:57:06

CC:  stefan yomcat

Currently the abstract class BasisExchangeMatroid provides a method .isomorphic() to test if two matroids are isomorphic, but that method does not return an isomorphism, if one exist.

I want to add a function that does. 


---

Comment by Rudi created at 2014-01-28 20:54:54

Made a first implementation by modifying the existing _is_isomorphic. It compiles and the doctests work. I will run a few tests before I put it up for review.
----
New commits:


---

Comment by git created at 2014-01-29 13:10:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2014-01-31 07:58:40

I'm happy with this implementation, so have a look.


---

Comment by Rudi created at 2014-01-31 07:58:40

Changing status from new to needs_review.


---

Comment by rohan created at 2014-04-04 01:53:58

Hi, I noticed the following about the special cases for rank or corank 0 or 1 in basis_exchange_matroid.pyx and for rank 0 in basis_matroid.pyx. They return the identity map on the ground set of self rather than a map to the ground set of other. For example

```
sage: M = Matroid(matrix=Matrix(GF(2), [[1,1,0],[0,1,0],[0,0,0]]))
sage: N = Matroid(matrix=Matrix(GF(2), [[0,1,1],[0,1,0],[0,0,0]]))
sage: M.is_isomorphic(N)
True
sage: M.is_isomorphism(N, M.isomorphism(N))
False
```


```
sage: M = Matroid(groundset='abcde', bases=[[]])
sage: N = Matroid(groundset=range(5), bases=[[]])
sage: M.is_isomorphic(N)
True
sage: M.is_isomorphism(N, M.isomorphism(N))

ValueError: range of morphism does not contain groundset of other matroid.
```

For the rank/corank 0 case maybe the line

```
return {e:e for e in self.groundset()}
```

should be something like

```
return {list(self.groundset())[i]:list(other.groundset())[i] for i in range(len(self.groundset()))}
```

and for the rank 1 case

```
morphism = {list(M.groundset()-M.loops())[i]:list(N.groundset()-N.loops())[i] for i in range(len(M.groundset()-M.loops()))}
morphism2 = {list(M.loops())[i]:list(N.loops())[i] for i in range(len(M.loops()))}
morphism.update(morphism2)
return morphism
```



---

Comment by git created at 2014-04-04 06:56:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2014-04-04 06:58:05

Thanks for catching that, Rohan. I changed the rank=0 case as you suggested and removed the separate handling of rank=1.


---

Comment by jdemeyer created at 2014-10-17 14:03:26

Given that `BasisExchangeMatroid` and `BasisMatroid` both inherit from `Matroid`, there is no point in adding `cpdef _isomorphism(self, other)` in the `.pxd` files for those.

Also, what's the advantage of making `isomorphism()` (without underscore) a `cpdef` method as opposed to just `def`?


---

Comment by jdemeyer created at 2014-10-17 14:38:15

Changing status from needs_review to needs_info.


---

Comment by Rudi created at 2014-10-22 21:40:13

Replying to [comment:12 jdemeyer]:
> Given that `BasisExchangeMatroid` and `BasisMatroid` both inherit from `Matroid`, there is no point in adding `cpdef _isomorphism(self, other)` in the `.pxd` files for those.
> 
OK, I'll remove these then.

> Also, what's the advantage of making `isomorphism()` (without underscore) a `cpdef` method as opposed to just `def`?

We did not really think about this. But is there a disadvantage? Cpdef just allows cdef child classes to override the function. While I don't see why anyone would want that,  why make it impossible? These are slow, high-level functions, so a little pointer testing at the start of the function won't affect overall efficiency. 

I wanted to upload a patch but today sage -b exits with: 
"src/convert.c:1:0: error: unknown value '10.10' of -mmacosx-version-min 
scons: * * * [src/convert.os] Error 1"

I guess my OSX version is too new. 

So feel free to make these changes, or wait until I find another way to test + upload a patch.


---

Comment by Rudi created at 2015-05-04 10:53:03

I wanted to finish this up now that my OSX version is not too new anymore, but I get a new type of error when compiling the patch. 

RudiPeninghsMBP:sage rudi$ ./sage -b
Install file: "include/interrupt.h" as "/Users/rudi/Documents/Development/sage/local/include/csage/interrupt.h"
Install file: "include/ntl_wrap.h" as "/Users/rudi/Documents/Development/sage/local/include/csage/ntl_wrap.h"
gcc -o src/interrupt.os -c -fPIC -I/Users/rudi/Documents/Development/sage/local/include -I/Users/rudi/Documents/Development/sage/local/include/python2.7 -I/Users/rudi/Documents/Development/sage/local/include/NTL -Iinclude src/interrupt.c
g++ -o src/ZZ_pylong.os -c -fPIC -I/Users/rudi/Documents/Development/sage/local/include -I/Users/rudi/Documents/Development/sage/local/include/python2.7 -I/Users/rudi/Documents/Development/sage/local/include/NTL -Iinclude src/ZZ_pylong.cpp
In file included from src/ZZ_pylong.cpp:13:0:
include/ntl_wrap.h:255:35: error: using typedef-name 'NTL::mat_ZZ' after 'struct'
 EXTERN void mat_ZZ_SetDims(struct mat_ZZ* mZZ, long nrows, long ncols);
                                   ^
In file included from include/ntl_wrap.h:13:0,
                 from src/ZZ_pylong.cpp:13:
/Users/rudi/Documents/Development/sage/local/include/NTL/mat_ZZ.h:12:17: note: 'NTL::mat_ZZ' has a previous declaration here
 typedef Mat<ZZ> mat_ZZ;

Etcetera.

This happens only if I work on the branch related to this ticket, not the master. Can anyone try to compile this patch to confirm that this is related to the patch and not something else?


---

Comment by Stefan created at 2015-05-05 15:43:31

This is an old ticket. It'll probably build on the branch after you do a "make distclean" or something. Alternatively, you can merge the ticket with the current develop branch. The easiest way (as a reviewer) is to do

git trac try 15753

(assuming you have the git-trac command installed correctly). For working on the ticket, I'd probably stay on this branch, or look into rebasing (I'm still not sure what the policy is, read up on it in the developer manual).


---

Comment by git created at 2015-05-06 19:34:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-06 19:40:24

Thanks, Stefan, for pointing out that I should rebase. Very happy that this problem is out of the way.

I rebased, then made my final edits, and tried to push. Another merge was necessary before I could finally push. Hope it all worked out correctly.


---

Comment by Rudi created at 2015-05-06 19:40:24

Changing status from needs_info to needs_review.


---

Comment by Stefan created at 2015-05-07 22:32:30

Two minor comments and a question:

* In BasisExchangeMatroid._is_isomorphic you changed four lines in the EXAMPLES section to remove BasisMatroid conversions. While today that doesn't matter, I would prefer to keep those to ensure that this file's version of the isomorphism test gets used, instead of some subclass's file.

* In Matroid._isomorphism you didn't indent the EXAMPLES block.

Fix those two things and the code gets a positive review from me.

One remark though: in Sage's graph class, there is a fairly common idiom to have an option in the test methods of the form `certificate=True/False`. When set to True, the function returns `(True, f)` if an isomorphism f is found, and `(False, )` otherwise. I'm not saying we should follow this here (isomorphism is important enough to be its own function), but we may want to consider it for other test methods.


---

Comment by git created at 2015-05-08 19:52:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-08 19:53:52

Replying to [comment:19 Stefan]:
> Two minor comments and a question:
> 
> * In BasisExchangeMatroid._is_isomorphic you changed four lines in the EXAMPLES section to remove BasisMatroid conversions. While today that doesn't matter, I would prefer to keep those to ensure that this file's version of the isomorphism test gets used, instead of some subclass's file.
> 
To make sure that this file's version of the isomorphism test eventually gets used (and in particular, not BasisMatroid._is_isomorphic), I put back the BasisMatroid conversions for just one of each pair of matroids. 
 

> * In Matroid._isomorphism you didn't indent the EXAMPLES block.

I did so now.


> One remark though: in Sage's graph class, there is a fairly common idiom to have an option in the test methods of the form `certificate=True/False`. When set to True, the function returns `(True, f)` if an isomorphism f is found, and `(False, )` otherwise. I'm not saying we should follow this here (isomorphism is important enough to be its own function), but we may want to consider it for other test methods.

I'll keep it in mind.  
----
New commits:
----
New commits:


---

Comment by Stefan created at 2015-05-11 15:53:37

This one's good to go!


---

Comment by Stefan created at 2015-05-11 15:53:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-13 11:33:41

Resolution: fixed
