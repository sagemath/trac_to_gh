# Issue 30412: Reimplement "sage -p SPKG" as "make SPKG-no-deps"

archive/issues_030412.json:
```json
{
    "body": "CC:  @jhpalmieri @orlitzky @kliem @vbraun\n\nMaking this change will allow us to remove the last use of `SAGE_LOGS` from `src/`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30649\n\n",
    "created_at": "2020-09-24T02:57:53Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Reimplement \"sage -p SPKG\" as \"make SPKG-no-deps\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30412",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jhpalmieri @orlitzky @kliem @vbraun

Making this change will allow us to remove the last use of `SAGE_LOGS` from `src/`.

Issue created by migration from https://trac.sagemath.org/ticket/30649





---

archive/issue_events_079712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79712"
}
```



---

archive/issue_comments_433302.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-19T21:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433302",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433303.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-01-19T21:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433303",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_433304.json:
```json
{
    "body": "I think that this does not behave according to the documentation: \"Options are the same as for the -i command.\" For example `./sage -p -c bzip2` does not run the test suite, and `./sage -p -s biopython` does not preserve the build directory.",
    "created_at": "2021-01-19T23:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433304",
    "user": "https://github.com/jhpalmieri"
}
```

I think that this does not behave according to the documentation: "Options are the same as for the -i command." For example `./sage -p -c bzip2` does not run the test suite, and `./sage -p -s biopython` does not preserve the build directory.



---

archive/issue_comments_433305.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-19T23:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433305",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_433306.json:
```json
{
    "body": "You are right, this needs more thought",
    "created_at": "2021-01-20T00:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433306",
    "user": "https://github.com/mkoeppe"
}
```

You are right, this needs more thought



---

archive/issue_comments_433307.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433307",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_079713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79713"
}
```



---

archive/issue_events_079714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79714"
}
```



---

archive/issue_comments_433308.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433308",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_079715.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79715"
}
```



---

archive/issue_events_079716.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79716"
}
```



---

archive/issue_comments_433309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-10-24T19:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_433310.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-24T19:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433311.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-24T19:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433311",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_433312.json:
```json
{
    "body": "The code looks simple and it works for me. `./sage -p -s ...` and `./sage -p -c ...` work. One possible issue I can see is the one mentioned in the description: users may need to use `./bootstrap` and/or `./configure` first. But I think this is okay.\n\nOne real issue: `src/sage/tests/cmdline.py` fails doctests. I think the test is kind of stupid, though (the second one):\n\n```\n    Test ``sage --info [packages]`` and the equivalent\n    ``sage -p --info --info [packages]`` (the doubling of ``--info``\n    is intentional, that option should be idempotent)::\n```\n\nWhy do we care whether `./sage -p --info --info PKG` works? `./sage --info --info PKG` doesn't work, so why should we care whether it works if we insert `-p`?",
    "created_at": "2021-11-02T04:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433312",
    "user": "https://github.com/jhpalmieri"
}
```

The code looks simple and it works for me. `./sage -p -s ...` and `./sage -p -c ...` work. One possible issue I can see is the one mentioned in the description: users may need to use `./bootstrap` and/or `./configure` first. But I think this is okay.

One real issue: `src/sage/tests/cmdline.py` fails doctests. I think the test is kind of stupid, though (the second one):

```
    Test ``sage --info [packages]`` and the equivalent
    ``sage -p --info --info [packages]`` (the doubling of ``--info``
    is intentional, that option should be idempotent)::
```

Why do we care whether `./sage -p --info --info PKG` works? `./sage --info --info PKG` doesn't work, so why should we care whether it works if we insert `-p`?



---

archive/issue_comments_433313.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-04T01:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433313",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_433314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-05T05:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433315.json:
```json
{
    "body": "I've cleaned this up a bit more, it's now all in `build/bin/sage-site`.\nNeeds a bit more work though",
    "created_at": "2021-11-05T05:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433315",
    "user": "https://github.com/mkoeppe"
}
```

I've cleaned this up a bit more, it's now all in `build/bin/sage-site`.
Needs a bit more work though



---

archive/issue_events_079717.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79717"
}
```



---

archive/issue_events_079718.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79718"
}
```



---

archive/issue_comments_433316.json:
```json
{
    "body": "Maybe this will resolve #22062: currently `sage -p --info sqlite` writes info to a log file as well as printing on the screen, and I think it should just print to the screen.",
    "created_at": "2022-01-05T23:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433316",
    "user": "https://github.com/jhpalmieri"
}
```

Maybe this will resolve #22062: currently `sage -p --info sqlite` writes info to a log file as well as printing on the screen, and I think it should just print to the screen.



---

archive/issue_comments_433317.json:
```json
{
    "body": "What work needs to be done here? This does indeed resolve #22062 because it disables the use of `sage -p --arg`.",
    "created_at": "2022-02-13T17:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433317",
    "user": "https://github.com/jhpalmieri"
}
```

What work needs to be done here? This does indeed resolve #22062 because it disables the use of `sage -p --arg`.



---

archive/issue_comments_433318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-13T17:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_433319.json:
```json
{
    "body": "Rebased on current beta.",
    "created_at": "2022-02-13T17:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433319",
    "user": "https://github.com/mkoeppe"
}
```

Rebased on current beta.



---

archive/issue_comments_433320.json:
```json
{
    "body": "I unfortunately don't recall what I meant in comment:19",
    "created_at": "2022-02-13T17:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433320",
    "user": "https://github.com/mkoeppe"
}
```

I unfortunately don't recall what I meant in comment:19



---

archive/issue_comments_433321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-13T17:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433322.json:
```json
{
    "body": "A (stupid) doctest fails, and we could just delete it:\n\n```diff\ndiff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py\nindex 681ff703e2..fccba3f12f 100644\n--- a/src/sage/tests/cmdline.py\n+++ b/src/sage/tests/cmdline.py\n@@ -210,9 +210,7 @@ def test_executable(args, input=\"\", timeout=100.0, pydebug_ignore_warnings=False\n         sage: ret  # optional - sage_spkg\n         0\n \n-    Test ``sage --info [packages]`` and the equivalent\n-    ``sage -p --info --info [packages]`` (the doubling of ``--info``\n-    is intentional, that option should be idempotent)::\n+    Test ``sage --info [packages]``::\n \n         sage: out, err, ret = test_executable([\"sage\", \"--info\", \"sqlite\"])  # optional - sage_spkg\n         sage: print(out)  # optional - sage_spkg\n@@ -225,17 +223,6 @@ def test_executable(args, input=\"\", timeout=100.0, pydebug_ignore_warnings=False\n         sage: ret  # optional - sage_spkg\n         0\n \n-        sage: out, err, ret = test_executable([\"sage\", \"-p\", \"--info\", \"--info\", \"sqlite\"])  # optional - sage_spkg\n-        sage: print(out)  # optional - sage_spkg\n-        sqlite...\n-        SQLite is a software library that implements a self-contained,\n-        serverless, zero-configuration, transactional SQL database engine.\n-        ...\n-        sage: err  # optional - sage_spkg\n-        ''\n-        sage: ret  # optional - sage_spkg\n-        0\n-\n     Test ``sage-run`` on a Python file, both with an absolute and with a relative path::\n \n         sage: dir = tmp_dir(); name = 'python_test_file.py'\n```\n\nUnless there is some script somewhere that routinely produces commands like `sage --info --info ...`?",
    "created_at": "2022-02-14T22:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433322",
    "user": "https://github.com/jhpalmieri"
}
```

A (stupid) doctest fails, and we could just delete it:

```diff
diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py
index 681ff703e2..fccba3f12f 100644
--- a/src/sage/tests/cmdline.py
+++ b/src/sage/tests/cmdline.py
@@ -210,9 +210,7 @@ def test_executable(args, input="", timeout=100.0, pydebug_ignore_warnings=False
         sage: ret  # optional - sage_spkg
         0
 
-    Test ``sage --info [packages]`` and the equivalent
-    ``sage -p --info --info [packages]`` (the doubling of ``--info``
-    is intentional, that option should be idempotent)::
+    Test ``sage --info [packages]``::
 
         sage: out, err, ret = test_executable(["sage", "--info", "sqlite"])  # optional - sage_spkg
         sage: print(out)  # optional - sage_spkg
@@ -225,17 +223,6 @@ def test_executable(args, input="", timeout=100.0, pydebug_ignore_warnings=False
         sage: ret  # optional - sage_spkg
         0
 
-        sage: out, err, ret = test_executable(["sage", "-p", "--info", "--info", "sqlite"])  # optional - sage_spkg
-        sage: print(out)  # optional - sage_spkg
-        sqlite...
-        SQLite is a software library that implements a self-contained,
-        serverless, zero-configuration, transactional SQL database engine.
-        ...
-        sage: err  # optional - sage_spkg
-        ''
-        sage: ret  # optional - sage_spkg
-        0
-
     Test ``sage-run`` on a Python file, both with an absolute and with a relative path::
 
         sage: dir = tmp_dir(); name = 'python_test_file.py'
```

Unless there is some script somewhere that routinely produces commands like `sage --info --info ...`?



---

archive/issue_comments_433323.json:
```json
{
    "body": "Yes, I'm in favor of deleting this nonsensical test",
    "created_at": "2022-02-15T05:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433323",
    "user": "https://github.com/mkoeppe"
}
```

Yes, I'm in favor of deleting this nonsensical test



---

archive/issue_comments_433324.json:
```json
{
    "body": "The issues in comment:6 have been fixed.\n----\nNew commits:",
    "created_at": "2022-02-15T22:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433324",
    "user": "https://github.com/jhpalmieri"
}
```

The issues in comment:6 have been fixed.
----
New commits:



---

archive/issue_comments_433325.json:
```json
{
    "body": "Any ideas on what else needs to be done with this?\n----\nNew commits:",
    "created_at": "2022-02-19T22:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433325",
    "user": "https://github.com/jhpalmieri"
}
```

Any ideas on what else needs to be done with this?
----
New commits:



---

archive/issue_comments_433326.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-02-19T22:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433326",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_433327.json:
```json
{
    "body": "I think it is ready",
    "created_at": "2022-02-19T22:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433327",
    "user": "https://github.com/mkoeppe"
}
```

I think it is ready



---

archive/issue_comments_433328.json:
```json
{
    "body": "The change from comment:30 and comment:31 seems to have been lost, and I am getting an error when I try to push. I don't want to mess up the rest of the branch, so it might be better if you do it:\n\n```diff\ndiff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py\nindex 681ff703e25..fccba3f12fb 100644\n--- a/src/sage/tests/cmdline.py\n+++ b/src/sage/tests/cmdline.py\n@@ -210,9 +210,7 @@ def test_executable(args, input=\"\", timeout=100.0, pydebug_ignore_warnings=False\n         sage: ret  # optional - sage_spkg\n         0\n \n-    Test ``sage --info [packages]`` and the equivalent\n-    ``sage -p --info --info [packages]`` (the doubling of ``--info``\n-    is intentional, that option should be idempotent)::\n+    Test ``sage --info [packages]``::\n \n         sage: out, err, ret = test_executable([\"sage\", \"--info\", \"sqlite\"])  # optional - sage_spkg\n         sage: print(out)  # optional - sage_spkg\n@@ -225,17 +223,6 @@ def test_executable(args, input=\"\", timeout=100.0, pydebug_ignore_warnings=False\n         sage: ret  # optional - sage_spkg\n         0\n \n-        sage: out, err, ret = test_executable([\"sage\", \"-p\", \"--info\", \"--info\", \"sqlite\"])  # optional - sage_spkg\n-        sage: print(out)  # optional - sage_spkg\n-        sqlite...\n-        SQLite is a software library that implements a self-contained,\n-        serverless, zero-configuration, transactional SQL database engine.\n-        ...\n-        sage: err  # optional - sage_spkg\n-        ''\n-        sage: ret  # optional - sage_spkg\n-        0\n-\n     Test ``sage-run`` on a Python file, both with an absolute and with a relative path::\n \n         sage: dir = tmp_dir(); name = 'python_test_file.py'\n```\n",
    "created_at": "2022-02-20T01:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433328",
    "user": "https://github.com/jhpalmieri"
}
```

The change from comment:30 and comment:31 seems to have been lost, and I am getting an error when I try to push. I don't want to mess up the rest of the branch, so it might be better if you do it:

```diff
diff --git a/src/sage/tests/cmdline.py b/src/sage/tests/cmdline.py
index 681ff703e25..fccba3f12fb 100644
--- a/src/sage/tests/cmdline.py
+++ b/src/sage/tests/cmdline.py
@@ -210,9 +210,7 @@ def test_executable(args, input="", timeout=100.0, pydebug_ignore_warnings=False
         sage: ret  # optional - sage_spkg
         0
 
-    Test ``sage --info [packages]`` and the equivalent
-    ``sage -p --info --info [packages]`` (the doubling of ``--info``
-    is intentional, that option should be idempotent)::
+    Test ``sage --info [packages]``::
 
         sage: out, err, ret = test_executable(["sage", "--info", "sqlite"])  # optional - sage_spkg
         sage: print(out)  # optional - sage_spkg
@@ -225,17 +223,6 @@ def test_executable(args, input="", timeout=100.0, pydebug_ignore_warnings=False
         sage: ret  # optional - sage_spkg
         0
 
-        sage: out, err, ret = test_executable(["sage", "-p", "--info", "--info", "sqlite"])  # optional - sage_spkg
-        sage: print(out)  # optional - sage_spkg
-        sqlite...
-        SQLite is a software library that implements a self-contained,
-        serverless, zero-configuration, transactional SQL database engine.
-        ...
-        sage: err  # optional - sage_spkg
-        ''
-        sage: ret  # optional - sage_spkg
-        0
-
     Test ``sage-run`` on a Python file, both with an absolute and with a relative path::
 
         sage: dir = tmp_dir(); name = 'python_test_file.py'
```




---

archive/issue_comments_433329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T01:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433330.json:
```json
{
    "body": "Sorry for dropping this! Here it is",
    "created_at": "2022-02-20T01:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433330",
    "user": "https://github.com/mkoeppe"
}
```

Sorry for dropping this! Here it is



---

archive/issue_comments_433331.json:
```json
{
    "body": "I propose the following two changes (the first one because this is already in `sage-site` and the option is handled twenty lines later, the second is just a typo not related to the changes here but one that you see when you run `./sage -p`):\n\n```diff\ndiff --git a/build/bin/sage-site b/build/bin/sage-site\nindex 78848c389e..f7164503b7 100755\n--- a/build/bin/sage-site\n+++ b/build/bin/sage-site\n@@ -129,7 +129,7 @@ if [ \"$1\" = '-standard' -o \"$1\" = \"--standard\" ]; then\n fi\n \n if [ \"$1\" = '-p' ]; then\n-    # If there are no further arguments, display usage help (via an option handled by sage-site)\n+    # If there are no further arguments, display usage help\n     if [ $# -eq 1 ]; then\n         set -- --info\n     else\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex 1af55f6671..4478bc7f2d 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -99,7 +99,7 @@ Options:\n    -y: automatically reply \"y\" for all prompts regarding\n        experimental and old-style packages; warning: there\n        is no guarantee that these packages will build correctly;\n-       use at your own risk\"\n+       use at your own risk\n    -n: automatically reply \"n\" for all prompts regarding\n        experimental and old-style packages\n    -o: allow fetching the package from its upstream URL\n```\n\nAlso for a future ticket: should `./sage -i` and `./sage -p` (with no further arguments) behave similarly? `./sage -i` builds some stuff, while `./sage -p` just prints a usage message and exits.",
    "created_at": "2022-02-20T04:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433331",
    "user": "https://github.com/jhpalmieri"
}
```

I propose the following two changes (the first one because this is already in `sage-site` and the option is handled twenty lines later, the second is just a typo not related to the changes here but one that you see when you run `./sage -p`):

```diff
diff --git a/build/bin/sage-site b/build/bin/sage-site
index 78848c389e..f7164503b7 100755
--- a/build/bin/sage-site
+++ b/build/bin/sage-site
@@ -129,7 +129,7 @@ if [ "$1" = '-standard' -o "$1" = "--standard" ]; then
 fi
 
 if [ "$1" = '-p' ]; then
-    # If there are no further arguments, display usage help (via an option handled by sage-site)
+    # If there are no further arguments, display usage help
     if [ $# -eq 1 ]; then
         set -- --info
     else
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index 1af55f6671..4478bc7f2d 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -99,7 +99,7 @@ Options:
    -y: automatically reply "y" for all prompts regarding
        experimental and old-style packages; warning: there
        is no guarantee that these packages will build correctly;
-       use at your own risk"
+       use at your own risk
    -n: automatically reply "n" for all prompts regarding
        experimental and old-style packages
    -o: allow fetching the package from its upstream URL
```

Also for a future ticket: should `./sage -i` and `./sage -p` (with no further arguments) behave similarly? `./sage -i` builds some stuff, while `./sage -p` just prints a usage message and exits.



---

archive/issue_comments_433332.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T19:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433333.json:
```json
{
    "body": "Replying to [comment:39 jhpalmieri]:\n> should `./sage -i` and `./sage -p` (with no further arguments) behave similarly? `./sage -i` builds some stuff, while `./sage -p` just prints a usage message and exits.\n\nI suppose `sage -p` could be reduced to just saying \"Nothing to do.\" instead of showing usage.",
    "created_at": "2022-02-20T19:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433333",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:39 jhpalmieri]:
> should `./sage -i` and `./sage -p` (with no further arguments) behave similarly? `./sage -i` builds some stuff, while `./sage -p` just prints a usage message and exits.

I suppose `sage -p` could be reduced to just saying "Nothing to do." instead of showing usage.



---

archive/issue_comments_433334.json:
```json
{
    "body": "And it's not clear if `sage -i` running `make all-build` is really useful, so we could consider changing this behavior too.\n\nBut as you say, that would be a future ticket.",
    "created_at": "2022-02-20T19:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433334",
    "user": "https://github.com/mkoeppe"
}
```

And it's not clear if `sage -i` running `make all-build` is really useful, so we could consider changing this behavior too.

But as you say, that would be a future ticket.



---

archive/issue_comments_433335.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-20T21:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433335",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433336.json:
```json
{
    "body": "Looks good to me. It has some advantages that I didn't expect. Without this branch:\n\n```\n% ./sage -p pytest\nError: Installing old-style SPKGs is no longer supported\n```\n\nwhereas with this branch, `./sage -p pytest` works fine (although it says \"Successfully installed iniconfig-1.1.1 pytest-7.0.1\" so it is still doing some dependency checking \u2014\u00a0probably `pip` or similar, not Sage's build system).",
    "created_at": "2022-02-20T21:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433336",
    "user": "https://github.com/jhpalmieri"
}
```

Looks good to me. It has some advantages that I didn't expect. Without this branch:

```
% ./sage -p pytest
Error: Installing old-style SPKGs is no longer supported
```

whereas with this branch, `./sage -p pytest` works fine (although it says "Successfully installed iniconfig-1.1.1 pytest-7.0.1" so it is still doing some dependency checking — probably `pip` or similar, not Sage's build system).



---

archive/issue_comments_433337.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-02-20T22:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433337",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_079719.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-21T21:56:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30412#event-79719"
}
```



---

archive/issue_comments_433338.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-21T21:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30412#issuecomment-433338",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
