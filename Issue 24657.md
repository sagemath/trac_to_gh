# Issue 24657: add super RSK algorithm to sage

Issue created by migration from https://trac.sagemath.org/ticket/24894

Original creator: @MareoRaft

Original creation time: 2018-03-03 18:26:06

CC:  sage-combinat tscrim aschilling darij mantepse bump brubaker ghseeli

Keywords: super RSK, super, RSK, Haiman

New trac user here.  I have implemented the super RSK algorithm (as described in https://arxiv.org/pdf/1711.00420v1.pdf).  I would like to contribute it to sage.

I would first like to talk about where the code should be organizationally.  There is already a `combinat/tableau.py` containing the Tableau object which has a traditional RSK bump method.  There is also a `combinat/rsk.py` module with the complete RSK algorithm and 1-2 variants.

The interesting thing is that the `rsk` module does not actually use the bump method from the `tableau` module, but rather re-implements it.  I believe this should be changed (to eliminate redundancy).  Also, actual Tableau objects are not used in the algorithm, but rather a list of lists (until the very end, when they are converted to Tableau).  I believe this also should be changed.

So my *proposal* for organization is to make these changes, and then add my own super_rsk_bump method to the Tableau object, and then add my own super rsk insertion option to the `rsk` module, which would run the super rsk algorithm and call the super_rsk_bump method on the Tableau as needed.

The code I have *currently* does *not* follow the above proposal because I wrote it before discovering the `tableau` module.  But before I waste time reorganizing everything, I wanted to get your input.  I will include the code I have now as an attachment, even though it is unfinished.  It is a modification of the `rsk` module.

The super RSK doesn't use integers as tableau entries but rather an alphabet where some numbers have carat symbols over them and some numbers do not.  You can see that I implemented this alphabet with a linear ordering as the class Letter.  I'm wondering if this alphabet might already exist elsewhere on sage, so I don't make redundant code.  Also, I'm wondering where I should put this class, since it doesn't seem to belong in the rsk module.  Probably in its own dedicated file?

Thank you for your input.  I will strive to follow your recommendations thoroughly.



---

Attachment

Welcome to Sage.

+1 for adding this. I saw the paper and have wanted to compare it with the bumping procedure of Benkart-Kang-Kashiwara (https://arxiv.org/abs/math/9810092, Sec. 4.5), of which the author seems to be unaware (actually, I probably should e-mail him and ask...). I'm cc-ing a bunch of people who might be interested in this ticket.

IMO, this should go in the `rsk` module as it is an RSK(-type) variant. I believe the letters are the same as what was recently done for the shifted tableaux (#22921), so you probably could use those.

> The interesting thing is that the `rsk` module does not actually use the bump method from the tableau module, but rather re-implements it. I believe this should be changed (to eliminate redundancy).

-1 the code within the `rsk` is **much** faster than using the `Tableau.bump()` (no intermediate objects in particular).

> Also, actual Tableau objects are not used in the algorithm, but rather a list of lists (until the very end, when they are converted to Tableau). I believe this also should be changed. 

-1 lists (of lists) are ~~easier to~~ meant to be manipulated.

Now while I understand why you want to break things into these localized functions, but you are passing far too much data around to do so. Also, my quick impression is that it is actually making the code more complicated because you are forcing yourself to work in either a row or column format.  In particular, you are not using your data structure efficiently nor taking advantage of the semistandardness by pulling out columns into a list. It might be time to have each of the bumping rules be implemented as classes, but I think we should refactor this code first and see what we get before doing that level of work.

<shameless_plug>You might be interested in coming to [SageDays`@`ICERM](https://icerm.brown.edu/topical_workshops/tw18-1-sage/); there is funding available for participants.</shameless_plug>


---

Comment by aschilling created at 2018-03-04 01:37:27

Welcome to Sage!

Martin Rubey has recently implemented an insertion related to this in #23896. It is also planned to generalize this to the semistandard insertions #24659. He uses growth diagrams. 

In the code for shifted tableau, Kirill internally allowed entries 3.5 etc for primed entries. Perhaps something similar would work for you?


---

Comment by @MareoRaft created at 2018-03-04 19:10:47

Replying to [comment:1 tscrim]:

Since I am new, I will aim to follow whatever guidelines you give me:

NEW PLAN:

  1. I will leave the original *standard* RSK alone (with the exception of adding one or two "if insertion=='sRSK'" statements into the RSK function that will call my specialized sRSK algorithm).  So nobody has to worry about the current functionality changing or becoming less efficient.

  2. I will leave my sRSK bump function in the `rsk`module (I guess a user who wants to do a single bump on a Tableau can import my function and then do `sRSK_bump(P.to_list(), Q.to_list())` or similar.

  3. The classes Letter, BiLetter, and BiWord will be moved to their very own module.  (This brings a new question.  I have viewed the ShiftedPrimedTableau object from #22921 and it does indeed use the same alphabet and total ordering as the letters I am using.  However, that code doesn't implement a class for these letters, but rather preprocesses the input in some way.  So once he is finished with his code, I would suggest that his preprocessing code can actually be moved into my module and then his code can call my module or something.  But anyway, I don't see why our two codes should interfere until after they are both independently added to Sage, so as not to complicate matters.)

Note: To be clear, my code does *not* use Tableau objects currently.  It was an idea, but since you do not recommend it, I will leave it as-is with direct list manipulation.

NEW QUESTION:

How do I submit my code changes?  I have cloned the git repo.  I'm assuming I should create a branch (but should I name it) and then add my commits to that branch.  After that, how do I add my branch to this proposal?


---

Comment by @MareoRaft created at 2018-03-04 19:12:30

Replying to [comment:2 aschilling]:

Does the generalization you speak of generalize the superRSK algorithm too?  (Because then my code is useless)


---

Comment by tscrim created at 2018-03-05 03:19:32

Replying to [comment:3 gh-MareoRaft]:
> Replying to [comment:1 tscrim]:
> 
> Since I am new, I will aim to follow whatever guidelines you give me:

Don't be afraid to propose changes. Just because we may not like them, it doesn't mean it isn't good to challenge our assumptions and some of them can be clear improvements.

> NEW PLAN:
> 
>   1. I will leave the original *standard* RSK alone (with the exception of adding one or two "if insertion=='sRSK'" statements into the RSK function that will call my specialized sRSK algorithm).  So nobody has to worry about the current functionality changing or becoming less efficient.
> 
>   2. I will leave my sRSK bump function in the `rsk`module (I guess a user who wants to do a single bump on a Tableau can import my function and then do `sRSK_bump(P.to_list(), Q.to_list())` or similar.

I think you should consider adding a class for super tableaux. That way you could start with a tableau and do a (series of) insertion(s) in a natural way and so the output has a clear object type. It will also make it much easier for performing the inverse as the `inverse_RSK` will know from the type of the input that it should do sRSK.

>   3. The classes Letter, BiLetter, and BiWord will be moved to their very own module.  (This brings a new question.  I have viewed the ShiftedPrimedTableau object from #22921 and it does indeed use the same alphabet and total ordering as the letters I am using.  However, that code doesn't implement a class for these letters, but rather preprocesses the input in some way.  So once he is finished with his code, I would suggest that his preprocessing code can actually be moved into my module and then his code can call my module or something.  But anyway, I don't see why our two codes should interfere until after they are both independently added to Sage, so as not to complicate matters.)

I am not sure where you're reading. There is a dedicated letter class `class PrimedEntry(SageObject)`. The tableau class has to (pre)process its input into these letters, but that is a necessary condition. Moreover, #22921 has been merged into Sage and is available in the latest beta. Since there is another use for this alphabet, +1 on extracting that part and the necessary other components into a dedicated module.

> Note: To be clear, my code does *not* use Tableau objects currently.  It was an idea, but since you do not recommend it, I will leave it as-is with direct list manipulation.

+1 on this. Just return some tableau objects.

> NEW QUESTION:
> 
> How do I submit my code changes?  I have cloned the git repo.  I'm assuming I should create a branch (but should I name it) and then add my commits to that branch.  After that, how do I add my branch to this proposal?

I generally follow http://doc.sagemath.org/html/en/developer/manual_git.html and manually push/pull from the trac server and update the branches. You will need to add your ssh key to your _trac_ account, and then push to the trac server. Once that is done, just set the branch field on this ticket and change to "needs_review". Let me know if you need more specific instructions.

ADDENDUM - You should upgrade to the latest beta (on the `develop` branch) and base your branch off of that.


---

Comment by git created at 2018-03-05 16:04:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-05 17:10:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @MareoRaft created at 2018-03-05 17:25:23

Replying to [comment:5 tscrim]:

Please see my commit.  I left the original RSK algo unaltered (but I moved it into _RSK), even though my algo generalizes it so we could just as easily run my algo (_sRSK) only.

You can see I moved all my code pertaining to Letters, BiLetters, and BiWords into a separate file called alphabet.py (I will rename it appropriately soon).  I guess this is the major stuff that needs to change now, because as you said there is already a `PrimedEntry(SageObject)` class that is related.  As well as the related `ShiftedPrimedTableau` class from #22921.

I will deal with making a SuperTableau class after dealing with the Primed stuff.

NEW PROBLEM:

I don't know how to run the test runner on my code.  I am within the git repo on my branch, and I run `sage -t rsk.py`, and this results in the error '_is_horizontal() is not defined' even though it is.  I think this has to do with the fact that I haven't successfully run `make` to build my official-git-repo version of sage, even though I have sage installed elsewhere on my computer.

If I copy and paste my code (from both this file and the alphabet.py file into a single file `myrsk.py` elsewhere on my computer) and then run `sage -t myrsk.py` on THAT, I not only get past the error but with a few minor tweaks I get all tests passing.


---

Comment by tscrim created at 2018-03-05 21:55:42

You need to import the parts that are not included in the global namespace. Basically, copy and paste in your tests into a (fresh) Sage session, you will get the same errors. You will have to do a `from foo import bar type statement and add that to the top of each of your functions.


---

Comment by @MareoRaft created at 2018-03-08 20:17:46

The `PrimedEntry` class does indeed serve the same purpose as the `Letter` class I had before, so I will be using the PrimedEntry class.

I need to make a `SemistandardPrimedTableau` which is just a semistandard tableau whose entries are primed instead of integers.  To achieve this, I will make a class called `GeneralizedSemistandardTableau` which is just like SemistandardTableau but does not require the entries to be integers.  Then SemistandardTableau will become a subclass of the generalized class with the only alteration being the enforcement of integers, and likewise SemistandardPrimedTableau will be a subclass of the generalized class with the only alteration being the enforcement of primed entries.


---

Comment by @MareoRaft created at 2018-03-09 16:43:18

New commits:


---

Comment by @MareoRaft created at 2018-03-09 17:02:10

I have no idea when this `__classcall_private__` method runs or why it exists, but here is what the `SemistandardTableau` class will look like as a subclass of `GeneralizedSemistandardTableau`:


```div style="font-size: 100%"
  {{{#!python
  class SemistandardTableau(GeneralizedSemistandardTableau):
    @staticmethod
    def __classcall_private__(self, t):
        super(SemistandardTableau, self).__classcall_private__(self, t)

        # Check entried are integers
        if not all(isinstance(c,(int,Integer)) for row in t for c in row):
            raise ValueError("entries must be integers"%t)

    def __init__(self, parent, t):
        super(SemistandardTableau, self).__init__(parent, t)

        # Check the entries of t are positive integers
        from sage.sets.positive_integers import PositiveIntegers
        PI = PositiveIntegers()
        for row in t:
            if any(c not in PI for c in row):
                raise ValueError("the entries of a semistandard tableau must be integers")
  }}}
```



---

Comment by tscrim created at 2018-03-09 21:32:40

Sorry I didn't get a chance to comment on this ticket yesterday. Your proposed hierarchy in comment:12 sounds good.

So `__classcall_private__` is there to take the input parameters and standardize them (e.g., take a list and make it into a tuple). For parents, this is so you cannot have multiple copies of the same set within Sage. (This is more towards deep, internal to Sage code reasons and more important for things like rings, but it does retain some uses in combinatorics.) In this instance, it is so we can use `Tableau` like a normal class, but it automatically creates the parent. However, you cannot super-call the `__classcall_private__`.

TL;DR You can just remove it, and I can add in the appropriate things once you finish the first version.


---

Comment by @MareoRaft created at 2018-03-09 22:22:44

Should my functions in general not edit their inputs inplace?  For example, should `bump(p, q)` leave its inputs alone and output a NEW p and q?  I think the answer is yes to be consistent with other sage things, but I would like confirmation before I bother changing it.


---

Comment by tscrim created at 2018-03-09 22:28:14

Replying to [comment:16 gh-MareoRaft]:
> Should my functions in general not edit their inputs inplace?  For example, should `bump(p, q)` leave its inputs alone and output a NEW p and q?  I think the answer is yes to be consistent with other sage things, but I would like confirmation before I bother changing it.

It depends on where they are and their use. If it is, say, an internal function of RSK that the user should not see, then no, it can edit their input inplace (assuming you have copied it into a mutable format). If it is a `bump` method of the tableau class, then yet, it should _not_ edit its input (i.e., for `T.bump()`, it should not edit `T`).


---

Comment by git created at 2018-03-09 23:11:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @MareoRaft created at 2018-03-09 23:19:34

`@`tscrim:

Perhaps you would like to make the necessary changes in the `tableau.py` file now?  I think you know what is going on there more than me.  I think the code is really close now, and it may soon be time to just touch things up and address the little stuff.


---

Comment by tscrim created at 2018-03-11 03:44:02

Yea, I can do that. However, I probably won't get to it until Monday.


---

Comment by @MareoRaft created at 2018-03-12 16:28:35

I'm getting an import error for `permutation`.  I *think* it's due to circular dependency structure.  permutation depends on rsk, rsk depends on tableau, and tableau depends on permutation.

If this is the case, I would question why permutation depends on rsk.  The RSK algorithm is performed on *tableau*, not on permutations.  Arguably, if somebody wanted to perform rsk on a 'permutation', then they should be doing something like `p = permutation([1,2,3]); Tableau(p).rsk`.


---

Comment by @MareoRaft created at 2018-03-12 21:26:18

I realized that there are more restrictions on SuperTableau than I originally thought.  I will push a new commit shortly with changes to `tableau.py` that will use multiple inheritance so we can define all these different types of tableau easily.


---

Comment by git created at 2018-03-12 21:58:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 03:07:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 03:24:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 03:36:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-03-21 12:17:45

I've been too busy to take a good look at this, but I just wanted you to know that I haven't forgotten about it.


---

Comment by @MareoRaft created at 2018-04-02 04:39:46

No problem!


---

Comment by tscrim created at 2018-04-02 04:46:59

As an update, Darij and I have been talking about refactoring the RSK as a whole to follow a similar design pattern as growth diagrams (see #25070). This had actually been on my mind for awhile (I think I mentioned this above). The current design just is not scaling. So I will be doing some experimenting based on your code. Please bear with me; I appreciate your patience.


---

Comment by @MareoRaft created at 2018-04-22 23:11:23

No problem, Travis.  I'm sure you will do a very good job.


---

Comment by @ChamanAgrawal created at 2019-07-10 20:55:04

Last 10 new commits:


---

Comment by @ChamanAgrawal created at 2019-07-10 20:55:04

Changing keywords from "super RSK, super, RSK, Haiman" to "gsoc19, super RSK, super, RSK, Haiman".


---

Comment by git created at 2019-07-13 16:35:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-14 20:30:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-16 05:42:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-16 19:53:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-18 04:28:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-18 13:56:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-19 15:42:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-23 17:45:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-23 19:49:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ChamanAgrawal created at 2019-07-23 19:49:49

Changing status from new to needs_review.


---

Comment by git created at 2019-07-24 10:49:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-24 10:51:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 22:00:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 22:08:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 09:53:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-01 17:44:26

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2019-08-05 16:01:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-08-23 02:09:51

I have added a doctest for the inverse map, which is currently failing on a semistandard tableaux:

```
sage -t --warn-long src/sage/combinat/rsk.py
**********************************************************************
File "src/sage/combinat/rsk.py", line 1984, in sage.combinat.rsk.RuleSuperRSK
Failed example:
    RSK_inverse(P, Q, insertion=RSK.rules.superRSK)
Expected:
    [[1', 1, 2', 2, 3', 3', 3', 3], [3, 2', 3, 2, 3', 3', 1', 2]]
Got:
    [[1', 1, 2', 2, 3', 3', 3], [3, 2', 3, 2, 3', 1', 2]]
```

There is a missing `[3', 3']` pair, so there is definitely a bug somewhere.

Also, I have added a few more doctests and done a little cleanup. I will do further review once the bug is fixed.
----
New commits:


---

Comment by tscrim created at 2019-08-23 02:09:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-08-23 05:20:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ChamanAgrawal created at 2019-08-23 05:24:28

Replying to [comment:52 tscrim]:
> I have added a doctest for the inverse map, which is currently failing on a semistandard tableaux:
> {{{
> sage -t --warn-long src/sage/combinat/rsk.py
> **********************************************************************
> File "src/sage/combinat/rsk.py", line 1984, in sage.combinat.rsk.RuleSuperRSK
> Failed example:
>     RSK_inverse(P, Q, insertion=RSK.rules.superRSK)
> Expected:
>     [[1', 1, 2', 2, 3', 3', 3', 3], [3, 2', 3, 2, 3', 3', 1', 2]]
> Got:
>     [[1', 1, 2', 2, 3', 3', 3], [3, 2', 3, 2, 3', 1', 2]]
> }}}
> There is a missing `[3', 3']` pair, so there is definitely a bug somewhere.

I have fixed it, it was because in superRSK the recording tableau columns can have repeated elements since we make upper row entries primed in case of column insertion.


---

Comment by @ChamanAgrawal created at 2019-08-23 05:24:55

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-08-23 05:53:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-08-23 05:54:51

Thanks. I finished my review, and my changes include some other doc cleanup and standardization that I noticed needed to be done from doing the review. If my changes are good, then you can set a positive review.


---

Comment by git created at 2019-08-23 06:57:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-26 00:14:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-26 05:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-30 02:52:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-08 18:19:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ChamanAgrawal created at 2019-09-08 18:25:55

This looks good to me. If there are no patch bot errors, I think this can be a positive review.


---

Comment by git created at 2019-09-08 21:53:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @MareoRaft created at 2019-09-08 22:21:15

Travis and Chaman, would you mind adding my name also at the top of the rsk.py file, as it contains some of my code?  I forgot to add it in my initial commits.  By the way, this all looks really great.  I had forgotten about this old ticket.


---

Comment by git created at 2019-09-08 22:46:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-09-09 22:43:18

Done, and now the patchbot is (morally) green.


---

Comment by git created at 2019-09-17 20:28:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-09-18 01:15:09

Green patchbot (still).


---

Comment by @ChamanAgrawal created at 2019-09-18 08:25:31

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-03 17:58:26

Resolution: fixed
