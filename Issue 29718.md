# Issue 29718: Reduction from dancing links instance to MILP instance

archive/issues_029718.json:
```json
{
    "body": "CC:  @slel\n\nFollowing #29338, the proposed branch adds 2 new methods which allows what follows:\n\n\n```\nsage: from sage.combinat.matrices.dancing_links import dlx_solver\nsage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]\nsage: d = dlx_solver(rows)\nsage: d.one_solution()\n[1, 0]\nsage: d.one_solution_using_milp_solver()\n[0, 1]\nsage: d.one_solution_using_milp_solver('Gurobi')\n[2, 3]\nsage: d.one_solution_using_milp_solver('CLPEX')\n[2, 3]\netc.\n```\n\n\nThis is based on the new method:\n\n```\nsage: p,x = d.to_milp_solver()\nsage: p\nBoolean Program (no objective, 6 variables, 6 constraints)\nsage: x\nMIPVariable of dimension 1 \n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29955\n\n",
    "created_at": "2020-06-24T13:04:55Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Reduction from dancing links instance to MILP instance",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29718",
    "user": "@seblabbe"
}
```
CC:  @slel

Following #29338, the proposed branch adds 2 new methods which allows what follows:


```
sage: from sage.combinat.matrices.dancing_links import dlx_solver
sage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]
sage: d = dlx_solver(rows)
sage: d.one_solution()
[1, 0]
sage: d.one_solution_using_milp_solver()
[0, 1]
sage: d.one_solution_using_milp_solver('Gurobi')
[2, 3]
sage: d.one_solution_using_milp_solver('CLPEX')
[2, 3]
etc.
```


This is based on the new method:

```
sage: p,x = d.to_milp_solver()
sage: p
Boolean Program (no objective, 6 variables, 6 constraints)
sage: x
MIPVariable of dimension 1 
```


Issue created by migration from https://trac.sagemath.org/ticket/29955





---

archive/issue_comments_422145.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-24T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422145",
    "user": "@seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422146.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-24T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422146",
    "user": "@seblabbe"
}
```

New commits:



---

archive/issue_comments_422147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T13:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422147",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422148.json:
```json
{
    "body": "I found two issues with the doctests. I'll post them as two separate comments.\n\nFirst, there is a doctest error (all the variables in the constraints are named `x_` instead of `x_0`, `x_1`, etc.).\n\n```\nRunning doctests with ID 2020-06-24-13-55-51-1a738b74.\nGit branch: u/slabbe/29955\nUsing --optional=build,cmake,cryptominisat,dochtml,glucose,pycosat,sage,sage_numerical_backends_gurobi\nDoctesting 1 file.\nsage -t --warn-long 44.8 dancing_links.pyx\n**********************************************************************\nFile \"dancing_links.pyx\", line 1037, in sage.combinat.matrices.dancing_links.dancing_linksWrapper.to_milp_solver\nFailed example:\n    p.show()\nExpected:\n    Maximization:\n    <BLANKLINE>\n    <BLANKLINE>\n    Constraints:\n      one 1 in 0-th column: 1.0 <= x_0 + x_1 <= 1.0\n      one 1 in 1-th column: 1.0 <= x_0 + x_2 <= 1.0\n      one 1 in 2-th column: 1.0 <= x_0 + x_1 <= 1.0\n      one 1 in 3-th column: 1.0 <= x_3 <= 1.0\n    Variables:\n      x_0 is a boolean variable (min=0.0, max=1.0)\n      x_1 is a boolean variable (min=0.0, max=1.0)\n      x_2 is a boolean variable (min=0.0, max=1.0)\n      x_3 is a boolean variable (min=0.0, max=1.0)\nGot:\n    Maximization:\n    <BLANKLINE>\n    <BLANKLINE>\n    Constraints:\n      one 1 in 0-th column: 1.0 <= x_ + x_ <= 1.0\n      one 1 in 1-th column: 1.0 <= x_ + x_ <= 1.0\n      one 1 in 2-th column: 1.0 <= x_ + x_ <= 1.0\n      one 1 in 3-th column: 1.0 <= x_ <= 1.0\n    Variables:\n      x_ = x_0 is a boolean variable (min=0.0, max=1.0)\n      x_ = x_1 is a boolean variable (min=0.0, max=1.0)\n      x_ = x_2 is a boolean variable (min=0.0, max=1.0)\n      x_ = x_3 is a boolean variable (min=0.0, max=1.0)\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.combinat.matrices.dancing_links.dancing_linksWrapper.to_milp_solver\n    [250 tests, 1 failure, 3.73 s]\n----------------------------------------------------------------------\nsage -t --warn-long 44.8 dancing_links.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 3.8 seconds\n    cpu time: 3.2 seconds\n    cumulative wall time: 3.7 seconds\n```\n",
    "created_at": "2020-06-24T18:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422148",
    "user": "@saliola"
}
```

I found two issues with the doctests. I'll post them as two separate comments.

First, there is a doctest error (all the variables in the constraints are named `x_` instead of `x_0`, `x_1`, etc.).

```
Running doctests with ID 2020-06-24-13-55-51-1a738b74.
Git branch: u/slabbe/29955
Using --optional=build,cmake,cryptominisat,dochtml,glucose,pycosat,sage,sage_numerical_backends_gurobi
Doctesting 1 file.
sage -t --warn-long 44.8 dancing_links.pyx
**********************************************************************
File "dancing_links.pyx", line 1037, in sage.combinat.matrices.dancing_links.dancing_linksWrapper.to_milp_solver
Failed example:
    p.show()
Expected:
    Maximization:
    <BLANKLINE>
    <BLANKLINE>
    Constraints:
      one 1 in 0-th column: 1.0 <= x_0 + x_1 <= 1.0
      one 1 in 1-th column: 1.0 <= x_0 + x_2 <= 1.0
      one 1 in 2-th column: 1.0 <= x_0 + x_1 <= 1.0
      one 1 in 3-th column: 1.0 <= x_3 <= 1.0
    Variables:
      x_0 is a boolean variable (min=0.0, max=1.0)
      x_1 is a boolean variable (min=0.0, max=1.0)
      x_2 is a boolean variable (min=0.0, max=1.0)
      x_3 is a boolean variable (min=0.0, max=1.0)
Got:
    Maximization:
    <BLANKLINE>
    <BLANKLINE>
    Constraints:
      one 1 in 0-th column: 1.0 <= x_ + x_ <= 1.0
      one 1 in 1-th column: 1.0 <= x_ + x_ <= 1.0
      one 1 in 2-th column: 1.0 <= x_ + x_ <= 1.0
      one 1 in 3-th column: 1.0 <= x_ <= 1.0
    Variables:
      x_ = x_0 is a boolean variable (min=0.0, max=1.0)
      x_ = x_1 is a boolean variable (min=0.0, max=1.0)
      x_ = x_2 is a boolean variable (min=0.0, max=1.0)
      x_ = x_3 is a boolean variable (min=0.0, max=1.0)
**********************************************************************
1 item had failures:
   1 of   8 in sage.combinat.matrices.dancing_links.dancing_linksWrapper.to_milp_solver
    [250 tests, 1 failure, 3.73 s]
----------------------------------------------------------------------
sage -t --warn-long 44.8 dancing_links.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 3.8 seconds
    cpu time: 3.2 seconds
    cumulative wall time: 3.7 seconds
```




---

archive/issue_comments_422149.json:
```json
{
    "body": "Second, the answer I get from the following doctest does not agree with the answer specified in the doctest.\n\n```\nsage: from sage.combinat.matrices.dancing_links import dlx_solver\nsage: rows = [[0,1,2], [0,2], [1], [3]]\nsage: d = dlx_solver(rows)\nsage: d.to_milp_solver(\"gurobi\")\n(Boolean Program (no objective, 4 variables, 4 constraints),\n MIPVariable of dimension 1)\n```\n\nThe doctest says the above should be:\n\n```\nsage: d.to_milp_solver('gurobi')   # optional gurobi sage_numerical_backends_gurobi\nBoolean Program (no objective, 4 variables, 4 constraints)\n```\n\nI'm not sure why this error is not caught by the doctest system.",
    "created_at": "2020-06-24T18:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422149",
    "user": "@saliola"
}
```

Second, the answer I get from the following doctest does not agree with the answer specified in the doctest.

```
sage: from sage.combinat.matrices.dancing_links import dlx_solver
sage: rows = [[0,1,2], [0,2], [1], [3]]
sage: d = dlx_solver(rows)
sage: d.to_milp_solver("gurobi")
(Boolean Program (no objective, 4 variables, 4 constraints),
 MIPVariable of dimension 1)
```

The doctest says the above should be:

```
sage: d.to_milp_solver('gurobi')   # optional gurobi sage_numerical_backends_gurobi
Boolean Program (no objective, 4 variables, 4 constraints)
```

I'm not sure why this error is not caught by the doctest system.



---

archive/issue_comments_422150.json:
```json
{
    "body": "Replying to [comment:5 saliola]:\n> I'm not sure why this error is not caught by the doctest system.\n\nI just learned about the `--show-skipped` option for `sage -t`. Since `gurobi` is not a sage optional package, I had to specify it explicitly with the `---optional` command. If I run \n\n```\nsage -t --optional=sage,gurobi,sage_numerical_backends_gurobi dancing_links.pyx\n```\n\nthen I see two doctest failures.",
    "created_at": "2020-06-24T18:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422150",
    "user": "@saliola"
}
```

Replying to [comment:5 saliola]:
> I'm not sure why this error is not caught by the doctest system.

I just learned about the `--show-skipped` option for `sage -t`. Since `gurobi` is not a sage optional package, I had to specify it explicitly with the `---optional` command. If I run 

```
sage -t --optional=sage,gurobi,sage_numerical_backends_gurobi dancing_links.pyx
```

then I see two doctest failures.



---

archive/issue_comments_422151.json:
```json
{
    "body": "I made some changes to address the second doctest problem above and I've updated the branch. Hopefully I didn't mess up....\n----\nNew commits:",
    "created_at": "2020-06-24T18:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422151",
    "user": "@saliola"
}
```

I made some changes to address the second doctest problem above and I've updated the branch. Hopefully I didn't mess up....
----
New commits:



---

archive/issue_comments_422152.json:
```json
{
    "body": "OK, it seems I was able to correctly create and set a public branch for this ticket. Any ideas on what to do for the doctest for `p.show()`?",
    "created_at": "2020-06-24T18:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422152",
    "user": "@saliola"
}
```

OK, it seems I was able to correctly create and set a public branch for this ticket. Any ideas on what to do for the doctest for `p.show()`?



---

archive/issue_comments_422153.json:
```json
{
    "body": "Yes indeed, I wanted to write\n\n```\nsage: p,x = d.to_milp_solver(solver='Gurobi')\nsage: p\nBoolean Program (no objective, 6 variables, 6 constraints)\nsage: x\nMIPVariable of dimension 1 \n```\n\n...as you fixed it is okay as well.\n\nOn another machine running a more recent version of Sage, with the current public branch, I get:\n\n```\n$ sage -version\nSageMath version 9.2.beta1, Release Date: 2020-06-13\n$ sage -bt --optional=sage,optional,external --show-skipped src/sage/combinat/matrices/dancing_links.pyx\n...\nsage -t src/sage/combinat/matrices/dancing_links.pyx\n    3 gurobi tests not run\n    0 tests not run because we ran out of time\n    [250 tests, 2.26 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nExternal software detected for doctesting: \n```\n\n\n(The licence of my Gurobi licence just expired. I need to renew it.)\n\nSo the error with the `x_` in the `p.show()` is weird. Are you able to reproduce it on another machine?",
    "created_at": "2020-06-24T19:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422153",
    "user": "@seblabbe"
}
```

Yes indeed, I wanted to write

```
sage: p,x = d.to_milp_solver(solver='Gurobi')
sage: p
Boolean Program (no objective, 6 variables, 6 constraints)
sage: x
MIPVariable of dimension 1 
```

...as you fixed it is okay as well.

On another machine running a more recent version of Sage, with the current public branch, I get:

```
$ sage -version
SageMath version 9.2.beta1, Release Date: 2020-06-13
$ sage -bt --optional=sage,optional,external --show-skipped src/sage/combinat/matrices/dancing_links.pyx
...
sage -t src/sage/combinat/matrices/dancing_links.pyx
    3 gurobi tests not run
    0 tests not run because we ran out of time
    [250 tests, 2.26 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
External software detected for doctesting: 
```


(The licence of my Gurobi licence just expired. I need to renew it.)

So the error with the `x_` in the `p.show()` is weird. Are you able to reproduce it on another machine?



---

archive/issue_comments_422154.json:
```json
{
    "body": "I was using sage version 9.1rc1 because that is what the branch switched too. I'll update to the develop version and test again.",
    "created_at": "2020-06-24T19:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422154",
    "user": "@saliola"
}
```

I was using sage version 9.1rc1 because that is what the branch switched too. I'll update to the develop version and test again.



---

archive/issue_comments_422155.json:
```json
{
    "body": "I figured out what is causing the error with the `x_` in the `p.show()` command. It is somehow caused by the `sage_numerical_backends_gurobi` optional package. The error is triggered as soon as this package is installed. I am not sure how to report this problem.",
    "created_at": "2020-06-25T17:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422155",
    "user": "@saliola"
}
```

I figured out what is causing the error with the `x_` in the `p.show()` command. It is somehow caused by the `sage_numerical_backends_gurobi` optional package. The error is triggered as soon as this package is installed. I am not sure how to report this problem.



---

archive/issue_comments_422156.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-25T17:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422156",
    "user": "@saliola"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422157.json:
```json
{
    "body": "Thank you so much for this S\u00e9bastien!",
    "created_at": "2020-06-25T17:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422157",
    "user": "@saliola"
}
```

Thank you so much for this Sébastien!



---

archive/issue_comments_422158.json:
```json
{
    "body": "Replying to [comment:11 saliola]:\n> I figured out what is causing the error with the `x_` in the `p.show()` command. It is somehow caused by the `sage_numerical_backends_gurobi` optional package. The error is triggered as soon as this package is installed. I am not sure how to report this problem.\nUpstream is https://github.com/mkoeppe/sage-numerical-backends-gurobi",
    "created_at": "2020-06-25T18:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422158",
    "user": "@mkoeppe"
}
```

Replying to [comment:11 saliola]:
> I figured out what is causing the error with the `x_` in the `p.show()` command. It is somehow caused by the `sage_numerical_backends_gurobi` optional package. The error is triggered as soon as this package is installed. I am not sure how to report this problem.
Upstream is https://github.com/mkoeppe/sage-numerical-backends-gurobi



---

archive/issue_comments_422159.json:
```json
{
    "body": "Thank you for your review Franco!",
    "created_at": "2020-06-25T20:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422159",
    "user": "@seblabbe"
}
```

Thank you for your review Franco!



---

archive/issue_comments_422160.json:
```json
{
    "body": "Thank you. I created an issue upstream with an example that does not require this ticket; see https://github.com/mkoeppe/sage-numerical-backends-gurobi/issues/2",
    "created_at": "2020-06-25T20:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422160",
    "user": "@saliola"
}
```

Thank you. I created an issue upstream with an example that does not require this ticket; see https://github.com/mkoeppe/sage-numerical-backends-gurobi/issues/2



---

archive/issue_comments_422161.json:
```json
{
    "body": "Replying to [comment:14 mkoeppe]:\n\nI just created \nhttps://github.com/mkoeppe/sage-numerical-backends-gurobi/issues/3",
    "created_at": "2020-06-25T20:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422161",
    "user": "@seblabbe"
}
```

Replying to [comment:14 mkoeppe]:

I just created 
https://github.com/mkoeppe/sage-numerical-backends-gurobi/issues/3



---

archive/issue_comments_422162.json:
```json
{
    "body": "oups, we did the same thing at the same time!",
    "created_at": "2020-06-25T20:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422162",
    "user": "@seblabbe"
}
```

oups, we did the same thing at the same time!



---

archive/issue_comments_422163.json:
```json
{
    "body": "A quick comment. I think `to_milp_solver` should be renamed to `to_milp`. In terminology of `sage.numerical.mip`, \"solver\" would be an instance of a subclass of `GenericBackend`.",
    "created_at": "2020-06-26T18:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422163",
    "user": "@mkoeppe"
}
```

A quick comment. I think `to_milp_solver` should be renamed to `to_milp`. In terminology of `sage.numerical.mip`, "solver" would be an instance of a subclass of `GenericBackend`.



---

archive/issue_comments_422164.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-06-28T19:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422164",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_422165.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-06-28T19:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422165",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_422166.json:
```json
{
    "body": "I agree. I just did a commit. Hoping that Volker did not started to merge that ticket while it was on positive review status. Needs review.",
    "created_at": "2020-06-28T19:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422166",
    "user": "@seblabbe"
}
```

I agree. I just did a commit. Hoping that Volker did not started to merge that ticket while it was on positive review status. Needs review.



---

archive/issue_comments_422167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-28T20:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422167",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422168.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29718",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29718#issuecomment-422168",
    "user": "@vbraun"
}
```

Resolution: fixed
