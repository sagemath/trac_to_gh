# Issue 25054: speed up generic polynomials

archive/issues_025054.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/25291\n\n",
    "created_at": "2018-05-04T10:37:53Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "speed up generic polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25054",
    "user": "https://github.com/mezzarobba"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/25291





---

archive/issue_comments_352108.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-04T10:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352108",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_352109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-04T10:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_352110.json:
```json
{
    "body": "I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\nHave you also run some timings?\n\nI will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).",
    "created_at": "2018-05-05T08:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352110",
    "user": "https://github.com/tscrim"
}
```

I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.

Have you also run some timings?

I will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).



---

archive/issue_comments_352111.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\nFine with me.\n\n> Have you also run some timings?\n\nNo micro-benchmarks, but this change seems to speed up the \u201creal-world\u201d code I was profiling by ~3%.",
    "created_at": "2018-05-05T09:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352111",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:3 tscrim]:
> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.

Fine with me.

> Have you also run some timings?

No micro-benchmarks, but this change seems to speed up the “real-world” code I was profiling by ~3%.



---

archive/issue_comments_352112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-05T09:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_352113.json:
```json
{
    "body": "I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.\n\nAll of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).\n\nMarc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n----\nNew commits:",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352113",
    "user": "https://github.com/tscrim"
}
```

I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.

All of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).

Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?
----
New commits:



---

archive/issue_comments_352114.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\nIt seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)",
    "created_at": "2018-05-05T12:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352114",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:6 tscrim]:
> Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?

It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)



---

archive/issue_comments_352115.json:
```json
{
    "body": "Replying to [comment:7 mmezzarobba]:\n> Replying to [comment:6 tscrim]:\n> > Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n> \n> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)\n\nThank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).\n\nSo if my changes are good, feel free to set a positive review. Thank you for your work.",
    "created_at": "2018-05-05T12:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352115",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:7 mmezzarobba]:
> Replying to [comment:6 tscrim]:
> > Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?
> 
> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)

Thank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).

So if my changes are good, feel free to set a positive review. Thank you for your work.



---

archive/issue_comments_352116.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352116",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_352117.json:
```json
{
    "body": "Thank you!",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352117",
    "user": "https://github.com/mezzarobba"
}
```

Thank you!



---

archive/issue_comments_352118.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25054#issuecomment-352118",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_023351.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:48:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25054",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25054#event-23351"
}
```
