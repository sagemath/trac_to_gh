# Issue 34425: sage.combinat.permutation.from_cycles produces wrong result when 'cycles' is a generator

Issue created by migration from https://trac.sagemath.org/ticket/34662

Original creator: @maxale

Original creation time: 2022-10-15 14:05:43

We have


```
sage: cycles = [[1,2,3],[4,5,6]]
sage: sage.combinat.permutation.from_cycles(6,cycles)
[2, 3, 1, 5, 6, 4]
sage: sage.combinat.permutation.from_cycles(6,(c for c in cycles))
[1, 2, 3, 4, 5, 6]
```


where the former result is correct and the latter is wrong.


---

Comment by @maxale created at 2022-10-15 14:06:43

Changing type from PLEASE CHANGE to defect.


---

Comment by @DaveWitteMorris created at 2022-10-21 19:05:14

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2022-10-21 19:05:14

Thanks for pointing out this bug. I rewrote the code to only access the input once, so it works with generators. The new code also verifies the input without sorting a list (which takes more than linear time).
----
New commits:


---

Comment by tscrim created at 2022-10-24 07:00:22

The test of `int(x)` doesn't quite do what it is claiming to do:

```
sage: int(1.5)
1
```

It would be better to just explicit convert the inputs to `ZZ`, which can just fail.

Likewise, do `p[i] = ZZ(i+1)`.

Please factor out the `len(cycle)` calls as a variable in the loop as an optimization.


---

Comment by git created at 2022-10-26 03:29:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2022-10-26 03:30:37

Thanks for your comments.  I think I made the changes that you suggested.


---

Comment by tscrim created at 2022-10-28 06:47:01

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-10-28 06:47:01

Thanks. LGTM.


---

Comment by @DaveWitteMorris created at 2022-10-29 04:32:46

Thanks!


---

Comment by vbraun created at 2022-11-07 20:26:16

Resolution: fixed
