# Issue 21426: Allow singular_ring_delete(NULL)

Issue created by migration from https://trac.sagemath.org/ticket/21663

Original creator: jdemeyer

Original creation time: 2016-10-07 13:53:27

CC:  jpflori

We should allow `singular_ring_delete(NULL)` and simply do nothing. This is analogous to `free(NULL)` which is also explicitly allowed as doing nothing.


---

Comment by jdemeyer created at 2016-10-07 14:00:25

New commits:


---

Comment by jdemeyer created at 2016-10-07 14:00:25

Changing status from new to needs_review.


---

Comment by jpflori created at 2016-10-07 14:20:10

Could you just document why this is needed?
To mimick `free` or did you actually needed it?


---

Comment by jdemeyer created at 2016-10-07 14:48:59


```
sage: t = type(QQ['x','y'].zero())
sage: t.__new__(t);
singular_ring_delete(ring*) called with NULL pointer.
  File "/usr/local/src/sage-config/src/bin/sage-ipython", line 11, in <module>
    app.start()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/terminal/ipapp.py", line 348, in start
    self.shell.mainloop()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 402, in mainloop
    self.interact()
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 393, in interact
    self.run_cell(code, store_history=True)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2705, in run_cell
    interactivity=interactivity, compiler=compiler, result=result)
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2815, in run_ast_nodes
    if self.run_code(code, result):
  File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2869, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)
  File "<ipython-input-16-61c9f5032c44>", line 1, in <module>
    t.__new__(t);
Exception KeyError: (The ring pointer 0x0,) in 'sage.libs.singular.ring.singular_ring_delete' ignored
```



---

Comment by jdemeyer created at 2016-10-08 08:22:45

Replying to [comment:3 jpflori]:
> To mimick `free` or did you actually needed it?

And yes, apart from #21658 it is typical behaviour that freeing an object can be safely done if that object contains only zero bytes. This is true for `free()` and `delete` in C++ but also `bitset_free()` in Sage and `mpz_clear()` in GMP/MPIR for example.


---

Comment by jdemeyer created at 2016-10-12 10:03:54

*ping*

Jean-Pierre, what do you think?


---

Comment by jpflori created at 2016-10-12 10:05:33

Euh, argh, I was onto other stuff.
This makes sense and I don't see how it could hurt.


---

Comment by jpflori created at 2016-10-12 10:05:33

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-10-12 10:08:15

Thanks!


---

Comment by vbraun created at 2016-10-29 14:28:03

Resolution: fixed
