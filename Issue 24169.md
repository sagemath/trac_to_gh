# Issue 24169: py3: get rid of some long(...) in quotient rings

archive/issues_024169.json:
```json
{
    "body": "CC:  embray jdemeyer tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24406\n\n",
    "created_at": "2017-12-20T09:03:38Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "title": "py3: get rid of some long(...) in quotient rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24169",
    "user": "chapoton"
}
```
CC:  embray jdemeyer tscrim



Issue created by migration from https://trac.sagemath.org/ticket/24406





---

archive/issue_comments_338624.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-20T09:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338624",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338625.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-20T09:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338625",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_338626.json:
```json
{
    "body": "In the same spirit, what to do with\n\n```\nsrc/sage/interfaces/interface.py: return long(randstate().seed()&0x1FFFFFFF)\n```\n\n?",
    "created_at": "2017-12-20T09:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338626",
    "user": "chapoton"
}
```

In the same spirit, what to do with

```
src/sage/interfaces/interface.py: return long(randstate().seed()&0x1FFFFFFF)
```

?



---

archive/issue_comments_338627.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2017-12-20T10:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338627",
    "user": "chapoton"
}
```

green bot, please review



---

archive/issue_comments_338628.json:
```json
{
    "body": "You should keep the doctests, i.e. move them somewhere else inside a `TESTS` block.",
    "created_at": "2017-12-20T10:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338628",
    "user": "jdemeyer"
}
```

You should keep the doctests, i.e. move them somewhere else inside a `TESTS` block.



---

archive/issue_comments_338629.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-20T10:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338629",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_338630.json:
```json
{
    "body": "They no longer work:\n\n```\nsage: R.<x> = PolynomialRing(QQ)\nsage: S.<a> = R.quotient(x^3-2)\nsage: long(S(10))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-fb296fb2f341> in <module>()\n----> 1 long(S(Integer(10)))\n\nTypeError: long() argument must be a string or a number, not 'PolynomialQuotientRing_field_with_category.element_class'\nsage: int(S(10))\n10\nsage: long(int(S(10)))\n10L\n```\n",
    "created_at": "2017-12-20T10:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338630",
    "user": "chapoton"
}
```

They no longer work:

```
sage: R.<x> = PolynomialRing(QQ)
sage: S.<a> = R.quotient(x^3-2)
sage: long(S(10))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-fb296fb2f341> in <module>()
----> 1 long(S(Integer(10)))

TypeError: long() argument must be a string or a number, not 'PolynomialQuotientRing_field_with_category.element_class'
sage: int(S(10))
10
sage: long(int(S(10)))
10L
```




---

archive/issue_comments_338631.json:
```json
{
    "body": "Would it be ok to use the previous comment as a doctest ?",
    "created_at": "2017-12-20T10:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338631",
    "user": "chapoton"
}
```

Would it be ok to use the previous comment as a doctest ?



---

archive/issue_comments_338632.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> Would it be ok to use the previous comment as a doctest ?\n\nOf course not. You are breaking a part of Sage that used to work!\n\nReally, why do we need to get rid of this `__long__` anyway? It doesn't hurt to keep it on Python 3. The doctests won't work because there is no `long`, but the tests should work with `int` on Python 3.",
    "created_at": "2017-12-20T10:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338632",
    "user": "jdemeyer"
}
```

Replying to [comment:6 chapoton]:
> Would it be ok to use the previous comment as a doctest ?

Of course not. You are breaking a part of Sage that used to work!

Really, why do we need to get rid of this `__long__` anyway? It doesn't hurt to keep it on Python 3. The doctests won't work because there is no `long`, but the tests should work with `int` on Python 3.



---

archive/issue_comments_338633.json:
```json
{
    "body": "It's a general thing that I have said on several other tickets: if you break an existing doctest for Python 3 porting, there should be an exceptional reason for it. Generally, you change the code such that the code works on Python 2 and Python 3 but you keep the doctests.\n\nOf course, if the doctest itself is not compatible with Python 3 (in this cases, it uses `long()`), then it can't work on Python 3. But it should still work on Python 2.",
    "created_at": "2017-12-20T10:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338633",
    "user": "jdemeyer"
}
```

It's a general thing that I have said on several other tickets: if you break an existing doctest for Python 3 porting, there should be an exceptional reason for it. Generally, you change the code such that the code works on Python 2 and Python 3 but you keep the doctests.

Of course, if the doctest itself is not compatible with Python 3 (in this cases, it uses `long()`), then it can't work on Python 3. But it should still work on Python 2.



---

archive/issue_comments_338634.json:
```json
{
    "body": "Well, because keeping long(..) is not an option if we want doctests to pass, that's why.\n\nBut I more concerned with the call to long in\n\n```\nsrc/sage/interfaces/interface.py: return long(randstate().seed()&0x1FFFFFFF)\n```\n\nthat prevents some combinat code to run.\n\nBy the way, did you try to build and use sage with python3 yourself ?",
    "created_at": "2017-12-20T10:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338634",
    "user": "chapoton"
}
```

Well, because keeping long(..) is not an option if we want doctests to pass, that's why.

But I more concerned with the call to long in

```
src/sage/interfaces/interface.py: return long(randstate().seed()&0x1FFFFFFF)
```

that prevents some combinat code to run.

By the way, did you try to build and use sage with python3 yourself ?



---

archive/issue_comments_338635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-20T14:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338635",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_338636.json:
```json
{
    "body": "Because I am not going to fight for this one, let us close it as wontfix.",
    "created_at": "2017-12-20T14:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338636",
    "user": "chapoton"
}
```

Because I am not going to fight for this one, let us close it as wontfix.



---

archive/issue_comments_338637.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-21T15:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338637",
    "user": "embray"
}
```

Resolution: wontfix



---

archive/issue_comments_338638.json:
```json
{
    "body": "I agree `__long__` shouldn't be outright removed.  I've fixed a few of these in my branch already on a case-by-case basis.",
    "created_at": "2017-12-21T15:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24169#issuecomment-338638",
    "user": "embray"
}
```

I agree `__long__` shouldn't be outright removed.  I've fixed a few of these in my branch already on a case-by-case basis.
