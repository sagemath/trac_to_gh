# Issue 33150: BipartiteGraph.reduced_adjacency_matrix: accept keyword arguments for matrix constructor

Issue created by migration from https://trac.sagemath.org/ticket/33387

Original creator: dcoudert

Original creation time: 2022-02-20 14:33:23

CC:  mkoeppe

Following #33377, we add arguments to method `BipartiteGraph.reduced_adjacency_matrix` for the matrix constructor.


---

Comment by dcoudert created at 2022-02-20 14:38:22

Last 10 new commits:


---

Comment by dcoudert created at 2022-02-20 14:38:22

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-02-20 18:53:10

typo: otherwisse -> otherwise


---

Comment by mkoeppe created at 2022-02-20 18:55:31

Otherwise, LGTM, feel free to set to positive review after the fix


---

Comment by git created at 2022-02-20 19:24:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-02-20 19:25:10

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2022-02-20 19:25:10

Thanks for the review.


---

Comment by fbissey created at 2022-02-23 08:57:52

I get 

```
sage -t --long --random-seed=234917630320381229401386766811170895410 /usr/lib/python3.10/site-packages/sage/graphs/bipartite_graph.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/graphs/bipartite_graph.py", line 1678, in sage.graphs.bipartite_graph.BipartiteGraph.reduced_adjacency_matrix
Failed example:
    B.reduced_adjacency_matrix(base_ring=RDF)
Expected:
    Traceback (most recent call last):
    ...
    TypeError: float() argument must be a string or a number, not 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.bipartite_graph.BipartiteGraph.reduced_adjacency_matrix[35]>", line 1, in <module>
        B.reduced_adjacency_matrix(base_ring=RDF)
      File "/usr/lib/python3.10/site-packages/sage/graphs/bipartite_graph.py", line 1718, in reduced_adjacency_matrix
        return matrix(base_ring, len(self.right), len(self.left), D, sparse=sparse, **kwds)
      File "sage/matrix/constructor.pyx", line 643, in sage.matrix.constructor.matrix (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/matrix/constructor.c:2725)
        M = MatrixArgs(*args, **kwds).matrix()
      File "sage/matrix/args.pyx", line 667, in sage.matrix.args.MatrixArgs.matrix (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/matrix/args.c:8006)
        M = self.space(self, coerce=convert)
      File "sage/structure/parent.pyx", line 899, in sage.structure.parent.Parent.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/parent.c:9471)
        return mor._call_with_args(x, args, kwds)
      File "sage/structure/coerce_maps.pyx", line 180, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/coerce_maps.c:5259)
        raise
      File "sage/structure/coerce_maps.pyx", line 170, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/coerce_maps.c:5049)
        return C._element_constructor(x, **kwds)
      File "/usr/lib/python3.10/site-packages/sage/matrix/matrix_space.py", line 928, in _element_constructor_
        return self.element_class(self, entries, **kwds)
      File "sage/matrix/matrix_generic_sparse.pyx", line 170, in sage.matrix.matrix_generic_sparse.Matrix_generic_sparse.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/matrix/matrix_generic_sparse.c:3332)
        self._entries = ma.dict(coerce)
      File "sage/matrix/args.pyx", line 770, in sage.matrix.args.MatrixArgs.dict (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/matrix/args.c:8863)
        for t in self.iter(convert, True):
      File "sage/matrix/args.pyx", line 544, in iter (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/matrix/args.c:7026)
        se = make_SparseEntry(se.i, se.j, self.base(se.entry))
      File "sage/structure/parent.pyx", line 897, in sage.structure.parent.Parent.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/parent.c:9444)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 161, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/coerce_maps.c:4728)
        raise
      File "sage/structure/coerce_maps.pyx", line 156, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/structure/coerce_maps.c:4620)
        return C._element_constructor(x)
      File "sage/rings/real_double.pyx", line 740, in sage.rings.real_double.RealDoubleElement.__init__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python3_10/cythonized/sage/rings/real_double.c:9480)
        self._value = float(x)
    TypeError: float() argument must be a string or a real number, not 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement'
```

The key bits are 

```
TypeError: float() argument must be a string or a number, not 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement'
```

is expected but

```
TypeError: float() argument must be a string or a real number, not 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement'
```

is returned. This is with python 3.10 and cython 0.29.26 if it is important.


---

Comment by mkoeppe created at 2022-02-23 16:37:41

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2022-02-23 16:38:24

Some `...` is needed to match the refined error messages in Python 3.10


---

Comment by git created at 2022-02-24 16:47:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-02-24 16:48:23

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2022-02-24 16:48:23

Let me know if this is ok or if I should shrink the line with the error message.


---

Comment by mkoeppe created at 2022-02-24 16:50:59

This should work, thanks


---

Comment by mkoeppe created at 2022-02-24 16:50:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-27 22:00:14

Resolution: fixed
