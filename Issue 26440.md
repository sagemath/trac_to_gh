# Issue 26440: rational_points for some elliptic curves fails

Issue created by migration from Trac.

Original creator: alexjbest

Original creation time: 2018-11-11 08:54:59

CC:  raghukul01 bhutz

Keywords: rational points, elliptic curves


```
sage: E = EllipticCurve("11a1")
sage: E.rational_points(bound=5)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-892e6de8bab5> in <module>()
----> 1 E.rational_points("11a1")

AttributeError: 'function' object has no attribute 'rational_points'
sage: E = EllipticCurve("11a1")
sage: E.rational_points(bound=5)
Exception raised by child process with pid=90565:
Traceback (most recent call last):
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py", line 177, in __call__
    self._subprocess(f, dir, *v0)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py", line 302, in _subprocess
    value = f(*args, **kwds)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_rational_point.py", line 460, in parallel_function
    Xp = X.change_ring(GF(p))
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 1347, in change_ring
    return self.base_extend(R)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_number_field.py", line 151, in base_extend
    E = super(EllipticCurve_number_field, self).base_extend(R)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 1329, in base_extend
    return constructor.EllipticCurve([R(a) for a in self.a_invariants()])
  File "sage/structure/factory.pyx", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2046)
    return self.get_object(version, key, kwds)
  File "sage/structure/factory.pyx", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2422)
    obj = self.create_object(version, key, **extra_args)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.py", line 471, in create_object
    return EllipticCurve_finite_field(R, x)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 149, in __init__
    raise ArithmeticError("invariants " + str(ainvs) + " define a singular curve")
ArithmeticError: invariants (0, 10, 1, 1, 2) define a singular curve
<---------SNIP----------->
/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.pyc in rational_points(self, **kwds)
   1828                 return X.points(**kwds) # checks for proper bound done in points functions
   1829             except TypeError:
-> 1830                 raise TypeError("Unable to enumerate points over %s."%F)
   1831         elif (self.base_ring() in NumberFields() or self.base_ring() == ZZ)\
   1832           and hasattr(F, 'precision'):

TypeError: Unable to enumerate points over Rational Field.
sage: 
```


Not clear the exact issue right now, but it looks like a bad prime is being used.

Miraculously this works for the curve that is currently doctested `37a`,


---

Comment by bhutz created at 2018-11-11 14:10:11

As stated above, the problem is that the sieving method is not considering whether a prime could be bad. I also prefer the suggestion of elliptic curves having their own method; if for no other reason that the method could be significantly improved in the case of the elliptic curves. In the short term, the elliptic curve method could just call the current method as a generic 'curve' until a faster specialized algorithm is implemented.


---

Comment by alexjbest created at 2018-11-11 22:14:40

Ok I added a patch, let me know if anyone thinks of a better solution, or if this should be somewhere more generic that elliptic_curve_number_field (thats just the situation I care about where I believe rational points is most common).
----
New commits:


---

Comment by alexjbest created at 2018-11-11 22:24:48

Changing status from new to needs_review.


---

Comment by bhutz created at 2018-11-11 22:46:47

I didn't pull the branch to test, but don't you need to coerce the points back to original elliptic curve before returning.


---

Comment by git created at 2018-11-11 23:05:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alexjbest created at 2018-11-11 23:05:13

Good point!


---

Comment by alexjbest created at 2018-11-11 23:17:51

Actually this requires some more code as we need to allow


```
sage: E = EllipticCurve([1,0])
sage: E.rational_points(bound=2, F= QuadraticField(-1))
```


 which currently fails


---

Comment by alexjbest created at 2018-11-11 23:17:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-11-12 05:18:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alexjbest created at 2018-11-12 05:19:02

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2018-11-13 18:43:36

You need to get the keyword 'F' before it can be used.

Maybe change the last example to

```
sage: E = EllipticCurve([1,0])
sage: E.rational_points(F=QuadraticField(-1))
```

so an error like this shows up.


---

Comment by bhutz created at 2018-11-13 18:43:36

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-11-14 22:59:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alexjbest created at 2018-11-14 23:00:40

Changing status from needs_work to needs_review.


---

Comment by alexjbest created at 2018-11-14 23:00:40

Yikes, thanks.


---

Comment by bhutz created at 2018-11-15 15:31:30

I think this is fine now. If we can get an all tests pass on the patchbot, I'll mark it positive.


---

Comment by bhutz created at 2018-11-16 17:50:07

ran the long tests on my machine. All passed.


---

Comment by bhutz created at 2018-11-16 17:50:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-11-18 00:06:55

Resolution: fixed
