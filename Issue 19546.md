# Issue 19546: fix test failures in sandpiles

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2015-12-25 18:37:23

CC:  dperkinson

testing sandpiles with 4ti2 installed results in test failures.
This is a leftover from #18618. Note that 4ti2 is an optional package, and 
as such all the doctests that use it must pass (see e.g. #19781).


---

Comment by dimpase created at 2015-12-25 18:39:26


```
$ sage -tp src/sage/sandpiles/sandpile.py 
Running doctests with ID 2015-12-25-18-15-20-5384a452.
Git branch: HEAD
Using --optional=4ti2,database_gap,gap_packages,mpir,python2,sage
Doctesting 1 file using 4 threads.
sage -t --warn-long 41.5 src/sage/sandpiles/sandpile.py
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 5171, in sage.sandpiles.sandpile.SandpileDivisor._set_linear_system
Failed example:
    D._set_linear_system() # optional - 4ti2
Expected nothing
Got:
    Input error: Parse error while reading vector; could be overflow
    <BLANKLINE>
                     **********************************
                     *** This method requires 4ti2. ***
                     **********************************
    <BLANKLINE>
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 5274, in sage.sandpiles.sandpile.SandpileDivisor.linear_system
Failed example:
    D.linear_system() # optional - 4ti2
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.sandpiles.sandpile.SandpileDivisor.linear_system[2]>", line 1, in <module>
        D.linear_system() # optional - 4ti2
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/sandpiles/sandpile.py", line 5291, in linear_system
        return self._linear_system
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/sandpiles/sandpile.py", line 4440, in __getattr__
        return self.__dict__[name]
    KeyError: '_linear_system'
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 5683, in sage.sandpiles.sandpile.SandpileDivisor.r_of_D
Failed example:
    E = D.r_of_D(True) # optional - 4ti2
Expected nothing
Got:
    doctest:1: DeprecationWarning: D.r_of_D() will be removed soon.  Please use ``D.rank()`` instead.
    See http://trac.sagemath.org/18618 for details.
**********************************************************************
3 items had failures:
   1 of   4 in sage.sandpiles.sandpile.SandpileDivisor._set_linear_system
   1 of   4 in sage.sandpiles.sandpile.SandpileDivisor.linear_system
   1 of   9 in sage.sandpiles.sandpile.SandpileDivisor.r_of_D
    [971 tests, 3 failures, 16.82 s]
----------------------------------------------------------------------
sage -t --warn-long 41.5 src/sage/sandpiles/sandpile.py  # 3 doctests failed
```



---

Comment by jdemeyer created at 2015-12-26 11:15:53

Changing priority from major to blocker.


---

Comment by dimpase created at 2016-01-01 12:13:58

as suggested on #19781, marked broken tests accordingly.
----
New commits:


---

Comment by dimpase created at 2016-01-01 12:13:58

Changing status from new to needs_review.


---

Comment by git created at 2016-01-01 12:18:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2016-01-01 12:19:19

ok, now the branch is clean...


---

Comment by jdemeyer created at 2016-01-01 12:19:55

Author name please...


---

Comment by jdemeyer created at 2016-01-01 22:56:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-02 15:15:26

Resolution: fixed
