# Issue 21470: Split sage-env into sage-build-env and sage-env

archive/issues_021470.json:
```json
{
    "body": "CC:  embray jdemeyer leif fbissey dimpase isuruf arojas infinity0 @timokau mjo jhpalmieri @tobiasdiez\n\n`sage-env` is used by both Sage-the-distribution while building packages,\nand by Sage at runtime.\n\nIt should be split into two separate scripts.\n- `sage-build-env` should go into `build/bin` and not be installed.\n- `sage-env` should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. \n\n(`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)\n\nThis is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21707\n\n",
    "created_at": "2016-10-15T06:08:58Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Split sage-env into sage-build-env and sage-env",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21470",
    "user": "mkoeppe"
}
```
CC:  embray jdemeyer leif fbissey dimpase isuruf arojas infinity0 @timokau mjo jhpalmieri @tobiasdiez

`sage-env` is used by both Sage-the-distribution while building packages,
and by Sage at runtime.

It should be split into two separate scripts.
- `sage-build-env` should go into `build/bin` and not be installed.
- `sage-env` should be installed by `src/setup.py` (thus very late in the build process), rather than by `build/make/Makefile`. 

(`sage-env` will be very short and at some point hopefully disappear, if we want sagelib to become a standalone Python library - #21507)

This is a step towards the cleaning of `src/bin` as described in #21569, #21570, #21559.

Issue created by migration from https://trac.sagemath.org/ticket/21707





---

archive/issue_comments_298078.json:
```json
{
    "body": "One comment. Currently `sage_setup` is installed because it needs to be installed to be doctested - like the rest of sage. But nothing in `sage_setup` is really needed at runtime and distro can choose not to install it. I don't in sage-on-gentoo. I tend to push for thing not needed at runtime to be moved in there. And that's where I would have put `sage-build-env` but I am not going to fight it going into `build/bin` although I'd like everything used by `setup.py` to be neatly under `src`.",
    "created_at": "2016-10-15T08:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298078",
    "user": "fbissey"
}
```

One comment. Currently `sage_setup` is installed because it needs to be installed to be doctested - like the rest of sage. But nothing in `sage_setup` is really needed at runtime and distro can choose not to install it. I don't in sage-on-gentoo. I tend to push for thing not needed at runtime to be moved in there. And that's where I would have put `sage-build-env` but I am not going to fight it going into `build/bin` although I'd like everything used by `setup.py` to be neatly under `src`.



---

archive/issue_comments_298079.json:
```json
{
    "body": "Thanks - I've updated the description",
    "created_at": "2016-10-15T18:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298079",
    "user": "mkoeppe"
}
```

Thanks - I've updated the description



---

archive/issue_comments_298080.json:
```json
{
    "body": "I agree.\n\nConsider a slight alternative: Rewrite sage-env as a Python script.  This would give it much more flexibility and probably more legibility, including some command-line options for different environments (`--build`, especially).\n\nThe output would of course be the shell commands to actually set the variables. So rather than `source sage-env` one would `eval $(sage-env)`.  My one concern is that it would be slower, but ideally it's something that shouldn't happen frequently anyways, but rather only when not already in sage-env.",
    "created_at": "2016-10-17T09:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298080",
    "user": "embray"
}
```

I agree.

Consider a slight alternative: Rewrite sage-env as a Python script.  This would give it much more flexibility and probably more legibility, including some command-line options for different environments (`--build`, especially).

The output would of course be the shell commands to actually set the variables. So rather than `source sage-env` one would `eval $(sage-env)`.  My one concern is that it would be slower, but ideally it's something that shouldn't happen frequently anyways, but rather only when not already in sage-env.



---

archive/issue_comments_298081.json:
```json
{
    "body": "I have a tendency to mix up `sage-env` the script and `sage.env.py`, my comment is really an example of that. However a lot is common between the two.",
    "created_at": "2016-10-17T09:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298081",
    "user": "fbissey"
}
```

I have a tendency to mix up `sage-env` the script and `sage.env.py`, my comment is really an example of that. However a lot is common between the two.



---

archive/issue_comments_298082.json:
```json
{
    "body": "Right--they could be one in the same.",
    "created_at": "2016-10-17T09:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298082",
    "user": "embray"
}
```

Right--they could be one in the same.



---

archive/issue_comments_298083.json:
```json
{
    "body": "Replying to [comment:6 embray]:\n> Right--they could be one in the same.\n I have thought about it often. Of course that really means that you'll have to removing all the build time stuff. But in sage-on-gentoo where I ship a very simplified sage-env (in /etc as well) they are virtually doing the same thing, one in shell, the other in python.",
    "created_at": "2016-10-17T09:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298083",
    "user": "fbissey"
}
```

Replying to [comment:6 embray]:
> Right--they could be one in the same.
 I have thought about it often. Of course that really means that you'll have to removing all the build time stuff. But in sage-on-gentoo where I ship a very simplified sage-env (in /etc as well) they are virtually doing the same thing, one in shell, the other in python.



---

archive/issue_comments_298084.json:
```json
{
    "body": "In either case--whether making a single script, or two separate shell scripts, this would be useful for gentoo (and probably other distros as well) then right?",
    "created_at": "2016-10-17T09:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298084",
    "user": "embray"
}
```

In either case--whether making a single script, or two separate shell scripts, this would be useful for gentoo (and probably other distros as well) then right?



---

archive/issue_comments_298085.json:
```json
{
    "body": "Probably, the current `sage-env` is a forest mostly dedicated to the build system. I just discard it and bring my own, it takes less space and maintenance than a mega patch.",
    "created_at": "2016-10-17T09:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298085",
    "user": "fbissey"
}
```

Probably, the current `sage-env` is a forest mostly dedicated to the build system. I just discard it and bring my own, it takes less space and maintenance than a mega patch.



---

archive/issue_comments_298086.json:
```json
{
    "body": "Ideally, the configuration for sagelib runtime should take place in a generated Python file and not involve environment variables at all.",
    "created_at": "2016-10-17T14:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298086",
    "user": "mkoeppe"
}
```

Ideally, the configuration for sagelib runtime should take place in a generated Python file and not involve environment variables at all.



---

archive/issue_comments_298087.json:
```json
{
    "body": "More likely parts of it would be static, and other parts could be generated, but yes, what I meant above in terms of rewriting `sage-env` in Python was that it would not (by default) involve environment variables at all.\n\nBut it's still useful for interacting with other tools, especially for build purposes, as well as dropping into `./sage -sh` to be able to set environment variables, which is why I suggest a mode to output a list of variables that can be read from the shell.",
    "created_at": "2016-10-17T14:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298087",
    "user": "embray"
}
```

More likely parts of it would be static, and other parts could be generated, but yes, what I meant above in terms of rewriting `sage-env` in Python was that it would not (by default) involve environment variables at all.

But it's still useful for interacting with other tools, especially for build purposes, as well as dropping into `./sage -sh` to be able to set environment variables, which is why I suggest a mode to output a list of variables that can be read from the shell.



---

archive/issue_comments_298088.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298088",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298089.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-20T00:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298089",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_298090.json:
```json
{
    "body": "As-is this is going to conflict with tickets like #27825 that are adding still more environment variables needed at build-time to sage-env-config.\n\nI'm completely in favor of this separation in principle though.  The question is whether we should do this first and then update tickets like #27825 on top of it, or the other way around?",
    "created_at": "2019-05-21T15:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298090",
    "user": "embray"
}
```

As-is this is going to conflict with tickets like #27825 that are adding still more environment variables needed at build-time to sage-env-config.

I'm completely in favor of this separation in principle though.  The question is whether we should do this first and then update tickets like #27825 on top of it, or the other way around?



---

archive/issue_comments_298091.json:
```json
{
    "body": "I really would like to first get our existing tickets (#27825, #27822) touching sage-env-config in.",
    "created_at": "2019-05-21T15:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298091",
    "user": "dimpase"
}
```

I really would like to first get our existing tickets (#27825, #27822) touching sage-env-config in.



---

archive/issue_comments_298092.json:
```json
{
    "body": "The tickets would be trivial to rebase on top of this one.",
    "created_at": "2019-05-22T20:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298092",
    "user": "mkoeppe"
}
```

The tickets would be trivial to rebase on top of this one.



---

archive/issue_comments_298093.json:
```json
{
    "body": "Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.",
    "created_at": "2019-05-23T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298093",
    "user": "mkoeppe"
}
```

Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.



---

archive/issue_comments_298094.json:
```json
{
    "body": "For the sake of a bit more terseness I wonder if we could call it just `sage-env-build.in` and `sage-env-build`.  The only reason for the `-config` in the other one is to distinguish it from plain `sage-env`.\n\nNow that I look I'm not even entirely sure we need to separate `sage-env-config` from `sage-env`.\n\nI think we could probably have a `sage-env.in` produce `sage-env` and get rid of the separate `sage-env-config` entirely, though it's possible there's some subtlety to that that I'm missing.",
    "created_at": "2019-07-01T12:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298094",
    "user": "embray"
}
```

For the sake of a bit more terseness I wonder if we could call it just `sage-env-build.in` and `sage-env-build`.  The only reason for the `-config` in the other one is to distinguish it from plain `sage-env`.

Now that I look I'm not even entirely sure we need to separate `sage-env-config` from `sage-env`.

I think we could probably have a `sage-env.in` produce `sage-env` and get rid of the separate `sage-env-config` entirely, though it's possible there's some subtlety to that that I'm missing.



---

archive/issue_comments_298095.json:
```json
{
    "body": "Went ahead and rebased on current develop so it could incorporate all the additional variables we've since added.\n\nI didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.\n----\nNew commits:",
    "created_at": "2019-07-01T12:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298095",
    "user": "embray"
}
```

Went ahead and rebased on current develop so it could incorporate all the additional variables we've since added.

I didn't change the name of the script yet; I would still prefer to shorten it but if anyone disagrees we can leave it as-is.
----
New commits:



---

archive/issue_comments_298096.json:
```json
{
    "body": "The only subtility to `sage-env-config` in my mind, is that you can touch it or even regenerate it without touching `sage-env`. But I am sure you don't need a separate file to achieve your objectives in either case.",
    "created_at": "2019-07-01T20:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298096",
    "user": "fbissey"
}
```

The only subtility to `sage-env-config` in my mind, is that you can touch it or even regenerate it without touching `sage-env`. But I am sure you don't need a separate file to achieve your objectives in either case.



---

archive/issue_comments_298097.json:
```json
{
    "body": "No, probably not.  I might try it, though we'll leave that as a separate exercise from this ticket.",
    "created_at": "2019-07-02T12:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298097",
    "user": "embray"
}
```

No, probably not.  I might try it, though we'll leave that as a separate exercise from this ticket.



---

archive/issue_comments_298098.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298098",
    "user": "embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_298099.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298099",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_298100.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-15T22:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298100",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298101.json:
```json
{
    "body": "The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.",
    "created_at": "2020-01-15T23:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298101",
    "user": "mkoeppe"
}
```

The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.



---

archive/issue_comments_298102.json:
```json
{
    "body": "Replying to [comment:17 mkoeppe]:\n> Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.\n\nAs an extension of this, there could be `sage --buildsh SPKG`, which would set up the environment in which `spkg-install` runs. This could be useful for testing new versions of packages.",
    "created_at": "2020-01-15T23:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298102",
    "user": "mkoeppe"
}
```

Replying to [comment:17 mkoeppe]:
> Probably one should introduce a command `sage --buildsh`, which would provide the larger environment.

As an extension of this, there could be `sage --buildsh SPKG`, which would set up the environment in which `spkg-install` runs. This could be useful for testing new versions of packages.



---

archive/issue_comments_298103.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.\nOr #29038 - Python package sage_conf: Provides optional configuration information for sagelib",
    "created_at": "2020-01-18T19:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298103",
    "user": "mkoeppe"
}
```

Replying to [comment:25 mkoeppe]:
> The run-time environment variables of sage could as well be configured by a Python module `src/sage/env_config.py` - see #29022.
Or #29038 - Python package sage_conf: Provides optional configuration information for sagelib



---

archive/issue_comments_298104.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298104",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_298105.json:
```json
{
    "body": "Changing type from enhancement to task.",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298105",
    "user": "mkoeppe"
}
```

Changing type from enhancement to task.



---

archive/issue_comments_298106.json:
```json
{
    "body": "Hoping for input from people involved in packaging.",
    "created_at": "2020-01-19T17:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298106",
    "user": "mkoeppe"
}
```

Hoping for input from people involved in packaging.



---

archive/issue_comments_298107.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-01-20T14:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298107",
    "user": "mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_298108.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-29T00:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298108",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298109.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd109\".",
    "created_at": "2020-05-27T15:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298109",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "sd109".



---

archive/issue_comments_298110.json:
```json
{
    "body": "Not sure if this is the right place, but I would suggest to use the refactoring process to also convert the environment variables to configuration files. \n\nThe idea would be to have a `toml` file (or `yaml` or whatever you prefer) in some predefined folder (say `src` for the start). This file could be generated e.g by the `configure` script. This config file is then parsed and wrapped by a python class (natural candidate would be the current `sage_conf.py`). The python class also provides reasonable default values in case the config file doesn't exist. \n\nThis has several advantages in my opinion:\n- More transparent, as one sees on one glance which variables influence sage.\n- Easily editable by the user/developer.\n- Local (e.g. think about multiple virtual environments with different configs).\n- Type-safe, i.e, it is ensured when parsing the toml file that the types of the config variables is correct.\n- Easier for downstream package managers, since they only need to provide a proper config file.\n- (Higher security as one cannot inject arbitrary python code, which would be the case if `sage_conf.py` should be edited.)\n\nWhat do you think?",
    "created_at": "2020-10-23T22:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298110",
    "user": "@tobiasdiez"
}
```

Not sure if this is the right place, but I would suggest to use the refactoring process to also convert the environment variables to configuration files. 

The idea would be to have a `toml` file (or `yaml` or whatever you prefer) in some predefined folder (say `src` for the start). This file could be generated e.g by the `configure` script. This config file is then parsed and wrapped by a python class (natural candidate would be the current `sage_conf.py`). The python class also provides reasonable default values in case the config file doesn't exist. 

This has several advantages in my opinion:
- More transparent, as one sees on one glance which variables influence sage.
- Easily editable by the user/developer.
- Local (e.g. think about multiple virtual environments with different configs).
- Type-safe, i.e, it is ensured when parsing the toml file that the types of the config variables is correct.
- Easier for downstream package managers, since they only need to provide a proper config file.
- (Higher security as one cannot inject arbitrary python code, which would be the case if `sage_conf.py` should be edited.)

What do you think?



---

archive/issue_comments_298111.json:
```json
{
    "body": "`sage_conf` defines an interface already - and the plan is indeed to get rid of dependencies on environment variables using this interface.\n\nHow `sage_conf` obtains the configuration is orthogonal to the defined interface.\n\nI am not interested in defining configuration files at the moment.  There is just too much potential on wasting energy on discussions regarding the \"best\" config file format.",
    "created_at": "2020-10-23T22:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298111",
    "user": "mkoeppe"
}
```

`sage_conf` defines an interface already - and the plan is indeed to get rid of dependencies on environment variables using this interface.

How `sage_conf` obtains the configuration is orthogonal to the defined interface.

I am not interested in defining configuration files at the moment.  There is just too much potential on wasting energy on discussions regarding the "best" config file format.



---

archive/issue_comments_298112.json:
```json
{
    "body": "Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`). One could easily bypass an extensive discussion and follow the arguments of https://www.python.org/dev/peps/pep-0518/#overview-of-file-formats-considered.\n\nBut I agree that my suggestion concerning a config file is somewhat out of line with the goal of this ticket. I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing.",
    "created_at": "2020-10-25T10:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298112",
    "user": "@tobiasdiez"
}
```

Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`). One could easily bypass an extensive discussion and follow the arguments of https://www.python.org/dev/peps/pep-0518/#overview-of-file-formats-considered.

But I agree that my suggestion concerning a config file is somewhat out of line with the goal of this ticket. I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing.



---

archive/issue_comments_298113.json:
```json
{
    "body": "Replying to [comment:52 gh-tobiasdiez]:\n> Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`).\n\nNote that `sage_conf.py` is already in use since Sage 9.1",
    "created_at": "2020-10-25T15:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298113",
    "user": "mkoeppe"
}
```

Replying to [comment:52 gh-tobiasdiez]:
> Well, you are actually proposing to add a configuration file in the form of a python file (`sage_conf.py`).

Note that `sage_conf.py` is already in use since Sage 9.1



---

archive/issue_comments_298114.json:
```json
{
    "body": "Replying to [comment:52 gh-tobiasdiez]:\n> I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing. \n\nAll of this discussion is certainly valid and I am sure that you (and others) have valuable insights there, but now is simply not the right time for it. To get the design right, one needs to know about objectives and constraints. We are in the process of expanding the ways of Sage installation/deployment into several directions, including pip-installability and modularization; and also binary packaging will need an overhaul.",
    "created_at": "2020-10-25T15:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298114",
    "user": "mkoeppe"
}
```

Replying to [comment:52 gh-tobiasdiez]:
> I would still suggest to keep this in mind while designing the interface for `sage_conf`, so that it might be easy in the future to switch to a design based on a config file. In particular, I would replace the module wide variables (like `VERSION`) with methods in a config class (like `Config.get_version`) that can also provide suitable defaults and do slight post-processing. 

All of this discussion is certainly valid and I am sure that you (and others) have valuable insights there, but now is simply not the right time for it. To get the design right, one needs to know about objectives and constraints. We are in the process of expanding the ways of Sage installation/deployment into several directions, including pip-installability and modularization; and also binary packaging will need an overhaul.



---

archive/issue_comments_298115.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298115",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_298116.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298116",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_298117.json:
```json
{
    "body": "From the discussion in #32904 regarding `sage_conf` at build time (with pip's build isolation) vs. runtime:\n- pip specifies \"ignore-installed\" while constructing the build environment and thus will build sage-conf twice. https://github.com/pypa/pip/blob/main/src/pip/_internal/build_env.py#L221\n- The PyPI version `sage_conf` (from #29039) keys the `SAGE_ROOT`/`SAGE_LOCAL` that it creates in `~/.sage` to the version of `sage_conf`\n- So if the `sage_conf` version is not completely pinned in the `sagemath-standard` build and install requirements, then different versions (and thus `SAGE_ROOT`s) may end up being used at build and install of `sagemath-standard`",
    "created_at": "2021-12-05T20:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298117",
    "user": "mkoeppe"
}
```

From the discussion in #32904 regarding `sage_conf` at build time (with pip's build isolation) vs. runtime:
- pip specifies "ignore-installed" while constructing the build environment and thus will build sage-conf twice. https://github.com/pypa/pip/blob/main/src/pip/_internal/build_env.py#L221
- The PyPI version `sage_conf` (from #29039) keys the `SAGE_ROOT`/`SAGE_LOCAL` that it creates in `~/.sage` to the version of `sage_conf`
- So if the `sage_conf` version is not completely pinned in the `sagemath-standard` build and install requirements, then different versions (and thus `SAGE_ROOT`s) may end up being used at build and install of `sagemath-standard`



---

archive/issue_comments_298118.json:
```json
{
    "body": "From #32904#comment:24:\n- Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at built time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.",
    "created_at": "2021-12-05T20:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298118",
    "user": "mkoeppe"
}
```

From #32904#comment:24:
- Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at built time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.



---

archive/issue_comments_298119.json:
```json
{
    "body": "Replying to [comment:60 mkoeppe]:\n> From gh-tobiasdiez in #32904#comment:24:\n>  - Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at build time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.\n\nI think this is an interesting direction",
    "created_at": "2021-12-05T20:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21470",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21470#issuecomment-298119",
    "user": "mkoeppe"
}
```

Replying to [comment:60 mkoeppe]:
> From gh-tobiasdiez in #32904#comment:24:
>  - Split `sage-conf` into build and runtime configuration. There is still an overlap (and thus duplication) but at build time sage needs less dependencies than at runtime. In addition, maybe directly incorporate the build-time `sage-conf` in the sagemath package.

I think this is an interesting direction
