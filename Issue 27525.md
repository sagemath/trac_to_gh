# Issue 27525: Meta-ticket: Julia

archive/issues_027525.json:
```json
{
    "body": "CC:  @sebasguts isuruf saraedum nthiery\n\nhttps://julialang.org/\n\nTickets:\n- #17230: create a pexpect interface to julia\n\nIssue created by migration from https://trac.sagemath.org/ticket/27762\n\n",
    "created_at": "2019-05-03T09:43:42Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "title": "Meta-ticket: Julia",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27525",
    "user": "mkoeppe"
}
```
CC:  @sebasguts isuruf saraedum nthiery

https://julialang.org/

Tickets:
- #17230: create a pexpect interface to julia

Issue created by migration from https://trac.sagemath.org/ticket/27762





---

archive/issue_comments_388326.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388326",
    "user": "embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_388327.json:
```json
{
    "body": "Changing keywords from \"\" to \"julia\".",
    "created_at": "2019-11-17T22:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388327",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "julia".



---

archive/issue_comments_388328.json:
```json
{
    "body": "I'm at the Sage-OSCAR days this week and am interested in being able to use Oscar (a Julia package) from Sage.  There is PyJulia, but I wasn't able to get Oscar working from that.  There's William's old pexpect interface at #17230.  Has anyone tried something like this?",
    "created_at": "2021-02-15T20:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388328",
    "user": "roed"
}
```

I'm at the Sage-OSCAR days this week and am interested in being able to use Oscar (a Julia package) from Sage.  There is PyJulia, but I wasn't able to get Oscar working from that.  There's William's old pexpect interface at #17230.  Has anyone tried something like this?



---

archive/issue_comments_388329.json:
```json
{
    "body": "I would recommend to start with the other direction, running Sage from Julia. I started #31350, see README at https://github.com/mkoeppe/SageMath.jl",
    "created_at": "2021-02-15T20:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388329",
    "user": "mkoeppe"
}
```

I would recommend to start with the other direction, running Sage from Julia. I started #31350, see README at https://github.com/mkoeppe/SageMath.jl



---

archive/issue_comments_388330.json:
```json
{
    "body": "Thanks!  I tried Variant 2 out using a normal build of Sage rather than a conda one and it worked.  I used\n\n```\njulia> ENV[\"PYTHON\"]=rstrip(read(`sage`, String))\njulia> using Pkg\njulia> Pkg.build(\"PyCall\")\njulia> using PyCall\njulia> sage_all = pyimport(\"sage.all\")\njulia> sage_all.ZZ(\"17\")\nPyObject 17\njulia> sage_all.polytopes.cube()\nPyObject A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices\n```\n\n\nHave you thought much about going in the other direction?",
    "created_at": "2021-02-15T21:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388330",
    "user": "roed"
}
```

Thanks!  I tried Variant 2 out using a normal build of Sage rather than a conda one and it worked.  I used

```
julia> ENV["PYTHON"]=rstrip(read(`sage`, String))
julia> using Pkg
julia> Pkg.build("PyCall")
julia> using PyCall
julia> sage_all = pyimport("sage.all")
julia> sage_all.ZZ("17")
PyObject 17
julia> sage_all.polytopes.cube()
PyObject A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices
```


Have you thought much about going in the other direction?



---

archive/issue_comments_388331.json:
```json
{
    "body": "Last time I tried the other direction, in #28754, there were technical problems with cysignals (I think).\n\nIf you run the testsuite, I think also some errors involving cysignals show up there.\n\nI think it is best to investigate and fix these problems first before attempting the `python-jl` route again.",
    "created_at": "2021-02-15T21:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388331",
    "user": "mkoeppe"
}
```

Last time I tried the other direction, in #28754, there were technical problems with cysignals (I think).

If you run the testsuite, I think also some errors involving cysignals show up there.

I think it is best to investigate and fix these problems first before attempting the `python-jl` route again.



---

archive/issue_comments_388332.json:
```json
{
    "body": "pyjulia works for me somewhat (I had to copy a few header files around so the GAP wrapper builds.)\n\n\n```\n>>> from julia import Oscar;Oscar.PadicField(2, 30)\n<PyCall.jlwrap Field of 2-adic numbers>\n```\n\n\nOnce I imported `Oscar`, as soon as I press the \"up\" key in the Python REPL, there's a segfault:\n\n\n```\nsignal (11): Segmentation fault\nin expression starting at none:0\nHDLR_FUNC at /workspace/srcdir/gap/src/calls.h:134 [inlined]\nHDLR_1ARGS at /workspace/srcdir/gap/src/calls.h:245 [inlined]\nCALL_1ARGS at /workspace/srcdir/gap/src/calls.h:320 [inlined]\nCall1ArgsInNewReader at /workspace/srcdir/gap/src/read.c:2893\nGAP_rl_func at /workspace/srcdir/gap/src/sysfiles.c:2087\n_rl_dispatch_subseq at /usr/lib/libreadline.so.8 (unknown line)\nreadline_internal_char at /usr/lib/libreadline.so.8 (unknown line)\nrl_callback_read_char at /usr/lib/libreadline.so.8 (unknown line)\nunknown function (ip: 0x7fede824c513)\nPyOS_Readline at /usr/lib/libpython3.9.so.1.0 (unknown line)\nunknown function (ip: 0x7fede7efa718)\nunknown function (ip: 0x7fede7fd7f40)\nunknown function (ip: 0x7fede7fd60ab)\nunknown function (ip: 0x7fede8072ecc)\nunknown function (ip: 0x7fede8072a0e)\nunknown function (ip: 0x7fede7f1bfc3)\nunknown function (ip: 0x7fede7f8e407)\nPyRun_InteractiveLoopFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)\nPyRun_AnyFileExFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)\nunknown function (ip: 0x7fede7f113a2)\nPy_BytesMain at /usr/lib/libpython3.9.so.1.0 (unknown line)\n__libc_start_main at /usr/lib/libc.so.6 (unknown line)\n_start at python (unknown line)\nAllocations: 56537538 (Pool: 56492870; Big: 44668); GC: 45\n[1]    1202215 segmentation fault (core dumped)  python\n```\n\n\nIt works much better in IPython:\n\n```\nIn []: from julia import Oscar\n\nIn []: p=5\n\nIn []: Qp = Oscar.PadicField(p, 30)\n\nIn []: a = 2*p + 4*p^2 + 1*p^3 + Oscar.O(Qp, p**4)\nTypeError: unsupported operand type(s) for +: 'int' and 'PyCall.jlwrap'\n\nIn []: from julia import Main\n\nIn []: plus = Main.eval('+')\n\nIn []: from functools import reduce\n\nIn []: a = reduce(plus, [2*p, 4*p**2, 1*p**3, Oscar.O(Qp, p**4)])\n\nIn []: Main.show(a)\n2*5^1 + 4*5^2 + 5^3 + O(5^4)\n```\n\n\nDisclaimer: I have no idea how this all works\u2026",
    "created_at": "2021-02-15T22:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388332",
    "user": "saraedum"
}
```

pyjulia works for me somewhat (I had to copy a few header files around so the GAP wrapper builds.)


```
>>> from julia import Oscar;Oscar.PadicField(2, 30)
<PyCall.jlwrap Field of 2-adic numbers>
```


Once I imported `Oscar`, as soon as I press the "up" key in the Python REPL, there's a segfault:


```
signal (11): Segmentation fault
in expression starting at none:0
HDLR_FUNC at /workspace/srcdir/gap/src/calls.h:134 [inlined]
HDLR_1ARGS at /workspace/srcdir/gap/src/calls.h:245 [inlined]
CALL_1ARGS at /workspace/srcdir/gap/src/calls.h:320 [inlined]
Call1ArgsInNewReader at /workspace/srcdir/gap/src/read.c:2893
GAP_rl_func at /workspace/srcdir/gap/src/sysfiles.c:2087
_rl_dispatch_subseq at /usr/lib/libreadline.so.8 (unknown line)
readline_internal_char at /usr/lib/libreadline.so.8 (unknown line)
rl_callback_read_char at /usr/lib/libreadline.so.8 (unknown line)
unknown function (ip: 0x7fede824c513)
PyOS_Readline at /usr/lib/libpython3.9.so.1.0 (unknown line)
unknown function (ip: 0x7fede7efa718)
unknown function (ip: 0x7fede7fd7f40)
unknown function (ip: 0x7fede7fd60ab)
unknown function (ip: 0x7fede8072ecc)
unknown function (ip: 0x7fede8072a0e)
unknown function (ip: 0x7fede7f1bfc3)
unknown function (ip: 0x7fede7f8e407)
PyRun_InteractiveLoopFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)
PyRun_AnyFileExFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)
unknown function (ip: 0x7fede7f113a2)
Py_BytesMain at /usr/lib/libpython3.9.so.1.0 (unknown line)
__libc_start_main at /usr/lib/libc.so.6 (unknown line)
_start at python (unknown line)
Allocations: 56537538 (Pool: 56492870; Big: 44668); GC: 45
[1]    1202215 segmentation fault (core dumped)  python
```


It works much better in IPython:

```
In []: from julia import Oscar

In []: p=5

In []: Qp = Oscar.PadicField(p, 30)

In []: a = 2*p + 4*p^2 + 1*p^3 + Oscar.O(Qp, p**4)
TypeError: unsupported operand type(s) for +: 'int' and 'PyCall.jlwrap'

In []: from julia import Main

In []: plus = Main.eval('+')

In []: from functools import reduce

In []: a = reduce(plus, [2*p, 4*p**2, 1*p**3, Oscar.O(Qp, p**4)])

In []: Main.show(a)
2*5^1 + 4*5^2 + 5^3 + O(5^4)
```


Disclaimer: I have no idea how this all works…



---

archive/issue_comments_388333.json:
```json
{
    "body": "I just came across https://github.com/cjdoris/PythonCall.jl which while similar to PyCall is a bit different https://cjdoris.github.io/PythonCall.jl/stable/pycall/ might be worth a look, it was designed by a mathematician with a lot of Magma experience at least so might have some Sage relevant design decisions.",
    "created_at": "2021-03-28T22:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27525#issuecomment-388333",
    "user": "alexjbest"
}
```

I just came across https://github.com/cjdoris/PythonCall.jl which while similar to PyCall is a bit different https://cjdoris.github.io/PythonCall.jl/stable/pycall/ might be worth a look, it was designed by a mathematician with a lot of Magma experience at least so might have some Sage relevant design decisions.
