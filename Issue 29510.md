# Issue 29510: Add tangent_line() to curves

archive/issues_029510.json:
```json
{
    "body": "Add tangent_line() and tangent_space() methods to curves.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29747\n\n",
    "created_at": "2020-05-28T11:43:40Z",
    "labels": [
        "algebraic geometry",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Add tangent_line() to curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29510",
    "user": "klee"
}
```
Add tangent_line() and tangent_space() methods to curves.

Issue created by migration from https://trac.sagemath.org/ticket/29747





---

archive/issue_comments_418979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-28T11:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418979",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418980.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-01T01:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418980",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_418981.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-01T01:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418981",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418982.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-01T01:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418982",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418983.json:
```json
{
    "body": "A few comments:\n\nThis is a bit faster and `int` is immutable:\n\n```diff\n-return self([0 for i in range(self.ngens())])\n+return self([0]*self.ngens())\n```\n\n\nI don't think the `list` is needed here:\n\n```diff\n-Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )\n+Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )\n```\n\n\nThis is a little cleaner IMO:\n\n```diff\n-I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))\n+I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))\n```\n\n\nThis is not future-proof (if `i` gets made so it remains local to the for-loop):\n\n```diff\n         for i in range(len(p)):\n             if p[i]:\n-                break\n-\n-        C = self.affine_patch(i)\n-        q = p.dehomogenize(i)\n-        T = C.tangent_line(q)\n-\n-        return T.projective_closure(i, self.ambient_space())\n+                C = self.affine_patch(i)\n+                q = p.dehomogenize(i)\n+                T = C.tangent_line(q)\n+                return T.projective_closure(i, self.ambient_space())\n+\n+        n = len(p)\n+        C = self.affine_patch(n)\n+        q = p.dehomogenize(n)\n+        T = C.tangent_line(q)\n+        return T.projective_closure(n, self.ambient_space())\n```\n\nI am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?",
    "created_at": "2020-06-01T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418983",
    "user": "tscrim"
}
```

A few comments:

This is a bit faster and `int` is immutable:

```diff
-return self([0 for i in range(self.ngens())])
+return self([0]*self.ngens())
```


I don't think the `list` is needed here:

```diff
-Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
+Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
```


This is a little cleaner IMO:

```diff
-I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
+I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
```


This is not future-proof (if `i` gets made so it remains local to the for-loop):

```diff
         for i in range(len(p)):
             if p[i]:
-                break
-
-        C = self.affine_patch(i)
-        q = p.dehomogenize(i)
-        T = C.tangent_line(q)
-
-        return T.projective_closure(i, self.ambient_space())
+                C = self.affine_patch(i)
+                q = p.dehomogenize(i)
+                T = C.tangent_line(q)
+                return T.projective_closure(i, self.ambient_space())
+
+        n = len(p)
+        C = self.affine_patch(n)
+        q = p.dehomogenize(n)
+        T = C.tangent_line(q)
+        return T.projective_closure(n, self.ambient_space())
```

I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?



---

archive/issue_comments_418984.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T05:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418984",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418985.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-06-01T05:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418985",
    "user": "tscrim"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_418986.json:
```json
{
    "body": "Replying to [comment:9 tscrim]:\n> A few comments:\n> \n> This is a bit faster and `int` is immutable:\n> {{{#!diff\n> -return self([0 for i in range(self.ngens())])\n> +return self([0]*self.ngens())\n> }}}\n\nDone.\n\n> I don't think the `list` is needed here:\n> {{{#!diff\n> -Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )\n> +Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )\n> }}}\n\nDone.\n\n> This is a little cleaner IMO:\n> {{{#!diff\n> -I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))\n> +I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))\n> }}}\n\nDone.\n\n> This is not future-proof (if `i` gets made so it remains local to the for-loop):\n> {{{#!diff\n>          for i in range(len(p)):\n>              if p[i]:\n> -                break\n> -\n> -        C = self.affine_patch(i)\n> -        q = p.dehomogenize(i)\n> -        T = C.tangent_line(q)\n> -\n> -        return T.projective_closure(i, self.ambient_space())\n> +                C = self.affine_patch(i)\n> +                q = p.dehomogenize(i)\n> +                T = C.tangent_line(q)\n> +                return T.projective_closure(i, self.ambient_space())\n> +\n> +        n = len(p)\n> +        C = self.affine_patch(n)\n> +        q = p.dehomogenize(n)\n> +        T = C.tangent_line(q)\n> +        return T.projective_closure(n, self.ambient_space())\n> }}}\n> I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?\n\nRight. There is no rational point with all zero homogeneous coordinates. It is now modified to raise a `TypeError` if somehow the part is reached.",
    "created_at": "2020-06-01T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418986",
    "user": "klee"
}
```

Replying to [comment:9 tscrim]:
> A few comments:
> 
> This is a bit faster and `int` is immutable:
> {{{#!diff
> -return self([0 for i in range(self.ngens())])
> +return self([0]*self.ngens())
> }}}

Done.

> I don't think the `list` is needed here:
> {{{#!diff
> -Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
> +Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
> }}}

Done.

> This is a little cleaner IMO:
> {{{#!diff
> -I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
> +I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
> }}}

Done.

> This is not future-proof (if `i` gets made so it remains local to the for-loop):
> {{{#!diff
>          for i in range(len(p)):
>              if p[i]:
> -                break
> -
> -        C = self.affine_patch(i)
> -        q = p.dehomogenize(i)
> -        T = C.tangent_line(q)
> -
> -        return T.projective_closure(i, self.ambient_space())
> +                C = self.affine_patch(i)
> +                q = p.dehomogenize(i)
> +                T = C.tangent_line(q)
> +                return T.projective_closure(i, self.ambient_space())
> +
> +        n = len(p)
> +        C = self.affine_patch(n)
> +        q = p.dehomogenize(n)
> +        T = C.tangent_line(q)
> +        return T.projective_closure(n, self.ambient_space())
> }}}
> I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?

Right. There is no rational point with all zero homogeneous coordinates. It is now modified to raise a `TypeError` if somehow the part is reached.



---

archive/issue_comments_418987.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-01T06:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418987",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418988.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T06:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418988",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418989.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2020-06-01T06:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418989",
    "user": "tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_418990.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> Thank you. LGTM.\n\nThank you!",
    "created_at": "2020-06-01T06:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418990",
    "user": "klee"
}
```

Replying to [comment:13 tscrim]:
> Thank you. LGTM.

Thank you!



---

archive/issue_comments_418991.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-05T22:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29510#issuecomment-418991",
    "user": "vbraun"
}
```

Resolution: fixed
