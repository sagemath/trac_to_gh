# Issue 29510: Add tangent_line() to curves

Issue created by migration from https://trac.sagemath.org/ticket/29747

Original creator: klee

Original creation time: 2020-05-28 11:43:40

Add tangent_line() and tangent_space() methods to curves.


---

Comment by git created at 2020-05-28 11:46:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-01 01:22:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2020-06-01 01:23:37

Changing status from new to needs_review.


---

Comment by git created at 2020-06-01 01:49:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-01 05:54:49

A few comments:

This is a bit faster and `int` is immutable:

```diff
-return self([0 for i in range(self.ngens())])
+return self([0]*self.ngens())
```


I don't think the `list` is needed here:

```diff
-Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
+Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
```


This is a little cleaner IMO:

```diff
-I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
+I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
```


This is not future-proof (if `i` gets made so it remains local to the for-loop):

```diff
         for i in range(len(p)):
             if p[i]:
-                break
-
-        C = self.affine_patch(i)
-        q = p.dehomogenize(i)
-        T = C.tangent_line(q)
-
-        return T.projective_closure(i, self.ambient_space())
+                C = self.affine_patch(i)
+                q = p.dehomogenize(i)
+                T = C.tangent_line(q)
+                return T.projective_closure(i, self.ambient_space())
+
+        n = len(p)
+        C = self.affine_patch(n)
+        q = p.dehomogenize(n)
+        T = C.tangent_line(q)
+        return T.projective_closure(n, self.ambient_space())
```

I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?


---

Comment by tscrim created at 2020-06-01 05:54:49

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-01 05:54:58

Changing status from positive_review to needs_review.


---

Comment by klee created at 2020-06-01 06:32:45

Replying to [comment:9 tscrim]:
> A few comments:
> 
> This is a bit faster and `int` is immutable:
> {{{#!diff
> -return self([0 for i in range(self.ngens())])
> +return self([0]*self.ngens())
> }}}

Done.

> I don't think the `list` is needed here:
> {{{#!diff
> -Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, list(p)))) )
> +Jp = J.apply_map( lambda f: f.subs(dict(zip(gens, p))) )
> }}}

Done.

> This is a little cleaner IMO:
> {{{#!diff
> -I.append(poly.subs(dict([x, x - c] for x, c in zip(gens, list(p)))))
> +I.append(poly.subs({x: x - c for x, c in zip(gens, p)}))
> }}}

Done.

> This is not future-proof (if `i` gets made so it remains local to the for-loop):
> {{{#!diff
>          for i in range(len(p)):
>              if p[i]:
> -                break
> -
> -        C = self.affine_patch(i)
> -        q = p.dehomogenize(i)
> -        T = C.tangent_line(q)
> -
> -        return T.projective_closure(i, self.ambient_space())
> +                C = self.affine_patch(i)
> +                q = p.dehomogenize(i)
> +                T = C.tangent_line(q)
> +                return T.projective_closure(i, self.ambient_space())
> +
> +        n = len(p)
> +        C = self.affine_patch(n)
> +        q = p.dehomogenize(n)
> +        T = C.tangent_line(q)
> +        return T.projective_closure(n, self.ambient_space())
> }}}
> I am not sure this last part makes sense (I am pretty sure it does not), but the code path could in principle reach here before. Maybe it should raise an error in that case?

Right. There is no rational point with all zero homogeneous coordinates. It is now modified to raise a `TypeError` if somehow the part is reached.


---

Comment by git created at 2020-06-01 06:33:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-01 06:37:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-01 06:37:02

Thank you. LGTM.


---

Comment by klee created at 2020-06-01 06:39:45

Replying to [comment:13 tscrim]:
> Thank you. LGTM.

Thank you!


---

Comment by vbraun created at 2020-06-05 22:12:24

Resolution: fixed
