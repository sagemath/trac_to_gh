# Issue 31772: Eliminate direct use of the Chart._domain attribute

Issue created by migration from https://trac.sagemath.org/ticket/32009

Original creator: mkoeppe

Original creation time: 2021-06-20 03:27:57

CC:  @mjungmath egourgoulhon vbraun

... using the method `.domain()` instead

This is preparation for #31894 - when `_domain` is a Cython attribute, it will not be directly accessible from Python.



---

Comment by mkoeppe created at 2021-06-20 03:28:43

New commits:


---

Comment by mkoeppe created at 2021-06-20 03:28:43

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-06-20 23:48:30

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-06-20 23:48:30

LGTM.


---

Comment by mkoeppe created at 2021-06-21 17:51:36

Thanks!


---

Comment by vbraun created at 2021-07-04 22:43:25


```
sage -t --long --warn-long 43.2 --random-seed=0 src/sage/manifolds/chart.py
**********************************************************************
File "src/sage/manifolds/chart.py", line 184, in sage.manifolds.chart.Chart
Failed example:
    XN.<Z1,Z2> = N.chart('Z1:period=1+2*I Z2')
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3736)
        raise KeyError(k)
    KeyError: ((<class 'sage.manifolds.chart.Chart'>, Complex 2-dimensional topological manifold N), (('calc_method', 'SR'), ('coordinates', 'Z1:period=1+2*I Z2'), ('names', ('Z1', 'Z2'))))

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.manifolds.chart.Chart[22]>", line 1, in <module>
        XN = N.chart('Z1:period=1+2*I Z2', names=('Z1', 'Z2',)); (Z1, Z2,) = XN._first_ngens(2)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/manifold.py", line 1571, in chart
        return self._structure.chart(self, coordinates=coordinates,
      File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6100)
        w = self.f(*args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 486, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2223)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py", line 309, in __init__
        self._init_coordinates(coord_list)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py", line 389, in _init_coordinates
        if domain.base_field_type() in ['real', 'complex']:
    NameError: name 'domain' is not defined
**********************************************************************
[...]
```



---

Comment by vbraun created at 2021-07-04 22:43:25

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-04 23:49:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-04 23:50:07

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2021-07-07 20:59:08

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-07-07 20:59:08

LGTM.


---

Comment by mkoeppe created at 2021-07-07 21:35:02

Thanks!


---

Comment by git created at 2021-07-12 19:17:49

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-07-12 19:17:49

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by mkoeppe created at 2021-07-12 19:18:26

Merged #30473 to resolve merge conflict.


---

Comment by mkoeppe created at 2021-07-12 19:18:26

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-24 19:01:39

Resolution: fixed


---

Comment by mkoeppe created at 2021-07-24 19:01:39

Apparently this has been merged as part of #32089.
