# Issue 31772: Eliminate direct use of the Chart._domain attribute

archive/issues_031772.json:
```json
{
    "body": "CC:  @mjungmath @egourgoulhon @vbraun\n\n... using the method `.domain()` instead\n\nThis is preparation for #31894 - when `_domain` is a Cython attribute, it will not be directly accessible from Python.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32009\n\n",
    "created_at": "2021-06-20T03:27:57Z",
    "labels": [
        "component: manifolds"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Eliminate direct use of the Chart._domain attribute",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31772",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @mjungmath @egourgoulhon @vbraun

... using the method `.domain()` instead

This is preparation for #31894 - when `_domain` is a Cython attribute, it will not be directly accessible from Python.


Issue created by migration from https://trac.sagemath.org/ticket/32009





---

archive/issue_comments_453451.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-20T03:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453451",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_453452.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-20T03:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453452",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_453453.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-20T23:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453453",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453454.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-06-20T23:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453454",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_453455.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-06-21T17:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453455",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_453456.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 43.2 --random-seed=0 src/sage/manifolds/chart.py\n**********************************************************************\nFile \"src/sage/manifolds/chart.py\", line 184, in sage.manifolds.chart.Chart\nFailed example:\n    XN.<Z1,Z2> = N.chart('Z1:period=1+2*I Z2')\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3736)\n        raise KeyError(k)\n    KeyError: ((<class 'sage.manifolds.chart.Chart'>, Complex 2-dimensional topological manifold N), (('calc_method', 'SR'), ('coordinates', 'Z1:period=1+2*I Z2'), ('names', ('Z1', 'Z2'))))\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.manifolds.chart.Chart[22]>\", line 1, in <module>\n        XN = N.chart('Z1:period=1+2*I Z2', names=('Z1', 'Z2',)); (Z1, Z2,) = XN._first_ngens(2)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/manifold.py\", line 1571, in chart\n        return self._structure.chart(self, coordinates=coordinates,\n      File \"sage/misc/classcall_metaclass.pyx\", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)\n        return cls.classcall(cls, *args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6100)\n        w = self.f(*args, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/structure/unique_representation.py\", line 1007, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 486, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2223)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py\", line 309, in __init__\n        self._init_coordinates(coord_list)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py\", line 389, in _init_coordinates\n        if domain.base_field_type() in ['real', 'complex']:\n    NameError: name 'domain' is not defined\n**********************************************************************\n[...]\n```\n",
    "created_at": "2021-07-04T22:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453456",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long --warn-long 43.2 --random-seed=0 src/sage/manifolds/chart.py
**********************************************************************
File "src/sage/manifolds/chart.py", line 184, in sage.manifolds.chart.Chart
Failed example:
    XN.<Z1,Z2> = N.chart('Z1:period=1+2*I Z2')
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5974)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3736)
        raise KeyError(k)
    KeyError: ((<class 'sage.manifolds.chart.Chart'>, Complex 2-dimensional topological manifold N), (('calc_method', 'SR'), ('coordinates', 'Z1:period=1+2*I Z2'), ('names', ('Z1', 'Z2'))))

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.manifolds.chart.Chart[22]>", line 1, in <module>
        XN = N.chart('Z1:period=1+2*I Z2', names=('Z1', 'Z2',)); (Z1, Z2,) = XN._first_ngens(2)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/manifold.py", line 1571, in chart
        return self._structure.chart(self, coordinates=coordinates,
      File "sage/misc/classcall_metaclass.pyx", line 322, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1761)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6100)
        w = self.f(*args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 486, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2223)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py", line 309, in __init__
        self._init_coordinates(coord_list)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/manifolds/chart.py", line 389, in _init_coordinates
        if domain.base_field_type() in ['real', 'complex']:
    NameError: name 'domain' is not defined
**********************************************************************
[...]
```




---

archive/issue_comments_453457.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-04T22:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453457",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_453458.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-04T23:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453458",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453459.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-04T23:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453459",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_453460.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-07T20:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453460",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453461.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-07-07T20:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453461",
    "user": "https://github.com/egourgoulhon"
}
```

LGTM.



---

archive/issue_comments_453462.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-07-07T21:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453462",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_453463.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-07-12T19:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_453464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:",
    "created_at": "2021-07-12T19:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:



---

archive/issue_comments_453465.json:
```json
{
    "body": "Merged #30473 to resolve merge conflict.",
    "created_at": "2021-07-12T19:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453465",
    "user": "https://github.com/mkoeppe"
}
```

Merged #30473 to resolve merge conflict.



---

archive/issue_comments_453466.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-12T19:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453466",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453467.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T19:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453467",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: fixed



---

archive/issue_comments_453468.json:
```json
{
    "body": "Apparently this has been merged as part of #32089.",
    "created_at": "2021-07-24T19:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31772#issuecomment-453468",
    "user": "https://github.com/mkoeppe"
}
```

Apparently this has been merged as part of #32089.



---

archive/issue_events_028932.json:
```json
{
    "actor": "@mkoeppe",
    "created_at": "2021-07-24T19:01:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31772",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31772#event-28932"
}
```
