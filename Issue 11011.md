# Issue 11011: Integral of sin(x)/x gives false result.

archive/issues_011011.json:
```json
{
    "body": "Assignee: tbd\n\n\n```\n> eq = sin(x)/x\n> integrate(eq, x, -1e-6, 1e6)\n-3.14159065359\n```\n\nI expected an answer of about 2e-6.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11164\n\n",
    "created_at": "2011-04-09T20:05:30Z",
    "labels": [
        "PLEASE CHANGE",
        "minor",
        "bug"
    ],
    "title": "Integral of sin(x)/x gives false result.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11011",
    "user": "benreynwar"
}
```
Assignee: tbd


```
> eq = sin(x)/x
> integrate(eq, x, -1e-6, 1e6)
-3.14159065359
```

I expected an answer of about 2e-6.

Issue created by migration from https://trac.sagemath.org/ticket/11164





---

archive/issue_comments_119679.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to calculus.",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119679",
    "user": "kcrisman"
}
```

Changing component from PLEASE CHANGE to calculus.



---

archive/issue_comments_119680.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119680",
    "user": "kcrisman"
}
```

Changing priority from minor to major.



---

archive/issue_comments_119681.json:
```json
{
    "body": "Changing assignee from tbd to burcin.",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119681",
    "user": "kcrisman"
}
```

Changing assignee from tbd to burcin.



---

archive/issue_comments_119682.json:
```json
{
    "body": "In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.\n\nThere are two problems here.\n* The actual problem - the report unfortunately has a typo.\n\n```\nsage: integrate(eq,x,-1e-6,1e-6)\n-3.14159065359\n```\n\n   This is definitely a problem.  However, it's fixed in the latest Maxima.  Here is the old one, in Sage:\n\n```\nMaxima 5.22.1 http://maxima.sourceforge.net\nusing Lisp ECL 10.4.1\n<snip>\n(%i2) keepfloat:true;\n(%o2)                                true\n(%i3) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6)\n;\n(%o3)                         - 3.141590653589793\n```\n\n   And here is 5.24.0.  I assume this isn't a problem of which Lisp we are using?\n\n```\nMaxima 5.24.0 http://maxima.sourceforge.net\nusing Lisp SBCL 1.0.24\n(%i3) keepfloat:true;\n(%o3)                                true\n(%i8) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6);\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n                                 %i                                %i\n(%o8) %i gamma_incomplete(0, - -------) - %i gamma_incomplete(0, -------)\n                               1000000                           1000000\n```\n\n* A problem revealed, but also fixed in the latest.   Old:\n\n```\n(%i4) integrate(sin(x)/x,x,-1e-6,1e6);\n\nMaxima encountered a Lisp error:\n\n #<a FLOATING-POINT-OVERFLOW>\n\nAutomatically continuing.\nTo enable the Lisp debugger set *debugger-hook* to nil.\n\n```\n\n   New:\n\n```\n(%i10) integrate(sin(x)/x,x,-1e-6,1e6);\n\nrat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7\n\nrat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7\n\nrat: replaced -1000000.0 by -1000000/1 = -1000000.0\n\nrat: replaced 1000000.0 by 1000000/1 = 1000000.0\n                                                                       %i\n                                              %i gamma_incomplete(0, -------)\n         %i gamma_incomplete(0, 1000000 %i)                          1000000\n(%o10) - ---------------------------------- - -------------------------------\n                         2                                   2\n                                  %i\n       %i gamma_incomplete(0, - -------)\n                                1000000    %i gamma_incomplete(0, - 1000000 %i)\n     + --------------------------------- + ------------------------------------\n                       2                                    2\n```\n\n\nWe'd need doctesting to test both of these once we upgrade Maxima.",
    "created_at": "2011-04-14T01:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119682",
    "user": "kcrisman"
}
```

In the future, be sure to pick a component (for instance, calculus or symbolics); that will help people find it more easily.

There are two problems here.
* The actual problem - the report unfortunately has a typo.

```
sage: integrate(eq,x,-1e-6,1e-6)
-3.14159065359
```

   This is definitely a problem.  However, it's fixed in the latest Maxima.  Here is the old one, in Sage:

```
Maxima 5.22.1 http://maxima.sourceforge.net
using Lisp ECL 10.4.1
<snip>
(%i2) keepfloat:true;
(%o2)                                true
(%i3) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6)
;
(%o3)                         - 3.141590653589793
```

   And here is 5.24.0.  I assume this isn't a problem of which Lisp we are using?

```
Maxima 5.24.0 http://maxima.sourceforge.net
using Lisp SBCL 1.0.24
(%i3) keepfloat:true;
(%o3)                                true
(%i8) integrate(sin(x)/x,x,-1.00000000000000e-6,1.00000000000000e-6);

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7
                                 %i                                %i
(%o8) %i gamma_incomplete(0, - -------) - %i gamma_incomplete(0, -------)
                               1000000                           1000000
```

* A problem revealed, but also fixed in the latest.   Old:

```
(%i4) integrate(sin(x)/x,x,-1e-6,1e6);

Maxima encountered a Lisp error:

 #<a FLOATING-POINT-OVERFLOW>

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.

```

   New:

```
(%i10) integrate(sin(x)/x,x,-1e-6,1e6);

rat: replaced 9.999999999999999e-7 by 1/1000000 = 9.999999999999999e-7

rat: replaced -9.999999999999999e-7 by -1/1000000 = -9.999999999999999e-7

rat: replaced -1000000.0 by -1000000/1 = -1000000.0

rat: replaced 1000000.0 by 1000000/1 = 1000000.0
                                                                       %i
                                              %i gamma_incomplete(0, -------)
         %i gamma_incomplete(0, 1000000 %i)                          1000000
(%o10) - ---------------------------------- - -------------------------------
                         2                                   2
                                  %i
       %i gamma_incomplete(0, - -------)
                                1000000    %i gamma_incomplete(0, - 1000000 %i)
     + --------------------------------- + ------------------------------------
                       2                                    2
```


We'd need doctesting to test both of these once we upgrade Maxima.



---

archive/issue_comments_119683.json:
```json
{
    "body": "add doctest to confirm fix",
    "created_at": "2011-12-15T05:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119683",
    "user": "dsm"
}
```

add doctest to confirm fix



---

archive/issue_comments_119684.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-15T05:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119684",
    "user": "dsm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_119685.json:
```json
{
    "body": "Attachment\n\nMight as well doctest and close.",
    "created_at": "2011-12-15T05:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119685",
    "user": "dsm"
}
```

Attachment

Might as well doctest and close.



---

archive/issue_comments_119686.json:
```json
{
    "body": "I may have misstated whether this is \"fixed\". \n\n```\nsage: integrate(sin(x)/x,x,-1e-6,1e-6)\nI*Ei(-1/1000000*I) - I*Ei(1/1000000*I)\nsage: integrate(sin(x)/x,x,-1e-6,1e-6).n()\n3.14159465358979\nsage: numerical_integral(sin(x)/x,-1e-6,1e-6)\n(1.9999999999998889e-06, nan)\n```\n\nThe graph makes it very obvious the second (numerical) answer is correct.  Unsurprisingly, the other answer is off by exactly `pi`...\n\nPresumably the first answer is \"correct\" in the sense that it is an alternate representation of the `Si` sine integral function.  But I think there are some branch issues - `Ei(I*x)` only has an alternate formula for `x>0`.  \n\nSo we still need to do something with this.  Or at the very least warn about branches.  But really, `sin(x)/x` shouldn't have to worry about this!",
    "created_at": "2011-12-15T14:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119686",
    "user": "kcrisman"
}
```

I may have misstated whether this is "fixed". 

```
sage: integrate(sin(x)/x,x,-1e-6,1e-6)
I*Ei(-1/1000000*I) - I*Ei(1/1000000*I)
sage: integrate(sin(x)/x,x,-1e-6,1e-6).n()
3.14159465358979
sage: numerical_integral(sin(x)/x,-1e-6,1e-6)
(1.9999999999998889e-06, nan)
```

The graph makes it very obvious the second (numerical) answer is correct.  Unsurprisingly, the other answer is off by exactly `pi`...

Presumably the first answer is "correct" in the sense that it is an alternate representation of the `Si` sine integral function.  But I think there are some branch issues - `Ei(I*x)` only has an alternate formula for `x>0`.  

So we still need to do something with this.  Or at the very least warn about branches.  But really, `sin(x)/x` shouldn't have to worry about this!



---

archive/issue_comments_119687.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-15T14:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119687",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119688.json:
```json
{
    "body": "You're right, of course.  It's silly to start with sin(x)/x and then generalize to something which doesn't reduce to the expected value, but far, far sillier to add a doctest enshrining the goofy behaviour as the expected. :^) \n\nDoes this work on the current maxima trunk now?",
    "created_at": "2011-12-15T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119688",
    "user": "dsm"
}
```

You're right, of course.  It's silly to start with sin(x)/x and then generalize to something which doesn't reduce to the expected value, but far, far sillier to add a doctest enshrining the goofy behaviour as the expected. :^) 

Does this work on the current maxima trunk now?



---

archive/issue_comments_119689.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-12-15T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119689",
    "user": "dsm"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_119690.json:
```json
{
    "body": "This is the previous version (5.25.1):\n\n```\n\n(%i5) integrate(sin(x)/x,x,-1/1000000,1/1000000);\n\n(%o5) %i*gamma_incomplete(0,-%i/1000000)-%i*gamma_incomplete(0,%i/1000000)\n\n```\n\nW|A agrees that this is about `-pi`.  (To be precise, `2*Si(1/10^6)-pi`.)  \n\n```\n\n(%i4) display2d:false;\n\n(%o4) false\n(%i5) integrate(sin(x)/x,x);\n\n(%o5) -(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\n```\n\nHere is the issue; this function may or may not be the same as the sine integral.  The problem seems to be that although Maxima has the sine integral (`expintegral_si`), it isn't really connected with the rest of Maxima (?).\n\nWhat do you think a good solution to this is?  I suppose we could open a ticket for it on the Maxima site, but I'm not sure whether the `Si` there is robust enough to handle all this yet.",
    "created_at": "2011-12-15T14:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119690",
    "user": "kcrisman"
}
```

This is the previous version (5.25.1):

```

(%i5) integrate(sin(x)/x,x,-1/1000000,1/1000000);

(%o5) %i*gamma_incomplete(0,-%i/1000000)-%i*gamma_incomplete(0,%i/1000000)

```

W|A agrees that this is about `-pi`.  (To be precise, `2*Si(1/10^6)-pi`.)  

```

(%i4) display2d:false;

(%o4) false
(%i5) integrate(sin(x)/x,x);

(%o5) -(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
```

Here is the issue; this function may or may not be the same as the sine integral.  The problem seems to be that although Maxima has the sine integral (`expintegral_si`), it isn't really connected with the rest of Maxima (?).

What do you think a good solution to this is?  I suppose we could open a ticket for it on the Maxima site, but I'm not sure whether the `Si` there is robust enough to handle all this yet.



---

archive/issue_comments_119691.json:
```json
{
    "body": "> Here is the issue; this function may or may not be the same as the sine integral.  \nBy which I mean it isn't the same, of course, but also that (as defined) it isn't even always the same constant away.  Antiderivatives can differ by a constant, but when the constant is different depending on what `x` is, that's annoying.  I think the Maxima folks would say this is a feature (for symbolic reasons).",
    "created_at": "2011-12-15T14:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119691",
    "user": "kcrisman"
}
```

> Here is the issue; this function may or may not be the same as the sine integral.  
By which I mean it isn't the same, of course, but also that (as defined) it isn't even always the same constant away.  Antiderivatives can differ by a constant, but when the constant is different depending on what `x` is, that's annoying.  I think the Maxima folks would say this is a feature (for symbolic reasons).



---

archive/issue_comments_119692.json:
```json
{
    "body": "By the way, achrzesz has a great one-liner for [a related question](http://ask.sagemath.org/question/6/how-do-i-understand-the-result-of-symbolic):\n\n```\n maxima('integrate(diff((exp(x)-1)/x,x),x),gamma_expand:true,factor').sage()\n```\n\nThough here it doesn't solve the problem, but maybe it will trigger someone's memory as to another Maxima flag to set...\n\n```\nsage: maxima('integrate(sin(x)/x,x,-1/1000000,1/1000000),gamma_expand:true').sage()\nI*expintegral_ei(-1/1000000*I) - I*expintegral_ei(1/1000000*I) # currently not translated into Sage, but see #11143\nsage: a = I*Ei(-1/1000000*I)-I*Ei(1/1000000*I)\nsage: a.n()\n3.14159465358979\n```\n",
    "created_at": "2011-12-24T04:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119692",
    "user": "kcrisman"
}
```

By the way, achrzesz has a great one-liner for [a related question](http://ask.sagemath.org/question/6/how-do-i-understand-the-result-of-symbolic):

```
 maxima('integrate(diff((exp(x)-1)/x,x),x),gamma_expand:true,factor').sage()
```

Though here it doesn't solve the problem, but maybe it will trigger someone's memory as to another Maxima flag to set...

```
sage: maxima('integrate(sin(x)/x,x,-1/1000000,1/1000000),gamma_expand:true').sage()
I*expintegral_ei(-1/1000000*I) - I*expintegral_ei(1/1000000*I) # currently not translated into Sage, but see #11143
sage: a = I*Ei(-1/1000000*I)-I*Ei(1/1000000*I)
sage: a.n()
3.14159465358979
```




---

archive/issue_comments_119693.json:
```json
{
    "body": "I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...",
    "created_at": "2013-01-20T01:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119693",
    "user": "kcrisman"
}
```

I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...



---

archive/issue_comments_119694.json:
```json
{
    "body": "> I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...\nApparently not yet.",
    "created_at": "2013-06-26T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119694",
    "user": "kcrisman"
}
```

> I wonder whether this is potentially fixed in #13364 - I don't know if we ever reported upstream, or whether we should have...
Apparently not yet.



---

archive/issue_comments_119695.json:
```json
{
    "body": "In 6.3.beta4 (so with #13973), I get:\n\n```\nsage: eq = sin(x) / x\nsage: integrate(eq, x, -1e-6, 1e-6)\n-I*Ei(1/1000000*I) + I*Ei(-1/1000000*I)\nsage: _.n()\n3.14159465358979\nsage: integrate(eq, x, -1e-12, 1e-12)\n-I*Ei(1/1000000000000*I) + I*Ei(-1/1000000000000*I)\nsage: _.n()\n3.14159265359179\n```\n\nSomething bad happens with the integration computation when crossing over 0 as we have:\n\n```\nsage: integrate(eq, x, 1e-12, 1e-6)\n-1/2*I*Ei(1/1000000*I) + 1/2*I*Ei(1/1000000000000*I) - 1/2*I*Ei(-1/1000000000000*I) + 1/2*I*Ei(-1/1000000*I)\nsage: _.n()\n9.99999000050877e-7\n```\n",
    "created_at": "2014-06-23T18:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119695",
    "user": "tscrim"
}
```

In 6.3.beta4 (so with #13973), I get:

```
sage: eq = sin(x) / x
sage: integrate(eq, x, -1e-6, 1e-6)
-I*Ei(1/1000000*I) + I*Ei(-1/1000000*I)
sage: _.n()
3.14159465358979
sage: integrate(eq, x, -1e-12, 1e-12)
-I*Ei(1/1000000000000*I) + I*Ei(-1/1000000000000*I)
sage: _.n()
3.14159265359179
```

Something bad happens with the integration computation when crossing over 0 as we have:

```
sage: integrate(eq, x, 1e-12, 1e-6)
-1/2*I*Ei(1/1000000*I) + 1/2*I*Ei(1/1000000000000*I) - 1/2*I*Ei(-1/1000000000000*I) + 1/2*I*Ei(-1/1000000*I)
sage: _.n()
9.99999000050877e-7
```




---

archive/issue_comments_119696.json:
```json
{
    "body": "The problem is caused by the integral being computed via symbolic integration; see also comment:5.  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.",
    "created_at": "2014-06-24T00:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119696",
    "user": "pbruin"
}
```

The problem is caused by the integral being computed via symbolic integration; see also comment:5.  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.



---

archive/issue_comments_119697.json:
```json
{
    "body": "> The problem is caused by the integral being computed via symbolic integration; see also comment:5.  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.\n\nHow much you wanna bet this is the same underlying problem as in #17328?",
    "created_at": "2014-11-14T21:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119697",
    "user": "kcrisman"
}
```

> The problem is caused by the integral being computed via symbolic integration; see also comment:5.  Maxima integrates `exp(x)/x` to `-gamma_incomplete(0, -x)`, which is in principle correct, but only gives a certain branch of the integral.  The branch cut chosen for the incomplete Gamma function is along the negative real axis.  When using this to compute `integrate(sin(x)/x, x, -1, 1)`, the two terms coming from `exp(%i*x)` and `exp(-%i*x)` have branch cuts along the negative and positive imaginary axis, respectively, so the sum has a branch cut along the whole imaginary axis and therefore can't be the antiderivative of `sin(x)/x`, which is an entire function.

How much you wanna bet this is the same underlying problem as in #17328?



---

archive/issue_comments_119698.json:
```json
{
    "body": "> How much you wanna bet this is the same underlying problem as in #17328?\nNah, I was thrown off by the gammas, I think.\n\nWhat if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?",
    "created_at": "2014-11-15T02:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119698",
    "user": "kcrisman"
}
```

> How much you wanna bet this is the same underlying problem as in #17328?
Nah, I was thrown off by the gammas, I think.

What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?



---

archive/issue_comments_119699.json:
```json
{
    "body": "> What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\nLooks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).",
    "created_at": "2014-11-17T16:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119699",
    "user": "kcrisman"
}
```

> What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?
Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).



---

archive/issue_comments_119700.json:
```json
{
    "body": "> > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\n> Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).\nOr maybe not; \n\n```\nsage: maxima('integrate(sin(x)/x,x)')\n-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\nsage: maxima('integrate(sin(x)/x,x), gamma_expand:true')\n-(%i*expintegral_ei(%i*x)-%i*expintegral_ei(-%i*x)+2*%pi)/2\n```\n\nso maybe we are already setting `gamma_expand:true` somewhere nowadays.  Reported upstream at https://sourceforge.net/p/maxima/bugs/2842/",
    "created_at": "2014-11-17T16:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119700",
    "user": "kcrisman"
}
```

> > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?
> Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).
Or maybe not; 

```
sage: maxima('integrate(sin(x)/x,x)')
-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
sage: maxima('integrate(sin(x)/x,x), gamma_expand:true')
-(%i*expintegral_ei(%i*x)-%i*expintegral_ei(-%i*x)+2*%pi)/2
```

so maybe we are already setting `gamma_expand:true` somewhere nowadays.  Reported upstream at https://sourceforge.net/p/maxima/bugs/2842/



---

archive/issue_comments_119701.json:
```json
{
    "body": "See also the documentation for [gamma_expand](http://maxima.sourceforge.net/docs/manual/maxima_15.html#Item_003a-gamma_005fexpand).  The [changelog says](http://www.walkingrandomly.com/images/maxima/ChangeLog-5.17-special-functions.txt)\n\n```\n\nImplementation of the Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete(a,z)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for gamma_incomplete(a,0) and gamma_incomplete(a,inf)\n - When $gamma_expand T expand the following expressions:\n   gamma_incomplete(0,z)\n   gamma_incomplete(n+1/2)\n   gamma_incomplete(1/2-n)\n   gamma_incomplete(n,z)\n   gamma_incomplete(-n,z)\n   gamma_incomplete(a+n,z)\n   gamma_incomplete(a-n,z)\n - Mirror symmetry\n - Derivative wrt the arguments a and z\n\n--------------------------------------------------------------------------------\nImplementation of the Generalized Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete_generalized(a,z1,z2)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for:\n   gamma_incomplete_generalized(a,z1,0)\n   gamma_incomplete_generalized(a,0,z2),\n   gamma_incomplete_generalized(a,z1,inf)\n   gamma_incomplete_generalized(a,inf,z2)\n   gamma_incomplete_generalized(a,0,inf)\n   gamma_incomplete_generalized(a,x,x)\n - When $gamma_expand T and n an integer expand\n   gamma_incomplete_generalized(a+n,z1,z2)\n - Implementation of Mirror symmetry\n - Derivative wrt the arguments a, z1 and z2\n\n--------------------------------------------------------------------------------\nImplementation of the Regularized Incomplete Gamma function\n\n New Maxima User function: gamma_incomplete_regularized(a,z)\n\n The following features are implemented:\n\n - Evaluation for real and complex numbers in double float and\n   bigfloat precision\n - Special values for:\n   gamma_incomplete_regularized(a,0)\n   gamma_incomplete_regularized(0,z)\n   gamma_incomplete_regularized(a,inf)\n - When $gamma_expand T and n a positive integer expansions for\n   gamma_incomplete_regularized(n+1/2,z)\n   gamma_incomplete_regularized(1/2-n,z)\n   gamma_incomplete_regularized(n,z)\n   gamma_incomplete_regularized(a+n,z)\n   gamma_incomplete_regularized(a-n,z)\n - Derivative wrt the arguments a and z\n - Implementation of Mirror symmetry\n\n```\n",
    "created_at": "2014-11-17T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119701",
    "user": "kcrisman"
}
```

See also the documentation for [gamma_expand](http://maxima.sourceforge.net/docs/manual/maxima_15.html#Item_003a-gamma_005fexpand).  The [changelog says](http://www.walkingrandomly.com/images/maxima/ChangeLog-5.17-special-functions.txt)

```

Implementation of the Incomplete Gamma function

 New Maxima User function: gamma_incomplete(a,z)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for gamma_incomplete(a,0) and gamma_incomplete(a,inf)
 - When $gamma_expand T expand the following expressions:
   gamma_incomplete(0,z)
   gamma_incomplete(n+1/2)
   gamma_incomplete(1/2-n)
   gamma_incomplete(n,z)
   gamma_incomplete(-n,z)
   gamma_incomplete(a+n,z)
   gamma_incomplete(a-n,z)
 - Mirror symmetry
 - Derivative wrt the arguments a and z

--------------------------------------------------------------------------------
Implementation of the Generalized Incomplete Gamma function

 New Maxima User function: gamma_incomplete_generalized(a,z1,z2)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for:
   gamma_incomplete_generalized(a,z1,0)
   gamma_incomplete_generalized(a,0,z2),
   gamma_incomplete_generalized(a,z1,inf)
   gamma_incomplete_generalized(a,inf,z2)
   gamma_incomplete_generalized(a,0,inf)
   gamma_incomplete_generalized(a,x,x)
 - When $gamma_expand T and n an integer expand
   gamma_incomplete_generalized(a+n,z1,z2)
 - Implementation of Mirror symmetry
 - Derivative wrt the arguments a, z1 and z2

--------------------------------------------------------------------------------
Implementation of the Regularized Incomplete Gamma function

 New Maxima User function: gamma_incomplete_regularized(a,z)

 The following features are implemented:

 - Evaluation for real and complex numbers in double float and
   bigfloat precision
 - Special values for:
   gamma_incomplete_regularized(a,0)
   gamma_incomplete_regularized(0,z)
   gamma_incomplete_regularized(a,inf)
 - When $gamma_expand T and n a positive integer expansions for
   gamma_incomplete_regularized(n+1/2,z)
   gamma_incomplete_regularized(1/2-n,z)
   gamma_incomplete_regularized(n,z)
   gamma_incomplete_regularized(a+n,z)
   gamma_incomplete_regularized(a-n,z)
 - Derivative wrt the arguments a and z
 - Implementation of Mirror symmetry

```




---

archive/issue_comments_119702.json:
```json
{
    "body": "> > > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?\n> > Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).\n> Or maybe not; \nDrivel.  We could try this, though the branch problem is likely still there with incomplete gamma.\n\n```\nsage: maxima_calculus('integrate(sin(x)/x,x)')\n-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2\nsage: maxima_calculus('integrate(sin(x)/x,x)').sage()\n-1/2*I*Ei(I*x) + 1/2*I*Ei(-I*x)\n```\n\nbecause we do\n\n```\n        if x == 0:\n            return -Ei(-y)\n```\n\nin sage/functions/other.py\n\nBut unfortunately\n\n```\nsage: i*CC(0).gamma_inc(-i/100000)-i*CC(0).gamma_inc(i/100000)\n-3.14157265358979\n```\n\nSo same problem there.  Yuck.  We really need Maxima to provide a proper `Si` function, or somehow magically translate such combos ourselves with pattern-matching, which sounds horrible too.",
    "created_at": "2014-11-17T17:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119702",
    "user": "kcrisman"
}
```

> > > What if we don't allow incomplete gamma to become `Ei` when the first arg is zero - would that solve the branch problem?
> > Looks like if that was once possible, it isn't any more (already done during integration in Maxima, I mean).
> Or maybe not; 
Drivel.  We could try this, though the branch problem is likely still there with incomplete gamma.

```
sage: maxima_calculus('integrate(sin(x)/x,x)')
-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2
sage: maxima_calculus('integrate(sin(x)/x,x)').sage()
-1/2*I*Ei(I*x) + 1/2*I*Ei(-I*x)
```

because we do

```
        if x == 0:
            return -Ei(-y)
```

in sage/functions/other.py

But unfortunately

```
sage: i*CC(0).gamma_inc(-i/100000)-i*CC(0).gamma_inc(i/100000)
-3.14157265358979
```

So same problem there.  Yuck.  We really need Maxima to provide a proper `Si` function, or somehow magically translate such combos ourselves with pattern-matching, which sounds horrible too.



---

archive/issue_comments_119703.json:
```json
{
    "body": "Replying to [comment:17 jakobkroeker]:\n> We really need Maxima to provide a proper `Si` function\nMaxima has provided a proper Si function for a while called `expintegral_si(x)` which seems to fit the bill. Maxima doesn't seem to use it though, and the behavior you described still occurs:\n\n`sage: maxima_calculus('integrate(sin(x)/x,x)')`\n`-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2`\n\nEdit: upstream said this would be fixed [here](https://sourceforge.net/p/maxima/bugs/3079/#94bd) in 2016.",
    "created_at": "2019-07-20T16:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119703",
    "user": "@JohnScott623"
}
```

Replying to [comment:17 jakobkroeker]:
> We really need Maxima to provide a proper `Si` function
Maxima has provided a proper Si function for a while called `expintegral_si(x)` which seems to fit the bill. Maxima doesn't seem to use it though, and the behavior you described still occurs:

`sage: maxima_calculus('integrate(sin(x)/x,x)')`
`-(%i*gamma_incomplete(0,%i*x)-%i*gamma_incomplete(0,-%i*x))/2`

Edit: upstream said this would be fixed [here](https://sourceforge.net/p/maxima/bugs/3079/#94bd) in 2016.



---

archive/issue_comments_119704.json:
```json
{
    "body": "Changing keywords from \"\" to \"maxima\".",
    "created_at": "2019-07-21T06:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119704",
    "user": "@mwageringel"
}
```

Changing keywords from "" to "maxima".



---

archive/issue_comments_119705.json:
```json
{
    "body": "Remove assignee burcin.",
    "created_at": "2019-08-01T13:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119705",
    "user": "@JohnScott623"
}
```

Remove assignee burcin.



---

archive/issue_comments_119706.json:
```json
{
    "body": "Changing keywords from \"maxima\" to \"maxima, integration\".",
    "created_at": "2019-08-24T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119706",
    "user": "chapoton"
}
```

Changing keywords from "maxima" to "maxima, integration".



---

archive/issue_comments_119707.json:
```json
{
    "body": "Similar bug (regression after upgrade to Maxima 5.44.0): #30389",
    "created_at": "2020-08-20T06:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11011#issuecomment-119707",
    "user": "pbruin"
}
```

Similar bug (regression after upgrade to Maxima 5.44.0): #30389
