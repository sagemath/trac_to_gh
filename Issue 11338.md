# Issue 11338: do not sdist the SAGE_ROOT hg repository

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-06-16 19:04:05

CC:  jhpalmieri vbraun leif

When sdist-ing Sage, there is absolutely no reason to distribute the SAGE_ROOT hg repository.  The hg repository should still be in the SAGE_ROOT spkg, so after Sage is built, there will be an hg repository present.  But before the Sage build, the hg repository serves no purpose.

See also #9433 and #11073.


---

Comment by jdemeyer created at 2011-06-16 20:01:58

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-06-17 12:11:02

Apply to SCRIPTS repository local/bin


---

Attachment


---

Comment by jdemeyer created at 2011-06-20 19:18:15

For testing purposes, this patch has been included in a trial [sage-4.7.1.alpha4](http://boxen.math.washington.edu/home/release/sage-4.7.1.alpha4/).  The following were tested successfully:
 1. Building a source tarball using the patched `sage-sdist`
 2. Building Sage completely from source using that tarball
 3. Upgrading from sage-4.6 (which does not include #9433)
 4. Upgrading from sage-4.7 (which does include #9433)
 5. `make ptestlong` in all these builds


---

Comment by jhpalmieri created at 2011-06-29 21:37:56

Two comments:

 - is there a problem with distributing the root repo?  It takes up a little disk space, but it's pretty innocuous, isn't it?

 - I can think of one situation where it might be useful to distribute the repo: someone has downloaded Sage and wants to immediately apply a patch to "Makefile", "spkg/standard/deps", etc.  Without the root repo, this is inconvenient.


---

Comment by jdemeyer created at 2011-07-01 20:49:34

Replying to [comment:5 jhpalmieri]:
> Two comments:
> 
>  - is there a problem with distributing the root repo?  It takes up a little disk space, but it's pretty innocuous, isn't it?
Lots of small files on the mirrors, not sure whether this is a desirable situation.  I can imagine that mirrors are optimized for just a few very large files.

>  - I can think of one situation where it might be useful to distribute the repo: someone has downloaded Sage and wants to immediately apply a patch to "Makefile", "spkg/standard/deps", etc.  Without the root repo, this is inconvenient.  
Well, one can always do a standard `patch -p1` but I agree that you have a point.


---

Comment by vbraun created at 2011-07-01 20:58:20

The way I understood it, the root repo would be directly part of the Sage tarball and not wrapped into an extra spkg. Updating Sage could be done with a mercurial bundle. 

That way, a first install as well as updates could always assume that the root repo is of the newest version.

I noticed before that first building Sage, then applying patches, and then rebuilding Sage is somewhat annoying. +1 from me :-)


---

Comment by jhpalmieri created at 2011-07-03 15:27:55

Jeroen: fortunately, the root repo doesn't track very many files, so its presence doesn't add a lot of files, maybe 40-50, but not hundreds.

Volker: yes, updating is the issue. I would be happy if the root repo weren't part of an spkg, but then we would need to revise the way it's handled in updates.  To use bundles, would "sage -sdist" store a bundle file with the other spkgs, and then "sage -upgrade" would download it and apply it?


---

Comment by jdemeyer created at 2011-11-06 00:09:59

Should this be closed as "wontfix"?


---

Comment by leif created at 2011-11-06 01:11:11

Replying to [comment:11 jdemeyer]:
> Should this be closed as "wontfix"?

Don't know.  Have you changed your mind?

There are advantages and disadvantages of having it there "from the beginning", although I tend to prefer having it.

Whether we need a separate sage_root _spkg_, also updated on every release, is IMHO orthogonal.


---

Comment by jdemeyer created at 2011-11-06 09:55:39

Replying to [comment:12 leif]:
> Replying to [comment:11 jdemeyer]:
> > Should this be closed as "wontfix"?
> 
> Don't know.  Have you changed your mind?
It seems I have the minority opinion here and also it is not such an important ticket.


---

Comment by jdemeyer created at 2012-08-13 12:22:25

Resolution: wontfix
