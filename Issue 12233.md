# Issue 12233: Add $SAGE_LOCAL/lib64 to LD_LIBRARY_PATH

archive/issues_012233.json:
```json
{
    "body": "Assignee: leif\n\nThis is needed for #12369 (and would probably have provided an easier fix for #12131).\n\nIssue created by migration from https://trac.sagemath.org/ticket/12405\n\n",
    "created_at": "2012-01-31T22:39:16Z",
    "labels": [
        "scripts",
        "major",
        "enhancement"
    ],
    "title": "Add $SAGE_LOCAL/lib64 to LD_LIBRARY_PATH",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12233",
    "user": "jdemeyer"
}
```
Assignee: leif

This is needed for #12369 (and would probably have provided an easier fix for #12131).

Issue created by migration from https://trac.sagemath.org/ticket/12405





---

archive/issue_comments_142931.json:
```json
{
    "body": "`lib64` is widely used but no standard. `lib32` isn't standard at all, as far as I know only debian variants use it. And they are moving towards multiarch, which will rename these to `lib/i386-linux-gnu` etc., see  http://wiki.debian.org/Multiarch. So unless you want to add all possible triplets to the `LD_LIBRARY_PATH` I suggest we rather the gcc package to respect standard configure options.\n\n-1 from me for this proposal.",
    "created_at": "2012-01-31T23:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142931",
    "user": "vbraun"
}
```

`lib64` is widely used but no standard. `lib32` isn't standard at all, as far as I know only debian variants use it. And they are moving towards multiarch, which will rename these to `lib/i386-linux-gnu` etc., see  http://wiki.debian.org/Multiarch. So unless you want to add all possible triplets to the `LD_LIBRARY_PATH` I suggest we rather the gcc package to respect standard configure options.

-1 from me for this proposal.



---

archive/issue_comments_142932.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n**If** we decide to ship a gcc package **and** this patch works **and** nobody comes up with a better solution, I guess we have no choice, right?",
    "created_at": "2012-01-31T23:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142932",
    "user": "jdemeyer"
}
```

Replying to [comment:3 vbraun]:
**If** we decide to ship a gcc package **and** this patch works **and** nobody comes up with a better solution, I guess we have no choice, right?



---

archive/issue_comments_142933.json:
```json
{
    "body": "If you prefer: we could only add *existing* directories (or some unknown-to-me way of detecting the multilib directories)",
    "created_at": "2012-01-31T23:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142933",
    "user": "jdemeyer"
}
```

If you prefer: we could only add *existing* directories (or some unknown-to-me way of detecting the multilib directories)



---

archive/issue_comments_142934.json:
```json
{
    "body": "I'll try fixing the gcc package first, this is really the sane way to do. At the very least we need to disable multilib building because not everybody has a multilib toolchain (Fedora doesn't, for example).",
    "created_at": "2012-01-31T23:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142934",
    "user": "vbraun"
}
```

I'll try fixing the gcc package first, this is really the sane way to do. At the very least we need to disable multilib building because not everybody has a multilib toolchain (Fedora doesn't, for example).



---

archive/issue_comments_142935.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> I'll try fixing the gcc package first, this is really the sane way to do. At the very least we need to disable multilib building because not everybody has a multilib toolchain (Fedora doesn't, for example).\n\nVolker, in your GCC spkg, you copy files from `lib64` to `lib`.  This suffers from all the problems you mentioned here.  It has the additional problem that you need to decide *which* files you copy.\n\nSo I still think changing `LD_LIBRARY_PATH` is the best solution.  But I'm certainly open to suggestions...",
    "created_at": "2012-02-10T12:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142935",
    "user": "jdemeyer"
}
```

Replying to [comment:6 vbraun]:
> I'll try fixing the gcc package first, this is really the sane way to do. At the very least we need to disable multilib building because not everybody has a multilib toolchain (Fedora doesn't, for example).

Volker, in your GCC spkg, you copy files from `lib64` to `lib`.  This suffers from all the problems you mentioned here.  It has the additional problem that you need to decide *which* files you copy.

So I still think changing `LD_LIBRARY_PATH` is the best solution.  But I'm certainly open to suggestions...



---

archive/issue_comments_142936.json:
```json
{
    "body": "I don't understand any of the subtleties here, but would it make sense to test whether the directory `$SAGE_ROOT/local/lib64` exists, and if so, put it first (before `local/lib`) in `$LD_LIBRARY_PATH`? If some spkg (like gcc) is the first one to install files in lib64, does `$LD_LIBRARY_PATH` need to include lib64 while that spkg is being installed, or will it only matter for later spkgs?  If only for later ones, well, sage-spkg should run sage-env for each installation, so `$LD_LIBRARY_PATH` should get set for all subsequent packages.",
    "created_at": "2012-03-02T18:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142936",
    "user": "jhpalmieri"
}
```

I don't understand any of the subtleties here, but would it make sense to test whether the directory `$SAGE_ROOT/local/lib64` exists, and if so, put it first (before `local/lib`) in `$LD_LIBRARY_PATH`? If some spkg (like gcc) is the first one to install files in lib64, does `$LD_LIBRARY_PATH` need to include lib64 while that spkg is being installed, or will it only matter for later spkgs?  If only for later ones, well, sage-spkg should run sage-env for each installation, so `$LD_LIBRARY_PATH` should get set for all subsequent packages.



---

archive/issue_comments_142937.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\n> I don't understand any of the subtleties here, but would it make sense to test whether the directory `$SAGE_ROOT/local/lib64` exists, and if so, put it first (before `local/lib`) in `$LD_LIBRARY_PATH`?\nYes, that would make a lot of sense.\n\n> If some spkg (like gcc) is the first one to install files in lib64, does `$LD_LIBRARY_PATH` need to include lib64 while that spkg is being installed\nNo.\n\n> or will it only matter for later spkgs?\nExactly, there might be some subtleties with parallel builds though.  But GCC (the package this is about) normally isn't built in parallel with anything else, so it doesn't really matter.",
    "created_at": "2012-03-02T21:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142937",
    "user": "jdemeyer"
}
```

Replying to [comment:8 jhpalmieri]:
> I don't understand any of the subtleties here, but would it make sense to test whether the directory `$SAGE_ROOT/local/lib64` exists, and if so, put it first (before `local/lib`) in `$LD_LIBRARY_PATH`?
Yes, that would make a lot of sense.

> If some spkg (like gcc) is the first one to install files in lib64, does `$LD_LIBRARY_PATH` need to include lib64 while that spkg is being installed
No.

> or will it only matter for later spkgs?
Exactly, there might be some subtleties with parallel builds though.  But GCC (the package this is about) normally isn't built in parallel with anything else, so it doesn't really matter.



---

archive/issue_comments_142938.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> Exactly, there might be some subtleties with parallel builds though. \n\nEven with parallel builds, if `deps` is correct, then if two packages are built at the same time, they shouldn't install things in `local/lib64` that the other one needs. There could be a race condition in creating `local/lib64`, I suppose, but that should be avoidable.",
    "created_at": "2012-03-02T22:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142938",
    "user": "jhpalmieri"
}
```

Replying to [comment:9 jdemeyer]:
> Exactly, there might be some subtleties with parallel builds though. 

Even with parallel builds, if `deps` is correct, then if two packages are built at the same time, they shouldn't install things in `local/lib64` that the other one needs. There could be a race condition in creating `local/lib64`, I suppose, but that should be avoidable.



---

archive/issue_comments_142939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-05T09:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142939",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142940.json:
```json
{
    "body": "I changed the patch to add only existing directories.",
    "created_at": "2012-03-05T09:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142940",
    "user": "jdemeyer"
}
```

I changed the patch to add only existing directories.



---

archive/issue_comments_142941.json:
```json
{
    "body": "Attachment [12405_lib64.patch](tarball://root/attachments/some-uuid/ticket12405/12405_lib64.patch) by jdemeyer created at 2012-03-05 09:06:00",
    "created_at": "2012-03-05T09:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142941",
    "user": "jdemeyer"
}
```

Attachment [12405_lib64.patch](tarball://root/attachments/some-uuid/ticket12405/12405_lib64.patch) by jdemeyer created at 2012-03-05 09:06:00



---

archive/issue_comments_142942.json:
```json
{
    "body": "This looks okay to me, but I don't think I'm qualified to review it. vbraun, what do you think?",
    "created_at": "2012-03-05T21:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142942",
    "user": "jhpalmieri"
}
```

This looks okay to me, but I don't think I'm qualified to review it. vbraun, what do you think?



---

archive/issue_comments_142943.json:
```json
{
    "body": "I don't think adding more stuff to `LD_LIBRARY_PATH` is the way to go. On the contrary, we have to get rid of it or we'll always have library conflicts on some systems. Also, this ticket is really just our ignorance about how to make gcc install its libraries in a specified directory. It must be possible since distros can do it. \n\nHaving said that, I don't mind if we use this as a bandaid until we figure out how to configure gcc correctly and/or Apple manages to ship a working compiler.",
    "created_at": "2012-03-05T21:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142943",
    "user": "vbraun"
}
```

I don't think adding more stuff to `LD_LIBRARY_PATH` is the way to go. On the contrary, we have to get rid of it or we'll always have library conflicts on some systems. Also, this ticket is really just our ignorance about how to make gcc install its libraries in a specified directory. It must be possible since distros can do it. 

Having said that, I don't mind if we use this as a bandaid until we figure out how to configure gcc correctly and/or Apple manages to ship a working compiler.



---

archive/issue_comments_142944.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> Having said that, I don't mind if we use this as a bandaid until we figure out how to configure gcc correctly.\nGood.  As I mentioned above, I am certainly open to suggestions but this is the best \"solution\" I could think of.",
    "created_at": "2012-03-05T21:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142944",
    "user": "jdemeyer"
}
```

Replying to [comment:13 vbraun]:
> Having said that, I don't mind if we use this as a bandaid until we figure out how to configure gcc correctly.
Good.  As I mentioned above, I am certainly open to suggestions but this is the best "solution" I could think of.



---

archive/issue_comments_142945.json:
```json
{
    "body": "So can we give it a positive review? I've been using it successfully (via #12369) for a while now, with no problems.",
    "created_at": "2012-03-05T21:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142945",
    "user": "jhpalmieri"
}
```

So can we give it a positive review? I've been using it successfully (via #12369) for a while now, with no problems.



---

archive/issue_comments_142946.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-05T22:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142946",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142947.json:
```json
{
    "body": "Lets do it.",
    "created_at": "2012-03-05T22:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142947",
    "user": "vbraun"
}
```

Lets do it.



---

archive/issue_comments_142948.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-13T08:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12233",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12233#issuecomment-142948",
    "user": "jdemeyer"
}
```

Resolution: fixed
