# Issue 24736: Univariate polynomial roots bug

archive/issues_024736.json:
```json
{
    "body": "And even\n\n```\nsage: x1 = polygen(ZZ, 'x')\nsage: x2 = polygen(ZZ['x'], 'x')\nsage: (x1 - x2)\nsage: (x1 - x2).roots()\nValueError                                Traceback (most recent call last)\n<ipython-input-4-b682a0535b1b> in <module>()\n      2 x2 = polygen(ZZ['x'], 'x')\n      3 (x1 - x2)\n----> 4 (x1 - x2).roots()\n\n/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:64397)()\n   7459         if hasattr(K, '_roots_univariate_polynomial'):\n   7460             try:\n-> 7461                 return K._roots_univariate_polynomial(self, ring=ring, multiplicities=multiplicities, algorithm=algorithm, **kwds)\n   7462             except NotImplementedError:\n   7463                 # This does not handle something, so keep calm and continue on\n\n/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _roots_univariate_polynomial(self, p, ring, multiplicities, algorithm, degree_bound)\n   1660             p = p.change_ring(ring)\n   1661             return p.roots(multiplicities, algorithm, degree_bound)\n-> 1662         roots = p._roots_from_factorization(p.factor(), multiplicities)\n   1663         if degree_bound is not None:\n   1664             if multiplicities:\n\n/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.factor (build/cythonized/sage/rings/polynomial/polynomial_element.c:36957)()\n   4133         if len(variables) > 1:\n   4134             base = self._parent._mpoly_base_ring()\n-> 4135             ring = PolynomialRing(base, variables)\n   4136             if ring._has_singular:\n   4137                 try:\n\n/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)\n    631             raise TypeError(\"you must specify the names of the variables\")\n    632 \n--> 633     names = normalize_names(n, names)\n    634 \n    635     # At this point, we have only handled the \"names\" keyword if it was\n\n/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9512)()\n    943 \n    944 \n--> 945 cpdef normalize_names(Py_ssize_t ngens, names):\n    946     r\"\"\"\n    947     Return a tuple of strings of variable names of length ngens given\n\n/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9361)()\n   1057                 names = sage.misc.defaults.variable_names(ngens, names)\n   1058 \n-> 1059     certify_names(names)\n   1060     if ngens >= 0 and len(names) != ngens:\n   1061        raise IndexError(\"the number of names must equal the number of generators\")\n\n/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.certify_names (build/cythonized/sage/structure/category_object.c:10028)()\n   1111             raise ValueError(\"variable name {!r} does not start with a letter\".format(N))\n   1112         if N in s:\n-> 1113             raise ValueError(\"variable name {!r} appears more than once\".format(N))\n   1114         s.add(N)\n   1115     return True\n\nValueError: variable name 'x' appears more than once\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24973\n\n",
    "created_at": "2018-03-14T11:18:21Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Univariate polynomial roots bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24736",
    "user": "@videlec"
}
```
And even

```
sage: x1 = polygen(ZZ, 'x')
sage: x2 = polygen(ZZ['x'], 'x')
sage: (x1 - x2)
sage: (x1 - x2).roots()
ValueError                                Traceback (most recent call last)
<ipython-input-4-b682a0535b1b> in <module>()
      2 x2 = polygen(ZZ['x'], 'x')
      3 (x1 - x2)
----> 4 (x1 - x2).roots()

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:64397)()
   7459         if hasattr(K, '_roots_univariate_polynomial'):
   7460             try:
-> 7461                 return K._roots_univariate_polynomial(self, ring=ring, multiplicities=multiplicities, algorithm=algorithm, **kwds)
   7462             except NotImplementedError:
   7463                 # This does not handle something, so keep calm and continue on

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _roots_univariate_polynomial(self, p, ring, multiplicities, algorithm, degree_bound)
   1660             p = p.change_ring(ring)
   1661             return p.roots(multiplicities, algorithm, degree_bound)
-> 1662         roots = p._roots_from_factorization(p.factor(), multiplicities)
   1663         if degree_bound is not None:
   1664             if multiplicities:

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.factor (build/cythonized/sage/rings/polynomial/polynomial_element.c:36957)()
   4133         if len(variables) > 1:
   4134             base = self._parent._mpoly_base_ring()
-> 4135             ring = PolynomialRing(base, variables)
   4136             if ring._has_singular:
   4137                 try:

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)
    631             raise TypeError("you must specify the names of the variables")
    632 
--> 633     names = normalize_names(n, names)
    634 
    635     # At this point, we have only handled the "names" keyword if it was

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9512)()
    943 
    944 
--> 945 cpdef normalize_names(Py_ssize_t ngens, names):
    946     r"""
    947     Return a tuple of strings of variable names of length ngens given

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9361)()
   1057                 names = sage.misc.defaults.variable_names(ngens, names)
   1058 
-> 1059     certify_names(names)
   1060     if ngens >= 0 and len(names) != ngens:
   1061        raise IndexError("the number of names must equal the number of generators")

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.certify_names (build/cythonized/sage/structure/category_object.c:10028)()
   1111             raise ValueError("variable name {!r} does not start with a letter".format(N))
   1112         if N in s:
-> 1113             raise ValueError("variable name {!r} appears more than once".format(N))
   1114         s.add(N)
   1115     return True

ValueError: variable name 'x' appears more than once
```


Issue created by migration from https://trac.sagemath.org/ticket/24973





---

archive/issue_comments_347245.json:
```json
{
    "body": "What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.",
    "created_at": "2018-04-05T09:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347245",
    "user": "@bgrenet"
}
```

What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.



---

archive/issue_comments_347246.json:
```json
{
    "body": "Not sure. What about the similar\n- `GF(4, 'a')['a']`\n- `QuadraticField(3, 'b')['b']`\n- and the completely broken `SR['x']` (the symbol x is an element of SR)\n\nYou want to recursively look at the list of generator names in base rings when constructing a polynomial ring? You can not exclude base rings with infinitely many generators (like SR).",
    "created_at": "2018-04-07T10:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347246",
    "user": "@videlec"
}
```

Not sure. What about the similar
- `GF(4, 'a')['a']`
- `QuadraticField(3, 'b')['b']`
- and the completely broken `SR['x']` (the symbol x is an element of SR)

You want to recursively look at the list of generator names in base rings when constructing a polynomial ring? You can not exclude base rings with infinitely many generators (like SR).



---

archive/issue_comments_347247.json:
```json
{
    "body": "Replying to [comment:1 bruno]:\n> What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.\n\nI don't think so. It should be possible to use an arbitrary variable name (say `'x'`) in a function that takes a ring `R` and creates `R['x']`, and everything that doesn't require ambiguous coercions should work... The alternative I see is to introduce a `Symbol` class to represent symbolic variables, with facilities to obtain fresh symbols, and to create distinct symbols with the same name.",
    "created_at": "2018-04-07T10:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347247",
    "user": "@mezzarobba"
}
```

Replying to [comment:1 bruno]:
> What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.

I don't think so. It should be possible to use an arbitrary variable name (say `'x'`) in a function that takes a ring `R` and creates `R['x']`, and everything that doesn't require ambiguous coercions should work... The alternative I see is to introduce a `Symbol` class to represent symbolic variables, with facilities to obtain fresh symbols, and to create distinct symbols with the same name.



---

archive/issue_comments_347248.json:
```json
{
    "body": "I propose a fix in the same vein as what Marc did in #25233 for gcd.",
    "created_at": "2018-06-18T15:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347248",
    "user": "@bgrenet"
}
```

I propose a fix in the same vein as what Marc did in #25233 for gcd.



---

archive/issue_comments_347249.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-18T15:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347249",
    "user": "@bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347250.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-03T08:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347250",
    "user": "@mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347251.json:
```json
{
    "body": "Thanks Marc!",
    "created_at": "2018-07-04T15:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347251",
    "user": "@bgrenet"
}
```

Thanks Marc!



---

archive/issue_comments_347252.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-07T01:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24736#issuecomment-347252",
    "user": "@vbraun"
}
```

Resolution: fixed
