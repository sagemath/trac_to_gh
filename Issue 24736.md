# Issue 24736: Univariate polynomial roots bug

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2018-03-14 11:18:21

And even

```
sage: x1 = polygen(ZZ, 'x')
sage: x2 = polygen(ZZ['x'], 'x')
sage: (x1 - x2)
sage: (x1 - x2).roots()
ValueError                                Traceback (most recent call last)
<ipython-input-4-b682a0535b1b> in <module>()
      2 x2 = polygen(ZZ['x'], 'x')
      3 (x1 - x2)
----> 4 (x1 - x2).roots()

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:64397)()
   7459         if hasattr(K, '_roots_univariate_polynomial'):
   7460             try:
-> 7461                 return K._roots_univariate_polynomial(self, ring=ring, multiplicities=multiplicities, algorithm=algorithm, **kwds)
   7462             except NotImplementedError:
   7463                 # This does not handle something, so keep calm and continue on

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _roots_univariate_polynomial(self, p, ring, multiplicities, algorithm, degree_bound)
   1660             p = p.change_ring(ring)
   1661             return p.roots(multiplicities, algorithm, degree_bound)
-> 1662         roots = p._roots_from_factorization(p.factor(), multiplicities)
   1663         if degree_bound is not None:
   1664             if multiplicities:

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.factor (build/cythonized/sage/rings/polynomial/polynomial_element.c:36957)()
   4133         if len(variables) > 1:
   4134             base = self._parent._mpoly_base_ring()
-> 4135             ring = PolynomialRing(base, variables)
   4136             if ring._has_singular:
   4137                 try:

/opt/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring_constructor.pyc in PolynomialRing(base_ring, *args, **kwds)
    631             raise TypeError("you must specify the names of the variables")
    632 
--> 633     names = normalize_names(n, names)
    634 
    635     # At this point, we have only handled the "names" keyword if it was

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9512)()
    943 
    944 
--> 945 cpdef normalize_names(Py_ssize_t ngens, names):
    946     r"""
    947     Return a tuple of strings of variable names of length ngens given

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:9361)()
   1057                 names = sage.misc.defaults.variable_names(ngens, names)
   1058 
-> 1059     certify_names(names)
   1060     if ngens >= 0 and len(names) != ngens:
   1061        raise IndexError("the number of names must equal the number of generators")

/opt/sage/local/lib/python2.7/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.certify_names (build/cythonized/sage/structure/category_object.c:10028)()
   1111             raise ValueError("variable name {!r} does not start with a letter".format(N))
   1112         if N in s:
-> 1113             raise ValueError("variable name {!r} appears more than once".format(N))
   1114         s.add(N)
   1115     return True

ValueError: variable name 'x' appears more than once
```



---

Comment by bruno created at 2018-04-05 09:12:27

What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.


---

Comment by vdelecroix created at 2018-04-07 10:09:35

Not sure. What about the similar
- `GF(4, 'a')['a']`
- `QuadraticField(3, 'b')['b']`
- and the completely broken `SR['x']` (the symbol x is an element of SR)

You want to recursively look at the list of generator names in base rings when constructing a polynomial ring? You can not exclude base rings with infinitely many generators (like SR).


---

Comment by mmezzarobba created at 2018-04-07 10:47:59

Replying to [comment:1 bruno]:
> What do you think should be the correct answer? My view is that the creation of the second polynomial ring should raise an exception already.

I don't think so. It should be possible to use an arbitrary variable name (say `'x'`) in a function that takes a ring `R` and creates `R['x']`, and everything that doesn't require ambiguous coercions should work... The alternative I see is to introduce a `Symbol` class to represent symbolic variables, with facilities to obtain fresh symbols, and to create distinct symbols with the same name.


---

Comment by bruno created at 2018-06-18 15:23:13

I propose a fix in the same vein as what Marc did in #25233 for gcd.


---

Comment by bruno created at 2018-06-18 15:23:13

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2018-07-03 08:14:42

Changing status from needs_review to positive_review.


---

Comment by bruno created at 2018-07-04 15:06:10

Thanks Marc!


---

Comment by vbraun created at 2018-07-07 01:34:30

Resolution: fixed
