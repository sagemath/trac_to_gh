# Issue 15478: Teach the graph backend that 'yield' exists in Cython

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2014-01-23 11:05:26

CC:  azi

The graph backends are currently building lists, only to return an iterator on that list. But Cython supports 'yield' now, so that can be simplified.

Nathann


---

Comment by ncohen created at 2014-01-23 11:06:14

Changing status from new to needs_review.


---

Comment by git created at 2014-01-23 11:06:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by robertwb created at 2014-01-25 22:16:28

You're missing a yield on line 1777 of c_graph.pyx. (Line comments would be really nice...)


---

Comment by robertwb created at 2014-01-25 22:16:28

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-01-29 08:46:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-01-29 08:46:17

Sorryyyyyyyy ! It is now fixed.

Nathann


---

Comment by ncohen created at 2014-01-29 08:46:17

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2014-02-04 20:16:46

I've made some tweaks to squeeze some extra speed out. Here are my timings:

```
sage: G = sage.graphs.base.sparse_graph.SparseGraphBackend(9)
sage: G.multiple_edges(True)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: %timeit list(G.iterator_edges(range(9), False))
100000 loops, best of 3: 15.5 us per loop
sage: %timeit list(G.iterator_edges(range(9), True))
100000 loops, best of 3: 16 us per loop
sage: %timeit list(G.iterator_in_edges([1], False))
100000 loops, best of 3: 4.8 us per loop
sage: %timeit list(G.iterator_in_edges([1], True))
100000 loops, best of 3: 5 us per loop
sage: %timeit list(G.iterator_out_edges([1], False))
100000 loops, best of 3: 5.67 us per loop
sage: %timeit list(G.iterator_out_edges([1], True))
100000 loops, best of 3: 6.17 us per loop
```

Before my changes:

```
sage: %timeit list(G.iterator_edges(range(9), False))
10000 loops, best of 3: 20.3 us per loop
sage: %timeit list(G.iterator_edges(range(9), True))
10000 loops, best of 3: 21.6 us per loop
sage: %timeit list(G.iterator_in_edges([1], False))
100000 loops, best of 3: 4.86 us per loop
sage: %timeit list(G.iterator_in_edges([1], True))
100000 loops, best of 3: 4.85 us per loop
sage: %timeit list(G.iterator_out_edges([1], False))
100000 loops, best of 3: 7.08 us per loop
sage: %timeit list(G.iterator_out_edges([1], True))
100000 loops, best of 3: 7.51 us per loop
```

This will likely be more pronounced as there are more and more multiple edges. If you're happy with my changes, then it's positive review.
----
New commits:


---

Comment by ncohen created at 2014-02-05 10:58:37

Well, seems free for healthy graphs and better for the others, so yes good idea `:-D`

THaaaaaaaaaaanks !

Nathann


---

Comment by ncohen created at 2014-02-05 10:58:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-07 00:49:58

Resolution: fixed
