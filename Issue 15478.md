# Issue 15478: Teach the graph backend that 'yield' exists in Cython

archive/issues_015478.json:
```json
{
    "body": "CC:  azi\n\nThe graph backends are currently building lists, only to return an iterator on that list. But Cython supports 'yield' now, so that can be simplified.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/15715\n\n",
    "created_at": "2014-01-23T11:05:26Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Teach the graph backend that 'yield' exists in Cython",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15478",
    "user": "https://github.com/nathanncohen"
}
```
CC:  azi

The graph backends are currently building lists, only to return an iterator on that list. But Cython supports 'yield' now, so that can be simplified.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/15715





---

archive/issue_comments_199721.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-23T11:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199721",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-23T11:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199723.json:
```json
{
    "body": "You're missing a yield on line 1777 of c_graph.pyx. (Line comments would be really nice...)",
    "created_at": "2014-01-25T22:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199723",
    "user": "https://github.com/robertwb"
}
```

You're missing a yield on line 1777 of c_graph.pyx. (Line comments would be really nice...)



---

archive/issue_comments_199724.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-25T22:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199724",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199725.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-29T08:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199725",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199726.json:
```json
{
    "body": "Sorryyyyyyyy ! It is now fixed.\n\nNathann",
    "created_at": "2014-01-29T08:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199726",
    "user": "https://github.com/nathanncohen"
}
```

Sorryyyyyyyy ! It is now fixed.

Nathann



---

archive/issue_comments_199727.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-29T08:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199727",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_046143.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15478#event-46143"
}
```



---

archive/issue_comments_199728.json:
```json
{
    "body": "I've made some tweaks to squeeze some extra speed out. Here are my timings:\n\n```\nsage: G = sage.graphs.base.sparse_graph.SparseGraphBackend(9)\nsage: G.multiple_edges(True)\nsage: G.add_edge(1,2,3,False)\nsage: G.add_edge(1,2,3,False)\nsage: G.add_edge(1,2,3,False)\nsage: G.add_edge(1,2,3,False)\nsage: G.add_edge(1,2,3,False)\nsage: %timeit list(G.iterator_edges(range(9), False))\n100000 loops, best of 3: 15.5 us per loop\nsage: %timeit list(G.iterator_edges(range(9), True))\n100000 loops, best of 3: 16 us per loop\nsage: %timeit list(G.iterator_in_edges([1], False))\n100000 loops, best of 3: 4.8 us per loop\nsage: %timeit list(G.iterator_in_edges([1], True))\n100000 loops, best of 3: 5 us per loop\nsage: %timeit list(G.iterator_out_edges([1], False))\n100000 loops, best of 3: 5.67 us per loop\nsage: %timeit list(G.iterator_out_edges([1], True))\n100000 loops, best of 3: 6.17 us per loop\n```\nBefore my changes:\n\n```\nsage: %timeit list(G.iterator_edges(range(9), False))\n10000 loops, best of 3: 20.3 us per loop\nsage: %timeit list(G.iterator_edges(range(9), True))\n10000 loops, best of 3: 21.6 us per loop\nsage: %timeit list(G.iterator_in_edges([1], False))\n100000 loops, best of 3: 4.86 us per loop\nsage: %timeit list(G.iterator_in_edges([1], True))\n100000 loops, best of 3: 4.85 us per loop\nsage: %timeit list(G.iterator_out_edges([1], False))\n100000 loops, best of 3: 7.08 us per loop\nsage: %timeit list(G.iterator_out_edges([1], True))\n100000 loops, best of 3: 7.51 us per loop\n```\nThis will likely be more pronounced as there are more and more multiple edges. If you're happy with my changes, then it's positive review.\n\n---\nNew commits:",
    "created_at": "2014-02-04T20:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199728",
    "user": "https://github.com/tscrim"
}
```

I've made some tweaks to squeeze some extra speed out. Here are my timings:

```
sage: G = sage.graphs.base.sparse_graph.SparseGraphBackend(9)
sage: G.multiple_edges(True)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: G.add_edge(1,2,3,False)
sage: %timeit list(G.iterator_edges(range(9), False))
100000 loops, best of 3: 15.5 us per loop
sage: %timeit list(G.iterator_edges(range(9), True))
100000 loops, best of 3: 16 us per loop
sage: %timeit list(G.iterator_in_edges([1], False))
100000 loops, best of 3: 4.8 us per loop
sage: %timeit list(G.iterator_in_edges([1], True))
100000 loops, best of 3: 5 us per loop
sage: %timeit list(G.iterator_out_edges([1], False))
100000 loops, best of 3: 5.67 us per loop
sage: %timeit list(G.iterator_out_edges([1], True))
100000 loops, best of 3: 6.17 us per loop
```
Before my changes:

```
sage: %timeit list(G.iterator_edges(range(9), False))
10000 loops, best of 3: 20.3 us per loop
sage: %timeit list(G.iterator_edges(range(9), True))
10000 loops, best of 3: 21.6 us per loop
sage: %timeit list(G.iterator_in_edges([1], False))
100000 loops, best of 3: 4.86 us per loop
sage: %timeit list(G.iterator_in_edges([1], True))
100000 loops, best of 3: 4.85 us per loop
sage: %timeit list(G.iterator_out_edges([1], False))
100000 loops, best of 3: 7.08 us per loop
sage: %timeit list(G.iterator_out_edges([1], True))
100000 loops, best of 3: 7.51 us per loop
```
This will likely be more pronounced as there are more and more multiple edges. If you're happy with my changes, then it's positive review.

---
New commits:



---

archive/issue_comments_199729.json:
```json
{
    "body": "Well, seems free for healthy graphs and better for the others, so yes good idea `:-D`\n\nTHaaaaaaaaaaanks !\n\nNathann",
    "created_at": "2014-02-05T10:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199729",
    "user": "https://github.com/nathanncohen"
}
```

Well, seems free for healthy graphs and better for the others, so yes good idea `:-D`

THaaaaaaaaaaanks !

Nathann



---

archive/issue_comments_199730.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-05T10:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199730",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199731.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-07T00:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15478#issuecomment-199731",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_046144.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-07T00:49:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15478",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15478#event-46144"
}
```
