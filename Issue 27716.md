# Issue 27716: Add integral curves over finite fields

Issue created by migration from https://trac.sagemath.org/ticket/27953

Original creator: klee

Original creation time: 2019-06-08 22:36:11

This is a subticket for #27873.

Integral curves over finite fields with function fields attached and with minimal functionality is added.

The constructor of curves is refactored to support integral curves.

Curves over **prime** finite fields are removed.


---

Comment by git created at 2019-06-08 22:46:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-06-09 03:24:18

Changing status from new to needs_review.


---

Comment by klee created at 2019-06-09 03:25:13

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-06-09 04:52:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-06-09 07:17:56

Changing status from needs_work to needs_review.


---

Comment by klee created at 2019-06-09 07:18:54

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-06-10 06:57:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by klee created at 2019-07-09 21:24:41

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-09-16 07:19:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-16 07:21:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-12-02 08:55:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2019-12-12 04:49:11

I have a few comments.

This can be simplified:

```diff
-            points = []
-            for x in K:
-                for y in K:
-                    if f(x,y) == 0:
-                        points.append(self((x,y)))
-            points.sort()
-            return points
+            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))
```

which should be faster too.

In `_nonsingular_model`, the `TESTS::` block needs to be indented.

The line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.


```diff
-s = set([p for f in self._coordinate_functions if f for p in f.poles()])
+s = set(p for f in self._coordinate_functions if f for p in f.poles())
```

(although you can just as easily combine it with the line after it.

Typically we do:

```
-        OUTPUT: a list of polynomials in the coordinate ring of the ambient
-        space of the curve this point is on.
+        OUTPUT:
+
+        a list of polynomials in the coordinate ring of the ambient
+        space of the curve this point is on
```

since it is a longer description.

Be careful when changing input parameter names, e.g.,{

```diff
-def affine_patch(self, i, AA=None):
+def affine_patch(self, i, A=None):
```

as this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.


---

Comment by klee created at 2019-12-20 01:45:33

Replying to [comment:22 tscrim]:
> I have a few comments.
> 
> This can be simplified:
> {{{#!diff
> -            points = []
> -            for x in K:
> -                for y in K:
> -                    if f(x,y) == 0:
> -                        points.append(self((x,y)))
> -            points.sort()
> -            return points
> +            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))
> }}}
> which should be faster too.

Done. Thanks.

> In `_nonsingular_model`, the `TESTS::` block needs to be indented.

Done.

> The line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.

This revealed that the method `_element_constructor_` itself is not needed here. Removed.

> {{{#!diff
> -s = set([p for f in self._coordinate_functions if f for p in f.poles()])
> +s = set(p for f in self._coordinate_functions if f for p in f.poles())
> }}}
> (although you can just as easily combine it with the line after it.

Done.

> Typically we do:
> {{{
> -        OUTPUT: a list of polynomials in the coordinate ring of the ambient
> -        space of the curve this point is on.
> +        OUTPUT:
> +
> +        a list of polynomials in the coordinate ring of the ambient
> +        space of the curve this point is on
> }}}
> since it is a longer description.

Done. And I also touched a few other docstrings as I can spot.

> Be careful when changing input parameter names, e.g.,{
> {{{#!diff
> -def affine_patch(self, i, AA=None):
> +def affine_patch(self, i, A=None):
> }}}
> as this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.

I recovered it, as I realized it means "ambient affine", so double A is appropriate.


---

Comment by git created at 2019-12-20 01:46:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-12-20 01:53:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-12-20 09:55:40

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-12-20 16:36:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-12-20 16:41:52

Changing status from needs_work to needs_review.


---

Comment by klee created at 2019-12-20 16:41:52

Now generic affine and projective curves do not assume fields as base ring.


---

Comment by git created at 2019-12-21 02:02:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-12-21 02:08:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2019-12-21 02:11:48

There was a noise in commits, caused by my confusion. Sorry!


---

Comment by tscrim created at 2019-12-23 16:33:50

You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). Once changed, you can set a positive review.


---

Comment by klee created at 2019-12-24 00:59:35

Replying to [comment:32 tscrim]:
> You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). 

`X in Fields` also works.  But as far as I know, `X in Fields()` is the documented style and more importantly

```
sage: from sage.categories.fields import Fields  
sage: time QQ in Fields
CPU times: user 34 µs, sys: 0 ns, total: 34 µs
Wall time: 37.2 µs
True
sage: time QQ in Fields()
CPU times: user 13 µs, sys: 1 µs, total: 14 µs
Wall time: 16.2 µs
True
sage: type(Fields)
<class 'sage.misc.classcall_metaclass.ClasscallMetaclass'>
sage: type(Fields())
<class 'sage.categories.fields.Fields_with_category'>
```

I would like the syntax `X in Fields` but now I got used to `X in Fields()`.


---

Comment by tscrim created at 2019-12-24 15:58:11

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-12-24 15:58:11

Hmm...curious. Using `%timeit` also yields that `X in Fields()` is faster. It probably matters more when there is a category with a base ring dependency (e.g., `Algebras(R)`) where it needs to resolve the entire category hierarchy. Anyways, positive review. Thank you.


---

Comment by git created at 2019-12-25 09:19:00

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-12-25 09:19:00

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by klee created at 2019-12-25 09:20:22

The last commit is to fix merge conflicts.


---

Comment by klee created at 2019-12-25 09:20:22

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-01-01 21:01:32

9.0 is out


---

Comment by vbraun created at 2020-01-05 15:47:44

Resolution: fixed
