# Issue 27716: Add integral curves over finite fields

archive/issues_027716.json:
```json
{
    "body": "This is a subticket for #27873.\n\nIntegral curves over finite fields with function fields attached and with minimal functionality is added.\n\nThe constructor of curves is refactored to support integral curves.\n\nCurves over **prime** finite fields are removed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27953\n\n",
    "created_at": "2019-06-08T22:36:11Z",
    "labels": [
        "algebraic geometry",
        "major",
        "enhancement"
    ],
    "title": "Add integral curves over finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27716",
    "user": "klee"
}
```
This is a subticket for #27873.

Integral curves over finite fields with function fields attached and with minimal functionality is added.

The constructor of curves is refactored to support integral curves.

Curves over **prime** finite fields are removed.

Issue created by migration from https://trac.sagemath.org/ticket/27953





---

archive/issue_comments_391423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-08T22:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391423",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391424.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-09T03:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391424",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391425.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-09T03:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391425",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_391426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-09T04:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-09T07:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391427",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_391428.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-09T07:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391428",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_391429.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-10T06:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391429",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391430.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391430",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_391431.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-09T21:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391431",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_391432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-16T07:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391432",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-16T07:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391433",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391434.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-12-02T08:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391434",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391435.json:
```json
{
    "body": "I have a few comments.\n\nThis can be simplified:\n\n```diff\n-            points = []\n-            for x in K:\n-                for y in K:\n-                    if f(x,y) == 0:\n-                        points.append(self((x,y)))\n-            points.sort()\n-            return points\n+            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))\n```\n\nwhich should be faster too.\n\nIn `_nonsingular_model`, the `TESTS::` block needs to be indented.\n\nThe line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.\n\n\n```diff\n-s = set([p for f in self._coordinate_functions if f for p in f.poles()])\n+s = set(p for f in self._coordinate_functions if f for p in f.poles())\n```\n\n(although you can just as easily combine it with the line after it.\n\nTypically we do:\n\n```\n-        OUTPUT: a list of polynomials in the coordinate ring of the ambient\n-        space of the curve this point is on.\n+        OUTPUT:\n+\n+        a list of polynomials in the coordinate ring of the ambient\n+        space of the curve this point is on\n```\n\nsince it is a longer description.\n\nBe careful when changing input parameter names, e.g.,{\n\n```diff\n-def affine_patch(self, i, AA=None):\n+def affine_patch(self, i, A=None):\n```\n\nas this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.",
    "created_at": "2019-12-12T04:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391435",
    "user": "tscrim"
}
```

I have a few comments.

This can be simplified:

```diff
-            points = []
-            for x in K:
-                for y in K:
-                    if f(x,y) == 0:
-                        points.append(self((x,y)))
-            points.sort()
-            return points
+            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))
```

which should be faster too.

In `_nonsingular_model`, the `TESTS::` block needs to be indented.

The line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.


```diff
-s = set([p for f in self._coordinate_functions if f for p in f.poles()])
+s = set(p for f in self._coordinate_functions if f for p in f.poles())
```

(although you can just as easily combine it with the line after it.

Typically we do:

```
-        OUTPUT: a list of polynomials in the coordinate ring of the ambient
-        space of the curve this point is on.
+        OUTPUT:
+
+        a list of polynomials in the coordinate ring of the ambient
+        space of the curve this point is on
```

since it is a longer description.

Be careful when changing input parameter names, e.g.,{

```diff
-def affine_patch(self, i, AA=None):
+def affine_patch(self, i, A=None):
```

as this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.



---

archive/issue_comments_391436.json:
```json
{
    "body": "Replying to [comment:22 tscrim]:\n> I have a few comments.\n> \n> This can be simplified:\n> {{{#!diff\n> -            points = []\n> -            for x in K:\n> -                for y in K:\n> -                    if f(x,y) == 0:\n> -                        points.append(self((x,y)))\n> -            points.sort()\n> -            return points\n> +            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))\n> }}}\n> which should be faster too.\n\nDone. Thanks.\n\n> In `_nonsingular_model`, the `TESTS::` block needs to be indented.\n\nDone.\n\n> The line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.\n\nThis revealed that the method `_element_constructor_` itself is not needed here. Removed.\n\n> {{{#!diff\n> -s = set([p for f in self._coordinate_functions if f for p in f.poles()])\n> +s = set(p for f in self._coordinate_functions if f for p in f.poles())\n> }}}\n> (although you can just as easily combine it with the line after it.\n\nDone.\n\n> Typically we do:\n> {{{\n> -        OUTPUT: a list of polynomials in the coordinate ring of the ambient\n> -        space of the curve this point is on.\n> +        OUTPUT:\n> +\n> +        a list of polynomials in the coordinate ring of the ambient\n> +        space of the curve this point is on\n> }}}\n> since it is a longer description.\n\nDone. And I also touched a few other docstrings as I can spot.\n\n> Be careful when changing input parameter names, e.g.,{\n> {{{#!diff\n> -def affine_patch(self, i, AA=None):\n> +def affine_patch(self, i, A=None):\n> }}}\n> as this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.\n\nI recovered it, as I realized it means \"ambient affine\", so double A is appropriate.",
    "created_at": "2019-12-20T01:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391436",
    "user": "klee"
}
```

Replying to [comment:22 tscrim]:
> I have a few comments.
> 
> This can be simplified:
> {{{#!diff
> -            points = []
> -            for x in K:
> -                for y in K:
> -                    if f(x,y) == 0:
> -                        points.append(self((x,y)))
> -            points.sort()
> -            return points
> +            return sorted((self((x,y)) for x in K for y in K if f(x,y) == 0))
> }}}
> which should be faster too.

Done. Thanks.

> In `_nonsingular_model`, the `TESTS::` block needs to be indented.

Done.

> The line `super(IntegralAffineCurve, self)._element_constructor_(x)` is missing the `return`.

This revealed that the method `_element_constructor_` itself is not needed here. Removed.

> {{{#!diff
> -s = set([p for f in self._coordinate_functions if f for p in f.poles()])
> +s = set(p for f in self._coordinate_functions if f for p in f.poles())
> }}}
> (although you can just as easily combine it with the line after it.

Done.

> Typically we do:
> {{{
> -        OUTPUT: a list of polynomials in the coordinate ring of the ambient
> -        space of the curve this point is on.
> +        OUTPUT:
> +
> +        a list of polynomials in the coordinate ring of the ambient
> +        space of the curve this point is on
> }}}
> since it is a longer description.

Done. And I also touched a few other docstrings as I can spot.

> Be careful when changing input parameter names, e.g.,{
> {{{#!diff
> -def affine_patch(self, i, AA=None):
> +def affine_patch(self, i, A=None):
> }}}
> as this is a backwards incompatible change. I would either recommend not doing it or adding a deprecation (I think there is a decorator that does this, but I don't remember what it is offhand). However, this is likely not passed as `foo.affine_patch(i, AA=bar)`, so it might not matter so much. In the `ProjectiveSpace_ring.__clascall__`, I would say that is a much more necessary change and should just be done outright.

I recovered it, as I realized it means "ambient affine", so double A is appropriate.



---

archive/issue_comments_391437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-20T01:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391437",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391438.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-20T01:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391438",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391439.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-20T09:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391439",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_391440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-20T16:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391440",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-20T16:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391441",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_391442.json:
```json
{
    "body": "Now generic affine and projective curves do not assume fields as base ring.",
    "created_at": "2019-12-20T16:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391442",
    "user": "klee"
}
```

Now generic affine and projective curves do not assume fields as base ring.



---

archive/issue_comments_391443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-21T02:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-12-21T02:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391444",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391445.json:
```json
{
    "body": "There was a noise in commits, caused by my confusion. Sorry!",
    "created_at": "2019-12-21T02:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391445",
    "user": "klee"
}
```

There was a noise in commits, caused by my confusion. Sorry!



---

archive/issue_comments_391446.json:
```json
{
    "body": "You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). Once changed, you can set a positive review.",
    "created_at": "2019-12-23T16:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391446",
    "user": "tscrim"
}
```

You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). Once changed, you can set a positive review.



---

archive/issue_comments_391447.json:
```json
{
    "body": "Replying to [comment:32 tscrim]:\n> You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). \n\n`X in Fields` also works.  But as far as I know, `X in Fields()` is the documented style and more importantly\n\n```\nsage: from sage.categories.fields import Fields  \nsage: time QQ in Fields\nCPU times: user 34 \u00b5s, sys: 0 ns, total: 34 \u00b5s\nWall time: 37.2 \u00b5s\nTrue\nsage: time QQ in Fields()\nCPU times: user 13 \u00b5s, sys: 1 \u00b5s, total: 14 \u00b5s\nWall time: 16.2 \u00b5s\nTrue\nsage: type(Fields)\n<class 'sage.misc.classcall_metaclass.ClasscallMetaclass'>\nsage: type(Fields())\n<class 'sage.categories.fields.Fields_with_category'>\n```\n\nI would like the syntax `X in Fields` but now I got used to `X in Fields()`.",
    "created_at": "2019-12-24T00:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391447",
    "user": "klee"
}
```

Replying to [comment:32 tscrim]:
> You can use `X in Fields` instead of `X in Fields()` (so it avoids creating a temporary object). 

`X in Fields` also works.  But as far as I know, `X in Fields()` is the documented style and more importantly

```
sage: from sage.categories.fields import Fields  
sage: time QQ in Fields
CPU times: user 34 µs, sys: 0 ns, total: 34 µs
Wall time: 37.2 µs
True
sage: time QQ in Fields()
CPU times: user 13 µs, sys: 1 µs, total: 14 µs
Wall time: 16.2 µs
True
sage: type(Fields)
<class 'sage.misc.classcall_metaclass.ClasscallMetaclass'>
sage: type(Fields())
<class 'sage.categories.fields.Fields_with_category'>
```

I would like the syntax `X in Fields` but now I got used to `X in Fields()`.



---

archive/issue_comments_391448.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-24T15:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391448",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391449.json:
```json
{
    "body": "Hmm...curious. Using `%timeit` also yields that `X in Fields()` is faster. It probably matters more when there is a category with a base ring dependency (e.g., `Algebras(R)`) where it needs to resolve the entire category hierarchy. Anyways, positive review. Thank you.",
    "created_at": "2019-12-24T15:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391449",
    "user": "tscrim"
}
```

Hmm...curious. Using `%timeit` also yields that `X in Fields()` is faster. It probably matters more when there is a category with a base ring dependency (e.g., `Algebras(R)`) where it needs to resolve the entire category hierarchy. Anyways, positive review. Thank you.



---

archive/issue_comments_391450.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-12-25T09:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391450",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_391451.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-12-25T09:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391451",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_391452.json:
```json
{
    "body": "The last commit is to fix merge conflicts.",
    "created_at": "2019-12-25T09:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391452",
    "user": "klee"
}
```

The last commit is to fix merge conflicts.



---

archive/issue_comments_391453.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-25T09:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391453",
    "user": "klee"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391454.json:
```json
{
    "body": "9.0 is out",
    "created_at": "2020-01-01T21:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391454",
    "user": "chapoton"
}
```

9.0 is out



---

archive/issue_comments_391455.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-05T15:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27716",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27716#issuecomment-391455",
    "user": "vbraun"
}
```

Resolution: fixed
