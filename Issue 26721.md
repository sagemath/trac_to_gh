# Issue 26721: Inheriting from MPolynomialRing_libsingular crashes sage

Issue created by migration from https://trac.sagemath.org/ticket/26958

Original creator: etn40ff

Original creation time: 2018-12-25 19:08:20

Keywords: polynomial rings

The following crashes sage with a SIGSEGV:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: class Foo(MPolynomialRing_libsingular):
....:     pass
sage: Foo(QQ, 2, ['x','y'], 'degrevlex')
```

Strangely enough this bug is triggered only when inheriting; indeed the following works as expected:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: MPolynomialRing_libsingular(QQ, 2, ['x','y'], 'degrevlex')
Multivariate Polynomial Ring in x, y over Rational Field
```


As it turns out this bug is due to a spurious call to `__init_extra__` of `Algebras(...).parent_class`. Univariate polynomial rings avoid this call by setting  the attribute `_no_generic_basering_coercion = True`; now multivariate polynomial rings do so too.



---

Comment by etn40ff created at 2018-12-25 19:12:43

New commits:


---

Comment by etn40ff created at 2018-12-25 19:12:43

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-12-26 15:55:08

Doesn't hurt I suppose...


---

Comment by jdemeyer created at 2018-12-26 15:55:08

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2018-12-26 15:55:08

Changing type from PLEASE CHANGE to defect.


---

Comment by jdemeyer created at 2018-12-26 15:57:01

Although maybe a minor comment about the code: can you replace

```
cdef public bool _no_generic_basering_coercion
```

by

```
cdef readonly _no_generic_basering_coercion
```

and remove the `bool` cimport (which serves no purpose)?


---

Comment by jdemeyer created at 2018-12-26 15:57:01

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-12-27 09:21:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by etn40ff created at 2018-12-27 09:25:50

Done, thanks for the review.

A side note worth noting for #25558: after this patch it is possible to inherit from `MPolynomialRing_libsingular` but it is not possible to change its element class because the element constructor uses a function, `new_MP`, which hardcodes its output.


---

Comment by etn40ff created at 2018-12-27 09:26:29

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-01-06 08:41:10

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-01-15 18:16:10

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by vbraun created at 2019-01-23 14:17:35

Resolution: fixed
