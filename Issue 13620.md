# Issue 13620: ZeroDivisionError in CyclotomicField __contains__

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-12-12 10:41:55

Assignee: tbd

CC:  sage-combinat

Keywords: beginner

The `__contains__` method should return ``False`` if the element is not cyclotomic, but instead it blows up with a zero division error if the denominator is zero in the cyclotomic field:

```
sage: 4/3 in GF(3)
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1931, 0))

ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1936, 0))

---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)

/home/vbraun/Documents/Ftheory/ToricFibrationsP2/TateShafarevich/<ipython console> in <module>()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__contains__ (sage/structure/parent.c:7845)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7305)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3583)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3485)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/rings/finite_rings/integer_mod_ring.pyc in _element_constructor_(self, x)
    928         """
    929         try:
--> 930             return integer_mod.IntegerMod(self, x)
    931         except (NotImplementedError, PariError):
    932             raise TypeError, "error coercing to finite field"

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/rings/finite_rings/integer_mod.so in sage.rings.finite_rings.integer_mod.IntegerMod (sage/rings/finite_rings/integer_mod.c:3501)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/rings/finite_rings/integer_mod.so in sage.rings.finite_rings.integer_mod.IntegerMod_int.__init__ (sage/rings/finite_rings/integer_mod.c:19191)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/rings/rational.so in sage.rings.rational.Rational.__mod__ (sage/rings/rational.c:20034)()

/home/vbraun/opt/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.inverse_mod (sage/rings/integer.c:32846)()

ZeroDivisionError: Inverse does not exist.
```



---

Comment by vbraun created at 2012-12-12 10:42:16

Changing assignee from tbd to AlexGhitza.


---

Comment by vbraun created at 2012-12-12 10:42:16

Changing component from PLEASE CHANGE to basic arithmetic.


---

Comment by tscrim created at 2012-12-17 03:07:00

Changing status from new to needs_review.


---

Comment by tscrim created at 2012-12-17 03:07:00

Fixed by writing a `__contains__()` which catches the zero division exception and returns false if caught. Also fixed for `IntergerModRing`.


---

Comment by vbraun created at 2012-12-17 11:09:19

In `Parent.__contains__` there is already a try/except block with

```
    except (TypeError, ValueError):
        return False
```

I would prefer it if we would just add `ZeroDivisionError` there once and for all instead of overriding it in special parents.


---

Attachment

New patch with `ZeroDivisionError` only added to `Parent.__contains__()`.


---

Comment by slabbe created at 2013-01-24 15:10:20

I started the review of this ticket. All test passed (tested on sage-5.6.rc0). Documentation builds fine without warning. As I understand it, the following command returns an error and it is fine:


```
sage: Integers(6) (15/36)
...
ZeroDivisionError: Inverse does not exist.
```


But we still want the following to return False even if the coercion raises the above error:


```
sage: 15/36 in Integers(6)   # with the patch applied
False
```



---

Comment by slabbe created at 2013-01-24 15:10:20

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-01-26 09:54:18

Resolution: fixed
