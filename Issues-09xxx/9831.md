# Issue 9831: Permutation(list) should check its input (?)

archive/issues_009830.json:
```json
{
    "body": "It seems that ``Permutation(list)`` requires that the elements of list are exactly 1, 2, ..., n, but this is not clearly documented. Other values of ``list`` are accepted without error and lead to strange behaviours later.\n\nWhen ``list`` contains 0:\n\n```\n~$ ulimit -v 1048576 \n~$ sage\n----------------------------------------------------------------------\n| Sage Version 4.5.1, Release Date: 2010-07-19                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: Permutation([1]).signature()\n1\nsage: Permutation([0]).signature()\n-1\nsage: Permutation([1,0]).signature()\n-1\nsage: Permutation([0,1]).signature()\n---------------------------------------------------------------------------\nMemoryError                               Traceback (most recent call last)\n\n/home/marc/<ipython console> in <module>()\n\n/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)\n    739             -1\n    740         \"\"\"\n--> 741         return (-1)**(len(p)-len(p.to_cycles()))\n    742     \n    743 \n\n/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)\n    556             l[i], next = False, l[i]\n    557             while next != cycleFirst:\n--> 558                 cycle.append( next )\n    559                 l[next - 1], next  = False, l[next - 1]\n    560             #Add the cycle to the list of cycles\n\nMemoryError:\n```\nWith repeated elements:\n\n```\nsage: Permutation([1,1]).signature()\n---------------------------------------------------------------------------\nMemoryError                               Traceback (most recent call last)\n\n/home/marc/<ipython console> in <module>()\n\n/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)\n    739             -1\n    740         \"\"\"\n--> 741         return (-1)**(len(p)-len(p.to_cycles()))\n    742     \n    743 \n\n/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)\n    556             l[i], next = False, l[i]\n    557             while next != cycleFirst:\n--> 558                 cycle.append( next )\n    559                 l[next - 1], next  = False, l[next - 1]\n    560             #Add the cycle to the list of cycles\n\nMemoryError:\n```\n\n\n**Assignee:** sage-combinat\n\n**CC:**  brunellus\n\n**Author:** Neal Harris\n\nIssue created by migration from https://trac.sagemath.org/ticket/9831\n\n",
    "closed_at": "2013-07-22T15:28:55Z",
    "created_at": "2010-08-28T08:13:00Z",
    "labels": [
        "component: combinatorics",
        "bug",
        "duplicate"
    ],
    "title": "Permutation(list) should check its input (?)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9831",
    "user": "https://github.com/mezzarobba"
}
```
It seems that ``Permutation(list)`` requires that the elements of list are exactly 1, 2, ..., n, but this is not clearly documented. Other values of ``list`` are accepted without error and lead to strange behaviours later.

When ``list`` contains 0:

```
~$ ulimit -v 1048576 
~$ sage
----------------------------------------------------------------------
| Sage Version 4.5.1, Release Date: 2010-07-19                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: Permutation([1]).signature()
1
sage: Permutation([0]).signature()
-1
sage: Permutation([1,0]).signature()
-1
sage: Permutation([0,1]).signature()
---------------------------------------------------------------------------
MemoryError                               Traceback (most recent call last)

/home/marc/<ipython console> in <module>()

/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)
    739             -1
    740         """
--> 741         return (-1)**(len(p)-len(p.to_cycles()))
    742     
    743 

/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)
    556             l[i], next = False, l[i]
    557             while next != cycleFirst:
--> 558                 cycle.append( next )
    559                 l[next - 1], next  = False, l[next - 1]
    560             #Add the cycle to the list of cycles

MemoryError:
```
With repeated elements:

```
sage: Permutation([1,1]).signature()
---------------------------------------------------------------------------
MemoryError                               Traceback (most recent call last)

/home/marc/<ipython console> in <module>()

/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)
    739             -1
    740         """
--> 741         return (-1)**(len(p)-len(p.to_cycles()))
    742     
    743 

/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)
    556             l[i], next = False, l[i]
    557             while next != cycleFirst:
--> 558                 cycle.append( next )
    559                 l[next - 1], next  = False, l[next - 1]
    560             #Add the cycle to the list of cycles

MemoryError:
```


**Assignee:** sage-combinat

**CC:**  brunellus

**Author:** Neal Harris

Issue created by migration from https://trac.sagemath.org/ticket/9831





---

archive/issue_comments_089701.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n+It seems that ``Permutation(list)`` requires that the elements of list are exactly 1, 2, ..., n, but this is not clearly documented. Other values of ``list`` are accepted without error and lead to strange behaviours later.\n+\n+When ``list`` contains 0:\n \n ```\n ~$ ulimit -v 1048576 \n@@ -34,3 +37,29 @@\n \n MemoryError:\n ```\n+With repeated elements:\n+\n+```\n+sage: Permutation([1,1]).signature()\n+---------------------------------------------------------------------------\n+MemoryError                               Traceback (most recent call last)\n+\n+/home/marc/<ipython console> in <module>()\n+\n+/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)\n+    739             -1\n+    740         \"\"\"\n+--> 741         return (-1)**(len(p)-len(p.to_cycles()))\n+    742     \n+    743 \n+\n+/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)\n+    556             l[i], next = False, l[i]\n+    557             while next != cycleFirst:\n+--> 558                 cycle.append( next )\n+    559                 l[next - 1], next  = False, l[next - 1]\n+    560             #Add the cycle to the list of cycles\n+\n+MemoryError:\n+```\n+\n``````\n",
    "created_at": "2010-08-28T08:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89701",
    "user": "https://github.com/mezzarobba"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
+It seems that ``Permutation(list)`` requires that the elements of list are exactly 1, 2, ..., n, but this is not clearly documented. Other values of ``list`` are accepted without error and lead to strange behaviours later.
+
+When ``list`` contains 0:
 
 ```
 ~$ ulimit -v 1048576 
@@ -34,3 +37,29 @@
 
 MemoryError:
 ```
+With repeated elements:
+
+```
+sage: Permutation([1,1]).signature()
+---------------------------------------------------------------------------
+MemoryError                               Traceback (most recent call last)
+
+/home/marc/<ipython console> in <module>()
+
+/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in signature(p)
+    739             -1
+    740         """
+--> 741         return (-1)**(len(p)-len(p.to_cycles()))
+    742     
+    743 
+
+/data/sage-4.5.1/local/lib/python2.6/site-packages/sage/combinat/permutation.pyc in to_cycles(self, singletons)
+    556             l[i], next = False, l[i]
+    557             while next != cycleFirst:
+--> 558                 cycle.append( next )
+    559                 l[next - 1], next  = False, l[next - 1]
+    560             #Add the cycle to the list of cycles
+
+MemoryError:
+```
+
``````




---

archive/issue_events_073556.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2010-08-28T08:23:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "rename": {
        "from": "Strange behaviour of Permutation(list) when list contains 0",
        "to": "Permutation(list) should check its input (?)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73556"
}
```



---

archive/issue_comments_089702.json:
```json
{
    "body": "<a id='comment:2'></a>\nYes, Permutation should check the input. Moreover, it should be better documented.\n\n\nIn cycle notation:\n\n```\nsage: Permutation([(1,2),(3,4),(1,3)])\n[3, 1, 1, 3]\n```\n\nwhich is not a permutation.",
    "created_at": "2010-09-08T13:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89702",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:2'></a>
Yes, Permutation should check the input. Moreover, it should be better documented.


In cycle notation:

```
sage: Permutation([(1,2),(3,4),(1,3)])
[3, 1, 1, 3]
```

which is not a permutation.



---

archive/attachments_012710.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9831_Permutation_list_check.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9831/trac_9831_Permutation_list_check.patch",
    "created_at": "2010-11-07T04:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/nharris"
}
```



---

archive/issue_comments_089703.json:
```json
{
    "body": "",
    "created_at": "2010-11-07T04:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89703",
    "user": "https://trac.sagemath.org/admin/accounts/users/nharris"
}
```





---

archive/issue_comments_089704.json:
```json
{
    "body": "**Author:** Neal Harris",
    "created_at": "2010-11-07T04:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89704",
    "user": "https://trac.sagemath.org/admin/accounts/users/nharris"
}
```

**Author:** Neal Harris



---

archive/issue_events_073557.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/nharris",
    "created_at": "2010-11-07T04:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73557"
}
```



---

archive/issue_comments_089705.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've uploaded a patch which takes care of this issue.  (It also allows Permutation to take a list of non-disjoint tuples.)  There's still some work to be done, as the patch breaks several doctests:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t -long devel/sage-test/doc/en/bordeaux_2008/generators_for_rings.rst # 4 doctests failed\n\tsage -t -long devel/sage-test/sage/combinat/integer_vector_weighted.py # 7 doctests failed\n\tsage -t -long devel/sage-test/sage/combinat/posets/hasse_diagram.py # 1 doctests failed\n\tsage -t -long devel/sage-test/sage/combinat/posets/poset_examples.py # 6 doctests failed\n\tsage -t -long devel/sage-test/sage/misc/sagedoc.py # 3 doctests failed\n\tsage -t -long devel/sage-test/sage/modular/modform/find_generators.py # 18 doctests failed\n\tsage -t -long devel/sage-test/sage/plot/plot3d/base.pyx # 4 doctests failed\n\tsage -t -long devel/sage-test/sage/modular/ssmod/ssmod.py # Time out\n----------------------------------------------------------------------\n```",
    "created_at": "2010-11-07T04:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89705",
    "user": "https://trac.sagemath.org/admin/accounts/users/nharris"
}
```

<a id='comment:3'></a>
I've uploaded a patch which takes care of this issue.  (It also allows Permutation to take a list of non-disjoint tuples.)  There's still some work to be done, as the patch breaks several doctests:

```
----------------------------------------------------------------------

The following tests failed:

	sage -t -long devel/sage-test/doc/en/bordeaux_2008/generators_for_rings.rst # 4 doctests failed
	sage -t -long devel/sage-test/sage/combinat/integer_vector_weighted.py # 7 doctests failed
	sage -t -long devel/sage-test/sage/combinat/posets/hasse_diagram.py # 1 doctests failed
	sage -t -long devel/sage-test/sage/combinat/posets/poset_examples.py # 6 doctests failed
	sage -t -long devel/sage-test/sage/misc/sagedoc.py # 3 doctests failed
	sage -t -long devel/sage-test/sage/modular/modform/find_generators.py # 18 doctests failed
	sage -t -long devel/sage-test/sage/plot/plot3d/base.pyx # 4 doctests failed
	sage -t -long devel/sage-test/sage/modular/ssmod/ssmod.py # Time out
----------------------------------------------------------------------
```



---

archive/issue_comments_089706.json:
```json
{
    "body": "<a id='comment:4'></a>\nPlease note that this ticket duplicates #8392, which also contains some patch. Moreover, it links to [a discussion](http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c6a39caca9df29dc) on combinat-devel, where an additional computational load of the check is considered.\n\nWould you mind if I resolve failing doctests? I am new to the Sage development, so I am not sure whether someone is working on this issue right now.",
    "created_at": "2011-12-02T15:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89706",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:4'></a>
Please note that this ticket duplicates #8392, which also contains some patch. Moreover, it links to [a discussion](http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/c6a39caca9df29dc) on combinat-devel, where an additional computational load of the check is considered.

Would you mind if I resolve failing doctests? I am new to the Sage development, so I am not sure whether someone is working on this issue right now.



---

archive/issue_comments_089707.json:
```json
{
    "body": "<a id='comment:6'></a>\nLarge portion of the errors was caused by integer_vector_weighted that used permutation multiplication instead of permutation acting on list.",
    "created_at": "2011-12-31T01:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89707",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:6'></a>
Large portion of the errors was caused by integer_vector_weighted that used permutation multiplication instead of permutation acting on list.



---

archive/attachments_012711.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9831_Permutation_input_repair.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9831/trac_9831_Permutation_input_repair.patch",
    "created_at": "2011-12-31T01:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```



---

archive/issue_comments_089708.json:
```json
{
    "body": "<a id='comment:7'></a>\nNow, I would like to send this to review, because I see no more error (maybe I overlooked some?). But the original patch refuses to apply -- I guess it's because codebase shifted somehow in last year. Is this a problem I should correct?",
    "created_at": "2011-12-31T01:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89708",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:7'></a>
Now, I would like to send this to review, because I see no more error (maybe I overlooked some?). But the original patch refuses to apply -- I guess it's because codebase shifted somehow in last year. Is this a problem I should correct?



---

archive/issue_events_073558.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:28:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73558"
}
```



---

archive/issue_events_073559.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:28:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73559"
}
```



---

archive/issue_comments_089709.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis is indeed a duplicate of #8392 which has been merged.",
    "created_at": "2013-07-22T15:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9831#issuecomment-89709",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:8'></a>
This is indeed a duplicate of #8392 which has been merged.



---

archive/issue_events_073560.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:28:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "label": "duplicate",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73560"
}
```



---

archive/issue_events_073561.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2013-07-22T15:28:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9831",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9831#event-73561"
}
```
