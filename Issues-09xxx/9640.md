# Issue 9640: Change PARI error catching mechanism

archive/issues_009640.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "Currently, the exceptions thrown by PARI are rather cryptic, like\n\n```\nTraceback (most recent call last):\n...\nPariError:  (15)\n```\n\nThis ticket does the following:\n\n- Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n\n- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.\n\n- Introduce a new function `sig_error()` to callback to the interrupt/signal handling code to handle errors which aren't signals and use that for PARI.\n\nApply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)\n\n\nDepends on #14029\nDepends on #13311\n\nCC:  @nexttime @jdemeyer\n\nKeywords: **pari error interrupt**\n\nReviewer: **Jeroen Demeyer, Peter Bruin**\n\nAuthor: **Peter Bruin, Jeroen Demeyer**\n\nMerged: **sage-5.13.beta3**\n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9640_\n\n",
    "closed_at": "2013-11-06T12:48:56Z",
    "created_at": "2010-07-29T15:47:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.13",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Change PARI error catching mechanism",
    "type": "issue",
    "updated_at": "2013-11-06T12:48:56Z",
    "url": "https://github.com/sagemath/sage/issues/9640",
    "user": "https://github.com/jdemeyer"
}
```
Currently, the exceptions thrown by PARI are rather cryptic, like

```
Traceback (most recent call last):
...
PariError:  (15)
```

This ticket does the following:

- Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.

- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.

- Introduce a new function `sig_error()` to callback to the interrupt/signal handling code to handle errors which aren't signals and use that for PARI.

Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)


Depends on #14029
Depends on #13311

CC:  @nexttime @jdemeyer

Keywords: **pari error interrupt**

Reviewer: **Jeroen Demeyer, Peter Bruin**

Author: **Peter Bruin, Jeroen Demeyer**

Merged: **sage-5.13.beta3**

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/9640_





---

archive/issue_events_124447.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-07-29T15:47:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124447"
}
```



---

archive/issue_events_124448.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-07-29T15:47:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124448"
}
```



---

archive/issue_events_124449.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-07-29T15:47:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124449"
}
```



---

archive/issue_events_124450.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-07-29T15:47:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124450"
}
```



---

archive/issue_events_124451.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-07-29T15:47:12Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124451"
}
```



---

archive/issue_comments_084312.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,6 @@\n PariError:  (15)\n ```\n \n-Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw PariError.  We should change to using cb_pari_handle_exception() instead of err_catch() to catch PARI exceptions.\n+Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n \n-Dependencies: #9343, #9636\n+Dependencies: #9678\n``````\n",
    "created_at": "2010-09-27T10:53:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84312",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,6 @@
 PariError:  (15)
 ```
 
-Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw PariError.  We should change to using cb_pari_handle_exception() instead of err_catch() to catch PARI exceptions.
+Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.
 
-Dependencies: #9343, #9636
+Dependencies: #9678
``````




---

archive/issue_comments_084313.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2010-09-27T11:55:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84313",
    "user": "https://github.com/nexttime"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_084314.json:
```json
{
    "body": "Old patch for reference",
    "created_at": "2010-10-17T18:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84314",
    "user": "https://github.com/jdemeyer"
}
```

Old patch for reference



---

archive/issue_comments_084315.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[9640old.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640old.patch.gz)**",
    "created_at": "2010-10-17T18:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84315",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[9640old.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640old.patch.gz)**



---

archive/issue_comments_084316.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,4 +8,4 @@\n \n Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n \n-Dependencies: #9678\n+Dependencies: #10115, #9893, #9678\n``````\n",
    "created_at": "2010-10-17T18:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84316",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,4 +8,4 @@
 
 Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.
 
-Dependencies: #9678
+Dependencies: #10115, #9893, #9678
``````




---

archive/issue_comments_084317.json:
```json
{
    "body": "Changed keywords from none to **pari error interrupt**",
    "created_at": "2010-10-17T18:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84317",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from none to **pari error interrupt**



---

archive/issue_events_124452.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124452"
}
```



---

archive/issue_events_124453.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124453"
}
```



---

archive/issue_comments_084318.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI am working on a patch that does the following things suggested by the ticket description:\n- Rewrite `pari_catch_sig_on()` and `pari_catch_sig_off()` to use the callbacks `cb_pari_handle_exception` and `cb_pari_err_recover` (defined by the PARI library) in combination with `sig_on()`/`sig_off()`, as opposed to the additional `setjmp()` of the current implementation.\n- Catch output sent to `pariErr` and store it in a string attribute `pari_instance.error_string` for later use by `PariError`.\n\nIt seems to work quite well; the only doctest failures I've seen so far are a few tests expecting a PARI warning message.  With the patch, these are not printed because they also go to `pariErr`.\n\nTo be done:\n- Make `PariError` aware of the stored string to give a more informative error message.  This should probably simply be extracted from the lines starting with `***` in `pari_instance.error_string`.\n- Minor change in PARI: send any extra newline at the start of the error message to `pariErr` instead of `pariOut` (this happens if the last printed character was not a newline).\n- Distinguish between errors and warnings; the latter should probably be printed to `stderr` as before.  This should be done either by filtering the text sent to `pariErr` or by having `pari_catch_sig_off()` check if `pari_instance.error_string` is non-empty even if no error occurred.\n\nThis may make #14894 redundant, although that ticket could be used for general things to be done for the upgrade to PARI 2.6.",
    "created_at": "2013-09-11T14:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84318",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

I am working on a patch that does the following things suggested by the ticket description:
- Rewrite `pari_catch_sig_on()` and `pari_catch_sig_off()` to use the callbacks `cb_pari_handle_exception` and `cb_pari_err_recover` (defined by the PARI library) in combination with `sig_on()`/`sig_off()`, as opposed to the additional `setjmp()` of the current implementation.
- Catch output sent to `pariErr` and store it in a string attribute `pari_instance.error_string` for later use by `PariError`.

It seems to work quite well; the only doctest failures I've seen so far are a few tests expecting a PARI warning message.  With the patch, these are not printed because they also go to `pariErr`.

To be done:
- Make `PariError` aware of the stored string to give a more informative error message.  This should probably simply be extracted from the lines starting with `***` in `pari_instance.error_string`.
- Minor change in PARI: send any extra newline at the start of the error message to `pariErr` instead of `pariOut` (this happens if the last printed character was not a newline).
- Distinguish between errors and warnings; the latter should probably be printed to `stderr` as before.  This should be done either by filtering the text sent to `pariErr` or by having `pari_catch_sig_off()` check if `pari_instance.error_string` is non-empty even if no error occurred.

This may make #14894 redundant, although that ticket could be used for general things to be done for the upgrade to PARI 2.6.



---

archive/issue_comments_084319.json:
```json
{
    "body": "Attachment: **[9640-pari_error_handling.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_handling.patch.gz)**\n\nbased on 5.12.beta4 + #15124",
    "created_at": "2013-09-11T15:22:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84319",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[9640-pari_error_handling.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_handling.patch.gz)**

based on 5.12.beta4 + #15124



---

archive/issue_comments_084320.json:
```json
{
    "body": "Work Issues: **see comment 6**",
    "created_at": "2013-09-11T15:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84320",
    "user": "https://github.com/pjbruin"
}
```

Work Issues: **see comment 6**



---

archive/issue_events_124454.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-11T15:24:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124454"
}
```



---

archive/issue_comments_084321.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe attached patch passes doctests on x86_64 GNU/Linux, except for two tests expecting a PARI warning (see above).",
    "created_at": "2013-09-11T15:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84321",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">comment:7</div>

The attached patch passes doctests on x86_64 GNU/Linux, except for two tests expecting a PARI warning (see above).



---

archive/issue_events_124455.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-11T15:25:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124455"
}
```



---

archive/issue_events_124456.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-11T15:25:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124456"
}
```



---

archive/issue_comments_084322.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nIt would be better practice to move `_pari_init_err()`, `_pari_handle_exception()` and `_pari_err_recover()` from `pari_err.h` to a C file or to translate them to Cython.  At the moment I don't think it is worth the trouble.",
    "created_at": "2013-09-11T15:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84322",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

It would be better practice to move `_pari_init_err()`, `_pari_handle_exception()` and `_pari_err_recover()` from `pari_err.h` to a C file or to translate them to Cython.  At the moment I don't think it is worth the trouble.



---

archive/issue_comments_084323.json:
```json
{
    "body": "Changed author from **Jeroen Demeyer** to **Peter Bruin**",
    "created_at": "2013-09-11T15:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84323",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **Jeroen Demeyer** to **Peter Bruin**



---

archive/issue_events_124457.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-12T19:42:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124457"
}
```



---

archive/issue_events_124458.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-12T19:42:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124458"
}
```



---

archive/issue_comments_084324.json:
```json
{
    "body": "Changed work issues from **see comment 6** to none",
    "created_at": "2013-09-12T19:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84324",
    "user": "https://github.com/pjbruin"
}
```

Changed work issues from **see comment 6** to none



---

archive/issue_comments_084325.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,11 @@\n PariError:  (15)\n ```\n \n-Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n+This ticket does the following:\n \n-Dependencies: #10115, #9893, #9678\n+- Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n+\n+- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)\n+\n+Apply: [attachment: 9640-pari_error_callbacks.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)\n+\n``````\n",
    "created_at": "2013-09-12T19:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84325",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,11 @@
 PariError:  (15)
 ```
 
-Using a mechanism similar to #9636, it should be possible to catch the full text of the exception and use it to throw `PariError`.  We should change to using `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.
+This ticket does the following:
 
-Dependencies: #10115, #9893, #9678
+- Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.
+
+- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)
+
+Apply: [attachment: 9640-pari_error_callbacks.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)
+
``````




---

archive/issue_comments_084326.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe latest patch does everything that I think it should do.  I hope it is reasonably self-explanatory.  A few remarks:\n\n- The error text is now passed to `PariError` and can be accessed using `PariError.errtext()`; is is not printed automatically.  Using this text to improve messages like `PariError:  (15)` will probably have to wait until another ticket.  (Edit: `user` errors are an exception, since they are converted into `RuntimeError`; here we append the error text to the currently used \"PARI user exception\".)\n\n- There is no problem with PARI sending escape sequences for colours in error messages; this is disabled by default.\n\n- The printing of a possible extra newline before the error message is easily avoided using `pari_set_last_newline(1)`.\n\n- The callback functions are now Cython functions in the new file `pari_error.pyx`.  It is important that this does *not* include `pari_err.pxi`; because of the way Cython imports functions, `pari_err.pxi` and `pari_err.h` use function pointers with the same names as the functions defined in `pari_error.pyx`.",
    "created_at": "2013-09-12T19:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84326",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

The latest patch does everything that I think it should do.  I hope it is reasonably self-explanatory.  A few remarks:

- The error text is now passed to `PariError` and can be accessed using `PariError.errtext()`; is is not printed automatically.  Using this text to improve messages like `PariError:  (15)` will probably have to wait until another ticket.  (Edit: `user` errors are an exception, since they are converted into `RuntimeError`; here we append the error text to the currently used "PARI user exception".)

- There is no problem with PARI sending escape sequences for colours in error messages; this is disabled by default.

- The printing of a possible extra newline before the error message is easily avoided using `pari_set_last_newline(1)`.

- The callback functions are now Cython functions in the new file `pari_error.pyx`.  It is important that this does *not* include `pari_err.pxi`; because of the way Cython imports functions, `pari_err.pxi` and `pari_err.h` use function pointers with the same names as the functions defined in `pari_error.pyx`.



---

archive/issue_comments_084327.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPatchbot:\n\n```\napply 9640-pari_error_callbacks.patch\u200b\n```",
    "created_at": "2013-09-23T10:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84327",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:11" align="right">comment:11</div>

Patchbot:

```
apply 9640-pari_error_callbacks.patch​
```



---

archive/issue_comments_084328.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWhy not set `cb_pari_handle_exception = _pari_handle_exception` globally and have `pari_catch_sig_on()` simply be **equal** to `sig_on()` (and then of course change `pari_catch_sig_on()` back to `sig_on()`).",
    "created_at": "2013-10-03T09:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84328",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Why not set `cb_pari_handle_exception = _pari_handle_exception` globally and have `pari_catch_sig_on()` simply be **equal** to `sig_on()` (and then of course change `pari_catch_sig_on()` back to `sig_on()`).



---

archive/issue_comments_084329.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nInstead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...",
    "created_at": "2013-10-03T10:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84329",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Instead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...



---

archive/issue_comments_084330.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:12):\n> Why not set `cb_pari_handle_exception = _pari_handle_exception` globally and have `pari_catch_sig_on()` simply be **equal** to `sig_on()` (and then of course change `pari_catch_sig_on()` back to `sig_on()`).\n\nGood question.  That would mean we simply always have PARI exception handling enabled, which would be more efficient and should not make any difference since PARI shouldn't be called outside of `sig_on()/sig_off()` anyway.  I'll try it out.",
    "created_at": "2013-10-03T10:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84330",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:12):
> Why not set `cb_pari_handle_exception = _pari_handle_exception` globally and have `pari_catch_sig_on()` simply be **equal** to `sig_on()` (and then of course change `pari_catch_sig_on()` back to `sig_on()`).

Good question.  That would mean we simply always have PARI exception handling enabled, which would be more efficient and should not make any difference since PARI shouldn't be called outside of `sig_on()/sig_off()` anyway.  I'll try it out.



---

archive/issue_comments_084331.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAnyway, I am thinking about a review patch so I will make these changes myself.\n\nPeter, is there any chance you could review #14029 and #13311 because those tickets also make changes to the interrupt code.",
    "created_at": "2013-10-03T10:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84331",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Anyway, I am thinking about a review patch so I will make these changes myself.

Peter, is there any chance you could review #14029 and #13311 because those tickets also make changes to the interrupt code.



---

archive/issue_comments_084332.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Instead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...\n\nWhy `abort()` and not `raise(SIGUSR1)` or another signal code?",
    "created_at": "2013-10-03T10:08:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84332",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> Instead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...

Why `abort()` and not `raise(SIGUSR1)` or another signal code?



---

archive/issue_comments_084333.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI am thinking about merging (parts of) #10018 here, especially the doctests.",
    "created_at": "2013-10-03T10:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84333",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

I am thinking about merging (parts of) #10018 here, especially the doctests.



---

archive/issue_comments_084334.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@pjbruin](#comment:16):\n> Replying to [@jdemeyer](#comment:13):\n> > Instead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...\n\n> Why `abort()` and not `raise(SIGUSR1)` or another signal code?\n\nBecause we already handle `abort()` anyway and because I see no gain of adding an extra signal, with the risk that `SIGUSR1` is used by other Sage packages.",
    "created_at": "2013-10-03T10:11:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84334",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@pjbruin](#comment:16):
> Replying to [@jdemeyer](#comment:13):
> > Instead of using `sage_siglongjmp()`, I think it's safer to call `abort()` and use the normal signal handling mechanism. Otherwise we have to consider race conditions like a `SIGINT` arriving during the `sage_siglongjmp()` call...

> Why `abort()` and not `raise(SIGUSR1)` or another signal code?

Because we already handle `abort()` anyway and because I see no gain of adding an extra signal, with the risk that `SIGUSR1` is used by other Sage packages.



---

archive/issue_comments_084335.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:18):\n> Replying to [@pjbruin](#comment:16):\n> > Why `abort()` and not `raise(SIGUSR1)` or another signal code?\n\n> Because we already handle `abort()` anyway and because I see no gain of adding an extra signal, with the risk that `SIGUSR1` is used by other Sage packages.\n\nBut we handle it by raising a new `RuntimeError`, among other things, unless I misunderstand `interrupt.c`.  So wouldn't the `SIGABRT` handler need to have a special case for the case where it is called in this way?  This would be rather inelegant.",
    "created_at": "2013-10-03T10:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84335",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:18):
> Replying to [@pjbruin](#comment:16):
> > Why `abort()` and not `raise(SIGUSR1)` or another signal code?

> Because we already handle `abort()` anyway and because I see no gain of adding an extra signal, with the risk that `SIGUSR1` is used by other Sage packages.

But we handle it by raising a new `RuntimeError`, among other things, unless I misunderstand `interrupt.c`.  So wouldn't the `SIGABRT` handler need to have a special case for the case where it is called in this way?  This would be rather inelegant.



---

archive/issue_comments_084336.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@pjbruin](#comment:19):\n> This would be rather inelegant.\n\nI personally don't find it inelegant. In any case, we would encapsalate this through some call like `sig_error()`.",
    "created_at": "2013-10-03T10:26:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84336",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@pjbruin](#comment:19):
> This would be rather inelegant.

I personally don't find it inelegant. In any case, we would encapsalate this through some call like `sig_error()`.



---

archive/issue_comments_084337.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment:15):\n> Peter, is there any chance you could review #14029 and #13311 because those tickets also make changes to the interrupt code.\n\nNot very soon, unfortunately (lots of work at the moment), but I'll put my name in the CC list.",
    "created_at": "2013-10-03T20:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84337",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment:15):
> Peter, is there any chance you could review #14029 and #13311 because those tickets also make changes to the interrupt code.

Not very soon, unfortunately (lots of work at the moment), but I'll put my name in the CC list.



---

archive/issue_comments_084338.json:
```json
{
    "body": "Dependencies: **#14029, #13311**",
    "created_at": "2013-11-01T10:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84338",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#14029, #13311**



---

archive/issue_events_124459.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-01T10:31:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124459"
}
```



---

archive/issue_events_124460.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-01T10:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124460"
}
```



---

archive/issue_comments_084339.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWorking/thinking about this...",
    "created_at": "2013-11-01T10:31:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84339",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Working/thinking about this...



---

archive/issue_comments_084340.json:
```json
{
    "body": "Attachment: **[9640-pari_error_callbacks.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)**\n\nbased on 5.12.beta4 + #15124",
    "created_at": "2013-11-01T10:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84340",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[9640-pari_error_callbacks.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)**

based on 5.12.beta4 + #15124



---

archive/issue_comments_084341.json:
```json
{
    "body": "Changed author from **Peter Bruin** to **Peter Bruin, Jeroen Demeyer**",
    "created_at": "2013-11-01T21:43:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84341",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Peter Bruin** to **Peter Bruin, Jeroen Demeyer**



---

archive/issue_comments_084342.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n \n - Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)\n \n-Apply: [attachment: 9640-pari_error_callbacks.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)\n+Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)\n \n``````\n",
    "created_at": "2013-11-01T21:43:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84342",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 
 - Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)
 
-Apply: [attachment: 9640-pari_error_callbacks.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks.patch.gz)
+Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)
 
``````




---

archive/issue_comments_084343.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n \n - Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.\n \n-- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)\n+- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.\n \n Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)\n \n``````\n",
    "created_at": "2013-11-01T22:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84343",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 
 - Use `cb_pari_handle_exception()` instead of `err_catch()` to catch PARI exceptions.
 
-- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.  (It is not printed automatically, but can be accessed via `PariError.errtext()`.)
+- Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.
 
 Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)
 
``````




---

archive/issue_comments_084344.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,7 @@\n \n - Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.\n \n+- Introduce a new function `sig_error()` to callback to the interrupt/signal handling code to handle errors which aren't signals and use that for PARI.\n+\n Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)\n \n``````\n",
    "created_at": "2013-11-01T22:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84344",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,7 @@
 
 - Using a mechanism similar to #9636, catch the full text of the exception and pass it to `PariError`.
 
+- Introduce a new function `sig_error()` to callback to the interrupt/signal handling code to handle errors which aren't signals and use that for PARI.
+
 Apply: [attachment: 9640-pari_error_callbacks_v2.patch](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)
 
``````




---

archive/issue_events_124461.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-01T22:42:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124461"
}
```



---

archive/issue_events_124462.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-01T22:42:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124462"
}
```



---

archive/issue_comments_084345.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nWhat is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?",
    "created_at": "2013-11-02T18:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84345",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:28" align="right">comment:28</div>

What is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?



---

archive/issue_comments_084346.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@pjbruin](#comment:28):\n> What is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?\n\nFor me, it can be removed. But it existed before (as a function `__errmessage()`) and one possible use would be to check that an error is of a given type without relying on the PARI error codes (for example, in pure Python code). Something like:\n\n```python\ntry:\n    pari.....\nexcept PariError as E:\n    if E.parimessage() == \"division by zero\":\n        raise ZeroDivisionError\n    else:\n        raise\n```\nPerhaps this is never going to happen, but at least the method `parimessage()` doesn't hurt either.",
    "created_at": "2013-11-02T20:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84346",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@pjbruin](#comment:28):
> What is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?

For me, it can be removed. But it existed before (as a function `__errmessage()`) and one possible use would be to check that an error is of a given type without relying on the PARI error codes (for example, in pure Python code). Something like:

```python
try:
    pari.....
except PariError as E:
    if E.parimessage() == "division by zero":
        raise ZeroDivisionError
    else:
        raise
```
Perhaps this is never going to happen, but at least the method `parimessage()` doesn't hurt either.



---

archive/issue_comments_084347.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:29):\n> Replying to [@pjbruin](#comment:28):\n> > What is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?\n\n> For me, it can be removed. But it existed before (as a function `__errmessage()`) and one possible use would be to check that an error is of a given type without relying on the PARI error codes (for example, in pure Python code).\n\nThat is a possibility.  On the other hand, the global variable `errmessage` is another thing that has disappeared in PARI 2.6.  It has been replaced by a function `const char *numerr_name(long numerr)` which returns e.g. `\"e_INV\"` for zero division errors.  This means that in the near future your example will probably look like\n\n```python\nif pari.numerr_name(E.errnum()) == \"e_INV\":\n    raise ZeroDivisionError\n```\nOf course, one could then think of a method of `PariError` encapsulating this if necessary, but `parimessage` would no longer be an appropriate name.\n\nFor the time being (at least until we switch to PARI 2.6) or unless someone really wants a method like this, I think it is easiest to just remove it.",
    "created_at": "2013-11-03T00:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84347",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:29):
> Replying to [@pjbruin](#comment:28):
> > What is the use of `PariError.parimessage()`?  It doesn't seem to be used, and appears to normally be a substring of `PariError.__str__()`.  Do you have any application for it in mind, or can it be removed?

> For me, it can be removed. But it existed before (as a function `__errmessage()`) and one possible use would be to check that an error is of a given type without relying on the PARI error codes (for example, in pure Python code).

That is a possibility.  On the other hand, the global variable `errmessage` is another thing that has disappeared in PARI 2.6.  It has been replaced by a function `const char *numerr_name(long numerr)` which returns e.g. `"e_INV"` for zero division errors.  This means that in the near future your example will probably look like

```python
if pari.numerr_name(E.errnum()) == "e_INV":
    raise ZeroDivisionError
```
Of course, one could then think of a method of `PariError` encapsulating this if necessary, but `parimessage` would no longer be an appropriate name.

For the time being (at least until we switch to PARI 2.6) or unless someone really wants a method like this, I think it is easiest to just remove it.



---

archive/issue_comments_084348.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAttachment: **[9640-pari_error_callbacks_v2.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)**\n\nRemoved `PariError.parimessage()` method and moved the `cdef extern from \"misc.h\":` block to the top of `gen.pyx`.",
    "created_at": "2013-11-03T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84348",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Attachment: **[9640-pari_error_callbacks_v2.patch.gz](https://github.com/sagemath/sage/files/ticket9640/9640-pari_error_callbacks_v2.patch.gz)**

Removed `PariError.parimessage()` method and moved the `cdef extern from "misc.h":` block to the top of `gen.pyx`.



---

archive/issue_comments_084349.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI'm happy with this now.  Hopefully someone wants to review it.",
    "created_at": "2013-11-04T12:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84349",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:32" align="right">comment:32</div>

I'm happy with this now.  Hopefully someone wants to review it.



---

archive/issue_events_124463.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-04T12:44:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124463"
}
```



---

archive/issue_events_124464.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-04T12:44:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124464"
}
```



---

archive/issue_comments_084350.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Peter Bruin**",
    "created_at": "2013-11-04T12:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84350",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer, Peter Bruin**



---

archive/issue_comments_084351.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@pjbruin](#comment:32):\n> I'm happy with this now.  Hopefully someone wants to review it.\n\nSince we both looked at eachother's work, I guess that counts as positive review.",
    "created_at": "2013-11-04T12:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84351",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@pjbruin](#comment:32):
> I'm happy with this now.  Hopefully someone wants to review it.

Since we both looked at eachother's work, I guess that counts as positive review.



---

archive/issue_comments_084352.json:
```json
{
    "body": "Merged: **sage-5.13.beta3**",
    "created_at": "2013-11-06T12:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9640#issuecomment-84352",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.13.beta3**



---

archive/issue_events_124465.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-06T12:48:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124465"
}
```



---

archive/issue_events_124466.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-06T12:48:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9640#event-124466"
}
```
