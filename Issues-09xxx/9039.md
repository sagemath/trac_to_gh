# Issue 9039: major error in E.sha().bound_kato() for E an elliptic curve

archive/issues_009039.json:
```json
{
    "body": "Does not check for primes of bad reduction at all!!\n\nAssignee: @JohnCremona\n\nCC:  @categorie\n\nResolution: fixed\n\nAuthor: Robert Miller\n\nReviewer: Chris Wuthrich\n\nMerged: sage-4.4.3.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/9039\n\n",
    "closed_at": "2010-06-04T15:28:21Z",
    "created_at": "2010-05-25T00:37:50Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.4.3",
    "title": "major error in E.sha().bound_kato() for E an elliptic curve",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9039",
    "user": "https://github.com/rlmill"
}
```
Does not check for primes of bad reduction at all!!

Assignee: @JohnCremona

CC:  @categorie

Resolution: fixed

Author: Robert Miller

Reviewer: Chris Wuthrich

Merged: sage-4.4.3.rc0

Issue created by migration from https://trac.sagemath.org/ticket/9039





---

archive/issue_comments_099467.json:
```json
{
    "body": "<a id='comment:1'></a>I haven't yet fixed the documentation results, since the returned lists are different, mainly to highlight the differences... Also I'm not entirely sure I have the code exactly right, maybe you can verify this. I also think that the references need updating/completing.\n\nInput is welcome! Here are the doc differences:\n\n```\nsage -t -long \"devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\"\nSaturation index bound = 265\nWARNING: saturation at primes p > 100 will not be done;  \npoints may be unsaturated at primes between 100 and index bound\nFailed to saturate MW basis at primes [ ]\n*** saturation possibly incomplete at primes [ ]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 876:\n    sage: E.sha().bound_kato()\nExpected:\n    [2, 3, 5]\nGot:\n    [2]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 879:\n    sage: E.sha().bound_kato()\nExpected:\n    [2, 3, 5]\nGot:\n    [2]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 882:\n    sage: E.sha().bound_kato()\nExpected:\n    [2, 3]\nGot:\n    [2]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 888:\n    sage: E.sha().bound_kato()                 # long time (about 1 second)\nExpected:\n    [2, 3, 5]\nGot:\n    [2, 5, 23]\n**********************************************************************\nFile \"/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 896:\n    sage: E.sha().bound_kato()                 # long time (< 10 seconds)\nExpected:\n    [2, 3, 7]\nGot:\n    [2, 7, 29]\n**********************************************************************\n1 items had failures:\n   5 of  15 in __main__.example_8\n***Test Failed*** 5 failures.\nFor whitespace errors, see the file /Users/rlmill/.sage//tmp/.doctest_sha_tate.py\n\t [154.4 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t -long \"devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\"\nTotal time for all tests: 154.4 seconds\n```",
    "created_at": "2010-05-25T01:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99467",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:1'></a>I haven't yet fixed the documentation results, since the returned lists are different, mainly to highlight the differences... Also I'm not entirely sure I have the code exactly right, maybe you can verify this. I also think that the references need updating/completing.

Input is welcome! Here are the doc differences:

```
sage -t -long "devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py"
Saturation index bound = 265
WARNING: saturation at primes p > 100 will not be done;  
points may be unsaturated at primes between 100 and index bound
Failed to saturate MW basis at primes [ ]
*** saturation possibly incomplete at primes [ ]
**********************************************************************
File "/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 876:
    sage: E.sha().bound_kato()
Expected:
    [2, 3, 5]
Got:
    [2]
**********************************************************************
File "/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 879:
    sage: E.sha().bound_kato()
Expected:
    [2, 3, 5]
Got:
    [2]
**********************************************************************
File "/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 882:
    sage: E.sha().bound_kato()
Expected:
    [2, 3]
Got:
    [2]
**********************************************************************
File "/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 888:
    sage: E.sha().bound_kato()                 # long time (about 1 second)
Expected:
    [2, 3, 5]
Got:
    [2, 5, 23]
**********************************************************************
File "/Users/rlmill/sage-4.4.1/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 896:
    sage: E.sha().bound_kato()                 # long time (< 10 seconds)
Expected:
    [2, 3, 7]
Got:
    [2, 7, 29]
**********************************************************************
1 items had failures:
   5 of  15 in __main__.example_8
***Test Failed*** 5 failures.
For whitespace errors, see the file /Users/rlmill/.sage//tmp/.doctest_sha_tate.py
	 [154.4 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t -long "devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py"
Total time for all tests: 154.4 seconds
```



---

archive/issue_comments_099468.json:
```json
{
    "body": "<a id='comment:2'></a>In principle, I agree with the changes. Certainly the additive primes must go in that list.\n\nWhen it comes to the the condition on the mod-p representation, I would propose to wait. I have submitted a correction for the article proving this. But before I get the confirmation that everything is fine now, I would not want to change this back in sage. Also there will be other places as in p_primary_bound where a change will be needed in that case.\n\nDo you want to wait ? Or do you want to fix the issue with the additive first and open another ticket when/if the corrections are accepted ?\n\nChris.",
    "created_at": "2010-05-25T14:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99468",
    "user": "https://github.com/categorie"
}
```

<a id='comment:2'></a>In principle, I agree with the changes. Certainly the additive primes must go in that list.

When it comes to the the condition on the mod-p representation, I would propose to wait. I have submitted a correction for the article proving this. But before I get the confirmation that everything is fine now, I would not want to change this back in sage. Also there will be other places as in p_primary_bound where a change will be needed in that case.

Do you want to wait ? Or do you want to fix the issue with the additive first and open another ticket when/if the corrections are accepted ?

Chris.



---

archive/issue_comments_099469.json:
```json
{
    "body": "<a id='comment:3'></a>Chris,\n\nReplying to [wuthrich](#comment%3A2):\n> Do you want to wait ? Or do you want to fix the issue with the additive first and open another ticket when/if the corrections are accepted ?\n\n\nI am not in favor of waiting. Let's get the patch up to speed with what is currently known and verified, and update the function once we're ready to.\n\nIn order to get an acceptable patch for now, are you saying that the only change should be to add in the additive primes? If so I can modify my patch to do only that.",
    "created_at": "2010-05-25T16:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99469",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:3'></a>Chris,

Replying to [wuthrich](#comment%3A2):
> Do you want to wait ? Or do you want to fix the issue with the additive first and open another ticket when/if the corrections are accepted ?


I am not in favor of waiting. Let's get the patch up to speed with what is currently known and verified, and update the function once we're ready to.

In order to get an acceptable patch for now, are you saying that the only change should be to add in the additive primes? If so I can modify my patch to do only that.



---

archive/issue_comments_099470.json:
```json
{
    "body": "<a id='comment:4'></a>Yes, the list should contain 2, all primes of additive reduction and all for which the mod-p representation is not surjective.",
    "created_at": "2010-05-25T21:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99470",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>Yes, the list should contain 2, all primes of additive reduction and all for which the mod-p representation is not surjective.



---

archive/issue_comments_099471.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-05-25T22:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99471",
    "user": "https://github.com/rlmill"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_099472.json:
```json
{
    "body": "<a id='comment:5'></a>The new patch gives doctest changes as well. Are you sure that this is correct (mod-p vs. p-adic rep'n surjective, etc.) for p=3? If it is, then it's all ready for review.",
    "created_at": "2010-05-25T22:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99472",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:5'></a>The new patch gives doctest changes as well. Are you sure that this is correct (mod-p vs. p-adic rep'n surjective, etc.) for p=3? If it is, then it's all ready for review.



---

archive/issue_comments_099473.json:
```json
{
    "body": "<a id='comment:6'></a>Ooops, you are right. Elkies describes these curves (they are rare) and shows that they do not contain SL_2(Z_p) in the p-adic Galois image. And that is needed for Kato's theorem 12.5. I have the vague feeling that one could lower it to the case of mod-p-surjectivity with some work, but I am sure it is not yet known if that is true.\n\nThat makes the check at 3 quite painful. Maybe we should just include 3 by default. I will look at the galois representations in sage soon again. Maybe I find an easy way to check it for p=3.\n\nChris.",
    "created_at": "2010-05-26T09:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99473",
    "user": "https://github.com/categorie"
}
```

<a id='comment:6'></a>Ooops, you are right. Elkies describes these curves (they are rare) and shows that they do not contain SL_2(Z_p) in the p-adic Galois image. And that is needed for Kato's theorem 12.5. I have the vague feeling that one could lower it to the case of mod-p-surjectivity with some work, but I am sure it is not yet known if that is true.

That makes the check at 3 quite painful. Maybe we should just include 3 by default. I will look at the galois representations in sage soon again. Maybe I find an easy way to check it for p=3.

Chris.



---

archive/issue_comments_099474.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [trac_9039.patch](tarball://root/attachments/some-uuid/ticket9039/trac_9039.patch) by @rlmill created at 2010-05-27 22:32:57\n\nChris,\n\nTake a look at the newest patch. This should provide a correct version of `bound_kato`.",
    "created_at": "2010-05-27T22:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99474",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:7'></a>Attachment [trac_9039.patch](tarball://root/attachments/some-uuid/ticket9039/trac_9039.patch) by @rlmill created at 2010-05-27 22:32:57

Chris,

Take a look at the newest patch. This should provide a correct version of `bound_kato`.



---

archive/issue_comments_099475.json:
```json
{
    "body": "<a id='comment:8'></a>All tests passed. This small but important change must go in !\nThanks, Robert.",
    "created_at": "2010-05-28T13:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99475",
    "user": "https://github.com/categorie"
}
```

<a id='comment:8'></a>All tests passed. This small but important change must go in !
Thanks, Robert.



---

archive/issue_comments_099476.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-05-28T13:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99476",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_099477.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Chris Wuthrich\"",
    "created_at": "2010-05-28T13:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99477",
    "user": "https://github.com/categorie"
}
```

Changing reviewer from "" to "Chris Wuthrich"



---

archive/issue_events_022128.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-04T15:28:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9039#event-22128"
}
```



---

archive/issue_comments_099478.json:
```json
{
    "body": "Changing merged from \"\" to \"4.4.3.rc0\"",
    "created_at": "2010-06-04T15:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99478",
    "user": "https://github.com/williamstein"
}
```

Changing merged from "" to "4.4.3.rc0"



---

archive/issue_comments_099479.json:
```json
{
    "body": "<a id='comment:9'></a>I'm merging this in, since Robert begged me to, and it's a 1-line fix I understand well, that has very, very low chance of causing any trouble elsewhere.",
    "created_at": "2010-06-04T15:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99479",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>I'm merging this in, since Robert begged me to, and it's a 1-line fix I understand well, that has very, very low chance of causing any trouble elsewhere.



---

archive/issue_comments_099480.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-06-04T15:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99480",
    "user": "https://github.com/williamstein"
}
```

Resolution: fixed



---

archive/issue_events_022129.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-04T15:28:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "milestone": "sage-4.4.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9039#event-22129"
}
```



---

archive/issue_comments_099481.json:
```json
{
    "body": "Changing merged from \"4.4.3.rc0\" to \"sage-4.4.3.rc0\"",
    "created_at": "2010-06-04T16:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9039#issuecomment-99481",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing merged from "4.4.3.rc0" to "sage-4.4.3.rc0"
