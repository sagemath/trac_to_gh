# Issue 9896: Upgrading from 4.5.3 to 4.6.alpha* can fail (not limited to MacOS X)

archive/issues_009895.json:
```json
{
    "assignees": [
        "https://github.com/nexttime"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nOn two separate machines running OS X 10.6, upgrading from 4.5.3 to 4.6.alpha0 seemed to work -- no errors were reported -- but Sage fails to start:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.6.alpha0, Release Date: 2010-09-10                  |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n  ***   bug in PARI/GP (Segmentation Fault), please report\n  ***   bug in PARI/GP (Segmentation Fault), please report\n```\n(Building from scratch works fine.)\n\n---\n\n## How to test:\n\n'''Upgrade path for testing the fixes:\nhttp://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''\n\nNote that **non-inplace upgrades** had been **broken in** Sage 4.6.**alpha3**, due to the inclusion of matplotlib 1.0.0 (#9221) into that version. To temporarily work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation to alpha3**:\n\n```sh\n$ rm spkg/installed/freetype-*\n```\n**This is not required for the rc0 upgrade path.**\n\nIf you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n\n```sh\n$ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed\n```\n(This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n\nDo the upgrade:\n\n```sh\n$ ./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/\n```\nNote that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)\n\n---\n\n## To the release manager / How to merge this ticket:\n* Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz\n* Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz\n* Apply https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz to the **Sage scripts repository** (Not mandatory, but helpful.)\n* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **Sage scripts repository**\n* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**\n* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz to the **Sage library repository**\n* Run `./sage -sdist ...`\n\n\nCC:  @JohnCremona @sagetrac-drkirkby @jdemeyer @nexttime @RalphieBoy @mwhansen\n\nComponent: **build**\n\nKeywords: **upgrade update dependencies PARI NewPARI**\n\nAuthor: **Leif Leonhardy**\n\nReviewer: **John Palmieri, Mitesh Patel**\n\nMerged: **sage-4.6.rc0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9896_\n\n",
    "closed_at": "2010-10-30T09:39:17Z",
    "created_at": "2010-09-11T06:04:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrading from 4.5.3 to 4.6.alpha* can fail (not limited to MacOS X)",
    "type": "issue",
    "updated_at": "2010-11-03T21:00:46Z",
    "url": "https://github.com/sagemath/sage/issues/9896",
    "user": "https://github.com/jhpalmieri"
}
```
<div id="comment:0"></div>

On two separate machines running OS X 10.6, upgrading from 4.5.3 to 4.6.alpha0 seemed to work -- no errors were reported -- but Sage fails to start:

```
----------------------------------------------------------------------
| Sage Version 4.6.alpha0, Release Date: 2010-09-10                  |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
  ***   bug in PARI/GP (Segmentation Fault), please report
  ***   bug in PARI/GP (Segmentation Fault), please report
```
(Building from scratch works fine.)

---

## How to test:

'''Upgrade path for testing the fixes:
http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''

Note that **non-inplace upgrades** had been **broken in** Sage 4.6.**alpha3**, due to the inclusion of matplotlib 1.0.0 (#9221) into that version. To temporarily work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation to alpha3**:

```sh
$ rm spkg/installed/freetype-*
```
**This is not required for the rc0 upgrade path.**

If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:

```sh
$ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed
```
(This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)

Do the upgrade:

```sh
$ ./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/
```
Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)

---

## To the release manager / How to merge this ticket:
* Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz
* Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz
* Apply https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz to the **Sage scripts repository** (Not mandatory, but helpful.)
* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **Sage scripts repository**
* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**
* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz to the **Sage library repository**
* Run `./sage -sdist ...`


CC:  @JohnCremona @sagetrac-drkirkby @jdemeyer @nexttime @RalphieBoy @mwhansen

Component: **build**

Keywords: **upgrade update dependencies PARI NewPARI**

Author: **Leif Leonhardy**

Reviewer: **John Palmieri, Mitesh Patel**

Merged: **sage-4.6.rc0**

_Issue created by migration from https://trac.sagemath.org/ticket/9896_





---

archive/issue_events_127341.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-11T06:04:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127341"
}
```



---

archive/issue_events_127342.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-11T06:04:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127342"
}
```



---

archive/issue_events_127343.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-11T06:04:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127343"
}
```



---

archive/issue_events_127344.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-09-11T06:04:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127344"
}
```



---

archive/issue_events_127345.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2010-09-11T06:04:41Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "subject": "https://github.com/jhpalmieri",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127345"
}
```



---

archive/issue_comments_088982.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nCan we somehow trace the PARI calls that lead to this?",
    "created_at": "2010-09-11T23:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88982",
    "user": "https://github.com/qed777"
}
```

<div id="comment:2" align="right">comment:2</div>

Can we somehow trace the PARI calls that lead to this?



---

archive/issue_comments_088983.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@qed777](#comment%3A2):\n> Can we somehow trace the PARI calls that lead to this?\n\nRunning `sage -gdb` could help, but on bsd.math, I get\n\n```\n[...]\nWe need authorization from an admin user to run the debugger.\nThis will only happen once per login session.\nAdmin username (mpatel): \n```",
    "created_at": "2010-09-12T00:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88983",
    "user": "https://github.com/qed777"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@qed777](#comment%3A2):
> Can we somehow trace the PARI calls that lead to this?

Running `sage -gdb` could help, but on bsd.math, I get

```
[...]
We need authorization from an admin user to run the debugger.
This will only happen once per login session.
Admin username (mpatel): 
```



---

archive/issue_comments_088984.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nMy problem is I don't know how to use gdb.  After running \"sage -gdb\", I see a ton of message like \n\n```\nReading symbols for shared libraries . done\n```\nand warnings like\n\n```\nwarning: Could not find object file \"/Applications/sage_builds/sage-4.5.3/spkg/build/gsl-1.14/src/.libs/libgsl.lax/libgslcdf.a/weibull.o\" - no debug information available for \"weibull.c\".\n```\nThen\n\n```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x0000000000000000\n0x000000010285aadc in err_leave ()\n(gdb) \n```\nNow what should I type to provide meaningful information?",
    "created_at": "2010-09-12T00:36:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88984",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

My problem is I don't know how to use gdb.  After running "sage -gdb", I see a ton of message like 

```
Reading symbols for shared libraries . done
```
and warnings like

```
warning: Could not find object file "/Applications/sage_builds/sage-4.5.3/spkg/build/gsl-1.14/src/.libs/libgsl.lax/libgslcdf.a/weibull.o" - no debug information available for "weibull.c".
```
Then

```
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0x0000000000000000
0x000000010285aadc in err_leave ()
(gdb) 
```
Now what should I type to provide meaningful information?



---

archive/issue_comments_088985.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhat happens if you type `bt` (for a backtrace)?  I'm not very familiar with GDB, but perhaps [comment:ticket:9583:5 this] or David can help?",
    "created_at": "2010-09-12T00:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88985",
    "user": "https://github.com/qed777"
}
```

<div id="comment:5" align="right">comment:5</div>

What happens if you type `bt` (for a backtrace)?  I'm not very familiar with GDB, but perhaps [comment:ticket:9583:5 this] or David can help?



---

archive/issue_comments_088986.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n`bt` (backtrace)?\n\nBtw, the segfault happens somewhere in `pari_init()`, because Sage afterwards disables PARI's signal handlers.",
    "created_at": "2010-09-12T00:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88986",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

`bt` (backtrace)?

Btw, the segfault happens somewhere in `pari_init()`, because Sage afterwards disables PARI's signal handlers.



---

archive/issue_comments_088987.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nPerhaps also first rebuild PARI with `CFLAGS=-fno-omit-frame-pointer`, and less optimization (`-O1` or `-O0`).",
    "created_at": "2010-09-12T01:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88987",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Perhaps also first rebuild PARI with `CFLAGS=-fno-omit-frame-pointer`, and less optimization (`-O1` or `-O0`).



---

archive/issue_comments_088988.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWell, I tried to rebuild PARI by setting CFLAGS=\"-fno-omit-frame-pointer -O0\" and then \"sage -f pari...\".  (I also tried running PARI's ./Configure with the \"-g\" debugging option, but it failed with\n\n```\nld: symbol(s) not found for inferred architecture x86_64\n```\nso I gave up on that.)  When I ran \"bt\", I got this:\n\n```\n\n(gdb) bt\n#0  0x000000010285aadc in err_leave ()\n#1  0x0000000102a72b5d in __pyx_pf_4sage_4libs_4pari_3gen_12PariInstance___init__ (__pyx_v_self=0x10211a4f0, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=0x101f573b0) at sage/libs/pari/gen.c:36951\n#2  0x000000010006d8c5 in type_call ()\n#3  0x000000010000bcd2 in PyObject_Call ()\n#4  0x0000000102a424fc in initgen () at sage/libs/pari/gen.c:46847\n#5  0x00000001000d2e11 in _PyImport_LoadDynamicModule ()\n#6  0x00000001000d10bf in import_submodule ()\n#7  0x00000001000d15da in load_next ()\n#8  0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#9  0x00000001000aeef3 in builtin___import__ ()\n#10 0x000000010000bcd2 in PyObject_Call ()\n#11 0x000000010000f825 in PyObject_CallFunction ()\n#12 0x00000001000d209b in PyImport_Import ()\n#13 0x000000010238cfeb in __Pyx_ImportModule [inlined] () at /Applications/sage_builds/sage-4.6.alpha0-upgrade/devel/sage-main/sage/rings/complex_double.c:15716\n#14 0x000000010238cfeb in __Pyx_ImportType (module_name=0x1023a8eb2 \"sage.libs.pari.gen\", class_name=0x1023a825b \"gen\", size=56, strict=1) at sage/rings/complex_double.c:15660\n#15 0x00000001023a3463 in initcomplex_double () at sage/rings/complex_double.c:14241\n#16 0x00000001000d2e11 in _PyImport_LoadDynamicModule ()\n#17 0x00000001000d10bf in import_submodule ()\n#18 0x00000001000d15da in load_next ()\n#19 0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#20 0x00000001000aeef3 in builtin___import__ ()\n#21 0x000000010000bcd2 in PyObject_Call ()\n#22 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#23 0x00000001000b440e in PyEval_EvalFrameEx ()\n#24 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#25 0x00000001000b90f6 in PyEval_EvalCode ()\n#26 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#27 0x00000001000cf212 in load_source_module ()\n#28 0x00000001000d10bf in import_submodule ()\n#29 0x00000001000d15da in load_next ()\n#30 0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#31 0x00000001000aeef3 in builtin___import__ ()\n#32 0x000000010000bcd2 in PyObject_Call ()\n#33 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#34 0x00000001000b440e in PyEval_EvalFrameEx ()\n#35 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#36 0x00000001000b90f6 in PyEval_EvalCode ()\n#37 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#38 0x00000001000cf212 in load_source_module ()\n#39 0x00000001000d10bf in import_submodule ()\n#40 0x00000001000d15da in load_next ()\n#41 0x00000001000d18ec in PyImport_ImportModuleLevel ()\n#42 0x00000001000aeef3 in builtin___import__ ()\n#43 0x000000010000bcd2 in PyObject_Call ()\n#44 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#45 0x00000001000b440e in PyEval_EvalFrameEx ()\n#46 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#47 0x00000001000b90f6 in PyEval_EvalCode ()\n#48 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#49 0x00000001000cf212 in load_source_module ()\n#50 0x00000001000d10bf in import_submodule ()\n#51 0x00000001000d15da in load_next ()\n#52 0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#53 0x00000001000aeef3 in builtin___import__ ()\n#54 0x000000010000bcd2 in PyObject_Call ()\n#55 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#56 0x00000001000b440e in PyEval_EvalFrameEx ()\n#57 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#58 0x00000001000b90f6 in PyEval_EvalCode ()\n#59 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#60 0x00000001000cf212 in load_source_module ()\n#61 0x00000001000d10bf in import_submodule ()\n#62 0x00000001000d15da in load_next ()\n#63 0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#64 0x00000001000aeef3 in builtin___import__ ()\n#65 0x000000010000bcd2 in PyObject_Call ()\n#66 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#67 0x00000001000b440e in PyEval_EvalFrameEx ()\n#68 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#69 0x00000001000b90f6 in PyEval_EvalCode ()\n#70 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#71 0x00000001000cf212 in load_source_module ()\n#72 0x00000001000d10bf in import_submodule ()\n#73 0x00000001000d15da in load_next ()\n#74 0x00000001000d1932 in PyImport_ImportModuleLevel ()\n#75 0x00000001000aeef3 in builtin___import__ ()\n#76 0x000000010000bcd2 in PyObject_Call ()\n#77 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#78 0x00000001000b440e in PyEval_EvalFrameEx ()\n#79 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#80 0x00000001000b90f6 in PyEval_EvalCode ()\n#81 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()\n#82 0x00000001000cf212 in load_source_module ()\n#83 0x00000001000d10bf in import_submodule ()\n#84 0x00000001000d15da in load_next ()\n#85 0x00000001000d18ec in PyImport_ImportModuleLevel ()\n#86 0x00000001000aeef3 in builtin___import__ ()\n#87 0x00000001000b82b8 in PyEval_EvalFrameEx ()\n#88 0x00000001000b745a in PyEval_EvalFrameEx ()\n#89 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#90 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#91 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#92 0x000000010003b0ad in function_call ()\n#93 0x000000010000bcd2 in PyObject_Call ()\n#94 0x000000010001dd0d in instancemethod_call ()\n#95 0x000000010000bcd2 in PyObject_Call ()\n#96 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()\n#97 0x0000000100020d0e in PyInstance_New ()\n#98 0x000000010000bcd2 in PyObject_Call ()\n#99 0x00000001000b457e in PyEval_EvalFrameEx ()\n#100 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#101 0x00000001000b6ffd in PyEval_EvalFrameEx ()\n#102 0x00000001000b9010 in PyEval_EvalCodeEx ()\n#103 0x00000001000b90f6 in PyEval_EvalCode ()\n#104 0x00000001000dde0e in PyRun_FileExFlags ()\n#105 0x00000001000de0c9 in PyRun_SimpleFileExFlags ()\n#106 0x00000001000eb5eb in Py_Main ()\n#107 0x0000000100000f14 in start ()\n```",
    "created_at": "2010-09-12T01:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88988",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Well, I tried to rebuild PARI by setting CFLAGS="-fno-omit-frame-pointer -O0" and then "sage -f pari...".  (I also tried running PARI's ./Configure with the "-g" debugging option, but it failed with

```
ld: symbol(s) not found for inferred architecture x86_64
```
so I gave up on that.)  When I ran "bt", I got this:

```

(gdb) bt
#0  0x000000010285aadc in err_leave ()
#1  0x0000000102a72b5d in __pyx_pf_4sage_4libs_4pari_3gen_12PariInstance___init__ (__pyx_v_self=0x10211a4f0, __pyx_args=<value temporarily unavailable, due to optimizations>, __pyx_kwds=0x101f573b0) at sage/libs/pari/gen.c:36951
#2  0x000000010006d8c5 in type_call ()
#3  0x000000010000bcd2 in PyObject_Call ()
#4  0x0000000102a424fc in initgen () at sage/libs/pari/gen.c:46847
#5  0x00000001000d2e11 in _PyImport_LoadDynamicModule ()
#6  0x00000001000d10bf in import_submodule ()
#7  0x00000001000d15da in load_next ()
#8  0x00000001000d1932 in PyImport_ImportModuleLevel ()
#9  0x00000001000aeef3 in builtin___import__ ()
#10 0x000000010000bcd2 in PyObject_Call ()
#11 0x000000010000f825 in PyObject_CallFunction ()
#12 0x00000001000d209b in PyImport_Import ()
#13 0x000000010238cfeb in __Pyx_ImportModule [inlined] () at /Applications/sage_builds/sage-4.6.alpha0-upgrade/devel/sage-main/sage/rings/complex_double.c:15716
#14 0x000000010238cfeb in __Pyx_ImportType (module_name=0x1023a8eb2 "sage.libs.pari.gen", class_name=0x1023a825b "gen", size=56, strict=1) at sage/rings/complex_double.c:15660
#15 0x00000001023a3463 in initcomplex_double () at sage/rings/complex_double.c:14241
#16 0x00000001000d2e11 in _PyImport_LoadDynamicModule ()
#17 0x00000001000d10bf in import_submodule ()
#18 0x00000001000d15da in load_next ()
#19 0x00000001000d1932 in PyImport_ImportModuleLevel ()
#20 0x00000001000aeef3 in builtin___import__ ()
#21 0x000000010000bcd2 in PyObject_Call ()
#22 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#23 0x00000001000b440e in PyEval_EvalFrameEx ()
#24 0x00000001000b9010 in PyEval_EvalCodeEx ()
#25 0x00000001000b90f6 in PyEval_EvalCode ()
#26 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#27 0x00000001000cf212 in load_source_module ()
#28 0x00000001000d10bf in import_submodule ()
#29 0x00000001000d15da in load_next ()
#30 0x00000001000d1932 in PyImport_ImportModuleLevel ()
#31 0x00000001000aeef3 in builtin___import__ ()
#32 0x000000010000bcd2 in PyObject_Call ()
#33 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#34 0x00000001000b440e in PyEval_EvalFrameEx ()
#35 0x00000001000b9010 in PyEval_EvalCodeEx ()
#36 0x00000001000b90f6 in PyEval_EvalCode ()
#37 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#38 0x00000001000cf212 in load_source_module ()
#39 0x00000001000d10bf in import_submodule ()
#40 0x00000001000d15da in load_next ()
#41 0x00000001000d18ec in PyImport_ImportModuleLevel ()
#42 0x00000001000aeef3 in builtin___import__ ()
#43 0x000000010000bcd2 in PyObject_Call ()
#44 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#45 0x00000001000b440e in PyEval_EvalFrameEx ()
#46 0x00000001000b9010 in PyEval_EvalCodeEx ()
#47 0x00000001000b90f6 in PyEval_EvalCode ()
#48 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#49 0x00000001000cf212 in load_source_module ()
#50 0x00000001000d10bf in import_submodule ()
#51 0x00000001000d15da in load_next ()
#52 0x00000001000d1932 in PyImport_ImportModuleLevel ()
#53 0x00000001000aeef3 in builtin___import__ ()
#54 0x000000010000bcd2 in PyObject_Call ()
#55 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#56 0x00000001000b440e in PyEval_EvalFrameEx ()
#57 0x00000001000b9010 in PyEval_EvalCodeEx ()
#58 0x00000001000b90f6 in PyEval_EvalCode ()
#59 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#60 0x00000001000cf212 in load_source_module ()
#61 0x00000001000d10bf in import_submodule ()
#62 0x00000001000d15da in load_next ()
#63 0x00000001000d1932 in PyImport_ImportModuleLevel ()
#64 0x00000001000aeef3 in builtin___import__ ()
#65 0x000000010000bcd2 in PyObject_Call ()
#66 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#67 0x00000001000b440e in PyEval_EvalFrameEx ()
#68 0x00000001000b9010 in PyEval_EvalCodeEx ()
#69 0x00000001000b90f6 in PyEval_EvalCode ()
#70 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#71 0x00000001000cf212 in load_source_module ()
#72 0x00000001000d10bf in import_submodule ()
#73 0x00000001000d15da in load_next ()
#74 0x00000001000d1932 in PyImport_ImportModuleLevel ()
#75 0x00000001000aeef3 in builtin___import__ ()
#76 0x000000010000bcd2 in PyObject_Call ()
#77 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#78 0x00000001000b440e in PyEval_EvalFrameEx ()
#79 0x00000001000b9010 in PyEval_EvalCodeEx ()
#80 0x00000001000b90f6 in PyEval_EvalCode ()
#81 0x00000001000cdfb0 in PyImport_ExecCodeModuleEx ()
#82 0x00000001000cf212 in load_source_module ()
#83 0x00000001000d10bf in import_submodule ()
#84 0x00000001000d15da in load_next ()
#85 0x00000001000d18ec in PyImport_ImportModuleLevel ()
#86 0x00000001000aeef3 in builtin___import__ ()
#87 0x00000001000b82b8 in PyEval_EvalFrameEx ()
#88 0x00000001000b745a in PyEval_EvalFrameEx ()
#89 0x00000001000b9010 in PyEval_EvalCodeEx ()
#90 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#91 0x00000001000b9010 in PyEval_EvalCodeEx ()
#92 0x000000010003b0ad in function_call ()
#93 0x000000010000bcd2 in PyObject_Call ()
#94 0x000000010001dd0d in instancemethod_call ()
#95 0x000000010000bcd2 in PyObject_Call ()
#96 0x00000001000b0147 in PyEval_CallObjectWithKeywords ()
#97 0x0000000100020d0e in PyInstance_New ()
#98 0x000000010000bcd2 in PyObject_Call ()
#99 0x00000001000b457e in PyEval_EvalFrameEx ()
#100 0x00000001000b9010 in PyEval_EvalCodeEx ()
#101 0x00000001000b6ffd in PyEval_EvalFrameEx ()
#102 0x00000001000b9010 in PyEval_EvalCodeEx ()
#103 0x00000001000b90f6 in PyEval_EvalCode ()
#104 0x00000001000dde0e in PyRun_FileExFlags ()
#105 0x00000001000de0c9 in PyRun_SimpleFileExFlags ()
#106 0x00000001000eb5eb in Py_Main ()
#107 0x0000000100000f14 in start ()
```



---

archive/issue_comments_088989.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nJohn, can you provide a link to the full PARI spkg install log?\n\nI also wonder if somehow PARI uses parts of its old installation (in `$SAGE_LOCAL/{lib,include/pari}/`) during the build (which one would not necessarily see in the log though). It would be safer to delete all these files prior to upgrading...\n\nDoes the stand-alone interpreter work?",
    "created_at": "2010-09-12T02:05:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88989",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

John, can you provide a link to the full PARI spkg install log?

I also wonder if somehow PARI uses parts of its old installation (in `$SAGE_LOCAL/{lib,include/pari}/`) during the build (which one would not necessarily see in the log though). It would be safer to delete all these files prior to upgrading...

Does the stand-alone interpreter work?



---

archive/issue_comments_088990.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI found the problem, I think, thanks to one of your questions on [sage-release](http://groups.google.com/group/sage-release/browse_frm/thread/57d92da34ef89e69): in local/lib, I have\n\n```\n  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 18:39 libpari-gmp-2.4.dylib\n  -rwxr-xr-x    1 palmieri  admin   3487624 Sep  8 21:53 libpari-gmp.dylib\n  -rw-r--r--    1 palmieri  admin  21398976 Sep 11 18:39 libpari.a\n  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 18:39 libpari.dylib\n```\nNote the time-stamp on the file libpari-gmp.dylib: this is from the old PARI installation.  If I get rid of this file and then link libpari-gmp-2.4.dylib to libpari-gmp.dylib, then Sage starts with no trouble.  If I just delete the file, then Sage complains\n\n```\nImportError: dlopen(/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so, 2): Library not loaded: libpari-gmp.dylib\n```\nI also get the complaint after running \"sage -ba\".  I don't see anything in the PARI install log about libpari-gmp.dylib, just libpari-gmp-2.4.dylib, so I'm a little confused about whether this link should be here.  Two things I might try next: running tests with the link, or deleting the old dylib file and then running \"sage -upgrade ...\" to see if that helps.",
    "created_at": "2010-09-12T02:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88990",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

I found the problem, I think, thanks to one of your questions on [sage-release](http://groups.google.com/group/sage-release/browse_frm/thread/57d92da34ef89e69): in local/lib, I have

```
  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 18:39 libpari-gmp-2.4.dylib
  -rwxr-xr-x    1 palmieri  admin   3487624 Sep  8 21:53 libpari-gmp.dylib
  -rw-r--r--    1 palmieri  admin  21398976 Sep 11 18:39 libpari.a
  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 18:39 libpari.dylib
```
Note the time-stamp on the file libpari-gmp.dylib: this is from the old PARI installation.  If I get rid of this file and then link libpari-gmp-2.4.dylib to libpari-gmp.dylib, then Sage starts with no trouble.  If I just delete the file, then Sage complains

```
ImportError: dlopen(/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so, 2): Library not loaded: libpari-gmp.dylib
```
I also get the complaint after running "sage -ba".  I don't see anything in the PARI install log about libpari-gmp.dylib, just libpari-gmp-2.4.dylib, so I'm a little confused about whether this link should be here.  Two things I might try next: running tests with the link, or deleting the old dylib file and then running "sage -upgrade ..." to see if that helps.



---

archive/issue_comments_088991.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.",
    "created_at": "2010-09-12T02:26:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88991",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

The time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.



---

archive/issue_comments_088992.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSome part in John's build must have been linked against `libpari.*` when this still was a copy of / symbolic link to the old `libpari-gmp.*`, s.t. the old soname got recorded, and all PARI symbols were resolved from there before `libpari-gmp-2.4.*` was considered.\n\n`libcsage.*` is IMHO a good candidate... Did this really get updated in `local/lib`, i.e. got `devel/sage/c_lib/libcsage.*` rebuilt?",
    "created_at": "2010-09-12T04:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88992",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Some part in John's build must have been linked against `libpari.*` when this still was a copy of / symbolic link to the old `libpari-gmp.*`, s.t. the old soname got recorded, and all PARI symbols were resolved from there before `libpari-gmp-2.4.*` was considered.

`libcsage.*` is IMHO a good candidate... Did this really get updated in `local/lib`, i.e. got `devel/sage/c_lib/libcsage.*` rebuilt?



---

archive/issue_comments_088993.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> Two things I might try next: running tests with the link, or deleting the old dylib file and then running \"sage -upgrade ...\" to see if that helps.\n\nI did these on two different machines.  With the link, all tests passed.  Deleting the old dylib file (and the old include files, just for kicks) and then upgrading caused problems: `ImportError` as above.\n\n> libcsage.* is IMHO a good candidate... Did this really get updated in local/lib, i.e. got devel/sage/c_lib/libcsage.* rebuilt?\n\nYes, it did.  After taking a clean 4.5.3 install and upgrading, here are the recent files in local/lib:\n\n```\n  lrwxr-xr-x    1 palmieri  admin        37 Sep 11 21:32 libcsage.dylib -> ../../devel/sage/c_lib/libcsage.dylib\n  -rwxr-xr-x    1 palmieri  admin     77488 Sep 11 21:32 libLfunction.so\n  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 21:31 libpari-gmp-2.4.dylib\n  -rw-r--r--    1 palmieri  admin  21398976 Sep 11 21:31 libpari.a\n  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 21:31 libpari.dylib\n```\nHere is the file to which libcsage.dylib links:\n\n```\n  -rwxr-xr-x   1 palmieri  admin    83864 Sep 11 21:32 libcsage.dylib\n```\nThe rest of the libraries in local/lib are old enough that they must have come from 4.5.3.",
    "created_at": "2010-09-12T04:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88993",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

> Two things I might try next: running tests with the link, or deleting the old dylib file and then running "sage -upgrade ..." to see if that helps.

I did these on two different machines.  With the link, all tests passed.  Deleting the old dylib file (and the old include files, just for kicks) and then upgrading caused problems: `ImportError` as above.

> libcsage.* is IMHO a good candidate... Did this really get updated in local/lib, i.e. got devel/sage/c_lib/libcsage.* rebuilt?

Yes, it did.  After taking a clean 4.5.3 install and upgrading, here are the recent files in local/lib:

```
  lrwxr-xr-x    1 palmieri  admin        37 Sep 11 21:32 libcsage.dylib -> ../../devel/sage/c_lib/libcsage.dylib
  -rwxr-xr-x    1 palmieri  admin     77488 Sep 11 21:32 libLfunction.so
  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 21:31 libpari-gmp-2.4.dylib
  -rw-r--r--    1 palmieri  admin  21398976 Sep 11 21:31 libpari.a
  -rwxr-xr-x    1 palmieri  admin   5249848 Sep 11 21:31 libpari.dylib
```
Here is the file to which libcsage.dylib links:

```
  -rwxr-xr-x   1 palmieri  admin    83864 Sep 11 21:32 libcsage.dylib
```
The rest of the libraries in local/lib are old enough that they must have come from 4.5.3.



---

archive/issue_comments_088994.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nJustin reported successful upgrade from 4.5.3 on MacOS X 10.**5.8** on sage-release, though some doctests fail.",
    "created_at": "2010-09-13T11:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88994",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

Justin reported successful upgrade from 4.5.3 on MacOS X 10.**5.8** on sage-release, though some doctests fail.



---

archive/issue_comments_088995.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@nexttime](#comment%3A14):\n> Justin reported successful upgrade from 4.5.3 on MacOS X 10.**5.8** on sage-release, though some doctests fail.\n\n(... due to `eclib` not getting rebuilt.)",
    "created_at": "2010-09-13T12:27:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88995",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@nexttime](#comment%3A14):
> Justin reported successful upgrade from 4.5.3 on MacOS X 10.**5.8** on sage-release, though some doctests fail.

(... due to `eclib` not getting rebuilt.)



---

archive/issue_comments_088996.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nNecessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:\n* Build Sage 4.5.3 from scratch ;-)\n* Run `./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.alpha0/sage-4.6.alpha0/` \n\n (Unfortunately, modifying `spkg/standard/deps` before doing so doesn't help since this file gets overwritten during upgrade.)\n* Run `./sage -f eclib-20100711` (just to record the **new** PARI shared library name in its various shared libraries).\n* Touch the Sage library files that have to be rebuilt for the same reason:\n\n   ```sh\n   touch devel/sage/sage/libs/cremona/homspace.pyx \n   touch devel/sage/sage/libs/cremona/newforms.pyx \n   touch devel/sage/sage/libs/mwrank/mwrank.pyx \n```\n   (Three command invocations just to make it readable without horizontal scrolling.)\n* Run `./sage -b` to rebuild them (i.e., their respective Python modules / shared libraries).\n\nDeleting the old PARI shared library files (`local/lib/libpari-gmp.*`) is not necessary, but will trigger Sage import errors if you omit one of the above steps... (unless you have a system-wide PARI library installed which matches the old version, i.e. 2.3.*)",
    "created_at": "2010-09-14T18:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88996",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">comment:16</div>

Necessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:
* Build Sage 4.5.3 from scratch ;-)
* Run `./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.alpha0/sage-4.6.alpha0/` 

 (Unfortunately, modifying `spkg/standard/deps` before doing so doesn't help since this file gets overwritten during upgrade.)
* Run `./sage -f eclib-20100711` (just to record the **new** PARI shared library name in its various shared libraries).
* Touch the Sage library files that have to be rebuilt for the same reason:

   ```sh
   touch devel/sage/sage/libs/cremona/homspace.pyx 
   touch devel/sage/sage/libs/cremona/newforms.pyx 
   touch devel/sage/sage/libs/mwrank/mwrank.pyx 
```
   (Three command invocations just to make it readable without horizontal scrolling.)
* Run `./sage -b` to rebuild them (i.e., their respective Python modules / shared libraries).

Deleting the old PARI shared library files (`local/lib/libpari-gmp.*`) is not necessary, but will trigger Sage import errors if you omit one of the above steps... (unless you have a system-wide PARI library installed which matches the old version, i.e. 2.3.*)



---

archive/issue_comments_088997.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n> Necessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:\n\nThis didn't work for me; I get the same segmentation fault message.  (I think that when I tried \"sage -ba\" before, that would have rebuilt the files from all the pyx files, so I guess it's not a surprise that this failed.)",
    "created_at": "2010-09-14T20:02:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88997",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

> Necessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:

This didn't work for me; I get the same segmentation fault message.  (I think that when I tried "sage -ba" before, that would have rebuilt the files from all the pyx files, so I guess it's not a surprise that this failed.)



---

archive/issue_comments_088998.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI consider the \"`touch` issue\" a bug in `module_list.py`, since PARI is not directly used by those extension modules (but listed in their `libraries`, and therefore gets recorded in the list of needed libraries).\n\nExplicitly linking against PARI would then only be necessary if we built some *statically* linked executable. Or is this also required on some systems like Cygwin? If so, we should make use of `uname_specific()` there, too.",
    "created_at": "2010-09-14T20:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88998",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">comment:18</div>

I consider the "`touch` issue" a bug in `module_list.py`, since PARI is not directly used by those extension modules (but listed in their `libraries`, and therefore gets recorded in the list of needed libraries).

Explicitly linking against PARI would then only be necessary if we built some *statically* linked executable. Or is this also required on some systems like Cygwin? If so, we should make use of `uname_specific()` there, too.



---

archive/issue_events_127346.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-14T20:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127346"
}
```



---

archive/issue_comments_088999.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment%3A17):\n> > Necessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:\n> \n> \n> This didn't work for me; I get the same segmentation fault message.  (I think that when I tried \"sage -ba\" before, that would have rebuilt the files from all the pyx files, so I guess it's not a surprise that this failed.)\n\nMust be some bad environment... ;-)\n\nDoes `gp` work (after upgrading)?",
    "created_at": "2010-09-14T20:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-88999",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment%3A17):
> > Necessary steps to properly upgrade (from Sage 4.5.3) to Sage 4.6.alpha0:
> 
> 
> This didn't work for me; I get the same segmentation fault message.  (I think that when I tried "sage -ba" before, that would have rebuilt the files from all the pyx files, so I guess it's not a surprise that this failed.)

Must be some bad environment... ;-)

Does `gp` work (after upgrading)?



---

archive/issue_comments_089000.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n> Does gp work (after upgrading)?\n\n`./sage -gp` starts up and can execute simple calculations.  No segfault.",
    "created_at": "2010-09-14T20:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89000",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

> Does gp work (after upgrading)?

`./sage -gp` starts up and can execute simple calculations.  No segfault.



---

archive/issue_comments_089001.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAnd what import errors do you now get after deleting the old PARI's dylibs (`libpari-gmp.*`)?",
    "created_at": "2010-09-14T20:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89001",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

And what import errors do you now get after deleting the old PARI's dylibs (`libpari-gmp.*`)?



---

archive/issue_comments_089002.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nFor me (Ubuntu 10.04 x86_64), upgrading with the above steps passes `ptestlong` with the original `module_list.py`, and also after deleting `\"pari\"` from the library lists of the mentioned extension modules, then again touching the `.pyx` files and running `./sage -b`.",
    "created_at": "2010-09-14T20:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89002",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:22" align="right">comment:22</div>

For me (Ubuntu 10.04 x86_64), upgrading with the above steps passes `ptestlong` with the original `module_list.py`, and also after deleting `"pari"` from the library lists of the mentioned extension modules, then again touching the `.pyx` files and running `./sage -b`.



---

archive/issue_comments_089003.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAfter going through the above steps, if I also delete the old libpari-gmp, then I get\n\n```\nImportError: dlopen(/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so, 2): Library not loaded: libpari-gmp.dylib\n  Referenced from: /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so\n  Reason: image not found\n```\nIf I touch complex_double.pyx and \"sage -b\", there is no change.  Touching all of the py, pyx, and pxd files in the libs/pari directory also triggers a rebuild of complex_double.pyx, and also doesn't help.",
    "created_at": "2010-09-14T21:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89003",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

After going through the above steps, if I also delete the old libpari-gmp, then I get

```
ImportError: dlopen(/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so, 2): Library not loaded: libpari-gmp.dylib
  Referenced from: /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings/complex_double.so
  Reason: image not found
```
If I touch complex_double.pyx and "sage -b", there is no change.  Touching all of the py, pyx, and pxd files in the libs/pari directory also triggers a rebuild of complex_double.pyx, and also doesn't help.



---

archive/issue_comments_089004.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAnd the files in `.../local/lib/python2.6/site-packages/...` got properly updated?!?\n\nCan you attach a log of the `./sage -b` run?\n\nThe only (other) thing I could imagine is some old PARI library in the linker/loader search path *during linking*, but not at run-time (i.e. dynamic loader search path). (Really) Environment issue?",
    "created_at": "2010-09-14T21:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89004",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

And the files in `.../local/lib/python2.6/site-packages/...` got properly updated?!?

Can you attach a log of the `./sage -b` run?

The only (other) thing I could imagine is some old PARI library in the linker/loader search path *during linking*, but not at run-time (i.e. dynamic loader search path). (Really) Environment issue?



---

archive/issue_comments_089005.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@nexttime](#comment%3A24):\n> And the files in `.../local/lib/python2.6/site-packages/...` got properly updated?!?\n\nAccording to the time stamps, yes.\n\n> Can you attach a log of the `./sage -b` run?\n\nWhich one?  Here's what happens if I follow your instructions, delete libpari-gmp.dylib, and touch complex_double.pyx:\n\n```\n$ ./sage -b\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nBuilding modified file sage/rings/complex_double.pyx.\nExecute 1 commands (using 1 threads)\npython `which cython` --embed-positions --directive cdivision=True -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/devel/sage-main -o sage/rings/complex_double.c sage/rings/complex_double.pyx\nsage/rings/complex_double.pyx --> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib/python/site-packages//sage/rings/complex_double.pyx\nTime to execute 1 commands: 4.32504701614 seconds\nFinished compiling Cython code (time = 4.87559199333 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.rings.complex_double' extension\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//include -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//include/csage -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/devel//sage/sage/ext -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/include/python2.6 -c sage/rings/complex_double.c -o build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -std=c99 -D_XPG6 -w\ngcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so\nTotal time spent compiling C/C++ extensions:  7.72538805008 seconds.\nrunning install_lib\ncopying build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so -> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings\nrunning install_egg_info\nRemoving /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info\nWriting /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info\n\nreal\t0m13.963s\nuser\t0m12.678s\nsys\t0m1.095s\n```\n\n> The only (other) thing I could imagine is some old PARI library in the linker/loader search path *during linking*, but not at run-time (i.e. dynamic loader search path). (Really) Environment issue?\n\nWell, I see it on two different machines. I don't have LD_LIBRARY_PATH or DYLD_LIBRARY_PATH set, and when I run \"./sage -sh\", I don't see anything odd in those variables.  I've posted what I get from \"export\" ordinarily and also after running \"./sage -sh\" at [http://sage.math.washington.edu/home/palmieri/misc/env.txt](http://sage.math.washington.edu/home/palmieri/misc/env.txt).  I'm going to try this all on bsd.math, which involves building sage 4.5.3 first, so it will take a while.  I've hardly used that machine, so my environment there is pretty vanilla.",
    "created_at": "2010-09-14T22:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89005",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@nexttime](#comment%3A24):
> And the files in `.../local/lib/python2.6/site-packages/...` got properly updated?!?

According to the time stamps, yes.

> Can you attach a log of the `./sage -b` run?

Which one?  Here's what happens if I follow your instructions, delete libpari-gmp.dylib, and touch complex_double.pyx:

```
$ ./sage -b

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Building modified file sage/rings/complex_double.pyx.
Execute 1 commands (using 1 threads)
python `which cython` --embed-positions --directive cdivision=True -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/devel/sage-main -o sage/rings/complex_double.c sage/rings/complex_double.pyx
sage/rings/complex_double.pyx --> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib/python/site-packages//sage/rings/complex_double.pyx
Time to execute 1 commands: 4.32504701614 seconds
Finished compiling Cython code (time = 4.87559199333 seconds)
running install
running build
running build_py
running build_ext
building 'sage.rings.complex_double' extension
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//include -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//include/csage -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/devel//sage/sage/ext -I/Applications/sage_builds/sage-4.6.alpha0-upgrade/local/include/python2.6 -c sage/rings/complex_double.c -o build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -std=c99 -D_XPG6 -w
gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so
Total time spent compiling C/C++ extensions:  7.72538805008 seconds.
running install_lib
copying build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so -> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings
running install_egg_info
Removing /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info
Writing /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info

real	0m13.963s
user	0m12.678s
sys	0m1.095s
```

> The only (other) thing I could imagine is some old PARI library in the linker/loader search path *during linking*, but not at run-time (i.e. dynamic loader search path). (Really) Environment issue?

Well, I see it on two different machines. I don't have LD_LIBRARY_PATH or DYLD_LIBRARY_PATH set, and when I run "./sage -sh", I don't see anything odd in those variables.  I've posted what I get from "export" ordinarily and also after running "./sage -sh" at [http://sage.math.washington.edu/home/palmieri/misc/env.txt](http://sage.math.washington.edu/home/palmieri/misc/env.txt).  I'm going to try this all on bsd.math, which involves building sage 4.5.3 first, so it will take a while.  I've hardly used that machine, so my environment there is pretty vanilla.



---

archive/issue_comments_089006.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n\n```\ngcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined\n dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o\n -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage\n -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o\n build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so\n```\n\nThat's what I was thinking of. Looks as if the linker also (first!) searches the old lib dir.\n\nYou renamed the directory of the upgrade / copied the Sage tree to a new directory...\n\nCould you temporarily rename the 4.5.3 directory and rerun `./sage -b` (after again touching Cython files)?\n\n(I assume `/Applications/sage_builds/sage-4.5.3` still exists.)",
    "created_at": "2010-09-14T22:50:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89006",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">comment:26</div>


```
gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined
 dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o
 -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage
 -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o
 build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so
```

That's what I was thinking of. Looks as if the linker also (first!) searches the old lib dir.

You renamed the directory of the upgrade / copied the Sage tree to a new directory...

Could you temporarily rename the 4.5.3 directory and rerun `./sage -b` (after again touching Cython files)?

(I assume `/Applications/sage_builds/sage-4.5.3` still exists.)



---

archive/issue_comments_089007.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@nexttime](#comment%3A26):\n> You renamed the directory of the upgrade / copied the Sage tree to a new directory...\n\nYes, I copied it.  I always do this so if the upgrade screws up, I still have a working copy of Sage.\n \n> Could you temporarily rename the 4.5.3 directory and rerun `./sage -b` (after again touching Cython files)?\n\nOkay, I did that.  Here's part of the log from \"./sage -b\".  Note the warning, since I renamed the directory:\n\n```\ngcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so\nld: warning: directory '/Applications/sage_builds/sage-4.5.3/local/lib' following -L not found\nTotal time spent compiling C/C++ extensions:  9.04102396965 seconds.\nrunning install_lib\ncopying build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so -> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings\nrunning install_egg_info\nRemoving /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info\nWriting /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info\n```\nI still get the import error, unfortunately.",
    "created_at": "2010-09-14T23:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89007",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@nexttime](#comment%3A26):
> You renamed the directory of the upgrade / copied the Sage tree to a new directory...

Yes, I copied it.  I always do this so if the upgrade screws up, I still have a working copy of Sage.
 
> Could you temporarily rename the 4.5.3 directory and rerun `./sage -b` (after again touching Cython files)?

Okay, I did that.  Here's part of the log from "./sage -b".  Note the warning, since I renamed the directory:

```
gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup build/temp.macosx-10.6-i386-2.6/sage/rings/complex_double.o -L/Applications/sage_builds/sage-4.6.alpha0-upgrade/local//lib -lcsage -lgsl -lcblas -latlas -lpari -lgmp -lm -lstdc++ -lntl -o build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so
ld: warning: directory '/Applications/sage_builds/sage-4.5.3/local/lib' following -L not found
Total time spent compiling C/C++ extensions:  9.04102396965 seconds.
running install_lib
copying build/lib.macosx-10.6-i386-2.6/sage/rings/complex_double.so -> /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage/rings
running install_egg_info
Removing /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info
Writing /Applications/sage_builds/sage-4.6.alpha0-upgrade/local/lib/python2.6/site-packages/sage-0.0.0-py2.6.egg-info
```
I still get the import error, unfortunately.



---

archive/issue_comments_089008.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jhpalmieri](#comment%3A27):\n> I still get the import error, unfortunately.\n\nHopefully now from a different import?",
    "created_at": "2010-09-14T23:13:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89008",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jhpalmieri](#comment%3A27):
> I still get the import error, unfortunately.

Hopefully now from a different import?



---

archive/issue_comments_089009.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAh, if I touch libs/pari/gen.pxd and then do \"./sage -b\", it starts without an error.  That seems to clear up all of the dependencies.",
    "created_at": "2010-09-14T23:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89009",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

Ah, if I touch libs/pari/gen.pxd and then do "./sage -b", it starts without an error.  That seems to clear up all of the dependencies.



---

archive/issue_comments_089010.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSo I think I need to delete the old libpari-gmp library, move the old Sage directory, touch \n\n- devel/sage/sage/libs/cremona/homspace.pyx \n- devel/sage/sage/libs/cremona/newforms.pyx \n- devel/sage/sage/libs/mwrank/mwrank.pyx \n- devel/sage/sage/libs/pari/gen.pxd\n\nand then run \"./sage -b\".  Simple.",
    "created_at": "2010-09-14T23:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89010",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

So I think I need to delete the old libpari-gmp library, move the old Sage directory, touch 

- devel/sage/sage/libs/cremona/homspace.pyx 
- devel/sage/sage/libs/cremona/newforms.pyx 
- devel/sage/sage/libs/mwrank/mwrank.pyx 
- devel/sage/sage/libs/pari/gen.pxd

and then run "./sage -b".  Simple.



---

archive/issue_comments_089011.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI still hate trac...\n\nHmmm, the preprocessor supports `-I-`, unfortunately the linker not `-L-`, so we have to modify the dumb Python default compiler settings to get rid of obsolete directories...",
    "created_at": "2010-09-14T23:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89011",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:31" align="right">comment:31</div>

I still hate trac...

Hmmm, the preprocessor supports `-I-`, unfortunately the linker not `-L-`, so we have to modify the dumb Python default compiler settings to get rid of obsolete directories...



---

archive/issue_comments_089012.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jhpalmieri](#comment%3A30):\n> So I think I need to delete the old libpari-gmp library, move the old Sage directory, touch \n>  ...\n> - devel/sage/sage/libs/pari/gen.pxd\n\nThe latter shouldn't be necessary.\n\n \n> Simple.\n\n;-) How many users will agree on that?",
    "created_at": "2010-09-14T23:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89012",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jhpalmieri](#comment%3A30):
> So I think I need to delete the old libpari-gmp library, move the old Sage directory, touch 
>  ...
> - devel/sage/sage/libs/pari/gen.pxd

The latter shouldn't be necessary.

 
> Simple.

;-) How many users will agree on that?



---

archive/issue_comments_089013.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nAlso looks like a Python on Darwin bug; I have the opposite order of linker search directories.",
    "created_at": "2010-09-14T23:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89013",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:33" align="right">comment:33</div>

Also looks like a Python on Darwin bug; I have the opposite order of linker search directories.



---

archive/issue_comments_089014.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\n> The latter shouldn't be necessary.\n\nI guess you're right.\n\nWouldn't it be easier for upgrading to see if libpari-gmp.dylib exists, and if so, delete it and then link libpari-gmp-2.4.dylib to it?\n\nBy the way, on a linux box I see libpari-gmp.so.2 and libpari-gmp.so.2.3.5 lying around from the old install.  They don't seem to cause any trouble, but should they be removed also?",
    "created_at": "2010-09-14T23:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89014",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

> The latter shouldn't be necessary.

I guess you're right.

Wouldn't it be easier for upgrading to see if libpari-gmp.dylib exists, and if so, delete it and then link libpari-gmp-2.4.dylib to it?

By the way, on a linux box I see libpari-gmp.so.2 and libpari-gmp.so.2.3.5 lying around from the old install.  They don't seem to cause any trouble, but should they be removed also?



---

archive/issue_comments_089015.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jhpalmieri](#comment%3A34):\n> Wouldn't it be easier for upgrading to see if libpari-gmp.dylib exists, and if so, delete it and then link libpari-gmp-2.4.dylib to it?\n\nI was thinking of fixing this in general, not a specific work-around limited to updating to *this* release.\n\n> By the way, on a linux box I see libpari-gmp.so.2 and libpari-gmp.so.2.3.5 lying around from the old install.  They don't seem to cause any trouble, but should they be removed also?\n\nAs I said, on Linux we seem to have the correct order of library search dirs, so if all necessary files actually get rebuilt, the old libs shouldn't cause problems. In fact, you can use both versions \"at the same time\" (on Linux), i.e. some Sage modules using the old, and some the new version. The Darwin loader doesn't support this, at least with how the modules are currently built on Darwin.\n\nFor the directory renaming issue (perhaps typical for upgrades, but not limited to):\n\n```python\ndistutils.sysconfig.get_config_vars()[\"LDFLAGS\"]=\"\" # remove potentially obsolete \"-L$SAGE_LOCAL/lib\"\n```\n(To be added to `devel/sage/setup.py`; doesn't hurt on normal installations where it is redundant anyway.)",
    "created_at": "2010-09-15T00:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89015",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jhpalmieri](#comment%3A34):
> Wouldn't it be easier for upgrading to see if libpari-gmp.dylib exists, and if so, delete it and then link libpari-gmp-2.4.dylib to it?

I was thinking of fixing this in general, not a specific work-around limited to updating to *this* release.

> By the way, on a linux box I see libpari-gmp.so.2 and libpari-gmp.so.2.3.5 lying around from the old install.  They don't seem to cause any trouble, but should they be removed also?

As I said, on Linux we seem to have the correct order of library search dirs, so if all necessary files actually get rebuilt, the old libs shouldn't cause problems. In fact, you can use both versions "at the same time" (on Linux), i.e. some Sage modules using the old, and some the new version. The Darwin loader doesn't support this, at least with how the modules are currently built on Darwin.

For the directory renaming issue (perhaps typical for upgrades, but not limited to):

```python
distutils.sysconfig.get_config_vars()["LDFLAGS"]="" # remove potentially obsolete "-L$SAGE_LOCAL/lib"
```
(To be added to `devel/sage/setup.py`; doesn't hurt on normal installations where it is redundant anyway.)



---

archive/issue_comments_089016.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@nexttime](#comment%3A35):\n>\n\n```python\ndistutils.sysconfig.get_config_vars()[\"LDFLAGS\"]=\"\" # remove potentially obsolete \"-L$SAGE_LOCAL/lib\"\n```\n\n*In theory...* We have to re-customize the compiler.",
    "created_at": "2010-09-15T00:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89016",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@nexttime](#comment%3A35):
>

```python
distutils.sysconfig.get_config_vars()["LDFLAGS"]="" # remove potentially obsolete "-L$SAGE_LOCAL/lib"
```

*In theory...* We have to re-customize the compiler.



---

archive/issue_comments_089017.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI'm not sure where the 4.5.3 is coming from.  If I do `./sage -ipython`:\n\n```\nIn [1]: import distutils.sysconfig\n\nIn [2]: s=''.join([str(x) for x in distutils.sysconfig.get_config_vars().values()])\n\nIn [3]: s.find('4.5')\nOut[3]: -1\n```\nSo the string '4.5' is not in any value of any variable listed by `get_config_vars`.  (By inspection it wasn't in LDFLAGS.)  I'm assuming that running `./sage -ipython` sets all of the variables the same way as during the `./sage -b` process, but I suppose this could be wrong.\n\nSo where does 4.5.3 come from?  Is there some file which stores it which needs to be rebuilt?  I notice that devel/sage/module_list.pyc is old and seems to refer to the absolute path, but rebuilding it didn't help.  Any other ideas?",
    "created_at": "2010-09-15T01:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89017",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

I'm not sure where the 4.5.3 is coming from.  If I do `./sage -ipython`:

```
In [1]: import distutils.sysconfig

In [2]: s=''.join([str(x) for x in distutils.sysconfig.get_config_vars().values()])

In [3]: s.find('4.5')
Out[3]: -1
```
So the string '4.5' is not in any value of any variable listed by `get_config_vars`.  (By inspection it wasn't in LDFLAGS.)  I'm assuming that running `./sage -ipython` sets all of the variables the same way as during the `./sage -b` process, but I suppose this could be wrong.

So where does 4.5.3 come from?  Is there some file which stores it which needs to be rebuilt?  I notice that devel/sage/module_list.pyc is old and seems to refer to the absolute path, but rebuilding it didn't help.  Any other ideas?



---

archive/issue_comments_089018.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI'm sorry, that's wrong, I was running it on the wrong machine.  4.5.3 appears in lots of places:\n\n```\n 'BINDIR': '/Applications/sage_builds/sage-4.5.3/local/bin',\n 'BINLIBDEST': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6',\n 'BLDSHARED': 'gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup',\n 'CONFIG_ARGS': \"'--enable-shared' '--prefix=/Applications/sage_builds/sage-4.5.3/local' '--enable-unicode=ucs4' '--disable-toolbox-glue' 'CC=gcc' 'LDFLAGS=-L/Applications/sage_builds/sage-4.5.3/local/lib ' 'CPPFLAGS=-I/Applications/sage_builds/sage-4.5.3/local/include '\",\n 'CONFINCLUDEDIR': '/Applications/sage_builds/sage-4.5.3/local/include',\n 'CONFINCLUDEPY': '/Applications/sage_builds/sage-4.5.3/local/include/python2.6',\n 'CPPFLAGS': '-I. -IInclude -I./Include -I/Applications/sage_builds/sage-4.5.3/local/include',\n 'DESTDIRS': '/Applications/sage_builds/sage-4.5.3/local /Applications/sage_builds/sage-4.5.3/local/lib /Applications/sage_builds/sage-4.5.3/local/lib/python2.6 /Applications/sage_builds/sage-4.5.3/local/lib/python2.6/lib-dynload',\n 'DESTLIB': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6',\n 'DESTSHARED': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6/lib-dynload'\n 'INCLDIRSTOMAKE': '/Applications/sage_builds/sage-4.5.3/local/include /Applications/sage_builds/sage-4.5.3/local/include /Applications/sage_builds/sage-4.5.3/local/include/python2.6 /Applications/sage_builds/sage-4.5.3/local/include/python2.6',\n 'INCLUDEDIR': '/Applications/sage_builds/sage-4.5.3/local/include',\n 'INCLUDEPY': '/Applications/sage_builds/sage-4.5.3/local/include/python2.6',\n 'LDFLAGS': '-L/Applications/sage_builds/sage-4.5.3/local/lib',\n 'LDSHARED': 'gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup',\n 'LIBDEST': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'\n 'LIBDIR': '/Applications/sage_builds/sage-4.5.3/local/lib'\n 'LIBP': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'\n 'LIBPL': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6/config'\n 'MACHDESTLIB': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'\n 'MANDIR': '/Applications/sage_builds/sage-4.5.3/local/share/man'\n 'PY_CFLAGS': '-fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I. -IInclude -I./Include -I/Applications/sage_builds/sage-4.5.3/local/include  -DPy_BUILD_CORE'\n 'SCRIPTDIR': '/Applications/sage_builds/sage-4.5.3/local/lib'\n```",
    "created_at": "2010-09-15T01:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89018",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">comment:38</div>

I'm sorry, that's wrong, I was running it on the wrong machine.  4.5.3 appears in lots of places:

```
 'BINDIR': '/Applications/sage_builds/sage-4.5.3/local/bin',
 'BINLIBDEST': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6',
 'BLDSHARED': 'gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup',
 'CONFIG_ARGS': "'--enable-shared' '--prefix=/Applications/sage_builds/sage-4.5.3/local' '--enable-unicode=ucs4' '--disable-toolbox-glue' 'CC=gcc' 'LDFLAGS=-L/Applications/sage_builds/sage-4.5.3/local/lib ' 'CPPFLAGS=-I/Applications/sage_builds/sage-4.5.3/local/include '",
 'CONFINCLUDEDIR': '/Applications/sage_builds/sage-4.5.3/local/include',
 'CONFINCLUDEPY': '/Applications/sage_builds/sage-4.5.3/local/include/python2.6',
 'CPPFLAGS': '-I. -IInclude -I./Include -I/Applications/sage_builds/sage-4.5.3/local/include',
 'DESTDIRS': '/Applications/sage_builds/sage-4.5.3/local /Applications/sage_builds/sage-4.5.3/local/lib /Applications/sage_builds/sage-4.5.3/local/lib/python2.6 /Applications/sage_builds/sage-4.5.3/local/lib/python2.6/lib-dynload',
 'DESTLIB': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6',
 'DESTSHARED': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6/lib-dynload'
 'INCLDIRSTOMAKE': '/Applications/sage_builds/sage-4.5.3/local/include /Applications/sage_builds/sage-4.5.3/local/include /Applications/sage_builds/sage-4.5.3/local/include/python2.6 /Applications/sage_builds/sage-4.5.3/local/include/python2.6',
 'INCLUDEDIR': '/Applications/sage_builds/sage-4.5.3/local/include',
 'INCLUDEPY': '/Applications/sage_builds/sage-4.5.3/local/include/python2.6',
 'LDFLAGS': '-L/Applications/sage_builds/sage-4.5.3/local/lib',
 'LDSHARED': 'gcc -L/Applications/sage_builds/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup',
 'LIBDEST': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'
 'LIBDIR': '/Applications/sage_builds/sage-4.5.3/local/lib'
 'LIBP': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'
 'LIBPL': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6/config'
 'MACHDESTLIB': '/Applications/sage_builds/sage-4.5.3/local/lib/python2.6'
 'MANDIR': '/Applications/sage_builds/sage-4.5.3/local/share/man'
 'PY_CFLAGS': '-fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I. -IInclude -I./Include -I/Applications/sage_builds/sage-4.5.3/local/include  -DPy_BUILD_CORE'
 'SCRIPTDIR': '/Applications/sage_builds/sage-4.5.3/local/lib'
```



---

archive/issue_comments_089019.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI can get rid of the second dir by adding the following line in `devel/sage/setup.py`:\n\n```python\n        self.compiler.set_library_dirs([]) # may have contained obsolete ones\n\n        self.compiler.link_shared_object(\n        ...\n```\n\nBut your `LDSHARED` looks bad; mine is just\n\n```\n'gcc -march=native -O3 -fno-strict-aliasing -fomit-frame-pointer -DHONORS_CFLAGS -pthread -shared'\n```\nor simply (the relevant part)\n\n```\n'gcc -pthread -shared'\n```",
    "created_at": "2010-09-15T01:55:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89019",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:39" align="right">comment:39</div>

I can get rid of the second dir by adding the following line in `devel/sage/setup.py`:

```python
        self.compiler.set_library_dirs([]) # may have contained obsolete ones

        self.compiler.link_shared_object(
        ...
```

But your `LDSHARED` looks bad; mine is just

```
'gcc -march=native -O3 -fno-strict-aliasing -fomit-frame-pointer -DHONORS_CFLAGS -pthread -shared'
```
or simply (the relevant part)

```
'gcc -pthread -shared'
```



---

archive/issue_comments_089020.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nYou can also replace or modify the linker command (for shared libraries) in `setup.py` by e.g.\n\n```python\n        self.compiler.linker_so=[\"gcc\",\"-shared\",\"-pthread\"] # Linux\n\n        self.compiler.link_shared_object(\n        ...\n```\nIn your case, perhaps just delete the second list element (`\"-L/...\"`).\n\nSimilar things have perhaps to be done for other commands and args / parameters.",
    "created_at": "2010-09-15T02:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89020",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:40" align="right">comment:40</div>

You can also replace or modify the linker command (for shared libraries) in `setup.py` by e.g.

```python
        self.compiler.linker_so=["gcc","-shared","-pthread"] # Linux

        self.compiler.link_shared_object(
        ...
```
In your case, perhaps just delete the second list element (`"-L/..."`).

Similar things have perhaps to be done for other commands and args / parameters.



---

archive/issue_comments_089021.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nMaybe doing the equivalent of `export LDSHARED='gcc -bundle -undefined dynamic_lookup'` will do it.  Actually running that in the shell, then touching a bunch of pyx files and typing \"./sage -b\", produces a version of sage which starts up without an import error.  It seems to use the correct command when building the Sage library files, and in distutils.sysconfig.customize_compiler, it says\n\n```\n        if 'LDSHARED' in os.environ:\n            ldshared = os.environ['LDSHARED']\n```\nI wish we knew why this is getting set wrong...",
    "created_at": "2010-09-15T03:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89021",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

Maybe doing the equivalent of `export LDSHARED='gcc -bundle -undefined dynamic_lookup'` will do it.  Actually running that in the shell, then touching a bunch of pyx files and typing "./sage -b", produces a version of sage which starts up without an import error.  It seems to use the correct command when building the Sage library files, and in distutils.sysconfig.customize_compiler, it says

```
        if 'LDSHARED' in os.environ:
            ldshared = os.environ['LDSHARED']
```
I wish we knew why this is getting set wrong...



---

archive/issue_comments_089022.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@nexttime](#comment%3A18):\n> I consider the \"`touch` issue\" a bug in `module_list.py`, since PARI is not directly used by those extension modules (but listed in their `libraries`, and therefore gets recorded in the list of needed libraries).\n\nI've opened #9914 to fix this; minimal patch up there, needs review.\n\n(Note that these extension modules also did not get rebuilt because they **don't** [directly] depend on PARI, despite that fact linked against it. Unless one links with `--as-needed`, which isn't very portable, the - *potentially later obsolete* - PARI library unnecessarily gets recorded as a prerequisite for those extension modules.)",
    "created_at": "2010-09-16T11:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89022",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@nexttime](#comment%3A18):
> I consider the "`touch` issue" a bug in `module_list.py`, since PARI is not directly used by those extension modules (but listed in their `libraries`, and therefore gets recorded in the list of needed libraries).

I've opened #9914 to fix this; minimal patch up there, needs review.

(Note that these extension modules also did not get rebuilt because they **don't** [directly] depend on PARI, despite that fact linked against it. Unless one links with `--as-needed`, which isn't very portable, the - *potentially later obsolete* - PARI library unnecessarily gets recorded as a prerequisite for those extension modules.)



---

archive/issue_comments_089023.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI have another possible data point.  I upgraded to 4.6.alpha1 (not alpha0) from 4.5.3 on OS X 10.6, and all seems well, except for failing doctests in `schemes/elliptic_curves/ell_rational_field.py` and `libs/mwrank/interface.py`.  Both errors are in mwrank.\n\nI have an updated Pynac (which would be time-consuming to revert) on this installation, which I suppose could have something to do with this.  But this seems fairly unlikely to me, so I thought I'd ask if anyone had tried the new upgrade possibility and seen something similar.",
    "created_at": "2010-09-22T02:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89023",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">comment:43</div>

I have another possible data point.  I upgraded to 4.6.alpha1 (not alpha0) from 4.5.3 on OS X 10.6, and all seems well, except for failing doctests in `schemes/elliptic_curves/ell_rational_field.py` and `libs/mwrank/interface.py`.  Both errors are in mwrank.

I have an updated Pynac (which would be time-consuming to revert) on this installation, which I suppose could have something to do with this.  But this seems fairly unlikely to me, so I thought I'd ask if anyone had tried the new upgrade possibility and seen something similar.



---

archive/issue_comments_089024.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.\n\nFor what it's worth, I get\n\n```\n\nsage -t  \"devel/sage/sage/libs/mwrank/interface.py\"         \nThe doctested process was killed by signal 4\n         [199.7 s]\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\nThe doctested process was killed by signal 4\n         [337.5 s]\n \n```\non OS X 10.4 with this same upgrade pattern, and without the new Pynac.  Also curious.",
    "created_at": "2010-09-22T02:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89024",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:44" align="right">comment:44</div>

I should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.

For what it's worth, I get

```

sage -t  "devel/sage/sage/libs/mwrank/interface.py"         
The doctested process was killed by signal 4
         [199.7 s]
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
The doctested process was killed by signal 4
         [337.5 s]
 
```
on OS X 10.4 with this same upgrade pattern, and without the new Pynac.  Also curious.



---

archive/issue_comments_089025.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@kcrisman](#comment%3A44):\n> I should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.\n> \n> For what it's worth, I get\n\n\n```\n\nsage -t  \"devel/sage/sage/libs/mwrank/interface.py\"         \nThe doctested process was killed by signal 4\n         [199.7 s]\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\nThe doctested process was killed by signal 4\n         [337.5 s]\n \n```\n> on OS X 10.4 with this same upgrade pattern, and without the new Pynac.  Also curious.\n\nHmmm, not that surprising, except that signal 4 is \"illegal instruction\", not a segmentation fault (but perhaps Apple uses different numbers on Darwin 8).\n\nDid you\n* rebuild ECLIB (with `./sage -f ...`) (depends on PARI)\n* rename or copy the 4.5.3 directory? \n\nAs mentioned above, three extension modules do **not** get rebuilt though they link against PARI (and depend on ECLIB).\n\nIn case you copied the directory to keep the 4.5.3 installation, the linker on Darwin will **first** search `$SAGE_LOCAL/lib` of the **old** Sage installation, and therefore link against the wrong PARI library. You can export `LDSHARED` to prevent this (see above).\n\nI'm not sure if the setting differs on MacOS X 10.4, so you could do:\n\n```\nsage: import distutils.sysconfig\nsage: distutils.sysconfig.get_config_var(\"LDSHARED\")\n' (current setting) '\n```\nand set `LDSHARED` to what you see except the first `-L...` (and export it).\n\nThen force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.\n\n\nI - hate - trac ... 8| (once again just logged me off when replying s.t. my whole comment went to /dev/null)",
    "created_at": "2010-09-22T03:25:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89025",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@kcrisman](#comment%3A44):
> I should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.
> 
> For what it's worth, I get


```

sage -t  "devel/sage/sage/libs/mwrank/interface.py"         
The doctested process was killed by signal 4
         [199.7 s]
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
The doctested process was killed by signal 4
         [337.5 s]
 
```
> on OS X 10.4 with this same upgrade pattern, and without the new Pynac.  Also curious.

Hmmm, not that surprising, except that signal 4 is "illegal instruction", not a segmentation fault (but perhaps Apple uses different numbers on Darwin 8).

Did you
* rebuild ECLIB (with `./sage -f ...`) (depends on PARI)
* rename or copy the 4.5.3 directory? 

As mentioned above, three extension modules do **not** get rebuilt though they link against PARI (and depend on ECLIB).

In case you copied the directory to keep the 4.5.3 installation, the linker on Darwin will **first** search `$SAGE_LOCAL/lib` of the **old** Sage installation, and therefore link against the wrong PARI library. You can export `LDSHARED` to prevent this (see above).

I'm not sure if the setting differs on MacOS X 10.4, so you could do:

```
sage: import distutils.sysconfig
sage: distutils.sysconfig.get_config_var("LDSHARED")
' (current setting) '
```
and set `LDSHARED` to what you see except the first `-L...` (and export it).

Then force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.


I - hate - trac ... 8| (once again just logged me off when replying s.t. my whole comment went to /dev/null)



---

archive/issue_comments_089026.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n> Did you\n> * rebuild ECLIB (with `./sage -f ...`) (depends on PARI)\n> * rename or copy the 4.5.3 directory? \n\nNope - like I said, it was a data point.\n> Then force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.\n\nI'll try this.",
    "created_at": "2010-09-22T12:54:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89026",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:46" align="right">comment:46</div>

> Did you
> * rebuild ECLIB (with `./sage -f ...`) (depends on PARI)
> * rename or copy the 4.5.3 directory? 

Nope - like I said, it was a data point.
> Then force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.

I'll try this.



---

archive/issue_comments_089027.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\n> > Then force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.\n> \n> I'll try this.\n\nYup, this fixed it.  I hope you figure out how to fix this before 4.6 is released!  A lot of our clientele is likely to have precisely this platform.",
    "created_at": "2010-09-22T14:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89027",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:47" align="right">comment:47</div>

> > Then force rebuilding ECLIB, touch the three Cython files listed above and do `./sage -b`.
> 
> I'll try this.

Yup, this fixed it.  I hope you figure out how to fix this before 4.6 is released!  A lot of our clientele is likely to have precisely this platform.



---

archive/issue_comments_089028.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nKarl-Dieter, could you add another data point, the output of\n\n```\ndistutils.sysconfig.get_config_var(\"LDSHARED\")\n```\non your MacOS X 10.**4** box? (Just to make sure it doesn't differ much from the settings on 10.5 and 10.6.)\n\nBtw, \"illegal instruction\" errors (signal 4) are also reasonable when the wrong PARI library is used, since memory might get corrupted and function pointers may point to some arbitrary location.\n\nThis upgrade problem isn't that hard to fix (since we now know the two rather unrelated causes), but I think I'll open a follow-up ticket for the necessary patches.",
    "created_at": "2010-09-22T15:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89028",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:48" align="right">comment:48</div>

Karl-Dieter, could you add another data point, the output of

```
distutils.sysconfig.get_config_var("LDSHARED")
```
on your MacOS X 10.**4** box? (Just to make sure it doesn't differ much from the settings on 10.5 and 10.6.)

Btw, "illegal instruction" errors (signal 4) are also reasonable when the wrong PARI library is used, since memory might get corrupted and function pointers may point to some arbitrary location.

This upgrade problem isn't that hard to fix (since we now know the two rather unrelated causes), but I think I'll open a follow-up ticket for the necessary patches.



---

archive/issue_comments_089029.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@jhpalmieri](#comment%3A11):\n> The time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.\n\nJust for the record: `paripriv.h` is a patched Sage version which is copied with `-p` on Darwin, but that's in general ok (though we don't preserve the file attributes, including the modification time, on others systems).",
    "created_at": "2010-09-22T17:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89029",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@jhpalmieri](#comment%3A11):
> The time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.

Just for the record: `paripriv.h` is a patched Sage version which is copied with `-p` on Darwin, but that's in general ok (though we don't preserve the file attributes, including the modification time, on others systems).



---

archive/issue_comments_089030.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@nexttime](#comment%3A49):\n> Replying to [@jhpalmieri](#comment%3A11):\n> > The time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.\n> \n> \n> Just for the record: `paripriv.h` is a patched Sage version which is copied with `-p` on Darwin, but that's in general ok (though we don't preserve the file attributes, including the modification time, on others systems).\n\nThe file `paripriv.h` is also patched on Solaris. \n\nNote William told me the file should be private to Pari (hence the \"priv\" in the name), so he is not surprised it needs patching for OS X and Solaris. \n\nI don't actually understand what this file does, but I rather get the feeling it is a hack of some sort.",
    "created_at": "2010-09-22T21:38:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89030",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@nexttime](#comment%3A49):
> Replying to [@jhpalmieri](#comment%3A11):
> > The time stamps on pariport.h, paritype.h, and paripriv.h are all old, too.
> 
> 
> Just for the record: `paripriv.h` is a patched Sage version which is copied with `-p` on Darwin, but that's in general ok (though we don't preserve the file attributes, including the modification time, on others systems).

The file `paripriv.h` is also patched on Solaris. 

Note William told me the file should be private to Pari (hence the "priv" in the name), so he is not surprised it needs patching for OS X and Solaris. 

I don't actually understand what this file does, but I rather get the feeling it is a hack of some sort.



---

archive/issue_comments_089031.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A50):\n> The file `paripriv.h` is also patched on Solaris.\n\nThe patched version only avoids a single name clash on MacOS X and Solaris.  \n\n> I don't actually understand what this file does, but I rather get the feeling it is a hack of some sort. \n\nIt defines more lower-level structures and functions of PARI that we use in `sage/libs/pari/gen.pyx`, the Python/Cython PARI *library* interface.",
    "created_at": "2010-09-22T23:35:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89031",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@sagetrac-drkirkby](#comment%3A50):
> The file `paripriv.h` is also patched on Solaris.

The patched version only avoids a single name clash on MacOS X and Solaris.  

> I don't actually understand what this file does, but I rather get the feeling it is a hack of some sort. 

It defines more lower-level structures and functions of PARI that we use in `sage/libs/pari/gen.pyx`, the Python/Cython PARI *library* interface.



---

archive/issue_comments_089032.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@nexttime](#comment%3A48):\n> Karl-Dieter, could you add another data point, the output of\n> \n> ```\n> distutils.sysconfig.get_config_var(\"LDSHARED\")\n> ```\n> on your MacOS X 10.**4** box? (Just to make sure it doesn't differ much from the settings on 10.5 and 10.6.)\n> \n\n```\nsage: import distutils\nsage: distutils.sysconfig.get_config_var(\"LDSHARED\")\n'gcc -L/Users/crisman/Desktop/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup'\n```\nIncidentally, I already changed the name of that folder to sage-4.6.alpha1, so that by itself is a little unsettling...",
    "created_at": "2010-09-23T00:13:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89032",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@nexttime](#comment%3A48):
> Karl-Dieter, could you add another data point, the output of
> 
> ```
> distutils.sysconfig.get_config_var("LDSHARED")
> ```
> on your MacOS X 10.**4** box? (Just to make sure it doesn't differ much from the settings on 10.5 and 10.6.)
> 

```
sage: import distutils
sage: distutils.sysconfig.get_config_var("LDSHARED")
'gcc -L/Users/crisman/Desktop/sage-4.5.3/local/lib -bundle -undefined dynamic_lookup'
```
Incidentally, I already changed the name of that folder to sage-4.6.alpha1, so that by itself is a little unsettling...



---

archive/issue_comments_089033.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@nexttime](#comment%3A45):\n> Replying to [@kcrisman](#comment%3A44):\n> > I should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.\n> > \n> > For what it's worth, I get\n> \n> \n> ```\n> \n> sage -t  \"devel/sage/sage/libs/mwrank/interface.py\"         \n> The doctested process was killed by signal 4\n>          [199.7 s]\n> sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n> The doctested process was killed by signal 4\n>          [337.5 s]\n>  \n> ```\n\nOk, did everything right and \n\n```\nsage -t  \"devel/sage/sage/libs/mwrank/interface.py\"         \n         [50.8 s]\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n         [279.7 s]\n \n----------------------------------------------------------------------\nAll tests passed!\n```\nThanks!",
    "created_at": "2010-09-23T00:59:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89033",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@nexttime](#comment%3A45):
> Replying to [@kcrisman](#comment%3A44):
> > I should point out that the errors look like the ones here, segmentation fault in Pari and all that.  It's not the computer I'm on right now, so I won't laboriously type it all out.
> > 
> > For what it's worth, I get
> 
> 
> ```
> 
> sage -t  "devel/sage/sage/libs/mwrank/interface.py"         
> The doctested process was killed by signal 4
>          [199.7 s]
> sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
> The doctested process was killed by signal 4
>          [337.5 s]
>  
> ```

Ok, did everything right and 

```
sage -t  "devel/sage/sage/libs/mwrank/interface.py"         
         [50.8 s]
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
         [279.7 s]
 
----------------------------------------------------------------------
All tests passed!
```
Thanks!



---

archive/issue_comments_089034.json:
```json
{
    "body": "Sage library patch. Fixes the relevant extension module dependencies. Based on Sage 4.6.alpha1.",
    "created_at": "2010-09-23T04:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89034",
    "user": "https://github.com/nexttime"
}
```

Sage library patch. Fixes the relevant extension module dependencies. Based on Sage 4.6.alpha1.



---

archive/issue_comments_089035.json:
```json
{
    "body": "Attachment: **[trac_9896-fix_extension_module_deps-sagelib.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)**\n\nAttachment: **[trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz)**\n\nScripts repo patch (to sage-upgrade). Based on Sage 4.6.alpha1.",
    "created_at": "2010-09-23T06:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89035",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-fix_extension_module_deps-sagelib.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)**

Attachment: **[trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz)**

Scripts repo patch (to sage-upgrade). Based on Sage 4.6.alpha1.



---

archive/issue_comments_089036.json:
```json
{
    "body": "New `spkg/standard/deps`. Based on Sage 4.6.alpha1. (Not under revision control.)",
    "created_at": "2010-09-23T06:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89036",
    "user": "https://github.com/nexttime"
}
```

New `spkg/standard/deps`. Based on Sage 4.6.alpha1. (Not under revision control.)



---

archive/issue_comments_089037.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.gz)**\n\nAttachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.diff.gz)**\n\nDiff of new `spkg/standard/deps` against that of Sage 4.6.alpha1.",
    "created_at": "2010-09-23T06:51:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89037",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.gz)**

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.diff.gz)**

Diff of new `spkg/standard/deps` against that of Sage 4.6.alpha1.



---

archive/issue_comments_089038.json:
```json
{
    "body": "Changed keywords from none to **upgrade update dependencies PARI NewPARI**",
    "created_at": "2010-09-23T07:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89038",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from none to **upgrade update dependencies PARI NewPARI**



---

archive/issue_comments_089039.json:
```json
{
    "body": "Author: **Leif Leonhardy**",
    "created_at": "2010-09-23T07:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89039",
    "user": "https://github.com/nexttime"
}
```

Author: **Leif Leonhardy**



---

archive/issue_events_127347.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-23T07:51:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127347"
}
```



---

archive/issue_events_127348.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-23T07:51:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127348"
}
```



---

archive/issue_comments_089040.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI've attached a few patches / files and their diffs that make upgrading from Sage < 4.6 (i.e. to the new PARI) work.\n\nI think this is a general improvement (not limited to PARI upgrade), though for e.g. the GMP/MPIR 2.1.2 upgrade (see #8664), more dependencies (or some other mechanism) have to be added to `module_list.py` to properly rebuild the Sage *library* (i.e. **all** *extension modules* that depend on MPIR). Sage *packages* depending on an upgraded spkg will now get rebuilt without the need to download unmodified \"new\" versions (with just the patch level bumped in order to get them rebuilt).\n\nI'm setting this to \"needs review\", though I've not yet uploaded a patch to get around the specific *Darwin* linker problem (but I'll provide one later).\n\nWhen doing an \"in-place\" upgrade (i.e. keeping the old directory name), the current patches should also fully work on MacOS X. A work-around to the linker problem (i.e. when the Sage to be upgraded is located in a new directory) is manually setting (and exporting) `LDSHARED` to the output of `distutils.sysconfig.get_config_var(\"LDSHARED\")` with the second \"word\" (`-L...`) either dropped or replaced by `-L` immediately followed by `$SAGE_ROOT/local/lib` (with `$SAGE_ROOT` the actual directory name, not the environment variable; see also comments above for more details).\n\nUnfortunately we'll have to set up a Sage package server (or a special directory on e.g. `www.sagemath.org`) to \"fully\" test this, i.e. by *really* running `sage -upgrade`.\n\nOn the other hand, the changes are quite small such that they should easily be reviewed. The behavior can be tested by e.g. running `make` with `SAGE_UPGRADING` set to \"yes\", faking some spkg was new (to see that all dependent spkgs really get rebuilt) etc. .\n\nOne can also test it by doing a real upgrade from some **vanilla** version to 4.6.alpha1, **after that** applying the patch to `module_list.py` and copying over the new `spkg/install` and `spkg/standard/deps`, then exporting `SAGE_UPGRADE=yes` and running `make`. Then everything should be properly [re]built.",
    "created_at": "2010-09-23T07:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89040",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:54" align="right">comment:54</div>

I've attached a few patches / files and their diffs that make upgrading from Sage < 4.6 (i.e. to the new PARI) work.

I think this is a general improvement (not limited to PARI upgrade), though for e.g. the GMP/MPIR 2.1.2 upgrade (see #8664), more dependencies (or some other mechanism) have to be added to `module_list.py` to properly rebuild the Sage *library* (i.e. **all** *extension modules* that depend on MPIR). Sage *packages* depending on an upgraded spkg will now get rebuilt without the need to download unmodified "new" versions (with just the patch level bumped in order to get them rebuilt).

I'm setting this to "needs review", though I've not yet uploaded a patch to get around the specific *Darwin* linker problem (but I'll provide one later).

When doing an "in-place" upgrade (i.e. keeping the old directory name), the current patches should also fully work on MacOS X. A work-around to the linker problem (i.e. when the Sage to be upgraded is located in a new directory) is manually setting (and exporting) `LDSHARED` to the output of `distutils.sysconfig.get_config_var("LDSHARED")` with the second "word" (`-L...`) either dropped or replaced by `-L` immediately followed by `$SAGE_ROOT/local/lib` (with `$SAGE_ROOT` the actual directory name, not the environment variable; see also comments above for more details).

Unfortunately we'll have to set up a Sage package server (or a special directory on e.g. `www.sagemath.org`) to "fully" test this, i.e. by *really* running `sage -upgrade`.

On the other hand, the changes are quite small such that they should easily be reviewed. The behavior can be tested by e.g. running `make` with `SAGE_UPGRADING` set to "yes", faking some spkg was new (to see that all dependent spkgs really get rebuilt) etc. .

One can also test it by doing a real upgrade from some **vanilla** version to 4.6.alpha1, **after that** applying the patch to `module_list.py` and copying over the new `spkg/install` and `spkg/standard/deps`, then exporting `SAGE_UPGRADE=yes` and running `make`. Then everything should be properly [re]built.



---

archive/issue_comments_089041.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@nexttime](#comment%3A54):\n> Unfortunately we'll have to set up a Sage package server (or a special directory on e.g. `www.sagemath.org`) to \"fully\" test this, i.e. by *really* running `sage -upgrade`.\n\nI could probably do this.",
    "created_at": "2010-09-23T07:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89041",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@nexttime](#comment%3A54):
> Unfortunately we'll have to set up a Sage package server (or a special directory on e.g. `www.sagemath.org`) to "fully" test this, i.e. by *really* running `sage -upgrade`.

I could probably do this.



---

archive/issue_events_127349.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-23T10:57:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127349"
}
```



---

archive/issue_events_127350.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-23T10:57:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127350"
}
```



---

archive/issue_comments_089042.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nYour `spkg/install` file gives trouble:\n\n```\ncd spkg && ./install all 2>&1 | tee -a ../install.log\n./install: line 90: syntax error near unexpected token `||'\n./install: line 90: `    || ([ -f \"$SAGE_LOCAL/bin/sage-upgrade\" ] &&'\n```",
    "created_at": "2010-09-23T10:57:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89042",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

Your `spkg/install` file gives trouble:

```
cd spkg && ./install all 2>&1 | tee -a ../install.log
./install: line 90: syntax error near unexpected token `||'
./install: line 90: `    || ([ -f "$SAGE_LOCAL/bin/sage-upgrade" ] &&'
```



---

archive/issue_comments_089043.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nThis is on a Gentoo Linux x86_64 system, with\n\n```\nGNU bash, version 3.2.39(1)-release (x86_64-pc-linux-gnu)\nCopyright (C) 2007 Free Software Foundation, Inc.\n```",
    "created_at": "2010-09-23T10:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89043",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

This is on a Gentoo Linux x86_64 system, with

```
GNU bash, version 3.2.39(1)-release (x86_64-pc-linux-gnu)
Copyright (C) 2007 Free Software Foundation, Inc.
```



---

archive/issue_comments_089044.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI looks like lines 90 and 91 need a `\\` at the end of the line.",
    "created_at": "2010-09-23T11:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89044",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

I looks like lines 90 and 91 need a `\` at the end of the line.



---

archive/issue_comments_089045.json:
```json
{
    "body": "New `spkg/install`. Based on Sage 4.6.alpha1. (Not under revision control.)",
    "created_at": "2010-09-23T13:20:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89045",
    "user": "https://github.com/nexttime"
}
```

New `spkg/install`. Based on Sage 4.6.alpha1. (Not under revision control.)



---

archive/issue_comments_089046.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__install.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.gz)**\n\nDiff of new `spkg/install` against that of Sage 4.6.alpha1.",
    "created_at": "2010-09-23T13:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89046",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__install.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.gz)**

Diff of new `spkg/install` against that of Sage 4.6.alpha1.



---

archive/issue_comments_089047.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAttachment: **[trac_9896-SAGE_ROOT__spkg__install.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.diff.gz)**\n\nReplying to [@nexttime](#comment%3A54):\n> One can also test it by doing a real upgrade from some **vanilla** version to 4.6.alpha1, **after that** applying the patch to `module_list.py` and copying over the new `spkg/install` and `spkg/standard/deps`, then exporting `SAGE_UPGRADE=yes` and running `make`. Then everything should be properly [re]built.\n\ns/`SAGE_UPGRADE`/`SAGE_UPGRADING`/",
    "created_at": "2010-09-23T13:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89047",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:59" align="right">comment:59</div>

Attachment: **[trac_9896-SAGE_ROOT__spkg__install.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.diff.gz)**

Replying to [@nexttime](#comment%3A54):
> One can also test it by doing a real upgrade from some **vanilla** version to 4.6.alpha1, **after that** applying the patch to `module_list.py` and copying over the new `spkg/install` and `spkg/standard/deps`, then exporting `SAGE_UPGRADE=yes` and running `make`. Then everything should be properly [re]built.

s/`SAGE_UPGRADE`/`SAGE_UPGRADING`/



---

archive/issue_events_127351.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-23T13:24:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127351"
}
```



---

archive/issue_events_127352.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-23T13:24:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127352"
}
```



---

archive/issue_comments_089048.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jdemeyer](#comment%3A56):\n> Your `spkg/install` file gives trouble\n\nUpdated.",
    "created_at": "2010-09-23T13:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89048",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jdemeyer](#comment%3A56):
> Your `spkg/install` file gives trouble

Updated.



---

archive/issue_comments_089049.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI created a Sage distribution for testing this.\n\nPlease test:\n\n```\nsage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/\n```",
    "created_at": "2010-09-24T07:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89049",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

I created a Sage distribution for testing this.

Please test:

```
sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/
```



---

archive/issue_comments_089050.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@jdemeyer](#comment%3A61):\n> I created a Sage distribution for testing this.\n> \n> Please test:\n\n\n```\nsage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/\n```\n\nThanks!\n\nUpgrade path: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/\n\nOn MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given above (regarding `LDSHARED`).",
    "created_at": "2010-09-24T13:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89050",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@jdemeyer](#comment%3A61):
> I created a Sage distribution for testing this.
> 
> Please test:


```
sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/
```

Thanks!

Upgrade path: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/

On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given above (regarding `LDSHARED`).



---

archive/issue_comments_089051.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,3 +15,9 @@\n ```\n (Building from scratch works fine.)\n \n+---\n+\n+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**\n+\n+On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in comments below (regarding `LDSHARED`).\n+\n``````\n",
    "created_at": "2010-09-24T13:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89051",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,3 +15,9 @@
 ```
 (Building from scratch works fine.)
 
+---
+
+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**
+
+On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in comments below (regarding `LDSHARED`).
+
``````




---

archive/issue_events_127353.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-09-24T13:59:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "title_is": "Upgrading from 4.5.3 to 4.6.alpha* can fail (not limited to MacOS X)",
    "title_was": "upgrading from 4.5.3 to 4.6.alpha0 fails on OS X 10.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127353"
}
```



---

archive/issue_comments_089052.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@nexttime](#comment%3A62):\n> On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given above (regarding `LDSHARED`).\n\nIf one tests upgrading in a new directory (renamed or copied) on MacOS X, it should be suffient to do\n\n```sh\nexport LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n```\n**before** running `./sage -upgrade ...` (with the upgrade path provided by Jeroen).",
    "created_at": "2010-09-24T14:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89052",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@nexttime](#comment%3A62):
> On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given above (regarding `LDSHARED`).

If one tests upgrading in a new directory (renamed or copied) on MacOS X, it should be suffient to do

```sh
export LDSHARED="gcc -bundle -undefined dynamic_lookup"
```
**before** running `./sage -upgrade ...` (with the upgrade path provided by Jeroen).



---

archive/issue_comments_089053.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,5 @@\n \n **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**\n \n-On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in comments below (regarding `LDSHARED`).\n+On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in the [comment below](#comment%3A63) (regarding `LDSHARED`).\n \n``````\n",
    "created_at": "2010-09-24T14:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89053",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,5 @@
 
 **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**
 
-On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in comments below (regarding `LDSHARED`).
+On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in the [comment below](#comment%3A63) (regarding `LDSHARED`).
 
``````




---

archive/issue_comments_089054.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nAs is often the case with upgrading, I'm puzzled by the logic here.  How can any patches help an upgrade from 4.5.3 (for example) to 4.6?\n\n- Upgrading won't affect files like `spkg/standard/deps` or `spkg/install` as long as those files aren't tracked anywhere -- see #9433.\n- Upgrading will change scripts like `sage-upgrade`, but of course it has to be running the old versions during the upgrade process.\n\nI can understand that patches to these files might help in future versions, but is there any way to deal with 4.5.3 to 4.6?\n\n(Meanwhile, I'm building a vanilla 4.5.3 to test the new upgrade path.)",
    "created_at": "2010-09-24T16:12:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89054",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:65" align="right">comment:65</div>

As is often the case with upgrading, I'm puzzled by the logic here.  How can any patches help an upgrade from 4.5.3 (for example) to 4.6?

- Upgrading won't affect files like `spkg/standard/deps` or `spkg/install` as long as those files aren't tracked anywhere -- see #9433.
- Upgrading will change scripts like `sage-upgrade`, but of course it has to be running the old versions during the upgrade process.

I can understand that patches to these files might help in future versions, but is there any way to deal with 4.5.3 to 4.6?

(Meanwhile, I'm building a vanilla 4.5.3 to test the new upgrade path.)



---

archive/issue_comments_089055.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@jhpalmieri](#comment%3A65):\n> As is often the case with upgrading, I'm puzzled by the logic here.  How can any patches help an upgrade from 4.5.3 (for example) to 4.6?\n> \n> - Upgrading won't affect files like `spkg/standard/deps` or `spkg/install` as long as those files aren't tracked anywhere -- see #9433.\n\n`sage-upgrade.py` also copies these two files (cf. the `pipestatus` issue with upgrading to 4.5[.1]).\n \n> - Upgrading will change scripts like `sage-upgrade`, but of course it has to be running the old versions during the upgrade process.\n\nThe new `spkg/install` is aware of that, i.e. deals with an old `sage-upgrade`, too. (See comments in the patch to the former.)\n \n> I can understand that patches to these files might help in future versions, but is there any way to deal with 4.5.3 to 4.6?\n\nThe patches are intended to especially deal with this (and should ease future upgrades as well).\n \n> (Meanwhile, I'm building a vanilla 4.5.3 to test the new upgrade path.)\n\nFine. I've copied a 4.5.3 installation (*of course*<sup>TM</sup> first running out of disk space) on Ubuntu 9.04 x86 and am currently running the upgrade.\n\nNote that when teeing the output it appears to hang, since the user is prompted, but the output isn't flushed. (One has to type \"y\" and hit return to start upgrading.) I'll open a ticket for that.",
    "created_at": "2010-09-24T16:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89055",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@jhpalmieri](#comment%3A65):
> As is often the case with upgrading, I'm puzzled by the logic here.  How can any patches help an upgrade from 4.5.3 (for example) to 4.6?
> 
> - Upgrading won't affect files like `spkg/standard/deps` or `spkg/install` as long as those files aren't tracked anywhere -- see #9433.

`sage-upgrade.py` also copies these two files (cf. the `pipestatus` issue with upgrading to 4.5[.1]).
 
> - Upgrading will change scripts like `sage-upgrade`, but of course it has to be running the old versions during the upgrade process.

The new `spkg/install` is aware of that, i.e. deals with an old `sage-upgrade`, too. (See comments in the patch to the former.)
 
> I can understand that patches to these files might help in future versions, but is there any way to deal with 4.5.3 to 4.6?

The patches are intended to especially deal with this (and should ease future upgrades as well).
 
> (Meanwhile, I'm building a vanilla 4.5.3 to test the new upgrade path.)

Fine. I've copied a 4.5.3 installation (*of course*<sup>TM</sup> first running out of disk space) on Ubuntu 9.04 x86 and am currently running the upgrade.

Note that when teeing the output it appears to hang, since the user is prompted, but the output isn't flushed. (One has to type "y" and hit return to start upgrading.) I'll open a ticket for that.



---

archive/issue_comments_089056.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nOoops, it's not `sage-upgrade.py`, its name is `sage-update` (a Python script though).",
    "created_at": "2010-09-24T16:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89056",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:67" align="right">comment:67</div>

Ooops, it's not `sage-upgrade.py`, its name is `sage-update` (a Python script though).



---

archive/issue_comments_089057.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nOuch!\n\nJeroen, you forgot to put the new `spkg/install` into the upgrade path.\n\n(http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install is still the old one, which doesn't work.)",
    "created_at": "2010-09-24T16:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89057",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:68" align="right">comment:68</div>

Ouch!

Jeroen, you forgot to put the new `spkg/install` into the upgrade path.

(http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install is still the old one, which doesn't work.)



---

archive/issue_comments_089058.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@jdemeyer](#comment%3A58):\n> I looks like lines 90 and 91 need a `\\` at the end of the line.\n\nI shouldn't have moved the `||` to the next line (which I later found more readable). ;-)\n\nThe `\\` currently on line 90 (following `&&`) is superfluous, at least for POSIX-conformant shells.",
    "created_at": "2010-09-24T18:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89058",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@jdemeyer](#comment%3A58):
> I looks like lines 90 and 91 need a `\` at the end of the line.

I shouldn't have moved the `||` to the next line (which I later found more readable). ;-)

The `\` currently on line 90 (following `&&`) is superfluous, at least for POSIX-conformant shells.



---

archive/issue_comments_089059.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@nexttime](#comment%3A68):\n> Ouch!\n> \n> Jeroen, you forgot to put the new `spkg/install` into the upgrade path.\n> \n> (http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install is still the old one, which doesn't work.)\n\nShould be fixed (let's hope I didn't mess up anything else).",
    "created_at": "2010-09-24T21:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89059",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@nexttime](#comment%3A68):
> Ouch!
> 
> Jeroen, you forgot to put the new `spkg/install` into the upgrade path.
> 
> (http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install is still the old one, which doesn't work.)

Should be fixed (let's hope I didn't mess up anything else).



---

archive/issue_comments_089060.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nHmmm, this is really odd:\n\nSince the `sage_scripts` spkg has been updated, and is part of `$(BASE)`, and **all** standard packages depend on `$(BASE)`, **all** packages were rebuilt during upgrade.\n\n(This is \"correct\", but except for the number of packages that have to be downloaded, this isn't better than rebuilding the new Sage version from source. Unfortunately, for this release. I wonder if we can improve `spkg/standard/deps`, or avoid updating `sage_scripts` [to often] in the future.)",
    "created_at": "2010-09-25T02:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89060",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:71" align="right">comment:71</div>

Hmmm, this is really odd:

Since the `sage_scripts` spkg has been updated, and is part of `$(BASE)`, and **all** standard packages depend on `$(BASE)`, **all** packages were rebuilt during upgrade.

(This is "correct", but except for the number of packages that have to be downloaded, this isn't better than rebuilding the new Sage version from source. Unfortunately, for this release. I wonder if we can improve `spkg/standard/deps`, or avoid updating `sage_scripts` [to often] in the future.)



---

archive/issue_comments_089061.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nWhich packages do *really* depend on `sage_scripts`?\n\n(I currently have no idea, except perhaps those depending on Python? Fortran?)",
    "created_at": "2010-09-25T02:24:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89061",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:72" align="right">comment:72</div>

Which packages do *really* depend on `sage_scripts`?

(I currently have no idea, except perhaps those depending on Python? Fortran?)



---

archive/issue_comments_089062.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nFirst, after doing\n\n```\n$ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n$ ./sage -upgrade ...\n```\nSage starts without segfaulting.  However, it wasn't totally successful because eclib didn't get rebuilt (nor did most of the packages).  Every log file gets touched, typically with a message like `sage: eclib-20100711 is already installed`, but that's it.  It looks to me as though the upgrade path still doesn't have the right version of \"install\", either in SAGE_ROOT/spkg or in the scripts spkg (which I don't think matters for upgrading).\n\nSecond, of course every package depends on sage_scripts because the script sage-spkg (for example) must be present.  But for upgrading, I don't know which ones really might depend on changes made to it.",
    "created_at": "2010-09-25T03:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89062",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:73" align="right">comment:73</div>

First, after doing

```
$ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
$ ./sage -upgrade ...
```
Sage starts without segfaulting.  However, it wasn't totally successful because eclib didn't get rebuilt (nor did most of the packages).  Every log file gets touched, typically with a message like `sage: eclib-20100711 is already installed`, but that's it.  It looks to me as though the upgrade path still doesn't have the right version of "install", either in SAGE_ROOT/spkg or in the scripts spkg (which I don't think matters for upgrading).

Second, of course every package depends on sage_scripts because the script sage-spkg (for example) must be present.  But for upgrading, I don't know which ones really might depend on changes made to it.



---

archive/issue_comments_089063.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@jhpalmieri](#comment%3A73):\n> [...] it wasn't totally successful because eclib didn't get rebuilt (nor did most of the packages).  Every log file gets touched, typically with a message like `sage: eclib-20100711 is already installed`, but that's it.  It looks to me as though the upgrade path still doesn't have the right version of \"install\", either in SAGE_ROOT/spkg or in the scripts spkg (which I don't think matters for upgrading).\n\nHmmm, did you upgrade to early? Or a cache issue? Worked for me (see above, the machine was completely \"clean\", i.e. lacking any new version of `spkg/install`, and that got properly updated by `sage-update`.\n\n \n> Second, of course every package depends on sage_scripts because the script sage-spkg (for example) must be present.\n\nBut a copy of that is already present (in `spkg/base/`), so it doesn't have to be extracted from an spkg, and is just copied over to `local/bin` (and later overwritten by the one from `sage_scripts`).\n\n> But for upgrading, I don't know which ones really might depend on changes made to it.\n\nI rather thought of dependencies on other scripts. I intentionally did *not* change `sage-spkg`. ;-)",
    "created_at": "2010-09-25T03:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89063",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@jhpalmieri](#comment%3A73):
> [...] it wasn't totally successful because eclib didn't get rebuilt (nor did most of the packages).  Every log file gets touched, typically with a message like `sage: eclib-20100711 is already installed`, but that's it.  It looks to me as though the upgrade path still doesn't have the right version of "install", either in SAGE_ROOT/spkg or in the scripts spkg (which I don't think matters for upgrading).

Hmmm, did you upgrade to early? Or a cache issue? Worked for me (see above, the machine was completely "clean", i.e. lacking any new version of `spkg/install`, and that got properly updated by `sage-update`.

 
> Second, of course every package depends on sage_scripts because the script sage-spkg (for example) must be present.

But a copy of that is already present (in `spkg/base/`), so it doesn't have to be extracted from an spkg, and is just copied over to `local/bin` (and later overwritten by the one from `sage_scripts`).

> But for upgrading, I don't know which ones really might depend on changes made to it.

I rather thought of dependencies on other scripts. I intentionally did *not* change `sage-spkg`. ;-)



---

archive/issue_comments_089064.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nThe copying is done in `spkg/base/dir-0.1-install`:\n\n```sh\n...\n   mymkdir \"../local/bin\"\n   mymkdir \"../local/include\"\n   mymkdir \"../tmp/\"\n   mymkdir \"$BUILD\"\n   mymkdir \"installed/\"\n\n   cp base/sage-* ../local/bin/\n...\n```",
    "created_at": "2010-09-25T04:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89064",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:75" align="right">comment:75</div>

The copying is done in `spkg/base/dir-0.1-install`:

```sh
...
   mymkdir "../local/bin"
   mymkdir "../local/include"
   mymkdir "../tmp/"
   mymkdir "$BUILD"
   mymkdir "installed/"

   cp base/sage-* ../local/bin/
...
```



---

archive/issue_comments_089065.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\n... and the base packages are of course *not* installed with `sage-spkg`:\n\n```make\n########################################\n# Building the base system\n########################################\n$(INST)/$(DIR):\n\t$(INSTALL) \"base/$(DIR)-install 2>&1\" \"tee -a $(SAGE_LOGS)/$(DIR).log\"\n```",
    "created_at": "2010-09-25T04:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89065",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:76" align="right">comment:76</div>

... and the base packages are of course *not* installed with `sage-spkg`:

```make
########################################
# Building the base system
########################################
$(INST)/$(DIR):
	$(INSTALL) "base/$(DIR)-install 2>&1" "tee -a $(SAGE_LOGS)/$(DIR).log"
```



---

archive/issue_comments_089066.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@nexttime](#comment%3A74):\n> I rather thought of dependencies on other scripts. I intentionally did *not* change `sage-spkg`. ;-)\n\nAn example is the (Python-related) `sage-make_relative`, but this could be run **once** at the end. (Or [also] integrated into `sage-spkg`, as suggested by Dave elsewhere.)",
    "created_at": "2010-09-25T04:16:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89066",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@nexttime](#comment%3A74):
> I rather thought of dependencies on other scripts. I intentionally did *not* change `sage-spkg`. ;-)

An example is the (Python-related) `sage-make_relative`, but this could be run **once** at the end. (Or [also] integrated into `sage-spkg`, as suggested by Dave elsewhere.)



---

archive/issue_comments_089067.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\n> Hmmm, did you upgrade to early?\n\nThe file [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install) is still the old one.  Or maybe with the activity on sage.math (with William working on /home, etc.), it got changed back to the old one?",
    "created_at": "2010-09-25T05:00:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89067",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:78" align="right">comment:78</div>

> Hmmm, did you upgrade to early?

The file [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install) is still the old one.  Or maybe with the activity on sage.math (with William working on /home, etc.), it got changed back to the old one?



---

archive/issue_comments_089068.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nReplying to [@jhpalmieri](#comment%3A78):\n> > Hmmm, did you upgrade to early?\n> \n> \n> The file [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install) is still the old one.  Or maybe with the activity on sage.math (with William working on /home, etc.), it got changed back to the old one?\n\nThat's a total mess. It's not *still*, it's **again** the old one!\n\nHopefully trac isn't affected by such...\n\nI only wonder if `spkg/install` gets somehow again overwritten during the upgrade process, since **after** the upgrade, I again have the old version, though I verified the new one was downloaded in the first place (and otherwise I wouldn't have run into the *rebuild all* issue; `sage-spkg` was definitely called with `-f`).\n\nPerhaps it (i.e. the old version) got later again downloaded when doing the *Double-checking...*.\n\nAnd perhaps William should follow Dave and enable the ZIL (on an SSD).",
    "created_at": "2010-09-25T05:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89068",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:79" align="right">comment:79</div>

Replying to [@jhpalmieri](#comment%3A78):
> > Hmmm, did you upgrade to early?
> 
> 
> The file [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/spkg/install) is still the old one.  Or maybe with the activity on sage.math (with William working on /home, etc.), it got changed back to the old one?

That's a total mess. It's not *still*, it's **again** the old one!

Hopefully trac isn't affected by such...

I only wonder if `spkg/install` gets somehow again overwritten during the upgrade process, since **after** the upgrade, I again have the old version, though I verified the new one was downloaded in the first place (and otherwise I wouldn't have run into the *rebuild all* issue; `sage-spkg` was definitely called with `-f`).

Perhaps it (i.e. the old version) got later again downloaded when doing the *Double-checking...*.

And perhaps William should follow Dave and enable the ZIL (on an SSD).



---

archive/issue_comments_089069.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nFrom `sage-sage`:\n\n```sh\nif [ \"$1\" = '-upgrade' -o \"$1\" = \"--upgrade\" ]; then\n    # People often move the Sage install right before doing the upgrade, so it's\n    # important to fix any path hardcoding issues first, or certain library\n    # links will fail.\n    \"$SAGE_ROOT/local/bin/\"sage-location\n\n    # Do it twice since when installing sage-scripts and a running\n    # script changes, it gets confused and exits with an error.\n    # Running again (with the script replaced) then fixes the problem.\n    # Run from a temporary copy of sage-sage\n    shift\n    sage-upgrade \"$@\"\n    if [ $? = 2 ]; then   # this exit codes means the user elected not to do the upgrade at all.\n        exit $?\n    fi\n    echo \"Double checking that all packages have been installed.\"\n    sage-upgrade \"$@\"\n    exit $?\nfi\n```\nBut `sage-update` won't download `spkg/install` twice if *\"No new spkgs\"* are available, which should be the case after a successful (first) upgrade.\n\nSo it must get overwritten from somewhere else...",
    "created_at": "2010-09-25T06:09:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89069",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:80" align="right">comment:80</div>

From `sage-sage`:

```sh
if [ "$1" = '-upgrade' -o "$1" = "--upgrade" ]; then
    # People often move the Sage install right before doing the upgrade, so it's
    # important to fix any path hardcoding issues first, or certain library
    # links will fail.
    "$SAGE_ROOT/local/bin/"sage-location

    # Do it twice since when installing sage-scripts and a running
    # script changes, it gets confused and exits with an error.
    # Running again (with the script replaced) then fixes the problem.
    # Run from a temporary copy of sage-sage
    shift
    sage-upgrade "$@"
    if [ $? = 2 ]; then   # this exit codes means the user elected not to do the upgrade at all.
        exit $?
    fi
    echo "Double checking that all packages have been installed."
    sage-upgrade "$@"
    exit $?
fi
```
But `sage-update` won't download `spkg/install` twice if *"No new spkgs"* are available, which should be the case after a successful (first) upgrade.

So it must get overwritten from somewhere else...



---

archive/issue_comments_089070.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nReplying to [@nexttime](#comment%3A80):\n> So it must get overwritten from somewhere else...\n\nYep, it's overwritten in `sage_scripts-*`'s `spkg-install`, and Jeroen (also) forgot to put the new one into the `sage_scripts` spkg, s.t. **after** the upgrade, the old one is back.\n\n(`deps` and `sage-upgrade` are ok.)",
    "created_at": "2010-09-25T06:32:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89070",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:81" align="right">comment:81</div>

Replying to [@nexttime](#comment%3A80):
> So it must get overwritten from somewhere else...

Yep, it's overwritten in `sage_scripts-*`'s `spkg-install`, and Jeroen (also) forgot to put the new one into the `sage_scripts` spkg, s.t. **after** the upgrade, the old one is back.

(`deps` and `sage-upgrade` are ok.)



---

archive/issue_comments_089071.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nI've successfully built and tested 4.6.alpha1 (from scratch) with a *modified* `deps` file where only the Sage library spkg depends on the Sage scripts, with 32 jobs on an already 50% loaded system.\n\nSo as I expected, adding the scripts to `$(BASE)` is obsolete.\n\nI'll upload a `...deps.v2` later, which then avoids rebuilding *all* packages on every upgrade.",
    "created_at": "2010-09-25T06:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89071",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:82" align="right">comment:82</div>

I've successfully built and tested 4.6.alpha1 (from scratch) with a *modified* `deps` file where only the Sage library spkg depends on the Sage scripts, with 32 jobs on an already 50% loaded system.

So as I expected, adding the scripts to `$(BASE)` is obsolete.

I'll upload a `...deps.v2` later, which then avoids rebuilding *all* packages on every upgrade.



---

archive/issue_comments_089072.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nApologies for the mess, I'm having a look what's going on...",
    "created_at": "2010-09-25T08:48:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89072",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

Apologies for the mess, I'm having a look what's going on...



---

archive/issue_comments_089073.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nCould it be that `spkg/install` is overwritten by `make`?  I've patched `spkg/install` and then built Sage.",
    "created_at": "2010-09-25T08:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89073",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:84" align="right">comment:84</div>

Could it be that `spkg/install` is overwritten by `make`?  I've patched `spkg/install` and then built Sage.



---

archive/issue_comments_089074.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nYes, `make` overwrites `spkg/install` some time in the very beginning of the installation.  Anybody knows where this `spkg/install` comes from?",
    "created_at": "2010-09-25T09:02:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89074",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

Yes, `make` overwrites `spkg/install` some time in the very beginning of the installation.  Anybody knows where this `spkg/install` comes from?



---

archive/issue_comments_089075.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nReplying to [@nexttime](#comment%3A81):\n> Replying to [@nexttime](#comment%3A80):\n> > So it must get overwritten from somewhere else...\n> \n> \n> Yep, it's overwritten in `sage_scripts-*`'s `spkg-install`, and Jeroen (also) forgot to put the new one into the `sage_scripts` spkg, s.t. **after** the upgrade, the old one is back.\n\nYes, this is exactly what happened.",
    "created_at": "2010-09-25T09:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89075",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:86" align="right">comment:86</div>

Replying to [@nexttime](#comment%3A81):
> Replying to [@nexttime](#comment%3A80):
> > So it must get overwritten from somewhere else...
> 
> 
> Yep, it's overwritten in `sage_scripts-*`'s `spkg-install`, and Jeroen (also) forgot to put the new one into the `sage_scripts` spkg, s.t. **after** the upgrade, the old one is back.

Yes, this is exactly what happened.



---

archive/issue_comments_089076.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@nexttime](#comment%3A82):\n> I've successfully built and tested 4.6.alpha1 (from scratch) with a *modified* `deps` file where only the Sage library spkg depends on the Sage scripts, with 32 jobs on an already 50% loaded system.\n> \n> So as I expected, adding the scripts to `$(BASE)` is obsolete.\n\nI added the scripts to `$(BASE)` during the reorganization of `deps` at #8306, because of the problem mentioned in [comment:ticket:8306:29 this comment].  This may well have been overkill.\n\n> I'll upload a `...deps.v2` later, which then avoids rebuilding *all* packages on every upgrade.",
    "created_at": "2010-09-25T09:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89076",
    "user": "https://github.com/qed777"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@nexttime](#comment%3A82):
> I've successfully built and tested 4.6.alpha1 (from scratch) with a *modified* `deps` file where only the Sage library spkg depends on the Sage scripts, with 32 jobs on an already 50% loaded system.
> 
> So as I expected, adding the scripts to `$(BASE)` is obsolete.

I added the scripts to `$(BASE)` during the reorganization of `deps` at #8306, because of the problem mentioned in [comment:ticket:8306:29 this comment].  This may well have been overkill.

> I'll upload a `...deps.v2` later, which then avoids rebuilding *all* packages on every upgrade.



---

archive/issue_comments_089077.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nThis morning, the upgrade procedure isn't working.  I'm getting this in the *termcap* install log (?!), after the new sage_scripts has been installed successfully:\n\n```\nar rc libtermcap.a termcap.o tparam.o version.o\nranlib libtermcap.a\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install -c -m 644 libtermcap.a /Applications/sage_builds/sage-4.6.alpha1-upgrade/local/lib/libtermcap.a\nCreating pipestatus.\ncp: base/sage-*: No such file or directory\ncp: base/testcc.sh: No such file or directory\ncp: base/testcxx.sh: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 105: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 108: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 111: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 120: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 123: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 126: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 129: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 132: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 135: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 138: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 141: standard/newest_version: No such file or directory\n/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 144: standard/newest_version: No such file or directory\nError determining package name using spkg/standard/newest_version script.\nmake[1]: *** [install] Error 1\n```\nLooks like a directory is not set correctly, because for example \"install\" is being run from local/bin/ rather than from spkg/.",
    "created_at": "2010-09-25T14:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89077",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:88" align="right">comment:88</div>

This morning, the upgrade procedure isn't working.  I'm getting this in the *termcap* install log (?!), after the new sage_scripts has been installed successfully:

```
ar rc libtermcap.a termcap.o tparam.o version.o
ranlib libtermcap.a
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install -c -m 644 libtermcap.a /Applications/sage_builds/sage-4.6.alpha1-upgrade/local/lib/libtermcap.a
Creating pipestatus.
cp: base/sage-*: No such file or directory
cp: base/testcc.sh: No such file or directory
cp: base/testcxx.sh: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 105: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 108: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 111: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 120: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 123: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 126: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 129: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 132: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 135: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 138: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 141: standard/newest_version: No such file or directory
/Applications/sage_builds/sage-4.6.alpha1-upgrade/local/bin/install: line 144: standard/newest_version: No such file or directory
Error determining package name using spkg/standard/newest_version script.
make[1]: *** [install] Error 1
```
Looks like a directory is not set correctly, because for example "install" is being run from local/bin/ rather than from spkg/.



---

archive/issue_comments_089078.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nLOL, we should in any case rename our `install` which comes from `sage_scripts` and is first copied to `$SAGE_LOCAL/bin` (which is in the path!).\n\nSo it happened that the scripts spkg got installed during `libtermcap`s installation / `configure`, and that found **our** `install` as a BSD-compatible install.\n\nI'm happy removing `sage_scripts` from `$(BASE)` also solves this! :)",
    "created_at": "2010-09-25T14:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89078",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:89" align="right">comment:89</div>

LOL, we should in any case rename our `install` which comes from `sage_scripts` and is first copied to `$SAGE_LOCAL/bin` (which is in the path!).

So it happened that the scripts spkg got installed during `libtermcap`s installation / `configure`, and that found **our** `install` as a BSD-compatible install.

I'm happy removing `sage_scripts` from `$(BASE)` also solves this! :)



---

archive/issue_comments_089079.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\n(Or `libtermcap` simply ran the first `install` [currently] in the path, which happened to be ours.)\n\nI don't think testing with the upgrade (test) path currently makes sense, not to mention the filesystem trouble.",
    "created_at": "2010-09-25T14:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89079",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:90" align="right">comment:90</div>

(Or `libtermcap` simply ran the first `install` [currently] in the path, which happened to be ours.)

I don't think testing with the upgrade (test) path currently makes sense, not to mention the filesystem trouble.



---

archive/issue_comments_089080.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nIn any case, I think I fixed the issues with `spkg/install` in my upgrade path\n[http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)",
    "created_at": "2010-09-25T15:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89080",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:91" align="right">comment:91</div>

In any case, I think I fixed the issues with `spkg/install` in my upgrade path
[http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)



---

archive/issue_comments_089081.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nI've long since thought that we need a way of stopping people upgrade from incomatible versions. One stratergy might be to only allow upgrades of the same major version, then ensure that incomatible changes are not permitted in the same version. \n\nI've personally given up tryig to use the upgrade option. \n\nDave",
    "created_at": "2010-09-25T15:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89081",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:92" align="right">comment:92</div>

I've long since thought that we need a way of stopping people upgrade from incomatible versions. One stratergy might be to only allow upgrades of the same major version, then ensure that incomatible changes are not permitted in the same version. 

I've personally given up tryig to use the upgrade option. 

Dave



---

archive/issue_comments_089082.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@nexttime](#comment%3A89):\n> I'm happy removing `sage_scripts` from `$(BASE)` also solves this! :)\n\nThat's not really true, but we definitely need a new `sage_scripts` spkg.\n\nI'll provide one later, together with a modified `deps`.\n\n`@`Dave: Nice attitude; I don't think many users will agree with you. If we can make upgrading work, we should IMHO do it.",
    "created_at": "2010-09-25T15:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89082",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@nexttime](#comment%3A89):
> I'm happy removing `sage_scripts` from `$(BASE)` also solves this! :)

That's not really true, but we definitely need a new `sage_scripts` spkg.

I'll provide one later, together with a modified `deps`.

`@`Dave: Nice attitude; I don't think many users will agree with you. If we can make upgrading work, we should IMHO do it.



---

archive/issue_comments_089083.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nReplying to [@jdemeyer](#comment%3A91):\n> In any case, I think I fixed the issues with `spkg/install` in my upgrade path\n> [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)\n\nWell, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):\n\n```sh\nleif@quadriga:~/tmp/sage_scripts-4.6.upgradetest_alpha1$ hg log -v install     \nchangeset:   1582:876225f0dec8\ntag:         4.6.upgradetest_alpha1\nuser:        Jeroen Demeyer <jdemeyer@cage.ugent.be>\ndate:        Sat Sep 25 11:32:06 2010 +0200\nfiles:       install\ndescription:\n#9896: new spkg/install\n\n\nleif@quadriga:~/tmp/sage_scripts-4.6.upgradetest_alpha1$ \n```\n(The file should be in `.hgignore`.)\n\nI don't think the instance in the `sage_scripts` spkg should be copied over `spkg/install` during that spkg's installation; if at all (see below), we should do that **after** the running instance of `spkg/install` has terminated, i.e. from the scripts that start it (`sage-upgrade` and the top-level Makefile, perhaps some other scripts).\n\nBut in principle we don't have to copy it at all; we should just make sure that both are the same. If that's *not* the case, something went very wrong. This is true for both upgrades *and* builds from scratch.",
    "created_at": "2010-09-25T17:17:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89083",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:94" align="right">comment:94</div>

Replying to [@jdemeyer](#comment%3A91):
> In any case, I think I fixed the issues with `spkg/install` in my upgrade path
> [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)

Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):

```sh
leif@quadriga:~/tmp/sage_scripts-4.6.upgradetest_alpha1$ hg log -v install     
changeset:   1582:876225f0dec8
tag:         4.6.upgradetest_alpha1
user:        Jeroen Demeyer <jdemeyer@cage.ugent.be>
date:        Sat Sep 25 11:32:06 2010 +0200
files:       install
description:
#9896: new spkg/install


leif@quadriga:~/tmp/sage_scripts-4.6.upgradetest_alpha1$ 
```
(The file should be in `.hgignore`.)

I don't think the instance in the `sage_scripts` spkg should be copied over `spkg/install` during that spkg's installation; if at all (see below), we should do that **after** the running instance of `spkg/install` has terminated, i.e. from the scripts that start it (`sage-upgrade` and the top-level Makefile, perhaps some other scripts).

But in principle we don't have to copy it at all; we should just make sure that both are the same. If that's *not* the case, something went very wrong. This is true for both upgrades *and* builds from scratch.



---

archive/issue_comments_089084.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@qed777](#comment%3A87):\n> Replying to [@nexttime](#comment%3A82):\n> > So as I expected, adding the scripts to `$(BASE)` is obsolete.\n> \n> \n> I added the scripts to `$(BASE)` during the reorganization of `deps` at #8306, because of the problem mentioned in [comment:ticket:8306:29 this comment].  This may well have been overkill.\n\nLOL (again), \"good catch\". That just happened because some !\"#$%& decided to put the Rpy package **into** R's spkg and recursively call `sage-spkg` from R's `spkg-install`. Perhaps #9906 should be a blocker... ;-)\n\n`sage-spkg` is copied over to `$SAGE_LOCAL/bin` early, in `dir-0.1-install` (and `$SAGE_ROOT/sage` is also present), but not `$SAGE_LOCAL/bin/sage-sage`:\n\n```sh\n...\necho \"Now install rpy\"\n\ncd \"$CUR\"\n\nRPY_VER=rpy2-2.0.8\n\nsage -f \"$RPY_VER\".spkg\nif [ ! -f \"$SAGE_ROOT\"/spkg/installed/\"$RPY_VER\" ]; then\n    echo \"Error installing rpy.\"\n    exit 1\nfi\n...\n```\n(From R's `spkg-install`. If we as a first step call `sage-spkg` there directly, the error from #8306 won't happen.)",
    "created_at": "2010-09-25T18:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89084",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@qed777](#comment%3A87):
> Replying to [@nexttime](#comment%3A82):
> > So as I expected, adding the scripts to `$(BASE)` is obsolete.
> 
> 
> I added the scripts to `$(BASE)` during the reorganization of `deps` at #8306, because of the problem mentioned in [comment:ticket:8306:29 this comment].  This may well have been overkill.

LOL (again), "good catch". That just happened because some !"#$%& decided to put the Rpy package **into** R's spkg and recursively call `sage-spkg` from R's `spkg-install`. Perhaps #9906 should be a blocker... ;-)

`sage-spkg` is copied over to `$SAGE_LOCAL/bin` early, in `dir-0.1-install` (and `$SAGE_ROOT/sage` is also present), but not `$SAGE_LOCAL/bin/sage-sage`:

```sh
...
echo "Now install rpy"

cd "$CUR"

RPY_VER=rpy2-2.0.8

sage -f "$RPY_VER".spkg
if [ ! -f "$SAGE_ROOT"/spkg/installed/"$RPY_VER" ]; then
    echo "Error installing rpy."
    exit 1
fi
...
```
(From R's `spkg-install`. If we as a first step call `sage-spkg` there directly, the error from #8306 won't happen.)



---

archive/issue_comments_089085.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nThe programs \"sage-download_package\", \"sage-latest-online-package\", \"sage-build-debian\" could conceivably be called by sage-spkg during installation, but they shouldn't for any standard packages.  The script \"sage-check-64\" is called by sage-env, so perhaps it should be added to spkg/base?\n\nThe sagetex package should depend on the scripts package, since its spkg-check file runs Sage, and so relies on the presence of the script sage-sage.",
    "created_at": "2010-09-25T19:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89085",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:96" align="right">comment:96</div>

The programs "sage-download_package", "sage-latest-online-package", "sage-build-debian" could conceivably be called by sage-spkg during installation, but they shouldn't for any standard packages.  The script "sage-check-64" is called by sage-env, so perhaps it should be added to spkg/base?

The sagetex package should depend on the scripts package, since its spkg-check file runs Sage, and so relies on the presence of the script sage-sage.



---

archive/issue_comments_089086.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nReplying to [@jhpalmieri](#comment%3A96):\n> The programs \"sage-download_package\", \"sage-latest-online-package\", \"sage-build-debian\" could conceivably be called by sage-spkg during installation, but they shouldn't for any standard packages.\n\nHopefully. ;-)\n\n> The script \"sage-check-64\" is called by sage-env, so perhaps it should be added to spkg/base?\n\nIf we keep it at all (we already had that discussion), it should be and certainly should have earlier been included in `base/`.\n\n> The sagetex package should depend on the scripts package, since its spkg-check file runs Sage, and so relies on the presence of the script sage-sage.\n\nI intended to make the Sage library depend on the Sage scripts; `sagetex` of course (also) depends on the former.",
    "created_at": "2010-09-25T19:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89086",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:97" align="right">comment:97</div>

Replying to [@jhpalmieri](#comment%3A96):
> The programs "sage-download_package", "sage-latest-online-package", "sage-build-debian" could conceivably be called by sage-spkg during installation, but they shouldn't for any standard packages.

Hopefully. ;-)

> The script "sage-check-64" is called by sage-env, so perhaps it should be added to spkg/base?

If we keep it at all (we already had that discussion), it should be and certainly should have earlier been included in `base/`.

> The sagetex package should depend on the scripts package, since its spkg-check file runs Sage, and so relies on the presence of the script sage-sage.

I intended to make the Sage library depend on the Sage scripts; `sagetex` of course (also) depends on the former.



---

archive/issue_comments_089087.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nAnalogous to `SAGE_UPGRADING`, we should perhaps set `SAGE_BUILDING` (or `SAGE_IN_BUILD`) to \"yes\" to prevent undesired behavior like downloading in scripts.",
    "created_at": "2010-09-25T19:59:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89087",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:98" align="right">comment:98</div>

Analogous to `SAGE_UPGRADING`, we should perhaps set `SAGE_BUILDING` (or `SAGE_IN_BUILD`) to "yes" to prevent undesired behavior like downloading in scripts.



---

archive/issue_comments_089088.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nReplying to [@nexttime](#comment%3A95):\n> If we as a first step call `sage-spkg` there directly, the error from #8306 won't happen.\n\nA new R spkg (r-2.10.1.p4) that doesn't depend on the Sage scripts spkg can be found at #10016 (needs review).",
    "created_at": "2010-09-25T23:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89088",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:99" align="right">comment:99</div>

Replying to [@nexttime](#comment%3A95):
> If we as a first step call `sage-spkg` there directly, the error from #8306 won't happen.

A new R spkg (r-2.10.1.p4) that doesn't depend on the Sage scripts spkg can be found at #10016 (needs review).



---

archive/issue_comments_089089.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@nexttime](#comment%3A94):\n> Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):\n\nBut why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?",
    "created_at": "2010-09-26T10:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89089",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@nexttime](#comment%3A94):
> Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):

But why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?



---

archive/issue_comments_089090.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nReplying to [@jdemeyer](#comment%3A100):\n> Replying to [@nexttime](#comment%3A94):\n> > Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):\n> \n> \n> But why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?\n\n`sage_scripts-*.spkg` *contains* the `local/bin/.hg` repository (at the *top* level), and **only** that. If during installation of the spkg a repository already exists in `$SAGE_LOCAL/bin`, it gets synchronized from that, so any file checked into the spkg's repo will be \"copied\" to `$SAGE_LOCAL/bin`. Other files in the spkg's top-level directory (i.e., in `.hgignore`) won't.\n\nIt would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.",
    "created_at": "2010-09-26T13:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89090",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:101" align="right">comment:101</div>

Replying to [@jdemeyer](#comment%3A100):
> Replying to [@nexttime](#comment%3A94):
> > Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):
> 
> 
> But why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?

`sage_scripts-*.spkg` *contains* the `local/bin/.hg` repository (at the *top* level), and **only** that. If during installation of the spkg a repository already exists in `$SAGE_LOCAL/bin`, it gets synchronized from that, so any file checked into the spkg's repo will be "copied" to `$SAGE_LOCAL/bin`. Other files in the spkg's top-level directory (i.e., in `.hgignore`) won't.

It would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.



---

archive/issue_comments_089091.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nReplying to [@nexttime](#comment%3A101):\n> Replying to [@jdemeyer](#comment%3A100):\n> > Replying to [@nexttime](#comment%3A94):\n> > > Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):\n> > \n> > \n> > But why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?\n> \n> \n> `sage_scripts-*.spkg` *contains* the `local/bin/.hg` repository (at the *top* level), and **only** that. If during installation of the spkg a repository already exists in `$SAGE_LOCAL/bin`, it gets synchronized from that, so any file checked into the spkg's repo will be \"copied\" to `$SAGE_LOCAL/bin`. Other files in the spkg's top-level directory (i.e., in `.hgignore`) won't.\n\nSo, this means that `install` should be put in `.hgignore`, right?\n\n> It would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.\n\nAny volunteers to do this? :-)",
    "created_at": "2010-09-27T10:27:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89091",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:102" align="right">comment:102</div>

Replying to [@nexttime](#comment%3A101):
> Replying to [@jdemeyer](#comment%3A100):
> > Replying to [@nexttime](#comment%3A94):
> > > Well, `spkg/install` and `spkg/standard/deps` are current again, but you've checked the (also current) `install` in (s.t. it's now in the Sage scripts repo, and also ends up in `$SAGE_ROOT/local/bin` where the scripts repo of the installation lives):
> > 
> > 
> > But why is it copied to `$SAGE_ROOT/local/bin`? Surely, putting the file under revision control should not have that as consequence?
> 
> 
> `sage_scripts-*.spkg` *contains* the `local/bin/.hg` repository (at the *top* level), and **only** that. If during installation of the spkg a repository already exists in `$SAGE_LOCAL/bin`, it gets synchronized from that, so any file checked into the spkg's repo will be "copied" to `$SAGE_LOCAL/bin`. Other files in the spkg's top-level directory (i.e., in `.hgignore`) won't.

So, this means that `install` should be put in `.hgignore`, right?

> It would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.

Any volunteers to do this? :-)



---

archive/issue_comments_089092.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nReplying to [@jdemeyer](#comment%3A102):\n> So, this means that `install` should be put in `.hgignore`, right?\n\nYep. (Or one could `hg rename` it to something else, s.t. it doesn't get confused with a BSD `install`.) \n\n> > It would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.\n> \n> \n> Any volunteers to do this? :-)\n\nYou? But that should be done **after** this ticket and especially #9433, which adds a new root repository (and deals with files like `install` currently *not* under revision control), have been merged.",
    "created_at": "2010-09-27T10:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89092",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:103" align="right">comment:103</div>

Replying to [@jdemeyer](#comment%3A102):
> So, this means that `install` should be put in `.hgignore`, right?

Yep. (Or one could `hg rename` it to something else, s.t. it doesn't get confused with a BSD `install`.) 

> > It would perhaps be less confusing if that spkg had the same structure as almost all others, i.e. the files *to be installed* in `src/` (including the `local/bin` repo), and the files that *manage the installation* in the top-level directory, `sage_scripts-*/`, along with their **own**, separate, Mercurial repository.
> 
> 
> Any volunteers to do this? :-)

You? But that should be done **after** this ticket and especially #9433, which adds a new root repository (and deals with files like `install` currently *not* under revision control), have been merged.



---

archive/issue_comments_089093.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nReplying to [@nexttime](#comment%3A103):\n> Replying to [@jdemeyer](#comment%3A102):\n> > So, this means that `install` should be put in `.hgignore`, right?\n> \n> \n> Yep. (Or one could `hg rename` it to something else, s.t. it doesn't get confused with a BSD `install`.) \n\nP.S.: In case you rename it, if its name starts with `sage-`, it will also be copied during an *install/build from scratch* (but then also wouldn't be confused with some system tool).",
    "created_at": "2010-09-27T11:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89093",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:104" align="right">comment:104</div>

Replying to [@nexttime](#comment%3A103):
> Replying to [@jdemeyer](#comment%3A102):
> > So, this means that `install` should be put in `.hgignore`, right?
> 
> 
> Yep. (Or one could `hg rename` it to something else, s.t. it doesn't get confused with a BSD `install`.) 

P.S.: In case you rename it, if its name starts with `sage-`, it will also be copied during an *install/build from scratch* (but then also wouldn't be confused with some system tool).



---

archive/issue_comments_089094.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.gz)**\n\nImproved new `spkg/standard/deps`. Based on Sage 4.6.alpha1. (Not under revision control.)",
    "created_at": "2010-09-27T21:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89094",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.gz)**

Improved new `spkg/standard/deps`. Based on Sage 4.6.alpha1. (Not under revision control.)



---

archive/issue_comments_089095.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.diff.gz)**\n\nDiff of improved new `spkg/standard/deps` against that of Sage 4.6.alpha1.",
    "created_at": "2010-09-27T21:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89095",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v2b.diff.gz)**

Diff of improved new `spkg/standard/deps` against that of Sage 4.6.alpha1.



---

archive/issue_comments_089096.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__install.v2b.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz)**\n\nImproved new `spkg/install`. Based on Sage 4.6.alpha1. (Not under revision control.)",
    "created_at": "2010-09-27T21:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89096",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__install.v2b.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz)**

Improved new `spkg/install`. Based on Sage 4.6.alpha1. (Not under revision control.)



---

archive/issue_comments_089097.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__install.v2b.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.diff.gz)**\n\nDiff of improved new `spkg/install` against that of Sage 4.6.alpha1.",
    "created_at": "2010-09-27T21:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89097",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__install.v2b.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.diff.gz)**

Diff of improved new `spkg/install` against that of Sage 4.6.alpha1.



---

archive/issue_comments_089098.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nUpdated upgrade path: [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)",
    "created_at": "2010-09-28T12:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89098",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:105" align="right">comment:105</div>

Updated upgrade path: [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/)



---

archive/issue_comments_089099.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,17 @@\n \n **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**\n \n-On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in the [comment below](#comment%3A63) (regarding `LDSHARED`).\n+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:\n \n+```sh\n+$ touch spkg/installed/iconv-1.13.1.p3\n+```\n+(This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n+\n+On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or do the following **before** running `./sage -upgrade ...`:\n+\n+```sh\n+$ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n+```\n+(See also the [comment below](#comment%3A63) regarding `LDSHARED`.)\n+\n``````\n",
    "created_at": "2010-09-28T21:12:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89099",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,17 @@
 
 **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**
 
-On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or follow the instructions given in the [comment below](#comment%3A63) (regarding `LDSHARED`).
+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:
 
+```sh
+$ touch spkg/installed/iconv-1.13.1.p3
+```
+(This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
+
+On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or do the following **before** running `./sage -upgrade ...`:
+
+```sh
+$ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
+```
+(See also the [comment below](#comment%3A63) regarding `LDSHARED`.)
+
``````




---

archive/issue_comments_089100.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nUpgraded succesfully from 4.5.3 on a Mac OS X 10.4 PPC system.",
    "created_at": "2010-09-29T08:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89100",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:107" align="right">comment:107</div>

Upgraded succesfully from 4.5.3 on a Mac OS X 10.4 PPC system.



---

archive/issue_comments_089101.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\nReplying to [@jdemeyer](#comment%3A107):\n> Upgraded succesfully from 4.5.3 on a Mac OS X 10.4 PPC system.\n\nI did so on Ubuntu 9.04 x86 (in-place), and on Ubuntu 10.04 x86_64 (in a renamed directory), too.\n\n`ptestlong` passed all tests, but Sphinx raises an exception related to `linear_programming` on both systems:\n\n```\n...\nsphinx-build -b html -d /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/doctrees/en/constructions    /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/en/constructions /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/html/en/constructions\nRunning Sphinx v0.6.3\nloading pickled environment... done\nbuilding [html]: targets for 18 source files that are out of date\nupdating environment: [config changed] 17 added, 0 changed, 1 removed\nreading sources... [  5%] algebraic_geometry\nreading sources... [ 11%] calculus\nreading sources... [ 17%] contributions\nreading sources... [ 23%] elliptic_curves\nreading sources... [ 29%] graph_theory\nreading sources... [ 35%] groups\nreading sources... [ 41%] index\nreading sources... [ 47%] interface_issues\nreading sources... [ 52%] linear_algebra\nreading sources... [ 58%] linear_codes\nreading sources... [ 64%] modular_forms\nreading sources... [ 70%] number_fields\nreading sources... [ 76%] number_theory\nreading sources... [ 82%] plotting\nreading sources... [ 88%] polynomials\nreading sources... [ 94%] rep_theory\nreading sources... [100%] rings\n\nlooking for now-outdated files... none found\npickling environment... done\nchecking consistency... done\npreparing documents... done\nwriting output... [  5%] algebraic_geometry\nwriting output... [ 11%] calculus\nwriting output... [ 16%] contributions\nwriting output... [ 22%] elliptic_curves\nwriting output... [ 27%] graph_theory\nwriting output... [ 33%] groups\nwriting output... [ 38%] index\nwriting output... [ 44%] interface_issues\nwriting output... [ 50%] linear_algebra\nwriting output... [ 55%] linear_codes\nwriting output... [ 61%] linear_programming\n\nException occurred:\n  File \"/home/leif/Sage/sage-4.5.3-for-v2b-upgraded/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg/sphinx/environment.py\", line 934, in get_toc_for\n    toc = self.tocs[docname].deepcopy()\nKeyError: 'linear_programming'\nThe full traceback has been saved in /tmp/sphinx-err-BbYhGC.log, if you want to report the issue to the author.\nPlease also report this if it was a user error, so that a better error message can be provided next time.\nSend reports to sphinx-dev@googlegroups.com. Thanks!\nBuild finished.  The built documents can be found in /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/html/en/constructions\n...\n```\nAfter removing the doctrees and rebuilding the documentation, this doesn't happen; `linear_programming` had been moved from *Constructions* to the *Thematic Tutorials*. (Note that Sage completely ignores any Sphinx errors, but that's just another bug.)",
    "created_at": "2010-09-29T14:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89101",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:108" align="right">comment:108</div>

Replying to [@jdemeyer](#comment%3A107):
> Upgraded succesfully from 4.5.3 on a Mac OS X 10.4 PPC system.

I did so on Ubuntu 9.04 x86 (in-place), and on Ubuntu 10.04 x86_64 (in a renamed directory), too.

`ptestlong` passed all tests, but Sphinx raises an exception related to `linear_programming` on both systems:

```
...
sphinx-build -b html -d /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/doctrees/en/constructions    /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/en/constructions /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/html/en/constructions
Running Sphinx v0.6.3
loading pickled environment... done
building [html]: targets for 18 source files that are out of date
updating environment: [config changed] 17 added, 0 changed, 1 removed
reading sources... [  5%] algebraic_geometry
reading sources... [ 11%] calculus
reading sources... [ 17%] contributions
reading sources... [ 23%] elliptic_curves
reading sources... [ 29%] graph_theory
reading sources... [ 35%] groups
reading sources... [ 41%] index
reading sources... [ 47%] interface_issues
reading sources... [ 52%] linear_algebra
reading sources... [ 58%] linear_codes
reading sources... [ 64%] modular_forms
reading sources... [ 70%] number_fields
reading sources... [ 76%] number_theory
reading sources... [ 82%] plotting
reading sources... [ 88%] polynomials
reading sources... [ 94%] rep_theory
reading sources... [100%] rings

looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [  5%] algebraic_geometry
writing output... [ 11%] calculus
writing output... [ 16%] contributions
writing output... [ 22%] elliptic_curves
writing output... [ 27%] graph_theory
writing output... [ 33%] groups
writing output... [ 38%] index
writing output... [ 44%] interface_issues
writing output... [ 50%] linear_algebra
writing output... [ 55%] linear_codes
writing output... [ 61%] linear_programming

Exception occurred:
  File "/home/leif/Sage/sage-4.5.3-for-v2b-upgraded/local/lib/python2.6/site-packages/Sphinx-0.6.3-py2.6.egg/sphinx/environment.py", line 934, in get_toc_for
    toc = self.tocs[docname].deepcopy()
KeyError: 'linear_programming'
The full traceback has been saved in /tmp/sphinx-err-BbYhGC.log, if you want to report the issue to the author.
Please also report this if it was a user error, so that a better error message can be provided next time.
Send reports to sphinx-dev@googlegroups.com. Thanks!
Build finished.  The built documents can be found in /home/leif/Sage/sage-4.5.3-for-v2b-upgraded/devel/sage/doc/output/html/en/constructions
...
```
After removing the doctrees and rebuilding the documentation, this doesn't happen; `linear_programming` had been moved from *Constructions* to the *Thematic Tutorials*. (Note that Sage completely ignores any Sphinx errors, but that's just another bug.)



---

archive/issue_comments_089102.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nBtw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.\n\n(The `sage_scripts` spkg currently \"changes\" in **any** new Sage version, which is sub-optimal anyway.)",
    "created_at": "2010-09-29T14:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89102",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:109" align="right">comment:109</div>

Btw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.

(The `sage_scripts` spkg currently "changes" in **any** new Sage version, which is sub-optimal anyway.)



---

archive/issue_comments_089103.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,7 +17,7 @@\n \n ---\n \n-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**\n+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**\n \n If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:\n \n``````\n",
    "created_at": "2010-10-04T19:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89103",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,7 +17,7 @@
 
 ---
 
-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha1/**
+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**
 
 If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:
 
``````




---

archive/issue_comments_089104.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nNew upgrade path based on sage-4.6.alpha2:\n[http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/)",
    "created_at": "2010-10-04T19:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89104",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:110" align="right">comment:110</div>

New upgrade path based on sage-4.6.alpha2:
[http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/)



---

archive/issue_comments_089105.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nI'm confused again.  On my mac, it seems like \n\n```sh\n$ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n```\nsolves the problem: I did this and then upgraded from 4.5.3 to 4.6.alpha**3**, and did not have the reported problem and all tests pass in sage/libs/pari.  So do we need the various patches?  They may be good ideas, but are they necessary for this ticket?  (I have only seen a problem on OS X, so I can't easily test what works and what doesn't on other systems.)\n\nAlso, do we need to advertise the need to set LDSHARED like this?  Or can we set it automatically during the upgrade process?",
    "created_at": "2010-10-11T22:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89105",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:111" align="right">comment:111</div>

I'm confused again.  On my mac, it seems like 

```sh
$ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
```
solves the problem: I did this and then upgraded from 4.5.3 to 4.6.alpha**3**, and did not have the reported problem and all tests pass in sage/libs/pari.  So do we need the various patches?  They may be good ideas, but are they necessary for this ticket?  (I have only seen a problem on OS X, so I can't easily test what works and what doesn't on other systems.)

Also, do we need to advertise the need to set LDSHARED like this?  Or can we set it automatically during the upgrade process?



---

archive/issue_comments_089106.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nReplying to [@nexttime](#comment%3A109):\n> Btw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.\n\nWith #10016 merged into 4.6.alpha2, should we update `deps`?",
    "created_at": "2010-10-17T01:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89106",
    "user": "https://github.com/qed777"
}
```

<div id="comment:112" align="right">comment:112</div>

Replying to [@nexttime](#comment%3A109):
> Btw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.

With #10016 merged into 4.6.alpha2, should we update `deps`?



---

archive/issue_comments_089107.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nReplying to [@qed777](#comment%3A112):\n> Replying to [@nexttime](#comment%3A109):\n> > Btw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.\n> \n> \n> With #10016 merged into 4.6.alpha2, should we update `deps`?\n\nYes, we can... ;-)\n\n(The modifications are already all in, but currently commented out, including the additions / changes we need once RPy becomes a stand-alone spkg. I can perhaps upload v3 versions tomorrow, or otherwise feel free to do it.)",
    "created_at": "2010-10-17T01:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89107",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:113" align="right">comment:113</div>

Replying to [@qed777](#comment%3A112):
> Replying to [@nexttime](#comment%3A109):
> > Btw, if somebody reviewed #10016 (and that got merged into Sage 4.6), we could drop the dependency of R on `sage_scripts`, which would further decrease the number of packages that have to be rebuilt during an upgrade.
> 
> 
> With #10016 merged into 4.6.alpha2, should we update `deps`?

Yes, we can... ;-)

(The modifications are already all in, but currently commented out, including the additions / changes we need once RPy becomes a stand-alone spkg. I can perhaps upload v3 versions tomorrow, or otherwise feel free to do it.)



---

archive/issue_comments_089108.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nReplying to [@jhpalmieri](#comment%3A111):\n> I'm confused again.  On my mac, it seems like \n\n\n```sh\n$ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n```\n> solves the problem: I did this and then upgraded from 4.5.3 to 4.6.alpha**3**, and did not have the reported problem and all tests pass in sage/libs/pari.\n\n`ptestlong`? Some extension modules should still refer to the *old* PARI shared library, which can cause trouble. Did you do anything else except `export LDSHARED=...` and `./sage -upgrade /path/to/alpha3`?\n\n> So do we need the various patches?\n\nCurrently just four IIRC... ;-)\n\n> They may be good ideas, but are they necessary for this ticket?  (I have only seen a problem on OS X, so I can't easily test what works and what doesn't on other systems.)\n\nWhile setting `LDSHARED` is not necessary on systems other than MacOS X (at least as far as I know / on the supported platforms), the patches make upgrading more \"reliable\". (I personally had to play a little to make upgrading fail on my Linux boxes I must admit, but without the patches it definitely *can* fail. Also, we'd run into similar problems when it comes to upgrading e.g. MPIR; to make *that* work, we'll in addition have to add some more dependencies to `module_list.py`.)\n \n> Also, do we need to advertise the need to set LDSHARED like this?  Or can we set it automatically during the upgrade process?\n\nI intended to do so, there are just (too) many ways how one could do this. ;-) (Basically e.g. adding a few Darwin-specific lines to `devel/sage/setup.py`, which is part of the `sage-x.y.z.spkg`, which \"of course\" gets updated upon *every* upgrade, regardless if there are any changes to the Sage library at all - besides `version.py` which is or will become redundant anyway.)",
    "created_at": "2010-10-17T02:39:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89108",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:114" align="right">comment:114</div>

Replying to [@jhpalmieri](#comment%3A111):
> I'm confused again.  On my mac, it seems like 


```sh
$ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
```
> solves the problem: I did this and then upgraded from 4.5.3 to 4.6.alpha**3**, and did not have the reported problem and all tests pass in sage/libs/pari.

`ptestlong`? Some extension modules should still refer to the *old* PARI shared library, which can cause trouble. Did you do anything else except `export LDSHARED=...` and `./sage -upgrade /path/to/alpha3`?

> So do we need the various patches?

Currently just four IIRC... ;-)

> They may be good ideas, but are they necessary for this ticket?  (I have only seen a problem on OS X, so I can't easily test what works and what doesn't on other systems.)

While setting `LDSHARED` is not necessary on systems other than MacOS X (at least as far as I know / on the supported platforms), the patches make upgrading more "reliable". (I personally had to play a little to make upgrading fail on my Linux boxes I must admit, but without the patches it definitely *can* fail. Also, we'd run into similar problems when it comes to upgrading e.g. MPIR; to make *that* work, we'll in addition have to add some more dependencies to `module_list.py`.)
 
> Also, do we need to advertise the need to set LDSHARED like this?  Or can we set it automatically during the upgrade process?

I intended to do so, there are just (too) many ways how one could do this. ;-) (Basically e.g. adding a few Darwin-specific lines to `devel/sage/setup.py`, which is part of the `sage-x.y.z.spkg`, which "of course" gets updated upon *every* upgrade, regardless if there are any changes to the Sage library at all - besides `version.py` which is or will become redundant anyway.)



---

archive/issue_comments_089109.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nReplying to [@nexttime](#comment%3A113):\n> (The modifications are already all in, but currently commented out, including the additions / changes we need once RPy becomes a stand-alone spkg. I can perhaps upload v3 versions tomorrow, or otherwise feel free to do it.)\n\nSetting status to \"needs_work\" because of this comment.",
    "created_at": "2010-10-18T07:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89109",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:115" align="right">comment:115</div>

Replying to [@nexttime](#comment%3A113):
> (The modifications are already all in, but currently commented out, including the additions / changes we need once RPy becomes a stand-alone spkg. I can perhaps upload v3 versions tomorrow, or otherwise feel free to do it.)

Setting status to "needs_work" because of this comment.



---

archive/issue_events_127354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-18T07:10:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127354"
}
```



---

archive/issue_events_127355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-10-18T07:10:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127355"
}
```



---

archive/issue_comments_089110.json:
```json
{
    "body": "Work Issues: **Perhaps rebase module_list patch on alpha3; remove sage_scripts from R's deps**",
    "created_at": "2010-10-18T08:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89110",
    "user": "https://github.com/nexttime"
}
```

Work Issues: **Perhaps rebase module_list patch on alpha3; remove sage_scripts from R's deps**



---

archive/issue_comments_089111.json:
```json
{
    "body": "Improved new `spkg/standard/deps`. Based on Sage 4.6.alpha**3**, removes `sage_scripts` from R's deps. (Not under revision control.)",
    "created_at": "2010-10-18T13:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89111",
    "user": "https://github.com/nexttime"
}
```

Improved new `spkg/standard/deps`. Based on Sage 4.6.alpha**3**, removes `sage_scripts` from R's deps. (Not under revision control.)



---

archive/issue_comments_089112.json:
```json
{
    "body": "Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz)**\n\nAttachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v3.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.diff.gz)**\n\nDiff of improved new `spkg/standard/deps` against that of Sage 4.6.alpha**3**.",
    "created_at": "2010-10-18T13:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89112",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz)**

Attachment: **[trac_9896-SAGE_ROOT__spkg__standard__deps.v3.diff.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.diff.gz)**

Diff of improved new `spkg/standard/deps` against that of Sage 4.6.alpha**3**.



---

archive/issue_comments_089113.json:
```json
{
    "body": "Changed work issues from **Perhaps rebase module_list patch on alpha3; remove sage_scripts from R's deps** to **Provide a patch (to setup.py) which fixes the Darwin linker issue.**",
    "created_at": "2010-10-18T13:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89113",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Perhaps rebase module_list patch on alpha3; remove sage_scripts from R's deps** to **Provide a patch (to setup.py) which fixes the Darwin linker issue.**



---

archive/issue_comments_089114.json:
```json
{
    "body": "<div id=\"comment:117\" align=\"right\">comment:117</div>\n\nSince #10016 has been merged into Sage 4.6.alpha2, I've attached a new version (v3) of `spkg/standard/deps`, which just removes the dependency of R on `sage_scripts`.\n\nHere's a diff between v2b and v3:\n\n```diff\n--- trac_9896-SAGE_ROOT__spkg__standard__deps.v2b\t2010-09-27 18:50:32.000000000 +0200\n+++ trac_9896-SAGE_ROOT__spkg__standard__deps.v3\t2010-10-18 14:57:44.000000000 +0200\n@@ -21,9 +21,7 @@\n # Rather than making *all* standard packages depend on SAGE_SCRIPTS (which\n # triggers the rebuild of *every* package on an upgrade), add SAGE_SCRIPTS\n # to the dependencies of only those packages that rely on them.\n-# These are:\n-# - R until #10016 is merged (replacing \"sage -f ...\" by a call to sage-spkg),\n-#     or until #9906 is merged (which moves the RPy spkg out of R's)\n+# These are (as of Sage 4.6.alpha3):\n # - The Sage library, $(SAGE)\n # - sagetex, but this in turn depends on $(SAGE)\n \n@@ -368,15 +366,10 @@\n $(INST)/$(MAXIMA): $(BASE) $(INST)/$(ECL)\n \t$(INSTALL) \"$(SAGE_SPKG) $(MAXIMA) 2>&1\" \"tee -a $(SAGE_LOGS)/$(MAXIMA).log\"\n \n-# Until #10016 (or #9906) gets merged, R depends on SAGE_SCRIPTS, because it\n-# installs the contained RPy spkg with \"sage -f\", which also requires sage-sage:\n-$(INST)/$(R): $(BASE) $(INST)/$(SAGE_SCRIPTS) \\\n-\t      $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)\n+# Note that even with a separate RPy spkg (#9906), Sage's R will still depend on\n+# Python (but does no longer on SAGE_SCRIPTS, #10016):\n+$(INST)/$(R): $(BASE) $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)\n \t$(INSTALL) \"$(SAGE_SPKG) $(R) 2>&1\" \"tee -a $(SAGE_LOGS)/$(R).log\"\n-# Note that even with a separate RPy spkg (#9906), Sage's R still depends on\n-# Python (but no longer on SAGE_SCRIPTS, see above):\n-# $(INST)/$(R): $(BASE) $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)\n-# \t$(INSTALL) \"$(SAGE_SPKG) $(R) 2>&1\" \"tee -a $(SAGE_LOGS)/$(R).log\"\n \n # Needed when #9906 gets merged (moving RPy out of R's spkg):\n # $(INST)/$(RPY): $(BASE) $(INST)/$(PYTHON) $(INST)/$(R)\n```\n\n(Note that neither `spkg/install` nor `spkg/standard/deps` have changed between Sage 4.6.alpha1 and 4.6.alpha3, so there's no new v3 of the former, and the diffs apply to alpha1...alpha3. Also, although `devel/sage/module_list.py` has changed, the current patch here still applies to Sage 4.6.alpha3 without rejects.)",
    "created_at": "2010-10-18T13:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89114",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:117" align="right">comment:117</div>

Since #10016 has been merged into Sage 4.6.alpha2, I've attached a new version (v3) of `spkg/standard/deps`, which just removes the dependency of R on `sage_scripts`.

Here's a diff between v2b and v3:

```diff
--- trac_9896-SAGE_ROOT__spkg__standard__deps.v2b	2010-09-27 18:50:32.000000000 +0200
+++ trac_9896-SAGE_ROOT__spkg__standard__deps.v3	2010-10-18 14:57:44.000000000 +0200
@@ -21,9 +21,7 @@
 # Rather than making *all* standard packages depend on SAGE_SCRIPTS (which
 # triggers the rebuild of *every* package on an upgrade), add SAGE_SCRIPTS
 # to the dependencies of only those packages that rely on them.
-# These are:
-# - R until #10016 is merged (replacing "sage -f ..." by a call to sage-spkg),
-#     or until #9906 is merged (which moves the RPy spkg out of R's)
+# These are (as of Sage 4.6.alpha3):
 # - The Sage library, $(SAGE)
 # - sagetex, but this in turn depends on $(SAGE)
 
@@ -368,15 +366,10 @@
 $(INST)/$(MAXIMA): $(BASE) $(INST)/$(ECL)
 	$(INSTALL) "$(SAGE_SPKG) $(MAXIMA) 2>&1" "tee -a $(SAGE_LOGS)/$(MAXIMA).log"
 
-# Until #10016 (or #9906) gets merged, R depends on SAGE_SCRIPTS, because it
-# installs the contained RPy spkg with "sage -f", which also requires sage-sage:
-$(INST)/$(R): $(BASE) $(INST)/$(SAGE_SCRIPTS) \
-	      $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)
+# Note that even with a separate RPy spkg (#9906), Sage's R will still depend on
+# Python (but does no longer on SAGE_SCRIPTS, #10016):
+$(INST)/$(R): $(BASE) $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)
 	$(INSTALL) "$(SAGE_SPKG) $(R) 2>&1" "tee -a $(SAGE_LOGS)/$(R).log"
-# Note that even with a separate RPy spkg (#9906), Sage's R still depends on
-# Python (but no longer on SAGE_SCRIPTS, see above):
-# $(INST)/$(R): $(BASE) $(INST)/$(PYTHON) $(INST)/$(ATLAS) $(INST)/$(ICONV) $(INST)/$(FORTRAN)
-# 	$(INSTALL) "$(SAGE_SPKG) $(R) 2>&1" "tee -a $(SAGE_LOGS)/$(R).log"
 
 # Needed when #9906 gets merged (moving RPy out of R's spkg):
 # $(INST)/$(RPY): $(BASE) $(INST)/$(PYTHON) $(INST)/$(R)
```

(Note that neither `spkg/install` nor `spkg/standard/deps` have changed between Sage 4.6.alpha1 and 4.6.alpha3, so there's no new v3 of the former, and the diffs apply to alpha1...alpha3. Also, although `devel/sage/module_list.py` has changed, the current patch here still applies to Sage 4.6.alpha3 without rejects.)



---

archive/issue_comments_089115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,19 +17,40 @@\n \n ---\n \n-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**\n+## How to test:\n \n-If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:\n+(There's not yet an upgrade path to Sage 4.6.alpha**3**.)\n+\n+**Upgrade path for testing the fixes (v2b versions): http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**\n+\n+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n ```sh\n $ touch spkg/installed/iconv-1.13.1.p3\n ```\n (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n \n-On MacOS X, one should at the moment either do an \"in-place\" upgrade (without renaming the directory / copying the original installation) or do the following **before** running `./sage -upgrade ...`:\n+On MacOS X, one should at the moment **either** do an \"in-place\" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:\n \n ```sh\n $ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n ```\n (See also the [comment below](#comment%3A63) regarding `LDSHARED`.)\n \n+Do the upgrade:\n+\n+```sh\n+$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/\n+```\n+Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) \n+\n+---\n+\n+## To the release manager / How to merge this ticket:\n+* Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz\n+* Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz\n+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**\n+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**\n+* **Not yet present**: Apply the patch to `devel/sage/setup.py` to the **Sage library repository**\n+* Run `./sage -sdist ...`\n+\n``````\n",
    "created_at": "2010-10-18T14:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89115",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,19 +17,40 @@
 
 ---
 
-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**
+## How to test:
 
-If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems other than Cygwin, HP-UX and Solaris, do the following **before** starting the upgrade:
+(There's not yet an upgrade path to Sage 4.6.alpha**3**.)
+
+**Upgrade path for testing the fixes (v2b versions): http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**
+
+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
 ```sh
 $ touch spkg/installed/iconv-1.13.1.p3
 ```
 (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
 
-On MacOS X, one should at the moment either do an "in-place" upgrade (without renaming the directory / copying the original installation) or do the following **before** running `./sage -upgrade ...`:
+On MacOS X, one should at the moment **either** do an "in-place" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:
 
 ```sh
 $ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
 ```
 (See also the [comment below](#comment%3A63) regarding `LDSHARED`.)
 
+Do the upgrade:
+
+```sh
+$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/
+```
+Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) 
+
+---
+
+## To the release manager / How to merge this ticket:
+* Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz
+* Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz
+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**
+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**
+* **Not yet present**: Apply the patch to `devel/sage/setup.py` to the **Sage library repository**
+* Run `./sage -sdist ...`
+
``````




---

archive/issue_comments_089116.json:
```json
{
    "body": "Add \"install\" to .hgignore, patch for sage-scripts",
    "created_at": "2010-10-18T16:02:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89116",
    "user": "https://github.com/jdemeyer"
}
```

Add "install" to .hgignore, patch for sage-scripts



---

archive/issue_comments_089117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -48,6 +48,7 @@\n \n ## To the release manager / How to merge this ticket:\n * Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz\n+* Apply the patch `9896_scripts_hgignore.patch` to the sage-scripts repository.\n * Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz\n * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**\n * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**\n``````\n",
    "created_at": "2010-10-18T16:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89117",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -48,6 +48,7 @@
 
 ## To the release manager / How to merge this ticket:
 * Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz
+* Apply the patch `9896_scripts_hgignore.patch` to the sage-scripts repository.
 * Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz
 * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**
 * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**
``````




---

archive/issue_comments_089118.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">comment:119</div>\n\nAttachment: **[9896_scripts_hgignore.patch.gz](https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz)**",
    "created_at": "2010-10-18T16:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89118",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:119" align="right">comment:119</div>

Attachment: **[9896_scripts_hgignore.patch.gz](https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz)**



---

archive/issue_comments_089119.json:
```json
{
    "body": "Attachment: **[trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz)**\n\nSage library patch. Fixes Darwin linker issue (in `setup.py`). Based on Sage 4.6.alpha3.",
    "created_at": "2010-10-19T10:03:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89119",
    "user": "https://github.com/nexttime"
}
```

Attachment: **[trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz)**

Sage library patch. Fixes Darwin linker issue (in `setup.py`). Based on Sage 4.6.alpha3.



---

archive/issue_comments_089120.json:
```json
{
    "body": "Changed work issues from **Provide a patch (to setup.py) which fixes the Darwin linker issue.** to **Update upgrade path for testing**",
    "created_at": "2010-10-19T10:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89120",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Provide a patch (to setup.py) which fixes the Darwin linker issue.** to **Update upgrade path for testing**



---

archive/issue_comments_089121.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\nI've attached a patch that avoids manually setting `LDSHARED` on MacOS X.\n\nOf course the upgrade path has yet to be updated for testing this, but the patch can be reviewed.",
    "created_at": "2010-10-19T10:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89121",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:120" align="right">comment:120</div>

I've attached a patch that avoids manually setting `LDSHARED` on MacOS X.

Of course the upgrade path has yet to be updated for testing this, but the patch can be reviewed.



---

archive/issue_comments_089122.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,12 +30,12 @@\n ```\n (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n \n-On MacOS X, one should at the moment **either** do an \"in-place\" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:\n+On MacOS X, one should **at the moment** **either** do an \"in-place\" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:\n \n ```sh\n $ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n ```\n-(See also the [comment below](#comment%3A63) regarding `LDSHARED`.)\n+(See also the [comment below](#comment%3A63) regarding `LDSHARED`. This will no longer be necessary when the second patch to the Sage library, `trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch`, has been merged into the upgrade path.)\n \n Do the upgrade:\n \n@@ -48,10 +48,10 @@\n \n ## To the release manager / How to merge this ticket:\n * Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz\n-* Apply the patch `9896_scripts_hgignore.patch` to the sage-scripts repository.\n * Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz\n-* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**\n+* Apply https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz to the **Sage scripts repository** (Not mandatory, but helpful.)\n+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **Sage scripts repository**\n * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**\n-* **Not yet present**: Apply the patch to `devel/sage/setup.py` to the **Sage library repository**\n+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz to the **Sage library repository**\n * Run `./sage -sdist ...`\n \n``````\n",
    "created_at": "2010-10-19T10:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89122",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,12 +30,12 @@
 ```
 (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
 
-On MacOS X, one should at the moment **either** do an "in-place" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:
+On MacOS X, one should **at the moment** **either** do an "in-place" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:
 
 ```sh
 $ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
 ```
-(See also the [comment below](#comment%3A63) regarding `LDSHARED`.)
+(See also the [comment below](#comment%3A63) regarding `LDSHARED`. This will no longer be necessary when the second patch to the Sage library, `trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch`, has been merged into the upgrade path.)
 
 Do the upgrade:
 
@@ -48,10 +48,10 @@
 
 ## To the release manager / How to merge this ticket:
 * Replace `spkg/install` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__install.v2b.gz
-* Apply the patch `9896_scripts_hgignore.patch` to the sage-scripts repository.
 * Replace `spkg/standard/deps` by https://github.com/sagemath/sage/files/ticket9896/trac_9896-SAGE_ROOT__spkg__standard__deps.v3.gz
-* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **scripts repository**
+* Apply https://github.com/sagemath/sage/files/ticket9896/9896_scripts_hgignore.patch.gz to the **Sage scripts repository** (Not mandatory, but helpful.)
+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-propagate_upgrading_to_install_script-scripts_repo.patch.gz to the **Sage scripts repository**
 * Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz to the **Sage library repository**
-* **Not yet present**: Apply the patch to `devel/sage/setup.py` to the **Sage library repository**
+* Apply https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz to the **Sage library repository**
 * Run `./sage -sdist ...`
 
``````




---

archive/issue_comments_089123.json:
```json
{
    "body": "Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jeroen Demeyer**",
    "created_at": "2010-10-19T10:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89123",
    "user": "https://github.com/nexttime"
}
```

Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jeroen Demeyer**



---

archive/issue_events_127356.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-10-19T10:21:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127356"
}
```



---

archive/issue_events_127357.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-10-19T10:21:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127357"
}
```



---

archive/issue_comments_089124.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nReplying to [@nexttime](#comment%3A120):\n> Of course the upgrade path has yet to be updated for testing this, but the patch can be reviewed.\n\nOne can also (partially) test the new patch by (optionally renaming the Sage directory of an installation to be upgraded, then) running `./sage -upgrade ...` with the *current* upgrade path, and **after that** applying [the new patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz) to the Sage library, then running `./sage -ba` and `make ptestlong` or alike. (Running just `./sage -b` would though show that the obsolete hard-coded directory gets replaced, of course only if `SAGE_ROOT` had been changed. Another way is to put fake directories into `LDSHARED`, e.g. by setting it to `\"gcc -bundle -L/foo/bar/ -undefined dynamic_lookup -Lbaz\"` on MacOS X, or e.g. `\"gcc -L/foo/bar -pthread -Lbaz/ -shared\"` on Linux.)",
    "created_at": "2010-10-19T10:40:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89124",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:121" align="right">comment:121</div>

Replying to [@nexttime](#comment%3A120):
> Of course the upgrade path has yet to be updated for testing this, but the patch can be reviewed.

One can also (partially) test the new patch by (optionally renaming the Sage directory of an installation to be upgraded, then) running `./sage -upgrade ...` with the *current* upgrade path, and **after that** applying [the new patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz) to the Sage library, then running `./sage -ba` and `make ptestlong` or alike. (Running just `./sage -b` would though show that the obsolete hard-coded directory gets replaced, of course only if `SAGE_ROOT` had been changed. Another way is to put fake directories into `LDSHARED`, e.g. by setting it to `"gcc -bundle -L/foo/bar/ -undefined dynamic_lookup -Lbaz"` on MacOS X, or e.g. `"gcc -L/foo/bar -pthread -Lbaz/ -shared"` on Linux.)



---

archive/issue_comments_089125.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nI am preparing a new upgrade path with the patches.",
    "created_at": "2010-10-19T12:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89125",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:122" align="right">comment:122</div>

I am preparing a new upgrade path with the patches.



---

archive/issue_comments_089126.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nReplying to [@jdemeyer](#comment%3A122):\n> I am preparing a new upgrade path with the patches.\n\nThanks again. Do you keep the alpha2 upgrade path? Incidentally, I was just going to test *that* on another machine...",
    "created_at": "2010-10-19T12:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89126",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:123" align="right">comment:123</div>

Replying to [@jdemeyer](#comment%3A122):
> I am preparing a new upgrade path with the patches.

Thanks again. Do you keep the alpha2 upgrade path? Incidentally, I was just going to test *that* on another machine...



---

archive/issue_comments_089127.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">comment:124</div>\n\nReplying to [@nexttime](#comment%3A123):\n> Do you keep the alpha2 upgrade path?\n\nSure.",
    "created_at": "2010-10-19T13:01:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89127",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:124" align="right">comment:124</div>

Replying to [@nexttime](#comment%3A123):
> Do you keep the alpha2 upgrade path?

Sure.



---

archive/issue_comments_089128.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,9 +19,7 @@\n \n ## How to test:\n \n-(There's not yet an upgrade path to Sage 4.6.alpha**3**.)\n-\n-**Upgrade path for testing the fixes (v2b versions): http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**\n+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**\n \n If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n``````\n",
    "created_at": "2010-10-19T20:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89128",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,9 +19,7 @@
 
 ## How to test:
 
-(There's not yet an upgrade path to Sage 4.6.alpha**3**.)
-
-**Upgrade path for testing the fixes (v2b versions): http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/**
+**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**
 
 If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
``````




---

archive/issue_comments_089129.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nNew upgrade path: [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/)\n\nLeif: the stuff about LDSHARED in the description might be outdated, can you fix it?",
    "created_at": "2010-10-19T20:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89129",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:125" align="right">comment:125</div>

New upgrade path: [http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/](http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/)

Leif: the stuff about LDSHARED in the description might be outdated, can you fix it?



---

archive/issue_comments_089130.json:
```json
{
    "body": "Changed work issues from **Update upgrade path for testing** to none",
    "created_at": "2010-10-19T20:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89130",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **Update upgrade path for testing** to none



---

archive/issue_comments_089131.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nReplying to [@jdemeyer](#comment%3A125):\n> Leif: the stuff about LDSHARED in the description might be outdated, can you fix it?\n\nDone. Thanks.",
    "created_at": "2010-10-19T21:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89131",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:126" align="right">comment:126</div>

Replying to [@jdemeyer](#comment%3A125):
> Leif: the stuff about LDSHARED in the description might be outdated, can you fix it?

Done. Thanks.



---

archive/issue_comments_089132.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,17 +28,10 @@\n ```\n (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n \n-On MacOS X, one should **at the moment** **either** do an \"in-place\" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:\n-\n-```sh\n-$ export LDSHARED=\"gcc -bundle -undefined dynamic_lookup\"\n-```\n-(See also the [comment below](#comment%3A63) regarding `LDSHARED`. This will no longer be necessary when the second patch to the Sage library, `trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch`, has been merged into the upgrade path.)\n-\n Do the upgrade:\n \n ```sh\n-$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/\n+$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/\n ```\n Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) \n \n``````\n",
    "created_at": "2010-10-19T21:18:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89132",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,17 +28,10 @@
 ```
 (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
 
-On MacOS X, one should **at the moment** **either** do an "in-place" upgrade (without renaming the directory / copying the original installation) **or** do the following **before** running `./sage -upgrade ...`:
-
-```sh
-$ export LDSHARED="gcc -bundle -undefined dynamic_lookup"
-```
-(See also the [comment below](#comment%3A63) regarding `LDSHARED`. This will no longer be necessary when the second patch to the Sage library, `trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch`, has been merged into the upgrade path.)
-
 Do the upgrade:
 
 ```sh
-$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha2/
+$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/
 ```
 Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) 
 
``````




---

archive/issue_comments_089133.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nJust for the record: I again did a fresh build of Sage 4.5.3, renamed the directory and then upgraded to Sage 4.6.alpha**2** with the (previous) test upgrade path (on Ubuntu 10.04 x86_64).\n\nThe upgrade failed in the first place, I then \"successfully\" ran `make` (all new packages are present) and now I get lots of doctest errors (`ptestlong`).\n\nMore to come (still running); currently testing the new alpha**3** test upgrade path on another machine.",
    "created_at": "2010-10-19T22:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89133",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:127" align="right">comment:127</div>

Just for the record: I again did a fresh build of Sage 4.5.3, renamed the directory and then upgraded to Sage 4.6.alpha**2** with the (previous) test upgrade path (on Ubuntu 10.04 x86_64).

The upgrade failed in the first place, I then "successfully" ran `make` (all new packages are present) and now I get lots of doctest errors (`ptestlong`).

More to come (still running); currently testing the new alpha**3** test upgrade path on another machine.



---

archive/issue_comments_089134.json:
```json
{
    "body": "<div id=\"comment:128\" align=\"right\">comment:128</div>\n\nReplying to [@nexttime](#comment%3A127):\n> Just for the record: I again did a fresh build of Sage 4.5.3, renamed the directory and then upgraded to Sage 4.6.alpha**2** with the (previous) test upgrade path (on Ubuntu 10.04 x86_64).\n\nMeaning: Did anybody test the alpha2 upgrade path? (I don't see reports here.)\n\n> The upgrade failed in the first place, I then \"successfully\" ran `make` (all new packages are present) and now I get lots of doctest errors (`ptestlong`).\n> \n> More to come (still running)\n\n```\nThe following tests failed:\n\n\tsage -t  -long devel/sage/sage/plot/misc.py # 4 doctests failed\n\tsage -t  -long devel/sage/sage/plot/plot.py # 12 doctests failed\n```\nAt least some end like this:\n\n```\n      File \"/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py\", line 658, in __init__\n        self._stix_fallback = StixFonts(*args, **kwargs)\n      File \"/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py\", line 900, in __init__\n        fullpath = findfont(name)\n      File \"/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/font_manager.py\", line 1306, in findfont\n        if not os.path.exists(font):\n      File \"/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python2.6/genericpath.py\", line 18, in exists\n        st = os.stat(path)\n    TypeError: coercing to Unicode: need string or buffer, dict found\n```",
    "created_at": "2010-10-19T22:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89134",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:128" align="right">comment:128</div>

Replying to [@nexttime](#comment%3A127):
> Just for the record: I again did a fresh build of Sage 4.5.3, renamed the directory and then upgraded to Sage 4.6.alpha**2** with the (previous) test upgrade path (on Ubuntu 10.04 x86_64).

Meaning: Did anybody test the alpha2 upgrade path? (I don't see reports here.)

> The upgrade failed in the first place, I then "successfully" ran `make` (all new packages are present) and now I get lots of doctest errors (`ptestlong`).
> 
> More to come (still running)

```
The following tests failed:

	sage -t  -long devel/sage/sage/plot/misc.py # 4 doctests failed
	sage -t  -long devel/sage/sage/plot/plot.py # 12 doctests failed
```
At least some end like this:

```
      File "/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py", line 658, in __init__
        self._stix_fallback = StixFonts(*args, **kwargs)
      File "/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/mathtext.py", line 900, in __init__
        fullpath = findfont(name)
      File "/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python/site-packages/matplotlib/font_manager.py", line 1306, in findfont
        if not os.path.exists(font):
      File "/home/leif/Sage/sage-4.5.3-4.6.alpha2/local/lib/python2.6/genericpath.py", line 18, in exists
        st = os.stat(path)
    TypeError: coercing to Unicode: need string or buffer, dict found
```



---

archive/issue_comments_089135.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,6 +20,12 @@\n ## How to test:\n \n **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**\n+\n+Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it should be sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:\n+\n+```sh\n+$ rm spkg/installed/freetype-*\n+```\n \n If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n``````\n",
    "created_at": "2010-10-20T21:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89135",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,6 +20,12 @@
 ## How to test:
 
 **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**
+
+Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it should be sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:
+
+```sh
+$ rm spkg/installed/freetype-*
+```
 
 If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
``````




---

archive/issue_comments_089136.json:
```json
{
    "body": "<div id=\"comment:129\" align=\"right\">comment:129</div>\n\nUpdated instructions for testing w.r.t. upgrades not performed in-place.",
    "created_at": "2010-10-20T21:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89136",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:129" align="right">comment:129</div>

Updated instructions for testing w.r.t. upgrades not performed in-place.



---

archive/issue_comments_089137.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,7 +21,7 @@\n \n **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**\n \n-Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it should be sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:\n+Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:\n \n ```sh\n $ rm spkg/installed/freetype-*\n``````\n",
    "created_at": "2010-10-21T02:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89137",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,7 +21,7 @@
 
 **Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**
 
-Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it should be sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:
+Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:
 
 ```sh
 $ rm spkg/installed/freetype-*
``````




---

archive/issue_comments_089138.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,7 +27,7 @@\n $ rm spkg/installed/freetype-*\n ```\n \n-If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n ```sh\n $ touch spkg/installed/iconv-1.13.1.p3\n@@ -39,7 +39,7 @@\n ```sh\n $ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/\n ```\n-Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) \n+Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (#10011 fixes this; currently needs review.)\n \n ---\n \n``````\n",
    "created_at": "2010-10-21T02:14:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89138",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,7 +27,7 @@
 $ rm spkg/installed/freetype-*
 ```
 
-If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) on systems **other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
+If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
 ```sh
 $ touch spkg/installed/iconv-1.13.1.p3
@@ -39,7 +39,7 @@
 ```sh
 $ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/
 ```
-Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) 
+Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (#10011 fixes this; currently needs review.)
 
 ---
 
``````




---

archive/issue_comments_089139.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nI've now successfully upgraded to Sage 4.6.alpha3 (from fresh builds of Sage 4.5.3) and (with the exception of the 32-bit system) `ptestlong` passed without errors on:\n\n* Ubuntu 9.04 x86 (in-place; after upgrading I now also get #10041, which doesn't occur when building from scratch)\n\n* Ubuntu 9.04 x86_64 (Sage installation moved before upgrading, with the work-around given in the description, i.e. also forcing a rebuild of freetype)\n\n* Ubuntu 10.04 x86_64 (in-place)\n\nI also \"repaired\" a failed upgrade from a moved Sage installation on the latter system by forcing reinstallation of freetype and running `make` afterwards; `ptestlong` then also passed without errors.\n\n---\n\nCurrently, the installation of matplotlib 1.0.0 (included in alpha3, #9221) breaks older versions of matplotlib in **other** Sage installations; this is now fixed by #6235.\n\nDeleting or renaming `$HOME/.matplotlib/` (probably each time) before running an older (or after running the new) version of Sage also avoids that problem (cf. traceback above, *\"TypeError: coercing to Unicode: need string or buffer, dict found\"*).",
    "created_at": "2010-10-21T03:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89139",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:132" align="right">comment:132</div>

I've now successfully upgraded to Sage 4.6.alpha3 (from fresh builds of Sage 4.5.3) and (with the exception of the 32-bit system) `ptestlong` passed without errors on:

* Ubuntu 9.04 x86 (in-place; after upgrading I now also get #10041, which doesn't occur when building from scratch)

* Ubuntu 9.04 x86_64 (Sage installation moved before upgrading, with the work-around given in the description, i.e. also forcing a rebuild of freetype)

* Ubuntu 10.04 x86_64 (in-place)

I also "repaired" a failed upgrade from a moved Sage installation on the latter system by forcing reinstallation of freetype and running `make` afterwards; `ptestlong` then also passed without errors.

---

Currently, the installation of matplotlib 1.0.0 (included in alpha3, #9221) breaks older versions of matplotlib in **other** Sage installations; this is now fixed by #6235.

Deleting or renaming `$HOME/.matplotlib/` (probably each time) before running an older (or after running the new) version of Sage also avoids that problem (cf. traceback above, *"TypeError: coercing to Unicode: need string or buffer, dict found"*).



---

archive/issue_comments_089140.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\nFollowing Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.",
    "created_at": "2010-10-21T09:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89140",
    "user": "https://github.com/qed777"
}
```

<div id="comment:133" align="right">comment:133</div>

Following Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.



---

archive/issue_comments_089141.json:
```json
{
    "body": "Merged: **sage-4.6.rc0**",
    "created_at": "2010-10-21T09:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89141",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.6.rc0**



---

archive/issue_comments_089142.json:
```json
{
    "body": "<div id=\"comment:134\" align=\"right\">comment:134</div>\n\nUpgraded succesfully on a PPC Mac OS X 10.4 from sage-4.5.3 to sage-4.6.alpha3 and `ptestlong` passes.  This upgrade was done in place.",
    "created_at": "2010-10-21T15:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89142",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:134" align="right">comment:134</div>

Upgraded succesfully on a PPC Mac OS X 10.4 from sage-4.5.3 to sage-4.6.alpha3 and `ptestlong` passes.  This upgrade was done in place.



---

archive/issue_comments_089143.json:
```json
{
    "body": "Changed author from **Leif Leonhardy, Jeroen Demeyer** to **Leif Leonhardy**",
    "created_at": "2010-10-21T15:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89143",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Leif Leonhardy, Jeroen Demeyer** to **Leif Leonhardy**



---

archive/issue_comments_089144.json:
```json
{
    "body": "<div id=\"comment:135\" align=\"right\">comment:135</div>\n\nUpgraded a copied directory on OS X 10.6 successfully.  Also an in-place upgrade on OpenSolaris, just to try a different platform and also to test that setting SAGE_ATLAS_LIB before the initial build wouldn't interfere with anything.",
    "created_at": "2010-10-21T15:43:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89144",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:135" align="right">comment:135</div>

Upgraded a copied directory on OS X 10.6 successfully.  Also an in-place upgrade on OpenSolaris, just to try a different platform and also to test that setting SAGE_ATLAS_LIB before the initial build wouldn't interfere with anything.



---

archive/issue_comments_089145.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -39,7 +39,7 @@\n ```sh\n $ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/\n ```\n-Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (#10011 fixes this; currently needs review.)\n+Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)\n \n ---\n \n``````\n",
    "created_at": "2010-10-21T20:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89145",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -39,7 +39,7 @@
 ```sh
 $ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/
 ```
-Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (#10011 fixes this; currently needs review.)
+Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)
 
 ---
 
``````




---

archive/issue_comments_089146.json:
```json
{
    "body": "<div id=\"comment:137\" align=\"right\">comment:137</div>\n\nReplying to [@qed777](#comment%3A133):\n> Following Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.\n\nI'll merge all of the patches and files in the description's current \"How to merge this ticket\" section.",
    "created_at": "2010-10-21T21:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89146",
    "user": "https://github.com/qed777"
}
```

<div id="comment:137" align="right">comment:137</div>

Replying to [@qed777](#comment%3A133):
> Following Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.

I'll merge all of the patches and files in the description's current "How to merge this ticket" section.



---

archive/issue_comments_089147.json:
```json
{
    "body": "<div id=\"comment:138\" align=\"right\">comment:138</div>\n\nReplying to [@qed777](#comment%3A137):\n> Replying to [@qed777](#comment%3A133):\n> > Following Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.\n> \n> \n> I'll merge all of the patches and files in the description's current \"How to merge this ticket\" section.\n\nThanks!\n\nUpgrading from Sage 4.4.4 in a renamed directory (with the official rc0 upgrade path) fully worked for me on Ubuntu 9.04 x86_64 (Core2, gcc 4.3.3; parallel build with 16 jobs).\n\nQuite surprisingly, even `ptestlong` passed without any doctest errors. ;-) (Cf. sage-release.)\n\nDespite that, I guess there are still missing dependencies in `module_list.py` that will come into play when e.g. updating MPIR (#8664). (I primarily addressed upgrading to the new PARI on this ticket; more changes should IMHO be made on other / the respective spkg tickets.)",
    "created_at": "2010-10-22T10:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89147",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:138" align="right">comment:138</div>

Replying to [@qed777](#comment%3A137):
> Replying to [@qed777](#comment%3A133):
> > Following Jeroen's [suggestion on sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/2253505ea7ae98ae), I'm planning to merge this ticket into 4.6.rc0.
> 
> 
> I'll merge all of the patches and files in the description's current "How to merge this ticket" section.

Thanks!

Upgrading from Sage 4.4.4 in a renamed directory (with the official rc0 upgrade path) fully worked for me on Ubuntu 9.04 x86_64 (Core2, gcc 4.3.3; parallel build with 16 jobs).

Quite surprisingly, even `ptestlong` passed without any doctest errors. ;-) (Cf. sage-release.)

Despite that, I guess there are still missing dependencies in `module_list.py` that will come into play when e.g. updating MPIR (#8664). (I primarily addressed upgrading to the new PARI on this ticket; more changes should IMHO be made on other / the respective spkg tickets.)



---

archive/issue_comments_089148.json:
```json
{
    "body": "<div id=\"comment:139\" align=\"right\">comment:139</div>\n\nReplying to [@nexttime](#comment%3A138):\n> Despite that, I guess there are still missing dependencies in `module_list.py` that will come into play when e.g. updating MPIR (#8664). (I primarily addressed upgrading to the new PARI on this ticket; more changes should IMHO be made on other / the respective spkg tickets.)\n\nNumPy and SciPy (#9808) are other candidates.",
    "created_at": "2010-10-22T10:39:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89148",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:139" align="right">comment:139</div>

Replying to [@nexttime](#comment%3A138):
> Despite that, I guess there are still missing dependencies in `module_list.py` that will come into play when e.g. updating MPIR (#8664). (I primarily addressed upgrading to the new PARI on this ticket; more changes should IMHO be made on other / the respective spkg tickets.)

NumPy and SciPy (#9808) are other candidates.



---

archive/issue_comments_089149.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,7 +30,8 @@\n If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n ```sh\n-$ touch spkg/installed/iconv-1.13.1.p3\n+$ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed\n+$ make build # touches all packages depending on iconv (without rebuilding them)\n ```\n (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n \n``````\n",
    "created_at": "2010-10-22T20:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89149",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,7 +30,8 @@
 If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
 ```sh
-$ touch spkg/installed/iconv-1.13.1.p3
+$ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed
+$ make build # touches all packages depending on iconv (without rebuilding them)
 ```
 (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
 
``````




---

archive/issue_events_127358.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2010-10-22T20:31:09Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127358"
}
```



---

archive/issue_events_127359.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2010-10-22T20:31:09Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127359"
}
```



---

archive/issue_comments_089150.json:
```json
{
    "body": "<div id=\"comment:141\" align=\"right\">comment:141</div>\n\nAlso successfully upgraded a *copied* Sage 4.5.3 installation to 4.6.rc0 on Ubuntu 9.04 x86; `ptestlong` passed without errors (cf. sage-release).",
    "created_at": "2010-10-22T20:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89150",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:141" align="right">comment:141</div>

Also successfully upgraded a *copied* Sage 4.5.3 installation to 4.6.rc0 on Ubuntu 9.04 x86; `ptestlong` passed without errors (cf. sage-release).



---

archive/issue_comments_089151.json:
```json
{
    "body": "<div id=\"comment:142\" align=\"right\">comment:142</div>\n\nAs far as reviewing goes, I'm happy with all of the patches except for two.\n\n- [/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz).  This seems fine, but the messages like \"Library dir found in dynamic linker command...\" don't actually appear in any log (unless you pipe the whole thing through tee, perhaps, but I haven't tried this yet).  (I'm assuming that, since I upgraded from 4.5.3 on OS X, the situation dealt with in the loop would occur, and I searched through all of the logs without finding this string.)  I was hoping that they would appear in the sage-4.6.rc0 log, but no.  Is there anything to be done about this?\n\n- [trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz).  I just don't know enough about the Sage build process and the dependencies to be able to review this well, and I don't have the time to learn about it right now.  I'm hoping that someone else can do this.",
    "created_at": "2010-10-22T21:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89151",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:142" align="right">comment:142</div>

As far as reviewing goes, I'm happy with all of the patches except for two.

- [/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz).  This seems fine, but the messages like "Library dir found in dynamic linker command..." don't actually appear in any log (unless you pipe the whole thing through tee, perhaps, but I haven't tried this yet).  (I'm assuming that, since I upgraded from 4.5.3 on OS X, the situation dealt with in the loop would occur, and I searched through all of the logs without finding this string.)  I was hoping that they would appear in the sage-4.6.rc0 log, but no.  Is there anything to be done about this?

- [trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz).  I just don't know enough about the Sage build process and the dependencies to be able to review this well, and I don't have the time to learn about it right now.  I'm hoping that someone else can do this.



---

archive/issue_comments_089152.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nReplying to [@jhpalmieri](#comment%3A142):\n> As far as reviewing goes, I'm happy with all of the patches except for two.\n> \n> - [/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz).  This seems fine, but the messages like \"Library dir found in dynamic linker command...\" don't actually appear in any log (unless you pipe the whole thing through tee, perhaps, but I haven't tried this yet).  (I'm assuming that, since I upgraded from 4.5.3 on OS X, the situation dealt with in the loop would occur, and I searched through all of the logs without finding this string.)  I was hoping that they would appear in the sage-4.6.rc0 log, but no.  Is there anything to be done about this?\n\n```python\n                if ldso_cmd[i][:2] == \"-L\":\n                    libdir = os.path.normpath(ldso_cmd[i][2:])\n                    self.debug_print(\n                      \"Library dir found in dynamic linker command: \" +\n                      \"\\\"%s\\\"\" % libdir)\n                    if libdir != sage_libdir:\n                        self.compiler.warn(\n                          \"Replacing library search directory in linker \" +\n                          \"command:\\n  \\\"%s\\\" -> \\\"%s\\\"\\n\" % (libdir,\n                                                              sage_libdir))\n                        ldso_cmd[i] = \"-L\"+sage_libdir\n                    \n```\n\nNo, that's intentional. `self.debug_print()` only produces output if `DISTUTILS_DEBUG` is set.\n\nIn contrast, `self.compiler.warn()` always prints a message, so you should find *\"warning: Replacing library search directory ...\"* in the logs of the installations you had moved:\n\n```sh\n$ grep \"^warning: \" install.log\n```\nor\n\n```sh\n$ grep \"^warning: Replacing\" spkg/logs/sage-*\n```\nshould show these.",
    "created_at": "2010-10-22T22:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89152",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:143" align="right">comment:143</div>

Replying to [@jhpalmieri](#comment%3A142):
> As far as reviewing goes, I'm happy with all of the patches except for two.
> 
> - [/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_hardcoded_libdirs_in_extmod_linker_cmd-sagelib.patch.gz).  This seems fine, but the messages like "Library dir found in dynamic linker command..." don't actually appear in any log (unless you pipe the whole thing through tee, perhaps, but I haven't tried this yet).  (I'm assuming that, since I upgraded from 4.5.3 on OS X, the situation dealt with in the loop would occur, and I searched through all of the logs without finding this string.)  I was hoping that they would appear in the sage-4.6.rc0 log, but no.  Is there anything to be done about this?

```python
                if ldso_cmd[i][:2] == "-L":
                    libdir = os.path.normpath(ldso_cmd[i][2:])
                    self.debug_print(
                      "Library dir found in dynamic linker command: " +
                      "\"%s\"" % libdir)
                    if libdir != sage_libdir:
                        self.compiler.warn(
                          "Replacing library search directory in linker " +
                          "command:\n  \"%s\" -> \"%s\"\n" % (libdir,
                                                              sage_libdir))
                        ldso_cmd[i] = "-L"+sage_libdir
                    
```

No, that's intentional. `self.debug_print()` only produces output if `DISTUTILS_DEBUG` is set.

In contrast, `self.compiler.warn()` always prints a message, so you should find *"warning: Replacing library search directory ..."* in the logs of the installations you had moved:

```sh
$ grep "^warning: " install.log
```
or

```sh
$ grep "^warning: Replacing" spkg/logs/sage-*
```
should show these.



---

archive/issue_comments_089153.json:
```json
{
    "body": "<div id=\"comment:144\" align=\"right\">comment:144</div>\n\nOh, sorry, that's what I meant by \"messages like ...\".  I don't see \"Replacing library\" in any log file, either.  (I copied my sage-4.5.3 directory to sage-4.6.rc0-upgrade and ran \"./sage -upgrade\".)",
    "created_at": "2010-10-22T22:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89153",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:144" align="right">comment:144</div>

Oh, sorry, that's what I meant by "messages like ...".  I don't see "Replacing library" in any log file, either.  (I copied my sage-4.5.3 directory to sage-4.6.rc0-upgrade and ran "./sage -upgrade".)



---

archive/issue_comments_089154.json:
```json
{
    "body": "<div id=\"comment:145\" align=\"right\">comment:145</div>\n\nHmmm, what does\n\n```sh\n$ ./sage -b 2>&1 | grep -A2 \"^warning\"\n```\ngive (in a moved Sage installation)?\n\nYou could also do\n\n```sh\n$ env DISTUTILS_DEBUG=yes ./sage -b\n```\nbut that produces *a lot* of output.",
    "created_at": "2010-10-22T22:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89154",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:145" align="right">comment:145</div>

Hmmm, what does

```sh
$ ./sage -b 2>&1 | grep -A2 "^warning"
```
give (in a moved Sage installation)?

You could also do

```sh
$ env DISTUTILS_DEBUG=yes ./sage -b
```
but that produces *a lot* of output.



---

archive/issue_comments_089155.json:
```json
{
    "body": "<div id=\"comment:146\" align=\"right\">comment:146</div>\n\n`grep -A2` is a GNUism - it will not work with Sun's grep. It would be better to stick to only the options mandated by the POSIX specification on the OpenGroup web site. But I can say for sure that would break on Solaris. \n\nDave",
    "created_at": "2010-10-22T22:41:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89155",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:146" align="right">comment:146</div>

`grep -A2` is a GNUism - it will not work with Sun's grep. It would be better to stick to only the options mandated by the POSIX specification on the OpenGroup web site. But I can say for sure that would break on Solaris. 

Dave



---

archive/issue_comments_089156.json:
```json
{
    "body": "<div id=\"comment:147\" align=\"right\">comment:147</div>\n\nI don't think John has Sun's `grep` installed on MacOS X... ;-)\n\n---\n\nOn topic again:\n\nThere are two reasons you (John) can't find such messages:\n\n* `./sage -upgrade` doesn't log to `install.log` (I used `script` to log what happened, also because of #10011.)\n\n* There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.",
    "created_at": "2010-10-22T23:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89156",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:147" align="right">comment:147</div>

I don't think John has Sun's `grep` installed on MacOS X... ;-)

---

On topic again:

There are two reasons you (John) can't find such messages:

* `./sage -upgrade` doesn't log to `install.log` (I used `script` to log what happened, also because of #10011.)

* There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.



---

archive/issue_comments_089157.json:
```json
{
    "body": "<div id=\"comment:148\" align=\"right\">comment:148</div>\n\nReplying to [@nexttime](#comment%3A147):\n> I don't think John has Sun's `grep` installed on MacOS X... ;-)\n\nI was just about to install it, but I guess I'll wait a bit now.  \n\n> * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.\n\nThe python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.",
    "created_at": "2010-10-22T23:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89157",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:148" align="right">comment:148</div>

Replying to [@nexttime](#comment%3A147):
> I don't think John has Sun's `grep` installed on MacOS X... ;-)

I was just about to install it, but I guess I'll wait a bit now.  

> * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.

The python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.



---

archive/issue_comments_089158.json:
```json
{
    "body": "<div id=\"comment:149\" align=\"right\">comment:149</div>\n\nReplying to [@jhpalmieri](#comment%3A148):\n> Replying to [@nexttime](#comment%3A147):\n> > I don't think John has Sun's `grep` installed on MacOS X... ;-)\n> \n> \n> I was just about to install it, but I guess I'll wait a bit now.  \n> \n> > * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.\n> \n> \n> The python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.\n\nNote that I've updated the description on that (you have to run `make build` afterwards to make that work).",
    "created_at": "2010-10-22T23:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89158",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:149" align="right">comment:149</div>

Replying to [@jhpalmieri](#comment%3A148):
> Replying to [@nexttime](#comment%3A147):
> > I don't think John has Sun's `grep` installed on MacOS X... ;-)
> 
> 
> I was just about to install it, but I guess I'll wait a bit now.  
> 
> > * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.
> 
> 
> The python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.

Note that I've updated the description on that (you have to run `make build` afterwards to make that work).



---

archive/issue_comments_089159.json:
```json
{
    "body": "<div id=\"comment:150\" align=\"right\">comment:150</div>\n\nReplying to [@nexttime](#comment%3A149):\n> Replying to [@jhpalmieri](#comment%3A148):\n> > Replying to [@nexttime](#comment%3A147):\n> > > I don't think John has Sun's `grep` installed on MacOS X... ;-)\n> > \n> > \n> > I was just about to install it, but I guess I'll wait a bit now.  \n> > \n> > > * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.\n> > \n> > \n> > The python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.\n> \n> \n> Note that I've updated the description on that (you have to run `make build` afterwards to make that work).\n\nOoops, weird. That doesn't seem to be necessary... (And just touching the new iconv worked for me, i.e. e.g. Python did *not* get rebuilt.)",
    "created_at": "2010-10-23T00:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89159",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:150" align="right">comment:150</div>

Replying to [@nexttime](#comment%3A149):
> Replying to [@jhpalmieri](#comment%3A148):
> > Replying to [@nexttime](#comment%3A147):
> > > I don't think John has Sun's `grep` installed on MacOS X... ;-)
> > 
> > 
> > I was just about to install it, but I guess I'll wait a bit now.  
> > 
> > > * There's a less obvious indirect dependency of Python on iconv (via GNUTLS, libgpg_error), so the Python spkg got rebuilt, too, which of course also updated the library search path of distutils.
> > 
> > 
> > The python spkg did get rebuilt.  I'm trying again, first touching spkg/installed/iconv-1.13.1.p3.
> 
> 
> Note that I've updated the description on that (you have to run `make build` afterwards to make that work).

Ooops, weird. That doesn't seem to be necessary... (And just touching the new iconv worked for me, i.e. e.g. Python did *not* get rebuilt.)



---

archive/issue_comments_089160.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,7 +31,6 @@\n \n ```sh\n $ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed\n-$ make build # touches all packages depending on iconv (without rebuilding them)\n ```\n (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)\n \n``````\n",
    "created_at": "2010-10-23T00:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89160",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,7 +31,6 @@
 
 ```sh
 $ touch spkg/installed/iconv-1.13.1.p3 # fake it was already installed
-$ make build # touches all packages depending on iconv (without rebuilding them)
 ```
 (This package is only used on the above systems, but upgrading it triggers the rebuild of MPIR on **any** platform, which in turn causes rebuilding all packages that directly or indirectly depend on MPIR, the GMP replacement package.)
 
``````




---

archive/issue_comments_089161.json:
```json
{
    "body": "<div id=\"comment:151\" align=\"right\">comment:151</div>\n\nReplying to [@nexttime](#comment%3A150):\n> Ooops, weird. That doesn't seem to be necessary... (And just touching the new iconv worked for me, i.e. e.g. Python did *not* get rebuilt.)\n\nFunny, that's because `newest_version` doesn't inspect `spkg/installed/*`, but e.g. `spkg/standard/*.spkg` (and therefore `make` concludes all is up-to-date).\n\nSo it works the way I originally described.",
    "created_at": "2010-10-23T00:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89161",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:151" align="right">comment:151</div>

Replying to [@nexttime](#comment%3A150):
> Ooops, weird. That doesn't seem to be necessary... (And just touching the new iconv worked for me, i.e. e.g. Python did *not* get rebuilt.)

Funny, that's because `newest_version` doesn't inspect `spkg/installed/*`, but e.g. `spkg/standard/*.spkg` (and therefore `make` concludes all is up-to-date).

So it works the way I originally described.



---

archive/issue_comments_089162.json:
```json
{
    "body": "<div id=\"comment:152\" align=\"right\">comment:152</div>\n\nReplying to [@jhpalmieri](#comment%3A148):\n> Replying to [@nexttime](#comment%3A147):\n> > I don't think John has Sun's `grep` installed on MacOS X... ;-)\n> \n> \n> I was just about to install it, but I guess I'll wait a bit now.  \n\nGiven the title title had the \"(not limited to OS X)\" I assumed this needed a solution to work on any platform. But I've not been following this ticket closely, so I'll shut up. \n\nIf John does manage to install Sun's grep on his OS X machine, let me know how. I might even buy a Mac then! \n\nDave",
    "created_at": "2010-10-23T00:54:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89162",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:152" align="right">comment:152</div>

Replying to [@jhpalmieri](#comment%3A148):
> Replying to [@nexttime](#comment%3A147):
> > I don't think John has Sun's `grep` installed on MacOS X... ;-)
> 
> 
> I was just about to install it, but I guess I'll wait a bit now.  

Given the title title had the "(not limited to OS X)" I assumed this needed a solution to work on any platform. But I've not been following this ticket closely, so I'll shut up. 

If John does manage to install Sun's grep on his OS X machine, let me know how. I might even buy a Mac then! 

Dave



---

archive/issue_comments_089163.json:
```json
{
    "body": "<div id=\"comment:153\" align=\"right\">comment:153</div>\n\nOkay, after touching iconv, I see the warning in the sage spkg log. (And this was on a machine where I didn't run \"make build\" before upgrading, as Leif says.)\n\n> Given the title title had the \"(not limited to OS X)\" I assumed this needed a solution to work on any platform. But I've not been following this ticket closely, so I'll shut up.\n\nAt that point, Leif was just suggesting something for me to try on one machine, a mac, to troubleshoot something, not as an actual solution to any problem. So it was a safe suggestion.\n\nAnyway, I guess now I'm happy with all but one of the patches (trac_9896-fix_extension_module_deps-sagelib.patch), and someone else will have to help with that.",
    "created_at": "2010-10-23T01:13:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89163",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:153" align="right">comment:153</div>

Okay, after touching iconv, I see the warning in the sage spkg log. (And this was on a machine where I didn't run "make build" before upgrading, as Leif says.)

> Given the title title had the "(not limited to OS X)" I assumed this needed a solution to work on any platform. But I've not been following this ticket closely, so I'll shut up.

At that point, Leif was just suggesting something for me to try on one machine, a mac, to troubleshoot something, not as an actual solution to any problem. So it was a safe suggestion.

Anyway, I guess now I'm happy with all but one of the patches (trac_9896-fix_extension_module_deps-sagelib.patch), and someone else will have to help with that.



---

archive/issue_comments_089164.json:
```json
{
    "body": "<div id=\"comment:154\" align=\"right\">comment:154</div>\n\nOh, on another OS X machine I did \"touch .../iconv...\" and then \"make build\" and then \"sage -upgrade ...\", and then during the upgrade, the linbox spkg failed to install.",
    "created_at": "2010-10-23T01:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89164",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:154" align="right">comment:154</div>

Oh, on another OS X machine I did "touch .../iconv..." and then "make build" and then "sage -upgrade ...", and then during the upgrade, the linbox spkg failed to install.



---

archive/issue_comments_089165.json:
```json
{
    "body": "<div id=\"comment:155\" align=\"right\">comment:155</div>\n\nReplying to [@jhpalmieri](#comment%3A154):\n> Oh, on another OS X machine I did \"touch .../iconv...\" and then \"make build\" and then \"sage -upgrade ...\", and then during the upgrade, the linbox spkg failed to install.\n\nDetails? Perhaps just once again a race condition?\n\n(The `make build` should be a nop, i.e. have no influence, unless the installation hadn't been up-to-date before.)",
    "created_at": "2010-10-23T01:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89165",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:155" align="right">comment:155</div>

Replying to [@jhpalmieri](#comment%3A154):
> Oh, on another OS X machine I did "touch .../iconv..." and then "make build" and then "sage -upgrade ...", and then during the upgrade, the linbox spkg failed to install.

Details? Perhaps just once again a race condition?

(The `make build` should be a nop, i.e. have no influence, unless the installation hadn't been up-to-date before.)



---

archive/issue_comments_089166.json:
```json
{
    "body": "<div id=\"comment:156\" align=\"right\">comment:156</div>\n\nThe linbox log has messages like this:\n\n```\n/bin/sh ../../libtool --tag=CXX   --mode=link g++  -g -fPIC -I\"/Applications/sage_builds/sage-4.6.rc0-X/local/include\" -I\"/Applications/sage_builds/sage-4.6.rc0-X/local/include/linbox\"  -L\"/Applications/sage_builds/sage-4.6.rc0-X/local/lib\" -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src/linbox  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include -D__LINBOX_HAVE_CBLAS   -o libutil.la  timer.lo error.lo commentator.lo debug.lo  /usr/lib/libcblas.dylib -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgmpxx -lgmp -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgivaro\nlibtool: link: warning: library `/Applications/sage_builds/sage-4.6.rc0-X/local/lib/libgmpxx.la' was moved.\ngrep: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory\nsed: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory\nlibtool: link: `/Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la' is not a valid libtool archive\nmake[4]: *** [libutil.la] Error 1\nmake[3]: *** [install-recursive] Error 1\nmake[2]: *** [install-recursive] Error 1\nmake[1]: *** [install-recursive] Error 1\nError installing linbox\n```",
    "created_at": "2010-10-23T03:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89166",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:156" align="right">comment:156</div>

The linbox log has messages like this:

```
/bin/sh ../../libtool --tag=CXX   --mode=link g++  -g -fPIC -I"/Applications/sage_builds/sage-4.6.rc0-X/local/include" -I"/Applications/sage_builds/sage-4.6.rc0-X/local/include/linbox"  -L"/Applications/sage_builds/sage-4.6.rc0-X/local/lib" -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src/linbox  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include -D__LINBOX_HAVE_CBLAS   -o libutil.la  timer.lo error.lo commentator.lo debug.lo  /usr/lib/libcblas.dylib -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgmpxx -lgmp -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgivaro
libtool: link: warning: library `/Applications/sage_builds/sage-4.6.rc0-X/local/lib/libgmpxx.la' was moved.
grep: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory
sed: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory
libtool: link: `/Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la' is not a valid libtool archive
make[4]: *** [libutil.la] Error 1
make[3]: *** [install-recursive] Error 1
make[2]: *** [install-recursive] Error 1
make[1]: *** [install-recursive] Error 1
Error installing linbox
```



---

archive/issue_comments_089167.json:
```json
{
    "body": "<div id=\"comment:157\" align=\"right\">comment:157</div>\n\nUpdate: on one OS X 10.6 machine, after touching spkg/installed/iconv-1.13.1.p3, it doesn't matter whether I run \"make build\" or not before upgrading: I get the above error with linbox either way.  On another OS X 10.6 machine, I didn't run \"make build\" and it seemed to complete successfully; I haven't tried with \"make build\".  I'll run doctests to see if it's really successful.\n\nI don't know what's different about the two machines.  Maybe the 4.5.3 build got corrupted on the first one somehow?  I can try rebuilding 4.5.3 and doing it again...",
    "created_at": "2010-10-23T04:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89167",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:157" align="right">comment:157</div>

Update: on one OS X 10.6 machine, after touching spkg/installed/iconv-1.13.1.p3, it doesn't matter whether I run "make build" or not before upgrading: I get the above error with linbox either way.  On another OS X 10.6 machine, I didn't run "make build" and it seemed to complete successfully; I haven't tried with "make build".  I'll run doctests to see if it's really successful.

I don't know what's different about the two machines.  Maybe the 4.5.3 build got corrupted on the first one somehow?  I can try rebuilding 4.5.3 and doing it again...



---

archive/issue_comments_089168.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,7 +19,8 @@\n \n ## How to test:\n \n-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**\n+'''Upgrade path for testing the fixes:\n+http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''\n \n Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:\n \n@@ -37,7 +38,7 @@\n Do the upgrade:\n \n ```sh\n-$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/\n+$ ./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/\n ```\n Note that you'll be prompted to confirm upgrading (by typing \"y\" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)\n \n``````\n",
    "created_at": "2010-10-23T07:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89168",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,7 +19,8 @@
 
 ## How to test:
 
-**Upgrade path for testing the fixes: http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/**
+'''Upgrade path for testing the fixes:
+http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''
 
 Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:
 
@@ -37,7 +38,7 @@
 Do the upgrade:
 
 ```sh
-$ ./sage -upgrade http://sage.math.washington.edu/home/jdemeyer/dist/sage-4.6.upgradetest_alpha3/
+$ ./sage -upgrade http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/
 ```
 Note that you'll be prompted to confirm upgrading (by typing "y" followed by carriage return), so be careful when `tee`ing the output, since currently the script's output isn't flushed s.t. you won't see the prompt in that case and perhaps wait forever... ;-) (this has been fixed in #10011.)
 
``````




---

archive/issue_comments_089169.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,11 +22,12 @@\n '''Upgrade path for testing the fixes:\n http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''\n \n-Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:\n+Note that **non-inplace upgrades** had been **broken in** Sage 4.6.**alpha3**, due to the inclusion of matplotlib 1.0.0 (#9221) into that version. To temporarily work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation to alpha3**:\n \n ```sh\n $ rm spkg/installed/freetype-*\n ```\n+**This is not required for the rc0 upgrade path.**\n \n If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:\n \n``````\n",
    "created_at": "2010-10-23T12:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89169",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,11 +22,12 @@
 '''Upgrade path for testing the fixes:
 http://sage.math.washington.edu/home/release/sage-4.6.rc0/sage-4.6.rc0/'''
 
-Note that **non-inplace upgrades** are currently again broken, due to the inclusion of matplotlib 1.0.0 (#9221) into Sage 4.6.alpha**3**. To (hopefully temporarily) work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation**:
+Note that **non-inplace upgrades** had been **broken in** Sage 4.6.**alpha3**, due to the inclusion of matplotlib 1.0.0 (#9221) into that version. To temporarily work around this, it is sufficient to trigger a rebuild of freetype during the upgrade **when upgrading from a moved (copied or renamed) Sage installation to alpha3**:
 
 ```sh
 $ rm spkg/installed/freetype-*
 ```
+**This is not required for the rc0 upgrade path.**
 
 If you want to speed up the upgrade (i.e., reduce the number of packages that get rebuilt) **on systems other than Cygwin, HP-UX and Solaris**, do the following **before** starting the upgrade:
 
``````




---

archive/issue_comments_089170.json:
```json
{
    "body": "<div id=\"comment:160\" align=\"right\">comment:160</div>\n\nReplying to [@jhpalmieri](#comment%3A156):\n> The linbox log has messages like this:\n\n\n```\n/bin/sh ../../libtool --tag=CXX   --mode=link g++  -g -fPIC -I\"/Applications/sage_builds/sage-4.6.rc0-X/local/include\" -I\"/Applications/sage_builds/sage-4.6.rc0-X/local/include/linbox\"  -L\"/Applications/sage_builds/sage-4.6.rc0-X/local/lib\" -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src/linbox  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include -D__LINBOX_HAVE_CBLAS   -o libutil.la  timer.lo error.lo commentator.lo debug.lo  /usr/lib/libcblas.dylib -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgmpxx -lgmp -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgivaro\nlibtool: link: warning: library `/Applications/sage_builds/sage-4.6.rc0-X/local/lib/libgmpxx.la' was moved.\ngrep: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory\nsed: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory\nlibtool: link: `/Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la' is not a valid libtool archive\nmake[4]: *** [libutil.la] Error 1\nmake[3]: *** [install-recursive] Error 1\nmake[2]: *** [install-recursive] Error 1\nmake[1]: *** [install-recursive] Error 1\nError installing linbox\n```\n\nI think this *should* have been fixed by `local/bin/sage-location`'s\n\n```python\ndef update_library_files(R):\n    LIB = '%s/local/lib/'%os.path.abspath(SAGE_ROOT)\n    # The .a files should be re-ranlib'd\n    os.system('cd \"%s\"; ranlib *.a 1>/dev/null 2>/dev/null'%LIB)\n\n    # The .la files hardcode path info.  Fix this.\n    for F in os.listdir(LIB):\n       if F[-3:] == \".la\":\n           G = open(LIB + F).read()\n           i = G.find('libdir=')\n           j = i+8 + G[i+8:].find(\"'\")\n           z = G[i+8:j].strip().strip(\"'\")\n           i = z.rfind('local/')\n           if i != -1:\n               z = z[:i]\n               H = G.replace(z, os.path.abspath(SAGE_ROOT) + '/')\n               open(LIB + F,'w').write(H)\n```\nwhich is (also) called from `sage -upgrade` (i.e. `sage-sage`) if the installation has (newly) moved. (I'm not sure how robust that code is, it's at least less readable.)\n\nDid you perhaps interrupt this in the first run?",
    "created_at": "2010-10-23T12:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89170",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:160" align="right">comment:160</div>

Replying to [@jhpalmieri](#comment%3A156):
> The linbox log has messages like this:


```
/bin/sh ../../libtool --tag=CXX   --mode=link g++  -g -fPIC -I"/Applications/sage_builds/sage-4.6.rc0-X/local/include" -I"/Applications/sage_builds/sage-4.6.rc0-X/local/include/linbox"  -L"/Applications/sage_builds/sage-4.6.rc0-X/local/lib" -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src -I/Applications/sage_builds/sage-4.6.rc0-X/spkg/build/linbox-1.1.6.p3/src/linbox  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include  -I/Applications/sage_builds/sage-4.6.rc0-X/local/include -D__LINBOX_HAVE_CBLAS   -o libutil.la  timer.lo error.lo commentator.lo debug.lo  /usr/lib/libcblas.dylib -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgmpxx -lgmp -L/Applications/sage_builds/sage-4.6.rc0-X/local/lib -lgivaro
libtool: link: warning: library `/Applications/sage_builds/sage-4.6.rc0-X/local/lib/libgmpxx.la' was moved.
grep: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory
sed: /Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la: No such file or directory
libtool: link: `/Applications/sage_builds/sage-4.5.3/local/lib/libgmp.la' is not a valid libtool archive
make[4]: *** [libutil.la] Error 1
make[3]: *** [install-recursive] Error 1
make[2]: *** [install-recursive] Error 1
make[1]: *** [install-recursive] Error 1
Error installing linbox
```

I think this *should* have been fixed by `local/bin/sage-location`'s

```python
def update_library_files(R):
    LIB = '%s/local/lib/'%os.path.abspath(SAGE_ROOT)
    # The .a files should be re-ranlib'd
    os.system('cd "%s"; ranlib *.a 1>/dev/null 2>/dev/null'%LIB)

    # The .la files hardcode path info.  Fix this.
    for F in os.listdir(LIB):
       if F[-3:] == ".la":
           G = open(LIB + F).read()
           i = G.find('libdir=')
           j = i+8 + G[i+8:].find("'")
           z = G[i+8:j].strip().strip("'")
           i = z.rfind('local/')
           if i != -1:
               z = z[:i]
               H = G.replace(z, os.path.abspath(SAGE_ROOT) + '/')
               open(LIB + F,'w').write(H)
```
which is (also) called from `sage -upgrade` (i.e. `sage-sage`) if the installation has (newly) moved. (I'm not sure how robust that code is, it's at least less readable.)

Did you perhaps interrupt this in the first run?



---

archive/issue_comments_089171.json:
```json
{
    "body": "<div id=\"comment:161\" align=\"right\">comment:161</div>\n\nAh, I see. The above code fixes just one instance of a hard-coded path in `libgmpxx.la`, namely `libdir=...`, but **not**:\n\n```sh\n# Libraries that this one depends upon.\ndependency_libs=' /home/leif/Sage/sage-4.6.rc0pre1/local/lib/libgmp.la'\n```\n\nI just wonder why this doesn't cause trouble on the other system.",
    "created_at": "2010-10-23T12:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89171",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:161" align="right">comment:161</div>

Ah, I see. The above code fixes just one instance of a hard-coded path in `libgmpxx.la`, namely `libdir=...`, but **not**:

```sh
# Libraries that this one depends upon.
dependency_libs=' /home/leif/Sage/sage-4.6.rc0pre1/local/lib/libgmp.la'
```

I just wonder why this doesn't cause trouble on the other system.



---

archive/issue_comments_089172.json:
```json
{
    "body": "<div id=\"comment:162\" align=\"right\">comment:162</div>\n\nReplying to [@nexttime](#comment%3A161):\n> Ah, I see. The above code fixes just one instance of a hard-coded path in `libgmpxx.la`, namely `libdir=...`, but **not**:\n\n\n```sh\n# Libraries that this one depends upon.\ndependency_libs=' /home/leif/Sage/sage-4.6.rc0pre1/local/lib/libgmp.la'\n```\n\nNot true. The above reads the old path from `libdir='...'`, but then replaces *all* occurrences of that (i.e. the old `$SAGE_ROOT`) by the new one. So perhaps really this was interrupted on the machine where LINBOX failed to build.",
    "created_at": "2010-10-23T13:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89172",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:162" align="right">comment:162</div>

Replying to [@nexttime](#comment%3A161):
> Ah, I see. The above code fixes just one instance of a hard-coded path in `libgmpxx.la`, namely `libdir=...`, but **not**:


```sh
# Libraries that this one depends upon.
dependency_libs=' /home/leif/Sage/sage-4.6.rc0pre1/local/lib/libgmp.la'
```

Not true. The above reads the old path from `libdir='...'`, but then replaces *all* occurrences of that (i.e. the old `$SAGE_ROOT`) by the new one. So perhaps really this was interrupted on the machine where LINBOX failed to build.



---

archive/issue_comments_089173.json:
```json
{
    "body": "<div id=\"comment:163\" align=\"right\">comment:163</div>\n\n> Did you perhaps interrupt this in the first run?\n\nIt's possible.  In any case, I can't repeat it now.",
    "created_at": "2010-10-23T19:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89173",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:163" align="right">comment:163</div>

> Did you perhaps interrupt this in the first run?

It's possible.  In any case, I can't repeat it now.



---

archive/issue_comments_089174.json:
```json
{
    "body": "<div id=\"comment:164\" align=\"right\">comment:164</div>\n\nReplying to [@jhpalmieri](#comment%3A163):\n> > Did you perhaps interrupt this in the first run?\n> \n> \n> It's possible.  In any case, I can't repeat it now.\n\nIt would in any case be better to trap `SIGINT` / `KeyboardInterrupt` while doing `sage-location`, or make backup copies first.\n\nAlso, it would be helpful for such situations to\n* log `$SAGE_ROOT` changes / movement (in a history file) for debugging or even to get the previous one,\n* perhaps log what changes `sage-location` made (to some file, perhaps a summary on the screen),\n* log the whole upgrade process as we do for builds / spkg installations (I'd suggest `$SAGE_ROOT/upgrade.log`, but only after #10011 and #10157 have been merged).\n\nDo you still have the broken installation? If so, you could\n\n```sh\n$ ls -rtl local/lib/*.la # see which were changed last / when\n$ cat local/lib/libgmpxx.la # to see the wrong paths\n```\n(libtool's `.la` files are plain text files.",
    "created_at": "2010-10-23T19:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89174",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:164" align="right">comment:164</div>

Replying to [@jhpalmieri](#comment%3A163):
> > Did you perhaps interrupt this in the first run?
> 
> 
> It's possible.  In any case, I can't repeat it now.

It would in any case be better to trap `SIGINT` / `KeyboardInterrupt` while doing `sage-location`, or make backup copies first.

Also, it would be helpful for such situations to
* log `$SAGE_ROOT` changes / movement (in a history file) for debugging or even to get the previous one,
* perhaps log what changes `sage-location` made (to some file, perhaps a summary on the screen),
* log the whole upgrade process as we do for builds / spkg installations (I'd suggest `$SAGE_ROOT/upgrade.log`, but only after #10011 and #10157 have been merged).

Do you still have the broken installation? If so, you could

```sh
$ ls -rtl local/lib/*.la # see which were changed last / when
$ cat local/lib/libgmpxx.la # to see the wrong paths
```
(libtool's `.la` files are plain text files.



---

archive/issue_comments_089175.json:
```json
{
    "body": "<div id=\"comment:165\" align=\"right\">comment:165</div>\n\n\n```sh\n$ ls -rtl local/lib/*.la\n```\nThe only difference between the broken one and the working one is that the two linbox files have been updated more recently in the working one, presumably when the linbox spkg was installed.  There are plenty of .la files with the wrong path in the working version.  The output from the working version:\n\n```\n-rwxr-xr-x@ 1 palmieri  admin   779 Feb 23  2008 local/lib/libgfortran.la*\n-rwxr-xr-x  1 palmieri  admin   975 Sep 24 08:23 local/lib/libpng12.la*\n-rwxr-xr-x  1 palmieri  admin   832 Sep 24 08:24 local/lib/libgc.la*\n-rwxr-xr-x  1 palmieri  admin   902 Sep 24 08:24 local/lib/libcord.la*\n-rwxr-xr-x  1 palmieri  admin   983 Sep 24 08:27 local/lib/libm4ri.la*\n-rwxr-xr-x  1 palmieri  admin   827 Sep 24 08:28 local/lib/libmpir.la*\n-rwxr-xr-x  1 palmieri  admin   897 Sep 24 08:28 local/lib/libmpirxx.la*\n-rwxr-xr-x  1 palmieri  admin   890 Sep 24 08:28 local/lib/libgmpxx.la*\n-rwxr-xr-x  1 palmieri  admin   821 Sep 24 08:28 local/lib/libgmp.la*\n-rwxr-xr-x  1 palmieri  admin   857 Sep 24 08:30 local/lib/libsqlite3.la*\n-rwxr-xr-x  1 palmieri  admin   887 Sep 24 08:31 local/lib/libgpg-error.la*\n-rwxr-xr-x  1 palmieri  admin   879 Sep 24 08:37 local/lib/libecm.la*\n-rwxr-xr-x  1 palmieri  admin  1066 Sep 24 08:38 local/lib/libmpfr.la*\n-rwxr-xr-x  1 palmieri  admin   980 Sep 24 08:42 local/lib/libgivaro.la*\n-rwxr-xr-x  1 palmieri  admin  1068 Sep 24 08:44 local/lib/libglpk.la*\n-rwxr-xr-x  1 palmieri  admin   852 Sep 24 08:44 local/lib/libmpfi.la*\n-rwxr-xr-x  1 palmieri  admin   982 Sep 24 08:55 local/lib/libgcrypt.la*\n-rwxr-xr-x  1 palmieri  admin  1023 Sep 24 09:01 local/lib/libfplll.la*\n-rwxr-xr-x  1 palmieri  admin  1053 Sep 24 09:01 local/lib/libopencdk.la*\n-rwxr-xr-x  1 palmieri  admin  1084 Sep 24 09:02 local/lib/libgnutls.la*\n-rwxr-xr-x  1 palmieri  admin  1272 Sep 24 09:02 local/lib/libgnutls-openssl.la*\n-rwxr-xr-x  1 palmieri  admin  1321 Sep 24 09:02 local/lib/libgnutls-extra.la*\n-rwxr-xr-x  1 palmieri  admin   945 Oct 23 10:46 local/lib/libcdd.la*\n-rwxr-xr-x  1 palmieri  admin  1075 Oct 23 10:46 local/lib/libcddgmp.la*\n-rwxr-xr-x  1 palmieri  admin   876 Oct 23 10:53 local/lib/libfreetype.la*\n-rwxr-xr-x  1 palmieri  admin  1087 Oct 23 10:54 local/lib/libgd.la*\n-rwxr-xr-x  1 palmieri  admin   979 Oct 23 10:59 local/lib/libgslcblas.la*\n-rwxr-xr-x  1 palmieri  admin   951 Oct 23 10:59 local/lib/libgsl.la*\n-rwxr-xr-x  1 palmieri  admin  1044 Oct 23 11:02 local/lib/libpynac.la*\n-rwxr-xr-x  1 palmieri  admin   951 Oct 23 11:37 local/lib/libiml.la*\n-rwxr-xr-x  1 palmieri  admin  1236 Oct 23 11:41 local/lib/liblinboxsage.la*\n-rwxr-xr-x  1 palmieri  admin  1206 Oct 23 11:41 local/lib/liblinbox.la*\n```\n\nI think this is the difference, although I haven't tested it: I had a directory \"/Applications/sage_builds/sage-4.5.3\".  In the broken one, I copied this to another directory, sage-4.6.rc0, and then I moved the original directory (so that any references to it would fail).  When upgrading the working version, I left the old directory in place.",
    "created_at": "2010-10-23T19:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89175",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:165" align="right">comment:165</div>


```sh
$ ls -rtl local/lib/*.la
```
The only difference between the broken one and the working one is that the two linbox files have been updated more recently in the working one, presumably when the linbox spkg was installed.  There are plenty of .la files with the wrong path in the working version.  The output from the working version:

```
-rwxr-xr-x@ 1 palmieri  admin   779 Feb 23  2008 local/lib/libgfortran.la*
-rwxr-xr-x  1 palmieri  admin   975 Sep 24 08:23 local/lib/libpng12.la*
-rwxr-xr-x  1 palmieri  admin   832 Sep 24 08:24 local/lib/libgc.la*
-rwxr-xr-x  1 palmieri  admin   902 Sep 24 08:24 local/lib/libcord.la*
-rwxr-xr-x  1 palmieri  admin   983 Sep 24 08:27 local/lib/libm4ri.la*
-rwxr-xr-x  1 palmieri  admin   827 Sep 24 08:28 local/lib/libmpir.la*
-rwxr-xr-x  1 palmieri  admin   897 Sep 24 08:28 local/lib/libmpirxx.la*
-rwxr-xr-x  1 palmieri  admin   890 Sep 24 08:28 local/lib/libgmpxx.la*
-rwxr-xr-x  1 palmieri  admin   821 Sep 24 08:28 local/lib/libgmp.la*
-rwxr-xr-x  1 palmieri  admin   857 Sep 24 08:30 local/lib/libsqlite3.la*
-rwxr-xr-x  1 palmieri  admin   887 Sep 24 08:31 local/lib/libgpg-error.la*
-rwxr-xr-x  1 palmieri  admin   879 Sep 24 08:37 local/lib/libecm.la*
-rwxr-xr-x  1 palmieri  admin  1066 Sep 24 08:38 local/lib/libmpfr.la*
-rwxr-xr-x  1 palmieri  admin   980 Sep 24 08:42 local/lib/libgivaro.la*
-rwxr-xr-x  1 palmieri  admin  1068 Sep 24 08:44 local/lib/libglpk.la*
-rwxr-xr-x  1 palmieri  admin   852 Sep 24 08:44 local/lib/libmpfi.la*
-rwxr-xr-x  1 palmieri  admin   982 Sep 24 08:55 local/lib/libgcrypt.la*
-rwxr-xr-x  1 palmieri  admin  1023 Sep 24 09:01 local/lib/libfplll.la*
-rwxr-xr-x  1 palmieri  admin  1053 Sep 24 09:01 local/lib/libopencdk.la*
-rwxr-xr-x  1 palmieri  admin  1084 Sep 24 09:02 local/lib/libgnutls.la*
-rwxr-xr-x  1 palmieri  admin  1272 Sep 24 09:02 local/lib/libgnutls-openssl.la*
-rwxr-xr-x  1 palmieri  admin  1321 Sep 24 09:02 local/lib/libgnutls-extra.la*
-rwxr-xr-x  1 palmieri  admin   945 Oct 23 10:46 local/lib/libcdd.la*
-rwxr-xr-x  1 palmieri  admin  1075 Oct 23 10:46 local/lib/libcddgmp.la*
-rwxr-xr-x  1 palmieri  admin   876 Oct 23 10:53 local/lib/libfreetype.la*
-rwxr-xr-x  1 palmieri  admin  1087 Oct 23 10:54 local/lib/libgd.la*
-rwxr-xr-x  1 palmieri  admin   979 Oct 23 10:59 local/lib/libgslcblas.la*
-rwxr-xr-x  1 palmieri  admin   951 Oct 23 10:59 local/lib/libgsl.la*
-rwxr-xr-x  1 palmieri  admin  1044 Oct 23 11:02 local/lib/libpynac.la*
-rwxr-xr-x  1 palmieri  admin   951 Oct 23 11:37 local/lib/libiml.la*
-rwxr-xr-x  1 palmieri  admin  1236 Oct 23 11:41 local/lib/liblinboxsage.la*
-rwxr-xr-x  1 palmieri  admin  1206 Oct 23 11:41 local/lib/liblinbox.la*
```

I think this is the difference, although I haven't tested it: I had a directory "/Applications/sage_builds/sage-4.5.3".  In the broken one, I copied this to another directory, sage-4.6.rc0, and then I moved the original directory (so that any references to it would fail).  When upgrading the working version, I left the old directory in place.



---

archive/issue_comments_089176.json:
```json
{
    "body": "<div id=\"comment:166\" align=\"right\">comment:166</div>\n\nSo it appears to be a bug in `sage-location`?\n\nCan you track this further down on a follow-up ticket? Works for me on Linuces...\n\nPerhaps copy all `.la` files to a temporary directory, move Sage (and run `./sage -c quit` to invoke `sage-location`), and then compare them.",
    "created_at": "2010-10-23T20:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89176",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:166" align="right">comment:166</div>

So it appears to be a bug in `sage-location`?

Can you track this further down on a follow-up ticket? Works for me on Linuces...

Perhaps copy all `.la` files to a temporary directory, move Sage (and run `./sage -c quit` to invoke `sage-location`), and then compare them.



---

archive/issue_comments_089177.json:
```json
{
    "body": "<div id=\"comment:167\" align=\"right\">comment:167</div>\n\nOkay, the problem is this: if you build Sage but never run it, then the script sage-location doesn't get run, so the file SAGE_ROOT/local/lib/sage-location.txt doesn't get created.  Then if you move or copy that directory, the file isn't there, so sage-location thinks everything is okay, so it doesn't rewrite the .la files.\n\n(This is despite the comment in sage-location that the files in local/lib get written \"during the build\".  This is also not platform-specific: I just built on sage.math, and there is no file sage-location.txt until Sage gets run for the first time.  I was also wondering why I wasn't seeing the message \"The Sage install tree may have moved...\" at the start of the upgrade, and this explains it.)\n\nSee #10162 for a follow-up; it's a one-liner.",
    "created_at": "2010-10-23T21:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89177",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:167" align="right">comment:167</div>

Okay, the problem is this: if you build Sage but never run it, then the script sage-location doesn't get run, so the file SAGE_ROOT/local/lib/sage-location.txt doesn't get created.  Then if you move or copy that directory, the file isn't there, so sage-location thinks everything is okay, so it doesn't rewrite the .la files.

(This is despite the comment in sage-location that the files in local/lib get written "during the build".  This is also not platform-specific: I just built on sage.math, and there is no file sage-location.txt until Sage gets run for the first time.  I was also wondering why I wasn't seeing the message "The Sage install tree may have moved..." at the start of the upgrade, and this explains it.)

See #10162 for a follow-up; it's a one-liner.



---

archive/issue_comments_089178.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2010-10-27T09:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89178",
    "user": "https://github.com/qed777"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_089179.json:
```json
{
    "body": "<div id=\"comment:168\" align=\"right\">comment:168</div>\n\nReplying to [@jhpalmieri](#comment%3A153):\n> Anyway, I guess now I'm happy with all but one of the patches (trac_9896-fix_extension_module_deps-sagelib.patch), and someone else will have to help with that.\n\nI'll try to review this later today.",
    "created_at": "2010-10-27T09:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89179",
    "user": "https://github.com/qed777"
}
```

<div id="comment:168" align="right">comment:168</div>

Replying to [@jhpalmieri](#comment%3A153):
> Anyway, I guess now I'm happy with all but one of the patches (trac_9896-fix_extension_module_deps-sagelib.patch), and someone else will have to help with that.

I'll try to review this later today.



---

archive/issue_comments_089180.json:
```json
{
    "body": "<div id=\"comment:169\" align=\"right\">comment:169</div>\n\nJohn Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?",
    "created_at": "2010-10-27T10:24:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89180",
    "user": "https://github.com/qed777"
}
```

<div id="comment:169" align="right">comment:169</div>

John Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?



---

archive/issue_comments_089181.json:
```json
{
    "body": "<div id=\"comment:170\" align=\"right\">comment:170</div>\n\nReplying to [@qed777](#comment%3A169):\n> John Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?\n\nThanks for asking.  For the include files listed, I assume that someone has just gone through the relevant pyx files and listed which of my header files are actually used?  I am not sure whether the point here is that (a) if some files are omitted from this list then the build will fail, or (b) if some are omitted then upgrading will not know to recompile something.  If (a) then the test is just to see if Sage builds!  If (b) I hardly think it matters since either all of eclib is built or none of it, surely?\n\nIt is quite possible that everything I have just said is complete nonsense.  If so sorry.\n\nAbout including the pari library:  Leif explained this to some extent on sage-devel.  I don't know (especially not what may or may not happen on cygwin) sp perhaps it is safer to leave it in?\n\nIf anyone ever has suggestions for improving the Makefiles for eclib I am always happy to receive them.  They were created during SD6 by editing old Makefiles of my own which had been evolving over years, so there may well be stuff in there which should not be.\n\nShort answer: no.",
    "created_at": "2010-10-27T10:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89181",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:170" align="right">comment:170</div>

Replying to [@qed777](#comment%3A169):
> John Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?

Thanks for asking.  For the include files listed, I assume that someone has just gone through the relevant pyx files and listed which of my header files are actually used?  I am not sure whether the point here is that (a) if some files are omitted from this list then the build will fail, or (b) if some are omitted then upgrading will not know to recompile something.  If (a) then the test is just to see if Sage builds!  If (b) I hardly think it matters since either all of eclib is built or none of it, surely?

It is quite possible that everything I have just said is complete nonsense.  If so sorry.

About including the pari library:  Leif explained this to some extent on sage-devel.  I don't know (especially not what may or may not happen on cygwin) sp perhaps it is safer to leave it in?

If anyone ever has suggestions for improving the Makefiles for eclib I am always happy to receive them.  They were created during SD6 by editing old Makefiles of my own which had been evolving over years, so there may well be stuff in there which should not be.

Short answer: no.



---

archive/issue_comments_089182.json:
```json
{
    "body": "<div id=\"comment:171\" align=\"right\">comment:171</div>\n\nI think we need to list eclib headers for these modules, so that during an upgrade, if the eclib package is rebuilt, because eclib and/or a dependent package has changed, the modules are also rebuilt.  Is this correct?\n\nI see\n\n```sh\n$ cd sage-4.6.rc0/devel/sage/sage/libs/mwrank\n$ grep \"eclib/\" *.c* *.h\nwrap.cc:#include \"eclib/htconst.h\"\nwrap.cc:#include \"eclib/interface.h\"\nwrap.h:#include \"eclib/curve.h\"\nwrap.h:#include \"eclib/egr.h\"    \nwrap.h:#include \"eclib/descent.h\"\nwrap.h:#include \"eclib/points.h\"\nwrap.h:#include \"eclib/isogs.h\"\nwrap.h:#include \"eclib/marith.h\" \nwrap.h:EXTERN void two_descent_saturate(struct two_descent* t, long sat_bd); // = -1 for default set in eclib/src/qcurves/saturate.h (currently 100)\n```\nand\n\n```sh\n$ cd sage-4.6.rc0/devel/sage/sage/libs/cremona\n$ grep \"eclib/\" *.cpp | grep -v cdef\nhomspace.cpp:#include \"eclib/moddata.h\"\nhomspace.cpp:#include \"eclib/symb.h\"\nhomspace.cpp:#include \"eclib/cusp.h\"\nhomspace.cpp:#include \"eclib/homspace.h\"\nmat.cpp:#include \"eclib/moddata.h\"\nmat.cpp:#include \"eclib/symb.h\"\nmat.cpp:#include \"eclib/cusp.h\"\nmat.cpp:#include \"eclib/homspace.h\"\nnewforms.cpp:#include \"eclib/interface.h\"\nnewforms.cpp:#include \"eclib/bigrat.h\"\nnewforms.cpp:#include \"eclib/rat.h\"\nnewforms.cpp:#include \"eclib/curve.h\"\nnewforms.cpp:#include \"eclib/moddata.h\"\nnewforms.cpp:#include \"eclib/symb.h\"\nnewforms.cpp:#include \"eclib/cusp.h\"\nnewforms.cpp:#include \"eclib/xsplit.h\"\nnewforms.cpp:#include \"eclib/method.h\"\nnewforms.cpp:#include \"eclib/oldforms.h\"\nnewforms.cpp:#include \"eclib/homspace.h\"\nnewforms.cpp:#include \"eclib/cperiods.h\"\nnewforms.cpp:#include \"eclib/newforms.h\"\n```\nFor `homspace` and `mat`, do we need to mention in `module_list.py` the `eclib/` headers that aren't listed above?",
    "created_at": "2010-10-27T12:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89182",
    "user": "https://github.com/qed777"
}
```

<div id="comment:171" align="right">comment:171</div>

I think we need to list eclib headers for these modules, so that during an upgrade, if the eclib package is rebuilt, because eclib and/or a dependent package has changed, the modules are also rebuilt.  Is this correct?

I see

```sh
$ cd sage-4.6.rc0/devel/sage/sage/libs/mwrank
$ grep "eclib/" *.c* *.h
wrap.cc:#include "eclib/htconst.h"
wrap.cc:#include "eclib/interface.h"
wrap.h:#include "eclib/curve.h"
wrap.h:#include "eclib/egr.h"    
wrap.h:#include "eclib/descent.h"
wrap.h:#include "eclib/points.h"
wrap.h:#include "eclib/isogs.h"
wrap.h:#include "eclib/marith.h" 
wrap.h:EXTERN void two_descent_saturate(struct two_descent* t, long sat_bd); // = -1 for default set in eclib/src/qcurves/saturate.h (currently 100)
```
and

```sh
$ cd sage-4.6.rc0/devel/sage/sage/libs/cremona
$ grep "eclib/" *.cpp | grep -v cdef
homspace.cpp:#include "eclib/moddata.h"
homspace.cpp:#include "eclib/symb.h"
homspace.cpp:#include "eclib/cusp.h"
homspace.cpp:#include "eclib/homspace.h"
mat.cpp:#include "eclib/moddata.h"
mat.cpp:#include "eclib/symb.h"
mat.cpp:#include "eclib/cusp.h"
mat.cpp:#include "eclib/homspace.h"
newforms.cpp:#include "eclib/interface.h"
newforms.cpp:#include "eclib/bigrat.h"
newforms.cpp:#include "eclib/rat.h"
newforms.cpp:#include "eclib/curve.h"
newforms.cpp:#include "eclib/moddata.h"
newforms.cpp:#include "eclib/symb.h"
newforms.cpp:#include "eclib/cusp.h"
newforms.cpp:#include "eclib/xsplit.h"
newforms.cpp:#include "eclib/method.h"
newforms.cpp:#include "eclib/oldforms.h"
newforms.cpp:#include "eclib/homspace.h"
newforms.cpp:#include "eclib/cperiods.h"
newforms.cpp:#include "eclib/newforms.h"
```
For `homspace` and `mat`, do we need to mention in `module_list.py` the `eclib/` headers that aren't listed above?



---

archive/issue_comments_089183.json:
```json
{
    "body": "<div id=\"comment:172\" align=\"right\">comment:172</div>\n\nI agree that these modules need to be rebuilt if eclib is rebuilt;  but I don't see why that means that we have to list header files individually.  Can't we make these modules depend on the spkg itself?",
    "created_at": "2010-10-27T14:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89183",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:172" align="right">comment:172</div>

I agree that these modules need to be rebuilt if eclib is rebuilt;  but I don't see why that means that we have to list header files individually.  Can't we make these modules depend on the spkg itself?



---

archive/issue_comments_089184.json:
```json
{
    "body": "<div id=\"comment:173\" align=\"right\">comment:173</div>\n\nReplying to [@JohnCremona](#comment%3A170):\n> Replying to [@qed777](#comment%3A169):\n> > John Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?\n> \n> \n> Thanks for asking.  For the include files listed, I assume that someone has just gone through the relevant pyx files and listed which of my header files are actually used?  \n\nExactly. I did that some weeks ago when debugging the original problem...\n\nIf any of these header files (to be precise, its modification time) changes, an extension module having it in its dependencies will get rebuilt. (The problem was this did not happen when ECLIB got rebuilt, such that these modules still used - or better: pulled-in - the old PARI library, which resulted in segfaults or import / dynamic linker errors.) \n\nPerhaps a little overkill (we just could rebuild all of these modules if *any* ECLIB header file changes), but as is may save some unnecessary rebuilds. ;-)\n\n> About including the pari library:  Leif explained this to some extent on sage-devel.  I don't know (especially not what may or may not happen on cygwin) so perhaps it is safer to leave it in?\n\nWell, I kept it for the moment (here; #9914 would remove the PARI library).\n\n> If anyone ever has suggestions for improving the Makefiles for eclib I am always happy to receive them.  They were created during SD6 by editing old Makefiles of my own which had been evolving over years, so there may well be stuff in there which should not be.\n\nOk, I have some patched ECLIB spkg somewhere around. Perhaps needs some more work though.",
    "created_at": "2010-10-27T15:58:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89184",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:173" align="right">comment:173</div>

Replying to [@JohnCremona](#comment%3A170):
> Replying to [@qed777](#comment%3A169):
> > John Cremona, do you happen to see any problems in [attachment: trac_9896-fix_extension_module_deps-sagelib.patch](https://github.com/sagemath/sage/files/ticket9896/trac_9896-fix_extension_module_deps-sagelib.patch.gz)?
> 
> 
> Thanks for asking.  For the include files listed, I assume that someone has just gone through the relevant pyx files and listed which of my header files are actually used?  

Exactly. I did that some weeks ago when debugging the original problem...

If any of these header files (to be precise, its modification time) changes, an extension module having it in its dependencies will get rebuilt. (The problem was this did not happen when ECLIB got rebuilt, such that these modules still used - or better: pulled-in - the old PARI library, which resulted in segfaults or import / dynamic linker errors.) 

Perhaps a little overkill (we just could rebuild all of these modules if *any* ECLIB header file changes), but as is may save some unnecessary rebuilds. ;-)

> About including the pari library:  Leif explained this to some extent on sage-devel.  I don't know (especially not what may or may not happen on cygwin) so perhaps it is safer to leave it in?

Well, I kept it for the moment (here; #9914 would remove the PARI library).

> If anyone ever has suggestions for improving the Makefiles for eclib I am always happy to receive them.  They were created during SD6 by editing old Makefiles of my own which had been evolving over years, so there may well be stuff in there which should not be.

Ok, I have some patched ECLIB spkg somewhere around. Perhaps needs some more work though.



---

archive/issue_comments_089185.json:
```json
{
    "body": "<div id=\"comment:174\" align=\"right\">comment:174</div>\n\nReplying to [@JohnCremona](#comment%3A172):\n> I agree that these modules need to be rebuilt if eclib is rebuilt;  but I don't see why that means that we have to list header files individually.  Can't we make these modules depend on the spkg itself?\n\nThe most generic way would be to make any extension module (explicitly) depend on the libraries it is linked to. (Though this certainly would also trigger unnecessary rebuilds, but is easy to implement and safe, assuming libraries change when there headers do.)\n\nRobert B. wanted to improve Cython s.t. we get rid of most of `module_list.py` (by using pragmas like `clib ...` etc. in the Cython files), which I think would also handle the true dependencies properly.\n\nSo I considered my change more or less temporary, and didn't address the dependencies of other modules **currently** not causing trouble. (As mentioned earlier, upgrading e.g. MPIR (#8664) will require further changes, and unless we get an improved Cython until then, I'll implement the above strategy in `setup.py`, but of course on another ticket. This one was at least originally meant to only or especially address the PARI upgrade, i.e. upgrading Sage to a version with the new PARI from one with the old.)",
    "created_at": "2010-10-27T16:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89185",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:174" align="right">comment:174</div>

Replying to [@JohnCremona](#comment%3A172):
> I agree that these modules need to be rebuilt if eclib is rebuilt;  but I don't see why that means that we have to list header files individually.  Can't we make these modules depend on the spkg itself?

The most generic way would be to make any extension module (explicitly) depend on the libraries it is linked to. (Though this certainly would also trigger unnecessary rebuilds, but is easy to implement and safe, assuming libraries change when there headers do.)

Robert B. wanted to improve Cython s.t. we get rid of most of `module_list.py` (by using pragmas like `clib ...` etc. in the Cython files), which I think would also handle the true dependencies properly.

So I considered my change more or less temporary, and didn't address the dependencies of other modules **currently** not causing trouble. (As mentioned earlier, upgrading e.g. MPIR (#8664) will require further changes, and unless we get an improved Cython until then, I'll implement the above strategy in `setup.py`, but of course on another ticket. This one was at least originally meant to only or especially address the PARI upgrade, i.e. upgrading Sage to a version with the new PARI from one with the old.)



---

archive/issue_comments_089186.json:
```json
{
    "body": "Changed reviewer from **John Palmieri** to **John Palmieri, Mitesh Patel**",
    "created_at": "2010-10-28T01:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89186",
    "user": "https://github.com/qed777"
}
```

Changed reviewer from **John Palmieri** to **John Palmieri, Mitesh Patel**



---

archive/issue_events_127360.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-28T01:20:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127360"
}
```



---

archive/issue_events_127361.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-28T01:20:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127361"
}
```



---

archive/issue_comments_089187.json:
```json
{
    "body": "<div id=\"comment:176\" align=\"right\">comment:176</div>\n\nThanks for finishing off the review.",
    "created_at": "2010-10-28T01:43:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89187",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:176" align="right">comment:176</div>

Thanks for finishing off the review.



---

archive/issue_comments_089188.json:
```json
{
    "body": "<div id=\"comment:177\" align=\"right\">comment:177</div>\n\nGreat!",
    "created_at": "2010-10-28T07:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89188",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:177" align="right">comment:177</div>

Great!



---

archive/issue_comments_089189.json:
```json
{
    "body": "<div id=\"comment:178\" align=\"right\">comment:178</div>\n\nReplying to [@jdemeyer](#comment%3A177):\n> Great!\n\nThe final review? We've only reached comment !#178... ;-)\n\nYes, thanks to you for setting up the test upgrade paths, and the reviewers!\n\n(#9914 is still an open question.)",
    "created_at": "2010-10-28T07:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89189",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:178" align="right">comment:178</div>

Replying to [@jdemeyer](#comment%3A177):
> Great!

The final review? We've only reached comment !#178... ;-)

Yes, thanks to you for setting up the test upgrade paths, and the reviewers!

(#9914 is still an open question.)



---

archive/issue_comments_089190.json:
```json
{
    "body": "<div id=\"comment:179\" align=\"right\">comment:179</div>\n\nGiven the number of things that look to be needed to update this, it would be good if one could create a small shell script, something like\n\n```\n#!/bin/sh\ncd devel/sage\nhg qimport /patch/to/raw-patch1\nhg qpush\nhg qimport /patch/to/raw-patch2\netc\n```\nso that we could check it easily. At the moment, looking at all those patches, it is rather off-putting!\n\nDave",
    "created_at": "2010-10-28T08:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89190",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:179" align="right">comment:179</div>

Given the number of things that look to be needed to update this, it would be good if one could create a small shell script, something like

```
#!/bin/sh
cd devel/sage
hg qimport /patch/to/raw-patch1
hg qpush
hg qimport /patch/to/raw-patch2
etc
```
so that we could check it easily. At the moment, looking at all those patches, it is rather off-putting!

Dave



---

archive/issue_events_127362.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-30T09:39:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127362"
}
```



---

archive/issue_events_127363.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-30T09:39:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9896#event-127363"
}
```



---

archive/issue_comments_089191.json:
```json
{
    "body": "<div id=\"comment:181\" align=\"right\">comment:181</div>\n\nA followup: on my mac, perhaps because of various symbolic links, whenever I run \"sage -b\", I see a message like\n\n```\nwarning: Replacing library search directory in linker command:\n  \"/Applications/sage_builds/sage-4.6/local/lib\" -> \"/Applications/sage/local/lib\"\n```\nI can run \"sage -b\" three times in a row, and I see this message all three times.\n\nThis may be because of symbolic links: \"/Applications/sage\" is a link pointing to \"/Applications/sage_builds/sage-4.6/\".\n\nPerhaps in setup.py, we should use os.path.realpath?  For example, \n\n```diff\ndiff -r cdc586ffbdfd setup.py\n--- a/setup.py  Mon Sep 13 00:52:40 2010 -0700\n+++ b/setup.py  Wed Nov 03 12:46:51 2010 -0700\n@@ -391,7 +391,7 @@\n                     self.debug_print(\n                       \"Library dir found in dynamic linker command: \" +\n                       \"\\\"%s\\\"\" % libdir)\n-                    if libdir != sage_libdir:\n+                    if os.path.realpath(libdir) != os.path.realpath(sage_libdir):\n                         self.compiler.warn(\n                           \"Replacing library search directory in linker \" +\n                           \"command:\\n  \\\"%s\\\" -> \\\"%s\\\"\\n\" % (libdir,\n```\nIf this sounds like a good idea, I can open a new ticket with this patch.",
    "created_at": "2010-11-03T19:47:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89191",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:181" align="right">comment:181</div>

A followup: on my mac, perhaps because of various symbolic links, whenever I run "sage -b", I see a message like

```
warning: Replacing library search directory in linker command:
  "/Applications/sage_builds/sage-4.6/local/lib" -> "/Applications/sage/local/lib"
```
I can run "sage -b" three times in a row, and I see this message all three times.

This may be because of symbolic links: "/Applications/sage" is a link pointing to "/Applications/sage_builds/sage-4.6/".

Perhaps in setup.py, we should use os.path.realpath?  For example, 

```diff
diff -r cdc586ffbdfd setup.py
--- a/setup.py  Mon Sep 13 00:52:40 2010 -0700
+++ b/setup.py  Wed Nov 03 12:46:51 2010 -0700
@@ -391,7 +391,7 @@
                     self.debug_print(
                       "Library dir found in dynamic linker command: " +
                       "\"%s\"" % libdir)
-                    if libdir != sage_libdir:
+                    if os.path.realpath(libdir) != os.path.realpath(sage_libdir):
                         self.compiler.warn(
                           "Replacing library search directory in linker " +
                           "command:\n  \"%s\" -> \"%s\"\n" % (libdir,
```
If this sounds like a good idea, I can open a new ticket with this patch.



---

archive/issue_comments_089192.json:
```json
{
    "body": "<div id=\"comment:182\" align=\"right\">comment:182</div>\n\nReplying to [@jhpalmieri](#comment%3A181):\n> A followup: on my mac, perhaps because of various symbolic links, whenever I run \"sage -b\", I see a message like\n\n\n```\nwarning: Replacing library search directory in linker command:\n  \"/Applications/sage_builds/sage-4.6/local/lib\" -> \"/Applications/sage/local/lib\"\n```\n> I can run \"sage -b\" three times in a row, and I see this message all three times.\n\nOf course. `distutils` reads the Python Makefile each time it is invoked by the Sage library's `setup()`; we do not (yet) patch that Makefile and `pyconfig,h`.\n\n\n> This may be because of symbolic links: \"/Applications/sage\" is a link pointing to \"/Applications/sage_builds/sage-4.6/\".\n\nYep.\n\n\n> Perhaps in setup.py, we should use os.path.realpath?\n> If this sounds like a good idea, I can open a new ticket with this patch.\n\nWell, it's just a warning; feel free to open a ticket for that, and I'll probably review it. ;-)",
    "created_at": "2010-11-03T20:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89192",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:182" align="right">comment:182</div>

Replying to [@jhpalmieri](#comment%3A181):
> A followup: on my mac, perhaps because of various symbolic links, whenever I run "sage -b", I see a message like


```
warning: Replacing library search directory in linker command:
  "/Applications/sage_builds/sage-4.6/local/lib" -> "/Applications/sage/local/lib"
```
> I can run "sage -b" three times in a row, and I see this message all three times.

Of course. `distutils` reads the Python Makefile each time it is invoked by the Sage library's `setup()`; we do not (yet) patch that Makefile and `pyconfig,h`.


> This may be because of symbolic links: "/Applications/sage" is a link pointing to "/Applications/sage_builds/sage-4.6/".

Yep.


> Perhaps in setup.py, we should use os.path.realpath?
> If this sounds like a good idea, I can open a new ticket with this patch.

Well, it's just a warning; feel free to open a ticket for that, and I'll probably review it. ;-)



---

archive/issue_comments_089193.json:
```json
{
    "body": "<div id=\"comment:183\" align=\"right\">comment:183</div>\n\nSee #10208.  I agree that it is just a warning, but it's a warning when there is nothing actually wrong, which might be distracting...",
    "created_at": "2010-11-03T21:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9896#issuecomment-89193",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:183" align="right">comment:183</div>

See #10208.  I agree that it is just a warning, but it's a warning when there is nothing actually wrong, which might be distracting...
