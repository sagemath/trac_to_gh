# Issue 9466: square root with all=True should not return ValueError but empty list

archive/issues_009466.json:
```json
{
    "body": "With Sage 4.4.4 and no relevant patches, I got the following:\n\n```\nsage: FiniteField(3)(2).sqrt(all = True)\n[]\n\nsage: 2.sqrt(extend = False, all = True)\nValueError: square root of 2 not an integer\n\nsage: FiniteField(next_prime(2^100))(2).sqrt(extend = False, all = True)\nValueError: self must be a square\n\nsage: _.<a>=FiniteField(9)\nsage: a.sqrt(extend = False, all = True)\nValueError: must be a perfect square.\n```\n\nAt sage days 23 we agreed that square root with all=True should not raise an error. If no square roots exist, then it should return an empty list.\n\nRight now, it returns an empty list for elements of small prime finite fields, but raises an error for integers, elements of large prime finite fields, and elements of non-prime finite fields.\n\napply\n\n* [attachment:9466.patch]\n\nAssignee: @aghitza\n\nCC:  @koffie ruckers\n\nKeywords: sd23 sd51 sqrt all\n\nReviewer: Alejandro Argaez, Angelos Koutsianas\n\nAuthor: Marco Streng, Sonseeahray Rucker\n\nMerged: sage-5.12.beta3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/9466\n\n",
    "closed_at": "2013-08-20T12:57:53Z",
    "created_at": "2010-07-09T13:18:25Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "square root with all=True should not return ValueError but empty list",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9466",
    "user": "https://github.com/mstreng"
}
```
With Sage 4.4.4 and no relevant patches, I got the following:

```
sage: FiniteField(3)(2).sqrt(all = True)
[]

sage: 2.sqrt(extend = False, all = True)
ValueError: square root of 2 not an integer

sage: FiniteField(next_prime(2^100))(2).sqrt(extend = False, all = True)
ValueError: self must be a square

sage: _.<a>=FiniteField(9)
sage: a.sqrt(extend = False, all = True)
ValueError: must be a perfect square.
```

At sage days 23 we agreed that square root with all=True should not raise an error. If no square roots exist, then it should return an empty list.

Right now, it returns an empty list for elements of small prime finite fields, but raises an error for integers, elements of large prime finite fields, and elements of non-prime finite fields.

apply

* [attachment:9466.patch]

Assignee: @aghitza

CC:  @koffie ruckers

Keywords: sd23 sd51 sqrt all

Reviewer: Alejandro Argaez, Angelos Koutsianas

Author: Marco Streng, Sonseeahray Rucker

Merged: sage-5.12.beta3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/9466





---

archive/issue_comments_106569.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+With Sage 4.4.4 and no relevant patches, I got the following:\n \n ```\n sage: FiniteField(3)(2).sqrt(all = True)\n``````\n",
    "created_at": "2010-07-09T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106569",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+With Sage 4.4.4 and no relevant patches, I got the following:
 
 ```
 sage: FiniteField(3)(2).sqrt(all = True)
``````




---

archive/issue_comments_106570.json:
```json
{
    "body": "Fixes the code:   sage: 2.sqrt(extend = False, all = True)",
    "created_at": "2012-02-08T05:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106570",
    "user": "https://trac.sagemath.org/admin/accounts/users/ruckers"
}
```

Fixes the code:   sage: 2.sqrt(extend = False, all = True)



---

archive/issue_comments_106571.json:
```json
{
    "body": "Attachment [my2.patch](tarball://root/attachments/some-uuid/ticket9466/my2.patch) by ruckers created at 2012-02-08 05:09:21\n\nFixes the code:  sage: FiniteField(next_prime(2^100))(2).sqrt(extend = False, all = True)",
    "created_at": "2012-02-08T05:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106571",
    "user": "https://trac.sagemath.org/admin/accounts/users/ruckers"
}
```

Attachment [my2.patch](tarball://root/attachments/some-uuid/ticket9466/my2.patch) by ruckers created at 2012-02-08 05:09:21

Fixes the code:  sage: FiniteField(next_prime(2^100))(2).sqrt(extend = False, all = True)



---

archive/issue_comments_106572.json:
```json
{
    "body": "<a id='comment:3'></a>\nI was not able to fix this code.\n\nsage: _.<a>=FiniteField(9)\n\nsage: a.sqrt(extend = False, all = True)\n\nValueError: must be a perfect square.",
    "created_at": "2012-02-08T05:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106572",
    "user": "https://trac.sagemath.org/admin/accounts/users/ruckers"
}
```

<a id='comment:3'></a>
I was not able to fix this code.

sage: _.<a>=FiniteField(9)

sage: a.sqrt(extend = False, all = True)

ValueError: must be a perfect square.



---

archive/issue_comments_106573.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks! That bug has been around for too long :)\n\nWhy were you not able to fix the `FiniteField(9)` case?\n\nUnfortunately, the patches need some more work, for the following three reasons.\n* With my2.patch:\n  {{{\n  sage: Zmod(7)(3).sqrt(extend=True)\n  sqrt3\n  sage: Zmod(7)(3).sqrt(all=True, extend=True)\n  []\n  }}}\n  The second one should either output `[sqrt3, -sqrt3]` or raise `NotImplementedError`, but never an empty list.\n* Patches must have your name and email address in them. This is done by putting your email address and name in your `.hgrc` file as specified [here](http://www.sagemath.org/doc/developer/walk_through.html#submitting-a-change)\n* Add an example of the new functionality to the documentation:\n  * This helps the user understand what the function does.\n  * Through the doctesting framework, this prevents other people from accidentally breaking your added functionality.\n  * This is [required](http://www.sagemath.org/doc/developer/trac.html#reviewing-patches) for your patch to be able to get a positive review. In fact, the manual says that you should also mention the ticket number #9466 with your example.\n\nIf you have any questions, let me know!",
    "created_at": "2012-02-08T10:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106573",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:4'></a>
Thanks! That bug has been around for too long :)

Why were you not able to fix the `FiniteField(9)` case?

Unfortunately, the patches need some more work, for the following three reasons.
* With my2.patch:
  {{{
  sage: Zmod(7)(3).sqrt(extend=True)
  sqrt3
  sage: Zmod(7)(3).sqrt(all=True, extend=True)
  []
  }}}
  The second one should either output `[sqrt3, -sqrt3]` or raise `NotImplementedError`, but never an empty list.
* Patches must have your name and email address in them. This is done by putting your email address and name in your `.hgrc` file as specified [here](http://www.sagemath.org/doc/developer/walk_through.html#submitting-a-change)
* Add an example of the new functionality to the documentation:
  * This helps the user understand what the function does.
  * Through the doctesting framework, this prevents other people from accidentally breaking your added functionality.
  * This is [required](http://www.sagemath.org/doc/developer/trac.html#reviewing-patches) for your patch to be able to get a positive review. In fact, the manual says that you should also mention the ticket number #9466 with your example.

If you have any questions, let me know!



---

archive/issue_comments_106574.json:
```json
{
    "body": "Attachment [9466.2.patch](tarball://root/attachments/some-uuid/ticket9466/9466.2.patch) by @mstreng created at 2013-07-25 18:20:22",
    "created_at": "2013-07-25T18:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106574",
    "user": "https://github.com/mstreng"
}
```

Attachment [9466.2.patch](tarball://root/attachments/some-uuid/ticket9466/9466.2.patch) by @mstreng created at 2013-07-25 18:20:22



---

archive/issue_comments_106575.json:
```json
{
    "body": "Attachment [9466.3.patch](tarball://root/attachments/some-uuid/ticket9466/9466.3.patch) by @mstreng created at 2013-07-25 18:21:59",
    "created_at": "2013-07-25T18:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106575",
    "user": "https://github.com/mstreng"
}
```

Attachment [9466.3.patch](tarball://root/attachments/some-uuid/ticket9466/9466.3.patch) by @mstreng created at 2013-07-25 18:21:59



---

archive/issue_comments_106576.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd23 sd51 sqrt all\".",
    "created_at": "2013-07-25T18:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106576",
    "user": "https://github.com/mstreng"
}
```

Changing keywords from "" to "sd23 sd51 sqrt all".



---

archive/issue_comments_106577.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [9466.patch](tarball://root/attachments/some-uuid/ticket9466/9466.patch) by @mstreng created at 2013-07-25 18:31:32\n\nDoes anyone know who user \"ruckers\" is? (s)he should be added to the list of authors\n\napply 9466.patch",
    "created_at": "2013-07-25T18:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106577",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:5'></a>
Attachment [9466.patch](tarball://root/attachments/some-uuid/ticket9466/9466.patch) by @mstreng created at 2013-07-25 18:31:32

Does anyone know who user "ruckers" is? (s)he should be added to the list of authors

apply 9466.patch



---

archive/issue_comments_106578.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,7 @@\n At sage days 23 we agreed that square root with all=True should not raise an error. If no square roots exist, then it should return an empty list.\n \n Right now, it returns an empty list for elements of small prime finite fields, but raises an error for integers, elements of large prime finite fields, and elements of non-prime finite fields.\n+\n+apply\n+\n+* [attachment:9466.patch]\n``````\n",
    "created_at": "2013-07-25T18:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106578",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,7 @@
 At sage days 23 we agreed that square root with all=True should not raise an error. If no square roots exist, then it should return an empty list.
 
 Right now, it returns an empty list for elements of small prime finite fields, but raises an error for integers, elements of large prime finite fields, and elements of non-prime finite fields.
+
+apply
+
+* [attachment:9466.patch]
``````




---

archive/issue_comments_106579.json:
```json
{
    "body": "Changing author from \"\" to \"Marco Streng\"",
    "created_at": "2013-07-25T18:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106579",
    "user": "https://github.com/mstreng"
}
```

Changing author from "" to "Marco Streng"



---

archive/issue_comments_106580.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-25T20:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106580",
    "user": "https://github.com/mstreng"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106581.json:
```json
{
    "body": "<a id='comment:6'></a>\nplease review!",
    "created_at": "2013-07-25T20:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106581",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:6'></a>
please review!



---

archive/issue_comments_106582.json:
```json
{
    "body": "Changing author from \"Marco Streng\" to \"Marco Streng and the person with trac account ruckers\"",
    "created_at": "2013-07-25T20:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106582",
    "user": "https://github.com/mstreng"
}
```

Changing author from "Marco Streng" to "Marco Streng and the person with trac account ruckers"



---

archive/issue_comments_106583.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-26T10:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106583",
    "user": "https://trac.sagemath.org/admin/accounts/users/akoutsianas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106584.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Alejandro Argaez, Angelos Koutsianas\"",
    "created_at": "2013-07-26T10:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106584",
    "user": "https://trac.sagemath.org/admin/accounts/users/akoutsianas"
}
```

Changing reviewer from "" to "Alejandro Argaez, Angelos Koutsianas"



---

archive/issue_comments_106585.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe patch passed all the tests for sage 5.11 version.",
    "created_at": "2013-07-26T10:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106585",
    "user": "https://trac.sagemath.org/admin/accounts/users/akoutsianas"
}
```

<a id='comment:7'></a>
The patch passed all the tests for sage 5.11 version.



---

archive/issue_events_036171.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-29T11:06:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9466#event-36171"
}
```



---

archive/issue_comments_106586.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T12:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106586",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_106587.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.12.beta3\"",
    "created_at": "2013-08-20T12:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106587",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.12.beta3"



---

archive/issue_events_036172.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:57:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9466#event-36172"
}
```



---

archive/issue_comments_106588.json:
```json
{
    "body": "Changing author from \"Marco Streng and the person with trac account ruckers\" to \"Marco Streng, Sonseeahray Rucker\"",
    "created_at": "2015-05-27T13:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9466#issuecomment-106588",
    "user": "https://github.com/kcrisman"
}
```

Changing author from "Marco Streng and the person with trac account ruckers" to "Marco Streng, Sonseeahray Rucker"
