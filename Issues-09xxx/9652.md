# Issue 9652: Unnecesary and buggy code in arith.py

archive/issues_009652.json:
```json
{
    "assignees": [
        "https://github.com/koffie"
    ],
    "body": "This code was added in #1148. I really think that the lines removed in my patch should be gone. The current (4.4.4) code is:\n\n```\ndef valuation(m, p):\n    if hasattr(m, 'valuation'):\n        return m.valuation(p)\n    if is_FractionFieldElement(m):  \n        return valuation(m.numerator()) - valuation(m.denominator())\n    if m == 0:\n        import sage.rings.all\n        return sage.rings.all.infinity\n    r = 0\n    power = p\n    while not (m % power): # m % power == 0\n        r += 1\n        power *= p\n    return r\n```\n\nPutting implementation specific to Fraction fields in a global function is bad practice. And since fraction fields have an implementation of valuation part of the above code will not be execucted. If it magicaly get's excecuted it will return bad results since it doesn't take into account the input variable \"p\" as it should.\n\nPatches to apply in order:\n\n1. smallfix1-arith_valuation.2.3.patch\n\n2. smallfix1-arith_valuation-doctest.2.3.patch \n\nCC:  @mstreng @lftabera\n\nComponent: **algebra**\n\nAuthor: **Maarten Derickx**\n\nReviewer: **Marco Streng, John Cremona, Luis Felipe Tabera**\n\nMerged: **sage-4.6.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9652_\n\n",
    "closed_at": "2010-09-15T11:14:02Z",
    "created_at": "2010-07-31T20:35:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Unnecesary and buggy code in arith.py",
    "type": "issue",
    "updated_at": "2010-09-15T11:14:02Z",
    "url": "https://github.com/sagemath/sage/issues/9652",
    "user": "https://github.com/koffie"
}
```
This code was added in #1148. I really think that the lines removed in my patch should be gone. The current (4.4.4) code is:

```
def valuation(m, p):
    if hasattr(m, 'valuation'):
        return m.valuation(p)
    if is_FractionFieldElement(m):  
        return valuation(m.numerator()) - valuation(m.denominator())
    if m == 0:
        import sage.rings.all
        return sage.rings.all.infinity
    r = 0
    power = p
    while not (m % power): # m % power == 0
        r += 1
        power *= p
    return r
```

Putting implementation specific to Fraction fields in a global function is bad practice. And since fraction fields have an implementation of valuation part of the above code will not be execucted. If it magicaly get's excecuted it will return bad results since it doesn't take into account the input variable "p" as it should.

Patches to apply in order:

1. smallfix1-arith_valuation.2.3.patch

2. smallfix1-arith_valuation-doctest.2.3.patch 

CC:  @mstreng @lftabera

Component: **algebra**

Author: **Maarten Derickx**

Reviewer: **Marco Streng, John Cremona, Luis Felipe Tabera**

Merged: **sage-4.6.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/9652_





---

archive/issue_events_125122.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-31T20:35:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125122"
}
```



---

archive/issue_events_125123.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-31T20:35:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125123"
}
```



---

archive/issue_events_125124.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-31T20:35:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125124"
}
```



---

archive/issue_events_125125.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-07-31T20:35:45Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "subject": "https://github.com/koffie",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125125"
}
```



---

archive/issue_events_125126.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-07-31T20:39:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125126"
}
```



---

archive/issue_comments_084476.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nTwo questions:\n\n* Is there any case in which any code after `return infinity` is executed and succesful?\n* Is there any case in which any code after `return m.valuation(...)` is executed and useful?\n\nCan't you remove a lot more while you are at it? The code seems to be there to catch off weird unexpected cases that don't have a valuation attribute, but\n\n1. if the case is weird enough, then nothing guarantees that this function terminates\n2. if the case happens to have a negative valuation, then the function returns 0 instead of a negative number\n\nWhile you are at it, I found that the function doesn't handle the valuation attribute of power series well (because it doesn't allow you to specify the (unique) prime p).\n\n```\nx = QQ[['x']].gen()\nvaluation(x^2, x)\nTypeError: valuation() takes no arguments (1 given)\nvaluation(x^2)\nTypeError: valuation() takes exactly 2 arguments (1 given)\n```\nThe first error is because `PowerSeries.valuation()` takes no arguments; the second is because the global function takes exactly 2 arguments.\n\nHow about defining the global function simply as follows?\n\n```\ndef valuation(m, *args1, **args2):\n    return m.valuation(*args1, **args2)\n```\nor\n\n```\ndef valuation(m, *args1, **args2):\n    if m == 0:\n        return sage.rings.all.infinity\n    return m.valuation(*args1, **args2)\n```\nI haven't tried and/or ran any doctests with this, but anything that is broken by this isn't good coding practice, as you said :) Plus this fixes my example with `valuation(x^2)`.",
    "created_at": "2010-08-02T14:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84476",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:2" align="right">comment:2</div>

Two questions:

* Is there any case in which any code after `return infinity` is executed and succesful?
* Is there any case in which any code after `return m.valuation(...)` is executed and useful?

Can't you remove a lot more while you are at it? The code seems to be there to catch off weird unexpected cases that don't have a valuation attribute, but

1. if the case is weird enough, then nothing guarantees that this function terminates
2. if the case happens to have a negative valuation, then the function returns 0 instead of a negative number

While you are at it, I found that the function doesn't handle the valuation attribute of power series well (because it doesn't allow you to specify the (unique) prime p).

```
x = QQ[['x']].gen()
valuation(x^2, x)
TypeError: valuation() takes no arguments (1 given)
valuation(x^2)
TypeError: valuation() takes exactly 2 arguments (1 given)
```
The first error is because `PowerSeries.valuation()` takes no arguments; the second is because the global function takes exactly 2 arguments.

How about defining the global function simply as follows?

```
def valuation(m, *args1, **args2):
    return m.valuation(*args1, **args2)
```
or

```
def valuation(m, *args1, **args2):
    if m == 0:
        return sage.rings.all.infinity
    return m.valuation(*args1, **args2)
```
I haven't tried and/or ran any doctests with this, but anything that is broken by this isn't good coding practice, as you said :) Plus this fixes my example with `valuation(x^2)`.



---

archive/issue_comments_084477.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI guess the code underneath there is for python integers, but I'm not sure. I will look into your questions when I have the time.\n\nps. similar practices seem to be going on a lot in arith.py I created a discussion on sage-devel. This discussion is not so much to discuss this specific example in detail, but to find a nice general solution for dealing with the problems involved when both using global functions an class methods to do the same thing.\n\nI guess your remark about just passing all the aruments to the class method instead of having a static signature should be of value in that discussion also.",
    "created_at": "2010-08-02T15:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84477",
    "user": "https://github.com/koffie"
}
```

<div id="comment:4" align="right">comment:4</div>

I guess the code underneath there is for python integers, but I'm not sure. I will look into your questions when I have the time.

ps. similar practices seem to be going on a lot in arith.py I created a discussion on sage-devel. This discussion is not so much to discuss this specific example in detail, but to find a nice general solution for dealing with the problems involved when both using global functions an class methods to do the same thing.

I guess your remark about just passing all the aruments to the class method instead of having a static signature should be of value in that discussion also.



---

archive/issue_comments_084478.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe code is indeed for python integers, and produces the right output in that case as the following shows.\n\n```\nsage: a=344r\nsage: type(a)\n<type 'int'>\nsage: hasattr(a,\"valuation\")\nFalse\nsage: valuation(a,2)\n3\n```\n\nI agree with you that that code should not be excecuted on general ring elements.\n\nIt crashes on local elements of the symbolic ring for example.\n\n```\nsage: var(\"z\")\nz\nsage: valuation(z^2,z)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Applications/sage/devel/sage-mderickx/<ipython console> in <module>()\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/rings/arith.pyc in valuation(m, p)\n    604     r = 0\n    605     power = p\n--> 606     while not (m % power): # m % power == 0\n    607         r += 1\n    608         power *= p\n\nTypeError: unsupported operand type(s) for %: 'sage.symbolic.expression.Expression' and 'sage.symbolic.expression.Expression'\n```\n.\n\nIn your remark 2. The code could also crash, for example try (1/2) % 2.\nI tried to find some real examples in sage, but I can't seem to find how to localize rings in sage. Maybe it's not implemented yet. The only thing I could find is: http://www.sagemath.org/doc/reference/coercion.html#example.\n\nMy failing quest to find other examples than python integers lead me to believe that this code should indeed only be excecuted on python integers.",
    "created_at": "2010-08-02T16:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84478",
    "user": "https://github.com/koffie"
}
```

<div id="comment:5" align="right">comment:5</div>

The code is indeed for python integers, and produces the right output in that case as the following shows.

```
sage: a=344r
sage: type(a)
<type 'int'>
sage: hasattr(a,"valuation")
False
sage: valuation(a,2)
3
```

I agree with you that that code should not be excecuted on general ring elements.

It crashes on local elements of the symbolic ring for example.

```
sage: var("z")
z
sage: valuation(z^2,z)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Applications/sage/devel/sage-mderickx/<ipython console> in <module>()

/Applications/sage/local/lib/python2.6/site-packages/sage/rings/arith.pyc in valuation(m, p)
    604     r = 0
    605     power = p
--> 606     while not (m % power): # m % power == 0
    607         r += 1
    608         power *= p

TypeError: unsupported operand type(s) for %: 'sage.symbolic.expression.Expression' and 'sage.symbolic.expression.Expression'
```
.

In your remark 2. The code could also crash, for example try (1/2) % 2.
I tried to find some real examples in sage, but I can't seem to find how to localize rings in sage. Maybe it's not implemented yet. The only thing I could find is: http://www.sagemath.org/doc/reference/coercion.html#example.

My failing quest to find other examples than python integers lead me to believe that this code should indeed only be excecuted on python integers.



---

archive/issue_comments_084479.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAh yes, python integers. Then perhaps first test if m is a python integer and call `Integer(m).valuation(*args1, **args2)` if it is and `m.valuation(*args1, **args2)` otherwise. I think you should leave out the `m == 0` check because nobody wants `valuation(0, 0)` or `valuation(0, 'whatever')` to give any output.",
    "created_at": "2010-08-02T17:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84479",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:6" align="right">comment:6</div>

Ah yes, python integers. Then perhaps first test if m is a python integer and call `Integer(m).valuation(*args1, **args2)` if it is and `m.valuation(*args1, **args2)` otherwise. I think you should leave out the `m == 0` check because nobody wants `valuation(0, 0)` or `valuation(0, 'whatever')` to give any output.



---

archive/issue_comments_084480.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n`valuation(int(1), int(1))` goes into an infinite loop",
    "created_at": "2010-08-02T18:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84480",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:7" align="right">comment:7</div>

`valuation(int(1), int(1))` goes into an infinite loop



---

archive/issue_comments_084481.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOk so the code behaves buggy for valuation(1r,1r).  I really think we should just let sage integers handle it. I really don't like having unneccery double code. Especially if one of the two is buggy.\n\nBy the way, the problem with valuation(0r,0r) is not just a problem of this code, it also happes with valuation on sage ints. Should we report that as a bug?\n\n```\nsage: 0.valuation(0)\n+Infinity\nsage: 8.valuation(0)\nValueError                                Traceback (most recent call last)\n...\nValueError: You can only compute the valuation with respect to a integer larger than 1.\n```\nps. if you want a number to not be converted to a sage integer by the preparser you should just put an r behind the number. Or else the preparser will generate the following silly code:\n\n```\nsage: preparse(\"valuation(int(1),int(1)\")\n'valuation(int(Integer(1)),int(Integer(1))'\n```\nWhat you want is this:\n\n```\nsage: preparse(\"valuation(1r,1r)\")\n'valuation(1,1)'\n```",
    "created_at": "2010-08-02T18:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84481",
    "user": "https://github.com/koffie"
}
```

<div id="comment:8" align="right">comment:8</div>

Ok so the code behaves buggy for valuation(1r,1r).  I really think we should just let sage integers handle it. I really don't like having unneccery double code. Especially if one of the two is buggy.

By the way, the problem with valuation(0r,0r) is not just a problem of this code, it also happes with valuation on sage ints. Should we report that as a bug?

```
sage: 0.valuation(0)
+Infinity
sage: 8.valuation(0)
ValueError                                Traceback (most recent call last)
...
ValueError: You can only compute the valuation with respect to a integer larger than 1.
```
ps. if you want a number to not be converted to a sage integer by the preparser you should just put an r behind the number. Or else the preparser will generate the following silly code:

```
sage: preparse("valuation(int(1),int(1)")
'valuation(int(Integer(1)),int(Integer(1))'
```
What you want is this:

```
sage: preparse("valuation(1r,1r)")
'valuation(1,1)'
```



---

archive/issue_comments_084482.json:
```json
{
    "body": "Attachment: **[smallfix1-arith_valuation.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.patch.gz)**",
    "created_at": "2010-08-02T18:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84482",
    "user": "https://github.com/koffie"
}
```

Attachment: **[smallfix1-arith_valuation.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.patch.gz)**



---

archive/issue_comments_084483.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nYou have added the extra arguments but have not documented them, or given any examples where they might be used.  That's not good!\n\nFor the main code, why not do\n\n```\ntry:\n  return m.valuation(p)\nexcept AttributeError:\n   pass\ntry:\n   return Integer(m).valuation(Integer(p))\nexcept (something):\n   raise an error\n```",
    "created_at": "2010-08-22T13:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84483",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

You have added the extra arguments but have not documented them, or given any examples where they might be used.  That's not good!

For the main code, why not do

```
try:
  return m.valuation(p)
except AttributeError:
   pass
try:
   return Integer(m).valuation(Integer(p))
except (something):
   raise an error
```



---

archive/issue_events_125127.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-22T13:16:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125127"
}
```



---

archive/issue_events_125128.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-08-22T13:16:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125128"
}
```



---

archive/issue_comments_084484.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWasn't the whole point of the extra arguments *args1, **args2 to make the global function `valuation` also work for power series? It doesn't in the current Sage, and it wouldn't with John's suggestion, but actually, it also doesn't with Maarten's patch.\n\nTo make it work, remove p. That is, replace \"`p,*args1, **args2`\" by \"`*args1, **args2`\" or simply \"`*args1`\" both times it occurs in your patch.\n\nIn the EXAMPLES block, you could add\n\n```\nsage: y = QQ['y'].gen()\nsage: valuation(y^3, y)\n3\nsage: x = QQ[['x']].gen()\nsage: valuation(x^2)\n2\n```\n\nThis doesn't really belong to the topic of this patch, but as you are rewriting the function anyway...",
    "created_at": "2010-08-22T19:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84484",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:10" align="right">comment:10</div>

Wasn't the whole point of the extra arguments *args1, **args2 to make the global function `valuation` also work for power series? It doesn't in the current Sage, and it wouldn't with John's suggestion, but actually, it also doesn't with Maarten's patch.

To make it work, remove p. That is, replace "`p,*args1, **args2`" by "`*args1, **args2`" or simply "`*args1`" both times it occurs in your patch.

In the EXAMPLES block, you could add

```
sage: y = QQ['y'].gen()
sage: valuation(y^3, y)
3
sage: x = QQ[['x']].gen()
sage: valuation(x^2)
2
```

This doesn't really belong to the topic of this patch, but as you are rewriting the function anyway...



---

archive/issue_comments_084485.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThat looks better!",
    "created_at": "2010-08-22T20:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84485",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

That looks better!



---

archive/issue_comments_084486.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI added a second patch which takes most of the comments into account. (please only apply the second patch, it got added as a second patch since I forgot to check the \"replace existing file\" box).\n\nI didn't do anything with the \"For the main code, why not !do:\" suggestion since to me it seemed to do the same thing but then with a different coding style. (My version is the \"look before you leap version\", and yours the \"Easier to ask for forgiveness than permission.\"). If there are reasons to chose one above the other I would certainly do that. I know that my code will raise an attribute error sometimes, an error that you would rewrite in your case. But I guess that error should be not confusing at all to the enduser.\n\n```\n\nsage: valuation(graphs.!PetersenGraph())\n\n---------------------------------------------------------------------------\n\n!AttributeError \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Traceback (most recent call last)\n\n/Users/maarten/<ipython console> in <module>()\n\n/Applications/sage/local/lib/python2.6/site-packages/sage/rings/arith.pyc in valuation(m, *args1, **args2)\n\n\u00a0\u00a0 \u00a0600 \u00a0 \u00a0 if isinstance(m,(int,long)):\n\n\u00a0\u00a0 \u00a0601 \u00a0 \u00a0 \u00a0 \u00a0 m=Integer(m)\n\n--> 602 \u00a0 \u00a0 return m.valuation(*args1, **args2)\n\n\u00a0\u00a0 \u00a0603\u00a0\n\n\u00a0\u00a0 \u00a0604 def prime_powers(start, stop=None):\n\n!AttributeError: 'Graph' object has no attribute 'valuation'\n\nsage:\u00a0\n\n```",
    "created_at": "2010-09-06T17:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84486",
    "user": "https://github.com/koffie"
}
```

<div id="comment:12" align="right">comment:12</div>

I added a second patch which takes most of the comments into account. (please only apply the second patch, it got added as a second patch since I forgot to check the "replace existing file" box).

I didn't do anything with the "For the main code, why not !do:" suggestion since to me it seemed to do the same thing but then with a different coding style. (My version is the "look before you leap version", and yours the "Easier to ask for forgiveness than permission."). If there are reasons to chose one above the other I would certainly do that. I know that my code will raise an attribute error sometimes, an error that you would rewrite in your case. But I guess that error should be not confusing at all to the enduser.

```

sage: valuation(graphs.!PetersenGraph())

---------------------------------------------------------------------------

!AttributeError                            Traceback (most recent call last)

/Users/maarten/<ipython console> in <module>()

/Applications/sage/local/lib/python2.6/site-packages/sage/rings/arith.pyc in valuation(m, *args1, **args2)

    600     if isinstance(m,(int,long)):

    601         m=Integer(m)

--> 602     return m.valuation(*args1, **args2)

    603 

    604 def prime_powers(start, stop=None):

!AttributeError: 'Graph' object has no attribute 'valuation'

sage: 

```



---

archive/issue_events_125129.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-06T17:21:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125129"
}
```



---

archive/issue_events_125130.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-06T17:21:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125130"
}
```



---

archive/issue_comments_084487.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nYou have to import \"Integer\" somewhere in the code:\n\n```\nsage: a=int(3)\nsage: valuation(a,2)\n...\n--> 695         m=Integer(m)\n...\nNameError: global name 'Integer' is not defined\n```\n\nAdd a doctest that uses an 'int' as argument to check that the previous code will work.\n\nIn the documentation, it says that valuation os zero is +Infinity but valuation with respect to zero is an error. However:\n\n```\nsage: valuation(0,0)\n+Infinity\nsage: K=QQ['x']\nsage: x=K.gen()\nsage: valuation(x,K(0))\n...\nPariError\nsage: valuation(K(0),K(0))\n+Infinity\n```",
    "created_at": "2010-09-08T13:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84487",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:13" align="right">comment:13</div>

You have to import "Integer" somewhere in the code:

```
sage: a=int(3)
sage: valuation(a,2)
...
--> 695         m=Integer(m)
...
NameError: global name 'Integer' is not defined
```

Add a doctest that uses an 'int' as argument to check that the previous code will work.

In the documentation, it says that valuation os zero is +Infinity but valuation with respect to zero is an error. However:

```
sage: valuation(0,0)
+Infinity
sage: K=QQ['x']
sage: x=K.gen()
sage: valuation(x,K(0))
...
PariError
sage: valuation(K(0),K(0))
+Infinity
```



---

archive/issue_events_125131.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-08T13:35:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125131"
}
```



---

archive/issue_events_125132.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-08T13:35:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125132"
}
```



---

archive/issue_comments_084488.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhy do you let the code work for float, but not for RealNumber? (I wouldn't let it work for float at all.)",
    "created_at": "2010-09-08T14:17:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84488",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:14" align="right">comment:14</div>

Why do you let the code work for float, but not for RealNumber? (I wouldn't let it work for float at all.)



---

archive/issue_comments_084489.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mstreng](#comment:14):\n> Why do you let the code work for float, but not for RealNumber? (I wouldn't let it work for float at all.)\n\nCould you elaborate that? For me, the code fails for floats with an AttributeError exception (as well as RealNumber).",
    "created_at": "2010-09-08T15:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84489",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mstreng](#comment:14):
> Why do you let the code work for float, but not for RealNumber? (I wouldn't let it work for float at all.)

Could you elaborate that? For me, the code fails for floats with an AttributeError exception (as well as RealNumber).



---

archive/issue_comments_084490.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI talked with Marco (mstreng) in real live. And his comment should be ignored as it was based on something he misread.",
    "created_at": "2010-09-08T18:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84490",
    "user": "https://github.com/koffie"
}
```

<div id="comment:16" align="right">comment:16</div>

I talked with Marco (mstreng) in real live. And his comment should be ignored as it was based on something he misread.



---

archive/issue_events_125133.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-08T21:36:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125133"
}
```



---

archive/issue_events_125134.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-08T21:36:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125134"
}
```



---

archive/issue_comments_084491.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI added the import and doctest as lftabera suggested. \n\nI didn't do anything with the comment about QQ['x'] since I already changed the documentation of the global function to say that you really should look at the documentation of the attribute functions. And the behaviour you show is consistent with the documentation of the attribute function.",
    "created_at": "2010-09-08T21:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84491",
    "user": "https://github.com/koffie"
}
```

<div id="comment:17" align="right">comment:17</div>

I added the import and doctest as lftabera suggested. 

I didn't do anything with the comment about QQ['x'] since I already changed the documentation of the global function to say that you really should look at the documentation of the attribute functions. And the behaviour you show is consistent with the documentation of the attribute function.



---

archive/issue_events_125135.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-10T07:45:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125135"
}
```



---

archive/issue_events_125136.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-10T07:45:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125136"
}
```



---

archive/issue_comments_084492.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI found the following doctest failures (4.5.2):\n\nsage -t -long \"devel/sage-devel/sage/quadratic_forms/count_local_2.pyx\"\n\nsage -t -long \"devel/sage-devel/sage/quadratic_forms/quadratic_form__count_local_2.py\"\n\nsage -t -long \"devel/sage-devel/sage/quadratic_forms/quadratic_form__local_density_congruence.py\"\n\nsage -t -long \"devel/sage-devel/sage/quadratic_forms/quadratic_form__local_representation_conditions.py\"\n\n\nall related with\n\nAttributeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object has no attribute 'valuation'\n\n\n\nAlso, in the code, you import Integers in the case of 'int' or 'float'. However, the local namespace of arith contains ZZ. I have checked and it is fastr to use ZZ(m) instead of importing Integer and using Integer(m). This is a corner case though.",
    "created_at": "2010-09-10T07:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84492",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:18" align="right">comment:18</div>

I found the following doctest failures (4.5.2):

sage -t -long "devel/sage-devel/sage/quadratic_forms/count_local_2.pyx"

sage -t -long "devel/sage-devel/sage/quadratic_forms/quadratic_form__count_local_2.py"

sage -t -long "devel/sage-devel/sage/quadratic_forms/quadratic_form__local_density_congruence.py"

sage -t -long "devel/sage-devel/sage/quadratic_forms/quadratic_form__local_representation_conditions.py"


all related with

AttributeError: 'sage.rings.finite_rings.integer_mod.IntegerMod_int' object has no attribute 'valuation'



Also, in the code, you import Integers in the case of 'int' or 'float'. However, the local namespace of arith contains ZZ. I have checked and it is fastr to use ZZ(m) instead of importing Integer and using Integer(m). This is a corner case though.



---

archive/issue_comments_084493.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIs there somewhere in the math literature a definition of what a valuation should be for \"Ring of integers modulo n\", cause the way it behaves right now in sage doesn't agree with my definition of what conditions a valuation should satisfy. If v is a valuation then in particular I would like to have v(a*b)=v(a)+v(b). But in sage right now you get the following:\n\n sage: for i in R: \n....:     for j in R: \n....:         if not valuation(i,Integer(3))+valuation(j,Integer(3))==valuation(i*j,Integer(3)):\n....:             print i,j\n....:             \n3 3\n3 6\n6 3\n6 6",
    "created_at": "2010-09-10T12:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84493",
    "user": "https://github.com/koffie"
}
```

<div id="comment:19" align="right">comment:19</div>

Is there somewhere in the math literature a definition of what a valuation should be for "Ring of integers modulo n", cause the way it behaves right now in sage doesn't agree with my definition of what conditions a valuation should satisfy. If v is a valuation then in particular I would like to have v(a*b)=v(a)+v(b). But in sage right now you get the following:

 sage: for i in R: 
....:     for j in R: 
....:         if not valuation(i,Integer(3))+valuation(j,Integer(3))==valuation(i*j,Integer(3)):
....:             print i,j
....:             
3 3
3 6
6 3
6 6



---

archive/issue_comments_084494.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\noops, now with the right formatting:\n\n```\n\n sage: for i in R: \n....:     for j in R: \n....:         if not valuation(i,Integer(3))+valuation(j,Integer(3))==valuation(i*j,Integer(3)):\n....:             print i,j\n....:             \n3 3\n3 6\n6 3\n6 6\n```",
    "created_at": "2010-09-10T12:19:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84494",
    "user": "https://github.com/koffie"
}
```

<div id="comment:20" align="right">comment:20</div>

oops, now with the right formatting:

```

 sage: for i in R: 
....:     for j in R: 
....:         if not valuation(i,Integer(3))+valuation(j,Integer(3))==valuation(i*j,Integer(3)):
....:             print i,j
....:             
3 3
3 6
6 3
6 6
```



---

archive/issue_comments_084495.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nBy the way: R=ZZ.quo(9)",
    "created_at": "2010-09-10T12:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84495",
    "user": "https://github.com/koffie"
}
```

<div id="comment:21" align="right">comment:21</div>

By the way: R=ZZ.quo(9)



---

archive/issue_comments_084496.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI am afraid that there are quite a bit of algorithms in SAGE that deal with IntegerModInt as plain Integer. The algorithms work, but you may fail to give a standar mathematical sense to them. This would be an example.",
    "created_at": "2010-09-10T13:12:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84496",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:22" align="right">comment:22</div>

I am afraid that there are quite a bit of algorithms in SAGE that deal with IntegerModInt as plain Integer. The algorithms work, but you may fail to give a standar mathematical sense to them. This would be an example.



---

archive/issue_comments_084497.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOk, then i'll just move the relevant parts of the old code so it becomes an attribute function of\u00a0IntegerModInt\u00a0together with a note section that sais that it's not a valuation in the mathematical sense.",
    "created_at": "2010-09-10T13:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84497",
    "user": "https://github.com/koffie"
}
```

<div id="comment:23" align="right">comment:23</div>

Ok, then i'll just move the relevant parts of the old code so it becomes an attribute function of IntegerModInt together with a note section that sais that it's not a valuation in the mathematical sense.



---

archive/issue_events_125137.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-09-11T08:53:24Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "subject": "https://github.com/koffie",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125137"
}
```



---

archive/issue_events_125138.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-11T08:53:24Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "subject": "https://github.com/koffie",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125138"
}
```



---

archive/issue_comments_084498.json:
```json
{
    "body": "Use this one, the other is an old version",
    "created_at": "2010-09-11T08:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84498",
    "user": "https://github.com/koffie"
}
```

Use this one, the other is an old version



---

archive/issue_comments_084499.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAttachment: **[smallfix1-arith_valuation.2.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.patch.gz)**\n\nOk, I moved the code, and the integer mod classes now also have a valuation attribute. All doctest should pass now when patching against 4.4.4 (sorry haven't updated in a while).",
    "created_at": "2010-09-11T08:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84499",
    "user": "https://github.com/koffie"
}
```

<div id="comment:25" align="right">comment:25</div>

Attachment: **[smallfix1-arith_valuation.2.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.patch.gz)**

Ok, I moved the code, and the integer mod classes now also have a valuation attribute. All doctest should pass now when patching against 4.4.4 (sorry haven't updated in a while).



---

archive/issue_events_125139.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-11T08:56:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125139"
}
```



---

archive/issue_events_125140.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2010-09-11T08:56:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125140"
}
```



---

archive/issue_comments_084500.json:
```json
{
    "body": "Attachment: **[smallfix1-arith_valuation.2.2.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.2.patch.gz)**\n\nUse this one, the other is an old version",
    "created_at": "2010-09-12T10:52:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84500",
    "user": "https://github.com/koffie"
}
```

Attachment: **[smallfix1-arith_valuation.2.2.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.2.patch.gz)**

Use this one, the other is an old version



---

archive/issue_comments_084501.json:
```json
{
    "body": "previous patch with clenaer comment in the header",
    "created_at": "2010-09-14T11:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84501",
    "user": "https://github.com/lftabera"
}
```

previous patch with clenaer comment in the header



---

archive/issue_comments_084502.json:
```json
{
    "body": "Attachment: **[smallfix1-arith_valuation.2.3.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.3.patch.gz)**\n\nAttachment: **[smallfix1-arith_valuation-doctest.2.3.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation-doctest.2.3.patch.gz)**\n\nadditional doctest",
    "created_at": "2010-09-14T11:27:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84502",
    "user": "https://github.com/lftabera"
}
```

Attachment: **[smallfix1-arith_valuation.2.3.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation.2.3.patch.gz)**

Attachment: **[smallfix1-arith_valuation-doctest.2.3.patch.gz](https://github.com/sagemath/sage/files/ticket9652/smallfix1-arith_valuation-doctest.2.3.patch.gz)**

additional doctest



---

archive/issue_comments_084503.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nEverything looks fine. Applies and passes doctest in 4.5.3\n\nI have modified the header of the patch in smallfix1-arith_valuation.2.3.patch and I have added another patch with a new doctest regarding a previous issue that arrived before valuation(1r,1r) not terminating.\n\nSince I have not touched the code, I fell I can give possitive review, but before doing so, mderickx, give me the OK for the change in the header of your patch.",
    "created_at": "2010-09-14T11:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84503",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:26" align="right">comment:26</div>

Everything looks fine. Applies and passes doctest in 4.5.3

I have modified the header of the patch in smallfix1-arith_valuation.2.3.patch and I have added another patch with a new doctest regarding a previous issue that arrived before valuation(1r,1r) not terminating.

Since I have not touched the code, I fell I can give possitive review, but before doing so, mderickx, give me the OK for the change in the header of your patch.



---

archive/issue_events_125141.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T11:30:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125141"
}
```



---

archive/issue_events_125142.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T11:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125142"
}
```



---

archive/issue_comments_084504.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI'm ok with the changes. Hooray, my first patch got through :).",
    "created_at": "2010-09-14T11:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84504",
    "user": "https://github.com/koffie"
}
```

<div id="comment:27" align="right">comment:27</div>

I'm ok with the changes. Hooray, my first patch got through :).



---

archive/issue_events_125143.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T12:32:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125143"
}
```



---

archive/issue_events_125144.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T12:32:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125144"
}
```



---

archive/issue_comments_084505.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,9 @@\n ```\n \n Putting implementation specific to Fraction fields in a global function is bad practice. And since fraction fields have an implementation of valuation part of the above code will not be execucted. If it magicaly get's excecuted it will return bad results since it doesn't take into account the input variable \"p\" as it should.\n+\n+Patches to apply in order:\n+\n+1. smallfix1-arith_valuation.2.3.patch\n+\n+2. smallfix1-arith_valuation-doctest.2.3.patch \n``````\n",
    "created_at": "2010-09-14T12:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84505",
    "user": "https://github.com/lftabera"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,9 @@
 ```
 
 Putting implementation specific to Fraction fields in a global function is bad practice. And since fraction fields have an implementation of valuation part of the above code will not be execucted. If it magicaly get's excecuted it will return bad results since it doesn't take into account the input variable "p" as it should.
+
+Patches to apply in order:
+
+1. smallfix1-arith_valuation.2.3.patch
+
+2. smallfix1-arith_valuation-doctest.2.3.patch 
``````




---

archive/issue_events_125145.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T12:32:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125145"
}
```



---

archive/issue_events_125146.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-14T12:32:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125146"
}
```



---

archive/issue_comments_084506.json:
```json
{
    "body": "Reviewer: **Marco Streng, John Cremona, Luis Felipe Tabera**",
    "created_at": "2010-09-15T11:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84506",
    "user": "https://github.com/qed777"
}
```

Reviewer: **Marco Streng, John Cremona, Luis Felipe Tabera**



---

archive/issue_comments_084507.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nPlease remember to update the \"Author(s)\" and \"Reviewer(s)\" fields.",
    "created_at": "2010-09-15T11:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84507",
    "user": "https://github.com/qed777"
}
```

<div id="comment:30" align="right">comment:30</div>

Please remember to update the "Author(s)" and "Reviewer(s)" fields.



---

archive/issue_events_125147.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T11:06:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125147"
}
```



---

archive/issue_comments_084508.json:
```json
{
    "body": "Author: **Maarten Derickx**",
    "created_at": "2010-09-15T11:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84508",
    "user": "https://github.com/qed777"
}
```

Author: **Maarten Derickx**



---

archive/issue_events_125148.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T11:14:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125148"
}
```



---

archive/issue_events_125149.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T11:14:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9652#event-125149"
}
```



---

archive/issue_comments_084509.json:
```json
{
    "body": "Merged: **sage-4.6.alpha1**",
    "created_at": "2010-09-15T11:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9652#issuecomment-84509",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.6.alpha1**
