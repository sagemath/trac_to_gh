# Issue 9812: Sorting bug in fan subdivision

archive/issues_009811.json:
```json
{
    "body": "\n```\nsage: C = Cone([(1,0,0), (0,1,0), (1,0,1), (0,1,1)])\nsage: F = Fan([C]).make_simplicial()\nsage: [cone.ambient_ray_indices() for cone in F]\n[(1, 3, 0), (1, 2, 0)]\n```\nWhile the output is mathematically correct, ambient ray indices are supposed to be sorted and violating this condition can lead to errors later. The attached patch adds extra sorting in the proper place. This means that polytopes constructed during subdivision can no longer be cached because of the potentially wrong vertex order, which is OK.\n\n**Assignee:** mhampton\n\n**CC:**  @vbraun\n\n**Resolution:** fixed\n\n**Author:** Andrey Novoseltsev\n\n**Reviewer:** Volker Braun\n\n**Merged:** sage-4.6.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9812\n\n",
    "closed_at": "2010-09-15T09:57:23Z",
    "created_at": "2010-08-26T22:23:58Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "Sorting bug in fan subdivision",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9812",
    "user": "https://github.com/novoselt"
}
```

```
sage: C = Cone([(1,0,0), (0,1,0), (1,0,1), (0,1,1)])
sage: F = Fan([C]).make_simplicial()
sage: [cone.ambient_ray_indices() for cone in F]
[(1, 3, 0), (1, 2, 0)]
```
While the output is mathematically correct, ambient ray indices are supposed to be sorted and violating this condition can lead to errors later. The attached patch adds extra sorting in the proper place. This means that polytopes constructed during subdivision can no longer be cached because of the potentially wrong vertex order, which is OK.

**Assignee:** mhampton

**CC:**  @vbraun

**Resolution:** fixed

**Author:** Andrey Novoseltsev

**Reviewer:** Volker Braun

**Merged:** sage-4.6.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9812





---

archive/issue_comments_122066.json:
```json
{
    "body": "Attachment [trac_9812_sorting_bug_in_fan_subdivision.patch](tarball://root/attachments/some-uuid/ticket9812/trac_9812_sorting_bug_in_fan_subdivision.patch) by @novoselt created at 2010-08-26 22:27:40",
    "created_at": "2010-08-26T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122066",
    "user": "https://github.com/novoselt"
}
```

Attachment [trac_9812_sorting_bug_in_fan_subdivision.patch](tarball://root/attachments/some-uuid/ticket9812/trac_9812_sorting_bug_in_fan_subdivision.patch) by @novoselt created at 2010-08-26 22:27:40



---

archive/issue_comments_122067.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-08-26T22:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122067",
    "user": "https://github.com/novoselt"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_122068.json:
```json
{
    "body": "<a id='comment:2'></a>\ngood catch!",
    "created_at": "2010-08-28T00:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122068",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
good catch!



---

archive/issue_comments_122069.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-08-28T00:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122069",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_122070.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2010-08-28T02:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122070",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_122071.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2010-09-15T09:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122071",
    "user": "https://github.com/qed777"
}
```

**Resolution:** fixed



---

archive/issue_events_029877.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-15T09:57:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9812#event-29877"
}
```



---

archive/issue_comments_122072.json:
```json
{
    "body": "**Merged:** sage-4.6.alpha1",
    "created_at": "2010-09-15T09:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9812#issuecomment-122072",
    "user": "https://github.com/qed777"
}
```

**Merged:** sage-4.6.alpha1
