# Issue 9543: Enable cephes on FreeBSD and disable it on Cygwin

archive/issues_009543.json:
```json
{
    "body": "FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.\n\nSpkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p1.spkg\n\n\n---\n\nAdditional comments for perusal in the future:\n\nA number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.\n\n\n**Assignee:** @peterjeremy\n\n**CC:**  @mwhansen jpflori\n\n**Keywords:** cephes spkg cygwin freebsd\n\n**Reviewer:** Stephen Montgomery-Smith, Karl-Dieter Crisman\n\n**Author:** Peter Jeremy, Jean-Pierre Flori\n\n**Merged:** sage-5.6.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/9543\n\n",
    "closed_at": "2013-01-12T08:52:00Z",
    "created_at": "2010-07-18T19:57:13Z",
    "labels": [
        "component: porting: bsd",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.6",
    "title": "Enable cephes on FreeBSD and disable it on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/9543",
    "user": "https://github.com/peterjeremy"
}
```
FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.

Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p1.spkg


---

Additional comments for perusal in the future:

A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.


**Assignee:** @peterjeremy

**CC:**  @mwhansen jpflori

**Keywords:** cephes spkg cygwin freebsd

**Reviewer:** Stephen Montgomery-Smith, Karl-Dieter Crisman

**Author:** Peter Jeremy, Jean-Pierre Flori

**Merged:** sage-5.6.rc0

Issue created by migration from https://trac.sagemath.org/ticket/9543





---

archive/issue_comments_084606.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, removes a reference to a non-existent test package and enables error checking.  The latter two components are needed on Cygwin as well as FreeBSD.\n+FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.\n+\n+A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.\n``````\n",
    "created_at": "2010-07-26T11:04:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84606",
    "user": "https://github.com/peterjeremy"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, removes a reference to a non-existent test package and enables error checking.  The latter two components are needed on Cygwin as well as FreeBSD.
+FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.
+
+A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.
``````




---

archive/issue_comments_084607.json:
```json
{
    "body": "<a id='comment:2'></a>\nI made an spkg at http://sage.math.washington.edu/home/mhansen/cephes-2.8.p0.spkg , but I get the following build error on Cygwin:\n\n```\n\n /usr/lib/gcc/i686-pc-cygwin/4.3.4/collect2.exe -tsaware --wrap _Znwj --wrap _Znaj --wrap _ZdlPv --wrap _ZdaPv --wrap _ZnwjRKSt9nothrow_t --wrap _ZnajRKSt9nothrow_t --wrap _ZdlPvRKSt9nothrow_t --wrap _ZdaPvRKSt9nothrow_t -Bdynamic --dll-search-prefix=cyg -u ___register_frame_info -u ___deregister_frame_info -o mtst.exe /usr/lib/gcc/i686-pc-cygwin/4.3.4/../../../crt0.o /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtbegin.o -L/home/mhansen/sage-4.5.3.alpha2/local/lib -L/home/mhansen/sage-4.5.3.alpha2/local/lib -L/usr/lib/gcc/i686-pc-cygwin/4.3.4 -L/usr/lib/gcc/i686-pc-cygwin/4.3.4 -L/usr/lib/gcc/i686-pc-cygwin/4.3.4/../../.. mtst.o cmplx.o clog.o cgamma.o stubs.o -lm -lgcc_s -lgcc -lgcc_eh -lcygwin -luser32 -lkernel32 -ladvapi32 -lshell32 -lgcc_s -lgcc -lgcc_eh /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtend.o\ngcc  -I. -g -O2 -Wall   -c -o cvect.o cvect.c\ncvect.c: In function \u2018main\u2019:\ncvect.c:130: warning: implicit declaration of function \u2018memcmp\u2019\ncvect.c:223: warning: implicit declaration of function \u2018exit\u2019\ncvect.c:223: warning: incompatible implicit declaration of built-in function \u2018exit\u2019\ngcc -o cvect cvect.o clog.o cmplx.o stubs.o -lm\ngcc  -I. -g -O2 -Wall -c dccalc.c\ngcc -o dccalc dccalc.o libmc.a stubs.o -lm\ngcc  -I. -g -O2 -Wall   -c -o mtstf.o mtstf.c\ngcc -o mtstf mtstf.o cmplxf.o clogf.o cgammaf.o stubs.o -lm\nmake: *** No rule to make target `whitebxf.c', needed by `whitebxf.o'.  Stop.\n```",
    "created_at": "2010-10-12T01:03:08Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84607",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
I made an spkg at http://sage.math.washington.edu/home/mhansen/cephes-2.8.p0.spkg , but I get the following build error on Cygwin:

```

 /usr/lib/gcc/i686-pc-cygwin/4.3.4/collect2.exe -tsaware --wrap _Znwj --wrap _Znaj --wrap _ZdlPv --wrap _ZdaPv --wrap _ZnwjRKSt9nothrow_t --wrap _ZnajRKSt9nothrow_t --wrap _ZdlPvRKSt9nothrow_t --wrap _ZdaPvRKSt9nothrow_t -Bdynamic --dll-search-prefix=cyg -u ___register_frame_info -u ___deregister_frame_info -o mtst.exe /usr/lib/gcc/i686-pc-cygwin/4.3.4/../../../crt0.o /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtbegin.o -L/home/mhansen/sage-4.5.3.alpha2/local/lib -L/home/mhansen/sage-4.5.3.alpha2/local/lib -L/usr/lib/gcc/i686-pc-cygwin/4.3.4 -L/usr/lib/gcc/i686-pc-cygwin/4.3.4 -L/usr/lib/gcc/i686-pc-cygwin/4.3.4/../../.. mtst.o cmplx.o clog.o cgamma.o stubs.o -lm -lgcc_s -lgcc -lgcc_eh -lcygwin -luser32 -lkernel32 -ladvapi32 -lshell32 -lgcc_s -lgcc -lgcc_eh /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtend.o
gcc  -I. -g -O2 -Wall   -c -o cvect.o cvect.c
cvect.c: In function ‘main’:
cvect.c:130: warning: implicit declaration of function ‘memcmp’
cvect.c:223: warning: implicit declaration of function ‘exit’
cvect.c:223: warning: incompatible implicit declaration of built-in function ‘exit’
gcc -o cvect cvect.o clog.o cmplx.o stubs.o -lm
gcc  -I. -g -O2 -Wall -c dccalc.c
gcc -o dccalc dccalc.o libmc.a stubs.o -lm
gcc  -I. -g -O2 -Wall   -c -o mtstf.o mtstf.c
gcc -o mtstf mtstf.o cmplxf.o clogf.o cgammaf.o stubs.o -lm
make: *** No rule to make target `whitebxf.c', needed by `whitebxf.o'.  Stop.
```



---

archive/issue_comments_084608.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe patches I added do not affect the build on Cygwin and I get exactly the same failure when building cephes-2.8.spkg (without any of my patches) on Cygwin.  As I noted in my initial description, some of the cephes self-tests have been removed - whitebxf.c being one such.",
    "created_at": "2010-10-13T21:32:04Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84608",
    "user": "https://github.com/peterjeremy"
}
```

<a id='comment:3'></a>
The patches I added do not affect the build on Cygwin and I get exactly the same failure when building cephes-2.8.spkg (without any of my patches) on Cygwin.  As I noted in my initial description, some of the cephes self-tests have been removed - whitebxf.c being one such.



---

archive/issue_comments_084609.json:
```json
{
    "body": "<a id='comment:4'></a>\nNote that patches should now be applied by using `patch` instead of `cp`.\n\nAlso, it would be really nice to make it more uniform: when possible, use the same patches both for Cygwin and for FreeBSD.",
    "created_at": "2012-01-24T14:24:31Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84609",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Note that patches should now be applied by using `patch` instead of `cp`.

Also, it would be really nice to make it more uniform: when possible, use the same patches both for Cygwin and for FreeBSD.



---

archive/issue_comments_084610.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@jdemeyer](#comment%3A4):\n> Note that patches should now be applied by using `patch` instead of `cp`.\n> \n> Also, it would be really nice to make it more uniform: when possible, use the same patches both for Cygwin and for FreeBSD.\n\nOf course, though with Cygwin development halted for a bit that may not be as crucial.",
    "created_at": "2012-01-24T14:32:21Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84610",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
Replying to [@jdemeyer](#comment%3A4):
> Note that patches should now be applied by using `patch` instead of `cp`.
> 
> Also, it would be really nice to make it more uniform: when possible, use the same patches both for Cygwin and for FreeBSD.

Of course, though with Cygwin development halted for a bit that may not be as crucial.



---

archive/issue_comments_084611.json:
```json
{
    "body": "<a id='comment:6'></a>\nWith respect to this patch right now, according to Stephen Montgomery-Smith, \"It caused build errors in other sub-packages.\"  However, it does seem that cephes is needed for ccosh and who knows what else.",
    "created_at": "2012-01-31T01:58:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84611",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
With respect to this patch right now, according to Stephen Montgomery-Smith, "It caused build errors in other sub-packages."  However, it does seem that cephes is needed for ccosh and who knows what else.



---

archive/issue_comments_084612.json:
```json
{
    "body": "<a id='comment:7'></a>\nSee [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/857a00a9aa271f17).",
    "created_at": "2012-01-31T01:59:12Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84612",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
See [this sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/857a00a9aa271f17).



---

archive/issue_comments_084613.json:
```json
{
    "body": "<a id='comment:8'></a>\nI could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.  Once a dynamic library has been created, apparently there is no mechanism for merging it with other dynamic libraries.\n\nMy solution was to slightly modify pjeremy's patch so that it creates a library libm_complex.so.  The following patch should be applied to pjeremy's patch:\n\n```\n--- cephes-2.8\t2012-04-14 01:39:13.000000000 +0000\n+++ cephes-2.8\t2012-04-14 01:38:51.000000000 +0000\n@@ -1273,11 +1273,11 @@\n +# Intermediate (ar) libraries\n +LIBS=c9x-complex/libmc.a double/libmd.a ldouble/libml.a single/libmf.a\n +\n-+all: libm.so\n++all: libm_complex.so\n +\n-+install: libm.so complex.h math.h\n++install: libm_complex.so complex.h math.h\n +\t${INSTALL} -C -m 644 complex.h math.h \"${SAGE_LOCAL}/include\"\n-+\t${INSTALL} -C -m 755 libm.so \"${SAGE_LOCAL}/lib\"\n++\t${INSTALL} -C -m 755 libm_complex.so \"${SAGE_LOCAL}/lib\"\n +\n +check:\n +\tcd c9x-complex && ${MAKE} \"CC=${CC}\" check\n@@ -1291,7 +1291,7 @@\n +#\tTBD\n +\n +clean:\n-+\trm -f libm.so syms.c99 syms.libm syms.wanted\n++\trm -f libm_complex.so syms.c99 syms.libm syms.wanted\n +\tcd c9x-complex && ${MAKE} clean\n +\tcd double && ${MAKE} clean\n +\tcd ldouble && ${MAKE} clean\n@@ -1300,8 +1300,8 @@\n +# FreeBSD includes some but not all of the C99 maths functions.  Build\n +# a \"new\" libm.so that uses cephes functions to replace the missing ones\n +# (listed in syms.wanted) and then fallback to the base libm.so\n-+libm.so: ${LIBS} syms.wanted\n-+\t${LD} -shared -o $@ $$(sed 's/^/-u /' syms.wanted) -L/usr/lib -lc -lm \\\n++libm_complex.so: ${LIBS} syms.wanted\n++\t${LD} -shared -o $@ $$(sed 's/^/-u /' syms.wanted) -L/usr/lib \\\n +\t   ${LIBS} -lgcc\n +\n +# List of symbols defined in the FreeBSD base libc.so and libm.so\n```\n\nThen I put a script in $SAGE_ROOT/local/bin called \"cc\" which is a wrapper around the cc I really want to use:\n\n```\n#!/usr/local/bin/bash\n\n# Intersperse a \"-lm_complex\" before \"-lm\".\n\nn=0\nfor i in \"$@\"; do\n  if [ \"x$i\" = \"x-lm\" ]; then\n    arg[$n]=\"-lm_complex\"\n    n=$((n+1))\n    arg[$n]=\"-lm\"\n  else\n    arg[$n]=\"$i\"\n  fi\n  n=$((n+1))\ndone\n\n# Some configure scripts invoke the compiler with the argument \"-v\", and if\n# LDFLAGS are added to the arguments, this results in an error which\n# ultimately stops the relevant package being built.\n\n# Otherwise LDFLAGS needs to be added so that the linker knows where to find\n# the dynamic libraries.\n\nif [ $n = 1 -a \"x${arg[0]}\" = \"x-v\" ]; then\n  exec /usr/local/bin/gcc46 \"${arg[@]}\"\nelse\n  exec /usr/local/bin/gcc46 -Wl,-rpath=$SAGE_ROOT/local/lib  -Wl,-rpath=/usr/local/lib/gcc46 \"${arg[@]}\"\nfi\n```",
    "created_at": "2012-04-14T03:30:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84613",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:8'></a>
I could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.  Once a dynamic library has been created, apparently there is no mechanism for merging it with other dynamic libraries.

My solution was to slightly modify pjeremy's patch so that it creates a library libm_complex.so.  The following patch should be applied to pjeremy's patch:

```
--- cephes-2.8	2012-04-14 01:39:13.000000000 +0000
+++ cephes-2.8	2012-04-14 01:38:51.000000000 +0000
@@ -1273,11 +1273,11 @@
 +# Intermediate (ar) libraries
 +LIBS=c9x-complex/libmc.a double/libmd.a ldouble/libml.a single/libmf.a
 +
-+all: libm.so
++all: libm_complex.so
 +
-+install: libm.so complex.h math.h
++install: libm_complex.so complex.h math.h
 +	${INSTALL} -C -m 644 complex.h math.h "${SAGE_LOCAL}/include"
-+	${INSTALL} -C -m 755 libm.so "${SAGE_LOCAL}/lib"
++	${INSTALL} -C -m 755 libm_complex.so "${SAGE_LOCAL}/lib"
 +
 +check:
 +	cd c9x-complex && ${MAKE} "CC=${CC}" check
@@ -1291,7 +1291,7 @@
 +#	TBD
 +
 +clean:
-+	rm -f libm.so syms.c99 syms.libm syms.wanted
++	rm -f libm_complex.so syms.c99 syms.libm syms.wanted
 +	cd c9x-complex && ${MAKE} clean
 +	cd double && ${MAKE} clean
 +	cd ldouble && ${MAKE} clean
@@ -1300,8 +1300,8 @@
 +# FreeBSD includes some but not all of the C99 maths functions.  Build
 +# a "new" libm.so that uses cephes functions to replace the missing ones
 +# (listed in syms.wanted) and then fallback to the base libm.so
-+libm.so: ${LIBS} syms.wanted
-+	${LD} -shared -o $@ $$(sed 's/^/-u /' syms.wanted) -L/usr/lib -lc -lm \
++libm_complex.so: ${LIBS} syms.wanted
++	${LD} -shared -o $@ $$(sed 's/^/-u /' syms.wanted) -L/usr/lib \
 +	   ${LIBS} -lgcc
 +
 +# List of symbols defined in the FreeBSD base libc.so and libm.so
```

Then I put a script in $SAGE_ROOT/local/bin called "cc" which is a wrapper around the cc I really want to use:

```
#!/usr/local/bin/bash

# Intersperse a "-lm_complex" before "-lm".

n=0
for i in "$@"; do
  if [ "x$i" = "x-lm" ]; then
    arg[$n]="-lm_complex"
    n=$((n+1))
    arg[$n]="-lm"
  else
    arg[$n]="$i"
  fi
  n=$((n+1))
done

# Some configure scripts invoke the compiler with the argument "-v", and if
# LDFLAGS are added to the arguments, this results in an error which
# ultimately stops the relevant package being built.

# Otherwise LDFLAGS needs to be added so that the linker knows where to find
# the dynamic libraries.

if [ $n = 1 -a "x${arg[0]}" = "x-v" ]; then
  exec /usr/local/bin/gcc46 "${arg[@]}"
else
  exec /usr/local/bin/gcc46 -Wl,-rpath=$SAGE_ROOT/local/lib  -Wl,-rpath=/usr/local/lib/gcc46 "${arg[@]}"
fi
```



---

archive/issue_comments_084614.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [stephen](#comment%3A8):\n> I could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.\n\nAre you sure about this?  Couldn't you link Cephes's `libm` against the system `-lm` (maybe you would have to rename the latter).\n\nI'm willing to experiment with this if somebody could give me access to a FreeBSD box.",
    "created_at": "2012-04-14T09:03:33Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84614",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [stephen](#comment%3A8):
> I could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.

Are you sure about this?  Couldn't you link Cephes's `libm` against the system `-lm` (maybe you would have to rename the latter).

I'm willing to experiment with this if somebody could give me access to a FreeBSD box.



---

archive/issue_comments_084615.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@jdemeyer](#comment%3A9):\n> Replying to [stephen](#comment%3A8):\n> > I could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.\n\n> Are you sure about this?  Couldn't you link Cephes's `libm` against the system `-lm` (maybe you would have to rename the latter).\n> \n> I'm willing to experiment with this if somebody could give me access to a FreeBSD box.\n\nNo I am not sure about this.  I received a private email from pjeremy, and did some more investigating.  I discovered his patch doesn't work when I use the **gcc46 compiler**, which comes with the FreeBSD ports system, and is automatically invoked when you use fortran.\n\nLet me think some more about this.",
    "created_at": "2012-04-14T12:34:54Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84615",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:10'></a>
Replying to [@jdemeyer](#comment%3A9):
> Replying to [stephen](#comment%3A8):
> > I could not get pjeremy's patch to work for FreeBSD.  After some searching, I found out that the problem is that his patch attempts to link the cephes functions with /lib/libm.so.  This is something that is not meant to work for dynamic libraries.

> Are you sure about this?  Couldn't you link Cephes's `libm` against the system `-lm` (maybe you would have to rename the latter).
> 
> I'm willing to experiment with this if somebody could give me access to a FreeBSD box.

No I am not sure about this.  I received a private email from pjeremy, and did some more investigating.  I discovered his patch doesn't work when I use the **gcc46 compiler**, which comes with the FreeBSD ports system, and is automatically invoked when you use fortran.

Let me think some more about this.



---

archive/issue_comments_084616.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [stephen](#comment%3A10):\n\n> No I am not sure about this.  I received a private email from pjeremy, and did some more investigating.  I discovered his patch doesn't work when I use the **gcc46 compiler**, which comes with the FreeBSD ports system, and is automatically invoked when you use fortran.\n> \n> Let me think some more about this.\n\nIt looks like I found the problem.  I was building under a chroot'ed environment.  I have discovered that after I perform the \n\n```\nchroot /usr/jail\n```\nI need to do\n\n```\nsh /etc/rc.d/ldconfig start\n```\nIt looks like I only need to do this one time.\n\nThanks for sticking with me on this guys.  It looks like pjeremy's patch works, as is, with no changes.",
    "created_at": "2012-04-14T17:12:46Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84616",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:11'></a>
Replying to [stephen](#comment%3A10):

> No I am not sure about this.  I received a private email from pjeremy, and did some more investigating.  I discovered his patch doesn't work when I use the **gcc46 compiler**, which comes with the FreeBSD ports system, and is automatically invoked when you use fortran.
> 
> Let me think some more about this.

It looks like I found the problem.  I was building under a chroot'ed environment.  I have discovered that after I perform the 

```
chroot /usr/jail
```
I need to do

```
sh /etc/rc.d/ldconfig start
```
It looks like I only need to do this one time.

Thanks for sticking with me on this guys.  It looks like pjeremy's patch works, as is, with no changes.



---

archive/issue_comments_084617.json:
```json
{
    "body": "**Reviewer:** Stephen Montgomery-Smith",
    "created_at": "2012-06-20T19:19:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84617",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Stephen Montgomery-Smith



---

archive/issue_comments_084618.json:
```json
{
    "body": "**Author:** Peter Jeremy",
    "created_at": "2012-06-20T19:19:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84618",
    "user": "https://github.com/kcrisman"
}
```

**Author:** Peter Jeremy



---

archive/issue_comments_084619.json:
```json
{
    "body": "<a id='comment:12'></a>\nGreat, we just have to make a new spkg for this.  Probably we should change to patches instead of entire files copied over, though these are all new files so it's not as big of an issue.",
    "created_at": "2012-06-20T19:19:49Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84619",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:12'></a>
Great, we just have to make a new spkg for this.  Probably we should change to patches instead of entire files copied over, though these are all new files so it's not as big of an issue.



---

archive/issue_comments_084620.json:
```json
{
    "body": "<a id='comment:13'></a>\nOn #13806 [this message](http://freebsd.1045724.n5.nabble.com/Use-of-C99-extra-long-double-math-functions-after-r236148-td5712748.html) came up.  Relevant?  Sorry that we still haven't made an spkg for this...",
    "created_at": "2012-12-18T16:54:06Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84620",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:13'></a>
On #13806 [this message](http://freebsd.1045724.n5.nabble.com/Use-of-C99-extra-long-double-math-functions-after-r236148-td5712748.html) came up.  Relevant?  Sorry that we still haven't made an spkg for this...



---

archive/issue_comments_084621.json:
```json
{
    "body": "<a id='comment:15'></a>\nSpkg cleanup and only targetting FreeBSD at\nhttp://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg",
    "created_at": "2012-12-19T10:56:57Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84621",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>
Spkg cleanup and only targetting FreeBSD at
http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg



---

archive/issue_comments_084622.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.\n \n A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.\n+\n+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg\n``````\n",
    "created_at": "2013-01-04T15:32:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84622",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.
 
 A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.
+
+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg
``````




---

archive/issue_comments_084623.json:
```json
{
    "body": "**Changing author** from \"Peter Jeremy\" to \"Peter Jeremy, Jean-Pierre Flori\".",
    "created_at": "2013-01-04T15:32:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84623",
    "user": "https://github.com/kcrisman"
}
```

**Changing author** from "Peter Jeremy" to "Peter Jeremy, Jean-Pierre Flori".



---

archive/issue_comments_084624.json:
```json
{
    "body": "<a id='comment:16'></a>\nTrivial error\n\n```\nif [ \"$UNAME\" != \"FreeBSD\" ]; then \n    echo \"We only install the cephes library on Cygwin and FreeBSD.\" \n    exit 0 \nfi\n```\nAnyway, I'm trying this on Cygwin now.",
    "created_at": "2013-01-04T15:32:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84624",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
Trivial error

```
if [ "$UNAME" != "FreeBSD" ]; then 
    echo "We only install the cephes library on Cygwin and FreeBSD." 
    exit 0 
fi
```
Anyway, I'm trying this on Cygwin now.



---

archive/issue_comments_084625.json:
```json
{
    "body": "<a id='comment:17'></a>\nRegarding testing the cephes library - I don't think it is fair to\nexpect them to give super accurate answers.  I believe that the linux\nlibrary functions will fail in the same way.  Same with OpenBSD.\n\nI have been working with the FreeBSD people to get the C99 math\nfunctions into FreeBSD.  They are remarkably fussy.  I have been working\non the complex arc-trig functions casin(h), cacos(h), catan(h), and I\nhave written some extremely well tested and verified code which is\nlisted here: http://www.math.missouri.edu/~stephen/software/#catrig\n\nNevertheless they still won't commit my programs until I have made some\nstyle corrections, and I don't have time right now to do this.\n\nThe only other package I know of that implements these functions well\nare the boost libraries.  And even those were buggy (my bug fixes were\nrecently accepted by them).\n\nAnother person is working on clog.  The real part of clog(z) is\nparticularly hard to implement in the case that |z| is close to one.\n\nThe linux and OpenBSD libraries totally disregard the issues that give\nrise to the huge errors.\n\nAnd for casinh and cacosh, even the mpc libraries are badly written in\nthat their only saving grace is that they keep increasing the number of\ninternal digits until they are sure that their answer is correct.  (If\nyou wanted something like 200 bits of accuracy for cacosh, some inputs\ncan take minutes to compute.)\n\nAnyway, all this is to say that you shouldn't hold the cephes libraries\nup to any kind of high standard.  Treat them as work arounds so that\nccosh and such like will actually be compiled into sage on FreeBSD,\nrather that the answers should be particularly accurate.",
    "created_at": "2013-01-04T16:52:35Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84625",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:17'></a>
Regarding testing the cephes library - I don't think it is fair to
expect them to give super accurate answers.  I believe that the linux
library functions will fail in the same way.  Same with OpenBSD.

I have been working with the FreeBSD people to get the C99 math
functions into FreeBSD.  They are remarkably fussy.  I have been working
on the complex arc-trig functions casin(h), cacos(h), catan(h), and I
have written some extremely well tested and verified code which is
listed here: http://www.math.missouri.edu/~stephen/software/#catrig

Nevertheless they still won't commit my programs until I have made some
style corrections, and I don't have time right now to do this.

The only other package I know of that implements these functions well
are the boost libraries.  And even those were buggy (my bug fixes were
recently accepted by them).

Another person is working on clog.  The real part of clog(z) is
particularly hard to implement in the case that |z| is close to one.

The linux and OpenBSD libraries totally disregard the issues that give
rise to the huge errors.

And for casinh and cacosh, even the mpc libraries are badly written in
that their only saving grace is that they keep increasing the number of
internal digits until they are sure that their answer is correct.  (If
you wanted something like 200 bits of accuracy for cacosh, some inputs
can take minutes to compute.)

Anyway, all this is to say that you shouldn't hold the cephes libraries
up to any kind of high standard.  Treat them as work arounds so that
ccosh and such like will actually be compiled into sage on FreeBSD,
rather that the answers should be particularly accurate.



---

archive/issue_comments_084626.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,11 @@\n FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.\n+\n+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg\n+\n+\n+---\n+\n+Additional comments for perusal in the future:\n \n A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.\n \n-Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg\n``````\n",
    "created_at": "2013-01-04T17:09:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84626",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,11 @@
 FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.
+
+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg
+
+
+---
+
+Additional comments for perusal in the future:
 
 A number of areas still need work - in particular some of the cephes self tests have been removed and some of the other self tests fail (at least some of the failures reflect bugs in cephes).  Suitable self-tests and a spkg-check script need to be developed.  It's possible mpfr could be used as a reference library.
 
-Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg
``````




---

archive/issue_comments_084627.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [stephen](#comment%3A17):\n> Regarding testing the cephes library - I don't think it is fair to\n> expect them to give super accurate answers.  I believe that the linux\n> library functions will fail in the same way.  Same with OpenBSD.\n\nI'm not sure anyone was suggesting doing this, just to at least *provide* such functions on Cygwin.\n> Anyway, all this is to say that you shouldn't hold the cephes libraries\n> up to any kind of high standard.  Treat them as work arounds so that\n> ccosh and such like will actually be compiled into sage on FreeBSD,\n> rather that the answers should be particularly accurate.\n\nHopefully that is all we are asking for!  I'm going to change the description to point out that we really just want this.\n\n---\n\nSo... would you mind checking (at your convenience) whether this spkg indeed does the same thing as the patches from before and at [your port](http://www.freebsd.org/cgi/cvsweb.cgi/ports/math/sage/files/spkg-patch-cephes_-_big-patch)?  Then if it works on Cygwin (i.e., if Cygwin doesn't need it) we can merge this and simplify things slightly.",
    "created_at": "2013-01-04T17:09:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84627",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
Replying to [stephen](#comment%3A17):
> Regarding testing the cephes library - I don't think it is fair to
> expect them to give super accurate answers.  I believe that the linux
> library functions will fail in the same way.  Same with OpenBSD.

I'm not sure anyone was suggesting doing this, just to at least *provide* such functions on Cygwin.
> Anyway, all this is to say that you shouldn't hold the cephes libraries
> up to any kind of high standard.  Treat them as work arounds so that
> ccosh and such like will actually be compiled into sage on FreeBSD,
> rather that the answers should be particularly accurate.

Hopefully that is all we are asking for!  I'm going to change the description to point out that we really just want this.

---

So... would you mind checking (at your convenience) whether this spkg indeed does the same thing as the patches from before and at [your port](http://www.freebsd.org/cgi/cvsweb.cgi/ports/math/sage/files/spkg-patch-cephes_-_big-patch)?  Then if it works on Cygwin (i.e., if Cygwin doesn't need it) we can merge this and simplify things slightly.



---

archive/issue_events_070518.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-04T17:09:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "rename": {
        "from": "Enable cephes on FreeBSD",
        "to": "Enable cephes on FreeBSD and disable it on Cygwin"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70518"
}
```



---

archive/issue_events_070519.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-04T17:09:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70519"
}
```



---

archive/issue_comments_084628.json:
```json
{
    "body": "<a id='comment:19'></a>\nThis new spkg failed to build rather early in the process:\n\n\n```\nFound package cephes-2.8.p0 in spkg/standard/cephes-2.8.p0.spkg\ncephes-2.8.p0\n====================================================\nExtracting package /usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/standard/cephes-2.8.p0.spkg\n-rw-r--r--  1 stephen  staff  2514467 Jan  4 20:36 /usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/standard/cephes-2.8.p0.spkg\nFinished extraction\n****************************************************\nHost system:\nFreeBSD wilberforce 8.3-STABLE FreeBSD 8.3-STABLE #0: Wed Jan  2 15:53:46 CST 2013     root@wilberforce:/usr/obj/usr/src/sys/GENERIC  amd64\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=/usr/local/bin/gcc46\nCOLLECT_LTO_WRAPPER=/usr/local/libexec/gcc46/gcc/x86_64-portbld-freebsd8.3/4.6.3/lto-wrapper\nTarget: x86_64-portbld-freebsd8.3\nConfigured with: ./../gcc-4.6.3/configure --disable-bootstrap --disable-nls --libdir=/usr/local/lib/gcc46 --libexecdir=/usr/local/libexec/gcc46 --program-suffix=46 --with-as=/usr/local/bin/as --with-gmp=/usr/local --with-gxx-include-dir=/usr/local/lib/gcc46/include/c++/ --with-ld=/usr/local/bin/ld --with-libiconv-prefix=/usr/local --with-pkgversion='FreeBSD Ports Collection' --with-system-zlib --enable-languages=c,c++,objc,fortran,java --prefix=/usr/local --mandir=/usr/local/man --infodir=/usr/local/info/gcc46 --build=x86_64-portbld-freebsd8.3\nThread model: posix\ngcc version 4.6.3 (FreeBSD Ports Collection)\n****************************************************\nApplying patches (if any)...\npatching file c9x-complex/cgamma.c\npatching file c9x-complex/cgammaf.c\npatching file c9x-complex/cgammal.c\npatching file c9x-complex/makefile\npatching file double/makefile\npatching file ldouble/gammal.c\npatching file ldouble/makefile\npatching file Makefile\n./spkg-install: line 21: check_error: command not found\nBuilding Cephes...\nmake[3]: Entering directory `/usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/build/cephes-2.8.p0/src'\nmake[3]: *** No rule to make target `../patches/complex_bsd.h', needed by `c9x-complex/complex.h'.  Stop.\nmake[3]: Leaving directory `/usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/build/cephes-2.8.p0/src'\nError - Failed to build Cephes ... exiting\n\nreal    0m0.025s\nuser    0m0.002s\nsys     0m0.013s\n************************************************************************\nError installing package cephes-2.8.p0\n************************************************************************\n```",
    "created_at": "2013-01-04T20:43:11Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84628",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:19'></a>
This new spkg failed to build rather early in the process:


```
Found package cephes-2.8.p0 in spkg/standard/cephes-2.8.p0.spkg
cephes-2.8.p0
====================================================
Extracting package /usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/standard/cephes-2.8.p0.spkg
-rw-r--r--  1 stephen  staff  2514467 Jan  4 20:36 /usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/standard/cephes-2.8.p0.spkg
Finished extraction
****************************************************
Host system:
FreeBSD wilberforce 8.3-STABLE FreeBSD 8.3-STABLE #0: Wed Jan  2 15:53:46 CST 2013     root@wilberforce:/usr/obj/usr/src/sys/GENERIC  amd64
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=/usr/local/bin/gcc46
COLLECT_LTO_WRAPPER=/usr/local/libexec/gcc46/gcc/x86_64-portbld-freebsd8.3/4.6.3/lto-wrapper
Target: x86_64-portbld-freebsd8.3
Configured with: ./../gcc-4.6.3/configure --disable-bootstrap --disable-nls --libdir=/usr/local/lib/gcc46 --libexecdir=/usr/local/libexec/gcc46 --program-suffix=46 --with-as=/usr/local/bin/as --with-gmp=/usr/local --with-gxx-include-dir=/usr/local/lib/gcc46/include/c++/ --with-ld=/usr/local/bin/ld --with-libiconv-prefix=/usr/local --with-pkgversion='FreeBSD Ports Collection' --with-system-zlib --enable-languages=c,c++,objc,fortran,java --prefix=/usr/local --mandir=/usr/local/man --infodir=/usr/local/info/gcc46 --build=x86_64-portbld-freebsd8.3
Thread model: posix
gcc version 4.6.3 (FreeBSD Ports Collection)
****************************************************
Applying patches (if any)...
patching file c9x-complex/cgamma.c
patching file c9x-complex/cgammaf.c
patching file c9x-complex/cgammal.c
patching file c9x-complex/makefile
patching file double/makefile
patching file ldouble/gammal.c
patching file ldouble/makefile
patching file Makefile
./spkg-install: line 21: check_error: command not found
Building Cephes...
make[3]: Entering directory `/usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/build/cephes-2.8.p0/src'
make[3]: *** No rule to make target `../patches/complex_bsd.h', needed by `c9x-complex/complex.h'.  Stop.
make[3]: Leaving directory `/usr/home/stephen/sage-devel/work/sage-5.6.beta2/spkg/build/cephes-2.8.p0/src'
Error - Failed to build Cephes ... exiting

real    0m0.025s
user    0m0.002s
sys     0m0.013s
************************************************************************
Error installing package cephes-2.8.p0
************************************************************************
```



---

archive/issue_events_070520.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-04T20:52:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70520"
}
```



---

archive/issue_events_070521.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-04T20:52:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70521"
}
```



---

archive/issue_comments_084629.json:
```json
{
    "body": "<a id='comment:20'></a>\n\n```\n./spkg-install: line 21: check_error: command not found\n```\nJP, I think you might have used that command from a different spkg we've been working on.  So that's two things... and then the third is that the `complex_bsd.h` is completely missing from pjeremy's patch to yours.\n\n---\nStill waiting on Cygwin, probably will hear back Monday since I'm using `SAGE_CHECK`.",
    "created_at": "2013-01-04T20:52:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84629",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>

```
./spkg-install: line 21: check_error: command not found
```
JP, I think you might have used that command from a different spkg we've been working on.  So that's two things... and then the third is that the `complex_bsd.h` is completely missing from pjeremy's patch to yours.

---
Still waiting on Cygwin, probably will hear back Monday since I'm using `SAGE_CHECK`.



---

archive/issue_comments_084630.json:
```json
{
    "body": "**Changing reviewer** from \"Stephen Montgomery-Smith\" to \"Stephen Montgomery-Smith, Karl-Dieter Crisman\".",
    "created_at": "2013-01-04T20:52:50Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84630",
    "user": "https://github.com/kcrisman"
}
```

**Changing reviewer** from "Stephen Montgomery-Smith" to "Stephen Montgomery-Smith, Karl-Dieter Crisman".



---

archive/issue_comments_084631.json:
```json
{
    "body": "<a id='comment:21'></a>\nCygwin is fine, unsurprisingly, though of course the message is a little funny\n\n```\n...\ngcc version 4.5.3 (GCC)\nWe only install the cephes library on Cygwin and FreeBSD.\n\nreal ...\nuser ...\nsys ...\nSuccessfully installed cephes-2.8.p0\n...\n```",
    "created_at": "2013-01-07T14:46:25Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84631",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
Cygwin is fine, unsurprisingly, though of course the message is a little funny

```
...
gcc version 4.5.3 (GCC)
We only install the cephes library on Cygwin and FreeBSD.

real ...
user ...
sys ...
Successfully installed cephes-2.8.p0
...
```



---

archive/issue_comments_084632.json:
```json
{
    "body": "**Work Issues:** typo in spkg-install, check_error not defined, complex_bsd.h",
    "created_at": "2013-01-07T14:46:25Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84632",
    "user": "https://github.com/kcrisman"
}
```

**Work Issues:** typo in spkg-install, check_error not defined, complex_bsd.h



---

archive/issue_comments_084633.json:
```json
{
    "body": "<a id='comment:22'></a>\nI've upped a new spkg which:\n* fixes the exit message,\n* fixes the use of check_error,\n* does not add math_bsd or complex_bsd as pjeremy's patch did not lead to their creation or installation, the bsd.patch and spkg-install I've produced should replicate the behavior of what you get with pjeremy's patch.",
    "created_at": "2013-01-07T15:12:31Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84633",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>
I've upped a new spkg which:
* fixes the exit message,
* fixes the use of check_error,
* does not add math_bsd or complex_bsd as pjeremy's patch did not lead to their creation or installation, the bsd.patch and spkg-install I've produced should replicate the behavior of what you get with pjeremy's patch.



---

archive/issue_events_070522.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-01-07T15:12:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70522"
}
```



---

archive/issue_events_070523.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-01-07T15:12:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70523"
}
```



---

archive/issue_comments_084634.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"cephes spkg cygwin freebsd\".",
    "created_at": "2013-01-07T15:12:31Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84634",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing keywords** from "" to "cephes spkg cygwin freebsd".



---

archive/issue_comments_084635.json:
```json
{
    "body": "**Changing work issues** from \"typo in spkg-install, check_error not defined, complex_bsd.h\" to \"\".",
    "created_at": "2013-01-07T15:12:31Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84635",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing work issues** from "typo in spkg-install, check_error not defined, complex_bsd.h" to "".



---

archive/issue_comments_084636.json:
```json
{
    "body": "<a id='comment:23'></a>\nThis is fine from my point of view.  If Stephen can check whether it performs as promised then we'll be set.",
    "created_at": "2013-01-07T15:19:58Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84636",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:23'></a>
This is fine from my point of view.  If Stephen can check whether it performs as promised then we'll be set.



---

archive/issue_comments_084637.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@kcrisman](#comment%3A23):\n> This is fine from my point of view.  If Stephen can check whether it performs as promised then we'll be set.\n\nAgreed!\n\nQuite strangely, I don't have access to a FreeBSD box :) (although I vaguely remember trying to setup one once)",
    "created_at": "2013-01-07T15:23:34Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84637",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>
Replying to [@kcrisman](#comment%3A23):
> This is fine from my point of view.  If Stephen can check whether it performs as promised then we'll be set.

Agreed!

Quite strangely, I don't have access to a FreeBSD box :) (although I vaguely remember trying to setup one once)



---

archive/issue_comments_084638.json:
```json
{
    "body": "<a id='comment:25'></a>\nIt still fails with the \"complex_bsd.h\" no rule message.\n\nI looked at Jeremy's patch, and it seemed to me that it did create math_bsd.h and complex_bsd.h.  For example, it has lines like this:\n\n```\n--- cephes-2.8/patches/complex_bsd.h.orig       2010-07-26 08:25:54.654310990 +1000\n+++ cephes-2.8/patches/complex_bsd.h    2010-07-26 08:25:54.658310309 +1000\n```\n\nThis is a diff against a non-existent file, using the \"-N\" option to diff.  The patch program creates a new file.\n\nMakefile then copies this from cephes-2.8/patches to where-ever it is needed.  I would probably change the patch so that it is created directly in the directory where it is needed.",
    "created_at": "2013-01-07T20:28:13Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84638",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:25'></a>
It still fails with the "complex_bsd.h" no rule message.

I looked at Jeremy's patch, and it seemed to me that it did create math_bsd.h and complex_bsd.h.  For example, it has lines like this:

```
--- cephes-2.8/patches/complex_bsd.h.orig       2010-07-26 08:25:54.654310990 +1000
+++ cephes-2.8/patches/complex_bsd.h    2010-07-26 08:25:54.658310309 +1000
```

This is a diff against a non-existent file, using the "-N" option to diff.  The patch program creates a new file.

Makefile then copies this from cephes-2.8/patches to where-ever it is needed.  I would probably change the patch so that it is created directly in the directory where it is needed.



---

archive/issue_comments_084639.json:
```json
{
    "body": "<a id='comment:26'></a>\nOh, and the reason it worked so well with cygwin is because it didn't do anything.",
    "created_at": "2013-01-07T20:29:56Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84639",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:26'></a>
Oh, and the reason it worked so well with cygwin is because it didn't do anything.



---

archive/issue_comments_084640.json:
```json
{
    "body": "<a id='comment:27'></a>\n> Oh, and the reason it worked so well with cygwin is because it didn't do anything.\n\nYes, understood.",
    "created_at": "2013-01-07T21:12:11Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84640",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:27'></a>
> Oh, and the reason it worked so well with cygwin is because it didn't do anything.

Yes, understood.



---

archive/issue_comments_084641.json:
```json
{
    "body": "<a id='comment:28'></a>\nOk, I had a closer look at jeremy's patch and indeed the *_bsd.h file are needed and copied by the new makefile.\n\nI did not create them at first because the bunch of bash functions called on cygwin explicitely copied them whereas on bsd we just have make / make install calls which got me confused.\n\nI'll fix that tomorrow.",
    "created_at": "2013-01-07T22:13:21Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84641",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>
Ok, I had a closer look at jeremy's patch and indeed the *_bsd.h file are needed and copied by the new makefile.

I did not create them at first because the bunch of bash functions called on cygwin explicitely copied them whereas on bsd we just have make / make install calls which got me confused.

I'll fix that tomorrow.



---

archive/attachments_012668.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "cephes-2.8.p0.diff",
    "asset_url": "tarball://root/attachments/ticket9543/cephes-2.8.p0.diff",
    "created_at": "2013-01-08T14:17:28Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p0.diff",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```



---

archive/issue_comments_084642.json:
```json
{
    "body": "**Attachment:** [cephes-2.8.p0.diff](https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p0.diff)\n\nSpkg diff, for review only.",
    "created_at": "2013-01-08T14:17:28Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84642",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Attachment:** [cephes-2.8.p0.diff](https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p0.diff)

Spkg diff, for review only.



---

archive/issue_comments_084643.json:
```json
{
    "body": "<a id='comment:29'></a>\nEverything is hopefully fine now.\n\nI've slightly modified Jeremy's approach to create (or rather modify as far as complex.h is concerned) the various headers while patching the src dir, rather than overwriting them with Makefile rules.",
    "created_at": "2013-01-08T14:19:05Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84643",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>
Everything is hopefully fine now.

I've slightly modified Jeremy's approach to create (or rather modify as far as complex.h is concerned) the various headers while patching the src dir, rather than overwriting them with Makefile rules.



---

archive/issue_comments_084644.json:
```json
{
    "body": "<a id='comment:30'></a>\nThe latest version built and worked just fine.",
    "created_at": "2013-01-08T23:13:47Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84644",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:30'></a>
The latest version built and worked just fine.



---

archive/issue_events_070524.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-09T06:22:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70524"
}
```



---

archive/issue_events_070525.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-09T06:22:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70525"
}
```



---

archive/issue_comments_084645.json:
```json
{
    "body": "<a id='comment:31'></a>\nAnd the spkg-install looks good to me.  Assuming that you formed it correctly, this should be good to go in!",
    "created_at": "2013-01-09T06:22:59Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84645",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:31'></a>
And the spkg-install looks good to me.  Assuming that you formed it correctly, this should be good to go in!



---

archive/issue_comments_084646.json:
```json
{
    "body": "<a id='comment:32'></a>\nSorry to be annoying but could you please document *why* we need cephes on FreeBSD? Preferably something should be mentioned in `SPKG.txt`. In the ticket description I only see\n> FreeBSD does not currently have a full C99 libm and therefore also needs cephes\n\nwhich is very vague.",
    "created_at": "2013-01-09T09:04:47Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84646",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Sorry to be annoying but could you please document *why* we need cephes on FreeBSD? Preferably something should be mentioned in `SPKG.txt`. In the ticket description I only see
> FreeBSD does not currently have a full C99 libm and therefore also needs cephes

which is very vague.



---

archive/issue_comments_084647.json:
```json
{
    "body": "<a id='comment:33'></a>\nFreeBSD's math library does not have all the mathematics functions described in Sections 7.3 and 7.12 of the C99 standard:\n\n```\nhttp://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf\n```\nSpecifically many of the complex and long double functions are missing in FreeBSD.\n\nCephes provides those functions that are missing from FreeBSD.  The Makefiles have been modified so that it only adds those functions missing from the version of FreeBSD in which compilation is taking place.",
    "created_at": "2013-01-09T13:14:26Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84647",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:33'></a>
FreeBSD's math library does not have all the mathematics functions described in Sections 7.3 and 7.12 of the C99 standard:

```
http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1124.pdf
```
Specifically many of the complex and long double functions are missing in FreeBSD.

Cephes provides those functions that are missing from FreeBSD.  The Makefiles have been modified so that it only adds those functions missing from the version of FreeBSD in which compilation is taking place.



---

archive/issue_comments_084648.json:
```json
{
    "body": "<a id='comment:34'></a>\nNew spkg with SPKG.txt including a note with what stephen posted.\nAs the change is minimal I'm leaving this as positive review.",
    "created_at": "2013-01-09T15:26:33Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84648",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:34'></a>
New spkg with SPKG.txt including a note with what stephen posted.
As the change is minimal I'm leaving this as positive review.



---

archive/issue_comments_084649.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.\n \n-Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg\n+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p1.spkg\n \n \n ---\n``````\n",
    "created_at": "2013-01-09T15:26:33Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84649",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 FreeBSD does not currently have a full C99 libm and therefore also needs cephes.  The attached patch enables cephes on FreeBSD, enables error checking and renames the long double gamma() functions in line with C99.  The latter two components are applicable to Cygwin as well as FreeBSD.
 
-Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p0.spkg
+Spkg at http://boxen.math.washington.edu/home/jpflori/cephes-2.8.p1.spkg
 
 
 ---
``````




---

archive/issue_comments_084650.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-01-09T15:26:55Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84650",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_events_070526.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T08:52:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70526"
}
```



---

archive/issue_events_070527.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T08:52:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9543#event-70527"
}
```



---

archive/attachments_012669.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "cephes-2.8.p1.diff",
    "asset_url": "tarball://root/attachments/ticket9543/cephes-2.8.p1.diff",
    "created_at": "2013-01-12T08:52:00Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p1.diff",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_084651.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Attachment:** [cephes-2.8.p1.diff](https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p1.diff)",
    "created_at": "2013-01-12T08:52:00Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84651",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
**Attachment:** [cephes-2.8.p1.diff](https://github.com/sagemath/sage/files/ticket9543/cephes-2.8.p1.diff)



---

archive/issue_comments_084652.json:
```json
{
    "body": "**Merged:** sage-5.6.rc0",
    "created_at": "2013-01-12T08:52:00Z",
    "issue": "https://github.com/sagemath/sage/issues/9543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9543#issuecomment-84652",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.6.rc0
