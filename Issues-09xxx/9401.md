# Issue 9401: pari(n).isprime(1) does not give the primality certificate to the user

archive/issues_009401.json:
```json
{
    "body": "The Pari `isprime` function is able to return a primality\ncertificate:\n\n```\ngp: isprime(2^31-1,1)\n\n[2 3 1]\n\n[3 5 1]\n\n[7 3 1]\n\n[11 3 1]\n\n[31 2 1]\n\n[151 3 1]\n\n[331 3 1]\n```\nHowever when calling this function from Sage, the certificate is\nlost:\n\n```\nsage: pari(2^31-1).isprime(1)\nTrue\n```\n\nAssignee: @aghitza\n\nCC:  @JohnCremona @orlitzky wstein @robertwb\n\nKeywords: prime number\n\nBranch/Commit: ed15dffe245f7f8306895500fe619c1be5bd22c3\n\nReviewer: Peter Bruin, Ralf Stephan\n\nAuthor: Paul Zimmermann, Peter Bruin\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/9401\n\n",
    "closed_at": "2014-03-05T09:36:28Z",
    "created_at": "2010-07-01T08:12:38Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "pari(n).isprime(1) does not give the primality certificate to the user",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9401",
    "user": "https://github.com/zimmermann6"
}
```
The Pari `isprime` function is able to return a primality
certificate:

```
gp: isprime(2^31-1,1)

[2 3 1]

[3 5 1]

[7 3 1]

[11 3 1]

[31 2 1]

[151 3 1]

[331 3 1]
```
However when calling this function from Sage, the certificate is
lost:

```
sage: pari(2^31-1).isprime(1)
True
```

Assignee: @aghitza

CC:  @JohnCremona @orlitzky wstein @robertwb

Keywords: prime number

Branch/Commit: ed15dffe245f7f8306895500fe619c1be5bd22c3

Reviewer: Peter Bruin, Ralf Stephan

Author: Paul Zimmermann, Peter Bruin

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/9401





---

archive/issue_comments_106854.json:
```json
{
    "body": "<a id='comment:1'></a>\n```\nsage: pari(3).isprime()\nTrue\nsage: pari(3).isprime(1)\nFalse\nsage: pari(3).isprime(2)\nTrue\n```\n\n...what?",
    "created_at": "2012-01-16T04:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106854",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
```
sage: pari(3).isprime()
True
sage: pari(3).isprime(1)
False
sage: pari(3).isprime(2)
True
```

...what?



---

archive/issue_comments_106855.json:
```json
{
    "body": "<a id='comment:2'></a>apparently something changed (in worse) since I reported this, since indeed we now get:\n\n```\nsage: pari(2^31-1).isprime(1)\nFalse\n```\nI change the priority to \"major\".\n\nPaul",
    "created_at": "2012-01-16T07:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106855",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:2'></a>apparently something changed (in worse) since I reported this, since indeed we now get:

```
sage: pari(2^31-1).isprime(1)
False
```
I change the priority to "major".

Paul



---

archive/issue_events_023184.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9401#event-23184"
}
```



---

archive/issue_comments_106856.json:
```json
{
    "body": "<a id='comment:4'></a>by the way I notice there is no indication on how to access or change the \"arithmetic proof flag\" mentioned in the documentation of `n.is_prime`.\n\nAnd the documentation of `get_flag` is ill-formed in the terminal version.\n\nPaul",
    "created_at": "2013-08-24T13:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106856",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>by the way I notice there is no indication on how to access or change the "arithmetic proof flag" mentioned in the documentation of `n.is_prime`.

And the documentation of `get_flag` is ill-formed in the terminal version.

Paul



---

archive/issue_comments_106857.json:
```json
{
    "body": "<a id='comment:5'></a>for the ill-formed documentation of `get_flag`, see #15096.",
    "created_at": "2013-08-25T10:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106857",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>for the ill-formed documentation of `get_flag`, see #15096.



---

archive/issue_comments_106858.json:
```json
{
    "body": "<a id='comment:6'></a>Attachment [trac_9401.patch](tarball://root/attachments/some-uuid/ticket9401/trac_9401.patch) by @zimmermann6 created at 2013-08-25 12:45:08\n\nthe attached patch does several things:\n\n1) it fixes two typos in `gen.pyx`\n\n2) it corrects the behaviour of `pari(n).isprime(1)` which incorrectly was returning `False` for prime n\n\n3) for prime n, now `pari(n).isprime(1)` returns a tuple `(True, cert)` where `cert` is the primality certificate (currently as Pari object, I didn't figure out how to convert it to a Python object)\n\nComments are welcome.\n\nPaul",
    "created_at": "2013-08-25T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106858",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:6'></a>Attachment [trac_9401.patch](tarball://root/attachments/some-uuid/ticket9401/trac_9401.patch) by @zimmermann6 created at 2013-08-25 12:45:08

the attached patch does several things:

1) it fixes two typos in `gen.pyx`

2) it corrects the behaviour of `pari(n).isprime(1)` which incorrectly was returning `False` for prime n

3) for prime n, now `pari(n).isprime(1)` returns a tuple `(True, cert)` where `cert` is the primality certificate (currently as Pari object, I didn't figure out how to convert it to a Python object)

Comments are welcome.

Paul



---

archive/issue_comments_106859.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-25T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106859",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106860.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-02T20:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106860",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_106861.json:
```json
{
    "body": "<a id='comment:7'></a>In principle OK, but needs to be rebased on #15124.\n\nAlso, it would be much cleaner to call `new_gen()` instead of initialising the `gen` and resetting the stack by hand:\n\n```python\ncdef GEN x\npari_catch_sig_on()\nx = gisprime(self.g, flag)\nif typ(x) != t_INT:\n    # case flag=1 with prime input: x is the certificate\n    return True, P.new_gen(x)\nelse:\n    pari_catch_sig_off()\n    return bool(signe(x))\n```",
    "created_at": "2013-10-02T20:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106861",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>In principle OK, but needs to be rebased on #15124.

Also, it would be much cleaner to call `new_gen()` instead of initialising the `gen` and resetting the stack by hand:

```python
cdef GEN x
pari_catch_sig_on()
x = gisprime(self.g, flag)
if typ(x) != t_INT:
    # case flag=1 with prime input: x is the certificate
    return True, P.new_gen(x)
else:
    pari_catch_sig_off()
    return bool(signe(x))
```



---

archive/issue_events_023185.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9401#event-23185"
}
```



---

archive/issue_events_023186.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9401#event-23186"
}
```



---

archive/issue_comments_106862.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/ticket/9401\"",
    "created_at": "2014-03-01T16:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106862",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/ticket/9401"



---

archive/issue_comments_106863.json:
```json
{
    "body": "Changing commit from \"\" to \"0974f9d33ca0c938823fd02f5de90ee94648cebf\"",
    "created_at": "2014-03-01T16:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106863",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "0974f9d33ca0c938823fd02f5de90ee94648cebf"



---

archive/issue_comments_106864.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-01T16:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106864",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_106865.json:
```json
{
    "body": "Changing author from \"\" to \"Paul Zimmermann, Peter Bruin, Ralf Stephan\"",
    "created_at": "2014-03-01T16:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106865",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Paul Zimmermann, Peter Bruin, Ralf Stephan"



---

archive/issue_comments_106866.json:
```json
{
    "body": "<a id='comment:10'></a>Rebased on 6.2.base2, applied comment:7 by pbruin\n\n---\nNew commits:",
    "created_at": "2014-03-01T16:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106866",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>Rebased on 6.2.base2, applied comment:7 by pbruin

---
New commits:



---

archive/issue_comments_106867.json:
```json
{
    "body": "<a id='comment:11'></a>Only the last two commits apply. If I create a new branch without the first stray commits, will trac handle this?",
    "created_at": "2014-03-01T16:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106867",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'></a>Only the last two commits apply. If I create a new branch without the first stray commits, will trac handle this?



---

archive/issue_comments_106868.json:
```json
{
    "body": "Changing commit from \"0974f9d33ca0c938823fd02f5de90ee94648cebf\" to \"\"",
    "created_at": "2014-03-01T16:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106868",
    "user": "https://github.com/rwst"
}
```

Changing commit from "0974f9d33ca0c938823fd02f5de90ee94648cebf" to ""



---

archive/issue_comments_106869.json:
```json
{
    "body": "Changing branch from \"u/rws/ticket/9401\" to \"\"",
    "created_at": "2014-03-01T16:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106869",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/ticket/9401" to ""



---

archive/issue_comments_106870.json:
```json
{
    "body": "<a id='comment:12'></a>Yes, this is no problem.  I did this (using `git rebase -i`) in the branch I just pushed, and made one trivial additional change (in Cython, `s != 0` turns out to be faster than `bool(s)`).  You can set this to `positive_review` if you are happy with this branch.",
    "created_at": "2014-03-01T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106870",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:12'></a>Yes, this is no problem.  I did this (using `git rebase -i`) in the branch I just pushed, and made one trivial additional change (in Cython, `s != 0` turns out to be faster than `bool(s)`).  You can set this to `positive_review` if you are happy with this branch.



---

archive/issue_comments_106871.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2014-03-01T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106871",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_106872.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/9401-pari_isprime\"",
    "created_at": "2014-03-01T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106872",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/9401-pari_isprime"



---

archive/issue_comments_106873.json:
```json
{
    "body": "Changing commit from \"\" to \"ed15dffe245f7f8306895500fe619c1be5bd22c3\"",
    "created_at": "2014-03-01T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106873",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "ed15dffe245f7f8306895500fe619c1be5bd22c3"



---

archive/issue_comments_106874.json:
```json
{
    "body": "Changing author from \"Paul Zimmermann, Peter Bruin, Ralf Stephan\" to \"Paul Zimmermann, Peter Bruin\"",
    "created_at": "2014-03-02T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106874",
    "user": "https://github.com/rwst"
}
```

Changing author from "Paul Zimmermann, Peter Bruin, Ralf Stephan" to "Paul Zimmermann, Peter Bruin"



---

archive/issue_comments_106875.json:
```json
{
    "body": "Changing reviewer from \"Peter Bruin\" to \"Peter Bruin, Ralf Stephan\"",
    "created_at": "2014-03-02T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106875",
    "user": "https://github.com/rwst"
}
```

Changing reviewer from "Peter Bruin" to "Peter Bruin, Ralf Stephan"



---

archive/issue_comments_106876.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-02T07:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106876",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106877.json:
```json
{
    "body": "Changing branch from \"u/pbruin/9401-pari_isprime\" to \"ed15dffe245f7f8306895500fe619c1be5bd22c3\"",
    "created_at": "2014-03-05T09:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106877",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/9401-pari_isprime" to "ed15dffe245f7f8306895500fe619c1be5bd22c3"



---

archive/issue_comments_106878.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-05T09:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9401#issuecomment-106878",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_023187.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-05T09:36:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9401",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9401#event-23187"
}
```
