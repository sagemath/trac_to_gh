# Issue 9457: power series equality fails when trailing coefficients are zero

archive/issues_009457.json:
```json
{
    "body": "Comparison of power series uses `list` instead of `padded_list`.  This drops trailing zeros, and means that power series equality is buggy:\n\n```\nsage: A.<t> = PowerSeriesRing(ZZ)\nsage: g = t + t^3 + t^5 + O(t^6); g\nt + t^3 + t^5 + O(t^6)\nsage: g == t + O(t^3)   # should be True\nFalse\n\nsage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True\n[True, False, True, False, True, False, True] \n\nsage: g.add_bigoh(3).list()  # drops trailing zero\n[0, 1]\nsage: g.add_bigoh(3).padded_list()\n[0, 1, 0]\n```\n\n\n\n\nAssignee: @malb\n\nCC:  simonking @categorie\n\nBranch/Commit: 9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1\n\nStopgaps: #15748\n\nReviewer: Peter Bruin\n\nAuthor: Niles Johnson\n\nDependencies: #8198\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/9457\n\n",
    "closed_at": "2014-04-14T16:55:53Z",
    "created_at": "2010-07-08T15:35:20Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "power series equality fails when trailing coefficients are zero",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9457",
    "user": "https://github.com/nilesjohnson"
}
```
Comparison of power series uses `list` instead of `padded_list`.  This drops trailing zeros, and means that power series equality is buggy:

```
sage: A.<t> = PowerSeriesRing(ZZ)
sage: g = t + t^3 + t^5 + O(t^6); g
t + t^3 + t^5 + O(t^6)
sage: g == t + O(t^3)   # should be True
False

sage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True
[True, False, True, False, True, False, True] 

sage: g.add_bigoh(3).list()  # drops trailing zero
[0, 1]
sage: g.add_bigoh(3).padded_list()
[0, 1, 0]
```




Assignee: @malb

CC:  simonking @categorie

Branch/Commit: 9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1

Stopgaps: #15748

Reviewer: Peter Bruin

Author: Niles Johnson

Dependencies: #8198

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/9457





---

archive/issue_comments_108204.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-07-08T15:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108204",
    "user": "https://github.com/nilesjohnson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_108205.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n ```\n sage: A.<t> = PowerSeriesRing(ZZ)\n sage: g = t + t^3 + t^5 + O(t^6); g\n-t + t^3 + O(t^6)\n+t + t^3 + t^5 + O(t^6)\n sage: [g == g.add_bigoh(i) for i in range(7)]\n [True, True, False, False, True, False, True] # should be all true\n sage: g.add_bigoh(3).list()\n@@ -11,3 +11,5 @@\n sage: g.add_bigoh(3).padded_list()\n [1, 0, 0]\n ```\n+\n+\n``````\n",
    "created_at": "2010-07-08T18:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108205",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 ```
 sage: A.<t> = PowerSeriesRing(ZZ)
 sage: g = t + t^3 + t^5 + O(t^6); g
-t + t^3 + O(t^6)
+t + t^3 + t^5 + O(t^6)
 sage: [g == g.add_bigoh(i) for i in range(7)]
 [True, True, False, False, True, False, True] # should be all true
 sage: g.add_bigoh(3).list()
@@ -11,3 +11,5 @@
 sage: g.add_bigoh(3).padded_list()
 [1, 0, 0]
 ```
+
+
``````




---

archive/issue_comments_108206.json:
```json
{
    "body": "Attachment [trac_9457_power_series_eq.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq.patch) by @nilesjohnson created at 2010-07-08 19:20:15\n\nchange list to padded_list in _richcmp_c_impl",
    "created_at": "2010-07-08T19:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108206",
    "user": "https://github.com/nilesjohnson"
}
```

Attachment [trac_9457_power_series_eq.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq.patch) by @nilesjohnson created at 2010-07-08 19:20:15

change list to padded_list in _richcmp_c_impl



---

archive/issue_comments_108207.json:
```json
{
    "body": "<a id='comment:3'></a>Replaced padded_list() with padded_list(prec) because of\n\n```\nsage: A.<t> = PowerSeriesRing(ZZ)\nsage: f = t + t^2 + O(t^10)\nsage: f == f.truncate()\nFalse\nsage: f.truncate().padded_list()\n[0, 1, 1]\n```\n\nThis brought up a problem with padded_list(infinity), which is also now patched\n\n```\nsage: A.<t> = PowerSeriesRing(ZZ)\nsage: f = t + t^2 + O(t**10)\nsage: f.padded_list()\n[0, 1, 1, 0, 0, 0, 0, 0, 0, 0]\nsage: f.padded_list(infinity)\nTraceback (most recent call last):\n...\nTypeError: unsupported operand parent(s) for '*': '<type 'list'>' and 'The Infinity Ring'\n```",
    "created_at": "2010-07-08T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108207",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:3'></a>Replaced padded_list() with padded_list(prec) because of

```
sage: A.<t> = PowerSeriesRing(ZZ)
sage: f = t + t^2 + O(t^10)
sage: f == f.truncate()
False
sage: f.truncate().padded_list()
[0, 1, 1]
```

This brought up a problem with padded_list(infinity), which is also now patched

```
sage: A.<t> = PowerSeriesRing(ZZ)
sage: f = t + t^2 + O(t**10)
sage: f.padded_list()
[0, 1, 1, 0, 0, 0, 0, 0, 0, 0]
sage: f.padded_list(infinity)
Traceback (most recent call last):
...
TypeError: unsupported operand parent(s) for '*': '<type 'list'>' and 'The Infinity Ring'
```



---

archive/issue_comments_108208.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,11 +5,11 @@\n sage: g = t + t^3 + t^5 + O(t^6); g\n t + t^3 + t^5 + O(t^6)\n sage: [g == g.add_bigoh(i) for i in range(7)]\n-[True, True, False, False, True, False, True] # should be all true\n+[True, False, True, False, True, False, True]\n sage: g.add_bigoh(3).list()\n-[1]\n+[0, 1]\n sage: g.add_bigoh(3).padded_list()\n-[1, 0, 0]\n+[0, 1, 0]\n ```\n \n \n``````\n",
    "created_at": "2010-07-09T12:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108208",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,11 +5,11 @@
 sage: g = t + t^3 + t^5 + O(t^6); g
 t + t^3 + t^5 + O(t^6)
 sage: [g == g.add_bigoh(i) for i in range(7)]
-[True, True, False, False, True, False, True] # should be all true
+[True, False, True, False, True, False, True]
 sage: g.add_bigoh(3).list()
-[1]
+[0, 1]
 sage: g.add_bigoh(3).padded_list()
-[1, 0, 0]
+[0, 1, 0]
 ```
 
 
``````




---

archive/issue_comments_108209.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 niles]: Code in the previous description made no sense; my apologies.  Here's what we have after applying the patch:\n\n```\nsage: A.<t> = PowerSeriesRing(ZZ)\nsage: g = t + t^3 + t^5 + O(t^6); g\nt + t^3 + t^5 + O(t^6)\nsage: [g == g.add_bigoh(i) for i in range(7)]\n[True, True, True, True, True, True, True]\n\n\nsage: f = t + t^2 + O(t^10)\nsage: f == f.truncate()\nTrue\nsage: f.padded_list()\n[0, 1, 1, 0, 0, 0, 0, 0, 0, 0]\nsage: f.padded_list(infinity)\n[0, 1, 1]\n```",
    "created_at": "2010-07-09T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108209",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:5'></a>Replying to [comment:4 niles]: Code in the previous description made no sense; my apologies.  Here's what we have after applying the patch:

```
sage: A.<t> = PowerSeriesRing(ZZ)
sage: g = t + t^3 + t^5 + O(t^6); g
t + t^3 + t^5 + O(t^6)
sage: [g == g.add_bigoh(i) for i in range(7)]
[True, True, True, True, True, True, True]


sage: f = t + t^2 + O(t^10)
sage: f == f.truncate()
True
sage: f.padded_list()
[0, 1, 1, 0, 0, 0, 0, 0, 0, 0]
sage: f.padded_list(infinity)
[0, 1, 1]
```



---

archive/issue_comments_108210.json:
```json
{
    "body": "apply after previous patch; includes doctests",
    "created_at": "2010-07-12T16:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108210",
    "user": "https://github.com/nilesjohnson"
}
```

apply after previous patch; includes doctests



---

archive/issue_comments_108211.json:
```json
{
    "body": "Changing author from \"\" to \"niles\"",
    "created_at": "2010-07-30T16:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108211",
    "user": "https://github.com/simon-king-jena"
}
```

Changing author from "" to "niles"



---

archive/issue_comments_108212.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-07-30T16:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108212",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_108213.json:
```json
{
    "body": "<a id='comment:6'></a>Attachment [trac_9457_power_series_eq_doctests.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq_doctests.patch) by @simon-king-jena created at 2010-07-30 16:59:31\n\nHi!\n\nThe patches cleanly apply, and `sage -b` works.\n\nThe original problem is fixed:\n\n```\nsage: A.<t> = PowerSeriesRing(ZZ)\nsage: g = t + t^3 + t^5 + O(t^6); g\nt + t^3 + t^5 + O(t^6)\nsage:\nsage: [g == g.add_bigoh(i) for i in range(7)]\n[True, True, True, True, True, True, True]\n```\n\nThe code looks good to me. I am now running doctests.\n\nOne minor problem: Please mention the ticket number in the commit messages. So, please add something like \"#9457: \" to the commit messages of both patches",
    "created_at": "2010-07-30T16:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108213",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>Attachment [trac_9457_power_series_eq_doctests.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq_doctests.patch) by @simon-king-jena created at 2010-07-30 16:59:31

Hi!

The patches cleanly apply, and `sage -b` works.

The original problem is fixed:

```
sage: A.<t> = PowerSeriesRing(ZZ)
sage: g = t + t^3 + t^5 + O(t^6); g
t + t^3 + t^5 + O(t^6)
sage:
sage: [g == g.add_bigoh(i) for i in range(7)]
[True, True, True, True, True, True, True]
```

The code looks good to me. I am now running doctests.

One minor problem: Please mention the ticket number in the commit messages. So, please add something like "#9457: " to the commit messages of both patches



---

archive/issue_comments_108214.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Mention ticket number in commit messages\"",
    "created_at": "2010-07-30T16:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108214",
    "user": "https://github.com/simon-king-jena"
}
```

Changing work_issues from "" to "Mention ticket number in commit messages"



---

archive/issue_comments_108215.json:
```json
{
    "body": "Changing work_issues from \"Mention ticket number in commit messages\" to \"Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic; mention ticket number in commit messages.\"",
    "created_at": "2010-07-30T22:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108215",
    "user": "https://github.com/simon-king-jena"
}
```

Changing work_issues from "Mention ticket number in commit messages" to "Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic; mention ticket number in commit messages."



---

archive/issue_comments_108216.json:
```json
{
    "body": "<a id='comment:7'></a>First, I applied the patches from #9443 and found that all doctests pass. Then, I applied the tickets from here, and got one doctest failure:\n\n```\nsage -t  -long devel/sage/sage/schemes/elliptic_curves/sha_tate.py\nSaturation index bound = 265\nWARNING: saturation at primes p > 100 will not be done;\npoints may be unsaturated at primes between 100 and index bound\nFailed to saturate MW basis at primes [ ]\n*** saturation possibly incomplete at primes [ ]\n**********************************************************************\nFile \"/home/king/SAGE/sage-4.4.2/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 393:\n    sage: EllipticCurve('53a1').sha().an_padic(5) # rank 1    (long time)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/SAGE/sage-4.4.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/king/SAGE/sage-4.4.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/king/SAGE/sage-4.4.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_4[13]>\", line 1, in <module>\n        EllipticCurve('53a1').sha().an_padic(Integer(5)) # rank 1    (long time)###line 393:\n    sage: EllipticCurve('53a1').sha().an_padic(5) # rank 1    (long time)\n      File \"/home/king/SAGE/sage-4.4.2/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 567, in an_padic\n        raise RuntimeError, \"There must be a bug in the supersingular routines for the p-adic BSD.\"\n    RuntimeError: There must be a bug in the supersingular routines for the p-adic BSD.\n```\n\nSo, there will be some bug hunt needed.",
    "created_at": "2010-07-30T22:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108216",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>First, I applied the patches from #9443 and found that all doctests pass. Then, I applied the tickets from here, and got one doctest failure:

```
sage -t  -long devel/sage/sage/schemes/elliptic_curves/sha_tate.py
Saturation index bound = 265
WARNING: saturation at primes p > 100 will not be done;
points may be unsaturated at primes between 100 and index bound
Failed to saturate MW basis at primes [ ]
*** saturation possibly incomplete at primes [ ]
**********************************************************************
File "/home/king/SAGE/sage-4.4.2/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 393:
    sage: EllipticCurve('53a1').sha().an_padic(5) # rank 1    (long time)
Exception raised:
    Traceback (most recent call last):
      File "/home/king/SAGE/sage-4.4.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/king/SAGE/sage-4.4.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/king/SAGE/sage-4.4.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_4[13]>", line 1, in <module>
        EllipticCurve('53a1').sha().an_padic(Integer(5)) # rank 1    (long time)###line 393:
    sage: EllipticCurve('53a1').sha().an_padic(5) # rank 1    (long time)
      File "/home/king/SAGE/sage-4.4.2/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 567, in an_padic
        raise RuntimeError, "There must be a bug in the supersingular routines for the p-adic BSD."
    RuntimeError: There must be a bug in the supersingular routines for the p-adic BSD.
```

So, there will be some bug hunt needed.



---

archive/issue_comments_108217.json:
```json
{
    "body": "<a id='comment:8'></a>Here's the problem.\n\nWithout the patch:\n\n```\nsage: R.<T> = QQ.completion(5,5)[[]]\nsage: R\nPower Series Ring in T over 5-adic Field with capped relative precision 5\nsage: O(T^2) == 0\nFalse\n```\n\nWith the patch:\n\n```\nsage: R.<T> = QQ.completion(5,5)[[]]\nsage: R\nPower Series Ring in T over 5-adic Field with capped relative precision 5\nsage: O(T^2) == 0\nTrue\n```\n\nI guess that the second answer is correct. Unfortunately, Sha.an_padic relies on the wrong answer.",
    "created_at": "2010-07-31T12:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108217",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>Here's the problem.

Without the patch:

```
sage: R.<T> = QQ.completion(5,5)[[]]
sage: R
Power Series Ring in T over 5-adic Field with capped relative precision 5
sage: O(T^2) == 0
False
```

With the patch:

```
sage: R.<T> = QQ.completion(5,5)[[]]
sage: R
Power Series Ring in T over 5-adic Field with capped relative precision 5
sage: O(T^2) == 0
True
```

I guess that the second answer is correct. Unfortunately, Sha.an_padic relies on the wrong answer.



---

archive/issue_comments_108218.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks, but I'm not sure I can tell how to fix this . . . I see in the code for `Sha.an_padic` the following lines:\n\n```\n# check consistency (the first two are only here to avoid a bug in the p-adic L-series\n# (namely the coefficients of zero-relative precision are treated as zero)\nif shan0 != 0 and shan1 != 0 and shan0 - shan1 != 0:\n    raise RuntimeError, \"There must be a bug in the supersingular routines for the p-adic BSD.\"\n```\n\nI suppose this is part of the problem but I don't see how to fix it . . . the two variables `shan0` and `shan1` are printed in the verbose output as \"the two values for Sha\"; the value of `shan1` is different depending on whether or not the patch is applied, but I have no idea which value is correct:\n\nWithout the patch:\n\n```\nsage: set_verbose(1)\nsage: EllipticCurve('53a1').sha().an_padic(5)\n ...\nverbose 1 (316: sha_tate.py, an_padic) ...putting things together\nverbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 0]\n1 + O(5)\n```\n\n\nWith the patch:\n\n```\nsage: set_verbose(1)\nsage: EllipticCurve('53a1').sha().an_padic(5)\n ...\nverbose 1 (316: sha_tate.py, an_padic) ...putting things together\nverbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 4 + O(5)]\n---------------------------------------------------------------------------\nTraceback (most recent call last)\n...\nRuntimeError: There must be a bug in the supersingular routines for the p-adic BSD.\n\n```\n\nNote that simply removing the conditions `shan0 != 0 and shan1 != 0` (as implied by the inline comment) does not resolve the problem, since `shan0 != shan1` is `True` with the patch.  The values of `shan0` and `shan1` are computed by the function `pAdicLseriesSupersingular.Dp_valued_series`, which gives different output with and without the patch; again I have no idea which is correct.\n\n\nWithout the patch:\n\n```\nsage: E = EllipticCurve('53a1')\nsage: Et, D = E.minimal_quadratic_twist()\nsage: lp = Et.padic_lseries(5)\nsage: lps = lp.Dp_valued_series(4,quadratic_twist=D, prec=4)\nsage: lps\n(O(5^4) + (3 + O(5))*T + O(5)*T^2 + (4 + O(5))*T^3 + O(T^4), O(T^4))\n```\n\nWith the patch:\n\n```\nsage: E = EllipticCurve('53a1')\nsage: Et, D = E.minimal_quadratic_twist()\nsage: lp = Et.padic_lseries(5)\nsage: lps = lp.Dp_valued_series(4,quadratic_twist=D, prec=4)\nsage: lps\n(O(5^4) + (3 + O(5))*T + O(5)*T^2 + (4 + O(5))*T^3 + O(T^4), O(5^5) + (4*5 + O(5^2))*T + O(5^2)*T^2 + (2*5 + O(5^2))*T^3 + O(T^4))\n```\n\nNote that every line of `pAdicLseriesSupersingular.Dp_valued_series` gives the same output with or without the patch, except for the very last one, which computes `lpv*eps.transpose()` where (with or without the patch)\n\n```\nlpv = (O(5^3) + (2*5^-1 + O(5^0))*T + O(5^0)*T^2 + (5^-1 + O(5^0))*T^3 + O(T^4), O(T^4))\n```\n\nand\n\n```\neps.transpose() = \n[  5/9 25/18]\n[-5/18   5/9]\n```\n\nBefore I try to chase this further, I think we should try to determine whether the patch is causing `Dp_valued_series` to give the wrong answer, or whether the conditions on `shan0` and `shan1` should be changed.  Ideas?  If I've missed the point of your previous comment, could you explain how you determined that was the problem?\n\np.s. I haven't forgotten about fixing the commit messages; I'll do it after this is sorted out.",
    "created_at": "2010-08-01T14:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108218",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:9'></a>Thanks, but I'm not sure I can tell how to fix this . . . I see in the code for `Sha.an_padic` the following lines:

```
# check consistency (the first two are only here to avoid a bug in the p-adic L-series
# (namely the coefficients of zero-relative precision are treated as zero)
if shan0 != 0 and shan1 != 0 and shan0 - shan1 != 0:
    raise RuntimeError, "There must be a bug in the supersingular routines for the p-adic BSD."
```

I suppose this is part of the problem but I don't see how to fix it . . . the two variables `shan0` and `shan1` are printed in the verbose output as "the two values for Sha"; the value of `shan1` is different depending on whether or not the patch is applied, but I have no idea which value is correct:

Without the patch:

```
sage: set_verbose(1)
sage: EllipticCurve('53a1').sha().an_padic(5)
 ...
verbose 1 (316: sha_tate.py, an_padic) ...putting things together
verbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 0]
1 + O(5)
```


With the patch:

```
sage: set_verbose(1)
sage: EllipticCurve('53a1').sha().an_padic(5)
 ...
verbose 1 (316: sha_tate.py, an_padic) ...putting things together
verbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 4 + O(5)]
---------------------------------------------------------------------------
Traceback (most recent call last)
...
RuntimeError: There must be a bug in the supersingular routines for the p-adic BSD.

```

Note that simply removing the conditions `shan0 != 0 and shan1 != 0` (as implied by the inline comment) does not resolve the problem, since `shan0 != shan1` is `True` with the patch.  The values of `shan0` and `shan1` are computed by the function `pAdicLseriesSupersingular.Dp_valued_series`, which gives different output with and without the patch; again I have no idea which is correct.


Without the patch:

```
sage: E = EllipticCurve('53a1')
sage: Et, D = E.minimal_quadratic_twist()
sage: lp = Et.padic_lseries(5)
sage: lps = lp.Dp_valued_series(4,quadratic_twist=D, prec=4)
sage: lps
(O(5^4) + (3 + O(5))*T + O(5)*T^2 + (4 + O(5))*T^3 + O(T^4), O(T^4))
```

With the patch:

```
sage: E = EllipticCurve('53a1')
sage: Et, D = E.minimal_quadratic_twist()
sage: lp = Et.padic_lseries(5)
sage: lps = lp.Dp_valued_series(4,quadratic_twist=D, prec=4)
sage: lps
(O(5^4) + (3 + O(5))*T + O(5)*T^2 + (4 + O(5))*T^3 + O(T^4), O(5^5) + (4*5 + O(5^2))*T + O(5^2)*T^2 + (2*5 + O(5^2))*T^3 + O(T^4))
```

Note that every line of `pAdicLseriesSupersingular.Dp_valued_series` gives the same output with or without the patch, except for the very last one, which computes `lpv*eps.transpose()` where (with or without the patch)

```
lpv = (O(5^3) + (2*5^-1 + O(5^0))*T + O(5^0)*T^2 + (5^-1 + O(5^0))*T^3 + O(T^4), O(T^4))
```

and

```
eps.transpose() = 
[  5/9 25/18]
[-5/18   5/9]
```

Before I try to chase this further, I think we should try to determine whether the patch is causing `Dp_valued_series` to give the wrong answer, or whether the conditions on `shan0` and `shan1` should be changed.  Ideas?  If I've missed the point of your previous comment, could you explain how you determined that was the problem?

p.s. I haven't forgotten about fixing the commit messages; I'll do it after this is sorted out.



---

archive/issue_comments_108219.json:
```json
{
    "body": "<a id='comment:10'></a>Hi niles!\n\nReplying to [comment:9 niles]:\n> Thanks, but I'm not sure I can tell how to fix this . . . \n\n\nAt least your bug hunting was much deeper than mine.\n\n> Before I try to chase this further, I think we should try to determine whether the patch is causing `Dp_valued_series` to give the wrong answer, or whether the conditions on `shan0` and `shan1` should be changed.\n\n\nProbably `Dp_valued_series`, since the patch changes it, as you found out. But I am no expert for elliptic curves.\n\n>  Ideas?  If I've missed the point of your previous comment, could you explain how you determined that was the problem?\n\n\nI inserted some print statements into an_padic, I don't recall exactly where. And it told me that just before the error occured, `O(T^2)` occured and was tested for being zero. As this is something that the patch changed, I conluded that there is a problem (but perhaps not the only problem).",
    "created_at": "2010-08-01T15:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108219",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>Hi niles!

Replying to [comment:9 niles]:
> Thanks, but I'm not sure I can tell how to fix this . . . 


At least your bug hunting was much deeper than mine.

> Before I try to chase this further, I think we should try to determine whether the patch is causing `Dp_valued_series` to give the wrong answer, or whether the conditions on `shan0` and `shan1` should be changed.


Probably `Dp_valued_series`, since the patch changes it, as you found out. But I am no expert for elliptic curves.

>  Ideas?  If I've missed the point of your previous comment, could you explain how you determined that was the problem?


I inserted some print statements into an_padic, I don't recall exactly where. And it told me that just before the error occured, `O(T^2)` occured and was tested for being zero. As this is something that the patch changed, I conluded that there is a problem (but perhaps not the only problem).



---

archive/issue_comments_108220.json:
```json
{
    "body": "<a id='comment:11'></a>Hi Simon, thanks for the quick reply :)\n\nReplying to [comment:10 SimonKing]:\n> Probably `Dp_valued_series`, since the patch changes it, as you found out. But I am no expert for elliptic curves.\n\n\nThat's my guess too; I'll write an e-mail to sage-devel and see if someone can help",
    "created_at": "2010-08-01T15:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108220",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:11'></a>Hi Simon, thanks for the quick reply :)

Replying to [comment:10 SimonKing]:
> Probably `Dp_valued_series`, since the patch changes it, as you found out. But I am no expert for elliptic curves.


That's my guess too; I'll write an e-mail to sage-devel and see if someone can help



---

archive/issue_comments_108221.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 SimonKing]:\n\nHi Simon,\n\nI believe I have identified the problem; I think it is a problem with negative valuation for p-adics.  First, here is what `Dp_valued_series` does:\n\nWith or without the patch, we have\n\n```\nsage: import sage.matrix.all as matrix\nsage: p = 5\nsage: prec = 2\nsage: E = EllipticCurve('53a1')\nsage: L = E.padic_lseries(5)\nsage: lps = L.series(4)\nsage: R = lps.base_ring().base_ring()\nsage: QpT, T = PowerSeriesRing(R,'T',2).objgen()\nsage: G = QpT([lps[n][0] for n in range(0,lps.prec())], prec)\nsage: H = QpT([lps[n][1] for n in range(0,lps.prec())], prec)\nsage: phi = matrix.matrix([[0,-1/p],[1,E.ap(p)/p]])\nsage: lpv = vector([G  + (E.ap(p))*H  , - R(p) * H ])\nsage: eps = (1-phi)**(-2)\nsage: lpv\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))\nsage: eps.transpose()\n[  5/9 25/18]\n[-5/18   5/9]\n```\n\nNow `Dp_valued_series` ends by returning `lpv*eps.transpose()`.\n\nWithout the patch:\n\n```\nsage: lpv*eps.transpose()\n(O(5^4) + (3 + O(5))*T + O(T^2), O(T^2))\n```\n\nAnd with the patch:\n\n```\nsage: lpv*eps.transpose()\n(O(5^4) + (3 + O(5))*T + O(T^2), O(5^5) + (4*5 + O(5^2))*T + O(T^2))\n```\n\nI had thought the with-patch answer was clearly right, until I tried the following (without the patch):\n\n```\nsage: a = vector([O(5^3) + (R(2/5).add_bigoh(0))*T + O(T^2), O(T^2)])\nsage: M = matrix.matrix([[  0, 1],[0,  1]]); M\n[0 1]\n[0 1]\nsage: a\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))\nsage: lpv\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))\nsage: a*M\n(0, O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2))\nsage: lpv*M\n(0, O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2))\n\nsage: M = matrix.matrix([[  0, 5],[0,  1]])\nsage: a*M\n(0, O(5^4) + (2 + O(5))*T + O(T^2))\nsage: lpv*M\n(0, O(T^2))\n```\n\nNow note the way `lpv[1]` is constructed: pull certain coefficients from `lps` and make a power series (of precision 2) in `QpT` with them.  Here is the list of coefficients for `H`:\n\n```\nsage: [lps[n][1] for n in range(0,lps.prec())]\n[O(5^2), O(5^-1), O(5^-1), O(5^-1), O(5^-1)]\nsage: H\nO(T^2)\n```\n\nSo the `O(T^2)` in `lpv[1]` should really be `O(5^2) + O(5^-1)*T + O(T^2)`, and this explains why `lpv*M` really should be `(0, O(T^2))` (when M has a 5 in the upper-right entry).\n\nHere is a more direct test that passing to the power series ring over 5-adic field does not remember negative precision of 0 (this is without the patch):\n\n```\nsage: R(0).add_bigoh(-1)\nO(5^-1)\nsage: QpT(R(0).add_bigoh(-1))\n0\nsage: R(0).add_bigoh(-1).precision_absolute()\n-1\nsage: QpT(R(0).add_bigoh(-1))[0].precision_absolute()\n+Infinity\nsage: QpT(R(1/25).add_bigoh(-1))\n5^-2 + O(5^-1)\nsage: QpT(R(1/25).add_bigoh(-1))[0].precision_absolute()\n-1\n```\n\nI believe the correct arithmetic should be as follows:\n\n```\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(5^2) + O(5^-1)*T + O(T^2))*\n[  5/9 25/18]\n[-5/18   5/9]\n```\nshould be\n\n```\n(O(5^3) + O(5^0)*T + O(T^2), O(5^3) + O(5^0)*T + O(T^2))\n```\nDoes this seem right?  If this were the output of `Dp_valued_series`, then `EllipticCurve('53a1').sha().an_padic(5)` would increase the precision of `Dp_valued_series` from 2 to 3 and run it again; I tested this, and with this precision `EllipticCurve('53a1').sha().an_padic(5)` succeeds (with the patch applied!) and gives the expected answer.\n \nSo I believe the problem is a bug with power series over p-adics, rather than with this patch or with the elliptic curves code.  Does this seem right to you?  If so, one possible route at this stage is to modify the `an_padic` code so that rather than throwing the error it first runs another loop with additional precision, and then submit a separate trac ticket for the p-adic problem.  This is sort of dodging the issue, but helps keep the individual bugs separated.",
    "created_at": "2010-08-03T13:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108221",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:12'></a>Replying to [comment:10 SimonKing]:

Hi Simon,

I believe I have identified the problem; I think it is a problem with negative valuation for p-adics.  First, here is what `Dp_valued_series` does:

With or without the patch, we have

```
sage: import sage.matrix.all as matrix
sage: p = 5
sage: prec = 2
sage: E = EllipticCurve('53a1')
sage: L = E.padic_lseries(5)
sage: lps = L.series(4)
sage: R = lps.base_ring().base_ring()
sage: QpT, T = PowerSeriesRing(R,'T',2).objgen()
sage: G = QpT([lps[n][0] for n in range(0,lps.prec())], prec)
sage: H = QpT([lps[n][1] for n in range(0,lps.prec())], prec)
sage: phi = matrix.matrix([[0,-1/p],[1,E.ap(p)/p]])
sage: lpv = vector([G  + (E.ap(p))*H  , - R(p) * H ])
sage: eps = (1-phi)**(-2)
sage: lpv
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))
sage: eps.transpose()
[  5/9 25/18]
[-5/18   5/9]
```

Now `Dp_valued_series` ends by returning `lpv*eps.transpose()`.

Without the patch:

```
sage: lpv*eps.transpose()
(O(5^4) + (3 + O(5))*T + O(T^2), O(T^2))
```

And with the patch:

```
sage: lpv*eps.transpose()
(O(5^4) + (3 + O(5))*T + O(T^2), O(5^5) + (4*5 + O(5^2))*T + O(T^2))
```

I had thought the with-patch answer was clearly right, until I tried the following (without the patch):

```
sage: a = vector([O(5^3) + (R(2/5).add_bigoh(0))*T + O(T^2), O(T^2)])
sage: M = matrix.matrix([[  0, 1],[0,  1]]); M
[0 1]
[0 1]
sage: a
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))
sage: lpv
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))
sage: a*M
(0, O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2))
sage: lpv*M
(0, O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2))

sage: M = matrix.matrix([[  0, 5],[0,  1]])
sage: a*M
(0, O(5^4) + (2 + O(5))*T + O(T^2))
sage: lpv*M
(0, O(T^2))
```

Now note the way `lpv[1]` is constructed: pull certain coefficients from `lps` and make a power series (of precision 2) in `QpT` with them.  Here is the list of coefficients for `H`:

```
sage: [lps[n][1] for n in range(0,lps.prec())]
[O(5^2), O(5^-1), O(5^-1), O(5^-1), O(5^-1)]
sage: H
O(T^2)
```

So the `O(T^2)` in `lpv[1]` should really be `O(5^2) + O(5^-1)*T + O(T^2)`, and this explains why `lpv*M` really should be `(0, O(T^2))` (when M has a 5 in the upper-right entry).

Here is a more direct test that passing to the power series ring over 5-adic field does not remember negative precision of 0 (this is without the patch):

```
sage: R(0).add_bigoh(-1)
O(5^-1)
sage: QpT(R(0).add_bigoh(-1))
0
sage: R(0).add_bigoh(-1).precision_absolute()
-1
sage: QpT(R(0).add_bigoh(-1))[0].precision_absolute()
+Infinity
sage: QpT(R(1/25).add_bigoh(-1))
5^-2 + O(5^-1)
sage: QpT(R(1/25).add_bigoh(-1))[0].precision_absolute()
-1
```

I believe the correct arithmetic should be as follows:

```
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(5^2) + O(5^-1)*T + O(T^2))*
[  5/9 25/18]
[-5/18   5/9]
```
should be

```
(O(5^3) + O(5^0)*T + O(T^2), O(5^3) + O(5^0)*T + O(T^2))
```
Does this seem right?  If this were the output of `Dp_valued_series`, then `EllipticCurve('53a1').sha().an_padic(5)` would increase the precision of `Dp_valued_series` from 2 to 3 and run it again; I tested this, and with this precision `EllipticCurve('53a1').sha().an_padic(5)` succeeds (with the patch applied!) and gives the expected answer.
 
So I believe the problem is a bug with power series over p-adics, rather than with this patch or with the elliptic curves code.  Does this seem right to you?  If so, one possible route at this stage is to modify the `an_padic` code so that rather than throwing the error it first runs another loop with additional precision, and then submit a separate trac ticket for the p-adic problem.  This is sort of dodging the issue, but helps keep the individual bugs separated.



---

archive/issue_comments_108222.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 niles]:\n\n> So the `O(T^2)` in `lpv[1]` should really be `O(5^2) + O(5^-1)*T + O(T^2)`, and this explains why `lpv*M` really should be `(0, O(T^2))` (when M has a 5 in the upper-right entry).\n\n\noops, `lpv[1]` is `(-R(p)) * H`, so I guess it should be `O(5^3) + O(5^0)*T + O(T^2)`\n\nand the arithmetic is:\n\n```\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(5^3) + O(5^0)*T + O(T^2))*\n[  5/9 25/18]\n[-5/18   5/9]\n```\nshould be\n\n```\n(O(5^4) + (3 + O(5))*T + O(T^2), O(5^4) + O(5)*T + O(T^2))\n```\nwhich will cause `an_padic` to still throw the error :(\n\nIn any case, computing with a higher precision does give the right answer with or without the patch.  I noticed there is an optional argument for this:\n\n```\nsage: set_verbose(1)\nsage: EllipticCurve('53a1').sha().an_padic(5, prec=5)\n ...\nverbose 1 (316: sha_tate.py, an_padic) the algebraic leading terms : (3 + 5 + 2*5^3 + 3*5^4 + 3*5^6 + 4*5^7 + 2*5^8 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 3*5^15 + 4*5^16 + 4*5^17 + 3*5^18 + 4*5^19 + O(5^20), 5 + 5^2 + 3*5^3 + 4*5^4 + 5^5 + 2*5^6 + 3*5^7 + 2*5^8 + 4*5^9 + 2*5^10 + 4*5^12 + 3*5^13 + 3*5^14 + 4*5^15 + 3*5^16 + 2*5^17 + 3*5^18 + 5^19 + O(5^20))\nverbose 1 (316: sha_tate.py, an_padic) ...computing the p-adic L-series\nverbose 1 (316: sha_tate.py, an_padic) r = 1\nverbose 1 (881: padic_lseries.py, series) using p-adic precision of 5\nverbose 1 (881: padic_lseries.py, series) Now iterating over 2500 summands\nverbose 1 (316: sha_tate.py, an_padic) the leading terms : [3 + O(5), 5 + O(5^2)]\nverbose 1 (316: sha_tate.py, an_padic) ...putting things together\nverbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 1 + O(5)]\n1 + O(5)\n```",
    "created_at": "2010-08-03T18:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108222",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:13'></a>Replying to [comment:12 niles]:

> So the `O(T^2)` in `lpv[1]` should really be `O(5^2) + O(5^-1)*T + O(T^2)`, and this explains why `lpv*M` really should be `(0, O(T^2))` (when M has a 5 in the upper-right entry).


oops, `lpv[1]` is `(-R(p)) * H`, so I guess it should be `O(5^3) + O(5^0)*T + O(T^2)`

and the arithmetic is:

```
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(5^3) + O(5^0)*T + O(T^2))*
[  5/9 25/18]
[-5/18   5/9]
```
should be

```
(O(5^4) + (3 + O(5))*T + O(T^2), O(5^4) + O(5)*T + O(T^2))
```
which will cause `an_padic` to still throw the error :(

In any case, computing with a higher precision does give the right answer with or without the patch.  I noticed there is an optional argument for this:

```
sage: set_verbose(1)
sage: EllipticCurve('53a1').sha().an_padic(5, prec=5)
 ...
verbose 1 (316: sha_tate.py, an_padic) the algebraic leading terms : (3 + 5 + 2*5^3 + 3*5^4 + 3*5^6 + 4*5^7 + 2*5^8 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 3*5^15 + 4*5^16 + 4*5^17 + 3*5^18 + 4*5^19 + O(5^20), 5 + 5^2 + 3*5^3 + 4*5^4 + 5^5 + 2*5^6 + 3*5^7 + 2*5^8 + 4*5^9 + 2*5^10 + 4*5^12 + 3*5^13 + 3*5^14 + 4*5^15 + 3*5^16 + 2*5^17 + 3*5^18 + 5^19 + O(5^20))
verbose 1 (316: sha_tate.py, an_padic) ...computing the p-adic L-series
verbose 1 (316: sha_tate.py, an_padic) r = 1
verbose 1 (881: padic_lseries.py, series) using p-adic precision of 5
verbose 1 (881: padic_lseries.py, series) Now iterating over 2500 summands
verbose 1 (316: sha_tate.py, an_padic) the leading terms : [3 + O(5), 5 + O(5^2)]
verbose 1 (316: sha_tate.py, an_padic) ...putting things together
verbose 1 (316: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 1 + O(5)]
1 + O(5)
```



---

archive/issue_comments_108223.json:
```json
{
    "body": "<a id='comment:14'></a>A bug in p-adic vectors related to the problems here was noticed and filed at #8198.  Problems with power series having zero p-adic coefficients were noticed and filed at #4656.  These seem related to #5075 (polynomials over inexact rings should not truncate inexact leading zeroes) and #6084 (Improved p-adic polynomials).  When these are resolved, perhaps progress can be made here.",
    "created_at": "2010-08-03T23:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108223",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:14'></a>A bug in p-adic vectors related to the problems here was noticed and filed at #8198.  Problems with power series having zero p-adic coefficients were noticed and filed at #4656.  These seem related to #5075 (polynomials over inexact rings should not truncate inexact leading zeroes) and #6084 (Improved p-adic polynomials).  When these are resolved, perhaps progress can be made here.



---

archive/issue_comments_108224.json:
```json
{
    "body": "Changing work_issues from \"Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic; mention ticket number in commit messages.\" to \"Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic\"",
    "created_at": "2011-05-11T13:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108224",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic; mention ticket number in commit messages." to "Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic"



---

archive/issue_comments_108225.json:
```json
{
    "body": "Attachment [trac_9457_power_series_eq_rebase.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq_rebase.patch) by @nilesjohnson created at 2012-05-03 14:52:51\n\nrebased to 5.0.rc0",
    "created_at": "2012-05-03T14:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108225",
    "user": "https://github.com/nilesjohnson"
}
```

Attachment [trac_9457_power_series_eq_rebase.patch](tarball://root/attachments/some-uuid/ticket9457/trac_9457_power_series_eq_rebase.patch) by @nilesjohnson created at 2012-05-03 14:52:51

rebased to 5.0.rc0



---

archive/issue_comments_108226.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,8 @@\n [0, 1, 0]\n ```\n \n+## Apply\n \n+* [attachment: trac_9457_power_series_eq_rebase.patch]\n+\n+\n``````\n",
    "created_at": "2012-05-03T14:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108226",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,8 @@
 [0, 1, 0]
 ```
 
+## Apply
 
+* [attachment: trac_9457_power_series_eq_rebase.patch]
+
+
``````




---

archive/issue_comments_108227.json:
```json
{
    "body": "Changing work_issues from \"Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic\" to \"\"",
    "created_at": "2012-05-03T14:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108227",
    "user": "https://github.com/nilesjohnson"
}
```

Changing work_issues from "Fix bug in sage.schemes.elliptic_curves.sha_tate.Sha.an_padic" to ""



---

archive/issue_comments_108228.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-03T14:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108228",
    "user": "https://github.com/nilesjohnson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_108229.json:
```json
{
    "body": "<a id='comment:16'></a>Bugs in p-adics seem to have been fixed as of Sage 5.0.rc0, so this patch passes all long tests in sage/schemes/elliptic_curves.  Since `padded_list` is quite a bit slower than `list`, I've reworked the patch to keep using `list`, but to append zeroes to the end of those lists which are too short.\n\nPatchbot: apply [attachment: trac_9457_power_series_eq_rebase.patch]",
    "created_at": "2012-05-03T14:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108229",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:16'></a>Bugs in p-adics seem to have been fixed as of Sage 5.0.rc0, so this patch passes all long tests in sage/schemes/elliptic_curves.  Since `padded_list` is quite a bit slower than `list`, I've reworked the patch to keep using `list`, but to append zeroes to the end of those lists which are too short.

Patchbot: apply [attachment: trac_9457_power_series_eq_rebase.patch]



---

archive/issue_events_023410.json:
```json
{
    "actor": "https://github.com/nilesjohnson",
    "created_at": "2012-05-03T14:59:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23410"
}
```



---

archive/issue_comments_108230.json:
```json
{
    "body": "<a id='comment:18'></a>Patchbot: apply trac_9457_power_series_eq_rebase.patch",
    "created_at": "2012-05-03T15:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108230",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:18'></a>Patchbot: apply trac_9457_power_series_eq_rebase.patch



---

archive/issue_comments_108231.json:
```json
{
    "body": "<a id='comment:19'></a>Oh bother!  When switching from `padded_list` to \n\n```\nx += [0]*(prec - len(x)) # x.list() does not include trailing zeroes \nx = x[:prec] # truncate x to common prec \n```\n\nI seem to be triggering the problem in `sha_tate.py` again . . .",
    "created_at": "2012-05-03T15:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108231",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:19'></a>Oh bother!  When switching from `padded_list` to 

```
x += [0]*(prec - len(x)) # x.list() does not include trailing zeroes 
x = x[:prec] # truncate x to common prec 
```

I seem to be triggering the problem in `sha_tate.py` again . . .



---

archive/issue_comments_108232.json:
```json
{
    "body": "Changing work_issues from \"\" to \"resolve problems with sha_tate.py\"",
    "created_at": "2012-05-03T15:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108232",
    "user": "https://github.com/nilesjohnson"
}
```

Changing work_issues from "" to "resolve problems with sha_tate.py"



---

archive/issue_comments_108233.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-03T15:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108233",
    "user": "https://github.com/nilesjohnson"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_023411.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23411"
}
```



---

archive/issue_events_023412.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23412"
}
```



---

archive/issue_comments_108234.json:
```json
{
    "body": "<a id='comment:21'></a>Last 10 new commits:",
    "created_at": "2014-01-03T19:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108234",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:21'></a>Last 10 new commits:



---

archive/issue_comments_108235.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,6 @@\n \n ## Apply\n \n-* [attachment: trac_9457_power_series_eq_rebase.patch]\n+* [attachment:trac_9457_power_series_eq_rebase.patch]\n \n \n``````\n",
    "created_at": "2014-01-03T19:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108235",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,6 @@
 
 ## Apply
 
-* [attachment: trac_9457_power_series_eq_rebase.patch]
+* [attachment:trac_9457_power_series_eq_rebase.patch]
 
 
``````




---

archive/issue_comments_108236.json:
```json
{
    "body": "Changing branch from \"\" to \"u/niles/ticket/9457\"",
    "created_at": "2014-01-03T19:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108236",
    "user": "https://github.com/nilesjohnson"
}
```

Changing branch from "" to "u/niles/ticket/9457"



---

archive/issue_comments_108237.json:
```json
{
    "body": "Changing commit from \"\" to \"83d1220d288e46df6e3e933a79faa4fc064ccefa\"",
    "created_at": "2014-01-03T19:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108237",
    "user": "https://github.com/nilesjohnson"
}
```

Changing commit from "" to "83d1220d288e46df6e3e933a79faa4fc064ccefa"



---

archive/issue_comments_108238.json:
```json
{
    "body": "Changing commit from \"83d1220d288e46df6e3e933a79faa4fc064ccefa\" to \"e2219602a9d360f465ad79b098e4f923765ab791\"",
    "created_at": "2014-01-03T19:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "83d1220d288e46df6e3e933a79faa4fc064ccefa" to "e2219602a9d360f465ad79b098e4f923765ab791"



---

archive/issue_comments_108239.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-03T19:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_108240.json:
```json
{
    "body": "<a id='comment:23'></a>I had hoped the changes at #12555 would magically resolve this, but they do not.  The other related tickets, listed in comment [comment:14]  are also not fixed by #12555.\n\nNote that the current version of the git branch for this ticket (commit \u200be221960) does *not* include the changes of #12555, although the initial version mistakenly did.",
    "created_at": "2014-01-03T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108240",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:23'></a>I had hoped the changes at #12555 would magically resolve this, but they do not.  The other related tickets, listed in comment [comment:14]  are also not fixed by #12555.

Note that the current version of the git branch for this ticket (commit e221960) does *not* include the changes of #12555, although the initial version mistakenly did.



---

archive/issue_comments_108241.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,13 @@\n-Comparison of power series uses list instead of padded_list; this means that power series equality can fail:\n+Comparison of power series uses `list` instead of `padded_list`.  This drops trailing zeros, and means that power series equality is buggy:\n \n ```\n sage: A.<t> = PowerSeriesRing(ZZ)\n sage: g = t + t^3 + t^5 + O(t^6); g\n t + t^3 + t^5 + O(t^6)\n-sage: [g == g.add_bigoh(i) for i in range(7)]\n-[True, False, True, False, True, False, True]\n-sage: g.add_bigoh(3).list()\n+sage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True\n+[True, False, True, False, True, False, True] \n+\n+sage: g.add_bigoh(3).list()  # drops trailing zero\n [0, 1]\n sage: g.add_bigoh(3).padded_list()\n [0, 1, 0]\n``````\n",
    "created_at": "2014-01-03T19:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108241",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,13 @@
-Comparison of power series uses list instead of padded_list; this means that power series equality can fail:
+Comparison of power series uses `list` instead of `padded_list`.  This drops trailing zeros, and means that power series equality is buggy:
 
 ```
 sage: A.<t> = PowerSeriesRing(ZZ)
 sage: g = t + t^3 + t^5 + O(t^6); g
 t + t^3 + t^5 + O(t^6)
-sage: [g == g.add_bigoh(i) for i in range(7)]
-[True, False, True, False, True, False, True]
-sage: g.add_bigoh(3).list()
+sage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True
+[True, False, True, False, True, False, True] 
+
+sage: g.add_bigoh(3).list()  # drops trailing zero
 [0, 1]
 sage: g.add_bigoh(3).padded_list()
 [0, 1, 0]
``````




---

archive/issue_comments_108242.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,6 +4,9 @@\n sage: A.<t> = PowerSeriesRing(ZZ)\n sage: g = t + t^3 + t^5 + O(t^6); g\n t + t^3 + t^5 + O(t^6)\n+sage: g == t + O(t^3)   # should be True\n+False\n+\n sage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True\n [True, False, True, False, True, False, True] \n \n@@ -13,8 +16,5 @@\n [0, 1, 0]\n ```\n \n-## Apply\n-\n-* [attachment:trac_9457_power_series_eq_rebase.patch]\n \n \n``````\n",
    "created_at": "2014-01-27T20:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108242",
    "user": "https://github.com/nilesjohnson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,6 +4,9 @@
 sage: A.<t> = PowerSeriesRing(ZZ)
 sage: g = t + t^3 + t^5 + O(t^6); g
 t + t^3 + t^5 + O(t^6)
+sage: g == t + O(t^3)   # should be True
+False
+
 sage: [g == g.add_bigoh(i) for i in range(7)]    # these should all be True
 [True, False, True, False, True, False, True] 
 
@@ -13,8 +16,5 @@
 [0, 1, 0]
 ```
 
-## Apply
-
-* [attachment:trac_9457_power_series_eq_rebase.patch]
 
 
``````




---

archive/issue_comments_108243.json:
```json
{
    "body": "Changing stopgaps from \"\" to \"#15748\"",
    "created_at": "2014-01-27T20:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108243",
    "user": "https://github.com/nilesjohnson"
}
```

Changing stopgaps from "" to "#15748"



---

archive/issue_comments_108244.json:
```json
{
    "body": "<a id='comment:25'></a>The problem with Sha.an_padic may also be related to the bug in extended gcd at #13439 or one of its dependencies.",
    "created_at": "2014-01-27T20:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108244",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:25'></a>The problem with Sha.an_padic may also be related to the bug in extended gcd at #13439 or one of its dependencies.



---

archive/issue_comments_108245.json:
```json
{
    "body": "<a id='comment:26'></a>Interesting. I just started to look at #4656 again this morning. And then I discovered this ticket. The problems there would get solved partially by this solution here and conversely, the problem there to fix it are with the supersingular case tested in this one case. Of course, I offer my help with this as I am at the origin of the code that causes troubles.",
    "created_at": "2014-01-29T21:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108245",
    "user": "https://github.com/categorie"
}
```

<a id='comment:26'></a>Interesting. I just started to look at #4656 again this morning. And then I discovered this ticket. The problems there would get solved partially by this solution here and conversely, the problem there to fix it are with the supersingular case tested in this one case. Of course, I offer my help with this as I am at the origin of the code that causes troubles.



---

archive/issue_comments_108246.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 wuthrich]:\n> Of course, I offer my help with this as I am at the origin of the code that causes troubles.\n\n\nThanks :)  The last real progress I made in understanding this is up in comments [comment:13] and [comment:14], where I worked through the offending doctest by hand -- see [the block starting on line 632](https://github.com/sagemath/sage/blob/master/src/sage/schemes/elliptic_curves/sha_tate.py#L632).  \n\nOne helpful thing would be to verify the calculations below:\n\nUsing the objects constructed in comment [comment:13], sage says\n\n```\nsage: G\nO(5^3) + (2*5^-1 + O(5^0))*T + O(T^2)\nsage: H\nO(T^2)\nsage: lpv\n(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))\nsage: eps.transpose()\n[  5/9 25/18]\n[-5/18   5/9]\n```\n\nI think that `H` is not correct, as it it built from the following list of coefficients\n\n```\nsage: [lps[n][1] for n in range(0,lps.prec())]\n[O(5^2), O(5^-1), O(5^-1), O(5^-1), O(5^-1)]\n```\n\nSo I think the correct value should be `H = O(5^2) + O(5^-1)*T + O(T^2)` and hence \n`-R(p) * H = O(5^3) + O(5^0)*T + O(T^2)`.  Converting `eps.transpose()` to the 5-adics `R`, so that I can check `lpv * eps.transpose()` by hand, I have\n\n```\nsage: Matrix(R,2,2,[R(_) for _ in eps.transpose().list()])\n[      4*5 + 2*5^2 + 5^4 + 2*5^5 + O(5^6)     2*5^2 + 5^3 + 3*5^5 + 3*5^6 + O(5^7)]\n[3*5 + 3*5^2 + 4*5^3 + 5^4 + 5^5 + O(5^6)       4*5 + 2*5^2 + 5^4 + 2*5^5 + O(5^6)]\n```\n\nTherefore `lpv * eps.transpose()` should be\n\n```\n( O(5^3) + (3 + O(5))*T + O(T^2) , O(5^4) + O(5^1)*T + O(T^2) )\n```\n\nCan you verify these calculations, and verify that if this were the output of `lpv*eps.transpose()`, then the rest of the code would work correctly and return `1`, as expected?  (I think I was confused about this last point when I made my comment [comment:14]; but this value for `lpv * eps.transpose()` should make `shan0 = 1` and `shan1 = 0`, and if I read the rest of that block correctly then this will lead to the expected output).\n\n\n---\n\nIf the analysis above is right, then the only problem remaining to solve is why `H` is not computed correctly.  The problem seems to be that the power series ring over p-adics does not keep track of negative precision when there are no non-zero coefficients:\n\n```\nsage: R(0).add_bigoh(-1)\nO(5^-1)\nsage: QpT(R(0).add_bigoh(-1))\n0   # should be same as line above\n\nsage: QpT(1/25 + R(0).add_bigoh(-1))\n5^-2 + O(5^-1)  # precision remembered when non-zero coefficients are present\n```\n\nI guess there is some problem with positive precision too:\n\n```\nsage: QpT(R(0).add_bigoh(1))\n0\nsage: QpT(1 + R(0).add_bigoh(1))\n1 + O(5)\n```\n\nIs this issue already part of one of the other padic bug tickets?",
    "created_at": "2014-01-30T19:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108246",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:27'></a>Replying to [comment:26 wuthrich]:
> Of course, I offer my help with this as I am at the origin of the code that causes troubles.


Thanks :)  The last real progress I made in understanding this is up in comments [comment:13] and [comment:14], where I worked through the offending doctest by hand -- see [the block starting on line 632](https://github.com/sagemath/sage/blob/master/src/sage/schemes/elliptic_curves/sha_tate.py#L632).  

One helpful thing would be to verify the calculations below:

Using the objects constructed in comment [comment:13], sage says

```
sage: G
O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2)
sage: H
O(T^2)
sage: lpv
(O(5^3) + (2*5^-1 + O(5^0))*T + O(T^2), O(T^2))
sage: eps.transpose()
[  5/9 25/18]
[-5/18   5/9]
```

I think that `H` is not correct, as it it built from the following list of coefficients

```
sage: [lps[n][1] for n in range(0,lps.prec())]
[O(5^2), O(5^-1), O(5^-1), O(5^-1), O(5^-1)]
```

So I think the correct value should be `H = O(5^2) + O(5^-1)*T + O(T^2)` and hence 
`-R(p) * H = O(5^3) + O(5^0)*T + O(T^2)`.  Converting `eps.transpose()` to the 5-adics `R`, so that I can check `lpv * eps.transpose()` by hand, I have

```
sage: Matrix(R,2,2,[R(_) for _ in eps.transpose().list()])
[      4*5 + 2*5^2 + 5^4 + 2*5^5 + O(5^6)     2*5^2 + 5^3 + 3*5^5 + 3*5^6 + O(5^7)]
[3*5 + 3*5^2 + 4*5^3 + 5^4 + 5^5 + O(5^6)       4*5 + 2*5^2 + 5^4 + 2*5^5 + O(5^6)]
```

Therefore `lpv * eps.transpose()` should be

```
( O(5^3) + (3 + O(5))*T + O(T^2) , O(5^4) + O(5^1)*T + O(T^2) )
```

Can you verify these calculations, and verify that if this were the output of `lpv*eps.transpose()`, then the rest of the code would work correctly and return `1`, as expected?  (I think I was confused about this last point when I made my comment [comment:14]; but this value for `lpv * eps.transpose()` should make `shan0 = 1` and `shan1 = 0`, and if I read the rest of that block correctly then this will lead to the expected output).


---

If the analysis above is right, then the only problem remaining to solve is why `H` is not computed correctly.  The problem seems to be that the power series ring over p-adics does not keep track of negative precision when there are no non-zero coefficients:

```
sage: R(0).add_bigoh(-1)
O(5^-1)
sage: QpT(R(0).add_bigoh(-1))
0   # should be same as line above

sage: QpT(1/25 + R(0).add_bigoh(-1))
5^-2 + O(5^-1)  # precision remembered when non-zero coefficients are present
```

I guess there is some problem with positive precision too:

```
sage: QpT(R(0).add_bigoh(1))
0
sage: QpT(1 + R(0).add_bigoh(1))
1 + O(5)
```

Is this issue already part of one of the other padic bug tickets?



---

archive/issue_events_023413.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23413"
}
```



---

archive/issue_events_023414.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23414"
}
```



---

archive/issue_comments_108247.json:
```json
{
    "body": "<a id='comment:29'></a>I try to remember what happened 4 years ago. I think I discovered exactly the same problem as you. First some bug, then fixing that gave an error for sha_tate in the supersingular case. This was due to the Dp_valued series return the wrong result. Chasing that I came to #8198, where I got stuck becasue (at the time) I did not know how I could fix that. \n\nSo let's make a list - as there are several overlapping tickets and issues:\n\n* (see #4656) is_zero is broken for power series. This causes your `QpT( O(5^-1))` to print as zero. It remembers that it is not, if you have .list you see its first coefficient is still `O(5^-1)`. We should change `__nonzero__` in power_series_poly.pyx\n\n* (see #4656, too) power series compare wrongly. Your suggestion to use padded_list above is better than what I tried to do in the other ticket. That is cmp in power_series_ring_element.pyx\n\n* (see #4656) power series also print wrongly. You would expect the inexact coefficients of the form `O(p^2)` to print, too. I tried to change that in the other ticket. That is `_repr_` in power_series_ring_element.pyx\n\n* (see #8198) Matrix multiplication on p-adics looses precision. I believe that is the heart of the problem for getting the right answer for this Dp_series. If I understand correctly you have spotted the same thing above.\n\n* There is also #5075 which I have never looked at myself.\n\nWe could take the out the doc-string in sha-tate out for now, so that this and #4656 can be closed. Then reintroduce it if we can fix #8198.",
    "created_at": "2014-02-02T14:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108247",
    "user": "https://github.com/categorie"
}
```

<a id='comment:29'></a>I try to remember what happened 4 years ago. I think I discovered exactly the same problem as you. First some bug, then fixing that gave an error for sha_tate in the supersingular case. This was due to the Dp_valued series return the wrong result. Chasing that I came to #8198, where I got stuck becasue (at the time) I did not know how I could fix that. 

So let's make a list - as there are several overlapping tickets and issues:

* (see #4656) is_zero is broken for power series. This causes your `QpT( O(5^-1))` to print as zero. It remembers that it is not, if you have .list you see its first coefficient is still `O(5^-1)`. We should change `__nonzero__` in power_series_poly.pyx

* (see #4656, too) power series compare wrongly. Your suggestion to use padded_list above is better than what I tried to do in the other ticket. That is cmp in power_series_ring_element.pyx

* (see #4656) power series also print wrongly. You would expect the inexact coefficients of the form `O(p^2)` to print, too. I tried to change that in the other ticket. That is `_repr_` in power_series_ring_element.pyx

* (see #8198) Matrix multiplication on p-adics looses precision. I believe that is the heart of the problem for getting the right answer for this Dp_series. If I understand correctly you have spotted the same thing above.

* There is also #5075 which I have never looked at myself.

We could take the out the doc-string in sha-tate out for now, so that this and #4656 can be closed. Then reintroduce it if we can fix #8198.



---

archive/issue_comments_108248.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 wuthrich]:\n\n> I try to remember what happened 4 years ago. \n\n\nThanks for putting this together :)\n\n> \n> So let's make a list - as there are several overlapping tickets and issues:\n> \n> * (see #4656) is_zero is broken for power series. This causes your `QpT( O(5^-1))` to print as zero. It remembers that it is not, if you have .list you see its first coefficient is still `O(5^-1)`. We should change `__nonzero__` in power_series_poly.pyx\n> \n\n\n#5075 addresses this too -- the patch there introduces 3 concepts of zero: exact zero (infinite precision), maximally zero (zero to maximal precision allowed by parent ring), and inexact zero (zero to precision less than maximal precision).  These are used to define some functions that are equal to degree for polynomials over exact rings, but more subtle over inexact rings, and these functions, in turn, are used to fix other functions . . . \n\nIn short, that ticket seems to me like a good place to start.\n\n> * (see #4656, too) power series compare wrongly. Your suggestion to use padded_list above is better than what I tried to do in the other ticket. That is cmp in power_series_ring_element.pyx\n\n\n`padded_list` works, but is substantially slower.  In the latest commit here, I have a more direct fix.  The patch at #5075 also has a fix that looks similar to mine, but I didn't compare them closely.\n\n> \n> * (see #4656) power series also print wrongly. You would expect the inexact coefficients of the form `O(p^2)` to print, too. I tried to change that in the other ticket. That is `_repr_` in power_series_ring_element.pyx\n> \n\n\n#5075 may address this too, at least judging by how some of the new doctests appear.\n\n> * (see #8198) Matrix multiplication on p-adics looses precision. I believe that is the heart of the problem for getting the right answer for this Dp_series. If I understand correctly you have spotted the same thing above.\n\n\nThis might be right . . . in my calculation above, the input to the vector*matrix multiplication is wrong, so I can't tell whether the matrix multiplication would also go wrong or not.\n\n> \n> * There is also #5075 which I have never looked at myself.\n\n\nI think we should go there :)\n\n> \n> We could take the out the doc-string in sha-tate out for now, so that this and #4656 can be closed. Then reintroduce it if we can fix #8198.\n\n\nHmmm . . . that doctest is holding up some pretty reasonable fixes, but it's also the only reason that we noticed these padic problems in the first place so I'm extremely reluctant to take it out.  I think it is especially bad to take it out before we fully understand where the problems are coming from.",
    "created_at": "2014-02-03T13:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108248",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:30'></a>Replying to [comment:29 wuthrich]:

> I try to remember what happened 4 years ago. 


Thanks for putting this together :)

> 
> So let's make a list - as there are several overlapping tickets and issues:
> 
> * (see #4656) is_zero is broken for power series. This causes your `QpT( O(5^-1))` to print as zero. It remembers that it is not, if you have .list you see its first coefficient is still `O(5^-1)`. We should change `__nonzero__` in power_series_poly.pyx
> 


#5075 addresses this too -- the patch there introduces 3 concepts of zero: exact zero (infinite precision), maximally zero (zero to maximal precision allowed by parent ring), and inexact zero (zero to precision less than maximal precision).  These are used to define some functions that are equal to degree for polynomials over exact rings, but more subtle over inexact rings, and these functions, in turn, are used to fix other functions . . . 

In short, that ticket seems to me like a good place to start.

> * (see #4656, too) power series compare wrongly. Your suggestion to use padded_list above is better than what I tried to do in the other ticket. That is cmp in power_series_ring_element.pyx


`padded_list` works, but is substantially slower.  In the latest commit here, I have a more direct fix.  The patch at #5075 also has a fix that looks similar to mine, but I didn't compare them closely.

> 
> * (see #4656) power series also print wrongly. You would expect the inexact coefficients of the form `O(p^2)` to print, too. I tried to change that in the other ticket. That is `_repr_` in power_series_ring_element.pyx
> 


#5075 may address this too, at least judging by how some of the new doctests appear.

> * (see #8198) Matrix multiplication on p-adics looses precision. I believe that is the heart of the problem for getting the right answer for this Dp_series. If I understand correctly you have spotted the same thing above.


This might be right . . . in my calculation above, the input to the vector*matrix multiplication is wrong, so I can't tell whether the matrix multiplication would also go wrong or not.

> 
> * There is also #5075 which I have never looked at myself.


I think we should go there :)

> 
> We could take the out the doc-string in sha-tate out for now, so that this and #4656 can be closed. Then reintroduce it if we can fix #8198.


Hmmm . . . that doctest is holding up some pretty reasonable fixes, but it's also the only reason that we noticed these padic problems in the first place so I'm extremely reluctant to take it out.  I think it is especially bad to take it out before we fully understand where the problems are coming from.



---

archive/issue_comments_108249.json:
```json
{
    "body": "<a id='comment:32'></a>The only thing I see when I click on the green \" u/niles/ticket/9457 \" link in the branch field is a deletion of a file. What the hell, trac?",
    "created_at": "2014-03-01T03:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108249",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:32'></a>The only thing I see when I click on the green " u/niles/ticket/9457 " link in the branch field is a deletion of a file. What the hell, trac?



---

archive/issue_comments_108250.json:
```json
{
    "body": "<a id='comment:33'></a>The first commit in comment:21 shows `Bad object id: 83d1220`.",
    "created_at": "2014-03-01T09:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108250",
    "user": "https://github.com/rwst"
}
```

<a id='comment:33'></a>The first commit in comment:21 shows `Bad object id: 83d1220`.



---

archive/issue_comments_108251.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 rws]:\n> The first commit in comment:21 shows `Bad object id: 83d1220`.\n\n\n\nWeird; The commit linked by trac seems wrong, although the \"Commit\" field is correct.  The branch should point to [e2219602...](http://git.sagemath.org/sage.git/diff/?id=e2219602a9d360f465ad79b098e4f923765ab791).  Here are some other links you can look at, which seem to have the branch pointing at the correct commit:\n\n* [log graph with u/niles/ticket/9457 at the top](http://git.sagemath.org/sage.git/log/?h=u/niles/ticket/9457)\n* [commit labeled u/niles/ticket/9457](http://git.sagemath.org/sage.git/commit/?h=u/niles/ticket/9457)\n\nI think the changes listed in comment [comment:21] came from trying to merge some other ticket branches with this one, which I think I should not have done.  Or rather, I should not have deleted that branch and replaced it with a new one having the same name -- that's probably causing confusion for trac.\n\nCommit [e2219602...](http://git.sagemath.org/sage.git/diff/?id=e2219602a9d360f465ad79b098e4f923765ab791) makes just the changes necessary for fixing this ticket, so that's the correct starting point.  Later today I'll make a new branch pointing to it and fix the trac branch field.",
    "created_at": "2014-03-01T12:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108251",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:34'></a>Replying to [comment:33 rws]:
> The first commit in comment:21 shows `Bad object id: 83d1220`.



Weird; The commit linked by trac seems wrong, although the "Commit" field is correct.  The branch should point to [e2219602...](http://git.sagemath.org/sage.git/diff/?id=e2219602a9d360f465ad79b098e4f923765ab791).  Here are some other links you can look at, which seem to have the branch pointing at the correct commit:

* [log graph with u/niles/ticket/9457 at the top](http://git.sagemath.org/sage.git/log/?h=u/niles/ticket/9457)
* [commit labeled u/niles/ticket/9457](http://git.sagemath.org/sage.git/commit/?h=u/niles/ticket/9457)

I think the changes listed in comment [comment:21] came from trying to merge some other ticket branches with this one, which I think I should not have done.  Or rather, I should not have deleted that branch and replaced it with a new one having the same name -- that's probably causing confusion for trac.

Commit [e2219602...](http://git.sagemath.org/sage.git/diff/?id=e2219602a9d360f465ad79b098e4f923765ab791) makes just the changes necessary for fixing this ticket, so that's the correct starting point.  Later today I'll make a new branch pointing to it and fix the trac branch field.



---

archive/issue_comments_108252.json:
```json
{
    "body": "Changing branch from \"u/niles/ticket/9457\" to \"u/niles/ticket/9457.2\"",
    "created_at": "2014-03-02T01:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108252",
    "user": "https://github.com/nilesjohnson"
}
```

Changing branch from "u/niles/ticket/9457" to "u/niles/ticket/9457.2"



---

archive/issue_comments_108253.json:
```json
{
    "body": "<a id='comment:35'></a>rebased to 6.2.beta2 and put changes on a completely new branch: u/niles/ticket/9457.2\n\n---\nNew commits:",
    "created_at": "2014-03-02T01:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108253",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:35'></a>rebased to 6.2.beta2 and put changes on a completely new branch: u/niles/ticket/9457.2

---
New commits:



---

archive/issue_comments_108254.json:
```json
{
    "body": "Changing commit from \"e2219602a9d360f465ad79b098e4f923765ab791\" to \"4329b79d433f2bc1658df01bba9d53f2e467bf86\"",
    "created_at": "2014-03-02T01:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108254",
    "user": "https://github.com/nilesjohnson"
}
```

Changing commit from "e2219602a9d360f465ad79b098e4f923765ab791" to "4329b79d433f2bc1658df01bba9d53f2e467bf86"



---

archive/issue_comments_108255.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#8198\"",
    "created_at": "2014-04-11T19:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108255",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#8198"



---

archive/issue_comments_108256.json:
```json
{
    "body": "<a id='comment:36'></a>The doctest failure in `sha_tate.py` disappears when testing this ticket together with #8198.  Is this the only thing keeping this ticket from being ready to be reviewed?",
    "created_at": "2014-04-11T19:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108256",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:36'></a>The doctest failure in `sha_tate.py` disappears when testing this ticket together with #8198.  Is this the only thing keeping this ticket from being ready to be reviewed?



---

archive/issue_comments_108257.json:
```json
{
    "body": "<a id='comment:37'></a>Yes, that is mine now. That may take me soem time to fix. This is really a new bug, which was not apparent with the bug fixed here. So my suggestion would be to comment out the failing test, to open a new ticket and to fix the new bug in a separate ticket as they are unrelated topics. Though I am not sure that is the way we should do it.\n\nIn any case, I start looking into the issue.",
    "created_at": "2014-04-12T19:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108257",
    "user": "https://github.com/categorie"
}
```

<a id='comment:37'></a>Yes, that is mine now. That may take me soem time to fix. This is really a new bug, which was not apparent with the bug fixed here. So my suggestion would be to comment out the failing test, to open a new ticket and to fix the new bug in a separate ticket as they are unrelated topics. Though I am not sure that is the way we should do it.

In any case, I start looking into the issue.



---

archive/issue_comments_108258.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 wuthrich]:\n> Yes, that is mine now. That may take me soem time to fix. This is really a new bug, which was not apparent with the bug fixed here.\n\nI'm not sure you interpreted my comment correctly.  I meant I merged #8198 and the branch for this, ran `make ptestlong`, and got NO doctest failures; I hope I made no mistakes there.  I.e. if that (former, after #8198) doctest failure in `sha_tate.py` was the only problem with this ticket, then there should be nothing stopping us from positively reviewing this one.",
    "created_at": "2014-04-12T19:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108258",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:38'></a>Replying to [comment:37 wuthrich]:
> Yes, that is mine now. That may take me soem time to fix. This is really a new bug, which was not apparent with the bug fixed here.

I'm not sure you interpreted my comment correctly.  I meant I merged #8198 and the branch for this, ran `make ptestlong`, and got NO doctest failures; I hope I made no mistakes there.  I.e. if that (former, after #8198) doctest failure in `sha_tate.py` was the only problem with this ticket, then there should be nothing stopping us from positively reviewing this one.



---

archive/issue_comments_108259.json:
```json
{
    "body": "<a id='comment:39'></a>Oh, I see. If so, we should change the branch on this one by merging #8198 into it, I think. Then a reviewer (e.g. me or you since you have done the work already) can give it a positive review.",
    "created_at": "2014-04-12T20:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108259",
    "user": "https://github.com/categorie"
}
```

<a id='comment:39'></a>Oh, I see. If so, we should change the branch on this one by merging #8198 into it, I think. Then a reviewer (e.g. me or you since you have done the work already) can give it a positive review.



---

archive/issue_comments_108260.json:
```json
{
    "body": "<a id='comment:40'></a>OK, I'll do that and also add a reviewer patch to remove the stopgap that was made for this ticket.\n\nI also thought of replacing the use of `list()` by `padded_list()` as the stopgap warning suggests, but judging from some small experiments that seems to be much slower.",
    "created_at": "2014-04-12T20:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108260",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:40'></a>OK, I'll do that and also add a reviewer patch to remove the stopgap that was made for this ticket.

I also thought of replacing the use of `list()` by `padded_list()` as the stopgap warning suggests, but judging from some small experiments that seems to be much slower.



---

archive/issue_comments_108261.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108261",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_108262.json:
```json
{
    "body": "Changing author from \"niles\" to \"Niles Johnson\"",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108262",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "niles" to "Niles Johnson"



---

archive/issue_comments_108263.json:
```json
{
    "body": "Changing branch from \"u/niles/ticket/9457.2\" to \"u/pbruin/9457-power_series_comparison\"",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108263",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "u/niles/ticket/9457.2" to "u/pbruin/9457-power_series_comparison"



---

archive/issue_comments_108264.json:
```json
{
    "body": "Changing work_issues from \"resolve problems with sha_tate.py\" to \"\"",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108264",
    "user": "https://github.com/pjbruin"
}
```

Changing work_issues from "resolve problems with sha_tate.py" to ""



---

archive/issue_comments_108265.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108265",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_comments_108266.json:
```json
{
    "body": "<a id='comment:41'></a>OK, all tests still pass. 8-)  Just a reviewer patch, as promised.  I mostly edited the documentation a bit more to also mention the idea that comparing to the minimum of the two precisions is consistent with coercing the elements to a common parent.",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108266",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:41'></a>OK, all tests still pass. 8-)  Just a reviewer patch, as promised.  I mostly edited the documentation a bit more to also mention the idea that comparing to the minimum of the two precisions is consistent with coercing the elements to a common parent.



---

archive/issue_comments_108267.json:
```json
{
    "body": "Changing commit from \"4329b79d433f2bc1658df01bba9d53f2e467bf86\" to \"9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1\"",
    "created_at": "2014-04-13T00:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108267",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "4329b79d433f2bc1658df01bba9d53f2e467bf86" to "9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1"



---

archive/issue_comments_108268.json:
```json
{
    "body": "<a id='comment:42'></a>This is fantastic!!  Thanks for seeing it through :)\n\n`padded_list` is indeed slower -- I just suggested it as a simple workaround for the stopgap warning.\n\nThe confounding doctest seems to be behaving correctly now -- the intermediate steps are consistent with my calculations by hand above, and the verbose output is as expected (given that there are still other problems with padics):\n\n```\nsage: EllipticCurve('53a1').sha().an_padic(5)\n...\nverbose 1 (431: sha_tate.py, an_padic) ...computing the p-adic L-series\nverbose 1 (1059: padic_lseries.py, series) using p-adic precision of 4\nverbose 1 (1059: padic_lseries.py, series) Now iterating over 100 summands\nverbose 1 (431: sha_tate.py, an_padic) the leading terms : [0, 0]\nverbose 1 (431: sha_tate.py, an_padic) increased precision to 4\nverbose 1 (1059: padic_lseries.py, series) using p-adic precision of 5\nverbose 1 (1059: padic_lseries.py, series) Now iterating over 500 summands\nverbose 1 (431: sha_tate.py, an_padic) the leading terms : [3 + O(5), 0]\nverbose 1 (431: sha_tate.py, an_padic) ...putting things together\nverbose 1 (431: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 0]\n1 + O(5)\n```",
    "created_at": "2014-04-14T16:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108268",
    "user": "https://github.com/nilesjohnson"
}
```

<a id='comment:42'></a>This is fantastic!!  Thanks for seeing it through :)

`padded_list` is indeed slower -- I just suggested it as a simple workaround for the stopgap warning.

The confounding doctest seems to be behaving correctly now -- the intermediate steps are consistent with my calculations by hand above, and the verbose output is as expected (given that there are still other problems with padics):

```
sage: EllipticCurve('53a1').sha().an_padic(5)
...
verbose 1 (431: sha_tate.py, an_padic) ...computing the p-adic L-series
verbose 1 (1059: padic_lseries.py, series) using p-adic precision of 4
verbose 1 (1059: padic_lseries.py, series) Now iterating over 100 summands
verbose 1 (431: sha_tate.py, an_padic) the leading terms : [0, 0]
verbose 1 (431: sha_tate.py, an_padic) increased precision to 4
verbose 1 (1059: padic_lseries.py, series) using p-adic precision of 5
verbose 1 (1059: padic_lseries.py, series) Now iterating over 500 summands
verbose 1 (431: sha_tate.py, an_padic) the leading terms : [3 + O(5), 0]
verbose 1 (431: sha_tate.py, an_padic) ...putting things together
verbose 1 (431: sha_tate.py, an_padic) the two values for Sha : [1 + O(5), 0]
1 + O(5)
```



---

archive/issue_comments_108269.json:
```json
{
    "body": "Changing branch from \"u/pbruin/9457-power_series_comparison\" to \"9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1\"",
    "created_at": "2014-04-14T16:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108269",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/9457-power_series_comparison" to "9c0b17f8ca77ce881b7b96a7a2b06ef8b856a0d1"



---

archive/issue_comments_108270.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-14T16:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9457#issuecomment-108270",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_023415.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-14T16:55:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9457",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9457#event-23415"
}
```
