# Issue 9822: Sage only examines the last cookie for a username

archive/issues_009821.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "c.f. http://groups.google.com/group/sage-support/msg/2fd79e5ccfceb728 and http://groups.google.com/group/sage-support/msg/10a3d906b6a0e675\n\nCC:  @jasongrout @kcrisman @qed777 @boothby\n\nComponent: **notebook**\n\nAuthor: **Jason Grout**\n\nReviewer: **Tim Dumol**\n\nMerged: **sagenb-0.8.3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9822_\n\n",
    "closed_at": "2010-10-04T01:34:54Z",
    "created_at": "2010-08-27T15:29:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Sage only examines the last cookie for a username",
    "type": "issue",
    "updated_at": "2010-10-04T01:34:54Z",
    "url": "https://github.com/sagemath/sage/issues/9822",
    "user": "https://github.com/TimDumol"
}
```
c.f. http://groups.google.com/group/sage-support/msg/2fd79e5ccfceb728 and http://groups.google.com/group/sage-support/msg/10a3d906b6a0e675

CC:  @jasongrout @kcrisman @qed777 @boothby

Component: **notebook**

Author: **Jason Grout**

Reviewer: **Tim Dumol**

Merged: **sagenb-0.8.3**

_Issue created by migration from https://trac.sagemath.org/ticket/9822_





---

archive/issue_events_126238.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126238"
}
```



---

archive/issue_events_126239.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "0000b0",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126239"
}
```



---

archive/issue_events_126240.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126240"
}
```



---

archive/issue_events_126241.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126241"
}
```



---

archive/issue_events_126242.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "subject": "https://github.com/TimDumol",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126242"
}
```



---

archive/issue_events_126243.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-08-27T15:29:01Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "subject": "https://github.com/TimDumol",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126243"
}
```



---

archive/issue_comments_087606.json:
```json
{
    "body": "Attachment: **[trac_9822-cookie-path-fix.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-path-fix.patch.gz)**\n\nSageNB. Attempted fix for Safari (setting cookie path to '/')",
    "created_at": "2010-08-27T15:30:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87606",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_9822-cookie-path-fix.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-path-fix.patch.gz)**

SageNB. Attempted fix for Safari (setting cookie path to '/')



---

archive/issue_events_126244.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-08-27T15:32:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126244"
}
```



---

archive/issue_comments_087607.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI have no Safari (on Linux), so it would be helpful if someone with Safari could test if this fixes the issue.",
    "created_at": "2010-08-27T15:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87607",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:1" align="right">comment:1</div>

I have no Safari (on Linux), so it would be helpful if someone with Safari could test if this fixes the issue.



---

archive/issue_comments_087608.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'd like to test it, but have no way to apply it to a server where this is a problem for me :(",
    "created_at": "2010-08-27T17:41:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87608",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

I'd like to test it, but have no way to apply it to a server where this is a problem for me :(



---

archive/issue_comments_087609.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'll test it.  I had 3-4 students today who complained about the issue.",
    "created_at": "2010-08-27T18:09:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87609",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

I'll test it.  I had 3-4 students today who complained about the issue.



---

archive/issue_comments_087610.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nLet me say again that it would be *really* nice if the sagenb repository was located somewhere in the sage repository, so that it was easy to apply patches and make fixes (without having to hunt down the spkg, read the instructions again, untar it, etc).  Maybe the sage spkg could by default do the equivalent of extracting in sage/devel/sagenb/ and doing the developer install (so the source and repository would be in sage/devel/sagenb/",
    "created_at": "2010-08-27T18:17:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87610",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

Let me say again that it would be *really* nice if the sagenb repository was located somewhere in the sage repository, so that it was easy to apply patches and make fixes (without having to hunt down the spkg, read the instructions again, untar it, etc).  Maybe the sage spkg could by default do the equivalent of extracting in sage/devel/sagenb/ and doing the developer install (so the source and repository would be in sage/devel/sagenb/



---

archive/issue_comments_087611.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks for testing!  I hope to start using it a little on the side next week.\n> Let me say again that it would be *really* nice if the sagenb repository was located somewhere in the sage repository, so that it was easy to apply patches and make fixes (without having to hunt down the spkg, read the instructions again, untar it, etc).  Maybe the sage spkg could by default do the equivalent of extracting in sage/devel/sagenb/ and doing the developer install (so the source and repository would be in sage/devel/sagenb/\n\nI have asked about this a lot too, though of course I also haven't stepped up and tried to figure out how to use python setup or whatever to create `hg_sagenb` or something.  Same with Pynac - it's just dumb that these things which (currently) are only used in Sage can't be easily modified.",
    "created_at": "2010-08-28T00:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87611",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks for testing!  I hope to start using it a little on the side next week.
> Let me say again that it would be *really* nice if the sagenb repository was located somewhere in the sage repository, so that it was easy to apply patches and make fixes (without having to hunt down the spkg, read the instructions again, untar it, etc).  Maybe the sage spkg could by default do the equivalent of extracting in sage/devel/sagenb/ and doing the developer install (so the source and repository would be in sage/devel/sagenb/

I have asked about this a lot too, though of course I also haven't stepped up and tried to figure out how to use python setup or whatever to create `hg_sagenb` or something.  Same with Pynac - it's just dumb that these things which (currently) are only used in Sage can't be easily modified.



---

archive/issue_comments_087612.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nJason Grout has [posted a fix on sage-notebook](http://groups.google.com/group/sage-notebook/browse_thread/thread/dbe2e0a64e9ccc38).",
    "created_at": "2010-09-01T23:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87612",
    "user": "https://github.com/qed777"
}
```

<div id="comment:6" align="right">comment:6</div>

Jason Grout has [posted a fix on sage-notebook](http://groups.google.com/group/sage-notebook/browse_thread/thread/dbe2e0a64e9ccc38).



---

archive/issue_comments_087613.json:
```json
{
    "body": "Replaces all others. Includes Jason Grout's fix ( http://groups.google.com/group/sage-notebook/browse_thread/thread/dbe2e0a64e9ccc38).",
    "created_at": "2010-09-10T04:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87613",
    "user": "https://github.com/TimDumol"
}
```

Replaces all others. Includes Jason Grout's fix ( http://groups.google.com/group/sage-notebook/browse_thread/thread/dbe2e0a64e9ccc38).



---

archive/issue_comments_087614.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_9822-cookie-fix.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.patch.gz)**",
    "created_at": "2010-09-10T04:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87614",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_9822-cookie-fix.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.patch.gz)**



---

archive/issue_comments_087615.json:
```json
{
    "body": "Author: **Jason Grout, Tim Dumol**",
    "created_at": "2010-09-10T04:20:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87615",
    "user": "https://github.com/TimDumol"
}
```

Author: **Jason Grout, Tim Dumol**



---

archive/issue_comments_087616.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSetting the port for the cookie worries me.  How does that play with using a proxy server (where Sage thinks it is running on a certain port, like 8000, but the web browser thinks it is running on port 80)?",
    "created_at": "2010-09-10T04:30:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87616",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:8" align="right">comment:8</div>

Setting the port for the cookie worries me.  How does that play with using a proxy server (where Sage thinks it is running on a certain port, like 8000, but the web browser thinks it is running on port 80)?



---

archive/issue_comments_087617.json:
```json
{
    "body": "Gets the port number from the HTTP header instead (this fixes the issue given by Jason)",
    "created_at": "2010-09-10T04:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87617",
    "user": "https://github.com/TimDumol"
}
```

Gets the port number from the HTTP header instead (this fixes the issue given by Jason)



---

archive/issue_comments_087618.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_9822-cookie-fix.2.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.2.patch.gz)**\n\nReplying to [@jasongrout](#comment:8):\n> Setting the port for the cookie worries me.  How does that play with using a proxy server (where Sage thinks it is running on a certain port, like 8000, but the web browser thinks it is running on port 80)?\n\nGood point. I've added a new patch that fixes that issue.",
    "created_at": "2010-09-10T04:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87618",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_9822-cookie-fix.2.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.2.patch.gz)**

Replying to [@jasongrout](#comment:8):
> Setting the port for the cookie worries me.  How does that play with using a proxy server (where Sage thinks it is running on a certain port, like 8000, but the web browser thinks it is running on port 80)?

Good point. I've added a new patch that fixes that issue.



---

archive/issue_comments_087619.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat if the connection is over https?  Can you assume that if you don't see a port number, then the port number is 80?  Why can't we just not set the port number (like before)?  (Disclaimer: I don't know much about this, so if someone that does thinks everything is all right, well, okay).\n\nAlso, I notice you use hasHeader.  Should my part of the patch be changed to have:\n\n```\nif request.headers.hasHeader('cookie'):\n```",
    "created_at": "2010-09-10T06:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87619",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">comment:10</div>

What if the connection is over https?  Can you assume that if you don't see a port number, then the port number is 80?  Why can't we just not set the port number (like before)?  (Disclaimer: I don't know much about this, so if someone that does thinks everything is all right, well, okay).

Also, I notice you use hasHeader.  Should my part of the patch be changed to have:

```
if request.headers.hasHeader('cookie'):
```



---

archive/issue_comments_087620.json:
```json
{
    "body": "Attachment: **[trac_9822-cookie-fix.3.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.3.patch.gz)**\n\nMakes the default port 443 if the connection is HTTPS.",
    "created_at": "2010-09-10T10:49:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87620",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_9822-cookie-fix.3.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.3.patch.gz)**

Makes the default port 443 if the connection is HTTPS.



---

archive/issue_comments_087621.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIt is insecure to let any site under the domain to access the cookie (cross-site scripting). I've made the port 443 if the notebook is secure. It also poses a problem if (in the admittedly rare case) the user decides to forward several ports to one notebook server.\n\n`getHeader()` returns None if the header is not found, so it works either way.",
    "created_at": "2010-09-10T10:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87621",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:11" align="right">comment:11</div>

It is insecure to let any site under the domain to access the cookie (cross-site scripting). I've made the port 443 if the notebook is secure. It also poses a problem if (in the admittedly rare case) the user decides to forward several ports to one notebook server.

`getHeader()` returns None if the header is not found, so it works either way.



---

archive/issue_comments_087622.json:
```json
{
    "body": "Attachment: **[trac_9822-cookie-fix.4.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.4.patch.gz)**\n\nFixes a bug.",
    "created_at": "2010-09-16T17:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87622",
    "user": "https://github.com/TimDumol"
}
```

Attachment: **[trac_9822-cookie-fix.4.patch.gz](https://github.com/sagemath/sage/files/ticket9822/trac_9822-cookie-fix.4.patch.gz)**

Fixes a bug.



---

archive/issue_comments_087623.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nBug fixed in latest patch.",
    "created_at": "2010-09-16T17:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87623",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:12" align="right">comment:12</div>

Bug fixed in latest patch.



---

archive/issue_events_126245.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-28T20:44:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126245"
}
```



---

archive/issue_events_126246.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-28T20:44:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126246"
}
```



---

archive/issue_comments_087624.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe cookie issue preventing logins makes this critical, I think.  I'm confident about that part of this patch.  I'm not confident about the other stuff done on cookies in this patch (just because I'm not familiar with them very much anymore).\n\nMitesh or Tom: you are some of the resident web experts.  Can you look at this patch?",
    "created_at": "2010-09-28T20:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87624",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:13" align="right">comment:13</div>

The cookie issue preventing logins makes this critical, I think.  I'm confident about that part of this patch.  I'm not confident about the other stuff done on cookies in this patch (just because I'm not familiar with them very much anymore).

Mitesh or Tom: you are some of the resident web experts.  Can you look at this patch?



---

archive/issue_comments_087625.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI installed this on my server (4.5.2) where I have apache forwarding port 80 (outside) to port 8000 (the local sage server).  On logging in, I get a browser message: \"Please enable cookies or delete all Sage cookies and localhost cookies in your browser and try again.\"  In Firebug, I see I have two cookies: cookie_test_80, and nb_session_8000.  That looks wrong, doesn't it?\n\nWhen I delete all of my cookies from that server, I still can't log in (same error).  After the error page comes up, and I click \"Continue\", I see the cookie_test_80 cookie show up in FireCookies.\n\nCan we split this ticket into two tickets?  A very high priority one that fixes the bug I found (my fix has been working for the past couple of months for me), and another ticket which takes care of the other issues?  That way the checking-only-last-cookie error can be taken care of right away.",
    "created_at": "2010-09-28T22:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87625",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:14" align="right">comment:14</div>

I installed this on my server (4.5.2) where I have apache forwarding port 80 (outside) to port 8000 (the local sage server).  On logging in, I get a browser message: "Please enable cookies or delete all Sage cookies and localhost cookies in your browser and try again."  In Firebug, I see I have two cookies: cookie_test_80, and nb_session_8000.  That looks wrong, doesn't it?

When I delete all of my cookies from that server, I still can't log in (same error).  After the error page comes up, and I click "Continue", I see the cookie_test_80 cookie show up in FireCookies.

Can we split this ticket into two tickets?  A very high priority one that fixes the bug I found (my fix has been working for the past couple of months for me), and another ticket which takes care of the other issues?  That way the checking-only-last-cookie error can be taken care of right away.



---

archive/issue_events_126247.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-28T22:42:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126247"
}
```



---

archive/issue_events_126248.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-28T22:42:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126248"
}
```



---

archive/issue_comments_087626.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWith just my part of the patch, I see a cookie_test_8000 and a nb_session_8000 cookie.  So apparently the problem is that after the patch above, we have a cookie_test_80 cookie.",
    "created_at": "2010-09-28T22:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87626",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:15" align="right">comment:15</div>

With just my part of the patch, I see a cookie_test_8000 and a nb_session_8000 cookie.  So apparently the problem is that after the patch above, we have a cookie_test_80 cookie.



---

archive/issue_comments_087627.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> Can we split this ticket into two tickets?  A very high priority one that fixes the bug I found (my fix has been working for the past couple of months for me), and another ticket which takes care of the other issues?  That way the checking-only-last-cookie error can be taken care of right away.\n\nYes, please!  I've been avoiding using Sage this semester (other than for me personally) some because the cookie issue just seems to have gotten worse...",
    "created_at": "2010-09-29T00:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87627",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">comment:16</div>

> Can we split this ticket into two tickets?  A very high priority one that fixes the bug I found (my fix has been working for the past couple of months for me), and another ticket which takes care of the other issues?  That way the checking-only-last-cookie error can be taken care of right away.

Yes, please!  I've been avoiding using Sage this semester (other than for me personally) some because the cookie issue just seems to have gotten worse...



---

archive/issue_comments_087628.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI've split Tim's changes to cookies out to #10029, since they don't seem to be quite ready yet.",
    "created_at": "2010-09-29T01:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87628",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:17" align="right">comment:17</div>

I've split Tim's changes to cookies out to #10029, since they don't seem to be quite ready yet.



---

archive/issue_comments_087629.json:
```json
{
    "body": "Attachment: **[9822-multiple-cookies.patch.gz](https://github.com/sagemath/sage/files/ticket9822/9822-multiple-cookies.patch.gz)**\n\napply instead of previous patches",
    "created_at": "2010-09-29T01:06:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87629",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[9822-multiple-cookies.patch.gz](https://github.com/sagemath/sage/files/ticket9822/9822-multiple-cookies.patch.gz)**

apply instead of previous patches



---

archive/issue_comments_087630.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nApply only 9822-multiple-cookies.patch.  The rest of the work on this ticket has been moved to #10029.",
    "created_at": "2010-09-29T01:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87630",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:18" align="right">comment:18</div>

Apply only 9822-multiple-cookies.patch.  The rest of the work on this ticket has been moved to #10029.



---

archive/issue_events_126249.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-29T01:06:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126249"
}
```



---

archive/issue_events_126250.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-29T01:06:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126250"
}
```



---

archive/issue_comments_087631.json:
```json
{
    "body": "Changed author from **Jason Grout, Tim Dumol** to **Jason Grout**",
    "created_at": "2010-09-29T01:07:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87631",
    "user": "https://github.com/jasongrout"
}
```

Changed author from **Jason Grout, Tim Dumol** to **Jason Grout**



---

archive/issue_events_126251.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-09-29T01:14:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "title_is": "Sage only examines the last cookie for a username",
    "title_was": "Cookies are still causing problems in SageNB (Safari)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126251"
}
```



---

archive/issue_comments_087632.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think we should get this and the currently positively reviewed SageNB tickets at {32} into a new SageNB 0.8.3.\n\nBut I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.",
    "created_at": "2010-09-29T11:09:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87632",
    "user": "https://github.com/qed777"
}
```

<div id="comment:21" align="right">comment:21</div>

I think we should get this and the currently positively reviewed SageNB tickets at {32} into a new SageNB 0.8.3.

But I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.



---

archive/issue_comments_087633.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> But I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.\n\nNot to reopen the whole numbering issue, but it seems weird that major upgrades to big pieces of Sage would be 4.6.1 - and possibly wait weeks.  Is it possible to keep the 4.6 cycle going, or would it make more sense to wait on all these?  I realize you're doing the work - just a query.  (Partly this is the fear that 4.6.1 might not happen for a while, since I expect you to take a break after this release! You certainly deserve it.)",
    "created_at": "2010-09-29T12:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87633",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">comment:22</div>

> But I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.

Not to reopen the whole numbering issue, but it seems weird that major upgrades to big pieces of Sage would be 4.6.1 - and possibly wait weeks.  Is it possible to keep the 4.6 cycle going, or would it make more sense to wait on all these?  I realize you're doing the work - just a query.  (Partly this is the fear that 4.6.1 might not happen for a while, since I expect you to take a break after this release! You certainly deserve it.)



---

archive/issue_comments_087634.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@qed777](#comment:21):\n> I think we should get this and the currently positively reviewed SageNB tickets at {32} into a new SageNB 0.8.3.\n\nI've opened #10036 for this.",
    "created_at": "2010-09-29T21:23:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87634",
    "user": "https://github.com/qed777"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@qed777](#comment:21):
> I think we should get this and the currently positively reviewed SageNB tickets at {32} into a new SageNB 0.8.3.

I've opened #10036 for this.



---

archive/issue_comments_087635.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kcrisman](#comment:22):\n> > But I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.\n\n> \n> Not to reopen the whole numbering issue, but it seems weird that major upgrades to big pieces of Sage would be 4.6.1 - and possibly wait weeks.  Is it possible to keep the 4.6 cycle going, or would it make more sense to wait on all these?  I realize you're doing the work - just a query.  (Partly this is the fear that 4.6.1 might not happen for a while, since I expect you to take a break after this release! You certainly deserve it.)\n\nThanks!  I may well take a break after 4.6 is out.\n\nI'll try to reply soon on sage-devel about the possibility of waiting longer for 4.6.alpha2 or adding an alpha3.\n\nRight now, I need to investigate a potential problem with current trial alpha2.  The current merge script is [here](http://sage.math.washington.edu/home/release/sage-4.6.alpha2/merger-4.6.alpha2).",
    "created_at": "2010-09-29T21:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87635",
    "user": "https://github.com/qed777"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kcrisman](#comment:22):
> > But I can't work on this now, as I'm a bit busy with getting 4.6.alpha2 ready to release and working on #3524.  That will put the 4.6 cycle in feature freeze, so it's likely that the new Cython, NumPy, Pynac, SageNB, and SciPy packages will have to wait for 4.6.1.

> 
> Not to reopen the whole numbering issue, but it seems weird that major upgrades to big pieces of Sage would be 4.6.1 - and possibly wait weeks.  Is it possible to keep the 4.6 cycle going, or would it make more sense to wait on all these?  I realize you're doing the work - just a query.  (Partly this is the fear that 4.6.1 might not happen for a while, since I expect you to take a break after this release! You certainly deserve it.)

Thanks!  I may well take a break after 4.6 is out.

I'll try to reply soon on sage-devel about the possibility of waiting longer for 4.6.alpha2 or adding an alpha3.

Right now, I need to investigate a potential problem with current trial alpha2.  The current merge script is [here](http://sage.math.washington.edu/home/release/sage-4.6.alpha2/merger-4.6.alpha2).



---

archive/issue_comments_087636.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jasongrout](#comment:18):\n> Apply only 9822-multiple-cookies.patch.  The rest of the work on this ticket has been moved to #10029.\n\nTim, does this patch look good to you?",
    "created_at": "2010-10-03T09:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87636",
    "user": "https://github.com/qed777"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jasongrout](#comment:18):
> Apply only 9822-multiple-cookies.patch.  The rest of the work on this ticket has been moved to #10029.

Tim, does this patch look good to you?



---

archive/issue_events_126252.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-10-03T09:45:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126252"
}
```



---

archive/issue_events_126253.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-10-03T09:45:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126253"
}
```



---

archive/issue_comments_087637.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nLooks good to me.",
    "created_at": "2010-10-03T09:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87637",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:26" align="right">comment:26</div>

Looks good to me.



---

archive/issue_comments_087638.json:
```json
{
    "body": "Reviewer: **Tim Dumol**",
    "created_at": "2010-10-03T09:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87638",
    "user": "https://github.com/qed777"
}
```

Reviewer: **Tim Dumol**



---

archive/issue_events_126254.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-04T01:34:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126254"
}
```



---

archive/issue_events_126255.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-04T01:34:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9822#event-126255"
}
```



---

archive/issue_comments_087639.json:
```json
{
    "body": "Merged: **sagenb-0.8.3**",
    "created_at": "2010-10-04T01:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9822",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9822#issuecomment-87639",
    "user": "https://github.com/qed777"
}
```

Merged: **sagenb-0.8.3**
