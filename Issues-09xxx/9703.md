# Issue 9703: Doctest failures caused by non-working sympow on 32-bit Solaris x86 and  32-bit OpenSolaris

archive/issues_009703.json:
```json
{
    "body": "John Palmieri has built most of Sage on the host fulvia, but there are a number of tests related to sympow that are failing. The summary at the end shows:\n\n```\nThe following tests failed:\nsage -t  -long devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\nsage -t  -long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\nsage -t  -long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\nsage -t  -long devel/sage/sage/stats/hmm/chmm.pyx # 3 doctests failed\nsage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\nsage -t  -long devel/sage/sage/symbolic/expression.pyx # 2 doctests failed\nTotal time for all tests: 7305.2 seconds\n```\n\nof these test failures, the following three are attributed to SYMPOW\n\n```\nsage -t  -long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\nsage -t  -long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\nsage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n```\nLooking at the source code, it is not valid C, so it's quite possible the code gets mis-compiled. In fact, IMHO, gcc should reject the code - just as the Sun compiler does. \n\nI'll try to work out what was intended and see if the code can be re-written in a way that compiles with the Sun compiler, in which case gcc should have more chance of generating correct code. \n\n\nAssignee: GeorgSWeber\n\nCC:  @jhpalmieri @jaapspies @nexttime @peterjeremy @kiwifb @williamstein @JohnCremona @mwhansen\n\nUpstream: Reported upstream. Little or no feedback.\n\nReviewer: Jeroen Demeyer, Mitesh Patel, Carl Witty\n\nAuthor: David Kirkby\n\nMerged: sage-4.5.3.alpha2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/9703\n\n",
    "closed_at": "2010-08-24T02:50:34Z",
    "created_at": "2010-08-07T16:17:42Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5.3",
    "title": "Doctest failures caused by non-working sympow on 32-bit Solaris x86 and  32-bit OpenSolaris",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9703",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
John Palmieri has built most of Sage on the host fulvia, but there are a number of tests related to sympow that are failing. The summary at the end shows:

```
The following tests failed:
sage -t  -long devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
sage -t  -long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
sage -t  -long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
sage -t  -long devel/sage/sage/stats/hmm/chmm.pyx # 3 doctests failed
sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
sage -t  -long devel/sage/sage/symbolic/expression.pyx # 2 doctests failed
Total time for all tests: 7305.2 seconds
```

of these test failures, the following three are attributed to SYMPOW

```
sage -t  -long devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
sage -t  -long devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
```
Looking at the source code, it is not valid C, so it's quite possible the code gets mis-compiled. In fact, IMHO, gcc should reject the code - just as the Sun compiler does. 

I'll try to work out what was intended and see if the code can be re-written in a way that compiles with the Sun compiler, in which case gcc should have more chance of generating correct code. 


Assignee: GeorgSWeber

CC:  @jhpalmieri @jaapspies @nexttime @peterjeremy @kiwifb @williamstein @JohnCremona @mwhansen

Upstream: Reported upstream. Little or no feedback.

Reviewer: Jeroen Demeyer, Mitesh Patel, Carl Witty

Author: David Kirkby

Merged: sage-4.5.3.alpha2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/9703





---

archive/issue_comments_094205.json:
```json
{
    "body": "<a id='comment:1'></a>The same issue is observed on a 32-bit build on OpenSolaris.",
    "created_at": "2010-08-12T17:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94205",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:1'></a>The same issue is observed on a 32-bit build on OpenSolaris.



---

archive/issue_comments_094206.json:
```json
{
    "body": "<a id='comment:3'></a>By generating the data files directly, with `SAGE_LOCAL/lib/sympow/new_data`,  I was able to get the \"optional\" and \"not tested\" examples [here](http://www.sagemath.org/doc/reference/sage/lfunctions/sympow.html) to run.  To really run `./sympow -new_data 2` for the example `a = sympow.L(EllipticCurve('11a'), 2, 16); a`, I ran\n\n```sh\n$ ./sage -sh\n> cd SAGE_LOCAL/lib/sympow\n> ./new_data sh gp '-sp 2'\n```\nFor the example `print sympow.Lderivs(EllipticCurve('11a'), 1, 16, 2)`, I ran\n\n```sh\n$ ./sage -sh\n> cd SAGE_LOCAL/lib/sympow\n> ./new_data sh gp '-sp 1 -dv 0'\n> ./new_data sh gp '-sp 1 -dv 1'\n> ./new_data sh gp '-sp 1 -dv 2'\n```\nIt seems that part of the Sage interface to SYMPOW is broken.\n\nBut I don't know if missing data files caused the failures reported here and at #9166.",
    "created_at": "2010-08-16T01:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94206",
    "user": "https://github.com/qed777"
}
```

<a id='comment:3'></a>By generating the data files directly, with `SAGE_LOCAL/lib/sympow/new_data`,  I was able to get the "optional" and "not tested" examples [here](http://www.sagemath.org/doc/reference/sage/lfunctions/sympow.html) to run.  To really run `./sympow -new_data 2` for the example `a = sympow.L(EllipticCurve('11a'), 2, 16); a`, I ran

```sh
$ ./sage -sh
> cd SAGE_LOCAL/lib/sympow
> ./new_data sh gp '-sp 2'
```
For the example `print sympow.Lderivs(EllipticCurve('11a'), 1, 16, 2)`, I ran

```sh
$ ./sage -sh
> cd SAGE_LOCAL/lib/sympow
> ./new_data sh gp '-sp 1 -dv 0'
> ./new_data sh gp '-sp 1 -dv 1'
> ./new_data sh gp '-sp 1 -dv 2'
```
It seems that part of the Sage interface to SYMPOW is broken.

But I don't know if missing data files caused the failures reported here and at #9166.



---

archive/issue_comments_094207.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 mpatel]:\n> It seems that part of the Sage interface to SYMPOW is broken.\n\n\nOr maybe `sympow` itself doesn't properly call `new_data`?",
    "created_at": "2010-08-16T02:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94207",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>Replying to [comment:3 mpatel]:
> It seems that part of the Sage interface to SYMPOW is broken.


Or maybe `sympow` itself doesn't properly call `new_data`?



---

archive/issue_comments_094208.json:
```json
{
    "body": "<a id='comment:5'></a>On the other hand, there is this (after running \"sage -sh\" and \"cd $SAGE_LOCAL/lib/sympow\"):\n\n```\n$ ./sympow -curve \"[0,-1,1,-10,-20]\" -moddeg\nsympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[1]\n```\nOn my mac or on sage.math, this produces valid output, including the line\n\n```\nModular Degree is 1\n```\nwhich is what is parsed by the `modular_degree` method.  So it looks to me as though sympow is really broken, not just its interface.  \n\n(Furthermore, regardless of the C code, I think that sympow.py would never be accepted into Sage today: too many untested methods.)",
    "created_at": "2010-08-16T05:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94208",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>On the other hand, there is this (after running "sage -sh" and "cd $SAGE_LOCAL/lib/sympow"):

```
$ ./sympow -curve "[0,-1,1,-10,-20]" -moddeg
sympow 1.018 RELEASE  (c) Mark Watkins -**ERROR** QD_check failed at x[1]
```
On my mac or on sage.math, this produces valid output, including the line

```
Modular Degree is 1
```
which is what is parsed by the `modular_degree` method.  So it looks to me as though sympow is really broken, not just its interface.  

(Furthermore, regardless of the C code, I think that sympow.py would never be accepted into Sage today: too many untested methods.)



---

archive/issue_comments_094209.json:
```json
{
    "body": "<a id='comment:6'></a>I wasn't clear enough above: the line `**ERROR**...` was produced on fulvia, an x86 box running Solaris.",
    "created_at": "2010-08-16T05:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94209",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>I wasn't clear enough above: the line `**ERROR**...` was produced on fulvia, an x86 box running Solaris.



---

archive/issue_comments_094210.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:3 mpatel]:\n> By generating the data files directly, with `SAGE_LOCAL/lib/sympow/new_data`,  I was able to get the \"optional\" and \"not tested\" examples [here](http://www.sagemath.org/doc/reference/sage/lfunctions/sympow.html) to run.  To really run `./sympow -new_data 2` for the example \n\n\nTry that on the **global** installation of sage on sage.math - not your own private one. \n\nI'm told part of the problem is that SYMPOW is trying to write data files below its installation directory. So it fails on a global installation of Sage, unless the user the user has root access. \n\nBut there's very little error checking, so the fact the data files are not created is not reported. \n\n> It seems that part of the Sage interface to SYMPOW is broken.\n\n\nIf it was only that! \n \n> But I don't know if missing data files caused the failures reported here and at #9166.\n\n\nTo the best of my knowledge, not all examples need data files. When they do, a message is printed telling one how to create the data files. So that is not all the reason. That is certainly applied by the README file in the source code. \n\nI've run the `smypow` executable from the command line, and find problems unrelated to the generation of data files. \n\nIt's not just the C code that is bad. There's a `Configure script` that starts with `#!/bin/sh`, then has code which checks if `sh` is on your system or not! \n\nMy preference would be to remove this, or at least move it to experimental, but William seems keen to keep it as a standard package. It seems a bit strange to me given. \n\n* This is apparently very specialised code. \n* It is so badly written\n* It is causing problems on Solaris x86, Cygwin and ArchLinux. \n\nThat seems an alful lot of problems \n\nI'm cc'ing a few people that I know have looked at SYMPOW at some point in the past. They might have some comments. Perhaps William has some comments to he would like to add to the ticket. \n\nDave",
    "created_at": "2010-08-16T09:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94210",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>Replying to [comment:3 mpatel]:
> By generating the data files directly, with `SAGE_LOCAL/lib/sympow/new_data`,  I was able to get the "optional" and "not tested" examples [here](http://www.sagemath.org/doc/reference/sage/lfunctions/sympow.html) to run.  To really run `./sympow -new_data 2` for the example 


Try that on the **global** installation of sage on sage.math - not your own private one. 

I'm told part of the problem is that SYMPOW is trying to write data files below its installation directory. So it fails on a global installation of Sage, unless the user the user has root access. 

But there's very little error checking, so the fact the data files are not created is not reported. 

> It seems that part of the Sage interface to SYMPOW is broken.


If it was only that! 
 
> But I don't know if missing data files caused the failures reported here and at #9166.


To the best of my knowledge, not all examples need data files. When they do, a message is printed telling one how to create the data files. So that is not all the reason. That is certainly applied by the README file in the source code. 

I've run the `smypow` executable from the command line, and find problems unrelated to the generation of data files. 

It's not just the C code that is bad. There's a `Configure script` that starts with `#!/bin/sh`, then has code which checks if `sh` is on your system or not! 

My preference would be to remove this, or at least move it to experimental, but William seems keen to keep it as a standard package. It seems a bit strange to me given. 

* This is apparently very specialised code. 
* It is so badly written
* It is causing problems on Solaris x86, Cygwin and ArchLinux. 

That seems an alful lot of problems 

I'm cc'ing a few people that I know have looked at SYMPOW at some point in the past. They might have some comments. Perhaps William has some comments to he would like to add to the ticket. 

Dave



---

archive/issue_comments_094211.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 drkirkby]:\n> \n> Try that on the **global** installation of sage on sage.math - not your own private one. \n> \n> I'm told part of the problem is that SYMPOW is trying to write data files below its installation directory. So it fails on a global installation of Sage, unless the user the user has root access. \n\n\nI'll comment. I am the one who told that to David. I have shamelessly sat on this info for about 3 years. I noticed it when I first tried to package sympow for Gentoo as part of my sage porting drive. At the time I had to allow the directory where the sympow scripts are installed to be world writable....\n\nThat no one really noticed means that no one using a global sage install has been using sympow for their work. The only people using it must have used a private installation. We now have a fix for this problem in sage-on-gentoo, Christopher, the other sage-on-gentoo dev, has figured a way of getting sympow to write in $HOME/.sympow in the last month or so.\n\nI think there is a case for trying to replace sympow. It seems like the original author has abandoned it - the sympow homepage has gone. Sage could become sympow\nupstream. But given the quality of the code there is a high burden for maintenance. It probably would be more beneficial in the long run to rewrite the functionality altogether. Given that there are references I think it could be a nice student project. \n\nThat's my opinion. \n\nFrancois",
    "created_at": "2010-08-16T10:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94211",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Replying to [comment:7 drkirkby]:
> 
> Try that on the **global** installation of sage on sage.math - not your own private one. 
> 
> I'm told part of the problem is that SYMPOW is trying to write data files below its installation directory. So it fails on a global installation of Sage, unless the user the user has root access. 


I'll comment. I am the one who told that to David. I have shamelessly sat on this info for about 3 years. I noticed it when I first tried to package sympow for Gentoo as part of my sage porting drive. At the time I had to allow the directory where the sympow scripts are installed to be world writable....

That no one really noticed means that no one using a global sage install has been using sympow for their work. The only people using it must have used a private installation. We now have a fix for this problem in sage-on-gentoo, Christopher, the other sage-on-gentoo dev, has figured a way of getting sympow to write in $HOME/.sympow in the last month or so.

I think there is a case for trying to replace sympow. It seems like the original author has abandoned it - the sympow homepage has gone. Sage could become sympow
upstream. But given the quality of the code there is a high burden for maintenance. It probably would be more beneficial in the long run to rewrite the functionality altogether. Given that there are references I think it could be a nice student project. 

That's my opinion. 

Francois



---

archive/issue_comments_094212.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 fbissey]:\n> That no one really noticed means that no one using a global sage install has been using sympow for their work. The only people using it must have used a private installation. We now have a fix for this problem in sage-on-gentoo, Christopher, the other sage-on-gentoo dev, has figured a way of getting sympow to write in $HOME/.sympow in the last month or so.\n\n\nI prepared a small patch which should fix the directory/permission problems. I did not fully test it because I got little time but you should be able see its basic idea - it includes the sed fixes from our sage-on-gentoo overlay: http://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sympow/sympow-1.018-r1.ebuild (look at it for more detailed comments on what the patch does). To successfully use it, apply it to sympow's source and do the following (would go into spkg-install):\n\n* install sympow's *.gp scripts into $SAGE_LOCAL/share/sympow\n* install sympow's datafiles (A012M.txt, A012S.txt and so on) into $SAGE_LOCAL/share/sympow/datafiles\n* the patch creates a wrapper script \"sympow-start\" which copies the datafiles from the share-directory to $HOME/.sympow (if it does not exist yet) so that sympow can read and write in that directory - give the script execute-permissions and make sure you start the script \"sympow-start\" instead of the binary. A better idea would be to rename the sympow binary and to rename the script to \"sympow\" (without \"-start\"), of course.\n\nWith the patch you also should be able to create the precomputed data which is needed for some optional tests.\n\nChristopher",
    "created_at": "2010-08-16T12:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94212",
    "user": "https://trac.sagemath.org/admin/accounts/users/cschwan"
}
```

<a id='comment:9'></a>Replying to [comment:8 fbissey]:
> That no one really noticed means that no one using a global sage install has been using sympow for their work. The only people using it must have used a private installation. We now have a fix for this problem in sage-on-gentoo, Christopher, the other sage-on-gentoo dev, has figured a way of getting sympow to write in $HOME/.sympow in the last month or so.


I prepared a small patch which should fix the directory/permission problems. I did not fully test it because I got little time but you should be able see its basic idea - it includes the sed fixes from our sage-on-gentoo overlay: http://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sympow/sympow-1.018-r1.ebuild (look at it for more detailed comments on what the patch does). To successfully use it, apply it to sympow's source and do the following (would go into spkg-install):

* install sympow's *.gp scripts into $SAGE_LOCAL/share/sympow
* install sympow's datafiles (A012M.txt, A012S.txt and so on) into $SAGE_LOCAL/share/sympow/datafiles
* the patch creates a wrapper script "sympow-start" which copies the datafiles from the share-directory to $HOME/.sympow (if it does not exist yet) so that sympow can read and write in that directory - give the script execute-permissions and make sure you start the script "sympow-start" instead of the binary. A better idea would be to rename the sympow binary and to rename the script to "sympow" (without "-start"), of course.

With the patch you also should be able to create the precomputed data which is needed for some optional tests.

Christopher



---

archive/issue_comments_094213.json:
```json
{
    "body": "<a id='comment:11'></a>I now have a better understanding of why SYMPOW is failing to work correctly on Cygwin and Solaris on x86 chips. SYMPOW makes use of the [Quad Double](http://crd.lbl.gov/~dhbailey/mpdist/) code which relies on IEE-754 double-precision maths, with a 53-bit mantissa and 64-bits in total. However, the default mode of the x86 CPUs is to use extended precision where 64-bits are used for the mantissa and 80 bits in total. It is necessary to change the mode of operation of the floating point processor in order that the Quad double code will work at all. SYMPOW had code for this in a file fpu.c, but it only worked on Linux. It made use of Linux-specific header files too. \n\nThe main change necessary was to add some inline assembly code to alter the values of bits 8 and 9 in the 16-bit control register of the floating point processor. I got the relevant information about the exact bits needed from an old (1987) copy of the Intel 80387 Programmer's Reference Manual. \n\nHere's a revised package which builds and passes all relevant tests on \n* OpenSolaris (32-bit) on x64 \n* Linux (64-bit)\n* OS X (64-bit)\n* Solaris 10 (32-bit) SPARC\n\nIt was not possible to test on Solaris 10 x86, as access to the Skynet machines is currently unavailable, but I do not believe ll present any problems, since it builds fine on OpenSolaris as a 32-bit application. \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg\n\nApart from a couple of minor changes, it is the same code which Mike Hansen tested on Cygwin and said it works there too. \n\nI've not implemented Christopher's changes which are necessary to get this to pass all the optional tests. Someone who is more keen than me can open a ticket for that if they wish. I just want to see the back of this rather annoying package. \n\nA note to reviewers (mainly aimed at Leif!) I know there are 1001 things wrong with this package, but I have no desire to clean them all up. Please review on the basis of the actual changes I made - not what it might be desirable to make. Otherwise it will never get reviewed. \n\n## Test results a Sun Ultra 27 running OpenSolaris 06/2009 (Originally SYMPOW failed all tests on this workstation)\n\n```\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ uname -a\nSunOS hawk 5.11 snv_134 i86pc i386 i86pc\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ cat /etc/release\n                       OpenSolaris Development snv_134 X86\n           Copyright 2010 Sun Microsystems, Inc.  All Rights Reserved.\n                        Use is subject to license terms.\n                             Assembled 01 March 2010\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py\nsage -t -long \"devel/sage/sage/modular/abvar/abvar.py\"      \n\t [27.4 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 27.5 seconds\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py\nsage -t -long \"devel/sage/sage/lfunctions/sympow.py\"        \n\t [5.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 5.8 seconds\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nsage -t -long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n\t [212.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 212.8 seconds\ndrkirkby@hawk:~/32/sage-4.5.3.alpha1$ \n```\n## Test results on Ubunta Linux (sage.math)\n\n```\nkirkby@sage:~/sage-4.5.alpha4$ uname -a\nLinux sage.math.washington.edu 2.6.24-28-server #1 SMP Sat Jul 31 18:41:35 UTC 2010 x86_64 GNU/Linux\nkirkby@sage:~/sage-4.5.alpha4$ cat /etc/issue\nUbuntu 8.04.4 LTS \\n \\l\n\nkirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py\nsage -t -long \"devel/sage/sage/modular/abvar/abvar.py\"      \n\t [34.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 34.1 seconds\nkirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py\nsage -t -long \"devel/sage/sage/lfunctions/sympow.py\"        \n\t [9.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 9.1 seconds\nkirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nsage -t -long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n\t [170.5 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 170.6 seconds\n```\n\n == Test results on OS X (bsd.math) ==\n\n```\n[kirkby@bsd sage-4.5.rc1]$ uname -a\nDarwin bsd.local 10.4.0 Darwin Kernel Version 10.4.0: Fri Apr 23 18:28:53 PDT 2010; root:xnu-1504.7.4~1/RELEASE_I386 i386 i386 MacPro1,1 Darwin\n[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py\nsage -t -long \"devel/sage/sage/modular/abvar/abvar.py\"      \n\t [40.5 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 40.5 seconds\n[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py\nsage -t -long \"devel/sage/sage/lfunctions/sympow.py\"        \n\t [7.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 7.7 seconds\n[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nsage -t -long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n\t [184.0 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 184.0 seconds\n\n```\n == Test results on a Sun T5240 SPARC running Solaris 10 update 7 (t2.math) ==\n\n```\nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ uname -a\nSunOS t2 5.10 Generic_141414-02 sun4v sparc SUNW,T5240\nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ cat /etc/release\n                       Solaris 10 5/09 s10s_u7wos_08 SPARC\n           Copyright 2009 Sun Microsystems, Inc.  All Rights Reserved.\n                        Use is subject to license terms.\n                             Assembled 30 March 2009\nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ \nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py\nsage -t -long \"devel/sage/sage/modular/abvar/abvar.py\"      \n         [321.2 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 321.5 seconds\nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py\nsage -t -long \"devel/sage/sage/lfunctions/sympow.py\"        \n         [89.0 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 89.2 seconds\nkirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nsage -t -long \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n         [3219.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 3219.8 seconds\n\n```\nDave",
    "created_at": "2010-08-22T01:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94213",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>I now have a better understanding of why SYMPOW is failing to work correctly on Cygwin and Solaris on x86 chips. SYMPOW makes use of the [Quad Double](http://crd.lbl.gov/~dhbailey/mpdist/) code which relies on IEE-754 double-precision maths, with a 53-bit mantissa and 64-bits in total. However, the default mode of the x86 CPUs is to use extended precision where 64-bits are used for the mantissa and 80 bits in total. It is necessary to change the mode of operation of the floating point processor in order that the Quad double code will work at all. SYMPOW had code for this in a file fpu.c, but it only worked on Linux. It made use of Linux-specific header files too. 

The main change necessary was to add some inline assembly code to alter the values of bits 8 and 9 in the 16-bit control register of the floating point processor. I got the relevant information about the exact bits needed from an old (1987) copy of the Intel 80387 Programmer's Reference Manual. 

Here's a revised package which builds and passes all relevant tests on 
* OpenSolaris (32-bit) on x64 
* Linux (64-bit)
* OS X (64-bit)
* Solaris 10 (32-bit) SPARC

It was not possible to test on Solaris 10 x86, as access to the Skynet machines is currently unavailable, but I do not believe ll present any problems, since it builds fine on OpenSolaris as a 32-bit application. 

http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg

Apart from a couple of minor changes, it is the same code which Mike Hansen tested on Cygwin and said it works there too. 

I've not implemented Christopher's changes which are necessary to get this to pass all the optional tests. Someone who is more keen than me can open a ticket for that if they wish. I just want to see the back of this rather annoying package. 

A note to reviewers (mainly aimed at Leif!) I know there are 1001 things wrong with this package, but I have no desire to clean them all up. Please review on the basis of the actual changes I made - not what it might be desirable to make. Otherwise it will never get reviewed. 

## Test results a Sun Ultra 27 running OpenSolaris 06/2009 (Originally SYMPOW failed all tests on this workstation)

```
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ uname -a
SunOS hawk 5.11 snv_134 i86pc i386 i86pc
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ cat /etc/release
                       OpenSolaris Development snv_134 X86
           Copyright 2010 Sun Microsystems, Inc.  All Rights Reserved.
                        Use is subject to license terms.
                             Assembled 01 March 2010
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py
sage -t -long "devel/sage/sage/modular/abvar/abvar.py"      
	 [27.4 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 27.5 seconds
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py
sage -t -long "devel/sage/sage/lfunctions/sympow.py"        
	 [5.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 5.8 seconds
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
sage -t -long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
	 [212.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 212.8 seconds
drkirkby@hawk:~/32/sage-4.5.3.alpha1$ 
```
## Test results on Ubunta Linux (sage.math)

```
kirkby@sage:~/sage-4.5.alpha4$ uname -a
Linux sage.math.washington.edu 2.6.24-28-server #1 SMP Sat Jul 31 18:41:35 UTC 2010 x86_64 GNU/Linux
kirkby@sage:~/sage-4.5.alpha4$ cat /etc/issue
Ubuntu 8.04.4 LTS \n \l

kirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py
sage -t -long "devel/sage/sage/modular/abvar/abvar.py"      
	 [34.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 34.1 seconds
kirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py
sage -t -long "devel/sage/sage/lfunctions/sympow.py"        
	 [9.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 9.1 seconds
kirkby@sage:~/sage-4.5.alpha4$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
sage -t -long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
	 [170.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 170.6 seconds
```

 == Test results on OS X (bsd.math) ==

```
[kirkby@bsd sage-4.5.rc1]$ uname -a
Darwin bsd.local 10.4.0 Darwin Kernel Version 10.4.0: Fri Apr 23 18:28:53 PDT 2010; root:xnu-1504.7.4~1/RELEASE_I386 i386 i386 MacPro1,1 Darwin
[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py
sage -t -long "devel/sage/sage/modular/abvar/abvar.py"      
	 [40.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 40.5 seconds
[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py
sage -t -long "devel/sage/sage/lfunctions/sympow.py"        
	 [7.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 7.7 seconds
[kirkby@bsd sage-4.5.rc1]$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
sage -t -long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
	 [184.0 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 184.0 seconds

```
 == Test results on a Sun T5240 SPARC running Solaris 10 update 7 (t2.math) ==

```
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ uname -a
SunOS t2 5.10 Generic_141414-02 sun4v sparc SUNW,T5240
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ cat /etc/release
                       Solaris 10 5/09 s10s_u7wos_08 SPARC
           Copyright 2009 Sun Microsystems, Inc.  All Rights Reserved.
                        Use is subject to license terms.
                             Assembled 30 March 2009
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ 
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/modular/abvar/abvar.py
sage -t -long "devel/sage/sage/modular/abvar/abvar.py"      
         [321.2 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 321.5 seconds
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/lfunctions/sympow.py
sage -t -long "devel/sage/sage/lfunctions/sympow.py"        
         [89.0 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 89.2 seconds
kirkby@t2:32 ~/t2/32/sage-4.5.3.alpha0$ ./sage -t  -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
sage -t -long "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
         [3219.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 3219.8 seconds

```
Dave



---

archive/issue_comments_094214.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-08-22T01:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94214",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_094215.json:
```json
{
    "body": "Changes the FPU to double-precession IEEE-754 from Intel's expended precisiion.",
    "created_at": "2010-08-22T01:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94215",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changes the FPU to double-precession IEEE-754 from Intel's expended precisiion.



---

archive/issue_comments_094216.json:
```json
{
    "body": "<a id='comment:12'></a>Attachment [9703-SYMPOW-fix-for-Solaris.patch](tarball://root/attachments/some-uuid/ticket9703/9703-SYMPOW-fix-for-Solaris.patch) by @qed777 created at 2010-08-23 13:23:47\n\nIf #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.",
    "created_at": "2010-08-23T13:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94216",
    "user": "https://github.com/qed777"
}
```

<a id='comment:12'></a>Attachment [9703-SYMPOW-fix-for-Solaris.patch](tarball://root/attachments/some-uuid/ticket9703/9703-SYMPOW-fix-for-Solaris.patch) by @qed777 created at 2010-08-23 13:23:47

If #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.



---

archive/issue_comments_094217.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 mpatel]:\n> If #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.\n\n\nAnd #9693, too.",
    "created_at": "2010-08-23T13:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94217",
    "user": "https://github.com/qed777"
}
```

<a id='comment:13'></a>Replying to [comment:12 mpatel]:
> If #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.


And #9693, too.



---

archive/issue_comments_094218.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 mpatel]:\n> Replying to [comment:12 mpatel]:\n> > If #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.\n\n> \n> And #9693, too.\n\nThank you. That would be great. That should give all doc tests passing on Solaris 10 x86, OpenSolaris and Solaris 10 SPARC. \n\nI just need someone to change it to positive. I think I've provided quite a bit of evidence that it passes the tests on every platform I can test on.",
    "created_at": "2010-08-23T13:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94218",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>Replying to [comment:13 mpatel]:
> Replying to [comment:12 mpatel]:
> > If #9722 is ready to merge soon and this ticket is also positively reviewed, I'll consider including this in a 4.5.3.alpha2.

> 
> And #9693, too.

Thank you. That would be great. That should give all doc tests passing on Solaris 10 x86, OpenSolaris and Solaris 10 SPARC. 

I just need someone to change it to positive. I think I've provided quite a bit of evidence that it passes the tests on every platform I can test on.



---

archive/issue_comments_094219.json:
```json
{
    "body": "Attachment [testfpu.c](tarball://root/attachments/some-uuid/ticket9703/testfpu.c) by @jdemeyer created at 2010-08-23 13:53:57\n\nTest whether FPU is 53-bit or more",
    "created_at": "2010-08-23T13:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94219",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [testfpu.c](tarball://root/attachments/some-uuid/ticket9703/testfpu.c) by @jdemeyer created at 2010-08-23 13:53:57

Test whether FPU is 53-bit or more



---

archive/issue_comments_094220.json:
```json
{
    "body": "<a id='comment:15'></a>Maybe the attached program might be useful.  It runs a simple computation to check whether or not the FPU is 53-bit or more.  For example, on a x86_64 Intel machine, I get:\n\n```\ngcc -mfpmath=387 testfpu.c -o testfpu && ./testfpu 134217728 134217728\na = 134217728, b = 134217728\nresult = 1\n```\n\n```\ngcc -mfpmath=sse testfpu.c -o testfpu && ./testfpu 134217728 134217728\na = 134217728, b = 134217728\nresult = 0\n```\n\n```\ngcc -mfpmath=387 -mpc64 testfpu.c -o testfpu && ./testfpu 134217728 134217728\na = 134217728, b = 134217728\nresult = 0\n```\n\nYou could use to check\n* whether or not the patch needs to be applied\n* whether the result is correct after possibly applying the patch (do this on all systems!)",
    "created_at": "2010-08-23T14:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94220",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Maybe the attached program might be useful.  It runs a simple computation to check whether or not the FPU is 53-bit or more.  For example, on a x86_64 Intel machine, I get:

```
gcc -mfpmath=387 testfpu.c -o testfpu && ./testfpu 134217728 134217728
a = 134217728, b = 134217728
result = 1
```

```
gcc -mfpmath=sse testfpu.c -o testfpu && ./testfpu 134217728 134217728
a = 134217728, b = 134217728
result = 0
```

```
gcc -mfpmath=387 -mpc64 testfpu.c -o testfpu && ./testfpu 134217728 134217728
a = 134217728, b = 134217728
result = 0
```

You could use to check
* whether or not the patch needs to be applied
* whether the result is correct after possibly applying the patch (do this on all systems!)



---

archive/issue_comments_094221.json:
```json
{
    "body": "<a id='comment:16'></a>Sage 4.6.prealpha3, which includes this ticket, passed all tests (`ptestlong`) on 64-bit Fedora 13 (Core2, gcc 4.4.4), see also http://trac.sagemath.org/sage_trac/ticket/9343#comment:308 .",
    "created_at": "2010-08-23T14:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94221",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>Sage 4.6.prealpha3, which includes this ticket, passed all tests (`ptestlong`) on 64-bit Fedora 13 (Core2, gcc 4.4.4), see also http://trac.sagemath.org/sage_trac/ticket/9343#comment:308 .



---

archive/issue_comments_094222.json:
```json
{
    "body": "<a id='comment:17'></a>Sage 4.6.prealpha3, which includes this ticket, passed all tests (ptestlong) on a Sun UltraSPARC with Solaris 10.",
    "created_at": "2010-08-23T15:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94222",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Sage 4.6.prealpha3, which includes this ticket, passed all tests (ptestlong) on a Sun UltraSPARC with Solaris 10.



---

archive/issue_comments_094223.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:15 jdemeyer]:\n> Maybe the attached program might be useful.  It runs a simple computation to check whether or not the FPU is 53-bit or more.  For example, on a x86_64 Intel machine, I get:\n\n\nIt is an interesting little program. It does show the behavior someone (probably you) suspected, that in 64-bit builds, the behaviour changes. \n\n> You could use to check\n> * whether or not the patch needs to be applied\n> * whether the result is correct after possibly applying the patch (do this on all systems!)\n\n\nI don't personally feel there is a need to do this. \n* It makes use of gcc-specific options. It would be nice to get Sage to build with the Sun compiler. At least now, this will try to build with the Sun compiler, and the error message seen is useful, as it highlights where the code is not valid C. \n* Some of those compiler options may not be supported in gcc 4.0.1, which is the earliest Sage supports. I think you said some were very new. \n* It was not done before, so I end up making further changes to a package which is already a complete mess. \n* If the FPU is already in using the lower precision, changing the bits to put it there will do no harm. \n* This has been quite extensively tested now, and has not failed on any system at all. \n \nI think if the result is incorrect (i.e. for some reason the FPU remained in the wrong precision), the doctests will pick this up very quickly. This was the reason the program built, but failed tests on Cygwin and Solairs x86. \n\nDave",
    "created_at": "2010-08-23T17:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94223",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:18'></a>Replying to [comment:15 jdemeyer]:
> Maybe the attached program might be useful.  It runs a simple computation to check whether or not the FPU is 53-bit or more.  For example, on a x86_64 Intel machine, I get:


It is an interesting little program. It does show the behavior someone (probably you) suspected, that in 64-bit builds, the behaviour changes. 

> You could use to check
> * whether or not the patch needs to be applied
> * whether the result is correct after possibly applying the patch (do this on all systems!)


I don't personally feel there is a need to do this. 
* It makes use of gcc-specific options. It would be nice to get Sage to build with the Sun compiler. At least now, this will try to build with the Sun compiler, and the error message seen is useful, as it highlights where the code is not valid C. 
* Some of those compiler options may not be supported in gcc 4.0.1, which is the earliest Sage supports. I think you said some were very new. 
* It was not done before, so I end up making further changes to a package which is already a complete mess. 
* If the FPU is already in using the lower precision, changing the bits to put it there will do no harm. 
* This has been quite extensively tested now, and has not failed on any system at all. 
 
I think if the result is incorrect (i.e. for some reason the FPU remained in the wrong precision), the doctests will pick this up very quickly. This was the reason the program built, but failed tests on Cygwin and Solairs x86. 

Dave



---

archive/issue_comments_094224.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 leif]:\n> Sage 4.6.prealpha3, which includes this ticket, passed all tests (`ptestlong`) on 64-bit Fedora 13 (Core2, gcc 4.4.4), see also http://trac.sagemath.org/sage_trac/ticket/9343#comment:308 .\n\n\nThank you for the Fedora confirmation. I had already tested on Ubunta, but not Fedora.",
    "created_at": "2010-08-23T17:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94224",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:19'></a>Replying to [comment:16 leif]:
> Sage 4.6.prealpha3, which includes this ticket, passed all tests (`ptestlong`) on 64-bit Fedora 13 (Core2, gcc 4.4.4), see also http://trac.sagemath.org/sage_trac/ticket/9343#comment:308 .


Thank you for the Fedora confirmation. I had already tested on Ubunta, but not Fedora.



---

archive/issue_comments_094225.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:17 jdemeyer]:\n> Sage 4.6.prealpha3, which includes this ticket, passed all tests (ptestlong) on a Sun UltraSPARC with Solaris 10.\n\nNote the SPARC that Jeroen used (a Sun Blade 1000 belonging to me), was not the same as as I used, which was the Sun T5240 (t2.,math). \n\nSo that's confirmation on two different Sun systems. One running the 2005 release of Solaris 10, the other running a much more recent release. \n\nDave",
    "created_at": "2010-08-23T17:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94225",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:20'></a>Replying to [comment:17 jdemeyer]:
> Sage 4.6.prealpha3, which includes this ticket, passed all tests (ptestlong) on a Sun UltraSPARC with Solaris 10.

Note the SPARC that Jeroen used (a Sun Blade 1000 belonging to me), was not the same as as I used, which was the Sun T5240 (t2.,math). 

So that's confirmation on two different Sun systems. One running the 2005 release of Solaris 10, the other running a much more recent release. 

Dave



---

archive/issue_comments_094226.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:18 drkirkby]:\n> > You could use to check\n> > * whether or not the patch needs to be applied\n> > * whether the result is correct after possibly applying the patch (do this on all systems!)\n\n> \n> I don't personally feel there is a need to do this. \n> * It makes use of gcc-specific options.\n\nIt doesn't.  I just added those options to show how the behaviour changes.  My idea would be to run testfpu.c without any options and check the result.\n\n>  * It was not done before, so I end up making further changes to a package which is already a complete mess.\n \nI believe that my program is a cleaner solution. For example, are you sure you don't need the patch on Darwin? Also, the following code looks very suspicious:\n\n```\nfor machine_hardware in ix86 i386 i486 i586 i686 x86_64 i86pc ia64\n```",
    "created_at": "2010-08-23T18:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94226",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:18 drkirkby]:
> > You could use to check
> > * whether or not the patch needs to be applied
> > * whether the result is correct after possibly applying the patch (do this on all systems!)

> 
> I don't personally feel there is a need to do this. 
> * It makes use of gcc-specific options.

It doesn't.  I just added those options to show how the behaviour changes.  My idea would be to run testfpu.c without any options and check the result.

>  * It was not done before, so I end up making further changes to a package which is already a complete mess.
 
I believe that my program is a cleaner solution. For example, are you sure you don't need the patch on Darwin? Also, the following code looks very suspicious:

```
for machine_hardware in ix86 i386 i486 i586 i686 x86_64 i86pc ia64
```



---

archive/issue_comments_094227.json:
```json
{
    "body": "<a id='comment:22'></a>By the way, my comment should not prevent this patch from being included in 4.5.3 if that was the plan.  If this patch works, I'm certainly happy with that.  I just wanted to indicate that there might be better ways to solve the issue.",
    "created_at": "2010-08-23T19:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94227",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>By the way, my comment should not prevent this patch from being included in 4.5.3 if that was the plan.  If this patch works, I'm certainly happy with that.  I just wanted to indicate that there might be better ways to solve the issue.



---

archive/issue_comments_094228.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 jdemeyer]:\n> By the way, my comment should not prevent this patch from being included in 4.5.3 if that was the plan.  If this patch works, I'm certainly happy with that.  I just wanted to indicate that there might be better ways to solve the issue.\n\n\nThe:\n\n \n`for machine_hardware in ix86 i386 i486 i586 i686 x86_64 i86pc ia64`\n\nwas there before - I only added `i86pc` and changed `x` to `machine_hardware`, as I thought it was a bit more informative. \n\nThe fpu patch has never been applied on OS X - note the original code specifically checked the platform was Linux. But since the C code used Linux-specific header files, I could not simply apply it everywhere. \n\nGiven SYMPOW is going to be withdrawn from Sage since it's poorly written and unmaintained, I think this is enough. You may notice today that Bill said on `sage-devel` that the author has made it clear he has no desire to maintain this package, as it works on his computer. \n\nI really want to avoid adding things to this code, since no matter what I do, it is still going to be very poor. This solves the only remaining Solaris x86 problem and is one less problem for the Cygwin port. \n\nDave",
    "created_at": "2010-08-23T19:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94228",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:23'></a>Replying to [comment:22 jdemeyer]:
> By the way, my comment should not prevent this patch from being included in 4.5.3 if that was the plan.  If this patch works, I'm certainly happy with that.  I just wanted to indicate that there might be better ways to solve the issue.


The:

 
`for machine_hardware in ix86 i386 i486 i586 i686 x86_64 i86pc ia64`

was there before - I only added `i86pc` and changed `x` to `machine_hardware`, as I thought it was a bit more informative. 

The fpu patch has never been applied on OS X - note the original code specifically checked the platform was Linux. But since the C code used Linux-specific header files, I could not simply apply it everywhere. 

Given SYMPOW is going to be withdrawn from Sage since it's poorly written and unmaintained, I think this is enough. You may notice today that Bill said on `sage-devel` that the author has made it clear he has no desire to maintain this package, as it works on his computer. 

I really want to avoid adding things to this code, since no matter what I do, it is still going to be very poor. This solves the only remaining Solaris x86 problem and is one less problem for the Cygwin port. 

Dave



---

archive/issue_comments_094229.json:
```json
{
    "body": "<a id='comment:24'></a>I'm testing\n\n http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg\n\non bsd, redhawk, sage, and t2.math.\n\nThe patch looks good to me, except that I'm not qualified to review the new `fpu.c`.  But apart from that, I think we have a positive review.\n\nJeroen, can you comment on `fpu.c`?  Alternatively, David, could you find someone to review this file?",
    "created_at": "2010-08-23T21:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94229",
    "user": "https://github.com/qed777"
}
```

<a id='comment:24'></a>I'm testing

 http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg

on bsd, redhawk, sage, and t2.math.

The patch looks good to me, except that I'm not qualified to review the new `fpu.c`.  But apart from that, I think we have a positive review.

Jeroen, can you comment on `fpu.c`?  Alternatively, David, could you find someone to review this file?



---

archive/issue_comments_094230.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2010-08-23T22:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94230",
    "user": "https://github.com/qed777"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_094231.json:
```json
{
    "body": "<a id='comment:26'></a>Can we close #9166 if/when this ticket is merged?",
    "created_at": "2010-08-23T22:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94231",
    "user": "https://github.com/qed777"
}
```

<a id='comment:26'></a>Can we close #9166 if/when this ticket is merged?



---

archive/issue_comments_094232.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mpatel]:\n> Can we close #9166 if/when this ticket is merged?\n\n\nIt should be possible, but you should wait for confirmation from Mike Hansen.\n\nMike confirmed the earlier version I wrote had worked on Cygwin and passed all tests. However, I had did make a small change since then. \n\nThe change was only the way I wrote the numbers in fpu.c. Initially I wrote them as binary using `0b` in front of the 0's and 1's. Later I converted the two binary numbers to hex, so used `0x}} instead. I found using {{{0b` is not portable - it works with gcc, but not Sun Studio. \n\nSo the only changes from the patch that Mike said worked were\n\n* Convert numbers from binary to hex form. \n* Add a few more comments in SPKG.txt and/or fpu.c\n* Committed the changes to the repository. \n\nDave",
    "created_at": "2010-08-23T22:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94232",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:27'></a>Replying to [comment:26 mpatel]:
> Can we close #9166 if/when this ticket is merged?


It should be possible, but you should wait for confirmation from Mike Hansen.

Mike confirmed the earlier version I wrote had worked on Cygwin and passed all tests. However, I had did make a small change since then. 

The change was only the way I wrote the numbers in fpu.c. Initially I wrote them as binary using `0b` in front of the 0's and 1's. Later I converted the two binary numbers to hex, so used `0x}} instead. I found using {{{0b` is not portable - it works with gcc, but not Sun Studio. 

So the only changes from the patch that Mike said worked were

* Convert numbers from binary to hex form. 
* Add a few more comments in SPKG.txt and/or fpu.c
* Committed the changes to the repository. 

Dave



---

archive/issue_comments_094233.json:
```json
{
    "body": "<a id='comment:28'></a>Oops, I should have previewed that once more. \n\n`0b` was changed to `0x` and the numbers obviously changed from a string of 0's and 1's to the hexadecimal equivalents.",
    "created_at": "2010-08-23T22:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94233",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:28'></a>Oops, I should have previewed that once more. 

`0b` was changed to `0x` and the numbers obviously changed from a string of 0's and 1's to the hexadecimal equivalents.



---

archive/issue_comments_094234.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:24 mpatel]:\n> I'm testing\n> \n>  http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg\n> \n> on bsd, redhawk, sage, and t2.math.\n> \n> The patch looks good to me, except that I'm not qualified to review the new `fpu.c`.  But apart from that, I think we have a positive review.\n> \n> Jeroen, can you comment on `fpu.c`?  Alternatively, David, could you find someone to review this file?\n\n\n\nI've asked on sage-devel if someone can comment on it. I suspect Jeroen can. Here's the \n\n[original fpu.c](http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8/src/fpu.c)\n\nand here's the changed version\n\n[patched fpu.c](http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8/patches/fpu.c) \n\nOne obvious difference is the original code just writes a number to the control word, but I first read the control word, set two bits, then write the control word. \n\nThe reason I did that was that one of the bits in that control word is reserved  by Intel, so I did not think it wise to write a number to the register directly. \n\nHaving carefully read the documentation that comes with the later version of quad-double, the only changes that should be made to that code is the precision control bits, which is all I change. \n\nDave",
    "created_at": "2010-08-23T22:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94234",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:29'></a>Replying to [comment:24 mpatel]:
> I'm testing
> 
>  http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg
> 
> on bsd, redhawk, sage, and t2.math.
> 
> The patch looks good to me, except that I'm not qualified to review the new `fpu.c`.  But apart from that, I think we have a positive review.
> 
> Jeroen, can you comment on `fpu.c`?  Alternatively, David, could you find someone to review this file?



I've asked on sage-devel if someone can comment on it. I suspect Jeroen can. Here's the 

[original fpu.c](http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8/src/fpu.c)

and here's the changed version

[patched fpu.c](http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8/patches/fpu.c) 

One obvious difference is the original code just writes a number to the control word, but I first read the control word, set two bits, then write the control word. 

The reason I did that was that one of the bits in that control word is reserved  by Intel, so I did not think it wise to write a number to the register directly. 

Having carefully read the documentation that comes with the later version of quad-double, the only changes that should be made to that code is the precision control bits, which is all I change. 

Dave



---

archive/issue_comments_094235.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-08-23T23:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94235",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_094236.json:
```json
{
    "body": "<a id='comment:30'></a>I've read and understood the new and old versions of fpu.c, and I confirm that the new version is equivalent to the old version under Linux but is more portable in general.  So positive review for fpu.c .\n\n(I'll go ahead and mark as positive review, relying on mpatel's review for everything except fpu.c .)",
    "created_at": "2010-08-23T23:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94236",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:30'></a>I've read and understood the new and old versions of fpu.c, and I confirm that the new version is equivalent to the old version under Linux but is more portable in general.  So positive review for fpu.c .

(I'll go ahead and mark as positive review, relying on mpatel's review for everything except fpu.c .)



---

archive/issue_comments_094237.json:
```json
{
    "body": "<a id='comment:31'></a>Thanks, Carl!\n\nReplying to [comment:24 mpatel]:\n> I'm testing\n> \n>  http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg\n> \n> on bsd, redhawk, sage, and t2.math.\n\n\nThe long doctests pass on these machines.",
    "created_at": "2010-08-23T23:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94237",
    "user": "https://github.com/qed777"
}
```

<a id='comment:31'></a>Thanks, Carl!

Replying to [comment:24 mpatel]:
> I'm testing
> 
>  http://boxen.math.washington.edu/home/kirkby/patches/sympow-1.018.1.p8.spkg
> 
> on bsd, redhawk, sage, and t2.math.


The long doctests pass on these machines.



---

archive/issue_comments_094238.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-08-24T02:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9703#issuecomment-94238",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed



---

archive/issue_events_024248.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-24T02:50:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9703",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9703#event-24248"
}
```
