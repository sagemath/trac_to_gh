# Issue 9061: Create an efficient SUM command

archive/issues_009061.json:
```json
{
    "body": "This *HAS* to be changed :\n\n```\np = MixedIntegerLinearProgram()\nv = p.new_variable()\nsage: %timeit sum([v[i] for i in xrange(900)])\n5 loops, best of 3: 1.14 s per loop\n```\n\nWith this new function :\n\n```\ndef mipvariables_sum(L):\n    d = {}\n    for v in L:\n        for (id,coeff) in v._f.iteritems():\n            d[id] = coeff + d.get(id,0)\n    return LinearFunction(d)\n```\n\nIt gives :\n\n```\nsage: from sage.numerical.mip import mipvariables_sum\nsage: %timeit mipvariables_sum([v[i] for i in xrange(900)])\n625 loops, best of 3: 1.5 ms per loop\n```\n\nEven though it requires a new function to add MIPVariables, it is still better than nothing for the moment.\n\nThis patch will define the function given, and replace all the occurences of \"sum\" in the graph files to have them use this optimization.\n\nNathann\n\nAssignee: jason, jkantor\n\nCC:  mvngu abmasse\n\nResolution: fixed\n\nAuthor: Nathann Cohen\n\nReviewer: Robert Miller\n\nMerged: sage-4.5.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/9061\n\n",
    "closed_at": "2010-07-06T08:20:52Z",
    "created_at": "2010-05-26T22:38:38Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.5",
    "title": "Create an efficient SUM command",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9061",
    "user": "https://github.com/nathanncohen"
}
```
This *HAS* to be changed :

```
p = MixedIntegerLinearProgram()
v = p.new_variable()
sage: %timeit sum([v[i] for i in xrange(900)])
5 loops, best of 3: 1.14 s per loop
```

With this new function :

```
def mipvariables_sum(L):
    d = {}
    for v in L:
        for (id,coeff) in v._f.iteritems():
            d[id] = coeff + d.get(id,0)
    return LinearFunction(d)
```

It gives :

```
sage: from sage.numerical.mip import mipvariables_sum
sage: %timeit mipvariables_sum([v[i] for i in xrange(900)])
625 loops, best of 3: 1.5 ms per loop
```

Even though it requires a new function to add MIPVariables, it is still better than nothing for the moment.

This patch will define the function given, and replace all the occurences of "sum" in the graph files to have them use this optimization.

Nathann

Assignee: jason, jkantor

CC:  mvngu abmasse

Resolution: fixed

Author: Nathann Cohen

Reviewer: Robert Miller

Merged: sage-4.5.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/9061





---

archive/issue_comments_087310.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,34 @@\n-Inequalities using <= and >= still do not work properly... :-/\n+This *HAS* to be changed :\n+\n+\\`\\`\\`\n+p = MixedIntegerLinearProgram()\n+v = p.new_variable()\n+sage: %timeit sum([v[i] for i in xrange(900)])\n+5 loops, best of 3: 1.14 s per loop\n+\\`\\`\\`\n+\n+With this new function :\n+\n+\\`\\`\\`\n+def mipvariables_sum(L):\n+    d = {}\n+    for v in L:\n+        for (id,coeff) in v._f.iteritems():\n+            d[id] = coeff + d.get(id,0)\n+    return LinearFunction(d)\n+\\`\\`\\`\n+\n+It gives :\n+\n+\\`\\`\\`\n+sage: from sage.numerical.mip import mipvariables_sum\n+sage: %timeit mipvariables_sum([v[i] for i in xrange(900)])\n+625 loops, best of 3: 1.5 ms per loop\n+\\`\\`\\`\n+\n+Even though it requires a new function to add MIPVariables, it is still better than nothing for the moment.\n+\n+This patch will define the function given, and replace all the occurences of \"sum\" in the graph files to have them use this optimization.\n \n Nathann\n \n```\n",
    "created_at": "2010-05-27T22:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87310",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,34 @@
-Inequalities using <= and >= still do not work properly... :-/
+This *HAS* to be changed :
+
+\`\`\`
+p = MixedIntegerLinearProgram()
+v = p.new_variable()
+sage: %timeit sum([v[i] for i in xrange(900)])
+5 loops, best of 3: 1.14 s per loop
+\`\`\`
+
+With this new function :
+
+\`\`\`
+def mipvariables_sum(L):
+    d = {}
+    for v in L:
+        for (id,coeff) in v._f.iteritems():
+            d[id] = coeff + d.get(id,0)
+    return LinearFunction(d)
+\`\`\`
+
+It gives :
+
+\`\`\`
+sage: from sage.numerical.mip import mipvariables_sum
+sage: %timeit mipvariables_sum([v[i] for i in xrange(900)])
+625 loops, best of 3: 1.5 ms per loop
+\`\`\`
+
+Even though it requires a new function to add MIPVariables, it is still better than nothing for the moment.
+
+This patch will define the function given, and replace all the occurences of "sum" in the graph files to have them use this optimization.
 
 Nathann
 
```




---

archive/issue_comments_087311.json:
```json
{
    "body": "<a id='comment:2'></a>Can you try `sage.misc.misc.balanced_sum`?  It seems to get about the same speedup for me as you indicate.\n\n```\np = MixedIntegerLinearProgram()\nv = p.new_variable()\n%timeit sage.misc.misc.balanced_sum([v[i] for i in xrange(900)])\n```",
    "created_at": "2010-05-28T00:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87311",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>Can you try `sage.misc.misc.balanced_sum`?  It seems to get about the same speedup for me as you indicate.

```
p = MixedIntegerLinearProgram()
v = p.new_variable()
%timeit sage.misc.misc.balanced_sum([v[i] for i in xrange(900)])
```



---

archive/issue_comments_087312.json:
```json
{
    "body": "<a id='comment:3'></a>For me, the balanced_sum function gives these timings:\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: v = p.new_variable()\nsage: sage: %timeit sum([v[i] for i in xrange(900)])\n5 loops, best of 3: 1.48 s per loop\nsage: p = MixedIntegerLinearProgram()\nsage: v = p.new_variable()\nsage: %timeit sage.misc.misc.balanced_sum([v[i] for i in xrange(900)])\n25 loops, best of 3: 28.2 ms per loop\n```\n\nSo I guess your function still wins (which isn't much of a surprise).",
    "created_at": "2010-05-28T02:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87312",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>For me, the balanced_sum function gives these timings:

```
sage: p = MixedIntegerLinearProgram()
sage: v = p.new_variable()
sage: sage: %timeit sum([v[i] for i in xrange(900)])
5 loops, best of 3: 1.48 s per loop
sage: p = MixedIntegerLinearProgram()
sage: v = p.new_variable()
sage: %timeit sage.misc.misc.balanced_sum([v[i] for i in xrange(900)])
25 loops, best of 3: 28.2 ms per loop
```

So I guess your function still wins (which isn't much of a surprise).



---

archive/issue_comments_087313.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-06-15T17:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87313",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_087314.json:
```json
{
    "body": "<a id='comment:4'></a>This patch defines the function sage.numerical.mip.Sum and updates the LP functions to have them use it !\n\nNathann",
    "created_at": "2010-06-15T17:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87314",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>This patch defines the function sage.numerical.mip.Sum and updates the LP functions to have them use it !

Nathann



---

archive/issue_comments_087315.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-07-01T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87315",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_087316.json:
```json
{
    "body": "<a id='comment:6'></a>Rebased ! :-)\n\nNathann",
    "created_at": "2010-07-01T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87316",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Rebased ! :-)

Nathann



---

archive/issue_comments_087317.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [trac_9061.patch](tarball://root/attachments/some-uuid/ticket9061/trac_9061.patch) by abmasse created at 2010-07-05 13:19:17\n\nHello, Nathann!\n\nDid you rebase it on sage-4.4.3? It seems so because it doesn't apply on sage-4.4.4. Since it touches many parts of the code, I don't know what would be the best strategy to make sure it is correctly based and it does not raise any problem with other patches.\n\nHaving looked at the code, it will probably be a fast review, as soon as I have checked for the improved efficiency.",
    "created_at": "2010-07-05T13:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87317",
    "user": "https://trac.sagemath.org/admin/accounts/users/abmasse"
}
```

<a id='comment:7'></a>Attachment [trac_9061.patch](tarball://root/attachments/some-uuid/ticket9061/trac_9061.patch) by abmasse created at 2010-07-05 13:19:17

Hello, Nathann!

Did you rebase it on sage-4.4.3? It seems so because it doesn't apply on sage-4.4.4. Since it touches many parts of the code, I don't know what would be the best strategy to make sure it is correctly based and it does not raise any problem with other patches.

Having looked at the code, it will probably be a fast review, as soon as I have checked for the improved efficiency.



---

archive/issue_comments_087318.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2010-07-06T08:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87318",
    "user": "https://github.com/rlmill"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_087319.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-07-06T08:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9061#issuecomment-87319",
    "user": "https://github.com/rlmill"
}
```

Resolution: fixed



---

archive/issue_events_022212.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-07-06T08:20:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9061",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9061#event-22212"
}
```
