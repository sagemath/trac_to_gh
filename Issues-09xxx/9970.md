# Issue 9970: Flaky doctest in sage/interfaces/r.py

archive/issues_009969.json:
```json
{
    "assignees": [],
    "body": "This test in `src/sage/interfaces/r.py` should be fixed:\n\n```\n            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)\n            True\n```\n\nThe script\n\n```python\nimport os\nimport tempfile\n\nfail = 0\nfor i in xrange(1000):\n    tmpdir = tempfile.mkdtemp()\n    r.chdir(tmpdir)\n    if tmpdir not in sageobj(r.getwd()):\n        print tmpdir, r.getwd(), sageobj(r.getwd())\n        fail += 1\n    os.rmdir(tmpdir)  # clean up\n\nprint fail\n```\nprints\n\n```python\n/tmp/tmpb1LEIM [1] \"/tmp/tmpb1LEIM\" /tmp/tmpbInteger(1)EIM\n/tmp/tmpZ6LyPm [1] \"/tmp/tmpZ6LyPm\" /tmp/tmpZInteger(6)yPm\n/tmp/tmp2LTCse [1] \"/tmp/tmp2LTCse\" /tmp/tmpInteger(2)TCse\n/tmp/tmpzoor1L [1] \"/tmp/tmpzoor1L\" /tmp/tmpzoorInteger(1)\n/tmp/tmpCl70Lo [1] \"/tmp/tmpCl70Lo\" /tmp/tmpClInteger(70)o\n/tmp/tmpN7L_vQ [1] \"/tmp/tmpN7L_vQ\" /tmp/tmpNInteger(7)_vQ\n/tmp/tmp9LAnw8 [1] \"/tmp/tmp9LAnw8\" /tmp/tmpInteger(9)Anw8\n/tmp/tmpvL13LQ [1] \"/tmp/tmpvL13LQ\" /tmp/tmpvLInteger(13)Q\n/tmp/tmpfB9L8g [1] \"/tmp/tmpfB9L8g\" /tmp/tmpfBInteger(9)8g\n/tmp/tmp0LtlQ6 [1] \"/tmp/tmp0LtlQ6\" /tmp/tmpInteger(0)tlQ6\n/tmp/tmpQF4L5I [1] \"/tmp/tmpQF4L5I\" /tmp/tmpQFInteger(4)5I\n/tmp/tmp_0LOOr [1] \"/tmp/tmp_0LOOr\" /tmp/tmp_Integer(0)OOr\n/tmp/tmpdDDj7L [1] \"/tmp/tmpdDDj7L\" /tmp/tmpdDDjInteger(7)\n/tmp/tmpr0LiLu [1] \"/tmp/tmpr0LiLu\" /tmp/tmprInteger(0)iLu\n/tmp/tmpu5LnMJ [1] \"/tmp/tmpu5LnMJ\" /tmp/tmpuInteger(5)nMJ\n/tmp/tmp0Py04L [1] \"/tmp/tmp0Py04L\" /tmp/tmp0PyInteger(04)\n/tmp/tmp3LZjCk [1] \"/tmp/tmp3LZjCk\" /tmp/tmpInteger(3)ZjCk\n17\n```\non sage.math.\n\nAssignee: **mvngu**\n\nCC:  @dimpase @kcrisman @nthiery @timokau\n\nKeywords: **r**\n\nAuthor: **Willem Jan Palenstijn**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9970_\n\n",
    "created_at": "2010-09-22T22:32:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/doctest%20coverage",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Flaky doctest in sage/interfaces/r.py",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/9970",
    "user": "https://github.com/qed777"
}
```
This test in `src/sage/interfaces/r.py` should be fixed:

```
            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)
            True
```

The script

```python
import os
import tempfile

fail = 0
for i in xrange(1000):
    tmpdir = tempfile.mkdtemp()
    r.chdir(tmpdir)
    if tmpdir not in sageobj(r.getwd()):
        print tmpdir, r.getwd(), sageobj(r.getwd())
        fail += 1
    os.rmdir(tmpdir)  # clean up

print fail
```
prints

```python
/tmp/tmpb1LEIM [1] "/tmp/tmpb1LEIM" /tmp/tmpbInteger(1)EIM
/tmp/tmpZ6LyPm [1] "/tmp/tmpZ6LyPm" /tmp/tmpZInteger(6)yPm
/tmp/tmp2LTCse [1] "/tmp/tmp2LTCse" /tmp/tmpInteger(2)TCse
/tmp/tmpzoor1L [1] "/tmp/tmpzoor1L" /tmp/tmpzoorInteger(1)
/tmp/tmpCl70Lo [1] "/tmp/tmpCl70Lo" /tmp/tmpClInteger(70)o
/tmp/tmpN7L_vQ [1] "/tmp/tmpN7L_vQ" /tmp/tmpNInteger(7)_vQ
/tmp/tmp9LAnw8 [1] "/tmp/tmp9LAnw8" /tmp/tmpInteger(9)Anw8
/tmp/tmpvL13LQ [1] "/tmp/tmpvL13LQ" /tmp/tmpvLInteger(13)Q
/tmp/tmpfB9L8g [1] "/tmp/tmpfB9L8g" /tmp/tmpfBInteger(9)8g
/tmp/tmp0LtlQ6 [1] "/tmp/tmp0LtlQ6" /tmp/tmpInteger(0)tlQ6
/tmp/tmpQF4L5I [1] "/tmp/tmpQF4L5I" /tmp/tmpQFInteger(4)5I
/tmp/tmp_0LOOr [1] "/tmp/tmp_0LOOr" /tmp/tmp_Integer(0)OOr
/tmp/tmpdDDj7L [1] "/tmp/tmpdDDj7L" /tmp/tmpdDDjInteger(7)
/tmp/tmpr0LiLu [1] "/tmp/tmpr0LiLu" /tmp/tmprInteger(0)iLu
/tmp/tmpu5LnMJ [1] "/tmp/tmpu5LnMJ" /tmp/tmpuInteger(5)nMJ
/tmp/tmp0Py04L [1] "/tmp/tmp0Py04L" /tmp/tmp0PyInteger(04)
/tmp/tmp3LZjCk [1] "/tmp/tmp3LZjCk" /tmp/tmpInteger(3)ZjCk
17
```
on sage.math.

Assignee: **mvngu**

CC:  @dimpase @kcrisman @nthiery @timokau

Keywords: **r**

Author: **Willem Jan Palenstijn**

_Issue created by migration from https://trac.sagemath.org/ticket/9970_





---

archive/issue_events_114499.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-22T22:32:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114499"
}
```



---

archive/issue_events_114500.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-22T22:32:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114500"
}
```



---

archive/issue_events_114501.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-22T22:32:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114501"
}
```



---

archive/issue_events_114502.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-22T22:32:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114502"
}
```



---

archive/issue_comments_092766.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,19 +24,18 @@\n             sage: tmpdir in sageobj(r.getwd()) \n             True\n ```\n-On sage.math, I get\n+The script\n \n ```python\n-sage: import tempfile\n-sage: \n-sage: fail = 0\n-sage: for i in xrange(1000):\n-....:     tmpdir = tempfile.mkdtemp()\n-....:     r.chdir(tmpdir)\n-....:     if tmpdir not in sageobj(r.getwd()):\n-....:             fail += 1\n-....: \n-sage: print fail\n-13\n+import tempfile\n+\n+fail = 0\n+for i in xrange(1000):\n+    tmpdir = tempfile.mkdtemp()\n+    r.chdir(tmpdir)\n+    if tmpdir not in sageobj(r.getwd()):\n+        fail += 1\n+\n+print fail\n ```\n-for example.\n+prints 12, 11, 14, etc., when run repeatedly on sage.math.\n``````\n",
    "created_at": "2010-09-22T22:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92766",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,19 +24,18 @@
             sage: tmpdir in sageobj(r.getwd()) 
             True
 ```
-On sage.math, I get
+The script
 
 ```python
-sage: import tempfile
-sage: 
-sage: fail = 0
-sage: for i in xrange(1000):
-....:     tmpdir = tempfile.mkdtemp()
-....:     r.chdir(tmpdir)
-....:     if tmpdir not in sageobj(r.getwd()):
-....:             fail += 1
-....: 
-sage: print fail
-13
+import tempfile
+
+fail = 0
+for i in xrange(1000):
+    tmpdir = tempfile.mkdtemp()
+    r.chdir(tmpdir)
+    if tmpdir not in sageobj(r.getwd()):
+        fail += 1
+
+print fail
 ```
-for example.
+prints 12, 11, 14, etc., when run repeatedly on sage.math.
``````




---

archive/issue_comments_092767.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,6 +27,7 @@\n The script\n \n ```python\n+import os\n import tempfile\n \n fail = 0\n@@ -34,8 +35,32 @@\n     tmpdir = tempfile.mkdtemp()\n     r.chdir(tmpdir)\n     if tmpdir not in sageobj(r.getwd()):\n+        print tmpdir, r.getwd(), sageobj(r.getwd())\n         fail += 1\n+    os.rmdir(tmpdir)  # clean up\n \n print fail\n ```\n-prints 12, 11, 14, etc., when run repeatedly on sage.math.\n+prints\n+\n+```python\n+/tmp/tmpb1LEIM [1] \"/tmp/tmpb1LEIM\" /tmp/tmpbInteger(1)EIM\n+/tmp/tmpZ6LyPm [1] \"/tmp/tmpZ6LyPm\" /tmp/tmpZInteger(6)yPm\n+/tmp/tmp2LTCse [1] \"/tmp/tmp2LTCse\" /tmp/tmpInteger(2)TCse\n+/tmp/tmpzoor1L [1] \"/tmp/tmpzoor1L\" /tmp/tmpzoorInteger(1)\n+/tmp/tmpCl70Lo [1] \"/tmp/tmpCl70Lo\" /tmp/tmpClInteger(70)o\n+/tmp/tmpN7L_vQ [1] \"/tmp/tmpN7L_vQ\" /tmp/tmpNInteger(7)_vQ\n+/tmp/tmp9LAnw8 [1] \"/tmp/tmp9LAnw8\" /tmp/tmpInteger(9)Anw8\n+/tmp/tmpvL13LQ [1] \"/tmp/tmpvL13LQ\" /tmp/tmpvLInteger(13)Q\n+/tmp/tmpfB9L8g [1] \"/tmp/tmpfB9L8g\" /tmp/tmpfBInteger(9)8g\n+/tmp/tmp0LtlQ6 [1] \"/tmp/tmp0LtlQ6\" /tmp/tmpInteger(0)tlQ6\n+/tmp/tmpQF4L5I [1] \"/tmp/tmpQF4L5I\" /tmp/tmpQFInteger(4)5I\n+/tmp/tmp_0LOOr [1] \"/tmp/tmp_0LOOr\" /tmp/tmp_Integer(0)OOr\n+/tmp/tmpdDDj7L [1] \"/tmp/tmpdDDj7L\" /tmp/tmpdDDjInteger(7)\n+/tmp/tmpr0LiLu [1] \"/tmp/tmpr0LiLu\" /tmp/tmprInteger(0)iLu\n+/tmp/tmpu5LnMJ [1] \"/tmp/tmpu5LnMJ\" /tmp/tmpuInteger(5)nMJ\n+/tmp/tmp0Py04L [1] \"/tmp/tmp0Py04L\" /tmp/tmp0PyInteger(04)\n+/tmp/tmp3LZjCk [1] \"/tmp/tmp3LZjCk\" /tmp/tmpInteger(3)ZjCk\n+17\n+```\n+on sage.math.\n``````\n",
    "created_at": "2010-09-22T22:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92767",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,6 +27,7 @@
 The script
 
 ```python
+import os
 import tempfile
 
 fail = 0
@@ -34,8 +35,32 @@
     tmpdir = tempfile.mkdtemp()
     r.chdir(tmpdir)
     if tmpdir not in sageobj(r.getwd()):
+        print tmpdir, r.getwd(), sageobj(r.getwd())
         fail += 1
+    os.rmdir(tmpdir)  # clean up
 
 print fail
 ```
-prints 12, 11, 14, etc., when run repeatedly on sage.math.
+prints
+
+```python
+/tmp/tmpb1LEIM [1] "/tmp/tmpb1LEIM" /tmp/tmpbInteger(1)EIM
+/tmp/tmpZ6LyPm [1] "/tmp/tmpZ6LyPm" /tmp/tmpZInteger(6)yPm
+/tmp/tmp2LTCse [1] "/tmp/tmp2LTCse" /tmp/tmpInteger(2)TCse
+/tmp/tmpzoor1L [1] "/tmp/tmpzoor1L" /tmp/tmpzoorInteger(1)
+/tmp/tmpCl70Lo [1] "/tmp/tmpCl70Lo" /tmp/tmpClInteger(70)o
+/tmp/tmpN7L_vQ [1] "/tmp/tmpN7L_vQ" /tmp/tmpNInteger(7)_vQ
+/tmp/tmp9LAnw8 [1] "/tmp/tmp9LAnw8" /tmp/tmpInteger(9)Anw8
+/tmp/tmpvL13LQ [1] "/tmp/tmpvL13LQ" /tmp/tmpvLInteger(13)Q
+/tmp/tmpfB9L8g [1] "/tmp/tmpfB9L8g" /tmp/tmpfBInteger(9)8g
+/tmp/tmp0LtlQ6 [1] "/tmp/tmp0LtlQ6" /tmp/tmpInteger(0)tlQ6
+/tmp/tmpQF4L5I [1] "/tmp/tmpQF4L5I" /tmp/tmpQFInteger(4)5I
+/tmp/tmp_0LOOr [1] "/tmp/tmp_0LOOr" /tmp/tmp_Integer(0)OOr
+/tmp/tmpdDDj7L [1] "/tmp/tmpdDDj7L" /tmp/tmpdDDjInteger(7)
+/tmp/tmpr0LiLu [1] "/tmp/tmpr0LiLu" /tmp/tmprInteger(0)iLu
+/tmp/tmpu5LnMJ [1] "/tmp/tmpu5LnMJ" /tmp/tmpuInteger(5)nMJ
+/tmp/tmp0Py04L [1] "/tmp/tmp0Py04L" /tmp/tmp0PyInteger(04)
+/tmp/tmp3LZjCk [1] "/tmp/tmp3LZjCk" /tmp/tmpInteger(3)ZjCk
+17
+```
+on sage.math.
``````




---

archive/issue_comments_092768.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nThat's very interesting, thanks for pointing it out.  Since the `r.chdir()` is a pretty recent addition, it's not surprising there are unusual bugs with this.  I get the same behavior on Mac OS X 10.4, so this is not platform dependent, unsurprisingly.\n\n I am wondering whether it is simply that the directory names are preparsed or something with all those `Integer` things - maybe these 13-20 out of 1000 are the ones that have numeric characters in the alphanumeric string?.  Though `/tmp/tmp0Py04L` only has the `04` in `Integer`, not the first `0`.  Also, I get\n\n```\n/tmp/tmpooH_dP [1] \"/private/tmp/tmpooH_dP\" /private/tmp/tmpooH_dP\n/tmp/tmpLPmXNF [1] \"/private/tmp/tmpLPmXNF\" /private/tmp/tmpLPmXNF\n/tmp/tmpH7BqRp [1] \"/private/tmp/tmpH7BqRp\" /private/tmp/tmpH7BqRp\n/tmp/tmpmV9yGJ [1] \"/private/tmp/tmpmV9yGJ\" /private/tmp/tmpmV9yGJ\n/tmp/tmpZig4LH [1] \"/private/tmp/tmpZig4LH\" /private/tmp/tmpZigInteger(4)H\n```\nin printing out the first ones until I get a failure (change the `if` loop to a `while` loop, basically), and a second time\n\n```\n/tmp/tmp2Ny1fm [1] \"/private/tmp/tmp2Ny1fm\" /private/tmp/tmp2Ny1fm\n/tmp/tmpY6qCbW [1] \"/private/tmp/tmpY6qCbW\" /private/tmp/tmpY6qCbW\n/tmp/tmpQWhSyG [1] \"/private/tmp/tmpQWhSyG\" /private/tmp/tmpQWhSyG\n/tmp/tmpJnST6Z [1] \"/private/tmp/tmpJnST6Z\" /private/tmp/tmpJnST6Z\n/tmp/tmpiP3g5g [1] \"/private/tmp/tmpiP3g5g\" /private/tmp/tmpiP3g5g\n/tmp/tmpBo_DwU [1] \"/private/tmp/tmpBo_DwU\" /private/tmp/tmpBo_DwU\n/tmp/tmp0O2kjX [1] \"/private/tmp/tmp0O2kjX\" /private/tmp/tmp0O2kjX\n/tmp/tmpJzFFFs [1] \"/private/tmp/tmpJzFFFs\" /private/tmp/tmpJzFFFs\n/tmp/tmpF3eRCC [1] \"/private/tmp/tmpF3eRCC\" /private/tmp/tmpF3eRCC\n/tmp/tmp3Vd1Lg [1] \"/private/tmp/tmp3Vd1Lg\" /private/tmp/tmp3VdInteger(1)g\n```\nso that can't be the issue, at least not by itself.  The position of the integer seems irrelevant as well.",
    "created_at": "2010-09-23T00:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92768",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'>Comment 3:</a>
That's very interesting, thanks for pointing it out.  Since the `r.chdir()` is a pretty recent addition, it's not surprising there are unusual bugs with this.  I get the same behavior on Mac OS X 10.4, so this is not platform dependent, unsurprisingly.

 I am wondering whether it is simply that the directory names are preparsed or something with all those `Integer` things - maybe these 13-20 out of 1000 are the ones that have numeric characters in the alphanumeric string?.  Though `/tmp/tmp0Py04L` only has the `04` in `Integer`, not the first `0`.  Also, I get

```
/tmp/tmpooH_dP [1] "/private/tmp/tmpooH_dP" /private/tmp/tmpooH_dP
/tmp/tmpLPmXNF [1] "/private/tmp/tmpLPmXNF" /private/tmp/tmpLPmXNF
/tmp/tmpH7BqRp [1] "/private/tmp/tmpH7BqRp" /private/tmp/tmpH7BqRp
/tmp/tmpmV9yGJ [1] "/private/tmp/tmpmV9yGJ" /private/tmp/tmpmV9yGJ
/tmp/tmpZig4LH [1] "/private/tmp/tmpZig4LH" /private/tmp/tmpZigInteger(4)H
```
in printing out the first ones until I get a failure (change the `if` loop to a `while` loop, basically), and a second time

```
/tmp/tmp2Ny1fm [1] "/private/tmp/tmp2Ny1fm" /private/tmp/tmp2Ny1fm
/tmp/tmpY6qCbW [1] "/private/tmp/tmpY6qCbW" /private/tmp/tmpY6qCbW
/tmp/tmpQWhSyG [1] "/private/tmp/tmpQWhSyG" /private/tmp/tmpQWhSyG
/tmp/tmpJnST6Z [1] "/private/tmp/tmpJnST6Z" /private/tmp/tmpJnST6Z
/tmp/tmpiP3g5g [1] "/private/tmp/tmpiP3g5g" /private/tmp/tmpiP3g5g
/tmp/tmpBo_DwU [1] "/private/tmp/tmpBo_DwU" /private/tmp/tmpBo_DwU
/tmp/tmp0O2kjX [1] "/private/tmp/tmp0O2kjX" /private/tmp/tmp0O2kjX
/tmp/tmpJzFFFs [1] "/private/tmp/tmpJzFFFs" /private/tmp/tmpJzFFFs
/tmp/tmpF3eRCC [1] "/private/tmp/tmpF3eRCC" /private/tmp/tmpF3eRCC
/tmp/tmp3Vd1Lg [1] "/private/tmp/tmp3Vd1Lg" /private/tmp/tmp3VdInteger(1)g
```
so that can't be the issue, at least not by itself.  The position of the integer seems irrelevant as well.



---

archive/issue_comments_092769.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nUsing `str` instead of `sageobj` seems to work.  Of course, that doesn't explain the behavior of `sageobj` here.\n\nAside: Would we avoid the platform-dependent `/private` prefix with `sage.misc.misc.tmp_dir`?  The `sage-cleaner` would later delete the directory.",
    "created_at": "2010-09-23T01:35:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92769",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'>Comment 4:</a>
Using `str` instead of `sageobj` seems to work.  Of course, that doesn't explain the behavior of `sageobj` here.

Aside: Would we avoid the platform-dependent `/private` prefix with `sage.misc.misc.tmp_dir`?  The `sage-cleaner` would later delete the directory.



---

archive/issue_comments_092770.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nTicket #10264 is an apparent duplicate.  Jeroen Demeyer has attached a patch there.",
    "created_at": "2010-11-15T09:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92770",
    "user": "https://github.com/qed777"
}
```

<a id='comment:5'>Comment 5:</a>
Ticket #10264 is an apparent duplicate.  Jeroen Demeyer has attached a patch there.



---

archive/issue_comments_092771.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@qed777](#comment%3A5):\n> Ticket #10264 is an apparent duplicate.  Jeroen Demeyer has attached a patch there.\n\nNo, it seems to be a different problem with the same doctest.",
    "created_at": "2010-11-15T09:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92771",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@qed777](#comment%3A5):
> Ticket #10264 is an apparent duplicate.  Jeroen Demeyer has attached a patch there.

No, it seems to be a different problem with the same doctest.



---

archive/issue_events_114503.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T09:19:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114503"
}
```



---

archive/issue_comments_092772.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@qed777](#comment%3A6):\n> No, it seems to be a different problem with the same doctest.\n\nExactly.  However, in order not to get into merge conflicts, I propose that any patch for this ticket actually goes to #10264.",
    "created_at": "2010-11-15T09:19:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92772",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@qed777](#comment%3A6):
> No, it seems to be a different problem with the same doctest.

Exactly.  However, in order not to get into merge conflicts, I propose that any patch for this ticket actually goes to #10264.



---

archive/issue_comments_092773.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIf you look carefully, you notice that these errors happen exactly when there is a digit followed by the letter \"L\".",
    "created_at": "2010-11-15T09:27:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92773",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
If you look carefully, you notice that these errors happen exactly when there is a digit followed by the letter "L".



---

archive/issue_comments_092774.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@jdemeyer](#comment%3A8):\n> If you look carefully, you notice that these errors happen exactly when there is a digit followed by the letter \"L\".\n\nHah!  You got it nailed - \n\n```\n/tmp/tmp3Vd1Lg [1] \"/private/tmp/tmp3Vd1Lg\" /private/tmp/tmp3VdInteger(1)g\n```\nthe `1L` becomes `Integer(1)`.  And all of them do that.  \n\nSo it thinks we have a 'long integer' when in fact it's just a random directory.  I think maybe this is a problem in R itself, in `setwd`?",
    "created_at": "2010-11-15T19:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92774",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@jdemeyer](#comment%3A8):
> If you look carefully, you notice that these errors happen exactly when there is a digit followed by the letter "L".

Hah!  You got it nailed - 

```
/tmp/tmp3Vd1Lg [1] "/private/tmp/tmp3Vd1Lg" /private/tmp/tmp3VdInteger(1)g
```
the `1L` becomes `Integer(1)`.  And all of them do that.  

So it thinks we have a 'long integer' when in fact it's just a random directory.  I think maybe this is a problem in R itself, in `setwd`?



---

archive/issue_comments_092775.json:
```json
{
    "body": "Changed keywords from **** to **r**",
    "created_at": "2010-11-16T08:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92775",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **** to **r**



---

archive/issue_comments_092776.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@kcrisman](#comment%3A9):\n> I think maybe this is a problem in R itself, in `setwd`?\n\nI doubt it, since `r.getwd()` returns the right thing, but `sageobj(r.getwd())` not.",
    "created_at": "2010-11-16T08:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@kcrisman](#comment%3A9):
> I think maybe this is a problem in R itself, in `setwd`?

I doubt it, since `r.getwd()` returns the right thing, but `sageobj(r.getwd())` not.



---

archive/issue_comments_092777.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nIf I comment out line 1717 in `interfaces/r.py`\n\n```python\n        # Change 'dL' to 'Integer(d)'\n        exp = rel_re_integer.sub(self._subs_integer, exp)\n```\n(in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.",
    "created_at": "2010-11-17T07:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92777",
    "user": "https://github.com/qed777"
}
```

<a id='comment:11'>Comment 11:</a>
If I comment out line 1717 in `interfaces/r.py`

```python
        # Change 'dL' to 'Integer(d)'
        exp = rel_re_integer.sub(self._subs_integer, exp)
```
(in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.



---

archive/issue_comments_092778.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@qed777](#comment%3A11):\n> If I comment out line 1717 in `interfaces/r.py`\n> \n> ```python\n>         # Change 'dL' to 'Integer(d)'\n>         exp = rel_re_integer.sub(self._subs_integer, exp)\n> ```\n> (in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.\n\nBut I suppose you might get errors somewhere else?",
    "created_at": "2010-11-17T08:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92778",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@qed777](#comment%3A11):
> If I comment out line 1717 in `interfaces/r.py`
> 
> ```python
>         # Change 'dL' to 'Integer(d)'
>         exp = rel_re_integer.sub(self._subs_integer, exp)
> ```
> (in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.

But I suppose you might get errors somewhere else?



---

archive/issue_comments_092779.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@jdemeyer](#comment%3A12):\n> Replying to [@qed777](#comment%3A11):\n> > If I comment out line 1717 in `interfaces/r.py`\n> > \n> > ```python\n> >         # Change 'dL' to 'Integer(d)'\n> >         exp = rel_re_integer.sub(self._subs_integer, exp)\n> > ```\n> > (in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.\n\n> \n> But I suppose you might get errors somewhere else?\n\nYou're probably right.  I was just following up on your observation about long integers with an experiment.\n\nHow about\n\n```python\nsage: '\"%s\"' % os.path.realpath(tmpdir) == r.eval('dput(%s)' % r.getwd().name())\nTrue\n```\n?  Can we simplify this?",
    "created_at": "2010-11-26T15:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92779",
    "user": "https://github.com/qed777"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@jdemeyer](#comment%3A12):
> Replying to [@qed777](#comment%3A11):
> > If I comment out line 1717 in `interfaces/r.py`
> > 
> > ```python
> >         # Change 'dL' to 'Integer(d)'
> >         exp = rel_re_integer.sub(self._subs_integer, exp)
> > ```
> > (in `sage.interfaces.r.RElement._sage_`), I get no failures with the script in the description.

> 
> But I suppose you might get errors somewhere else?

You're probably right.  I was just following up on your observation about long integers with an experiment.

How about

```python
sage: '"%s"' % os.path.realpath(tmpdir) == r.eval('dput(%s)' % r.getwd().name())
True
```
?  Can we simplify this?



---

archive/issue_comments_092780.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nOr\n\n```python\nsage: os.path.realpath(tmpdir) in str(r.getwd())\nTrue\n```\n?",
    "created_at": "2010-11-26T15:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92780",
    "user": "https://github.com/qed777"
}
```

<a id='comment:14'>Comment 14:</a>
Or

```python
sage: os.path.realpath(tmpdir) in str(r.getwd())
True
```
?



---

archive/issue_comments_092781.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nPersonally, I am **against** changing doctests when the underlying functions are broken.  In this case, it is clearly the conversion from R to Sage which is broken, not the doctest.  By changing the doctest, we just hide the bug under the carpet instead of solving it.",
    "created_at": "2010-11-26T16:08:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92781",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
Personally, I am **against** changing doctests when the underlying functions are broken.  In this case, it is clearly the conversion from R to Sage which is broken, not the doctest.  By changing the doctest, we just hide the bug under the carpet instead of solving it.



---

archive/issue_comments_092782.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@jdemeyer](#comment%3A15):\n> Personally, I am **against** changing doctests when the underlying functions are broken.  In this case, it is clearly the conversion from R to Sage which is broken, not the doctest.  By changing the doctest, we just hide the bug under the carpet instead of solving it.\n\n+1, though the doctest tries to test something else as I understand it.",
    "created_at": "2010-12-02T12:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92782",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@jdemeyer](#comment%3A15):
> Personally, I am **against** changing doctests when the underlying functions are broken.  In this case, it is clearly the conversion from R to Sage which is broken, not the doctest.  By changing the doctest, we just hide the bug under the carpet instead of solving it.

+1, though the doctest tries to test something else as I understand it.



---

archive/issue_events_114504.json:
```json
{
    "actor": "https://github.com/wjp",
    "created_at": "2011-01-13T23:02:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114504"
}
```



---

archive/issue_comments_092783.json:
```json
{
    "body": "Author: **Willem Jan Palenstijn**",
    "created_at": "2011-01-13T23:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92783",
    "user": "https://github.com/wjp"
}
```

Author: **Willem Jan Palenstijn**



---

archive/issue_comments_092784.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nI have a patch that should fix this, but due to lack of knowledge of R I can't effectively test it. I think it needs some more doctests for the `_sage_` function.",
    "created_at": "2011-01-13T23:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92784",
    "user": "https://github.com/wjp"
}
```

<a id='comment:17'>Comment 17:</a>
I have a patch that should fix this, but due to lack of knowledge of R I can't effectively test it. I think it needs some more doctests for the `_sage_` function.



---

archive/issue_comments_092785.json:
```json
{
    "body": "Attachment: **[9970_r_strings.patch.gz](https://github.com/sagemath/sage/files/ticket9970/9970_r_strings.patch.gz)**",
    "created_at": "2011-01-13T23:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92785",
    "user": "https://github.com/wjp"
}
```

Attachment: **[9970_r_strings.patch.gz](https://github.com/sagemath/sage/files/ticket9970/9970_r_strings.patch.gz)**



---

archive/issue_comments_092786.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@wjp](#comment%3A17):\n> I have a patch that should fix this, but due to lack of knowledge of R I can't effectively test it. I think it needs some more doctests for the `_sage_` function.\n\nI will eventually look at this, but because it's a rather harmless doctest failure (even though we really don't like doctest failures) I won't be able to check it out very quickly.  \n\nI'm also putting your request from sage-devel here for reference as to what you think is needed for review - thanks!\n\n```\nIf somebody more familiar with the R language and interface could take a look \nif the string-related corner cases work, and if it didn't break anything \nnon-string-related (and maybe add some more doctests to the _sage_ method), \nthat would be great. \n```",
    "created_at": "2011-01-14T01:48:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92786",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@wjp](#comment%3A17):
> I have a patch that should fix this, but due to lack of knowledge of R I can't effectively test it. I think it needs some more doctests for the `_sage_` function.

I will eventually look at this, but because it's a rather harmless doctest failure (even though we really don't like doctest failures) I won't be able to check it out very quickly.  

I'm also putting your request from sage-devel here for reference as to what you think is needed for review - thanks!

```
If somebody more familiar with the R language and interface could take a look 
if the string-related corner cases work, and if it didn't break anything 
non-string-related (and maybe add some more doctests to the _sage_ method), 
that would be great. 
```



---

archive/issue_comments_092787.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nThis is still a very annoying bug.",
    "created_at": "2013-02-04T13:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92787",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>Comment 19:</a>
This is still a very annoying bug.



---

archive/issue_events_114505.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-04T13:14:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114505"
}
```



---

archive/issue_events_114506.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-04T13:14:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114506"
}
```



---

archive/issue_events_114507.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:10:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114507"
}
```



---

archive/issue_events_114508.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:10:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114508"
}
```



---

archive/issue_comments_092788.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBy #12415, a remark was added in r.py, pointing to this ticket:\n\n```\n            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)\n            True\n```\n\nNote that in #12876, Nicolas changes the test by inserting os.path.realpath on the right side as well, hence:\n\n```\n            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))\n            True\n```\n\nI don't know if this test is all what this ticket is about. So, please decide yourself if this ticket became a duplicate (or actually a sub-problem) of #12876",
    "created_at": "2013-05-23T20:10:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92788",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:20'>Comment 20:</a>
By #12415, a remark was added in r.py, pointing to this ticket:

```
            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)
            True
```

Note that in #12876, Nicolas changes the test by inserting os.path.realpath on the right side as well, hence:

```
            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))
            True
```

I don't know if this test is all what this ticket is about. So, please decide yourself if this ticket became a duplicate (or actually a sub-problem) of #12876



---

archive/issue_comments_092789.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nUnrelated as far as I can tell.",
    "created_at": "2013-05-23T20:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92789",
    "user": "https://github.com/wjp"
}
```

<a id='comment:21'>Comment 21:</a>
Unrelated as far as I can tell.



---

archive/issue_comments_092790.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@wjp](#comment%3A21):\n> Unrelated as far as I can tell.\n\nOK, then the ticket status should probably reverted (it has been \"needs work\").\n\nIn any case, it seems that #12876 needs this change to make the doctest failure vanish. I suggest that a \"todo\" is added, referring to this ticket, stating that the doctest fix from #12876 is not a fix of the underlying problem, which is dealt with here.",
    "created_at": "2013-05-23T20:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92790",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@wjp](#comment%3A21):
> Unrelated as far as I can tell.

OK, then the ticket status should probably reverted (it has been "needs work").

In any case, it seems that #12876 needs this change to make the doctest failure vanish. I suggest that a "todo" is added, referring to this ticket, stating that the doctest fix from #12876 is not a fix of the underlying problem, which is dealt with here.



---

archive/issue_events_114509.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:55:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114509"
}
```



---

archive/issue_events_114510.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:55:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114510"
}
```



---

archive/issue_events_114511.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:55:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114511"
}
```



---

archive/issue_events_114512.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-23T20:55:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114512"
}
```



---

archive/issue_comments_092791.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@simon-king-jena](#comment%3A22):\n> In any case, it seems that #12876 needs this change to make the doctest failure vanish.\n\nAre you sure, because I don't see what #12876 has to do with either the conversion from R to Sage or with filesystem paths.",
    "created_at": "2013-05-24T06:30:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92791",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@simon-king-jena](#comment%3A22):
> In any case, it seems that #12876 needs this change to make the doctest failure vanish.

Are you sure, because I don't see what #12876 has to do with either the conversion from R to Sage or with filesystem paths.



---

archive/issue_comments_092792.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@jdemeyer](#comment%3A24):\n> Replying to [@simon-king-jena](#comment%3A22):\n> > In any case, it seems that #12876 needs this change to make the doctest failure vanish.\n\n> Are you sure, because I don't see what #12876 has to do with either the conversion from R to Sage or with filesystem paths.\n\nWell, at least it used to need it. If I recall correctly, at the time when I created the first version of this patch, we got a consistent error in the test, and with the patch the error consistently vanished.\n\nHowever, as I've learned today, the tests also pass without this patch. So, we should drop it.",
    "created_at": "2013-05-24T07:02:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92792",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@jdemeyer](#comment%3A24):
> Replying to [@simon-king-jena](#comment%3A22):
> > In any case, it seems that #12876 needs this change to make the doctest failure vanish.

> Are you sure, because I don't see what #12876 has to do with either the conversion from R to Sage or with filesystem paths.

Well, at least it used to need it. If I recall correctly, at the time when I created the first version of this patch, we got a consistent error in the test, and with the patch the error consistently vanished.

However, as I've learned today, the tests also pass without this patch. So, we should drop it.



---

archive/issue_events_114513.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114513"
}
```



---

archive/issue_events_114514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114514"
}
```



---

archive/issue_events_114515.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114515"
}
```



---

archive/issue_events_114516.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114516"
}
```



---

archive/issue_events_114517.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114517"
}
```



---

archive/issue_events_114518.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114518"
}
```



---

archive/issue_events_114519.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114519"
}
```



---

archive/issue_events_114520.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114520"
}
```



---

archive/issue_events_114521.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-10T08:57:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114521"
}
```



---

archive/issue_events_114522.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-10T08:57:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114522"
}
```



---

archive/issue_comments_092793.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@simon-king-jena](#comment%3A25):\n> However, as I've learned today, the tests also pass without this patch. So, we should drop it.\n\nSo should this ticket be closed as invalid?",
    "created_at": "2015-02-10T08:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92793",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@simon-king-jena](#comment%3A25):
> However, as I've learned today, the tests also pass without this patch. So, we should drop it.

So should this ticket be closed as invalid?



---

archive/issue_comments_092794.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@mezzarobba](#comment%3A30):\n> So should this ticket be closed as invalid?\n\n**NO**",
    "created_at": "2015-02-10T09:26:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92794",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@mezzarobba](#comment%3A30):
> So should this ticket be closed as invalid?

**NO**



---

archive/issue_comments_092795.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,29 +1,10 @@\n-[Dima Pasechnik reports on sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/01a01378099b9d5e/3fe4b83c4c612663#3fe4b83c4c612663):\n+This test in `src/sage/interfaces/r.py` should be fixed:\n \n ```\n-Builds and tests OK on Linux amd64 (Debian unstable). Got one test failure:\n-\n-sage -t  \"devel/sage/sage/interfaces/r.py\"\n-**********************************************************************\n-File \"/usr/local/src/sage/sage-4.6.alpha1/devel/sage/sage/interfaces/r.py\", line 1128:\n-    sage: tmpdir in sageobj(r.getwd())\n-Expected:\n-    True\n-Got:\n-    False\n-\n-that however would  not repeat if I tested again...\n+            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)\n+            True\n ```\n \n-I've also seen this error, on occasion.  The test lines are\n-\n-```python\n-            sage: import tempfile\n-            sage: tmpdir = tempfile.mkdtemp()\n-            sage: r.chdir(tmpdir)\n-            sage: tmpdir in sageobj(r.getwd()) \n-            True\n-```\n The script\n \n ```python\n``````\n",
    "created_at": "2015-02-10T09:28:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92795",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,29 +1,10 @@
-[Dima Pasechnik reports on sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/01a01378099b9d5e/3fe4b83c4c612663#3fe4b83c4c612663):
+This test in `src/sage/interfaces/r.py` should be fixed:
 
 ```
-Builds and tests OK on Linux amd64 (Debian unstable). Got one test failure:
-
-sage -t  "devel/sage/sage/interfaces/r.py"
-**********************************************************************
-File "/usr/local/src/sage/sage-4.6.alpha1/devel/sage/sage/interfaces/r.py", line 1128:
-    sage: tmpdir in sageobj(r.getwd())
-Expected:
-    True
-Got:
-    False
-
-that however would  not repeat if I tested again...
+            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)
+            True
 ```
 
-I've also seen this error, on occasion.  The test lines are
-
-```python
-            sage: import tempfile
-            sage: tmpdir = tempfile.mkdtemp()
-            sage: r.chdir(tmpdir)
-            sage: tmpdir in sageobj(r.getwd()) 
-            True
-```
 The script
 
 ```python
``````




---

archive/issue_events_114523.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-10T10:25:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114523"
}
```



---

archive/issue_events_114524.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2015-02-10T10:25:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114524"
}
```



---

archive/issue_events_114525.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-02-10T11:16:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114525"
}
```



---

archive/issue_events_114526.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-02-10T11:16:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114526"
}
```



---

archive/issue_comments_092796.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nAs of Sage 8.5 I no longer get errors from the script above, so presumably \"known bug\" can be removed.\n\nHowever, `r.chdir` and `os.chdir` now do the same thing, i.e. the current directory for R and Sage is the same, which suggests to me that this function should be deprecated entirely. Unless it is desirable to be able to set different directories, in which case this has to be reimplemented.",
    "created_at": "2018-12-24T15:39:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92796",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:35'>Comment 35:</a>
As of Sage 8.5 I no longer get errors from the script above, so presumably "known bug" can be removed.

However, `r.chdir` and `os.chdir` now do the same thing, i.e. the current directory for R and Sage is the same, which suggests to me that this function should be deprecated entirely. Unless it is desirable to be able to set different directories, in which case this has to be reimplemented.



---

archive/issue_comments_092797.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nTimo - am I right that with rpy2 interface the working directory of python and R are always the same and so `r.chdir` does not really make sense anymore?",
    "created_at": "2019-01-08T21:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92797",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:36'>Comment 36:</a>
Timo - am I right that with rpy2 interface the working directory of python and R are always the same and so `r.chdir` does not really make sense anymore?



---

archive/issue_comments_092798.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nYes that is right. I wasn't aware that there was a difference before. I think sharing a working directory is actually less confusing. You're right that `r.chdir` should be removed if we don't want to restore the old behaviour.",
    "created_at": "2019-01-08T21:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92798",
    "user": "https://github.com/timokau"
}
```

<a id='comment:37'>Comment 37:</a>
Yes that is right. I wasn't aware that there was a difference before. I think sharing a working directory is actually less confusing. You're right that `r.chdir` should be removed if we don't want to restore the old behaviour.



---

archive/issue_events_114527.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2020-10-08T09:36:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114527"
}
```



---

archive/issue_events_114528.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2020-10-08T09:36:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114528"
}
```



---

archive/issue_comments_092799.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\ndowngrading priority to minor in view of the last comments",
    "created_at": "2020-10-08T09:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92799",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:38'>Comment 38:</a>
downgrading priority to minor in view of the last comments



---

archive/issue_events_114529.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2020-10-08T09:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114529"
}
```



---

archive/issue_events_114530.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2020-10-08T09:36:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114530"
}
```



---

archive/issue_comments_092800.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92800",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'>Comment 39:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_114531.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114531"
}
```



---

archive/issue_events_114532.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114532"
}
```



---

archive/issue_comments_092801.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9970#issuecomment-92801",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'>Comment 40:</a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_114533.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114533"
}
```



---

archive/issue_events_114534.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114534"
}
```



---

archive/issue_events_114535.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114535"
}
```



---

archive/issue_events_114536.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114536"
}
```



---

archive/issue_events_114537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114537"
}
```



---

archive/issue_events_114538.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114538"
}
```



---

archive/issue_events_114539.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114539"
}
```



---

archive/issue_events_114540.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9970",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9970#event-114540"
}
```
