# Issue 9345: Unhandled SIGFPE in rational_reconstruction if the modulus is zero

archive/issues_009345.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Sage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm\n\n```\nsage: rational_reconstruction(1,0)\n\n\n------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occured in Sage.\nThis probably occured because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n```\n\n**Apply:** [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)\n\nCC:  @jdemeyer\n\nComponent: **algebra**\n\nAuthor: **Luis Felipe Tabera Alonso**\n\nReviewer: **Minh Van Nguyen, Jeroen Demeyer**\n\nMerged: **sage-4.6.1.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9345_\n\n",
    "closed_at": "2010-11-15T23:26:25Z",
    "created_at": "2010-06-26T10:42:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.6.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Unhandled SIGFPE in rational_reconstruction if the modulus is zero",
    "type": "issue",
    "updated_at": "2010-11-15T23:26:25Z",
    "url": "https://github.com/sagemath/sage/issues/9345",
    "user": "https://github.com/lftabera"
}
```
Sage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm

```
sage: rational_reconstruction(1,0)


------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occured in Sage.
This probably occured because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```

**Apply:** [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)

CC:  @jdemeyer

Component: **algebra**

Author: **Luis Felipe Tabera Alonso**

Reviewer: **Minh Van Nguyen, Jeroen Demeyer**

Merged: **sage-4.6.1.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/9345_





---

archive/issue_events_118546.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T10:42:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118546"
}
```



---

archive/issue_events_118547.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T10:42:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118547"
}
```



---

archive/issue_events_118548.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T10:42:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118548"
}
```



---

archive/issue_events_118549.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T10:42:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118549"
}
```



---

archive/issue_events_118550.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2010-06-26T10:42:28Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "subject": "https://github.com/lftabera",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118550"
}
```



---

archive/issue_events_118551.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T10:51:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118551"
}
```



---

archive/issue_comments_079546.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_9345.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.patch.gz)**",
    "created_at": "2010-06-26T10:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79546",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_9345.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.patch.gz)**



---

archive/issue_comments_079547.json:
```json
{
    "body": "Attachment: **[trac_9345.2.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)**",
    "created_at": "2010-06-26T11:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79547",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Attachment: **[trac_9345.2.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)**



---

archive/issue_comments_079548.json:
```json
{
    "body": "Reviewer: **Minh Van Nguyen**",
    "created_at": "2010-06-26T11:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79548",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Reviewer: **Minh Van Nguyen**



---

archive/issue_events_118552.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-06-26T11:40:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "title_is": "Unhandled SIGFPE in rational_reconstruction if the modulus is zero",
    "title_was": "Unhandled SIGFPE is rational_reconstruction if the modulus is zero",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118552"
}
```



---

archive/issue_comments_079549.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Ssage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm\n+Sage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm\n \n ```\n sage: rational_reconstruction(1,0)\n@@ -12,5 +12,9 @@\n You might want to run Sage under gdb with 'sage -gdb' to debug this.\n Sage will now terminate (sorry).\n ------------------------------------------------------------\n+```\n \n-```\n+**Apply:**\n+\n+1. [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)\n+2. [trac_9345-reviewer.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)\n``````\n",
    "created_at": "2010-06-26T11:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79549",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Ssage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm
+Sage crashes if try to perform a rational_reconstruction with zero modulus and compiled fast algorithm
 
 ```
 sage: rational_reconstruction(1,0)
@@ -12,5 +12,9 @@
 You might want to run Sage under gdb with 'sage -gdb' to debug this.
 Sage will now terminate (sorry).
 ------------------------------------------------------------
+```
 
-```
+**Apply:**
+
+1. [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)
+2. [trac_9345-reviewer.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)
``````




---

archive/issue_comments_079550.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[trac_9345-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)**\n\nI'm mostly OK with lftabera's patch. Here are some changes that needs to be made:\n\n* Reference the ticket number in the relevant regression test.\n* Use the Python 3.x compliant way of raising exceptions.\n* Add a more general regression test.\n* Credit lftabera in his patch. (We don't accept anonymous patches.) Put a sensible commit message in lftabera's patch. So one now uses [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz) instead of [trac_9345.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.patch.gz). \n\nSee the ticket description for instructions on how to apply the relevant patches. Only my proposed changes need review by anyone but me. If they are OK, then the whole ticket receives a positive review.",
    "created_at": "2010-06-26T11:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79550",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[trac_9345-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)**

I'm mostly OK with lftabera's patch. Here are some changes that needs to be made:

* Reference the ticket number in the relevant regression test.
* Use the Python 3.x compliant way of raising exceptions.
* Add a more general regression test.
* Credit lftabera in his patch. (We don't accept anonymous patches.) Put a sensible commit message in lftabera's patch. So one now uses [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz) instead of [trac_9345.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.patch.gz). 

See the ticket description for instructions on how to apply the relevant patches. Only my proposed changes need review by anyone but me. If they are OK, then the whole ticket receives a positive review.



---

archive/issue_comments_079551.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNot quite solved, the problem is not in this method, but in the compiled rational reconstruction\n\n```\nsage: ZZ(1).rational_reconstruction(0)\n\n\n------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occured in Sage.\nThis probably occured because a *compiled* component\nof Sage has a bug in it (typically accessing invalid memory)\nor is not properly wrapped with _sig_on, _sig_off.\nYou might want to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate (sorry).\n------------------------------------------------------------\n```\n\nI will update the patch to the correct function",
    "created_at": "2010-06-26T11:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79551",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:3" align="right">comment:3</div>

Not quite solved, the problem is not in this method, but in the compiled rational reconstruction

```
sage: ZZ(1).rational_reconstruction(0)


------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occured in Sage.
This probably occured because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```

I will update the patch to the correct function



---

archive/issue_events_118553.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T11:51:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118553"
}
```



---

archive/issue_events_118554.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-06-26T11:51:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118554"
}
```



---

archive/issue_comments_079552.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe following files have a call to rational_reconstruction, computed using\n\n```\nsage: search_src('rational_reconstruction',interact=False)\n\n```\nand code to make Sage crash\n\n* rings/integer.pyx\n\n```\n sage: ZZ(1).rational_reconstruction(0)\n```\n  Calls rational.pyrex_rational_reconstruction\n\n* rings/rational.pyx\n\n```\n sage: sage.rings.rational.pyrex_rational_reconstruction(1,0)\n```\n* rings/arith.py\n\n```\n sage: rational_reconstruction(1,0)\n```\n  Calls ZZ.rational_reconstruction\n\n* rings/finite_rings/element_ext_pari.py\n\n  Unable to crash, it is an element of a finite field. Anyway, it calls arith.rational_reconstruction\n\n* rings/finite_rings/integer_mod.pyx\n\n  Unable to crash, an element mod 0 is an Integer. Anyway, it calls ZZ.rational_reconstruction\n\n* rings/padics/padic_generic_element.pyx\n\n  Unable to crash, modulus of a p-adic element is not zero. anyway, it calls arith.rational_reconstruction\n\n* matrix/matrix_rational_dense.pyx\n\n1. _lift_crt_rr\n2. _lift_crt_rr_with_lcm\n\n\n   Obsolete functions for crt? They seem not to be used anywhere. By the code, it seems tha mm should be a list of moduli matrices (call of _lift_crt). On the other hand, the product should be an integer \nm= mm.prod(); mpq_rational_reconstruction(Q_row[j], Z_row[j], m.value) So I cannot test whether there is a problem for these functions. I am not able to get crashes or any sensible output from these functions.\n\n* matrix/matrix_integer_sparse.pyx\n\n```\n sage: M = random_matrix(ZZ, 3, 3, 'sparse')\n sage: M.rational_reconstruction()\n```\n  Calls misc.matrix_integer_sparse_rational_reconstruction\n\n* matrix/misc.pyx\n\n```\n sage: M = random_matrix(ZZ, 3, 3, 'sparse')\n sage: sage.matrix.misc.matrix_integer_sparse_rational_reconstruction(M,0)\n```\n\n```\n sage: M = random_matrix(ZZ, 3, 3)\n sage: sage.matrix.misc.matrix_integer_dense_rational_reconstruction(M,0)\n```\n* matrix/matrix_cyclo_dense.pyx\n\n  Unable to crash. Used in a modular algorithm, calls misc.matrix_integer_dense_rational_reconstruction\n\n* matrix/matrix_integer_dense.pyx\n\n```\n sage: M = random_matrix(ZZ,3)\n sage: M.rational_reconstruction(0)\n```\n  Calls misc.matrix_integer_dense_rational_reconstruction",
    "created_at": "2010-06-30T13:55:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79552",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:4" align="right">comment:4</div>

The following files have a call to rational_reconstruction, computed using

```
sage: search_src('rational_reconstruction',interact=False)

```
and code to make Sage crash

* rings/integer.pyx

```
 sage: ZZ(1).rational_reconstruction(0)
```
  Calls rational.pyrex_rational_reconstruction

* rings/rational.pyx

```
 sage: sage.rings.rational.pyrex_rational_reconstruction(1,0)
```
* rings/arith.py

```
 sage: rational_reconstruction(1,0)
```
  Calls ZZ.rational_reconstruction

* rings/finite_rings/element_ext_pari.py

  Unable to crash, it is an element of a finite field. Anyway, it calls arith.rational_reconstruction

* rings/finite_rings/integer_mod.pyx

  Unable to crash, an element mod 0 is an Integer. Anyway, it calls ZZ.rational_reconstruction

* rings/padics/padic_generic_element.pyx

  Unable to crash, modulus of a p-adic element is not zero. anyway, it calls arith.rational_reconstruction

* matrix/matrix_rational_dense.pyx

1. _lift_crt_rr
2. _lift_crt_rr_with_lcm


   Obsolete functions for crt? They seem not to be used anywhere. By the code, it seems tha mm should be a list of moduli matrices (call of _lift_crt). On the other hand, the product should be an integer 
m= mm.prod(); mpq_rational_reconstruction(Q_row[j], Z_row[j], m.value) So I cannot test whether there is a problem for these functions. I am not able to get crashes or any sensible output from these functions.

* matrix/matrix_integer_sparse.pyx

```
 sage: M = random_matrix(ZZ, 3, 3, 'sparse')
 sage: M.rational_reconstruction()
```
  Calls misc.matrix_integer_sparse_rational_reconstruction

* matrix/misc.pyx

```
 sage: M = random_matrix(ZZ, 3, 3, 'sparse')
 sage: sage.matrix.misc.matrix_integer_sparse_rational_reconstruction(M,0)
```

```
 sage: M = random_matrix(ZZ, 3, 3)
 sage: sage.matrix.misc.matrix_integer_dense_rational_reconstruction(M,0)
```
* matrix/matrix_cyclo_dense.pyx

  Unable to crash. Used in a modular algorithm, calls misc.matrix_integer_dense_rational_reconstruction

* matrix/matrix_integer_dense.pyx

```
 sage: M = random_matrix(ZZ,3)
 sage: M.rational_reconstruction(0)
```
  Calls misc.matrix_integer_dense_rational_reconstruction



---

archive/issue_comments_079553.json:
```json
{
    "body": "Attachment: **[trac_9345.3.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)**\n\nprevious patches merged",
    "created_at": "2010-07-02T10:07:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79553",
    "user": "https://github.com/lftabera"
}
```

Attachment: **[trac_9345.3.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)**

previous patches merged



---

archive/issue_comments_079554.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNew patch with all the modifications. Respecting the code, the patch only changes rings/rational.pyx and matrix/misc.pyx where the offending code is.\n\nHowever, I have added doctests to check all the crashes in the previous post. This might be overkilling though.",
    "created_at": "2010-07-02T10:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79554",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:5" align="right">comment:5</div>

New patch with all the modifications. Respecting the code, the patch only changes rings/rational.pyx and matrix/misc.pyx where the offending code is.

However, I have added doctests to check all the crashes in the previous post. This might be overkilling though.



---

archive/issue_events_118555.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-07-02T10:11:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118555"
}
```



---

archive/issue_events_118556.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-07-02T10:11:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118556"
}
```



---

archive/issue_comments_079555.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,5 +16,4 @@\n \n **Apply:**\n \n-1. [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)\n-2. [trac_9345-reviewer.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)\n+1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)\n``````\n",
    "created_at": "2010-07-02T10:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79555",
    "user": "https://github.com/lftabera"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,5 +16,4 @@
 
 **Apply:**
 
-1. [trac_9345.2.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.2.patch.gz)
-2. [trac_9345-reviewer.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345-reviewer.patch.gz)
+1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)
``````




---

archive/issue_events_118557.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-08-10T06:15:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118557"
}
```



---

archive/issue_events_118558.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-08-10T06:15:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118558"
}
```



---

archive/issue_comments_079556.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think one should find out which code really causes the crash, because _sig_on/_sig_off should be used there.  See [http://sagemath.org/doc/developer/coding_in_other.html#the-pari-c-library-interface](http://sagemath.org/doc/developer/coding_in_other.html#the-pari-c-library-interface) (the docs are about PARI but apply more generally to all C and Cython code).",
    "created_at": "2010-08-10T06:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79556",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

I think one should find out which code really causes the crash, because _sig_on/_sig_off should be used there.  See [http://sagemath.org/doc/developer/coding_in_other.html#the-pari-c-library-interface](http://sagemath.org/doc/developer/coding_in_other.html#the-pari-c-library-interface) (the docs are about PARI but apply more generally to all C and Cython code).



---

archive/issue_events_118559.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-06T09:03:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118559"
}
```



---

archive/issue_events_118560.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-09-06T09:03:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118560"
}
```



---

archive/issue_comments_079557.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac-9345-sigs.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs.patch.gz)**\n\nWell, there was a similar problem in #9357 and I got this answer to the question of _sig_onm, _sig_off\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/e8317365bfe9e6e8/2a4148024500dfd2\n\nNote that if the exception is controlled by _sig, it will raise a RuntimeError instead of ZeroDivisionError. Moreover, with the patch I provided, all ocurrences of being zero are catched and never reaches the C functions.\n\nAnyway, I have written a second patch that add the _sig_on, _sig_off to the problematic functions, so if they have to be added, apply the following patches (in order):\n\ntrac_9345.3.patch\ntrac-9345-sigs.patch",
    "created_at": "2010-09-06T09:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79557",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac-9345-sigs.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs.patch.gz)**

Well, there was a similar problem in #9357 and I got this answer to the question of _sig_onm, _sig_off

http://groups.google.com/group/sage-devel/browse_thread/thread/e8317365bfe9e6e8/2a4148024500dfd2

Note that if the exception is controlled by _sig, it will raise a RuntimeError instead of ZeroDivisionError. Moreover, with the patch I provided, all ocurrences of being zero are catched and never reaches the C functions.

Anyway, I have written a second patch that add the _sig_on, _sig_off to the problematic functions, so if they have to be added, apply the following patches (in order):

trac_9345.3.patch
trac-9345-sigs.patch



---

archive/issue_comments_079558.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@lftabera](#comment%3A7):\n> Note that if the exception is controlled by _sig, it will raise a RuntimeError instead of ZeroDivisionError. Moreover, with the patch I provided, all ocurrences of being zero are catched and never reaches the C functions.\n\nI agree that your patch fixes the problem of division by zero, that wasn't my point.  My point was that, **in addition** you should add _sig_on and _sig_off to make the code more robust (for example, against crtl+C).\n\n> Anyway, I have written a second patch that add the _sig_on, _sig_off to the problematic functions, so if they have to be added, apply the following patches (in order):\n> \n> trac_9345.3.patch\n> trac-9345-sigs.patch\n\nWell, the _sig_on and _sig_off are in the wrong places (_sig_on should be before any mpz or mpq function is called and _sig_off after). I can have a look at this if you want.",
    "created_at": "2010-09-06T10:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79558",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@lftabera](#comment%3A7):
> Note that if the exception is controlled by _sig, it will raise a RuntimeError instead of ZeroDivisionError. Moreover, with the patch I provided, all ocurrences of being zero are catched and never reaches the C functions.

I agree that your patch fixes the problem of division by zero, that wasn't my point.  My point was that, **in addition** you should add _sig_on and _sig_off to make the code more robust (for example, against crtl+C).

> Anyway, I have written a second patch that add the _sig_on, _sig_off to the problematic functions, so if they have to be added, apply the following patches (in order):
> 
> trac_9345.3.patch
> trac-9345-sigs.patch

Well, the _sig_on and _sig_off are in the wrong places (_sig_on should be before any mpz or mpq function is called and _sig_off after). I can have a look at this if you want.



---

archive/issue_events_118561.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-06T10:33:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118561"
}
```



---

archive/issue_events_118562.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-09-06T10:33:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "milestone_number": null,
    "milestone_title": "sage-4.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118562"
}
```



---

archive/issue_comments_079559.json:
```json
{
    "body": "Attachment: **[trac-9345-sigs-jd.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd.patch.gz)**\n\nBetter alternative to trac-9345-sigs.patch",
    "created_at": "2010-09-07T20:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79559",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac-9345-sigs-jd.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd.patch.gz)**

Better alternative to trac-9345-sigs.patch



---

archive/issue_comments_079560.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@lftabera](#comment%3A5):\n> However, I have added doctests to check all the crashes in the previous post. This might be overkilling though.\n\nI agree that it is overkill, but I'm fine with it.  I'm giving positive_review for `trac_9345.3.patch`. Somebody else should review my `trac-9345-sigs-jd.patch`.",
    "created_at": "2010-09-07T21:01:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79560",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@lftabera](#comment%3A5):
> However, I have added doctests to check all the crashes in the previous post. This might be overkilling though.

I agree that it is overkill, but I'm fine with it.  I'm giving positive_review for `trac_9345.3.patch`. Somebody else should review my `trac-9345-sigs-jd.patch`.



---

archive/issue_comments_079561.json:
```json
{
    "body": "Changed reviewer from **Minh Van Nguyen** to **Minh Van Nguyen, Jeroen Demeyer**",
    "created_at": "2010-09-07T21:01:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79561",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Minh Van Nguyen** to **Minh Van Nguyen, Jeroen Demeyer**



---

archive/issue_comments_079562.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,3 +17,6 @@\n **Apply:**\n \n 1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)\n+ \n+2.\n+[trac-9345-sigs-jd-2.patch](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)\n``````\n",
    "created_at": "2010-09-08T08:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79562",
    "user": "https://github.com/lftabera"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,3 +17,6 @@
 **Apply:**
 
 1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)
+ 
+2.
+[trac-9345-sigs-jd-2.patch](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)
``````




---

archive/issue_comments_079563.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAttachment: **[trac-9345-sigs-jd-2.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)**\n\nI have corrected jdemeyer patch to also  include the sparse matrix case. The patch to review is trac-9345-sigs-jd-2.patch",
    "created_at": "2010-09-08T08:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79563",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:10" align="right">comment:10</div>

Attachment: **[trac-9345-sigs-jd-2.patch.gz](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)**

I have corrected jdemeyer patch to also  include the sparse matrix case. The patch to review is trac-9345-sigs-jd-2.patch



---

archive/issue_comments_079564.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@lftabera](#comment%3A10):\n> I have corrected jdemeyer patch to also  include the sparse matrix case. The patch to review is trac-9345-sigs-jd-2.patch\n\nLooks good to me, but I suppose somebody else should formally review it.",
    "created_at": "2010-09-08T12:02:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79564",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@lftabera](#comment%3A10):
> I have corrected jdemeyer patch to also  include the sparse matrix case. The patch to review is trac-9345-sigs-jd-2.patch

Looks good to me, but I suppose somebody else should formally review it.



---

archive/issue_comments_079565.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,9 +14,4 @@\n ------------------------------------------------------------\n ```\n \n-**Apply:**\n-\n-1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)\n- \n-2.\n-[trac-9345-sigs-jd-2.patch](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)\n+**Apply:** [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)\n``````\n",
    "created_at": "2010-11-13T10:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79565",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,9 +14,4 @@
 ------------------------------------------------------------
 ```
 
-**Apply:**
-
-1. [trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)
- 
-2.
-[trac-9345-sigs-jd-2.patch](https://github.com/sagemath/sage/files/ticket9345/trac-9345-sigs-jd-2.patch.gz)
+**Apply:** [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)
``````




---

archive/issue_comments_079566.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI will move the signals part to #10061, therefore positive review for [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)",
    "created_at": "2010-11-13T10:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79566",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

I will move the signals part to #10061, therefore positive review for [attachment: trac_9345.3.patch](https://github.com/sagemath/sage/files/ticket9345/trac_9345.3.patch.gz)



---

archive/issue_events_118563.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-13T10:43:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118563"
}
```



---

archive/issue_events_118564.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-13T10:43:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118564"
}
```



---

archive/issue_comments_079567.json:
```json
{
    "body": "Merged: **sage-4.6.1.alpha2**",
    "created_at": "2010-11-15T23:26:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9345#issuecomment-79567",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.6.1.alpha2**



---

archive/issue_events_118565.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T23:26:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118565"
}
```



---

archive/issue_events_118566.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-15T23:26:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9345",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9345#event-118566"
}
```
