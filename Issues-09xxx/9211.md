# Issue 9211: graph vertices cut off

archive/issues_009211.json:
```json
{
    "body": "Though #7299 helped, graph vertices are still cut off.\n\nWe can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').\n\n---\nFirst apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to `$SAGE_ROOT/devel/sage`. Finally apply [attachment:trac_9211-fix_doctests.patch] to `$SAGE_ROOT/devel/sage`.\n\n**Assignee:** @jasongrout, mvngu, @nathanncohen, @rlmill\n\n**CC:**  @rbeezer @kcrisman @kini\n\n**Author:** Jason Grout\n\n**Reviewer:** Punarbasu Purkayastha\n\n**Merged:** sage-4.8.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/9211\n\n",
    "closed_at": "2011-11-07T10:10:28Z",
    "created_at": "2010-06-11T06:48:32Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "graph vertices cut off",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9211",
    "user": "https://github.com/jasongrout"
}
```
Though #7299 helped, graph vertices are still cut off.

We can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').

---
First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to `$SAGE_ROOT/devel/sage`. Finally apply [attachment:trac_9211-fix_doctests.patch] to `$SAGE_ROOT/devel/sage`.

**Assignee:** @jasongrout, mvngu, @nathanncohen, @rlmill

**CC:**  @rbeezer @kcrisman @kini

**Author:** Jason Grout

**Reviewer:** Punarbasu Purkayastha

**Merged:** sage-4.8.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/9211





---

archive/issue_comments_080520.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere is a good example showing the problem (still):\n\n```\na=matrix([[1,2],[3,4]])\n\nvar('x y z w')\nb=matrix([[x,y],[z,w]])\n\na.set_immutable()\nb.set_immutable()\n\nK=DiGraph({a:[b]})\nshow(K, vertex_size=800)\n\n```",
    "created_at": "2010-06-11T06:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80520",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
Here is a good example showing the problem (still):

```
a=matrix([[1,2],[3,4]])

var('x y z w')
b=matrix([[x,y],[z,w]])

a.set_immutable()
b.set_immutable()

K=DiGraph({a:[b]})
show(K, vertex_size=800)

```



---

archive/attachments_011606.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-9211-graph-vertices-cut.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/trac-9211-graph-vertices-cut.patch",
    "created_at": "2010-06-12T21:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_080521.json:
```json
{
    "body": "",
    "created_at": "2010-06-12T21:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80521",
    "user": "https://github.com/jasongrout"
}
```





---

archive/issue_comments_080522.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch depends on the matplotlib spkg at #9221.  I don't know if the patch is very elegant.  I'll trust the reviewer's comments on that.  The problem is that it lets the scatter plot vertices extend beyond the frame (relying on the user adjusting the axes_pad option to extend the frame).",
    "created_at": "2010-06-12T21:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80522",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
This patch depends on the matplotlib spkg at #9221.  I don't know if the patch is very elegant.  I'll trust the reviewer's comments on that.  The problem is that it lets the scatter plot vertices extend beyond the frame (relying on the user adjusting the axes_pad option to extend the frame).



---

archive/issue_events_068806.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-06-12T21:24:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68806"
}
```



---

archive/issue_comments_080523.json:
```json
{
    "body": "**Author:** Jason Grout",
    "created_at": "2010-06-12T21:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80523",
    "user": "https://github.com/jasongrout"
}
```

**Author:** Jason Grout



---

archive/issue_comments_080524.json:
```json
{
    "body": "**Work_Issues:** depends on #9221",
    "created_at": "2010-06-12T21:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80524",
    "user": "https://github.com/jasongrout"
}
```

**Work_Issues:** depends on #9221



---

archive/issue_events_068807.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-06-12T22:34:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68807"
}
```



---

archive/issue_events_068808.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-06-12T22:34:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68808"
}
```



---

archive/issue_comments_080525.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe patch doesn't work for multiple-edge graphs (they are drawn completely differently than graphs without multiple edges).  In fact, we probably ought to draw all graphs using CircleCollection objects rather than scatter_plot or Circles.",
    "created_at": "2010-06-12T22:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80525",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
The patch doesn't work for multiple-edge graphs (they are drawn completely differently than graphs without multiple edges).  In fact, we probably ought to draw all graphs using CircleCollection objects rather than scatter_plot or Circles.



---

archive/issue_comments_080526.json:
```json
{
    "body": "<a id='comment:5'></a>\nHere's how to draw circles like the ones in scatter plot (where the size doesn't change as you make the figure smaller or bigger: use a CircleCollection argument and use different transforms to specify location and size coordinates.  See http://sourceforge.net/mailarchive/forum.php?thread_name=AANLkTim6ZnGiOV1RTRBz0uBMF5y67xyrDp%2BkVSCBtkrB%40mail.gmail.com&forum_name=matplotlib-users",
    "created_at": "2010-08-28T14:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80526",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
Here's how to draw circles like the ones in scatter plot (where the size doesn't change as you make the figure smaller or bigger: use a CircleCollection argument and use different transforms to specify location and size coordinates.  See http://sourceforge.net/mailarchive/forum.php?thread_name=AANLkTim6ZnGiOV1RTRBz0uBMF5y67xyrDp%2BkVSCBtkrB%40mail.gmail.com&forum_name=matplotlib-users



---

archive/issue_comments_080527.json:
```json
{
    "body": "<a id='comment:6'></a>\nSee also http://groups.google.com/group/networkx-discuss/browse_thread/thread/b95fda9813fae67d for code/ideas for rewriting the graph drawing.",
    "created_at": "2010-08-28T20:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80527",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
See also http://groups.google.com/group/networkx-discuss/browse_thread/thread/b95fda9813fae67d for code/ideas for rewriting the graph drawing.



---

archive/issue_comments_080528.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think this patch might take just a little to clean up.  Most of the patch is just adding comments to explain the code or reformatting long lines.  The big key is the clip=False arguments and the code to add things to the bbox_extra_artists.\n\nI think the patch might just need some doctests and testing.  The other comments I put in above can be moved to another ticket that does a bigger revamp of graph drawing.",
    "created_at": "2011-03-23T02:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80528",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:7'></a>
I think this patch might take just a little to clean up.  Most of the patch is just adding comments to explain the code or reformatting long lines.  The big key is the clip=False arguments and the code to add things to the bbox_extra_artists.

I think the patch might just need some doctests and testing.  The other comments I put in above can be moved to another ticket that does a bigger revamp of graph drawing.



---

archive/issue_comments_080529.json:
```json
{
    "body": "**Changing work_issues** from \"depends on #9221\" to \"\".",
    "created_at": "2011-03-23T12:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80529",
    "user": "https://github.com/kcrisman"
}
```

**Changing work_issues** from "depends on #9221" to "".



---

archive/issue_comments_080530.json:
```json
{
    "body": "( Fix cut off vertices in graphs ) Apply to devel/sage/",
    "created_at": "2011-10-11T09:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80530",
    "user": "https://github.com/ppurka"
}
```

( Fix cut off vertices in graphs ) Apply to devel/sage/



---

archive/attachments_011607.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac-9211-add_padding_to_graphs.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/trac-9211-add_padding_to_graphs.patch",
    "created_at": "2011-10-11T09:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_080531.json:
```json
{
    "body": "( Add additional padding to graphs ) Apply to devel/sage",
    "created_at": "2011-10-11T09:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80531",
    "user": "https://github.com/ppurka"
}
```

( Add additional padding to graphs ) Apply to devel/sage



---

archive/issue_comments_080532.json:
```json
{
    "body": "Output with only the earlier patch (modified for 4.7.2)",
    "created_at": "2011-10-11T09:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80532",
    "user": "https://github.com/ppurka"
}
```

Output with only the earlier patch (modified for 4.7.2)



---

archive/attachments_011608.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "with-earlier-patch-modified-for-4.7.2.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/with-earlier-patch-modified-for-4.7.2.png",
    "created_at": "2011-10-11T09:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_080533.json:
```json
{
    "body": "Output with patch for additional padding",
    "created_at": "2011-10-11T09:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80533",
    "user": "https://github.com/ppurka"
}
```

Output with patch for additional padding



---

archive/issue_events_068809.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2011-10-11T09:57:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68809"
}
```



---

archive/issue_events_068810.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2011-10-11T09:57:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68810"
}
```



---

archive/attachments_011609.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "with-additional-padding.png",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/with-additional-padding.png",
    "created_at": "2011-10-11T09:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.png",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_080534.json:
```json
{
    "body": "<a id='comment:11'></a>\nAdded two patches. The [attachment:trac-9211-fix_cut_vertices_in_graphs.patch first one] is essentially the patch by jason redone to work with 4.7.2_alpha3.\n\nThe [attachment:trac-9211-add_padding_to_graphs.patch second patch] adds extra padding to all graphs. The two pngs attached are the output of\n\n```\nM = matrix(RDF, [[1/3, 1/3, 1/3], [0, 1/4, 3/4], [1/2, 1/4, 1/4]])\nG=DiGraph(M, format='weighted_adjacency_matrix')\nG.show(vertex_size=800, edge_labels=True)\n```\n\nThe file [attachment:with-additional-padding.png] is the result of both the patches being applied.\n\nGraphs currently look really bad without either of the two patches. The second patch is not a panacea for all cut off graph plots since it doesn't fix all cases. But my hope is that it fixes most commonly used cases.",
    "created_at": "2011-10-11T09:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80534",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:11'></a>
Added two patches. The [attachment:trac-9211-fix_cut_vertices_in_graphs.patch first one] is essentially the patch by jason redone to work with 4.7.2_alpha3.

The [attachment:trac-9211-add_padding_to_graphs.patch second patch] adds extra padding to all graphs. The two pngs attached are the output of

```
M = matrix(RDF, [[1/3, 1/3, 1/3], [0, 1/4, 3/4], [1/2, 1/4, 1/4]])
G=DiGraph(M, format='weighted_adjacency_matrix')
G.show(vertex_size=800, edge_labels=True)
```

The file [attachment:with-additional-padding.png] is the result of both the patches being applied.

Graphs currently look really bad without either of the two patches. The second patch is not a panacea for all cut off graph plots since it doesn't fix all cases. But my hope is that it fixes most commonly used cases.



---

archive/issue_comments_080535.json:
```json
{
    "body": "<a id='comment:12'></a>\nI'm curious why you need the extra padding patch.  Are vertices still cut off using just the first patch?",
    "created_at": "2011-10-11T13:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80535",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:12'></a>
I'm curious why you need the extra padding patch.  Are vertices still cut off using just the first patch?



---

archive/issue_comments_080536.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jason](#comment%3A12):\n\n> I'm curious why you need the extra padding patch.  Are vertices still cut off using just the first patch?\n\n\nYes. Check [attachment:with-earlier-patch-modified-for-4.7.2.png the plot after the first patch] against the [attachment:with-additional-padding.png the plot after first+second patch]",
    "created_at": "2011-10-11T13:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80536",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:13'></a>
Replying to [jason](#comment%3A12):

> I'm curious why you need the extra padding patch.  Are vertices still cut off using just the first patch?


Yes. Check [attachment:with-earlier-patch-modified-for-4.7.2.png the plot after the first patch] against the [attachment:with-additional-padding.png the plot after first+second patch]



---

archive/issue_comments_080537.json:
```json
{
    "body": "<a id='comment:14'></a>\nAh, right, because the first patch only fixes undirected graphs.  You are plotting a directed graph, so the changes in the patch don't apply.  I'm uploading a new patch that doesn't clip digraph circles or text.",
    "created_at": "2011-10-11T14:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80537",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:14'></a>
Ah, right, because the first patch only fixes undirected graphs.  You are plotting a directed graph, so the changes in the patch don't apply.  I'm uploading a new patch that doesn't clip digraph circles or text.



---

archive/attachments_011610.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9211_digraph_clipping.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/trac_9211_digraph_clipping.patch",
    "created_at": "2011-10-11T14:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_080538.json:
```json
{
    "body": "apply after trac-9211-fix_cut_vertices_in_graphs.patch",
    "created_at": "2011-10-11T14:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80538",
    "user": "https://github.com/jasongrout"
}
```

apply after trac-9211-fix_cut_vertices_in_graphs.patch



---

archive/issue_comments_080539.json:
```json
{
    "body": "<a id='comment:15'></a>\nCan you try applying just trac-9211-fix_cut_vertices_in_graphs.patch and  trac_9211_digraph_clipping.patch ?",
    "created_at": "2011-10-11T14:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80539",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:15'></a>
Can you try applying just trac-9211-fix_cut_vertices_in_graphs.patch and  trac_9211_digraph_clipping.patch ?



---

archive/issue_comments_080540.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jason](#comment%3A15):\n\n> Can you try applying just trac-9211-fix_cut_vertices_in_graphs.patch and  trac_9211_digraph_clipping.patch ?\n\n\nExcellent! Thanks. This does fix the problem for digraphs. Much better than adding random paddings.",
    "created_at": "2011-10-11T14:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80540",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:16'></a>
Replying to [jason](#comment%3A15):

> Can you try applying just trac-9211-fix_cut_vertices_in_graphs.patch and  trac_9211_digraph_clipping.patch ?


Excellent! Thanks. This does fix the problem for digraphs. Much better than adding random paddings.



---

archive/issue_comments_080541.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,6 @@\n With the updated matplotlib spkg at #9210, we can turn off clipping of the matplotlib scatterplot, or with a more recent (SVN right now) version of matplotlib, we could probably add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').\n \n Either way, a real fix should be possible soon.\n+\n+---\n+First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.\n``````\n",
    "created_at": "2011-10-11T15:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80541",
    "user": "https://github.com/ppurka"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,6 @@
 With the updated matplotlib spkg at #9210, we can turn off clipping of the matplotlib scatterplot, or with a more recent (SVN right now) version of matplotlib, we could probably add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').
 
 Either way, a real fix should be possible soon.
+
+---
+First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.
``````




---

archive/issue_comments_080542.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,6 @@\n Though #7299 helped, graph vertices are still cut off.\n \n-With the updated matplotlib spkg at #9210, we can turn off clipping of the matplotlib scatterplot, or with a more recent (SVN right now) version of matplotlib, we could probably add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').\n-\n-Either way, a real fix should be possible soon.\n+We can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').\n \n ---\n First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.\n``````\n",
    "created_at": "2011-10-11T15:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80542",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,6 @@
 Though #7299 helped, graph vertices are still cut off.
 
-With the updated matplotlib spkg at #9210, we can turn off clipping of the matplotlib scatterplot, or with a more recent (SVN right now) version of matplotlib, we could probably add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').
-
-Either way, a real fix should be possible soon.
+We can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').
 
 ---
 First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.
``````




---

archive/issue_comments_080543.json:
```json
{
    "body": "<a id='comment:19'></a>\nOkay, did you run long tests on Sage?  The new version of my first patch seems okay to me, so if you positively review the patches, I think we are good to go, assuming that you've run long tests and there are no doctest errors.",
    "created_at": "2011-10-11T15:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80543",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:19'></a>
Okay, did you run long tests on Sage?  The new version of my first patch seems okay to me, so if you positively review the patches, I think we are good to go, assuming that you've run long tests and there are no doctest errors.



---

archive/issue_comments_080544.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jason](#comment%3A19):\n\n> Okay, did you run long tests on Sage?  The new version of my first patch seems okay to me, so if you positively review the patches, I think we are good to go, assuming that you've run long tests and there are no doctest errors.\n\n\nI started the long test (make ptestlong) over an hour ago. I guess there's 3 more hours to go :)",
    "created_at": "2011-10-11T16:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80544",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:20'></a>
Replying to [jason](#comment%3A19):

> Okay, did you run long tests on Sage?  The new version of my first patch seems okay to me, so if you positively review the patches, I think we are good to go, assuming that you've run long tests and there are no doctest errors.


I started the long test (make ptestlong) over an hour ago. I guess there's 3 more hours to go :)



---

archive/issue_comments_080545.json:
```json
{
    "body": "<a id='comment:21'></a>\nA couple of doctests failed. Only in the directory plot/ (and in the files changed by this patch + base.pyx). Will investigate more once I am physically near that machine where the doctest was run.",
    "created_at": "2011-10-12T03:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80545",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:21'></a>
A couple of doctests failed. Only in the directory plot/ (and in the files changed by this patch + base.pyx). Will investigate more once I am physically near that machine where the doctest was run.



---

archive/issue_comments_080546.json:
```json
{
    "body": "<a id='comment:22'></a>\n> A couple of doctests failed. Only in the directory plot/ (and in the files changed by this patch + base.pyx). Will investigate more once I am physically near that machine where the doctest was run.\n\n\nJust FYI, base.pyx often fails on Mac if you don't have libjpeg or libtiff in the right place - see #7344 and #7345.  If the errors look like \n\n```\n    ImportError: The _imaging C module is not installed\n```\nyou can ignore them, they would be unrelated.",
    "created_at": "2011-10-12T03:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80546",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
> A couple of doctests failed. Only in the directory plot/ (and in the files changed by this patch + base.pyx). Will investigate more once I am physically near that machine where the doctest was run.


Just FYI, base.pyx often fails on Mac if you don't have libjpeg or libtiff in the right place - see #7344 and #7345.  If the errors look like 

```
    ImportError: The _imaging C module is not installed
```
you can ignore them, they would be unrelated.



---

archive/issue_comments_080547.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n We can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').\n \n ---\n-First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.\n+First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to `$SAGE_ROOT/devel/sage`. Finally apply [attachment:trac_9211-fix_doctests.patch] to `$SAGE_ROOT/devel/sage`.\n``````\n",
    "created_at": "2011-10-12T08:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80547",
    "user": "https://github.com/ppurka"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 We can turn off clipping of the matplotlib scatterplot and add some bbox_extra_artists to the savefig which takes those artists into account when calculating the bounding box (when bbox_inches='tight').
 
 ---
-First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to !`SAGE_ROOT/devel/sage`.
+First apply [attachment:trac-9211-fix_cut_vertices_in_graphs.patch] and then apply [attachment:trac_9211_digraph_clipping.patch] to `$SAGE_ROOT/devel/sage`. Finally apply [attachment:trac_9211-fix_doctests.patch] to `$SAGE_ROOT/devel/sage`.
``````




---

archive/issue_comments_080548.json:
```json
{
    "body": "<a id='comment:23'></a>\nI am running it on x86_64 Linux. The errors were because of the additional 'clip' option introduced in the patches. Attaching a fix for the doctests.",
    "created_at": "2011-10-12T08:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80548",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:23'></a>
I am running it on x86_64 Linux. The errors were because of the additional 'clip' option introduced in the patches. Attaching a fix for the doctests.



---

archive/issue_comments_080549.json:
```json
{
    "body": "<a id='comment:24'></a>\nI wonder why you are concatenating lines in the doctest output - our docstrings are theoretically supposed to be 72 (or 79) characters wide, if I'm not mistaken, which is why they the current test results are broken into multiple lines. The doctester doesn't care about purely whitespace differences between the expected and received output.",
    "created_at": "2011-10-12T08:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80549",
    "user": "https://github.com/kini"
}
```

<a id='comment:24'></a>
I wonder why you are concatenating lines in the doctest output - our docstrings are theoretically supposed to be 72 (or 79) characters wide, if I'm not mistaken, which is why they the current test results are broken into multiple lines. The doctester doesn't care about purely whitespace differences between the expected and received output.



---

archive/issue_comments_080550.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [kini](#comment%3A24):\n> I wonder why you are concatenating lines in the doctest output - our docstrings are theoretically supposed to be 72 (or 79) characters wide, if I'm not mistaken, which is why they the current test results are broken into multiple lines. The doctester doesn't care about purely whitespace differences between the expected and received output.\n\nSimply copied the output from \"Expected output\". Will attached a space-ified fix. :)",
    "created_at": "2011-10-12T08:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80550",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:25'></a>
Replying to [kini](#comment%3A24):
> I wonder why you are concatenating lines in the doctest output - our docstrings are theoretically supposed to be 72 (or 79) characters wide, if I'm not mistaken, which is why they the current test results are broken into multiple lines. The doctester doesn't care about purely whitespace differences between the expected and received output.

Simply copied the output from "Expected output". Will attached a space-ified fix. :)



---

archive/issue_comments_080551.json:
```json
{
    "body": "<a id='comment:26'></a>\nI wonder if you are aware of `sage -fixdoctests`, which does basically exactly what you are doing... :) BTW I have the same comment for [attachment:trac-9211-add_padding_to_graphs.patch].",
    "created_at": "2011-10-12T09:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80551",
    "user": "https://github.com/kini"
}
```

<a id='comment:26'></a>
I wonder if you are aware of `sage -fixdoctests`, which does basically exactly what you are doing... :) BTW I have the same comment for [attachment:trac-9211-add_padding_to_graphs.patch].



---

archive/attachments_011611.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_9211-fix_doctests.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket9211/trac_9211-fix_doctests.patch",
    "created_at": "2011-10-12T09:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_080552.json:
```json
{
    "body": "Fix doctests for 3d plots (re-uploaded)",
    "created_at": "2011-10-12T09:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80552",
    "user": "https://github.com/ppurka"
}
```

Fix doctests for 3d plots (re-uploaded)



---

archive/issue_comments_080553.json:
```json
{
    "body": "<a id='comment:27'></a>\nUploaded new patch.\n\nDidn't know about `-fixdoctests` (it wasn't too painful to fix because of vim)\n\nForget about the adding padding patch. Jason did the real fix. :)",
    "created_at": "2011-10-12T09:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80553",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:27'></a>
Uploaded new patch.

Didn't know about `-fixdoctests` (it wasn't too painful to fix because of vim)

Forget about the adding padding patch. Jason did the real fix. :)



---

archive/issue_comments_080554.json:
```json
{
    "body": "<a id='comment:28'></a>\nPrevious failures were:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t  -long -force_lib devel/sage/sage/plot/scatter_plot.py # 1 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/plot/text.py # 5 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/plot/circle.py # 8 doctests failed\n\tsage -t  -long -force_lib devel/sage/sage/plot/plot3d/base.pyx # 5 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 8844.0 seconds\n```\n\nNew doctest on `devel/sage/sage/plot/` passes all doctests:\n\n```\n~/Installations/sage-4.7.2> ./sage -t -long devel/sage/sage/plot\n...\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 520.6 seconds\n```\nSo positive review from my side.",
    "created_at": "2011-10-12T09:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80554",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:28'></a>
Previous failures were:

```
----------------------------------------------------------------------

The following tests failed:

	sage -t  -long -force_lib devel/sage/sage/plot/scatter_plot.py # 1 doctests failed
	sage -t  -long -force_lib devel/sage/sage/plot/text.py # 5 doctests failed
	sage -t  -long -force_lib devel/sage/sage/plot/circle.py # 8 doctests failed
	sage -t  -long -force_lib devel/sage/sage/plot/plot3d/base.pyx # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 8844.0 seconds
```

New doctest on `devel/sage/sage/plot/` passes all doctests:

```
~/Installations/sage-4.7.2> ./sage -t -long devel/sage/sage/plot
...
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 520.6 seconds
```
So positive review from my side.



---

archive/issue_comments_080555.json:
```json
{
    "body": "**Reviewer:** Punarbasu Purkayastha",
    "created_at": "2011-10-12T09:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80555",
    "user": "https://github.com/ppurka"
}
```

**Reviewer:** Punarbasu Purkayastha



---

archive/issue_events_068811.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2011-10-12T09:14:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68811"
}
```



---

archive/issue_events_068812.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2011-10-12T09:14:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68812"
}
```



---

archive/issue_events_068813.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-10-12T15:05:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68813"
}
```



---

archive/issue_events_068814.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-10-12T15:05:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68814"
}
```



---

archive/issue_comments_080556.json:
```json
{
    "body": "<a id='comment:30'></a>\nYour changes were a little more than just fixing whitespace, so let someone look at it to review your last patch.\n\nSorry---you're right about those doctests.  I shouldn't have been so sloppy as to not fix those doctests before indicating it needed to be reviewed.",
    "created_at": "2011-10-12T15:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80556",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:30'></a>
Your changes were a little more than just fixing whitespace, so let someone look at it to review your last patch.

Sorry---you're right about those doctests.  I shouldn't have been so sloppy as to not fix those doctests before indicating it needed to be reviewed.



---

archive/issue_events_068815.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-10-12T15:06:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68815"
}
```



---

archive/issue_events_068816.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-10-12T15:06:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68816"
}
```



---

archive/issue_events_068817.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-11-04T17:53:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68817"
}
```



---

archive/issue_events_068818.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-11-04T17:53:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68818"
}
```



---

archive/issue_comments_080557.json:
```json
{
    "body": "<a id='comment:31'></a>\nYep, I confirm that normal tests in graphs/ and plot/ pass.  Positive review for the fix doctests patch.  Good job!",
    "created_at": "2011-11-04T17:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80557",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:31'></a>
Yep, I confirm that normal tests in graphs/ and plot/ pass.  Positive review for the fix doctests patch.  Good job!



---

archive/issue_comments_080558.json:
```json
{
    "body": "**Merged:** sage-4.8.alpha1",
    "created_at": "2011-11-07T10:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9211#issuecomment-80558",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.8.alpha1



---

archive/issue_events_068819.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T10:10:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68819"
}
```



---

archive/issue_events_068820.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T10:10:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9211",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9211#event-68820"
}
```
