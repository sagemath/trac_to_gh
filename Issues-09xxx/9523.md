# Issue 9523: Upgrade the Readline spkg to 6.1

archive/issues_009523.json:
```json
{
    "body": "Under Arch Linux, Sage fails to build, giving this error message:\n\n```\nbash: symbol lookup error: bash: undefined symbol: rl_filename_rewrite_hook\n```\nin the middle of the sqlite build (the next package built after readline).  This can also happen on openSUSE Linux.\n\nThis is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.\n\nWe should upgrade our readline spkg to 6.1; I bet that would fix the problem.\n\nThreads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).\n\nRelated: #9530, #9987\n\nAn updated .spkg can be found at\nhttp://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg \nwhich is based on readline-6.0.p4.spkg from #9530. \n\nAssignee: tbd\n\nCC:  @TimDumol\n\nResolution: fixed\n\nAuthor: David Kirkby\n\nReviewer: Florent Hivert, Leif Leonhardy, Jeroen Demeyer, Volker Braun\n\nMerged: sage-4.6.1.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/9523\n\n",
    "closed_at": "2011-01-09T18:59:44Z",
    "created_at": "2010-07-17T04:43:30Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "Upgrade the Readline spkg to 6.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/9523",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```
Under Arch Linux, Sage fails to build, giving this error message:

```
bash: symbol lookup error: bash: undefined symbol: rl_filename_rewrite_hook
```
in the middle of the sqlite build (the next package built after readline).  This can also happen on openSUSE Linux.

This is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.

We should upgrade our readline spkg to 6.1; I bet that would fix the problem.

Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).

Related: #9530, #9987

An updated .spkg can be found at
http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg 
which is based on readline-6.0.p4.spkg from #9530. 

Assignee: tbd

CC:  @TimDumol

Resolution: fixed

Author: David Kirkby

Reviewer: Florent Hivert, Leif Leonhardy, Jeroen Demeyer, Volker Braun

Merged: sage-4.6.1.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/9523





---

archive/issue_comments_115614.json:
```json
{
    "body": "<a id='comment:1'></a>\nHello, I'm the maintainer of sage-mathematics in the AUR. I think I have worked around this issue with 4.5-2 by not building sage's libreadline, and as a result, using the system's readline :)\n\nBTW, this error is supposedly worked around by sage, by checking if uname -r | grep ARCH returns anything. Which means that people with custom kernels are likely to be experiencing this problem.",
    "created_at": "2010-07-17T05:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115614",
    "user": "https://trac.sagemath.org/admin/accounts/users/gostrc"
}
```

<a id='comment:1'></a>
Hello, I'm the maintainer of sage-mathematics in the AUR. I think I have worked around this issue with 4.5-2 by not building sage's libreadline, and as a result, using the system's readline :)

BTW, this error is supposedly worked around by sage, by checking if uname -r | grep ARCH returns anything. Which means that people with custom kernels are likely to be experiencing this problem.



---

archive/issue_comments_115615.json:
```json
{
    "body": "<a id='comment:2'></a>\nOh ya, +1 from me to upgrade sage's libreadline to 6.1 so it can get rid of the internal workarounds and the workaround in my PKGBUILD :P",
    "created_at": "2010-07-17T05:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115615",
    "user": "https://trac.sagemath.org/admin/accounts/users/gostrc"
}
```

<a id='comment:2'></a>
Oh ya, +1 from me to upgrade sage's libreadline to 6.1 so it can get rid of the internal workarounds and the workaround in my PKGBUILD :P



---

archive/issue_comments_115616.json:
```json
{
    "body": "<a id='comment:3'></a>\nJust to let you now ! The very same problem occurs with the new openSuSE 11.3...\n\nFlorent",
    "created_at": "2010-07-19T14:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115616",
    "user": "https://github.com/hivert"
}
```

<a id='comment:3'></a>
Just to let you now ! The very same problem occurs with the new openSuSE 11.3...

Florent



---

archive/issue_comments_115617.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [hivert](#comment%3A3):\n> Just to let you now ! The very same problem occurs with the new openSuSE 11.3...\n\n\nIndeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.",
    "created_at": "2010-09-15T21:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115617",
    "user": "https://github.com/qed777"
}
```

<a id='comment:4'></a>
Replying to [hivert](#comment%3A3):
> Just to let you now ! The very same problem occurs with the new openSuSE 11.3...


Indeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.



---

archive/issue_comments_115618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,7 @@\n This is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.\n \n We should upgrade our readline spkg to 6.1; I bet that would fix the problem.\n+\n+There's a very similar problem with openSUSE Linux.\n+\n+Related: #9530.\n``````\n",
    "created_at": "2010-09-15T21:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115618",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,7 @@
 This is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.
 
 We should upgrade our readline spkg to 6.1; I bet that would fix the problem.
+
+There's a very similar problem with openSUSE Linux.
+
+Related: #9530.
``````




---

archive/issue_events_028813.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "rename": {
        "from": "Arch linux build fails because our readline spkg is too old",
        "to": "Upgrade the Readline spkg to 6.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9523#event-28813"
}
```



---

archive/issue_comments_115619.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,6 @@\n \n We should upgrade our readline spkg to 6.1; I bet that would fix the problem.\n \n-There's a very similar problem with openSUSE Linux.\n+There's a very similar problem on openSUSE Linux.\n \n Related: #9530.\n``````\n",
    "created_at": "2010-09-15T21:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115619",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,6 @@
 
 We should upgrade our readline spkg to 6.1; I bet that would fix the problem.
 
-There's a very similar problem with openSUSE Linux.
+There's a very similar problem on openSUSE Linux.
 
 Related: #9530.
``````




---

archive/issue_comments_115620.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,14 @@\n-Under Arch linux, Sage fails to build, giving this error message:\n+Under Arch Linux, Sage fails to build, giving this error message:\n \n ```\n bash: symbol lookup error: bash: undefined symbol: rl_filename_rewrite_hook\n ```\n-in the middle of the sqlite build (the next package built after readline).\n+in the middle of the sqlite build (the next package built after readline).  This can also happen on openSUSE Linux.\n \n This is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.\n \n We should upgrade our readline spkg to 6.1; I bet that would fix the problem.\n \n-There's a very similar problem on openSUSE Linux.\n+Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).\n \n Related: #9530.\n``````\n",
    "created_at": "2010-09-15T22:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115620",
    "user": "https://github.com/qed777"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,14 @@
-Under Arch linux, Sage fails to build, giving this error message:
+Under Arch Linux, Sage fails to build, giving this error message:
 
 ```
 bash: symbol lookup error: bash: undefined symbol: rl_filename_rewrite_hook
 ```
-in the middle of the sqlite build (the next package built after readline).
+in the middle of the sqlite build (the next package built after readline).  This can also happen on openSUSE Linux.
 
 This is a new symbol that was added in readline 6.1; so I'm pretty sure the problem is because our readline 6.0 is missing that symbol, so trying to run Arch's /bin/bash with our LD_LIBRARY_PATH will fail.
 
 We should upgrade our readline spkg to 6.1; I bet that would fix the problem.
 
-There's a very similar problem on openSUSE Linux.
+Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).
 
 Related: #9530.
``````




---

archive/issue_comments_115621.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mpatel](#comment%3A4):\n> Replying to [hivert](#comment%3A3):\n> > Just to let you now ! The very same problem occurs with the new openSuSE 11.3...\n\n> \n> Indeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.\n\n\n[Another](http://groups.google.com/group/sage-support/browse_thread/thread/8757b2515155ab42#).\n\nWe should try to fix this in 4.6 or 4.6.1.",
    "created_at": "2010-09-18T09:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115621",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
Replying to [mpatel](#comment%3A4):
> Replying to [hivert](#comment%3A3):
> > Just to let you now ! The very same problem occurs with the new openSuSE 11.3...

> 
> Indeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.


[Another](http://groups.google.com/group/sage-support/browse_thread/thread/8757b2515155ab42#).

We should try to fix this in 4.6 or 4.6.1.



---

archive/issue_comments_115622.json:
```json
{
    "body": "<a id='comment:8'></a>\nNote that this wouldn't happen with proper shared library versioning... :|",
    "created_at": "2010-09-18T15:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115622",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Note that this wouldn't happen with proper shared library versioning... :|



---

archive/issue_comments_115623.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [mpatel](#comment%3A7):\n> Replying to [mpatel](#comment%3A4):\n> > Replying to [hivert](#comment%3A3):\n> > > Just to let you now ! The very same problem occurs with the new openSuSE 11.3...\n\n> > \n> > Indeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.\n\n> \n> [Another](http://groups.google.com/group/sage-support/browse_thread/thread/8757b2515155ab42#).\n\n\nAnd at [AskSage](http://ask.sagemath.org/question/135/trying-to-install-sage-to-suse-113).",
    "created_at": "2010-09-19T06:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115623",
    "user": "https://github.com/qed777"
}
```

<a id='comment:9'></a>
Replying to [mpatel](#comment%3A7):
> Replying to [mpatel](#comment%3A4):
> > Replying to [hivert](#comment%3A3):
> > > Just to let you now ! The very same problem occurs with the new openSuSE 11.3...

> > 
> > Indeed, there's [a recent thread about readline and openSUSE](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197) on sage-support.

> 
> [Another](http://groups.google.com/group/sage-support/browse_thread/thread/8757b2515155ab42#).


And at [AskSage](http://ask.sagemath.org/question/135/trying-to-install-sage-to-suse-113).



---

archive/issue_comments_115624.json:
```json
{
    "body": "<a id='comment:10'></a>\nSomewhat related is #9987 \n\nReadline can definitely be built on AIX -  see for example \n\nhttp://www.perzl.org/aix/index.php?n=Main.Readline\n\nso something is wrong in how Sage is using readline. \n\nDave",
    "created_at": "2010-09-23T21:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115624",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:10'></a>
Somewhat related is #9987 

Readline can definitely be built on AIX -  see for example 

http://www.perzl.org/aix/index.php?n=Main.Readline

so something is wrong in how Sage is using readline. 

Dave



---

archive/issue_comments_115625.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n \n Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).\n \n-Related: #9530.\n+Related: #9530, #9987\n``````\n",
    "created_at": "2010-09-23T21:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115625",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 
 Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).
 
-Related: #9530.
+Related: #9530, #9987
``````




---

archive/issue_events_028814.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-10-07T12:10:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "milestone": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9523#event-28814"
}
```



---

archive/issue_comments_115626.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,3 +12,6 @@\n Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).\n \n Related: #9530, #9987\n+\n+An updated .spkg can be found at\n+http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg\n``````\n",
    "created_at": "2010-10-24T10:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115626",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,3 +12,6 @@
 Threads: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/3f0f6d8c6ead4816/75bb442a9accc9ec?#75bb442a9accc9ec), [sage-support](http://groups.google.com/group/sage-support/browse_thread/thread/973316c62d190197).
 
 Related: #9530, #9987
+
+An updated .spkg can be found at
+http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg
``````




---

archive/issue_comments_115627.json:
```json
{
    "body": "<a id='comment:13'></a>\nI've updated the source code, and cleaned up the package a bit. If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using. The .spkg can be found here.\n\nhttp://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg\n\nI've checked the new .spkg actually builds on the following systems\n* AIX 5.3 (my own RS/6000 7025 F50 'aixbox') I did **not** try to resolve #9987\n* HP-UX 11.11B (my own HP C3600 'hpbox')\n* Linux (sage.math)\n* OpenSolaris 06/2009 (my own Sun Ultra 27 'hawk' which is a Sage buildbot slave.)\n* OS X (bsd.math)\n* Solaris 10 SPARC ('mark' on skynet, which is a Sun Blade 2500)\n \nI've checked that the whole of Sage builds, and passes all doctests \n\n```\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1740.4 seconds\ndrkirkby@hawk:~/sage-4.6.rc0$ \n```\n\nwith the updated .spkg on only the following system. \n\n* OpenSolaris (my own Sun Ultra 27 'hawk' which is a Sage buildbot slave)\n\nI've **not** checked this on any of the systems which have been known to cause issues with readline (FreeBSD, ArchLinux, OpenSUSE etc). \n\n\nDave",
    "created_at": "2010-10-24T10:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115627",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>
I've updated the source code, and cleaned up the package a bit. If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using. The .spkg can be found here.

http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg

I've checked the new .spkg actually builds on the following systems
* AIX 5.3 (my own RS/6000 7025 F50 'aixbox') I did **not** try to resolve #9987
* HP-UX 11.11B (my own HP C3600 'hpbox')
* Linux (sage.math)
* OpenSolaris 06/2009 (my own Sun Ultra 27 'hawk' which is a Sage buildbot slave.)
* OS X (bsd.math)
* Solaris 10 SPARC ('mark' on skynet, which is a Sun Blade 2500)
 
I've checked that the whole of Sage builds, and passes all doctests 

```
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1740.4 seconds
drkirkby@hawk:~/sage-4.6.rc0$ 
```

with the updated .spkg on only the following system. 

* OpenSolaris (my own Sun Ultra 27 'hawk' which is a Sage buildbot slave)

I've **not** checked this on any of the systems which have been known to cause issues with readline (FreeBSD, ArchLinux, OpenSUSE etc). 


Dave



---

archive/issue_comments_115628.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-24T10:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115628",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_115629.json:
```json
{
    "body": "<a id='comment:14'></a>\nI just noticed I had not made all the necessary changes to a patch that was included in the .spkg. The patch would not apply cleanly to the update version of the source, so I had to do it manually, but it looks like I forgot a couple of bits. \n\nLeave it with me.",
    "created_at": "2010-10-24T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115629",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>
I just noticed I had not made all the necessary changes to a patch that was included in the .spkg. The patch would not apply cleanly to the update version of the source, so I had to do it manually, but it looks like I forgot a couple of bits. 

Leave it with me.



---

archive/issue_comments_115630.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-10-24T10:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115630",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115631.json:
```json
{
    "body": "Mercurial patch - adds a rather useless spkg-check file, cleans the package a little.",
    "created_at": "2010-10-24T10:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115631",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Mercurial patch - adds a rather useless spkg-check file, cleans the package a little.



---

archive/issue_comments_115632.json:
```json
{
    "body": "<a id='comment:15'></a>\nAttachment [9523-update-readline.patch](tarball://root/attachments/some-uuid/ticket9523/9523-update-readline.patch) by drkirkby created at 2010-10-24 11:09:52\n\nThis now needs review. \n\nPlease test, especially on platforms where there has been problems with readline, which appear to be many!\n\nI've now added an `spkg-check` file and run `make check` as there is a `check` target, but it does not actually do anything useful at this time. Hopefully the readline developers will add some self-tests. \n\nThe package can be found at http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg\n\nDave",
    "created_at": "2010-10-24T11:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115632",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>
Attachment [9523-update-readline.patch](tarball://root/attachments/some-uuid/ticket9523/9523-update-readline.patch) by drkirkby created at 2010-10-24 11:09:52

This now needs review. 

Please test, especially on platforms where there has been problems with readline, which appear to be many!

I've now added an `spkg-check` file and run `make check` as there is a `check` target, but it does not actually do anything useful at this time. Hopefully the readline developers will add some self-tests. 

The package can be found at http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg

Dave



---

archive/issue_comments_115633.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-10-24T11:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115633",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115634.json:
```json
{
    "body": "<a id='comment:16'></a>\nHi David !\n\nReplying to [drkirkby](#comment%3A15):\n> This now needs review. \n> \n> Please test, especially on platforms where there has been problems with readline, which appear to be many!\n\n\nThanks for taking care of that. I'm trying to compile sage 4.6.rc0 with your\nreadline spkg on a 64 bits openSuSE 11.3. It seems to work ! My machine is now\ncompiling ATLAS and the \"undefined symbol\" vanished. However, as I posted on\n[sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332?hl=en_US), it seems that there is another problem on this architecture. So I don't think I'll get a working sage.",
    "created_at": "2010-10-24T13:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115634",
    "user": "https://github.com/hivert"
}
```

<a id='comment:16'></a>
Hi David !

Replying to [drkirkby](#comment%3A15):
> This now needs review. 
> 
> Please test, especially on platforms where there has been problems with readline, which appear to be many!


Thanks for taking care of that. I'm trying to compile sage 4.6.rc0 with your
readline spkg on a 64 bits openSuSE 11.3. It seems to work ! My machine is now
compiling ATLAS and the "undefined symbol" vanished. However, as I posted on
[sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332?hl=en_US), it seems that there is another problem on this architecture. So I don't think I'll get a working sage.



---

archive/issue_comments_115635.json:
```json
{
    "body": "<a id='comment:17'></a>\nA few comments:\n\n* The way `CFLAGS` (and `CXXFLAGS`) are set overrides user-specified settings (`-O2`, `-Wall`).\n* The handling of `SAGE_DEBUG` is inconsistent (and does not disable optimization):\n\n```sh\n# If SAGE_DEBUG is set either unset (the default), or set to  'yes'\n# then add debugging information.\n# Since both the Sun and GNU compilers accept -g to give debugging information,\n# there is no need to do anything specific to one compiler or the other.\n\nif [ \"x$SAGE_DEBUG\" = \"x\" ] || [ \"x$SAGE_DEBUG\" = \"xyes\" ] ; then\n   echo \"Code will be built with debugging information present. Set 'SAGE_DEBUG' to 'no' if you don't want that.\"\n   # Actually anything other than 'yes' or '1' will cause\n   # no debugging information to be added.\n   CFLAGS=\"$CFLAGS -g \"\n   CXXFLAGS=\"$CXXFLAGS -g \"\nelse\n   echo \"No debugging information will be used during the build of this package.\"\n   echo \"Unset SAGE_DEBUG if you want debugging information present (-g added).\"\nfi\n```\n   I would add debugging symbols by default anyway.\n* `make` is used instead of `$MAKE`. I don't know why we do the build and install in one call.\n* The following is most probably wrong for readline 6.1:\n\n```sh\nelif [ \"$UNAME\" = \"OpenBSD\" ]; then\n  DYLIB_NAME=\"$SAGE_LOCAL\"/lib/libreadline.so.6.0\n```\n* The following should simply be `if grep -q ... ; then ...`:\n\n```sh\n    if [ `grep 11.1 /etc/SuSE-release > /dev/null; echo $?` -eq 0 ]; then\n```\n   (or at least `if grep ... >/dev/null; then ...`). The preceding `test -f` is also superfluous, but I agree makes it perhaps more readable.\n* The use of `set +/-e` is quite confusing and error-prone, and its use is **definitely wrong here**, since we don't get the exit status of \"copying patches\" and, worse, `build()`:\n\n```sh\n...\nset -e\n...\ncp patches/shobj-conf src/support/\nif [ $? -ne 0 ]; then\n    echo \"Error copying patch over.\"\n    exit 1\nfi\n\ncd src/\n\nbuild()\n{\n    ./configure --prefix=\"$SAGE_LOCAL\" $CONF_FLAGS\n    make install\n}\n\nbuild\nset +e\nif [ $? -ne 0 ]; then\n    echo \"Error building and installing readline.\"\n    exit 1\nfi\nset -e\n...\n```\n* It is safer to quote (all instances of) `$UNAME`.\n* The `build()` functions is almost useless, and in fact does `make install` (see above).\n\nI originally wanted to set this to \"needs info\" (w.r.t. OpenBSD), but now I think at least *some of* the above really needs to be fixed, therefore \"needs work\".",
    "created_at": "2010-10-24T16:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115635",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
A few comments:

* The way `CFLAGS` (and `CXXFLAGS`) are set overrides user-specified settings (`-O2`, `-Wall`).
* The handling of `SAGE_DEBUG` is inconsistent (and does not disable optimization):

```sh
# If SAGE_DEBUG is set either unset (the default), or set to  'yes'
# then add debugging information.
# Since both the Sun and GNU compilers accept -g to give debugging information,
# there is no need to do anything specific to one compiler or the other.

if [ "x$SAGE_DEBUG" = "x" ] || [ "x$SAGE_DEBUG" = "xyes" ] ; then
   echo "Code will be built with debugging information present. Set 'SAGE_DEBUG' to 'no' if you don't want that."
   # Actually anything other than 'yes' or '1' will cause
   # no debugging information to be added.
   CFLAGS="$CFLAGS -g "
   CXXFLAGS="$CXXFLAGS -g "
else
   echo "No debugging information will be used during the build of this package."
   echo "Unset SAGE_DEBUG if you want debugging information present (-g added)."
fi
```
   I would add debugging symbols by default anyway.
* `make` is used instead of `$MAKE`. I don't know why we do the build and install in one call.
* The following is most probably wrong for readline 6.1:

```sh
elif [ "$UNAME" = "OpenBSD" ]; then
  DYLIB_NAME="$SAGE_LOCAL"/lib/libreadline.so.6.0
```
* The following should simply be `if grep -q ... ; then ...`:

```sh
    if [ `grep 11.1 /etc/SuSE-release > /dev/null; echo $?` -eq 0 ]; then
```
   (or at least `if grep ... >/dev/null; then ...`). The preceding `test -f` is also superfluous, but I agree makes it perhaps more readable.
* The use of `set +/-e` is quite confusing and error-prone, and its use is **definitely wrong here**, since we don't get the exit status of "copying patches" and, worse, `build()`:

```sh
...
set -e
...
cp patches/shobj-conf src/support/
if [ $? -ne 0 ]; then
    echo "Error copying patch over."
    exit 1
fi

cd src/

build()
{
    ./configure --prefix="$SAGE_LOCAL" $CONF_FLAGS
    make install
}

build
set +e
if [ $? -ne 0 ]; then
    echo "Error building and installing readline."
    exit 1
fi
set -e
...
```
* It is safer to quote (all instances of) `$UNAME`.
* The `build()` functions is almost useless, and in fact does `make install` (see above).

I originally wanted to set this to "needs info" (w.r.t. OpenBSD), but now I think at least *some of* the above really needs to be fixed, therefore "needs work".



---

archive/issue_comments_115636.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-10-24T16:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115636",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115637.json:
```json
{
    "body": "<a id='comment:18'></a>\nP.S.: Do we at all still need to use the system's readline on OpenSuSE 11.1?",
    "created_at": "2010-10-24T16:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115637",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>
P.S.: Do we at all still need to use the system's readline on OpenSuSE 11.1?



---

archive/issue_comments_115638.json:
```json
{
    "body": "<a id='comment:19'></a>\nLeif, \n\nI'd agree the OpenBSD code is probably wrong, though with nobody at all working on an OpenBSD port to my knowledge, I don't know how we are going to find out. But I'm willing to change that. To my knowledge, only FreeBSD is being worked on by Peter, with nobody working on NetBSD, OpenBSD or any other *BSD. \n\nWith the possible exception of that, I don't believe my changes have introduced any new problems. I simply don't have time to go though another ticket like #9603, where there were endless changes to `spkg-install` which took 6 weeks. \n\nMany of those proposed will need extensive testing, which I don't have time for. As I remarked above:\n\n*If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using.* \n\nI'd rather concentrate my time on sorting out #9040 and #9840. I suggest you create another ticket to clean this up if you feel it needs it. Sorry, but I just don't want another ticket like #9603! \n\nI've got no idea of the situation with OpenSUSE\n\nDave",
    "created_at": "2010-10-24T17:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115638",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:19'></a>
Leif, 

I'd agree the OpenBSD code is probably wrong, though with nobody at all working on an OpenBSD port to my knowledge, I don't know how we are going to find out. But I'm willing to change that. To my knowledge, only FreeBSD is being worked on by Peter, with nobody working on NetBSD, OpenBSD or any other *BSD. 

With the possible exception of that, I don't believe my changes have introduced any new problems. I simply don't have time to go though another ticket like #9603, where there were endless changes to `spkg-install` which took 6 weeks. 

Many of those proposed will need extensive testing, which I don't have time for. As I remarked above:

*If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using.* 

I'd rather concentrate my time on sorting out #9040 and #9840. I suggest you create another ticket to clean this up if you feel it needs it. Sorry, but I just don't want another ticket like #9603! 

I've got no idea of the situation with OpenSUSE

Dave



---

archive/issue_comments_115639.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [drkirkby](#comment%3A19):\n> I don't believe my changes have introduced any new problems.\n\n\nI didn't say you introduced them, doesn't make a difference to me though.\n\n> I simply don't have time to go though another ticket like #9603, where there were endless changes to `spkg-install` which took 6 weeks.\n\n\nThat had a couple of reasons. All my suggestions are above, and as I said *some* of them are minor, but at the same time most of them trivial to fix without risk.\n\n(Cf. the Cython upgrade, where I just \"cleaned up\" the `spkg-install` by moving `cd src`, and Robert at the same time - with the original spkg - ran into exactly the potential error to make by copying the patches at the wrong point of the script, which one would not even have noticed when installing the spkg.)\n \n> Many of those proposed will need extensive testing, \n\n\nI don't agree; also, the handling of `SAGE_DEBUG` e.g. and the use of `set -e` is simply wrong **as it is now**.\n\n> *If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using.* \n> \n\n\nNathann, is it you? ;-)\n\n> I'd rather concentrate my time on sorting out #9040 and #9840. I suggest you create another ticket to clean this up if you feel it needs it.\n\n\nIt doesn't make sense to me to keep definite flaws in it, and postpone fixing them to yet another ticket. And I don't have time for such either, not to mention every new ticket needs new review and testing again.\n\nIt's currently a blocker, but meanwhile one for 4.6**.1**.\n\n> I've got no idea of the situation with OpenSUSE\n\n\nMe either, but the reason for upgrading readline was OpenSuSE!",
    "created_at": "2010-10-24T18:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115639",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
Replying to [drkirkby](#comment%3A19):
> I don't believe my changes have introduced any new problems.


I didn't say you introduced them, doesn't make a difference to me though.

> I simply don't have time to go though another ticket like #9603, where there were endless changes to `spkg-install` which took 6 weeks.


That had a couple of reasons. All my suggestions are above, and as I said *some* of them are minor, but at the same time most of them trivial to fix without risk.

(Cf. the Cython upgrade, where I just "cleaned up" the `spkg-install` by moving `cd src`, and Robert at the same time - with the original spkg - ran into exactly the potential error to make by copying the patches at the wrong point of the script, which one would not even have noticed when installing the spkg.)
 
> Many of those proposed will need extensive testing, 


I don't agree; also, the handling of `SAGE_DEBUG` e.g. and the use of `set -e` is simply wrong **as it is now**.

> *If others want to clean it up further, feel free, but I don't want to spend a lot of time on this. It is not even causing any problems on any systems I'm using.* 
> 


Nathann, is it you? ;-)

> I'd rather concentrate my time on sorting out #9040 and #9840. I suggest you create another ticket to clean this up if you feel it needs it.


It doesn't make sense to me to keep definite flaws in it, and postpone fixing them to yet another ticket. And I don't have time for such either, not to mention every new ticket needs new review and testing again.

It's currently a blocker, but meanwhile one for 4.6**.1**.

> I've got no idea of the situation with OpenSUSE


Me either, but the reason for upgrading readline was OpenSuSE!



---

archive/issue_comments_115640.json:
```json
{
    "body": "<a id='comment:21'></a>\n> I've got no idea of the situation with OpenSUSE\n\n\nI'm using openSuSE 11.3 (the latest) on a 64 bits machine and I've the following behavior:\n\n- The openSuSE binary for 4.5.2, 4.5.3 *doesn't start* unless the following files are removed from sage install:\n\n```\nlibreadline.a  libreadline.so  libreadline.so.6  libreadline.so.6.0\n```\nIt seems to works perfectly of those are removed (I got all tests passed with 4.5.2). \n\n- The 4.5.2 and 4.5.3 source doesn't compile either. I got it compile and work with the patch on #9530 (all test passed on 4.5.3)\n\n- The 4.6rc0 seem to compile correctly using David's spkg, however for a probably different reason it doesn't start, failing with the error\n\n```\nImportError: No module named sagenb.misc.sphinxify\n```\n\nI've no idea how to fix this last error and as I said previously I asked for\nhelp on sage-release.\n\n\nAlso, if needed I have access on a older openSuSE 11.1 system but I haven't\nupgraded sage on it recently.\n\nCheers,\n\nFlorent",
    "created_at": "2010-10-24T18:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115640",
    "user": "https://github.com/hivert"
}
```

<a id='comment:21'></a>
> I've got no idea of the situation with OpenSUSE


I'm using openSuSE 11.3 (the latest) on a 64 bits machine and I've the following behavior:

- The openSuSE binary for 4.5.2, 4.5.3 *doesn't start* unless the following files are removed from sage install:

```
libreadline.a  libreadline.so  libreadline.so.6  libreadline.so.6.0
```
It seems to works perfectly of those are removed (I got all tests passed with 4.5.2). 

- The 4.5.2 and 4.5.3 source doesn't compile either. I got it compile and work with the patch on #9530 (all test passed on 4.5.3)

- The 4.6rc0 seem to compile correctly using David's spkg, however for a probably different reason it doesn't start, failing with the error

```
ImportError: No module named sagenb.misc.sphinxify
```

I've no idea how to fix this last error and as I said previously I asked for
help on sage-release.


Also, if needed I have access on a older openSuSE 11.1 system but I haven't
upgraded sage on it recently.

Cheers,

Florent



---

archive/issue_comments_115641.json:
```json
{
    "body": "<a id='comment:22'></a>\nLeif, \n\nI'll make **some** of the changes you suggest. I will change `make` to `$MAKE`, but that will need **extensive** testing, as parallel builds tends to break on many packages. I'll test it 100 times on my reasonably quick (quad core 3.33 GHz) Sun Ultra 27, but I don't have time to test it extensively on every system.",
    "created_at": "2010-10-24T19:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115641",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:22'></a>
Leif, 

I'll make **some** of the changes you suggest. I will change `make` to `$MAKE`, but that will need **extensive** testing, as parallel builds tends to break on many packages. I'll test it 100 times on my reasonably quick (quad core 3.33 GHz) Sun Ultra 27, but I don't have time to test it extensively on every system.



---

archive/issue_comments_115642.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [hivert](#comment%3A21):\n>  - The 4.6rc0 seem to compile correctly using David's spkg, however for a probably different reason it doesn't start, failing with the error\n \n{{{\nImportError: No module named sagenb.misc.sphinxify\n}}}\n> \n> I've no idea how to fix this last error and as I said previously I asked for\n> help on sage-release.\n> \n> \n> Also, if needed I have access on a older openSuSE 11.1 system but I haven't\n> upgraded sage on it recently.\n\n\nIt would be helpful if you could try to build Sage 4.6.rc0 on that, too (upgrading from a - perhaps copied - working Sage version should also work), to see if the same error occurs as on OpenSuSE 11.3.",
    "created_at": "2010-10-24T20:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115642",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [hivert](#comment%3A21):
>  - The 4.6rc0 seem to compile correctly using David's spkg, however for a probably different reason it doesn't start, failing with the error
 
{{{
ImportError: No module named sagenb.misc.sphinxify
}}}
> 
> I've no idea how to fix this last error and as I said previously I asked for
> help on sage-release.
> 
> 
> Also, if needed I have access on a older openSuSE 11.1 system but I haven't
> upgraded sage on it recently.


It would be helpful if you could try to build Sage 4.6.rc0 on that, too (upgrading from a - perhaps copied - working Sage version should also work), to see if the same error occurs as on OpenSuSE 11.3.



---

archive/issue_comments_115643.json:
```json
{
    "body": "Mercurial patch to clean up the package a bit more",
    "created_at": "2010-10-24T20:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115643",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Mercurial patch to clean up the package a bit more



---

archive/issue_comments_115644.json:
```json
{
    "body": "<a id='comment:24'></a>\nAttachment [9523-further-cleanup.patch](tarball://root/attachments/some-uuid/ticket9523/9523-further-cleanup.patch) by drkirkby created at 2010-10-24 20:30:08\n\nI've attached to clean this up a bit more. If a reviewer wants further changes, please make a reviewer patch, as I have more pressing things to do. I've done most of the changes suggested. \n\nI've set this to build in parallel. It does not make a huge difference to the install time, changing from 14 seconds to 6 seconds on my machine. Shaving off 8 seconds is not a huge gain, \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg\n\nI've tested the parallel builds 100 times on OpenSolaris, but not on any other platform. \n\nDave",
    "created_at": "2010-10-24T20:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115644",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:24'></a>
Attachment [9523-further-cleanup.patch](tarball://root/attachments/some-uuid/ticket9523/9523-further-cleanup.patch) by drkirkby created at 2010-10-24 20:30:08

I've attached to clean this up a bit more. If a reviewer wants further changes, please make a reviewer patch, as I have more pressing things to do. I've done most of the changes suggested. 

I've set this to build in parallel. It does not make a huge difference to the install time, changing from 14 seconds to 6 seconds on my machine. Shaving off 8 seconds is not a huge gain, 

http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg

I've tested the parallel builds 100 times on OpenSolaris, but not on any other platform. 

Dave



---

archive/issue_comments_115645.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-10-24T20:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115645",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115646.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [drkirkby](#comment%3A22):\n> I'll make **some** of the changes you suggest. I will change `make` to `$MAKE`, but that will need **extensive** testing, as parallel builds tends to break on many packages. I'll test it 100 times on my reasonably quick (quad core 3.33 GHz) Sun Ultra 27, but I don't have time to test it extensively on every system.\n\n\nWell, I would consider changing `make` to `$MAKE` less important for the moment, as - as you say - *that* requires more testing, in contrast to the other changes.\n\nNote that e.g.\n\n```sh\n$ env MAKE=\"make -j\" ./sage -i readline-6.1.spkg\n```\n(or copying the spkg to `spkg/standard/` and running `env MAKE=\"make -j\" make`) would currently attempt a parallel build / install anyway, even though you call `make` in `spkg-install`.\n\n---\n\nIt's quite funny to enable `-Wall` in a script and at the same time keep blocks of unreachable code in the script itself.\n\n---\n\nBtw, `ptestlong` passed with 4.6.rc0 on Ubuntu 10.04 x86_64 both with just that spkg as well as all dependent packages [re]built.",
    "created_at": "2010-10-24T20:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115646",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>
Replying to [drkirkby](#comment%3A22):
> I'll make **some** of the changes you suggest. I will change `make` to `$MAKE`, but that will need **extensive** testing, as parallel builds tends to break on many packages. I'll test it 100 times on my reasonably quick (quad core 3.33 GHz) Sun Ultra 27, but I don't have time to test it extensively on every system.


Well, I would consider changing `make` to `$MAKE` less important for the moment, as - as you say - *that* requires more testing, in contrast to the other changes.

Note that e.g.

```sh
$ env MAKE="make -j" ./sage -i readline-6.1.spkg
```
(or copying the spkg to `spkg/standard/` and running `env MAKE="make -j" make`) would currently attempt a parallel build / install anyway, even though you call `make` in `spkg-install`.

---

It's quite funny to enable `-Wall` in a script and at the same time keep blocks of unreachable code in the script itself.

---

Btw, `ptestlong` passed with 4.6.rc0 on Ubuntu 10.04 x86_64 both with just that spkg as well as all dependent packages [re]built.



---

archive/issue_comments_115647.json:
```json
{
    "body": "Changing author from \"\" to \"David Kirkby\"",
    "created_at": "2010-10-24T20:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115647",
    "user": "https://github.com/nexttime"
}
```

Changing author from "" to "David Kirkby"



---

archive/issue_comments_115648.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Florent Hivert, Leif Leonhardy\"",
    "created_at": "2010-10-24T20:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115648",
    "user": "https://github.com/nexttime"
}
```

Changing reviewer from "" to "Florent Hivert, Leif Leonhardy"



---

archive/issue_comments_115649.json:
```json
{
    "body": "<a id='comment:26'></a>\nAs I said, I don't wish to spend too long on this. I thought it would be a relatively quick fix to just update the source code, but are very keen to let the ticket drag on. \n\nI was not aware there were blocks of unreachable code, but feel free to remove them with a reviewer patch.",
    "created_at": "2010-10-24T20:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115649",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:26'></a>
As I said, I don't wish to spend too long on this. I thought it would be a relatively quick fix to just update the source code, but are very keen to let the ticket drag on. 

I was not aware there were blocks of unreachable code, but feel free to remove them with a reviewer patch.



---

archive/issue_comments_115650.json:
```json
{
    "body": "<a id='comment:27'></a>\nSage now has a buildbot set up. See\n\nhttp://build.sagemath.org/sage/waterfall\n\nThe machine on the far right 'hawk' is my own machine, and seems to manage being a buildbot slave despite this is only on a home ADSL network, and not a professionally managed data centre. If someone has an !OpenSUSE machine they can keep on 24/7, and permit access via the buildbot, then perhaps Mitesh will add it as a slave. That would drastically reduce the chances of a Sage build breaking on !OpenSUSE, as a failure would be detected very quickly. \n\nDave",
    "created_at": "2010-10-24T20:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115650",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:27'></a>
Sage now has a buildbot set up. See

http://build.sagemath.org/sage/waterfall

The machine on the far right 'hawk' is my own machine, and seems to manage being a buildbot slave despite this is only on a home ADSL network, and not a professionally managed data centre. If someone has an !OpenSUSE machine they can keep on 24/7, and permit access via the buildbot, then perhaps Mitesh will add it as a slave. That would drastically reduce the chances of a Sage build breaking on !OpenSUSE, as a failure would be detected very quickly. 

Dave



---

archive/issue_comments_115651.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe newly attached patch looks good (you changed even things I did not mention :) ), except for you now add `$OPTIMZATION_FLAGS` twice (if `SAGE_DEBUG!=\"yes\"`), the second time again overriding user settings, and also `-Wall` is **ap**pended to `CFLAGS` s.t. it can't be disabled by the user.\n\nAs far as I can see, `$CONF_FLAGS` passed to `./configure` aren't set anywhere, so we could drop that. (Otherwise a value from the global environment might unintentionally be used.)",
    "created_at": "2010-10-24T20:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115651",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
The newly attached patch looks good (you changed even things I did not mention :) ), except for you now add `$OPTIMZATION_FLAGS` twice (if `SAGE_DEBUG!="yes"`), the second time again overriding user settings, and also `-Wall` is **ap**pended to `CFLAGS` s.t. it can't be disabled by the user.

As far as I can see, `$CONF_FLAGS` passed to `./configure` aren't set anywhere, so we could drop that. (Otherwise a value from the global environment might unintentionally be used.)



---

archive/issue_comments_115652.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [drkirkby](#comment%3A26):\n> I was not aware there were blocks of unreachable code, but feel free to remove them with a reviewer patch. \n\n\nRemoving `set -e` solved that.",
    "created_at": "2010-10-24T20:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115652",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Replying to [drkirkby](#comment%3A26):
> I was not aware there were blocks of unreachable code, but feel free to remove them with a reviewer patch. 


Removing `set -e` solved that.



---

archive/issue_comments_115653.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [leif](#comment%3A25):\n> Btw, `ptestlong` passed with 4.6.rc0 on Ubuntu 10.04 x86_64 both with just that spkg as well as all dependent packages [re]built.\n\n\nI've successfully reinstalled / rebuilt the updated spkg and all dependent packages* (with 32 jobs); `ptestlong` again passed.\n\n\n---\n\n* To achieve this, one can (since rc0) `export SAGE_UPGRADING=yes` and run `make` after copying the new spkg to `spkg/standard/` and deleting `spkg/installed/readline-6.1`.",
    "created_at": "2010-10-24T22:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115653",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Replying to [leif](#comment%3A25):
> Btw, `ptestlong` passed with 4.6.rc0 on Ubuntu 10.04 x86_64 both with just that spkg as well as all dependent packages [re]built.


I've successfully reinstalled / rebuilt the updated spkg and all dependent packages* (with 32 jobs); `ptestlong` again passed.


---

* To achieve this, one can (since rc0) `export SAGE_UPGRADING=yes` and run `make` after copying the new spkg to `spkg/standard/` and deleting `spkg/installed/readline-6.1`.



---

archive/issue_comments_115654.json:
```json
{
    "body": "<a id='comment:31'></a>\nAre there any more changes needed for this to get a positive review, or is it only further testing? \n\nLonger term there are a few things I'd like to sort out in this package. Currently it assumes if the compiler is not the Sun compiler, then it is gcc, but that overlooks the possibility of other compilers such as those from IBM and HP. There is now a small script that can determine what C compiler is in use `$SAGE_LOCAL/bin/testcc.sh`. Longer term I'd like to sort that out, but that's not important in the short or medium term. \n\nI tested my previous version actually built on AIX, HP-UX, Linux, OpenSolaris, OS X and Solaris. I found all tests passed on OpenSolaris. Leif has found all tests pass for this version on Linux. \n\nI just this minute started a build and test on OpenSolaris, but I wont know the result for a couple of hours, as it takes an hour to build and test and I will not be in the house at that point - I leave in 35 minute or so. \n\nGiven we now have the buildbot, I would have thought this a fairly low-risk patch to put in sage-4.6.rc1, as any problems should be easily spotted. \n\nDave",
    "created_at": "2010-10-25T07:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115654",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:31'></a>
Are there any more changes needed for this to get a positive review, or is it only further testing? 

Longer term there are a few things I'd like to sort out in this package. Currently it assumes if the compiler is not the Sun compiler, then it is gcc, but that overlooks the possibility of other compilers such as those from IBM and HP. There is now a small script that can determine what C compiler is in use `$SAGE_LOCAL/bin/testcc.sh`. Longer term I'd like to sort that out, but that's not important in the short or medium term. 

I tested my previous version actually built on AIX, HP-UX, Linux, OpenSolaris, OS X and Solaris. I found all tests passed on OpenSolaris. Leif has found all tests pass for this version on Linux. 

I just this minute started a build and test on OpenSolaris, but I wont know the result for a couple of hours, as it takes an hour to build and test and I will not be in the house at that point - I leave in 35 minute or so. 

Given we now have the buildbot, I would have thought this a fairly low-risk patch to put in sage-4.6.rc1, as any problems should be easily spotted. 

Dave



---

archive/issue_comments_115655.json:
```json
{
    "body": "<a id='comment:32'></a>\nI build Sage from scratch with the updated .spkg on a Sun Ultra 27 running OpenSolaris. This was a parallel build, and parallel doctests. Two doctests failed\n\n```\nThe following tests failed:\n\n        sage -t  -long -force_lib devel/sage/sage/interfaces/psage.py # 1 doctests failed\n        sage -t  -long -force_lib devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx # 0 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1675.4 seconds\n```\n\nBut when I run those two tests individually they both passed. I can only assume this is the usual problem - the doctesting framework is partially broken for parallel testing. \n\n```\ndrkirkby@hawk:~/sage-4.6.rc0$ ./sage -t  -long -force_lib devel/sage/sage/interfaces/psage.py\nsage -t -long -force_lib \"devel/sage/sage/interfaces/psage.py\"\n         [24.9 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 25.4 seconds\ndrkirkby@hawk:~/sage-4.6.rc0$ ./sage -t  -long -force_lib devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx\nsage -t -long -force_lib \"devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx\"\n         [13.0 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 13.0 seconds\ndrkirkby@hawk:~/sage-4.6.rc0$ \n```\n\nAs such, Sage has been build from scratch using this package, and has passed all tests on both Linux and OpenSolaris. \n\nDave",
    "created_at": "2010-10-25T12:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115655",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:32'></a>
I build Sage from scratch with the updated .spkg on a Sun Ultra 27 running OpenSolaris. This was a parallel build, and parallel doctests. Two doctests failed

```
The following tests failed:

        sage -t  -long -force_lib devel/sage/sage/interfaces/psage.py # 1 doctests failed
        sage -t  -long -force_lib devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx # 0 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1675.4 seconds
```

But when I run those two tests individually they both passed. I can only assume this is the usual problem - the doctesting framework is partially broken for parallel testing. 

```
drkirkby@hawk:~/sage-4.6.rc0$ ./sage -t  -long -force_lib devel/sage/sage/interfaces/psage.py
sage -t -long -force_lib "devel/sage/sage/interfaces/psage.py"
         [24.9 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 25.4 seconds
drkirkby@hawk:~/sage-4.6.rc0$ ./sage -t  -long -force_lib devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx
sage -t -long -force_lib "devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx"
         [13.0 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 13.0 seconds
drkirkby@hawk:~/sage-4.6.rc0$ 
```

As such, Sage has been build from scratch using this package, and has passed all tests on both Linux and OpenSolaris. 

Dave



---

archive/issue_comments_115656.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [leif](#comment%3A17):\n> A few comments:\n\n\n>  * The following should simply be `if grep -q ... ; then ...`:\n\n\nUsing `grep -q` would cause a problem on Solaris, since the default `grep` in most peoples path is not POSIX compatible. \n\nThis is still awaiting review though. \n\nDave",
    "created_at": "2010-10-27T10:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115656",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:33'></a>
Replying to [leif](#comment%3A17):
> A few comments:


>  * The following should simply be `if grep -q ... ; then ...`:


Using `grep -q` would cause a problem on Solaris, since the default `grep` in most peoples path is not POSIX compatible. 

This is still awaiting review though. 

Dave



---

archive/issue_comments_115657.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.1.alpha0\"",
    "created_at": "2010-11-01T10:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115657",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.6.1.alpha0"



---

archive/issue_comments_115658.json:
```json
{
    "body": "Complete spkg patch for reference",
    "created_at": "2010-11-05T10:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115658",
    "user": "https://github.com/jdemeyer"
}
```

Complete spkg patch for reference



---

archive/issue_comments_115659.json:
```json
{
    "body": "<a id='comment:35'></a>\nAttachment [readline-6.1.patch](tarball://root/attachments/some-uuid/ticket9523/readline-6.1.patch) by @jdemeyer created at 2010-11-05 11:06:23\n\n\"presidence\" sould be \"precedence\"\n\nWhy is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).\n\nI don't like `\"$CC\" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:\n* I don't think $CC is supposed to be quoted because people might do things like CC=\"gcc -m64\"\n* You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.\n* Instead of checking for Sun's compiler, why not check explicitly for `gcc` using\n\n```\n$CC </dev/null >/dev/null 2>/dev/null --version |grep >/dev/null gcc\n```",
    "created_at": "2010-11-05T11:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115659",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Attachment [readline-6.1.patch](tarball://root/attachments/some-uuid/ticket9523/readline-6.1.patch) by @jdemeyer created at 2010-11-05 11:06:23

"presidence" sould be "precedence"

Why is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).

I don't like `"$CC" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:
* I don't think $CC is supposed to be quoted because people might do things like CC="gcc -m64"
* You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.
* Instead of checking for Sun's compiler, why not check explicitly for `gcc` using

```
$CC </dev/null >/dev/null 2>/dev/null --version |grep >/dev/null gcc
```



---

archive/issue_comments_115660.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [jdemeyer](#comment%3A35):\n> \"presidence\" sould be \"precedence\"\n> \n> Why is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).\n\n\nIt is practice to put both. The argument I've heard for doing this is that if the only the patch file is under revision control, if a package gets updated, then the patch is against a version of the source not in the package. So you need to download the old version. \n\nI'm not totally convinced of the logic myself, but it is standard practice. (I'd personally rather just see a patch file, and use 'patch' rather than 'cp', but that is not permitted). \n\n> I don't like `\"$CC\" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:\n> * I don't think $CC is supposed to be quoted because people might do things like CC=\"gcc -m64\"\n\n\nThat would not change the results of the test. I can assure you that works with and without -m64. \n\n>  * You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.\n\n\nI'm unaware of any problems with the current code. \n\n>  * Instead of checking for Sun's compiler, why not check explicitly for `gcc` using\n \n> {{{\n> $CC </dev/null >/dev/null 2>/dev/null --version |grep >/dev/null gcc\n> }}}\n\n\nI forget why, but there was some reason that I did not use the obvious 'gcc --version'. Several compilers act like gcc, but are not actually gcc. I believe the Intel compiler takes the gcc options, so for practical purposes is gcc, but wont output gcc. In any case, I think one can change that string when gcc is built to whatever you want. \n\nHowever, if someone wants to change the test, then the most sensible thing to do is use the script $SAGE_LOCAL/bin/testcc.sh, as that will return one of \n\n* GCC\n* Sun_Studio\n* HP_on_Tru64\n* IBM_on_AIX\n* HP_on_Alpha_Linux\n* Unknown\n\nThat tests what gets defined when (!__SUNPRO_C in the case of the Sun compiler, !__GNUC!__ in the case of gcc etc). \n\nThere are bugs that I'm aware of, that are causing serious problems - #9040 and #9840 are two I would love to solve. I'm reluctant to make a change, which itself has a finite risk of introducing a bug, to \"solve\" a problem that has never been observed. That bit of code has remained unchanged for a long time, and has never caused any problem on any platform. \n\nDave",
    "created_at": "2010-11-05T12:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115660",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:36'></a>
Replying to [jdemeyer](#comment%3A35):
> "presidence" sould be "precedence"
> 
> Why is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).


It is practice to put both. The argument I've heard for doing this is that if the only the patch file is under revision control, if a package gets updated, then the patch is against a version of the source not in the package. So you need to download the old version. 

I'm not totally convinced of the logic myself, but it is standard practice. (I'd personally rather just see a patch file, and use 'patch' rather than 'cp', but that is not permitted). 

> I don't like `"$CC" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:
> * I don't think $CC is supposed to be quoted because people might do things like CC="gcc -m64"


That would not change the results of the test. I can assure you that works with and without -m64. 

>  * You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.


I'm unaware of any problems with the current code. 

>  * Instead of checking for Sun's compiler, why not check explicitly for `gcc` using
 
> {{{
> $CC </dev/null >/dev/null 2>/dev/null --version |grep >/dev/null gcc
> }}}


I forget why, but there was some reason that I did not use the obvious 'gcc --version'. Several compilers act like gcc, but are not actually gcc. I believe the Intel compiler takes the gcc options, so for practical purposes is gcc, but wont output gcc. In any case, I think one can change that string when gcc is built to whatever you want. 

However, if someone wants to change the test, then the most sensible thing to do is use the script $SAGE_LOCAL/bin/testcc.sh, as that will return one of 

* GCC
* Sun_Studio
* HP_on_Tru64
* IBM_on_AIX
* HP_on_Alpha_Linux
* Unknown

That tests what gets defined when (!__SUNPRO_C in the case of the Sun compiler, !__GNUC!__ in the case of gcc etc). 

There are bugs that I'm aware of, that are causing serious problems - #9040 and #9840 are two I would love to solve. I'm reluctant to make a change, which itself has a finite risk of introducing a bug, to "solve" a problem that has never been observed. That bit of code has remained unchanged for a long time, and has never caused any problem on any platform. 

Dave



---

archive/issue_comments_115661.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [drkirkby](#comment%3A36):\n> >  * I don't think $CC is supposed to be quoted because people might do things like CC=\"gcc -m64\"\n \n> \n> That would not change the results of the test. I can assure you that works with and without -m64. \n\n\nReally?  With `GNU bash, version 4.0.35(1)-release (x86_64-pc-linux-gnu)`, I get\n\n```\n$ CC=\"gcc -m64\"\n$ \"$CC\" --version\nbash: gcc -m64: command not found\n```\n\n> >  * You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.\n \n> \n> I'm unaware of any problems with the current code.\n\nMe neither, but I think redirecting stdin from `/dev/null` does no harm and is safer.",
    "created_at": "2010-11-05T12:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115661",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [drkirkby](#comment%3A36):
> >  * I don't think $CC is supposed to be quoted because people might do things like CC="gcc -m64"
 
> 
> That would not change the results of the test. I can assure you that works with and without -m64. 


Really?  With `GNU bash, version 4.0.35(1)-release (x86_64-pc-linux-gnu)`, I get

```
$ CC="gcc -m64"
$ "$CC" --version
bash: gcc -m64: command not found
```

> >  * You should redirect stdin from `/dev/null` in case $CC wants to read from stdin.
 
> 
> I'm unaware of any problems with the current code.

Me neither, but I think redirecting stdin from `/dev/null` does no harm and is safer.



---

archive/issue_comments_115662.json:
```json
{
    "body": "<a id='comment:38'></a>\nFor the record: GNU autoconf uses `$CC` without quoting and redirects stdin from `/dev/null` (for the whole `configure` script using `exec`).",
    "created_at": "2010-11-05T13:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115662",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
For the record: GNU autoconf uses `$CC` without quoting and redirects stdin from `/dev/null` (for the whole `configure` script using `exec`).



---

archive/issue_comments_115663.json:
```json
{
    "body": "<a id='comment:39'></a>\nBy the way: I think the quoting of `$CC` really is a bug, I care less about the other issues.",
    "created_at": "2010-11-05T13:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115663",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
By the way: I think the quoting of `$CC` really is a bug, I care less about the other issues.



---

archive/issue_comments_115664.json:
```json
{
    "body": "Changing reviewer from \"Florent Hivert, Leif Leonhardy\" to \"Florent Hivert, Leif Leonhardy, Jeroen Demeyer\"",
    "created_at": "2010-11-05T13:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115664",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "Florent Hivert, Leif Leonhardy" to "Florent Hivert, Leif Leonhardy, Jeroen Demeyer"



---

archive/issue_comments_115665.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-05T13:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115665",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115666.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [drkirkby](#comment%3A36):\n> Replying to [jdemeyer](#comment%3A35):\n> > Why is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).\n\n> \n> It is practice to put both. The argument I've heard for doing this is that if the only the patch file is under revision control, if a package gets updated, then the patch is against a version of the source not in the package. So you need to download the old version.\n\n\nWell, that's of course b*llsh*t, since the old source code is in the old spkg you're going to upgrade. But it is long and current practice, as Dave says.\n\nA more convincing reason is that it is safer to put both under revision control, since some people might update just the patch and not the patched file which is copied over. This is easy to see with `hg log`, though one would also notice that by just looking at the file modification times.\n\n> I'm not totally convinced of the logic myself, but it is standard practice. (I'd personally rather just see a patch file, and use 'patch' rather than 'cp', but that is not permitted).\n\n\nIn the light of 1 MB `configure.in` etc. in `patches/` and the Mercurial repository, I'd also rather have just the patches (diffs) there, i.e. omitting pre-patched files at all.\n\nThis would either require (explicitly) making `patch` a prerequisite (which is IMHO not a problem), or - perhaps in addition - providing `ed` patches, with isn't very nice (and complicates reviewing).\n\n> > I don't like `\"$CC\" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:\n> > * I don't think $CC is supposed to be quoted because people might do things like CC=\"gcc -m64\"\n\n> \n> That would not change the results of the test. I can assure you that works with and without -m64.\n\n\nAs Jeroen noted, this *does* make a difference. I do not even get an error message:\n\n```sh\n$ \"gcc -m64\" --version ; echo $?     # equivalent to gcc\\ -m64 --version\n127\n$ gcc -m64 --version ; echo $?\ngcc (Ubuntu 4.4.3-4ubuntu5) 4.4.3\nCopyright (C) 2009 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n0\n```\n\nI wanted to make a reviewer patch anyway, since we need to also patch the `pkg-config` file created by freetype to avoid potential trouble with Sage relocation. (Btw, the term \"migration\" would be less ambiguous, though it is used in other contexts as well, but certainly not within Sage.)",
    "created_at": "2010-11-05T13:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115666",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:40'></a>
Replying to [drkirkby](#comment%3A36):
> Replying to [jdemeyer](#comment%3A35):
> > Why is `patches/shobj-conf` under revision control?  I believe it is sufficient for the patch file to be under revision control (but putting the *patched* files also under revision control might be the usual Sage practice).

> 
> It is practice to put both. The argument I've heard for doing this is that if the only the patch file is under revision control, if a package gets updated, then the patch is against a version of the source not in the package. So you need to download the old version.


Well, that's of course b*llsh*t, since the old source code is in the old spkg you're going to upgrade. But it is long and current practice, as Dave says.

A more convincing reason is that it is safer to put both under revision control, since some people might update just the patch and not the patched file which is copied over. This is easy to see with `hg log`, though one would also notice that by just looking at the file modification times.

> I'm not totally convinced of the logic myself, but it is standard practice. (I'd personally rather just see a patch file, and use 'patch' rather than 'cp', but that is not permitted).


In the light of 1 MB `configure.in` etc. in `patches/` and the Mercurial repository, I'd also rather have just the patches (diffs) there, i.e. omitting pre-patched files at all.

This would either require (explicitly) making `patch` a prerequisite (which is IMHO not a problem), or - perhaps in addition - providing `ed` patches, with isn't very nice (and complicates reviewing).

> > I don't like `"$CC" -flags > /dev/null 2>&1` (`spkg-install` line 43) for various reasons:
> > * I don't think $CC is supposed to be quoted because people might do things like CC="gcc -m64"

> 
> That would not change the results of the test. I can assure you that works with and without -m64.


As Jeroen noted, this *does* make a difference. I do not even get an error message:

```sh
$ "gcc -m64" --version ; echo $?     # equivalent to gcc\ -m64 --version
127
$ gcc -m64 --version ; echo $?
gcc (Ubuntu 4.4.3-4ubuntu5) 4.4.3
Copyright (C) 2009 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

0
```

I wanted to make a reviewer patch anyway, since we need to also patch the `pkg-config` file created by freetype to avoid potential trouble with Sage relocation. (Btw, the term "migration" would be less ambiguous, though it is used in other contexts as well, but certainly not within Sage.)



---

archive/issue_comments_115667.json:
```json
{
    "body": "<a id='comment:41'></a>\nNone of this is causing a problem with the package:\n\n```\nexport CC=\"gcc -m64\"\n\n<snip>\n\nreadline-6.1/src/rlwinsize.h\nFinished extraction\n****************************************************\nHost system\nuname -a:\nSunOS hawk 5.11 snv_134 i86pc i386 i86pc\n****************************************************\n****************************************************\nCC Version\ngcc -m64 -v\nUsing built-in specs.\nCOLLECT_GCC=/usr/local/gcc-4.5.0/bin/gcc\nCOLLECT_LTO_WRAPPER=/usr/local/gcc-4.5.0/libexec/gcc/i386-pc-solaris2.10/4.5.0/lto-wrapper\nTarget: i386-pc-solaris2.10\nConfigured with: ../gcc-4.5.0/configure --prefix=/usr/local/gcc-4.5.0 --build=i386-pc-solaris2.10 --enable-languages=c,c++,fortran --with-gmp=/usr/local/gcc-4.5.0 --with-mpfr=/usr/local/gcc-4.5.0 --disable-nls --enable-checking=release --enable-werror=no --enable-multilib -with-system-zlib --enable-bootstrap --with-gnu-as --with-as=/usr/local/binutils-2.20/bin/as --without-gnu-ld --with-ld=/usr/ccs/bin/ld\nThread model: posix\ngcc version 4.5.0 (GCC) \n****************************************************\nBuilding a 64-bit version of Readline\nUsing CC=gcc -m64\nThe following environment variables will be exported.\nUsing CFLAGS=-O2  -m64 -g -O2 -Wall\nUsing CPPFLAGS=\nUsing LDFLAGS= -m64\n```\n\nbut I'm happy to change it. \n\nI long ago created a package for 'patch'\n\nhttp://boxen.math.washington.edu/home/kirkby/patches/patch-2.6.1.spkg\n\nI think William finally agreed to make it part of sage, since many wanted it. But then after that others had convinced him there were better ways do it with Mercurial, so I gave up the idea. \n\nLeif, what has the pkg-config file for freetype got to do with this readline package? \n\nDo you want to create a reviewer patch, or shall I unquote CC? \n\nDave",
    "created_at": "2010-11-05T16:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115667",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:41'></a>
None of this is causing a problem with the package:

```
export CC="gcc -m64"

<snip>

readline-6.1/src/rlwinsize.h
Finished extraction
****************************************************
Host system
uname -a:
SunOS hawk 5.11 snv_134 i86pc i386 i86pc
****************************************************
****************************************************
CC Version
gcc -m64 -v
Using built-in specs.
COLLECT_GCC=/usr/local/gcc-4.5.0/bin/gcc
COLLECT_LTO_WRAPPER=/usr/local/gcc-4.5.0/libexec/gcc/i386-pc-solaris2.10/4.5.0/lto-wrapper
Target: i386-pc-solaris2.10
Configured with: ../gcc-4.5.0/configure --prefix=/usr/local/gcc-4.5.0 --build=i386-pc-solaris2.10 --enable-languages=c,c++,fortran --with-gmp=/usr/local/gcc-4.5.0 --with-mpfr=/usr/local/gcc-4.5.0 --disable-nls --enable-checking=release --enable-werror=no --enable-multilib -with-system-zlib --enable-bootstrap --with-gnu-as --with-as=/usr/local/binutils-2.20/bin/as --without-gnu-ld --with-ld=/usr/ccs/bin/ld
Thread model: posix
gcc version 4.5.0 (GCC) 
****************************************************
Building a 64-bit version of Readline
Using CC=gcc -m64
The following environment variables will be exported.
Using CFLAGS=-O2  -m64 -g -O2 -Wall
Using CPPFLAGS=
Using LDFLAGS= -m64
```

but I'm happy to change it. 

I long ago created a package for 'patch'

http://boxen.math.washington.edu/home/kirkby/patches/patch-2.6.1.spkg

I think William finally agreed to make it part of sage, since many wanted it. But then after that others had convinced him there were better ways do it with Mercurial, so I gave up the idea. 

Leif, what has the pkg-config file for freetype got to do with this readline package? 

Do you want to create a reviewer patch, or shall I unquote CC? 

Dave



---

archive/issue_comments_115668.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [drkirkby](#comment%3A41):\n> None of this is causing a problem with the package:\n> but I'm happy to change it.\n\n\nOf course it incidentally \"works\" *there*, because we are not looking for `gcc`. If you define `CC=\"suncc -whatever\"` it won't work, i.e. not recognize Sun's `cc`.\n\n\n> I long ago created a package for 'patch'\n> \n> http://boxen.math.washington.edu/home/kirkby/patches/patch-2.6.1.spkg\n> \n> I think William finally agreed to make it part of sage, since many wanted it. But then after that others had convinced him there were better ways do it with Mercurial, so I gave up the idea.\n\n\nI think we don't have to provide a (standard) package to make `patch` a prerequisite.\n\nNote that Mercurial depends on Python, so unless we make one of these a prerequisite, using Mercurial instead (which I wouldn't like) isn't an option.\n\n\n> Leif, what has the pkg-config file for freetype got to do with this readline package?\n\n\nGood question... ;-) Apparently wrong ticket... (Confused that because updating the readline spkg *triggered* the `pkg-config` problems with freetype.)\n\n> Do you want to create a reviewer patch, or shall I unquote CC?\n\n\nI can do that, as I've suggested some other minor changes [above](#comment%3A28).",
    "created_at": "2010-11-05T16:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115668",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:42'></a>
Replying to [drkirkby](#comment%3A41):
> None of this is causing a problem with the package:
> but I'm happy to change it.


Of course it incidentally "works" *there*, because we are not looking for `gcc`. If you define `CC="suncc -whatever"` it won't work, i.e. not recognize Sun's `cc`.


> I long ago created a package for 'patch'
> 
> http://boxen.math.washington.edu/home/kirkby/patches/patch-2.6.1.spkg
> 
> I think William finally agreed to make it part of sage, since many wanted it. But then after that others had convinced him there were better ways do it with Mercurial, so I gave up the idea.


I think we don't have to provide a (standard) package to make `patch` a prerequisite.

Note that Mercurial depends on Python, so unless we make one of these a prerequisite, using Mercurial instead (which I wouldn't like) isn't an option.


> Leif, what has the pkg-config file for freetype got to do with this readline package?


Good question... ;-) Apparently wrong ticket... (Confused that because updating the readline spkg *triggered* the `pkg-config` problems with freetype.)

> Do you want to create a reviewer patch, or shall I unquote CC?


I can do that, as I've suggested some other minor changes [above](#comment%3A28).



---

archive/issue_comments_115669.json:
```json
{
    "body": "<a id='comment:43'></a>\nGrrr, I just noticed we still have to include the changes from #9530 as well, so either we provide two additional patches, or it will take a bit longer.\n\nI think I'll first upload a reviewer patch without the changes from there.",
    "created_at": "2010-11-05T17:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115669",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Grrr, I just noticed we still have to include the changes from #9530 as well, so either we provide two additional patches, or it will take a bit longer.

I think I'll first upload a reviewer patch without the changes from there.



---

archive/issue_comments_115670.json:
```json
{
    "body": "Attachment [trac_9523-first_reviewer.patch](tarball://root/attachments/some-uuid/ticket9523/trac_9523-first_reviewer.patch) by @nexttime created at 2010-11-05 17:16:07\n\nSPKG reviewer patch. Removes quotes from `$CC`etc. Apply on top of Dave's \"further clean-up\" patch.",
    "created_at": "2010-11-05T17:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115670",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_9523-first_reviewer.patch](tarball://root/attachments/some-uuid/ticket9523/trac_9523-first_reviewer.patch) by @nexttime created at 2010-11-05 17:16:07

SPKG reviewer patch. Removes quotes from `$CC`etc. Apply on top of Dave's "further clean-up" patch.



---

archive/issue_comments_115671.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [leif](#comment%3A43):\n> I think I'll first upload a reviewer patch without the changes from there.\n\n\nDid so.",
    "created_at": "2010-11-05T17:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115671",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:44'></a>
Replying to [leif](#comment%3A43):
> I think I'll first upload a reviewer patch without the changes from there.


Did so.



---

archive/issue_comments_115672.json:
```json
{
    "body": "Changing merged from \"sage-4.6.1.alpha0\" to \"\"",
    "created_at": "2010-11-07T10:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115672",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "sage-4.6.1.alpha0" to ""



---

archive/issue_comments_115673.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rebase to readline-6.0.p4.spkg (#9530)\"",
    "created_at": "2010-11-07T10:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115673",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "rebase to readline-6.0.p4.spkg (#9530)"



---

archive/issue_comments_115674.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-11-11T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115674",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115675.json:
```json
{
    "body": "<a id='comment:46'></a>\nI had difficulty merging the changes made on this ticket to the changes made in readline-6.0.p4.spkg (see #9530). There were a lot of rejects and I was less confident of sorting them out, then doing the changes manually. \n\nAs such, I've taken the readline-6.0.p4.spkg, and manually made the changes originally made here. It's not totally impossible I've missed one, but I think they are ok. \n\nSo I'm attaching a new patch, `9523-brand-new-patch-based-on-readline-6.0.p4.patch` which should have all the changes need to sort out the update, and clean the package somewhat. \n\nThe updated package can be found at \n\nhttp://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg \n\n(if you want to look at my previous attempt, see http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg)\n\nDave",
    "created_at": "2010-11-11T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115675",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:46'></a>
I had difficulty merging the changes made on this ticket to the changes made in readline-6.0.p4.spkg (see #9530). There were a lot of rejects and I was less confident of sorting them out, then doing the changes manually. 

As such, I've taken the readline-6.0.p4.spkg, and manually made the changes originally made here. It's not totally impossible I've missed one, but I think they are ok. 

So I'm attaching a new patch, `9523-brand-new-patch-based-on-readline-6.0.p4.patch` which should have all the changes need to sort out the update, and clean the package somewhat. 

The updated package can be found at 

http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg 

(if you want to look at my previous attempt, see http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg)

Dave



---

archive/issue_comments_115676.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,4 +14,5 @@\n Related: #9530, #9987\n \n An updated .spkg can be found at\n-http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg\n+http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg \n+which is based on readline-6.0.p4.spkg from #9530. \n``````\n",
    "created_at": "2010-11-11T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115676",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,4 +14,5 @@
 Related: #9530, #9987
 
 An updated .spkg can be found at
-http://boxen.math.washington.edu/home/kirkby/patches/readline-6.1.spkg
+http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg 
+which is based on readline-6.0.p4.spkg from #9530. 
``````




---

archive/issue_comments_115677.json:
```json
{
    "body": "Attachment [9523-brand-new-patch-based-on-readline-6.0.p4.patch](tarball://root/attachments/some-uuid/ticket9523/9523-brand-new-patch-based-on-readline-6.0.p4.patch) by drkirkby created at 2010-11-11 19:47:01\n\nMercurial patch with all (well hopefully all) the changes needed to update to 6.1 and clean up.",
    "created_at": "2010-11-11T19:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115677",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [9523-brand-new-patch-based-on-readline-6.0.p4.patch](tarball://root/attachments/some-uuid/ticket9523/9523-brand-new-patch-based-on-readline-6.0.p4.patch) by drkirkby created at 2010-11-11 19:47:01

Mercurial patch with all (well hopefully all) the changes needed to update to 6.1 and clean up.



---

archive/issue_comments_115678.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.6.1.alpha2\"",
    "created_at": "2010-11-19T07:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115678",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.6.1.alpha2"



---

archive/issue_comments_115679.json:
```json
{
    "body": "<a id='comment:49'></a>\nFYI, for OpenSUSE 11.0 and 11.1, Sage should not try to use the system readline, because it will be a .5 version. It will only build if the special OpenSUSE handling is *not* there. See also http://groups.google.com/group/sage-devel/browse_thread/thread/71d3a99910e11b01",
    "created_at": "2010-12-13T12:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115679",
    "user": "https://trac.sagemath.org/admin/accounts/users/Koen"
}
```

<a id='comment:49'></a>
FYI, for OpenSUSE 11.0 and 11.1, Sage should not try to use the system readline, because it will be a .5 version. It will only build if the special OpenSUSE handling is *not* there. See also http://groups.google.com/group/sage-devel/browse_thread/thread/71d3a99910e11b01



---

archive/issue_comments_115680.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [Koen](#comment%3A49):\n> FYI, for OpenSUSE 11.0 and 11.1, Sage should not try to use the system readline, because it will be a .5 version. It will only build if the special OpenSUSE handling is *not* there. See also http://groups.google.com/group/sage-devel/browse_thread/thread/71d3a99910e11b01\n\n\nThanks. Then I'd say **needs work**...\n\nMaybe we should compare the versions and always use the newer one?\nBut this causes trouble in case the interface changes, but not its \"official\" version (which should IMHO never happen though).",
    "created_at": "2010-12-13T14:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115680",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'></a>
Replying to [Koen](#comment%3A49):
> FYI, for OpenSUSE 11.0 and 11.1, Sage should not try to use the system readline, because it will be a .5 version. It will only build if the special OpenSUSE handling is *not* there. See also http://groups.google.com/group/sage-devel/browse_thread/thread/71d3a99910e11b01


Thanks. Then I'd say **needs work**...

Maybe we should compare the versions and always use the newer one?
But this causes trouble in case the interface changes, but not its "official" version (which should IMHO never happen though).



---

archive/issue_comments_115681.json:
```json
{
    "body": "<a id='comment:51'></a>\nWhy do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.",
    "created_at": "2010-12-13T14:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115681",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>
Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.



---

archive/issue_comments_115682.json:
```json
{
    "body": "<a id='comment:52'></a>\n`CFLAGS` still (or again) get overwritten even if `SAGE_DEBUG` is not \"yes\".",
    "created_at": "2010-12-13T15:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115682",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:52'></a>
`CFLAGS` still (or again) get overwritten even if `SAGE_DEBUG` is not "yes".



---

archive/issue_comments_115683.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [jdemeyer](#comment%3A51):\n> Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.\n\n\n:D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...\n\nOtherwise the problem remains or rearises with future releases of these OSs.",
    "created_at": "2010-12-13T15:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115683",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'></a>
Replying to [jdemeyer](#comment%3A51):
> Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.


:D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...

Otherwise the problem remains or rearises with future releases of these OSs.



---

archive/issue_comments_115684.json:
```json
{
    "body": "<a id='comment:54'></a>\nWe could just always build Sage's readline and - **before** installing it - test if it works with `/bin/bash` by e.g.\n\n```sh\nif env LD_LIBRARY_PATH=\".\" bash -c \"echo 'Bash works with this version of readline.'\"; then\n    $MAKE install\n    ...\nelse\n    echo \"Bash doesn't work with Sage's version of readline - using the system's one.\"\n    # Can this cause trouble with *older* system libreadlines?\n    # We still need a *development* version of readline btw.\n    exit 0\nfi\n```",
    "created_at": "2010-12-13T15:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115684",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:54'></a>
We could just always build Sage's readline and - **before** installing it - test if it works with `/bin/bash` by e.g.

```sh
if env LD_LIBRARY_PATH="." bash -c "echo 'Bash works with this version of readline.'"; then
    $MAKE install
    ...
else
    echo "Bash doesn't work with Sage's version of readline - using the system's one."
    # Can this cause trouble with *older* system libreadlines?
    # We still need a *development* version of readline btw.
    exit 0
fi
```



---

archive/issue_comments_115685.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [leif](#comment%3A53):\n> Replying to [jdemeyer](#comment%3A51):\n> > Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.\n\n> \n> :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...\n> \n> Otherwise the problem remains or rearises with future releases of these OSs.\n\nTrue, but this problem is not specific to these OSs and applies to every OS.",
    "created_at": "2010-12-13T15:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115685",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>
Replying to [leif](#comment%3A53):
> Replying to [jdemeyer](#comment%3A51):
> > Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.

> 
> :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...
> 
> Otherwise the problem remains or rearises with future releases of these OSs.

True, but this problem is not specific to these OSs and applies to every OS.



---

archive/issue_comments_115686.json:
```json
{
    "body": "Changing work_issues from \"rebase to readline-6.0.p4.spkg (#9530)\" to \"\"",
    "created_at": "2010-12-13T15:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115686",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "rebase to readline-6.0.p4.spkg (#9530)" to ""



---

archive/issue_comments_115687.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-12-13T15:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115687",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_115688.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [jdemeyer](#comment%3A55):\n> Replying to [leif](#comment%3A53):\n> > Replying to [jdemeyer](#comment%3A51):\n> > > Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.\n\n> > \n> > :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...\n> > \n> > Otherwise the problem remains or rearises with future releases of these OSs.\n\n> True, but this problem is not specific to these OSs and applies to every OS.\n\nNot really. Others work fine, so I consider testing if `bash` works with our readline also an (implicit) special case.\n\nWould you be happy with that?\n\n(I think at least it doesn't hurt doing so, i.e. testing `bash` against Sage's readline before installing it. Better to give a concise error message than risking other weird build errors.)",
    "created_at": "2010-12-13T16:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115688",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:56'></a>
Replying to [jdemeyer](#comment%3A55):
> Replying to [leif](#comment%3A53):
> > Replying to [jdemeyer](#comment%3A51):
> > > Why do we need to special-case OpenSUSE in the first place?  I thought the whole point of this ticket was **not** to have any special cases any more.

> > 
> > :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...
> > 
> > Otherwise the problem remains or rearises with future releases of these OSs.

> True, but this problem is not specific to these OSs and applies to every OS.

Not really. Others work fine, so I consider testing if `bash` works with our readline also an (implicit) special case.

Would you be happy with that?

(I think at least it doesn't hurt doing so, i.e. testing `bash` against Sage's readline before installing it. Better to give a concise error message than risking other weird build errors.)



---

archive/issue_comments_115689.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [jdemeyer](#comment%3A55):\n> Replying to [leif](#comment%3A53):\n> > :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...\n> > \n> > Otherwise the problem remains or rearises with future releases of these OSs.\n\n> True, but this problem is not specific to these OSs and applies to every OS.\n\nIt seems to be specific to these two Linux distributions - though perhaps there are others, as one Linux distro tends to be based on another. Mint is based on Ubuntu, which is itself based on Debian. \n\nMost other distros don't ship with a bash that is dynamically linked to readline. It's never been a problem on Solaris or OS X either. Although I've never built Sage fully on either AIX or HP-UX, I'm not aware of any bash/readline issues on those operating systems either. \n\nUnless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. \n\nhttp://wiki.sagemath.org/SupportedPlatforms#Linux\n\nsays 11.1 is supported, and 11.2 and 11.3 are known to be broken. \n\nI simply don't have access to the hardware/software to test this. \n\nWilliam posted a few weeks ago he was wanting people to administer virtual machines. Unless someone is going to do this for the latest OpenSUSE, then I can't see how we can support it. I already admin two machines myself which are buildbot slavs (*hawk* and *t2*). \n\nDave",
    "created_at": "2010-12-13T18:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115689",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:57'></a>
Replying to [jdemeyer](#comment%3A55):
> Replying to [leif](#comment%3A53):
> > :D If you convince the openSUSE and ArchLinux developers to never make `bash` depend on a newer libreadline than Sage ships...
> > 
> > Otherwise the problem remains or rearises with future releases of these OSs.

> True, but this problem is not specific to these OSs and applies to every OS.

It seems to be specific to these two Linux distributions - though perhaps there are others, as one Linux distro tends to be based on another. Mint is based on Ubuntu, which is itself based on Debian. 

Most other distros don't ship with a bash that is dynamically linked to readline. It's never been a problem on Solaris or OS X either. Although I've never built Sage fully on either AIX or HP-UX, I'm not aware of any bash/readline issues on those operating systems either. 

Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. 

http://wiki.sagemath.org/SupportedPlatforms#Linux

says 11.1 is supported, and 11.2 and 11.3 are known to be broken. 

I simply don't have access to the hardware/software to test this. 

William posted a few weeks ago he was wanting people to administer virtual machines. Unless someone is going to do this for the latest OpenSUSE, then I can't see how we can support it. I already admin two machines myself which are buildbot slavs (*hawk* and *t2*). 

Dave



---

archive/issue_comments_115690.json:
```json
{
    "body": "<a id='comment:58'></a>\nReplying to [drkirkby](#comment%3A57):\n> Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. \n> \n> http://wiki.sagemath.org/SupportedPlatforms#Linux\n> \n> says 11.1 is supported, and 11.2 and 11.3 are known to be broken. \n> \n> I simply don't have access to the hardware/software to test this.\n\n\nJust provide an spkg and let the others test (and review) it... ;-)\n\n(until we get more build slaves, running these distros.)\n\n\n \n> William posted a few weeks ago he was wanting people to administer virtual machines. Unless someone is going to do this for the latest OpenSUSE, then I can't see how we can support it. I already admin two machines myself which are buildbot slavs (*hawk* and *t2*). \n\n\n---\n\nAs mentioned on sage-devel, a work-around for a Bash broken by Sage's readline is to set its `RPATH` or `RUNPATH` (with `chrpath`). We could give a hint to that in an error (or warning) message in case we detect installing our readline would break `bash` (but don't know for sure using the system's libreadline will work for us).",
    "created_at": "2010-12-13T18:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115690",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:58'></a>
Replying to [drkirkby](#comment%3A57):
> Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. 
> 
> http://wiki.sagemath.org/SupportedPlatforms#Linux
> 
> says 11.1 is supported, and 11.2 and 11.3 are known to be broken. 
> 
> I simply don't have access to the hardware/software to test this.


Just provide an spkg and let the others test (and review) it... ;-)

(until we get more build slaves, running these distros.)


 
> William posted a few weeks ago he was wanting people to administer virtual machines. Unless someone is going to do this for the latest OpenSUSE, then I can't see how we can support it. I already admin two machines myself which are buildbot slavs (*hawk* and *t2*). 


---

As mentioned on sage-devel, a work-around for a Bash broken by Sage's readline is to set its `RPATH` or `RUNPATH` (with `chrpath`). We could give a hint to that in an error (or warning) message in case we detect installing our readline would break `bash` (but don't know for sure using the system's libreadline will work for us).



---

archive/issue_comments_115691.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [leif](#comment%3A56):\n> Not really. Others work fine, so I consider testing if `bash` works with our readline also an (implicit) special case.\n> \n> Would you be happy with that?\n\nWell, I don't care too much about this, but if it's possible to test whether `bash` works, that certainly is a better solution.",
    "created_at": "2010-12-13T20:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115691",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'></a>
Replying to [leif](#comment%3A56):
> Not really. Others work fine, so I consider testing if `bash` works with our readline also an (implicit) special case.
> 
> Would you be happy with that?

Well, I don't care too much about this, but if it's possible to test whether `bash` works, that certainly is a better solution.



---

archive/issue_comments_115692.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [leif](#comment%3A58):\n> As mentioned on sage-devel, a work-around for a Bash broken by Sage's readline is to set its `RPATH` or `RUNPATH` (with `chrpath`). We could give a hint to that in an error (or warning) message in case we detect installing our readline would break `bash` (but don't know for sure using the system's libreadline will work for us).\n\n\ns/set its `RPATH`/change an existing `RPATH` or `RUNPATH`/\n\nor use `patchelf`, which also supports **creating** / adding such tags.\n\n\nAnother work-around is to set up a `bash` wrapper that (re)sets `LD_LIBRARY_PATH`... ;-)",
    "created_at": "2010-12-13T20:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115692",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:60'></a>
Replying to [leif](#comment%3A58):
> As mentioned on sage-devel, a work-around for a Bash broken by Sage's readline is to set its `RPATH` or `RUNPATH` (with `chrpath`). We could give a hint to that in an error (or warning) message in case we detect installing our readline would break `bash` (but don't know for sure using the system's libreadline will work for us).


s/set its `RPATH`/change an existing `RPATH` or `RUNPATH`/

or use `patchelf`, which also supports **creating** / adding such tags.


Another work-around is to set up a `bash` wrapper that (re)sets `LD_LIBRARY_PATH`... ;-)



---

archive/issue_comments_115693.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [drkirkby](#comment%3A57):\n> Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. \n> \n> http://wiki.sagemath.org/SupportedPlatforms#Linux\n> \n> says 11.1 is supported, and 11.2 and 11.3 are known to be broken. \n> \n> I simply don't have access to the hardware/software to test this. \n\n\nI've been testing openSUSE lately - and theory and practice are completely reversed. Sage does not build on 11.1 due to readline 5.x being the default there. Whereas on openSUSE 11.2 and 11.3, Sage builds properly (a recent 4.6.1.rc0 snapshot).\nHowever, I'm not sure how to test if my final Sage 'works' w.r.t. the readline/bash problem, so I will only claim that it builds and sage starts properly.",
    "created_at": "2010-12-13T23:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115693",
    "user": "https://trac.sagemath.org/admin/accounts/users/Koen"
}
```

<a id='comment:61'></a>
Replying to [drkirkby](#comment%3A57):
> Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. 
> 
> http://wiki.sagemath.org/SupportedPlatforms#Linux
> 
> says 11.1 is supported, and 11.2 and 11.3 are known to be broken. 
> 
> I simply don't have access to the hardware/software to test this. 


I've been testing openSUSE lately - and theory and practice are completely reversed. Sage does not build on 11.1 due to readline 5.x being the default there. Whereas on openSUSE 11.2 and 11.3, Sage builds properly (a recent 4.6.1.rc0 snapshot).
However, I'm not sure how to test if my final Sage 'works' w.r.t. the readline/bash problem, so I will only claim that it builds and sage starts properly.



---

archive/issue_comments_115694.json:
```json
{
    "body": "<a id='comment:62'></a>\nNote: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).",
    "created_at": "2010-12-13T23:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115694",
    "user": "https://trac.sagemath.org/admin/accounts/users/Koen"
}
```

<a id='comment:62'></a>
Note: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).



---

archive/issue_comments_115695.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [Koen](#comment%3A62):\n> Note: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).\n\n\nWe shouldn't have to drop support for that, installing / using our 6.1 package should work there as well.\n\n(Bash would still use the system's 5.x version.)\n\nWe just have to fix / remove the old copying stuff... (and I would add the mentioned sanity check).",
    "created_at": "2010-12-14T00:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115695",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:63'></a>
Replying to [Koen](#comment%3A62):
> Note: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).


We shouldn't have to drop support for that, installing / using our 6.1 package should work there as well.

(Bash would still use the system's 5.x version.)

We just have to fix / remove the old copying stuff... (and I would add the mentioned sanity check).



---

archive/issue_comments_115696.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [Koen](#comment%3A62):\n> Note: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).\n\n\nIt's a shame that support is dropped so soon in the Linux world - this contrasts widely with professional Unix systems like Solaris. Solaris 8 was released in February 2000 and will be supported until March 2012 (i.e. supported for 12 years). Similar patterns will be seen on AIX and HP-UX I expect. \n\nNot everyone runs the latest version of the operating system. For many people, they don't update the OS until they buy a new computer. I consider myself pretty IT literate, but looking at my computers, many don't have the latest releases. I grew out of the habit of updating the OS because a new one came out. \n\nDave",
    "created_at": "2010-12-14T01:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115696",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:64'></a>
Replying to [Koen](#comment%3A62):
> Note: it might be reasonable to drop support for openSUSE 11.1, because it will stop receiving security updates after December 31st, 2010 (the release is 2 years old now).


It's a shame that support is dropped so soon in the Linux world - this contrasts widely with professional Unix systems like Solaris. Solaris 8 was released in February 2000 and will be supported until March 2012 (i.e. supported for 12 years). Similar patterns will be seen on AIX and HP-UX I expect. 

Not everyone runs the latest version of the operating system. For many people, they don't update the OS until they buy a new computer. I consider myself pretty IT literate, but looking at my computers, many don't have the latest releases. I grew out of the habit of updating the OS because a new one came out. 

Dave



---

archive/issue_comments_115697.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [leif](#comment%3A58):\n> Replying to [drkirkby](#comment%3A57):\n> > Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. \n> > \n> > http://wiki.sagemath.org/SupportedPlatforms#Linux\n> > \n> > says 11.1 is supported, and 11.2 and 11.3 are known to be broken. \n> > \n> > I simply don't have access to the hardware/software to test this.\n\n> \n> Just provide an spkg and let the others test (and review) it... ;-)\n> \n> (until we get more build slaves, running these distros.)\n\n\nI've done that. I created the package. It's now marked as \"needs work\" but it is going to need to be worked on by someone else. \n\nIn general, I very much like the approach taken by `autoconf`, where instead of having a huge lookup table detailing what version of what OS supports this function or that function, it actually **tests** the functionality. Overall that seems a far more logical approach to me, and seems to be what Jeroen is proposing. If we can **test** the functionality of bash, rather than having code that attempts to find a specific Linux release, then testing seems a better way forward. \n\nDave",
    "created_at": "2010-12-14T02:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115697",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:65'></a>
Replying to [leif](#comment%3A58):
> Replying to [drkirkby](#comment%3A57):
> > Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. 
> > 
> > http://wiki.sagemath.org/SupportedPlatforms#Linux
> > 
> > says 11.1 is supported, and 11.2 and 11.3 are known to be broken. 
> > 
> > I simply don't have access to the hardware/software to test this.

> 
> Just provide an spkg and let the others test (and review) it... ;-)
> 
> (until we get more build slaves, running these distros.)


I've done that. I created the package. It's now marked as "needs work" but it is going to need to be worked on by someone else. 

In general, I very much like the approach taken by `autoconf`, where instead of having a huge lookup table detailing what version of what OS supports this function or that function, it actually **tests** the functionality. Overall that seems a far more logical approach to me, and seems to be what Jeroen is proposing. If we can **test** the functionality of bash, rather than having code that attempts to find a specific Linux release, then testing seems a better way forward. 

Dave



---

archive/issue_comments_115698.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [drkirkby](#comment%3A65):\n> I've done that. I created the package. It's now marked as \"needs work\" but it is going to need to be worked on by someone else.\n\n\nOk. If you're not going to change it further, I can do that in the next days.\n\n\n \n> In general, I very much like the approach taken by `autoconf`, where instead of having a huge lookup table detailing what version of what OS supports this function or that function, it actually **tests** the functionality. Overall that seems a far more logical approach to me, and seems to be what Jeroen is proposing. If we can **test** the functionality of bash, rather than having code that attempts to find a specific Linux release, then testing seems a better way forward.\n\n\nWell, autotools, or the scripts their files are built from, have a lot of knowledge coded into them (like chess programs, or e.g. `gcc`, too), i.e. they also - at least partially - detect the system and make the choices based on that.\n\n(And packages using autotools still have `configure` options like `--with-package-xy=/path/to/package-xy`, `--with-included-package-xy` and `--with-system-package-xy`, and lots of `--disable-*` and `--enable-*` one sometimes *has to* specify manually. Try e.g. building a \"customized\" version of a recent GCC, with dozens of settings also for GMP, MPFR, MPC, PPL and CLooG, probably other packages like gettext and zlib as well. Also, GCC does drop support of older platforms, OSs and architectures, due to a lack of developer resources.)\n\n\nFeel free to extend Sage's `configure` (which really could do much more, setting appropriate environment variables [like your famous `CFLAG64`] etc.)...\n\nBut Sage is (also) a distro with many \"foreign\" packages, not just a program, and to make things work together, we have to make choices normally a user would make - manually - for each of Sage's packages.\n\nThe user can still fake Sage's readline was already installed such that Sage will use the system's one, but that requires some more reading and typing than just issuing `make` (or double-clicking the Makefile). ;-)\n\nSame for other packages.",
    "created_at": "2010-12-14T03:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115698",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:66'></a>
Replying to [drkirkby](#comment%3A65):
> I've done that. I created the package. It's now marked as "needs work" but it is going to need to be worked on by someone else.


Ok. If you're not going to change it further, I can do that in the next days.


 
> In general, I very much like the approach taken by `autoconf`, where instead of having a huge lookup table detailing what version of what OS supports this function or that function, it actually **tests** the functionality. Overall that seems a far more logical approach to me, and seems to be what Jeroen is proposing. If we can **test** the functionality of bash, rather than having code that attempts to find a specific Linux release, then testing seems a better way forward.


Well, autotools, or the scripts their files are built from, have a lot of knowledge coded into them (like chess programs, or e.g. `gcc`, too), i.e. they also - at least partially - detect the system and make the choices based on that.

(And packages using autotools still have `configure` options like `--with-package-xy=/path/to/package-xy`, `--with-included-package-xy` and `--with-system-package-xy`, and lots of `--disable-*` and `--enable-*` one sometimes *has to* specify manually. Try e.g. building a "customized" version of a recent GCC, with dozens of settings also for GMP, MPFR, MPC, PPL and CLooG, probably other packages like gettext and zlib as well. Also, GCC does drop support of older platforms, OSs and architectures, due to a lack of developer resources.)


Feel free to extend Sage's `configure` (which really could do much more, setting appropriate environment variables [like your famous `CFLAG64`] etc.)...

But Sage is (also) a distro with many "foreign" packages, not just a program, and to make things work together, we have to make choices normally a user would make - manually - for each of Sage's packages.

The user can still fake Sage's readline was already installed such that Sage will use the system's one, but that requires some more reading and typing than just issuing `make` (or double-clicking the Makefile). ;-)

Same for other packages.



---

archive/issue_comments_115699.json:
```json
{
    "body": "<a id='comment:67'></a>\nThanks for the work on this ticket.  Do you think it is realistic to fix this spkg in the next days?  If not, I will unmerge this spkg and release Sage 4.6.1 with the old readline spkg (which also has problems).",
    "created_at": "2010-12-16T09:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115699",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:67'></a>
Thanks for the work on this ticket.  Do you think it is realistic to fix this spkg in the next days?  If not, I will unmerge this spkg and release Sage 4.6.1 with the old readline spkg (which also has problems).



---

archive/issue_comments_115700.json:
```json
{
    "body": "<a id='comment:68'></a>\nAdditional note: I don't mind merging a partially-fixed readline 6.1 (with some issues remaining) if there is a clear improvement over the old readline 6.0.p4 spkg.  In that case, we should try to converge on a 6.1 spkg which can get positive_review and leave further changes to a different ticket.",
    "created_at": "2010-12-16T09:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'></a>
Additional note: I don't mind merging a partially-fixed readline 6.1 (with some issues remaining) if there is a clear improvement over the old readline 6.0.p4 spkg.  In that case, we should try to converge on a 6.1 spkg which can get positive_review and leave further changes to a different ticket.



---

archive/issue_comments_115701.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [Koen](#comment%3A61):\n> Replying to [drkirkby](#comment%3A57):\n> > Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. \n> > \n> > http://wiki.sagemath.org/SupportedPlatforms#Linux\n> > \n> > says 11.1 is supported, and 11.2 and 11.3 are known to be broken. \n> > \n> > I simply don't have access to the hardware/software to test this. \n\n> \n> I've been testing openSUSE lately - and theory and practice are completely reversed. Sage does not build on 11.1 due to readline 5.x being the default there. Whereas on openSUSE 11.2 and 11.3, Sage builds properly (a recent 4.6.1.rc0 snapshot).\n> However, I'm not sure how to test if my final Sage 'works' w.r.t. the readline/bash problem, so I will only claim that it builds and sage starts properly.\n\n\nThis is a can of worms. Sage certainly was built on 11.1 on 21<sup>st</sup> October. \n\nhttp://build.sagemath.org/sage/builders/openSUSE%2011.1-64%20%28menas%29\n\nI'll leave others to judge if my package is better or worst than the present one. Obviously if someone can improve the readline package soon, it would be good to get an improved version in Sage. But if nobody has the time/resources to do so, then perhaps merging my 6.1 will be preferable to leaving the old one. \n\nDave",
    "created_at": "2010-12-16T17:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115701",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:69'></a>
Replying to [Koen](#comment%3A61):
> Replying to [drkirkby](#comment%3A57):
> > Unless someone is willing to set up an OpenSUSE system for people to test on, I can't really see how we can support the latest release. 
> > 
> > http://wiki.sagemath.org/SupportedPlatforms#Linux
> > 
> > says 11.1 is supported, and 11.2 and 11.3 are known to be broken. 
> > 
> > I simply don't have access to the hardware/software to test this. 

> 
> I've been testing openSUSE lately - and theory and practice are completely reversed. Sage does not build on 11.1 due to readline 5.x being the default there. Whereas on openSUSE 11.2 and 11.3, Sage builds properly (a recent 4.6.1.rc0 snapshot).
> However, I'm not sure how to test if my final Sage 'works' w.r.t. the readline/bash problem, so I will only claim that it builds and sage starts properly.


This is a can of worms. Sage certainly was built on 11.1 on 21<sup>st</sup> October. 

http://build.sagemath.org/sage/builders/openSUSE%2011.1-64%20%28menas%29

I'll leave others to judge if my package is better or worst than the present one. Obviously if someone can improve the readline package soon, it would be good to get an improved version in Sage. But if nobody has the time/resources to do so, then perhaps merging my 6.1 will be preferable to leaving the old one. 

Dave



---

archive/issue_comments_115702.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-12-19T12:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115702",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_115703.json:
```json
{
    "body": "<a id='comment:70'></a>\nReplying to [drkirkby](#comment%3A69):\n> But if nobody has the time/resources to do so, then perhaps merging my 6.1 will be preferable to leaving the old one. \n\n\nWith these words, I propose the *current* spkg http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg] for review.",
    "created_at": "2010-12-19T12:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115703",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:70'></a>
Replying to [drkirkby](#comment%3A69):
> But if nobody has the time/resources to do so, then perhaps merging my 6.1 will be preferable to leaving the old one. 


With these words, I propose the *current* spkg http://boxen.math.washington.edu/home/kirkby/readline-6.1.spkg] for review.



---

archive/issue_comments_115704.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-01-08T00:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115704",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_115705.json:
```json
{
    "body": "<a id='comment:71'></a>\nThis ticket certainly illustrates why screwing with LD_PRELOAD / LD_LIBRARY_PATH is considered bad practice for any nontrivial project. The imho only correct fix is to explicitly set the RPATH/RUNPATH in all of Sage's binaries, and not set LD_LIBRARY_PATH. But then, thats for another ticket...\n\nAs far as readline is concerned, I think the current state is a definite improvement. Since there is really no remaining issue that can be fixed easy, I give this a positive review so that we can go ahead with releasing Sage-4.6.1.",
    "created_at": "2011-01-08T00:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115705",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:71'></a>
This ticket certainly illustrates why screwing with LD_PRELOAD / LD_LIBRARY_PATH is considered bad practice for any nontrivial project. The imho only correct fix is to explicitly set the RPATH/RUNPATH in all of Sage's binaries, and not set LD_LIBRARY_PATH. But then, thats for another ticket...

As far as readline is concerned, I think the current state is a definite improvement. Since there is really no remaining issue that can be fixed easy, I give this a positive review so that we can go ahead with releasing Sage-4.6.1.



---

archive/issue_comments_115706.json:
```json
{
    "body": "Changing reviewer from \"Florent Hivert, Leif Leonhardy, Jeroen Demeyer\" to \"Florent Hivert, Leif Leonhardy, Jeroen Demeyer, Volker Braun\"",
    "created_at": "2011-01-08T00:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115706",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "Florent Hivert, Leif Leonhardy, Jeroen Demeyer" to "Florent Hivert, Leif Leonhardy, Jeroen Demeyer, Volker Braun"



---

archive/issue_events_028815.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-01-09T18:59:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/9523#event-28815"
}
```



---

archive/issue_comments_115707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-01-09T18:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/9523",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/9523#issuecomment-115707",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
