# Issue 9419: Update Developers Guide to state how patches should be made.

archive/issues_009419.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "As discussed here\n\nhttp://groups.google.co.uk/group/sage-devel/browse_thread/thread/c566520374106df3\n\n[GNU patch](http://savannah.gnu.org/projects/patch/) will be added to Sage. This is ticket #9418. \n\nIn order to make use of the command, the developers guide will need to be updated to reflect a new way of making patch commands. We should sort out the details as precisely as possible, so everyone uses the exact same method. \n\n---\n\nApply\n\n- [attachment: trac_9419-use-patch.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz) and [attachment: trac_9419-part2.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz) to the main Sage repository.\n\nCC:  @nexttime @jdemeyer @pipedream\n\nComponent: **documentation**\n\nKeywords: **patch doc howto spkgs diff**\n\nAuthor: **John Palmieri**\n\nReviewer: **Karl-Dieter Crisman**\n\nMerged: **sage-4.8.alpha6**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9419_\n\n",
    "closed_at": "2011-12-24T01:03:25Z",
    "created_at": "2010-07-03T08:36:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20documentation"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update Developers Guide to state how patches should be made.",
    "type": "issue",
    "updated_at": "2011-12-24T05:45:26Z",
    "url": "https://github.com/sagemath/sage/issues/9419",
    "user": "https://github.com/sagetrac-drkirkby"
}
```
As discussed here

http://groups.google.co.uk/group/sage-devel/browse_thread/thread/c566520374106df3

[GNU patch](http://savannah.gnu.org/projects/patch/) will be added to Sage. This is ticket #9418. 

In order to make use of the command, the developers guide will need to be updated to reflect a new way of making patch commands. We should sort out the details as precisely as possible, so everyone uses the exact same method. 

---

Apply

- [attachment: trac_9419-use-patch.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz) and [attachment: trac_9419-part2.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz) to the main Sage repository.

CC:  @nexttime @jdemeyer @pipedream

Component: **documentation**

Keywords: **patch doc howto spkgs diff**

Author: **John Palmieri**

Reviewer: **Karl-Dieter Crisman**

Merged: **sage-4.8.alpha6**

_Issue created by migration from https://trac.sagemath.org/ticket/9419_





---

archive/issue_events_119684.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-03T08:36:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119684"
}
```



---

archive/issue_events_119685.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-03T08:36:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119685"
}
```



---

archive/issue_events_119686.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-03T08:36:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119686"
}
```



---

archive/issue_events_119687.json:
```json
{
    "actor": "https://github.com/sagetrac-drkirkby",
    "created_at": "2010-07-03T08:36:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119687"
}
```



---

archive/issue_events_119688.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-07-03T08:36:32Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "subject": "https://github.com/sagetrac-drkirkby",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119688"
}
```



---

archive/issue_comments_080582.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nHopefully finished before Sage 5.0 comes out... ;-)",
    "created_at": "2010-11-21T21:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80582",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

Hopefully finished before Sage 5.0 comes out... ;-)



---

archive/issue_events_119689.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-22T20:36:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119689"
}
```



---

archive/issue_events_119690.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2010-11-22T20:36:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "milestone_number": null,
    "milestone_title": "sage-4.6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119690"
}
```



---

archive/issue_comments_080583.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI will do a first attempt at writing this up...",
    "created_at": "2010-11-22T20:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80583",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

I will do a first attempt at writing this up...



---

archive/issue_comments_080584.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHow do you like the following high-level steps, suppose we want to create sphinx-1.0.4.p3\n\n```\n1) create a directory sphinx-1.0.4.p3\n2) put upstream source in sphinx-1.0.4.p3/src\nFor every ISSUE which needs to be patched, do the following:\n    3) cp -pr sphinx-1.0.4.p3 sphinx-1.0.4.p3.patched\n    4) edit sphinx-1.0.4.p3.patched/src to fix ISSUE.\n    5) diff -ur sphinx-1.0.4.p3/src sphinx-1.0.4.p3.patched/src >sphinx-1.0.4.p3/patches/ISSUE.patch\n    6) rm -r sphinx-1.0.4.p3.patched\n```",
    "created_at": "2010-11-22T20:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80584",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

How do you like the following high-level steps, suppose we want to create sphinx-1.0.4.p3

```
1) create a directory sphinx-1.0.4.p3
2) put upstream source in sphinx-1.0.4.p3/src
For every ISSUE which needs to be patched, do the following:
    3) cp -pr sphinx-1.0.4.p3 sphinx-1.0.4.p3.patched
    4) edit sphinx-1.0.4.p3.patched/src to fix ISSUE.
    5) diff -ur sphinx-1.0.4.p3/src sphinx-1.0.4.p3.patched/src >sphinx-1.0.4.p3/patches/ISSUE.patch
    6) rm -r sphinx-1.0.4.p3.patched
```



---

archive/issue_comments_080585.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFor applying the patches in `spkg-install`:\n\n```\npatch -p1 <src/ISSUE.patch\n```",
    "created_at": "2010-11-22T20:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80585",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

For applying the patches in `spkg-install`:

```
patch -p1 <src/ISSUE.patch
```



---

archive/issue_comments_080586.json:
```json
{
    "body": "Changed keywords from none to **patch doc**",
    "created_at": "2010-11-28T10:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80586",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from none to **patch doc**



---

archive/issue_comments_080587.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAfter thinking about it some more, perhaps the following is better:\n\n```\n1) create a directory sphinx-1.0.4.p3\n2) cd sphinx-1.0.4.p3\n2) put upstream source in sphinx-1.0.4.p3/src\nFor every ISSUE which needs to be patched, do the following:\n    3) cp -pr src src.patched\n    4) edit src.patched to fix ISSUE.\n    5) diff -ur src src.patched >patches/ISSUE.patch\n    6) rm -r src.patched\n```\n\nTo apply the patches in `spkg-install`:\n\n```\n1) cd src\n2) patch -p1 <../patches/ISSUE.patch\n```",
    "created_at": "2010-11-28T10:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80587",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

After thinking about it some more, perhaps the following is better:

```
1) create a directory sphinx-1.0.4.p3
2) cd sphinx-1.0.4.p3
2) put upstream source in sphinx-1.0.4.p3/src
For every ISSUE which needs to be patched, do the following:
    3) cp -pr src src.patched
    4) edit src.patched to fix ISSUE.
    5) diff -ur src src.patched >patches/ISSUE.patch
    6) rm -r src.patched
```

To apply the patches in `spkg-install`:

```
1) cd src
2) patch -p1 <../patches/ISSUE.patch
```



---

archive/issue_comments_080588.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSo, in what order should `patches/*.patch` be applied?\n\nIt's not *that* unlikely *in principle \"unrelated\"* patches affect the same parts of code (or at least modify parts near to each other in the same file), such that multiple patches against vanilla upstream source won't apply smoothly in (arbitrary) sequence.\n\nThere should (in addition) be some documentation on what files are patched by what \"ISSUE\", I'd suggest in an `SPKG.txt` section and / or a `patches/README`[`.txt`]. (If \"ISSUE\" is almost self-explanatory, we don't need extra comments in `spkg-install`, but then other files should contain further details and references to the relevant tickets.)\n\nWhat if some patches only have to be applied on platform XY?\n\nI think creating `src-$ISSUE/` for each \"ISSUE\" and then doing `diff -ur src/ src-$ISSUE/ > patches/$ISSUE.patch` is equally valid.\n\nAnd IMHO doing e.g. `cd src/ && diff -u file.orig file > ../patches/file.patch` should be valid for \"simple\" patches as well (then using `cd src ; patch -p0 < ../patches/file.patch`, or omitting the `-p0`), though perhaps using `diff -u src/file.orig src/file ...` (and applying them from the top level spkg directory) would be better.\n\nSo I'm not convinced there is a single best way to go in all cases.",
    "created_at": "2010-11-29T17:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80588",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

So, in what order should `patches/*.patch` be applied?

It's not *that* unlikely *in principle "unrelated"* patches affect the same parts of code (or at least modify parts near to each other in the same file), such that multiple patches against vanilla upstream source won't apply smoothly in (arbitrary) sequence.

There should (in addition) be some documentation on what files are patched by what "ISSUE", I'd suggest in an `SPKG.txt` section and / or a `patches/README`[`.txt`]. (If "ISSUE" is almost self-explanatory, we don't need extra comments in `spkg-install`, but then other files should contain further details and references to the relevant tickets.)

What if some patches only have to be applied on platform XY?

I think creating `src-$ISSUE/` for each "ISSUE" and then doing `diff -ur src/ src-$ISSUE/ > patches/$ISSUE.patch` is equally valid.

And IMHO doing e.g. `cd src/ && diff -u file.orig file > ../patches/file.patch` should be valid for "simple" patches as well (then using `cd src ; patch -p0 < ../patches/file.patch`, or omitting the `-p0`), though perhaps using `diff -u src/file.orig src/file ...` (and applying them from the top level spkg directory) would be better.

So I'm not convinced there is a single best way to go in all cases.



---

archive/issue_comments_080589.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAlso, the *Dependencies* section of `SPKG.txt` should explicitly contain [GNU] `patch` if it is used by an spkg.\n\n(I'd prefer *selectively* adding \"patch\" as a dependency in `spkg/standard/deps`, too.)",
    "created_at": "2010-11-29T20:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80589",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

Also, the *Dependencies* section of `SPKG.txt` should explicitly contain [GNU] `patch` if it is used by an spkg.

(I'd prefer *selectively* adding "patch" as a dependency in `spkg/standard/deps`, too.)



---

archive/issue_comments_080590.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nexttime](#comment%3A6):\n> So, in what order should `patches/*.patch` be applied?\n\nThat's up to the writer of `spkg-install`.\n\n> There should (in addition) be some documentation on what files are patched by what \"ISSUE\", I'd suggest in an `SPKG.txt` section and / or a `patches/README`[`.txt`]. (If \"ISSUE\" is almost self-explanatory, we don't need extra comments in `spkg-install`, but then other files should contain further details and references to the relevant tickets.)\n\nAgreed.  I prefer in `SPKG.txt` because then all the information about the package is contained in one file.\n\n> What if some patches only have to be applied on platform XY?\n\nSame as today.  Instead of a conditional `cp`, we have a conditional `patch`.\n\n> I think creating `src-$ISSUE/` for each \"ISSUE\" and then doing `diff -ur src/ src-$ISSUE/ > patches/$ISSUE.patch` is equally valid.\n\nAgreed.\n\n> And IMHO doing e.g. `cd src/ && diff -u file.orig file > ../patches/file.patch` should be valid for \"simple\" patches as well (then using `cd src ; patch -p0 < ../patches/file.patch`, or omitting the `-p0`)\n\nI would prefer that all patches can be *applied* the same way, namely from `src/` with a `-p1` strip level.  So I disagree.\n\n> though perhaps using `diff -u src/file.orig src/file ...` (and applying them from the top level spkg directory) would be better.\n\nOkay for me.",
    "created_at": "2010-11-29T20:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80590",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nexttime](#comment%3A6):
> So, in what order should `patches/*.patch` be applied?

That's up to the writer of `spkg-install`.

> There should (in addition) be some documentation on what files are patched by what "ISSUE", I'd suggest in an `SPKG.txt` section and / or a `patches/README`[`.txt`]. (If "ISSUE" is almost self-explanatory, we don't need extra comments in `spkg-install`, but then other files should contain further details and references to the relevant tickets.)

Agreed.  I prefer in `SPKG.txt` because then all the information about the package is contained in one file.

> What if some patches only have to be applied on platform XY?

Same as today.  Instead of a conditional `cp`, we have a conditional `patch`.

> I think creating `src-$ISSUE/` for each "ISSUE" and then doing `diff -ur src/ src-$ISSUE/ > patches/$ISSUE.patch` is equally valid.

Agreed.

> And IMHO doing e.g. `cd src/ && diff -u file.orig file > ../patches/file.patch` should be valid for "simple" patches as well (then using `cd src ; patch -p0 < ../patches/file.patch`, or omitting the `-p0`)

I would prefer that all patches can be *applied* the same way, namely from `src/` with a `-p1` strip level.  So I disagree.

> though perhaps using `diff -u src/file.orig src/file ...` (and applying them from the top level spkg directory) would be better.

Okay for me.



---

archive/issue_comments_080591.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> I will do a first attempt at writing this up...\n\nDid you get anywhere with this? The issue is quite important, as currently the developers guide is still advising the use of 'cp'  and saying not to use 'patch'. \n\nOne thing we need to be careful of is that when testing the patch, people don't overwrite the src directory. Which makes me think, should the write permissions for all files below src be removed? That would at least prevent that accident, though perhaps it would screw up some packages. \n\nDave",
    "created_at": "2011-04-28T05:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80591",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment%3A2):
> I will do a first attempt at writing this up...

Did you get anywhere with this? The issue is quite important, as currently the developers guide is still advising the use of 'cp'  and saying not to use 'patch'. 

One thing we need to be careful of is that when testing the patch, people don't overwrite the src directory. Which makes me think, should the write permissions for all files below src be removed? That would at least prevent that accident, though perhaps it would screw up some packages. 

Dave



---

archive/issue_comments_080592.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAlso, the *Developer's Guide* should state how to check the exit code(s) of `patch`, i.e. **we should IMHO test `$?` of *every* application of `patch`** (cf. [my comment here](https://github.com/sagemath/sage/issues/11246#comment:21)):\n\n *[...] Fortunately, we now use `patch` rather than `cp`, which at least spits out warning or error messages in case upstream and `patches/*` get out of sync (or someone made another mistake), but these messages are easily missed - even by a reviewer, which can lead to all kinds of obscure errors or misbehavior **any time later**, so we should IMHO check `$?` there. [...]*\n\nIf we apply many patches in a loop (which I don't really like since this badly documents *what* is actually patched *why*, but see documentation-related discussion above), we should at least \"accumulate\" the outcome, i.e. test once all patches were successfully applied.\n\nWe could even check if they applied seamlessly, without fuzz (which I think should be the case in spkgs; otherwise they should get rebased).\n\nOpinions?",
    "created_at": "2011-07-03T11:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80592",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Also, the *Developer's Guide* should state how to check the exit code(s) of `patch`, i.e. **we should IMHO test `$?` of *every* application of `patch`** (cf. [my comment here](https://github.com/sagemath/sage/issues/11246#comment:21)):

 *[...] Fortunately, we now use `patch` rather than `cp`, which at least spits out warning or error messages in case upstream and `patches/*` get out of sync (or someone made another mistake), but these messages are easily missed - even by a reviewer, which can lead to all kinds of obscure errors or misbehavior **any time later**, so we should IMHO check `$?` there. [...]*

If we apply many patches in a loop (which I don't really like since this badly documents *what* is actually patched *why*, but see documentation-related discussion above), we should at least "accumulate" the outcome, i.e. test once all patches were successfully applied.

We could even check if they applied seamlessly, without fuzz (which I think should be the case in spkgs; otherwise they should get rebased).

Opinions?



---

archive/issue_comments_080593.json:
```json
{
    "body": "Changed keywords from **patch doc** to **patch doc howto spkgs diff**",
    "created_at": "2011-07-03T11:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80593",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **patch doc** to **patch doc howto spkgs diff**



---

archive/issue_comments_080594.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A9):\n> One thing we need to be careful of is that when testing the patch, people don't overwrite the src directory. Which makes me think, should the write permissions for all files below src be removed? That would at least prevent that accident, though perhaps it would screw up some packages.\n\nWell, you usually *want (or need) to overwrite / modify* files in `src/` when applying patches from within `spkg-install`...\n\nNote that you don't need write permissions on a file you're going to patch, but on its containing directory.",
    "created_at": "2011-07-03T11:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80594",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@sagetrac-drkirkby](#comment%3A9):
> One thing we need to be careful of is that when testing the patch, people don't overwrite the src directory. Which makes me think, should the write permissions for all files below src be removed? That would at least prevent that accident, though perhaps it would screw up some packages.

Well, you usually *want (or need) to overwrite / modify* files in `src/` when applying patches from within `spkg-install`...

Note that you don't need write permissions on a file you're going to patch, but on its containing directory.



---

archive/issue_comments_080595.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> I will do a first attempt at writing this up...\n\nJeroen, do you already have some draft of a new section for the Developer's Guide (replacing [*\"Use `cp` for patching\"*](http://www.sagemath.org/doc/developer/patching_spkgs.html#use-cp-for-patching))?",
    "created_at": "2011-07-03T14:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80595",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment%3A2):
> I will do a first attempt at writing this up...

Jeroen, do you already have some draft of a new section for the Developer's Guide (replacing [*"Use `cp` for patching"*](http://www.sagemath.org/doc/developer/patching_spkgs.html#use-cp-for-patching))?



---

archive/issue_events_119691.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-03T15:46:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119691"
}
```



---

archive/issue_comments_080596.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nOk, I just started rewriting `doc/en/developer/{producing,patching}_spkgs.rst`.\n\n**Q:** Should patches to upstream source (also? optionally?) be documented in `patches/README.txt` or whatever it is called, or just - i.e. only - in `SPKG.txt`'s *Special Update/Build Instructions* section (or even a new one, \"*Patches*\")?",
    "created_at": "2011-07-03T15:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80596",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

Ok, I just started rewriting `doc/en/developer/{producing,patching}_spkgs.rst`.

**Q:** Should patches to upstream source (also? optionally?) be documented in `patches/README.txt` or whatever it is called, or just - i.e. only - in `SPKG.txt`'s *Special Update/Build Instructions* section (or even a new one, "*Patches*")?



---

archive/issue_comments_080597.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHere's an attempt at a patch.  (I'm tired of wanting to refer people in sage-devel to the Developer's Guide, but then hesitating because of its out-dated insistence on using 'cp' instead of 'patch', and nothing seems to be happening with this.  Plus I'm trying to avoid grading an exam.)",
    "created_at": "2011-11-23T00:16:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80597",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Here's an attempt at a patch.  (I'm tired of wanting to refer people in sage-devel to the Developer's Guide, but then hesitating because of its out-dated insistence on using 'cp' instead of 'patch', and nothing seems to be happening with this.  Plus I'm trying to avoid grading an exam.)



---

archive/issue_events_119692.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-23T00:16:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119692"
}
```



---

archive/issue_events_119693.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-23T00:16:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119693"
}
```



---

archive/issue_comments_080598.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[trac_9419-use-patch.patch.gz](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz)**\n\nA minor typo, with \"an\" instead of \"a\". \n\n\"so if you are writing an spkg which is not part of the standard\"\n\nPersonally I would have used:\n\n```\ndiff -Naur\n```\n\nwhich seems one of the most common ways. There's some discussion in \n\nhttp://linux.die.net/man/1/patch\n\nof the best arguments to use. The main change is that this is recursive, so if one edits multiple files to make a change to sort out some problem, there can be one patch file to resolve the problem, rather than having to make one for each file. \n\nDave",
    "created_at": "2011-12-01T06:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80598",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[trac_9419-use-patch.patch.gz](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz)**

A minor typo, with "an" instead of "a". 

"so if you are writing an spkg which is not part of the standard"

Personally I would have used:

```
diff -Naur
```

which seems one of the most common ways. There's some discussion in 

http://linux.die.net/man/1/patch

of the best arguments to use. The main change is that this is recursive, so if one edits multiple files to make a change to sort out some problem, there can be one patch file to resolve the problem, rather than having to make one for each file. 

Dave



---

archive/issue_comments_080599.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-drkirkby](#comment%3A15):\n> A minor typo, with \"an\" instead of \"a\". \n> \n> \"so if you are writing an spkg which is not part of the standard\"\n\nI will fix that, thanks.\n\n> Personally I would have used:\n> \n\n ```\n diff -Naur\n ```\n> \n> which seems one of the most common ways.  \n\nDave, I'm shocked: this doesn't seem to be Posix-standard usage :)  For example, as far as I can tell, on your machine hawk neither `-N` nor `-a` are supported.  Also, re `-r`: I think we might want to produce patches just for one file at a time, although I don't have a strong feeling about this.  At least in the spkgs that I remember, each patch is for a single file.",
    "created_at": "2011-12-04T02:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80599",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-drkirkby](#comment%3A15):
> A minor typo, with "an" instead of "a". 
> 
> "so if you are writing an spkg which is not part of the standard"

I will fix that, thanks.

> Personally I would have used:
> 

 ```
 diff -Naur
 ```
> 
> which seems one of the most common ways.  

Dave, I'm shocked: this doesn't seem to be Posix-standard usage :)  For example, as far as I can tell, on your machine hawk neither `-N` nor `-a` are supported.  Also, re `-r`: I think we might want to produce patches just for one file at a time, although I don't have a strong feeling about this.  At least in the spkgs that I remember, each patch is for a single file.



---

archive/issue_comments_080600.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFor the \"typo\" referred to above: should we say \"a spkg\" or \"an spkg\"?  The style seems to be the latter, which is what my patch uses.  So I don't think I need to change anything.",
    "created_at": "2011-12-05T22:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80600",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

For the "typo" referred to above: should we say "a spkg" or "an spkg"?  The style seems to be the latter, which is what my patch uses.  So I don't think I need to change anything.



---

archive/issue_comments_080601.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jhpalmieri](#comment%3A16):\n> Replying to [@sagetrac-drkirkby](#comment%3A15):\n> > A minor typo, with \"an\" instead of \"a\". \n> > \n> > \"so if you are writing an spkg which is not part of the standard\"\n\n> \n> I will fix that, thanks.\n> \n> > Personally I would have used:\n> > \n\n>  ```\n>  diff -Naur\n>  ```\n> > \n> > which seems one of the most common ways.  \n\n> \n> Dave, I'm shocked: this doesn't seem to be Posix-standard usage :)  \n\nAn argument for including GNU 'patch' command was that it would be consistent across all systems. The Sun 'patch' command differs significantly from the GNU one. In such a case, I think we might as well use the GNU version of diff, which is /usr/bin/gdiff on hawk. \n\n> Also, re `-r`: I think we might want to produce patches just for one file at a time, although I don't have a strong feeling about this.  At least in the spkgs that I remember, each patch is for a single file.\n\nThat could get quite messy if for example you update configure.ac, and then generate the 'configure' script. It would seem logical to keep one patch file for any changes that are made to resolve a particular problem. But I don't have a strong feeling about it. \n\ndave",
    "created_at": "2011-12-06T21:42:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80601",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jhpalmieri](#comment%3A16):
> Replying to [@sagetrac-drkirkby](#comment%3A15):
> > A minor typo, with "an" instead of "a". 
> > 
> > "so if you are writing an spkg which is not part of the standard"

> 
> I will fix that, thanks.
> 
> > Personally I would have used:
> > 

>  ```
>  diff -Naur
>  ```
> > 
> > which seems one of the most common ways.  

> 
> Dave, I'm shocked: this doesn't seem to be Posix-standard usage :)  

An argument for including GNU 'patch' command was that it would be consistent across all systems. The Sun 'patch' command differs significantly from the GNU one. In such a case, I think we might as well use the GNU version of diff, which is /usr/bin/gdiff on hawk. 

> Also, re `-r`: I think we might want to produce patches just for one file at a time, although I don't have a strong feeling about this.  At least in the spkgs that I remember, each patch is for a single file.

That could get quite messy if for example you update configure.ac, and then generate the 'configure' script. It would seem logical to keep one patch file for any changes that are made to resolve a particular problem. But I don't have a strong feeling about it. 

dave



---

archive/issue_comments_080602.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment%3A17):\n> For the \"typo\" referred to above: should we say \"a spkg\" or \"an spkg\"?  The style seems to be the latter, which is what my patch uses.  So I don't think I need to change anything.\n\nThis is another thing I don't have a strong feeling about. \n\nhttp://grammar.quickanddirtytips.com/a-versus-an.aspx\n\nsays:\n*The rule is  that you use a before words that start with a consonant sound and an before words that start with a vowel sound (1).*\n\n\nhttp://en.wikipedia.org/wiki/English_articles#Discrimination_between_a_and_an\n\nbasically says the same thing, but is less clear about it. \n\nThe letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been \"a spkg\" and not \"an spkg\". But it's not a big deal. \n\nDave \n\nI guess 'spkg' is not a word, and I don't know if its an abbreviation for something.",
    "created_at": "2011-12-06T22:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80602",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment%3A17):
> For the "typo" referred to above: should we say "a spkg" or "an spkg"?  The style seems to be the latter, which is what my patch uses.  So I don't think I need to change anything.

This is another thing I don't have a strong feeling about. 

http://grammar.quickanddirtytips.com/a-versus-an.aspx

says:
*The rule is  that you use a before words that start with a consonant sound and an before words that start with a vowel sound (1).*


http://en.wikipedia.org/wiki/English_articles#Discrimination_between_a_and_an

basically says the same thing, but is less clear about it. 

The letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been "a spkg" and not "an spkg". But it's not a big deal. 

Dave 

I guess 'spkg' is not a word, and I don't know if its an abbreviation for something.



---

archive/issue_comments_080603.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis is great stuff, John.  Once this is in I will actually be able to change a few spkgs to use `patch` correctly, and to more easily review them - since the syntax is there.\n\nAs a non-expert in shell syntax I will not give this a positive review, but everything I do know about seems good, and the examples are more informative.  One tiny request.  In \n\n```\nNow provide a high-level explanation of your changes in \n``SPKG.txt``. Once you are satisfied with your changes, use Mercurial \nto check in your changes with a meaningful commit message. Next,\n```\nI wonder if you could put two more comments.\n* One with the syntax for the changes in SPKG.txt (the `=== pkg-name 1.4.5.p3 (John Palmieri, Octember 33 2011) ===` thing)\n* One to tell people they might as well tag the tip with the new spkg version number.  I know Jeroen currently does this anyway when merging, but it would make things easier for him (and for any new release manager eventually).",
    "created_at": "2011-12-18T03:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80603",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">comment:20</div>

This is great stuff, John.  Once this is in I will actually be able to change a few spkgs to use `patch` correctly, and to more easily review them - since the syntax is there.

As a non-expert in shell syntax I will not give this a positive review, but everything I do know about seems good, and the examples are more informative.  One tiny request.  In 

```
Now provide a high-level explanation of your changes in 
``SPKG.txt``. Once you are satisfied with your changes, use Mercurial 
to check in your changes with a meaningful commit message. Next,
```
I wonder if you could put two more comments.
* One with the syntax for the changes in SPKG.txt (the `=== pkg-name 1.4.5.p3 (John Palmieri, Octember 33 2011) ===` thing)
* One to tell people they might as well tag the tip with the new spkg version number.  I know Jeroen currently does this anyway when merging, but it would make things easier for him (and for any new release manager eventually).



---

archive/issue_comments_080604.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,9 @@\n [GNU patch](http://savannah.gnu.org/projects/patch/) will be added to Sage. This is ticket #9418. \n \n In order to make use of the command, the developers guide will need to be updated to reflect a new way of making patch commands. We should sort out the details as precisely as possible, so everyone uses the exact same method. \n+\n+---\n+\n+Apply\n+\n+- [attachment: trac_9419-use-patch.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz) and [attachment: trac_9419-part2.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz) to the main Sage repository.\n``````\n",
    "created_at": "2011-12-19T19:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80604",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,9 @@
 [GNU patch](http://savannah.gnu.org/projects/patch/) will be added to Sage. This is ticket #9418. 
 
 In order to make use of the command, the developers guide will need to be updated to reflect a new way of making patch commands. We should sort out the details as precisely as possible, so everyone uses the exact same method. 
+
+---
+
+Apply
+
+- [attachment: trac_9419-use-patch.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-use-patch.patch.gz) and [attachment: trac_9419-part2.patch](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz) to the main Sage repository.
``````




---

archive/issue_comments_080605.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@kcrisman](#comment%3A20):\n> One tiny request.  \n\nOkay, here's part 2 of the patch, which addresses your suggestions.",
    "created_at": "2011-12-19T19:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80605",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@kcrisman](#comment%3A20):
> One tiny request.  

Okay, here's part 2 of the patch, which addresses your suggestions.



---

archive/issue_comments_080606.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman**",
    "created_at": "2011-12-19T20:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80606",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman**



---

archive/issue_comments_080607.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n> > One tiny request.  \n\n> \n> Okay, here's part 2 of the patch, which addresses your suggestions.\n\nWow, great!  Looks good, applies to alpha4 fine, builds and doc looks great.  \n\nAs I said, I don't feel comfortable addressing the shell stuff, but I like this.  Here are a few tiny things.\n* Syntax:\n\n```\nsage -f /URL/to/package-x.y.z.spkg\n```\n   Maybe, just to be pedantic, \n\n```\nsage -f http://URL/to/package-x.y.z.spkg\n```\n   Or maybe that will cause more confusion than the original one...\n* One actual error I found, I think.\n\n```\nmatplotlib-1.0.1.p0/src/lib/matplotlib/finance.py.patch\n```\n   I think that should just be finance.py, right?   Should be easy to refresh the `part2.patch`, I hope.  Sorry.\n\n* And a teensy teensy thing:\n\n```\nA main message of this section is\n``` \n   should that be `The main`?  I realize this is \"legacy documentation\", but might as well spruce it up.\n\n* A question, probably due to ignorance:\n\n```\ndiff -u src/configure src-patched/configure > patches/configure.patch \n```\n   will that make a patch that actually applies correctly?  I feel like this will produce one with a header that says\n\n```\n--- a/src/configure\n+++ b/src-patched/configure\n```\n   that wouldn't apply, as opposed to \n\n```\n--- a/src/configure\n+++ b/src/configure\n```\n\n---\nOtherwise, here are things that need to be reviewed that I don't feel comfortable doing, though I'm sure they are right.\n* the argument about `diff -u` versus `diff -Naur`\n* the `[This is the Trac macro *-z \"$SAGE_LOCAL\" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-z \"$SAGE_LOCAL\" -macro)` change \n* Changing to `--` instead of `-` for options to commands, like `sage --pkg`.\n* `cp -pR`\n* `patch -p1 <\"$patch\"` versus `patch -p1 < \"$patch\"` (the latter is probably just my imagination, but I know that shell script cares about spaces at times) and in general verifying that that is the correct syntax, though I'm sure it is based on seeing various of Leif's spkgs\n\nAnyone who uses these a lot can check them off as correct and this can go in.\n\n---\nRegarding \"a\" versus \"an\".\n> The letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been \"a spkg\" and not \"an spkg\". But it's not a big deal.\n\nAh, but I've never heard \"spkg\" pronounced other than as \"esspackage\".  Vowel sound.  Sort of like how different people will say \"an (h)istorical\" or \"a historical\", and both are right.",
    "created_at": "2011-12-19T20:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80607",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">comment:22</div>

> > One tiny request.  

> 
> Okay, here's part 2 of the patch, which addresses your suggestions.

Wow, great!  Looks good, applies to alpha4 fine, builds and doc looks great.  

As I said, I don't feel comfortable addressing the shell stuff, but I like this.  Here are a few tiny things.
* Syntax:

```
sage -f /URL/to/package-x.y.z.spkg
```
   Maybe, just to be pedantic, 

```
sage -f http://URL/to/package-x.y.z.spkg
```
   Or maybe that will cause more confusion than the original one...
* One actual error I found, I think.

```
matplotlib-1.0.1.p0/src/lib/matplotlib/finance.py.patch
```
   I think that should just be finance.py, right?   Should be easy to refresh the `part2.patch`, I hope.  Sorry.

* And a teensy teensy thing:

```
A main message of this section is
``` 
   should that be `The main`?  I realize this is "legacy documentation", but might as well spruce it up.

* A question, probably due to ignorance:

```
diff -u src/configure src-patched/configure > patches/configure.patch 
```
   will that make a patch that actually applies correctly?  I feel like this will produce one with a header that says

```
--- a/src/configure
+++ b/src-patched/configure
```
   that wouldn't apply, as opposed to 

```
--- a/src/configure
+++ b/src/configure
```

---
Otherwise, here are things that need to be reviewed that I don't feel comfortable doing, though I'm sure they are right.
* the argument about `diff -u` versus `diff -Naur`
* the `[This is the Trac macro *-z "$SAGE_LOCAL" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-z "$SAGE_LOCAL" -macro)` change 
* Changing to `--` instead of `-` for options to commands, like `sage --pkg`.
* `cp -pR`
* `patch -p1 <"$patch"` versus `patch -p1 < "$patch"` (the latter is probably just my imagination, but I know that shell script cares about spaces at times) and in general verifying that that is the correct syntax, though I'm sure it is based on seeing various of Leif's spkgs

Anyone who uses these a lot can check them off as correct and this can go in.

---
Regarding "a" versus "an".
> The letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been "a spkg" and not "an spkg". But it's not a big deal.

Ah, but I've never heard "spkg" pronounced other than as "esspackage".  Vowel sound.  Sort of like how different people will say "an (h)istorical" or "a historical", and both are right.



---

archive/issue_events_119694.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-19T20:43:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119694"
}
```



---

archive/issue_events_119695.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-19T20:43:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119695"
}
```



---

archive/issue_comments_080608.json:
```json
{
    "body": "Work Issues: **finance.py.patch in too many places**",
    "created_at": "2011-12-19T20:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80608",
    "user": "https://github.com/kcrisman"
}
```

Work Issues: **finance.py.patch in too many places**



---

archive/issue_comments_080609.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2011-12-19T20:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80609",
    "user": "https://github.com/kcrisman"
}
```

Author: **John Palmieri**



---

archive/issue_comments_080610.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> Ah, but I've never heard \"spkg\" pronounced other than as \"esspackage\".  Vowel sound.  Sort of like how different people will say \"an (h)istorical\" or \"a historical\", and both are right.\n\nSee e.g. [this book by John McWhorter](http://www.npr.org/books/titles/138991857/what-language-is-and-what-it-isnt-and-what-it-could-be) on some of these issues.  Not that I agree with everything he has to say, but it's a nice \"field guide to practical linguistics\".",
    "created_at": "2011-12-19T20:45:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80610",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>

> Ah, but I've never heard "spkg" pronounced other than as "esspackage".  Vowel sound.  Sort of like how different people will say "an (h)istorical" or "a historical", and both are right.

See e.g. [this book by John McWhorter](http://www.npr.org/books/titles/138991857/what-language-is-and-what-it-isnt-and-what-it-could-be) on some of these issues.  Not that I agree with everything he has to say, but it's a nice "field guide to practical linguistics".



---

archive/issue_events_119696.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-12-19T21:20:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119696"
}
```



---

archive/issue_events_119697.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-12-19T21:20:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119697"
}
```



---

archive/issue_comments_080611.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kcrisman](#comment%3A22):\n> > > One tiny request.  \n\n> > \n> > Okay, here's part 2 of the patch, which addresses your suggestions.\n\n> \n> Wow, great!  Looks good, applies to alpha4 fine, builds and doc looks great.  \n> \n> As I said, I don't feel comfortable addressing the shell stuff, but I like this.  Here are a few tiny things.\n\nGreat, thanks for catching these.  I've updated the \"part2\" patch.\n\n> * A question, probably due to ignorance:\n\n\n ```\n diff -u src/configure src-patched/configure > patches/configure.patch \n ```\n>    will that make a patch that actually applies correctly?  I feel like this will produce one with a header that says\n\n\n ```\n --- a/src/configure\n +++ b/src-patched/configure\n ```\n>    that wouldn't apply, as opposed to \n\nWhen you run \"patch -p1 file.patch\", it strips the file names up to the first slash (\"-pN\" strips up to the Nth slash), so it will patch a file \"configure\" in the current directory.  (So this patch command should be run after cd'ing to `src`.  I've added such a cd command to one of the examples.)\n\n> Regarding \"a\" versus \"an\".\n> > The letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been \"a spkg\" and not \"an spkg\". But it's not a big deal.\n\n> Ah, but I've never heard \"spkg\" pronounced other than as \"esspackage\".  Vowel sound.  Sort of like how different people will say \"an (h)istorical\" or \"a historical\", and both are right.\n\nMe too.",
    "created_at": "2011-12-19T21:20:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80611",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kcrisman](#comment%3A22):
> > > One tiny request.  

> > 
> > Okay, here's part 2 of the patch, which addresses your suggestions.

> 
> Wow, great!  Looks good, applies to alpha4 fine, builds and doc looks great.  
> 
> As I said, I don't feel comfortable addressing the shell stuff, but I like this.  Here are a few tiny things.

Great, thanks for catching these.  I've updated the "part2" patch.

> * A question, probably due to ignorance:


 ```
 diff -u src/configure src-patched/configure > patches/configure.patch 
 ```
>    will that make a patch that actually applies correctly?  I feel like this will produce one with a header that says


 ```
 --- a/src/configure
 +++ b/src-patched/configure
 ```
>    that wouldn't apply, as opposed to 

When you run "patch -p1 file.patch", it strips the file names up to the first slash ("-pN" strips up to the Nth slash), so it will patch a file "configure" in the current directory.  (So this patch command should be run after cd'ing to `src`.  I've added such a cd command to one of the examples.)

> Regarding "a" versus "an".
> > The letter 's' is certainly a consonant, and not a vowel, and I don't think 'spkg' sounds like a vowel (as for example 'hour' does, despite it starting with a consonant). So I would have thought it should have been "a spkg" and not "an spkg". But it's not a big deal.

> Ah, but I've never heard "spkg" pronounced other than as "esspackage".  Vowel sound.  Sort of like how different people will say "an (h)istorical" or "a historical", and both are right.

Me too.



---

archive/issue_comments_080612.json:
```json
{
    "body": "Attachment: **[trac_9419-part2.patch.gz](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz)**",
    "created_at": "2011-12-19T21:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80612",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_9419-part2.patch.gz](https://github.com/sagemath/sage/files/ticket9419/trac_9419-part2.patch.gz)**



---

archive/issue_comments_080613.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nOk, that clarifies `patch`.\n\nI also did a *lot* of reading of man pages and searches, and the shell stuff checks out.  I agree than `diff -u` is totally appropriate for this particular context of creating spkg patches (not in general!).  \n\nLast question (but positive review!) - why\n\n```\n[[ -z \"$SAGE_LOCAL\" ]]\n```\nand not \n\n```\n[ -z \"$SAGE_LOCAL\" ]\n```\nsince it seems like in this situation (no 'and's) they behave identically?",
    "created_at": "2011-12-20T02:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80613",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

Ok, that clarifies `patch`.

I also did a *lot* of reading of man pages and searches, and the shell stuff checks out.  I agree than `diff -u` is totally appropriate for this particular context of creating spkg patches (not in general!).  

Last question (but positive review!) - why

```
[[ -z "$SAGE_LOCAL" ]]
```
and not 

```
[ -z "$SAGE_LOCAL" ]
```
since it seems like in this situation (no 'and's) they behave identically?



---

archive/issue_events_119698.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-20T02:00:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119698"
}
```



---

archive/issue_events_119699.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-20T02:00:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119699"
}
```



---

archive/issue_comments_080614.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@kcrisman](#comment%3A25):\n> Ok, that clarifies `patch`.\n> \n> I also did a *lot* of reading of man pages and searches, and the shell stuff checks out. \n\nGreat!  Thanks for doing that work.\n\n> Last question (but positive review!) - why\n\n\n ```\n [[ -z \"$SAGE_LOCAL\" ]]\n ```\n>and not \n\n\n ```\n [ -z \"$SAGE_LOCAL\" ]\n ```\n> since it seems like in this situation (no 'and's) they behave identically?\n\nI think they do behave identically.  The double bracket version calls a bash built-in function, whereas the single bracket version runs another program.  So the double bracket version is faster, although it doesn't matter too much here of course.  I think that if we're using bash scripts, using double brackets is slightly preferable to single ones: double brackets are faster and have some extra functionality.  I found [this link](http://stackoverflow.com/questions/2188199/bash-double-or-single-bracket-parentheses-curly-braces) and [this one](http://stackoverflow.com/questions/669452/is-preferable-over-in-bash-scripts), which seem like good explanations.",
    "created_at": "2011-12-20T06:37:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80614",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@kcrisman](#comment%3A25):
> Ok, that clarifies `patch`.
> 
> I also did a *lot* of reading of man pages and searches, and the shell stuff checks out. 

Great!  Thanks for doing that work.

> Last question (but positive review!) - why


 ```
 [[ -z "$SAGE_LOCAL" ]]
 ```
>and not 


 ```
 [ -z "$SAGE_LOCAL" ]
 ```
> since it seems like in this situation (no 'and's) they behave identically?

I think they do behave identically.  The double bracket version calls a bash built-in function, whereas the single bracket version runs another program.  So the double bracket version is faster, although it doesn't matter too much here of course.  I think that if we're using bash scripts, using double brackets is slightly preferable to single ones: double brackets are faster and have some extra functionality.  I found [this link](http://stackoverflow.com/questions/2188199/bash-double-or-single-bracket-parentheses-curly-braces) and [this one](http://stackoverflow.com/questions/669452/is-preferable-over-in-bash-scripts), which seem like good explanations.



---

archive/issue_comments_080615.json:
```json
{
    "body": "Changed work issues from **finance.py.patch in too many places** to none",
    "created_at": "2011-12-23T12:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80615",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **finance.py.patch in too many places** to none



---

archive/issue_comments_080616.json:
```json
{
    "body": "Merged: **sage-4.8.alpha6**",
    "created_at": "2011-12-24T01:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80616",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.8.alpha6**



---

archive/issue_events_119700.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-24T01:03:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119700"
}
```



---

archive/issue_events_119701.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-24T01:03:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9419#event-119701"
}
```



---

archive/issue_comments_080617.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nhttp://www.sagemath.org/doc/developer/patching_spkgs.html still says to use cp and not patch.",
    "created_at": "2011-12-24T04:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80617",
    "user": "https://github.com/pipedream"
}
```

<div id="comment:29" align="right">comment:29</div>

http://www.sagemath.org/doc/developer/patching_spkgs.html still says to use cp and not patch.



---

archive/issue_comments_080618.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@pipedream](#comment%3A29):\n> http://www.sagemath.org/doc/developer/patching_spkgs.html still says to use cp and not patch.\n\nThe patch was merged into 4.8.alpha6, a prerelease.  Once 4.8 is released, the on-line documentation should get updated.",
    "created_at": "2011-12-24T05:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9419#issuecomment-80618",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@pipedream](#comment%3A29):
> http://www.sagemath.org/doc/developer/patching_spkgs.html still says to use cp and not patch.

The patch was merged into 4.8.alpha6, a prerelease.  Once 4.8 is released, the on-line documentation should get updated.
