# Issue 9606: local/bin/sage-sage assumes 'sh' is bash

archive/issues_009606.json:
```json
{
    "assignees": [
        "https://github.com/peterjeremy"
    ],
    "body": "\"sage -sh\" is intended to start a subshell of the user's preference (as per $SHELL) with the local Sage environment configured in it.\n\nIn order to prevent the environment being altered by the user's shell RC scripts, local/bin/sage-sage passes an argument to $SHELL which is intended to disable RC processing.  Unfortunately, it assumes that 'sh' is 'bash' and passes '--norc' - which is not legal for POSIX shells.\n\nWhilst this appears to be ignored by Solaris /bin/sh and /usr/xpg4/bin/sh (which is at variance to the man page), it is rejected by FreeBSD /bin/sh - which reports \"Illegal option --\".\n\nThe fix is not clear because Cygwin, Linux and OpenSolaris (at least) all install bash as /bin/sh - though experiments show that at least bash-4.1.7 will not run any RC script when invoked as sh.\n\nCC:  @sagetrac-stephen\n\nReviewer: **Leif Leonhardy, John Palmieri, Stephen Montgomery-Smith**\n\nComponent: **porting: BSD**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/9606_\n\n",
    "closed_at": "2013-01-17T10:03:30Z",
    "created_at": "2010-07-26T23:42:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20bsd",
        "https://github.com/sagemath/sage/labels/worksforme"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "local/bin/sage-sage assumes 'sh' is bash",
    "type": "issue",
    "updated_at": "2013-01-17T10:03:30Z",
    "url": "https://github.com/sagemath/sage/issues/9606",
    "user": "https://github.com/peterjeremy"
}
```
"sage -sh" is intended to start a subshell of the user's preference (as per $SHELL) with the local Sage environment configured in it.

In order to prevent the environment being altered by the user's shell RC scripts, local/bin/sage-sage passes an argument to $SHELL which is intended to disable RC processing.  Unfortunately, it assumes that 'sh' is 'bash' and passes '--norc' - which is not legal for POSIX shells.

Whilst this appears to be ignored by Solaris /bin/sh and /usr/xpg4/bin/sh (which is at variance to the man page), it is rejected by FreeBSD /bin/sh - which reports "Illegal option --".

The fix is not clear because Cygwin, Linux and OpenSolaris (at least) all install bash as /bin/sh - though experiments show that at least bash-4.1.7 will not run any RC script when invoked as sh.

CC:  @sagetrac-stephen

Reviewer: **Leif Leonhardy, John Palmieri, Stephen Montgomery-Smith**

Component: **porting: BSD**

_Issue created by migration from https://trac.sagemath.org/ticket/9606_





---

archive/issue_events_123957.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-07-26T23:42:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123957"
}
```



---

archive/issue_events_123958.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-07-26T23:42:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20bsd",
    "label_color": "000080",
    "label_name": "c: porting: bsd",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123958"
}
```



---

archive/issue_events_123959.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-07-26T23:42:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123959"
}
```



---

archive/issue_events_123960.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-07-26T23:42:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123960"
}
```



---

archive/issue_events_123961.json:
```json
{
    "actor": "https://github.com/peterjeremy",
    "created_at": "2010-07-26T23:42:53Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "subject": "https://github.com/peterjeremy",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123961"
}
```



---

archive/issue_events_123962.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-04-19T21:06:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123962"
}
```



---

archive/issue_comments_083960.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIs this still an issue?\n\n(The script btw. has meanwhile been renamed / moved to `$SAGE_ROOT/spkg/bin/sage`.)",
    "created_at": "2012-04-19T21:06:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83960",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

Is this still an issue?

(The script btw. has meanwhile been renamed / moved to `$SAGE_ROOT/spkg/bin/sage`.)



---

archive/issue_comments_083961.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe relevant part of the script says\n\n```sh\n        sh)\n            # We don't really know which shell \"sh\" is (it could be\n            # bash, but this is not guaranteed), so we don't set\n            # SHELL_OPTS.\n            if [ \"$color_prompt\" = yes ] ; then\n                PS1=\"$(tput rev)(sage-sh)$(tput sgr0) $USER@`hostname -s`:\\${PWD##*/}$ \"\n            else\n                PS1=\"(sage-sh) $USER@`hostname -s`:\\${PWD}$ \"\n            fi\n            export PS1\n            ;;\n```\nSo it doesn't look like this ticket is relevant any more.",
    "created_at": "2012-04-19T23:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83961",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

The relevant part of the script says

```sh
        sh)
            # We don't really know which shell "sh" is (it could be
            # bash, but this is not guaranteed), so we don't set
            # SHELL_OPTS.
            if [ "$color_prompt" = yes ] ; then
                PS1="$(tput rev)(sage-sh)$(tput sgr0) $USER@`hostname -s`:\${PWD##*/}$ "
            else
                PS1="(sage-sh) $USER@`hostname -s`:\${PWD}$ "
            fi
            export PS1
            ;;
```
So it doesn't look like this ticket is relevant any more.



---

archive/issue_comments_083962.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n`@`Stephen M-S:  If you have time, can you check that `./sage -sh` works from `SAGE_ROOT`?   That would confirm what John and Leif point out here - but it would be nice to have it actually tested, since stranger things have happened.",
    "created_at": "2013-01-16T01:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83962",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

`@`Stephen M-S:  If you have time, can you check that `./sage -sh` works from `SAGE_ROOT`?   That would confirm what John and Leif point out here - but it would be nice to have it actually tested, since stranger things have happened.



---

archive/issue_events_123963.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T01:21:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123963"
}
```



---

archive/issue_events_123964.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T01:21:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123964"
}
```



---

archive/issue_comments_083963.json:
```json
{
    "body": "Reviewer: **Leif Leonhardy, John Palmieri**",
    "created_at": "2013-01-16T01:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83963",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Leif Leonhardy, John Palmieri**



---

archive/issue_events_123965.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T01:21:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123965"
}
```



---

archive/issue_events_123966.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T01:21:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123966"
}
```



---

archive/issue_events_123967.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T01:21:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123967"
}
```



---

archive/issue_comments_083964.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI can confirm that ./sage -sh works from SAGE_ROOT, even when SHELL=/bin/sh.",
    "created_at": "2013-01-16T02:48:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83964",
    "user": "https://github.com/sagetrac-stephen"
}
```

<div id="comment:4" align="right">comment:4</div>

I can confirm that ./sage -sh works from SAGE_ROOT, even when SHELL=/bin/sh.



---

archive/issue_events_123968.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T02:58:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123968"
}
```



---

archive/issue_events_123969.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-01-16T02:58:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123969"
}
```



---

archive/issue_comments_083965.json:
```json
{
    "body": "Changed reviewer from **Leif Leonhardy, John Palmieri** to **Leif Leonhardy, John Palmieri, Stephen Montgomery-Smith**",
    "created_at": "2013-01-16T02:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83965",
    "user": "https://github.com/kcrisman"
}
```

Changed reviewer from **Leif Leonhardy, John Palmieri** to **Leif Leonhardy, John Palmieri, Stephen Montgomery-Smith**



---

archive/issue_comments_083966.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nGreat, thank you!",
    "created_at": "2013-01-16T02:58:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/9606#issuecomment-83966",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">comment:5</div>

Great, thank you!



---

archive/issue_events_123970.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T10:03:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123970"
}
```



---

archive/issue_events_123971.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T10:03:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123971"
}
```



---

archive/issue_events_123972.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T10:03:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/9606",
    "label": "https://github.com/sagemath/sage/labels/worksforme",
    "label_color": "a6a6a6",
    "label_name": "worksforme",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/9606#event-123972"
}
```
